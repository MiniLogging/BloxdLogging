"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[10,11],{2474:(J,T,b)=>{var q;b.d(T,{b:()=>t}),function(J){J[J.PointerMove=0]="PointerMove",J[J.PointerDown=1]="PointerDown",J[J.PointerUp=2]="PointerUp"}(q||(q={}));class t{}t.DOM_DELTA_PIXEL=0,t.DOM_DELTA_LINE=1,t.DOM_DELTA_PAGE=2},2468:(J,T,b)=>{b.d(T,{d:()=>q,g:()=>j,i:()=>t});class q{}q.KEYDOWN=1,q.KEYUP=2;class t{constructor(J,T){this.type=J,this.event=T}}class j extends t{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(J){this.skipOnKeyboardObservable=J}constructor(J,T){super(J,T),this.type=J,this.event=T,this.skipOnKeyboardObservable=!1}}},2463:(J,T,b)=>{b.d(T,{d:()=>t,g:()=>B,i:()=>Y});var q=b(697);class t{}t.POINTERDOWN=1,t.POINTERUP=2,t.POINTERMOVE=4,t.POINTERWHEEL=8,t.POINTERPICK=16,t.POINTERTAP=32,t.POINTERDOUBLETAP=64;class j{constructor(J,T){this.type=J,this.event=T}}class B extends j{constructor(J,T,b,t){super(J,T),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new q.k(b,t)}}class Y extends j{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(J,T,b){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(J,T),this._pickInfo=b,this._inputManager=q}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},2501:(J,T,b)=>{var q=b(2309),t=b(2323);t.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(t.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=q.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((J=>{this._texture._sphericalPolynomial=J,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(J){this._texture&&(this._texture._sphericalPolynomial=J)},enumerable:!0,configurable:!0})},2445:(J,T,b)=>{function q(J){J.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}b.d(T,{d:()=>q})},2454:(J,T,b)=>{b.d(T,{e:()=>j,f:()=>t});var q=b(2445);function t(J,T){T.EXPOSURE&&J.push("exposureLinear"),T.CONTRAST&&J.push("contrast"),T.COLORGRADING&&J.push("colorTransformSettings"),(T.VIGNETTE||T.DITHER)&&J.push("vInverseScreenSize"),T.VIGNETTE&&(J.push("vignetteSettings1"),J.push("vignetteSettings2")),T.COLORCURVES&&(0,q.d)(J),T.DITHER&&J.push("ditherIntensity")}function j(J,T){T.COLORGRADING&&J.push("txColorTransform")}},2442:(J,T,b)=>{b.d(T,{b:()=>v});var q=b(674),t=b(680),j=b(497),B=b(731),Y=b(727),C=b(2445);class F{constructor(){this._dirty=!0,this._tempColor=new B.d(0,0,0,0),this._globalCurve=new B.d(0,0,0,0),this._highlightsCurve=new B.d(0,0,0,0),this._midtonesCurve=new B.d(0,0,0,0),this._shadowsCurve=new B.d(0,0,0,0),this._positiveCurve=new B.d(0,0,0,0),this._negativeCurve=new B.d(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(J){this._globalHue=J,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(J){this._globalDensity=J,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(J){this._globalSaturation=J,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(J){this._globalExposure=J,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(J){this._highlightsHue=J,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(J){this._highlightsDensity=J,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(J){this._highlightsSaturation=J,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(J){this._highlightsExposure=J,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(J){this._midtonesHue=J,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(J){this._midtonesDensity=J,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(J){this._midtonesSaturation=J,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(J){this._midtonesExposure=J,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(J){this._shadowsHue=J,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(J){this._shadowsDensity=J,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(J){this._shadowsSaturation=J,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(J){this._shadowsExposure=J,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";J._dirty&&(J._dirty=!1,J._getColorGradingDataToRef(J._globalHue,J._globalDensity,J._globalSaturation,J._globalExposure,J._globalCurve),J._getColorGradingDataToRef(J._highlightsHue,J._highlightsDensity,J._highlightsSaturation,J._highlightsExposure,J._tempColor),J._tempColor.multiplyToRef(J._globalCurve,J._highlightsCurve),J._getColorGradingDataToRef(J._midtonesHue,J._midtonesDensity,J._midtonesSaturation,J._midtonesExposure,J._tempColor),J._tempColor.multiplyToRef(J._globalCurve,J._midtonesCurve),J._getColorGradingDataToRef(J._shadowsHue,J._shadowsDensity,J._shadowsSaturation,J._shadowsExposure,J._tempColor),J._tempColor.multiplyToRef(J._globalCurve,J._shadowsCurve),J._highlightsCurve.subtractToRef(J._midtonesCurve,J._positiveCurve),J._midtonesCurve.subtractToRef(J._shadowsCurve,J._negativeCurve)),T&&(T.setFloat4(b,J._positiveCurve.r,J._positiveCurve.g,J._positiveCurve.b,J._positiveCurve.a),T.setFloat4(q,J._midtonesCurve.r,J._midtonesCurve.g,J._midtonesCurve.b,J._midtonesCurve.a),T.setFloat4(t,J._negativeCurve.r,J._negativeCurve.g,J._negativeCurve.b,J._negativeCurve.a))}_getColorGradingDataToRef(J,T,b,q,t){null!=J&&(J=F._Clamp(J,0,360),T=F._Clamp(T,-100,100),b=F._Clamp(b,-100,100),q=F._Clamp(q,-100,100),T=F._ApplyColorGradingSliderNonlinear(T),T*=.5,q=F._ApplyColorGradingSliderNonlinear(q),T<0&&(T*=-1,J=(J+180)%360),F._FromHSBToRef(J,T,50+.25*q,t),t.scaleToRef(2,t),t.a=1+.01*b)}static _ApplyColorGradingSliderNonlinear(J){J/=100;let T=Math.abs(J);return T=Math.pow(T,2),J<0&&(T*=-1),T*=100,T}static _FromHSBToRef(J,T,b,q){let t=F._Clamp(J,0,360);const j=F._Clamp(T/100,0,1),B=F._Clamp(b/100,0,1);if(0===j)q.r=B,q.g=B,q.b=B;else{t/=60;const J=Math.floor(t),T=t-J,b=B*(1-j),Y=B*(1-j*T),C=B*(1-j*(1-T));switch(J){case 0:q.r=B,q.g=C,q.b=b;break;case 1:q.r=Y,q.g=B,q.b=b;break;case 2:q.r=b,q.g=B,q.b=C;break;case 3:q.r=b,q.g=Y,q.b=B;break;case 4:q.r=C,q.g=b,q.b=B;break;default:q.r=B,q.g=b,q.b=Y}}q.a=1}static _Clamp(J,T,b){return Math.min(Math.max(J,T),b)}clone(){return Y.d.Clone((()=>new F),this)}serialize(){return Y.d.Serialize(this)}static Parse(J){return Y.d.Parse((()=>new F),J,null,null)}}F.PrepareUniforms=C.d,(0,q.e)([(0,t.M)()],F.prototype,"_globalHue",void 0),(0,q.e)([(0,t.M)()],F.prototype,"_globalDensity",void 0),(0,q.e)([(0,t.M)()],F.prototype,"_globalSaturation",void 0),(0,q.e)([(0,t.M)()],F.prototype,"_globalExposure",void 0),(0,q.e)([(0,t.M)()],F.prototype,"_highlightsHue",void 0),(0,q.e)([(0,t.M)()],F.prototype,"_highlightsDensity",void 0),(0,q.e)([(0,t.M)()],F.prototype,"_highlightsSaturation",void 0),(0,q.e)([(0,t.M)()],F.prototype,"_highlightsExposure",void 0),(0,q.e)([(0,t.M)()],F.prototype,"_midtonesHue",void 0),(0,q.e)([(0,t.M)()],F.prototype,"_midtonesDensity",void 0),(0,q.e)([(0,t.M)()],F.prototype,"_midtonesSaturation",void 0),(0,q.e)([(0,t.M)()],F.prototype,"_midtonesExposure",void 0),Y.d._ColorCurvesParser=F.Parse;var A=b(646),a=b(2454),P=b(639);class v{constructor(){this.colorCurves=new F,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=v.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new B.d(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=v.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.outputTextureWidth=0,this.outputTextureHeight=0,this.onUpdateParameters=new j.b}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(J){this._colorCurvesEnabled!==J&&(this._colorCurvesEnabled=J,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(J){this._colorGradingTexture!==J&&(this._colorGradingTexture=J,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(J){this._colorGradingEnabled!==J&&(this._colorGradingEnabled=J,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(J){this._colorGradingWithGreenDepth!==J&&(this._colorGradingWithGreenDepth=J,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(J){this._colorGradingBGR!==J&&(this._colorGradingBGR=J,this._updateParameters())}get exposure(){return this._exposure}set exposure(J){this._exposure!==J&&(this._exposure=J,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(J){this._toneMappingEnabled!==J&&(this._toneMappingEnabled=J,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(J){this._toneMappingType!==J&&(this._toneMappingType=J,this._updateParameters())}get contrast(){return this._contrast}set contrast(J){this._contrast!==J&&(this._contrast=J,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(J){this.vignetteCenterY=J}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(J){this.vignetteCenterX=J}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(J){this._vignetteBlendMode!==J&&(this._vignetteBlendMode=J,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(J){this._vignetteEnabled!==J&&(this._vignetteEnabled=J,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(J){this._ditheringEnabled!==J&&(this._ditheringEnabled=J,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(J){this._ditheringIntensity!==J&&(this._ditheringIntensity=J,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(J){this._skipFinalColorClamp!==J&&(this._skipFinalColorClamp=J,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(J){this._applyByPostProcess!==J&&(this._applyByPostProcess=J,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(J){this._isEnabled!==J&&(this._isEnabled=J,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(J){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return J.VIGNETTE=!1,J.TONEMAPPING=0,J.CONTRAST=!1,J.EXPOSURE=!1,J.COLORCURVES=!1,J.COLORGRADING=!1,J.COLORGRADING3D=!1,J.DITHER=!1,J.IMAGEPROCESSING=!1,J.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(J.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(J.VIGNETTE=this.vignetteEnabled,J.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===v._VIGNETTEMODE_MULTIPLY,J.VIGNETTEBLENDMODEOPAQUE=!J.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case v.TONEMAPPING_KHR_PBR_NEUTRAL:J.TONEMAPPING=3;break;case v.TONEMAPPING_ACES:J.TONEMAPPING=2;break;default:J.TONEMAPPING=1}else J.TONEMAPPING=0;J.CONTRAST=1!==this.contrast,J.EXPOSURE=1!==this.exposure,J.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,J.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,J.COLORGRADING?J.COLORGRADING3D=this.colorGradingTexture.is3D:J.COLORGRADING3D=!1,J.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,J.SAMPLER3DBGRMAP=this.colorGradingBGR,J.DITHER=this._ditheringEnabled,J.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,J.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,J.IMAGEPROCESSING=J.VIGNETTE||!!J.TONEMAPPING||J.CONTRAST||J.EXPOSURE||J.COLORCURVES||J.COLORGRADING||J.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(J,T){if(this._colorCurvesEnabled&&this.colorCurves&&F.Bind(this.colorCurves,J),this._vignetteEnabled||this._ditheringEnabled){const b=1/(this.outputTextureWidth||J.getEngine().getRenderWidth()),q=1/(this.outputTextureHeight||J.getEngine().getRenderHeight());if(J.setFloat2("vInverseScreenSize",b,q),this._ditheringEnabled&&J.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const t=null!=T?T:q/b;let j=Math.tan(.5*this.vignetteCameraFov),B=j*t;const Y=Math.sqrt(B*j);B=(0,A.i)(B,Y,this.vignetteStretch),j=(0,A.i)(j,Y,this.vignetteStretch),J.setFloat4("vignetteSettings1",B,j,-B*this.vignetteCenterX,-j*this.vignetteCenterY);const C=-2*this.vignetteWeight;J.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,C)}}if(J.setFloat("exposureLinear",this.exposure),J.setFloat("contrast",this.contrast),this.colorGradingTexture){J.setTexture("txColorTransform",this.colorGradingTexture);const T=this.colorGradingTexture.getSize().height;J.setFloat4("colorTransformSettings",(T-1)/T,.5/T,T,this.colorGradingTexture.level)}}clone(){return Y.d.Clone((()=>new v),this)}serialize(){return Y.d.Serialize(this)}static Parse(J){const T=Y.d.Parse((()=>new v),J,null,null);return void 0!==J.vignetteCentreX&&(T.vignetteCenterX=J.vignetteCentreX),void 0!==J.vignetteCentreY&&(T.vignetteCenterY=J.vignetteCentreY),T}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}v.TONEMAPPING_STANDARD=0,v.TONEMAPPING_ACES=1,v.TONEMAPPING_KHR_PBR_NEUTRAL=2,v.PrepareUniforms=a.f,v.PrepareSamplers=a.e,v._VIGNETTEMODE_MULTIPLY=0,v._VIGNETTEMODE_OPAQUE=1,(0,q.e)([(0,t.k)()],v.prototype,"colorCurves",void 0),(0,q.e)([(0,t.M)()],v.prototype,"_colorCurvesEnabled",void 0),(0,q.e)([(0,t.D)("colorGradingTexture")],v.prototype,"_colorGradingTexture",void 0),(0,q.e)([(0,t.M)()],v.prototype,"_colorGradingEnabled",void 0),(0,q.e)([(0,t.M)()],v.prototype,"_colorGradingWithGreenDepth",void 0),(0,q.e)([(0,t.M)()],v.prototype,"_colorGradingBGR",void 0),(0,q.e)([(0,t.M)()],v.prototype,"_exposure",void 0),(0,q.e)([(0,t.M)()],v.prototype,"_toneMappingEnabled",void 0),(0,q.e)([(0,t.M)()],v.prototype,"_toneMappingType",void 0),(0,q.e)([(0,t.M)()],v.prototype,"_contrast",void 0),(0,q.e)([(0,t.M)()],v.prototype,"vignetteStretch",void 0),(0,q.e)([(0,t.M)()],v.prototype,"vignetteCenterX",void 0),(0,q.e)([(0,t.M)()],v.prototype,"vignetteCenterY",void 0),(0,q.e)([(0,t.M)()],v.prototype,"vignetteWeight",void 0),(0,q.e)([(0,t.r)()],v.prototype,"vignetteColor",void 0),(0,q.e)([(0,t.M)()],v.prototype,"vignetteCameraFov",void 0),(0,q.e)([(0,t.M)()],v.prototype,"_vignetteBlendMode",void 0),(0,q.e)([(0,t.M)()],v.prototype,"_vignetteEnabled",void 0),(0,q.e)([(0,t.M)()],v.prototype,"_ditheringEnabled",void 0),(0,q.e)([(0,t.M)()],v.prototype,"_ditheringIntensity",void 0),(0,q.e)([(0,t.M)()],v.prototype,"_skipFinalColorClamp",void 0),(0,q.e)([(0,t.M)()],v.prototype,"_applyByPostProcess",void 0),(0,q.e)([(0,t.M)()],v.prototype,"_isEnabled",void 0),(0,q.e)([(0,t.M)()],v.prototype,"outputTextureWidth",void 0),(0,q.e)([(0,t.M)()],v.prototype,"outputTextureHeight",void 0),Y.d._ImageProcessingConfigurationParser=v.Parse,(0,P.g)("BABYLON.ImageProcessingConfiguration",v)},2493:(J,T,b)=>{b.r(T),b.d(T,{Dispose:()=>P,DumpData:()=>a,DumpDataAsync:()=>A,DumpFramebuffer:()=>F,DumpTools:()=>v});var q=b(2343),t=b(505),j=b(717),B=b(550);let Y,C=null;async function F(J,T,b,q){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",j=arguments.length>5?arguments[5]:void 0,B=arguments.length>6?arguments[6]:void 0;const Y=await b.readPixels(0,0,J,T);a(J,T,new Uint8Array(Y.buffer),q,t,j,!0,void 0,B)}async function A(J,T,b){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",t=arguments.length>4?arguments[4]:void 0,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7?arguments[7]:void 0;return await new Promise((C=>{a(J,T,b,(J=>C(J)),q,t,j,B,Y)}))}function a(J,T,F,A){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",v=arguments.length>5?arguments[5]:void 0,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7&&void 0!==arguments[7]&&arguments[7],I=arguments.length>8?arguments[8]:void 0;(async function(){return C||(C=new Promise(((J,T)=>{let t,j=null;const C={Rk:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(b.bind(b,2354)).then((F=>{let{ThinEngine:A}=F;const a=B.e.Instances.length;try{t=new OffscreenCanvas(100,100),j=new A(t,!1,C)}catch(x){var v;a<B.e.Instances.length&&(null===(v=B.e.Instances.pop())||void 0===v||v.dispose()),t=document.createElement("canvas"),j=new A(t,!1,C)}B.e.Instances.pop(),B.e.OnEnginesDisposedObservable.add((J=>{j&&J!==j&&!j.u&&0===B.e.Instances.length&&P()})),j.getCaps().parallelShaderCompile=void 0;const G=new q.d(j);b.e(35).then(b.bind(b,13182)).then((b=>{let{passPixelShader:B}=b;if(!j)return void T("Engine is not defined");const C=new q.e({Li:j,name:B.name,fragmentShader:B.shader,samplerNames:["textureSampler"]});Y={canvas:t,Li:j,renderer:G,wrapper:C},J(Y)}))})).catch(T)}))),await C})().then((b=>{if(b.Li.setSize(J,T,!0),F instanceof Float32Array){const J=new Uint8Array(F.length);let T=F.length;for(;T--;){const b=F[T];J[T]=Math.round(255*(0,j.b)(b))}F=J}const q=b.Li.createRawTexture(F,J,T,5,!1,!G,1);b.renderer.setViewport(),b.renderer.applyEffectWrapper(b.wrapper),b.wrapper.effect._bindTexture("textureSampler",q),b.renderer.draw(),x?t.e.ToBlob(b.canvas,(J=>{const T=new FileReader;T.onload=J=>{const T=J.target.result;A&&A(T)},T.readAsArrayBuffer(J)}),a,I):t.e.EncodeScreenshotCanvasData(b.canvas,A,a,v,I),q.dispose()}))}function P(){var J;Y?(Y.wrapper.dispose(),Y.renderer.dispose(),Y.Li.dispose()):null===(J=C)||void 0===J||J.then((J=>{J.wrapper.dispose(),J.renderer.dispose(),J.Li.dispose()}));C=null,Y=null}const v={DumpData:a,DumpDataAsync:A,DumpFramebuffer:F,Dispose:P};t.e.DumpData=a,t.e.DumpDataAsync=A,t.e.DumpFramebuffer=F},2433:(J,T,b)=>{b.d(T,{b:()=>G,d:()=>U,e:()=>p,h:()=>o});var q=b(505),t=b(697),j=b(717),B=b(2279),Y=b(615),C=b(2323),F=(b(2440),b(2341)),A=b(519);b(2490),b(2493),b(2501);const a="image/png",P=2,v=[134,22,135,150,246,214,150,54];function G(J){const T=new DataView(J.buffer,J.byteOffset,J.byteLength);let b=0;for(let B=0;B<v.length;B++)if(T.getUint8(b++)!==v[B])return A.d.Error("Not a babylon environment map"),null;let q="",t=0;for(;t=T.getUint8(b++);)q+=String.fromCharCode(t);let j=JSON.parse(q);return j=x(j),j.binaryDataPosition=b,j.ej&&(j.ej.lodGenerationScale=j.ej.lodGenerationScale||.8),j}function x(J){if(J.version>P)throw new Error(`Unsupported babylon environment map version "${J.version}". Latest supported version is "${P}".`);return 2===J.version?J:J={...J,version:2,imageType:a}}function I(J,T){const b=(T=x(T)).ej;let q=Math.log2(T.width);if(q=Math.round(q)+1,b.mipmaps.length!==6*q)throw new Error(`Unsupported specular mipmaps number "${b.mipmaps.length}"`);const t=new Array(q);for(let j=0;j<q;j++){t[j]=new Array(6);for(let q=0;q<6;q++){const B=b.mipmaps[6*j+q];t[j][q]=new Uint8Array(J.buffer,J.byteOffset+T.binaryDataPosition+B.position,B.length)}}return t}function u(J,T){var b;T=x(T);const q=new Array(6),t=null===(b=T.irradiance)||void 0===b?void 0:b.irradianceTexture;if(t){if(6!==t.faces.length)throw new Error(`Incorrect irradiance texture faces number "${t.faces.length}"`);for(let b=0;b<6;b++){const j=t.faces[b];q[b]=new Uint8Array(J.buffer,J.byteOffset+T.binaryDataPosition+j.position,j.length)}}return q}function U(J,T,b){var q;const j=(b=x(b)).ej;if(!j)return Promise.resolve([]);J._lodGenerationScale=j.lodGenerationScale;const B=[],Y=I(T,b);B.push(E(J,Y,b.imageType));const C=null===(q=b.irradiance)||void 0===q?void 0:q.irradianceTexture;if(C){var F,A;const q=u(T,b);let j=null;null!==(F=b.irradiance)&&void 0!==F&&null!==(A=F.irradianceTexture)&&void 0!==A&&A.dominantDirection&&(j=t.n.ni(b.irradiance.irradianceTexture.dominantDirection)),B.push(l(J,q,C.size,b.imageType,j))}return Promise.all(B)}async function K(J,T,b,q,t,j,B,Y,C,F,A){return await new Promise(((a,P)=>{if(b){const b=T.createTexture(null,!0,!0,null,1,null,(J=>{P(J)}),J);null===q||void 0===q||q.onEffectCreatedObservable.addOnce((Y=>{Y.executeWhenCompiled((()=>{q.externalTextureSamplerBinding=!0,q.onApply=q=>{q._bindTexture("textureSampler",b),q.setFloat2("scale",1,T._features.needsInvertingBitmap&&J instanceof ImageBitmap?-1:1)},T.scenes.length&&(T.scenes[0].postProcessManager.directRender([q],F,!0,j,B),T.restoreDefaultFramebuffer(),b.dispose(),URL.revokeObjectURL(t),a())}))}))}else{if(T._uploadImageToTexture(A,J,j,B),Y){const b=C[B];b&&T._uploadImageToTexture(b._texture,J,j,0)}a()}}))}async function E(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a;const q=J.getEngine();J.format=5,J.type=0,J.generateMipMaps=!0,J._cachedAnisotropicFilteringLevel=null,q.updateTextureSamplingMode(3,J),await W(J,T,!0,b),J.isReady=!0}async function l(J,T,b){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const j=J.getEngine(),B=new Y.d(j,5),F=new C.d(j,B);J._irradianceTexture=F,F._dominantDirection=t,B.isCube=!0,B.format=5,B.type=0,B.generateMipMaps=!0,B._cachedAnisotropicFilteringLevel=null,B.generateMipMaps=!0,B.width=b,B.height=b,j.updateTextureSamplingMode(3,B),await W(B,[T],!1,q),j.generateMipMapsForCubemap(B),B.isReady=!0}async function W(J,T,t){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a;if(!q.e.IsExponentOfTwo(J.width))throw new Error("Texture size must be a power of two");const A=(0,j.j)(J.width)+1,P=J.getEngine();let v=!1,G=!1,x=null,I=null,u=null;const U=P.getCaps();U.textureLOD?P._features.supportRenderAndCopyToLodForFloatTextures?U.textureHalfFloatRender&&U.textureHalfFloatLinearFiltering?(v=!0,J.type=2):U.textureFloatRender&&U.textureFloatLinearFiltering&&(v=!0,J.type=1):v=!1:(v=!1,G=t);let E=0;if(v)P.isWebGPU?(E=1,await b.e(26).then(b.bind(b,13196))):await b.e(24).then(b.bind(b,13200)),x=new F.e("rgbdDecode","rgbdDecode",null,null,1,null,3,P,!1,void 0,J.type,void 0,null,!1,void 0,E),J._isRGBD=!1,J.invertY=!1,I=P.createRenderTargetCubeTexture(J.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:J.type,format:5});else if(J._isRGBD=!0,J.invertY=!0,G){const T=3;u={};const b=J._lodGenerationScale,q=J._lodGenerationOffset;for(let t=0;t<T;t++){const j=(A-1)*b+q,B=q+(j-q)*(1-t/(T-1)),F=Math.round(Math.min(Math.max(B,0),j)),a=new Y.d(P,2);a.isCube=!0,a.invertY=!0,a.generateMipMaps=!1,P.updateTextureSamplingMode(2,a);const v=new C.d(null);switch(v._isCube=!0,v._texture=a,u[F]=v,t){case 0:J._lodTextureLow=v;break;case 1:J._lodTextureMid=v;break;case 2:J._lodTextureHigh=v}}}const l=[];for(let b=0;b<T.length;b++)for(let q=0;q<6;q++){const t=T[b][q],j=new Blob([t],{type:B}),Y=URL.createObjectURL(j);let C;if(P._features.forceBitmapOverHTMLImageElement)C=P.createImageBitmap(j,{premultiplyAlpha:"none"}).then((async T=>await K(T,P,v,x,Y,q,b,G,u,I,J)));else{const T=new Image;T.src=Y,C=new Promise(((t,j)=>{T.onload=()=>{K(T,P,v,x,Y,q,b,G,u,I,J).then((()=>t())).catch((J=>{j(J)}))},T.onerror=J=>{j(J)}}))}l.push(C)}if(await Promise.all(l),T.length<A){let b;const q=Math.pow(2,A-1-T.length),t=q*q*4;switch(J.type){case 0:b=new Uint8Array(t);break;case 2:b=new Uint16Array(t);break;case 1:b=new Float32Array(t)}for(let j=T.length;j<A;j++)for(let T=0;T<6;T++){var W;P._uploadArrayBufferViewToTexture((null===(W=I)||void 0===W?void 0:W.texture)||J,b,T,j)}}if(I){const T=J._irradianceTexture;J._irradianceTexture=null,P._releaseTexture(J),I._swapAndDie(J),J._irradianceTexture=T}x&&x.dispose(),G&&(J._lodTextureHigh&&J._lodTextureHigh._texture&&(J._lodTextureHigh._texture.isReady=!0),J._lodTextureMid&&J._lodTextureMid._texture&&(J._lodTextureMid._texture.isReady=!0),J._lodTextureLow&&J._lodTextureLow._texture&&(J._lodTextureLow._texture.isReady=!0))}function p(J,T){const b=(T=x(T)).irradiance;if(!b)return;const q=new B.i;t.n.FromArrayToRef(b.x,0,q.x),t.n.FromArrayToRef(b.y,0,q.y),t.n.FromArrayToRef(b.z,0,q.z),t.n.FromArrayToRef(b.xx,0,q.xx),t.n.FromArrayToRef(b.yy,0,q.yy),t.n.FromArrayToRef(b.zz,0,q.zz),t.n.FromArrayToRef(b.yz,0,q.yz),t.n.FromArrayToRef(b.zx,0,q.zx),t.n.FromArrayToRef(b.xy,0,q.xy),J._sphericalPolynomial=q}function o(J,T,b,q,t){const j=E(J.getEngine().createRawCubeTexture(null,J.width,J.format,J.type,J.generateMipMaps,J.invertY,J.samplingMode,J._compression),T).then((()=>J));return J.onRebuildCallback=J=>({proxy:j,isReady:!0,isAsync:!0}),J._source=13,J._bufferViewArrayArray=T,J._lodGenerationScale=q,J._lodGenerationOffset=t,J._sphericalPolynomial=b,E(J,T).then((()=>(J.isReady=!0,J)))}},2490:(J,T,b)=>{b.d(T,{d:()=>j});var q=b(2341),t=b(2317);class j{static ExpandRGBDTexture(J){const T=J._texture;if(!T||!J.isRGBD)return;const t=T.getEngine(),j=t.getCaps(),B=T.isReady;let Y=!1;j.textureHalfFloatRender&&j.textureHalfFloatLinearFiltering?(Y=!0,T.type=2):j.textureFloatRender&&j.textureFloatLinearFiltering&&(Y=!0,T.type=1),Y&&(T.isReady=!1,T._isRGBD=!1,T.invertY=!1);const C=async()=>{const j=t.isWebGPU,B=j?1:0;T.isReady=!1,j?await b.e(26).then(b.bind(b,13196)):await b.e(24).then(b.bind(b,13200));const Y=new q.e("rgbdDecode","rgbdDecode",null,null,1,null,3,t,!1,void 0,T.type,void 0,null,!1,void 0,B);Y.externalTextureSamplerBinding=!0;const C=t.createRenderTargetTexture(T.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:T.samplingMode,type:T.type,format:5});Y.onEffectCreatedObservable.addOnce((b=>{b.executeWhenCompiled((()=>{Y.onApply=J=>{J._bindTexture("textureSampler",T),J.setFloat2("scale",1,1)},J.va().postProcessManager.directRender([Y],C,!0),t.restoreDefaultFramebuffer(),t._releaseTexture(T),Y&&Y.dispose(),C._swapAndDie(T),T.isReady=!0}))}))};Y&&(B?C():J.onLoadObservable.addOnce(C))}static async EncodeTextureToRGBD(J,T){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return T.getEngine().isWebGPU?await b.e(27).then(b.bind(b,13215)):await b.e(25).then(b.bind(b,13207)),await(0,t.e)("rgbdEncode",J,T,q,1,5)}}},2487:(J,T,b)=>{b.d(T,{e:()=>q});class q{static get UniqueId(){const J=this._UniqueIdCounter;return this._UniqueIdCounter++,J}}q._UniqueIdCounter=1},2482:(J,T,b)=>{b.d(T,{e:()=>q});class q{}q._IsPickingAvailable=!1},2440:(J,T,b)=>{b.d(T,{b:()=>JJ});var q=b(505),t=b(529),j=b(497),B=b(689);class Y{constructor(){this._count=0,this._data={}}p(J){this.clear(),J.forEach(((J,T)=>this.add(J,T)))}get(J){const T=this._data[J];if(void 0!==T)return T}getOrAddWithFactory(J,T){let b=this.get(J);return void 0!==b||(b=T(J),b&&this.add(J,b)),b}getOrAdd(J,T){const b=this.get(J);return void 0!==b?b:(this.add(J,T),T)}contains(J){return void 0!==this._data[J]}add(J,T){return void 0===this._data[J]&&(this._data[J]=T,++this._count,!0)}set(J,T){return void 0!==this._data[J]&&(this._data[J]=T,!0)}getAndRemove(J){const T=this.get(J);return void 0!==T?(delete this._data[J],--this._count,T):null}remove(J){return!!this.contains(J)&&(delete this._data[J],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(J){for(const T in this._data){J(T,this._data[T])}}first(J){for(const T in this._data){const b=J(T,this._data[T]);if(b)return b}return null}}var C=b(654),F=b(697),A=b(2442),a=b(845),P=b(841);class v{constructor(J,T,b,q,t,j){this.source=J,this.pointerX=T,this.pointerY=b,this.meshUnderPointer=q,this.sourceEvent=t,this.additionalData=j}static CreateNew(J,T,b){const q=J.va();return new v(J,q.pointerX,q.pointerY,q.meshUnderPointer||J,T,b)}static CreateNewFromSprite(J,T,b,q){return new v(J,T.pointerX,T.pointerY,T.meshUnderPointer,b,q)}static CreateNewFromScene(J,T){return new v(null,J.pointerX,J.pointerY,J.meshUnderPointer,T)}static CreateNewFromPrimitive(J,T,b,q){return new v(J,T.x,T.y,null,b,q)}}var G=b(2331),x=b(2338),I=b(884),u=b(510),U=b(550),K=b(533),E=b(2463);class l{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const J in l.Triggers)if(Object.prototype.hasOwnProperty.call(l.Triggers,J))return!0;return!1}static get HasPickTriggers(){for(const J in l.Triggers)if(Object.prototype.hasOwnProperty.call(l.Triggers,J)){const T=parseInt(J);if(T>=1&&T<=7)return!0}return!1}static HasSpecificTrigger(J){for(const T in l.Triggers)if(Object.prototype.hasOwnProperty.call(l.Triggers,T)){if(parseInt(T)===J)return!0}return!1}}l.Triggers={};var W,p,o,S,H,s,g,d=b(2468);!function(J){J[J.Generic=0]="Generic",J[J.Keyboard=1]="Keyboard",J[J.Mouse=2]="Mouse",J[J.Touch=3]="Touch",J[J.DualShock=4]="DualShock",J[J.Xbox=5]="Xbox",J[J.Switch=6]="Switch",J[J.DualSense=7]="DualSense"}(W||(W={})),function(J){J[J.Horizontal=0]="Horizontal",J[J.Vertical=1]="Vertical",J[J.LeftClick=2]="LeftClick",J[J.MiddleClick=3]="MiddleClick",J[J.RightClick=4]="RightClick",J[J.BrowserBack=5]="BrowserBack",J[J.BrowserForward=6]="BrowserForward",J[J.MouseWheelX=7]="MouseWheelX",J[J.MouseWheelY=8]="MouseWheelY",J[J.MouseWheelZ=9]="MouseWheelZ",J[J.Move=12]="Move"}(p||(p={})),function(J){J[J.Horizontal=0]="Horizontal",J[J.Vertical=1]="Vertical",J[J.LeftClick=2]="LeftClick",J[J.MiddleClick=3]="MiddleClick",J[J.RightClick=4]="RightClick",J[J.BrowserBack=5]="BrowserBack",J[J.BrowserForward=6]="BrowserForward",J[J.MouseWheelX=7]="MouseWheelX",J[J.MouseWheelY=8]="MouseWheelY",J[J.MouseWheelZ=9]="MouseWheelZ",J[J.DeltaHorizontal=10]="DeltaHorizontal",J[J.DeltaVertical=11]="DeltaVertical"}(o||(o={})),function(J){J[J.Cross=0]="Cross",J[J.Circle=1]="Circle",J[J.Square=2]="Square",J[J.Triangle=3]="Triangle",J[J.L1=4]="L1",J[J.R1=5]="R1",J[J.L2=6]="L2",J[J.R2=7]="R2",J[J.Share=8]="Share",J[J.Options=9]="Options",J[J.L3=10]="L3",J[J.R3=11]="R3",J[J.DPadUp=12]="DPadUp",J[J.DPadDown=13]="DPadDown",J[J.DPadLeft=14]="DPadLeft",J[J.DPadRight=15]="DPadRight",J[J.Home=16]="Home",J[J.TouchPad=17]="TouchPad",J[J.LStickXAxis=18]="LStickXAxis",J[J.LStickYAxis=19]="LStickYAxis",J[J.RStickXAxis=20]="RStickXAxis",J[J.RStickYAxis=21]="RStickYAxis"}(S||(S={})),function(J){J[J.Cross=0]="Cross",J[J.Circle=1]="Circle",J[J.Square=2]="Square",J[J.Triangle=3]="Triangle",J[J.L1=4]="L1",J[J.R1=5]="R1",J[J.L2=6]="L2",J[J.R2=7]="R2",J[J.Create=8]="Create",J[J.Options=9]="Options",J[J.L3=10]="L3",J[J.R3=11]="R3",J[J.DPadUp=12]="DPadUp",J[J.DPadDown=13]="DPadDown",J[J.DPadLeft=14]="DPadLeft",J[J.DPadRight=15]="DPadRight",J[J.Home=16]="Home",J[J.TouchPad=17]="TouchPad",J[J.LStickXAxis=18]="LStickXAxis",J[J.LStickYAxis=19]="LStickYAxis",J[J.RStickXAxis=20]="RStickXAxis",J[J.RStickYAxis=21]="RStickYAxis"}(H||(H={})),function(J){J[J.A=0]="A",J[J.B=1]="B",J[J.X=2]="X",J[J.Y=3]="Y",J[J.LB=4]="LB",J[J.RB=5]="RB",J[J.LT=6]="LT",J[J.RT=7]="RT",J[J.Back=8]="Back",J[J.Start=9]="Start",J[J.LS=10]="LS",J[J.RS=11]="RS",J[J.DPadUp=12]="DPadUp",J[J.DPadDown=13]="DPadDown",J[J.DPadLeft=14]="DPadLeft",J[J.DPadRight=15]="DPadRight",J[J.Home=16]="Home",J[J.LStickXAxis=17]="LStickXAxis",J[J.LStickYAxis=18]="LStickYAxis",J[J.RStickXAxis=19]="RStickXAxis",J[J.RStickYAxis=20]="RStickYAxis"}(s||(s={})),function(J){J[J.B=0]="B",J[J.A=1]="A",J[J.Y=2]="Y",J[J.X=3]="X",J[J.L=4]="L",J[J.R=5]="R",J[J.ZL=6]="ZL",J[J.ZR=7]="ZR",J[J.Minus=8]="Minus",J[J.Plus=9]="Plus",J[J.LS=10]="LS",J[J.RS=11]="RS",J[J.DPadUp=12]="DPadUp",J[J.DPadDown=13]="DPadDown",J[J.DPadLeft=14]="DPadLeft",J[J.DPadRight=15]="DPadRight",J[J.Home=16]="Home",J[J.Capture=17]="Capture",J[J.LStickXAxis=18]="LStickXAxis",J[J.LStickYAxis=19]="LStickYAxis",J[J.RStickXAxis=20]="RStickXAxis",J[J.RStickYAxis=21]="RStickYAxis"}(g||(g={}));var w=b(2474);class Z{static CreateDeviceEvent(J,T,b,q,t,j,B){switch(J){case W.Keyboard:return this._CreateKeyboardEvent(b,q,t,j);case W.Mouse:if(b===p.MouseWheelX||b===p.MouseWheelY||b===p.MouseWheelZ)return this._CreateWheelEvent(J,T,b,q,t,j);case W.Touch:return this._CreatePointerEvent(J,T,b,q,t,j,B);default:throw`Unable to generate event for device ${W[J]}`}}static _CreatePointerEvent(J,T,b,q,t,j,B){const Y=this._CreateMouseEvent(J,T,b,q,t,j);J===W.Mouse?(Y.deviceType=W.Mouse,Y.pointerId=1,Y.pointerType="mouse"):(Y.deviceType=W.Touch,Y.pointerId=B??T,Y.pointerType="touch");let C=0;return C+=t.pollInput(J,T,p.LeftClick),C+=2*t.pollInput(J,T,p.RightClick),C+=4*t.pollInput(J,T,p.MiddleClick),Y.buttons=C,b===p.Move?Y.type="pointermove":b>=p.LeftClick&&b<=p.RightClick&&(Y.type=1===q?"pointerdown":"pointerup",Y.button=b-2),Y}static _CreateWheelEvent(J,T,b,q,t,j){const B=this._CreateMouseEvent(J,T,b,q,t,j);switch(B.pointerId=1,B.type="wheel",B.deltaMode=w.b.DOM_DELTA_PIXEL,B.deltaX=0,B.deltaY=0,B.deltaZ=0,b){case p.MouseWheelX:B.deltaX=q;break;case p.MouseWheelY:B.deltaY=q;break;case p.MouseWheelZ:B.deltaZ=q}return B}static _CreateMouseEvent(J,T,b,q,t,j){const B=this._CreateEvent(j),Y=t.pollInput(J,T,p.Horizontal),C=t.pollInput(J,T,p.Vertical);return j?(B.movementX=0,B.movementY=0,B.offsetX=B.movementX-j.getBoundingClientRect().x,B.offsetY=B.movementY-j.getBoundingClientRect().y):(B.movementX=t.pollInput(J,T,10),B.movementY=t.pollInput(J,T,11),B.offsetX=0,B.offsetY=0),this._CheckNonCharacterKeys(B,t),B.clientX=Y,B.clientY=C,B.x=Y,B.y=C,B.deviceType=J,B.deviceSlot=T,B.inputIndex=b,B}static _CreateKeyboardEvent(J,T,b,q){const t=this._CreateEvent(q);return this._CheckNonCharacterKeys(t,b),t.deviceType=W.Keyboard,t.deviceSlot=0,t.inputIndex=J,t.type=1===T?"keydown":"keyup",t.key=String.fromCharCode(J),t.keyCode=J,t}static _CheckNonCharacterKeys(J,T){const b=T.isDeviceAvailable(W.Keyboard),q=b&&1===T.pollInput(W.Keyboard,0,18),t=b&&1===T.pollInput(W.Keyboard,0,17),j=b&&(1===T.pollInput(W.Keyboard,0,91)||1===T.pollInput(W.Keyboard,0,92)||1===T.pollInput(W.Keyboard,0,93)),B=b&&1===T.pollInput(W.Keyboard,0,16);J.altKey=q,J.ctrlKey=t,J.metaKey=j,J.shiftKey=B}static _CreateEvent(J){const T={preventDefault:()=>{}};return T.target=J,T}}class e{constructor(J,T,b){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(J,T,((J,T,q,t)=>{const j=Z.CreateDeviceEvent(J,T,q,t,this);b(J,T,j)})):this._createDummyNativeInput()}pollInput(J,T,b){return this._nativeInput.pollInput(J,T,b)}isDeviceAvailable(J){return J===W.Mouse||J===W.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const c=Object.keys(p).length/2;class V{constructor(J,T,b,t){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=q.e.IsSafari(),this._usingMacOs=(0,u.g)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=J=>{},this._keyboardUpEvent=J=>{},this._keyboardBlurEvent=J=>{},this._pointerMoveEvent=J=>{},this._pointerDownEvent=J=>{},this._pointerUpEvent=J=>{},this._pointerCancelEvent=J=>{},this._pointerCancelTouch=J=>{},this._pointerLeaveEvent=J=>{},this._pointerWheelEvent=J=>{},this._pointerBlurEvent=J=>{},this._pointerMacOsChromeOutEvent=J=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,u.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,u.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=J=>{},this._gamepadDisconnectedEvent=J=>{},this._eventPrefix=q.e.GetPointerPrefix(J),this._engine=J,this._onDeviceConnected=T,this._onDeviceDisconnected=b,this._onInputChanged=t,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOs&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(J,T,b){const t=this._inputs[J][T];if(!t)throw`Unable to find device ${W[J]}`;J>=W.DualShock&&J<=W.DualSense&&this._updateDevice(J,T,b);const j=t[b];if(void 0===j)throw`Unable to find input ${b} for device ${W[J]} in slot ${T}`;return b===p.Move&&q.e.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),j}isDeviceAvailable(J){return void 0!==this._inputs[J]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const J=null===this||void 0===this?void 0:this._engine.getInputElement();if(J&&(!this._eventsAttached||this._elementToAttachTo!==J)){if(this._disableEvents(),this._inputs)for(const J of this._inputs)if(J)for(const T in J){const b=J[+T];if(b)for(let J=0;J<b.length;J++)b[J]=0}this._elementToAttachTo=J,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOs&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const J=navigator.getGamepads();for(const T of J)T&&this._addGamePad(T)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(W.Mouse,0,0,0)}_addGamePad(J){const T=this._getGamepadDeviceType(J.id),b=J.index;this._gamepads=this._gamepads||new Array(J.index+1),this._registerDevice(T,b,J.buttons.length+J.axes.length),this._gamepads[b]=T}_addPointerDevice(J,T,b,q){this._pointerActive||(this._pointerActive=!0),this._registerDevice(J,T,c);const t=this._inputs[J][T];t[0]=b,t[1]=q}_registerDevice(J,T,b){if(void 0===T)throw`Unable to register device ${W[J]} to undefined slot.`;if(this._inputs[J]||(this._inputs[J]={}),!this._inputs[J][T]){const q=new Array(b);q.fill(0),this._inputs[J][T]=q,this._onDeviceConnected(J,T)}}_unregisterDevice(J,T){this._inputs[J][T]&&(delete this._inputs[J][T],this._onDeviceDisconnected(J,T))}_handleKeyActions(){this._keyboardDownEvent=J=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(W.Keyboard,0,255));const T=this._inputs[W.Keyboard][0];if(T){T[J.keyCode]=1;const b=J;b.inputIndex=J.keyCode,this._usingMacOs&&J.metaKey&&"Meta"!==J.key&&(this._metaKeys.includes(J.keyCode)||this._metaKeys.push(J.keyCode)),this._onInputChanged(W.Keyboard,0,b)}},this._keyboardUpEvent=J=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(W.Keyboard,0,255));const T=this._inputs[W.Keyboard][0];if(T){T[J.keyCode]=0;const b=J;if(b.inputIndex=J.keyCode,this._usingMacOs&&"Meta"===J.key&&this._metaKeys.length>0){for(const J of this._metaKeys){const b=Z.CreateDeviceEvent(W.Keyboard,0,J,0,this,this._elementToAttachTo);T[J]=0,this._onInputChanged(W.Keyboard,0,b)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(W.Keyboard,0,b)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const J=this._inputs[W.Keyboard][0];for(let T=0;T<J.length;T++)if(0!==J[T]){J[T]=0;const b=Z.CreateDeviceEvent(W.Keyboard,0,T,0,this,this._elementToAttachTo);this._onInputChanged(W.Keyboard,0,b)}this._usingMacOs&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,u.g)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let q=0;q<this._maxTouchPoints;q++)this._activeTouchIds[q]=-1;this._pointerMoveEvent=J=>{const T=this._getPointerType(J);let b=T===W.Mouse?0:this._activeTouchIds.indexOf(J.pointerId);if(T===W.Touch&&-1===b){const t=this._activeTouchIds.indexOf(-1);if(!(t>=0))return void q.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);b=t,this._activeTouchIds[t]=J.pointerId,this._onDeviceConnected(T,b)}this._inputs[T]||(this._inputs[T]={}),this._inputs[T][b]||this._addPointerDevice(T,b,J.clientX,J.clientY);const t=this._inputs[T][b];if(t){const q=J;q.inputIndex=p.Move,t[p.Horizontal]=J.clientX,t[p.Vertical]=J.clientY,T===W.Touch&&0===t[p.LeftClick]&&(t[p.LeftClick]=1),void 0===J.pointerId&&(J.pointerId=this._mouseId),this._onInputChanged(T,b,q),this._usingSafari||-1===J.button||(q.inputIndex=J.button+2,t[J.button+2]=t[J.button+2]?0:1,this._onInputChanged(T,b,q))}},this._pointerDownEvent=J=>{const T=this._getPointerType(J);let b=T===W.Mouse?0:J.pointerId;if(T===W.Touch){let T=this._activeTouchIds.indexOf(J.pointerId);if(-1===T&&(T=this._activeTouchIds.indexOf(-1)),!(T>=0))return void q.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);b=T,this._activeTouchIds[T]=J.pointerId}this._inputs[T]||(this._inputs[T]={}),this._inputs[T][b]?T===W.Touch&&this._onDeviceConnected(T,b):this._addPointerDevice(T,b,J.clientX,J.clientY);const t=this._inputs[T][b];if(t){const q=t[p.Horizontal],B=t[p.Vertical];if(T===W.Mouse){if(void 0===J.pointerId&&(J.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(j){}}else if(J.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(J.pointerId)}catch(j){}t[p.Horizontal]=J.clientX,t[p.Vertical]=J.clientY,t[J.button+2]=1;const Y=J;Y.inputIndex=J.button+2,this._onInputChanged(T,b,Y),q===J.clientX&&B===J.clientY||(Y.inputIndex=p.Move,this._onInputChanged(T,b,Y))}},this._pointerUpEvent=J=>{var T;const b=this._getPointerType(J),q=b===W.Mouse?0:this._activeTouchIds.indexOf(J.pointerId);if(b===W.Touch){if(-1===q)return;this._activeTouchIds[q]=-1}const t=null===(T=this._inputs[b])||void 0===T?void 0:T[q];let j=J.button,B=t&&0!==t[j+2];if(!B&&this._isUsingFirefox&&this._usingMacOs&&t&&(j=2===j?0:2,B=0!==t[j+2]),B){var Y,C,F,A;const T=t[p.Horizontal],B=t[p.Vertical];t[p.Horizontal]=J.clientX,t[p.Vertical]=J.clientY,t[j+2]=0;const a=J;void 0===J.pointerId&&(J.pointerId=this._mouseId),T===J.clientX&&B===J.clientY||(a.inputIndex=p.Move,this._onInputChanged(b,q,a)),a.inputIndex=j+2,b===W.Mouse&&this._mouseId>=0&&null!==(Y=(C=this._elementToAttachTo).hasPointerCapture)&&void 0!==Y&&Y.call(C,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):J.pointerId&&null!==(F=(A=this._elementToAttachTo).hasPointerCapture)&&void 0!==F&&F.call(A,J.pointerId)&&this._elementToAttachTo.releasePointerCapture(J.pointerId),this._onInputChanged(b,q,a),b===W.Touch&&this._onDeviceDisconnected(b,q)}},this._pointerCancelTouch=J=>{var T,b;const q=this._activeTouchIds.indexOf(J);if(-1===q)return;null!==(T=(b=this._elementToAttachTo).hasPointerCapture)&&void 0!==T&&T.call(b,J)&&this._elementToAttachTo.releasePointerCapture(J),this._inputs[W.Touch][q][p.LeftClick]=0;const t=Z.CreateDeviceEvent(W.Touch,q,p.LeftClick,0,this,this._elementToAttachTo,J);this._onInputChanged(W.Touch,q,t),this._activeTouchIds[q]=-1,this._onDeviceDisconnected(W.Touch,q)},this._pointerCancelEvent=J=>{if("mouse"===J.pointerType){var T,b;const J=this._inputs[W.Mouse][0];this._mouseId>=0&&null!==(T=(b=this._elementToAttachTo).hasPointerCapture)&&void 0!==T&&T.call(b,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let T=p.LeftClick;T<=p.BrowserForward;T++)if(1===J[T]){J[T]=0;const b=Z.CreateDeviceEvent(W.Mouse,0,T,0,this,this._elementToAttachTo);this._onInputChanged(W.Mouse,0,b)}}else this._pointerCancelTouch(J.pointerId)},this._pointerLeaveEvent=J=>{"pen"===J.pointerType&&this._pointerCancelTouch(J.pointerId)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let J=!1;const T=function(){};try{const b=Object.defineProperty({},"passive",{get:function(){J=!0}});this._elementToAttachTo.addEventListener("test",T,b),this._elementToAttachTo.removeEventListener("test",T,b)}catch(b){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(W.Mouse)){var J,T;const b=this._inputs[W.Mouse][0];this._mouseId>=0&&null!==(J=(T=this._elementToAttachTo).hasPointerCapture)&&void 0!==J&&J.call(T,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let J=p.LeftClick;J<=p.BrowserForward;J++)if(1===b[J]){b[J]=0;const T=Z.CreateDeviceEvent(W.Mouse,0,J,0,this,this._elementToAttachTo);this._onInputChanged(W.Mouse,0,T)}}if(this.isDeviceAvailable(W.Touch)){const J=this._inputs[W.Touch];for(let T=0;T<this._activeTouchIds.length;T++){var b,q,t;const j=this._activeTouchIds[T];if(null!==(b=(q=this._elementToAttachTo).hasPointerCapture)&&void 0!==b&&b.call(q,j)&&this._elementToAttachTo.releasePointerCapture(j),-1!==j&&1===(null===(t=J[T])||void 0===t?void 0:t[p.LeftClick])){J[T][p.LeftClick]=0;const b=Z.CreateDeviceEvent(W.Touch,T,p.LeftClick,0,this,this._elementToAttachTo,j);this._onInputChanged(W.Touch,T,b),this._activeTouchIds[T]=-1,this._onDeviceDisconnected(W.Touch,T)}}}},this._pointerWheelEvent=J=>{const T=W.Mouse;this._inputs[T]||(this._inputs[T]=[]),this._inputs[T][0]||(this._pointerActive=!0,this._registerDevice(T,0,c));const b=this._inputs[T][0];if(b){b[p.MouseWheelX]=J.deltaX||0,b[p.MouseWheelY]=J.deltaY||J.wheelDelta||0,b[p.MouseWheelZ]=J.deltaZ||0;const q=J;void 0===J.pointerId&&(J.pointerId=this._mouseId),0!==b[p.MouseWheelX]&&(q.inputIndex=p.MouseWheelX,this._onInputChanged(T,0,q)),0!==b[p.MouseWheelY]&&(q.inputIndex=p.MouseWheelY,this._onInputChanged(T,0,q)),0!==b[p.MouseWheelZ]&&(q.inputIndex=p.MouseWheelZ,this._onInputChanged(T,0,q))}},this._usingMacOs&&this._isUsingChromium&&(this._pointerMacOsChromeOutEvent=J=>{J.buttons>1&&this._pointerCancelEvent(J)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!J&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(W.Mouse)){const J=this._inputs[W.Mouse][0];J[p.MouseWheelX]=0,J[p.MouseWheelY]=0,J[p.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=J=>{this._addGamePad(J.gamepad)},this._gamepadDisconnectedEvent=J=>{if(this._gamepads){const T=this._getGamepadDeviceType(J.gamepad.id),b=J.gamepad.index;this._unregisterDevice(T,b),delete this._gamepads[b]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(J,T,b){const q=navigator.getGamepads()[T];if(q&&J===this._gamepads[T]){const t=this._inputs[J][T];b>=q.buttons.length?t[b]=q.axes[b-q.buttons.length].valueOf():t[b]=q.buttons[b].value}}_getGamepadDeviceType(J){return-1!==J.indexOf("054c")?-1!==J.indexOf("0ce6")?W.DualSense:W.DualShock:-1!==J.indexOf("Xbox One")||-1!==J.search("Xbox 360")||-1!==J.search("xinput")?W.Xbox:-1!==J.indexOf("057e")?W.Switch:W.Generic}_getPointerType(J){let T=W.Mouse;return("touch"===J.pointerType||"pen"===J.pointerType||J.touches)&&(T=W.Touch),T}}class Q{constructor(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=T,this.deviceSlot=b,this.onInputChangedObservable=new j.b,this._deviceInputSystem=J}getInput(J){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,J)}}class h{constructor(J){this._registeredManagers=new Array,this._refCount=0,this.registerManager=J=>{for(let T=0;T<this._devices.length;T++){const b=this._devices[T];for(const q in b){const b=+q;J._addDevice(new Q(this._deviceInputSystem,T,b))}}this._registeredManagers.push(J)},this.unregisterManager=J=>{const T=this._registeredManagers.indexOf(J);T>-1&&this._registeredManagers.splice(T,1)};const T=Object.keys(W).length/2;this._devices=new Array(T);const b=(J,T)=>{this._devices[J]||(this._devices[J]=new Array),this._devices[J][T]||(this._devices[J][T]=T);for(const b of this._registeredManagers){const q=new Q(this._deviceInputSystem,J,T);b._addDevice(q)}},q=(J,T)=>{var b;null!==(b=this._devices[J])&&void 0!==b&&b[T]&&delete this._devices[J][T];for(const q of this._registeredManagers)q._removeDevice(J,T)},t=(J,T,b)=>{if(b)for(const q of this._registeredManagers)q._onInputChanged(J,T,b)};"undefined"!==typeof _native?this._deviceInputSystem=new e(b,q,t):this._deviceInputSystem=new V(J,b,q,t)}dispose(){this._deviceInputSystem.dispose()}}class i{getDeviceSource(J,T){if(void 0===T){if(void 0===this._firstDevice[J])return null;T=this._firstDevice[J]}return this._devices[J]&&void 0!==this._devices[J][T]?this._devices[J][T]:null}getDeviceSources(J){return this._devices[J]?this._devices[J].filter((J=>!!J)):[]}constructor(J){const T=Object.keys(W).length/2;this._devices=new Array(T),this._firstDevice=new Array(T),this._engine=J,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new h(J)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new j.b((J=>{for(const T of this._devices)if(T)for(const b of T)b&&this.onDeviceConnectedObservable.notifyObserver(J,b)})),this.onDeviceDisconnectedObservable=new j.b,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=J.Ki.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.Ki.remove(this._onDisposeObserver)}_addDevice(J){this._devices[J.deviceType]||(this._devices[J.deviceType]=[]),this._devices[J.deviceType][J.deviceSlot]||(this._devices[J.deviceType][J.deviceSlot]=J,this._updateFirstDevices(J.deviceType)),this.onDeviceConnectedObservable.notifyObservers(J)}_removeDevice(J,T){var b,q;const t=null===(b=this._devices[J])||void 0===b?void 0:b[T];this.onDeviceDisconnectedObservable.notifyObservers(t),null!==(q=this._devices[J])&&void 0!==q&&q[T]&&delete this._devices[J][T],this._updateFirstDevices(J)}_onInputChanged(J,T,b){var q,t;null===(q=this._devices[J])||void 0===q||null===(t=q[T])||void 0===t||t.onInputChangedObservable.notifyObservers(b)}_updateFirstDevices(J){switch(J){case W.Keyboard:case W.Mouse:this._firstDevice[J]=0;break;case W.Touch:case W.DualSense:case W.DualShock:case W.Xbox:case W.Switch:case W.Generic:{delete this._firstDevice[J];const T=this._devices[J];if(T)for(let b=0;b<T.length;b++)if(T[b]){this._firstDevice[J]=b;break}break}}}}var m=b(2482);class O{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(J){this._singleClick=J}set doubleClick(J){this._doubleClick=J}set hasSwiped(J){this._hasSwiped=J}set ignore(J){this._ignore=J}}class X{constructor(J){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new F.k(0,0),this._previousStartingPointerPosition=new F.k(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=J||U.e.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(J){return this._meshUnderPointerId[J]||null}get unTranslatedPointer(){return new F.k(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(J){this._pointerX=J}get pointerY(){return this._pointerY}set pointerY(J){this._pointerY=J}_updatePointerPosition(J){const T=this._scene.getEngine().getInputElementClientRect();T&&(this._pointerX=J.clientX-T.left,this._pointerY=J.clientY-T.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(J,T){const b=this._scene,q=b.getEngine(),t=q.getInputElement();t&&(t.tabIndex=q.canvasTabIndex,b.doNotHandleCursors||(t.style.cursor=b.defaultCursor)),this._setCursorAndPointerOverMesh(J,T,b);for(const C of b._pointerMoveStage){var j;const b=!(null===(j=J=J||this._pickMove(T))||void 0===j||!j.pickedMesh);J=C.action(this._unTranslatedPointerX,this._unTranslatedPointerY,J,b,t)}const B=T.inputIndex>=p.MouseWheelX&&T.inputIndex<=p.MouseWheelZ?E.d.POINTERWHEEL:E.d.POINTERMOVE;let Y;b.onPointerMove&&(J=J||this._pickMove(T),b.onPointerMove(T,J,B)),J?(Y=new E.i(B,T,J),this._setRayOnPointerInfo(J,T)):(Y=new E.i(B,T,null,this),this._movePointerInfo=Y),b.onPointerObservable.hasObservers()&&b.onPointerObservable.notifyObservers(Y,B)}_setRayOnPointerInfo(J,T){const b=this._scene;J&&m.e._IsPickingAvailable&&(J.ray||(J.ray=b.createPickingRay(T.offsetX,T.offsetY,F.e.Identity(),b.activeCamera)))}_addCameraPointerObserver(J,T){return this._cameraObserverCount++,this._scene.onPointerObservable.add(J,T)}_removeCameraPointerObserver(J){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(J)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(J,T,b){const q=this._scene,t=new E.g(b,T,this._unTranslatedPointerX,this._unTranslatedPointerY);return J&&(t.originalPickingInfo=J,t.ray=J.ray,"xr-near"===T.pointerType&&J.originMesh&&(t.nearInteractionPickingInfo=J)),q.onPrePointerObservable.notifyObservers(t,b),!!t.skipOnPointerObservable}_pickMove(J){const T=this._scene,b=T.Mk(this._unTranslatedPointerX,this._unTranslatedPointerY,T.pointerMovePredicate,T.pointerMoveFastCheck,T.cameraToUseForPointers,T.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(b,J,T),b}_setCursorAndPointerOverMesh(J,T,b){const q=b.getEngine().getInputElement();if(null!==J&&void 0!==J&&J.pickedMesh){if(this.setPointerOverMesh(J.pickedMesh,T.pointerId,J,T),!b.doNotHandleCursors&&q&&this._pointerOverMesh){const J=this._pointerOverMesh._getActionManagerForTrigger();J&&J.hasPointerTriggers&&(q.style.cursor=J.hoverCursor||b.hoverCursor)}}else this.setPointerOverMesh(null,T.pointerId,J,T)}simulatePointerMove(J,T){const b=new PointerEvent("pointermove",T);b.inputIndex=p.Move,this._checkPrePointerObservable(J,b,E.d.POINTERMOVE)||this._processPointerMove(J,b)}simulatePointerDown(J,T){const b=new PointerEvent("pointerdown",T);b.inputIndex=b.button+2,this._checkPrePointerObservable(J,b,E.d.POINTERDOWN)||this._processPointerDown(J,b)}_processPointerDown(J,T){var b;const q=this._scene;if(null!==(b=J)&&void 0!==b&&b.pickedMesh){this._pickedDownMesh=J.pickedMesh;const b=J.pickedMesh._getActionManagerForTrigger();if(b){if(b.hasPickTriggers)switch(b.processTrigger(5,new v(J.pickedMesh,q.pointerX,q.pointerY,J.pickedMesh,T,J)),T.button){case 0:b.processTrigger(2,new v(J.pickedMesh,q.pointerX,q.pointerY,J.pickedMesh,T,J));break;case 1:b.processTrigger(4,new v(J.pickedMesh,q.pointerX,q.pointerY,J.pickedMesh,T,J));break;case 2:b.processTrigger(3,new v(J.pickedMesh,q.pointerX,q.pointerY,J.pickedMesh,T,J))}b.hasSpecificTrigger(8)&&window.setTimeout((()=>{const J=q.Mk(this._unTranslatedPointerX,this._unTranslatedPointerY,(J=>J.Bi&&J.isVisible&&J.isReady()&&J.actionManager&&J.actionManager.hasSpecificTrigger(8)&&J===this._pickedDownMesh),!1,q.cameraToUseForPointers);null!==J&&void 0!==J&&J.pickedMesh&&b&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>X.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,b.processTrigger(8,v.CreateNew(J.pickedMesh,T)))}),X.LongPressDelay)}}else for(const B of q._pointerDownStage)J=B.action(this._unTranslatedPointerX,this._unTranslatedPointerY,J,T,!1);let t;const j=E.d.POINTERDOWN;J?(q.onPointerDown&&q.onPointerDown(T,J,j),t=new E.i(j,T,J),this._setRayOnPointerInfo(J,T)):t=new E.i(j,T,null,this),q.onPointerObservable.hasObservers()&&q.onPointerObservable.notifyObservers(t,j)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(J,T,b){const q=new PointerEvent("pointerup",T);q.inputIndex=p.Move;const t=new O;b?t.doubleClick=!0:t.singleClick=!0,this._checkPrePointerObservable(J,q,E.d.POINTERUP)||this._processPointerUp(J,q,t)}_processPointerUp(J,T,b){var q;const t=this._scene;if(null!==(q=J)&&void 0!==q&&q.pickedMesh){if(this._pickedUpMesh=J.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(t.onPointerPick&&t.onPointerPick(T,J),b.singleClick&&!b.ignore&&t.onPointerObservable.observers.length>this._cameraObserverCount)){const b=E.d.POINTERPICK,q=new E.i(b,T,J);this._setRayOnPointerInfo(J,T),t.onPointerObservable.notifyObservers(q,b)}const q=J.pickedMesh._getActionManagerForTrigger();if(q&&!b.ignore){q.processTrigger(7,v.CreateNew(J.pickedMesh,T,J)),!b.hasSwiped&&b.singleClick&&q.processTrigger(1,v.CreateNew(J.pickedMesh,T,J));const t=J.pickedMesh._getActionManagerForTrigger(6);b.doubleClick&&t&&t.processTrigger(6,v.CreateNew(J.pickedMesh,T,J))}}else if(!b.ignore)for(const j of t._pointerUpStage)J=j.action(this._unTranslatedPointerX,this._unTranslatedPointerY,J,T,b.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const J=this._pickedDownMesh._getActionManagerForTrigger(16);J&&J.processTrigger(16,v.CreateNew(this._pickedDownMesh,T))}if(!b.ignore){const q=new E.i(E.d.POINTERUP,T,J);if(this._setRayOnPointerInfo(J,T),t.onPointerObservable.notifyObservers(q,E.d.POINTERUP),t.onPointerUp&&t.onPointerUp(T,J,E.d.POINTERUP),!b.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let q=0;if(b.singleClick?q=E.d.POINTERTAP:b.doubleClick&&(q=E.d.POINTERDOUBLETAP),q){const b=new E.i(q,T,J);t.onPointerObservable.hasObservers()&&t.onPointerObservable.hasSpecificMask(q)&&t.onPointerObservable.notifyObservers(b,q)}}}}isPointerCaptured(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[J]}attachControl(){let J=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const t=this._scene,j=t.getEngine();q||(q=j.getInputElement()),this._alreadyAttached&&this.Oi(),q&&(this._alreadyAttachedTo=q),this._deviceSourceManager=new i(j),this._initActionManager=J=>{if(!this._meshPickProceed){const T=t.skipPointerUpPicking||0===t._registeredActions&&!this._checkForPicking()&&!t.onPointerUp?null:t.Mk(this._unTranslatedPointerX,this._unTranslatedPointerY,t.pointerUpPredicate,t.pointerUpFastCheck,t.cameraToUseForPointers,t.pointerUpTrianglePredicate);this._currentPickResult=T,T&&(J=T.hit&&T.pickedMesh?T.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return J},this._delayedSimpleClick=(J,T,b)=>{if((Date.now()-this._previousStartingPointerTime>X.DoubleClickDelay&&!this._doubleClickOccured||J!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,T.singleClick=!0,T.ignore=!1,this._delayedClicks[J])){const T=this._delayedClicks[J].evt,b=E.d.POINTERTAP,q=new E.i(b,T,this._currentPickResult);t.onPointerObservable.hasObservers()&&t.onPointerObservable.hasSpecificMask(b)&&t.onPointerObservable.notifyObservers(q,b),this._delayedClicks[J]=null}},this._initClickEvent=(J,T,b,q)=>{const t=new O;this._currentPickResult=null;let j=null,B=J.hasSpecificMask(E.d.POINTERPICK)||T.hasSpecificMask(E.d.POINTERPICK)||J.hasSpecificMask(E.d.POINTERTAP)||T.hasSpecificMask(E.d.POINTERTAP)||J.hasSpecificMask(E.d.POINTERDOUBLETAP)||T.hasSpecificMask(E.d.POINTERDOUBLETAP);!B&&l&&(j=this._initActionManager(j,t),j&&(B=j.hasPickTriggers));let Y=!1;if(B=B&&!this._isMultiTouchGesture,B){const B=b.button;if(t.hasSwiped=this._isPointerSwiping(),!t.hasSwiped){let A=!X.ExclusiveDoubleClickMode;if(A||(A=!J.hasSpecificMask(E.d.POINTERDOUBLETAP)&&!T.hasSpecificMask(E.d.POINTERDOUBLETAP),A&&!l.HasSpecificTrigger(6)&&(j=this._initActionManager(j,t),j&&(A=!j.hasSpecificTrigger(6)))),A)(Date.now()-this._previousStartingPointerTime>X.DoubleClickDelay||B!==this._previousButtonPressed)&&(t.singleClick=!0,q(t,this._currentPickResult),Y=!0);else{const J={evt:b,clickInfo:t,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,B,t,q),X.DoubleClickDelay)};this._delayedClicks[B]=J}let a=J.hasSpecificMask(E.d.POINTERDOUBLETAP)||T.hasSpecificMask(E.d.POINTERDOUBLETAP);if(!a&&l.HasSpecificTrigger(6)&&(j=this._initActionManager(j,t),j&&(a=j.hasSpecificTrigger(6))),a)if(B===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<X.DoubleClickDelay&&!this._doubleClickOccured){if(t.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=B,X.ExclusiveDoubleClickMode){var C;if(this._delayedClicks[B])clearTimeout(null===(C=this._delayedClicks[B])||void 0===C?void 0:C.timeoutId),this._delayedClicks[B]=null;q(t,this._previousPickResult)}else q(t,this._currentPickResult);else{var F;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,t.doubleClick=!0,t.ignore=!1,X.ExclusiveDoubleClickMode&&this._delayedClicks[B])clearTimeout(null===(F=this._delayedClicks[B])||void 0===F?void 0:F.timeoutId),this._delayedClicks[B]=null;q(t,this._currentPickResult)}Y=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=B}}Y||q(t,this._currentPickResult)},this._onPointerMove=J=>{if(this._updatePointerPosition(J),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>X.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>X.DragMovementThreshold),j.isPointerLock&&j._verifyPointerLock(),this._checkPrePointerObservable(null,J,J.inputIndex>=p.MouseWheelX&&J.inputIndex<=p.MouseWheelZ?E.d.POINTERWHEEL:E.d.POINTERMOVE))return;if(!t.cameraToUseForPointers&&!t.activeCamera)return;if(t.Ll)return void this._processPointerMove(new P.d,J);t.pointerMovePredicate||(t.pointerMovePredicate=J=>J.Bi&&J.isVisible&&J.isReady()&&J.isEnabled()&&(J.enablePointerMoveEvents||t.constantlyUpdateMeshUnderPointer||null!==J._getActionManagerForTrigger())&&(!t.cameraToUseForPointers||0!==(t.cameraToUseForPointers.layerMask&J.layerMask)));const T=t._registeredActions>0||t.constantlyUpdateMeshUnderPointer?this._pickMove(J):null;this._processPointerMove(T,J)},this._onPointerDown=J=>{const T=this._activePointerIds.indexOf(-1);if(-1===T?this._activePointerIds.push(J.pointerId):this._activePointerIds[T]=J.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,X.ExclusiveDoubleClickMode)for(let q=0;q<this._delayedClicks.length;q++)if(this._delayedClicks[q])if(J.button===q){var b;clearTimeout(null===(b=this._delayedClicks[q])||void 0===b?void 0:b.timeoutId)}else{const J=this._delayedClicks[q].clickInfo;this._doubleClickOccured=!1,J.singleClick=!0,J.ignore=!1;const T=this._delayedClicks[q].evt,b=E.d.POINTERTAP,j=new E.i(b,T,this._currentPickResult);t.onPointerObservable.hasObservers()&&t.onPointerObservable.hasSpecificMask(b)&&t.onPointerObservable.notifyObservers(j,b),this._delayedClicks[q]=null}if(this._updatePointerPosition(J),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=J.button),t.preventDefaultOnPointerDown&&q&&(J.preventDefault(),q.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,J,E.d.POINTERDOWN))return;if(!t.cameraToUseForPointers&&!t.activeCamera)return;let j;this._pointerCaptures[J.pointerId]=!0,t.pointerDownPredicate||(t.pointerDownPredicate=J=>J.Bi&&J.isVisible&&J.isReady()&&J.isEnabled()&&(!t.cameraToUseForPointers||0!==(t.cameraToUseForPointers.layerMask&J.layerMask))),this._pickedDownMesh=null,j=t.skipPointerDownPicking||0===t._registeredActions&&!this._checkForPicking()&&!t.onPointerDown?new P.d:t.Mk(this._unTranslatedPointerX,this._unTranslatedPointerY,t.pointerDownPredicate,t.pointerDownFastCheck,t.cameraToUseForPointers,t.pointerDownTrianglePredicate),this._processPointerDown(j,J)},this._onPointerUp=J=>{const T=this._activePointerIds.indexOf(J.pointerId);-1!==T&&(this._activePointerIds[T]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(J),t.preventDefaultOnPointerUp&&q&&(J.preventDefault(),q.focus()),this._initClickEvent(t.onPrePointerObservable,t.onPointerObservable,J,((T,b)=>{if(t.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!T.ignore)){if(this._checkPrePointerObservable(null,J,E.d.POINTERUP))return this._swipeButtonPressed===J.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===J.buttons&&(this._pointerCaptures[J.pointerId]=!1));T.hasSwiped||(T.singleClick&&t.onPrePointerObservable.hasSpecificMask(E.d.POINTERTAP)&&this._checkPrePointerObservable(null,J,E.d.POINTERTAP)&&(this._skipPointerTap=!0),T.doubleClick&&t.onPrePointerObservable.hasSpecificMask(E.d.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,J,E.d.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[J.pointerId]?(0===J.buttons&&(this._pointerCaptures[J.pointerId]=!1),(t.cameraToUseForPointers||t.activeCamera)&&(t.pointerUpPredicate||(t.pointerUpPredicate=J=>J.Bi&&J.isVisible&&J.isReady()&&J.isEnabled()&&(!t.cameraToUseForPointers||0!==(t.cameraToUseForPointers.layerMask&J.layerMask))),!this._meshPickProceed&&(l&&l.HasTriggers||this._checkForPicking()||t.onPointerUp)&&this._initActionManager(null,T),b||(b=this._currentPickResult),this._processPointerUp(b,J,T),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===J.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===J.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=J=>{const T=d.d.KEYDOWN;if(t.onPreKeyboardObservable.hasObservers()){const b=new d.g(T,J);if(t.onPreKeyboardObservable.notifyObservers(b,T),b.skipOnKeyboardObservable)return}if(t.onKeyboardObservable.hasObservers()){const b=new d.i(T,J);t.onKeyboardObservable.notifyObservers(b,T)}t.actionManager&&t.actionManager.processTrigger(14,v.CreateNewFromScene(t,J))},this._onKeyUp=J=>{const T=d.d.KEYUP;if(t.onPreKeyboardObservable.hasObservers()){const b=new d.g(T,J);if(t.onPreKeyboardObservable.notifyObservers(b,T),b.skipOnKeyboardObservable)return}if(t.onKeyboardObservable.hasObservers()){const b=new d.i(T,J);t.onKeyboardObservable.notifyObservers(b,T)}t.actionManager&&t.actionManager.processTrigger(15,v.CreateNewFromScene(t,J))},this._deviceSourceManager.onDeviceConnectedObservable.add((q=>{q.deviceType===W.Mouse?q.onInputChangedObservable.add((t=>{this._originMouseEvent=t,t.inputIndex===p.LeftClick||t.inputIndex===p.MiddleClick||t.inputIndex===p.RightClick||t.inputIndex===p.BrowserBack||t.inputIndex===p.BrowserForward?T&&1===q.getInput(t.inputIndex)?this._onPointerDown(t):J&&0===q.getInput(t.inputIndex)&&this._onPointerUp(t):b&&(t.inputIndex===p.Move?this._onPointerMove(t):t.inputIndex!==p.MouseWheelX&&t.inputIndex!==p.MouseWheelY&&t.inputIndex!==p.MouseWheelZ||this._onPointerMove(t))})):q.deviceType===W.Touch?q.onInputChangedObservable.add((t=>{t.inputIndex===p.LeftClick&&(T&&1===q.getInput(t.inputIndex)?(this._onPointerDown(t),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):J&&0===q.getInput(t.inputIndex)&&(this._onPointerUp(t),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),b&&t.inputIndex===p.Move&&this._onPointerMove(t)})):q.deviceType===W.Keyboard&&q.onInputChangedObservable.add((J=>{"keydown"===J.type?this._onKeyDown(J):"keyup"===J.type&&this._onKeyUp(J)}))})),this._alreadyAttached=!0}Oi(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,b=arguments.length>2?arguments[2]:void 0,q=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[T]===J&&(!J||!J._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const t=this._meshUnderPointerId[T];let j;t&&(j=t._getActionManagerForTrigger(10),j&&j.processTrigger(10,new v(t,this._pointerX,this._pointerY,J,q,{pointerId:T}))),J?(this._meshUnderPointerId[T]=J,this._pointerOverMesh=J,j=J._getActionManagerForTrigger(9),j&&j.processTrigger(9,new v(J,this._pointerX,this._pointerY,J,q,{pointerId:T,pickResult:b}))):(delete this._meshUnderPointerId[T],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:J,pointerId:T})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(J){this._pointerOverMesh===J&&(this._pointerOverMesh=null),this._pickedDownMesh===J&&(this._pickedDownMesh=null),this._pickedUpMesh===J&&(this._pickedUpMesh=null);for(const T in this._meshUnderPointerId)this._meshUnderPointerId[T]===J&&delete this._meshUnderPointerId[T]}}X.DragMovementThreshold=10,X.LongPressDelay=500,X.DoubleClickDelay=300,X.ExclusiveDoubleClickMode=!1;var L=b(2405),r=b(731),N=b(742),R=b(2487),n=b(556),D=b(867),f=b(711);class z{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.Ll=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var M,y=b(519),k=b(639);!function(J){J[J.BackwardCompatible=0]="BackwardCompatible",J[J.Intermediate=1]="Intermediate",J[J.Aggressive=2]="Aggressive"}(M||(M={}));class JJ{static DefaultMaterialFactory(J){throw(0,K.e)("o")}static CollisionCoordinatorFactory(){throw(0,K.e)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(J){J!==this._clearColor&&(this._clearColor=J,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(J){if(J!==this._performancePriority){switch(this._performancePriority=J,J){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Ll=!1,this.El=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Ll=!0,this.El=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.Ll=!0,this.El=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(J)}}set forceWireframe(J){this._forceWireframe!==J&&(this._forceWireframe=J,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(J){this._skipFrustumClipping!==J&&(this._skipFrustumClipping=J)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(J){this._forcePointsCloud!==J&&(this._forcePointsCloud=J,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(J){this._environmentTexture!==J&&(this._environmentTexture=J,this.onEnvironmentTextureChangedObservable.notifyObservers(J),this.markAllMaterialsAsDirty(1))}getNodes(){let J=[];J=J.concat(this.meshes),J=J.concat(this.lights),J=J.concat(this.cameras),J=J.concat(this.transformNodes);for(const T of this.skeletons)J=J.concat(T.bones);return J}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(J){this._animationPropertiesOverride=J}set onDispose(J){this._onDisposeObserver&&this.Ki.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ki.add(J)}set beforeRender(J){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),J&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(J))}set afterRender(J){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),J&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(J))}set beforeCameraRender(J){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(J)}set afterCameraRender(J){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(J)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(J){this._pointerPickingConfiguration.pointerDownPredicate=J}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(J){this._pointerPickingConfiguration.pointerUpPredicate=J}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(J){this._pointerPickingConfiguration.pointerMovePredicate=J}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(J){this._pointerPickingConfiguration.pointerDownFastCheck=J}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(J){this._pointerPickingConfiguration.pointerUpFastCheck=J}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(J){this._pointerPickingConfiguration.pointerMoveFastCheck=J}get Ll(){return this._pointerPickingConfiguration.Ll}set Ll(J){this._pointerPickingConfiguration.Ll=J}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(J){this._pointerPickingConfiguration.skipPointerDownPicking=J}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(J){this._pointerPickingConfiguration.skipPointerUpPicking=J}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return X.DragMovementThreshold}static set DragMovementThreshold(J){X.DragMovementThreshold=J}static get LongPressDelay(){return X.LongPressDelay}static set LongPressDelay(J){X.LongPressDelay=J}static get DoubleClickDelay(){return X.DoubleClickDelay}static set DoubleClickDelay(J){X.DoubleClickDelay=J}static get ExclusiveDoubleClickMode(){return X.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(J){X.ExclusiveDoubleClickMode=J}bindEyePosition(J){var T;let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:(null===(T=this.activeCamera)||void 0===T?void 0:T.globalPosition)??F.n.ZeroReadOnly,j=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return F.j.Vector4[0].set(t.x,t.y,t.z,j?-1:1),J&&(q?J.setFloat3(b,F.j.Vector4[0].x,F.j.Vector4[0].y,F.j.Vector4[0].z):J.setVector4(b,F.j.Vector4[0])),F.j.Vector4[0]}finalizeSceneUbo(){const J=this.getSceneUniformBuffer(),T=this.bindEyePosition(null);return J.updateFloat4("vEyePosition",T.x,T.y,T.z,T.w),J.update(),J}set useRightHandedSystem(J){this._useRightHandedSystem!==J&&(this._useRightHandedSystem=J,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(J){this._currentStepId=J}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(J){this._fogEnabled!==J&&(this._fogEnabled=J,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(J){this._fogMode!==J&&(this._fogMode=J,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(J){this._shadowsEnabled!==J&&(this._shadowsEnabled=J,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(J){this._lightsEnabled!==J&&(this._lightsEnabled=J,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(J){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),J&&(this._unObserveActiveCameras=(0,f.e)(J,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=J}get activeCamera(){return this._activeCamera}set activeCamera(J){J!==this._activeCamera&&(this._activeCamera=J,this.onActiveCameraChanged.notifyObservers(this))}get _hasDefaultMaterial(){return JJ.DefaultMaterialFactory!==JJ._OriginalDefaultMaterialFactory}get defaultMaterial(){return this.ol||(this.ol=JJ.DefaultMaterialFactory(this)),this.ol}set defaultMaterial(J){this.ol=J}set texturesEnabled(J){this._texturesEnabled!==J&&(this._texturesEnabled=J,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(J){if(this._frameGraph)return this._frameGraph=J,void(J||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=J,J&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph,this.activeCamera=null)}set skeletonsEnabled(J){this._skeletonsEnabled!==J&&(this._skeletonsEnabled=J,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=JJ.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const J of this._transientComponents)J.register();this._transientComponents.length=0}}bb(J){this._components.push(J),this._transientComponents.push(J);const T=J;T.addFromContainer&&T.serialize&&this._serializableComponents.push(T)}_getComponent(J){for(const T of this._components)if(T.name===J)return T;return null}get uniqueId(){return this._uniqueId}constructor(J,T){this._inputManager=new X(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.El=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new r.d(.2,.2,.3,1),this.onClearColorChangedObservable=new j.b,this.ambientColor=new r.b(0,0,0),this.environmentIntensity=1,this.iblIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new j.b,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.si=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.om=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.Ki=new j.b,this._onDisposeObserver=null,this.onBeforeRenderObservable=new j.b,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new j.b,this.onAfterRenderCameraObservable=new j.b,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new j.b,this.onAfterAnimationsObservable=new j.b,this.onBeforeDrawPhaseObservable=new j.b,this.onAfterDrawPhaseObservable=new j.b,this.onReadyObservable=new j.b,this.onBeforeCameraRenderObservable=new j.b,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new j.b,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new j.b,this.onAfterActiveMeshesEvaluationObservable=new j.b,this.onBeforeParticlesRenderingObservable=new j.b,this.onAfterParticlesRenderingObservable=new j.b,this.onDataLoadedObservable=new j.b,this.onNewCameraAddedObservable=new j.b,this.onCameraRemovedObservable=new j.b,this.onNewLightAddedObservable=new j.b,this.onLightRemovedObservable=new j.b,this.onNewGeometryAddedObservable=new j.b,this.onGeometryRemovedObservable=new j.b,this.onNewTransformNodeAddedObservable=new j.b,this.onTransformNodeRemovedObservable=new j.b,this.onNewMeshAddedObservable=new j.b,this.onMeshRemovedObservable=new j.b,this.onNewSkeletonAddedObservable=new j.b,this.onSkeletonRemovedObservable=new j.b,this.onNewMaterialAddedObservable=new j.b,this.onNewMultiMaterialAddedObservable=new j.b,this.onMaterialRemovedObservable=new j.b,this.onMultiMaterialRemovedObservable=new j.b,this.onNewTextureAddedObservable=new j.b,this.onTextureRemovedObservable=new j.b,this.onBeforeRenderTargetsRenderObservable=new j.b,this.onAfterRenderTargetsRenderObservable=new j.b,this.onBeforeStepObservable=new j.b,this.onAfterStepObservable=new j.b,this.onActiveCameraChanged=new j.b,this.onActiveCamerasChanged=new j.b,this.onBeforeRenderingGroupObservable=new j.b,this.onAfterRenderingGroupObservable=new j.b,this.onMeshImportedObservable=new j.b,this.onAnimationFileImportedObservable=new j.b,this.onEnvironmentTextureChangedObservable=new j.b,this.onMeshUnderPointerUpdatedObservable=new j.b,this._registeredForLateAnimationBindings=new B.d(256),this._pointerPickingConfiguration=new z,this.onPrePointerObservable=new j.b,this.onPointerObservable=new j.b,this.onPreKeyboardObservable=new j.b,this.onKeyboardObservable=new j.b,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=JJ.FOGMODE_NONE,this.fogColor=new r.b(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.frameGraphs=[],this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new F.n(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new B.d(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new L.d,this._activeIndices=new L.d,this._activeParticles=new L.d,this._activeBones=new L.d,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=[],this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new B.e(256),this._processedMaterials=new B.e(256),this._renderTargets=new B.d(256),this._materialsRenderTargets=new B.d(256),this._activeParticleSystems=new B.e(256),this._activeSkeletons=new B.d(32),this._softwareSkinnedMeshes=new B.d(32),this._activeAnimatables=new Array,this._transformMatrix=F.e.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=I.f.Create(),this._beforeClearStage=I.f.Create(),this._beforeRenderTargetClearStage=I.f.Create(),this._gatherRenderTargetsStage=I.f.Create(),this._gatherActiveCameraRenderTargetsStage=I.f.Create(),this._isReadyForMeshStage=I.f.Create(),this._beforeEvaluateActiveMeshStage=I.f.Create(),this._evaluateSubMeshStage=I.f.Create(),this._preActiveMeshStage=I.f.Create(),this._cameraDrawRenderTargetStage=I.f.Create(),this._beforeCameraDrawStage=I.f.Create(),this._beforeRenderTargetDrawStage=I.f.Create(),this._beforeRenderingGroupDrawStage=I.f.Create(),this._beforeRenderingMeshStage=I.f.Create(),this._afterRenderingMeshStage=I.f.Create(),this._afterRenderingGroupDrawStage=I.f.Create(),this._afterCameraDrawStage=I.f.Create(),this._afterCameraPostProcessStage=I.f.Create(),this._afterRenderTargetDrawStage=I.f.Create(),this._afterRenderTargetPostProcessStage=I.f.Create(),this._afterRenderStage=I.f.Create(),this._pointerMoveStage=I.f.Create(),this._pointerDownStage=I.f.Create(),this._pointerUpStage=I.f.Create(),this._geometriesByUniqueId=null,this._uniqueId=0,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._useCurrentFrameBuffer=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[],this._uniqueId=this.getUniqueId();const b={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...T};J=this._engine=J||U.e.LastCreatedEngine,b.virtual?J._virtualScenes.push(this):(U.e._LastCreatedScene=this,J.scenes.push(this)),this._uid=null,this._renderingManager=new x.c(this),G.d&&(this.postProcessManager=new G.d(this)),(0,u.j)()&&this.attachControl(),this._createUbo(),A.b&&(this._imageProcessingConfiguration=new A.b),this.setDefaultCandidateProviders(),b.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=b.useMaterialMeshMap,this.useClonedMeshMap=b.useClonedMeshMap,T&&T.virtual||J.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(J){return this._defaultSubMeshCandidates.data=J.xi,this._defaultSubMeshCandidates.length=J.xi.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=J=>this._getDefaultSubMeshCandidates(J),this.getIntersectingSubMeshCandidates=(J,T)=>this._getDefaultSubMeshCandidates(J),this.getCollidingSubMeshCandidates=(J,T)=>this._getDefaultSubMeshCandidates(J)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(J){this._inputManager.pointerX=J}get pointerY(){return this._inputManager.pointerY}set pointerY(J){this._inputManager.pointerY=J}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(J,T){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==T||this._cachedMaterial!==J||this._cachedVisibility!==b}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(J,T){return this._inputManager.simulatePointerMove(J,T),this}simulatePointerDown(J,T){return this._inputManager.simulatePointerDown(J,T),this}simulatePointerUp(J,T,b){return this._inputManager.simulatePointerUp(J,T,b),this}isPointerCaptured(){let J=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(J)}attachControl(){let J=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(J,T,b)}Oi(){this._inputManager.Oi()}isReady(){var J,T;let b,q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const t=this.getEngine(),j=t.currentRenderPassId;t.currentRenderPassId=(null===(J=this.activeCamera)||void 0===J?void 0:J.renderPassId)??j;let B=!0;for(this._pendingData.length>0&&(B=!1),null===(T=this.prePassRenderer)||void 0===T||T.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&B&&(B=this.depthPeelingRenderer.isReady()),q&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),b=0;b<this.meshes.length;b++){const J=this.meshes[b];if(!J.xi||0===J.xi.length)continue;if(!J.isReady(!0)){B=!1;continue}const T=J.hasThinInstances||"InstancedMesh"===J.getClassName()||"InstancedLinesMesh"===J.getClassName()||t.getCaps().instancedArrays&&J.instances.length>0;for(const b of this._isReadyForMeshStage)b.action(J,T)||(B=!1);if(!q)continue;const j=J.material||this.defaultMaterial;if(j)if(j._storeEffectOnSubMeshes)for(const b of J.xi){const J=b.Ha();J&&J.hasRenderTargetTextures&&null!=J.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(J)&&(this._processedMaterials.push(J),this._materialsRenderTargets.concatWithNoDuplicate(J.getRenderTargetTextures()))}else j.hasRenderTargetTextures&&null!=j.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(j)&&(this._processedMaterials.push(j),this._materialsRenderTargets.concatWithNoDuplicate(j.getRenderTargetTextures()))}if(q)for(b=0;b<this._materialsRenderTargets.length;++b){this._materialsRenderTargets.data[b].isReadyForRendering()||(B=!1)}for(b=0;b<this.geometries.length;b++){2===this.geometries[b].delayLoadState&&(B=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const Y of this.activeCameras)Y.isReady(!0)||(B=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(B=!1));for(const Y of this.si)Y.isReady()||(B=!1);if(this.layers)for(const Y of this.layers)Y.isReady()||(B=!1);if(this.effectLayers)for(const Y of this.effectLayers)Y.isLayerReady()||(B=!1);return t.areAllEffectsReady()||(B=!1),t.currentRenderPassId=j,B}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(J){this.onBeforeRenderObservable.add(J)}unregisterBeforeRender(J){this.onBeforeRenderObservable.removeCallback(J)}registerAfterRender(J){this.onAfterRenderObservable.add(J)}unregisterAfterRender(J){this.onAfterRenderObservable.removeCallback(J)}_executeOnceBeforeRender(J){const T=()=>{J(),setTimeout((()=>{this.unregisterBeforeRender(T)}))};this.registerBeforeRender(T)}executeOnceBeforeRender(J,T){void 0!==T?setTimeout((()=>{this._executeOnceBeforeRender(J)}),T):this._executeOnceBeforeRender(J)}addPendingData(J){this._pendingData.push(J)}removePendingData(J){const T=this.isLoading,b=this._pendingData.indexOf(J);-1!==b&&this._pendingData.splice(b,1),T&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(J),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(T)}async whenReadyAsync(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return await new Promise((T=>{this.executeWhenReady((()=>{T()}),J)}))}_checkIsReady(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(J)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(J)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=t.b.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(J,T,b,q){b||q||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===J.updateFlag&&this._projectionUpdateFlag===T.updateFlag||(this._viewUpdateFlag=J.updateFlag,this._projectionUpdateFlag=T.updateFlag,this._viewMatrix=J,this._projectionMatrix=T,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?N.d.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=N.d.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(b,q):this._sceneUbo.useUbo&&(this._sceneUbo.Zi("viewProjection",this._transformMatrix),this._sceneUbo.Zi("view",this._viewMatrix),this._sceneUbo.Zi("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(J){const T=new a.b(this._engine,void 0,!1,J??"cg");return T.addUniform("viewProjection",16),T.addUniform("view",16),T.addUniform("projection",16),T.addUniform("vEyePosition",4),T}setSceneUniformBuffer(J){this._sceneUbo=J,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return R.e.UniqueId}Yi(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._blockEntityCollection&&(this.meshes.push(J),J._resyncLightSources(),J.parent||J._addToSceneRootNodes(),q.e.SetImmediate((()=>{this.onNewMeshAddedObservable.notifyObservers(J)})),T)){const T=J.getChildMeshes();for(const J of T)this.Yi(J)}}_i(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const b=this.meshes.indexOf(J);if(-1!==b&&(this.meshes.splice(b,1),J.parent||J._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(J),this.onMeshRemovedObservable.notifyObservers(J),T){const T=J.getChildMeshes();for(const J of T)this._i(J)}return b}addTransformNode(J){this._blockEntityCollection||J.va()===this&&-1!==J._indexInSceneTransformNodesArray||(J._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(J),J.parent||J._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(J))}removeTransformNode(J){const T=J._indexInSceneTransformNodesArray;if(-1!==T){if(T!==this.transformNodes.length-1){const J=this.transformNodes[this.transformNodes.length-1];this.transformNodes[T]=J,J._indexInSceneTransformNodesArray=T}J._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),J.parent||J._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(J),T}removeSkeleton(J){const T=this.skeletons.indexOf(J);return-1!==T&&(this.skeletons.splice(T,1),this.onSkeletonRemovedObservable.notifyObservers(J),this._executeActiveContainerCleanup(this._activeSkeletons)),T}removeMorphTargetManager(J){const T=this.morphTargetManagers.indexOf(J);return-1!==T&&this.morphTargetManagers.splice(T,1),T}removeLight(J){const T=this.lights.indexOf(J);if(-1!==T){for(const T of this.meshes)T._removeLightSource(J,!1);this.lights.splice(T,1),this.sortLightsByPriority(),J.parent||J._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(J),T}removeCamera(J){const T=this.cameras.indexOf(J);if(-1!==T&&(this.cameras.splice(T,1),J.parent||J._removeFromSceneRootNodes()),this.activeCameras){const T=this.activeCameras.indexOf(J);-1!==T&&this.activeCameras.splice(T,1)}return this.activeCamera===J&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(J),T}removeParticleSystem(J){const T=this.si.indexOf(J);return-1!==T&&(this.si.splice(T,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),T}removeAnimation(J){const T=this.animations.indexOf(J);return-1!==T&&this.animations.splice(T,1),T}stopAnimation(J,T,b){}removeAnimationGroup(J){const T=this.animationGroups.indexOf(J);return-1!==T&&this.animationGroups.splice(T,1),T}removeMultiMaterial(J){const T=this.multiMaterials.indexOf(J);return-1!==T&&this.multiMaterials.splice(T,1),this.onMultiMaterialRemovedObservable.notifyObservers(J),T}removeMaterial(J){const T=J._indexInSceneMaterialArray;if(-1!==T&&T<this.materials.length){if(T!==this.materials.length-1){const J=this.materials[this.materials.length-1];this.materials[T]=J,J._indexInSceneMaterialArray=T}J._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(J),T}removeActionManager(J){const T=this.actionManagers.indexOf(J);return-1!==T&&this.actionManagers.splice(T,1),T}removeTexture(J){const T=this.textures.indexOf(J);return-1!==T&&this.textures.splice(T,1),this.onTextureRemovedObservable.notifyObservers(J),T}addLight(J){if(!this._blockEntityCollection){this.lights.push(J),this.sortLightsByPriority(),J.parent||J._addToSceneRootNodes();for(const T of this.meshes)-1===T.lightSources.indexOf(J)&&(T.lightSources.push(J),T._resyncLightSources());q.e.SetImmediate((()=>{this.onNewLightAddedObservable.notifyObservers(J)}))}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(D.e.CompareLightsPriority)}addCamera(J){this._blockEntityCollection||(this.cameras.push(J),q.e.SetImmediate((()=>{this.onNewCameraAddedObservable.notifyObservers(J)})),J.parent||J._addToSceneRootNodes())}addSkeleton(J){this._blockEntityCollection||(this.skeletons.push(J),q.e.SetImmediate((()=>{this.onNewSkeletonAddedObservable.notifyObservers(J)})))}addParticleSystem(J){this._blockEntityCollection||this.si.push(J)}addAnimation(J){this._blockEntityCollection||this.animations.push(J)}addAnimationGroup(J){this._blockEntityCollection||this.animationGroups.push(J)}addMultiMaterial(J){this._blockEntityCollection||(this.multiMaterials.push(J),q.e.SetImmediate((()=>{this.onNewMultiMaterialAddedObservable.notifyObservers(J)})))}addMaterial(J){this._blockEntityCollection||J.va()===this&&-1!==J._indexInSceneMaterialArray||(J._indexInSceneMaterialArray=this.materials.length,this.materials.push(J),q.e.SetImmediate((()=>{this.onNewMaterialAddedObservable.notifyObservers(J)})))}addMorphTargetManager(J){this._blockEntityCollection||this.morphTargetManagers.push(J)}addGeometry(J){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[J.uniqueId]=this.geometries.length),this.geometries.push(J))}addActionManager(J){this.actionManagers.push(J)}addTexture(J){this._blockEntityCollection||(this.textures.push(J),this.onNewTextureAddedObservable.notifyObservers(J))}switchActiveCamera(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.Oi(),this.activeCamera=J,T&&J.attachControl())}setActiveCameraById(J){const T=this.getCameraById(J);return T?(this.activeCamera=T,T):null}setActiveCameraByName(J){const T=this.getCameraByName(J);return T?(this.activeCamera=T,T):null}getAnimationGroupByName(J){for(let T=0;T<this.animationGroups.length;T++)if(this.animationGroups[T].name===J)return this.animationGroups[T];return null}_getMaterial(J,T){for(let b=0;b<this.materials.length;b++){const J=this.materials[b];if(T(J))return J}if(J)for(let b=0;b<this.multiMaterials.length;b++){const J=this.multiMaterials[b];if(T(J))return J}return null}getMaterialByUniqueID(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getMaterialByUniqueId(J,T)}getMaterialByUniqueId(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(T,(T=>T.uniqueId===J))}getMaterialById(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(T,(T=>T.id===J))}getMaterialByName(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(T,(T=>T.name===J))}getLastMaterialById(J){let T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let b=this.materials.length-1;b>=0;b--)if(this.materials[b].id===J)return this.materials[b];if(T)for(let b=this.multiMaterials.length-1;b>=0;b--)if(this.multiMaterials[b].id===J)return this.multiMaterials[b];return null}getTextureByUniqueId(J){for(let T=0;T<this.textures.length;T++)if(this.textures[T].uniqueId===J)return this.textures[T];return null}getTextureByName(J){for(let T=0;T<this.textures.length;T++)if(this.textures[T].name===J)return this.textures[T];return null}getCameraById(J){for(let T=0;T<this.cameras.length;T++)if(this.cameras[T].id===J)return this.cameras[T];return null}getCameraByUniqueId(J){for(let T=0;T<this.cameras.length;T++)if(this.cameras[T].uniqueId===J)return this.cameras[T];return null}getCameraByName(J){for(let T=0;T<this.cameras.length;T++)if(this.cameras[T].name===J)return this.cameras[T];return null}getBoneById(J){for(let T=0;T<this.skeletons.length;T++){const b=this.skeletons[T];for(let T=0;T<b.bones.length;T++)if(b.bones[T].id===J)return b.bones[T]}return null}getBoneByName(J){for(let T=0;T<this.skeletons.length;T++){const b=this.skeletons[T];for(let T=0;T<b.bones.length;T++)if(b.bones[T].name===J)return b.bones[T]}return null}getLightByName(J){for(let T=0;T<this.lights.length;T++)if(this.lights[T].name===J)return this.lights[T];return null}getLightById(J){for(let T=0;T<this.lights.length;T++)if(this.lights[T].id===J)return this.lights[T];return null}getLightByUniqueId(J){for(let T=0;T<this.lights.length;T++)if(this.lights[T].uniqueId===J)return this.lights[T];return null}getParticleSystemById(J){for(let T=0;T<this.si.length;T++)if(this.si[T].id===J)return this.si[T];return null}getGeometryById(J){for(let T=0;T<this.geometries.length;T++)if(this.geometries[T].id===J)return this.geometries[T];return null}_getGeometryByUniqueId(J){if(this._geometriesByUniqueId){const T=this._geometriesByUniqueId[J];if(void 0!==T)return this.geometries[T]}else for(let T=0;T<this.geometries.length;T++)if(this.geometries[T].uniqueId===J)return this.geometries[T];return null}getFrameGraphByName(J){for(let T=0;T<this.frameGraphs.length;T++)if(this.frameGraphs[T].name===J)return this.frameGraphs[T];return null}pushGeometry(J,T){return!(!T&&this._getGeometryByUniqueId(J.uniqueId))&&(this.addGeometry(J),q.e.SetImmediate((()=>{this.onNewGeometryAddedObservable.notifyObservers(J)})),!0)}removeGeometry(J){let T;if(this._geometriesByUniqueId){if(T=this._geometriesByUniqueId[J.uniqueId],void 0===T)return!1}else if(T=this.geometries.indexOf(J),T<0)return!1;if(T!==this.geometries.length-1){const J=this.geometries[this.geometries.length-1];J&&(this.geometries[T]=J,this._geometriesByUniqueId&&(this._geometriesByUniqueId[J.uniqueId]=T))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[J.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(J),!0}getGeometries(){return this.geometries}getMeshById(J){for(let T=0;T<this.meshes.length;T++)if(this.meshes[T].id===J)return this.meshes[T];return null}getMeshesById(J){return this.meshes.filter((function(T){return T.id===J}))}getTransformNodeById(J){for(let T=0;T<this.transformNodes.length;T++)if(this.transformNodes[T].id===J)return this.transformNodes[T];return null}getTransformNodeByUniqueId(J){for(let T=0;T<this.transformNodes.length;T++)if(this.transformNodes[T].uniqueId===J)return this.transformNodes[T];return null}getTransformNodesById(J){return this.transformNodes.filter((function(T){return T.id===J}))}getMeshByUniqueId(J){for(let T=0;T<this.meshes.length;T++)if(this.meshes[T].uniqueId===J)return this.meshes[T];return null}getLastMeshById(J){for(let T=this.meshes.length-1;T>=0;T--)if(this.meshes[T].id===J)return this.meshes[T];return null}getLastTransformNodeById(J){for(let T=this.transformNodes.length-1;T>=0;T--)if(this.transformNodes[T].id===J)return this.transformNodes[T];return null}getLastEntryById(J){let T;for(T=this.meshes.length-1;T>=0;T--)if(this.meshes[T].id===J)return this.meshes[T];for(T=this.transformNodes.length-1;T>=0;T--)if(this.transformNodes[T].id===J)return this.transformNodes[T];for(T=this.cameras.length-1;T>=0;T--)if(this.cameras[T].id===J)return this.cameras[T];for(T=this.lights.length-1;T>=0;T--)if(this.lights[T].id===J)return this.lights[T];return null}getNodeById(J){const T=this.getMeshById(J);if(T)return T;const b=this.getTransformNodeById(J);if(b)return b;const q=this.getLightById(J);if(q)return q;const t=this.getCameraById(J);if(t)return t;const j=this.getBoneById(J);return j||null}getNodeByName(J){const T=this.getMeshByName(J);if(T)return T;const b=this.getTransformNodeByName(J);if(b)return b;const q=this.getLightByName(J);if(q)return q;const t=this.getCameraByName(J);if(t)return t;const j=this.getBoneByName(J);return j||null}getMeshByName(J){for(let T=0;T<this.meshes.length;T++)if(this.meshes[T].name===J)return this.meshes[T];return null}getTransformNodeByName(J){for(let T=0;T<this.transformNodes.length;T++)if(this.transformNodes[T].name===J)return this.transformNodes[T];return null}getLastSkeletonById(J){for(let T=this.skeletons.length-1;T>=0;T--)if(this.skeletons[T].id===J)return this.skeletons[T];return null}getSkeletonByUniqueId(J){for(let T=0;T<this.skeletons.length;T++)if(this.skeletons[T].uniqueId===J)return this.skeletons[T];return null}getSkeletonById(J){for(let T=0;T<this.skeletons.length;T++)if(this.skeletons[T].id===J)return this.skeletons[T];return null}getSkeletonByName(J){for(let T=0;T<this.skeletons.length;T++)if(this.skeletons[T].name===J)return this.skeletons[T];return null}getMorphTargetManagerById(J){for(let T=0;T<this.morphTargetManagers.length;T++)if(this.morphTargetManagers[T].uniqueId===J)return this.morphTargetManagers[T];return null}getMorphTargetById(J){for(let T=0;T<this.morphTargetManagers.length;++T){const b=this.morphTargetManagers[T];for(let T=0;T<b.numTargets;++T){const q=b.getTarget(T);if(q.id===J)return q}}return null}getMorphTargetByName(J){for(let T=0;T<this.morphTargetManagers.length;++T){const b=this.morphTargetManagers[T];for(let T=0;T<b.numTargets;++T){const q=b.getTarget(T);if(q.name===J)return q}}return null}getPostProcessByName(J){for(let T=0;T<this.postProcesses.length;++T){const b=this.postProcesses[T];if(b.name===J)return b}return null}isActiveMesh(J){return-1!==this._activeMeshes.indexOf(J)}get uid(){return this._uid||(this._uid=q.e.RandomId()),this._uid}addExternalData(J,T){return this._externalData||(this._externalData=new Y),this._externalData.add(J,T)}getExternalData(J){return this._externalData?this._externalData.get(J):null}getOrAddExternalDataWithFactory(J,T){return this._externalData||(this._externalData=new Y),this._externalData.getOrAddWithFactory(J,T)}removeExternalData(J){return this._externalData.remove(J)}_evaluateSubMesh(J,T,b,q){if(q||J.isInFrustum(this._frustumPlanes)){for(const q of this._evaluateSubMeshStage)q.action(T,J);const b=J.Ha();null!==b&&void 0!==b&&(b.hasRenderTargetTextures&&null!=b.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(b)&&(this._processedMaterials.push(b),this._materialsRenderTargets.concatWithNoDuplicate(b.getRenderTargetTextures())),this._renderingManager.dispatch(J,T,b))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(J){this._preventFreeActiveMeshesAndRenderingGroups!==J&&(J&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=J)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let J=0;J<this.activeCameras.length;J++){const T=this.activeCameras[J];T&&T._activeMeshes&&T._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let J=0;J<this.textures.length;J++){const T=this.textures[J];T&&T.renderList&&T.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0],T=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0,q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],t=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=t,this._skipEvaluateActiveMeshesCompletely=J,q)for(let J=0;J<this._activeMeshes.length;J++)this._activeMeshes.data[J]._freeze();T&&T()}else b&&b("No active camera found")})),this}unfreezeActiveMeshes(){for(let J=0;J<this.meshes.length;J++){const T=this.meshes[J];T._internalAbstractMeshDataInfo&&(T._internalAbstractMeshDataInfo._isActive=!1)}for(let J=0;J<this._activeMeshes.length;J++)this._activeMeshes.data[J]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(J){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>J.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var J;if(this._activeMeshes.length>0)null===(J=this.activeCamera)||void 0===J||J._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const J=this._activeMeshes.length;for(let T=0;T<J;T++){this._activeMeshes.data[T].ti()}}if(this._activeParticleSystems){const J=this._activeParticleSystems.length;for(let T=0;T<J;T++)this._activeParticleSystems.data[T].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const q of this._beforeEvaluateActiveMeshStage)q.action();const T=this.getActiveMeshCandidates(),b=T.length;for(let q=0;q<b;q++){const J=T.data[q];let b=J._internalAbstractMeshDataInfo._currentLOD.get(this.activeCamera);if(b?b[1]=-1:(b=[J,-1],J._internalAbstractMeshDataInfo._currentLOD.set(this.activeCamera,b)),J.isBlocked)continue;if(this._totalVertices.addCount(J.getTotalVertices(),!1),!J.isReady()||!J.isEnabled()||J.ii.hasAZeroComponent)continue;J.ti(),J.actionManager&&J.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(J);let t=this.customLODSelector?this.customLODSelector(J,this.activeCamera):J.getLOD(this.activeCamera);if(b[0]=t,b[1]=this._frameId,void 0!==t&&null!==t&&(t!==J&&0!==t.billboardMode&&t.ti(),J._preActivate(),J.isVisible&&J.visibility>0&&0!==(J.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||J.ai||J.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(J),this.activeCamera._activeMeshes.push(J),t!==J&&t._activate(this._renderId,!1);for(const T of this._preActiveMeshStage)T.action(J);J._activate(this._renderId,!1)&&(J.isAnInstance?J._internalAbstractMeshDataInfo._actAsRegularMesh&&(t=J):t._internalAbstractMeshDataInfo._onlyForInstances=!1,t._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(J,t)),J._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let J=0;J<this.si.length;J++){const T=this.si[J];if(!T.isStarted()||!T.j)continue;const b=T.j;b.position&&!b.isEnabled()||(this._activeParticleSystems.push(T),T.animate(),this._renderingManager.dispatchParticles(T))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(J){this._skeletonsEnabled&&J.skeleton&&(this._activeSkeletons.pushNoDuplicate(J.skeleton)&&(J.skeleton.prepare(),this._activeBones.addCount(J.skeleton.bones.length,!1)),J.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(J)&&this.frameGraph&&J.applySkeleton(J.skeleton))}_activeMesh(J,T){this._prepareSkeleton(T);let b=J.hasInstances||J.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||T.ai;if(T&&T.xi&&T.xi.length>0){const q=this.getActiveSubMeshCandidates(T),t=q.length;b=b||1===t;for(let j=0;j<t;j++){const t=q.data[j];this._evaluateSubMesh(t,T,J,b)}}}updateTransformMatrix(J){const T=this.activeCamera;if(T)if(T._renderingMultiview){const b=T._rigCameras[0],q=T._rigCameras[1];this.setTransformMatrix(b.getViewMatrix(),b.getProjectionMatrix(J),q.getViewMatrix(),q.getProjectionMatrix(J))}else this.setTransformMatrix(T.getViewMatrix(),T.getProjectionMatrix(J))}_bindFrameBuffer(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._useCurrentFrameBuffer||(J&&J._multiviewTexture?J._multiviewTexture._bindFrameBuffer():J&&J.outputRenderTarget?J.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer()),T&&this._clearFrameBuffer(J)}_clearFrameBuffer(J){if(J&&J._multiviewTexture);else if(J&&J.outputRenderTarget&&!J._renderingMultiview){const T=J.outputRenderTarget;T.onClearObservable.hasObservers()?T.onClearObservable.notifyObservers(this._engine):T.skipInitialClear||J.isRightCamera||(this.El&&this._engine.clear(T.clearColor||this._clearColor,!T._cleared,!0,!0),T._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(J,T){var b;let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(J&&J._skipRendering)return;const j=this._engine;if(this._activeCamera=J,!this.activeCamera)throw new Error("Active camera not set");if(j.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&t){let T=!0;J._renderingMultiview&&J.outputRenderTarget&&(T=J.outputRenderTarget.skipInitialClear,this.El&&(this._defaultFrameBufferCleared=!1,J.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),J._renderingMultiview&&J.outputRenderTarget&&(J.outputRenderTarget.skipInitialClear=T)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let q=0;q<this._softwareSkinnedMeshes.length;q++){const J=this._softwareSkinnedMeshes.data[q];J.applySkeleton(J.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),J.customRenderTargets&&J.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(J.customRenderTargets),T&&T.customRenderTargets&&T.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(T.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const q of this._gatherActiveCameraRenderTargetsStage)q.action(this._renderTargets);let B=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){q.e.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let J=0;J<this._renderTargets.length;J++){const T=this._renderTargets.data[J];if(T._shouldRender()){this._renderId++;const J=T.activeCamera&&T.activeCamera!==this.activeCamera;T.render(J,this.dumpNextRenderTargets),B=!0}}q.e.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const J of this._cameraDrawRenderTargetStage)B=J.action(this.activeCamera)||B;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(b=J.outputRenderTarget)||void 0===b?void 0:b.renderPassId)??J.renderPassId??0,B&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||J._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const q of this._beforeCameraDrawStage)q.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),j.snapshotRendering&&1===j.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const q of this._afterCameraDrawStage)q.action(this.activeCamera);if(this.postProcessManager&&!J._multiviewTexture){const T=J.outputRenderTarget?J.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(J.isIntermediate,T)}for(const q of this._afterCameraPostProcessStage)q.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(J){let T=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===J.cameraRigMode||J._renderingMultiview)return J._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(J,void 0,T),void this.onAfterRenderCameraObservable.notifyObservers(J);if(J._useMultiviewToSingleView)this._renderMultiviewToSingleView(J);else{this.onBeforeCameraRenderObservable.notifyObservers(J);for(let T=0;T<J._rigCameras.length;T++)this._renderForCamera(J._rigCameras[T],J)}this._activeCamera=J,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(J)}_checkIntersections(){for(let J=0;J<this._meshesForIntersections.length;J++){const T=this._meshesForIntersections.data[J];if(T.actionManager)for(let J=0;T.actionManager&&J<T.actionManager.actions.length;J++){const b=T.actionManager.actions[J];if(12===b.trigger||13===b.trigger){const J=b.getTriggerParameter(),q=J.mesh?J.mesh:J,t=q.intersectsMesh(T,J.usePreciseIntersection),j=T._intersectionsInProgress.indexOf(q);t&&-1===j?12===b.trigger?(b._executeCurrent(v.CreateNew(T,void 0,q)),T._intersectionsInProgress.push(q)):13===b.trigger&&T._intersectionsInProgress.push(q):!t&&j>-1&&(13===b.trigger&&b._executeCurrent(v.CreateNew(T,void 0,q)),T.actionManager.hasSpecificTrigger(13,(J=>{const T=J.mesh?J.mesh:J;return q===T}))&&13!==b.trigger||T._intersectionsInProgress.splice(j,1))}}}}_advancePhysicsEngineStep(J){}_animate(J){}animate(){if(this._engine.isDeterministicLockStep()){let J=Math.max(JJ.MinDeltaTime,Math.min(this._engine.getDeltaTime(),JJ.MaxDeltaTime))+this._timeAccumulator;const T=this._engine.getTimeStep(),b=1e3/T/1e3;let q=0;const t=this._engine.getLockstepMaxSteps();let j=Math.floor(J/T);for(j=Math.min(j,t);J>0&&q<j;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=T*b,this._animate(T),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(T),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,q++,J-=T;this._timeAccumulator=J<0?0:J}else{const J=this.useConstantAnimationDeltaTime?16:Math.max(JJ.MinDeltaTime,Math.min(this._engine.getDeltaTime(),JJ.MaxDeltaTime));this._animationRatio=.06*J,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(J)}}_clear(){(this.autoClearDepthAndStencil||this.El)&&this._engine.clear(this._clearColor,this.El||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(J){var T;if(null===J||void 0===J||!J.outputRenderTarget||null!==J&&void 0!==J&&J.isRigCamera||(J.outputRenderTarget._cleared=!1),null!==J&&void 0!==J&&null!==(T=J.rigCameras)&&void 0!==T&&T.length)for(let b=0;b<J.rigCameras.length;++b){const T=J.rigCameras[b].outputRenderTarget;T&&(T._cleared=!1)}}resetDrawCache(J){if(this.meshes)for(const T of this.meshes)T.resetDrawCache(J)}_renderWithFrameGraph(){var J;let T=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),T)for(const t of this.cameras)if(t.update(),0!==t.cameraRigMode)for(let J=0;J<t._rigCameras.length;J++)t._rigCameras[J].update();this.onBeforeRenderObservable.notifyObservers(this);for(const t of this._beforeClearStage)t.action();const b=this.getActiveMeshCandidates(),q=b.length;for(let t=0;t<q;t++){const J=b.data[t];J.isBlocked||(this._totalVertices.addCount(J.getTotalVertices(),!1),J.isReady()&&J.isEnabled()&&!J.ii.hasAZeroComponent&&(J.ti(),J.actionManager&&J.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(J)))}if(this.particlesEnabled)for(let t=0;t<this.si.length;t++){const J=this.si[t];if(!J.isStarted()||!J.j)continue;const T=J.j;T.position&&!T.isEnabled()||(this._activeParticleSystems.push(J),J.animate())}null===(J=this.frameGraph)||void 0===J||J.execute()}_renderRenderTarget(J,T){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._intermediateRendering=!0,J._shouldRender()){if(this._renderId++,this.activeCamera=T,!this.activeCamera)throw new Error("Active camera not set");this._engine.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),J.render(b,q)}this._intermediateRendering=!1}render(){var J;let T=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.u){if(this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(J=this.activeCameras)&&void 0!==J&&J.length)for(const J of this.activeCameras)this._checkCameraRenderTarget(J);this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),b||this.animate();for(const J of this._beforeCameraUpdateStage)J.action();if(T)if(this.activeCameras&&this.activeCameras.length>0)for(let J=0;J<this.activeCameras.length;J++){const T=this.activeCameras[J];if(T.update(),0!==T.cameraRigMode)for(let J=0;J<T._rigCameras.length;J++)T._rigCameras[J].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let J=0;J<this.activeCamera._rigCameras.length;J++)this.activeCamera._rigCameras[J].update();if(this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(T,b);else{var t;this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const J=null!==(t=this.activeCameras)&&void 0!==t&&t.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){q.e.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);for(let T=0;T<this.customRenderTargets.length;T++){const b=this.customRenderTargets[T],q=b.activeCamera||this.activeCamera;this._renderRenderTarget(b,q,J!==q,this.dumpNextRenderTargets)}q.e.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._renderId++}this._engine.currentRenderPassId=(null===J||void 0===J?void 0:J.renderPassId)??0,this.activeCamera=J,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const T of this._beforeClearStage)T.action();this._clearFrameBuffer(this.activeCamera);for(const T of this._gatherRenderTargetsStage)T.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let T=0;T<this.activeCameras.length;T++)this._processSubCameras(this.activeCameras[T],T>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const J of this._afterRenderStage)J.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let J=0;J<this._toBeDisposed.length;J++){const T=this._toBeDisposed[J];T&&T.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let J=0;J<this.materials.length;J++)this.materials[J].freeze()}unfreezeMaterials(){for(let J=0;J<this.materials.length;J++)this.materials[J].unfreeze()}dispose(){if(this.u)return;if(this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations){for(const J of this._activeAnimatables)J.onAnimationEndObservable.clear(),J.onAnimationEnd=null;this.stopAllAnimations()}this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const J=this._activeRequests.slice();for(const t of J)t.abort();this._activeRequests.length=0;try{this.Ki.notifyObservers(this)}catch(q){y.d.Error("An error occurred while calling onDisposeObservable!",q)}this.Oi();if(this._engine.getInputElement())for(let t=0;t<this.cameras.length;t++)this.cameras[t].Oi();this._disposeList(this.animationGroups),this._disposeList(this.lights),this.ol&&this.ol.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.meshes,(J=>J.dispose(!0))),this._disposeList(this.transformNodes,(J=>J.dispose(!0)));const T=this.cameras;this._disposeList(T),this._disposeList(this.si),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let b=this._engine.scenes.indexOf(this);if(b>-1&&this._engine.scenes.splice(b,1),U.e._LastCreatedScene===this){U.e._LastCreatedScene=null;let J=U.e.Instances.length-1;for(;J>=0;){const T=U.e.Instances[J];if(T.scenes.length>0){U.e._LastCreatedScene=T.scenes[this._engine.scenes.length-1];break}J--}}b=this._engine._virtualScenes.indexOf(this),b>-1&&this._engine._virtualScenes.splice(b,1),this._engine.wipeCaches(!0),this.Ki.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this.onEnvironmentTextureChangedObservable.clear(),this.onMeshUnderPointerUpdatedObservable.clear(),this._isDisposed=!0}_disposeList(J,T){const b=J.slice(0);T=T??(J=>J.dispose());for(const q of b)T(q);J.length=0}get u(){return this._isDisposed}clearCachedVertexData(){for(let J=0;J<this.meshes.length;J++){const T=this.meshes[J].qi;T&&T.clearCachedData()}}cleanCachedTextureBuffer(){for(const J of this.textures){J._buffer&&(J._buffer=null)}}getWorldExtends(J){const T=new F.n(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b=new F.n(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);J=J||(()=>!0);const q=this.meshes.filter(J);for(const t of q){if(t.ti(!0),!t.xi||0===t.xi.length||t.infiniteDistance)continue;const J=t.getBoundingInfo(),q=J.boundingBox.minimumWorld,j=J.boundingBox.maximumWorld;F.n.CheckExtends(q,T,b),F.n.CheckExtends(j,T,b)}return{min:T,max:b}}createPickingRay(J,T,b,q){throw(0,K.e)("Ray")}createPickingRayToRef(J,T,b,q,t){throw(0,K.e)("Ray")}createPickingRayInCameraSpace(J,T,b){throw(0,K.e)("Ray")}createPickingRayInCameraSpaceToRef(J,T,b,q){throw(0,K.e)("Ray")}Mk(J,T,b,q,t,j){const B=(0,K.e)("Ray",!0);return B&&y.d.Warn(B),new P.d}pickWithBoundingInfo(J,T,b,q,t){const j=(0,K.e)("Ray",!0);return j&&y.d.Warn(j),new P.d}pickWithRay(J,T,b,q){throw(0,K.e)("Ray")}multiPick(J,T,b,q,t){throw(0,K.e)("Ray")}multiPickWithRay(J,T,b){throw(0,K.e)("Ray")}setPointerOverMesh(J,T,b){this._inputManager.setPointerOverMesh(J,T,b)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const J of this.geometries)J._rebuild();for(const J of this.meshes)J._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const J of this._components)J.rebuild();for(const J of this.si)J.rebuild();if(this.spriteManagers)for(const J of this.spriteManagers)J.rebuild()}_rebuildTextures(){for(const J of this.textures)J._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(J,T,b){if(void 0===T)return J;const q=[];for(const t in J){const j=J[t];C.c&&C.c.MatchesQuery(j,T)&&(!b||b(j))&&q.push(j)}return q}getMeshesByTags(J,T){return this._getByTags(this.meshes,J,T)}getCamerasByTags(J,T){return this._getByTags(this.cameras,J,T)}getLightsByTags(J,T){return this._getByTags(this.lights,J,T)}getMaterialByTags(J,T){return this._getByTags(this.materials,J,T).concat(this._getByTags(this.multiMaterials,J,T))}getTransformNodesByTags(J,T){return this._getByTags(this.transformNodes,J,T)}setRenderingOrder(J){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(J,T,b,q)}setRenderingAutoClearDepthStencil(J,T){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(J,T,b,q)}getAutoClearDepthStencilSetup(J){return this._renderingManager.getAutoClearDepthStencilSetup(J)}_forceBlockMaterialDirtyMechanism(J){this._blockMaterialDirtyMechanism=J}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(J){this._blockMaterialDirtyMechanism!==J&&(this._blockMaterialDirtyMechanism=J,J||this.markAllMaterialsAsDirty(127))}markAllMaterialsAsDirty(J,T){if(!this._blockMaterialDirtyMechanism)for(const b of this.materials)T&&!T(b)||b.Pi(J)}_loadFile(J,T,b,q,t,j,B){const Y=(0,n.l)(J,T,b,q?this.offlineProvider:void 0,t,j,B);return this._activeRequests.push(Y),Y.onCompleteObservable.add((J=>{this._activeRequests.splice(this._activeRequests.indexOf(J),1)})),Y}async _loadFileAsync(J,T,b,q,t){return await new Promise(((j,B)=>{this._loadFile(J,(J=>{j(J)}),T,b,q,((J,T)=>{B(T)}),t)}))}_requestFile(J,T,b,q,t,j,B){const Y=(0,n.t)(J,T,b,q?this.offlineProvider:void 0,t,j,B);return this._activeRequests.push(Y),Y.onCompleteObservable.add((J=>{this._activeRequests.splice(this._activeRequests.indexOf(J),1)})),Y}async _requestFileAsync(J,T,b,q,t){return await new Promise(((j,B)=>{this._requestFile(J,(J=>{j(J)}),T,b,q,(J=>{B(J)}),t)}))}_readFile(J,T,b,q,t){const j=(0,n.r)(J,T,b,q,t);return this._activeRequests.push(j),j.onCompleteObservable.add((J=>{this._activeRequests.splice(this._activeRequests.indexOf(J),1)})),j}async _readFileAsync(J,T,b){return await new Promise(((q,t)=>{this._readFile(J,(J=>{q(J)}),T,b,(J=>{t(J)}))}))}getPerfCollector(){throw(0,K.e)("performanceViewerSceneExtension")}setActiveCameraByID(J){return this.setActiveCameraById(J)}getMaterialByID(J){return this.getMaterialById(J)}getLastMaterialByID(J){return this.getLastMaterialById(J)}getTextureByUniqueID(J){return this.getTextureByUniqueId(J)}getCameraByID(J){return this.getCameraById(J)}getCameraByUniqueID(J){return this.getCameraByUniqueId(J)}getBoneByID(J){return this.getBoneById(J)}getLightByID(J){return this.getLightById(J)}getLightByUniqueID(J){return this.getLightByUniqueId(J)}getParticleSystemByID(J){return this.getParticleSystemById(J)}getGeometryByID(J){return this.getGeometryById(J)}getMeshByID(J){return this.getMeshById(J)}getMeshByUniqueID(J){return this.getMeshByUniqueId(J)}getLastMeshByID(J){return this.getLastMeshById(J)}getMeshesByID(J){return this.getMeshesById(J)}getTransformNodeByID(J){return this.getTransformNodeById(J)}getTransformNodeByUniqueID(J){return this.getTransformNodeByUniqueId(J)}getTransformNodesByID(J){return this.getTransformNodesById(J)}getNodeByID(J){return this.getNodeById(J)}getLastEntryByID(J){return this.getLastEntryById(J)}getLastSkeletonByID(J){return this.getLastSkeletonById(J)}}JJ.FOGMODE_NONE=0,JJ.FOGMODE_EXP=1,JJ.FOGMODE_EXP2=2,JJ.FOGMODE_LINEAR=3,JJ.MinDeltaTime=1,JJ.MaxDeltaTime=1e3,JJ._OriginalDefaultMaterialFactory=JJ.DefaultMaterialFactory,(0,k.g)("BABYLON.Scene",JJ)}}]);