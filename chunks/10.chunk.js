"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[10],{2175:(U,W,l)=>{l.d(W,{d:()=>w,h:()=>f,i:()=>D,l:()=>o});var M=l(503),t=l(706),L=l(722),p=l(2009),B=l(624),k=l(2051),A=(l(2178),l(2071)),q=l(512);l(2235),l(2239),l(2245);const y="image/png",j=2,s=[134,22,135,150,246,214,150,54];function w(U){const W=new DataView(U.buffer,U.byteOffset,U.byteLength);let l=0;for(let p=0;p<s.length;p++)if(W.getUint8(l++)!==s[p])return q.b.Error("Not a babylon environment map"),null;let M="",t=0;for(;t=W.getUint8(l++);)M+=String.fromCharCode(t);let L=JSON.parse(M);return L=K(L),L.binaryDataPosition=l,L.xk&&(L.xk.lodGenerationScale=L.xk.lodGenerationScale||.8),L}function K(U){if(U.version>j)throw new Error(`Unsupported babylon environment map version "${U.version}". Latest supported version is "${j}".`);return 2===U.version?U:U={...U,version:2,imageType:y}}function r(U,W){const l=(W=K(W)).xk;let M=Math.log2(W.width);if(M=Math.round(M)+1,l.mipmaps.length!==6*M)throw new Error(`Unsupported specular mipmaps number "${l.mipmaps.length}"`);const t=new Array(M);for(let L=0;L<M;L++){t[L]=new Array(6);for(let M=0;M<6;M++){const p=l.mipmaps[6*L+M];t[L][M]=new Uint8Array(U.buffer,U.byteOffset+W.binaryDataPosition+p.position,p.length)}}return t}function m(U,W){var l;W=K(W);const M=new Array(6),t=null===(l=W.irradiance)||void 0===l?void 0:l.irradianceTexture;if(t){if(6!==t.faces.length)throw new Error(`Incorrect irradiance texture faces number "${t.faces.length}"`);for(let l=0;l<6;l++){const L=t.faces[l];M[l]=new Uint8Array(U.buffer,U.byteOffset+W.binaryDataPosition+L.position,L.length)}}return M}function f(U,W,l){var M;const L=(l=K(l)).xk;if(!L)return Promise.resolve([]);U._lodGenerationScale=L.lodGenerationScale;const p=[],B=r(W,l);p.push(E(U,B,l.imageType));const k=null===(M=l.irradiance)||void 0===M?void 0:M.irradianceTexture;if(k){var A,q;const M=m(W,l);let L=null;null!==(A=l.irradiance)&&void 0!==A&&null!==(q=A.irradianceTexture)&&void 0!==q&&q.dominantDirection&&(L=t.l.gk(l.irradiance.irradianceTexture.dominantDirection)),p.push(Z(U,M,k.size,l.imageType,L))}return Promise.all(p)}async function g(U,W,l,M,t,L,p,B,k,A,q){return await new Promise(((y,j)=>{if(l){const l=W.createTexture(null,!0,!0,null,1,null,(U=>{j(U)}),U);null===M||void 0===M||M.onEffectCreatedObservable.addOnce((B=>{B.executeWhenCompiled((()=>{M.externalTextureSamplerBinding=!0,M.onApply=M=>{M._bindTexture("textureSampler",l),M.setFloat2("scale",1,W._features.needsInvertingBitmap&&U instanceof ImageBitmap?-1:1)},W.scenes.length&&(W.scenes[0].postProcessManager.directRender([M],A,!0,L,p),W.restoreDefaultFramebuffer(),l.dispose(),URL.revokeObjectURL(t),y())}))}))}else{if(W._uploadImageToTexture(q,U,L,p),B){const l=k[p];l&&W._uploadImageToTexture(l._texture,U,L,0)}y()}}))}async function E(U,W){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y;const M=U.getEngine();U.format=5,U.type=0,U.generateMipMaps=!0,U._cachedAnisotropicFilteringLevel=null,M.updateTextureSamplingMode(3,U),await N(U,W,!0,l),U.isReady=!0}async function Z(U,W,l){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const L=U.getEngine(),p=new B.c(L,5),A=new k.c(L,p);U._irradianceTexture=A,A._dominantDirection=t,p.isCube=!0,p.format=5,p.type=0,p.generateMipMaps=!0,p._cachedAnisotropicFilteringLevel=null,p.generateMipMaps=!0,p.width=l,p.height=l,L.updateTextureSamplingMode(3,p),await N(p,[W],!1,M),L.generateMipMapsForCubemap(p),p.isReady=!0}async function N(U,W,t){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y;if(!M.h.IsExponentOfTwo(U.width))throw new Error("Texture size must be a power of two");const q=(0,L.ILog2)(U.width)+1,j=U.getEngine();let s=!1,w=!1,K=null,r=null,m=null;const f=j.getCaps();f.textureLOD?j._features.supportRenderAndCopyToLodForFloatTextures?f.textureHalfFloatRender&&f.textureHalfFloatLinearFiltering?(s=!0,U.type=2):f.textureFloatRender&&f.textureFloatLinearFiltering&&(s=!0,U.type=1):s=!1:(s=!1,w=t);let E=0;if(s)j.isWebGPU?(E=1,await l.e(36).then(l.bind(l,13305))):await l.e(29).then(l.bind(l,13313)),K=new A.b("rgbdDecode","rgbdDecode",null,null,1,null,3,j,!1,void 0,U.type,void 0,null,!1,void 0,E),U._isRGBD=!1,U.invertY=!1,r=j.createRenderTargetCubeTexture(U.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:U.type,format:5});else if(U._isRGBD=!0,U.invertY=!0,w){const W=3;m={};const l=U._lodGenerationScale,M=U._lodGenerationOffset;for(let t=0;t<W;t++){const L=(q-1)*l+M,p=M+(L-M)*(1-t/(W-1)),A=Math.round(Math.min(Math.max(p,0),L)),y=new B.c(j,2);y.isCube=!0,y.invertY=!0,y.generateMipMaps=!1,j.updateTextureSamplingMode(2,y);const s=new k.c(null);switch(s._isCube=!0,s._texture=y,m[A]=s,t){case 0:U._lodTextureLow=s;break;case 1:U._lodTextureMid=s;break;case 2:U._lodTextureHigh=s}}}const Z=[];for(let l=0;l<W.length;l++)for(let M=0;M<6;M++){const t=W[l][M],L=new Blob([t],{type:p}),B=URL.createObjectURL(L);let k;if(j._features.forceBitmapOverHTMLImageElement)k=j.createImageBitmap(L,{premultiplyAlpha:"none"}).then((async W=>await g(W,j,s,K,B,M,l,w,m,r,U)));else{const W=new Image;W.src=B,k=new Promise(((t,L)=>{W.onload=()=>{g(W,j,s,K,B,M,l,w,m,r,U).then((()=>t())).catch((U=>{L(U)}))},W.onerror=U=>{L(U)}}))}Z.push(k)}if(await Promise.all(Z),W.length<q){let l;const M=Math.pow(2,q-1-W.length),t=M*M*4;switch(U.type){case 0:l=new Uint8Array(t);break;case 2:l=new Uint16Array(t);break;case 1:l=new Float32Array(t)}for(let L=W.length;L<q;L++)for(let W=0;W<6;W++){var N;j._uploadArrayBufferViewToTexture((null===(N=r)||void 0===N?void 0:N.texture)||U,l,W,L)}}if(r){const W=U._irradianceTexture;U._irradianceTexture=null,j._releaseTexture(U),r._swapAndDie(U),U._irradianceTexture=W}K&&K.dispose(),w&&(U._lodTextureHigh&&U._lodTextureHigh._texture&&(U._lodTextureHigh._texture.isReady=!0),U._lodTextureMid&&U._lodTextureMid._texture&&(U._lodTextureMid._texture.isReady=!0),U._lodTextureLow&&U._lodTextureLow._texture&&(U._lodTextureLow._texture.isReady=!0))}function D(U,W){const l=(W=K(W)).irradiance;if(!l)return;const M=new p.d;t.l.FromArrayToRef(l.x,0,M.x),t.l.FromArrayToRef(l.y,0,M.y),t.l.FromArrayToRef(l.z,0,M.z),t.l.FromArrayToRef(l.xx,0,M.xx),t.l.FromArrayToRef(l.yy,0,M.yy),t.l.FromArrayToRef(l.zz,0,M.zz),t.l.FromArrayToRef(l.yz,0,M.yz),t.l.FromArrayToRef(l.zx,0,M.zx),t.l.FromArrayToRef(l.xy,0,M.xy),U._sphericalPolynomial=M}function o(U,W,l,M,t){const L=E(U.getEngine().createRawCubeTexture(null,U.width,U.format,U.type,U.generateMipMaps,U.invertY,U.samplingMode,U._compression),W).then((()=>U));return U.onRebuildCallback=U=>({proxy:L,isReady:!0,isAsync:!0}),U._source=13,U._bufferViewArrayArray=W,U._lodGenerationScale=M,U._lodGenerationOffset=t,U._sphericalPolynomial=l,E(U,W).then((()=>(U.isReady=!0,U)))}}}]);