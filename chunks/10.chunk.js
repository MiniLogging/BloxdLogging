/*! For license information please see q880f5.10.b21450cd.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[10],{12662:(T,z,X)=>{"use strict";var b=X(12668),F=X(12674),A=X(12682);X.g.__TYPEDARRAY_POOL||(X.g.__TYPEDARRAY_POOL={UINT8:F([32,0]),UINT16:F([32,0]),UINT32:F([32,0]),INT8:F([32,0]),INT16:F([32,0]),INT32:F([32,0]),FLOAT:F([32,0]),DOUBLE:F([32,0]),DATA:F([32,0]),UINT8C:F([32,0]),BUFFER:F([32,0])});var u="undefined"!==typeof Uint8ClampedArray,y=X.g.__TYPEDARRAY_POOL;y.UINT8C||(y.UINT8C=F([32,0])),y.BUFFER||(y.BUFFER=F([32,0]));var E=y.DATA,v=y.BUFFER;function k(T){if(T){var z=T.length||T.byteLength,X=b.log2(z);E[X].push(T)}}function L(T){T=b.nextPow2(T);var z=b.log2(T),X=E[z];return X.length>0?X.pop():new ArrayBuffer(T)}function D(T){return new Uint8Array(L(T),0,T)}function c(T){return new Uint16Array(L(2*T),0,T)}function p(T){return new Uint32Array(L(4*T),0,T)}function H(T){return new Int8Array(L(T),0,T)}function U(T){return new Int16Array(L(2*T),0,T)}function s(T){return new Int32Array(L(4*T),0,T)}function x(T){return new Float32Array(L(4*T),0,T)}function K(T){return new Float64Array(L(8*T),0,T)}function d(T){return u?new Uint8ClampedArray(L(T),0,T):D(T)}function N(T){return new DataView(L(T),0,T)}z.free=function(T){if(A(T))v[b.log2(T.length)].push(T);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(T)&&(T=T.buffer),!T)return;var z=T.length||T.byteLength,X=0|b.log2(z);E[X].push(T)}},z.freeUint8=z.freeUint16=z.freeUint32=z.freeInt8=z.freeInt16=z.freeInt32=z.freeFloat32=z.freeFloat=z.freeFloat64=z.freeDouble=z.freeUint8Clamped=z.freeDataView=function(T){k(T.buffer)},z.freeArrayBuffer=k,z.freeBuffer=function(T){v[b.log2(T.length)].push(T)},z.malloc=function(T,z){if(void 0===z||"arraybuffer"===z)return L(T);switch(z){case"uint8":return D(T);case"uint16":return c(T);case"uint32":return p(T);case"int8":return H(T);case"int16":return U(T);case"int32":return s(T);case"float":case"float32":return x(T);case"double":case"float64":return K(T);case"uint8_clamped":return d(T);case"buffer":throw"Buffer not supported";case"data":case"dataview":return N(T);default:return null}return null},z.mallocArrayBuffer=L,z.mallocUint8=D,z.mallocUint16=c,z.mallocUint32=p,z.mallocInt8=H,z.mallocInt16=U,z.mallocInt32=s,z.mallocFloat32=z.mallocFloat=x,z.mallocFloat64=z.mallocDouble=K,z.mallocUint8Clamped=d,z.mallocDataView=N,z.clearCache=function(){for(var T=0;T<32;++T)y.UINT8[T].length=0,y.UINT16[T].length=0,y.UINT32[T].length=0,y.INT8[T].length=0,y.INT16[T].length=0,y.INT32[T].length=0,y.FLOAT[T].length=0,y.DOUBLE[T].length=0,y.UINT8C[T].length=0,E[T].length=0,v[T].length=0}},12765:(T,z,X)=>{T.exports=F;var b=X(12244);function F(T,z){if(!(this instanceof F))return new F(T,z);var X=b.create();b.add(X,T,z),this.$c=b.min(b.create(),T,X),this.Eh=b.clone(z),this.max=b.max(b.create(),T,X),this.mag=b.length(this.Eh)}var A=F.prototype;A.width=function(){return this.Eh[0]},A.height=function(){return this.Eh[1]},A.depth=function(){return this.Eh[2]},A.x0=function(){return this.$c[0]},A.y0=function(){return this.$c[1]},A.z0=function(){return this.$c[2]},A.x1=function(){return this.max[0]},A.y1=function(){return this.max[1]},A.z1=function(){return this.max[2]},A.translate=function(T){return b.add(this.max,this.max,T),b.add(this.$c,this.$c,T),this},A.setPosition=function(T){return b.add(this.max,T,this.Eh),b.j(this.$c,T),this},A.expand=function(T){var z=b.create(),X=b.create();return b.max(z,T.max,this.max),b.min(X,T.$c,this.$c),b.Mc(z,z,X),new F(X,z)},A.intersects=function(T){return!(T.$c[0]>this.max[0])&&(!(T.$c[1]>this.max[1])&&(!(T.$c[2]>this.max[2])&&(!(T.max[0]<this.$c[0])&&(!(T.max[1]<this.$c[1])&&!(T.max[2]<this.$c[2])))))},A.touches=function(T){var z=this.union(T);return null!==z&&(0==z.width()||0==z.height()||0==z.depth())},A.union=function(T){if(!this.intersects(T))return null;var z=Math.max(T.$c[0],this.$c[0]),X=Math.max(T.$c[1],this.$c[1]),b=Math.max(T.$c[2],this.$c[2]);return new F([z,X,b],[Math.min(T.max[0],this.max[0])-z,Math.min(T.max[1],this.max[1])-X,Math.min(T.max[2],this.max[2])-b])}},12668:(T,z)=>{"use strict";function X(T){var z=32;return(T&=-T)&&z--,65535&T&&(z-=16),16711935&T&&(z-=8),252645135&T&&(z-=4),858993459&T&&(z-=2),1431655765&T&&(z-=1),z}z.INT_BITS=32,z.INT_MAX=2147483647,z.INT_MIN=-1<<31,z.sign=function(T){return(T>0)-(T<0)},z.abs=function(T){var z=T>>31;return(T^z)-z},z.min=function(T,z){return z^(T^z)&-(T<z)},z.max=function(T,z){return T^(T^z)&-(T<z)},z.isPow2=function(T){return!(T&T-1)&&!!T},z.log2=function(T){var z,X;return z=(T>65535)<<4,z|=X=((T>>>=z)>255)<<3,z|=X=((T>>>=X)>15)<<2,(z|=X=((T>>>=X)>3)<<1)|(T>>>=X)>>1},z.log10=function(T){return T>=1e9?9:T>=1e8?8:T>=1e7?7:T>=1e6?6:T>=1e5?5:T>=1e4?4:T>=1e3?3:T>=100?2:T>=10?1:0},z.popCount=function(T){return 16843009*((T=(858993459&(T-=T>>>1&1431655765))+(T>>>2&858993459))+(T>>>4)&252645135)>>>24},z.countTrailingZeros=X,z.nextPow2=function(T){return T+=0===T,--T,T|=T>>>1,T|=T>>>2,T|=T>>>4,T|=T>>>8,(T|=T>>>16)+1},z.prevPow2=function(T){return T|=T>>>1,T|=T>>>2,T|=T>>>4,T|=T>>>8,(T|=T>>>16)-(T>>>1)},z.parity=function(T){return T^=T>>>16,T^=T>>>8,T^=T>>>4,27030>>>(T&=15)&1};var b=new Array(256);!function(T){for(var z=0;z<256;++z){var X=z,b=z,F=7;for(X>>>=1;X;X>>>=1)b<<=1,b|=1&X,--F;T[z]=b<<F&255}}(b),z.reverse=function(T){return b[255&T]<<24|b[T>>>8&255]<<16|b[T>>>16&255]<<8|b[T>>>24&255]},z.interleave2=function(T,z){return(T=1431655765&((T=858993459&((T=252645135&((T=16711935&((T&=65535)|T<<8))|T<<4))|T<<2))|T<<1))|(z=1431655765&((z=858993459&((z=252645135&((z=16711935&((z&=65535)|z<<8))|z<<4))|z<<2))|z<<1))<<1},z.deinterleave2=function(T,z){return(T=65535&((T=16711935&((T=252645135&((T=858993459&((T=T>>>z&1431655765)|T>>>1))|T>>>2))|T>>>4))|T>>>16))<<16>>16},z.interleave3=function(T,z,X){return T=1227133513&((T=3272356035&((T=251719695&((T=4278190335&((T&=1023)|T<<16))|T<<8))|T<<4))|T<<2),(T|=(z=1227133513&((z=3272356035&((z=251719695&((z=4278190335&((z&=1023)|z<<16))|z<<8))|z<<4))|z<<2))<<1)|(X=1227133513&((X=3272356035&((X=251719695&((X=4278190335&((X&=1023)|X<<16))|X<<8))|X<<4))|X<<2))<<2},z.deinterleave3=function(T,z){return(T=1023&((T=4278190335&((T=251719695&((T=3272356035&((T=T>>>z&1227133513)|T>>>2))|T>>>4))|T>>>8))|T>>>16))<<22>>22},z.nextCombination=function(T){var z=T|T-1;return z+1|(~z&-~z)-1>>>X(T)+1}},12656:(T,z,X)=>{"use strict";T.exports=function(T,z,X){switch(arguments.length){case 1:return b=[],v(F=T,F,k,!0),b;case 2:return"function"===typeof z?v(T,T,z,!0):function(T,z){return b=[],v(T,z,k,!1),b}(T,z);case 3:return v(T,z,X,!1);default:throw new Error("box-intersect: Invalid arguments")}var F};var b,F=X(12662),A=X(12687),u=X(12704);function y(T,z){for(var X=0;X<T;++X)if(!(z[X]<=z[X+T]))return!0;return!1}function E(T,z,X,b){for(var F=0,A=0,u=0,E=T.length;u<E;++u){var v=T[u];if(!y(z,v)){for(var k=0;k<2*z;++k)X[F++]=v[k];b[A++]=u}}return A}function v(T,z,X,b){var y=T.length,v=z.length;if(!(y<=0||v<=0)){var k=T[0].length>>>1;if(!(k<=0)){var L,D=F.mallocDouble(2*k*y),c=F.mallocInt32(y);if((y=E(T,k,D,c))>0){if(1===k&&b)A.init(y),L=A.sweepComplete(k,X,0,y,D,c,0,y,D,c);else{var p=F.mallocDouble(2*k*v),H=F.mallocInt32(v);(v=E(z,k,p,H))>0&&(A.init(y+v),L=1===k?A.sweepBipartite(k,X,0,y,D,c,0,v,p,H):u(k,X,b,y,D,c,v,p,H),F.free(p),F.free(H))}F.free(D),F.free(c)}return L}}}function k(T,z){b.push([T,z])}},12708:(T,z)=>{"use strict";var X="d",b="ax",F="fp",A="es",u="rs",y="re",E="rb",v="bs",k="be",L="bb",D=[X,b,"vv",u,y,E,"ri",v,k,L,"bi"];function c(T){var z="bruteForce"+(T?"Full":"Partial"),b=[],u=D.slice();T||u.splice(3,0,F);var y=["function "+z+"("+u.join()+"){"];function E(z,F){var u=function(T,z,b){var F="bruteForce"+(T?"Red":"Blue")+(z?"Flip":"")+(b?"Full":""),u=["function ",F,"(",D.join(),"){","var ",A,"=2*",X,";"],y="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",E="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(b?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return T?u.push(y,"Q",":",E):u.push(E,"Q",":",y),b?u.push("if(y1<x0||x1<y0)continue;"):z?u.push("if(y0<=x0||x1<y0)continue;"):u.push("if(y0<x0||x1<y0)continue;"),u.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),z?u.push("yi,xi"):u.push("xi,yi"),u.push(");if(rv!==void 0)return rv;}}}"),{name:F,code:u.join("")}}(z,F,T);b.push(u.code),y.push("return "+u.name+"("+D.join()+");")}y.push("if(re-rs>be-bs){"),T?(E(!0,!1),y.push("}else{"),E(!1,!1)):(y.push("if(fp){"),E(!0,!0),y.push("}else{"),E(!0,!1),y.push("}}else{if(fp){"),E(!1,!0),y.push("}else{"),E(!1,!1),y.push("}")),y.push("}}return "+z);var v=b.join("")+y.join("");return new Function(v)()}z.partial=c(!1),z.full=c(!0)},12704:(T,z,X)=>{"use strict";T.exports=function(T,z,X,A,k,G,j,Z,m){!function(T,z){var X=8*F.log2(z+1)*(T+1)|0,A=F.nextPow2(d*X);l.length<A&&(b.free(l),l=b.mallocInt32(A));var u=F.nextPow2(N*X);a.length<u&&(b.free(a),a=b.mallocDouble(u))}(T,A+j);var S,n=0,O=2*T;q(n++,0,0,A,0,j,X?16:0,-1/0,1/0),X||q(n++,0,0,j,0,A,1,-1/0,1/0);for(;n>0;){var P=(n-=1)*d,W=l[P],B=l[P+1],e=l[P+2],R=l[P+3],Y=l[P+4],i=l[P+5],t=n*N,g=a[t],M=a[t+1],r=1&i,o=!!(16&i),f=k,h=G,Q=Z,w=m;if(r&&(f=Z,h=m,Q=k,w=G),!(2&i&&B>=(e=U(T,W,B,e,f,h,M)))&&!(4&i&&(B=s(T,W,B,e,f,h,g))>=e)){var J=e-B,I=Y-R;if(o){if(T*J*(J+I)<c){if(void 0!==(S=E.scanComplete(T,W,z,B,e,f,h,R,Y,Q,w)))return S;continue}}else{if(T*Math.min(J,I)<L){if(void 0!==(S=u(T,W,z,r,B,e,f,h,R,Y,Q,w)))return S;continue}if(T*J*I<D){if(void 0!==(S=E.scanBipartite(T,W,z,r,B,e,f,h,R,Y,Q,w)))return S;continue}}var TT=p(T,W,B,e,f,h,g,M);if(B<TT)if(T*(TT-B)<L){if(void 0!==(S=y(T,W+1,z,B,TT,f,h,R,Y,Q,w)))return S}else if(W===T-2){if(void 0!==(S=r?E.sweepBipartite(T,z,R,Y,Q,w,B,TT,f,h):E.sweepBipartite(T,z,B,TT,f,h,R,Y,Q,w)))return S}else q(n++,W+1,B,TT,R,Y,r,-1/0,1/0),q(n++,W+1,R,Y,B,TT,1^r,-1/0,1/0);if(TT<e){var zT=v(T,W,R,Y,Q,w),XT=Q[O*zT+W],bT=H(T,W,zT,Y,Q,w,XT);if(bT<Y&&q(n++,W,TT,e,bT,Y,(4|r)+(o?16:0),XT,M),R<zT&&q(n++,W,TT,e,R,zT,(2|r)+(o?16:0),g,XT),zT+1===bT){if(void 0!==(S=o?C(T,W,z,TT,e,f,h,zT,Q,w[zT]):V(T,W,z,r,TT,e,f,h,zT,Q,w[zT])))return S}else if(zT<bT){var FT;if(o){if(TT<(FT=x(T,W,TT,e,f,h,XT))){var AT=H(T,W,TT,FT,f,h,XT);if(W===T-2){if(TT<AT&&void 0!==(S=E.sweepComplete(T,z,TT,AT,f,h,zT,bT,Q,w)))return S;if(AT<FT&&void 0!==(S=E.sweepBipartite(T,z,AT,FT,f,h,zT,bT,Q,w)))return S}else TT<AT&&q(n++,W+1,TT,AT,zT,bT,16,-1/0,1/0),AT<FT&&(q(n++,W+1,AT,FT,zT,bT,0,-1/0,1/0),q(n++,W+1,zT,bT,AT,FT,1,-1/0,1/0))}}else TT<(FT=r?K(T,W,TT,e,f,h,XT):x(T,W,TT,e,f,h,XT))&&(W===T-2?S=r?E.sweepBipartite(T,z,zT,bT,Q,w,TT,FT,f,h):E.sweepBipartite(T,z,TT,FT,f,h,zT,bT,Q,w):(q(n++,W+1,TT,FT,zT,bT,r,-1/0,1/0),q(n++,W+1,zT,bT,TT,FT,1^r,-1/0,1/0)))}}}}};var b=X(12662),F=X(12668),A=X(12708),u=A.partial,y=A.full,E=X(12687),v=X(12713),k=X(12722),L=128,D=1<<22,c=1<<22,p=k("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),H=k("lo===p0",["p0"]),U=k("lo<p0",["p0"]),s=k("hi<=p0",["p0"]),x=k("lo<=p0&&p0<=hi",["p0"]),K=k("lo<p0&&p0<=hi",["p0"]),d=6,N=2,l=b.mallocInt32(1024),a=b.mallocDouble(1024);function q(T,z,X,b,F,A,u,y,E){var v=d*T;l[v]=z,l[v+1]=X,l[v+2]=b,l[v+3]=F,l[v+4]=A,l[v+5]=u;var k=N*T;a[k]=y,a[k+1]=E}function V(T,z,X,b,F,A,u,y,E,v,k){var L=2*T,D=E*L,c=v[D+z];T:for(var p=F,H=F*L;p<A;++p,H+=L){var U=u[H+z],s=u[H+z+T];if(!(c<U||s<c)&&(!b||c!==U)){for(var x,K=y[p],d=z+1;d<T;++d){U=u[H+d],s=u[H+d+T];var N=v[D+d],l=v[D+d+T];if(s<N||l<U)continue T}if(void 0!==(x=b?X(k,K):X(K,k)))return x}}}function C(T,z,X,b,F,A,u,y,E,v){var k=2*T,L=y*k,D=E[L+z];T:for(var c=b,p=b*k;c<F;++c,p+=k){var H=u[c];if(H!==v){var U=A[p+z],s=A[p+z+T];if(!(D<U||s<D)){for(var x=z+1;x<T;++x){U=A[p+x],s=A[p+x+T];var K=E[L+x],d=E[L+x+T];if(s<K||d<U)continue T}var N=X(H,v);if(void 0!==N)return N}}}}},12713:(T,z,X)=>{"use strict";T.exports=function(T,z,X,u,y,E){if(u<=X+1)return X;var v=X,k=u,L=u+X>>>1,D=2*T,c=L,p=y[D*L+z];for(;v<k;){if(k-v<F){A(T,z,v,k,y,E),p=y[D*L+z];break}var H=k-v,U=Math.random()*H+v|0,s=y[D*U+z],x=Math.random()*H+v|0,K=y[D*x+z],d=Math.random()*H+v|0,N=y[D*d+z];s<=K?N>=K?(c=x,p=K):s>=N?(c=U,p=s):(c=d,p=N):K>=N?(c=x,p=K):N>=s?(c=U,p=s):(c=d,p=N);for(var l=D*(k-1),a=D*c,q=0;q<D;++q,++l,++a){var V=y[l];y[l]=y[a],y[a]=V}var C=E[k-1];E[k-1]=E[c],E[c]=C;for(l=D*(k-1),a=D*(c=b(T,z,v,k-1,y,E,p)),q=0;q<D;++q,++l,++a){V=y[l];y[l]=y[a],y[a]=V}C=E[k-1];if(E[k-1]=E[c],E[c]=C,L<c){for(k=c-1;v<k&&y[D*(k-1)+z]===p;)k-=1;k+=1}else{if(!(c<L))break;for(v=c+1;v<k&&y[D*v+z]===p;)v+=1}}return b(T,z,X,L,y,E,y[D*L+z])};var b=X(12722)("lo<p0",["p0"]),F=8;function A(T,z,X,b,F,A){for(var u=2*T,y=u*(X+1)+z,E=X+1;E<b;++E,y+=u)for(var v=F[y],k=E,L=u*(E-1);k>X&&F[L+z]>v;--k,L-=u){for(var D=L,c=L+u,p=0;p<u;++p,++D,++c){var H=F[D];F[D]=F[c],F[c]=H}var U=A[k];A[k]=A[k-1],A[k-1]=U}}},12722:T=>{"use strict";T.exports=function(T,X){var b="abcdef".split("").concat(X),F=[];T.indexOf("lo")>=0&&F.push("lo=e[k+n]");T.indexOf("hi")>=0&&F.push("hi=e[k+o]");return b.push(z.replace("_",F.join()).replace("$",T)),Function.apply(void 0,b)};var z="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12695:T=>{"use strict";T.exports=function(T,b){b<=4*z?X(0,b-1,T):v(0,b-1,T)};var z=32;function X(T,z,X){for(var b=2*(T+1),F=T+1;F<=z;++F){for(var A=X[b++],u=X[b++],y=F,E=b-2;y-- >T;){var v=X[E-2],k=X[E-1];if(v<A)break;if(v===A&&k<u)break;X[E]=v,X[E+1]=k,E-=2}X[E]=A,X[E+1]=u}}function b(T,z,X){z*=2;var b=X[T*=2],F=X[T+1];X[T]=X[z],X[T+1]=X[z+1],X[z]=b,X[z+1]=F}function F(T,z,X){z*=2,X[T*=2]=X[z],X[T+1]=X[z+1]}function A(T,z,X,b){z*=2,X*=2;var F=b[T*=2],A=b[T+1];b[T]=b[z],b[T+1]=b[z+1],b[z]=b[X],b[z+1]=b[X+1],b[X]=F,b[X+1]=A}function u(T,z,X,b,F){z*=2,F[T*=2]=F[z],F[z]=X,F[T+1]=F[z+1],F[z+1]=b}function y(T,z,X){z*=2;var b=X[T*=2],F=X[z];return!(b<F)&&(b!==F||X[T+1]>X[z+1])}function E(T,z,X,b){var F=b[T*=2];return F<z||F===z&&b[T+1]<X}function v(T,k,L){var D=(k-T+1)/6|0,c=T+D,p=k-D,H=T+k>>1,U=H-D,s=H+D,x=c,K=U,d=H,N=s,l=p,a=T+1,q=k-1,V=0;y(x,K,L)&&(V=x,x=K,K=V),y(N,l,L)&&(V=N,N=l,l=V),y(x,d,L)&&(V=x,x=d,d=V),y(K,d,L)&&(V=K,K=d,d=V),y(x,N,L)&&(V=x,x=N,N=V),y(d,N,L)&&(V=d,d=N,N=V),y(K,l,L)&&(V=K,K=l,l=V),y(K,d,L)&&(V=K,K=d,d=V),y(N,l,L)&&(V=N,N=l,l=V);for(var C=L[2*K],G=L[2*K+1],j=L[2*N],Z=L[2*N+1],m=2*x,S=2*d,n=2*l,O=2*c,P=2*H,W=2*p,B=0;B<2;++B){var e=L[m+B],R=L[S+B],Y=L[n+B];L[O+B]=e,L[P+B]=R,L[W+B]=Y}F(U,T,L),F(s,k,L);for(var i=a;i<=q;++i)if(E(i,C,G,L))i!==a&&b(i,a,L),++a;else if(!E(i,j,Z,L))for(;;){if(E(q,j,Z,L)){E(q,C,G,L)?(A(i,a,q,L),++a,--q):(b(i,q,L),--q);break}if(--q<i)break}u(T,a-1,C,G,L),u(k,q+1,j,Z,L),a-2-T<=z?X(T,a-2,L):v(T,a-2,L),k-(q+2)<=z?X(q+2,k,L):v(q+2,k,L),q-a<=z?X(a,q,L):v(a,q,L)}},12687:(T,z,X)=>{"use strict";T.exports={init:function(T){var z=F.nextPow2(T);E.length<z&&(b.free(E),E=b.mallocInt32(z));v.length<z&&(b.free(v),v=b.mallocInt32(z));k.length<z&&(b.free(k),k=b.mallocInt32(z));L.length<z&&(b.free(L),L=b.mallocInt32(z));D.length<z&&(b.free(D),D=b.mallocInt32(z));c.length<z&&(b.free(c),c=b.mallocInt32(z));var X=8*z;p.length<X&&(b.free(p),p=b.mallocDouble(X))},sweepBipartite:function(T,z,X,b,F,y,D,c,s,x){for(var K=0,d=2*T,N=T-1,l=d-1,a=X;a<b;++a){var q=y[a],V=d*a;p[K++]=F[V+N],p[K++]=-(q+1),p[K++]=F[V+l],p[K++]=q}for(a=D;a<c;++a){q=x[a]+u;var C=d*a;p[K++]=s[C+N],p[K++]=-q,p[K++]=s[C+l],p[K++]=q}var G=K>>>1;A(p,G);var j=0,Z=0;for(a=0;a<G;++a){var m=0|p[2*a+1];if(m>=u)H(k,L,Z--,m=m-u|0);else if(m>=0)H(E,v,j--,m);else if(m<=-u){m=-m-u|0;for(var S=0;S<j;++S){if(void 0!==(n=z(E[S],m)))return n}U(k,L,Z++,m)}else{m=-m-1|0;for(S=0;S<Z;++S){var n;if(void 0!==(n=z(m,k[S])))return n}U(E,v,j++,m)}}},sweepComplete:function(T,z,X,b,F,u,y,s,x,K){for(var d=0,N=2*T,l=T-1,a=N-1,q=X;q<b;++q){var V=u[q]+1<<1,C=N*q;p[d++]=F[C+l],p[d++]=-V,p[d++]=F[C+a],p[d++]=V}for(q=y;q<s;++q){V=K[q]+1<<1;var G=N*q;p[d++]=x[G+l],p[d++]=1|-V,p[d++]=x[G+a],p[d++]=1|V}var j=d>>>1;A(p,j);var Z=0,m=0,S=0;for(q=0;q<j;++q){var n=0|p[2*q+1],O=1&n;if(q<j-1&&n>>1===p[2*q+3]>>1&&(O=2,q+=1),n<0){for(var P=-(n>>1)-1,W=0;W<S;++W){if(void 0!==(B=z(D[W],P)))return B}if(0!==O)for(W=0;W<Z;++W){if(void 0!==(B=z(E[W],P)))return B}if(1!==O)for(W=0;W<m;++W){var B;if(void 0!==(B=z(k[W],P)))return B}0===O?U(E,v,Z++,P):1===O?U(k,L,m++,P):2===O&&U(D,c,S++,P)}else{P=(n>>1)-1;0===O?H(E,v,Z--,P):1===O?H(k,L,m--,P):2===O&&H(D,c,S--,P)}}},scanBipartite:function(T,z,X,b,F,y,k,L,D,c,s,x){var K=0,d=2*T,N=z,l=z+T,a=1,q=1;b?q=u:a=u;for(var V=F;V<y;++V){var C=V+a,G=d*V;p[K++]=k[G+N],p[K++]=-C,p[K++]=k[G+l],p[K++]=C}for(V=D;V<c;++V){C=V+q;var j=d*V;p[K++]=s[j+N],p[K++]=-C}var Z=K>>>1;A(p,Z);var m=0;for(V=0;V<Z;++V){var S=0|p[2*V+1];if(S<0){var n=!1;if((C=-S)>=u?(n=!b,C-=u):(n=!!b,C-=1),n)U(E,v,m++,C);else{var O=x[C],P=d*C,W=s[P+z+1],B=s[P+z+1+T];T:for(var e=0;e<m;++e){var R=E[e],Y=d*R;if(!(B<k[Y+z+1]||k[Y+z+1+T]<W)){for(var i=z+2;i<T;++i)if(s[P+i+T]<k[Y+i]||k[Y+i+T]<s[P+i])continue T;var t,g=L[R];if(void 0!==(t=b?X(O,g):X(g,O)))return t}}}}else H(E,v,m--,S-a)}},scanComplete:function(T,z,X,b,F,y,v,k,L,D,c){for(var H=0,U=2*T,s=z,x=z+T,K=b;K<F;++K){var d=K+u,N=U*K;p[H++]=y[N+s],p[H++]=-d,p[H++]=y[N+x],p[H++]=d}for(K=k;K<L;++K){d=K+1;var l=U*K;p[H++]=D[l+s],p[H++]=-d}var a=H>>>1;A(p,a);var q=0;for(K=0;K<a;++K){var V=0|p[2*K+1];if(V<0){if((d=-V)>=u)E[q++]=d-u;else{var C=c[d-=1],G=U*d,j=D[G+z+1],Z=D[G+z+1+T];T:for(var m=0;m<q;++m){var S=E[m],n=v[S];if(n===C)break;var O=U*S;if(!(Z<y[O+z+1]||y[O+z+1+T]<j)){for(var P=z+2;P<T;++P)if(D[G+P+T]<y[O+P]||y[O+P+T]<D[G+P])continue T;var W=X(n,C);if(void 0!==W)return W}}}}else{for(d=V-u,m=q-1;m>=0;--m)if(E[m]===d){for(P=m+1;P<q;++P)E[P-1]=E[P];break}--q}}}};var b=X(12662),F=X(12668),A=X(12695),u=1<<28,y=1024,E=b.mallocInt32(y),v=b.mallocInt32(y),k=b.mallocInt32(y),L=b.mallocInt32(y),D=b.mallocInt32(y),c=b.mallocInt32(y),p=b.mallocDouble(8192);function H(T,z,X,b){var F=z[b],A=T[X-1];T[F]=A,z[A]=F}function U(T,z,X,b){T[X]=b,z[b]=X}},12674:T=>{"use strict";function z(T,X,b){var F=0|T[b];if(F<=0)return[];var A,u=new Array(F);if(b===T.length-1)for(A=0;A<F;++A)u[A]=X;else for(A=0;A<F;++A)u[A]=z(T,X,b+1);return u}T.exports=function(T,X){switch("undefined"===typeof X&&(X=0),typeof T){case"number":if(T>0)return function(T,z){var X,b;for(X=new Array(T),b=0;b<T;++b)X[b]=z;return X}(0|T,X);break;case"object":if("number"===typeof T.length)return z(T,X,0)}return[]}},12627:(T,z,X)=>{T.exports=function(){var T=this;this.components={},this.comps=this.components;var z=this.components,X=1,F={},A=[],u=[],y={timeout:!1,removals:[],multiComps:[]};function E(T,X){var b=z[X],A=F[X],u=A.hash[T];u&&(A.remove(T),b.ab&&(b.multi?(u.forEach((z=>{z&&b.ab(T,z)})),u.length=0):b.ab(T,u)),y.removals.push(A),v())}function v(){y.timeout||(y.timeout=!0,setTimeout(k,1))}function k(){y.timeout=!1,L()}function L(){y.multiComps.length&&function(T){for(var z=0;z<T.length;z++){var{entID:X,data:b}=T[z],F=b.hash[X];if(F){for(var A=0;A<F.length;A++)F[A]||(F.splice(A,1),A--);0===F.length&&(b.remove(X),y.removals.push(b))}}T.length=0}(y.multiComps),y.removals.length&&function(T){for(var z=0;z<T.length;z++){T[z].flush()}T.length=0}(y.removals)}this._i=F,this._systems=A,this._renderSystems=u,this.Jh=function(z){var b=X++;return Array.isArray(z)&&z.forEach((z=>T.Ff(b,z))),b},this.deleteEntity=function(z){return Object.keys(F).forEach((T=>{F[T].hash[z]&&E(z,T)})),T},this.fi=function(T){if(!T)throw new Error("Missing component definition");var X=T.name;if(!X)throw new Error("Component definition must have a name property.");if("string"!==typeof X)throw new Error("Component name must be a string.");if(""===X)throw new Error("Component name must be a non-empty string.");if(F[X])throw new Error(`Component ${X} already exists.`);var y={};return y.name=X,y.multi=!!T.multi,y.order=isNaN(T.order)?99:T.order,y.stateConstructor=T.stateConstructor||null,y.state=T.state||{},y.Pf=T.Pf||null,y.ab=T.ab||null,y.system=T.system||null,y.ah=T.ah||null,z[X]=y,F[X]=new b,F[X]._pendingMultiCleanup=!1,F[X]._multiCleanupIDs=y.multi?[]:null,y.system&&(A.push(X),A.sort(((T,X)=>z[T].order-z[X].order))),y.ah&&(u.push(X),u.sort(((T,X)=>z[T].order-z[X].order))),X},this.overwriteComponent=function(T,X){var b=z[T];if(!b)throw new Error(`Unknown component: ${T}`);if(!X)throw new Error("Missing component definition");if(b.name!==X.name)throw new Error("Overwriting component must use the same name property.");var y={};y.name=T,y.multi=!!X.multi,y.order=isNaN(X.order)?99:X.order,y.state=X.state||{},y.Pf=X.Pf||null,y.ab=X.ab||null,y.system=X.system||null,y.ah=X.ah||null,z[T]=y,F[T]._pendingMultiCleanup=!1,F[T]._multiCleanupIDs=y.multi?[]:null;var E=A.indexOf(T);y.system&&E<0&&A.push(T),!y.system&&E>=0&&A.splice(E,1),A.sort(((T,X)=>z[T].order-z[X].order));var v=u.indexOf(T);y.ah&&v<0&&u.push(T),!y.ah&&v>=0&&u.splice(v,1),u.sort(((T,X)=>z[T].order-z[X].order));var k=y.state;return this.gh(T).forEach((T=>{for(var z in k)z in T||(T[z]=k[z]);y.Pf&&y.Pf(T._g,T)})),T},this.deleteComponent=function(X){var b=F[X];if(!b)throw new Error(`Unknown component: ${X}`);b.flush(),b.list.forEach((T=>{T&&E(T._g||T[0]._g,X)}));var y=A.indexOf(X),v=u.indexOf(X);return y>-1&&A.splice(y,1),v>-1&&u.splice(v,1),F[X].dispose(),delete F[X],delete z[X],T},this.Ff=function(T,X,b){var A,u=z[X],y=F[X];if(!y)throw new Error(`Unknown component: ${X}.`);if(y.hash[T]&&!u.multi)throw new Error(`Entity ${T} already has component: ${X}.`);if(u.stateConstructor){if(!(A=new u.stateConstructor).hasOwnProperty("_g"))throw new Error(`Component ${u.name} stateConstructor type does not have property __id`)}else A=Object.assign({},{_g:T},u.state,b);if(A._g=T,u.multi){var E=y.hash[T];E||(E=[],y.add(T,E)),E.push(A)}else y.add(T,A);return u.Pf&&u.Pf(T,A),this},this.Tf=function(T,z){var X=F[z];if(!X)throw new Error(`Unknown component: ${z}.`);return!!X.hash[T]},this.Kf=function(z,X){if(!F[X])throw new Error(`Unknown component: ${X}.`);return E(z,X),T},this.getState=function(T,z){var X=F[z];if(!X)throw new Error(`Unknown component: ${z}.`);return X.hash[T]},this.gh=function(T){var z=F[T];if(!z)throw new Error(`Unknown component: ${T}.`);return L(),z.list},this.Jk=function(T){if(!F[T])throw new Error(`Unknown component: ${T}.`);var z=F[T].hash;return T=>z[T]},this.Mk=function(T){if(!F[T])throw new Error(`Unknown component: ${T}.`);var z=F[T].hash;return T=>!!z[T]},this.yf=function(X){L();for(var b=0;b<A.length;b++){var u=A[b],y=z[u],E=F[u];y.system(X,E.list),L()}return T},this.render=function(X){L();for(var b=0;b<u.length;b++){var A=u[b],y=z[A],E=F[A];y.ah(X,E.list),L()}return T},this.removeMultiComponent=function(X,b,A){var u=z[b],E=F[b];if(!E)throw new Error(`Unknown component: ${b}.`);if(!u.multi)throw new Error("removeMultiComponent called on non-multi component");return function(T,z,X,b){var F=X.hash[T];if(F){var A=F[b];A&&(F[b]=null,z.ab&&z.ab(T,A),y.multiComps.push({entID:T,data:X}),v())}}(X,u,E,A),T}};var b=X(12634)},12634:T=>{function z(T,z){var X=T._map[z];if(delete T.hash[z],delete T._map[z],X===T.list.length-1)T.list.pop();else{var b=T.list.pop();if(T.list[X]=b,null===b||null===b[0]){var F=T.list.length;for(var A in T._map)if(T._map[A]===F)return void(T._map[A]=X)}else{var u=b._g||b[0]._g;T._map[u]=X}}}T.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(T,z){if("number"===typeof this._map[T]){var X=this._map[T];this.hash[T]=z,this.list[X]=z}else this._map[T]=this.list.length,this.hash[T]=z,this.list.push(z)}remove(T){var z=this._map[T];this.hash[T]=null,this.list[z]=null,this._pendingRemovals.push(T)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var T=0;T<this._pendingRemovals.length;T++){var X=this._pendingRemovals[T];null===this.hash[X]&&z(this,X)}this._pendingRemovals.length=0}}},12593:T=>{"use strict";var z,X="object"===typeof Reflect?Reflect:null,b=function(T,z,X){return Function.prototype.apply.call(T,z,X)};z=X&&"function"===typeof X.ownKeys?X.ownKeys:Object.getOwnPropertySymbols?function(T){return Object.getOwnPropertyNames(T).concat(Object.getOwnPropertySymbols(T))}:function(T){return Object.getOwnPropertyNames(T)};var F=Number.isNaN||function(T){return T!==T};function A(){A.init.call(this)}T.exports=A,T.exports.once=function(T,z){return new Promise((function(X,b){function F(X){T.removeListener(z,A),b(X)}function A(){"function"===typeof T.removeListener&&T.removeListener("error",F),X([].slice.call(arguments))}H(T,z,A,{once:!0}),"error"!==z&&function(T,z,X){"function"===typeof T.on&&H(T,"error",z,X)}(T,F,{once:!0})}))},A.EventEmitter=A,A.prototype._events=void 0,A.prototype._eventsCount=0,A.prototype._maxListeners=void 0;var u=10;function y(T){if("function"!==typeof T)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof T)}function E(T){return void 0===T._maxListeners?A.defaultMaxListeners:T._maxListeners}function v(T,z,X,b){var F,A,u,v;if(y(X),void 0===(A=T._events)?(A=T._events=Object.create(null),T._eventsCount=0):(void 0!==A.newListener&&(T.emit("newListener",z,X.listener?X.listener:X),A=T._events),u=A[z]),void 0===u)u=A[z]=X,++T._eventsCount;else if("function"===typeof u?u=A[z]=b?[X,u]:[u,X]:b?u.unshift(X):u.push(X),(F=E(T))>0&&u.length>F&&!u.warned){u.warned=!0;var k=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(z)+" listeners added. Use emitter.setMaxListeners() to increase limit");k.name="MaxListenersExceededWarning",k.k=T,k.type=z,k.count=u.length,v=k,console&&console.warn&&console.warn(v)}return T}function k(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function L(T,z,X){var b={fired:!1,wrapFn:void 0,target:T,type:z,listener:X},F=k.bind(b);return F.listener=X,b.wrapFn=F,F}function D(T,z,X){var b=T._events;if(void 0===b)return[];var F=b[z];return void 0===F?[]:"function"===typeof F?X?[F.listener||F]:[F]:X?function(T){for(var z=new Array(T.length),X=0;X<z.length;++X)z[X]=T[X].listener||T[X];return z}(F):p(F,F.length)}function c(T){var z=this._events;if(void 0!==z){var X=z[T];if("function"===typeof X)return 1;if(void 0!==X)return X.length}return 0}function p(T,z){for(var X=new Array(z),b=0;b<z;++b)X[b]=T[b];return X}function H(T,z,X,b){if("function"===typeof T.on)b.once?T.once(z,X):T.on(z,X);else{if("function"!==typeof T.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof T);T.addEventListener(z,(function F(A){b.once&&T.removeEventListener(z,F),X(A)}))}}Object.defineProperty(A,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(T){if("number"!==typeof T||T<0||F(T))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+T+".");u=T}}),A.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},A.prototype.setMaxListeners=function(T){if("number"!==typeof T||T<0||F(T))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+T+".");return this._maxListeners=T,this},A.prototype.getMaxListeners=function(){return E(this)},A.prototype.emit=function(T){for(var z=[],X=1;X<arguments.length;X++)z.push(arguments[X]);var F="error"===T,A=this._events;if(void 0!==A)F=F&&void 0===A.error;else if(!F)return!1;if(F){var u;if(z.length>0&&(u=z[0]),u instanceof Error)throw u;var y=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw y.context=u,y}var E=A[T];if(void 0===E)return!1;if("function"===typeof E)b(E,this,z);else{var v=E.length,k=p(E,v);for(X=0;X<v;++X)b(k[X],this,z)}return!0},A.prototype.addListener=function(T,z){return v(this,T,z,!1)},A.prototype.on=A.prototype.addListener,A.prototype.prependListener=function(T,z){return v(this,T,z,!0)},A.prototype.once=function(T,z){return y(z),this.on(T,L(this,T,z)),this},A.prototype.prependOnceListener=function(T,z){return y(z),this.prependListener(T,L(this,T,z)),this},A.prototype.removeListener=function(T,z){var X,b,F,A,u;if(y(z),void 0===(b=this._events))return this;if(void 0===(X=b[T]))return this;if(X===z||X.listener===z)0===--this._eventsCount?this._events=Object.create(null):(delete b[T],b.removeListener&&this.emit("removeListener",T,X.listener||z));else if("function"!==typeof X){for(F=-1,A=X.length-1;A>=0;A--)if(X[A]===z||X[A].listener===z){u=X[A].listener,F=A;break}if(F<0)return this;0===F?X.shift():function(T,z){for(;z+1<T.length;z++)T[z]=T[z+1];T.pop()}(X,F),1===X.length&&(b[T]=X[0]),void 0!==b.removeListener&&this.emit("removeListener",T,u||z)}return this},A.prototype.off=A.prototype.removeListener,A.prototype.removeAllListeners=function(T){var z,X,b;if(void 0===(X=this._events))return this;if(void 0===X.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==X[T]&&(0===--this._eventsCount?this._events=Object.create(null):delete X[T]),this;if(0===arguments.length){var F,A=Object.keys(X);for(b=0;b<A.length;++b)"removeListener"!==(F=A[b])&&this.removeAllListeners(F);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(z=X[T]))this.removeListener(T,z);else if(void 0!==z)for(b=z.length-1;b>=0;b--)this.removeListener(T,z[b]);return this},A.prototype.listeners=function(T){return D(this,T,!0)},A.prototype.rawListeners=function(T){return D(this,T,!1)},A.listenerCount=function(T,z){return"function"===typeof T.listenerCount?T.listenerCount(z):c.call(T,z)},A.prototype.listenerCount=c,A.prototype.eventNames=function(){return this._eventsCount>0?z(this._events):[]}},12914:T=>{"use strict";T.exports=function(T,z,X,b,F,A){var u=+z[0],y=+z[1],E=+z[2],v=+X[0],k=+X[1],L=+X[2],D=Math.sqrt(v*v+k*k+L*L);if(0===D)throw new Error("Can't raycast along a zero vector");return function(T,z,X,b,F,A,u,y,E,v){for(var k=0,L=Math.floor,D=0|L(z),c=0|L(X),p=0|L(b),H=F>0?1:-1,U=A>0?1:-1,s=u>0?1:-1,x=Math.abs(1/F),K=Math.abs(1/A),d=Math.abs(1/u),N=x<1/0?x*(H>0?D+1-z:z-D):1/0,l=K<1/0?K*(U>0?c+1-X:X-c):1/0,a=d<1/0?d*(s>0?p+1-b:b-p):1/0,q=-1;k<=y;){var V=T(D,c,p);if(V)return E&&(E[0]=z+k*F,E[1]=X+k*A,E[2]=b+k*u),v&&(v[0]=v[1]=v[2]=0,0===q&&(v[0]=-H),1===q&&(v[1]=-U),2===q&&(v[2]=-s)),V;N<l?N<a?(D+=H,k=N,N+=x,q=0):(p+=s,k=a,a+=d,q=2):l<a?(c+=U,k=l,l+=K,q=1):(p+=s,k=a,a+=d,q=2)}return E&&(E[0]=z+k*F,E[1]=X+k*A,E[2]=b+k*u),v&&(v[0]=v[1]=v[2]=0),0}(T,u,y,E,v/=D,k/=D,L/=D,b="undefined"===typeof b?64:+b,F,A)}},12941:(T,z,X)=>{"use strict";X.d(z,{d:()=>A});var b=X(12593);function F(){this.Jj=!1,this.stopPropagation=!1,this.Kj=!1,this.disabled=!1}class A{constructor(T,z){this.version="0.7.0";var X=Object.assign({},new F,z||{});this.element=T||document,this.Jj=!!X.Jj,this.stopPropagation=!!X.stopPropagation,this.Kj=!!X.Kj,this.disabled=!!X.disabled,this.filterEvents=(T,z)=>!0,this.down=new b.EventEmitter,this.up=new b.EventEmitter,this.state={},this.Sg={dx:0,dy:0,Ak:0,Rg:0,Bk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?y(this):document.addEventListener("DOMContentLoaded",(T=>{y(this)}),{once:!0})}bind(T){for(var z=arguments.length,X=new Array(z>1?z-1:0),b=1;b<z;b++)X[b-1]=arguments[b];X.forEach((z=>{var X=this._keyBindmap[z]||[];X.includes(T)||(X.push(T),this._keyBindmap[z]=X)})),this.state[T]=!!this.state[T],this.pressCount[T]=this.pressCount[T]||0,this.releaseCount[T]=this.releaseCount[T]||0}unbind(T){for(var z in this._keyBindmap){var X=this._keyBindmap[z],b=X.indexOf(T);b>-1&&X.splice(b,1)}}getBindings(){var T={};for(var z in this._keyBindmap){this._keyBindmap[z].forEach((X=>{T[X]=T[X]||[],T[X].push(z)}))}return T}yf(){u(this.Sg),u(this.pressCount),u(this.releaseCount)}}function u(T){for(var z in T)T[z]=0}function y(T){window.addEventListener("keydown",p.bind(null,T,!0),!1),window.addEventListener("keyup",p.bind(null,T,!1),!1);var z={passive:!0};T.element.addEventListener("touchstart",L.bind(void 0,T),{passive:!1}),T.element.addEventListener("touchend",c.bind(void 0,T),z),T.element.addEventListener("mousedown",H.bind(null,T,!0),z),window.document.addEventListener("mouseup",H.bind(null,T,!1),z),T.element.addEventListener("touchmove",U.bind(null,T),z),T.element.addEventListener("mousemove",U.bind(null,T),z),window.PointerEvent,T.element.addEventListener("wheel",s.bind(null,T),z),T.element.addEventListener("contextmenu",x.bind(null,T),!1),window.addEventListener("blur",K.bind(null,T),!1)}var E=0,v=0,k=null;function L(T,z){z.preventDefault(),D(z)}function D(T){let z=!1;for(let X=0;X<T.touches.length;++X)if(T.touches[X].identifier===k){z=!0;break}if(!z){const z=T.changedTouches[0];E=z.clientX,v=z.clientY,k=z.identifier}}function c(T,z){for(var X=z.changedTouches,b=0;b<X.length;++b)X[b].identifier===k&&(k=null)}function p(T,z,X){d(X.code,z,T,X)}function H(T,z,X){if("pointerId"in X)if(z){if(null!==T._touches.currID)return;T._touches.currID=X.pointerId}else{if(T._touches.currID!==X.pointerId)return;T._touches.currID=null}return d("Mouse"+("button"in X?X.button+1:1),z,T,X),!1}function U(T,z){var X=z.movementX||z.mozMovementX||0,b=z.movementY||z.mozMovementY||0;if(z.touches&&0===(X|b)){var F=function(T){D(T);for(let z=0;z<T.changedTouches.length;++z)if(T.changedTouches[z].identifier==k){const X=T.changedTouches[z],b=[X.clientX-E,X.clientY-v];return E=X.clientX,v=X.clientY,b}return console.error(`Did not find touch id ${k}`),[0,0]}(z);X=F[0],b=F[1]}T.Sg.dx+=X,T.Sg.dy+=b}function s(T,z){var X=1;switch(z.deltaMode){case 0:X=1;break;case 1:X=12;break;case 2:X=T.element.clientHeight||window.innerHeight}T.Sg.Ak+=(z.deltaX||0)*X,T.Sg.Rg+=(z.deltaY||0)*X,T.Sg.Bk+=(z.deltaZ||0)*X}function x(T,z){if(!T.Kj)return z.preventDefault(),!1}function K(T){for(var z in T._keyStates)T._keyStates[z]&&(/^Mouse\d/.test(z)||d(z,!1,T,{code:z,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function d(T,z,X,b){var F=X._keyBindmap[T];F&&(N(X._keyStates[T],z)&&(X._keyStates[T]=z,F.forEach((T=>{(!X.filterEvents||X.filterEvents(b,T))&&function(T,z,X,b){var F=z?X.pressCount:X.releaseCount;F[T]=(F[T]||0)+1;var A=X._bindPressCount[T]||0;(A+=z?1:-1)<0&&(A=0);X._bindPressCount[T]=A;var u=X.state[T];if(N(u,A)){X.state[T]=A>0;var y=z?X.down:X.up;X.disabled||y.emit(T,b)}}(T,z,X,b)}))),"button"in b||(X.Jj&&!b.defaultPrevented&&b.preventDefault(),X.stopPropagation&&b.stopPropagation()))}function N(T,z){return T?!z:z}},12302:T=>{T.exports=function(T,z,X){return T[0]=z[0]+X[0],T[1]=z[1]+X[1],T[2]=z[2]+X[2],T}},12268:(T,z,X)=>{T.exports=function(T,z){var X=b(T[0],T[1],T[2]),u=b(z[0],z[1],z[2]);F(X,X),F(u,u);var y=A(X,u);return y>1?0:Math.acos(y)};var b=X(12271),F=X(12273),A=X(12277)},12345:T=>{T.exports=function(T,z){return T[0]=Math.ceil(z[0]),T[1]=Math.ceil(z[1]),T[2]=Math.ceil(z[2]),T}},12260:T=>{T.exports=function(T){var z=new Float32Array(3);return z[0]=T[0],z[1]=T[1],z[2]=T[2],z}},12280:T=>{T.exports=function(T,z){return T[0]=z[0],T[1]=z[1],T[2]=z[2],T}},12256:T=>{T.exports=function(){var T=new Float32Array(3);return T[0]=0,T[1]=0,T[2]=0,T}},12424:T=>{T.exports=function(T,z,X){var b=z[0],F=z[1],A=z[2],u=X[0],y=X[1],E=X[2];return T[0]=F*E-A*y,T[1]=A*u-b*E,T[2]=b*y-F*u,T}},12372:(T,z,X)=>{T.exports=X(12364)},12364:T=>{T.exports=function(T,z){var X=z[0]-T[0],b=z[1]-T[1],F=z[2]-T[2];return Math.sqrt(X*X+b*b+F*F)}},12327:(T,z,X)=>{T.exports=X(12325)},12325:T=>{T.exports=function(T,z,X){return T[0]=z[0]/X[0],T[1]=z[1]/X[1],T[2]=z[2]/X[2],T}},12277:T=>{T.exports=function(T,z){return T[0]*z[0]+T[1]*z[1]+T[2]*z[2]}},12253:T=>{T.exports=1e-6},12292:(T,z,X)=>{T.exports=function(T,z){var X=T[0],F=T[1],A=T[2],u=z[0],y=z[1],E=z[2];return Math.abs(X-u)<=b*Math.max(1,Math.abs(X),Math.abs(u))&&Math.abs(F-y)<=b*Math.max(1,Math.abs(F),Math.abs(y))&&Math.abs(A-E)<=b*Math.max(1,Math.abs(A),Math.abs(E))};var b=X(12253)},12298:T=>{T.exports=function(T,z){return T[0]===z[0]&&T[1]===z[1]&&T[2]===z[2]}},12339:T=>{T.exports=function(T,z){return T[0]=Math.floor(z[0]),T[1]=Math.floor(z[1]),T[2]=Math.floor(z[2]),T}},12466:(T,z,X)=>{T.exports=function(T,z,X,F,A,u){var y,E;z||(z=3);X||(X=0);E=F?Math.min(F*z+X,T.length):T.length;for(y=X;y<E;y+=z)b[0]=T[y],b[1]=T[y+1],b[2]=T[y+2],A(b,b,u),T[y]=b[0],T[y+1]=b[1],T[y+2]=b[2];return T};var b=X(12256)()},12271:T=>{T.exports=function(T,z,X){var b=new Float32Array(3);return b[0]=T,b[1]=z,b[2]=X,b}},12244:(T,z,X)=>{T.exports={EPSILON:X(12253),create:X(12256),clone:X(12260),angle:X(12268),Jc:X(12271),j:X(12280),set:X(12284),equals:X(12292),exactEquals:X(12298),add:X(12302),Mc:X(12310),sub:X(12312),multiply:X(12318),mul:X(12323),divide:X(12325),div:X(12327),min:X(12330),max:X(12336),floor:X(12339),ceil:X(12345),round:X(12347),scale:X(12355),Oc:X(12358),distance:X(12364),dist:X(12372),Qc:X(12379),sqrDist:X(12383),length:X(12392),len:X(12397),squaredLength:X(12403),Rc:X(12408),negate:X(12410),inverse:X(12416),normalize:X(12273),dot:X(12277),cross:X(12424),Sc:X(12426),random:X(12429),transformMat4:X(12432),transformMat3:X(12437),transformQuat:X(12446),Vc:X(12451),Wc:X(12458),Zc:X(12461),forEach:X(12466)}},12416:T=>{T.exports=function(T,z){return T[0]=1/z[0],T[1]=1/z[1],T[2]=1/z[2],T}},12397:(T,z,X)=>{T.exports=X(12392)},12392:T=>{T.exports=function(T){var z=T[0],X=T[1],b=T[2];return Math.sqrt(z*z+X*X+b*b)}},12426:T=>{T.exports=function(T,z,X,b){var F=z[0],A=z[1],u=z[2];return T[0]=F+b*(X[0]-F),T[1]=A+b*(X[1]-A),T[2]=u+b*(X[2]-u),T}},12336:T=>{T.exports=function(T,z,X){return T[0]=Math.max(z[0],X[0]),T[1]=Math.max(z[1],X[1]),T[2]=Math.max(z[2],X[2]),T}},12330:T=>{T.exports=function(T,z,X){return T[0]=Math.min(z[0],X[0]),T[1]=Math.min(z[1],X[1]),T[2]=Math.min(z[2],X[2]),T}},12323:(T,z,X)=>{T.exports=X(12318)},12318:T=>{T.exports=function(T,z,X){return T[0]=z[0]*X[0],T[1]=z[1]*X[1],T[2]=z[2]*X[2],T}},12410:T=>{T.exports=function(T,z){return T[0]=-z[0],T[1]=-z[1],T[2]=-z[2],T}},12273:T=>{T.exports=function(T,z){var X=z[0],b=z[1],F=z[2],A=X*X+b*b+F*F;A>0&&(A=1/Math.sqrt(A),T[0]=z[0]*A,T[1]=z[1]*A,T[2]=z[2]*A);return T}},12429:T=>{T.exports=function(T,z){z=z||1;var X=2*Math.random()*Math.PI,b=2*Math.random()-1,F=Math.sqrt(1-b*b)*z;return T[0]=Math.cos(X)*F,T[1]=Math.sin(X)*F,T[2]=b*z,T}},12451:T=>{T.exports=function(T,z,X,b){var F=X[1],A=X[2],u=z[1]-F,y=z[2]-A,E=Math.sin(b),v=Math.cos(b);return T[0]=z[0],T[1]=F+u*v-y*E,T[2]=A+u*E+y*v,T}},12458:T=>{T.exports=function(T,z,X,b){var F=X[0],A=X[2],u=z[0]-F,y=z[2]-A,E=Math.sin(b),v=Math.cos(b);return T[0]=F+y*E+u*v,T[1]=z[1],T[2]=A+y*v-u*E,T}},12461:T=>{T.exports=function(T,z,X,b){var F=X[0],A=X[1],u=z[0]-F,y=z[1]-A,E=Math.sin(b),v=Math.cos(b);return T[0]=F+u*v-y*E,T[1]=A+u*E+y*v,T[2]=z[2],T}},12347:T=>{T.exports=function(T,z){return T[0]=Math.round(z[0]),T[1]=Math.round(z[1]),T[2]=Math.round(z[2]),T}},12355:T=>{T.exports=function(T,z,X){return T[0]=z[0]*X,T[1]=z[1]*X,T[2]=z[2]*X,T}},12358:T=>{T.exports=function(T,z,X,b){return T[0]=z[0]+X[0]*b,T[1]=z[1]+X[1]*b,T[2]=z[2]+X[2]*b,T}},12284:T=>{T.exports=function(T,z,X,b){return T[0]=z,T[1]=X,T[2]=b,T}},12383:(T,z,X)=>{T.exports=X(12379)},12408:(T,z,X)=>{T.exports=X(12403)},12379:T=>{T.exports=function(T,z){var X=z[0]-T[0],b=z[1]-T[1],F=z[2]-T[2];return X*X+b*b+F*F}},12403:T=>{T.exports=function(T){var z=T[0],X=T[1],b=T[2];return z*z+X*X+b*b}},12312:(T,z,X)=>{T.exports=X(12310)},12310:T=>{T.exports=function(T,z,X){return T[0]=z[0]-X[0],T[1]=z[1]-X[1],T[2]=z[2]-X[2],T}},12437:T=>{T.exports=function(T,z,X){var b=z[0],F=z[1],A=z[2];return T[0]=b*X[0]+F*X[3]+A*X[6],T[1]=b*X[1]+F*X[4]+A*X[7],T[2]=b*X[2]+F*X[5]+A*X[8],T}},12432:T=>{T.exports=function(T,z,X){var b=z[0],F=z[1],A=z[2],u=X[3]*b+X[7]*F+X[11]*A+X[15];return u=u||1,T[0]=(X[0]*b+X[4]*F+X[8]*A+X[12])/u,T[1]=(X[1]*b+X[5]*F+X[9]*A+X[13])/u,T[2]=(X[2]*b+X[6]*F+X[10]*A+X[14])/u,T}},12446:T=>{T.exports=function(T,z,X){var b=z[0],F=z[1],A=z[2],u=X[0],y=X[1],E=X[2],v=X[3],k=v*b+y*A-E*F,L=v*F+E*b-u*A,D=v*A+u*F-y*b,c=-u*b-y*F-E*A;return T[0]=k*v+c*-u+L*-E-D*-y,T[1]=L*v+c*-y+D*-u-k*-E,T[2]=D*v+c*-E+k*-y-L*-u,T}},12618:T=>{"use strict";T.exports=function(T){for(var z=new Array(T),X=0;X<T;++X)z[X]=X;return z}},12682:T=>{T.exports=function(T){return null!=T&&null!=T.constructor&&"function"===typeof T.constructor.isBuffer&&T.constructor.isBuffer(T)}},12916:(T,z,X)=>{"use strict";X.d(z,{c:()=>b});class b{constructor(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Bi=!1,this.Ci=!1,this.zi=30,this.Ai=0,this.Ki=!1,this.fullscreen=!1,this.Ei=function(T){},this.Fi=function(){},this.Ii=function(){},this.bb=function(){},this.Gi=function(T){},this.onFullscreenChanged=function(T){},v((()=>{!function(T,z){T._nowObject=performance||Date,T._lastTick=0,T._renderAccum=0,T._rt=0,T._frameCB=y.bind(null,T),requestAnimationFrame(T._frameCB),z>0&&(T._intervalCB=u.bind(null,T),T._interval=setInterval(T._intervalCB,Math.max(z,1e3/T.zi/2)))}(this,z),function(T,z){if(!z)return;var X=!1,b=!1;document.addEventListener("pointerlockchange",(b=>{X=document.pointerLockElement===z,T.Gi(X)})),document.addEventListener("fullscreenchange",(X=>{b=document.fullscreenElement===z,T.onFullscreenChanged(b)})),Object.defineProperty(T,"Ki",{get:()=>X,set:T=>{T&&!X?E(z):X&&!T&&function(T){T.exitPointerLock&&T.exitPointerLock()}(document)}}),Object.defineProperty(T,"fullscreen",{get:()=>b,set:T=>{T&&!b?z.requestFullscreen():b&&!T&&document.exitFullscreen()}}),z.addEventListener("click",(F=>{T.Bi&&!X&&E(z),T.Ci&&!b&&z.requestFullscreen()}));var F=()=>T.bb();if(window.ResizeObserver){new ResizeObserver(F).observe(z)}else window.addEventListener("resize",F)}(this,T),this.Ii()}))}}var F=3,A=20;function u(T){for(var z=1e3/T.zi,X=T._nowObject.now()+A,b=0;T._nowObject.now()>=T._lastTick+z&&T._nowObject.now()<X&&++b<=F;)T.Ei(z),T._lastTick+=z;var u=5*(z+5),y=T._nowObject.now();if(y-T._lastTick>u)for(;y>=T._lastTick+z;)T._lastTick+=z}function y(T){requestAnimationFrame(T._frameCB),u(T);var z=T._nowObject.now(),X=z-T._rt;if(T._rt=z,T.Ai>0){T._renderAccum+=X;var b=1e3/T.Ai;if(T._renderAccum<b)return;T._renderAccum=Math.min(T._renderAccum-b,b)}var F=1e3/T.zi,A=(z-T._lastTick)/F;T.Fi(X,A,F)}function E(T){T.requestPointerLock&&T.requestPointerLock()}var v=T=>{if("loading"===document.readyState){var z=()=>{document.removeEventListener("readystatechange",z),T()};document.addEventListener("readystatechange",z)}else setTimeout(T,1)}},12610:(T,z,X)=>{var b=X(12618),F=X(12621),A="undefined"!==typeof Float64Array;function u(T,z){return T[0]-z[0]}function y(){var T,z=this.stride,X=new Array(z.length);for(T=0;T<X.length;++T)X[T]=[Math.abs(z[T]),T];X.sort(u);var b=new Array(X.length);for(T=0;T<b.length;++T)b[T]=X[T][1];return b}function E(T,z){var X=["View",z,"d",T].join("");z<0&&(X="View_Nil"+T);var F="generic"===T;if(-1===z){var A="function "+X+"(a){this.data=a;};var proto="+X+".prototype;proto.dtype='"+T+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+X+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+X+"(a){return new "+X+"(a);}";return new Function(A)()}if(0===z){A="function "+X+"(a,d) {this.data = a;this.offset = d};var proto="+X+".prototype;proto.dtype='"+T+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+X+"_copy() {return new "+X+"(this.data,this.offset)};proto.pick=function "+X+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+X+"_get(){return "+(F?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+X+"_set(v){return "+(F?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+X+"(a,b,c,d){return new "+X+"(a,d)}";return new Function("TrivialArray",A)(v[T][0])}A=["'use strict'"];var u=b(z),E=u.map((function(T){return"i"+T})),k="this.offset+"+u.map((function(T){return"this.stride["+T+"]*i"+T})).join("+"),L=u.map((function(T){return"b"+T})).join(","),D=u.map((function(T){return"c"+T})).join(",");A.push("function "+X+"(a,"+L+","+D+",d){this.data=a","this.shape=["+L+"]","this.stride=["+D+"]","this.offset=d|0}","var proto="+X+".prototype","proto.dtype='"+T+"'","proto.dimension="+z),A.push("Object.defineProperty(proto,'size',{get:function "+X+"_size(){return "+u.map((function(T){return"this.shape["+T+"]"})).join("*"),"}})"),1===z?A.push("proto.order=[0]"):(A.push("Object.defineProperty(proto,'order',{get:"),z<4?(A.push("function "+X+"_order(){"),2===z?A.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===z&&A.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):A.push("ORDER})")),A.push("proto.set=function "+X+"_set("+E.join(",")+",v){"),F?A.push("return this.data.set("+k+",v)}"):A.push("return this.data["+k+"]=v}"),A.push("proto.get=function "+X+"_get("+E.join(",")+"){"),F?A.push("return this.data.get("+k+")}"):A.push("return this.data["+k+"]}"),A.push("proto.index=function "+X+"_index(",E.join(),"){return "+k+"}"),A.push("proto.hi=function "+X+"_hi("+E.join(",")+"){return new "+X+"(this.data,"+u.map((function(T){return["(typeof i",T,"!=='number'||i",T,"<0)?this.shape[",T,"]:i",T,"|0"].join("")})).join(",")+","+u.map((function(T){return"this.stride["+T+"]"})).join(",")+",this.offset)}");var c=u.map((function(T){return"a"+T+"=this.shape["+T+"]"})),p=u.map((function(T){return"c"+T+"=this.stride["+T+"]"}));A.push("proto.lo=function "+X+"_lo("+E.join(",")+"){var b=this.offset,d=0,"+c.join(",")+","+p.join(","));for(var H=0;H<z;++H)A.push("if(typeof i"+H+"==='number'&&i"+H+">=0){d=i"+H+"|0;b+=c"+H+"*d;a"+H+"-=d}");A.push("return new "+X+"(this.data,"+u.map((function(T){return"a"+T})).join(",")+","+u.map((function(T){return"c"+T})).join(",")+",b)}"),A.push("proto.step=function "+X+"_step("+E.join(",")+"){var "+u.map((function(T){return"a"+T+"=this.shape["+T+"]"})).join(",")+","+u.map((function(T){return"b"+T+"=this.stride["+T+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(H=0;H<z;++H)A.push("if(typeof i"+H+"==='number'){d=i"+H+"|0;if(d<0){c+=b"+H+"*(a"+H+"-1);a"+H+"=ceil(-a"+H+"/d)}else{a"+H+"=ceil(a"+H+"/d)}b"+H+"*=d}");A.push("return new "+X+"(this.data,"+u.map((function(T){return"a"+T})).join(",")+","+u.map((function(T){return"b"+T})).join(",")+",c)}");var U=new Array(z),s=new Array(z);for(H=0;H<z;++H)U[H]="a[i"+H+"]",s[H]="b[i"+H+"]";A.push("proto.transpose=function "+X+"_transpose("+E+"){"+E.map((function(T,z){return T+"=("+T+"===undefined?"+z+":"+T+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+X+"(this.data,"+U.join(",")+","+s.join(",")+",this.offset)}"),A.push("proto.pick=function "+X+"_pick("+E+"){var a=[],b=[],c=this.offset");for(H=0;H<z;++H)A.push("if(typeof i"+H+"==='number'&&i"+H+">=0){c=(c+this.stride["+H+"]*i"+H+")|0}else{a.push(this.shape["+H+"]);b.push(this.stride["+H+"])}");return A.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),A.push("return function construct_"+X+"(data,shape,stride,offset){return new "+X+"(data,"+u.map((function(T){return"shape["+T+"]"})).join(",")+","+u.map((function(T){return"stride["+T+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",A.join("\n"))(v[T],y)}var v={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};T.exports=function(T,z,X,b){if(void 0===T)return(0,v.array[0])([]);"number"===typeof T&&(T=[T]),void 0===z&&(z=[T.length]);var u=z.length;if(void 0===X){X=new Array(u);for(var y=u-1,k=1;y>=0;--y)X[y]=k,k*=z[y]}if(void 0===b){b=0;for(y=0;y<u;++y)X[y]<0&&(b-=(z[y]-1)*X[y])}for(var L=function(T){if(F(T))return"buffer";if(A)switch(Object.prototype.toString.call(T)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(T)?"array":"generic"}(T),D=v[L];D.length<=u+1;)D.push(E(L,D.length-1));return(0,D[u+1])(T,z,X,b)}},12621:T=>{function z(T){return!!T.constructor&&"function"===typeof T.constructor.isBuffer&&T.constructor.isBuffer(T)}T.exports=function(T){return null!=T&&(z(T)||function(T){return"function"===typeof T.readFloatLE&&"function"===typeof T.slice&&z(T.slice(0,0))}(T)||!!T._isBuffer)}},12774:T=>{"use strict";var z=[],X=[],b=[],F=[],A=[],u=[],y=[],E=[],v=[],k=[],L=[],D=[];T.exports=function(T,c,p,H,U,s){for(var x=y,K=v,d=k,N=D,l=0;l<3;l++)x[l]=+p[l],d[l]=+c.max[l],K[l]=+c.$c[l];s||(s=1e-10);var a=function(T,y,v,k,D,c){var p=z,H=X,U=b,s=F,x=A,K=u,d=E,N=Math.floor,l=0,a=0,q=0,V=0,C=0;if(G(),0===q)return 0;for(V=m();a<=q;){if(j(V)&&Z())return l;V=m()}for(l+=q,C=0;C<3;C++)k[C]+=v[C],D[C]+=v[C];return l;function G(){if(a=0,0!==(q=Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2])))for(var T=0;T<3;T++){var z=v[T]>=0;s[T]=z?1:-1;var X=z?D[T]:k[T];p[T]=z?k[T]:D[T],H[T]=S(X,s[T]),U[T]=n(p[T],s[T]),d[T]=v[T]/q,x[T]=Math.abs(1/d[T]);var b=z?H[T]+1-X:X-H[T];K[T]=x[T]<1/0?x[T]*b:1/0}}function j(z){for(var X=s[0],b=0===z?H[0]:U[0],F=H[0]+X,A=s[1],u=1===z?H[1]:U[1],y=H[1]+A,E=s[2],v=2===z?H[2]:U[2],k=H[2]+E,L=b;L!=F;L+=X)for(var D=u;D!=y;D+=A)for(var c=v;c!=k;c+=E)if(T(L,D,c))return!0;return!1}function Z(){l+=a;var T=s[V],z=a/q,X=L;for(C=0;C<3;C++){var b=v[C]*z;k[C]+=b,D[C]+=b,X[C]=v[C]-b}if(T>0?D[V]=Math.round(D[V]):k[V]=Math.round(k[V]),y(l,V,T,X))return!0;for(C=0;C<3;C++)v[C]=X[C];return G(),0===q}function m(){var T=K[0]<K[1]?K[0]<K[2]?0:2:K[1]<K[2]?1:2,z=K[T]-a;for(a=K[T],H[T]+=s[T],K[T]+=x[T],C=0;C<3;C++)p[C]+=z*d[C],U[C]=n(p[C],s[C]);return T}function S(T,z){return N(T-z*c)}function n(T,z){return N(T+z*c)}}(T,H,x,K,d,s);if(!U){for(l=0;l<3;l++)N[l]=p[l]>0?d[l]-c.max[l]:K[l]-c.$c[l];c.translate(N)}return a}},12947:(T,z,X)=>{"use strict";X.d(z,{e:()=>L});var b=X(12765),F=X(12244);class A{constructor(T,z,X,A,u,y,E){this.eh=new b(T.$c,T.Eh),this.mass=z,this.friction=X,this.restitution=A,this.Rb=u,this.Uk=y,this.Yb=!!E,this.Dh=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Hl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.rg=F.create(),this.Zg=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=F.create(),this._impulses=F.create(),this._sleepFrameCount=10}loadFromCopy(T){F.j(this.eh.$c,T.eh.$c),F.j(this.eh.Eh,T.eh.Eh),F.j(this.eh.max,T.eh.max),this.eh.mag=T.eh.mag,this.mass=T.mass,this.friction=T.friction,this.restitution=T.restitution,this.Rb=T.Rb,this.Uk=T.Uk,this.Yb=T.Yb,this.Dh=T.Dh,this.fluidDrag=T.fluidDrag,this.Hl=T.Hl,this.preventFallOffEdge=T.preventFallOffEdge,this.rolledBackLastTick=T.rolledBackLastTick,F.j(this.rg,T.rg),F.j(this.Zg,T.Zg),this.inFluid=T.inFluid,this._ratioInFluid=T._ratioInFluid,F.j(this._forces,T._forces),F.j(this._impulses,T._impulses),this._sleepFrameCount=T._sleepFrameCount}setPosition(T){u(T),F.Mc(T,T,this.eh.$c),this.eh.translate(T),this.vg()}cb(){return F.clone(this.eh.$c)}applyForce(T){u(T),F.add(this._forces,this._forces,T),this.vg()}applyImpulse(T){u(T),F.add(this._impulses,this._impulses,T),this.vg()}vg(){this._sleepFrameCount=10}atRestX(){return this.Zg[0]}atRestY(){return this.Zg[1]}atRestZ(){return this.Zg[2]}}var u=T=>{};var y=X(12765),E=X(12244),v=X(12774);function k(){this.Dh=.1,this.fluidDrag=.4,this.Ic=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function L(T,z,X){T=Object.assign(new k,T),this.gravity=T.gravity||[0,-10,0],this.Dh=T.Dh||.1,this.Ic=T.Ic||2,this.fluidDrag=T.fluidDrag||.4,this.minBounceImpulse=T.minBounceImpulse,this.bodies=[],this.qk=T.qk,this.testSolid=z,this.testFluid=X}L.prototype._k=function(T,z,X,b,F,u){T=T||new y([0,0,0],[1,1,1]),"undefined"==typeof z&&(z=1),"undefined"==typeof X&&(X=1),"undefined"==typeof b&&(b=0),"undefined"==typeof F&&(F=1);var E=new A(T,z,X,b,F,u);return this.bodies.push(E),E},L.prototype.al=function(T){var z=this.bodies.indexOf(T);z<0||(this.bodies.splice(z,1),T.eh=T.Uk=null)};var D=E.create(),c=E.create(),p=E.create(),H=E.create(),U=E.create(),s=E.create(),x=E.create(),K=new y([0,0,0],[1,1,1]),d=new A(K,1,1,0,1,(()=>{}),!1);function N(T,z,X){return z=X,z*=1-(1-T.ratioInFluid)**2}L.prototype.yf=function(T){T/=1e3;var z=e(0,E.squaredLength(this.gravity));this.bodies.forEach((X=>function(T,z,X,b){E.j(U,z.Zg),T.qk&&d.loadFromCopy(z);if(z.mass<=0)return E.set(z.rg,0,0,0),E.set(z._forces,0,0,0),void E.set(z._impulses,0,0,0);var F=b||0===z.Rb;if(function(T,z,X,b){if(z._sleepFrameCount>0)return!1;if(b)return!0;var F=!1,A=.5*X*X*z.Rb;return E.scale(B,T.gravity,A),v(T.testSolid,z.eh,B,(function(){return F=!0,!0}),!0),F}(T,z,X,F))return;z._sleepFrameCount--,function(T,z){var X=z.eh,b=Math.floor(X.$c[0]),F=Math.floor(X.$c[2]),A=Math.floor(X.$c[1]),u=Math.floor(X.max[1]);if(!T.testFluid(b,A,F))return z.inFluid=!1,void(z.ratioInFluid=0);var y=1,v=A+1;for(;v<=u&&T.testFluid(b,v,F);)y++,v++;var k=(A+y-X.$c[1])/X.Eh[1];k>1&&(k=1);var L=X.Eh[0]*X.Eh[1]*X.Eh[2]*k,D=a;E.scale(D,T.gravity,-T.Ic*L*z.Rb),z.applyForce(D),z.inFluid=!0,z.ratioInFluid=k}(T,z),Y(z._forces),Y(z._impulses),Y(z.rg),Y(z.Zg),E.scale(D,z._forces,1/z.mass),E.Oc(D,D,T.gravity,z.Rb),E.scale(c,z._impulses,1/z.mass),E.Oc(c,c,D,X),E.add(z.rg,z.rg,c),z.friction&&(q(T,0,z,c,X),q(T,1,z,c,X),q(T,2,z,c,X));var A=z.fluidDrag>=0?z.fluidDrag:T.fluidDrag,u=z.Dh>=0?z.Dh:T.Dh,y=u,k=u;z.inFluid&&(y=N(z,y,z.fluidDragHoriz>=0?z.fluidDragHoriz:A),k=N(z,k,z.fluidDragVert>=0?z.fluidDragVert:A));y=Math.max(1-y*X/z.mass,0),k=Math.max(1-k*X/z.mass,0),E.set(l,y,k,y),E.multiply(z.rg,z.rg,l),E.scale(p,z.rg,X),E.set(z._forces,0,0,0),E.set(z._impulses,0,0,0),z.Yb&&R(G,z.eh);E.j(s,p),E.set(x,0,0,0),z.preventFallOffEdge&&function(T,z,X,b){if(!z.Zg[1]||X[1]>0)return;var F=O;R(F,z.eh);for(var A=0;A<3;A+=2){E.set(n,0,0,0),n[A]=X[A];var u=!0;(u=(u=(u=(u=u&&!W(T,F.$c[0]+n[0]+1e-5,F.$c[1],F.$c[2]+n[2]+1e-5))&&!W(T,F.max[0]+n[0]-1e-5,F.$c[1],F.$c[2]+n[2]+1e-5))&&!W(T,F.$c[0]+n[0]+1e-5,F.$c[1],F.max[2]+n[2]-1e-5))&&!W(T,F.max[0]+n[0]-1e-5,F.$c[1],F.max[2]+n[2]-1e-5))?(b[A]=X[A]>0?1:-1,X[A]=0):0===A&&(E.set(P,X[0],0,0),C(T,F,P,b,z.slideOnCollision))}}(T,z,p,x);C(T,z.eh,p,z.Zg,z.slideOnCollision),z.Yb&&function(T,z,X,b){if(z.Zg[1]>=0&&!z.inFluid)return;var F=0!==z.Zg[0],A=0!==z.Zg[2];if(!F&&!A)return;var u=Math.abs(b[0]/b[2]),y=4;if(!F&&u>y)return;if(!A&&u<1/y)return;E.add(Z,X.$c,b);var k=T.testSolid;v(k,X,b,(function(T,z,X,b){if(1!==z)return!0;b[z]=0}));var L=X.$c[1],D=z.inFluid?1.951:1.001,c=Math.floor(L+D)-L;E.set(m,0,c,0);var p=!1;if(v(k,X,m,(function(T,z,X,b){return p=!0,!0})),p)return;E.Mc(S,Z,X.$c),S[1]=0,C(T,X,S,j,!0);var H=e(X.$c[0],Z[0]),U=e(X.$c[2],Z[2]);if(F&&!H&&(!U||!A))return;if(A&&(!H||!F)&&!U)return;var s=!0;if(s=s&&!W(T,X.$c[0]+1e-5,X.$c[1],X.$c[2]+1e-5),s=s&&!W(T,X.max[0]-1e-5,X.$c[1],X.$c[2]+1e-5),s=s&&!W(T,X.$c[0]+1e-5,X.$c[1],X.max[2]-1e-5),s=s&&!W(T,X.max[0]-1e-5,X.$c[1],X.max[2]-1e-5),s)return;R(z.eh,X),z.Zg[0]=j[0],z.Zg[2]=j[2],z.Hl&&z.Hl()}(T,z,G,s);for(var L=0;L<3;++L)z.Zg[L]=z.Zg[L]||x[L],H[L]=0,z.Zg[L]&&(U[L]||(H[L]=-z.rg[L]),z.rg[L]=0);var K=E.length(H);K>.001&&(E.scale(H,H,z.mass),z.Uk&&z.Uk(H),z.restitution>0&&K>T.minBounceImpulse&&(E.scale(H,H,z.restitution),z.applyImpulse(H)));var V=E.squaredLength(z.rg);V>1e-5&&z.vg();T.qk&&T.qk(z)?(z.loadFromCopy(d),z.rolledBackLastTick=!0):z.rolledBackLastTick=!1}(this,X,T,z)))};var l=E.create([0,0,0]);var a=E.create();function q(T,z,X,b,F){var A=X.Zg[z],u=b[z];if(!X.alwaysApplyHorizFriction||1!==z){if(0===A)return;if(A*u<=0)return}E.j(V,X.rg),V[z]=0;var y=E.length(V);if(!e(y,0)){var v=Math.abs(X.friction*T.gravity[z]*F),k=y>v?(y-v)/y:0;X.rg[(z+1)%3]*=k,X.rg[(z+2)%3]*=k}}var V=E.create();function C(T,z,X,b,F){return E.set(b,0,0,0),v(T.testSolid,z,X,(function(T,z,X,A){b[z]=X,A[z]=0,F||(A[0]=0,A[1]=0,A[2]=0)}))}var G=new y([],[]),j=E.create(),Z=E.create(),m=E.create(),S=E.create();var n=E.create(),O=new y([],[]),P=E.create();function W(T,z,X,b){return T.testSolid(Math.floor(z),Math.floor(X-1),Math.floor(b))}var B=E.create();function e(T,z){return Math.abs(T-z)<1e-5}function R(T,z){for(var X=0;X<3;X++)T.$c[X]=z.$c[X],T.max[X]=z.max[X],T.Eh[X]=z.Eh[X]}var Y=function(T){}},11747:function(T,z){!function(T){"use strict";var z=function(T,X){return z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,z){T.__proto__=z}||function(T,z){for(var X in z)Object.prototype.hasOwnProperty.call(z,X)&&(T[X]=z[X])},z(T,X)};function X(T,X){if("function"!==typeof X&&null!==X)throw new TypeError("Class extends value "+String(X)+" is not a constructor or null");function b(){this.constructor=T}z(T,X),T.prototype=null===X?Object.create(X):(b.prototype=X.prototype,new b)}function b(T,z,X,b){var F,A=arguments.length,u=A<3?z:null===b?b=Object.getOwnPropertyDescriptor(z,X):b;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)u=Reflect.decorate(T,z,X,b);else for(var y=T.length-1;y>=0;y--)(F=T[y])&&(u=(A<3?F(u):A>3?F(z,X,u):F(z,X))||u);return A>3&&u&&Object.defineProperty(z,X,u),u}function F(T,z,X){if(X||2===arguments.length)for(var b,F=0,A=z.length;F<A;F++)!b&&F in z||(b||(b=Array.prototype.slice.call(z,0,F)),b[F]=z[F]);return T.concat(b||Array.prototype.slice.call(z))}var A,u=255,y=213;T.OPERATION=void 0,(A=T.OPERATION||(T.OPERATION={}))[A.ADD=128]="ADD",A[A.REPLACE=0]="REPLACE",A[A.DELETE=64]="DELETE",A[A.DELETE_AND_ADD=192]="DELETE_AND_ADD",A[A.TOUCH=1]="TOUCH",A[A.CLEAR=10]="CLEAR";var E=function(){function z(T,z,X){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=T,this.setParent(z,X)}return z.prototype.setParent=function(T,z,X){var b=this;if(this.indexes||(this.indexes=this.ref instanceof ST?this.ref._definition.indexes:{}),this.parent=T,this.parentIndex=X,z)if(this.root=z,this.ref instanceof ST){var F=this.ref._definition;for(var A in F.schema){var u=this.ref[A];if(u&&u.$changes){var y=F.indexes[A];u.$changes.setParent(this.ref,z,y)}}}else"object"===typeof this.ref&&this.ref.forEach((function(T,z){if(T instanceof ST){var X=T.$changes,F=b.ref.$changes.indexes[z];X.setParent(b.ref,b.root,F)}}))},z.prototype.operation=function(T){this.changes.set(--this.currentCustomOperation,T)},z.prototype.change=function(z,X){void 0===X&&(X=T.OPERATION.ADD);var b="number"===typeof z?z:this.indexes[z];this.assertValidIndex(b,z);var F=this.changes.get(b);F&&F.op!==T.OPERATION.DELETE&&F.op!==T.OPERATION.TOUCH||this.changes.set(b,{op:F&&F.op===T.OPERATION.DELETE?T.OPERATION.DELETE_AND_ADD:X,index:b}),this.allChanges.add(b),this.changed=!0,this.touchParents()},z.prototype.touch=function(z){var X="number"===typeof z?z:this.indexes[z];this.assertValidIndex(X,z),this.changes.has(X)||this.changes.set(X,{op:T.OPERATION.TOUCH,index:X}),this.allChanges.add(X),this.touchParents()},z.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},z.prototype.getType=function(T){if(this.ref._definition)return(z=this.ref._definition).schema[z.fieldsByIndex[T]];var z,X=(z=this.parent._definition).schema[z.fieldsByIndex[this.parentIndex]];return Object.values(X)[0]},z.prototype.getChildrenFilter=function(){var T=this.parent._definition.childFilters;return T&&T[this.parentIndex]},z.prototype.getValue=function(T){return this.ref.getByIndex(T)},z.prototype.delete=function(z){var X="number"===typeof z?z:this.indexes[z];if(void 0!==X){var b=this.getValue(X);this.changes.set(X,{op:T.OPERATION.DELETE,index:X}),this.allChanges.delete(X),delete this.caches[X],b&&b.$changes&&(b.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(z," (").concat(X,")"))},z.prototype.discard=function(z,X){var b=this;void 0===z&&(z=!1),void 0===X&&(X=!1),this.ref instanceof ST||this.changes.forEach((function(z){if(z.op===T.OPERATION.DELETE){var X=b.ref.getIndex(z.index);delete b.indexes[X]}})),this.changes.clear(),this.changed=z,X&&this.allChanges.clear(),this.currentCustomOperation=0},z.prototype.discardAll=function(){var T=this;this.changes.forEach((function(z){var X=T.getValue(z.index);X&&X.$changes&&X.$changes.discardAll()})),this.discard()},z.prototype.cache=function(T,z){this.caches[T]=z},z.prototype.clone=function(){return new z(this.ref,this.parent,this.root)},z.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},z.prototype.assertValidIndex=function(T,z){if(void 0===T)throw new Error('ChangeTree: missing index for field "'.concat(z,'"'))},z}();function v(T,z,X,b){return T[z]||(T[z]=[]),T[z].push(X),null===b||void 0===b||b.forEach((function(T,z){return X(T,z)})),function(){return L(T[z],T[z].indexOf(X))}}function k(z){var X=this,b="string"!==typeof this.$changes.getType();this.$items.forEach((function(F,A){z.push({refId:X.$changes.refId,op:T.OPERATION.DELETE,field:A,value:void 0,previousValue:F}),b&&X.$changes.root.removeRef(F.$changes.refId)}))}function L(T,z){if(-1===z||z>=T.length)return!1;for(var X=T.length-1,b=z;b<X;b++)T[b]=T[b+1];return T.length=X,!0}var D=function(T,z){var X=T.toString(),b=z.toString();return X<b?-1:X>b?1:0};function c(T){return T.$proxy=!0,T=new Proxy(T,{get:function(T,z){return"symbol"===typeof z||isNaN(z)?T[z]:T.at(z)},set:function(T,z,X){if("symbol"===typeof z||isNaN(z))T[z]=X;else{var b=Array.from(T.$items.keys()),F=parseInt(b[z]||z);void 0===X||null===X?T.deleteAt(F):T.setAt(F,X)}return!0},deleteProperty:function(T,z){return"number"===typeof z?T.deleteAt(z):delete T[z],!0}})}var p=function(){function z(){for(var T=[],z=0;z<arguments.length;z++)T[z]=arguments[z];this.$changes=new E(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,T)}return z.prototype.Pf=function(z,X){return void 0===X&&(X=!0),v(this.$callbacks||(this.$callbacks=[]),T.OPERATION.ADD,z,X?this.$items:void 0)},z.prototype.ab=function(z){return v(this.$callbacks||(this.$callbacks=[]),T.OPERATION.DELETE,z)},z.prototype.onChange=function(z){return v(this.$callbacks||(this.$callbacks=[]),T.OPERATION.REPLACE,z)},z.is=function(T){return Array.isArray(T)||void 0!==T.array},Object.defineProperty(z.prototype,"length",{get:function(){return this.$items.size},set:function(T){0===T?this.clear():this.splice(T,this.length-T)},enumerable:!1,configurable:!0}),z.prototype.push=function(){for(var T,z=this,X=[],b=0;b<arguments.length;b++)X[b]=arguments[b];return X.forEach((function(X){T=z.$refId++,z.setAt(T,X)})),T},z.prototype.pop=function(){var T=Array.from(this.$indexes.values()).pop();if(void 0!==T){this.$changes.delete(T),this.$indexes.delete(T);var z=this.$items.get(T);return this.$items.delete(T),z}},z.prototype.at=function(T){var z=Array.from(this.$items.keys())[T];return this.$items.get(z)},z.prototype.setAt=function(z,X){var b,F;if(void 0!==X&&null!==X){if(this.$items.get(z)!==X){void 0!==X.$changes&&X.$changes.setParent(this,this.$changes.root,z);var A=null!==(F=null===(b=this.$changes.indexes[z])||void 0===b?void 0:b.op)&&void 0!==F?F:T.OPERATION.ADD;this.$changes.indexes[z]=z,this.$indexes.set(z,z),this.$items.set(z,X),this.$changes.change(z,A)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},z.prototype.deleteAt=function(T){var z=Array.from(this.$items.keys())[T];return void 0!==z&&this.$deleteAt(z)},z.prototype.$deleteAt=function(T){return this.$changes.delete(T),this.$indexes.delete(T),this.$items.delete(T)},z.prototype.clear=function(z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),z&&k.call(this,z),this.$items.clear(),this.$changes.operation({index:0,op:T.OPERATION.CLEAR}),this.$changes.touchParents()},z.prototype.concat=function(){for(var T,X=[],b=0;b<arguments.length;b++)X[b]=arguments[b];return new(z.bind.apply(z,F([void 0],(T=Array.from(this.$items.values())).concat.apply(T,X),!1)))},z.prototype.join=function(T){return Array.from(this.$items.values()).join(T)},z.prototype.reverse=function(){var T=this,z=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(X,b){T.setAt(z[b],X)})),this},z.prototype.shift=function(){var T=Array.from(this.$items.keys()).shift();if(void 0!==T){var z=this.$items.get(T);return this.$deleteAt(T),z}},z.prototype.slice=function(T,X){var b=new z;return b.push.apply(b,Array.from(this.$items.values()).slice(T,X)),b},z.prototype.sort=function(T){var z=this;void 0===T&&(T=D);var X=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(T).forEach((function(T,b){z.setAt(X[b],T)})),this},z.prototype.splice=function(T,z){void 0===z&&(z=this.length-T);for(var X=Array.from(this.$items.keys()),b=[],F=T;F<T+z;F++)b.push(this.$items.get(X[F])),this.$deleteAt(X[F]);return b},z.prototype.unshift=function(){for(var T=this,z=[],X=0;X<arguments.length;X++)z[X]=arguments[X];var b=this.length,F=z.length,A=Array.from(this.$items.values());return z.forEach((function(z,X){T.setAt(X,z)})),A.forEach((function(z,X){T.setAt(F+X,z)})),b+F},z.prototype.indexOf=function(T,z){return Array.from(this.$items.values()).indexOf(T,z)},z.prototype.lastIndexOf=function(T,z){return void 0===z&&(z=this.length-1),Array.from(this.$items.values()).lastIndexOf(T,z)},z.prototype.every=function(T,z){return Array.from(this.$items.values()).every(T,z)},z.prototype.some=function(T,z){return Array.from(this.$items.values()).some(T,z)},z.prototype.forEach=function(T,z){Array.from(this.$items.values()).forEach(T,z)},z.prototype.map=function(T,z){return Array.from(this.$items.values()).map(T,z)},z.prototype.filter=function(T,z){return Array.from(this.$items.values()).filter(T,z)},z.prototype.reduce=function(T,z){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},z.prototype.reduceRight=function(T,z){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},z.prototype.find=function(T,z){return Array.from(this.$items.values()).find(T,z)},z.prototype.findIndex=function(T,z){return Array.from(this.$items.values()).findIndex(T,z)},z.prototype.fill=function(T,z,X){throw new Error("ArraySchema#fill() not implemented")},z.prototype.copyWithin=function(T,z,X){throw new Error("ArraySchema#copyWithin() not implemented")},z.prototype.toString=function(){return this.$items.toString()},z.prototype.toLocaleString=function(){return this.$items.toLocaleString()},z.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(z,Symbol.species,{get:function(){return z},enumerable:!1,configurable:!0}),z.prototype.entries=function(){return this.$items.entries()},z.prototype.keys=function(){return this.$items.keys()},z.prototype.values=function(){return this.$items.values()},z.prototype.includes=function(T,z){return Array.from(this.$items.values()).includes(T,z)},z.prototype.flatMap=function(T,z){throw new Error("ArraySchema#flatMap() is not supported.")},z.prototype.flat=function(T){throw new Error("ArraySchema#flat() is not supported.")},z.prototype.findLast=function(){var T=Array.from(this.$items.values());return T.findLast.apply(T,arguments)},z.prototype.findLastIndex=function(){var T=Array.from(this.$items.values());return T.findLastIndex.apply(T,arguments)},z.prototype.setIndex=function(T,z){this.$indexes.set(T,z)},z.prototype.getIndex=function(T){return this.$indexes.get(T)},z.prototype.getByIndex=function(T){return this.$items.get(this.$indexes.get(T))},z.prototype.deleteByIndex=function(T){var z=this.$indexes.get(T);this.$items.delete(z),this.$indexes.delete(T)},z.prototype.toArray=function(){return Array.from(this.$items.values())},z.prototype.toJSON=function(){return this.toArray().map((function(T){return"function"===typeof T.toJSON?T.toJSON():T}))},z.prototype.clone=function(T){return T?new(z.bind.apply(z,F([void 0],Array.from(this.$items.values()),!1))):new(z.bind.apply(z,F([void 0],this.map((function(T){return T.$changes?T.clone():T})),!1)))},z}();function H(T){return T.$proxy=!0,T=new Proxy(T,{get:function(T,z){return"symbol"!==typeof z&&"undefined"===typeof T[z]?T.get(z):T[z]},set:function(T,z,X){return"symbol"!==typeof z&&-1===z.indexOf("$")&&"Pf"!==z&&"ab"!==z&&"onChange"!==z?T.set(z,X):T[z]=X,!0},deleteProperty:function(T,z){return T.delete(z),!0}})}var U=function(){function z(T){var X=this;if(this.$changes=new E(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,T)if(T instanceof Map||T instanceof z)T.forEach((function(T,z){return X.set(z,T)}));else for(var b in T)this.set(b,T[b])}return z.prototype.Pf=function(z,X){return void 0===X&&(X=!0),v(this.$callbacks||(this.$callbacks=[]),T.OPERATION.ADD,z,X?this.$items:void 0)},z.prototype.ab=function(z){return v(this.$callbacks||(this.$callbacks=[]),T.OPERATION.DELETE,z)},z.prototype.onChange=function(z){return v(this.$callbacks||(this.$callbacks=[]),T.OPERATION.REPLACE,z)},z.is=function(T){return void 0!==T.map},z.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(z.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(z,Symbol.species,{get:function(){return z},enumerable:!1,configurable:!0}),z.prototype.set=function(z,X){if(void 0===X||null===X)throw new Error("MapSchema#set('".concat(z,"', ").concat(X,"): trying to set ").concat(X," value on '").concat(z,"'."));z=z.toString();var b="undefined"!==typeof this.$changes.indexes[z],F=b?this.$changes.indexes[z]:this.$refId++,A=b?T.OPERATION.REPLACE:T.OPERATION.ADD,u=void 0!==X.$changes;if(u&&X.$changes.setParent(this,this.$changes.root,F),b){if(!u&&this.$items.get(z)===X)return;u&&this.$items.get(z)!==X&&(A=T.OPERATION.ADD)}else this.$changes.indexes[z]=F,this.$indexes.set(F,z);return this.$items.set(z,X),this.$changes.change(z,A),this},z.prototype.get=function(T){return this.$items.get(T)},z.prototype.delete=function(T){return this.$changes.delete(T),this.$items.delete(T)},z.prototype.clear=function(z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),z&&k.call(this,z),this.$items.clear(),this.$changes.operation({index:0,op:T.OPERATION.CLEAR}),this.$changes.touchParents()},z.prototype.has=function(T){return this.$items.has(T)},z.prototype.forEach=function(T){this.$items.forEach(T)},z.prototype.entries=function(){return this.$items.entries()},z.prototype.keys=function(){return this.$items.keys()},z.prototype.values=function(){return this.$items.values()},Object.defineProperty(z.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),z.prototype.setIndex=function(T,z){this.$indexes.set(T,z)},z.prototype.getIndex=function(T){return this.$indexes.get(T)},z.prototype.getByIndex=function(T){return this.$items.get(this.$indexes.get(T))},z.prototype.deleteByIndex=function(T){var z=this.$indexes.get(T);this.$items.delete(z),this.$indexes.delete(T)},z.prototype.toJSON=function(){var T={};return this.forEach((function(z,X){T[X]="function"===typeof z.toJSON?z.toJSON():z})),T},z.prototype.clone=function(T){var X;return T?X=Object.assign(new z,this):(X=new z,this.forEach((function(T,z){T.$changes?X.set(z,T.clone()):X.set(z,T)}))),X},z}(),s={};function x(T,z){s[T]=z}function K(T){return s[T]}var d=function(){function T(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return T.create=function(z){var X=new T;return X.schema=Object.assign({},z&&z.schema||{}),X.indexes=Object.assign({},z&&z.indexes||{}),X.fieldsByIndex=Object.assign({},z&&z.fieldsByIndex||{}),X.descriptors=Object.assign({},z&&z.descriptors||{}),X.deprecated=Object.assign({},z&&z.deprecated||{}),X},T.prototype.addField=function(T,z){var X=this.getNextFieldIndex();this.fieldsByIndex[X]=T,this.indexes[T]=X,this.schema[T]=Array.isArray(z)?{array:z[0]}:z},T.prototype.hasField=function(T){return void 0!==this.indexes[T]},T.prototype.addFilter=function(T,z){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[T]]=z,this.indexesWithFilters.push(this.indexes[T]),!0},T.prototype.addChildrenFilter=function(T,z){var X=this.indexes[T],b=this.schema[T];if(K(Object.keys(b)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[X]=z,!0;console.warn("@filterChildren: field '".concat(T,"' can't have children. Ignoring filter."))},T.prototype.getChildrenFilter=function(T){return this.childFilters&&this.childFilters[this.indexes[T]]},T.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},T}();function N(T){return T._context&&T._context.useFilters}var l=function(){function T(){this.types={},this.schemas=new Map,this.useFilters=!1}return T.prototype.has=function(T){return this.schemas.has(T)},T.prototype.get=function(T){return this.types[T]},T.prototype.add=function(T,z){void 0===z&&(z=this.schemas.size),T._definition=d.create(T._definition),T._typeid=z,this.types[z]=T,this.schemas.set(T,z)},T.create=function(z){return void 0===z&&(z={}),function(X){return z.context||(z.context=new T),q(X,z)}},T}(),a=new l;function q(T,z){return void 0===z&&(z={}),function(X,b){var A=z.context||a,u=X.constructor;if(u._context=A,!T)throw new Error("".concat(u.name,': @type() reference provided for "').concat(b,"\" is undefined. Make sure you don't have any circular dependencies."));A.has(u)||A.add(u);var y=u._definition;if(y.addField(b,T),y.descriptors[b]){if(y.deprecated[b])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(b,"' definition on '").concat(u.name,"'.\nCheck @type() annotation"))}catch(s){var E=s.stack.split("\n")[4].trim();throw new Error("".concat(s.message," ").concat(E))}}var v=p.is(T),k=!v&&U.is(T);if("string"!==typeof T&&!ST.is(T)){var L=Object.values(T)[0];"string"===typeof L||A.has(L)||A.add(L)}if(z.manual)y.descriptors[b]={enumerable:!0,configurable:!0,writable:!0};else{var D="_".concat(b);y.descriptors[D]={enumerable:!1,configurable:!1,writable:!0},y.descriptors[b]={get:function(){return this[D]},set:function(T){T!==this[D]&&(void 0!==T&&null!==T?(!v||T instanceof p||(T=new(p.bind.apply(p,F([void 0],T,!1)))),!k||T instanceof U||(T=new U(T)),void 0===T.$proxy&&(k?T=H(T):v&&(T=c(T))),this.$changes.change(b),T.$changes&&T.$changes.setParent(this,this.$changes.root,this._definition.indexes[b])):this[D]&&this.$changes.delete(b),this[D]=T)},enumerable:!0,configurable:!0}}}}function V(T){return function(z,X){var b=z.constructor;b._definition.addFilter(X,T)&&(b._context.useFilters=!0)}}function C(T){return function(z,X){var b=z.constructor;b._definition.addChildrenFilter(X,T)&&(b._context.useFilters=!0)}}function G(T){return void 0===T&&(T=!0),function(z,X){var b=z.constructor._definition;b.deprecated[X]=!0,T&&(b.descriptors[X]={get:function(){throw new Error("".concat(X," is deprecated."))},set:function(T){},enumerable:!1,configurable:!0})}}function j(T,z,X){for(var b in void 0===X&&(X={}),X.context||(X.context=T._context||X.context||a),z)q(z[b],X)(T.prototype,b);return T}function Z(T){for(var z=0,X=0,b=0,F=T.length;b<F;b++)(z=T.charCodeAt(b))<128?X+=1:z<2048?X+=2:z<55296||z>=57344?X+=3:(b++,X+=4);return X}function m(T,z,X){for(var b=0,F=0,A=X.length;F<A;F++)(b=X.charCodeAt(F))<128?T[z++]=b:b<2048?(T[z++]=192|b>>6,T[z++]=128|63&b):b<55296||b>=57344?(T[z++]=224|b>>12,T[z++]=128|b>>6&63,T[z++]=128|63&b):(F++,b=65536+((1023&b)<<10|1023&X.charCodeAt(F)),T[z++]=240|b>>18,T[z++]=128|b>>12&63,T[z++]=128|b>>6&63,T[z++]=128|63&b)}function S(T,z){T.push(255&z)}function n(T,z){T.push(255&z)}function O(T,z){T.push(255&z),T.push(z>>8&255)}function P(T,z){T.push(255&z),T.push(z>>8&255)}function W(T,z){T.push(255&z),T.push(z>>8&255),T.push(z>>16&255),T.push(z>>24&255)}function B(T,z){var X=z>>24,b=z>>16,F=z>>8,A=z;T.push(255&A),T.push(255&F),T.push(255&b),T.push(255&X)}function e(T,z){var X=Math.floor(z/Math.pow(2,32));B(T,z>>>0),B(T,X)}function R(T,z){var X=z/Math.pow(2,32)|0;B(T,z>>>0),B(T,X)}function Y(T,z){r(T,z)}function i(T,z){o(T,z)}var t=new Int32Array(2),g=new Float32Array(t.buffer),M=new Float64Array(t.buffer);function r(T,z){g[0]=z,W(T,t[0])}function o(T,z){M[0]=z,W(T,t[0]),W(T,t[1])}function f(T,z){return n(T,z?1:0)}function h(T,z){z||(z="");var X=Z(z),b=0;if(X<32)T.push(160|X),b=1;else if(X<256)T.push(217),n(T,X),b=2;else if(X<65536)T.push(218),P(T,X),b=3;else{if(!(X<4294967296))throw new Error("String too long");T.push(219),B(T,X),b=5}return m(T,T.length,z),b+X}function Q(T,z){return isNaN(z)?Q(T,0):isFinite(z)?z!==(0|z)?(T.push(203),o(T,z),9):z>=0?z<128?(n(T,z),1):z<256?(T.push(204),n(T,z),2):z<65536?(T.push(205),P(T,z),3):z<4294967296?(T.push(206),B(T,z),5):(T.push(207),R(T,z),9):z>=-32?(T.push(224|z+32),1):z>=-128?(T.push(208),S(T,z),2):z>=-32768?(T.push(209),O(T,z),3):z>=-2147483648?(T.push(210),W(T,z),5):(T.push(211),e(T,z),9):Q(T,z>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var w=Object.freeze({__proto__:null,utf8Write:m,int8:S,uint8:n,int16:O,uint16:P,int32:W,uint32:B,int64:e,uint64:R,float32:Y,float64:i,writeFloat32:r,writeFloat64:o,boolean:f,string:h,number:Q});function J(T,z,X){for(var b="",F=0,A=z,u=z+X;A<u;A++){var y=T[A];0!==(128&y)?192!==(224&y)?224!==(240&y)?240!==(248&y)?console.error("Invalid byte "+y.toString(16)):(F=(7&y)<<18|(63&T[++A])<<12|(63&T[++A])<<6|63&T[++A])>=65536?(F-=65536,b+=String.fromCharCode(55296+(F>>>10),56320+(1023&F))):b+=String.fromCharCode(F):b+=String.fromCharCode((15&y)<<12|(63&T[++A])<<6|63&T[++A]):b+=String.fromCharCode((31&y)<<6|63&T[++A]):b+=String.fromCharCode(y)}return b}function I(T,z){return TT(T,z)<<24>>24}function TT(T,z){return T[z.offset++]}function zT(T,z){return XT(T,z)<<16>>16}function XT(T,z){return T[z.offset++]|T[z.offset++]<<8}function bT(T,z){return T[z.offset++]|T[z.offset++]<<8|T[z.offset++]<<16|T[z.offset++]<<24}function FT(T,z){return bT(T,z)>>>0}function AT(T,z){return DT(T,z)}function uT(T,z){return cT(T,z)}function yT(T,z){var X=FT(T,z);return bT(T,z)*Math.pow(2,32)+X}function ET(T,z){var X=FT(T,z);return FT(T,z)*Math.pow(2,32)+X}var vT=new Int32Array(2),kT=new Float32Array(vT.buffer),LT=new Float64Array(vT.buffer);function DT(T,z){return vT[0]=bT(T,z),kT[0]}function cT(T,z){return vT[0]=bT(T,z),vT[1]=bT(T,z),LT[0]}function pT(T,z){return TT(T,z)>0}function HT(T,z){var X,b=T[z.offset++];b<192?X=31&b:217===b?X=TT(T,z):218===b?X=XT(T,z):219===b&&(X=FT(T,z));var F=J(T,z.offset,X);return z.offset+=X,F}function UT(T,z){var X=T[z.offset];return X<192&&X>160||217===X||218===X||219===X}function sT(T,z){var X=T[z.offset++];return X<128?X:202===X?DT(T,z):203===X?cT(T,z):204===X?TT(T,z):205===X?XT(T,z):206===X?FT(T,z):207===X?ET(T,z):208===X?I(T,z):209===X?zT(T,z):210===X?bT(T,z):211===X?yT(T,z):X>223?-1*(255-X+1):void 0}function xT(T,z){var X=T[z.offset];return X<128||X>=202&&X<=211}function KT(T,z){return T[z.offset]<160}function dT(T,z){return T[z.offset-1]===u&&(T[z.offset]<128||T[z.offset]>=202&&T[z.offset]<=211)}var NT=Object.freeze({__proto__:null,int8:I,uint8:TT,int16:zT,uint16:XT,int32:bT,uint32:FT,float32:AT,float64:uT,int64:yT,uint64:ET,readFloat32:DT,readFloat64:cT,boolean:pT,string:HT,stringCheck:UT,number:sT,numberCheck:xT,arrayCheck:KT,switchStructureCheck:dT}),lT=function(){function z(T){var z=this;this.$changes=new E(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,T&&T.forEach((function(T){return z.add(T)}))}return z.prototype.Pf=function(z,X){return void 0===X&&(X=!0),v(this.$callbacks||(this.$callbacks=[]),T.OPERATION.ADD,z,X?this.$items:void 0)},z.prototype.ab=function(z){return v(this.$callbacks||(this.$callbacks=[]),T.OPERATION.DELETE,z)},z.prototype.onChange=function(z){return v(this.$callbacks||(this.$callbacks=[]),T.OPERATION.REPLACE,z)},z.is=function(T){return void 0!==T.collection},z.prototype.add=function(T){var z=this.$refId++;return void 0!==T.$changes&&T.$changes.setParent(this,this.$changes.root,z),this.$changes.indexes[z]=z,this.$indexes.set(z,z),this.$items.set(z,T),this.$changes.change(z),z},z.prototype.at=function(T){var z=Array.from(this.$items.keys())[T];return this.$items.get(z)},z.prototype.entries=function(){return this.$items.entries()},z.prototype.delete=function(T){for(var z,X,b=this.$items.entries();(X=b.next())&&!X.done;)if(T===X.value[1]){z=X.value[0];break}return void 0!==z&&(this.$changes.delete(z),this.$indexes.delete(z),this.$items.delete(z))},z.prototype.clear=function(z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),z&&k.call(this,z),this.$items.clear(),this.$changes.operation({index:0,op:T.OPERATION.CLEAR}),this.$changes.touchParents()},z.prototype.has=function(T){return Array.from(this.$items.values()).some((function(z){return z===T}))},z.prototype.forEach=function(T){var z=this;this.$items.forEach((function(X,b,F){return T(X,b,z)}))},z.prototype.values=function(){return this.$items.values()},Object.defineProperty(z.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),z.prototype.setIndex=function(T,z){this.$indexes.set(T,z)},z.prototype.getIndex=function(T){return this.$indexes.get(T)},z.prototype.getByIndex=function(T){return this.$items.get(this.$indexes.get(T))},z.prototype.deleteByIndex=function(T){var z=this.$indexes.get(T);this.$items.delete(z),this.$indexes.delete(T)},z.prototype.toArray=function(){return Array.from(this.$items.values())},z.prototype.toJSON=function(){var T=[];return this.forEach((function(z,X){T.push("function"===typeof z.toJSON?z.toJSON():z)})),T},z.prototype.clone=function(T){var X;return T?X=Object.assign(new z,this):(X=new z,this.forEach((function(T){T.$changes?X.add(T.clone()):X.add(T)}))),X},z}(),aT=function(){function z(T){var z=this;this.$changes=new E(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,T&&T.forEach((function(T){return z.add(T)}))}return z.prototype.Pf=function(z,X){return void 0===X&&(X=!0),v(this.$callbacks||(this.$callbacks=[]),T.OPERATION.ADD,z,X?this.$items:void 0)},z.prototype.ab=function(z){return v(this.$callbacks||(this.$callbacks=[]),T.OPERATION.DELETE,z)},z.prototype.onChange=function(z){return v(this.$callbacks||(this.$callbacks=[]),T.OPERATION.REPLACE,z)},z.is=function(T){return void 0!==T.set},z.prototype.add=function(z){var X,b;if(this.has(z))return!1;var F=this.$refId++;void 0!==z.$changes&&z.$changes.setParent(this,this.$changes.root,F);var A=null!==(b=null===(X=this.$changes.indexes[F])||void 0===X?void 0:X.op)&&void 0!==b?b:T.OPERATION.ADD;return this.$changes.indexes[F]=F,this.$indexes.set(F,F),this.$items.set(F,z),this.$changes.change(F,A),F},z.prototype.entries=function(){return this.$items.entries()},z.prototype.delete=function(T){for(var z,X,b=this.$items.entries();(X=b.next())&&!X.done;)if(T===X.value[1]){z=X.value[0];break}return void 0!==z&&(this.$changes.delete(z),this.$indexes.delete(z),this.$items.delete(z))},z.prototype.clear=function(z){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),z&&k.call(this,z),this.$items.clear(),this.$changes.operation({index:0,op:T.OPERATION.CLEAR}),this.$changes.touchParents()},z.prototype.has=function(T){for(var z,X=this.$items.values(),b=!1;(z=X.next())&&!z.done;)if(T===z.value){b=!0;break}return b},z.prototype.forEach=function(T){var z=this;this.$items.forEach((function(X,b,F){return T(X,b,z)}))},z.prototype.values=function(){return this.$items.values()},Object.defineProperty(z.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),z.prototype.setIndex=function(T,z){this.$indexes.set(T,z)},z.prototype.getIndex=function(T){return this.$indexes.get(T)},z.prototype.getByIndex=function(T){return this.$items.get(this.$indexes.get(T))},z.prototype.deleteByIndex=function(T){var z=this.$indexes.get(T);this.$items.delete(z),this.$indexes.delete(T)},z.prototype.toArray=function(){return Array.from(this.$items.values())},z.prototype.toJSON=function(){var T=[];return this.forEach((function(z,X){T.push("function"===typeof z.toJSON?z.toJSON():z)})),T},z.prototype.clone=function(T){var X;return T?X=Object.assign(new z,this):(X=new z,this.forEach((function(T){T.$changes?X.add(T.clone()):X.add(T)}))),X},z}(),qT=function(){function T(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return T.prototype.addRefId=function(T){this.refIds.has(T)||(this.refIds.add(T),this.containerIndexes.set(T,new Set))},T.get=function(z){return void 0===z.$filterState&&(z.$filterState=new T),z.$filterState},T}(),VT=function(){function T(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return T.prototype.getNextUniqueId=function(){return this.nextUniqueId++},T.prototype.addRef=function(T,z,X){void 0===X&&(X=!0),this.refs.set(T,z),X&&(this.refCounts[T]=(this.refCounts[T]||0)+1)},T.prototype.removeRef=function(T){this.refCounts[T]=this.refCounts[T]-1,this.deletedRefs.add(T)},T.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},T.prototype.garbageCollectDeletedRefs=function(){var T=this;this.deletedRefs.forEach((function(z){if(!(T.refCounts[z]>0)){var X=T.refs.get(z);if(X instanceof ST)for(var b in X._definition.schema)"string"!==typeof X._definition.schema[b]&&X[b]&&X[b].$changes&&T.removeRef(X[b].$changes.refId);else{var F=X.$changes.parent._definition,A=F.schema[F.fieldsByIndex[X.$changes.parentIndex]];"function"===typeof Object.values(A)[0]&&Array.from(X.values()).forEach((function(z){return T.removeRef(z.$changes.refId)}))}T.refs.delete(z),delete T.refCounts[z]}})),this.deletedRefs.clear()},T}(),CT=function(T){function z(){return null!==T&&T.apply(this,arguments)||this}return X(z,T),z}(Error);function GT(T,z,X,b){var F,A=!1;switch(z){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":F="number",isNaN(T)&&console.log('trying to encode "NaN" in '.concat(X.constructor.name,"#").concat(b));break;case"string":F="string",A=!0;break;case"boolean":return}if(typeof T!==F&&(!A||A&&null!==T)){var u="'".concat(JSON.stringify(T),"'").concat(T&&T.constructor&&" (".concat(T.constructor.name,")")||"");throw new CT("a '".concat(F,"' was expected, but ").concat(u," was provided in ").concat(X.constructor.name,"#").concat(b))}}function jT(T,z,X,b){if(!(T instanceof z))throw new CT("a '".concat(z.name,"' was expected, but '").concat(T.constructor.name,"' was provided in ").concat(X.constructor.name,"#").concat(b))}function ZT(T,z,X,b,F){GT(X,T,b,F);var A=w[T];if(!A)throw new CT("a '".concat(T,"' was expected, but ").concat(X," was provided in ").concat(b.constructor.name,"#").concat(F));A(z,X)}function mT(T,z,X){return NT[T](z,X)}var ST=function(){function z(){for(var T=[],z=0;z<arguments.length;z++)T[z]=arguments[z];Object.defineProperties(this,{$changes:{value:new E(this,void 0,new VT),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var X=this._definition.descriptors;X&&Object.defineProperties(this,X),T[0]&&this.assign(T[0])}return z.onError=function(T){console.error(T)},z.is=function(T){return T._definition&&void 0!==T._definition.schema},z.prototype.onChange=function(z){return v(this.$callbacks||(this.$callbacks=[]),T.OPERATION.REPLACE,z)},z.prototype.ab=function(z){return v(this.$callbacks||(this.$callbacks=[]),T.OPERATION.DELETE,z)},z.prototype.assign=function(T){return Object.assign(this,T),this},Object.defineProperty(z.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),z.prototype.setDirty=function(T,z){this.$changes.change(T,z)},z.prototype.listen=function(T,z,X){var b=this;return void 0===X&&(X=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[T]||(this.$callbacks[T]=[]),this.$callbacks[T].push(z),X&&void 0!==this[T]&&z(this[T],void 0),function(){return L(b.$callbacks[T],b.$callbacks[T].indexOf(z))}},z.prototype.decode=function(X,b,F){var A;void 0===b&&(b={offset:0}),void 0===F&&(F=this);var y=[],E=this.$changes.root,v=X.length,k=0;for(E.refs.set(k,this);b.offset<v;){var L=X[b.offset++];if(L!=u){var D=F.$changes,c=void 0!==F._definition,H=c?L>>6<<6:L;if(H!==T.OPERATION.CLEAR){var s=c?L%(H||255):sT(X,b),x=c?F._definition.fieldsByIndex[s]:"",d=D.getType(s),N=void 0,l=void 0,a=void 0;if(c?l=F["_".concat(x)]:(l=F.getByIndex(s),(H&T.OPERATION.ADD)===T.OPERATION.ADD?(a=F instanceof U?HT(X,b):s,F.setIndex(s,a)):a=F.getIndex(s)),(H&T.OPERATION.DELETE)===T.OPERATION.DELETE&&(H!==T.OPERATION.DELETE_AND_ADD&&F.deleteByIndex(s),l&&l.$changes&&E.removeRef(l.$changes.refId),N=null),void 0!==x){if(H===T.OPERATION.DELETE);else if(z.is(d)){var q=sT(X,b);if(N=E.refs.get(q),H!==T.OPERATION.REPLACE){var V=this.getSchemaType(X,b,d);N||((N=this.createTypeInstance(V)).$changes.refId=q,l&&(N.$callbacks=l.$callbacks,l.$changes.refId&&q!==l.$changes.refId&&E.removeRef(l.$changes.refId))),E.addRef(q,N,N!==l)}}else if("string"===typeof d)N=mT(d,X,b);else{var C=K(Object.keys(d)[0]),G=sT(X,b),j=E.refs.has(G)?l||E.refs.get(G):new C.constructor;if((N=j.clone(!0)).$changes.refId=G,l&&(N.$callbacks=l.$callbacks,l.$changes.refId&&G!==l.$changes.refId)){E.removeRef(l.$changes.refId);for(var Z=l.entries(),m=void 0;(m=Z.next())&&!m.done;){var S=(A=m.value)[0],n=A[1];y.push({refId:G,op:T.OPERATION.DELETE,field:S,value:void 0,previousValue:n})}}E.addRef(G,N,j!==l)}if(null!==N&&void 0!==N)if(N.$changes&&N.$changes.setParent(D.ref,D.root,s),F instanceof z)F[x]=N;else if(F instanceof U)S=a,F.$items.set(S,N),F.$changes.allChanges.add(s);else if(F instanceof p)F.setAt(s,N);else if(F instanceof lT){var O=F.add(N);F.setIndex(s,O)}else F instanceof aT&&!1!==(O=F.add(N))&&F.setIndex(s,O);l!==N&&y.push({refId:k,op:H,field:x,dynamicIndex:a,value:N,previousValue:l})}else{console.warn("@colyseus/schema: definition mismatch");for(var P={offset:b.offset};b.offset<v&&(!dT(X,b)||(P.offset=b.offset+1,!E.refs.has(sT(X,P))));)b.offset++}}else F.clear(y)}else{k=sT(X,b);var W=E.refs.get(k);if(!W)throw new Error('"refId" not found: '.concat(k));F=W}}return this._triggerChanges(y),E.garbageCollectDeletedRefs(),y},z.prototype.encode=function(X,b,F){void 0===X&&(X=!1),void 0===b&&(b=[]),void 0===F&&(F=!1);for(var A=this.$changes,y=new WeakSet,E=[A],v=1,k=0;k<v;k++){var L=E[k],D=L.ref,c=D instanceof z;L.ensureRefId(),y.add(L),L!==A&&(L.changed||X)&&(n(b,u),Q(b,L.refId));for(var p=X?Array.from(L.allChanges):Array.from(L.changes.values()),H=0,s=p.length;H<s;H++){var x=X?{op:T.OPERATION.ADD,index:p[H]}:p[H],d=x.index,N=c?D._definition.fieldsByIndex&&D._definition.fieldsByIndex[d]:d,l=b.length;if(x.op!==T.OPERATION.TOUCH)if(c)n(b,d|x.op);else{if(n(b,x.op),x.op===T.OPERATION.CLEAR)continue;Q(b,d)}if(c||(x.op&T.OPERATION.ADD)!=T.OPERATION.ADD||D instanceof U&&h(b,L.ref.$indexes.get(d)),x.op!==T.OPERATION.DELETE){var a=L.getType(d),q=L.getValue(d);if(q&&q.$changes&&!y.has(q.$changes)&&(E.push(q.$changes),q.$changes.ensureRefId(),v++),x.op!==T.OPERATION.TOUCH){if(z.is(a))jT(q,a,D,N),Q(b,q.$changes.refId),(x.op&T.OPERATION.ADD)===T.OPERATION.ADD&&this.tryEncodeTypeId(b,a,q.constructor);else if("string"===typeof a)ZT(a,b,q,D,N);else{var V=K(Object.keys(a)[0]);jT(D["_".concat(N)],V.constructor,D,N),Q(b,q.$changes.refId)}F&&L.cache(d,b.slice(l))}}}X||F||L.discard()}return b},z.prototype.encodeAll=function(T){return this.encode(!0,[],T)},z.prototype.applyFilters=function(X,b){var F,A;void 0===b&&(b=!1);for(var y=this,E=new Set,v=qT.get(X),k=[this.$changes],L=1,D=[],c=function(c){var p=k[c];if(E.has(p.refId))return"continue";var H=p.ref,s=H instanceof z;n(D,u),Q(D,p.refId);var x=v.refIds.has(p),K=b||!x;v.addRefId(p);var d=v.containerIndexes.get(p),N=K?Array.from(p.allChanges):Array.from(p.changes.values());!b&&s&&H._definition.indexesWithFilters&&H._definition.indexesWithFilters.forEach((function(z){!d.has(z)&&p.allChanges.has(z)&&(K?N.push(z):N.push({op:T.OPERATION.ADD,index:z}))}));for(var l=0,a=N.length;l<a;l++){var q=K?{op:T.OPERATION.ADD,index:N[l]}:N[l];if(q.op!==T.OPERATION.CLEAR){var V=q.index;if(q.op!==T.OPERATION.DELETE){var C=p.getValue(V),G=p.getType(V);if(s){if((j=H._definition.filters&&H._definition.filters[V])&&!j.call(H,X,C,y)){C&&C.$changes&&E.add(C.$changes.refId);continue}}else{var j,Z=p.parent;if((j=p.getChildrenFilter())&&!j.call(Z,X,H.$indexes.get(V),C,y)){C&&C.$changes&&E.add(C.$changes.refId);continue}}if(C.$changes&&(k.push(C.$changes),L++),q.op!==T.OPERATION.TOUCH)if(q.op===T.OPERATION.ADD||s)D.push.apply(D,null!==(F=p.caches[V])&&void 0!==F?F:[]),d.add(V);else if(d.has(V))D.push.apply(D,null!==(A=p.caches[V])&&void 0!==A?A:[]);else{if(d.add(V),n(D,T.OPERATION.ADD),Q(D,V),H instanceof U){var m=p.ref.$indexes.get(V);h(D,m)}C.$changes?Q(D,C.$changes.refId):w[G](D,C)}else C.$changes&&!s&&(n(D,T.OPERATION.ADD),Q(D,V),H instanceof U&&(m=p.ref.$indexes.get(V),h(D,m)),Q(D,C.$changes.refId))}else s?n(D,q.op|V):(n(D,q.op),Q(D,V))}else n(D,q.op)}},p=0;p<L;p++)c(p);return D},z.prototype.clone=function(){var T,z=new this.constructor,X=this._definition.schema;for(var b in X)"object"===typeof this[b]&&"function"===typeof(null===(T=this[b])||void 0===T?void 0:T.clone)?z[b]=this[b].clone():z[b]=this[b];return z},z.prototype.toJSON=function(){var T=this._definition.schema,z=this._definition.deprecated,X={};for(var b in T)z[b]||null===this[b]||"undefined"===typeof this[b]||(X[b]="function"===typeof this[b].toJSON?this[b].toJSON():this["_".concat(b)]);return X},z.prototype.discardAllChanges=function(){this.$changes.discardAll()},z.prototype.getByIndex=function(T){return this[this._definition.fieldsByIndex[T]]},z.prototype.deleteByIndex=function(T){this[this._definition.fieldsByIndex[T]]=void 0},z.prototype.tryEncodeTypeId=function(T,z,X){z._typeid!==X._typeid&&(n(T,y),Q(T,X._typeid))},z.prototype.getSchemaType=function(T,z,X){var b;return T[z.offset]===y&&(z.offset++,b=this.constructor._context.get(sT(T,z))),b||X},z.prototype.createTypeInstance=function(T){var z=new T;return z.$changes.root=this.$changes.root,z},z.prototype._triggerChanges=function(X){for(var b,F,A,u,y,E,v,k,L,D=new Set,c=this.$changes.root.refs,p=function(p){var H=X[p],U=H.refId,s=c.get(U),x=s.$callbacks;if((H.op&T.OPERATION.DELETE)===T.OPERATION.DELETE&&H.previousValue instanceof z&&(null===(F=null===(b=H.previousValue.$callbacks)||void 0===b?void 0:b[T.OPERATION.DELETE])||void 0===F||F.forEach((function(T){return T()}))),!x)return"continue";if(s instanceof z){if(!D.has(U))try{null===(A=null===x||void 0===x?void 0:x[T.OPERATION.REPLACE])||void 0===A||A.forEach((function(T){return T()}))}catch(K){z.onError(K)}try{x.hasOwnProperty(H.field)&&(null===(u=x[H.field])||void 0===u||u.forEach((function(T){return T(H.value,H.previousValue)})))}catch(K){z.onError(K)}}else H.op===T.OPERATION.ADD&&void 0===H.previousValue?null===(y=x[T.OPERATION.ADD])||void 0===y||y.forEach((function(T){var z;return T(H.value,null!==(z=H.dynamicIndex)&&void 0!==z?z:H.field)})):H.op===T.OPERATION.DELETE?void 0!==H.previousValue&&(null===(E=x[T.OPERATION.DELETE])||void 0===E||E.forEach((function(T){var z;return T(H.previousValue,null!==(z=H.dynamicIndex)&&void 0!==z?z:H.field)}))):H.op===T.OPERATION.DELETE_AND_ADD&&(void 0!==H.previousValue&&(null===(v=x[T.OPERATION.DELETE])||void 0===v||v.forEach((function(T){var z;return T(H.previousValue,null!==(z=H.dynamicIndex)&&void 0!==z?z:H.field)}))),null===(k=x[T.OPERATION.ADD])||void 0===k||k.forEach((function(T){var z;return T(H.value,null!==(z=H.dynamicIndex)&&void 0!==z?z:H.field)}))),H.value!==H.previousValue&&(null===(L=x[T.OPERATION.REPLACE])||void 0===L||L.forEach((function(T){var z;return T(H.value,null!==(z=H.dynamicIndex)&&void 0!==z?z:H.field)})));D.add(U)},H=0;H<X.length;H++)p(H)},z._definition=d.create(),z}();function nT(T){for(var z=[T.$changes],X=1,b={},F=b,A=function(T){var X=z[T];X.changes.forEach((function(T){var z=X.ref,b=T.index,A=z._definition?z._definition.fieldsByIndex[b]:z.$indexes.get(b);F[A]=X.getValue(b)}))},u=0;u<X;u++)A(u);return b}var OT={context:new l},PT=function(T){function z(){return null!==T&&T.apply(this,arguments)||this}return X(z,T),b([q("string",OT)],z.prototype,"name",void 0),b([q("string",OT)],z.prototype,"type",void 0),b([q("number",OT)],z.prototype,"referencedType",void 0),z}(ST),WT=function(T){function z(){var z=null!==T&&T.apply(this,arguments)||this;return z.fields=new p,z}return X(z,T),b([q("number",OT)],z.prototype,"id",void 0),b([q([PT],OT)],z.prototype,"fields",void 0),z}(ST),BT=function(T){function z(){var z=null!==T&&T.apply(this,arguments)||this;return z.types=new p,z}return X(z,T),z.encode=function(T){var X=T.constructor,b=new z;b.rootType=X._typeid;var F=function(T,z){for(var X in z){var F=new PT;F.name=X;var A=void 0;if("string"===typeof z[X])A=z[X];else{var u=z[X],y=void 0;ST.is(u)?(A="ref",y=z[X]):"string"===typeof u[A=Object.keys(u)[0]]?A+=":"+u[A]:y=u[A],F.referencedType=y?y._typeid:-1}F.type=A,T.fields.push(F)}b.types.push(T)},A=X._context.types;for(var u in A){var y=new WT;y.id=Number(u),F(y,A[u]._definition.schema)}return b.encodeAll()},z.decode=function(T,b){var F=new l,A=new z;A.decode(T,b);var u=A.types.reduce((function(T,z){var b=function(T){function z(){return null!==T&&T.apply(this,arguments)||this}return X(z,T),z}(ST),A=z.id;return T[A]=b,F.add(b,A),T}),{});A.types.forEach((function(T){var z=u[T.id];T.fields.forEach((function(T){var X;if(void 0!==T.referencedType){var b=T.type,A=u[T.referencedType];if(!A){var y=T.type.split(":");b=y[0],A=y[1]}"ref"===b?q(A,{context:F})(z.prototype,T.name):q(((X={})[b]=A,X),{context:F})(z.prototype,T.name)}else q(T.type,{context:F})(z.prototype,T.name)}))}));var y=u[A.rootType],E=new y;for(var v in y._definition.schema){var k=y._definition.schema[v];"string"!==typeof k&&(E[v]="function"===typeof k?new k:new(K(Object.keys(k)[0]).constructor))}return E},b([q([WT],OT)],z.prototype,"types",void 0),b([q("number",OT)],z.prototype,"rootType",void 0),z}(ST);x("map",{constructor:U}),x("array",{constructor:p}),x("set",{constructor:aT}),x("collection",{constructor:lT}),T.ArraySchema=p,T.CollectionSchema=lT,T.Context=l,T.MapSchema=U,T.Reflection=BT,T.ReflectionField=PT,T.ReflectionType=WT,T.Schema=ST,T.SchemaDefinition=d,T.SetSchema=aT,T.decode=NT,T.defineTypes=j,T.deprecated=G,T.dumpChanges=nT,T.encode=w,T.filter=V,T.filterChildren=C,T.hasFilter=N,T.registerType=x,T.type=q,Object.defineProperty(T,"__esModule",{value:!0})}(z)},12822:T=>{"use strict";T.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12819:(T,z,X)=>{var b=X(12822),F=X(12827),A=Object.hasOwnProperty,u=Object.create(null);for(var y in b)A.call(b,y)&&(u[b[y]]=y);var E=T.exports={to:{},get:{}};function v(T,z,X){return Math.min(Math.max(z,T),X)}function k(T){var z=Math.round(T).toString(16).toUpperCase();return z.length<2?"0"+z:z}E.get=function(T){var z,X;switch(T.substring(0,3).toLowerCase()){case"hsl":z=E.get.hsl(T),X="hsl";break;case"hwb":z=E.get.hwb(T),X="hwb";break;default:z=E.get.rgb(T),X="rgb"}return z?{model:X,value:z}:null},E.get.rgb=function(T){if(!T)return null;var z,X,F,u=[0,0,0,1];if(z=T.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(F=z[2],z=z[1],X=0;X<3;X++){var y=2*X;u[X]=parseInt(z.slice(y,y+2),16)}F&&(u[3]=parseInt(F,16)/255)}else if(z=T.match(/^#([a-f0-9]{3,4})$/i)){for(F=(z=z[1])[3],X=0;X<3;X++)u[X]=parseInt(z[X]+z[X],16);F&&(u[3]=parseInt(F+F,16)/255)}else if(z=T.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(X=0;X<3;X++)u[X]=parseInt(z[X+1],0);z[4]&&(z[5]?u[3]=.01*parseFloat(z[4]):u[3]=parseFloat(z[4]))}else{if(!(z=T.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(z=T.match(/^(\w+)$/))?"transparent"===z[1]?[0,0,0,0]:A.call(b,z[1])?((u=b[z[1]])[3]=1,u):null:null;for(X=0;X<3;X++)u[X]=Math.round(2.55*parseFloat(z[X+1]));z[4]&&(z[5]?u[3]=.01*parseFloat(z[4]):u[3]=parseFloat(z[4]))}for(X=0;X<3;X++)u[X]=v(u[X],0,255);return u[3]=v(u[3],0,1),u},E.get.hsl=function(T){if(!T)return null;var z=T.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(z){var X=parseFloat(z[4]);return[(parseFloat(z[1])%360+360)%360,v(parseFloat(z[2]),0,100),v(parseFloat(z[3]),0,100),v(isNaN(X)?1:X,0,1)]}return null},E.get.hwb=function(T){if(!T)return null;var z=T.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(z){var X=parseFloat(z[4]);return[(parseFloat(z[1])%360+360)%360,v(parseFloat(z[2]),0,100),v(parseFloat(z[3]),0,100),v(isNaN(X)?1:X,0,1)]}return null},E.to.hex=function(){var T=F(arguments);return"#"+k(T[0])+k(T[1])+k(T[2])+(T[3]<1?k(Math.round(255*T[3])):"")},E.to.rgb=function(){var T=F(arguments);return T.length<4||1===T[3]?"rgb("+Math.round(T[0])+", "+Math.round(T[1])+", "+Math.round(T[2])+")":"rgba("+Math.round(T[0])+", "+Math.round(T[1])+", "+Math.round(T[2])+", "+T[3]+")"},E.to.rgb.percent=function(){var T=F(arguments),z=Math.round(T[0]/255*100),X=Math.round(T[1]/255*100),b=Math.round(T[2]/255*100);return T.length<4||1===T[3]?"rgb("+z+"%, "+X+"%, "+b+"%)":"rgba("+z+"%, "+X+"%, "+b+"%, "+T[3]+")"},E.to.hsl=function(){var T=F(arguments);return T.length<4||1===T[3]?"hsl("+T[0]+", "+T[1]+"%, "+T[2]+"%)":"hsla("+T[0]+", "+T[1]+"%, "+T[2]+"%, "+T[3]+")"},E.to.hwb=function(){var T=F(arguments),z="";return T.length>=4&&1!==T[3]&&(z=", "+T[3]),"hwb("+T[0]+", "+T[1]+"%, "+T[2]+"%"+z+")"},E.to.keyword=function(T){return u[T.slice(0,3)]}},12814:(T,z,X)=>{const b=X(12819),F=X(12836),A=["keyword","gray","hex"],u={};for(const c of Object.keys(F))u[[...F[c].labels].sort().join("")]=c;const y={};function E(T,z){if(!(this instanceof E))return new E(T,z);if(z&&z in A&&(z=null),z&&!(z in F))throw new Error("Unknown model: "+z);let X,v;if(null==T)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(T instanceof E)this.model=T.model,this.color=[...T.color],this.valpha=T.valpha;else if("string"===typeof T){const z=b.get(T);if(null===z)throw new Error("Unable to parse color from string: "+T);this.model=z.model,v=F[this.model].channels,this.color=z.value.slice(0,v),this.valpha="number"===typeof z.value[v]?z.value[v]:1}else if(T.length>0){this.model=z||"rgb",v=F[this.model].channels;const X=Array.prototype.slice.call(T,0,v);this.color=D(X,v),this.valpha="number"===typeof T[v]?T[v]:1}else if("number"===typeof T)this.model="rgb",this.color=[T>>16&255,T>>8&255,255&T],this.valpha=1;else{this.valpha=1;const z=Object.keys(T);"alpha"in T&&(z.splice(z.indexOf("alpha"),1),this.valpha="number"===typeof T.alpha?T.alpha:0);const b=z.sort().join("");if(!(b in u))throw new Error("Unable to parse color from object: "+JSON.stringify(T));this.model=u[b];const{labels:A}=F[this.model],y=[];for(X=0;X<A.length;X++)y.push(T[A[X]]);this.color=D(y)}if(y[this.model])for(v=F[this.model].channels,X=0;X<v;X++){const T=y[this.model][X];T&&(this.color[X]=T(this.color[X]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}E.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(T){let z=this.model in b.to?this:this.rgb();z=z.round("number"===typeof T?T:1);const X=1===z.valpha?z.color:[...z.color,this.valpha];return b.to[z.model](X)},percentString(T){const z=this.rgb().round("number"===typeof T?T:1),X=1===z.valpha?z.color:[...z.color,this.valpha];return b.to.rgb.percent(X)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const T={},{channels:z}=F[this.model],{labels:X}=F[this.model];for(let b=0;b<z;b++)T[X[b]]=this.color[b];return 1!==this.valpha&&(T.alpha=this.valpha),T},unitArray(){const T=this.rgb().color;return T[0]/=255,T[1]/=255,T[2]/=255,1!==this.valpha&&T.push(this.valpha),T},unitObject(){const T=this.rgb().object();return T.r/=255,T.g/=255,T.b/=255,1!==this.valpha&&(T.alpha=this.valpha),T},round(T){return T=Math.max(T||0,0),new E([...this.color.map(v(T)),this.valpha],this.model)},alpha(T){return void 0!==T?new E([...this.color,Math.max(0,Math.min(1,T))],this.model):this.valpha},red:k("rgb",0,L(255)),green:k("rgb",1,L(255)),blue:k("rgb",2,L(255)),hue:k(["hsl","hsv","hsl","hwb","hcg"],0,(T=>(T%360+360)%360)),saturationl:k("hsl",1,L(100)),lightness:k("hsl",2,L(100)),saturationv:k("hsv",1,L(100)),value:k("hsv",2,L(100)),chroma:k("hcg",1,L(100)),gray:k("hcg",2,L(100)),white:k("hwb",1,L(100)),wblack:k("hwb",2,L(100)),cyan:k("cmyk",0,L(100)),magenta:k("cmyk",1,L(100)),yellow:k("cmyk",2,L(100)),black:k("cmyk",3,L(100)),x:k("xyz",0,L(95.047)),y:k("xyz",1,L(100)),z:k("xyz",2,L(108.833)),l:k("lab",0,L(100)),a:k("lab",1),b:k("lab",2),keyword(T){return void 0!==T?new E(T):F[this.model].keyword(this.color)},hex(T){return void 0!==T?new E(T):b.to.hex(this.rgb().round().color)},hexa(T){if(void 0!==T)return new E(T);const z=this.rgb().round().color;let X=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===X.length&&(X="0"+X),b.to.hex(z)+X},rgbNumber(){const T=this.rgb().color;return(255&T[0])<<16|(255&T[1])<<8|255&T[2]},luminosity(){const T=this.rgb().color,z=[];for(const[X,b]of T.entries()){const T=b/255;z[X]=T<=.04045?T/12.92:((T+.055)/1.055)**2.4}return.2126*z[0]+.7152*z[1]+.0722*z[2]},contrast(T){const z=this.luminosity(),X=T.luminosity();return z>X?(z+.05)/(X+.05):(X+.05)/(z+.05)},level(T){const z=this.contrast(T);return z>=7?"AAA":z>=4.5?"AA":""},isDark(){const T=this.rgb().color;return(2126*T[0]+7152*T[1]+722*T[2])/1e4<128},isLight(){return!this.isDark()},negate(){const T=this.rgb();for(let z=0;z<3;z++)T.color[z]=255-T.color[z];return T},lighten(T){const z=this.hsl();return z.color[2]+=z.color[2]*T,z},darken(T){const z=this.hsl();return z.color[2]-=z.color[2]*T,z},saturate(T){const z=this.hsl();return z.color[1]+=z.color[1]*T,z},desaturate(T){const z=this.hsl();return z.color[1]-=z.color[1]*T,z},whiten(T){const z=this.hwb();return z.color[1]+=z.color[1]*T,z},blacken(T){const z=this.hwb();return z.color[2]+=z.color[2]*T,z},grayscale(){const T=this.rgb().color,z=.3*T[0]+.59*T[1]+.11*T[2];return E.rgb(z,z,z)},fade(T){return this.alpha(this.valpha-this.valpha*T)},opaquer(T){return this.alpha(this.valpha+this.valpha*T)},rotate(T){const z=this.hsl();let X=z.color[0];return X=(X+T)%360,X=X<0?360+X:X,z.color[0]=X,z},mix(T,z){if(!T||!T.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof T);const X=T.rgb(),b=this.rgb(),F=void 0===z?.5:z,A=2*F-1,u=X.alpha()-b.alpha(),y=((A*u===-1?A:(A+u)/(1+A*u))+1)/2,v=1-y;return E.rgb(y*X.red()+v*b.red(),y*X.green()+v*b.green(),y*X.blue()+v*b.blue(),X.alpha()*F+b.alpha()*(1-F))}};for(const c of Object.keys(F)){if(A.includes(c))continue;const{channels:T}=F[c];E.prototype[c]=function(){if(this.model===c)return new E(this);for(var T=arguments.length,z=new Array(T),X=0;X<T;X++)z[X]=arguments[X];return z.length>0?new E(z,c):new E([...(b=F[this.model][c].raw(this.color),Array.isArray(b)?b:[b]),this.valpha],c);var b},E[c]=function(){for(var z=arguments.length,X=new Array(z),b=0;b<z;b++)X[b]=arguments[b];let F=X[0];return"number"===typeof F&&(F=D(X,T)),new E(F,c)}}function v(T){return function(z){return function(T,z){return Number(T.toFixed(z))}(z,T)}}function k(T,z,X){T=Array.isArray(T)?T:[T];for(const b of T)(y[b]||(y[b]=[]))[z]=X;return T=T[0],function(b){let F;return void 0!==b?(X&&(b=X(b)),F=this[T](),F.color[z]=b,F):(F=this[T]().color[z],X&&(F=X(F)),F)}}function L(T){return function(z){return Math.max(0,Math.min(T,z))}}function D(T,z){for(let X=0;X<z;X++)"number"!==typeof T[X]&&(T[X]=0);return T}T.exports=E},12842:(T,z,X)=>{const b=X(12850),F={};for(const u of Object.keys(b))F[b[u]]=u;const A={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};T.exports=A;for(const u of Object.keys(A)){if(!("channels"in A[u]))throw new Error("missing channels property: "+u);if(!("labels"in A[u]))throw new Error("missing channel labels property: "+u);if(A[u].labels.length!==A[u].channels)throw new Error("channel and label counts mismatch: "+u);const{channels:T,labels:z}=A[u];delete A[u].channels,delete A[u].labels,Object.defineProperty(A[u],"channels",{value:T}),Object.defineProperty(A[u],"labels",{value:z})}A.rgb.hsl=function(T){const z=T[0]/255,X=T[1]/255,b=T[2]/255,F=Math.min(z,X,b),A=Math.max(z,X,b),u=A-F;let y,E;A===F?y=0:z===A?y=(X-b)/u:X===A?y=2+(b-z)/u:b===A&&(y=4+(z-X)/u),y=Math.min(60*y,360),y<0&&(y+=360);const v=(F+A)/2;return E=A===F?0:v<=.5?u/(A+F):u/(2-A-F),[y,100*E,100*v]},A.rgb.hsv=function(T){let z,X,b,F,A;const u=T[0]/255,y=T[1]/255,E=T[2]/255,v=Math.max(u,y,E),k=v-Math.min(u,y,E),L=function(T){return(v-T)/6/k+.5};return 0===k?(F=0,A=0):(A=k/v,z=L(u),X=L(y),b=L(E),u===v?F=b-X:y===v?F=1/3+z-b:E===v&&(F=2/3+X-z),F<0?F+=1:F>1&&(F-=1)),[360*F,100*A,100*v]},A.rgb.hwb=function(T){const z=T[0],X=T[1];let b=T[2];const F=A.rgb.hsl(T)[0],u=1/255*Math.min(z,Math.min(X,b));return b=1-1/255*Math.max(z,Math.max(X,b)),[F,100*u,100*b]},A.rgb.cmyk=function(T){const z=T[0]/255,X=T[1]/255,b=T[2]/255,F=Math.min(1-z,1-X,1-b);return[100*((1-z-F)/(1-F)||0),100*((1-X-F)/(1-F)||0),100*((1-b-F)/(1-F)||0),100*F]},A.rgb.keyword=function(T){const z=F[T];if(z)return z;let X,A=1/0;for(const F of Object.keys(b)){const z=b[F],E=(y=z,((u=T)[0]-y[0])**2+(u[1]-y[1])**2+(u[2]-y[2])**2);E<A&&(A=E,X=F)}var u,y;return X},A.keyword.rgb=function(T){return b[T]},A.rgb.xyz=function(T){let z=T[0]/255,X=T[1]/255,b=T[2]/255;z=z>.04045?((z+.055)/1.055)**2.4:z/12.92,X=X>.04045?((X+.055)/1.055)**2.4:X/12.92,b=b>.04045?((b+.055)/1.055)**2.4:b/12.92;return[100*(.4124*z+.3576*X+.1805*b),100*(.2126*z+.7152*X+.0722*b),100*(.0193*z+.1192*X+.9505*b)]},A.rgb.lab=function(T){const z=A.rgb.xyz(T);let X=z[0],b=z[1],F=z[2];X/=95.047,b/=100,F/=108.883,X=X>.008856?X**(1/3):7.787*X+16/116,b=b>.008856?b**(1/3):7.787*b+16/116,F=F>.008856?F**(1/3):7.787*F+16/116;return[116*b-16,500*(X-b),200*(b-F)]},A.hsl.rgb=function(T){const z=T[0]/360,X=T[1]/100,b=T[2]/100;let F,A,u;if(0===X)return u=255*b,[u,u,u];F=b<.5?b*(1+X):b+X-b*X;const y=2*b-F,E=[0,0,0];for(let v=0;v<3;v++)A=z+1/3*-(v-1),A<0&&A++,A>1&&A--,u=6*A<1?y+6*(F-y)*A:2*A<1?F:3*A<2?y+(F-y)*(2/3-A)*6:y,E[v]=255*u;return E},A.hsl.hsv=function(T){const z=T[0];let X=T[1]/100,b=T[2]/100,F=X;const A=Math.max(b,.01);b*=2,X*=b<=1?b:2-b,F*=A<=1?A:2-A;return[z,100*(0===b?2*F/(A+F):2*X/(b+X)),100*((b+X)/2)]},A.hsv.rgb=function(T){const z=T[0]/60,X=T[1]/100;let b=T[2]/100;const F=Math.floor(z)%6,A=z-Math.floor(z),u=255*b*(1-X),y=255*b*(1-X*A),E=255*b*(1-X*(1-A));switch(b*=255,F){case 0:return[b,E,u];case 1:return[y,b,u];case 2:return[u,b,E];case 3:return[u,y,b];case 4:return[E,u,b];case 5:return[b,u,y]}},A.hsv.hsl=function(T){const z=T[0],X=T[1]/100,b=T[2]/100,F=Math.max(b,.01);let A,u;u=(2-X)*b;const y=(2-X)*F;return A=X*F,A/=y<=1?y:2-y,A=A||0,u/=2,[z,100*A,100*u]},A.hwb.rgb=function(T){const z=T[0]/360;let X=T[1]/100,b=T[2]/100;const F=X+b;let A;F>1&&(X/=F,b/=F);const u=Math.floor(6*z),y=1-b;A=6*z-u,0!==(1&u)&&(A=1-A);const E=X+A*(y-X);let v,k,L;switch(u){default:case 6:case 0:v=y,k=E,L=X;break;case 1:v=E,k=y,L=X;break;case 2:v=X,k=y,L=E;break;case 3:v=X,k=E,L=y;break;case 4:v=E,k=X,L=y;break;case 5:v=y,k=X,L=E}return[255*v,255*k,255*L]},A.cmyk.rgb=function(T){const z=T[0]/100,X=T[1]/100,b=T[2]/100,F=T[3]/100;return[255*(1-Math.min(1,z*(1-F)+F)),255*(1-Math.min(1,X*(1-F)+F)),255*(1-Math.min(1,b*(1-F)+F))]},A.xyz.rgb=function(T){const z=T[0]/100,X=T[1]/100,b=T[2]/100;let F,A,u;return F=3.2406*z+-1.5372*X+-.4986*b,A=-.9689*z+1.8758*X+.0415*b,u=.0557*z+-.204*X+1.057*b,F=F>.0031308?1.055*F**(1/2.4)-.055:12.92*F,A=A>.0031308?1.055*A**(1/2.4)-.055:12.92*A,u=u>.0031308?1.055*u**(1/2.4)-.055:12.92*u,F=Math.min(Math.max(0,F),1),A=Math.min(Math.max(0,A),1),u=Math.min(Math.max(0,u),1),[255*F,255*A,255*u]},A.xyz.lab=function(T){let z=T[0],X=T[1],b=T[2];z/=95.047,X/=100,b/=108.883,z=z>.008856?z**(1/3):7.787*z+16/116,X=X>.008856?X**(1/3):7.787*X+16/116,b=b>.008856?b**(1/3):7.787*b+16/116;return[116*X-16,500*(z-X),200*(X-b)]},A.lab.xyz=function(T){let z,X,b;X=(T[0]+16)/116,z=T[1]/500+X,b=X-T[2]/200;const F=X**3,A=z**3,u=b**3;return X=F>.008856?F:(X-16/116)/7.787,z=A>.008856?A:(z-16/116)/7.787,b=u>.008856?u:(b-16/116)/7.787,z*=95.047,X*=100,b*=108.883,[z,X,b]},A.lab.lch=function(T){const z=T[0],X=T[1],b=T[2];let F;F=360*Math.atan2(b,X)/2/Math.PI,F<0&&(F+=360);return[z,Math.sqrt(X*X+b*b),F]},A.lch.lab=function(T){const z=T[0],X=T[1],b=T[2]/360*2*Math.PI;return[z,X*Math.cos(b),X*Math.sin(b)]},A.rgb.ansi16=function(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[X,b,F]=T;let u=null===z?A.rgb.hsv(T)[2]:z;if(u=Math.round(u/50),0===u)return 30;let y=30+(Math.round(F/255)<<2|Math.round(b/255)<<1|Math.round(X/255));return 2===u&&(y+=60),y},A.hsv.ansi16=function(T){return A.rgb.ansi16(A.hsv.rgb(T),T[2])},A.rgb.ansi256=function(T){const z=T[0],X=T[1],b=T[2];if(z===X&&X===b)return z<8?16:z>248?231:Math.round((z-8)/247*24)+232;return 16+36*Math.round(z/255*5)+6*Math.round(X/255*5)+Math.round(b/255*5)},A.ansi16.rgb=function(T){let z=T%10;if(0===z||7===z)return T>50&&(z+=3.5),z=z/10.5*255,[z,z,z];const X=.5*(1+~~(T>50));return[(1&z)*X*255,(z>>1&1)*X*255,(z>>2&1)*X*255]},A.ansi256.rgb=function(T){if(T>=232){const z=10*(T-232)+8;return[z,z,z]}let z;T-=16;return[Math.floor(T/36)/5*255,Math.floor((z=T%36)/6)/5*255,z%6/5*255]},A.rgb.hex=function(T){const z=(((255&Math.round(T[0]))<<16)+((255&Math.round(T[1]))<<8)+(255&Math.round(T[2]))).toString(16).toUpperCase();return"000000".substring(z.length)+z},A.hex.rgb=function(T){const z=T.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!z)return[0,0,0];let X=z[0];3===z[0].length&&(X=X.split("").map((T=>T+T)).join(""));const b=parseInt(X,16);return[b>>16&255,b>>8&255,255&b]},A.rgb.hcg=function(T){const z=T[0]/255,X=T[1]/255,b=T[2]/255,F=Math.max(Math.max(z,X),b),A=Math.min(Math.min(z,X),b),u=F-A;let y,E;return y=u<1?A/(1-u):0,E=u<=0?0:F===z?(X-b)/u%6:F===X?2+(b-z)/u:4+(z-X)/u,E/=6,E%=1,[360*E,100*u,100*y]},A.hsl.hcg=function(T){const z=T[1]/100,X=T[2]/100,b=X<.5?2*z*X:2*z*(1-X);let F=0;return b<1&&(F=(X-.5*b)/(1-b)),[T[0],100*b,100*F]},A.hsv.hcg=function(T){const z=T[1]/100,X=T[2]/100,b=z*X;let F=0;return b<1&&(F=(X-b)/(1-b)),[T[0],100*b,100*F]},A.hcg.rgb=function(T){const z=T[0]/360,X=T[1]/100,b=T[2]/100;if(0===X)return[255*b,255*b,255*b];const F=[0,0,0],A=z%1*6,u=A%1,y=1-u;let E=0;switch(Math.floor(A)){case 0:F[0]=1,F[1]=u,F[2]=0;break;case 1:F[0]=y,F[1]=1,F[2]=0;break;case 2:F[0]=0,F[1]=1,F[2]=u;break;case 3:F[0]=0,F[1]=y,F[2]=1;break;case 4:F[0]=u,F[1]=0,F[2]=1;break;default:F[0]=1,F[1]=0,F[2]=y}return E=(1-X)*b,[255*(X*F[0]+E),255*(X*F[1]+E),255*(X*F[2]+E)]},A.hcg.hsv=function(T){const z=T[1]/100,X=z+T[2]/100*(1-z);let b=0;return X>0&&(b=z/X),[T[0],100*b,100*X]},A.hcg.hsl=function(T){const z=T[1]/100,X=T[2]/100*(1-z)+.5*z;let b=0;return X>0&&X<.5?b=z/(2*X):X>=.5&&X<1&&(b=z/(2*(1-X))),[T[0],100*b,100*X]},A.hcg.hwb=function(T){const z=T[1]/100,X=z+T[2]/100*(1-z);return[T[0],100*(X-z),100*(1-X)]},A.hwb.hcg=function(T){const z=T[1]/100,X=1-T[2]/100,b=X-z;let F=0;return b<1&&(F=(X-b)/(1-b)),[T[0],100*b,100*F]},A.apple.rgb=function(T){return[T[0]/65535*255,T[1]/65535*255,T[2]/65535*255]},A.rgb.apple=function(T){return[T[0]/255*65535,T[1]/255*65535,T[2]/255*65535]},A.gray.rgb=function(T){return[T[0]/100*255,T[0]/100*255,T[0]/100*255]},A.gray.hsl=function(T){return[0,0,T[0]]},A.gray.hsv=A.gray.hsl,A.gray.hwb=function(T){return[0,100,T[0]]},A.gray.cmyk=function(T){return[0,0,0,T[0]]},A.gray.lab=function(T){return[T[0],0,0]},A.gray.hex=function(T){const z=255&Math.round(T[0]/100*255),X=((z<<16)+(z<<8)+z).toString(16).toUpperCase();return"000000".substring(X.length)+X},A.rgb.gray=function(T){return[(T[0]+T[1]+T[2])/3/255*100]}},12836:(T,z,X)=>{const b=X(12842),F=X(12854),A={};Object.keys(b).forEach((T=>{A[T]={},Object.defineProperty(A[T],"channels",{value:b[T].channels}),Object.defineProperty(A[T],"labels",{value:b[T].labels});const z=F(T);Object.keys(z).forEach((X=>{const b=z[X];A[T][X]=function(T){const z=function(){for(var z=arguments.length,X=new Array(z),b=0;b<z;b++)X[b]=arguments[b];const F=X[0];if(void 0===F||null===F)return F;F.length>1&&(X=F);const A=T(X);if("object"===typeof A)for(let T=A.length,u=0;u<T;u++)A[u]=Math.round(A[u]);return A};return"conversion"in T&&(z.conversion=T.conversion),z}(b),A[T][X].raw=function(T){const z=function(){for(var z=arguments.length,X=new Array(z),b=0;b<z;b++)X[b]=arguments[b];const F=X[0];return void 0===F||null===F?F:(F.length>1&&(X=F),T(X))};return"conversion"in T&&(z.conversion=T.conversion),z}(b)}))})),T.exports=A},12854:(T,z,X)=>{const b=X(12842);function F(T){const z=function(){const T={},z=Object.keys(b);for(let X=z.length,b=0;b<X;b++)T[z[b]]={distance:-1,parent:null};return T}(),X=[T];for(z[T].distance=0;X.length;){const T=X.pop(),F=Object.keys(b[T]);for(let b=F.length,A=0;A<b;A++){const b=F[A],u=z[b];-1===u.distance&&(u.distance=z[T].distance+1,u.parent=T,X.unshift(b))}}return z}function A(T,z){return function(X){return z(T(X))}}function u(T,z){const X=[z[T].parent,T];let F=b[z[T].parent][T],u=z[T].parent;for(;z[u].parent;)X.unshift(z[u].parent),F=A(b[z[u].parent][u],F),u=z[u].parent;return F.conversion=X,F}T.exports=function(T){const z=F(T),X={},b=Object.keys(z);for(let F=b.length,A=0;A<F;A++){const T=b[A];null!==z[T].parent&&(X[T]=u(T,z))}return X}},12850:T=>{"use strict";T.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11750:function(T,z,X){"use strict";var b=this&&this.__createBinding||(Object.create?function(T,z,X,b){void 0===b&&(b=X);var F=Object.getOwnPropertyDescriptor(z,X);F&&!("get"in F?!z.__esModule:F.writable||F.configurable)||(F={enumerable:!0,get:function(){return z[X]}}),Object.defineProperty(T,b,F)}:function(T,z,X,b){void 0===b&&(b=X),T[b]=z[X]}),F=this&&this.__setModuleDefault||(Object.create?function(T,z){Object.defineProperty(T,"default",{enumerable:!0,value:z})}:function(T,z){T.default=z}),A=this&&this.__importStar||function(T){if(T&&T.__esModule)return T;var z={};if(null!=T)for(var X in T)"default"!==X&&Object.prototype.hasOwnProperty.call(T,X)&&b(z,T,X);return F(z,T),z},u=this&&this.__awaiter||function(T,z,X,b){return new(X||(X=Promise))((function(F,A){function u(T){try{E(b.next(T))}catch(z){A(z)}}function y(T){try{E(b.throw(T))}catch(z){A(z)}}function E(T){var z;T.done?F(T.value):(z=T.value,z instanceof X?z:new X((function(T){T(z)}))).then(u,y)}E((b=b.apply(T,z||[])).next())}))};Object.defineProperty(z,"__esModule",{value:!0}),z.Auth=z.Platform=void 0;const y=A(X(11695)),E=X(11755),v="colyseus-auth-token";!function(T){T.ios="ios",T.android="android"}(z.Platform||(z.Platform={}));z.Auth=class{constructor(T){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=T.replace("ws","http"),(0,E.getItem)(v,(T=>this.token=T))}get hasToken(){return!!this.token}login(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,void 0,void 0,(function*(){const z=Object.assign({},T);this.hasToken&&(z.token=this.token);const X=yield this.request("post","/auth",z);this.token=X.token,(0,E.setItem)(v,this.token);for(let T in X)this.hasOwnProperty(T)&&(this[T]=X[T]);return this.registerPingService(),this}))}save(){return u(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return u(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return u(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return u(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(T){return u(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:T})}))}acceptFriendRequest(T){return u(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:T})}))}declineFriendRequest(T){return u(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:T})}))}blockUser(T){return u(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:T})}))}unblockUser(T){return u(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:T})}))}request(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},b=arguments.length>3?arguments[3]:void 0,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return u(this,void 0,void 0,(function*(){F.Accept="application/json",this.hasToken&&(F.Authorization="Bearer "+this.token);const A=[];for(const T in X)A.push(`${T}=${X[T]}`);const u=A.length>0?`?${A.join("&")}`:"",E={headers:F};return b&&(E.body=b),(yield y[T](`${this.endpoint}${z}${u}`,E)).data}))}logout(){this.token=void 0,(0,E.removeItem)(v),this.unregisterPingService()}registerPingService(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),T)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11687:function(T,z,X){"use strict";var b,F=this&&this.__awaiter||function(T,z,X,b){return new(X||(X=Promise))((function(F,A){function u(T){try{E(b.next(T))}catch(z){A(z)}}function y(T){try{E(b.throw(T))}catch(z){A(z)}}function E(T){var z;T.done?F(T.value):(z=T.value,z instanceof X?z:new X((function(T){T(z)}))).then(u,y)}E((b=b.apply(T,z||[])).next())}))};Object.defineProperty(z,"__esModule",{value:!0}),z.Client=z.MatchMakeError=void 0;const A=X(11695),u=X(11699),y=X(11703);class E extends Error{constructor(T,z){super(T),this.code=z,Object.setPrototypeOf(this,E.prototype)}}z.MatchMakeError=E;const v="undefined"!==typeof window&&"undefined"!==typeof(null===(b=null===window||void 0===window?void 0:window.location)||void 0===b?void 0:b.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";z.Client=class{constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v;if("string"===typeof T){const z=new URL(T),X="https:"===z.protocol||"wss:"===z.protocol,b=Number(z.port||(X?443:80));this.settings={hostname:z.hostname,pathname:"/"!==z.pathname?z.pathname:"",port:b,secure:X}}else void 0===T.port&&(T.port=T.secure?443:80),void 0===T.pathname&&(T.pathname=""),this.settings=T}joinOrCreate(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2?arguments[2]:void 0;return F(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",T,z,X)}))}create(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2?arguments[2]:void 0;return F(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",T,z,X)}))}join(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2?arguments[2]:void 0;return F(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",T,z,X)}))}joinById(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2?arguments[2]:void 0;return F(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",T,z,X)}))}reconnect(T,z){return F(this,void 0,void 0,(function*(){if("string"===typeof T&&"string"===typeof z)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[X,b]=T.split(":");return yield this.createMatchMakeRequest("reconnect",X,{reconnectionToken:b},z)}))}getAvailableRooms(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return F(this,void 0,void 0,(function*(){return(yield(0,A.get)(this.getHttpEndpoint(`${T}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(T,z,X){return F(this,void 0,void 0,(function*(){const b=this.createRoom(T.room.name,z);b.roomId=T.room.roomId,b.sessionId=T.sessionId;const A={sessionId:b.sessionId};T.reconnectionToken&&(A.reconnectionToken=T.reconnectionToken);const y=X||b;return b.connect(this.buildEndpoint(T.room,A),T.devMode&&(()=>F(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${b.roomId}'...`);let X=0;const A=()=>F(this,void 0,void 0,(function*(){X++;try{yield this.consumeSeatReservation(T,z,y),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${b.roomId}'`)}catch(F){X<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${X} out of 8)`),setTimeout(A,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(A,2e3)}))),y),new Promise(((T,z)=>{const X=(T,X)=>z(new u.ServerError(T,X));y.onError.once(X),y.onJoin.once((()=>{y.onError.remove(X),T(y)}))}))}))}createMatchMakeRequest(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},b=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0;return F(this,void 0,void 0,(function*(){const F=(yield(0,A.post)(this.getHttpEndpoint(`${T}/${z}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(X)})).data;if(F.error)throw new E(F.error,F.code);return"reconnect"===T&&(F.reconnectionToken=X.reconnectionToken),yield this.consumeSeatReservation(F,b,u)}))}createRoom(T,z){return new y.Room(T,z)}buildEndpoint(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const X=[];for(const F in z)z.hasOwnProperty(F)&&X.push(`${F}=${z[F]}`);let b=this.settings.secure?"wss://":"ws://";return T.publicAddress?b+=`${T.publicAddress}`:b+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${b}/${T.processId}/${T.roomId}?${X.join("&")}`}getHttpEndpoint(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${T}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11712:(T,z,X)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0}),z.Connection=void 0;const b=X(11716);z.Connection=class{constructor(){this.events={},this.transport=new b.WebSocketTransport(this.events)}send(T){this.transport.send(T)}connect(T){this.transport.connect(T)}close(T,z){this.transport.close(T,z)}get isOpen(){return this.transport.isOpen}}},11727:(T,z)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0}),z.utf8Length=z.utf8Read=z.ErrorCode=z.Protocol=void 0,function(T){T[T.HANDSHAKE=9]="HANDSHAKE",T[T.JOIN_ROOM=10]="JOIN_ROOM",T[T.ERROR=11]="ERROR",T[T.LEAVE_ROOM=12]="LEAVE_ROOM",T[T.ROOM_DATA=13]="ROOM_DATA",T[T.ROOM_STATE=14]="ROOM_STATE",T[T.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",T[T.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",T[T.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(z.Protocol||(z.Protocol={})),function(T){T[T.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",T[T.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",T[T.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",T[T.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",T[T.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",T[T.AUTH_FAILED=4215]="AUTH_FAILED",T[T.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(z.ErrorCode||(z.ErrorCode={})),z.utf8Read=function(T,z){const X=T[z++];for(var b="",F=0,A=z,u=z+X;A<u;A++){var y=T[A];if(0!==(128&y))if(192!==(224&y))if(224!==(240&y)){if(240!==(248&y))throw new Error("Invalid byte "+y.toString(16));(F=(7&y)<<18|(63&T[++A])<<12|(63&T[++A])<<6|63&T[++A])>=65536?(F-=65536,b+=String.fromCharCode(55296+(F>>>10),56320+(1023&F))):b+=String.fromCharCode(F)}else b+=String.fromCharCode((15&y)<<12|(63&T[++A])<<6|63&T[++A]);else b+=String.fromCharCode((31&y)<<6|63&T[++A]);else b+=String.fromCharCode(y)}return b},z.utf8Length=function(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",z=0,X=0;for(let b=0,F=T.length;b<F;b++)z=T.charCodeAt(b),z<128?X+=1:z<2048?X+=2:z<55296||z>=57344?X+=3:(b++,X+=4);return X+1}},11703:function(T,z,X){"use strict";var b=this&&this.__createBinding||(Object.create?function(T,z,X,b){void 0===b&&(b=X);var F=Object.getOwnPropertyDescriptor(z,X);F&&!("get"in F?!z.__esModule:F.writable||F.configurable)||(F={enumerable:!0,get:function(){return z[X]}}),Object.defineProperty(T,b,F)}:function(T,z,X,b){void 0===b&&(b=X),T[b]=z[X]}),F=this&&this.__setModuleDefault||(Object.create?function(T,z){Object.defineProperty(T,"default",{enumerable:!0,value:z})}:function(T,z){T.default=z}),A=this&&this.__importStar||function(T){if(T&&T.__esModule)return T;var z={};if(null!=T)for(var X in T)"default"!==X&&Object.prototype.hasOwnProperty.call(T,X)&&b(z,T,X);return F(z,T),z};Object.defineProperty(z,"__esModule",{value:!0}),z.Room=void 0;const u=A(X(11705)),y=X(11712),E=X(11727),v=X(11731),k=X(11739),L=X(11741),D=X(11747),c=X(11699);class p{constructor(T,z){this.onStateChange=(0,L.createSignal)(),this.onError=(0,L.createSignal)(),this.onLeave=(0,L.createSignal)(),this.onJoin=(0,L.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,k.createNanoEvents)(),this.roomId=null,this.name=T,z&&(this.serializer=new((0,v.getSerializer)("schema")),this.rootSchema=z,this.serializer.state=new z),this.onError(((T,z)=>{var X;return null===(X=console.warn)||void 0===X?void 0:X.call(console,`colyseus.js - onError => (${T}) ${z}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const b=new y.Connection;X.connection=b,b.events.onmessage=p.prototype.onMessageCallback.bind(X),b.events.onclose=function(T){var b;if(!X.hasJoined)return null===(b=console.warn)||void 0===b||b.call(console,`Room connection was closed unexpectedly (${T.code}): ${T.reason}`),void X.onError.invoke(T.code,T.reason);T.code===c.CloseCode.DEVMODE_RESTART&&z?z():(X.onLeave.invoke(T.code),X.destroy())},b.events.onerror=function(T){var z;null===(z=console.warn)||void 0===z||z.call(console,`Room, onError (${T.code}): ${T.reason}`),X.onError.invoke(T.code,T.reason)},b.connect(T)}leave(){let T=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((z=>{this.onLeave((T=>z(T))),this.connection?T?this.connection.send([E.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(c.CloseCode.CONSENTED)}))}onMessage(T,z){return this.onMessageHandlers.on(this.getMessageHandlerKey(T),z)}send(T,z){const X=[E.Protocol.ROOM_DATA];let b;if("string"===typeof T?D.encode.string(X,T):D.encode.number(X,T),void 0!==z){const T=u.encode(z);b=new Uint8Array(X.length+T.byteLength),b.set(new Uint8Array(X),0),b.set(new Uint8Array(T),X.length)}else b=new Uint8Array(X);this.connection.send(b.buffer)}sendBytes(T,z){const X=[E.Protocol.ROOM_DATA_BYTES];let b;"string"===typeof T?D.encode.string(X,T):D.encode.number(X,T),b=new Uint8Array(X.length+(z.byteLength||z.length)),b.set(new Uint8Array(X),0),b.set(new Uint8Array(z),X.length),this.connection.send(b.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(T){const z=Array.from(new Uint8Array(T.data)),X=z[0];if(X===E.Protocol.JOIN_ROOM){let T=1;const X=(0,E.utf8Read)(z,T);if(T+=(0,E.utf8Length)(X),this.serializerId=(0,E.utf8Read)(z,T),T+=(0,E.utf8Length)(this.serializerId),!this.serializer){const T=(0,v.getSerializer)(this.serializerId);this.serializer=new T}z.length>T&&this.serializer.handshake&&this.serializer.handshake(z,{offset:T}),this.reconnectionToken=`${this.roomId}:${X}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([E.Protocol.JOIN_ROOM])}else if(X===E.Protocol.ERROR){const T={offset:1},X=D.decode.number(z,T),b=D.decode.string(z,T);this.onError.invoke(X,b)}else if(X===E.Protocol.LEAVE_ROOM)this.leave();else if(X===E.Protocol.ROOM_DATA_SCHEMA){const T={offset:1},X=this.serializer.getState().constructor._context.get(D.decode.number(z,T)),b=new X;b.decode(z,T),this.dispatchMessage(X,b)}else if(X===E.Protocol.ROOM_STATE)z.shift(),this.setState(z);else if(X===E.Protocol.ROOM_STATE_PATCH)z.shift(),this.patch(z);else if(X===E.Protocol.ROOM_DATA){const X={offset:1},b=D.decode.stringCheck(z,X)?D.decode.string(z,X):D.decode.number(z,X),F=z.length>X.offset?u.decode(T.data,X.offset):void 0;this.dispatchMessage(b,F)}else if(X===E.Protocol.ROOM_DATA_BYTES){const T={offset:1},X=D.decode.stringCheck(z,T)?D.decode.string(z,T):D.decode.number(z,T);this.dispatchMessage(X,new Uint8Array(z.slice(T.offset)))}}setState(T){this.serializer.setState(T),this.onStateChange.invoke(this.serializer.getState())}patch(T){this.serializer.patch(T),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(T,z){var X;const b=this.getMessageHandlerKey(T);this.onMessageHandlers.events[b]?this.onMessageHandlers.emit(b,z):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",T,z):null===(X=console.warn)||void 0===X||X.call(console,`colyseus.js: onMessage() not registered for type '${T}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(T){switch(typeof T){case"function":return`$${T._typeid}`;case"string":return T;case"number":return`i${T}`;default:throw new Error("invalid message type.")}}}z.Room=p},11755:(T,z)=>{"use strict";let X;function b(){return X||(X="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(T,z){this.cache[T]=z},getItem:function(T){this.cache[T]},removeItem:function(T){delete this.cache[T]}}),X}Object.defineProperty(z,"__esModule",{value:!0}),z.getItem=z.removeItem=z.setItem=void 0,z.setItem=function(T,z){b().setItem(T,z)},z.removeItem=function(T){b().removeItem(T)},z.getItem=function(T,z){const X=b().getItem(T);"undefined"!==typeof Promise&&X instanceof Promise?X.then((T=>z(T))):z(X)}},11739:(T,z)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0}),z.createNanoEvents=void 0;z.createNanoEvents=()=>({emit(T){let z=this.events[T]||[];for(var X=arguments.length,b=new Array(X>1?X-1:0),F=1;F<X;F++)b[F-1]=arguments[F];for(let A=0,u=z.length;A<u;A++)z[A](...b)},events:{},on(T,z){var X;return(null===(X=this.events[T])||void 0===X?void 0:X.push(z))||(this.events[T]=[z]),()=>{var X;this.events[T]=null===(X=this.events[T])||void 0===X?void 0:X.filter((T=>z!==T))}}})},11741:(T,z)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0}),z.createSignal=z.EventEmitter=void 0;class X{constructor(){this.handlers=[]}register(T){return this.handlers.push(T),this}invoke(){for(var T=arguments.length,z=new Array(T),X=0;X<T;X++)z[X]=arguments[X];this.handlers.forEach((T=>T.apply(this,z)))}invokeAsync(){for(var T=arguments.length,z=new Array(T),X=0;X<T;X++)z[X]=arguments[X];return Promise.all(this.handlers.map((T=>T.apply(this,z))))}remove(T){const z=this.handlers.indexOf(T);this.handlers[z]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}z.EventEmitter=X,z.createSignal=function(){const T=new X;function z(z){return T.register(z,null===this)}return z.once=z=>{const X=function(){for(var b=arguments.length,F=new Array(b),A=0;A<b;A++)F[A]=arguments[A];z.apply(this,F),T.remove(X)};T.register(X)},z.remove=z=>T.remove(z),z.invoke=function(){return T.invoke(...arguments)},z.invokeAsync=function(){return T.invokeAsync(...arguments)},z.clear=()=>T.clear(),z}},11699:(T,z)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0}),z.ServerError=z.CloseCode=void 0,function(T){T[T.CONSENTED=4e3]="CONSENTED",T[T.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(z.CloseCode||(z.CloseCode={}));class X extends Error{constructor(T,z){super(z),this.name="ServerError",this.code=T}}z.ServerError=X},11676:(T,z,X)=>{"use strict";z.d=void 0,X(11684);var b=X(11687);Object.defineProperty(z,"d",{enumerable:!0,get:function(){return b.Client}});var F=X(11727);var A=X(11703);var u=X(11750);const y=X(11758);const E=X(11764),v=X(11731);(0,v.registerSerializer)("schema",y.SchemaSerializer),(0,v.registerSerializer)("none",E.NoneSerializer)},11684:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=T=>null!==T&&"object"===typeof T&&T.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11705:(T,z)=>{"use strict";function X(T,z){if(this._offset=z,T instanceof ArrayBuffer)this._buffer=T,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(T))throw new Error("Invalid argument");this._buffer=T.buffer,this._view=new DataView(this._buffer,T.byteOffset,T.byteLength)}}Object.defineProperty(z,"__esModule",{value:!0}),z.decode=z.encode=void 0,X.prototype._array=function(T){for(var z=new Array(T),X=0;X<T;X++)z[X]=this._parse();return z},X.prototype._map=function(T){for(var z={},X=0;X<T;X++)z[this._parse()]=this._parse();return z},X.prototype._str=function(T){var z=function(T,z,X){for(var b="",F=0,A=z,u=z+X;A<u;A++){var y=T.getUint8(A);if(0!==(128&y))if(192!==(224&y))if(224!==(240&y)){if(240!==(248&y))throw new Error("Invalid byte "+y.toString(16));(F=(7&y)<<18|(63&T.getUint8(++A))<<12|(63&T.getUint8(++A))<<6|63&T.getUint8(++A))>=65536?(F-=65536,b+=String.fromCharCode(55296+(F>>>10),56320+(1023&F))):b+=String.fromCharCode(F)}else b+=String.fromCharCode((15&y)<<12|(63&T.getUint8(++A))<<6|63&T.getUint8(++A));else b+=String.fromCharCode((31&y)<<6|63&T.getUint8(++A));else b+=String.fromCharCode(y)}return b}(this._view,this._offset,T);return this._offset+=T,z},X.prototype._bin=function(T){var z=this._buffer.slice(this._offset,this._offset+T);return this._offset+=T,z},X.prototype._parse=function(){var T,z=this._view.getUint8(this._offset++),X=0,b=0,F=0,A=0;if(z<192)return z<128?z:z<144?this._map(15&z):z<160?this._array(15&z):this._str(31&z);if(z>223)return-1*(255-z+1);switch(z){case 192:return null;case 194:return!1;case 195:return!0;case 196:return X=this._view.getUint8(this._offset),this._offset+=1,this._bin(X);case 197:return X=this._view.getUint16(this._offset),this._offset+=2,this._bin(X);case 198:return X=this._view.getUint32(this._offset),this._offset+=4,this._bin(X);case 199:if(X=this._view.getUint8(this._offset),b=this._view.getInt8(this._offset+1),this._offset+=2,-1===b){var u=this._view.getUint32(this._offset);return F=this._view.getInt32(this._offset+4),A=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*F+A)+u/1e6)}return[b,this._bin(X)];case 200:return X=this._view.getUint16(this._offset),b=this._view.getInt8(this._offset+2),this._offset+=3,[b,this._bin(X)];case 201:return X=this._view.getUint32(this._offset),b=this._view.getInt8(this._offset+4),this._offset+=5,[b,this._bin(X)];case 202:return T=this._view.getFloat32(this._offset),this._offset+=4,T;case 203:return T=this._view.getFloat64(this._offset),this._offset+=8,T;case 204:return T=this._view.getUint8(this._offset),this._offset+=1,T;case 205:return T=this._view.getUint16(this._offset),this._offset+=2,T;case 206:return T=this._view.getUint32(this._offset),this._offset+=4,T;case 207:return F=this._view.getUint32(this._offset)*Math.pow(2,32),A=this._view.getUint32(this._offset+4),this._offset+=8,F+A;case 208:return T=this._view.getInt8(this._offset),this._offset+=1,T;case 209:return T=this._view.getInt16(this._offset),this._offset+=2,T;case 210:return T=this._view.getInt32(this._offset),this._offset+=4,T;case 211:return F=this._view.getInt32(this._offset)*Math.pow(2,32),A=this._view.getUint32(this._offset+4),this._offset+=8,F+A;case 212:return b=this._view.getInt8(this._offset),this._offset+=1,0===b?void(this._offset+=1):[b,this._bin(1)];case 213:return b=this._view.getInt8(this._offset),this._offset+=1,[b,this._bin(2)];case 214:return b=this._view.getInt8(this._offset),this._offset+=1,-1===b?(T=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*T)):[b,this._bin(4)];case 215:return b=this._view.getInt8(this._offset),this._offset+=1,0===b?(F=this._view.getInt32(this._offset)*Math.pow(2,32),A=this._view.getUint32(this._offset+4),this._offset+=8,new Date(F+A)):-1===b?(F=this._view.getUint32(this._offset),A=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&F)+A)+(F>>>2)/1e6)):[b,this._bin(8)];case 216:return b=this._view.getInt8(this._offset),this._offset+=1,[b,this._bin(16)];case 217:return X=this._view.getUint8(this._offset),this._offset+=1,this._str(X);case 218:return X=this._view.getUint16(this._offset),this._offset+=2,this._str(X);case 219:return X=this._view.getUint32(this._offset),this._offset+=4,this._str(X);case 220:return X=this._view.getUint16(this._offset),this._offset+=2,this._array(X);case 221:return X=this._view.getUint32(this._offset),this._offset+=4,this._array(X);case 222:return X=this._view.getUint16(this._offset),this._offset+=2,this._map(X);case 223:return X=this._view.getUint32(this._offset),this._offset+=4,this._map(X)}throw new Error("Could not parse")},z.decode=function(T){var z=new X(T,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),b=z._parse();if(z._offset!==T.byteLength)throw new Error(T.byteLength-z._offset+" trailing bytes");return b};function b(T,z,X){for(var b=0,F=0,A=X.length;F<A;F++)(b=X.charCodeAt(F))<128?T.setUint8(z++,b):b<2048?(T.setUint8(z++,192|b>>6),T.setUint8(z++,128|63&b)):b<55296||b>=57344?(T.setUint8(z++,224|b>>12),T.setUint8(z++,128|b>>6&63),T.setUint8(z++,128|63&b)):(F++,b=65536+((1023&b)<<10|1023&X.charCodeAt(F)),T.setUint8(z++,240|b>>18),T.setUint8(z++,128|b>>12&63),T.setUint8(z++,128|b>>6&63),T.setUint8(z++,128|63&b))}function F(T,z,X){var b=typeof X,A=0,u=0,y=0,E=0,v=0,k=0;if("string"===b){if(v=function(T){for(var z=0,X=0,b=0,F=T.length;b<F;b++)(z=T.charCodeAt(b))<128?X+=1:z<2048?X+=2:z<55296||z>=57344?X+=3:(b++,X+=4);return X}(X),v<32)T.push(160|v),k=1;else if(v<256)T.push(217,v),k=2;else if(v<65536)T.push(218,v>>8,v),k=3;else{if(!(v<4294967296))throw new Error("String too long");T.push(219,v>>24,v>>16,v>>8,v),k=5}return z.push({_str:X,_length:v,_offset:T.length}),k+v}if("number"===b)return Math.floor(X)===X&&isFinite(X)?X>=0?X<128?(T.push(X),1):X<256?(T.push(204,X),2):X<65536?(T.push(205,X>>8,X),3):X<4294967296?(T.push(206,X>>24,X>>16,X>>8,X),5):(y=X/Math.pow(2,32)|0,E=X>>>0,T.push(207,y>>24,y>>16,y>>8,y,E>>24,E>>16,E>>8,E),9):X>=-32?(T.push(X),1):X>=-128?(T.push(208,X),2):X>=-32768?(T.push(209,X>>8,X),3):X>=-2147483648?(T.push(210,X>>24,X>>16,X>>8,X),5):(y=Math.floor(X/Math.pow(2,32)),E=X>>>0,T.push(211,y>>24,y>>16,y>>8,y,E>>24,E>>16,E>>8,E),9):(T.push(203),z.push({_float:X,_length:8,_offset:T.length}),9);if("object"===b){if(null===X)return T.push(192),1;if(Array.isArray(X)){if((v=X.length)<16)T.push(144|v),k=1;else if(v<65536)T.push(220,v>>8,v),k=3;else{if(!(v<4294967296))throw new Error("Array too large");T.push(221,v>>24,v>>16,v>>8,v),k=5}for(A=0;A<v;A++)k+=F(T,z,X[A]);return k}if(X instanceof Date){var L=X.getTime(),D=Math.floor(L/1e3),c=1e6*(L-1e3*D);return D>=0&&c>=0&&D<=17179869183?0===c&&D<=4294967295?(T.push(214,255,D>>24,D>>16,D>>8,D),6):(y=D/4294967296,E=4294967295&D,T.push(215,255,c>>22,c>>14,c>>6,y,E>>24,E>>16,E>>8,E),10):(y=Math.floor(D/4294967296),E=D>>>0,T.push(199,12,255,c>>24,c>>16,c>>8,c,y>>24,y>>16,y>>8,y,E>>24,E>>16,E>>8,E),15)}if(X instanceof ArrayBuffer){if((v=X.byteLength)<256)T.push(196,v),k=2;else if(v<65536)T.push(197,v>>8,v),k=3;else{if(!(v<4294967296))throw new Error("Buffer too large");T.push(198,v>>24,v>>16,v>>8,v),k=5}return z.push({_bin:X,_length:v,_offset:T.length}),k+v}if("function"===typeof X.toJSON)return F(T,z,X.toJSON());var p=[],H="",U=Object.keys(X);for(A=0,u=U.length;A<u;A++)void 0!==X[H=U[A]]&&"function"!==typeof X[H]&&p.push(H);if((v=p.length)<16)T.push(128|v),k=1;else if(v<65536)T.push(222,v>>8,v),k=3;else{if(!(v<4294967296))throw new Error("Object too large");T.push(223,v>>24,v>>16,v>>8,v),k=5}for(A=0;A<v;A++)k+=F(T,z,H=p[A]),k+=F(T,z,X[H]);return k}if("boolean"===b)return T.push(X?195:194),1;if("undefined"===b)return T.push(192),1;if("function"===typeof X.toJSON)return F(T,z,X.toJSON());throw new Error("Could not encode")}z.encode=function(T){var z=[],X=[],A=F(z,X,T),u=new ArrayBuffer(A),y=new DataView(u),E=0,v=0,k=-1;X.length>0&&(k=X[0]._offset);for(var L,D=0,c=0,p=0,H=z.length;p<H;p++)if(y.setUint8(v+p,z[p]),p+1===k){if(D=(L=X[E])._length,c=v+k,L._bin)for(var U=new Uint8Array(L._bin),s=0;s<D;s++)y.setUint8(c+s,U[s]);else L._str?b(y,c,L._str):void 0!==L._float&&y.setFloat64(c,L._float);v+=D,X[++E]&&(k=X[E]._offset)}return u}},11764:(T,z)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0}),z.NoneSerializer=void 0;z.NoneSerializer=class{setState(T){}getState(){return null}patch(T){}teardown(){}handshake(T){}}},11758:(T,z,X)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0}),z.SchemaSerializer=void 0;const b=X(11747);z.SchemaSerializer=class{setState(T){return this.state.decode(T)}getState(){return this.state}patch(T){return this.state.decode(T)}teardown(){var T,z;null===(z=null===(T=this.state)||void 0===T?void 0:T.$changes)||void 0===z||z.root.clearRefs()}handshake(T,z){if(this.state){(new b.Reflection).decode(T,z)}else this.state=b.Reflection.decode(T,z)}}},11731:(T,z)=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0}),z.getSerializer=z.registerSerializer=void 0;const X={};z.registerSerializer=function(T,z){X[T]=z},z.getSerializer=function(T){const z=X[T];if(!z)throw new Error("missing serializer: "+T);return z}},11716:function(T,z,X){"use strict";var b=this&&this.__importDefault||function(T){return T&&T.__esModule?T:{default:T}};Object.defineProperty(z,"__esModule",{value:!0}),z.WebSocketTransport=void 0;const F=b(X(11723)),A=globalThis.WebSocket||F.default;z.WebSocketTransport=class{constructor(T){this.events=T}send(T){T instanceof ArrayBuffer?this.ws.send(T):Array.isArray(T)&&this.ws.send(new Uint8Array(T).buffer)}connect(T){this.ws=new A(T,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(T,z){this.ws.close(T,z)}get isOpen(){return this.ws.readyState===A.OPEN}}},11723:T=>{"use strict";T.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},11809:T=>{"use strict";T.exports=function(T){for(var z=new Array(T),X=0;X<T;++X)z[X]=X;return z}},11813:T=>{function z(T){return!!T.constructor&&"function"===typeof T.constructor.isBuffer&&T.constructor.isBuffer(T)}T.exports=function(T){return null!=T&&(z(T)||function(T){return"function"===typeof T.readFloatLE&&"function"===typeof T.slice&&z(T.slice(0,0))}(T)||!!T._isBuffer)}},11804:(T,z,X)=>{var b=X(11809),F=X(11813),A="undefined"!==typeof Float64Array;function u(T,z){return T[0]-z[0]}function y(){var T,z=this.stride,X=new Array(z.length);for(T=0;T<X.length;++T)X[T]=[Math.abs(z[T]),T];X.sort(u);var b=new Array(X.length);for(T=0;T<b.length;++T)b[T]=X[T][1];return b}function E(T,z){var X=["View",z,"d",T].join("");z<0&&(X="View_Nil"+T);var F="generic"===T;if(-1===z){var A="function "+X+"(a){this.data=a;};var proto="+X+".prototype;proto.dtype='"+T+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+X+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+X+"(a){return new "+X+"(a);}";return new Function(A)()}if(0===z){A="function "+X+"(a,d) {this.data = a;this.offset = d};var proto="+X+".prototype;proto.dtype='"+T+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+X+"_copy() {return new "+X+"(this.data,this.offset)};proto.pick=function "+X+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+X+"_get(){return "+(F?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+X+"_set(v){return "+(F?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+X+"(a,b,c,d){return new "+X+"(a,d)}";return new Function("TrivialArray",A)(v[T][0])}A=["'use strict'"];var u=b(z),E=u.map((function(T){return"i"+T})),k="this.offset+"+u.map((function(T){return"this.stride["+T+"]*i"+T})).join("+"),L=u.map((function(T){return"b"+T})).join(","),D=u.map((function(T){return"c"+T})).join(",");A.push("function "+X+"(a,"+L+","+D+",d){this.data=a","this.shape=["+L+"]","this.stride=["+D+"]","this.offset=d|0}","var proto="+X+".prototype","proto.dtype='"+T+"'","proto.dimension="+z),A.push("Object.defineProperty(proto,'size',{get:function "+X+"_size(){return "+u.map((function(T){return"this.shape["+T+"]"})).join("*"),"}})"),1===z?A.push("proto.order=[0]"):(A.push("Object.defineProperty(proto,'order',{get:"),z<4?(A.push("function "+X+"_order(){"),2===z?A.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===z&&A.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):A.push("ORDER})")),A.push("proto.set=function "+X+"_set("+E.join(",")+",v){"),F?A.push("return this.data.set("+k+",v)}"):A.push("return this.data["+k+"]=v}"),A.push("proto.get=function "+X+"_get("+E.join(",")+"){"),F?A.push("return this.data.get("+k+")}"):A.push("return this.data["+k+"]}"),A.push("proto.index=function "+X+"_index(",E.join(),"){return "+k+"}"),A.push("proto.hi=function "+X+"_hi("+E.join(",")+"){return new "+X+"(this.data,"+u.map((function(T){return["(typeof i",T,"!=='number'||i",T,"<0)?this.shape[",T,"]:i",T,"|0"].join("")})).join(",")+","+u.map((function(T){return"this.stride["+T+"]"})).join(",")+",this.offset)}");var c=u.map((function(T){return"a"+T+"=this.shape["+T+"]"})),p=u.map((function(T){return"c"+T+"=this.stride["+T+"]"}));A.push("proto.lo=function "+X+"_lo("+E.join(",")+"){var b=this.offset,d=0,"+c.join(",")+","+p.join(","));for(var H=0;H<z;++H)A.push("if(typeof i"+H+"==='number'&&i"+H+">=0){d=i"+H+"|0;b+=c"+H+"*d;a"+H+"-=d}");A.push("return new "+X+"(this.data,"+u.map((function(T){return"a"+T})).join(",")+","+u.map((function(T){return"c"+T})).join(",")+",b)}"),A.push("proto.step=function "+X+"_step("+E.join(",")+"){var "+u.map((function(T){return"a"+T+"=this.shape["+T+"]"})).join(",")+","+u.map((function(T){return"b"+T+"=this.stride["+T+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(H=0;H<z;++H)A.push("if(typeof i"+H+"==='number'){d=i"+H+"|0;if(d<0){c+=b"+H+"*(a"+H+"-1);a"+H+"=ceil(-a"+H+"/d)}else{a"+H+"=ceil(a"+H+"/d)}b"+H+"*=d}");A.push("return new "+X+"(this.data,"+u.map((function(T){return"a"+T})).join(",")+","+u.map((function(T){return"b"+T})).join(",")+",c)}");var U=new Array(z),s=new Array(z);for(H=0;H<z;++H)U[H]="a[i"+H+"]",s[H]="b[i"+H+"]";A.push("proto.transpose=function "+X+"_transpose("+E+"){"+E.map((function(T,z){return T+"=("+T+"===undefined?"+z+":"+T+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+X+"(this.data,"+U.join(",")+","+s.join(",")+",this.offset)}"),A.push("proto.pick=function "+X+"_pick("+E+"){var a=[],b=[],c=this.offset");for(H=0;H<z;++H)A.push("if(typeof i"+H+"==='number'&&i"+H+">=0){c=(c+this.stride["+H+"]*i"+H+")|0}else{a.push(this.shape["+H+"]);b.push(this.stride["+H+"])}");return A.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),A.push("return function construct_"+X+"(data,shape,stride,offset){return new "+X+"(data,"+u.map((function(T){return"shape["+T+"]"})).join(",")+","+u.map((function(T){return"stride["+T+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",A.join("\n"))(v[T],y)}var v={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};T.exports=function(T,z,X,b){if(void 0===T)return(0,v.array[0])([]);"number"===typeof T&&(T=[T]),void 0===z&&(z=[T.length]);var u=z.length;if(void 0===X){X=new Array(u);for(var y=u-1,k=1;y>=0;--y)X[y]=k,k*=z[y]}if(void 0===b){b=0;for(y=0;y<u;++y)X[y]<0&&(b-=(z[y]-1)*X[y])}for(var L=function(T){if(F(T))return"buffer";if(A)switch(Object.prototype.toString.call(T)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(T)?"array":"generic"}(T),D=v[L];D.length<=u+1;)D.push(E(L,D.length-1));return(0,D[u+1])(T,z,X,b)}},11780:T=>{var z;self,z=()=>(()=>{"use strict";var T={d:(z,X)=>{for(var b in X)T.o(X,b)&&!T.o(z,b)&&Object.defineProperty(z,b,{enumerable:!0,get:X[b]})},o:(T,z)=>Object.prototype.hasOwnProperty.call(T,z)},z={};T.d(z,{default:()=>n});var X,b=function(T,z){var X=z.x-T.x,b=z.y-T.y;return Math.sqrt(X*X+b*b)},F=function(T){return T*(Math.PI/180)},A=new Map,u=function(T){A.has(T)&&clearTimeout(A.get(T)),A.set(T,setTimeout(T,100))},y=function(T,z,X){for(var b,F=z.split(/[ ,]+/g),A=0;A<F.length;A+=1)b=F[A],T.addEventListener?T.addEventListener(b,X,!1):T.attachEvent&&T.attachEvent(b,X)},E=function(T,z,X){for(var b,F=z.split(/[ ,]+/g),A=0;A<F.length;A+=1)b=F[A],T.removeEventListener?T.removeEventListener(b,X):T.detachEvent&&T.detachEvent(b,X)},v=function(T){return T.preventDefault(),T.type.match(/^touch/)?T.changedTouches:T},k=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},L=function(T,z){z.top||z.right||z.bottom||z.left?(T.style.top=z.top,T.style.right=z.right,T.style.bottom=z.bottom,T.style.left=z.left):(T.style.left=z.x+"px",T.style.top=z.y+"px")},D=function(T,z,X){var b=c(T);for(var F in b)if(b.hasOwnProperty(F))if("string"==typeof z)b[F]=z+" "+X;else{for(var A="",u=0,y=z.length;u<y;u+=1)A+=z[u]+" "+X+", ";b[F]=A.slice(0,-2)}return b},c=function(T){var z={};return z[T]="",["webkit","Moz","o"].forEach((function(X){z[X+T.charAt(0).toUpperCase()+T.slice(1)]=""})),z},p=function(T,z){for(var X in z)z.hasOwnProperty(X)&&(T[X]=z[X]);return T},H=function(T,z){if(T.length)for(var X=0,b=T.length;X<b;X+=1)z(T[X]);else z(T)},U="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,s=window.matchMedia("(any-hover: none)").matches,x=!!("ontouchstart"in window),K=!!window.PointerEvent,d=!!window.MSPointerEvent,N={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},l={start:"mousedown",move:"mousemove",end:"mouseup"},a={};function q(){}U&&!s?X=N:K?X={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:d?X={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:x?(X=N,a=l):X=l,q.prototype.on=function(T,z){var X,b=this,F=T.split(/[ ,]+/g);b._handlers_=b._handlers_||{};for(var A=0;A<F.length;A+=1)X=F[A],b._handlers_[X]=b._handlers_[X]||[],b._handlers_[X].push(z);return b},q.prototype.off=function(T,z){var X=this;return X._handlers_=X._handlers_||{},void 0===T?X._handlers_={}:void 0===z?X._handlers_[T]=null:X._handlers_[T]&&X._handlers_[T].indexOf(z)>=0&&X._handlers_[T].splice(X._handlers_[T].indexOf(z),1),X},q.prototype.trigger=function(T,z){var X,b=this,F=T.split(/[ ,]+/g);b._handlers_=b._handlers_||{};for(var A=0;A<F.length;A+=1)X=F[A],b._handlers_[X]&&b._handlers_[X].length&&b._handlers_[X].forEach((function(T){T.call(b,{type:X,target:b},z)}))},q.prototype.config=function(T){var z=this;z.options=z.defaults||{},T&&(z.options=function(T,z){var X={};for(var b in T)T.hasOwnProperty(b)&&z.hasOwnProperty(b)?X[b]=z[b]:T.hasOwnProperty(b)&&(X[b]=T[b]);return X}(z.options,T))},q.prototype.bindEvt=function(T,z){var b=this;return b._domHandlers_=b._domHandlers_||{},b._domHandlers_[z]=function(){"function"==typeof b["on"+z]?b["on"+z].apply(b,arguments):console.warn('[WARNING] : Missing "on'+z+'" handler.')},y(T,X[z],b._domHandlers_[z]),a[z]&&y(T,a[z],b._domHandlers_[z]),b},q.prototype.unbindEvt=function(T,z){var b=this;return b._domHandlers_=b._domHandlers_||{},E(T,X[z],b._domHandlers_[z]),a[z]&&E(T,a[z],b._domHandlers_[z]),delete b._domHandlers_[z],this};const V=q;function C(T,z){return this.identifier=z.identifier,this.position=z.position,this.frontPosition=z.frontPosition,this.collection=T,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(z),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=C.id,C.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}C.prototype=new V,C.constructor=C,C.id=0,C.prototype.buildEl=function(T){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},C.prototype.stylize=function(){if(this.options.dataOnly)return this;var T=this.options.fadeTime+"ms",z=function(){var T=c("borderRadius");for(var z in T)T.hasOwnProperty(z)&&(T[z]="50%");return T}(),X=D("transition","opacity",T),b={};return b.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},b.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},b.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},p(b.el,X),"circle"===this.options.shape&&p(b.back,z),p(b.front,z),this.applyStyles(b),this},C.prototype.applyStyles=function(T){for(var z in this.ui)if(this.ui.hasOwnProperty(z))for(var X in T[z])this.ui[z].style[X]=T[z][X];return this},C.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},C.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},C.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},C.prototype.show=function(T){var z=this;return z.options.dataOnly||(clearTimeout(z.removeTimeout),clearTimeout(z.showTimeout),clearTimeout(z.restTimeout),z.addToDom(),z.restCallback(),setTimeout((function(){z.ui.el.style.opacity=1}),0),z.showTimeout=setTimeout((function(){z.trigger("shown",z.instance),"function"==typeof T&&T.call(this)}),z.options.fadeTime)),z},C.prototype.hide=function(T){var z=this;if(z.options.dataOnly)return z;if(z.ui.el.style.opacity=z.options.restOpacity,clearTimeout(z.removeTimeout),clearTimeout(z.showTimeout),clearTimeout(z.restTimeout),z.removeTimeout=setTimeout((function(){var X="dynamic"===z.options.mode?"none":"block";z.ui.el.style.display=X,"function"==typeof T&&T.call(z),z.trigger("hidden",z.instance)}),z.options.fadeTime),z.options.restJoystick){var X=z.options.restJoystick,b={};b.x=!0===X||!1!==X.x?0:z.instance.frontPosition.x,b.y=!0===X||!1!==X.y?0:z.instance.frontPosition.y,z.setPosition(T,b)}return z},C.prototype.setPosition=function(T,z){var X=this;X.frontPosition={x:z.x,y:z.y};var b=X.options.fadeTime+"ms",F={};F.front=D("transition",["transform"],b);var A={front:{}};A.front={transform:"translate("+X.frontPosition.x+"px,"+X.frontPosition.y+"px)"},X.applyStyles(F),X.applyStyles(A),X.restTimeout=setTimeout((function(){"function"==typeof T&&T.call(X),X.restCallback()}),X.options.fadeTime)},C.prototype.restCallback=function(){var T=this,z={};z.front=D("transition","none",""),T.applyStyles(z),T.trigger("rested",T.instance)},C.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},C.prototype.computeDirection=function(T){var z,X,b,F=T.angle.radian,A=Math.PI/4,u=Math.PI/2;if(F>A&&F<3*A&&!T.lockX?z="up":F>-A&&F<=A&&!T.lockY?z="left":F>3*-A&&F<=-A&&!T.lockX?z="down":T.lockY||(z="right"),T.lockY||(X=F>-u&&F<u?"left":"right"),T.lockX||(b=F>0?"up":"down"),T.force>this.options.threshold){var y,E={};for(y in this.direction)this.direction.hasOwnProperty(y)&&(E[y]=this.direction[y]);var v={};for(y in this.direction={x:X,y:b,angle:z},T.direction=this.direction,E)E[y]===this.direction[y]&&(v[y]=!0);if(v.x&&v.y&&v.angle)return T;v.x&&v.y||this.trigger("plain",T),v.x||this.trigger("plain:"+X,T),v.y||this.trigger("plain:"+b,T),v.angle||this.trigger("dir dir:"+z,T)}else this.resetDirection();return T};const G=C;function j(T,z){var X=this;X.nipples=[],X.idles=[],X.actives=[],X.ids=[],X.pressureIntervals={},X.manager=T,X.id=j.id,j.id+=1,X.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},X.config(z),"static"!==X.options.mode&&"semi"!==X.options.mode||(X.options.multitouch=!1),X.options.multitouch||(X.options.maxNumberOfNipples=1);var b=getComputedStyle(X.options.zone.parentElement);return b&&"flex"===b.display&&(X.parentIsFlex=!0),X.updateBox(),X.prepareNipples(),X.Lj(),X.begin(),X.nipples}j.prototype=new V,j.constructor=j,j.id=0,j.prototype.prepareNipples=function(){var T=this,z=T.nipples;z.on=T.on.bind(T),z.off=T.off.bind(T),z.options=T.options,z.destroy=T.destroy.bind(T),z.ids=T.ids,z.id=T.id,z.processOnMove=T.processOnMove.bind(T),z.processOnEnd=T.processOnEnd.bind(T),z.get=function(T){if(void 0===T)return z[0];for(var X=0,b=z.length;X<b;X+=1)if(z[X].identifier===T)return z[X];return!1}},j.prototype.Lj=function(){var T=this;T.bindEvt(T.options.zone,"start"),T.options.zone.style.touchAction="none",T.options.zone.style.msTouchAction="none"},j.prototype.begin=function(){var T=this,z=T.options;if("static"===z.mode){var X=T.createNipple(z.position,T.manager.getIdentifier());X.add(),T.idles.push(X)}},j.prototype.createNipple=function(T,z){var X=this,b=X.manager.scroll,F={},A=X.options,u=X.parentIsFlex?b.x:b.x+X.box.left,y=X.parentIsFlex?b.y:b.y+X.box.top;if(T.x&&T.y)F={x:T.x-u,y:T.y-y};else if(T.top||T.right||T.bottom||T.left){var E=document.createElement("DIV");E.style.display="hidden",E.style.top=T.top,E.style.right=T.right,E.style.bottom=T.bottom,E.style.left=T.left,E.style.position="absolute",A.zone.appendChild(E);var v=E.getBoundingClientRect();A.zone.removeChild(E),F=T,T={x:v.left+b.x,y:v.top+b.y}}var k=new G(X,{color:A.color,size:A.size,threshold:A.threshold,fadeTime:A.fadeTime,dataOnly:A.dataOnly,restJoystick:A.restJoystick,restOpacity:A.restOpacity,mode:A.mode,identifier:z,position:T,zone:A.zone,frontPosition:{x:0,y:0},shape:A.shape});return A.dataOnly||(L(k.ui.el,F),L(k.ui.front,k.frontPosition)),X.nipples.push(k),X.trigger("added "+k.identifier+":added",k),X.manager.trigger("added "+k.identifier+":added",k),X.bindNipple(k),k},j.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},j.prototype.bindNipple=function(T){var z,X=this,b=function(T,b){z=T.type+" "+b.id+":"+T.type,X.trigger(z,b)};T.on("destroyed",X.onDestroyed.bind(X)),T.on("shown hidden rested dir plain",b),T.on("dir:up dir:right dir:down dir:left",b),T.on("plain:up plain:right plain:down plain:left",b)},j.prototype.pressureFn=function(T,z,X){var b=this,F=0;clearInterval(b.pressureIntervals[X]),b.pressureIntervals[X]=setInterval(function(){var X=T.force||T.pressure||T.webkitForce||0;X!==F&&(z.trigger("pressure",X),b.trigger("pressure "+z.identifier+":pressure",X),F=X)}.bind(b),100)},j.prototype.onstart=function(T){var z=this,X=z.options,b=T;return T=v(T),z.updateBox(),H(T,(function(F){z.actives.length<X.maxNumberOfNipples?z.processOnStart(F):b.type.match(/^touch/)&&(Object.keys(z.manager.ids).forEach((function(X){if(Object.values(b.touches).findIndex((function(T){return T.identifier===X}))<0){var F=[T[0]];F.identifier=X,z.processOnEnd(F)}})),z.actives.length<X.maxNumberOfNipples&&z.processOnStart(F))})),z.manager.bindDocument(),!1},j.prototype.processOnStart=function(T){var z,X=this,F=X.options,A=X.manager.getIdentifier(T),u=T.force||T.pressure||T.webkitForce||0,y={x:T.pageX,y:T.pageY},E=X.getOrCreate(A,y);E.identifier!==A&&X.manager.removeIdentifier(E.identifier),E.identifier=A;var v=function(z){z.trigger("start",z),X.trigger("start "+z.id+":start",z),z.show(),u>0&&X.pressureFn(T,z,z.identifier),X.processOnMove(T)};if((z=X.idles.indexOf(E))>=0&&X.idles.splice(z,1),X.actives.push(E),X.ids.push(E.identifier),"semi"!==F.mode)v(E);else{if(!(b(y,E.position)<=F.catchDistance))return E.destroy(),void X.processOnStart(T);v(E)}return E},j.prototype.getOrCreate=function(T,z){var X,b=this,F=b.options;return/(semi|static)/.test(F.mode)?(X=b.idles[0])?(b.idles.splice(0,1),X):"semi"===F.mode?b.createNipple(z,T):(console.warn("Coudln't find the needed nipple."),!1):X=b.createNipple(z,T)},j.prototype.processOnMove=function(T){var z=this,X=z.options,A=z.manager.getIdentifier(T),u=z.nipples.get(A),y=z.manager.scroll;if(function(T){return isNaN(T.buttons)?0!==T.pressure:0!==T.buttons}(T)){if(!u)return console.error("Found zombie joystick with ID "+A),void z.manager.removeIdentifier(A);if(X.dynamicPage){var E=u.el.getBoundingClientRect();u.position={x:y.x+E.left,y:y.y+E.top}}u.identifier=A;var v=u.options.size/2,k={x:T.pageX,y:T.pageY};X.lockX&&(k.y=u.position.y),X.lockY&&(k.x=u.position.x);var L,D,c,p,H,U,s,x,K,d,N=b(k,u.position),l=(L=k,c=(D=u.position).x-L.x,p=D.y-L.y,function(T){return T*(180/Math.PI)}(Math.atan2(p,c))),a=F(l),q=N/v,V={distance:N,position:k};if("circle"===u.options.shape?(H=Math.min(N,v),s=u.position,x=H,d={x:0,y:0},K=F(K=l),d.x=s.x-x*Math.cos(K),d.y=s.y-x*Math.sin(K),U=d):(U=function(T,z,X){return{x:Math.min(Math.max(T.x,z.x-X),z.x+X),y:Math.min(Math.max(T.y,z.y-X),z.y+X)}}(k,u.position,v),H=b(U,u.position)),X.follow){if(N>v){var C=k.x-U.x,G=k.y-U.y;u.position.x+=C,u.position.y+=G,u.el.style.top=u.position.y-(z.box.top+y.y)+"px",u.el.style.left=u.position.x-(z.box.left+y.x)+"px",N=b(k,u.position)}}else k=U,N=H;var j=k.x-u.position.x,Z=k.y-u.position.y;u.frontPosition={x:j,y:Z},X.dataOnly||(u.ui.front.style.transform="translate("+j+"px,"+Z+"px)");var m={identifier:u.identifier,position:k,force:q,pressure:T.force||T.pressure||T.webkitForce||0,distance:N,angle:{radian:a,degree:l},vector:{x:j/v,y:-Z/v},raw:V,instance:u,lockX:X.lockX,lockY:X.lockY};(m=u.computeDirection(m)).angle={radian:F(180-l),degree:180-l},u.trigger("move",m),z.trigger("move "+u.id+":move",m)}else this.processOnEnd(T)},j.prototype.processOnEnd=function(T){var z=this,X=z.options,b=z.manager.getIdentifier(T),F=z.nipples.get(b),A=z.manager.removeIdentifier(F.identifier);F&&(X.dataOnly||F.hide((function(){"dynamic"===X.mode&&(F.trigger("removed",F),z.trigger("removed "+F.id+":removed",F),z.manager.trigger("removed "+F.id+":removed",F),F.destroy())})),clearInterval(z.pressureIntervals[F.identifier]),F.resetDirection(),F.trigger("end",F),z.trigger("end "+F.id+":end",F),z.ids.indexOf(F.identifier)>=0&&z.ids.splice(z.ids.indexOf(F.identifier),1),z.actives.indexOf(F)>=0&&z.actives.splice(z.actives.indexOf(F),1),/(semi|static)/.test(X.mode)?z.idles.push(F):z.nipples.indexOf(F)>=0&&z.nipples.splice(z.nipples.indexOf(F),1),z.manager.unbindDocument(),/(semi|static)/.test(X.mode)&&(z.manager.ids[A.id]=A.identifier))},j.prototype.onDestroyed=function(T,z){var X=this;X.nipples.indexOf(z)>=0&&X.nipples.splice(X.nipples.indexOf(z),1),X.actives.indexOf(z)>=0&&X.actives.splice(X.actives.indexOf(z),1),X.idles.indexOf(z)>=0&&X.idles.splice(X.idles.indexOf(z),1),X.ids.indexOf(z.identifier)>=0&&X.ids.splice(X.ids.indexOf(z.identifier),1),X.manager.removeIdentifier(z.identifier),X.manager.unbindDocument()},j.prototype.destroy=function(){var T=this;for(var z in T.unbindEvt(T.options.zone,"start"),T.nipples.forEach((function(T){T.destroy()})),T.pressureIntervals)T.pressureIntervals.hasOwnProperty(z)&&clearInterval(T.pressureIntervals[z]);T.trigger("destroyed",T.nipples),T.manager.unbindDocument(),T.off()};const Z=j;function m(T){var z=this;z.ids={},z.index=0,z.collections=[],z.scroll=k(),z.config(T),z.prepareCollections();var X=function(){var T;z.collections.forEach((function(X){X.forEach((function(X){T=X.el.getBoundingClientRect(),X.position={x:z.scroll.x+T.left,y:z.scroll.y+T.top}}))}))};y(window,"resize",(function(){u(X)}));var b=function(){z.scroll=k()};return y(window,"scroll",(function(){u(b)})),z.collections}m.prototype=new V,m.constructor=m,m.prototype.prepareCollections=function(){var T=this;T.collections.create=T.create.bind(T),T.collections.on=T.on.bind(T),T.collections.off=T.off.bind(T),T.collections.destroy=T.destroy.bind(T),T.collections.get=function(z){var X;return T.collections.every((function(T){return!(X=T.get(z))})),X}},m.prototype.create=function(T){return this.createCollection(T)},m.prototype.createCollection=function(T){var z=this,X=new Z(z,T);return z.bindCollection(X),z.collections.push(X),X},m.prototype.bindCollection=function(T){var z,X=this,b=function(T,b){z=T.type+" "+b.id+":"+T.type,X.trigger(z,b)};T.on("destroyed",X.onDestroyed.bind(X)),T.on("shown hidden rested dir plain",b),T.on("dir:up dir:right dir:down dir:left",b),T.on("plain:up plain:right plain:down plain:left",b)},m.prototype.bindDocument=function(){var T=this;T.binded||(T.bindEvt(document,"move").bindEvt(document,"end"),T.binded=!0)},m.prototype.unbindDocument=function(T){var z=this;Object.keys(z.ids).length&&!0!==T||(z.unbindEvt(document,"move").unbindEvt(document,"end"),z.binded=!1)},m.prototype.getIdentifier=function(T){var z;return T?void 0===(z=void 0===T.identifier?T.pointerId:T.identifier)&&(z=this.latest||0):z=this.index,void 0===this.ids[z]&&(this.ids[z]=this.index,this.index+=1),this.latest=z,this.ids[z]},m.prototype.removeIdentifier=function(T){var z={};for(var X in this.ids)if(this.ids[X]===T){z.id=X,z.identifier=this.ids[X],delete this.ids[X];break}return z},m.prototype.onmove=function(T){return this.onAny("move",T),!1},m.prototype.onend=function(T){return this.onAny("end",T),!1},m.prototype.oncancel=function(T){return this.onAny("end",T),!1},m.prototype.onAny=function(T,z){var X,b=this,F="processOn"+T.charAt(0).toUpperCase()+T.slice(1);z=v(z);var A=function(T,z,X){X.ids.indexOf(z)>=0&&(X[F](T),T._found_=!0)};return H(z,(function(T){X=b.getIdentifier(T),H(b.collections,A.bind(null,T,X)),T._found_||b.removeIdentifier(X)})),!1},m.prototype.destroy=function(){var T=this;T.unbindDocument(!0),T.ids={},T.index=0,T.collections.forEach((function(T){T.destroy()})),T.off()},m.prototype.onDestroyed=function(T,z){var X=this;if(X.collections.indexOf(z)<0)return!1;X.collections.splice(X.collections.indexOf(z),1)};var S=new m;const n={create:function(T){return S.create(T)},factory:S};return z.default})(),T.exports=z()},11827:(T,z,X)=>{"use strict";const{Deflate:b,deflate:F,deflateRaw:A,gzip:u}=X(11832),{Inflate:y,inflate:E,inflateRaw:v,ungzip:k}=X(11883),L=X(11865);T.exports.Deflate=b,T.exports.deflate=F,T.exports.deflateRaw=A,T.exports.gzip=u,T.exports.Inflate=y,T.exports.inflate=E,T.exports.inflateRaw=v,T.exports.ungzip=k,T.exports.constants=L},11832:(T,z,X)=>{"use strict";const b=X(11834),F=X(11871),A=X(11879),u=X(11856),y=X(11881),E=Object.prototype.toString,{Z_NO_FLUSH:v,Z_SYNC_FLUSH:k,Z_FULL_FLUSH:L,Z_FINISH:D,Z_OK:c,Z_STREAM_END:p,Z_DEFAULT_COMPRESSION:H,Z_DEFAULT_STRATEGY:U,Z_DEFLATED:s}=X(11865);function x(T){this.options=F.assign({level:H,method:s,Ja:16384,windowBits:15,memLevel:8,strategy:U},T||{});let z=this.options;z.raw&&z.windowBits>0?z.windowBits=-z.windowBits:z.gzip&&z.windowBits>0&&z.windowBits<16&&(z.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new y,this.strm.avail_out=0;let X=b.deflateInit2(this.strm,z.level,z.method,z.windowBits,z.memLevel,z.strategy);if(X!==c)throw new Error(u[X]);if(z.header&&b.deflateSetHeader(this.strm,z.header),z.dictionary){let T;if(T="string"===typeof z.dictionary?A.string2buf(z.dictionary):"[object ArrayBuffer]"===E.call(z.dictionary)?new Uint8Array(z.dictionary):z.dictionary,X=b.deflateSetDictionary(this.strm,T),X!==c)throw new Error(u[X]);this._dict_set=!0}}function K(T,z){const X=new x(z);if(X.push(T,!0),X.err)throw X.msg||u[X.err];return X.result}x.prototype.push=function(T,z){const X=this.strm,F=this.options.Ja;let u,y;if(this.ended)return!1;for(y=z===~~z?z:!0===z?D:v,"string"===typeof T?X.input=A.string2buf(T):"[object ArrayBuffer]"===E.call(T)?X.input=new Uint8Array(T):X.input=T,X.next_in=0,X.avail_in=X.input.length;;)if(0===X.avail_out&&(X.output=new Uint8Array(F),X.next_out=0,X.avail_out=F),(y===k||y===L)&&X.avail_out<=6)this.onData(X.output.subarray(0,X.next_out)),X.avail_out=0;else{if(u=b.deflate(X,y),u===p)return X.next_out>0&&this.onData(X.output.subarray(0,X.next_out)),u=b.deflateEnd(this.strm),this.onEnd(u),this.ended=!0,u===c;if(0!==X.avail_out){if(y>0&&X.next_out>0)this.onData(X.output.subarray(0,X.next_out)),X.avail_out=0;else if(0===X.avail_in)break}else this.onData(X.output)}return!0},x.prototype.onData=function(T){this.chunks.push(T)},x.prototype.onEnd=function(T){T===c&&(this.result=F.flattenChunks(this.chunks)),this.chunks=[],this.err=T,this.msg=this.strm.msg},T.exports.Deflate=x,T.exports.deflate=K,T.exports.deflateRaw=function(T,z){return(z=z||{}).raw=!0,K(T,z)},T.exports.gzip=function(T,z){return(z=z||{}).gzip=!0,K(T,z)},T.exports.constants=X(11865)},11883:(T,z,X)=>{"use strict";const b=X(11885),F=X(11871),A=X(11879),u=X(11856),y=X(11881),E=X(11897),v=Object.prototype.toString,{Z_NO_FLUSH:k,Z_FINISH:L,Z_OK:D,Z_STREAM_END:c,Z_NEED_DICT:p,Z_STREAM_ERROR:H,Z_DATA_ERROR:U,Z_MEM_ERROR:s}=X(11865);function x(T){this.options=F.assign({Ja:65536,windowBits:15,to:""},T||{});const z=this.options;z.raw&&z.windowBits>=0&&z.windowBits<16&&(z.windowBits=-z.windowBits,0===z.windowBits&&(z.windowBits=-15)),!(z.windowBits>=0&&z.windowBits<16)||T&&T.windowBits||(z.windowBits+=32),z.windowBits>15&&z.windowBits<48&&0===(15&z.windowBits)&&(z.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new y,this.strm.avail_out=0;let X=b.inflateInit2(this.strm,z.windowBits);if(X!==D)throw new Error(u[X]);if(this.header=new E,b.inflateGetHeader(this.strm,this.header),z.dictionary&&("string"===typeof z.dictionary?z.dictionary=A.string2buf(z.dictionary):"[object ArrayBuffer]"===v.call(z.dictionary)&&(z.dictionary=new Uint8Array(z.dictionary)),z.raw&&(X=b.inflateSetDictionary(this.strm,z.dictionary),X!==D)))throw new Error(u[X])}function K(T,z){const X=new x(z);if(X.push(T),X.err)throw X.msg||u[X.err];return X.result}x.prototype.push=function(T,z){const X=this.strm,F=this.options.Ja,u=this.options.dictionary;let y,E,x;if(this.ended)return!1;for(E=z===~~z?z:!0===z?L:k,"[object ArrayBuffer]"===v.call(T)?X.input=new Uint8Array(T):X.input=T,X.next_in=0,X.avail_in=X.input.length;;){for(0===X.avail_out&&(X.output=new Uint8Array(F),X.next_out=0,X.avail_out=F),y=b.inflate(X,E),y===p&&u&&(y=b.inflateSetDictionary(X,u),y===D?y=b.inflate(X,E):y===U&&(y=p));X.avail_in>0&&y===c&&X.state.wrap>0&&0!==T[X.next_in];)b.inflateReset(X),y=b.inflate(X,E);switch(y){case H:case U:case p:case s:return this.onEnd(y),this.ended=!0,!1}if(x=X.avail_out,X.next_out&&(0===X.avail_out||y===c))if("string"===this.options.to){let T=A.utf8border(X.output,X.next_out),z=X.next_out-T,b=A.buf2string(X.output,T);X.next_out=z,X.avail_out=F-z,z&&X.output.set(X.output.subarray(T,T+z),0),this.onData(b)}else this.onData(X.output.length===X.next_out?X.output:X.output.subarray(0,X.next_out));if(y!==D||0!==x){if(y===c)return y=b.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,!0;if(0===X.avail_in)break}}return!0},x.prototype.onData=function(T){this.chunks.push(T)},x.prototype.onEnd=function(T){T===D&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=F.flattenChunks(this.chunks)),this.chunks=[],this.err=T,this.msg=this.strm.msg},T.exports.Inflate=x,T.exports.inflate=K,T.exports.inflateRaw=function(T,z){return(z=z||{}).raw=!0,K(T,z)},T.exports.ungzip=K,T.exports.constants=X(11865)},11871:T=>{"use strict";const z=(T,z)=>Object.prototype.hasOwnProperty.call(T,z);T.exports.assign=function(T){const X=Array.prototype.slice.call(arguments,1);for(;X.length;){const b=X.shift();if(b){if("object"!==typeof b)throw new TypeError(b+"must be non-object");for(const X in b)z(b,X)&&(T[X]=b[X])}}return T},T.exports.flattenChunks=T=>{let z=0;for(let b=0,F=T.length;b<F;b++)z+=T[b].length;const X=new Uint8Array(z);for(let b=0,F=0,A=T.length;b<A;b++){let z=T[b];X.set(z,F),F+=z.length}return X}},11879:T=>{"use strict";let z=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(b){z=!1}const X=new Uint8Array(256);for(let F=0;F<256;F++)X[F]=F>=252?6:F>=248?5:F>=240?4:F>=224?3:F>=192?2:1;X[254]=X[254]=1,T.exports.string2buf=T=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(T);let z,X,b,F,A,u=T.length,y=0;for(F=0;F<u;F++)X=T.charCodeAt(F),55296===(64512&X)&&F+1<u&&(b=T.charCodeAt(F+1),56320===(64512&b)&&(X=65536+(X-55296<<10)+(b-56320),F++)),y+=X<128?1:X<2048?2:X<65536?3:4;for(z=new Uint8Array(y),A=0,F=0;A<y;F++)X=T.charCodeAt(F),55296===(64512&X)&&F+1<u&&(b=T.charCodeAt(F+1),56320===(64512&b)&&(X=65536+(X-55296<<10)+(b-56320),F++)),X<128?z[A++]=X:X<2048?(z[A++]=192|X>>>6,z[A++]=128|63&X):X<65536?(z[A++]=224|X>>>12,z[A++]=128|X>>>6&63,z[A++]=128|63&X):(z[A++]=240|X>>>18,z[A++]=128|X>>>12&63,z[A++]=128|X>>>6&63,z[A++]=128|63&X);return z};T.exports.buf2string=(T,b)=>{const F=b||T.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(T.subarray(0,b));let A,u;const y=new Array(2*F);for(u=0,A=0;A<F;){let z=T[A++];if(z<128){y[u++]=z;continue}let b=X[z];if(b>4)y[u++]=65533,A+=b-1;else{for(z&=2===b?31:3===b?15:7;b>1&&A<F;)z=z<<6|63&T[A++],b--;b>1?y[u++]=65533:z<65536?y[u++]=z:(z-=65536,y[u++]=55296|z>>10&1023,y[u++]=56320|1023&z)}}return((T,X)=>{if(X<65534&&T.subarray&&z)return String.fromCharCode.apply(null,T.length===X?T:T.subarray(0,X));let b="";for(let z=0;z<X;z++)b+=String.fromCharCode(T[z]);return b})(y,u)},T.exports.utf8border=(T,z)=>{(z=z||T.length)>T.length&&(z=T.length);let b=z-1;for(;b>=0&&128===(192&T[b]);)b--;return b<0||0===b?z:b+X[T[b]]>z?b:z}},11847:T=>{"use strict";T.exports=(T,z,X,b)=>{let F=65535&T,A=T>>>16&65535,u=0;for(;0!==X;){u=X>2e3?2e3:X,X-=u;do{F=F+z[b++]|0,A=A+F|0}while(--u);F%=65521,A%=65521}return F|A<<16}},11865:T=>{"use strict";T.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11853:T=>{"use strict";const z=new Uint32Array((()=>{let T,z=[];for(var X=0;X<256;X++){T=X;for(var b=0;b<8;b++)T=1&T?3988292384^T>>>1:T>>>1;z[X]=T}return z})());T.exports=(T,X,b,F)=>{const A=z,u=F+b;T^=-1;for(let z=F;z<u;z++)T=T>>>8^A[255&(T^X[z])];return~T}},11834:(T,z,X)=>{"use strict";const{_tr_init:b,_tr_stored_block:F,_tr_flush_block:A,_tr_tally:u,_tr_align:y}=X(11843),E=X(11847),v=X(11853),k=X(11856),{Z_NO_FLUSH:L,Z_PARTIAL_FLUSH:D,Z_FULL_FLUSH:c,Z_FINISH:p,Z_BLOCK:H,Z_OK:U,Z_STREAM_END:s,Z_STREAM_ERROR:x,Z_DATA_ERROR:K,Z_BUF_ERROR:d,Z_DEFAULT_COMPRESSION:N,Z_FILTERED:l,Z_HUFFMAN_ONLY:a,Z_RLE:q,Z_FIXED:V,Z_DEFAULT_STRATEGY:C,Z_UNKNOWN:G,Z_DEFLATED:j}=X(11865),Z=258,m=262,S=103,n=113,O=666,P=(T,z)=>(T.msg=k[z],z),W=T=>(T<<1)-(T>4?9:0),B=T=>{let z=T.length;for(;--z>=0;)T[z]=0};let e=(T,z,X)=>(z<<T.hash_shift^X)&T.hash_mask;const R=T=>{const z=T.state;let X=z.pending;X>T.avail_out&&(X=T.avail_out),0!==X&&(T.output.set(z.pending_buf.subarray(z.pending_out,z.pending_out+X),T.next_out),T.next_out+=X,z.pending_out+=X,T.total_out+=X,T.avail_out-=X,z.pending-=X,0===z.pending&&(z.pending_out=0))},Y=(T,z)=>{A(T,T.block_start>=0?T.block_start:-1,T.strstart-T.block_start,z),T.block_start=T.strstart,R(T.strm)},i=(T,z)=>{T.pending_buf[T.pending++]=z},t=(T,z)=>{T.pending_buf[T.pending++]=z>>>8&255,T.pending_buf[T.pending++]=255&z},g=(T,z,X,b)=>{let F=T.avail_in;return F>b&&(F=b),0===F?0:(T.avail_in-=F,z.set(T.input.subarray(T.next_in,T.next_in+F),X),1===T.state.wrap?T.adler=E(T.adler,z,F,X):2===T.state.wrap&&(T.adler=v(T.adler,z,F,X)),T.next_in+=F,T.total_in+=F,F)},M=(T,z)=>{let X,b,F=T.max_chain_length,A=T.strstart,u=T.prev_length,y=T.nice_match;const E=T.strstart>T.w_size-m?T.strstart-(T.w_size-m):0,v=T.window,k=T.w_mask,L=T.prev,D=T.strstart+Z;let c=v[A+u-1],p=v[A+u];T.prev_length>=T.good_match&&(F>>=2),y>T.lookahead&&(y=T.lookahead);do{if(X=z,v[X+u]===p&&v[X+u-1]===c&&v[X]===v[A]&&v[++X]===v[A+1]){A+=2,X++;do{}while(v[++A]===v[++X]&&v[++A]===v[++X]&&v[++A]===v[++X]&&v[++A]===v[++X]&&v[++A]===v[++X]&&v[++A]===v[++X]&&v[++A]===v[++X]&&v[++A]===v[++X]&&A<D);if(b=Z-(D-A),A=D-Z,b>u){if(T.match_start=z,u=b,b>=y)break;c=v[A+u-1],p=v[A+u]}}}while((z=L[z&k])>E&&0!==--F);return u<=T.lookahead?u:T.lookahead},r=T=>{const z=T.w_size;let X,b,F,A,u;do{if(A=T.window_size-T.lookahead-T.strstart,T.strstart>=z+(z-m)){T.window.set(T.window.subarray(z,z+z),0),T.match_start-=z,T.strstart-=z,T.block_start-=z,b=T.hash_size,X=b;do{F=T.head[--X],T.head[X]=F>=z?F-z:0}while(--b);b=z,X=b;do{F=T.prev[--X],T.prev[X]=F>=z?F-z:0}while(--b);A+=z}if(0===T.strm.avail_in)break;if(b=g(T.strm,T.window,T.strstart+T.lookahead,A),T.lookahead+=b,T.lookahead+T.insert>=3)for(u=T.strstart-T.insert,T.ins_h=T.window[u],T.ins_h=e(T,T.ins_h,T.window[u+1]);T.insert&&(T.ins_h=e(T,T.ins_h,T.window[u+3-1]),T.prev[u&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=u,u++,T.insert--,!(T.lookahead+T.insert<3)););}while(T.lookahead<m&&0!==T.strm.avail_in)},o=(T,z)=>{let X,b;for(;;){if(T.lookahead<m){if(r(T),T.lookahead<m&&z===L)return 1;if(0===T.lookahead)break}if(X=0,T.lookahead>=3&&(T.ins_h=e(T,T.ins_h,T.window[T.strstart+3-1]),X=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart),0!==X&&T.strstart-X<=T.w_size-m&&(T.match_length=M(T,X)),T.match_length>=3)if(b=u(T,T.strstart-T.match_start,T.match_length-3),T.lookahead-=T.match_length,T.match_length<=T.max_lazy_match&&T.lookahead>=3){T.match_length--;do{T.strstart++,T.ins_h=e(T,T.ins_h,T.window[T.strstart+3-1]),X=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart}while(0!==--T.match_length);T.strstart++}else T.strstart+=T.match_length,T.match_length=0,T.ins_h=T.window[T.strstart],T.ins_h=e(T,T.ins_h,T.window[T.strstart+1]);else b=u(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++;if(b&&(Y(T,!1),0===T.strm.avail_out))return 1}return T.insert=T.strstart<2?T.strstart:2,z===p?(Y(T,!0),0===T.strm.avail_out?3:4):T.last_lit&&(Y(T,!1),0===T.strm.avail_out)?1:2},f=(T,z)=>{let X,b,F;for(;;){if(T.lookahead<m){if(r(T),T.lookahead<m&&z===L)return 1;if(0===T.lookahead)break}if(X=0,T.lookahead>=3&&(T.ins_h=e(T,T.ins_h,T.window[T.strstart+3-1]),X=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart),T.prev_length=T.match_length,T.prev_match=T.match_start,T.match_length=2,0!==X&&T.prev_length<T.max_lazy_match&&T.strstart-X<=T.w_size-m&&(T.match_length=M(T,X),T.match_length<=5&&(T.strategy===l||3===T.match_length&&T.strstart-T.match_start>4096)&&(T.match_length=2)),T.prev_length>=3&&T.match_length<=T.prev_length){F=T.strstart+T.lookahead-3,b=u(T,T.strstart-1-T.prev_match,T.prev_length-3),T.lookahead-=T.prev_length-1,T.prev_length-=2;do{++T.strstart<=F&&(T.ins_h=e(T,T.ins_h,T.window[T.strstart+3-1]),X=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart)}while(0!==--T.prev_length);if(T.match_available=0,T.match_length=2,T.strstart++,b&&(Y(T,!1),0===T.strm.avail_out))return 1}else if(T.match_available){if(b=u(T,0,T.window[T.strstart-1]),b&&Y(T,!1),T.strstart++,T.lookahead--,0===T.strm.avail_out)return 1}else T.match_available=1,T.strstart++,T.lookahead--}return T.match_available&&(b=u(T,0,T.window[T.strstart-1]),T.match_available=0),T.insert=T.strstart<2?T.strstart:2,z===p?(Y(T,!0),0===T.strm.avail_out?3:4):T.last_lit&&(Y(T,!1),0===T.strm.avail_out)?1:2};function h(T,z,X,b,F){this.good_length=T,this.max_lazy=z,this.nice_length=X,this.max_chain=b,this.func=F}const Q=[new h(0,0,0,0,((T,z)=>{let X=65535;for(X>T.pending_buf_size-5&&(X=T.pending_buf_size-5);;){if(T.lookahead<=1){if(r(T),0===T.lookahead&&z===L)return 1;if(0===T.lookahead)break}T.strstart+=T.lookahead,T.lookahead=0;const b=T.block_start+X;if((0===T.strstart||T.strstart>=b)&&(T.lookahead=T.strstart-b,T.strstart=b,Y(T,!1),0===T.strm.avail_out))return 1;if(T.strstart-T.block_start>=T.w_size-m&&(Y(T,!1),0===T.strm.avail_out))return 1}return T.insert=0,z===p?(Y(T,!0),0===T.strm.avail_out?3:4):(T.strstart>T.block_start&&(Y(T,!1),T.strm.avail_out),1)})),new h(4,4,8,4,o),new h(4,5,16,8,o),new h(4,6,32,32,o),new h(4,4,16,16,f),new h(8,16,32,32,f),new h(8,16,128,128,f),new h(8,32,128,256,f),new h(32,128,258,1024,f),new h(32,258,258,4096,f)];function w(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=j,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),B(this.dyn_ltree),B(this.dyn_dtree),B(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),B(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),B(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const J=T=>{if(!T||!T.state)return P(T,x);T.total_in=T.total_out=0,T.data_type=G;const z=T.state;return z.pending=0,z.pending_out=0,z.wrap<0&&(z.wrap=-z.wrap),z.status=z.wrap?42:n,T.adler=2===z.wrap?0:1,z.last_flush=L,b(z),U},I=T=>{const z=J(T);var X;return z===U&&((X=T.state).window_size=2*X.w_size,B(X.head),X.max_lazy_match=Q[X.level].max_lazy,X.good_match=Q[X.level].good_length,X.nice_match=Q[X.level].nice_length,X.max_chain_length=Q[X.level].max_chain,X.strstart=0,X.block_start=0,X.lookahead=0,X.insert=0,X.match_length=X.prev_length=2,X.match_available=0,X.ins_h=0),z},TT=(T,z,X,b,F,A)=>{if(!T)return x;let u=1;if(z===N&&(z=6),b<0?(u=0,b=-b):b>15&&(u=2,b-=16),F<1||F>9||X!==j||b<8||b>15||z<0||z>9||A<0||A>V)return P(T,x);8===b&&(b=9);const y=new w;return T.state=y,y.strm=T,y.wrap=u,y.gzhead=null,y.w_bits=b,y.w_size=1<<y.w_bits,y.w_mask=y.w_size-1,y.hash_bits=F+7,y.hash_size=1<<y.hash_bits,y.hash_mask=y.hash_size-1,y.hash_shift=~~((y.hash_bits+3-1)/3),y.window=new Uint8Array(2*y.w_size),y.head=new Uint16Array(y.hash_size),y.prev=new Uint16Array(y.w_size),y.lit_bufsize=1<<F+6,y.pending_buf_size=4*y.lit_bufsize,y.pending_buf=new Uint8Array(y.pending_buf_size),y.d_buf=1*y.lit_bufsize,y.l_buf=3*y.lit_bufsize,y.level=z,y.strategy=A,y.method=X,I(T)};T.exports.deflateInit=(T,z)=>TT(T,z,j,15,8,C),T.exports.deflateInit2=TT,T.exports.deflateReset=I,T.exports.deflateResetKeep=J,T.exports.deflateSetHeader=(T,z)=>T&&T.state?2!==T.state.wrap?x:(T.state.gzhead=z,U):x,T.exports.deflate=(T,z)=>{let X,b;if(!T||!T.state||z>H||z<0)return T?P(T,x):x;const A=T.state;if(!T.output||!T.input&&0!==T.avail_in||A.status===O&&z!==p)return P(T,0===T.avail_out?d:x);A.strm=T;const E=A.last_flush;if(A.last_flush=z,42===A.status)if(2===A.wrap)T.adler=0,i(A,31),i(A,139),i(A,8),A.gzhead?(i(A,(A.gzhead.text?1:0)+(A.gzhead.hcrc?2:0)+(A.gzhead.extra?4:0)+(A.gzhead.name?8:0)+(A.gzhead.comment?16:0)),i(A,255&A.gzhead.time),i(A,A.gzhead.time>>8&255),i(A,A.gzhead.time>>16&255),i(A,A.gzhead.time>>24&255),i(A,9===A.level?2:A.strategy>=a||A.level<2?4:0),i(A,255&A.gzhead.os),A.gzhead.extra&&A.gzhead.extra.length&&(i(A,255&A.gzhead.extra.length),i(A,A.gzhead.extra.length>>8&255)),A.gzhead.hcrc&&(T.adler=v(T.adler,A.pending_buf,A.pending,0)),A.gzindex=0,A.status=69):(i(A,0),i(A,0),i(A,0),i(A,0),i(A,0),i(A,9===A.level?2:A.strategy>=a||A.level<2?4:0),i(A,3),A.status=n);else{let z=j+(A.w_bits-8<<4)<<8,X=-1;X=A.strategy>=a||A.level<2?0:A.level<6?1:6===A.level?2:3,z|=X<<6,0!==A.strstart&&(z|=32),z+=31-z%31,A.status=n,t(A,z),0!==A.strstart&&(t(A,T.adler>>>16),t(A,65535&T.adler)),T.adler=1}if(69===A.status)if(A.gzhead.extra){for(X=A.pending;A.gzindex<(65535&A.gzhead.extra.length)&&(A.pending!==A.pending_buf_size||(A.gzhead.hcrc&&A.pending>X&&(T.adler=v(T.adler,A.pending_buf,A.pending-X,X)),R(T),X=A.pending,A.pending!==A.pending_buf_size));)i(A,255&A.gzhead.extra[A.gzindex]),A.gzindex++;A.gzhead.hcrc&&A.pending>X&&(T.adler=v(T.adler,A.pending_buf,A.pending-X,X)),A.gzindex===A.gzhead.extra.length&&(A.gzindex=0,A.status=73)}else A.status=73;if(73===A.status)if(A.gzhead.name){X=A.pending;do{if(A.pending===A.pending_buf_size&&(A.gzhead.hcrc&&A.pending>X&&(T.adler=v(T.adler,A.pending_buf,A.pending-X,X)),R(T),X=A.pending,A.pending===A.pending_buf_size)){b=1;break}b=A.gzindex<A.gzhead.name.length?255&A.gzhead.name.charCodeAt(A.gzindex++):0,i(A,b)}while(0!==b);A.gzhead.hcrc&&A.pending>X&&(T.adler=v(T.adler,A.pending_buf,A.pending-X,X)),0===b&&(A.gzindex=0,A.status=91)}else A.status=91;if(91===A.status)if(A.gzhead.comment){X=A.pending;do{if(A.pending===A.pending_buf_size&&(A.gzhead.hcrc&&A.pending>X&&(T.adler=v(T.adler,A.pending_buf,A.pending-X,X)),R(T),X=A.pending,A.pending===A.pending_buf_size)){b=1;break}b=A.gzindex<A.gzhead.comment.length?255&A.gzhead.comment.charCodeAt(A.gzindex++):0,i(A,b)}while(0!==b);A.gzhead.hcrc&&A.pending>X&&(T.adler=v(T.adler,A.pending_buf,A.pending-X,X)),0===b&&(A.status=S)}else A.status=S;if(A.status===S&&(A.gzhead.hcrc?(A.pending+2>A.pending_buf_size&&R(T),A.pending+2<=A.pending_buf_size&&(i(A,255&T.adler),i(A,T.adler>>8&255),T.adler=0,A.status=n)):A.status=n),0!==A.pending){if(R(T),0===T.avail_out)return A.last_flush=-1,U}else if(0===T.avail_in&&W(z)<=W(E)&&z!==p)return P(T,d);if(A.status===O&&0!==T.avail_in)return P(T,d);if(0!==T.avail_in||0!==A.lookahead||z!==L&&A.status!==O){let X=A.strategy===a?((T,z)=>{let X;for(;;){if(0===T.lookahead&&(r(T),0===T.lookahead)){if(z===L)return 1;break}if(T.match_length=0,X=u(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++,X&&(Y(T,!1),0===T.strm.avail_out))return 1}return T.insert=0,z===p?(Y(T,!0),0===T.strm.avail_out?3:4):T.last_lit&&(Y(T,!1),0===T.strm.avail_out)?1:2})(A,z):A.strategy===q?((T,z)=>{let X,b,F,A;const y=T.window;for(;;){if(T.lookahead<=Z){if(r(T),T.lookahead<=Z&&z===L)return 1;if(0===T.lookahead)break}if(T.match_length=0,T.lookahead>=3&&T.strstart>0&&(F=T.strstart-1,b=y[F],b===y[++F]&&b===y[++F]&&b===y[++F])){A=T.strstart+Z;do{}while(b===y[++F]&&b===y[++F]&&b===y[++F]&&b===y[++F]&&b===y[++F]&&b===y[++F]&&b===y[++F]&&b===y[++F]&&F<A);T.match_length=Z-(A-F),T.match_length>T.lookahead&&(T.match_length=T.lookahead)}if(T.match_length>=3?(X=u(T,1,T.match_length-3),T.lookahead-=T.match_length,T.strstart+=T.match_length,T.match_length=0):(X=u(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++),X&&(Y(T,!1),0===T.strm.avail_out))return 1}return T.insert=0,z===p?(Y(T,!0),0===T.strm.avail_out?3:4):T.last_lit&&(Y(T,!1),0===T.strm.avail_out)?1:2})(A,z):Q[A.level].func(A,z);if(3!==X&&4!==X||(A.status=O),1===X||3===X)return 0===T.avail_out&&(A.last_flush=-1),U;if(2===X&&(z===D?y(A):z!==H&&(F(A,0,0,!1),z===c&&(B(A.head),0===A.lookahead&&(A.strstart=0,A.block_start=0,A.insert=0))),R(T),0===T.avail_out))return A.last_flush=-1,U}return z!==p?U:A.wrap<=0?s:(2===A.wrap?(i(A,255&T.adler),i(A,T.adler>>8&255),i(A,T.adler>>16&255),i(A,T.adler>>24&255),i(A,255&T.total_in),i(A,T.total_in>>8&255),i(A,T.total_in>>16&255),i(A,T.total_in>>24&255)):(t(A,T.adler>>>16),t(A,65535&T.adler)),R(T),A.wrap>0&&(A.wrap=-A.wrap),0!==A.pending?U:s)},T.exports.deflateEnd=T=>{if(!T||!T.state)return x;const z=T.state.status;return 42!==z&&69!==z&&73!==z&&91!==z&&z!==S&&z!==n&&z!==O?P(T,x):(T.state=null,z===n?P(T,K):U)},T.exports.deflateSetDictionary=(T,z)=>{let X=z.length;if(!T||!T.state)return x;const b=T.state,F=b.wrap;if(2===F||1===F&&42!==b.status||b.lookahead)return x;if(1===F&&(T.adler=E(T.adler,z,X,0)),b.wrap=0,X>=b.w_size){0===F&&(B(b.head),b.strstart=0,b.block_start=0,b.insert=0);let T=new Uint8Array(b.w_size);T.set(z.subarray(X-b.w_size,X),0),z=T,X=b.w_size}const A=T.avail_in,u=T.next_in,y=T.input;for(T.avail_in=X,T.next_in=0,T.input=z,r(b);b.lookahead>=3;){let T=b.strstart,z=b.lookahead-2;do{b.ins_h=e(b,b.ins_h,b.window[T+3-1]),b.prev[T&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=T,T++}while(--z);b.strstart=T,b.lookahead=2,r(b)}return b.strstart+=b.lookahead,b.block_start=b.strstart,b.insert=b.lookahead,b.lookahead=0,b.match_length=b.prev_length=2,b.match_available=0,T.next_in=u,T.input=y,T.avail_in=A,b.wrap=F,U},T.exports.deflateInfo="pako deflate (from Nodeca project)"},11897:T=>{"use strict";T.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11888:T=>{"use strict";T.exports=function(T,z){let X,b,F,A,u,y,E,v,k,L,D,c,p,H,U,s,x,K,d,N,l,a,q,V;const C=T.state;X=T.next_in,q=T.input,b=X+(T.avail_in-5),F=T.next_out,V=T.output,A=F-(z-T.avail_out),u=F+(T.avail_out-257),y=C.dmax,E=C.wsize,v=C.whave,k=C.wnext,L=C.window,D=C.hold,c=C.bits,p=C.lencode,H=C.distcode,U=(1<<C.lenbits)-1,s=(1<<C.distbits)-1;T:do{c<15&&(D+=q[X++]<<c,c+=8,D+=q[X++]<<c,c+=8),x=p[D&U];z:for(;;){if(K=x>>>24,D>>>=K,c-=K,K=x>>>16&255,0===K)V[F++]=65535&x;else{if(!(16&K)){if(0===(64&K)){x=p[(65535&x)+(D&(1<<K)-1)];continue z}if(32&K){C.mode=12;break T}T.msg="invalid literal/length code",C.mode=30;break T}d=65535&x,K&=15,K&&(c<K&&(D+=q[X++]<<c,c+=8),d+=D&(1<<K)-1,D>>>=K,c-=K),c<15&&(D+=q[X++]<<c,c+=8,D+=q[X++]<<c,c+=8),x=H[D&s];X:for(;;){if(K=x>>>24,D>>>=K,c-=K,K=x>>>16&255,!(16&K)){if(0===(64&K)){x=H[(65535&x)+(D&(1<<K)-1)];continue X}T.msg="invalid distance code",C.mode=30;break T}if(N=65535&x,K&=15,c<K&&(D+=q[X++]<<c,c+=8,c<K&&(D+=q[X++]<<c,c+=8)),N+=D&(1<<K)-1,N>y){T.msg="invalid distance too far back",C.mode=30;break T}if(D>>>=K,c-=K,K=F-A,N>K){if(K=N-K,K>v&&C.sane){T.msg="invalid distance too far back",C.mode=30;break T}if(l=0,a=L,0===k){if(l+=E-K,K<d){d-=K;do{V[F++]=L[l++]}while(--K);l=F-N,a=V}}else if(k<K){if(l+=E+k-K,K-=k,K<d){d-=K;do{V[F++]=L[l++]}while(--K);if(l=0,k<d){K=k,d-=K;do{V[F++]=L[l++]}while(--K);l=F-N,a=V}}}else if(l+=k-K,K<d){d-=K;do{V[F++]=L[l++]}while(--K);l=F-N,a=V}for(;d>2;)V[F++]=a[l++],V[F++]=a[l++],V[F++]=a[l++],d-=3;d&&(V[F++]=a[l++],d>1&&(V[F++]=a[l++]))}else{l=F-N;do{V[F++]=V[l++],V[F++]=V[l++],V[F++]=V[l++],d-=3}while(d>2);d&&(V[F++]=V[l++],d>1&&(V[F++]=V[l++]))}break}}break}}while(X<b&&F<u);d=c>>3,X-=d,c-=d<<3,D&=(1<<c)-1,T.next_in=X,T.next_out=F,T.avail_in=X<b?b-X+5:5-(X-b),T.avail_out=F<u?u-F+257:257-(F-u),C.hold=D,C.bits=c}},11885:(T,z,X)=>{"use strict";const b=X(11847),F=X(11853),A=X(11888),u=X(11891),{Z_FINISH:y,Z_BLOCK:E,Z_TREES:v,Z_OK:k,Z_STREAM_END:L,Z_NEED_DICT:D,Z_STREAM_ERROR:c,Z_DATA_ERROR:p,Z_MEM_ERROR:H,Z_BUF_ERROR:U,Z_DEFLATED:s}=X(11865),x=12,K=30,d=T=>(T>>>24&255)+(T>>>8&65280)+((65280&T)<<8)+((255&T)<<24);function N(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const l=T=>{if(!T||!T.state)return c;const z=T.state;return T.total_in=T.total_out=z.total=0,T.msg="",z.wrap&&(T.adler=1&z.wrap),z.mode=1,z.last=0,z.havedict=0,z.dmax=32768,z.head=null,z.hold=0,z.bits=0,z.lencode=z.lendyn=new Int32Array(852),z.distcode=z.distdyn=new Int32Array(592),z.sane=1,z.back=-1,k},a=T=>{if(!T||!T.state)return c;const z=T.state;return z.wsize=0,z.whave=0,z.wnext=0,l(T)},q=(T,z)=>{let X;if(!T||!T.state)return c;const b=T.state;return z<0?(X=0,z=-z):(X=1+(z>>4),z<48&&(z&=15)),z&&(z<8||z>15)?c:(null!==b.window&&b.wbits!==z&&(b.window=null),b.wrap=X,b.wbits=z,a(T))},V=(T,z)=>{if(!T)return c;const X=new N;T.state=X,X.window=null;const b=q(T,z);return b!==k&&(T.state=null),b};let C,G,j=!0;const Z=T=>{if(j){C=new Int32Array(512),G=new Int32Array(32);let z=0;for(;z<144;)T.lens[z++]=8;for(;z<256;)T.lens[z++]=9;for(;z<280;)T.lens[z++]=7;for(;z<288;)T.lens[z++]=8;for(u(1,T.lens,0,288,C,0,T.work,{bits:9}),z=0;z<32;)T.lens[z++]=5;u(2,T.lens,0,32,G,0,T.work,{bits:5}),j=!1}T.lencode=C,T.lenbits=9,T.distcode=G,T.distbits=5},m=(T,z,X,b)=>{let F;const A=T.state;return null===A.window&&(A.wsize=1<<A.wbits,A.wnext=0,A.whave=0,A.window=new Uint8Array(A.wsize)),b>=A.wsize?(A.window.set(z.subarray(X-A.wsize,X),0),A.wnext=0,A.whave=A.wsize):(F=A.wsize-A.wnext,F>b&&(F=b),A.window.set(z.subarray(X-b,X-b+F),A.wnext),(b-=F)?(A.window.set(z.subarray(X-b,X),0),A.wnext=b,A.whave=A.wsize):(A.wnext+=F,A.wnext===A.wsize&&(A.wnext=0),A.whave<A.wsize&&(A.whave+=F))),0};T.exports.inflateReset=a,T.exports.inflateReset2=q,T.exports.inflateResetKeep=l,T.exports.inflateInit=T=>V(T,15),T.exports.inflateInit2=V,T.exports.inflate=(T,z)=>{let X,N,l,a,q,V,C,G,j,S,n,O,P,W,B,e,R,Y,i,t,g,M,r=0;const o=new Uint8Array(4);let f,h;const Q=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!T||!T.state||!T.output||!T.input&&0!==T.avail_in)return c;X=T.state,X.mode===x&&(X.mode=13),q=T.next_out,l=T.output,C=T.avail_out,a=T.next_in,N=T.input,V=T.avail_in,G=X.hold,j=X.bits,S=V,n=C,M=k;T:for(;;)switch(X.mode){case 1:if(0===X.wrap){X.mode=13;break}for(;j<16;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}if(2&X.wrap&&35615===G){X.check=0,o[0]=255&G,o[1]=G>>>8&255,X.check=F(X.check,o,2,0),G=0,j=0,X.mode=2;break}if(X.flags=0,X.head&&(X.head.done=!1),!(1&X.wrap)||(((255&G)<<8)+(G>>8))%31){T.msg="incorrect header check",X.mode=K;break}if((15&G)!==s){T.msg="unknown compression method",X.mode=K;break}if(G>>>=4,j-=4,g=8+(15&G),0===X.wbits)X.wbits=g;else if(g>X.wbits){T.msg="invalid window size",X.mode=K;break}X.dmax=1<<X.wbits,T.adler=X.check=1,X.mode=512&G?10:x,G=0,j=0;break;case 2:for(;j<16;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}if(X.flags=G,(255&X.flags)!==s){T.msg="unknown compression method",X.mode=K;break}if(57344&X.flags){T.msg="unknown header flags set",X.mode=K;break}X.head&&(X.head.text=G>>8&1),512&X.flags&&(o[0]=255&G,o[1]=G>>>8&255,X.check=F(X.check,o,2,0)),G=0,j=0,X.mode=3;case 3:for(;j<32;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}X.head&&(X.head.time=G),512&X.flags&&(o[0]=255&G,o[1]=G>>>8&255,o[2]=G>>>16&255,o[3]=G>>>24&255,X.check=F(X.check,o,4,0)),G=0,j=0,X.mode=4;case 4:for(;j<16;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}X.head&&(X.head.xflags=255&G,X.head.os=G>>8),512&X.flags&&(o[0]=255&G,o[1]=G>>>8&255,X.check=F(X.check,o,2,0)),G=0,j=0,X.mode=5;case 5:if(1024&X.flags){for(;j<16;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}X.length=G,X.head&&(X.head.extra_len=G),512&X.flags&&(o[0]=255&G,o[1]=G>>>8&255,X.check=F(X.check,o,2,0)),G=0,j=0}else X.head&&(X.head.extra=null);X.mode=6;case 6:if(1024&X.flags&&(O=X.length,O>V&&(O=V),O&&(X.head&&(g=X.head.extra_len-X.length,X.head.extra||(X.head.extra=new Uint8Array(X.head.extra_len)),X.head.extra.set(N.subarray(a,a+O),g)),512&X.flags&&(X.check=F(X.check,N,O,a)),V-=O,a+=O,X.length-=O),X.length))break T;X.length=0,X.mode=7;case 7:if(2048&X.flags){if(0===V)break T;O=0;do{g=N[a+O++],X.head&&g&&X.length<65536&&(X.head.name+=String.fromCharCode(g))}while(g&&O<V);if(512&X.flags&&(X.check=F(X.check,N,O,a)),V-=O,a+=O,g)break T}else X.head&&(X.head.name=null);X.length=0,X.mode=8;case 8:if(4096&X.flags){if(0===V)break T;O=0;do{g=N[a+O++],X.head&&g&&X.length<65536&&(X.head.comment+=String.fromCharCode(g))}while(g&&O<V);if(512&X.flags&&(X.check=F(X.check,N,O,a)),V-=O,a+=O,g)break T}else X.head&&(X.head.comment=null);X.mode=9;case 9:if(512&X.flags){for(;j<16;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}if(G!==(65535&X.check)){T.msg="header crc mismatch",X.mode=K;break}G=0,j=0}X.head&&(X.head.hcrc=X.flags>>9&1,X.head.done=!0),T.adler=X.check=0,X.mode=x;break;case 10:for(;j<32;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}T.adler=X.check=d(G),G=0,j=0,X.mode=11;case 11:if(0===X.havedict)return T.next_out=q,T.avail_out=C,T.next_in=a,T.avail_in=V,X.hold=G,X.bits=j,D;T.adler=X.check=1,X.mode=x;case x:if(z===E||z===v)break T;case 13:if(X.last){G>>>=7&j,j-=7&j,X.mode=27;break}for(;j<3;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}switch(X.last=1&G,G>>>=1,j-=1,3&G){case 0:X.mode=14;break;case 1:if(Z(X),X.mode=20,z===v){G>>>=2,j-=2;break T}break;case 2:X.mode=17;break;case 3:T.msg="invalid block type",X.mode=K}G>>>=2,j-=2;break;case 14:for(G>>>=7&j,j-=7&j;j<32;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}if((65535&G)!==(G>>>16^65535)){T.msg="invalid stored block lengths",X.mode=K;break}if(X.length=65535&G,G=0,j=0,X.mode=15,z===v)break T;case 15:X.mode=16;case 16:if(O=X.length,O){if(O>V&&(O=V),O>C&&(O=C),0===O)break T;l.set(N.subarray(a,a+O),q),V-=O,a+=O,C-=O,q+=O,X.length-=O;break}X.mode=x;break;case 17:for(;j<14;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}if(X.nlen=257+(31&G),G>>>=5,j-=5,X.ndist=1+(31&G),G>>>=5,j-=5,X.ncode=4+(15&G),G>>>=4,j-=4,X.nlen>286||X.ndist>30){T.msg="too many length or distance symbols",X.mode=K;break}X.have=0,X.mode=18;case 18:for(;X.have<X.ncode;){for(;j<3;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}X.lens[Q[X.have++]]=7&G,G>>>=3,j-=3}for(;X.have<19;)X.lens[Q[X.have++]]=0;if(X.lencode=X.lendyn,X.lenbits=7,f={bits:X.lenbits},M=u(0,X.lens,0,19,X.lencode,0,X.work,f),X.lenbits=f.bits,M){T.msg="invalid code lengths set",X.mode=K;break}X.have=0,X.mode=19;case 19:for(;X.have<X.nlen+X.ndist;){for(;r=X.lencode[G&(1<<X.lenbits)-1],B=r>>>24,e=r>>>16&255,R=65535&r,!(B<=j);){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}if(R<16)G>>>=B,j-=B,X.lens[X.have++]=R;else{if(16===R){for(h=B+2;j<h;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}if(G>>>=B,j-=B,0===X.have){T.msg="invalid bit length repeat",X.mode=K;break}g=X.lens[X.have-1],O=3+(3&G),G>>>=2,j-=2}else if(17===R){for(h=B+3;j<h;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}G>>>=B,j-=B,g=0,O=3+(7&G),G>>>=3,j-=3}else{for(h=B+7;j<h;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}G>>>=B,j-=B,g=0,O=11+(127&G),G>>>=7,j-=7}if(X.have+O>X.nlen+X.ndist){T.msg="invalid bit length repeat",X.mode=K;break}for(;O--;)X.lens[X.have++]=g}}if(X.mode===K)break;if(0===X.lens[256]){T.msg="invalid code -- missing end-of-block",X.mode=K;break}if(X.lenbits=9,f={bits:X.lenbits},M=u(1,X.lens,0,X.nlen,X.lencode,0,X.work,f),X.lenbits=f.bits,M){T.msg="invalid literal/lengths set",X.mode=K;break}if(X.distbits=6,X.distcode=X.distdyn,f={bits:X.distbits},M=u(2,X.lens,X.nlen,X.ndist,X.distcode,0,X.work,f),X.distbits=f.bits,M){T.msg="invalid distances set",X.mode=K;break}if(X.mode=20,z===v)break T;case 20:X.mode=21;case 21:if(V>=6&&C>=258){T.next_out=q,T.avail_out=C,T.next_in=a,T.avail_in=V,X.hold=G,X.bits=j,A(T,n),q=T.next_out,l=T.output,C=T.avail_out,a=T.next_in,N=T.input,V=T.avail_in,G=X.hold,j=X.bits,X.mode===x&&(X.back=-1);break}for(X.back=0;r=X.lencode[G&(1<<X.lenbits)-1],B=r>>>24,e=r>>>16&255,R=65535&r,!(B<=j);){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}if(e&&0===(240&e)){for(Y=B,i=e,t=R;r=X.lencode[t+((G&(1<<Y+i)-1)>>Y)],B=r>>>24,e=r>>>16&255,R=65535&r,!(Y+B<=j);){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}G>>>=Y,j-=Y,X.back+=Y}if(G>>>=B,j-=B,X.back+=B,X.length=R,0===e){X.mode=26;break}if(32&e){X.back=-1,X.mode=x;break}if(64&e){T.msg="invalid literal/length code",X.mode=K;break}X.extra=15&e,X.mode=22;case 22:if(X.extra){for(h=X.extra;j<h;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}X.length+=G&(1<<X.extra)-1,G>>>=X.extra,j-=X.extra,X.back+=X.extra}X.was=X.length,X.mode=23;case 23:for(;r=X.distcode[G&(1<<X.distbits)-1],B=r>>>24,e=r>>>16&255,R=65535&r,!(B<=j);){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}if(0===(240&e)){for(Y=B,i=e,t=R;r=X.distcode[t+((G&(1<<Y+i)-1)>>Y)],B=r>>>24,e=r>>>16&255,R=65535&r,!(Y+B<=j);){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}G>>>=Y,j-=Y,X.back+=Y}if(G>>>=B,j-=B,X.back+=B,64&e){T.msg="invalid distance code",X.mode=K;break}X.offset=R,X.extra=15&e,X.mode=24;case 24:if(X.extra){for(h=X.extra;j<h;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}X.offset+=G&(1<<X.extra)-1,G>>>=X.extra,j-=X.extra,X.back+=X.extra}if(X.offset>X.dmax){T.msg="invalid distance too far back",X.mode=K;break}X.mode=25;case 25:if(0===C)break T;if(O=n-C,X.offset>O){if(O=X.offset-O,O>X.whave&&X.sane){T.msg="invalid distance too far back",X.mode=K;break}O>X.wnext?(O-=X.wnext,P=X.wsize-O):P=X.wnext-O,O>X.length&&(O=X.length),W=X.window}else W=l,P=q-X.offset,O=X.length;O>C&&(O=C),C-=O,X.length-=O;do{l[q++]=W[P++]}while(--O);0===X.length&&(X.mode=21);break;case 26:if(0===C)break T;l[q++]=X.length,C--,X.mode=21;break;case 27:if(X.wrap){for(;j<32;){if(0===V)break T;V--,G|=N[a++]<<j,j+=8}if(n-=C,T.total_out+=n,X.total+=n,n&&(T.adler=X.check=X.flags?F(X.check,l,n,q-n):b(X.check,l,n,q-n)),n=C,(X.flags?G:d(G))!==X.check){T.msg="incorrect data check",X.mode=K;break}G=0,j=0}X.mode=28;case 28:if(X.wrap&&X.flags){for(;j<32;){if(0===V)break T;V--,G+=N[a++]<<j,j+=8}if(G!==(4294967295&X.total)){T.msg="incorrect length check",X.mode=K;break}G=0,j=0}X.mode=29;case 29:M=L;break T;case K:M=p;break T;case 31:return H;default:return c}return T.next_out=q,T.avail_out=C,T.next_in=a,T.avail_in=V,X.hold=G,X.bits=j,(X.wsize||n!==T.avail_out&&X.mode<K&&(X.mode<27||z!==y))&&m(T,T.output,T.next_out,n-T.avail_out)?(X.mode=31,H):(S-=T.avail_in,n-=T.avail_out,T.total_in+=S,T.total_out+=n,X.total+=n,X.wrap&&n&&(T.adler=X.check=X.flags?F(X.check,l,n,T.next_out-n):b(X.check,l,n,T.next_out-n)),T.data_type=X.bits+(X.last?64:0)+(X.mode===x?128:0)+(20===X.mode||15===X.mode?256:0),(0===S&&0===n||z===y)&&M===k&&(M=U),M)},T.exports.inflateEnd=T=>{if(!T||!T.state)return c;let z=T.state;return z.window&&(z.window=null),T.state=null,k},T.exports.inflateGetHeader=(T,z)=>{if(!T||!T.state)return c;const X=T.state;return 0===(2&X.wrap)?c:(X.head=z,z.done=!1,k)},T.exports.inflateSetDictionary=(T,z)=>{const X=z.length;let F,A,u;return T&&T.state?(F=T.state,0!==F.wrap&&11!==F.mode?c:11===F.mode&&(A=1,A=b(A,z,X,0),A!==F.check)?p:(u=m(T,z,X,X),u?(F.mode=31,H):(F.havedict=1,k))):c},T.exports.inflateInfo="pako inflate (from Nodeca project)"},11891:T=>{"use strict";const z=15,X=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),b=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),F=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),A=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);T.exports=(T,u,y,E,v,k,L,D)=>{const c=D.bits;let p,H,U,s,x,K,d=0,N=0,l=0,a=0,q=0,V=0,C=0,G=0,j=0,Z=0,m=null,S=0;const n=new Uint16Array(16),O=new Uint16Array(16);let P,W,B,e=null,R=0;for(d=0;d<=z;d++)n[d]=0;for(N=0;N<E;N++)n[u[y+N]]++;for(q=c,a=z;a>=1&&0===n[a];a--);if(q>a&&(q=a),0===a)return v[k++]=20971520,v[k++]=20971520,D.bits=1,0;for(l=1;l<a&&0===n[l];l++);for(q<l&&(q=l),G=1,d=1;d<=z;d++)if(G<<=1,G-=n[d],G<0)return-1;if(G>0&&(0===T||1!==a))return-1;for(O[1]=0,d=1;d<z;d++)O[d+1]=O[d]+n[d];for(N=0;N<E;N++)0!==u[y+N]&&(L[O[u[y+N]]++]=N);if(0===T?(m=e=L,K=19):1===T?(m=X,S-=257,e=b,R-=257,K=256):(m=F,e=A,K=-1),Z=0,N=0,d=l,x=k,V=q,C=0,U=-1,j=1<<q,s=j-1,1===T&&j>852||2===T&&j>592)return 1;for(;;){P=d-C,L[N]<K?(W=0,B=L[N]):L[N]>K?(W=e[R+L[N]],B=m[S+L[N]]):(W=96,B=0),p=1<<d-C,H=1<<V,l=H;do{H-=p,v[x+(Z>>C)+H]=P<<24|W<<16|B}while(0!==H);for(p=1<<d-1;Z&p;)p>>=1;if(0!==p?(Z&=p-1,Z+=p):Z=0,N++,0===--n[d]){if(d===a)break;d=u[y+L[N]]}if(d>q&&(Z&s)!==U){for(0===C&&(C=q),x+=l,V=d-C,G=1<<V;V+C<a&&(G-=n[V+C],!(G<=0));)V++,G<<=1;if(j+=1<<V,1===T&&j>852||2===T&&j>592)return 1;U=Z&s,v[U]=q<<24|V<<16|x-k}}return 0!==Z&&(v[x+Z]=d-C<<24|64<<16),D.bits=q,0}},11856:T=>{"use strict";T.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11843:T=>{"use strict";function z(T){let z=T.length;for(;--z>=0;)T[z]=0}const X=256,b=286,F=30,A=15,u=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),y=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),E=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),v=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),k=new Array(576);z(k);const L=new Array(60);z(L);const D=new Array(512);z(D);const c=new Array(256);z(c);const p=new Array(29);z(p);const H=new Array(F);function U(T,z,X,b,F){this.static_tree=T,this.extra_bits=z,this.extra_base=X,this.elems=b,this.max_length=F,this.has_stree=T&&T.length}let s,x,K;function d(T,z){this.dyn_tree=T,this.max_code=0,this.stat_desc=z}z(H);const N=T=>T<256?D[T]:D[256+(T>>>7)],l=(T,z)=>{T.pending_buf[T.pending++]=255&z,T.pending_buf[T.pending++]=z>>>8&255},a=(T,z,X)=>{T.bi_valid>16-X?(T.bi_buf|=z<<T.bi_valid&65535,l(T,T.bi_buf),T.bi_buf=z>>16-T.bi_valid,T.bi_valid+=X-16):(T.bi_buf|=z<<T.bi_valid&65535,T.bi_valid+=X)},q=(T,z,X)=>{a(T,X[2*z],X[2*z+1])},V=(T,z)=>{let X=0;do{X|=1&T,T>>>=1,X<<=1}while(--z>0);return X>>>1},C=(T,z,X)=>{const b=new Array(16);let F,u,y=0;for(F=1;F<=A;F++)b[F]=y=y+X[F-1]<<1;for(u=0;u<=z;u++){let z=T[2*u+1];0!==z&&(T[2*u]=V(b[z]++,z))}},G=T=>{let z;for(z=0;z<b;z++)T.dyn_ltree[2*z]=0;for(z=0;z<F;z++)T.dyn_dtree[2*z]=0;for(z=0;z<19;z++)T.bl_tree[2*z]=0;T.dyn_ltree[512]=1,T.opt_len=T.static_len=0,T.last_lit=T.matches=0},j=T=>{T.bi_valid>8?l(T,T.bi_buf):T.bi_valid>0&&(T.pending_buf[T.pending++]=T.bi_buf),T.bi_buf=0,T.bi_valid=0},Z=(T,z,X,b)=>{const F=2*z,A=2*X;return T[F]<T[A]||T[F]===T[A]&&b[z]<=b[X]},m=(T,z,X)=>{const b=T.heap[X];let F=X<<1;for(;F<=T.heap_len&&(F<T.heap_len&&Z(z,T.heap[F+1],T.heap[F],T.depth)&&F++,!Z(z,b,T.heap[F],T.depth));)T.heap[X]=T.heap[F],X=F,F<<=1;T.heap[X]=b},S=(T,z,b)=>{let F,A,E,v,k=0;if(0!==T.last_lit)do{F=T.pending_buf[T.d_buf+2*k]<<8|T.pending_buf[T.d_buf+2*k+1],A=T.pending_buf[T.l_buf+k],k++,0===F?q(T,A,z):(E=c[A],q(T,E+X+1,z),v=u[E],0!==v&&(A-=p[E],a(T,A,v)),F--,E=N(F),q(T,E,b),v=y[E],0!==v&&(F-=H[E],a(T,F,v)))}while(k<T.last_lit);q(T,256,z)},n=(T,z)=>{const X=z.dyn_tree,b=z.stat_desc.static_tree,F=z.stat_desc.has_stree,u=z.stat_desc.elems;let y,E,v,k=-1;for(T.heap_len=0,T.heap_max=573,y=0;y<u;y++)0!==X[2*y]?(T.heap[++T.heap_len]=k=y,T.depth[y]=0):X[2*y+1]=0;for(;T.heap_len<2;)v=T.heap[++T.heap_len]=k<2?++k:0,X[2*v]=1,T.depth[v]=0,T.opt_len--,F&&(T.static_len-=b[2*v+1]);for(z.max_code=k,y=T.heap_len>>1;y>=1;y--)m(T,X,y);v=u;do{y=T.heap[1],T.heap[1]=T.heap[T.heap_len--],m(T,X,1),E=T.heap[1],T.heap[--T.heap_max]=y,T.heap[--T.heap_max]=E,X[2*v]=X[2*y]+X[2*E],T.depth[v]=(T.depth[y]>=T.depth[E]?T.depth[y]:T.depth[E])+1,X[2*y+1]=X[2*E+1]=v,T.heap[1]=v++,m(T,X,1)}while(T.heap_len>=2);T.heap[--T.heap_max]=T.heap[1],((T,z)=>{const X=z.dyn_tree,b=z.max_code,F=z.stat_desc.static_tree,u=z.stat_desc.has_stree,y=z.stat_desc.extra_bits,E=z.stat_desc.extra_base,v=z.stat_desc.max_length;let k,L,D,c,p,H,U=0;for(c=0;c<=A;c++)T.bl_count[c]=0;for(X[2*T.heap[T.heap_max]+1]=0,k=T.heap_max+1;k<573;k++)L=T.heap[k],c=X[2*X[2*L+1]+1]+1,c>v&&(c=v,U++),X[2*L+1]=c,L>b||(T.bl_count[c]++,p=0,L>=E&&(p=y[L-E]),H=X[2*L],T.opt_len+=H*(c+p),u&&(T.static_len+=H*(F[2*L+1]+p)));if(0!==U){do{for(c=v-1;0===T.bl_count[c];)c--;T.bl_count[c]--,T.bl_count[c+1]+=2,T.bl_count[v]--,U-=2}while(U>0);for(c=v;0!==c;c--)for(L=T.bl_count[c];0!==L;)D=T.heap[--k],D>b||(X[2*D+1]!==c&&(T.opt_len+=(c-X[2*D+1])*X[2*D],X[2*D+1]=c),L--)}})(T,z),C(X,k,T.bl_count)},O=(T,z,X)=>{let b,F,A=-1,u=z[1],y=0,E=7,v=4;for(0===u&&(E=138,v=3),z[2*(X+1)+1]=65535,b=0;b<=X;b++)F=u,u=z[2*(b+1)+1],++y<E&&F===u||(y<v?T.bl_tree[2*F]+=y:0!==F?(F!==A&&T.bl_tree[2*F]++,T.bl_tree[32]++):y<=10?T.bl_tree[34]++:T.bl_tree[36]++,y=0,A=F,0===u?(E=138,v=3):F===u?(E=6,v=3):(E=7,v=4))},P=(T,z,X)=>{let b,F,A=-1,u=z[1],y=0,E=7,v=4;for(0===u&&(E=138,v=3),b=0;b<=X;b++)if(F=u,u=z[2*(b+1)+1],!(++y<E&&F===u)){if(y<v)do{q(T,F,T.bl_tree)}while(0!==--y);else 0!==F?(F!==A&&(q(T,F,T.bl_tree),y--),q(T,16,T.bl_tree),a(T,y-3,2)):y<=10?(q(T,17,T.bl_tree),a(T,y-3,3)):(q(T,18,T.bl_tree),a(T,y-11,7));y=0,A=F,0===u?(E=138,v=3):F===u?(E=6,v=3):(E=7,v=4)}};let W=!1;const B=(T,z,X,b)=>{a(T,0+(b?1:0),3),((T,z,X,b)=>{j(T),b&&(l(T,X),l(T,~X)),T.pending_buf.set(T.window.subarray(z,z+X),T.pending),T.pending+=X})(T,z,X,!0)};T.exports._tr_init=T=>{W||((()=>{let T,z,X,v,d;const N=new Array(16);for(X=0,v=0;v<28;v++)for(p[v]=X,T=0;T<1<<u[v];T++)c[X++]=v;for(c[X-1]=v,d=0,v=0;v<16;v++)for(H[v]=d,T=0;T<1<<y[v];T++)D[d++]=v;for(d>>=7;v<F;v++)for(H[v]=d<<7,T=0;T<1<<y[v]-7;T++)D[256+d++]=v;for(z=0;z<=A;z++)N[z]=0;for(T=0;T<=143;)k[2*T+1]=8,T++,N[8]++;for(;T<=255;)k[2*T+1]=9,T++,N[9]++;for(;T<=279;)k[2*T+1]=7,T++,N[7]++;for(;T<=287;)k[2*T+1]=8,T++,N[8]++;for(C(k,287,N),T=0;T<F;T++)L[2*T+1]=5,L[2*T]=V(T,5);s=new U(k,u,257,b,A),x=new U(L,y,0,F,A),K=new U(new Array(0),E,0,19,7)})(),W=!0),T.l_desc=new d(T.dyn_ltree,s),T.d_desc=new d(T.dyn_dtree,x),T.bl_desc=new d(T.bl_tree,K),T.bi_buf=0,T.bi_valid=0,G(T)},T.exports._tr_stored_block=B,T.exports._tr_flush_block=(T,z,b,F)=>{let A,u,y=0;T.level>0?(2===T.strm.data_type&&(T.strm.data_type=(T=>{let z,b=4093624447;for(z=0;z<=31;z++,b>>>=1)if(1&b&&0!==T.dyn_ltree[2*z])return 0;if(0!==T.dyn_ltree[18]||0!==T.dyn_ltree[20]||0!==T.dyn_ltree[26])return 1;for(z=32;z<X;z++)if(0!==T.dyn_ltree[2*z])return 1;return 0})(T)),n(T,T.l_desc),n(T,T.d_desc),y=(T=>{let z;for(O(T,T.dyn_ltree,T.l_desc.max_code),O(T,T.dyn_dtree,T.d_desc.max_code),n(T,T.bl_desc),z=18;z>=3&&0===T.bl_tree[2*v[z]+1];z--);return T.opt_len+=3*(z+1)+5+5+4,z})(T),A=T.opt_len+3+7>>>3,u=T.static_len+3+7>>>3,u<=A&&(A=u)):A=u=b+5,b+4<=A&&-1!==z?B(T,z,b,F):4===T.strategy||u===A?(a(T,2+(F?1:0),3),S(T,k,L)):(a(T,4+(F?1:0),3),((T,z,X,b)=>{let F;for(a(T,z-257,5),a(T,X-1,5),a(T,b-4,4),F=0;F<b;F++)a(T,T.bl_tree[2*v[F]+1],3);P(T,T.dyn_ltree,z-1),P(T,T.dyn_dtree,X-1)})(T,T.l_desc.max_code+1,T.d_desc.max_code+1,y+1),S(T,T.dyn_ltree,T.dyn_dtree)),G(T),F&&j(T)},T.exports._tr_tally=(T,z,b)=>(T.pending_buf[T.d_buf+2*T.last_lit]=z>>>8&255,T.pending_buf[T.d_buf+2*T.last_lit+1]=255&z,T.pending_buf[T.l_buf+T.last_lit]=255&b,T.last_lit++,0===z?T.dyn_ltree[2*b]++:(T.matches++,z--,T.dyn_ltree[2*(c[b]+X+1)]++,T.dyn_dtree[2*N(z)]++),T.last_lit===T.lit_bufsize-1),T.exports._tr_align=T=>{a(T,2,3),q(T,256,k),(T=>{16===T.bi_valid?(l(T,T.bi_buf),T.bi_buf=0,T.bi_valid=0):T.bi_valid>=8&&(T.pending_buf[T.pending++]=255&T.bi_buf,T.bi_buf>>=8,T.bi_valid-=8)})(T)}},11881:T=>{"use strict";T.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},12233:T=>{function z(T,z,X){for(var b=T.length,F=-1/0,A=1/0,u=0;u<b;u++){var y=(X[0][u]-T[u])/z[u],E=(X[1][u]-T[u])/z[u];if(y>E){var v=y;y=E,E=v}if(E<F||y>A)return 1/0;y>F&&(F=y),E<A&&(A=E)}return F>A?1/0:F}T.exports=function(T,X,b,F){var A=z(X,b,F);if(A===1/0)T=null;else{T=T||[];for(var u=0;u<X.length;u++)T[u]=X[u]+b[u]*A}return T},T.exports.distance=z},12877:(T,z,X)=>{"use strict";X.d(z,{e:()=>u});var b=X(37);const F=b.useLayoutEffect;const A=function(T){var z=(0,b.useRef)(T);return F((function(){z.current=T})),z};var u=function(T){var z=A(T);(0,b.useEffect)((function(){var T=function(T){var X;if(null!=z.current&&(X=z.current(T)),T.defaultPrevented&&(T.returnValue=""),"string"===typeof X)return T.returnValue=X,X};return window.addEventListener("beforeunload",T),function(){window.removeEventListener("beforeunload",T)}}),[])}},12827:(T,z,X)=>{"use strict";var b=X(12832),F=Array.prototype.concat,A=Array.prototype.slice,u=T.exports=function(T){for(var z=[],X=0,u=T.length;X<u;X++){var y=T[X];b(y)?z=F.call(z,A.call(y)):z.push(y)}return z};u.wrap=function(T){return function(){return T(u(arguments))}}},12832:T=>{T.exports=function(T){return!(!T||"string"===typeof T)&&(T instanceof Array||Array.isArray(T)||T.length>=0&&(T.splice instanceof Function||Object.getOwnPropertyDescriptor(T,T.length-1)&&"String"!==T.constructor.name))}},11794:(T,z,X)=>{var b=X(11802);function F(T){for(var z,X,F=0,A=T.length,u=0;u<T.length;){for(z=T[u],X=0;u<A&&T[u]===z;)++u,++X;F+=b.log2(X)/7|0,F+=b.log2(z>>>0)/7|0,F+=2}return F}z.size=F,z.encode=function(T,z){z||(z=new Uint8Array(F(T)));for(var X,b,A=0,u=z.length,y=0;y<T.length;){for(X=T[y],b=0;y<T.length&&T[y]===X;)++y,++b;for(;A<u&&b>=128;)z[A++]=128+(127&b),b>>>=7;if(A>=u)throw new Error("RLE buffer overflow");for(z[A++]=b,X>>>=0;A<u&&X>=128;)z[A++]=128+(127&X),X>>>=7;if(A>=u)throw new Error("RLE buffer overflow");z[A++]=X}return z},z.decode=function(T,z){for(var X,b,F,A,u=z.length,y=T.length,E=0,v=0;v<y;){for(X=0,b=0;v<y&&T[v]>=128;)X+=(127&T[v++])<<b,b+=7;if(X+=T[v++]<<b,v>=y)throw new Error("RLE buffer underrun");if(E+X>u)throw new Error("Chunk buffer overflow");for(F=0,b=0;v<y&&T[v]>=128;)F+=(127&T[v++])<<b,b+=7;if(v>=y)throw new Error("RLE buffer underrun");for(F+=T[v++]<<b,A=0;A<X;++A)z[E++]=F}return z}},11802:(T,z)=>{"use strict";function X(T){var z=32;return(T&=-T)&&z--,65535&T&&(z-=16),16711935&T&&(z-=8),252645135&T&&(z-=4),858993459&T&&(z-=2),1431655765&T&&(z-=1),z}z.INT_BITS=32,z.INT_MAX=2147483647,z.INT_MIN=-1<<31,z.sign=function(T){return(T>0)-(T<0)},z.abs=function(T){var z=T>>31;return(T^z)-z},z.min=function(T,z){return z^(T^z)&-(T<z)},z.max=function(T,z){return T^(T^z)&-(T<z)},z.isPow2=function(T){return!(T&T-1)&&!!T},z.log2=function(T){var z,X;return z=(T>65535)<<4,z|=X=((T>>>=z)>255)<<3,z|=X=((T>>>=X)>15)<<2,(z|=X=((T>>>=X)>3)<<1)|(T>>>=X)>>1},z.log10=function(T){return T>=1e9?9:T>=1e8?8:T>=1e7?7:T>=1e6?6:T>=1e5?5:T>=1e4?4:T>=1e3?3:T>=100?2:T>=10?1:0},z.popCount=function(T){return 16843009*((T=(858993459&(T-=T>>>1&1431655765))+(T>>>2&858993459))+(T>>>4)&252645135)>>>24},z.countTrailingZeros=X,z.nextPow2=function(T){return T+=0===T,--T,T|=T>>>1,T|=T>>>2,T|=T>>>4,T|=T>>>8,(T|=T>>>16)+1},z.prevPow2=function(T){return T|=T>>>1,T|=T>>>2,T|=T>>>4,T|=T>>>8,(T|=T>>>16)-(T>>>1)},z.parity=function(T){return T^=T>>>16,T^=T>>>8,T^=T>>>4,27030>>>(T&=15)&1};var b=new Array(256);!function(T){for(var z=0;z<256;++z){var X=z,b=z,F=7;for(X>>>=1;X;X>>>=1)b<<=1,b|=1&X,--F;T[z]=b<<F&255}}(b),z.reverse=function(T){return b[255&T]<<24|b[T>>>8&255]<<16|b[T>>>16&255]<<8|b[T>>>24&255]},z.interleave2=function(T,z){return(T=1431655765&((T=858993459&((T=252645135&((T=16711935&((T&=65535)|T<<8))|T<<4))|T<<2))|T<<1))|(z=1431655765&((z=858993459&((z=252645135&((z=16711935&((z&=65535)|z<<8))|z<<4))|z<<2))|z<<1))<<1},z.deinterleave2=function(T,z){return(T=65535&((T=16711935&((T=252645135&((T=858993459&((T=T>>>z&1431655765)|T>>>1))|T>>>2))|T>>>4))|T>>>16))<<16>>16},z.interleave3=function(T,z,X){return T=1227133513&((T=3272356035&((T=251719695&((T=4278190335&((T&=1023)|T<<16))|T<<8))|T<<4))|T<<2),(T|=(z=1227133513&((z=3272356035&((z=251719695&((z=4278190335&((z&=1023)|z<<16))|z<<8))|z<<4))|z<<2))<<1)|(X=1227133513&((X=3272356035&((X=251719695&((X=4278190335&((X&=1023)|X<<16))|X<<8))|X<<4))|X<<2))<<2},z.deinterleave3=function(T,z){return(T=1023&((T=4278190335&((T=251719695&((T=3272356035&((T=T>>>z&1227133513)|T>>>2))|T>>>4))|T>>>8))|T>>>16))<<22>>22},z.nextCombination=function(T){var z=T|T-1;return z+1|(~z&-~z)-1>>>X(T)+1}},11825:T=>{"use strict";T.exports=function(T,z,X,b){var F=self||window;try{try{var A;try{A=new F.Blob([T])}catch(v){(A=new(F.BlobBuilder||F.WebKitBlobBuilder||F.MozBlobBuilder||F.MSBlobBuilder)).append(T),A=A.getBlob()}var u=F.URL||F.webkitURL,y=u.createObjectURL(A),E=new F[z](y,X);return u.revokeObjectURL(y),E}catch(v){return new F[z]("data:application/javascript,".concat(encodeURIComponent(T)),X)}}catch(v){if(!b)throw Error("Inline worker is not supported");return new F[z](b,X)}}},12211:(T,z,X)=>{"use strict";function b(T,z,X,b,F){var A={};return Object.keys(b).forEach((function(T){A[T]=b[T]})),A.enumerable=!!A.enumerable,A.configurable=!!A.configurable,("value"in A||A.initializer)&&(A.writable=!0),A=X.slice().reverse().reduce((function(X,b){return b(T,z,X)||X}),A),F&&void 0!==A.initializer&&(A.value=A.initializer?A.initializer.call(F):void 0,A.initializer=void 0),void 0===A.initializer&&(Object.defineProperty(T,z,A),A=null),A}X.d(z,{b:()=>b})},12203:(T,z,X)=>{"use strict";function b(T,z,X,b){X&&Object.defineProperty(T,z,{enumerable:X.enumerable,configurable:X.configurable,writable:X.writable,value:X.initializer?X.initializer.call(b):void 0})}X.d(z,{c:()=>b})},12493:(T,z,X)=>{"use strict";X.d(z,{e:()=>K,f:()=>U,g:()=>s,j:()=>D,l:()=>H,n:()=>p,o:()=>c});var b=X(976),F=X(1132),A=X(1014),u=X(993),y=X(12496),E=X(11948),v=X(1117),k=X(1032),L=X(1122);const D=Object.freeze(new b.e(0,0,0,0)),c=Object.freeze(b.j.Zero()),p=Object.freeze(b.i.Zero()),H=Object.freeze(v.e.Zero()),U=Object.freeze(F.b.Black()),s=Object.freeze(new F.d(0,0,0,0)),x={key:0,repeatCount:0,loopMode:2};class K{static _PrepareAnimation(T,z,X,A,u,y,E,k){let L;if(!isNaN(parseFloat(u))&&isFinite(u)?L=K.ANIMATIONTYPE_FLOAT:u instanceof b.e?L=K.ANIMATIONTYPE_QUATERNION:u instanceof b.j?L=K.ANIMATIONTYPE_VECTOR3:u instanceof b.i?L=K.ANIMATIONTYPE_VECTOR2:u instanceof F.b?L=K.ANIMATIONTYPE_COLOR3:u instanceof F.d?L=K.ANIMATIONTYPE_COLOR4:u instanceof v.e&&(L=K.ANIMATIONTYPE_SIZE),void 0==L)return null;const D=new K(T,z,X,L,E),c=[{frame:0,value:u},{frame:A,value:y}];return D.setKeys(c),void 0!==k&&D.setEasingFunction(k),D}static CreateAnimation(T,z,X,b){const F=new K(T+"Animation",T,X,z,K.ANIMATIONLOOPMODE_CONSTANT);return F.setEasingFunction(b),F}static CreateAndStartAnimation(T,z,X,b,F,A,u,y,E,v,k){const L=K._PrepareAnimation(T,X,b,F,A,u,y,E);return L?(z.va&&(k=z.va()),k?k.beginDirectAnimation(z,[L],0,F,1===L.loopMode,1,v):null):null}static CreateAndStartHierarchyAnimation(T,z,X,b,F,A,u,y,E,v,k){const L=K._PrepareAnimation(T,b,F,A,u,y,E,v);if(!L)return null;return z.va().beginDirectHierarchyAnimation(z,X,[L],0,A,1===L.loopMode,1,k)}static CreateMergeAndStartAnimation(T,z,X,b,F,A,u,y,E,v){const k=K._PrepareAnimation(T,X,b,F,A,u,y,E);return k?(z.animations.push(k),z.va().beginAnimation(z,0,F,1===k.loopMode,1,v)):null}static MakeAnimationAdditive(T,z,X){let F;F="object"===typeof z?z:{referenceFrame:z??0,range:X,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let A=T;if(F.cloneOriginalAnimation&&(A=T.clone(),A.name=F.clonedAnimationName||A.name),!A._keys.length)return A;const u=F.referenceFrame&&F.referenceFrame>=0?F.referenceFrame:0;let y=0;const E=A._keys[0];let v=A._keys.length-1;const k=A._keys[v],L={referenceValue:E.value,referencePosition:b.f.Id[0],referenceQuaternion:b.f.Quaternion[0],referenceScaling:b.f.Id[1],keyPosition:b.f.Id[2],keyQuaternion:b.f.Quaternion[1],keyScaling:b.f.Id[3]};let D=E.frame,c=k.frame;if(F.range){const T=A.getRange(F.range);T&&(D=T.from,c=T.to)}else D=F.fromFrame??D,c=F.toFrame??c;if(D!==E.frame&&(y=A.createKeyForFrame(D)),c!==k.frame&&(v=A.createKeyForFrame(c)),1===A._keys.length){const T=A._getKeyValue(A._keys[0]);L.referenceValue=T.clone?T.clone():T}else if(u<=E.frame){const T=A._getKeyValue(E.value);L.referenceValue=T.clone?T.clone():T}else if(u>=k.frame){const T=A._getKeyValue(k.value);L.referenceValue=T.clone?T.clone():T}else{x.key=0;const T=A._interpolate(u,x);L.referenceValue=T.clone?T.clone():T}A.dataType===K.ANIMATIONTYPE_QUATERNION?L.referenceValue.normalize().conjugateInPlace():A.dataType===K.ANIMATIONTYPE_MATRIX&&(L.referenceValue.decompose(L.referenceScaling,L.referenceQuaternion,L.referencePosition),L.referenceQuaternion.normalize().conjugateInPlace());let p=Number.MAX_VALUE;const H=F.clipKeys?[]:null;for(let U=y;U<=v;U++){let T=A._keys[U];if((H||F.cloneOriginalAnimation)&&(T={frame:T.frame,value:T.value.clone?T.value.clone():T.value,inTangent:T.inTangent,outTangent:T.outTangent,interpolation:T.interpolation,lockedTangent:T.lockedTangent},H&&(p===Number.MAX_VALUE&&(p=T.frame),T.frame-=p,H.push(T))),!U||A.dataType===K.ANIMATIONTYPE_FLOAT||T.value!==E.value)switch(A.dataType){case K.ANIMATIONTYPE_MATRIX:T.value.decompose(L.keyScaling,L.keyQuaternion,L.keyPosition),L.keyPosition.vd(L.referencePosition),L.keyScaling.divideInPlace(L.referenceScaling),L.referenceQuaternion.multiplyToRef(L.keyQuaternion,L.keyQuaternion),b.d.ComposeToRef(L.keyScaling,L.keyQuaternion,L.keyPosition,T.value);break;case K.ANIMATIONTYPE_QUATERNION:L.referenceValue.multiplyToRef(T.value,T.value);break;case K.ANIMATIONTYPE_VECTOR2:case K.ANIMATIONTYPE_VECTOR3:case K.ANIMATIONTYPE_COLOR3:case K.ANIMATIONTYPE_COLOR4:T.value.subtractToRef(L.referenceValue,T.value);break;case K.ANIMATIONTYPE_SIZE:T.value.width-=L.referenceValue.width,T.value.height-=L.referenceValue.height;break;default:T.value-=L.referenceValue}}return H&&A.setKeys(H,!0),A}static TransitionTo(T,z,X,b,F,A,u){let y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(u<=0)return X[T]=z,y&&y(),null;const E=F*(u/1e3);A.setKeys([{frame:0,value:X[T].clone?X[T].clone():X[T]},{frame:E,value:z}]),X.animations||(X.animations=[]),X.animations.push(A);const v=b.beginAnimation(X,0,E,!1);return v.onAnimationEnd=y,v}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const T of this._runtimeAnimations)if(!T.isStopped())return!0;return!1}constructor(T,z,X,b,F,A){this.name=T,this.targetProperty=z,this.framePerSecond=X,this.dataType=b,this.loopMode=F,this.enableBlending=A,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=z.split("."),this.dataType=b,this.loopMode=void 0===F?K.ANIMATIONLOOPMODE_CYCLE:F,this.uniqueId=K._UniqueIdGenerator++}toString(T){let z="Name: "+this.name+", property: "+this.targetProperty;if(z+=", datatype: "+["Float","Id","Quaternion","Matrix","Wd","Vector2"][this.dataType],z+=", nKeys: "+(this._keys?this._keys.length:"none"),z+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),T){z+=", Ranges: {";let T=!0;for(const X in this._ranges)T&&(z+=", ",T=!1),z+=X;z+="}"}return z}addEvent(T){this._events.push(T),this._events.sort(((T,z)=>T.frame-z.frame))}removeEvents(T){for(let z=0;z<this._events.length;z++)this._events[z].frame===T&&(this._events.splice(z,1),z--)}getEvents(){return this._events}createRange(T,z,X){this._ranges[T]||(this._ranges[T]=new y.c(T,z,X))}deleteRange(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const X=this._ranges[T];if(X){if(z){const T=X.from,z=X.to;for(let X=this._keys.length-1;X>=0;X--)this._keys[X].frame>=T&&this._keys[X].frame<=z&&this._keys.splice(X,1)}this._ranges[T]=null}}getRange(T){return this._ranges[T]}getKeys(){return this._keys}getHighestFrame(){let T=0;for(let z=0,X=this._keys.length;z<X;z++)T<this._keys[z].frame&&(T=this._keys[z].frame);return T}getEasingFunction(){return this._easingFunction}setEasingFunction(T){this._easingFunction=T}floatInterpolateFunction(T,z,X){return(0,A.p)(T,z,X)}floatInterpolateFunctionWithTangents(T,z,X,b,F){return(0,A.e)(T,z,X,b,F)}quaternionInterpolateFunction(T,z,X){return b.e.Slerp(T,z,X)}quaternionInterpolateFunctionWithTangents(T,z,X,F,A){return b.e.Hermite(T,z,X,F,A).normalize()}vector3InterpolateFunction(T,z,X){return b.j.Lerp(T,z,X)}vector3InterpolateFunctionWithTangents(T,z,X,F,A){return b.j.Hermite(T,z,X,F,A)}vector2InterpolateFunction(T,z,X){return b.i.Lerp(T,z,X)}vector2InterpolateFunctionWithTangents(T,z,X,F,A){return b.i.Hermite(T,z,X,F,A)}sizeInterpolateFunction(T,z,X){return v.e.Lerp(T,z,X)}color3InterpolateFunction(T,z,X){return F.b.Lerp(T,z,X)}color3InterpolateFunctionWithTangents(T,z,X,b,A){return F.b.Hermite(T,z,X,b,A)}color4InterpolateFunction(T,z,X){return F.d.Lerp(T,z,X)}color4InterpolateFunctionWithTangents(T,z,X,b,A){return F.d.Hermite(T,z,X,b,A)}_getKeyValue(T){return"function"===typeof T?T():T}evaluate(T){return x.key=0,this._interpolate(T,x)}_interpolate(T,z){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(z.loopMode===K.ANIMATIONLOOPMODE_CONSTANT&&z.repeatCount>0)return z.highLimitValue.clone?z.highLimitValue.clone():z.highLimitValue;const b=this._keys,F=b.length;let A=z.key;for(;A>=0&&T<b[A].frame;)--A;for(;A+1<=F-1&&T>=b[A+1].frame;)++A;if(z.key=A,A<0)return X?void 0:this._getKeyValue(b[0].value);if(A+1>F-1)return X?void 0:this._getKeyValue(b[F-1].value);const u=b[A],y=b[A+1];if(X&&(T===u.frame||T===y.frame))return;const E=this._getKeyValue(u.value),v=this._getKeyValue(y.value);if(1===u.interpolation)return y.frame>T?E:v;const k=void 0!==u.outTangent&&void 0!==y.inTangent,L=y.frame-u.frame;let x=(T-u.frame)/L;const d=u.easingFunction||this.getEasingFunction();switch(null!==d&&(x=d.ease(x)),this.dataType){case K.ANIMATIONTYPE_FLOAT:{const T=k?this.floatInterpolateFunctionWithTangents(E,u.outTangent*L,v,y.inTangent*L,x):this.floatInterpolateFunction(E,v,x);switch(z.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return T;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(z.offsetValue??0)*z.repeatCount+T}break}case K.ANIMATIONTYPE_QUATERNION:{const T=k?this.quaternionInterpolateFunctionWithTangents(E,u.outTangent.scale(L),v,y.inTangent.scale(L),x):this.quaternionInterpolateFunction(E,v,x);switch(z.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return T;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return T.addInPlace((z.offsetValue||D).scale(z.repeatCount))}return T}case K.ANIMATIONTYPE_VECTOR3:{const T=k?this.vector3InterpolateFunctionWithTangents(E,u.outTangent.scale(L),v,y.inTangent.scale(L),x):this.vector3InterpolateFunction(E,v,x);switch(z.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return T;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return T.add((z.offsetValue||c).scale(z.repeatCount))}break}case K.ANIMATIONTYPE_VECTOR2:{const T=k?this.vector2InterpolateFunctionWithTangents(E,u.outTangent.scale(L),v,y.inTangent.scale(L),x):this.vector2InterpolateFunction(E,v,x);switch(z.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return T;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return T.add((z.offsetValue||p).scale(z.repeatCount))}break}case K.ANIMATIONTYPE_SIZE:switch(z.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(E,v,x);case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(E,v,x).add((z.offsetValue||H).scale(z.repeatCount))}break;case K.ANIMATIONTYPE_COLOR3:{const T=k?this.color3InterpolateFunctionWithTangents(E,u.outTangent.scale(L),v,y.inTangent.scale(L),x):this.color3InterpolateFunction(E,v,x);switch(z.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return T;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return T.add((z.offsetValue||U).scale(z.repeatCount))}break}case K.ANIMATIONTYPE_COLOR4:{const T=k?this.color4InterpolateFunctionWithTangents(E,u.outTangent.scale(L),v,y.inTangent.scale(L),x):this.color4InterpolateFunction(E,v,x);switch(z.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return T;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return T.add((z.offsetValue||s).scale(z.repeatCount))}break}case K.ANIMATIONTYPE_MATRIX:switch(z.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return K.AllowMatricesInterpolation?this.matrixInterpolateFunction(E,v,x,z.workValue):E;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return E}}return 0}matrixInterpolateFunction(T,z,X,F){return K.AllowMatrixDecomposeForInterpolation?F?(b.d.DecomposeLerpToRef(T,z,X,F),F):b.d.DecomposeLerp(T,z,X):F?(b.d.LerpToRef(T,z,X,F),F):b.d.Lerp(T,z,X)}clone(){const T=new K(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(T.enableBlending=this.enableBlending,T.blendingSpeed=this.blendingSpeed,this._keys&&T.setKeys(this._keys),this._ranges){T._ranges={};for(const z in this._ranges){const X=this._ranges[z];X&&(T._ranges[z]=X.clone())}}return T}setKeys(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=z?T:T.slice(0)}createKeyForFrame(T){x.key=0;const z=this._interpolate(T,x,!0);if(!z)return this._keys[x.key].frame===T?x.key:x.key+1;const X={frame:T,value:z.clone?z.clone():z};return this._keys.splice(x.key+1,0,X),x.key+1}serialize(){const T={};T.name=this.name,T.property=this.targetProperty,T.framePerSecond=this.framePerSecond,T.dataType=this.dataType,T.loopBehavior=this.loopMode,T.enableBlending=this.enableBlending,T.blendingSpeed=this.blendingSpeed;const z=this.dataType;T.keys=[];const X=this.getKeys();for(let b=0;b<X.length;b++){const F=X[b],A={};switch(A.frame=F.frame,z){case K.ANIMATIONTYPE_FLOAT:A.values=[F.value],void 0!==F.inTangent&&A.values.push(F.inTangent),void 0!==F.outTangent&&(void 0===F.inTangent&&A.values.push(void 0),A.values.push(F.outTangent)),void 0!==F.interpolation&&(void 0===F.inTangent&&A.values.push(void 0),void 0===F.outTangent&&A.values.push(void 0),A.values.push(F.interpolation));break;case K.ANIMATIONTYPE_QUATERNION:case K.ANIMATIONTYPE_MATRIX:case K.ANIMATIONTYPE_VECTOR3:case K.ANIMATIONTYPE_COLOR3:case K.ANIMATIONTYPE_COLOR4:A.values=F.value.zd(),void 0!=F.inTangent&&A.values.push(F.inTangent.zd()),void 0!=F.outTangent&&(void 0===F.inTangent&&A.values.push(void 0),A.values.push(F.outTangent.zd())),void 0!==F.interpolation&&(void 0===F.inTangent&&A.values.push(void 0),void 0===F.outTangent&&A.values.push(void 0),A.values.push(F.interpolation))}T.keys.push(A)}T.ranges=[];for(const b in this._ranges){const z=this._ranges[b];if(!z)continue;const X={};X.name=b,X.from=z.from,X.to=z.to,T.ranges.push(X)}return T}static _UniversalLerp(T,z,X){const b=T.constructor;return b.Lerp?b.Lerp(T,z,X):b.Slerp?b.Slerp(T,z,X):T.toFixed?T*(1-X)+X*z:z}static Parse(T){const z=new K(T.name,T.property,T.framePerSecond,T.dataType,T.loopBehavior),X=T.dataType,A=[];let u,y;for(T.enableBlending&&(z.enableBlending=T.enableBlending),T.blendingSpeed&&(z.blendingSpeed=T.blendingSpeed),y=0;y<T.keys.length;y++){const z=T.keys[y];let E,v,k;switch(X){case K.ANIMATIONTYPE_FLOAT:u=z.values[0],z.values.length>=2&&(E=z.values[1]),z.values.length>=3&&(v=z.values[2]),z.values.length>=4&&(k=z.values[3]);break;case K.ANIMATIONTYPE_QUATERNION:if(u=b.e.xd(z.values),z.values.length>=8){const T=b.e.xd(z.values.slice(4,8));T.equals(b.e.Zero())||(E=T)}if(z.values.length>=12){const T=b.e.xd(z.values.slice(8,12));T.equals(b.e.Zero())||(v=T)}z.values.length>=13&&(k=z.values[12]);break;case K.ANIMATIONTYPE_MATRIX:u=b.d.xd(z.values),z.values.length>=17&&(k=z.values[16]);break;case K.ANIMATIONTYPE_COLOR3:u=F.b.xd(z.values),z.values[3]&&(E=F.b.xd(z.values[3])),z.values[4]&&(v=F.b.xd(z.values[4])),z.values[5]&&(k=z.values[5]);break;case K.ANIMATIONTYPE_COLOR4:u=F.d.xd(z.values),z.values[4]&&(E=F.d.xd(z.values[4])),z.values[5]&&(v=F.d.xd(z.values[5])),z.values[6]&&(k=F.d.xd(z.values[6]));break;case K.ANIMATIONTYPE_VECTOR3:default:u=b.j.xd(z.values),z.values[3]&&(E=b.j.xd(z.values[3])),z.values[4]&&(v=b.j.xd(z.values[4])),z.values[5]&&(k=z.values[5])}const L={};L.frame=z.frame,L.value=u,void 0!=E&&(L.inTangent=E),void 0!=v&&(L.outTangent=v),void 0!=k&&(L.interpolation=k),A.push(L)}if(z.setKeys(A),T.ranges)for(y=0;y<T.ranges.length;y++)u=T.ranges[y],z.createRange(u.name,u.from,u.to);return z}static AppendSerializedAnimations(T,z){L.b.AppendSerializedAnimations(T,z)}static ParseFromFileAsync(T,z){return new Promise(((X,b)=>{const F=new k.e;F.addEventListener("readystatechange",(()=>{if(4==F.readyState)if(200==F.status){let z=JSON.parse(F.responseText);if(z.animations&&(z=z.animations),z.length){const T=[];for(const X of z)T.push(this.Parse(X));X(T)}else{const b=this.Parse(z);T&&(b.name=T),X(b)}}else b("Unable to load the animation")})),F.open("GET",z),F.send()}))}static ParseFromSnippetAsync(T){return new Promise(((z,X)=>{const b=new k.e;b.addEventListener("readystatechange",(()=>{if(4==b.readyState)if(200==b.status){const X=JSON.parse(JSON.parse(b.responseText).jsonPayload);if(X.animations){const b=JSON.parse(X.animations),F=[];for(const z of b.animations){const X=this.Parse(z);X.snippetId=T,F.push(X)}z(F)}else{const b=JSON.parse(X.animation),F=this.Parse(b);F.snippetId=T,z(F)}}else X("Unable to load the snippet "+T)})),b.open("GET",this.SnippetUrl+"/"+T.replace(/#/g,"/")),b.send()}))}}K._UniqueIdGenerator=0,K.AllowMatricesInterpolation=!1,K.AllowMatrixDecomposeForInterpolation=!0,K.SnippetUrl="https://snippet.babylonjs.com",K.ANIMATIONTYPE_FLOAT=0,K.ANIMATIONTYPE_VECTOR3=1,K.ANIMATIONTYPE_QUATERNION=2,K.ANIMATIONTYPE_MATRIX=3,K.ANIMATIONTYPE_COLOR3=4,K.ANIMATIONTYPE_COLOR4=7,K.ANIMATIONTYPE_VECTOR2=5,K.ANIMATIONTYPE_SIZE=6,K.ANIMATIONLOOPMODE_RELATIVE=0,K.ANIMATIONLOOPMODE_CYCLE=1,K.ANIMATIONLOOPMODE_CONSTANT=2,K.ANIMATIONLOOPMODE_YOYO=4,K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,K.CreateFromSnippetAsync=K.ParseFromSnippetAsync,(0,u.h)("BABYLON.Animation",K),E.b._AnimationRangeFactory=(T,z,X)=>new y.c(T,z,X)},12496:(T,z,X)=>{"use strict";X.d(z,{c:()=>b});class b{constructor(T,z,X){this.name=T,this.from=z,this.to=X}clone(){return new b(this.name,this.from,this.to)}}},12491:(T,z,X)=>{"use strict";X.d(z,{d:()=>u});var b=X(976),F=X(987),A=X(11948);class u extends A.b{get _matrix(){return this._compose(),this._j}set _matrix(T){(T.updateFlag!==this._j.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this._j.p(T),this._markAsDirtyAndDecompose())}constructor(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(T,z.va(),!1),this.name=T,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=z,this._j=(null===F||void 0===F?void 0:F.clone())??b.d.Identity(),this._restMatrix=A??this._j.clone(),this._bindMatrix=u??this._j.clone(),this._index=y,this._absoluteMatrix=new b.d,this._absoluteBindMatrix=new b.d,this._absoluteInverseBindMatrix=new b.d,this._finalMatrix=new b.d,z.bones.push(this),this.setParent(X,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(T){this.setParent(T)}setParent(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==T){if(this.parent){const T=this.parent.children.indexOf(this);-1!==T&&this.parent.children.splice(T,1)}this._parentNode=T,this.parent&&this.parent.children.push(this),z&&this._updateAbsoluteBindMatrices(),this.Fe()}}getLocalMatrix(){return this._compose(),this._j}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(T){this._restMatrix.p(T)}setRestPose(T){this.setRestMatrix(T)}getBindPose(){return this.getBindMatrix()}setBindMatrix(T){this._d(T)}setBindPose(T){this.setBindMatrix(T)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const T=b.f.Id[0],z=b.f.Quaternion[0],X=b.f.Id[1];this.getRestMatrix().decompose(T,z,X),this._linkedTransformNode.position.p(X),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??b.e.Identity(),this._linkedTransformNode.rotationQuaternion.p(z),this._linkedTransformNode.Pd.p(T)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(T){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=T,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Eg}set position(T){this._decompose(),this.Eg.p(T),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(T){this.setRotation(T)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(T){this.setRotationQuaternion(T)}get Pd(){return this.getScale()}set Pd(T){this.setScale(T)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=b.j.Zero(),this._localRotation=b.e.Zero(),this.Eg=b.j.Zero()),this._j.decompose(this._localScaling,this._localRotation,this.Eg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,b.d.ComposeToRef(this._localScaling,this._localRotation,this.Eg,this._j)):this._needToCompose=!1)}_d(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(T),z&&this._updateAbsoluteBindMatrices(),X?this._matrix=T:this.Fe()}_updateAbsoluteBindMatrices(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(T||(T=this._bindMatrix),this.parent?T.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(T),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),z)for(let X=0;X<this.children.length;X++)this.children[X]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Fe(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Fe(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Fe(),this._needToDecompose=!0}_updatePosition(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2?arguments[2]:void 0,F=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const A=this.getLocalMatrix();if(0==z)F?(A.addAtIndex(12,T.x),A.addAtIndex(13,T.y),A.addAtIndex(14,T.z)):A.setTranslationFromFloats(T.x,T.y,T.z);else{let z=null;X&&(z=X.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const y=u._TmpMats[0],E=u._TmpVecs[0];this.parent?X&&z?(y.p(this.parent.getAbsoluteMatrix()),y.multiplyToRef(z,y)):y.p(this.parent.getAbsoluteMatrix()):b.d.IdentityToRef(y),F&&y.setTranslationFromFloats(0,0,0),y.invert(),b.j.TransformCoordinatesToRef(T,y,E),F?(A.addAtIndex(12,E.x),A.addAtIndex(13,E.y),A.addAtIndex(14,E.z)):A.setTranslationFromFloats(E.x,E.y,E.z)}this._markAsDirtyAndDecompose()}translate(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2?arguments[2]:void 0;this._updatePosition(T,z,X,!0)}setPosition(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2?arguments[2]:void 0;this._updatePosition(T,z,X,!1)}setAbsolutePosition(T,z){this.setPosition(T,1,z)}scale(T,z,X){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const A=this.getLocalMatrix(),y=u._TmpMats[0];b.d.ScalingToRef(T,z,X,y),y.multiplyToRef(A,A),y.invert();for(const b of this.children){const F=b.getLocalMatrix();F.multiplyToRef(y,F),F.multiplyAtIndex(12,T),F.multiplyAtIndex(13,z),F.multiplyAtIndex(14,X),b._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),F)for(const b of this.children)b.scale(T,z,X,F)}setScale(T){this._decompose(),this._localScaling.p(T),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(T){this._decompose(),T.p(this._localScaling)}setYawPitchRoll(T,z,X){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4?arguments[4]:void 0;if(0===F){const y=u._TmpQuat;return b.e.RotationYawPitchRollToRef(T,z,X,y),void this.setRotationQuaternion(y,F,A)}const y=u._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(y,A))return;const E=u._TmpMats[1];b.d.RotationYawPitchRollToRef(T,z,X,E),y.multiplyToRef(E,E),this._rotateWithMatrix(E,F,A)}rotate(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,F=arguments.length>3?arguments[3]:void 0;const A=u._TmpMats[0];A.setTranslationFromFloats(0,0,0),b.d.RotationAxisToRef(T,z,A),this._rotateWithMatrix(A,X,F)}setAxisAngle(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,F=arguments.length>3?arguments[3]:void 0;if(0===X){const A=u._TmpQuat;return b.e.RotationAxisToRef(T,z,A),void this.setRotationQuaternion(A,X,F)}const A=u._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(A,F))return;const y=u._TmpMats[1];b.d.RotationAxisToRef(T,z,y),A.multiplyToRef(y,y),this._rotateWithMatrix(y,X,F)}setRotation(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(T.y,T.x,T.z,z,X)}setRotationQuaternion(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2?arguments[2]:void 0;if(0===z)return this._decompose(),this._localRotation.p(T),void this._markAsDirtyAndCompose();const F=u._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(F,X))return;const A=u._TmpMats[1];b.d.FromQuaternionToRef(T,A),F.multiplyToRef(A,A),this._rotateWithMatrix(A,z,X)}setRotationMatrix(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2?arguments[2]:void 0;if(0===z){const F=u._TmpQuat;return b.e.FromRotationMatrixToRef(T,F),void this.setRotationQuaternion(F,z,X)}const F=u._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(F,X))return;const A=u._TmpMats[1];A.p(T),F.multiplyToRef(T,A),this._rotateWithMatrix(A,z,X)}_rotateWithMatrix(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2?arguments[2]:void 0;const b=this.getLocalMatrix(),F=b.m[12],A=b.m[13],y=b.m[14],E=this.getParent(),v=u._TmpMats[3],k=u._TmpMats[4];E&&1==z?(X?(v.p(X.getWorldMatrix()),E.getAbsoluteMatrix().multiplyToRef(v,v)):v.p(E.getAbsoluteMatrix()),k.p(v),k.invert(),b.multiplyToRef(v,b),b.multiplyToRef(T,b),b.multiplyToRef(k,b)):1==z&&X?(v.p(X.getWorldMatrix()),k.p(v),k.invert(),b.multiplyToRef(v,b),b.multiplyToRef(T,b),b.multiplyToRef(k,b)):b.multiplyToRef(T,b),b.setTranslationFromFloats(F,A,y),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(T,z){const X=u._TmpMats[2];return T.p(this.getAbsoluteMatrix()),z?(T.multiplyToRef(z.getWorldMatrix(),T),b.d.ScalingToRef(z.Pd.x,z.Pd.y,z.Pd.z,X)):b.d.IdentityToRef(X),T.invert(),!isNaN(T.m[0])&&(X.multiplyAtIndex(0,this._scalingDeterminant),T.multiplyToRef(X,T),!0)}cb(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=b.j.Zero();return this.getPositionToRef(T,z,X),X}getPositionToRef(){let T=arguments.length>1?arguments[1]:void 0,z=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const T=this.getLocalMatrix();z.x=T.m[12],z.y=T.m[13],z.z=T.m[14]}else{let X=null;T&&(X=T.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let b=u._TmpMats[0];T&&X?(b.p(this.getAbsoluteMatrix()),b.multiplyToRef(X,b)):b=this.getAbsoluteMatrix(),z.x=b.m[12],z.y=b.m[13],z.z=b.m[14]}}getAbsolutePosition(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const z=b.j.Zero();return this.getPositionToRef(1,T,z),z}getAbsolutePositionToRef(T,z){this.getPositionToRef(1,T,z)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this._j.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this._j);const T=this._skeleton.getPoseMatrix();T&&this._absoluteMatrix.multiplyToRef(T,this._absoluteMatrix)}const T=this.children,z=T.length;for(let X=0;X<z;X++)T[X].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}me(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=b.j.Zero();return this.getDirectionToRef(T,z,X),X}getDirectionToRef(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0,F=null;z&&(F=z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const A=u._TmpMats[0];A.p(this.getAbsoluteMatrix()),z&&F&&A.multiplyToRef(F,A),b.j.TransformNormalToRef(T,A,X),X.normalize()}getRotation(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=b.j.Zero();return this.getRotationToRef(T,z,X),X}getRotationToRef(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0;const b=u._TmpQuat;this.getRotationQuaternionToRef(T,z,b),b.toEulerAnglesToRef(X)}getRotationQuaternion(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=b.e.Identity();return this.getRotationQuaternionToRef(T,z,X),X}getRotationQuaternionToRef(){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,z=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),z.p(this._localRotation);else{const X=u._TmpMats[0],b=this.getAbsoluteMatrix();T?b.multiplyToRef(T.getWorldMatrix(),X):X.p(b),X.multiplyAtIndex(0,this._scalingDeterminant),X.multiplyAtIndex(1,this._scalingDeterminant),X.multiplyAtIndex(2,this._scalingDeterminant),X.decompose(void 0,z,void 0)}}getRotationMatrix(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1?arguments[1]:void 0;const X=b.d.Identity();return this.getRotationMatrixToRef(T,z,X),X}getRotationMatrixToRef(){let T=arguments.length>1?arguments[1]:void 0,z=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(z);else{const X=u._TmpMats[0],b=this.getAbsoluteMatrix();T?b.multiplyToRef(T.getWorldMatrix(),X):X.p(b),X.multiplyAtIndex(0,this._scalingDeterminant),X.multiplyAtIndex(1,this._scalingDeterminant),X.multiplyAtIndex(2,this._scalingDeterminant),X.getRotationMatrixToRef(z)}}getAbsolutePositionFromLocal(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=b.j.Zero();return this.getAbsolutePositionFromLocalToRef(T,z,X),X}getAbsolutePositionFromLocalToRef(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0,F=null;z&&(F=z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const A=u._TmpMats[0];A.p(this.getAbsoluteMatrix()),z&&F&&A.multiplyToRef(F,A),b.j.TransformCoordinatesToRef(T,A,X)}getLocalPositionFromAbsolute(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=b.j.Zero();return this.getLocalPositionFromAbsoluteToRef(T,z,X),X}getLocalPositionFromAbsoluteToRef(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0,F=null;z&&(F=z.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const A=u._TmpMats[0];A.p(this.getAbsoluteMatrix()),z&&F&&A.multiplyToRef(F,A),A.invert(),b.j.TransformCoordinatesToRef(T,A,X)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}u._TmpVecs=(0,F.c)(2,b.j.Zero),u._TmpQuat=b.e.Identity(),u._TmpMats=(0,F.c)(5,b.d.Identity)},12861:(T,z,X)=>{"use strict";X.d(z,{b:()=>S});var b=X(952),F=X(957),A=X(968),u=X(976),y=X(11948),E=X(11933),v=X(1224),k=X(1096),L=X(979);class D{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(T){this._zoomStopsAnimation=T}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(T){this._idleRotationSpeed=T}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(T){this._idleRotationWaitTime=T}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(T){this._idleRotationSpinupTime=T}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(T){this._attachedCamera=T;const z=this._attachedCamera.va();this._onPrePointerObservableObserver=z.onPrePointerObservable.add((T=>{T.type!==v.c.POINTERDOWN?T.type===v.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=T.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const T=k.c.Now;let z=0;null!=this._lastFrameTime&&(z=T-this._lastFrameTime),this._lastFrameTime=T,this._applyUserInteraction();const X=T-this._lastInteractionTime-this._idleRotationWaitTime,b=Math.max(Math.min(X/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*b,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(z/1e3))}))}detach(){if(!this._attachedCamera)return;const T=this._attachedCamera.va();this._onPrePointerObservableObserver&&T.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(T){this._lastInteractionTime=T??k.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<L.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let T=!1;return this._lastFrameRadius===this._attachedCamera.i&&0!==this._attachedCamera.inertialRadiusOffset&&(T=!0),this._lastFrameRadius=this._attachedCamera.i,this._zoomStopsAnimation?T:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=k.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}X(1452);class c{constructor(){this._easingMode=c.EASINGMODE_EASEIN}setEasingMode(T){const z=Math.min(Math.max(T,0),2);this._easingMode=z}getEasingMode(){return this._easingMode}easeInCore(T){throw new Error("You must implement this method")}ease(T){switch(this._easingMode){case c.EASINGMODE_EASEIN:return this.easeInCore(T);case c.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-T)}return T>=.5?.5*(1-this.easeInCore(2*(1-T)))+.5:.5*this.easeInCore(2*T)}}c.EASINGMODE_EASEIN=0,c.EASINGMODE_EASEOUT=1,c.EASINGMODE_EASEINOUT=2;var p=X(12493);class H{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(T){if(this._autoTransitionRange===T)return;this._autoTransitionRange=T;const z=this._attachedCamera;z&&(T?this._onMeshTargetChangedObserver=z.onMeshTargetChangedObservable.add((T=>{if(T&&(T.ze(!0),T.getBoundingInfo)){const z=T.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*z,this.upperRadiusTransitionRange=.05*z}})):this._onMeshTargetChangedObserver&&z.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(T){this._attachedCamera=T,this._onAfterCheckInputsObserver=T.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(T){return!!this._attachedCamera&&(this._attachedCamera.i===T&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(T){if(!this._attachedCamera)return;this._radiusBounceTransition||(H.EasingFunction.setEasingMode(H.EasingMode),this._radiusBounceTransition=p.e.CreateAnimation("i",p.e.ANIMATIONTYPE_FLOAT,60,H.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const z=p.e.TransitionTo("i",this._attachedCamera.i+T,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));z&&this._animatables.push(z)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}H.EasingFunction=new class extends c{constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=T}easeInCore(T){const z=Math.max(0,this.amplitude);return Math.pow(T,3)-T*z*Math.sin(3.141592653589793*T)}}(.3),H.EasingMode=c.EASINGMODE_EASEOUT;class U{constructor(){this.onTargetFramingAnimationEndObservable=new A.d,this._mode=U.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(T){this._mode=T}get mode(){return this._mode}set radiusScale(T){this._radiusScale=T}get radiusScale(){return this._radiusScale}set positionScale(T){this._positionScale=T}get positionScale(){return this._positionScale}set defaultElevation(T){this._defaultElevation=T}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(T){this._elevationReturnTime=T}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(T){this._elevationReturnWaitTime=T}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(T){this._zoomStopsAnimation=T}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(T){this._framingTime=T}get framingTime(){return this._framingTime}init(){}attach(T){this._attachedCamera=T;const z=this._attachedCamera.va();U.EasingFunction.setEasingMode(U.EasingMode),this._onPrePointerObservableObserver=z.onPrePointerObservable.add((T=>{T.type!==v.c.POINTERDOWN?T.type===v.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=T.onMeshTargetChangedObservable.add((T=>{T&&T.getBoundingInfo&&this.zoomOnMesh(T,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=T.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const T=this._attachedCamera.va();this._onPrePointerObservableObserver&&T.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;T.ze(!0);const b=T.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(b.minimumWorld,b.maximumWorld,z,X)}zoomOnMeshHierarchy(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;T.ze(!0);const b=T.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(b.min,b.max,z,X)}zoomOnMeshesHierarchy(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new u.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),F=new u.j(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let A=0;A<T.length;A++){const z=T[A].getHierarchyBoundingVectors(!0);u.j.CheckExtends(z.min,b,F),u.j.CheckExtends(z.max,b,F)}this.zoomOnBoundingInfo(b,F,z,X)}zoomOnBoundingInfo(T,z){let X,b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const A=T.y,y=A+(z.y-A)*this._positionScale,E=z.Mc(T).scale(.5);if(b)X=new u.j(0,y,0);else{const z=T.add(E);X=new u.j(z.x,y,z.z)}this._vectorTransition||(this._vectorTransition=p.e.CreateAnimation("target",p.e.ANIMATIONTYPE_VECTOR3,60,U.EasingFunction)),this._betaIsAnimating=!0;let v=p.e.TransitionTo("target",X,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);v&&this._animatables.push(v);let k=0;if(this._mode===U.FitFrustumSidesMode){const X=this._calculateLowerRadiusFromModelBoundingSphere(T,z);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=E.length()+this._attachedCamera.qj),k=X}else this._mode===U.IgnoreBoundsSizeMode&&(k=this._calculateLowerRadiusFromModelBoundingSphere(T,z),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.qj));if(this.autoCorrectCameraLimitsAndSensibility){const X=z.Mc(T).length();this._attachedCamera.panningSensibility=5e3/X,this._attachedCamera.wheelPrecision=100/k}return this._radiusTransition||(this._radiusTransition=p.e.CreateAnimation("i",p.e.ANIMATIONTYPE_FLOAT,60,U.EasingFunction)),v=p.e.TransitionTo("i",k,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),F&&F(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),v&&this._animatables.push(v),!0}_calculateLowerRadiusFromModelBoundingSphere(T,z){const X=this._attachedCamera;if(!X)return 0;let b=X._calculateLowerRadiusFromModelBoundingSphere(T,z,this._radiusScale);return X.lowerRadiusLimit&&this._mode===U.IgnoreBoundsSizeMode&&(b=b<X.lowerRadiusLimit?X.lowerRadiusLimit:b),X.upperRadiusLimit&&(b=b>X.upperRadiusLimit?X.upperRadiusLimit:b),b}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const T=k.c.Now-this._lastInteractionTime,z=.5*Math.PI-this._defaultElevation,X=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>X&&T>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=p.e.CreateAnimation("beta",p.e.ANIMATIONTYPE_FLOAT,60,U.EasingFunction));const T=p.e.TransitionTo("beta",z,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));T&&this._animatables.push(T)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=k.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}U.EasingFunction=new class extends c{constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=T}easeInCore(T){return this.exponent<=0?T:(Math.exp(this.exponent*T)-1)/(Math.exp(this.exponent)-1)}},U.EasingMode=c.EASINGMODE_EASEINOUT,U.IgnoreBoundsSizeMode=0,U.FitFrustumSidesMode=1;var s=X(11944),x=X(12484),K=X(12486),d=X(1166);class N{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(T){T=d.g.BackCompatCameraNoPreventDefault(arguments);const z=this.camera.getEngine(),X=z.getInputElement();let b=0,F=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=A=>{var u,y;const E=A.event,k="touch"===E.pointerType;if(A.type!==v.c.POINTERMOVE&&-1===this.buttons.indexOf(E.button))return;const L=E.target;if(this._altKey=E.altKey,this._ctrlKey=E.ctrlKey,this._metaKey=E.metaKey,this._shiftKey=E.shiftKey,this._buttonsPressed=E.buttons,z.isPointerLock){const T=E.movementX,z=E.movementY;this.onTouch(null,T,z),this._pointA=null,this._pointB=null}else{if(A.type!==v.c.POINTERDOWN&&A.type!==v.c.POINTERDOUBLETAP&&k&&(null===(u=this._pointA)||void 0===u?void 0:u.pointerId)!==E.pointerId&&(null===(y=this._pointB)||void 0===y?void 0:y.pointerId)!==E.pointerId)return;if(A.type!==v.c.POINTERDOWN||-1!==this._currentActiveButton&&!k)if(A.type===v.c.POINTERDOUBLETAP)this.onDoubleTap(E.pointerType);else if(A.type!==v.c.POINTERUP||this._currentActiveButton!==E.button&&!k){if(A.type===v.c.POINTERMOVE)if(T||E.preventDefault(),this._pointA&&null===this._pointB){const T=E.clientX-this._pointA.x,z=E.clientY-this._pointA.y;this._pointA.x=E.clientX,this._pointA.y=E.clientY,this.onTouch(this._pointA,T,z)}else if(this._pointA&&this._pointB){const T=this._pointA.pointerId===E.pointerId?this._pointA:this._pointB;T.x=E.clientX,T.y=E.clientY;const z=this._pointA.x-this._pointB.x,X=this._pointA.y-this._pointB.y,u=z*z+X*X,y={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:E.pointerId,type:A.type};this.onMultiTouch(this._pointA,this._pointB,b,u,F,y),F=y,b=u}}else{try{null===L||void 0===L||L.releasePointerCapture(E.pointerId)}catch(D){}k||(this._pointB=null),z._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==E.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==E.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==b||F)&&(this.onMultiTouch(this._pointA,this._pointB,b,0,F,null),b=0,F=null),this._currentActiveButton=-1,this.onButtonUp(E),T||E.preventDefault()}else{try{null===L||void 0===L||L.setPointerCapture(E.pointerId)}catch(D){}if(null===this._pointA)this._pointA={x:E.clientX,y:E.clientY,pointerId:E.pointerId,type:E.pointerType};else{if(null!==this._pointB)return;this._pointB={x:E.clientX,y:E.clientY,pointerId:E.pointerId,type:E.pointerType}}-1!==this._currentActiveButton||k||(this._currentActiveButton=E.button),this.onButtonDown(E),T||(E.preventDefault(),X&&X.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,v.c.POINTERDOWN|v.c.POINTERUP|v.c.POINTERMOVE|v.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,b=0,F=null,this.onLostFocus()},this._contextMenuBind=T=>this.onContextMenu(T),X&&X.addEventListener("contextmenu",this._contextMenuBind,!1);const A=this.camera.va().getEngine().getHostWindow();A&&d.g.RegisterTopRootEvents(A,[{name:"blur",handler:this._onLostFocus}])}ee(){if(this._onLostFocus){const T=this.camera.va().getEngine().getHostWindow();T&&d.g.UnregisterTopRootEvents(T,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const T=this.camera.va().getEngine().getInputElement();T&&T.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(T){}onTouch(T,z,X){}onMultiTouch(T,z,X,b,F,A){}onContextMenu(T){T.preventDefault()}onButtonDown(T){}onButtonUp(T){}onLostFocus(){}}(0,b.c)([(0,F.E)()],N.prototype,"buttons",void 0);class l extends N{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(T,z){if(0!==this.panningSensibility&&T&&z){const X=z.x-T.x,b=z.y-T.y;this.camera.inertialPanningX+=-X/this.panningSensibility,this.camera.inertialPanningY+=b/this.panningSensibility}}_computePinchZoom(T,z){const X=this.camera.i||l.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.i=X*Math.sqrt(T)/Math.sqrt(z):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(z-T)*X*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(z-T)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(T,z,X){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-z/this.panningSensibility,this.camera.inertialPanningY+=X/this.panningSensibility):(this.camera.inertialAlphaOffset-=z/this.angularSensibilityX,this.camera.inertialBetaOffset-=X/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(T,z,X,b,F,A){0===X&&null===F||0===b&&null===A||(this.multiTouchPanAndZoom?(this._computePinchZoom(X,b),this._computeMultiTouchPanning(F,A)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(b)-Math.sqrt(X))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(X,b),this._isPinching=!0):this._computeMultiTouchPanning(F,A)):this.multiTouchPanning?this._computeMultiTouchPanning(F,A):this.pinchZoom&&this._computePinchZoom(X,b))}onButtonDown(T){this._isPanClick=T.button===this.camera._panningMouseButton}onButtonUp(T){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}l.MinimumRadiusForPinch=.001,(0,b.c)([(0,F.E)()],l.prototype,"buttons",void 0),(0,b.c)([(0,F.E)()],l.prototype,"angularSensibilityX",void 0),(0,b.c)([(0,F.E)()],l.prototype,"angularSensibilityY",void 0),(0,b.c)([(0,F.E)()],l.prototype,"pinchPrecision",void 0),(0,b.c)([(0,F.E)()],l.prototype,"pinchDeltaPercentage",void 0),(0,b.c)([(0,F.E)()],l.prototype,"useNaturalPinchZoom",void 0),(0,b.c)([(0,F.E)()],l.prototype,"pinchZoom",void 0),(0,b.c)([(0,F.E)()],l.prototype,"panningSensibility",void 0),(0,b.c)([(0,F.E)()],l.prototype,"multiTouchPanning",void 0),(0,b.c)([(0,F.E)()],l.prototype,"multiTouchPanAndZoom",void 0),K.e.ArcRotateCameraPointersInput=l;var a=X(1226);class q{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(T){T=d.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((z=>{const X=z.event;if(!X.metaKey)if(z.type===a.e.KEYDOWN){if(this._ctrlPressed=X.ctrlKey,this._altPressed=X.altKey,-1!==this.keysUp.indexOf(X.keyCode)||-1!==this.keysDown.indexOf(X.keyCode)||-1!==this.keysLeft.indexOf(X.keyCode)||-1!==this.keysRight.indexOf(X.keyCode)||-1!==this.keysReset.indexOf(X.keyCode)){-1===this._keys.indexOf(X.keyCode)&&this._keys.push(X.keyCode),X.preventDefault&&(T||X.preventDefault())}}else if(-1!==this.keysUp.indexOf(X.keyCode)||-1!==this.keysDown.indexOf(X.keyCode)||-1!==this.keysLeft.indexOf(X.keyCode)||-1!==this.keysRight.indexOf(X.keyCode)||-1!==this.keysReset.indexOf(X.keyCode)){const z=this._keys.indexOf(X.keyCode);z>=0&&this._keys.splice(z,1),X.preventDefault&&(T||X.preventDefault())}})))}ee(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const T=this.camera;for(let z=0;z<this._keys.length;z++){const X=this._keys[z];-1!==this.keysLeft.indexOf(X)?this._ctrlPressed&&this.camera._useCtrlForPanning?T.inertialPanningX-=1/this.panningSensibility:T.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(X)?this._ctrlPressed&&this.camera._useCtrlForPanning?T.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?T.inertialRadiusOffset+=1/this.zoomingSensibility:T.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(X)?this._ctrlPressed&&this.camera._useCtrlForPanning?T.inertialPanningX+=1/this.panningSensibility:T.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(X)?this._ctrlPressed&&this.camera._useCtrlForPanning?T.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?T.inertialRadiusOffset-=1/this.zoomingSensibility:T.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(X)&&T.useInputToRestoreState&&T.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,b.c)([(0,F.E)()],q.prototype,"keysUp",void 0),(0,b.c)([(0,F.E)()],q.prototype,"keysDown",void 0),(0,b.c)([(0,F.E)()],q.prototype,"keysLeft",void 0),(0,b.c)([(0,F.E)()],q.prototype,"keysRight",void 0),(0,b.c)([(0,F.E)()],q.prototype,"keysReset",void 0),(0,b.c)([(0,F.E)()],q.prototype,"panningSensibility",void 0),(0,b.c)([(0,F.E)()],q.prototype,"zoomingSensibility",void 0),(0,b.c)([(0,F.E)()],q.prototype,"useAltToZoom",void 0),(0,b.c)([(0,F.E)()],q.prototype,"angularSpeed",void 0),K.e.ArcRotateCameraKeyboardMoveInput=q;var V=X(1139),C=X(1228),G=X(1014);class j{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new u.j(0,0,0),this._globalOffset=new u.j(0,0,0),this._inertialPanning=u.j.Zero()}_computeDeltaFromMouseWheelLegacyEvent(T,z){let X=0;const b=.01*T*this.wheelDeltaPercentage*z;return X=T>0?b/(1+this.wheelDeltaPercentage):b*(1+this.wheelDeltaPercentage),X}attachControl(T){T=d.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=z=>{if(z.type!==v.c.POINTERWHEEL)return;const X=z.event;let b=0;const F=X.deltaMode===C.d.DOM_DELTA_LINE?40:1,A=-X.deltaY*F;if(this.customComputeDeltaFromMouseWheel)b=this.customComputeDeltaFromMouseWheel(A,this,X);else if(this.wheelDeltaPercentage){if(b=this._computeDeltaFromMouseWheelLegacyEvent(A,this.camera.i),b>0){let T=this.camera.i,z=this.camera.inertialRadiusOffset+b;for(let X=0;X<20&&Math.abs(z)>.001;X++)T-=z,z*=this.camera.inertia;T=(0,G.d)(T,0,Number.MAX_VALUE),b=this._computeDeltaFromMouseWheelLegacyEvent(A,T)}}else b=A/(40*this.wheelPrecision);b&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(b)):this.camera.inertialRadiusOffset+=b),X.preventDefault&&(T||X.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,v.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Gd(0)}ee(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const T=this.camera;0+T.inertialAlphaOffset+T.inertialBetaOffset+T.inertialRadiusOffset&&(this._updateHitPlane(),T.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(T.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const T=this.camera,z=T.target.Mc(T.position);this._hitPlane=V.c.FromPositionAndNormal(T.target,z)}_getPosition(){const T=this.camera,z=T.va(),X=z.createPickingRay(z.pointerX,z.pointerY,u.d.Identity(),T,!1);0===T.targetScreenOffset.x&&0===T.targetScreenOffset.y||(this._viewOffset.set(T.targetScreenOffset.x,T.targetScreenOffset.y,0),T.getViewMatrix().invertToRef(T._cameraTransformMatrix),this._globalOffset=u.j.TransformNormal(this._viewOffset,T._cameraTransformMatrix),X.origin.addInPlace(this._globalOffset));let b=0;return this._hitPlane&&(b=X.intersectsPlane(this._hitPlane)??0),X.origin.addInPlace(X.direction.scaleInPlace(b))}_zoomToMouse(T){const z=this.camera,X=1-z.inertia;if(z.lowerRadiusLimit){const b=z.lowerRadiusLimit??0;z.i-(z.inertialRadiusOffset+T)/X<b&&(T=(z.i-b)*X-z.inertialRadiusOffset)}if(z.upperRadiusLimit){const b=z.upperRadiusLimit??0;z.i-(z.inertialRadiusOffset+T)/X>b&&(T=(z.i-b)*X-z.inertialRadiusOffset)}const b=T/X/z.i,F=this._getPosition(),A=u.f.Id[6];F.subtractToRef(z.target,A),A.scaleInPlace(b),A.scaleInPlace(X),this._inertialPanning.addInPlace(A),z.inertialRadiusOffset+=T}_zeroIfClose(T){Math.abs(T.x)<L.e&&(T.x=0),Math.abs(T.y)<L.e&&(T.y=0),Math.abs(T.z)<L.e&&(T.z=0)}}(0,b.c)([(0,F.E)()],j.prototype,"wheelPrecision",void 0),(0,b.c)([(0,F.E)()],j.prototype,"zoomToMouseLocation",void 0),(0,b.c)([(0,F.E)()],j.prototype,"wheelDeltaPercentage",void 0),K.e.ArcRotateCameraMouseWheelInput=j;class Z extends K.f{constructor(T){super(T)}addMouseWheel(){return this.add(new j),this}addPointers(){return this.add(new l),this}addKeyboard(){return this.add(new q),this}}var m=X(993);y.b.AddNodeConstructor("ArcRotateCamera",((T,z)=>()=>new S(T,0,0,1,u.j.Zero(),z)));class S extends x.c{get target(){return this._target}set target(T){this.setTarget(T)}get targetHost(){return this._targetHost}set targetHost(T){T&&this.setTarget(T)}getTarget(){return this.target}get position(){return this._position}set position(T){this.setPosition(T)}set upVector(T){this._upToYMatrix||(this._yToUpMatrix=new u.d,this._upToYMatrix=new u.d,this._upVector=u.j.Zero()),T.normalize(),this._upVector.p(T),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){u.d.RotationAlignToRef(u.j.UpReadOnly,this._upVector,this._yToUpMatrix),u.d.RotationAlignToRef(this._upVector,u.j.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const T=this.inputs.attached.pointers;return T?T.angularSensibilityX:0}set angularSensibilityX(T){const z=this.inputs.attached.pointers;z&&(z.angularSensibilityX=T)}get angularSensibilityY(){const T=this.inputs.attached.pointers;return T?T.angularSensibilityY:0}set angularSensibilityY(T){const z=this.inputs.attached.pointers;z&&(z.angularSensibilityY=T)}get pinchPrecision(){const T=this.inputs.attached.pointers;return T?T.pinchPrecision:0}set pinchPrecision(T){const z=this.inputs.attached.pointers;z&&(z.pinchPrecision=T)}get pinchDeltaPercentage(){const T=this.inputs.attached.pointers;return T?T.pinchDeltaPercentage:0}set pinchDeltaPercentage(T){const z=this.inputs.attached.pointers;z&&(z.pinchDeltaPercentage=T)}get useNaturalPinchZoom(){const T=this.inputs.attached.pointers;return!!T&&T.useNaturalPinchZoom}set useNaturalPinchZoom(T){const z=this.inputs.attached.pointers;z&&(z.useNaturalPinchZoom=T)}get panningSensibility(){const T=this.inputs.attached.pointers;return T?T.panningSensibility:0}set panningSensibility(T){const z=this.inputs.attached.pointers;z&&(z.panningSensibility=T)}get keysUp(){const T=this.inputs.attached.keyboard;return T?T.keysUp:[]}set keysUp(T){const z=this.inputs.attached.keyboard;z&&(z.keysUp=T)}get keysDown(){const T=this.inputs.attached.keyboard;return T?T.keysDown:[]}set keysDown(T){const z=this.inputs.attached.keyboard;z&&(z.keysDown=T)}get keysLeft(){const T=this.inputs.attached.keyboard;return T?T.keysLeft:[]}set keysLeft(T){const z=this.inputs.attached.keyboard;z&&(z.keysLeft=T)}get keysRight(){const T=this.inputs.attached.keyboard;return T?T.keysRight:[]}set keysRight(T){const z=this.inputs.attached.keyboard;z&&(z.keysRight=T)}get wheelPrecision(){const T=this.inputs.attached.mousewheel;return T?T.wheelPrecision:0}set wheelPrecision(T){const z=this.inputs.attached.mousewheel;z&&(z.wheelPrecision=T)}get zoomToMouseLocation(){const T=this.inputs.attached.mousewheel;return!!T&&T.zoomToMouseLocation}set zoomToMouseLocation(T){const z=this.inputs.attached.mousewheel;z&&(z.zoomToMouseLocation=T)}get wheelDeltaPercentage(){const T=this.inputs.attached.mousewheel;return T?T.wheelDeltaPercentage:0}set wheelDeltaPercentage(T){const z=this.inputs.attached.mousewheel;z&&(z.wheelDeltaPercentage=T)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(T){T!==this.useBouncingBehavior&&(T?(this._bouncingBehavior=new H,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(T){T!==this.useFramingBehavior&&(T?(this._framingBehavior=new U,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(T){T!==this.useAutoRotationBehavior&&(T?(this._autoRotationBehavior=new D,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(T,z,X,b,F,y){var E;let v=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(T,u.j.Zero(),y,v),E=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=u.j.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=u.i.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new u.d,this.panningAxis=new u.j(1,1,0),this._transformedDirection=new u.j,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new A.d,this.checkCollisions=!1,this.collisionRadius=new u.j(.5,.5,.5),this._previousPosition=u.j.Zero(),this._collisionVelocity=u.j.Zero(),this._newPosition=u.j.Zero(),this._computationVector=u.j.Zero(),this._onCollisionPositionChange=function(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;X?(E.setPosition(z),E.Uk&&E.Uk(X)):E._previousPosition.p(E._position);const b=Math.cos(E.alpha),F=Math.sin(E.alpha),A=Math.cos(E.beta);let u=Math.sin(E.beta);0===u&&(u=1e-4);const y=E._getTargetPosition();E._computationVector.Cd(E.i*b*u,E.i*A,E.i*F*u),y.addToRef(E._computationVector,E._newPosition),E._position.p(E._newPosition);let v=E.upVector;E.allowUpsideDown&&E.beta<0&&(v=v.clone(),v=v.negate()),E._computeViewMatrix(E._position,y,v),E._viewMatrix.addAtIndex(12,E.targetScreenOffset.x),E._viewMatrix.addAtIndex(13,E.targetScreenOffset.y),E._collisionTriggered=!1},this._target=u.j.Zero(),F&&this.setTarget(F),this.alpha=z,this.beta=X,this.i=b,this.getViewMatrix(),this.inputs=new Z(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new u.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.i=void 0,this._cache.targetScreenOffset=u.i.Zero()}_updateCache(T){T||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.i=this.i,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const T=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?T.addToRef(this._targetBoundingCenter,this._target):this._target.p(T)}const T=this._getLockedTargetPosition();return T||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.i,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>L.e&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.i=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.i===this.i&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(T,z){let X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const F=arguments;z=d.g.BackCompatCameraNoPreventDefault(F),this._useCtrlForPanning=X,this._panningMouseButton=b,"boolean"===typeof F[0]&&(F.length>1&&(this._useCtrlForPanning=F[1]),F.length>2&&(this._panningMouseButton=F[2])),this.inputs.attachElement(z),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}ee(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const T=this._scene.getEngine().getDeltaTime()/1e3,z=1-Math.pow(2,-T/this.restoreStateInterpolationFactor);this.setTarget(u.j.Lerp(this.getTarget(),this._storedTarget,z)),u.e.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,u.f.Quaternion[0]),u.e.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,u.f.Quaternion[1]),u.e.SlerpToRef(u.f.Quaternion[1],u.f.Quaternion[0],z,u.f.Quaternion[2]),u.f.Quaternion[2].normalize(),u.f.Quaternion[2].toAlphaBetaGammaToRef(u.f.Id[0]),this.alpha=u.f.Id[0].x,this.beta=u.f.Id[0].y,this.i+=(this._storedRadius-this.i)*z,u.i.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,z,this.targetScreenOffset),(u.j.DistanceSquared(this.getTarget(),this._storedTarget)<L.e&&u.f.Quaternion[2].equalsWithEpsilon(u.f.Quaternion[0])&&Math.pow(this._storedRadius-this.i,2)<L.e&&u.i.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<L.e||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const T=this.invertRotation?-1:1,z=this._calculateHandednessMultiplier();let X=this.inertialAlphaOffset*z;this.beta<0&&(X*=-1),this.alpha+=X*T,this.beta+=this.inertialBetaOffset*T,this.i-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<L.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<L.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*L.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const T=new u.j(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),T.multiplyInPlace(this.panningAxis),u.j.TransformNormalToRef(T,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const T=this.upVector,z=u.j.CrossToRef(this._transformedDirection,T,this._transformedDirection);u.j.CrossToRef(T,z,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);u.j.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const T=u.f.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(T),T.transposeToRef(T),u.j.TransformCoordinatesToRef(this._transformedDirection,T,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*L.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*L.e&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.i<this.lowerRadiusLimit&&(this.i=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.i>this.upperRadiusLimit&&(this.i=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||u.j.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.i=this._computationVector.length(),0===this.i&&(this.i=1e-4);const T=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const z=Math.round((T-this.alpha)/(2*Math.PI));this.alpha+=2*z*Math.PI,this.beta=Math.acos(this._computationVector.y/this.i),this._checkLimits()}setPosition(T){this._position.equals(T)||(this._position.p(T),this.rebuildAnglesAndRadius())}setTarget(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(b=this.overrideCloneAlphaBetaRadius??b,T.ze)z&&T.getBoundingInfo?this._targetBoundingCenter=T.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,T.ze(),this._targetHost=T,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const z=T,b=this._getTargetPosition();if(b&&!X&&b.equals(z))return;this._targetHost=null,this._target=z,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}b||this.rebuildAnglesAndRadius()}_getViewMatrix(){const T=Math.cos(this.alpha),z=Math.sin(this.alpha),X=Math.cos(this.beta);let b=Math.sin(this.beta);0===b&&(b=1e-4),0===this.i&&(this.i=1e-4);const F=this._getTargetPosition();if(this._computationVector.Cd(this.i*T*b,this.i*X,this.i*z*b),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||u.j.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),F.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const T=this.va().collisionCoordinator;this._collider||(this._collider=T.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,T.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let T=this.upVector;this.allowUpsideDown&&b<0&&(T=T.negate()),this._computeViewMatrix(this._position,F,T),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=F,this._viewMatrix}zoomOn(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];T=T||this.va().meshes;const X=E.e.MinMax(T);let b=this._calculateLowerRadiusFromModelBoundingSphere(X.min,X.max);b=Math.max(Math.min(b,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.i=b*this.zoomOnFactor,this.focusOn({min:X.min,max:X.max,distance:b},z)}focusOn(T){let z,X,b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===T.min){const b=T||this.va().meshes;z=E.e.MinMax(b),X=u.j.Distance(z.min,z.max)}else{z=T,X=T.distance}this._target=E.e.Center(z),b||(this.maxZ=2*X)}createRigCamera(T,z){let X=0;switch(this.cameraRigMode){case s.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case s.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case s.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case s.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case s.c.RIG_MODE_VR:X=this._cameraRigParams.stereoHalfAngle*(0===z?1:-1);break;case s.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:X=this._cameraRigParams.stereoHalfAngle*(0===z?-1:1)}const b=new S(T,this.alpha+X,this.beta,this.i,this._target,this.va());return b._cameraRigParams={},b.isRigCamera=!0,b.rigParent=this,b.upVector=this.upVector,b.mode=this.mode,b.orthoLeft=this.orthoLeft,b.orthoRight=this.orthoRight,b.orthoBottom=this.orthoBottom,b.orthoTop=this.orthoTop,b}_updateRigCameras(){const T=this._rigCameras[0],z=this._rigCameras[1];switch(T.beta=z.beta=this.beta,this.cameraRigMode){case s.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case s.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case s.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case s.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case s.c.RIG_MODE_VR:T.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,z.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case s.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:T.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,z.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const b=u.j.Distance(T,z),F=this.va().getEngine().getAspectRatio(this),A=Math.tan(this.fov/2),y=A*F,E=.5*b*X,v=E*Math.sqrt(1+1/(y*y)),k=E*Math.sqrt(1+1/(A*A));return Math.max(v,k)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,b.c)([(0,F.E)()],S.prototype,"alpha",void 0),(0,b.c)([(0,F.E)()],S.prototype,"beta",void 0),(0,b.c)([(0,F.E)()],S.prototype,"i",void 0),(0,b.c)([(0,F.E)()],S.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,b.c)([(0,F.C)("target")],S.prototype,"_target",void 0),(0,b.c)([(0,F.u)("targetHost")],S.prototype,"_targetHost",void 0),(0,b.c)([(0,F.E)()],S.prototype,"inertialAlphaOffset",void 0),(0,b.c)([(0,F.E)()],S.prototype,"inertialBetaOffset",void 0),(0,b.c)([(0,F.E)()],S.prototype,"inertialRadiusOffset",void 0),(0,b.c)([(0,F.E)()],S.prototype,"lowerAlphaLimit",void 0),(0,b.c)([(0,F.E)()],S.prototype,"upperAlphaLimit",void 0),(0,b.c)([(0,F.E)()],S.prototype,"lowerBetaLimit",void 0),(0,b.c)([(0,F.E)()],S.prototype,"upperBetaLimit",void 0),(0,b.c)([(0,F.E)()],S.prototype,"lowerRadiusLimit",void 0),(0,b.c)([(0,F.E)()],S.prototype,"upperRadiusLimit",void 0),(0,b.c)([(0,F.E)()],S.prototype,"inertialPanningX",void 0),(0,b.c)([(0,F.E)()],S.prototype,"inertialPanningY",void 0),(0,b.c)([(0,F.E)()],S.prototype,"pinchToPanMaxDistance",void 0),(0,b.c)([(0,F.E)()],S.prototype,"panningDistanceLimit",void 0),(0,b.c)([(0,F.C)()],S.prototype,"panningOriginTarget",void 0),(0,b.c)([(0,F.E)()],S.prototype,"panningInertia",void 0),(0,b.c)([(0,F.E)()],S.prototype,"zoomToMouseLocation",null),(0,b.c)([(0,F.E)()],S.prototype,"zoomOnFactor",void 0),(0,b.c)([(0,F.y)()],S.prototype,"targetScreenOffset",void 0),(0,b.c)([(0,F.E)()],S.prototype,"allowUpsideDown",void 0),(0,b.c)([(0,F.E)()],S.prototype,"useInputToRestoreState",void 0),(0,b.c)([(0,F.E)()],S.prototype,"restoreStateInterpolationFactor",void 0),(0,m.h)("BABYLON.ArcRotateCamera",S)},11944:(T,z,X)=>{"use strict";X.d(z,{c:()=>U});var b=X(952),F=X(957),A=X(1154),u=X(1166),y=X(968),E=X(976),v=X(11948),k=X(1065),L=X(993),D=X(1061),c=X(1456),p=X(1249),H=X(1122);class U extends v.b{get position(){return this._position}set position(T){this._position=T}set upVector(T){this._upVector=T}get upVector(){return this._upVector}get screenArea(){let T=0,z=0;if(this.mode===U.PERSPECTIVE_CAMERA)this.fovMode===U.FOVMODE_VERTICAL_FIXED?(z=2*this.qj*Math.tan(this.fov/2),T=this.getEngine().getAspectRatio(this)*z):(T=2*this.qj*Math.tan(this.fov/2),z=T/this.getEngine().getAspectRatio(this));else{const X=this.getEngine().getRenderWidth()/2,b=this.getEngine().getRenderHeight()/2;T=(this.orthoRight??X)-(this.orthoLeft??-X),z=(this.orthoTop??b)-(this.orthoBottom??-b)}return T*z}set orthoLeft(T){this._orthoLeft=T;for(const z of this._rigCameras)z.orthoLeft=T}get orthoLeft(){return this._orthoLeft}set orthoRight(T){this._orthoRight=T;for(const z of this._rigCameras)z.orthoRight=T}get orthoRight(){return this._orthoRight}set orthoBottom(T){this._orthoBottom=T;for(const z of this._rigCameras)z.orthoBottom=T}get orthoBottom(){return this._orthoBottom}set orthoTop(T){this._orthoTop=T;for(const z of this._rigCameras)z.orthoTop=T}get orthoTop(){return this._orthoTop}set mode(T){this._mode=T;for(const z of this._rigCameras)z.mode=T}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(T,z,X){let b=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(T,X,!1),this._position=E.j.Zero(),this._upVector=E.j.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.qj=1,this.maxZ=1e4,this.inertia=.9,this._mode=U.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new c.b(0,0,1,1),this.layerMask=268435455,this.fovMode=U.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=U.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new y.d,this.onProjectionMatrixChangedObservable=new y.d,this.onAfterCheckInputsObservable=new y.d,this.onRestoreStateObservable=new y.d,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new E.d,this._postProcesses=new Array,this._activeMeshes=new A.h(256),this._globalPosition=E.j.Zero(),this._computedViewMatrix=E.d.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=E.d.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=E.e.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),b&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=z,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${T}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Xh"}toString(T){let z="Name: "+this.name;if(z+=", type: "+this.getClassName(),this.animations)for(let X=0;X<this.animations.length;X++)z+=", animation[0]: "+this.animations[X].toString(T);return z}applyVerticalCorrection(){const T=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-T.x:T.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(T){return-1!==this._activeMeshes.indexOf(T)}isReady(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(T)for(const z of this._postProcesses)if(z&&!z.isReady())return!1;return super.isReady(T)}_initCache(){super._initCache(),this._cache.position=new E.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new E.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.qj=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(T){T||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let T=this._cache.mode===this.mode&&this._cache.qj===this.qj&&this._cache.maxZ===this.maxZ;if(!T)return!1;const z=this.getEngine();return this.mode===U.PERSPECTIVE_CAMERA?T=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===z.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(T=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===z.getRenderWidth()&&this._cache.renderHeight===z.getRenderHeight(),this.oblique&&(T=T&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),T}attachControl(T,z){}ee(T){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==U.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let T=0;T<this._postProcesses.length;T++)if(null!==this._postProcesses[T])return this._postProcesses[T];return null}_cascadePostProcessesToRigCams(){const T=this._getFirstPostProcess();T&&T.markTextureDirty();for(let z=0,X=this._rigCameras.length;z<X;z++){const T=this._rigCameras[z],X=T._rigPostProcess;if(X){"pass"===X.getEffectName()&&(T.isIntermediate=0===this._postProcesses.length),T._postProcesses=this._postProcesses.slice(0).concat(X),X.markTextureDirty()}else T._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!T.isReusable()&&this._postProcesses.indexOf(T)>-1?(k.e.Error("You're trying to reuse a post process not defined as reusable."),0):(null==z||z<0?this._postProcesses.push(T):null===this._postProcesses[z]?this._postProcesses[z]=T:this._postProcesses.splice(z,0,T),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.Fe(),this._postProcesses.indexOf(T))}detachPostProcess(T){const z=this._postProcesses.indexOf(T);-1!==z&&(this._postProcesses[z]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.Fe(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return E.d.Identity()}getViewMatrix(T){return!T&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(T){this._doNotComputeProjectionMatrix=!0,void 0!==T&&(this._projectionMatrix=T)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(T){if(this._doNotComputeProjectionMatrix||!T&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.qj=this.qj,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const z=this.getEngine(),X=this.va(),b=z.useReverseDepthBuffer;if(this.mode===U.PERSPECTIVE_CAMERA){let T;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=z.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.qj<=0&&(this.qj=.1),T=X.useRightHandedSystem?E.d.PerspectiveFovRHToRef:E.d.PerspectiveFovLHToRef,T(this.fov,z.getAspectRatio(this),b?this.maxZ:this.qj,b?this.qj:this.maxZ,this._projectionMatrix,this.fovMode===U.FOVMODE_VERTICAL_FIXED,z.isNDCHalfZRange,this.projectionPlaneTilt,b)}else{var F,A,u;const T=z.getRenderWidth()/2,y=z.getRenderHeight()/2;X.useRightHandedSystem?this.oblique?E.d.ObliqueOffCenterRHToRef(this.orthoLeft??-T,this.orthoRight??T,this.orthoBottom??-y,this.orthoTop??y,b?this.maxZ:this.qj,b?this.qj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,z.isNDCHalfZRange):E.d.OrthoOffCenterRHToRef(this.orthoLeft??-T,this.orthoRight??T,this.orthoBottom??-y,this.orthoTop??y,b?this.maxZ:this.qj,b?this.qj:this.maxZ,this._projectionMatrix,z.isNDCHalfZRange):this.oblique?E.d.ObliqueOffCenterLHToRef(this.orthoLeft??-T,this.orthoRight??T,this.orthoBottom??-y,this.orthoTop??y,b?this.maxZ:this.qj,b?this.qj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,z.isNDCHalfZRange):E.d.OrthoOffCenterLHToRef(this.orthoLeft??-T,this.orthoRight??T,this.orthoBottom??-y,this.orthoTop??y,b?this.maxZ:this.qj,b?this.qj:this.maxZ,this._projectionMatrix,z.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(F=this.oblique)||void 0===F?void 0:F.angle,this._cache.obliqueLength=null===(A=this.oblique)||void 0===A?void 0:A.length,this._cache.obliqueOffset=null===(u=this.oblique)||void 0===u?void 0:u.offset,this._cache.renderWidth=z.getRenderWidth(),this._cache.renderHeight=z.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(T){return(this.i||(this.target?E.j.Distance(this.position,this.target):this.position.length()))+T}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?p.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=p.e.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),z&&this.rigCameras.length>0){let z=!1;return this.rigCameras.forEach((X=>{X._updateFrustumPlanes(),z=z||T.isInFrustum(X._frustumPlanes)})),z}return T.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(T){return this._updateFrustumPlanes(),T.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,D.d)("Ray")}getForwardRayToRef(T){throw(0,D.d)("Ray")}dispose(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const T=this._rigCameras.pop();T&&T.dispose()}if(this._parentContainer){const T=this._parentContainer.cameras.indexOf(this);T>-1&&this._parentContainer.cameras.splice(T,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==U.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let T=this._postProcesses.length;for(;--T>=0;){const z=this._postProcesses[T];z&&z.dispose(this)}}let X=this.customRenderTargets.length;for(;--X>=0;)this.customRenderTargets[X].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(T,z)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(T,z){if(this.cameraRigMode!==T){for(;this._rigCameras.length>0;){const T=this._rigCameras.pop();T&&T.dispose()}if(this.cameraRigMode=T,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=z.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=u.g.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==U.RIG_MODE_NONE){const T=this.createRigCamera(this.name+"_L",0);T&&(T._isLeftCamera=!0);const z=this.createRigCamera(this.name+"_R",1);z&&(z._isRightCamera=!0),T&&z&&(this._rigCameras.push(T),this._rigCameras.push(z))}this._setRigMode(z),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(T){}_getVRProjectionMatrix(){return E.d.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.qj,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(T,z){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[T]=z,"interaxialDistance"===T&&(this._cameraRigParams.stereoHalfAngle=u.g.ToRadians(z/.0637))}createRigCamera(T,z){return null}_updateRigCameras(){for(let T=0;T<this._rigCameras.length;T++)this._rigCameras[T].qj=this.qj,this._rigCameras[T].maxZ=this.maxZ,this._rigCameras[T].fov=this.fov,this._rigCameras[T].upVector.p(this.upVector);this.cameraRigMode===U.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const T=H.b.Serialize(this);return T.uniqueId=this.uniqueId,T.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(T),this.inputs&&this.inputs.serialize(T),H.b.AppendSerializedAnimations(this,T),T.ranges=this.serializeAnimationRanges(),T.isEnabled=this.isEnabled(),T}clone(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=H.b.Clone(U.GetConstructorFromName(this.getClassName(),T,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return X.name=T,X.parent=z,this.onClonedObservable.notifyObservers(X),X}me(T){const z=E.j.Zero();return this.getDirectionToRef(T,z),z}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(T,z){E.j.TransformNormalToRef(T,this.getWorldMatrix(),z)}static GetConstructorFromName(T,z,X){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,F=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const A=v.b.Construct(T,z,X,{interaxial_distance:b,isStereoscopicSideBySide:F});return A||(()=>U._CreateDefaultParsedCamera(z,X))}ze(){return this.getWorldMatrix()}static Parse(T,z){const X=T.type,b=U.GetConstructorFromName(X,T.name,z,T.interaxial_distance,T.isStereoscopicSideBySide),F=H.b.Parse(b,T,z);if(void 0!==T.parentId&&(F._waitingParentId=T.parentId),void 0!==T.parentInstanceIndex&&(F._waitingParentInstanceIndex=T.parentInstanceIndex),F.inputs&&(F.inputs.parse(T),F._setupInputs()),T.upVector&&(F.upVector=E.j.xd(T.upVector)),F.setPosition&&(F.position.Cd(0,0,0),F.setPosition(E.j.xd(T.position))),T.target&&F.setTarget&&F.setTarget(E.j.xd(T.target)),T.cameraRigMode){const z=T.interaxial_distance?{interaxialDistance:T.interaxial_distance}:{};F.setCameraRigMode(T.cameraRigMode,z)}if(T.animations){for(let z=0;z<T.animations.length;z++){const X=T.animations[z],b=(0,L.e)("BABYLON.Animation");b&&F.animations.push(b.Parse(X))}v.b.ParseAnimationRanges(F,T,z)}return T.autoAnimate&&z.beginAnimation(F,T.autoAnimateFrom,T.autoAnimateTo,T.autoAnimateLoop,T.autoAnimateSpeed||1),void 0!==T.isEnabled&&F.Hg(T.isEnabled),F}_calculateHandednessMultiplier(){let T=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(T*=-1),T}}U._CreateDefaultParsedCamera=(T,z)=>{throw(0,D.d)("UniversalCamera")},U.PERSPECTIVE_CAMERA=0,U.ORTHOGRAPHIC_CAMERA=1,U.FOVMODE_VERTICAL_FIXED=0,U.FOVMODE_HORIZONTAL_FIXED=1,U.RIG_MODE_NONE=0,U.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,U.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,U.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,U.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,U.RIG_MODE_STEREOSCOPIC_INTERLACED=14,U.RIG_MODE_VR=20,U.RIG_MODE_CUSTOM=22,U.ForceAttachControlToAlwaysPreventDefault=!1,(0,b.c)([(0,F.C)("position")],U.prototype,"_position",void 0),(0,b.c)([(0,F.C)("upVector")],U.prototype,"_upVector",void 0),(0,b.c)([(0,F.E)()],U.prototype,"orthoLeft",null),(0,b.c)([(0,F.E)()],U.prototype,"orthoRight",null),(0,b.c)([(0,F.E)()],U.prototype,"orthoBottom",null),(0,b.c)([(0,F.E)()],U.prototype,"orthoTop",null),(0,b.c)([(0,F.E)()],U.prototype,"fov",void 0),(0,b.c)([(0,F.E)()],U.prototype,"projectionPlaneTilt",void 0),(0,b.c)([(0,F.E)()],U.prototype,"qj",void 0),(0,b.c)([(0,F.E)()],U.prototype,"maxZ",void 0),(0,b.c)([(0,F.E)()],U.prototype,"inertia",void 0),(0,b.c)([(0,F.E)()],U.prototype,"mode",null),(0,b.c)([(0,F.E)()],U.prototype,"layerMask",void 0),(0,b.c)([(0,F.E)()],U.prototype,"fovMode",void 0),(0,b.c)([(0,F.E)()],U.prototype,"cameraRigMode",void 0),(0,b.c)([(0,F.E)()],U.prototype,"interaxialDistance",void 0),(0,b.c)([(0,F.E)()],U.prototype,"isStereoscopicSideBySide",void 0)},12486:(T,z,X)=>{"use strict";X.d(z,{e:()=>u,f:()=>y});var b=X(1065),F=X(1122),A=X(11944),u={};class y{constructor(T){this.attachedToElement=!1,this.attached={},this.camera=T,this.checkInputs=()=>{}}add(T){const z=T.getSimpleName();this.attached[z]?b.e.Warn("camera input of type "+z+" already exists on camera"):(this.attached[z]=T,T.camera=this.camera,T.checkInputs&&(this.checkInputs=this._addCheckInputs(T.checkInputs.bind(T))),this.attachedToElement&&T.attachControl(this.noPreventDefault))}remove(T){for(const z in this.attached){const X=this.attached[z];if(X===T)return X.ee(),X.camera=null,delete this.attached[z],void this.rebuildInputCheck()}}removeByType(T){for(const z in this.attached){const X=this.attached[z];X.getClassName()===T&&(X.ee(),X.camera=null,delete this.attached[z],this.rebuildInputCheck())}}_addCheckInputs(T){const z=this.checkInputs;return()=>{z(),T()}}attachInput(T){this.attachedToElement&&T.attachControl(this.noPreventDefault)}attachElement(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){T=!A.c.ForceAttachControlToAlwaysPreventDefault&&T,this.attachedToElement=!0,this.noPreventDefault=T;for(const z in this.attached)this.attached[z].attachControl(T)}}detachElement(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const z in this.attached)this.attached[z].ee(),T&&(this.attached[z].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const T in this.attached){const z=this.attached[T];z.checkInputs&&(this.checkInputs=this._addCheckInputs(z.checkInputs.bind(z)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(T){const z={};for(const X in this.attached){const T=this.attached[X],b=F.b.Serialize(T);z[T.getClassName()]=b}T.inputsmgr=z}parse(T){const z=T.inputsmgr;if(z){this.clear();for(const T in z){const X=u[T];if(X){const b=z[T],A=F.b.Parse((()=>new X),b,null);this.add(A)}}}else for(const X in this.attached){const z=u[this.attached[X].getClassName()];if(z){const b=F.b.Parse((()=>new z),T,null);this.remove(this.attached[X]),this.add(b)}}}}},12482:(T,z,X)=>{"use strict";X.d(z,{d:()=>l});var b=X(952),F=X(957),A=X(976),u=X(12484),y=X(12486),E=X(1226),v=X(1166);class k{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(T){T=v.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((z=>{const X=z.event;if(!X.metaKey)if(z.type===E.e.KEYDOWN){if(-1!==this.keysUp.indexOf(X.keyCode)||-1!==this.keysDown.indexOf(X.keyCode)||-1!==this.keysLeft.indexOf(X.keyCode)||-1!==this.keysRight.indexOf(X.keyCode)||-1!==this.keysUpward.indexOf(X.keyCode)||-1!==this.keysDownward.indexOf(X.keyCode)||-1!==this.keysRotateLeft.indexOf(X.keyCode)||-1!==this.keysRotateRight.indexOf(X.keyCode)||-1!==this.keysRotateUp.indexOf(X.keyCode)||-1!==this.keysRotateDown.indexOf(X.keyCode)){-1===this._keys.indexOf(X.keyCode)&&this._keys.push(X.keyCode),T||X.preventDefault()}}else if(-1!==this.keysUp.indexOf(X.keyCode)||-1!==this.keysDown.indexOf(X.keyCode)||-1!==this.keysLeft.indexOf(X.keyCode)||-1!==this.keysRight.indexOf(X.keyCode)||-1!==this.keysUpward.indexOf(X.keyCode)||-1!==this.keysDownward.indexOf(X.keyCode)||-1!==this.keysRotateLeft.indexOf(X.keyCode)||-1!==this.keysRotateRight.indexOf(X.keyCode)||-1!==this.keysRotateUp.indexOf(X.keyCode)||-1!==this.keysRotateDown.indexOf(X.keyCode)){const z=this._keys.indexOf(X.keyCode);z>=0&&this._keys.splice(z,1),T||X.preventDefault()}})))}ee(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const T=this.camera;for(let z=0;z<this._keys.length;z++){const X=this._keys[z],b=T._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(X)?T._localDirection.Cd(-b,0,0):-1!==this.keysUp.indexOf(X)?T._localDirection.Cd(0,0,b):-1!==this.keysRight.indexOf(X)?T._localDirection.Cd(b,0,0):-1!==this.keysDown.indexOf(X)?T._localDirection.Cd(0,0,-b):-1!==this.keysUpward.indexOf(X)?T._localDirection.Cd(0,b,0):-1!==this.keysDownward.indexOf(X)?T._localDirection.Cd(0,-b,0):-1!==this.keysRotateLeft.indexOf(X)?(T._localDirection.Cd(0,0,0),T.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(X)?(T._localDirection.Cd(0,0,0),T.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(X)?(T._localDirection.Cd(0,0,0),T.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(X)&&(T._localDirection.Cd(0,0,0),T.cameraRotation.x+=this._getLocalRotation()),T.va().useRightHandedSystem&&(T._localDirection.z*=-1),T.getViewMatrix().invertToRef(T._cameraTransformMatrix),A.j.TransformNormalToRef(T._localDirection,T._cameraTransformMatrix,T._transformedDirection),T.cameraDirection.addInPlace(T._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const T=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*T}}(0,b.c)([(0,F.E)()],k.prototype,"keysUp",void 0),(0,b.c)([(0,F.E)()],k.prototype,"keysUpward",void 0),(0,b.c)([(0,F.E)()],k.prototype,"keysDown",void 0),(0,b.c)([(0,F.E)()],k.prototype,"keysDownward",void 0),(0,b.c)([(0,F.E)()],k.prototype,"keysLeft",void 0),(0,b.c)([(0,F.E)()],k.prototype,"keysRight",void 0),(0,b.c)([(0,F.E)()],k.prototype,"rotationSpeed",void 0),(0,b.c)([(0,F.E)()],k.prototype,"keysRotateLeft",void 0),(0,b.c)([(0,F.E)()],k.prototype,"keysRotateRight",void 0),(0,b.c)([(0,F.E)()],k.prototype,"keysRotateUp",void 0),(0,b.c)([(0,F.E)()],k.prototype,"keysRotateDown",void 0),y.e.FreeCameraKeyboardMoveInput=k;var L=X(968),D=X(1224);class c{constructor(){let T=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=T,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new L.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(T){T=v.g.BackCompatCameraNoPreventDefault(arguments);const z=this.camera.getEngine(),X=z.getInputElement();this._pointerInput||(this._pointerInput=b=>{const F=b.event,A="touch"===F.pointerType;if(!this.touchEnabled&&A)return;if(b.type!==D.c.POINTERMOVE&&-1===this.buttons.indexOf(F.button))return;const u=F.target;if(b.type===D.c.POINTERDOWN){if(A&&-1!==this._activePointerId||!A&&-1!==this._currentActiveButton)return;this._activePointerId=F.pointerId;try{null===u||void 0===u||u.setPointerCapture(F.pointerId)}catch(y){}-1===this._currentActiveButton&&(this._currentActiveButton=F.button),this._previousPosition={x:F.clientX,y:F.clientY},T||(F.preventDefault(),X&&X.focus()),z.isPointerLock&&this._onMouseMove&&this._onMouseMove(b.event)}else if(b.type===D.c.POINTERUP){if(A&&this._activePointerId!==F.pointerId||!A&&this._currentActiveButton!==F.button)return;try{null===u||void 0===u||u.releasePointerCapture(F.pointerId)}catch(y){}this._currentActiveButton=-1,this._previousPosition=null,T||F.preventDefault(),this._activePointerId=-1}else if(b.type===D.c.POINTERMOVE&&(this._activePointerId===F.pointerId||!A))if(z.isPointerLock&&this._onMouseMove)this._onMouseMove(b.event);else if(this._previousPosition){const z=this.camera._calculateHandednessMultiplier(),X=(F.clientX-this._previousPosition.x)*z,b=F.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=X/this.angularSensibility,this.camera.cameraRotation.x+=b/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:X,offsetY:b}),this._previousPosition={x:F.clientX,y:F.clientY},T||F.preventDefault()}}),this._onMouseMove=X=>{if(!z.isPointerLock)return;const b=this.camera._calculateHandednessMultiplier(),F=X.movementX*b;this.camera.cameraRotation.y+=F/this.angularSensibility;const A=X.movementY;this.camera.cameraRotation.x+=A/this.angularSensibility,this._previousPosition=null,T||X.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,D.c.POINTERDOWN|D.c.POINTERUP|D.c.POINTERMOVE),X&&(this._contextMenuBind=T=>this.onContextMenu(T),X.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(T){T.preventDefault()}ee(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const T=this.camera.getEngine().getInputElement();T&&T.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,b.c)([(0,F.E)()],c.prototype,"buttons",void 0),(0,b.c)([(0,F.E)()],c.prototype,"angularSensibility",void 0),y.e.FreeCameraMouseInput=c;var p,H=X(1228);class U{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new L.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(T){T=v.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=z=>{if(z.type!==D.c.POINTERWHEEL)return;const X=z.event,b=X.deltaMode===H.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*b*X.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*b*X.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*b*X.deltaZ/this._normalize,X.preventDefault&&(T||X.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,D.c.POINTERWHEEL)}ee(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,b.c)([(0,F.E)()],U.prototype,"wheelPrecisionX",void 0),(0,b.c)([(0,F.E)()],U.prototype,"wheelPrecisionY",void 0),(0,b.c)([(0,F.E)()],U.prototype,"wheelPrecisionZ",void 0),function(T){T[T.MoveRelative=0]="MoveRelative",T[T.RotateRelative=1]="RotateRelative",T[T.MoveScene=2]="MoveScene"}(p||(p={}));class s extends U{constructor(){super(...arguments),this._moveRelative=A.j.Zero(),this._rotateRelative=A.j.Zero(),this._moveScene=A.j.Zero(),this._wheelXAction=p.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=p.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(T){null===T&&this._wheelXAction!==p.MoveRelative||(this._wheelXAction=p.MoveRelative,this._wheelXActionCoordinate=T)}get wheelXMoveRelative(){return this._wheelXAction!==p.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(T){null===T&&this._wheelYAction!==p.MoveRelative||(this._wheelYAction=p.MoveRelative,this._wheelYActionCoordinate=T)}get wheelYMoveRelative(){return this._wheelYAction!==p.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(T){null===T&&this._wheelZAction!==p.MoveRelative||(this._wheelZAction=p.MoveRelative,this._wheelZActionCoordinate=T)}get wheelZMoveRelative(){return this._wheelZAction!==p.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(T){null===T&&this._wheelXAction!==p.RotateRelative||(this._wheelXAction=p.RotateRelative,this._wheelXActionCoordinate=T)}get wheelXRotateRelative(){return this._wheelXAction!==p.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(T){null===T&&this._wheelYAction!==p.RotateRelative||(this._wheelYAction=p.RotateRelative,this._wheelYActionCoordinate=T)}get wheelYRotateRelative(){return this._wheelYAction!==p.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(T){null===T&&this._wheelZAction!==p.RotateRelative||(this._wheelZAction=p.RotateRelative,this._wheelZActionCoordinate=T)}get wheelZRotateRelative(){return this._wheelZAction!==p.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(T){null===T&&this._wheelXAction!==p.MoveScene||(this._wheelXAction=p.MoveScene,this._wheelXActionCoordinate=T)}get wheelXMoveScene(){return this._wheelXAction!==p.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(T){null===T&&this._wheelYAction!==p.MoveScene||(this._wheelYAction=p.MoveScene,this._wheelYActionCoordinate=T)}get wheelYMoveScene(){return this._wheelYAction!==p.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(T){null===T&&this._wheelZAction!==p.MoveScene||(this._wheelZAction=p.MoveScene,this._wheelZActionCoordinate=T)}get wheelZMoveScene(){return this._wheelZAction!==p.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Gd(0),this._rotateRelative.Gd(0),this._moveScene.Gd(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const T=A.d.Zero();this.camera.getViewMatrix().invertToRef(T);const z=A.j.Zero();A.j.TransformNormalToRef(this._moveRelative,T,z),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(z),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(T,z,X){if(0===T)return;if(null===z||null===X)return;let b=null;switch(z){case p.MoveRelative:b=this._moveRelative;break;case p.RotateRelative:b=this._rotateRelative;break;case p.MoveScene:b=this._moveScene}switch(X){case 0:b.set(T,0,0);break;case 1:b.set(0,T,0);break;case 2:b.set(0,0,T)}}}(0,b.c)([(0,F.E)()],s.prototype,"wheelXMoveRelative",null),(0,b.c)([(0,F.E)()],s.prototype,"wheelYMoveRelative",null),(0,b.c)([(0,F.E)()],s.prototype,"wheelZMoveRelative",null),(0,b.c)([(0,F.E)()],s.prototype,"wheelXRotateRelative",null),(0,b.c)([(0,F.E)()],s.prototype,"wheelYRotateRelative",null),(0,b.c)([(0,F.E)()],s.prototype,"wheelZRotateRelative",null),(0,b.c)([(0,F.E)()],s.prototype,"wheelXMoveScene",null),(0,b.c)([(0,F.E)()],s.prototype,"wheelYMoveScene",null),(0,b.c)([(0,F.E)()],s.prototype,"wheelZMoveScene",null),y.e.FreeCameraMouseWheelInput=s;class x{constructor(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=T,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=v.g.IsSafari()}attachControl(T){T=v.g.BackCompatCameraNoPreventDefault(arguments);let z=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=X=>{const b=X.event,F="mouse"===b.pointerType||this._isSafari&&"undefined"===typeof b.pointerType;if(this.allowMouse||!F)if(X.type===D.c.POINTERDOWN){if(T||b.preventDefault(),this._pointerPressed.push(b.pointerId),1!==this._pointerPressed.length)return;z={x:b.clientX,y:b.clientY}}else if(X.type===D.c.POINTERUP){T||b.preventDefault();const X=this._pointerPressed.indexOf(b.pointerId);if(-1===X)return;if(this._pointerPressed.splice(X,1),0!=X)return;z=null,this._offsetX=null,this._offsetY=null}else if(X.type===D.c.POINTERMOVE){if(T||b.preventDefault(),!z)return;if(0!=this._pointerPressed.indexOf(b.pointerId))return;this._offsetX=b.clientX-z.x,this._offsetY=-(b.clientY-z.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,D.c.POINTERDOWN|D.c.POINTERUP|D.c.POINTERMOVE),this._onLostFocus){const T=this.camera.getEngine().getInputElement();T&&T.addEventListener("blur",this._onLostFocus)}}ee(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const T=this.camera.getEngine().getInputElement();T&&T.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const T=this.camera,z=T._calculateHandednessMultiplier();T.cameraRotation.y=z*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)T.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const z=T._computeLocalCameraSpeed(),X=new A.j(0,0,0!==this.touchMoveSensibility?z*this._offsetY/this.touchMoveSensibility:0);A.d.RotationYawPitchRollToRef(T.rotation.y,T.rotation.x,0,T._cameraRotationMatrix),T.cameraDirection.addInPlace(A.j.TransformCoordinates(X,T._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,b.c)([(0,F.E)()],x.prototype,"touchAngularSensibility",void 0),(0,b.c)([(0,F.E)()],x.prototype,"touchMoveSensibility",void 0),y.e.FreeCameraTouchInput=x;class K extends y.f{constructor(T){super(T),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new k),this}addMouse(){let T=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new c(T),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new s,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new x),this}clear(){super.clear(),this._mouseInput=null}}var d=X(993),N=X(1071);class l extends u.c{get angularSensibility(){const T=this.inputs.attached.mouse;return T?T.angularSensibility:0}set angularSensibility(T){const z=this.inputs.attached.mouse;z&&(z.angularSensibility=T)}get keysUp(){const T=this.inputs.attached.keyboard;return T?T.keysUp:[]}set keysUp(T){const z=this.inputs.attached.keyboard;z&&(z.keysUp=T)}get keysUpward(){const T=this.inputs.attached.keyboard;return T?T.keysUpward:[]}set keysUpward(T){const z=this.inputs.attached.keyboard;z&&(z.keysUpward=T)}get keysDown(){const T=this.inputs.attached.keyboard;return T?T.keysDown:[]}set keysDown(T){const z=this.inputs.attached.keyboard;z&&(z.keysDown=T)}get keysDownward(){const T=this.inputs.attached.keyboard;return T?T.keysDownward:[]}set keysDownward(T){const z=this.inputs.attached.keyboard;z&&(z.keysDownward=T)}get keysLeft(){const T=this.inputs.attached.keyboard;return T?T.keysLeft:[]}set keysLeft(T){const z=this.inputs.attached.keyboard;z&&(z.keysLeft=T)}get keysRight(){const T=this.inputs.attached.keyboard;return T?T.keysRight:[]}set keysRight(T){const z=this.inputs.attached.keyboard;z&&(z.keysRight=T)}get keysRotateLeft(){const T=this.inputs.attached.keyboard;return T?T.keysRotateLeft:[]}set keysRotateLeft(T){const z=this.inputs.attached.keyboard;z&&(z.keysRotateLeft=T)}get keysRotateRight(){const T=this.inputs.attached.keyboard;return T?T.keysRotateRight:[]}set keysRotateRight(T){const z=this.inputs.attached.keyboard;z&&(z.keysRotateRight=T)}get keysRotateUp(){const T=this.inputs.attached.keyboard;return T?T.keysRotateUp:[]}set keysRotateUp(T){const z=this.inputs.attached.keyboard;z&&(z.keysRotateUp=T)}get keysRotateDown(){const T=this.inputs.attached.keyboard;return T?T.keysRotateDown:[]}set keysRotateDown(T){const z=this.inputs.attached.keyboard;z&&(z.keysRotateDown=T)}constructor(T,z,X){var b;super(T,z,X,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),b=this,this.ellipsoid=new A.j(.5,1,.5),this.ellipsoidOffset=new A.j(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=A.j.Zero(),this._diffPosition=A.j.Zero(),this._newPosition=A.j.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;b._newPosition.p(z),b._newPosition.subtractToRef(b._oldPosition,b._diffPosition),b._diffPosition.length()>N.d.CollisionsEpsilon&&(b.position.addToRef(b._diffPosition,b._deferredPositionUpdate),b._deferOnly?b._deferredUpdated=!0:b.position.p(b._deferredPositionUpdate),b.Uk&&X&&b.Uk(X))},this.inputs=new K(this),this.inputs.addKeyboard().addMouse()}attachControl(T,z){z=v.g.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(z)}ee(){this.inputs.detachElement(),this.cameraDirection=new A.j(0,0,0),this.cameraRotation=new A.i(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(T){this._collisionMask=isNaN(T)?-1:T}_collideWithWorld(T){let z;z=this.parent?A.j.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,z.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const X=this.va().collisionCoordinator;this._collider||(this._collider=X.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let b=T;this.applyGravity&&(b=T.add(this.va().gravity)),X.getNewPosition(this._oldPosition,b,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=A.j.Zero(),this._transformedDirection=A.j.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(T){this._needMoveForGravity=T}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fb"}}(0,b.c)([(0,F.C)()],l.prototype,"ellipsoid",void 0),(0,b.c)([(0,F.C)()],l.prototype,"ellipsoidOffset",void 0),(0,b.c)([(0,F.E)()],l.prototype,"checkCollisions",void 0),(0,b.c)([(0,F.E)()],l.prototype,"applyGravity",void 0),(0,d.h)("BABYLON.FreeCamera",l)},12484:(T,z,X)=>{"use strict";X.d(z,{c:()=>v});var b=X(952),F=X(957),A=X(11944),u=X(976),y=X(979),E=X(1449);X(11948).b.AddNodeConstructor("TargetCamera",((T,z)=>()=>new v(T,u.j.Zero(),z)));class v extends A.c{constructor(T,z,X){super(T,z,X,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=u.j.Zero(),this._tmpTargetVector=u.j.Zero(),this.cameraDirection=new u.j(0,0,0),this.cameraRotation=new u.i(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new u.e,this.rotation=new u.j(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=u.j.Zero(),this._initialFocalDistance=1,this._viewMatrix=u.d.Zero(),this._camMatrix=u.d.Zero(),this._cameraTransformMatrix=u.d.Zero(),this._cameraRotationMatrix=u.d.Zero(),this._referencePoint=new u.j(0,0,1),this._transformedReferencePoint=u.j.Zero(),this._deferredPositionUpdate=new u.j,this._deferredRotationQuaternionUpdate=new u.e,this._deferredRotationUpdate=new u.j,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=u.j.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(T){this.getWorldMatrix();const z=this.getTarget().Mc(this.position);return z.normalize(),z.scaleInPlace(T),this.globalPosition.add(z)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const T=this.lockedTarget;T.ze().getTranslationToRef(T.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Cd(0,0,0),this.cameraRotation.Cd(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new u.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new u.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new u.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(T){T||super._updateCache();const z=this._getLockedTargetPosition();z?this._cache.lockedTarget?this._cache.lockedTarget.p(z):this._cache.lockedTarget=z.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const T=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(T):!T)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const T=this.getEngine();return this.speed*Math.sqrt(T.getDeltaTime()/(100*T.getFps()))}setTarget(T){this.upVector.normalize(),this._initialFocalDistance=T.Mc(this.position).length(),this.position.z===T.z&&(this.position.z+=y.e),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),u.d.LookAtLHToRef(this.position,T,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const z=T.Mc(this.position);z.x>=0?this.rotation.y=-Math.atan(z.z/z.x)+Math.PI/2:this.rotation.y=-Math.atan(z.z/z.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&u.e.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(T){this.setTarget(T)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(u.f.Matrix[0]),u.j.TransformNormalToRef(this.cameraDirection,u.f.Matrix[0],u.f.Id[0]),this._deferredPositionUpdate.addInPlace(u.f.Id[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const T=this.invertRotation?-this.inverseRotationSpeed:1,z=this._decideIfNeedsToMove(),X=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),z&&this._updatePosition(),X){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*T,this._deferredRotationUpdate.y+=this.cameraRotation.y*T,!this.noRotationConstraint){const T=1.570796;this._deferredRotationUpdate.x>T&&(this._deferredRotationUpdate.x=T),this._deferredRotationUpdate.x<-T&&(this._deferredRotationUpdate.x=-T)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(u.e.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}z&&(Math.abs(this.cameraDirection.x)<this.speed*y.e&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*y.e&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*y.e&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),X&&(Math.abs(this.cameraRotation.x)<this.speed*y.e&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*y.e&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):u.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return u.j.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),u.j.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?E.b.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(u.e.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),E.b.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(T,z,X){if(this.ignoreParentScaling){if(this.parent){const b=this.parent.getWorldMatrix();u.j.TransformCoordinatesToRef(T,b,this._globalPosition),u.j.TransformCoordinatesToRef(z,b,this._tmpTargetVector),u.j.TransformNormalToRef(X,b,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(T),this._tmpTargetVector.p(z),this._tmpUpVector.p(X);this.va().useRightHandedSystem?u.d.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):u.d.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?u.d.LookAtRHToRef(T,z,X,this._viewMatrix):u.d.LookAtLHToRef(T,z,X,this._viewMatrix),this.parent){const T=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(T,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(T)}createRigCamera(T,z){if(this.cameraRigMode!==A.c.RIG_MODE_NONE){const z=new v(T,this.position.clone(),this.va());return z.isRigCamera=!0,z.rigParent=this,this.cameraRigMode===A.c.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new u.e),z._cameraRigParams={},z.rotationQuaternion=new u.e),z.mode=this.mode,z.orthoLeft=this.orthoLeft,z.orthoRight=this.orthoRight,z.orthoTop=this.orthoTop,z.orthoBottom=this.orthoBottom,z}return null}_updateRigCameras(){const T=this._rigCameras[0],z=this._rigCameras[1];switch(this.ze(),this.cameraRigMode){case A.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case A.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case A.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case A.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case A.c.RIG_MODE_STEREOSCOPIC_INTERLACED:{const X=this.cameraRigMode===A.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,b=this.cameraRigMode===A.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*X,T),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*b,z);break}case A.c.RIG_MODE_VR:T.rotationQuaternion?(T.rotationQuaternion.p(this.rotationQuaternion),z.rotationQuaternion.p(this.rotationQuaternion)):(T.rotation.p(this.rotation),z.rotation.p(this.rotation)),T.position.p(this.position),z.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(T,z){this.getTarget().subtractToRef(this.position,v._TargetFocalPoint),v._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const X=v._TargetFocalPoint.addInPlace(this.position);u.d.TranslationToRef(-X.x,-X.y,-X.z,v._TargetTransformMatrix),v._TargetTransformMatrix.multiplyToRef(u.d.RotationAxis(z.upVector,T),v._RigCamTransformMatrix),u.d.TranslationToRef(X.x,X.y,X.z,v._TargetTransformMatrix),v._RigCamTransformMatrix.multiplyToRef(v._TargetTransformMatrix,v._RigCamTransformMatrix),u.j.TransformCoordinatesToRef(this.position,v._RigCamTransformMatrix,z.position),z.setTarget(X)}getClassName(){return"TargetCamera"}}v._RigCamTransformMatrix=new u.d,v._TargetTransformMatrix=new u.d,v._TargetFocalPoint=new u.j,(0,b.c)([(0,F.C)()],v.prototype,"rotation",void 0),(0,b.c)([(0,F.E)()],v.prototype,"speed",void 0),(0,b.c)([(0,F.u)("lockedTargetId")],v.prototype,"lockedTarget",void 0)},12925:(T,z,X)=>{"use strict";X.d(z,{e:()=>A});var b=X(1154),F=X(12928);class A{constructor(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=X,this.Ni=[],this._maxBlockCapacity=z||64,this._selectionContent=new b.e(1024),this._creationFunc=T}update(T,z,X){F.e._CreateBlocks(T,z,X,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}we(T){for(let z=0;z<this.ei.length;z++){this.ei[z].addEntry(T)}}ye(T){for(let z=0;z<this.ei.length;z++){this.ei[z].removeEntry(T)}}select(T,z){this._selectionContent.reset();for(let X=0;X<this.ei.length;X++){this.ei[X].select(T,this._selectionContent,z)}return z?this._selectionContent.concat(this.Ni):this._selectionContent.concatWithNoDuplicate(this.Ni),this._selectionContent}intersects(T,z,X){this._selectionContent.reset();for(let b=0;b<this.ei.length;b++){this.ei[b].intersects(T,z,this._selectionContent,X)}return X?this._selectionContent.concat(this.Ni):this._selectionContent.concatWithNoDuplicate(this.Ni),this._selectionContent}intersectsRay(T){this._selectionContent.reset();for(let z=0;z<this.ei.length;z++){this.ei[z].intersectsRay(T,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Ni),this._selectionContent}}A.CreationFuncForMeshes=(T,z)=>{const X=T.getBoundingInfo();!T.isBlocked&&X.boundingBox.intersectsMinMax(z.Ri,z.Si)&&z.entries.push(T)},A.CreationFuncForSubMeshes=(T,z)=>{T.getBoundingInfo().boundingBox.intersectsMinMax(z.Ri,z.Si)&&z.entries.push(T)}},12928:(T,z,X)=>{"use strict";X.d(z,{e:()=>A});var b=X(976),F=X(1284);class A{constructor(T,z,X,b,F,A){this.entries=[],this.Ti=new Array,this._capacity=X,this._depth=b,this._maxDepth=F,this._creationFunc=A,this._minPoint=T,this._maxPoint=z,this.Ti.push(T.clone()),this.Ti.push(z.clone()),this.Ti.push(T.clone()),this.Ti[2].x=z.x,this.Ti.push(T.clone()),this.Ti[3].y=z.y,this.Ti.push(T.clone()),this.Ti[4].z=z.z,this.Ti.push(z.clone()),this.Ti[5].z=T.z,this.Ti.push(z.clone()),this.Ti[6].x=T.x,this.Ti.push(z.clone()),this.Ti[7].y=T.y}get qd(){return this._capacity}get Ri(){return this._minPoint}get Si(){return this._maxPoint}addEntry(T){if(this.ei)for(let z=0;z<this.ei.length;z++){this.ei[z].addEntry(T)}else this._creationFunc(T,this),this.entries.length>this.qd&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(T){if(this.ei){for(let z=0;z<this.ei.length;z++){this.ei[z].removeEntry(T)}return}const z=this.entries.indexOf(T);z>-1&&this.entries.splice(z,1)}addEntries(T){for(let z=0;z<T.length;z++){const X=T[z];this.addEntry(X)}}select(T,z,X){if(F.c.IsInFrustum(this.Ti,T)){if(this.ei){for(let b=0;b<this.ei.length;b++){this.ei[b].select(T,z,X)}return}X?z.concat(this.entries):z.concatWithNoDuplicate(this.entries)}}intersects(T,z,X,b){if(F.c.IntersectsSphere(this._minPoint,this._maxPoint,T,z)){if(this.ei){for(let F=0;F<this.ei.length;F++){this.ei[F].intersects(T,z,X,b)}return}b?X.concat(this.entries):X.concatWithNoDuplicate(this.entries)}}intersectsRay(T,z){if(T.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.ei){for(let X=0;X<this.ei.length;X++){this.ei[X].intersectsRay(T,z)}return}z.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){A._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(T,z,X,F,u,y,E,v){E.ei=new Array;const k=new b.j((z.x-T.x)/2,(z.y-T.y)/2,(z.z-T.z)/2);for(let b=0;b<2;b++)for(let z=0;z<2;z++)for(let L=0;L<2;L++){const D=T.add(k.multiplyByFloats(b,z,L)),c=T.add(k.multiplyByFloats(b+1,z+1,L+1)),p=new A(D,c,F,u+1,y,v);p.addEntries(X),E.ei.push(p)}}}},12933:(T,z,X)=>{"use strict";X.d(z,{e:()=>k});var b=X(1159),F=X(976),A=X(11970),u=X(12096),y=X(1221),E=X(12925),v=X(1007);b.e.prototype.createOrUpdateSelectionOctree=function(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,X=this._getComponent(y.b.NAME_OCTREE);X||(X=new k(this),this.ne(X)),this.Li||(this.Li=new E.e(E.e.CreationFuncForMeshes,T,z));const b=this.getWorldExtends();return this.Li.update(b.min,b.max,this.meshes),this.Li},Object.defineProperty(b.e.prototype,"selectionOctree",{get:function(){return this.Li},enumerable:!0,configurable:!0}),A.c.prototype.createOrUpdateSubmeshesOctree=function(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const X=this.va();let b=X._getComponent(y.b.NAME_OCTREE);b||(b=new k(X),X.ne(b)),this._submeshesOctree||(this._submeshesOctree=new E.e(E.e.CreationFuncForSubMeshes,T,z)),this.ze(!0);const F=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(F.minimumWorld,F.maximumWorld,this.ue),this._submeshesOctree};class k{constructor(T){this.name=y.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new u.d(F.j.Zero(),new F.j(1,1,1)),(T=T||v.e.LastCreatedScene)&&(this.ve=T,this.ve.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.ve.getActiveSubMeshCandidates=T=>this.getActiveSubMeshCandidates(T),this.ve.getCollidingSubMeshCandidates=(T,z)=>this.getCollidingSubMeshCandidates(T,z),this.ve.getIntersectingSubMeshCandidates=(T,z)=>this.getIntersectingSubMeshCandidates(T,z))}register(){this.ve.onMeshRemovedObservable.add((T=>{const z=this.ve.selectionOctree;if(void 0!==z&&null!==z){const X=z.Ni.indexOf(T);-1!==X&&z.Ni.splice(X,1)}})),this.ve.onMeshImportedObservable.add((T=>{const z=this.ve.selectionOctree;void 0!==z&&null!==z&&z.we(T)}))}getActiveMeshCandidates(){var T;return(null===(T=this.ve.Li)||void 0===T?void 0:T.select(this.ve.frustumPlanes))||this.ve._getDefaultMeshCandidates()}getActiveSubMeshCandidates(T){if(T._submeshesOctree&&T.useOctreeForRenderingSelection){return T._submeshesOctree.select(this.ve.frustumPlanes)}return this.ve._getDefaultSubMeshCandidates(T)}getIntersectingSubMeshCandidates(T,z){if(T._submeshesOctree&&T.useOctreeForPicking){u.d.TransformToRef(z,T.getWorldMatrix(),this._tempRay);return T._submeshesOctree.intersectsRay(this._tempRay)}return this.ve._getDefaultSubMeshCandidates(T)}getCollidingSubMeshCandidates(T,z){if(T._submeshesOctree&&T.useOctreeForCollisions){const X=z._velocityWorldLength+Math.max(z._radius.x,z._radius.y,z._radius.z);return T._submeshesOctree.intersects(z._basePointWorld,X)}return this.ve._getDefaultSubMeshCandidates(T)}rebuild(){}dispose(){}}},12096:(T,z,X)=>{"use strict";X.d(z,{d:()=>c});var b=X(1159),F=X(11944),A=X(979),u=X(976),y=X(987),E=X(1277),v=X(1198),k=X(1007),L=X(1236);const D={internalPickerForMesh:void 0};class c{constructor(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A.e;this.origin=T,this.direction=z,this.length=X,this.epsilon=b}clone(){return new c(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const b=c._TmpVector3[0].Cd(T.x-X,T.y-X,T.z-X),F=c._TmpVector3[1].Cd(z.x+X,z.y+X,z.z+X);let A,u,y,E,v=0,k=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<b.x||this.origin.x>F.x)return!1}else if(A=1/this.direction.x,u=(b.x-this.origin.x)*A,y=(F.x-this.origin.x)*A,y===-1/0&&(y=1/0),u>y&&(E=u,u=y,y=E),v=Math.max(u,v),k=Math.min(y,k),v>k)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<b.y||this.origin.y>F.y)return!1}else if(A=1/this.direction.y,u=(b.y-this.origin.y)*A,y=(F.y-this.origin.y)*A,y===-1/0&&(y=1/0),u>y&&(E=u,u=y,y=E),v=Math.max(u,v),k=Math.min(y,k),v>k)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<b.z||this.origin.z>F.z)return!1}else if(A=1/this.direction.z,u=(b.z-this.origin.z)*A,y=(F.z-this.origin.z)*A,y===-1/0&&(y=1/0),u>y&&(E=u,u=y,y=E),v=Math.max(u,v),k=Math.min(y,k),v>k)return!1;return!0}intersectsBox(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(T.minimum,T.maximum,z)}intersectsSphere(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const X=T.center.x-this.origin.x,b=T.center.y-this.origin.y,F=T.center.z-this.origin.z,A=X*X+b*b+F*F,u=T.i+z,y=u*u;if(A<=y)return!0;const E=X*this.direction.x+b*this.direction.y+F*this.direction.z;if(E<0)return!1;return A-E*E<=y}intersectsTriangle(T,z,X){const b=c._TmpVector3[0],F=c._TmpVector3[1],A=c._TmpVector3[2],y=c._TmpVector3[3],v=c._TmpVector3[4];z.subtractToRef(T,b),X.subtractToRef(T,F),u.j.CrossToRef(this.direction,F,A);const k=u.j.Dot(b,A);if(0===k)return null;const L=1/k;this.origin.subtractToRef(T,y);const D=u.j.Dot(y,A)*L;if(D<-this.epsilon||D>1+this.epsilon)return null;u.j.CrossToRef(y,b,v);const p=u.j.Dot(this.direction,v)*L;if(p<-this.epsilon||D+p>1+this.epsilon)return null;const H=u.j.Dot(F,v)*L;return H>this.length?null:new E.c(1-D-p,D,H)}intersectsPlane(T){let z;const X=u.j.Dot(T.Jd,this.direction);if(Math.abs(X)<9.99999997475243e-7)return null;{const b=u.j.Dot(T.Jd,this.origin);return z=(-T.d-b)/X,z<0?z<-9.99999997475243e-7?null:0:z}}intersectsAxis(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(T){case"y":{const T=(this.origin.y-z)/this.direction.y;return T>0?null:new u.j(this.origin.x+this.direction.x*-T,z,this.origin.z+this.direction.z*-T)}case"x":{const T=(this.origin.x-z)/this.direction.x;return T>0?null:new u.j(z,this.origin.y+this.direction.y*-T,this.origin.z+this.direction.z*-T)}case"z":{const T=(this.origin.z-z)/this.direction.z;return T>0?null:new u.j(this.origin.x+this.direction.x*-T,this.origin.y+this.direction.y*-T,z)}default:return null}}intersectsMesh(T,z,X){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4?arguments[4]:void 0,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const y=u.f.Matrix[0];return T.getWorldMatrix().invertToRef(y),this._tmpRay?c.TransformToRef(this,y,this._tmpRay):this._tmpRay=c.Transform(this,y),T.intersects(this._tmpRay,z,X,b,F,A)}intersectsMeshes(T,z,X){X?X.length=0:X=[];for(let b=0;b<T.length;b++){const F=this.intersectsMesh(T[b],z);F.hit&&X.push(F)}return X.sort(this._comparePickingInfo),X}_comparePickingInfo(T,z){return T.distance<z.distance?-1:T.distance>z.distance?1:0}intersectionSegment(T,z,X){const b=this.origin,F=u.f.Id[0],A=u.f.Id[1],y=u.f.Id[2],E=u.f.Id[3];z.subtractToRef(T,F),this.direction.scaleToRef(c._Rayl,y),b.addToRef(y,A),T.subtractToRef(b,E);const v=u.j.Dot(F,F),k=u.j.Dot(F,y),L=u.j.Dot(y,y),D=u.j.Dot(F,E),p=u.j.Dot(y,E),H=v*L-k*k;let U,s,x=H,K=H;H<c._Smallnum?(U=0,x=1,s=p,K=L):(U=k*p-L*D,s=v*p-k*D,U<0?(U=0,s=p,K=L):U>x&&(U=x,s=p+k,K=L)),s<0?(s=0,-D<0?U=0:-D>v?U=x:(U=-D,x=v)):s>K&&(s=K,-D+k<0?U=0:-D+k>v?U=x:(U=-D+k,x=v));const d=Math.abs(U)<c._Smallnum?0:U/x,N=Math.abs(s)<c._Smallnum?0:s/K,l=u.f.Id[4];y.scaleToRef(N,l);const a=u.f.Id[5];F.scaleToRef(d,a),a.addInPlace(E);const q=u.f.Id[6];a.subtractToRef(l,q);return N>0&&N<=this.length&&q.lengthSquared()<X*X?a.length():-1}update(T,z,X,b,F,A,y){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){c._RayDistant||(c._RayDistant=c.Zero()),c._RayDistant.unprojectRayToRef(T,z,X,b,u.d.IdentityReadOnly,A,y);const E=u.f.Matrix[0];F.invertToRef(E),c.TransformToRef(c._RayDistant,E,this)}else this.unprojectRayToRef(T,z,X,b,F,A,y);return this}static Zero(){return new c(u.j.Zero(),u.j.Zero())}static CreateNew(T,z,X,b,F,A,u){return c.Zero().update(T,z,X,b,F,A,u)}static CreateNewFromTo(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.d.IdentityReadOnly;const b=new c(new u.j(0,0,0),new u.j(0,0,0));return c.CreateFromToToRef(T,z,b,X)}static CreateFromToToRef(T,z,X){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.d.IdentityReadOnly;X.origin.p(T);const F=z.subtractToRef(T,X.direction),A=Math.sqrt(F.x*F.x+F.y*F.y+F.z*F.z);return X.length=A,X.direction.normalize(),c.TransformToRef(X,b,X)}static Transform(T,z){const X=new c(new u.j(0,0,0),new u.j(0,0,0));return c.TransformToRef(T,z,X),X}static TransformToRef(T,z,X){u.j.TransformCoordinatesToRef(T.origin,z,X.origin),u.j.TransformNormalToRef(T.direction,z,X.direction),X.length=T.length,X.epsilon=T.epsilon;const b=X.direction,F=b.length();if(0!==F&&1!==F){const T=1/F;b.x*=T,b.y*=T,b.z*=T,X.length*=F}return X}unprojectRayToRef(T,z,X,b,F,A,y){const E=u.f.Matrix[0];F.multiplyToRef(A,E),E.multiplyToRef(y,E),E.invert();const v=k.e.LastCreatedEngine,L=u.f.Id[0];L.x=T/X*2-1,L.y=-(z/b*2-1),L.z=null!==v&&void 0!==v&&v.useReverseDepthBuffer?1:null!==v&&void 0!==v&&v.isNDCHalfZRange?0:-1;const D=u.f.Id[1].Cd(L.x,L.y,1-1e-8),c=u.f.Id[2],p=u.f.Id[3];u.j._UnprojectFromInvertedMatrixToRef(L,E,c),u.j._UnprojectFromInvertedMatrixToRef(D,E,p),this.origin.p(c),p.subtractToRef(c,this.direction),this.direction.normalize()}}function p(T,z,X,b,F){let A=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const u=c.Zero();return H(T,z,X,b,u,F,A),u}function H(T,z,X,b,F,A){let y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const v=T.getEngine();if(!A&&!(A=T.activeCamera))return T;const k=A.viewport,L=v.getRenderHeight(),{x:D,y:c,width:p,height:H}=k.toGlobal(v.getRenderWidth(),L),U=1/v.getHardwareScalingLevel();return z=z*U-D,X=X*U-(L-c-H),F.update(z,X,p,H,b||u.d.IdentityReadOnly,y?u.d.IdentityReadOnly:A.getViewMatrix(),A.getProjectionMatrix(),E),T}function U(T,z,X,b,F){if(!v.c)return T;const A=T.getEngine();if(!F&&!(F=T.activeCamera))throw new Error("Active camera not set");const y=F.viewport,E=A.getRenderHeight(),{x:k,y:L,width:D,height:c}=y.toGlobal(A.getRenderWidth(),E),p=u.d.Identity(),H=1/A.getHardwareScalingLevel();return z=z*H-k,X=X*H-(E-L-c),b.update(z,X,D,c,p,p,F.getProjectionMatrix()),T}function s(T,z,X,b,F,A,u,y){const E=z(b,X.enableDistantPicking),v=X.intersects(E,F,u,A,b,y);return v&&v.hit?!F&&null!=T&&v.distance>=T.distance?null:v:null}function x(T,z,X,b,F,A){let y=null;const E=!!(T.activeCameras&&T.activeCameras.length>1&&T.cameraToUseForPointers!==T.activeCamera),k=T.cameraToUseForPointers||T.activeCamera,L=D.internalPickerForMesh||s;for(let v=0;v<T.meshes.length;v++){const D=T.meshes[v];if(X){if(!X(D,-1))continue}else if(!D.isEnabled()||!D.isVisible||!D.de)continue;const c=E&&D.isWorldMatrixCameraDependent(),p=D.ze(c,k);if(D.hasThinInstances&&D.thinInstanceEnablePicking){const T=L(y,z,D,p,!0,!0,A);if(T){if(F)return T;const E=u.f.Matrix[1],v=D.thinInstanceGetWorldMatrices();for(let T=0;T<v.length;T++){if(X&&!X(D,T))continue;v[T].multiplyToRef(p,E);const u=L(y,z,D,E,b,F,A,!0);if(u&&(y=u,y.thinInstanceIndex=T,b))return y}}}else{const T=L(y,z,D,p,b,F,A);if(T&&(y=T,b))return y}}return y||new v.c}function K(T,z,X,b){if(!v.c)return null;const F=[],A=!!(T.activeCameras&&T.activeCameras.length>1&&T.cameraToUseForPointers!==T.activeCamera),y=T.cameraToUseForPointers||T.activeCamera,E=D.internalPickerForMesh||s;for(let v=0;v<T.meshes.length;v++){const k=T.meshes[v];if(X){if(!X(k,-1))continue}else if(!k.isEnabled()||!k.isVisible||!k.de)continue;const L=A&&k.isWorldMatrixCameraDependent(),D=k.ze(L,y);if(k.hasThinInstances&&k.thinInstanceEnablePicking){if(E(null,z,k,D,!0,!0,b)){const T=u.f.Matrix[1],A=k.thinInstanceGetWorldMatrices();for(let u=0;u<A.length;u++){if(X&&!X(k,u))continue;A[u].multiplyToRef(D,T);const y=E(null,z,k,T,!1,!1,b,!0);y&&(y.thinInstanceIndex=u,F.push(y))}}}else{const T=E(null,z,k,D,!1,!1,b);T&&F.push(T)}}return F}function d(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,b=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0;b||(b=T.getWorldMatrix()),z.length=X,F?z.origin.p(F):z.origin.p(T.position);const A=u.f.Id[2];A.set(0,0,T._scene.useRightHandedSystem?-1:1);const y=u.f.Id[3];return u.j.TransformNormalToRef(A,b,y),u.j.NormalizeToRef(y,z.direction),z}var N,l;c._TmpVector3=(0,y.c)(6,u.j.Zero),c._RayDistant=c.Zero(),c._Smallnum=1e-8,c._Rayl=1e9,N=b.e,(l=F.c)&&(l.prototype.getForwardRay=function(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,z=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;return d(this,new c(u.j.Zero(),u.j.Zero(),T),T,z,X)},l.prototype.getForwardRayToRef=function(T){return d(this,T,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),N&&(L.c._IsPickingAvailable=!0,N.prototype.createPickingRay=function(T,z,X,b){return p(this,T,z,X,b,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),b.e.prototype.createPickingRayToRef=function(T,z,X,b,F){return H(this,T,z,X,b,F,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},b.e.prototype.createPickingRayInCameraSpace=function(T,z,X){return function(T,z,X,b){const F=c.Zero();return U(T,z,X,F,b),F}(this,T,z,X)},b.e.prototype.createPickingRayInCameraSpaceToRef=function(T,z,X,b){return U(this,T,z,X,b)},b.e.prototype.pickWithBoundingInfo=function(T,z,X,b,F){return function(T,z,X,b,F,A){if(!v.c)return null;const y=x(T,(b=>(T._tempPickingRay||(T._tempPickingRay=c.Zero()),H(T,z,X,b,T._tempPickingRay,A||null),T._tempPickingRay)),b,F,!0);return y&&(y.ray=p(T,z,X,u.d.Identity(),A||null)),y}(this,T,z,X,b,F)},b.e.prototype.be=function(T,z,X,b,F,A){return function(T,z,X,b,F,A,y){const E=x(T,((b,F)=>(T._tempPickingRay||(T._tempPickingRay=c.Zero()),H(T,z,X,b,T._tempPickingRay,A||null,!1,F),T._tempPickingRay)),b,F,!1,y);return E&&(E.ray=p(T,z,X,u.d.Identity(),A||null)),E}(this,T,z,X,b,F,A)},b.e.prototype.pickWithRay=function(T,z,X,b){return function(T,z,X,b,F){const A=x(T,(X=>(T._pickWithRayInverseMatrix||(T._pickWithRayInverseMatrix=u.d.Identity()),X.invertToRef(T._pickWithRayInverseMatrix),T._cachedRayForTransform||(T._cachedRayForTransform=c.Zero()),c.TransformToRef(z,T._pickWithRayInverseMatrix,T._cachedRayForTransform),T._cachedRayForTransform)),X,b,!1,F);return A&&(A.ray=z),A}(this,T,z,X,b)},b.e.prototype.multiPick=function(T,z,X,b,F){return function(T,z,X,b,F,A){return K(T,(b=>p(T,z,X,b,F||null)),b,A)}(this,T,z,X,b,F)},b.e.prototype.multiPickWithRay=function(T,z,X){return function(T,z,X,b){return K(T,(X=>(T._pickWithRayInverseMatrix||(T._pickWithRayInverseMatrix=u.d.Identity()),X.invertToRef(T._pickWithRayInverseMatrix),T._cachedRayForTransform||(T._cachedRayForTransform=c.Zero()),c.TransformToRef(z,T._pickWithRayInverseMatrix,T._cachedRayForTransform),T._cachedRayForTransform)),X,b)}(this,T,z,X)}},12935:(T,z,X)=>{"use strict";X(1065);var b=X(1373);X(1102),X(1213),X(999),X(1424),X(1386);b.e},11821:(T,z,X)=>{"use strict";X.r(z),X.d(z,{SceneInstrumentation:()=>A});var b=X(1166),F=X(1242);class A{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(T){T!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=T,T?(this._onBeforeActiveMeshesEvaluationObserver=this.ve.onBeforeActiveMeshesEvaluationObservable.add((()=>{b.g.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.ve.onAfterActiveMeshesEvaluationObservable.add((()=>{b.g.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.ve.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ve.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(T){T!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=T,T?(this._onBeforeRenderTargetsRenderObserver=this.ve.onBeforeRenderTargetsRenderObservable.add((()=>{b.g.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.ve.onAfterRenderTargetsRenderObservable.add((()=>{b.g.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.ve.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ve.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(T){T!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=T,T?(this._onBeforeParticlesRenderingObserver=this.ve.onBeforeParticlesRenderingObservable.add((()=>{b.g.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.ve.onAfterParticlesRenderingObservable.add((()=>{b.g.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.ve.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ve.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(T){T!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=T,this.ve.spriteManagers&&(T?(this._onBeforeSpritesRenderingObserver=this.ve.onBeforeSpritesRenderingObservable.add((()=>{b.g.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.ve.onAfterSpritesRenderingObservable.add((()=>{b.g.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.ve.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.ve.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(T){T!==this._capturePhysicsTime&&this.ve.onBeforePhysicsObservable&&(this._capturePhysicsTime=T,T?(this._onBeforePhysicsObserver=this.ve.onBeforePhysicsObservable.add((()=>{b.g.StartPerformanceCounter("gb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.ve.onAfterPhysicsObservable.add((()=>{b.g.EndPerformanceCounter("gb"),this._physicsTime.endMonitoring()}))):(this.ve.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.ve.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(T){T!==this._captureAnimationsTime&&(this._captureAnimationsTime=T,T?this._onAfterAnimationsObserver=this.ve.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.ve.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(T){this._captureFrameTime=T}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(T){this._captureInterFrameTime=T}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(T){T!==this._captureRenderTime&&(this._captureRenderTime=T,T?(this._onBeforeDrawPhaseObserver=this.ve.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),b.g.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.ve.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),b.g.EndPerformanceCounter("Main render")}))):(this.ve.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ve.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(T){T!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=T,T?(this._onBeforeCameraRenderObserver=this.ve.onBeforeCameraRenderObservable.add((T=>{this._cameraRenderTime.beginMonitoring(),b.g.StartPerformanceCounter(`Rendering camera ${T.name}`)})),this._onAfterCameraRenderObserver=this.ve.onAfterCameraRenderObservable.add((T=>{this._cameraRenderTime.endMonitoring(!1),b.g.EndPerformanceCounter(`Rendering camera ${T.name}`)}))):(this.ve.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ve.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.ve.getEngine()._drawCalls}constructor(T){this.ve=T,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new F.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new F.b,this._captureFrameTime=!1,this._frameTime=new F.b,this._captureRenderTime=!1,this._renderTime=new F.b,this._captureInterFrameTime=!1,this._interFrameTime=new F.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new F.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new F.b,this._capturePhysicsTime=!1,this._physicsTime=new F.b,this._captureAnimationsTime=!1,this._animationsTime=new F.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new F.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=T.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(b.g.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.ve.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=T.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(b.g.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Vd(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Vd(),this._captureParticlesRenderTime&&this._particlesRenderTime.Vd(),this._captureSpritesRenderTime&&this._spritesRenderTime.Vd(),this._captureRenderTime&&this._renderTime.Vd(),this._captureCameraRenderTime&&this._cameraRenderTime.Vd()}))}dispose(){this.ve.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.ve.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ve.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.ve.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ve.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.ve.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.ve.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ve.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.ve.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.ve.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.ve.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ve.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.ve.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.ve.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.ve.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.ve.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ve.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.ve=null}}},12548:(T,z,X)=>{"use strict";X.d(z,{d:()=>k});var b=X(952),F=X(957),A=X(976),u=X(11948),y=X(12521),E=X(12554),v=X(993);u.b.AddNodeConstructor("Light_Type_1",((T,z)=>()=>new k(T,A.j.Zero(),z)));class k extends E.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(T){this._shadowFrustumSize=T,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(T){this._shadowOrthoScale=T,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(T){this._orthoLeft=T}get orthoRight(){return this._orthoRight}set orthoRight(T){this._orthoRight=T}get orthoTop(){return this._orthoTop}set orthoTop(T){this._orthoTop=T}get orthoBottom(){return this._orthoBottom}set orthoBottom(T){this._orthoBottom=T}constructor(T,z,X){super(T,X),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=z.scale(-1),this.direction=z}getClassName(){return"ib"}getTypeID(){return y.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(T,z,X){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(T):this._setDefaultAutoExtendShadowProjectionMatrix(T,z,X)}_setDefaultFixedFrustumShadowProjectionMatrix(T){const z=this.va().activeCamera;z&&A.d.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:z.qj,void 0!==this.shadowMaxZ?this.shadowMaxZ:z.maxZ,T,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(T,z,X){const b=this.va().activeCamera;if(!b)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const T=A.j.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let b=Number.MAX_VALUE,F=-Number.MAX_VALUE;for(let u=0;u<X.length;u++){const y=X[u];if(!y)continue;const E=y.getBoundingInfo().boundingBox;for(let X=0;X<E.vectorsWorld.length;X++)A.j.TransformCoordinatesToRef(E.vectorsWorld[X],z,T),T.x<this._orthoLeft&&(this._orthoLeft=T.x),T.y<this._orthoBottom&&(this._orthoBottom=T.y),T.x>this._orthoRight&&(this._orthoRight=T.x),T.y>this._orthoTop&&(this._orthoTop=T.y),this.autoCalcShadowZBounds&&(T.z<b&&(b=T.z),T.z>F&&(F=T.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=b,this._shadowMaxZ=F)}const F=this._orthoRight-this._orthoLeft,u=this._orthoTop-this._orthoBottom,y=void 0!==this.shadowMinZ?this.shadowMinZ:b.qj,E=void 0!==this.shadowMaxZ?this.shadowMaxZ:b.maxZ,v=this.va().getEngine().useReverseDepthBuffer;A.d.OrthoOffCenterLHToRef(this._orthoLeft-F*this.shadowOrthoScale,this._orthoRight+F*this.shadowOrthoScale,this._orthoBottom-u*this.shadowOrthoScale,this._orthoTop+u*this.shadowOrthoScale,v?E:y,v?y:E,T,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(T,z){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,z),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,z),this)}transferToNodeMaterialEffect(T,z){return this.computeTransformedInformation()?(T.setFloat3(z,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(T.setFloat3(z,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(T){const z=this._scene.getEngine();return!z.useReverseDepthBuffer&&z.isNDCHalfZRange?0:1}getDepthMaxZ(T){const z=this._scene.getEngine();return z.useReverseDepthBuffer&&z.isNDCHalfZRange?0:1}prepareLightSpecificDefines(T,z){T["DIRLIGHT"+z]=!0}}(0,b.c)([(0,F.E)()],k.prototype,"shadowFrustumSize",null),(0,b.c)([(0,F.E)()],k.prototype,"shadowOrthoScale",null),(0,b.c)([(0,F.E)()],k.prototype,"autoUpdateExtends",void 0),(0,b.c)([(0,F.E)()],k.prototype,"autoCalcShadowZBounds",void 0),(0,b.c)([(0,F.E)("orthoLeft")],k.prototype,"_orthoLeft",void 0),(0,b.c)([(0,F.E)("orthoRight")],k.prototype,"_orthoRight",void 0),(0,b.c)([(0,F.E)("orthoTop")],k.prototype,"_orthoTop",void 0),(0,b.c)([(0,F.E)("orthoBottom")],k.prototype,"_orthoBottom",void 0),(0,v.h)("BABYLON.DirectionalLight",k)},12868:(T,z,X)=>{"use strict";X.d(z,{b:()=>k});var b=X(952),F=X(957),A=X(976),u=X(1132),y=X(11948),E=X(12521),v=X(993);y.b.AddNodeConstructor("Light_Type_3",((T,z)=>()=>new k(T,A.j.Zero(),z)));class k extends E.c{constructor(T,z,X){super(T,X),this.groundColor=new u.b(0,0,0),this.direction=z||A.j.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"jb"}setDirectionToTarget(T){return this.direction=A.j.Normalize(T.Mc(A.j.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(T,z){const X=A.j.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",X.x,X.y,X.z,0,z),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.uj),z),this}transferToNodeMaterialEffect(T,z){const X=A.j.Normalize(this.direction);return T.setFloat3(z,X.x,X.y,X.z),this}ze(){return this._worldMatrix||(this._worldMatrix=A.d.Identity()),this._worldMatrix}getTypeID(){return E.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(T,z){T["HEMILIGHT"+z]=!0}}(0,b.c)([(0,F.k)()],k.prototype,"groundColor",void 0),(0,b.c)([(0,F.C)()],k.prototype,"direction",void 0),(0,v.h)("BABYLON.HemisphericLight",k)},12521:(T,z,X)=>{"use strict";X.d(z,{c:()=>D});var b=X(952),F=X(957),A=X(976),u=X(1132),y=X(11948),E=X(1195),v=X(993),k=X(1262),L=X(1122);class D extends y.b{get range(){return this._range}set range(T){this._range=T,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(T){this._intensityMode=T,this._computePhotometricScale()}get i(){return this._radius}set i(T){this._radius=T,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(T){this._shadowEnabled!==T&&(this._shadowEnabled=T,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(T){this._includedOnlyMeshes=T,this._hookArrayForIncludedOnly(T)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(T){this._excludedMeshes=T,this._hookArrayForExcluded(T)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(T){this._excludeWithLayerMask=T,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(T){this._includeOnlyWithLayerMask=T,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(T){this._lightmapMode!==T&&(this._lightmapMode=T,this._markMeshesAsLightDirty())}getViewMatrix(T){return null}getProjectionMatrix(T,z){return null}constructor(T,z){super(T,z,!1),this.Yh=new u.b(1,1,1),this.Re=new u.b(1,1,1),this.falloffType=D.FALLOFF_DEFAULT,this.uj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=D.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new E.c(this.va().getEngine(),void 0,void 0,T),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(T,z){return this}_bindLight(T,z,X,b){let F=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const A=T.toString();let y=!1;if(this._uniformBuffer.bindToEffect(X,"Light"+A),this._renderId!==z.getRenderId()||this._lastUseSpecular!==b||!this._uniformBuffer.useUbo){this._renderId=z.getRenderId(),this._lastUseSpecular=b;const T=this.getScaledIntensity();this.transferToEffect(X,A),this.Yh.scaleToRef(T,u.h.Wd[0]),this._uniformBuffer.updateColor4("vLightDiffuse",u.h.Wd[0],this.range,A),b&&(this.Re.scaleToRef(T,u.h.Wd[1]),this._uniformBuffer.updateColor4("vLightSpecular",u.h.Wd[1],this.i,A)),y=!0}if(this.transferTexturesToEffect(X,A),z.shadowsEnabled&&this.shadowEnabled&&F){const T=this.getShadowGenerator(z.activeCamera)??this.getShadowGenerator();T&&(T.bindShadowLight(A,X),y=!0)}y?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(T){let z="Name: "+this.name;if(z+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let X=0;X<this.animations.length;X++)z+=", animation[0]: "+this.animations[X].toString(T);return z}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Hg(T){super.Hg(T),this._resyncMeshes()}getShadowGenerator(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(T)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return A.j.Zero()}canAffectMesh(T){return!T||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(T))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(T))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&T.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&T.layerMask)))}dispose(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const T=this._shadowGenerators.values();for(let z=T.next();!0!==z.done;z=T.next()){z.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const T=this._parentContainer.lights.indexOf(this);T>-1&&this._parentContainer.lights.splice(T,1),this._parentContainer=null}for(const X of this.va().meshes)X._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(T,z)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.uj}clone(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=D.GetConstructorFromName(this.getTypeID(),T,this.va());if(!X)return null;const b=L.b.Clone(X,this);return T&&(b.name=T),z&&(b.parent=z),b.Hg(this.isEnabled()),this.onClonedObservable.notifyObservers(b),b}serialize(){const T=L.b.Serialize(this);return T.uniqueId=this.uniqueId,T.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(T),this.excludedMeshes.length>0&&(T.excludedMeshesIds=[],this.excludedMeshes.forEach((z=>{T.excludedMeshesIds.push(z.id)}))),this.includedOnlyMeshes.length>0&&(T.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((z=>{T.includedOnlyMeshesIds.push(z.id)}))),L.b.AppendSerializedAnimations(this,T),T.ranges=this.serializeAnimationRanges(),T.isEnabled=this.isEnabled(),T}static GetConstructorFromName(T,z,X){const b=y.b.Construct("Light_Type_"+T,z,X);return b||null}static Parse(T,z){const X=D.GetConstructorFromName(T.type,T.name,z);if(!X)return null;const b=L.b.Parse(X,T,z);if(T.excludedMeshesIds&&(b._excludedMeshesIds=T.excludedMeshesIds),T.includedOnlyMeshesIds&&(b._includedOnlyMeshesIds=T.includedOnlyMeshesIds),void 0!==T.parentId&&(b._waitingParentId=T.parentId),void 0!==T.parentInstanceIndex&&(b._waitingParentInstanceIndex=T.parentInstanceIndex),void 0!==T.falloffType&&(b.falloffType=T.falloffType),void 0!==T.lightmapMode&&(b.lightmapMode=T.lightmapMode),T.animations){for(let z=0;z<T.animations.length;z++){const X=T.animations[z],F=(0,v.e)("BABYLON.Animation");F&&b.animations.push(F.Parse(X))}y.b.ParseAnimationRanges(b,T,z)}return T.autoAnimate&&z.beginAnimation(b,T.autoAnimateFrom,T.autoAnimateTo,T.autoAnimateLoop,T.autoAnimateSpeed||1),void 0!==T.isEnabled&&b.Hg(T.isEnabled),b}_hookArrayForExcluded(T){var z=this;const X=T.push;T.push=function(){for(var b=arguments.length,F=new Array(b),A=0;A<b;A++)F[A]=arguments[A];const u=X.apply(T,F);for(const T of F)T._resyncLightSource(z);return u};const b=T.splice;T.splice=(z,X)=>{const F=b.apply(T,[z,X]);for(const T of F)T._resyncLightSource(this);return F};for(const F of T)F._resyncLightSource(this)}_hookArrayForIncludedOnly(T){var z=this;const X=T.push;T.push=function(){for(var b=arguments.length,F=new Array(b),A=0;A<b;A++)F[A]=arguments[A];const u=X.apply(T,F);return z._resyncMeshes(),u};const b=T.splice;T.splice=(z,X)=>{const F=b.apply(T,[z,X]);return this._resyncMeshes(),F},this._resyncMeshes()}_resyncMeshes(){for(const T of this.va().meshes)T._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const T of this.va().meshes)-1!==T.lightSources.indexOf(this)&&T._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let T=0;const z=this.getTypeID();let X=this.intensityMode;switch(X===D.INTENSITYMODE_AUTOMATIC&&(X=z===D.LIGHTTYPEID_DIRECTIONALLIGHT?D.INTENSITYMODE_ILLUMINANCE:D.INTENSITYMODE_LUMINOUSINTENSITY),z){case D.LIGHTTYPEID_POINTLIGHT:case D.LIGHTTYPEID_SPOTLIGHT:switch(X){case D.INTENSITYMODE_LUMINOUSPOWER:T=1/(4*Math.PI);break;case D.INTENSITYMODE_LUMINOUSINTENSITY:T=1;break;case D.INTENSITYMODE_LUMINANCE:T=this.i*this.i}break;case D.LIGHTTYPEID_DIRECTIONALLIGHT:switch(X){case D.INTENSITYMODE_ILLUMINANCE:T=1;break;case D.INTENSITYMODE_LUMINANCE:{let z=this.i;z=Math.max(z,.001);T=2*Math.PI*(1-Math.cos(z));break}}break;case D.LIGHTTYPEID_HEMISPHERICLIGHT:T=1}return T}_reorderLightsInScene(){const T=this.va();0!=this._renderPriority&&(T.requireLightSorting=!0),this.va().sortLightsByPriority()}}D.FALLOFF_DEFAULT=k.d.FALLOFF_DEFAULT,D.FALLOFF_PHYSICAL=k.d.FALLOFF_PHYSICAL,D.FALLOFF_GLTF=k.d.FALLOFF_GLTF,D.FALLOFF_STANDARD=k.d.FALLOFF_STANDARD,D.LIGHTMAP_DEFAULT=k.d.LIGHTMAP_DEFAULT,D.LIGHTMAP_SPECULAR=k.d.LIGHTMAP_SPECULAR,D.LIGHTMAP_SHADOWSONLY=k.d.LIGHTMAP_SHADOWSONLY,D.INTENSITYMODE_AUTOMATIC=k.d.INTENSITYMODE_AUTOMATIC,D.INTENSITYMODE_LUMINOUSPOWER=k.d.INTENSITYMODE_LUMINOUSPOWER,D.INTENSITYMODE_LUMINOUSINTENSITY=k.d.INTENSITYMODE_LUMINOUSINTENSITY,D.INTENSITYMODE_ILLUMINANCE=k.d.INTENSITYMODE_ILLUMINANCE,D.INTENSITYMODE_LUMINANCE=k.d.INTENSITYMODE_LUMINANCE,D.LIGHTTYPEID_POINTLIGHT=k.d.LIGHTTYPEID_POINTLIGHT,D.LIGHTTYPEID_DIRECTIONALLIGHT=k.d.LIGHTTYPEID_DIRECTIONALLIGHT,D.LIGHTTYPEID_SPOTLIGHT=k.d.LIGHTTYPEID_SPOTLIGHT,D.LIGHTTYPEID_HEMISPHERICLIGHT=k.d.LIGHTTYPEID_HEMISPHERICLIGHT,(0,b.c)([(0,F.k)()],D.prototype,"diffuse",void 0),(0,b.c)([(0,F.k)()],D.prototype,"specular",void 0),(0,b.c)([(0,F.E)()],D.prototype,"falloffType",void 0),(0,b.c)([(0,F.E)()],D.prototype,"intensity",void 0),(0,b.c)([(0,F.E)()],D.prototype,"range",null),(0,b.c)([(0,F.E)()],D.prototype,"intensityMode",null),(0,b.c)([(0,F.E)()],D.prototype,"i",null),(0,b.c)([(0,F.E)()],D.prototype,"_renderPriority",void 0),(0,b.c)([(0,F.b)("_reorderLightsInScene")],D.prototype,"renderPriority",void 0),(0,b.c)([(0,F.E)("shadowEnabled")],D.prototype,"_shadowEnabled",void 0),(0,b.c)([(0,F.E)("excludeWithLayerMask")],D.prototype,"_excludeWithLayerMask",void 0),(0,b.c)([(0,F.E)("includeOnlyWithLayerMask")],D.prototype,"_includeOnlyWithLayerMask",void 0),(0,b.c)([(0,F.E)("lightmapMode")],D.prototype,"_lightmapMode",void 0)},12554:(T,z,X)=>{"use strict";X.d(z,{b:()=>E});var b=X(952),F=X(957),A=X(976),u=X(12521),y=X(1449);class E extends u.c{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=A.d.Identity(),this._projectionMatrix=A.d.Identity()}_setPosition(T){this._position=T}get position(){return this._position}set position(T){this._setPosition(T)}_setDirection(T){this._direction=T}get direction(){return this._direction}set direction(T){this._setDirection(T)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(T){this._shadowMinZ=T,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(T){this._shadowMaxZ=T,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=A.j.Zero()),A.j.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=A.j.Zero()),A.j.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(T){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(T){return this.direction=A.j.Normalize(T.Mc(this.position)),this.direction}getRotation(){this.direction.normalize();const T=A.j.Cross(this.direction,y.b.Y),z=A.j.Cross(T,this.direction);return A.j.RotationFromAxis(T,z,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=A.j.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}ze(T){return!T&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=A.d.Identity()),A.d.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(T){return void 0!==this.shadowMinZ?this.shadowMinZ:T.qj}getDepthMaxZ(T){return void 0!==this.shadowMaxZ?this.shadowMaxZ:T.maxZ}setShadowProjectionMatrix(T,z,X){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(z,X,T):this._setDefaultShadowProjectionMatrix(T,z,X),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(T){const z=A.f.Id[0];let X=this.position;this.computeTransformedInformation()&&(X=this.transformedPosition),A.j.NormalizeToRef(this.getShadowDirection(T),z),1===Math.abs(A.j.Dot(z,A.j.Up()))&&(z.z=1e-13);const b=A.f.Id[1];return X.addToRef(z,b),A.d.LookAtLHToRef(X,b,A.j.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(T,z){return this.setShadowProjectionMatrix(this._projectionMatrix,T??this._viewMatrix,z??[]),this._projectionMatrix}}(0,b.c)([(0,F.C)()],E.prototype,"position",null),(0,b.c)([(0,F.C)()],E.prototype,"direction",null),(0,b.c)([(0,F.E)()],E.prototype,"shadowMinZ",null),(0,b.c)([(0,F.E)()],E.prototype,"shadowMaxZ",null)},12084:(T,z,X)=>{"use strict";X.d(z,{b:()=>u,f:()=>A,h:()=>y});const b={},F={};function A(T,z){b[T]=z}function u(T,z){F[T]=z}function y(T){return F[T]?F[T]:null}},12025:(T,z,X)=>{"use strict";X.d(z,{e:()=>n,h:()=>l});var b,F=X(1166),A=X(968),u=X(1159),y=X(1007),E=X(1065),v=X(11966),k=X(1030),L=X(1039),D=X(1025),c=X(1071);!function(T){T[T.Clean=0]="Clean",T[T.Stop=1]="Stop",T[T.Sync=2]="Sync",T[T.NoSync=3]="NoSync"}(b||(b={}));const p=new A.d,H={};let U=!1;function s(){return H[".babylon"]}function x(T){const z=H[T];return z||(E.e.Warn("Unable to find a plugin to load "+T+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),s())}function K(T,z,X){let b="Unable to load from "+(T.rawData?"binary data":T.url);return z?b+=`: ${z}`:X&&(b+=`: ${X}`),b}function d(T,z,X,b,F,A,u,y,E){var v;const L="data:"===(D=T.url).substring(0,5)?D.substring(5):null;var D;if(T.rawData&&!u)throw"When using ArrayBufferView to load data the file extension must be provided.";const U=u?x(u):L?function(T){for(const z in H){const X=H[z].plugin;if(X.canDirectLoad&&X.canDirectLoad(T))return H[z]}return s()}(T.url):function(T){const z=T.indexOf("?");-1!==z&&(T=T.substring(0,z));const X=T.lastIndexOf(".");return x(T.substring(X,T.length).toLowerCase())}(T.url);if(!U)throw new Error(`No plugin or fallback for ${u??T.url}`);if(!1===(null===E||void 0===E||null===(v=E[U.plugin.name])||void 0===v?void 0:v.enabled))throw new Error(`The '${U.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(T.rawData&&!U.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(T=>{if(U.plugin.createPlugin){const z=U.plugin.createPlugin(E??{});return z instanceof Promise?(z.then(T).catch((T=>{F("Error instantiating plugin.",T)})),null):(T(z),z)}return T(U.plugin),U.plugin})((E=>{var v;if(!E)throw`The loader plugin corresponding to the '${u}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(p.notifyObservers(E),L&&(E.canDirectLoad&&E.canDirectLoad(T.url)||!(0,k.i)(T.url))){if(E.directLoad){const T=E.directLoad(z,L);T instanceof Promise?T.then((T=>{X(E,T)})).catch((T=>{F("Error in directLoad of _loadData: "+T,T)})):X(E,T)}else X(E,L);return}const D=U.isBinary,H=(T,b)=>{z.u?F("Scene has been disposed"):X(E,T,b)};let s=null,x=!1;null===(v=E.Qd)||void 0===v||v.add((()=>{x=!0,s&&(s.abort(),s=null),A()}));const K=()=>{if(x)return;const X=(T,z)=>{F(null===T||void 0===T?void 0:T.statusText,z)};if(!E.loadFile&&T.rawData)throw"Plugin does not support loading ArrayBufferView.";s=E.loadFile?E.loadFile(z,T.rawData||T.file||T.url,T.rootUrl,H,b,D,X,y):z._loadFile(T.file||T.url,H,b,!0,D,X)},d=z.getEngine();let N=d.enableOfflineSupport;if(N){let X=!1;for(const b of z.disableOfflineSupportExceptionRules)if(b.test(T.url)){X=!0;break}N=!X}N&&c.d.OfflineProviderFactory?z.offlineProvider=c.d.OfflineProviderFactory(T.url,K,d.disableManifestCheck):K()}))}function N(T,z){let X,b,A=null,u=null;if(z)if(z.name)X=`file:${z.name}`,b=z.name,A=z;else if(ArrayBuffer.isView(z))X="",b=(0,D.b)(),u=z;else if(z.startsWith("data:"))X=z,b="";else if(T){const A=z;if("/"===A.substring(0,1))return F.g.Error("Wrong sceneFilename parameter"),null;X=T+A,b=A}else X=z,b=F.g.GetFilename(z),T=F.g.GetFolderPath(z);else X=T,b=F.g.GetFilename(T),T=F.g.GetFolderPath(T);return{url:X,rootUrl:T,name:b,file:A,rawData:u}}function l(T){if("string"===typeof T.extensions){const z=T.extensions;H[z.toLowerCase()]={plugin:T,isBinary:!1}}else{const z=T.extensions;Object.keys(z).forEach((X=>{H[X.toLowerCase()]={plugin:T,isBinary:z[X].isBinary}}))}}function a(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y.e.LastCreatedScene,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!b)return E.e.Error("No scene available to import mesh to"),null;const c=N(z,X);if(!c)return null;const p={};b.addPendingData(p);const H=()=>{b.removePendingData(p)},U=(T,z)=>{const X=K(c,T,z);u?u(b,X,new L.i(X,L.g.SceneLoaderError,z)):E.e.Error(X),H()},s=A?T=>{try{A(T)}catch(z){U("Error in onProgress callback: "+z,z)}}:void 0,x=(T,z,X,A,u,y,E,v)=>{if(b.importedMeshesFiles.push(c.url),F)try{F(T,z,X,A,u,y,E,v)}catch(k){U("Error in onSuccess callback: "+k,k)}b.removePendingData(p)};return d(c,b,((z,X,F)=>{if(z.rewriteRootURL&&(c.rootUrl=z.rewriteRootURL(c.rootUrl,F)),z.importMesh){const F=[],A=[],u=[];if(!z.importMesh(T,b,X,c.rootUrl,F,A,u,U))return;b.loadingPluginName=z.name,x(F,A,u,[],[],[],[],[])}else{z.importMeshAsync(T,b,X,c.rootUrl,s,c.name).then((T=>{b.loadingPluginName=z.name,x(T.meshes,T.pe,T.skeletons,T.animationGroups,T.transformNodes,T.geometries,T.lights,T.spriteManagers)})).catch((T=>{U(T.message,T)}))}}),s,U,H,v,k,D)}function q(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.e.LastCreatedEngine,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return X?C(T,z,new u.e(X),b,A,E,v,k,L):(F.g.Error("No engine available"),null)}function V(T,z,X,b,F,A,u){return new Promise(((y,E)=>{q(T,z,X,(T=>{y(T)}),b,((T,z,X)=>{E(X||new Error(z))}),F,A,u)}))}function C(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.e.LastCreatedScene,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!X)return E.e.Error("No scene available to append to"),null;const c=N(T,z);if(!c)return null;const p={};X.addPendingData(p);const H=()=>{X.removePendingData(p)};v.d.ShowLoadingScreen&&!U&&(U=!0,X.getEngine().displayLoadingUI(),X.executeWhenReady((()=>{X.getEngine().hideLoadingUI(),U=!1})));const s=(T,z)=>{const b=K(c,T,z);A?A(X,b,new L.i(b,L.g.SceneLoaderError,z)):E.e.Error(b),H()},x=F?T=>{try{F(T)}catch(z){s("Error in onProgress callback",z)}}:void 0,l=()=>{if(b)try{b(X)}catch(T){s("Error in onSuccess callback",T)}X.removePendingData(p)};return d(c,X,((T,z)=>{if(T.load){if(!T.load(X,z,c.rootUrl,s))return;X.loadingPluginName=T.name,l()}else{T.loadAsync(X,z,c.rootUrl,x,c.name).then((()=>{X.loadingPluginName=T.name,l()})).catch((T=>{s(T.message,T)}))}}),x,s,H,u,k,D)}function G(T,z,X,b,F,A,u){return new Promise(((y,E)=>{C(T,z,X,(T=>{y(T)}),b,((T,z,X)=>{E(X||new Error(z))}),F,A,u)}))}function j(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.e.LastCreatedScene,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!X)return E.e.Error("No scene available to load asset container to"),null;const D=N(T,z);if(!D)return null;const c={};X.addPendingData(c);const p=()=>{X.removePendingData(c)},H=(T,z)=>{const b=K(D,T,z);A?A(X,b,new L.i(b,L.g.SceneLoaderError,z)):E.e.Error(b),p()},U=F?T=>{try{F(T)}catch(z){H("Error in onProgress callback",z)}}:void 0,s=T=>{if(b)try{b(T)}catch(z){H("Error in onSuccess callback",z)}X.removePendingData(c)};return d(D,X,((T,z)=>{if(T.loadAssetContainer){const b=T.loadAssetContainer(X,z,D.rootUrl,H);if(!b)return;b.populateRootNodes(),X.loadingPluginName=T.name,s(b)}else if(T.loadAssetContainerAsync){T.loadAssetContainerAsync(X,z,D.rootUrl,U,D.name).then((z=>{z.populateRootNodes(),X.loadingPluginName=T.name,s(z)})).catch((T=>{H(T.message,T)}))}else H("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),U,H,p,u,v,k)}function Z(T,z,X,b,F,A,u){return new Promise(((y,E)=>{j(T,z,X,(T=>{y(T)}),b,((T,z,X)=>{E(X||new Error(z))}),F,A,u)}))}function m(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.e.LastCreatedScene,b=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,L=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,D=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!X)return void E.e.Error("No scene available to load animations to");if(b){for(const T of X.animatables)T.reset();X.stopAllAnimations(),X.animationGroups.slice().forEach((T=>{T.dispose()}));X.getNodes().forEach((T=>{T.animations&&(T.animations=[])}))}else switch(F){case 0:X.animationGroups.slice().forEach((T=>{T.dispose()}));break;case 1:X.animationGroups.forEach((T=>{T.stop()}));break;case 2:X.animationGroups.forEach((T=>{T.reset(),T.restart()}));break;case 3:break;default:return void E.e.Error("Unknown animation group loading mode value '"+F+"'")}const p=X.animatables.length;j(T,z,X,(T=>{T.mergeAnimationsTo(X,X.animatables.slice(p),A),T.dispose(),X.onAnimationFileImportedObservable.notifyObservers(X),u&&u(X)}),v,k,L,D,c)}function S(T,z,X,b,F,A,u,y,E,v){return new Promise(((k,L)=>{m(T,z,X,b,F,A,(T=>{k(T)}),u,((T,z,X)=>{L(X||new Error(z))}),y,E,v)}))}class n{static get ForceFullSceneLoadingForIncremental(){return v.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(T){v.d.ForceFullSceneLoadingForIncremental=T}static get ShowLoadingScreen(){return v.d.ShowLoadingScreen}static set ShowLoadingScreen(T){v.d.ShowLoadingScreen=T}static get loggingLevel(){return v.d.loggingLevel}static set loggingLevel(T){v.d.loggingLevel=T}static get CleanBoneMatrixWeights(){return v.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(T){v.d.CleanBoneMatrixWeights=T}static GetDefaultPlugin(){return s()}static GetPluginForExtension(T){var z;return null===(z=x(T))||void 0===z?void 0:z.plugin}static IsPluginForExtensionAvailable(T){return function(T){return!!H[T]}(T)}static RegisterPlugin(T){l(T)}static ImportMesh(T,z,X,b,F,A,u,y,E){return a(T,z,X,b,F,A,u,y,E)}static ImportMeshAsync(T,z,X,b,F,A,u){return function(T,z,X,b,F,A,u,y){return new Promise(((E,v)=>{a(T,z,X,b,((T,z,X,b,F,A,u,y)=>{E({meshes:T,pe:z,skeletons:X,animationGroups:b,transformNodes:F,geometries:A,lights:u,spriteManagers:y})}),F,((T,z,X)=>{v(X||new Error(z))}),A,u,y)}))}(T,z,X,b,F,A,u)}static Load(T,z,X,b,F,A,u,y){return q(T,z,X,b,F,A,u,y)}static LoadAsync(T,z,X,b,F,A){return V(T,z,X,b,F,A)}static Append(T,z,X,b,F,A,u,y){return C(T,z,X,b,F,A,u,y)}static AppendAsync(T,z,X,b,F,A){return G(T,z,X,b,F,A)}static LoadAssetContainer(T,z,X,b,F,A,u,y){return j(T,z,X,b,F,A,u,y)}static LoadAssetContainerAsync(T,z,X,b,F,A){return Z(T,z,X,b,F,A)}static ImportAnimations(T,z,X,b,F,A,u,y,E,v,k){m(T,z,X,b,F,A,u,y,E,v,k)}static ImportAnimationsAsync(T,z,X,b,F,A,u,y,E,v,k){return S(T,z,X,b,F,A,y,v,k)}}n.NO_LOGGING=0,n.MINIMAL_LOGGING=1,n.SUMMARY_LOGGING=2,n.DETAILED_LOGGING=3,n.OnPluginActivatedObservable=p},11966:(T,z,X)=>{"use strict";X.d(z,{d:()=>b});class b{static get ForceFullSceneLoadingForIncremental(){return b._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(T){b._ForceFullSceneLoadingForIncremental=T}static get ShowLoadingScreen(){return b._ShowLoadingScreen}static set ShowLoadingScreen(T){b._ShowLoadingScreen=T}static get loggingLevel(){return b._LoggingLevel}static set loggingLevel(T){b._LoggingLevel=T}static get CleanBoneMatrixWeights(){return b._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(T){b._CleanBoneMatrixWeights=T}}b._ForceFullSceneLoadingForIncremental=!1,b._ShowLoadingScreen=!0,b._CleanBoneMatrixWeights=!1,b._LoggingLevel=0},12505:(T,z,X)=>{"use strict";X.d(z,{b:()=>Y});var b=X(952),F=X(957),A=X(1065),u=X(1154),y=X(12499),E=X(1159),v=X(976),k=X(1207),L=X(1317),D=X(1348);class c extends L.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class p extends D.d{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(T,"PBRBRDF",90,new c,z),this._useEnergyConservation=p.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=p.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=p.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=p.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=p.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=p.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=p.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=p.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=T._dirtyCallbacks[16],this._enable(!0)}prepareDefines(T){T.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,T.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,T.SPHERICAL_HARMONICS=this._useSphericalHarmonics,T.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}p.DEFAULT_USE_ENERGY_CONSERVATION=!0,p.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,p.DEFAULT_USE_SPHERICAL_HARMONICS=!0,p.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsMiscDirty")],p.prototype,"useEnergyConservation",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsMiscDirty")],p.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsMiscDirty")],p.prototype,"useSphericalHarmonics",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsMiscDirty")],p.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var H=X(1269),U=X(1132),s=X(1175),x=X(1271),K=X(1326),d=X(949),N=X(1332),l=(X(10980),X(1334)),a=X(1305);class q extends L.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class V extends D.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(T,"PBRClearCoat",100,new q,z),this._isEnabled=!1,this.isEnabled=!1,this.uj=1,this.roughness=0,this._indexOfRefraction=V._DefaultIndexOfRefraction,this.indexOfRefraction=V._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=U.b.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=T._dirtyCallbacks[1]}isReadyForSubMesh(T,z,X){if(!this._isEnabled)return!0;const b=this._material._disableBumpMap;if(T._areTexturesDirty&&z.texturesEnabled){if(this._texture&&N.d.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&N.d.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(X.getCaps().standardDerivatives&&this._bumpTexture&&N.d.ClearCoatBumpTextureEnabled&&!b&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&N.d.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(T,z){this._isEnabled?(T.CLEARCOAT=!0,T.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,T.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,T._areTexturesDirty&&z.texturesEnabled&&(this._texture&&N.d.ClearCoatTextureEnabled?(0,a.S)(this._texture,T,"CLEARCOAT_TEXTURE"):T.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&N.d.ClearCoatTextureEnabled?(0,a.S)(this._textureRoughness,T,"CLEARCOAT_TEXTURE_ROUGHNESS"):T.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&N.d.ClearCoatBumpTextureEnabled?(0,a.S)(this._bumpTexture,T,"CLEARCOAT_BUMP"):T.CLEARCOAT_BUMP=!1,T.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===V._DefaultIndexOfRefraction,this._isTintEnabled?(T.CLEARCOAT_TINT=!0,this._tintTexture&&N.d.ClearCoatTintTextureEnabled?((0,a.S)(this._tintTexture,T,"CLEARCOAT_TINT_TEXTURE"),T.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):T.CLEARCOAT_TINT_TEXTURE=!1):(T.CLEARCOAT_TINT=!1,T.CLEARCOAT_TINT_TEXTURE=!1))):(T.CLEARCOAT=!1,T.CLEARCOAT_TEXTURE=!1,T.CLEARCOAT_TEXTURE_ROUGHNESS=!1,T.CLEARCOAT_BUMP=!1,T.CLEARCOAT_TINT=!1,T.CLEARCOAT_TINT_TEXTURE=!1,T.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,T.CLEARCOAT_DEFAULTIOR=!1,T.CLEARCOAT_TEXTUREDIRECTUV=0,T.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,T.CLEARCOAT_BUMPDIRECTUV=0,T.CLEARCOAT_REMAP_F0=!1,T.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,T.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(T,z,X,b){if(!this._isEnabled)return;const F=b.materialDefines,A=this._material.isFrozen,u=this._material._disableBumpMap,y=this._material._invertNormalMapX,E=this._material._invertNormalMapY;if(!T.useUbo||!A||!T.isSync){var v,k,L,D;if((this._texture||this._textureRoughness)&&N.d.ClearCoatTextureEnabled)T.updateFloat4("vClearCoatInfos",(null===(v=this._texture)||void 0===v?void 0:v.coordinatesIndex)??0,(null===(k=this._texture)||void 0===k?void 0:k.level)??0,(null===(L=this._textureRoughness)||void 0===L?void 0:L.coordinatesIndex)??0,(null===(D=this._textureRoughness)||void 0===D?void 0:D.level)??0),this._texture&&(0,a.s)(this._texture,T,"clearCoat"),this._textureRoughness&&!F.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,a.s)(this._textureRoughness,T,"clearCoatRoughness");this._bumpTexture&&X.getCaps().standardDerivatives&&N.d.ClearCoatTextureEnabled&&!u&&(T.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,a.s)(this._bumpTexture,T,"clearCoatBump"),z._mirroredCameraPosition?T.updateFloat2("vClearCoatTangentSpaceParams",y?1:-1,E?1:-1):T.updateFloat2("vClearCoatTangentSpaceParams",y?-1:1,E?-1:1)),this._tintTexture&&N.d.ClearCoatTintTextureEnabled&&(T.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,a.s)(this._tintTexture,T,"clearCoatTint")),T.updateFloat2("vClearCoatParams",this.uj,this.roughness);const b=1-this._indexOfRefraction,A=1+this._indexOfRefraction,c=Math.pow(-b/A,2),p=1/this._indexOfRefraction;T.updateFloat4("vClearCoatRefractionParams",c,p,b,A),this._isTintEnabled&&(T.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),T.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}z.texturesEnabled&&(this._texture&&N.d.ClearCoatTextureEnabled&&T.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!F.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&N.d.ClearCoatTextureEnabled&&T.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&X.getCaps().standardDerivatives&&N.d.ClearCoatBumpTextureEnabled&&!u&&T.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&N.d.ClearCoatTintTextureEnabled&&T.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(T){return this._texture===T||(this._textureRoughness===T||(this._bumpTexture===T||this._tintTexture===T))}getActiveTextures(T){this._texture&&T.push(this._texture),this._textureRoughness&&T.push(this._textureRoughness),this._bumpTexture&&T.push(this._bumpTexture),this._tintTexture&&T.push(this._tintTexture)}getAnimatables(T){this._texture&&this._texture.animations&&this._texture.animations.length>0&&T.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&T.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&T.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&T.push(this._tintTexture)}dispose(T){var z,X,b,F;T&&(null===(z=this._texture)||void 0===z||z.dispose(),null===(X=this._textureRoughness)||void 0===X||X.dispose(),null===(b=this._bumpTexture)||void 0===b||b.dispose(),null===(F=this._tintTexture)||void 0===F||F.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(T,z,X){return T.CLEARCOAT_BUMP&&z.addFallback(X++,"CLEARCOAT_BUMP"),T.CLEARCOAT_TINT&&z.addFallback(X++,"CLEARCOAT_TINT"),T.CLEARCOAT&&z.addFallback(X++,"CLEARCOAT"),X}getSamplers(T){T.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}V._DefaultIndexOfRefraction=1.5,(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"isEnabled",void 0),(0,b.c)([(0,F.E)()],V.prototype,"intensity",void 0),(0,b.c)([(0,F.E)()],V.prototype,"roughness",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"indexOfRefraction",void 0),(0,b.c)([(0,F.x)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"texture",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useRoughnessFromMainTexture",void 0),(0,b.c)([(0,F.x)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"textureRoughness",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"remapF0OnInterfaceChange",void 0),(0,b.c)([(0,F.x)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"bumpTexture",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"isTintEnabled",void 0),(0,b.c)([(0,F.k)()],V.prototype,"tintColor",void 0),(0,b.c)([(0,F.E)()],V.prototype,"tintColorAtDistance",void 0),(0,b.c)([(0,F.E)()],V.prototype,"tintThickness",void 0),(0,b.c)([(0,F.x)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"tintTexture",void 0);class C extends L.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class G extends D.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(T,"PBRIridescence",110,new C,z),this._isEnabled=!1,this.isEnabled=!1,this.uj=1,this.minimumThickness=G._DefaultMinimumThickness,this.maximumThickness=G._DefaultMaximumThickness,this.indexOfRefraction=G._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=T._dirtyCallbacks[1]}isReadyForSubMesh(T,z){if(!this._isEnabled)return!0;if(T._areTexturesDirty&&z.texturesEnabled){if(this._texture&&N.d.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&N.d.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(T,z){this._isEnabled?(T.IRIDESCENCE=!0,T._areTexturesDirty&&z.texturesEnabled&&(this._texture&&N.d.IridescenceTextureEnabled?(0,a.S)(this._texture,T,"IRIDESCENCE_TEXTURE"):T.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&N.d.IridescenceTextureEnabled?(0,a.S)(this._thicknessTexture,T,"IRIDESCENCE_THICKNESS_TEXTURE"):T.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(T.IRIDESCENCE=!1,T.IRIDESCENCE_TEXTURE=!1,T.IRIDESCENCE_THICKNESS_TEXTURE=!1,T.IRIDESCENCE_TEXTUREDIRECTUV=0,T.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(T,z){if(!this._isEnabled)return;const X=this._material.isFrozen;if(!T.useUbo||!X||!T.isSync){var b,F,A,u;if((this._texture||this._thicknessTexture)&&N.d.IridescenceTextureEnabled)T.updateFloat4("vIridescenceInfos",(null===(b=this._texture)||void 0===b?void 0:b.coordinatesIndex)??0,(null===(F=this._texture)||void 0===F?void 0:F.level)??0,(null===(A=this._thicknessTexture)||void 0===A?void 0:A.coordinatesIndex)??0,(null===(u=this._thicknessTexture)||void 0===u?void 0:u.level)??0),this._texture&&(0,a.s)(this._texture,T,"iridescence"),this._thicknessTexture&&(0,a.s)(this._thicknessTexture,T,"iridescenceThickness");T.updateFloat4("vIridescenceParams",this.uj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}z.texturesEnabled&&(this._texture&&N.d.IridescenceTextureEnabled&&T.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&N.d.IridescenceTextureEnabled&&T.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(T){return this._texture===T||this._thicknessTexture===T}getActiveTextures(T){this._texture&&T.push(this._texture),this._thicknessTexture&&T.push(this._thicknessTexture)}getAnimatables(T){this._texture&&this._texture.animations&&this._texture.animations.length>0&&T.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&T.push(this._thicknessTexture)}dispose(T){var z,X;T&&(null===(z=this._texture)||void 0===z||z.dispose(),null===(X=this._thicknessTexture)||void 0===X||X.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(T,z,X){return T.IRIDESCENCE&&z.addFallback(X++,"IRIDESCENCE"),X}getSamplers(T){T.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}G._DefaultMinimumThickness=100,G._DefaultMaximumThickness=400,G._DefaultIndexOfRefraction=1.3,(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"isEnabled",void 0),(0,b.c)([(0,F.E)()],G.prototype,"intensity",void 0),(0,b.c)([(0,F.E)()],G.prototype,"minimumThickness",void 0),(0,b.c)([(0,F.E)()],G.prototype,"maximumThickness",void 0),(0,b.c)([(0,F.E)()],G.prototype,"indexOfRefraction",void 0),(0,b.c)([(0,F.x)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"texture",void 0),(0,b.c)([(0,F.x)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"thicknessTexture",void 0);class j extends L.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class Z extends D.d{set angle(T){this.direction.x=Math.cos(T),this.direction.y=Math.sin(T)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(T,"PBRAnisotropic",110,new j,z),this._isEnabled=!1,this.isEnabled=!1,this.uj=1,this.direction=new v.i(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=T._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=T._dirtyCallbacks[16]}isReadyForSubMesh(T,z){return!this._isEnabled||!(T._areTexturesDirty&&z.texturesEnabled&&this._texture&&N.d.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(T,z,X){this._isEnabled?(T.ANISOTROPIC=this._isEnabled,this._isEnabled&&!X.isVerticesDataPresent(k.e.TangentKind)&&(T._needUVs=!0,T.MAINUV1=!0),T._areTexturesDirty&&z.texturesEnabled&&(this._texture&&N.d.AnisotropicTextureEnabled?(0,a.S)(this._texture,T,"ANISOTROPIC_TEXTURE"):T.ANISOTROPIC_TEXTURE=!1),T._areMiscDirty&&(T.ANISOTROPIC_LEGACY=this._legacy)):(T.ANISOTROPIC=!1,T.ANISOTROPIC_TEXTURE=!1,T.ANISOTROPIC_TEXTUREDIRECTUV=0,T.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(T,z){if(!this._isEnabled)return;const X=this._material.isFrozen;T.useUbo&&X&&T.isSync||(this._texture&&N.d.AnisotropicTextureEnabled&&(T.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,a.s)(this._texture,T,"anisotropy")),T.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.uj)),z.texturesEnabled&&this._texture&&N.d.AnisotropicTextureEnabled&&T.setTexture("anisotropySampler",this._texture)}hasTexture(T){return this._texture===T}getActiveTextures(T){this._texture&&T.push(this._texture)}getAnimatables(T){this._texture&&this._texture.animations&&this._texture.animations.length>0&&T.push(this._texture)}dispose(T){T&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(T,z,X){return T.ANISOTROPIC&&z.addFallback(X++,"ANISOTROPIC"),X}getSamplers(T){T.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(T,z,X){super.parse(T,z,X),void 0===T.legacy&&(this.legacy=!0)}}(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"isEnabled",void 0),(0,b.c)([(0,F.E)()],Z.prototype,"intensity",void 0),(0,b.c)([(0,F.y)()],Z.prototype,"direction",void 0),(0,b.c)([(0,F.x)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"texture",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsMiscDirty")],Z.prototype,"legacy",void 0);class m extends L.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class S extends D.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(T,"Sheen",120,new m,z),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.uj=1,this.color=U.b.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=T._dirtyCallbacks[1]}isReadyForSubMesh(T,z){if(!this._isEnabled)return!0;if(T._areTexturesDirty&&z.texturesEnabled){if(this._texture&&N.d.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&N.d.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(T,z){this._isEnabled?(T.SHEEN=!0,T.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,T.SHEEN_ROUGHNESS=null!==this._roughness,T.SHEEN_ALBEDOSCALING=this._albedoScaling,T.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,T._areTexturesDirty&&z.texturesEnabled&&(this._texture&&N.d.SheenTextureEnabled?((0,a.S)(this._texture,T,"SHEEN_TEXTURE"),T.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):T.SHEEN_TEXTURE=!1,this._textureRoughness&&N.d.SheenTextureEnabled?(0,a.S)(this._textureRoughness,T,"SHEEN_TEXTURE_ROUGHNESS"):T.SHEEN_TEXTURE_ROUGHNESS=!1)):(T.SHEEN=!1,T.SHEEN_TEXTURE=!1,T.SHEEN_TEXTURE_ROUGHNESS=!1,T.SHEEN_LINKWITHALBEDO=!1,T.SHEEN_ROUGHNESS=!1,T.SHEEN_ALBEDOSCALING=!1,T.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,T.SHEEN_GAMMATEXTURE=!1,T.SHEEN_TEXTUREDIRECTUV=0,T.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(T,z,X,b){if(!this._isEnabled)return;const F=b.materialDefines,A=this._material.isFrozen;if(!T.useUbo||!A||!T.isSync){var u,y,E,v;if((this._texture||this._textureRoughness)&&N.d.SheenTextureEnabled)T.updateFloat4("vSheenInfos",(null===(u=this._texture)||void 0===u?void 0:u.coordinatesIndex)??0,(null===(y=this._texture)||void 0===y?void 0:y.level)??0,(null===(E=this._textureRoughness)||void 0===E?void 0:E.coordinatesIndex)??0,(null===(v=this._textureRoughness)||void 0===v?void 0:v.level)??0),this._texture&&(0,a.s)(this._texture,T,"sheen"),this._textureRoughness&&!F.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,a.s)(this._textureRoughness,T,"sheenRoughness");T.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.uj),null!==this._roughness&&T.updateFloat("vSheenRoughness",this._roughness)}z.texturesEnabled&&(this._texture&&N.d.SheenTextureEnabled&&T.setTexture("sheenSampler",this._texture),this._textureRoughness&&!F.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&N.d.SheenTextureEnabled&&T.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(T){return this._texture===T||this._textureRoughness===T}getActiveTextures(T){this._texture&&T.push(this._texture),this._textureRoughness&&T.push(this._textureRoughness)}getAnimatables(T){this._texture&&this._texture.animations&&this._texture.animations.length>0&&T.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&T.push(this._textureRoughness)}dispose(T){var z,X;T&&(null===(z=this._texture)||void 0===z||z.dispose(),null===(X=this._textureRoughness)||void 0===X||X.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(T,z,X){return T.SHEEN&&z.addFallback(X++,"SHEEN"),X}getSamplers(T){T.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"isEnabled",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"linkSheenWithAlbedo",void 0),(0,b.c)([(0,F.E)()],S.prototype,"intensity",void 0),(0,b.c)([(0,F.k)()],S.prototype,"color",void 0),(0,b.c)([(0,F.x)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"texture",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRoughnessFromMainTexture",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"roughness",void 0),(0,b.c)([(0,F.x)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"textureRoughness",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"albedoScaling",void 0);class n extends L.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class O extends D.d{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(T){this._scene.enableSubSurfaceForPrePass()&&T&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(T))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(T){this._volumeIndexOfRefraction=T>=1?T:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(T,"PBRSubSurface",130,new n,z),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=U.b.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=U.b.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=T.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=T._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=T._dirtyCallbacks[32]}isReadyForSubMesh(T,z){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(T._areTexturesDirty&&z.texturesEnabled){if(this._thicknessTexture&&N.d.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&N.d.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&N.d.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const T=this._getRefractionTexture(z);if(T&&N.d.RefractionTextureEnabled&&!T.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(T,z){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return T.SUBSURFACE=!1,T.SS_DISPERSION=!1,T.SS_TRANSLUCENCY=!1,T.SS_SCATTERING=!1,T.SS_REFRACTION=!1,T.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,T.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,T.SS_THICKNESSANDMASK_TEXTURE=!1,T.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,T.SS_HAS_THICKNESS=!1,T.SS_REFRACTIONINTENSITY_TEXTURE=!1,T.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,T.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,T.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,T.SS_REFRACTIONMAP_3D=!1,T.SS_REFRACTIONMAP_OPPOSITEZ=!1,T.SS_LODINREFRACTIONALPHA=!1,T.SS_GAMMAREFRACTION=!1,T.SS_RGBDREFRACTION=!1,T.SS_LINEARSPECULARREFRACTION=!1,T.SS_LINKREFRACTIONTOTRANSPARENCY=!1,T.SS_ALBEDOFORREFRACTIONTINT=!1,T.SS_ALBEDOFORTRANSLUCENCYTINT=!1,T.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,T.SS_USE_THICKNESS_AS_DEPTH=!1,T.SS_USE_GLTF_TEXTURES=!1,T.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(T.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(T._areTexturesDirty){if(T.SUBSURFACE=!0,T.SS_DISPERSION=this._isDispersionEnabled,T.SS_TRANSLUCENCY=this._isTranslucencyEnabled,T.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,T.SS_SCATTERING=this._isScatteringEnabled,T.SS_THICKNESSANDMASK_TEXTURE=!1,T.SS_REFRACTIONINTENSITY_TEXTURE=!1,T.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,T.SS_HAS_THICKNESS=!1,T.SS_USE_GLTF_TEXTURES=!1,T.SS_REFRACTION=!1,T.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,T.SS_REFRACTIONMAP_3D=!1,T.SS_GAMMAREFRACTION=!1,T.SS_RGBDREFRACTION=!1,T.SS_LINEARSPECULARREFRACTION=!1,T.SS_REFRACTIONMAP_OPPOSITEZ=!1,T.SS_LODINREFRACTIONALPHA=!1,T.SS_LINKREFRACTIONTOTRANSPARENCY=!1,T.SS_ALBEDOFORREFRACTIONTINT=!1,T.SS_ALBEDOFORTRANSLUCENCYTINT=!1,T.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,T.SS_USE_THICKNESS_AS_DEPTH=!1,T.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,T._areTexturesDirty&&z.texturesEnabled&&(this._thicknessTexture&&N.d.ThicknessTextureEnabled&&(0,a.S)(this._thicknessTexture,T,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&N.d.RefractionIntensityTextureEnabled&&(0,a.S)(this._refractionIntensityTexture,T,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&N.d.TranslucencyIntensityTextureEnabled&&(0,a.S)(this._translucencyIntensityTexture,T,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&N.d.TranslucencyColorTextureEnabled&&(0,a.S)(this._translucencyColorTexture,T,"SS_TRANSLUCENCYCOLOR_TEXTURE")),T.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,T.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,T.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,T.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&z.texturesEnabled){const X=this._getRefractionTexture(z);X&&N.d.RefractionTextureEnabled&&(T.SS_REFRACTION=!0,T.SS_REFRACTIONMAP_3D=X.isCube,T.SS_GAMMAREFRACTION=X.gammaSpace,T.SS_RGBDREFRACTION=X.isRGBD,T.SS_LINEARSPECULARREFRACTION=X.linearSpecularLOD,T.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&X.isCube?!X.invertZ:X.invertZ,T.SS_LODINREFRACTIONALPHA=X.lodLevelInAlpha,T.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,T.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,T.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=X.isCube&&X.boundingBoxSize,T.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(T.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(T,z,X,b){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)T.updateFloat2("vThicknessParam",0,0);else{b.getRenderingMesh().getWorldMatrix().decompose(v.f.Id[0]);const z=Math.max(Math.abs(v.f.Id[0].x),Math.abs(v.f.Id[0].y),Math.abs(v.f.Id[0].z));T.updateFloat2("vThicknessParam",this.minimumThickness*z,(this.maximumThickness-this.minimumThickness)*z)}}bindForSubMesh(T,z,X,b){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const F=b.materialDefines,A=this._material.isFrozen,u=this._material.realTimeFiltering,y=F.LODBASEDMICROSFURACE,E=this._getRefractionTexture(z);if(!T.useUbo||!A||!T.isSync){if(this._thicknessTexture&&N.d.ThicknessTextureEnabled&&(T.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,a.s)(this._thicknessTexture,T,"thickness")),this._refractionIntensityTexture&&N.d.RefractionIntensityTextureEnabled&&F.SS_REFRACTIONINTENSITY_TEXTURE&&(T.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,a.s)(this._refractionIntensityTexture,T,"refractionIntensity")),this._translucencyColorTexture&&N.d.TranslucencyColorTextureEnabled&&F.SS_TRANSLUCENCYCOLOR_TEXTURE&&(T.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,a.s)(this._translucencyColorTexture,T,"translucencyColor")),this._translucencyIntensityTexture&&N.d.TranslucencyIntensityTextureEnabled&&F.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(T.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,a.s)(this._translucencyIntensityTexture,T,"translucencyIntensity")),E&&N.d.RefractionTextureEnabled){T._d("refractionMatrix",E.getRefractionTextureMatrix());let z=1;E.isCube||E.depth&&(z=E.depth);const X=E.getSize().width,b=this.volumeIndexOfRefraction;if(T.updateFloat4("vRefractionInfos",E.level,1/b,z,this._invertRefractionY?-1:1),T.updateFloat4("vRefractionMicrosurfaceInfos",X,E.lodGenerationScale,E.lodGenerationOffset,1/this.indexOfRefraction),u&&T.updateFloat2("vRefractionFilteringInfo",X,Math.log2(X)),E.boundingBoxSize){const z=E;T.updateVector3("vRefractionPosition",z.boundingBoxPosition),T.updateVector3("vRefractionSize",z.boundingBoxSize)}}this._isScatteringEnabled&&T.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),T.updateColor3("vDiffusionDistance",this.diffusionDistance),T.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),T.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),T.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),T.updateFloat("dispersion",this.dispersion)}z.texturesEnabled&&(this._thicknessTexture&&N.d.ThicknessTextureEnabled&&T.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&N.d.RefractionIntensityTextureEnabled&&F.SS_REFRACTIONINTENSITY_TEXTURE&&T.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&N.d.TranslucencyIntensityTextureEnabled&&F.SS_TRANSLUCENCYINTENSITY_TEXTURE&&T.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&N.d.TranslucencyColorTextureEnabled&&F.SS_TRANSLUCENCYCOLOR_TEXTURE&&T.setTexture("translucencyColorSampler",this._translucencyColorTexture),E&&N.d.RefractionTextureEnabled&&(y?T.setTexture("refractionSampler",E):(T.setTexture("refractionSampler",E._lodTextureMid||E),T.setTexture("refractionSamplerLow",E._lodTextureLow||E),T.setTexture("refractionSamplerHigh",E._lodTextureHigh||E))))}_getRefractionTexture(T){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?T.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(T){N.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&T.push(this._refractionTexture)}hasTexture(T){return this._thicknessTexture===T||(this._refractionTexture===T||(this._refractionIntensityTexture===T||(this._translucencyIntensityTexture===T||this._translucencyColorTexture===T)))}hasRenderTargetTextures(){return!!(N.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(T){this._thicknessTexture&&T.push(this._thicknessTexture),this._refractionTexture&&T.push(this._refractionTexture),this._translucencyColorTexture&&T.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&T.push(this._translucencyIntensityTexture)}getAnimatables(T){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&T.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&T.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&T.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&T.push(this._translucencyIntensityTexture)}dispose(T){T&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(T,z,X){return T.SS_SCATTERING&&z.addFallback(X++,"SS_SCATTERING"),T.SS_TRANSLUCENCY&&z.addFallback(X++,"SS_TRANSLUCENCY"),X}getSamplers(T){T.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"isRefractionEnabled",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"isTranslucencyEnabled",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"isDispersionEnabled",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markScenePrePassDirty")],O.prototype,"isScatteringEnabled",void 0),(0,b.c)([(0,F.E)()],O.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,b.c)([(0,F.E)()],O.prototype,"refractionIntensity",void 0),(0,b.c)([(0,F.E)()],O.prototype,"translucencyIntensity",void 0),(0,b.c)([(0,F.E)()],O.prototype,"useAlbedoToTintRefraction",void 0),(0,b.c)([(0,F.E)()],O.prototype,"useAlbedoToTintTranslucency",void 0),(0,b.c)([(0,F.x)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"thicknessTexture",void 0),(0,b.c)([(0,F.x)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"refractionTexture",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"indexOfRefraction",void 0),(0,b.c)([(0,F.E)()],O.prototype,"_volumeIndexOfRefraction",void 0),(0,b.c)([(0,F.b)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"volumeIndexOfRefraction",null),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"invertRefractionY",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"linkRefractionWithTransparency",void 0),(0,b.c)([(0,F.E)()],O.prototype,"minimumThickness",void 0),(0,b.c)([(0,F.E)()],O.prototype,"maximumThickness",void 0),(0,b.c)([(0,F.E)()],O.prototype,"useThicknessAsDepth",void 0),(0,b.c)([(0,F.k)()],O.prototype,"tintColor",void 0),(0,b.c)([(0,F.E)()],O.prototype,"tintColorAtDistance",void 0),(0,b.c)([(0,F.E)()],O.prototype,"dispersion",void 0),(0,b.c)([(0,F.k)()],O.prototype,"diffusionDistance",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"useMaskFromThicknessTexture",void 0),(0,b.c)([(0,F.x)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"refractionIntensityTexture",void 0),(0,b.c)([(0,F.x)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"translucencyIntensityTexture",void 0),(0,b.c)([(0,F.k)()],O.prototype,"translucencyColor",void 0),(0,b.c)([(0,F.x)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"translucencyColorTexture",void 0),(0,b.c)([(0,F.E)(),(0,F.b)("_markAllSubMeshesAsTexturesDirty")],O.prototype,"useGltfStyleTextures",void 0);var P=X(1339),W=X(1310),B=X(1355);const e={effect:null,subMesh:null};class R extends L.d{constructor(T){super(T),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class Y extends K.c{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(T){this._realTimeFiltering=T,this.Fe(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(T){this._realTimeFilteringQuality=T,this.Fe(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(T){T!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=T||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(T,z){super(T,z,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||Y.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new v.n(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=Y.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=U.b.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new U.b(0,0,0),this._albedoColor=new U.b(1,1,1),this._reflectivityColor=new U.b(1,1,1),this._reflectionColor=new U.b(1,1,1),this._emissiveColor=new U.b(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=Y.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new u.h(16),this._globalAmbientColor=new U.b(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new p(this),this.clearCoat=new V(this),this.iridescence=new G(this),this.anisotropy=new Z(this),this.sheen=new S(this),this.subSurface=new O(this),this.detailMap=new P.d(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),N.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,y.d)(this.va()),this.prePassConfiguration=new H.b}get hasRenderTargetTextures(){return!!(N.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var T;return this._transparencyMode===Y.PBRMATERIAL_OPAQUE||this._transparencyMode===Y.PBRMATERIAL_ALPHATEST||(null===(T=this.subSurface)||void 0===T?void 0:T.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var T;return!!this._forceAlphaTest||(null===(T=this.subSurface)||void 0===T||!T.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===Y.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.ld&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==Y.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.ld||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(T,z,X){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const b=z._drawWrapper;if(b.effect&&this.isFrozen&&b._wasPreviouslyReady&&b._wasPreviouslyUsingInstances===X)return!0;z.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),z.materialDefines=new R(this._eventInfo.defineNames));const F=z.materialDefines;if(this._isReadyForSubMesh(z))return!0;const u=this.va(),y=u.getEngine();if(F._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,u.texturesEnabled)){if(this._albedoTexture&&N.d.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&N.d.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&N.d.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const T=this._getReflectionTexture();if(T&&N.d.ReflectionTextureEnabled){if(!T.isReadyOrNotBlocking())return!1;var E;if(T.irradianceTexture){if(!T.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!T.sphericalPolynomial&&null!==(E=T.getInternalTexture())&&void 0!==E&&E._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&N.d.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&N.d.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(N.d.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(y.getCaps().standardDerivatives&&this._bumpTexture&&N.d.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&N.d.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=F,this._eventInfo.subMesh=z,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(F._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;y.getCaps().standardDerivatives||T.isVerticesDataPresent(k.e.NormalKind)||(T.createNormals(!0),A.e.Warn("PBRMaterial: Normals have been created for the mesh: "+T.name));const v=z.effect,L=F._areLightsDisposed;let D=this._prepareEffect(T,F,this.onCompiled,this.onError,X,null,z.getRenderingMesh().hasThinInstances),c=!1;if(D)if(this._onEffectCreatedObservable&&(e.effect=D,e.subMesh=z,this._onEffectCreatedObservable.notifyObservers(e)),this.allowShaderHotSwapping&&v&&!D.isReady()){if(D=v,F.markAsUnprocessed(),c=this.isFrozen,L)return F._areLightsDisposed=!0,!1}else u.resetCachedMaterial(),z.setEffect(D,F,this._materialContext);return!(!z.effect||!z.effect.isReady())&&(F._renderId=u.getRenderId(),b._wasPreviouslyReady=!c,b._wasPreviouslyUsingInstances=!!X,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(T,z){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(T,z,A,u,y),!z.isDirty)return null;z.markAsProcessed();const E=this.va().getEngine(),v=new l.d;let L=0;z.USESPHERICALINVERTEX&&v.addFallback(L++,"USESPHERICALINVERTEX"),z.FOG&&v.addFallback(L,"FOG"),z.SPECULARAA&&v.addFallback(L,"SPECULARAA"),z.POINTSIZE&&v.addFallback(L,"POINTSIZE"),z.LOGARITHMICDEPTH&&v.addFallback(L,"LOGARITHMICDEPTH"),z.PARALLAX&&v.addFallback(L,"PARALLAX"),z.PARALLAX_RHS&&v.addFallback(L,"PARALLAX_RHS"),z.PARALLAXOCCLUSION&&v.addFallback(L++,"PARALLAXOCCLUSION"),z.ENVIRONMENTBRDF&&v.addFallback(L++,"ENVIRONMENTBRDF"),z.TANGENT&&v.addFallback(L++,"TANGENT"),z.BUMP&&v.addFallback(L++,"BUMP"),L=(0,a.w)(z,v,this._maxSimultaneousLights,L++),z.SPECULARTERM&&v.addFallback(L++,"SPECULARTERM"),z.USESPHERICALFROMREFLECTIONMAP&&v.addFallback(L++,"USESPHERICALFROMREFLECTIONMAP"),z.USEIRRADIANCEMAP&&v.addFallback(L++,"USEIRRADIANCEMAP"),z.LIGHTMAP&&v.addFallback(L++,"LIGHTMAP"),z.NORMAL&&v.addFallback(L++,"NORMAL"),z.AMBIENT&&v.addFallback(L++,"AMBIENT"),z.EMISSIVE&&v.addFallback(L++,"EMISSIVE"),z.VERTEXCOLOR&&v.addFallback(L++,"VERTEXCOLOR"),z.MORPHTARGETS&&v.addFallback(L++,"MORPHTARGETS"),z.MULTIVIEW&&v.addFallback(0,"MULTIVIEW");const D=[k.e.PositionKind];z.NORMAL&&D.push(k.e.NormalKind),z.TANGENT&&D.push(k.e.TangentKind);for(let X=1;X<=6;++X)z["UV"+X]&&D.push(`uv${1===X?"":X}`);z.VERTEXCOLOR&&D.push(k.e.ColorKind),(0,a.B)(D,T,z,v),(0,a.D)(D,z),(0,a.H)(D,T,z),(0,a.z)(D,T,z);let c="pbr";const p=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],U=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],x=["Material","Scene","Mesh"],K={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:z.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=v,this._eventInfo.fallbackRank=L,this._eventInfo.defines=z,this._eventInfo.uniforms=p,this._eventInfo.attributes=D,this._eventInfo.samplers=U,this._eventInfo.uniformBuffersNames=x,this._eventInfo.customCode=void 0,this._eventInfo.mesh=T,this._eventInfo.indexParameters=K,this._callbackPluginEventGeneric(128,this._eventInfo),B.e.AddUniformsAndSamplers(p,U),H.b.AddUniforms(p),H.b.AddSamplers(U),(0,W.d)(p),s.c&&(s.c.PrepareUniforms(p,z),s.c.PrepareSamplers(U,z)),(0,a.ab)({uniformsNames:p,uniformBuffersNames:x,samplers:U,defines:z,maxSimultaneousLights:this._maxSimultaneousLights});const d={};this.customShaderNameResolve&&(c=this.customShaderNameResolve(c,p,x,U,z,D,d));const N=z.toString(),q=E.createEffect(c,{attributes:D,uniformsNames:p,uniformBuffersNames:x,samplers:U,defines:N,fallbacks:v,onCompiled:b,onError:F,indexParameters:K,processFinalCode:d.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:z.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([X.e(15),X.e(44)]).then(X.bind(X,13180)),Promise.all([X.e(16),X.e(45)]).then(X.bind(X,13193))]):await Promise.all([Promise.all([X.e(21),X.e(46)]).then(X.bind(X,13195)),Promise.all([X.e(23),X.e(47)]).then(X.bind(X,13205))]),this._shadersLoaded=!0}},E);return this._eventInfo.customCode=void 0,q}_prepareDefines(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const A=this.va(),u=A.getEngine();(0,a.O)(A,T,z,!0,this._maxSimultaneousLights,this._disableLighting),z._needNormals=!0,(0,a.V)(A,z);const y=this.needAlphaBlendingForMesh(T)&&this.va().useOrderIndependentTransparency;if((0,a.$)(A,z,this.canRenderToMRT&&!y),(0,a.X)(A,z,y),B.e.PrepareDefines(u.currentRenderPassId,T,z),z.METALLICWORKFLOW=this.isMetallicWorkflow(),z._areTexturesDirty){z._needUVs=!1;for(let T=1;T<=6;++T)z["MAINUV"+T]=!1;if(A.texturesEnabled){z.ALBEDODIRECTUV=0,z.AMBIENTDIRECTUV=0,z.OPACITYDIRECTUV=0,z.EMISSIVEDIRECTUV=0,z.REFLECTIVITYDIRECTUV=0,z.MICROSURFACEMAPDIRECTUV=0,z.METALLIC_REFLECTANCEDIRECTUV=0,z.REFLECTANCEDIRECTUV=0,z.BUMPDIRECTUV=0,z.LIGHTMAPDIRECTUV=0,u.getCaps().textureLOD&&(z.LODBASEDMICROSFURACE=!0),this._albedoTexture&&N.d.DiffuseTextureEnabled?((0,a.S)(this._albedoTexture,z,"ALBEDO"),z.GAMMAALBEDO=this._albedoTexture.gammaSpace):z.ALBEDO=!1,this._ambientTexture&&N.d.AmbientTextureEnabled?((0,a.S)(this._ambientTexture,z,"AMBIENT"),z.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):z.AMBIENT=!1,this._opacityTexture&&N.d.OpacityTextureEnabled?((0,a.S)(this._opacityTexture,z,"OPACITY"),z.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):z.OPACITY=!1;const T=this._getReflectionTexture();if(T&&N.d.ReflectionTextureEnabled){switch(z.REFLECTION=!0,z.GAMMAREFLECTION=T.gammaSpace,z.RGBDREFLECTION=T.isRGBD,z.LODINREFLECTIONALPHA=T.lodLevelInAlpha,z.LINEARSPECULARREFLECTION=T.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(z.NUM_SAMPLES=""+this.realTimeFilteringQuality,u._features.needTypeSuffixInShaderConstants&&(z.NUM_SAMPLES=z.NUM_SAMPLES+"u"),z.REALTIME_FILTERING=!0):z.REALTIME_FILTERING=!1,z.INVERTCUBICMAP=T.coordinatesMode===d.c.INVCUBIC_MODE,z.REFLECTIONMAP_3D=T.isCube,z.REFLECTIONMAP_OPPOSITEZ=z.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!T.invertZ:T.invertZ,z.REFLECTIONMAP_CUBIC=!1,z.REFLECTIONMAP_EXPLICIT=!1,z.REFLECTIONMAP_PLANAR=!1,z.REFLECTIONMAP_PROJECTION=!1,z.REFLECTIONMAP_SKYBOX=!1,z.REFLECTIONMAP_SPHERICAL=!1,z.REFLECTIONMAP_EQUIRECTANGULAR=!1,z.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,z.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,T.coordinatesMode){case d.c.EXPLICIT_MODE:z.REFLECTIONMAP_EXPLICIT=!0;break;case d.c.PLANAR_MODE:z.REFLECTIONMAP_PLANAR=!0;break;case d.c.PROJECTION_MODE:z.REFLECTIONMAP_PROJECTION=!0;break;case d.c.SKYBOX_MODE:z.REFLECTIONMAP_SKYBOX=!0;break;case d.c.SPHERICAL_MODE:z.REFLECTIONMAP_SPHERICAL=!0;break;case d.c.EQUIRECTANGULAR_MODE:z.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case d.c.FIXED_EQUIRECTANGULAR_MODE:z.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case d.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:z.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case d.c.CUBIC_MODE:case d.c.INVCUBIC_MODE:default:z.REFLECTIONMAP_CUBIC=!0,z.USE_LOCAL_REFLECTIONMAP_CUBIC=!!T.boundingBoxSize}T.coordinatesMode!==d.c.SKYBOX_MODE&&(T.irradianceTexture?(z.USEIRRADIANCEMAP=!0,z.USESPHERICALFROMREFLECTIONMAP=!1):T.isCube&&(z.USESPHERICALFROMREFLECTIONMAP=!0,z.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||u.getCaps().maxVaryingVectors<=8?z.USESPHERICALINVERTEX=!1:z.USESPHERICALINVERTEX=!0))}else z.REFLECTION=!1,z.REFLECTIONMAP_3D=!1,z.REFLECTIONMAP_SPHERICAL=!1,z.REFLECTIONMAP_PLANAR=!1,z.REFLECTIONMAP_CUBIC=!1,z.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,z.REFLECTIONMAP_PROJECTION=!1,z.REFLECTIONMAP_SKYBOX=!1,z.REFLECTIONMAP_EXPLICIT=!1,z.REFLECTIONMAP_EQUIRECTANGULAR=!1,z.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,z.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,z.INVERTCUBICMAP=!1,z.USESPHERICALFROMREFLECTIONMAP=!1,z.USEIRRADIANCEMAP=!1,z.USESPHERICALINVERTEX=!1,z.REFLECTIONMAP_OPPOSITEZ=!1,z.LODINREFLECTIONALPHA=!1,z.GAMMAREFLECTION=!1,z.RGBDREFLECTION=!1,z.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&N.d.LightmapTextureEnabled?((0,a.S)(this._lightmapTexture,z,"LIGHTMAP"),z.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,z.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,z.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):z.LIGHTMAP=!1,this._emissiveTexture&&N.d.EmissiveTextureEnabled?((0,a.S)(this._emissiveTexture,z,"EMISSIVE"),z.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):z.EMISSIVE=!1,N.d.SpecularTextureEnabled?(this._metallicTexture?((0,a.S)(this._metallicTexture,z,"REFLECTIVITY"),z.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,z.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,z.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,z.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,z.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,a.S)(this._reflectivityTexture,z,"REFLECTIVITY"),z.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,z.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,z.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):z.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(z.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,a.S)(this._metallicReflectanceTexture,z,"METALLIC_REFLECTANCE"),z.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):z.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,a.S)(this._reflectanceTexture,z,"REFLECTANCE"),z.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):z.REFLECTANCE=!1):(z.METALLIC_REFLECTANCE=!1,z.REFLECTANCE=!1),this._microSurfaceTexture?(0,a.S)(this._microSurfaceTexture,z,"MICROSURFACEMAP"):z.MICROSURFACEMAP=!1):(z.REFLECTIVITY=!1,z.MICROSURFACEMAP=!1),u.getCaps().standardDerivatives&&this._bumpTexture&&N.d.BumpTextureEnabled&&!this._disableBumpMap?((0,a.S)(this._bumpTexture,z,"BUMP"),this._useParallax&&this._albedoTexture&&N.d.DiffuseTextureEnabled?(z.PARALLAX=!0,z.PARALLAX_RHS=A.useRightHandedSystem,z.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):z.PARALLAX=!1,z.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(z.BUMP=!1,z.PARALLAX=!1,z.PARALLAX_RHS=!1,z.PARALLAXOCCLUSION=!1,z.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&N.d.ReflectionTextureEnabled?(z.ENVIRONMENTBRDF=!0,z.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(z.ENVIRONMENTBRDF=!1,z.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?z.ALPHAFROMALBEDO=!0:z.ALPHAFROMALBEDO=!1}z.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===Y.LIGHTFALLOFF_STANDARD?(z.USEPHYSICALLIGHTFALLOFF=!1,z.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===Y.LIGHTFALLOFF_GLTF?(z.USEPHYSICALLIGHTFALLOFF=!1,z.USEGLTFLIGHTFALLOFF=!0):(z.USEPHYSICALLIGHTFALLOFF=!0,z.USEGLTFLIGHTFALLOFF=!1),z.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Ke&&this._twoSidedLighting?z.TWOSIDEDLIGHTING=!0:z.TWOSIDEDLIGHTING=!1,z.SPECULARAA=u.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(z._areTexturesDirty||z._areMiscDirty)&&(z.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,z.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,z.ALPHABLEND=this.needAlphaBlendingForMesh(T),z.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,z.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),z._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(z),z.FORCENORMALFORWARD=this._forceNormalForward,z.RADIANCEOCCLUSION=this._useRadianceOcclusion,z.HORIZONOCCLUSION=this._useHorizonOcclusion,z._areMiscDirty&&((0,a.U)(T,A,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(T)||this._forceAlphaTest,z,this._applyDecalMapAfterDetailMap),z.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!T.isVerticesDataPresent(k.e.NormalKind),z.DEBUGMODE=this._debugMode),(0,a.L)(A,u,this,z,!!X,b,F),this._eventInfo.defines=z,this._eventInfo.mesh=T,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,a.K)(T,z,!0,!0,!0,this._transparencyMode!==Y.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(T,z,X){const b={clipPlane:!1,useInstances:!1,...X};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const X=new R(this._eventInfo.defineNames),F=this._prepareEffect(T,X,void 0,void 0,b.useInstances,b.clipPlane,T.hasThinInstances);this._onEffectCreatedObservable&&(e.effect=F,e.subMesh=null,this._onEffectCreatedObservable.notifyObservers(e)),F.isReady()?z&&z(this):F.onCompileObservable.add((()=>{z&&z(this)}))})()}buildUniformLayout(){const T=this._uniformBuffer;T.addUniform("vAlbedoInfos",2),T.addUniform("vAmbientInfos",4),T.addUniform("vOpacityInfos",2),T.addUniform("vEmissiveInfos",2),T.addUniform("vLightmapInfos",2),T.addUniform("vReflectivityInfos",3),T.addUniform("vMicroSurfaceSamplerInfos",2),T.addUniform("vReflectionInfos",2),T.addUniform("vReflectionFilteringInfo",2),T.addUniform("vReflectionPosition",3),T.addUniform("vReflectionSize",3),T.addUniform("vBumpInfos",3),T.addUniform("albedoMatrix",16),T.addUniform("ambientMatrix",16),T.addUniform("opacityMatrix",16),T.addUniform("emissiveMatrix",16),T.addUniform("lightmapMatrix",16),T.addUniform("reflectivityMatrix",16),T.addUniform("microSurfaceSamplerMatrix",16),T.addUniform("bumpMatrix",16),T.addUniform("vTangentSpaceParams",2),T.addUniform("reflectionMatrix",16),T.addUniform("vReflectionColor",3),T.addUniform("vAlbedoColor",4),T.addUniform("vLightingIntensity",4),T.addUniform("vReflectionMicrosurfaceInfos",3),T.addUniform("pointSize",1),T.addUniform("vReflectivityColor",4),T.addUniform("vEmissiveColor",3),T.addUniform("vAmbientColor",3),T.addUniform("vDebugMode",2),T.addUniform("vMetallicReflectanceFactors",4),T.addUniform("vMetallicReflectanceInfos",2),T.addUniform("metallicReflectanceMatrix",16),T.addUniform("vReflectanceInfos",2),T.addUniform("reflectanceMatrix",16),T.addUniform("vSphericalL00",3),T.addUniform("vSphericalL1_1",3),T.addUniform("vSphericalL10",3),T.addUniform("vSphericalL11",3),T.addUniform("vSphericalL2_2",3),T.addUniform("vSphericalL2_1",3),T.addUniform("vSphericalL20",3),T.addUniform("vSphericalL21",3),T.addUniform("vSphericalL22",3),T.addUniform("vSphericalX",3),T.addUniform("vSphericalY",3),T.addUniform("vSphericalZ",3),T.addUniform("vSphericalXX_ZZ",3),T.addUniform("vSphericalYY_ZZ",3),T.addUniform("vSphericalZZ",3),T.addUniform("vSphericalXY",3),T.addUniform("vSphericalYZ",3),T.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(T,z,X){const b=this.va(),F=X.materialDefines;if(!F)return;const A=X.effect;if(!A)return;this._activeEffect=A,z.getMeshUniformBuffer().bindToEffect(A,"Mesh"),z.transferToEffect(T);const u=b.getEngine();this._uniformBuffer.bindToEffect(A,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,b,z,T,this.isFrozen),B.e.Bind(u.currentRenderPassId,this._activeEffect,z,T),this._eventInfo.subMesh=X,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),F.OBJECTSPACE_NORMALMAP&&(T.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const y=this._mustRebind(b,A,X,z.visibility);(0,a.c)(z,this._activeEffect,this.prePassConfiguration);let v=null;const k=this._uniformBuffer;if(y){if(this.bindViewProjection(A),v=this._getReflectionTexture(),!k.useUbo||!this.isFrozen||!k.isSync||X._drawWrapper._forceRebindOnNextCall){var L;if(b.texturesEnabled){if(this._albedoTexture&&N.d.DiffuseTextureEnabled&&(k.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,a.s)(this._albedoTexture,k,"albedo")),this._ambientTexture&&N.d.AmbientTextureEnabled&&(k.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,a.s)(this._ambientTexture,k,"ambient")),this._opacityTexture&&N.d.OpacityTextureEnabled&&(k.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,a.s)(this._opacityTexture,k,"opacity")),v&&N.d.ReflectionTextureEnabled){if(k._d("reflectionMatrix",v.getReflectionTextureMatrix()),k.updateFloat2("vReflectionInfos",v.level,0),v.boundingBoxSize){const T=v;k.updateVector3("vReflectionPosition",T.boundingBoxPosition),k.updateVector3("vReflectionSize",T.boundingBoxSize)}if(this.realTimeFiltering){const T=v.getSize().width;k.updateFloat2("vReflectionFilteringInfo",T,Math.log2(T))}if(!F.USEIRRADIANCEMAP){const T=v.sphericalPolynomial;if(F.USESPHERICALFROMREFLECTIONMAP&&T)if(F.SPHERICAL_HARMONICS){const z=T.preScaledHarmonics;k.updateVector3("vSphericalL00",z.l00),k.updateVector3("vSphericalL1_1",z.l1_1),k.updateVector3("vSphericalL10",z.l10),k.updateVector3("vSphericalL11",z.l11),k.updateVector3("vSphericalL2_2",z.l2_2),k.updateVector3("vSphericalL2_1",z.l2_1),k.updateVector3("vSphericalL20",z.l20),k.updateVector3("vSphericalL21",z.l21),k.updateVector3("vSphericalL22",z.l22)}else k.updateFloat3("vSphericalX",T.x.x,T.x.y,T.x.z),k.updateFloat3("vSphericalY",T.y.x,T.y.y,T.y.z),k.updateFloat3("vSphericalZ",T.z.x,T.z.y,T.z.z),k.updateFloat3("vSphericalXX_ZZ",T.xx.x-T.zz.x,T.xx.y-T.zz.y,T.xx.z-T.zz.z),k.updateFloat3("vSphericalYY_ZZ",T.yy.x-T.zz.x,T.yy.y-T.zz.y,T.yy.z-T.zz.z),k.updateFloat3("vSphericalZZ",T.zz.x,T.zz.y,T.zz.z),k.updateFloat3("vSphericalXY",T.xy.x,T.xy.y,T.xy.z),k.updateFloat3("vSphericalYZ",T.yz.x,T.yz.y,T.yz.z),k.updateFloat3("vSphericalZX",T.zx.x,T.zx.y,T.zx.z)}k.updateFloat3("vReflectionMicrosurfaceInfos",v.getSize().width,v.lodGenerationScale,v.lodGenerationOffset)}this._emissiveTexture&&N.d.EmissiveTextureEnabled&&(k.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,a.s)(this._emissiveTexture,k,"emissive")),this._lightmapTexture&&N.d.LightmapTextureEnabled&&(k.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,a.s)(this._lightmapTexture,k,"lightmap")),N.d.SpecularTextureEnabled&&(this._metallicTexture?(k.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,a.s)(this._metallicTexture,k,"reflectivity")):this._reflectivityTexture&&(k.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,a.s)(this._reflectivityTexture,k,"reflectivity")),this._metallicReflectanceTexture&&(k.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,a.s)(this._metallicReflectanceTexture,k,"metallicReflectance")),this._reflectanceTexture&&F.REFLECTANCE&&(k.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,a.s)(this._reflectanceTexture,k,"reflectance")),this._microSurfaceTexture&&(k.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,a.s)(this._microSurfaceTexture,k,"microSurfaceSampler"))),this._bumpTexture&&u.getCaps().standardDerivatives&&N.d.BumpTextureEnabled&&!this._disableBumpMap&&(k.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,a.s)(this._bumpTexture,k,"bump"),b._mirroredCameraPosition?k.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):k.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&k.updateFloat("pointSize",this.pointSize),F.METALLICWORKFLOW){var D;U.h.Wd[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,U.h.Wd[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,k.updateColor4("vReflectivityColor",U.h.Wd[0],1);const T=(null===(D=this.subSurface)||void 0===D?void 0:D._indexOfRefraction)??1.5,z=1,X=Math.pow((T-z)/(T+z),2);this._metallicReflectanceColor.scaleToRef(X*this._metallicF0Factor,U.h.Wd[0]);const b=this._metallicF0Factor;k.updateColor4("vMetallicReflectanceFactors",U.h.Wd[0],b)}else k.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);k.updateColor3("vEmissiveColor",N.d.EmissiveTextureEnabled?this._emissiveColor:U.b.BlackReadOnly),k.updateColor3("vReflectionColor",this._reflectionColor),!F.SS_REFRACTION&&null!==(L=this.subSurface)&&void 0!==L&&L._linkRefractionWithTransparency?k.updateColor4("vAlbedoColor",this._albedoColor,1):k.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*b.environmentIntensity,this._lightingInfos.w=this._specularIntensity,k.updateVector4("vLightingIntensity",this._lightingInfos),b.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),k.updateColor3("vAmbientColor",this._globalAmbientColor),k.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}b.texturesEnabled&&(this._albedoTexture&&N.d.DiffuseTextureEnabled&&k.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&N.d.AmbientTextureEnabled&&k.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&N.d.OpacityTextureEnabled&&k.setTexture("opacitySampler",this._opacityTexture),v&&N.d.ReflectionTextureEnabled&&(F.LODBASEDMICROSFURACE?k.setTexture("reflectionSampler",v):(k.setTexture("reflectionSampler",v._lodTextureMid||v),k.setTexture("reflectionSamplerLow",v._lodTextureLow||v),k.setTexture("reflectionSamplerHigh",v._lodTextureHigh||v)),F.USEIRRADIANCEMAP&&k.setTexture("irradianceSampler",v.irradianceTexture)),F.ENVIRONMENTBRDF&&k.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&N.d.EmissiveTextureEnabled&&k.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&N.d.LightmapTextureEnabled&&k.setTexture("lightmapSampler",this._lightmapTexture),N.d.SpecularTextureEnabled&&(this._metallicTexture?k.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&k.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&k.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&F.REFLECTANCE&&k.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&k.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&u.getCaps().standardDerivatives&&N.d.BumpTextureEnabled&&!this._disableBumpMap&&k.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(z)&&this.va().depthPeelingRenderer.bind(A),this._eventInfo.subMesh=X,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,W.e)(this._activeEffect,this,b),this.bindEyePosition(A)}else b.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(y||!this.isFrozen){var c;if(b.lightsEnabled&&!this._disableLighting&&(0,a.h)(b,z,this._activeEffect,F,this._maxSimultaneousLights),(b.fogEnabled&&z.applyFog&&b.fogMode!==E.e.FOGMODE_NONE||v||this.subSurface.refractionTexture||z.receiveShadows||F.PREPASS)&&this.bindView(A),(0,a.d)(b,z,this._activeEffect,!0),F.NUM_MORPH_INFLUENCERS&&(0,a.m)(z,this._activeEffect),F.BAKED_VERTEX_ANIMATION_TEXTURE)null===(c=z.bakedVertexAnimationManager)||void 0===c||c.bind(A,F.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,a.l)(F,this._activeEffect,b)}this._afterBind(z,this._activeEffect,X),k.update()}getAnimatables(){const T=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&T.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&T.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&T.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&T.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&T.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?T.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&T.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&T.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&T.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&T.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&T.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&T.push(this._microSurfaceTexture),T}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const T=super.getActiveTextures();return this._albedoTexture&&T.push(this._albedoTexture),this._ambientTexture&&T.push(this._ambientTexture),this._opacityTexture&&T.push(this._opacityTexture),this._reflectionTexture&&T.push(this._reflectionTexture),this._emissiveTexture&&T.push(this._emissiveTexture),this._reflectivityTexture&&T.push(this._reflectivityTexture),this._metallicTexture&&T.push(this._metallicTexture),this._metallicReflectanceTexture&&T.push(this._metallicReflectanceTexture),this._reflectanceTexture&&T.push(this._reflectanceTexture),this._microSurfaceTexture&&T.push(this._microSurfaceTexture),this._bumpTexture&&T.push(this._bumpTexture),this._lightmapTexture&&T.push(this._lightmapTexture),T}hasTexture(T){return!!super.hasTexture(T)||(this._albedoTexture===T||(this._ambientTexture===T||(this._opacityTexture===T||(this._reflectionTexture===T||(this._emissiveTexture===T||(this._reflectivityTexture===T||(this._metallicTexture===T||(this._metallicReflectanceTexture===T||(this._reflectanceTexture===T||(this._microSurfaceTexture===T||(this._bumpTexture===T||this._lightmapTexture===T)))))))))))}setPrePassRenderer(){var T;if(null===(T=this.subSurface)||void 0===T||!T.isScatteringEnabled)return!1;const z=this.va().enableSubSurfaceForPrePass();return z&&(z.enabled=!0),!0}dispose(T,z){var X,b,F,A,u,y,E,v,k,L,D,c;(this._breakShaderLoadedCheck=!0,z)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(X=this._albedoTexture)||void 0===X||X.dispose(),null===(b=this._ambientTexture)||void 0===b||b.dispose(),null===(F=this._opacityTexture)||void 0===F||F.dispose(),null===(A=this._reflectionTexture)||void 0===A||A.dispose(),null===(u=this._emissiveTexture)||void 0===u||u.dispose(),null===(y=this._metallicTexture)||void 0===y||y.dispose(),null===(E=this._reflectivityTexture)||void 0===E||E.dispose(),null===(v=this._bumpTexture)||void 0===v||v.dispose(),null===(k=this._lightmapTexture)||void 0===k||k.dispose(),null===(L=this._metallicReflectanceTexture)||void 0===L||L.dispose(),null===(D=this._reflectanceTexture)||void 0===D||D.dispose(),null===(c=this._microSurfaceTexture)||void 0===c||c.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(T,z)}}Y.PBRMATERIAL_OPAQUE=x.d.MATERIAL_OPAQUE,Y.PBRMATERIAL_ALPHATEST=x.d.MATERIAL_ALPHATEST,Y.PBRMATERIAL_ALPHABLEND=x.d.MATERIAL_ALPHABLEND,Y.PBRMATERIAL_ALPHATESTANDBLEND=x.d.MATERIAL_ALPHATESTANDBLEND,Y.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,Y.LIGHTFALLOFF_PHYSICAL=0,Y.LIGHTFALLOFF_GLTF=1,Y.LIGHTFALLOFF_STANDARD=2,Y.ForceGLSL=!1,(0,b.c)([(0,F.r)()],Y.prototype,"_imageProcessingConfiguration",void 0),(0,b.c)([(0,F.b)("_markAllSubMeshesAsMiscDirty")],Y.prototype,"debugMode",void 0)},12530:(T,z,X)=>{"use strict";X.d(z,{e:()=>D});var b=X(952),F=X(957),A=X(1166),u=X(976),y=X(1021),E=X(949),v=X(993),k=X(968),L=X(1122);X(1510);class D extends y.b{set boundingBoxSize(T){if(this._boundingBoxSize&&this._boundingBoxSize.equals(T))return;this._boundingBoxSize=T;const z=this.va();z&&z.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(T){this._rotationY=T,this.setReflectionTextureMatrix(u.d.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(T,z,X){let b="";return T.forEach((T=>b+=T)),new D(b,z,null,X,T)}static CreateFromPrefilteredData(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const F=z.useDelayedTextureLoading;z.useDelayedTextureLoading=!1;const A=new D(T,z,null,!1,null,null,null,void 0,!0,X,b);return z.useDelayedTextureLoading=F,A}constructor(T,z){var X;let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,D=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,p=arguments.length>10&&void 0!==arguments[10]&&arguments[10],H=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,U=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,s=arguments.length>13?arguments[13]:void 0,x=arguments.length>14?arguments[14]:void 0;super(z),this.onLoadObservable=new k.d,this.boundingBoxPosition=u.j.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new u.d,this._buffer=null,this.name=T,this.url=T,this._noMipmap=F,this.ld=!1,this.isCube=!0,this._textureMatrix=u.d.Identity(),this.coordinatesMode=E.c.CUBIC_MODE;let K=null,d=null;null===b||Array.isArray(b)?(this._noMipmap=F,this._format=L,this._createPolynomials=p,K=b,this._loaderOptions=s,this._useSRGBBuffer=x,this._lodScale=H,this._lodOffset=U):(K=b.extensions??null,this._noMipmap=b.noMipmap??!1,A=b.files??null,d=b.buffer??null,this._format=b.format??5,D=b.prefiltered??!1,c=b.forcedExtension??null,this._createPolynomials=b.createPolynomials??!1,this._lodScale=b.lodScale??.8,this._lodOffset=b.lodOffset??0,this._loaderOptions=b.loaderOptions,this._useSRGBBuffer=b.useSRGBBuffer,y=b.X??null,v=b.onError??null),(T||A)&&this.updateURL(T,c,y,D,v,K,null===(X=this.va())||void 0===X?void 0:X.useDelayedTextureLoading,A,d)}getClassName(){return"CubeTexture"}updateURL(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=T),this.url=T,z&&(this._forcedExtension=z);const v=T.lastIndexOf("."),k=z||(v>-1?T.substring(v).toLowerCase():""),L=0===k.indexOf(".dds"),D=0===k.indexOf(".env"),c=0===k.indexOf(".basis");if(D?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=b,b&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),y)this._files=y;else if(c||D||L||A||(A=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,A){for(let z=0;z<A.length;z++)this._files.push(T+A[z]);this._extensions=A}this._buffer=E,u?(this.delayLoadState=4,this._delayedOnLoad=X,this._delayedOnError=F):this._loadTexture(X,F)}delayLoad(T){4===this.delayLoadState&&(T&&(this._forcedExtension=T),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(T){var z,X;if(T.updateFlag===this._textureMatrix.updateFlag)return;T.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(X=this.va())||void 0===X||X.markAllMaterialsAsDirty(1,(T=>-1!==T.getActiveTextures().indexOf(this))));if(this._textureMatrix=T,null===(z=this.va())||void 0===z||!z.useRightHandedSystem)return;const b=u.f.Id[0],F=u.f.Quaternion[0],A=u.f.Id[1];this._textureMatrix.decompose(b,F,A),F.z*=-1,F.w*=-1,u.d.ComposeToRef(b,F,A,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var T;return null!==(T=this.va())&&void 0!==T&&T.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const X=this.va(),b=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const F=()=>{var z;(this.onLoadObservable.notifyObservers(this),b)&&(b.dispose(),null===(z=this.va())||void 0===z||z.markAllMaterialsAsDirty(1));T&&T()},u=(T,X)=>{this._loadingError=!0,this._errorObject={message:T,exception:X},z&&z(T,X),E.c.OnTextureLoadErrorObservable.notifyObservers(this)};var y;this._texture?this._texture.isReady?A.g.SetImmediate((()=>F())):this._texture.onLoadedObservable.add((()=>F())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,X,this._lodScale,this._lodOffset,T,u,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,X,this._files,this._noMipmap,T,u,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(y=this._texture)||void 0===y||y.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(T,z,X){const b=L.b.Parse((()=>{let b=!1;return T.prefiltered&&(b=T.prefiltered),new D(X+(T.url??T.name),z,T.extensions,!1,T.files||null,null,null,void 0,b,T.forcedExtension)}),T,z);if(T.boundingBoxPosition&&(b.boundingBoxPosition=u.j.xd(T.boundingBoxPosition)),T.boundingBoxSize&&(b.boundingBoxSize=u.j.xd(T.boundingBoxSize)),T.animations)for(let F=0;F<T.animations.length;F++){const z=T.animations[F],X=(0,v.e)("BABYLON.Animation");X&&b.animations.push(X.Parse(z))}return b}clone(){let T=0;const z=L.b.Clone((()=>{const z=new D(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return T=z.uniqueId,z}),this);return z.uniqueId=T,z}}(0,b.c)([(0,F.E)()],D.prototype,"url",void 0),(0,b.c)([(0,F.C)()],D.prototype,"boundingBoxPosition",void 0),(0,b.c)([(0,F.C)()],D.prototype,"boundingBoxSize",null),(0,b.c)([(0,F.E)("rotationY")],D.prototype,"rotationY",null),(0,b.c)([(0,F.E)("files")],D.prototype,"_files",void 0),(0,b.c)([(0,F.E)("forcedExtension")],D.prototype,"_forcedExtension",void 0),(0,b.c)([(0,F.E)("extensions")],D.prototype,"_extensions",void 0),(0,b.c)([(0,F.s)("textureMatrix")],D.prototype,"_textureMatrix",void 0),(0,b.c)([(0,F.s)("textureMatrixRefraction")],D.prototype,"_textureMatrixRefraction",void 0),E.c._CubeTextureParser=D.Parse,(0,v.h)("BABYLON.CubeTexture",D)},12893:(T,z,X)=>{"use strict";X.d(z,{c:()=>E});var b=X(1065),F=X(949),A=X(1170),u=X(1381),y=X(1102);u.ThinEngine.prototype.createDynamicTexture=function(T,z,X,b){const F=new y.b(this,4);return F.baseWidth=T,F.baseHeight=z,X&&(T=this.needPOTTextures?(0,A.g)(T,this._caps.maxTextureSize):T,z=this.needPOTTextures?(0,A.g)(z,this._caps.maxTextureSize):z),F.width=T,F.height=z,F.isReady=!1,F.generateMipMaps=X,F.samplingMode=b,this.updateTextureSamplingMode(b,F),this._internalTexturesCache.push(F),F},u.ThinEngine.prototype.updateDynamicTexture=function(T,z,X){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4?arguments[4]:void 0,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!T)return;const u=this._gl,y=u.TEXTURE_2D,E=this._bindTextureDirectly(y,T,!0,A);this._unpackFlipY(void 0===X?T.invertY:X),b&&u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const v=this._getWebGLTextureType(T.type),k=this._getInternalFormat(F||T.format),L=this._getRGBABufferInternalSizedFormat(T.type,k);u.texImage2D(y,0,L,k,v,z),T.generateMipMaps&&u.generateMipmap(y),E||this._bindTextureDirectly(y,null),b&&u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),F&&(T.format=F),T._dynamicTextureSource=z,T._premulAlpha=b,T.invertY=X||!1,T.isReady=!0};class E extends F.c{constructor(T,z,X){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,y=arguments.length>6?arguments[6]:void 0;const E=!X||X._isScene;super(null,E?X:null===X||void 0===X?void 0:X.ve,E?!b:X,y,A,void 0,void 0,void 0,void 0,u),this.name=T,this.wrapU=F.c.CLAMP_ADDRESSMODE,this.wrapV=F.c.CLAMP_ADDRESSMODE,this._generateMipMaps=b;const v=this._getEngine();if(!v)return;if(z.getContext)this._canvas=z,this._ownCanvas=!1,this._texture=v.createDynamicTexture(this._canvas.width,this._canvas.height,b,A);else{this._canvas=v.createCanvas(1,1),this._ownCanvas=!0;const T=z;T.width||0===T.width?this._texture=v.createDynamicTexture(T.width,T.height,b,A):this._texture=v.createDynamicTexture(z,z,b,A)}const k=this.getSize();this._canvas.width!==k.width&&(this._canvas.width=k.width),this._canvas.height!==k.height&&(this._canvas.height=k.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(T){this._canvas.width=T.width,this._canvas.height=T.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(T.width,T.height,this._generateMipMaps,this.samplingMode)}scale(T){const z=this.getSize();z.width*=T,z.height*=T,this._recreate(z)}scaleTo(T,z){const X=this.getSize();X.width=T,X.height=z,this._recreate(X)}getContext(){return this._context}clear(T){const z=this.getSize();T&&(this._context.fillStyle=T),this._context.clearRect(0,0,z.width,z.height)}update(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===T||T,z,this._format||void 0,void 0,X)}drawText(T,z,X,b,F,A,u){let y=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const E=this.getSize();if(A&&(this._context.fillStyle=A,this._context.fillRect(0,0,E.width,E.height)),this._context.font=b,null===z||void 0===z){const X=this._context.measureText(T);z=(E.width-X.width)/2}if(null===X||void 0===X){const T=parseInt(b.replace(/\D/g,""));X=E.height/2+T/3.65}this._context.fillStyle=F||"",this._context.fillText(T,z,X),y&&this.update(u)}dispose(){var T,z;(super.dispose(),this._ownCanvas)&&(null===(T=this._canvas)||void 0===T||null===(z=T.remove)||void 0===z||z.call(T));this._canvas=null,this._context=null}clone(){const T=this.va();if(!T)return this;const z=this.getSize(),X=new E(this.name,z,T,this._generateMipMaps);return X.ld=this.ld,X.level=this.level,X.wrapU=this.wrapU,X.wrapV=this.wrapV,X}serialize(){const T=this.va();T&&!T.isReady()&&b.e.Warn("The scene must be ready before serializing the dynamic texture");const z=super.serialize();return E._IsCanvasElement(this._canvas)&&(z.base64String=this._canvas.toDataURL()),z.invertY=this._invertY,z.samplingMode=this.samplingMode,z}static _IsCanvasElement(T){return void 0!==T.toDataURL}_rebuild(){this.update()}}},12071:(T,z,X)=>{"use strict";X.d(z,{c:()=>F});var b=X(949);class F extends b.c{constructor(T,z,X,F,A){let u=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,k=arguments.length>9?arguments[9]:void 0,L=arguments.length>10?arguments[10]:void 0;super(null,A,!u,y,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,k),this.format=F,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==v||(E=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==v||(E=1),this._texture=this._engine.createRawTexture(T,z,X,F,u,y,E,null,v,k??0,L??!1),this.wrapU=b.c.CLAMP_ADDRESSMODE,this.wrapV=b.c.CLAMP_ADDRESSMODE)}update(T){this._getEngine().updateRawTexture(this._texture,T,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const T=new F(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return T._texture=this._texture,this._texture.incrementReferences(),T}static CreateLuminanceTexture(T,z,X,b){return new F(T,z,X,1,b,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(T,z,X,b){return new F(T,z,X,2,b,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(T,z,X,b){return new F(T,z,X,0,b,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(T,z,X,b){return new F(T,z,X,4,b,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(T,z,X,b){return new F(T,z,X,5,b,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(T,z,X,b){return new F(T,z,X,5,b,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(T,z,X,A){let u=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:b.c.TRILINEAR_SAMPLINGMODE;return new F(T,z,X,6,A,u,y,E,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(T,z,X,A){let u=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:b.c.TRILINEAR_SAMPLINGMODE;return new F(T,z,X,6,A,u,y,E,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11976:(T,z,X)=>{"use strict";X.d(z,{c:()=>u});var b=X(1271),F=X(1128),A=X(993);class u extends b.d{get Gg(){return this._subMaterials}set Gg(T){this._subMaterials=T,this._hookArray(T)}getChildren(){return this.Gg}constructor(T,z){super(T,z,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.Gg=[],this._storeEffectOnSubMeshes=!0}_hookArray(T){var z=this;const X=T.push;T.push=function(){for(var b=arguments.length,F=new Array(b),A=0;A<b;A++)F[A]=arguments[A];const u=X.apply(T,F);return z._markAllSubMeshesAsTexturesDirty(),u};const b=T.splice;T.splice=(z,X)=>{const F=b.apply(T,[z,X]);return this._markAllSubMeshesAsTexturesDirty(),F}}getSubMaterial(T){return T<0||T>=this.Gg.length?this.va().defaultMaterial:this.Gg[T]}getActiveTextures(){return super.getActiveTextures().concat(...this.Gg.map((T=>T?T.getActiveTextures():[])))}hasTexture(T){if(super.hasTexture(T))return!0;for(let X=0;X<this.Gg.length;X++){var z;if(null!==(z=this.Gg[X])&&void 0!==z&&z.hasTexture(T))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(T,z,X){for(let b=0;b<this.Gg.length;b++){const F=this.Gg[b];if(F){if(F._storeEffectOnSubMeshes){if(!F.isReadyForSubMesh(T,z,X))return!1;continue}if(!F.isReady(T))return!1}}return!0}clone(T,z){const X=new u(T,this.va());for(let b=0;b<this.Gg.length;b++){let F=null;const A=this.Gg[b];F=z&&A?A.clone(T+"-"+A.name):this.Gg[b],X.Gg.push(F)}return X}serialize(){const T={};T.name=this.name,T.id=this.id,T.uniqueId=this.uniqueId,F.e&&(T.tags=F.e.GetTags(this)),T.materialsUniqueIds=[],T.materials=[];for(let z=0;z<this.Gg.length;z++){const X=this.Gg[z];X?(T.materialsUniqueIds.push(X.uniqueId),T.materials.push(X.id)):(T.materialsUniqueIds.push(null),T.materials.push(null))}return T}dispose(T,z,X){const b=this.va();if(!b)return;if(X)for(let A=0;A<this.Gg.length;A++){const X=this.Gg[A];X&&X.dispose(T,z)}const F=b.multiMaterials.indexOf(this);F>=0&&b.multiMaterials.splice(F,1),super.dispose(T,z)}static ParseMultiMaterial(T,z){const X=new u(T.name,z);return X.id=T.id,X._loadedUniqueId=T.uniqueId,F.e&&F.e.AddTagsTo(X,T.tags),T.materialsUniqueIds?X._waitingSubMaterialsUniqueIds=T.materialsUniqueIds:T.materials.forEach((T=>X.Gg.push(z.getLastMaterialById(T)))),X}}(0,A.h)("BABYLON.MultiMaterial",u)},11978:(T,z,X)=>{"use strict";X.d(z,{b:()=>k,f:()=>v});var b=X(976),F=X(1132),A=X(11933),u=X(11955),y=X(1141);X(11983);function E(T){let z=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const X=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],A=[];let E=[];const v=T.width||T.size||1,k=T.height||T.size||1,L=T.depth||T.size||1,D=T.wrap||!1;let c=void 0===T.topBaseAt?1:T.topBaseAt,p=void 0===T.bottomBaseAt?0:T.bottomBaseAt;c=(c+4)%4,p=(p+4)%4;let H=[2,0,3,1][c],U=[2,0,1,3][p],s=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(D){z=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],s=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let T=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],X=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const b=[17,18,19,16],F=[22,23,20,21];for(;H>0;)T.unshift(T.pop()),b.unshift(b.pop()),H--;for(;U>0;)X.unshift(X.pop()),F.unshift(F.pop()),U--;T=T.flat(),X=X.flat(),s=s.concat(T).concat(X),z.push(b[0],b[2],b[3],b[0],b[1],b[2]),z.push(F[0],F[2],F[3],F[0],F[1],F[2])}const x=[v/2,k/2,L/2];E=s.reduce(((T,z,X)=>T.concat(z*x[X%3])),[]);const K=0===T.sideOrientation?0:T.sideOrientation||u.e.DEFAULTSIDE,d=T.faceUV||new Array(6),N=T.faceColors,l=[];for(let u=0;u<6;u++)void 0===d[u]&&(d[u]=new b.n(0,0,1,1)),N&&void 0===N[u]&&(N[u]=new F.d(1,1,1,1));for(let b=0;b<6;b++)if(A.push(d[b].z,y.c?1-d[b].w:d[b].w),A.push(d[b].x,y.c?1-d[b].w:d[b].w),A.push(d[b].x,y.c?1-d[b].y:d[b].y),A.push(d[b].z,y.c?1-d[b].y:d[b].y),N)for(let T=0;T<4;T++)l.push(N[b].r,N[b].g,N[b].b,N[b].a);u.e._ComputeSides(K,E,z,X,A,T.frontUVs,T.backUVs);const a=new u.e;if(a.indices=z,a.xa=E,a.ya=X,a.Aa=A,N){const T=K===u.e.DOUBLESIDE?l.concat(l):l;a.za=T}return a}function v(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new A.e(T,X);z.sideOrientation=A.e._GetDefaultSideOrientation(z.sideOrientation),b._originalBuilderSideOrientation=z.sideOrientation;return E(z).Ca(b,z.updatable),b}const k={CreateBox:v};u.e.CreateBox=E,A.e.CreateBox=function(T,z){return v(T,{size:z,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12092:(T,z,X)=>{"use strict";X.d(z,{e:()=>y});var b=X(11933),F=X(11955),A=X(1141);function u(T){const z=[],X=[],b=[],u=[],y=T.i||.5,E=T.dl||64,v=T.arc&&(T.arc<=0||T.arc>1)?1:T.arc||1,k=0===T.sideOrientation?0:T.sideOrientation||F.e.DEFAULTSIDE;z.push(0,0,0),u.push(.5,.5);const L=2*Math.PI*v,D=1===v?L/E:L/(E-1);let c=0;for(let F=0;F<E;F++){const T=Math.cos(c),X=Math.sin(c),b=(T+1)/2,F=(1-X)/2;z.push(y*T,y*X,0),u.push(b,A.c?1-F:F),c+=D}1===v&&(z.push(z[3],z[4],z[5]),u.push(u[2],A.c?1-u[3]:u[3]));const p=z.length/3;for(let F=1;F<p-1;F++)X.push(F+1,0,F);F.e.ComputeNormals(z,X,b),F.e._ComputeSides(k,z,X,b,u,T.frontUVs,T.backUVs);const H=new F.e;return H.indices=X,H.xa=z,H.ya=b,H.Aa=u,H}function y(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new b.e(T,X);z.sideOrientation=b.e._GetDefaultSideOrientation(z.sideOrientation),F._originalBuilderSideOrientation=z.sideOrientation;return u(z).Ca(F,z.updatable),F}F.e.kb=u,b.e.kb=function(T,z,X){return y(T,{i:z,dl:X,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11983:(T,z,X)=>{"use strict";X.d(z,{d:()=>U,b:()=>x,e:()=>s});var b=X(976),F=X(1132),A=X(11933),u=X(11955),y=X(1207);A.e._GroundMeshParser=(T,z)=>E.Parse(T,z);class E extends A.e{constructor(T,z){super(T,z),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=T,this._subdivisionsY=T,this.subdivide(T);const X=this;X.createOrUpdateSubmeshesOctree&&X.createOrUpdateSubmeshesOctree(z)}getHeightAtCoordinates(T,z){const X=this.getWorldMatrix(),F=b.f.Matrix[5];X.invertToRef(F);const A=b.f.Id[8];if(b.j.TransformCoordinatesFromFloatsToRef(T,0,z,F,A),T=A.x,z=A.z,T<this._minX||T>=this._maxX||z<=this._minZ||z>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const u=this._getFacetAt(T,z),y=-(u.x*T+u.z*z+u.w)/u.y;return b.j.TransformCoordinatesFromFloatsToRef(0,y,0,X,A),A.y}getNormalAtCoordinates(T,z){const X=new b.j(0,1,0);return this.getNormalAtCoordinatesToRef(T,z,X),X}getNormalAtCoordinatesToRef(T,z,X){const F=this.getWorldMatrix(),A=b.f.Matrix[5];F.invertToRef(A);const u=b.f.Id[8];if(b.j.TransformCoordinatesFromFloatsToRef(T,0,z,A,u),T=u.x,z=u.z,T<this._minX||T>this._maxX||z<this._minZ||z>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const y=this._getFacetAt(T,z);return b.j.TransformNormalFromFloatsToRef(y.x,y.y,y.z,F,X),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(T,z){const X=Math.floor((T+this._maxX)*this._subdivisionsX/this._width),b=Math.floor(-(z+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),F=this._heightQuads[b*this._subdivisionsX+X];let A;return A=z<F.slope.x*T+F.slope.y?F.facet1:F.facet2,A}_initHeightQuads(){const T=this._subdivisionsX,z=this._subdivisionsY;this._heightQuads=new Array;for(let X=0;X<z;X++)for(let z=0;z<T;z++){const F={slope:b.i.Zero(),facet1:new b.n(0,0,0,0),facet2:new b.n(0,0,0,0)};this._heightQuads[X*T+z]=F}return this}_computeHeightQuads(){const T=this.getVerticesData(y.e.PositionKind);if(!T)return this;const z=b.f.Id[3],X=b.f.Id[2],F=b.f.Id[1],A=b.f.Id[0],u=b.f.Id[4],E=b.f.Id[5],v=b.f.Id[6],k=b.f.Id[7],L=b.f.Id[8];let D=0,c=0,p=0,H=0,U=0,s=0,x=0;const K=this._subdivisionsX,d=this._subdivisionsY;for(let y=0;y<d;y++)for(let d=0;d<K;d++){D=3*d,c=y*(K+1)*3,p=(y+1)*(K+1)*3,z.x=T[c+D],z.y=T[c+D+1],z.z=T[c+D+2],X.x=T[c+D+3],X.y=T[c+D+4],X.z=T[c+D+5],F.x=T[p+D],F.y=T[p+D+1],F.z=T[p+D+2],A.x=T[p+D+3],A.y=T[p+D+4],A.z=T[p+D+5],H=(A.z-z.z)/(A.x-z.x),U=z.z-H*z.x,X.subtractToRef(z,u),F.subtractToRef(z,E),A.subtractToRef(z,v),b.j.CrossToRef(v,E,k),b.j.CrossToRef(u,v,L),k.normalize(),L.normalize(),s=-(k.x*z.x+k.y*z.y+k.z*z.z),x=-(L.x*X.x+L.y*X.y+L.z*X.z);const N=this._heightQuads[y*K+d];N.slope.Cd(H,U),N.facet1.Cd(k.x,k.y,k.z,s),N.facet2.Cd(L.x,L.y,L.z,x)}return this}serialize(T){super.serialize(T),T.subdivisionsX=this._subdivisionsX,T.subdivisionsY=this._subdivisionsY,T.minX=this._minX,T.maxX=this._maxX,T.qj=this._minZ,T.maxZ=this._maxZ,T.width=this._width,T.height=this._height}static Parse(T,z){const X=new E(T.name,z);return X._subdivisionsX=T.subdivisionsX||1,X._subdivisionsY=T.subdivisionsY||1,X._minX=T.minX,X._maxX=T.maxX,X._minZ=T.qj,X._maxZ=T.maxZ,X._width=T.width,X._height=T.height,X}}var v=X(1166),k=X(1007),L=X(979),D=X(1141);function c(T){const z=[],X=[],F=[],A=[];let y,E;const v=T.width||T.size||1,k=T.height||T.size||1,L=0|(T.subdivisionsX||T.subdivisions||1),c=0|(T.subdivisionsY||T.subdivisions||1);for(y=0;y<=c;y++)for(E=0;E<=L;E++){const T=new b.j(E*v/L-v/2,0,(c-y)*k/c-k/2),z=new b.j(0,1,0);X.push(T.x,T.y,T.z),F.push(z.x,z.y,z.z),A.push(E/L,D.c?y/c:1-y/c)}for(y=0;y<c;y++)for(E=0;E<L;E++)z.push(E+1+(y+1)*(L+1)),z.push(E+1+y*(L+1)),z.push(E+y*(L+1)),z.push(E+(y+1)*(L+1)),z.push(E+1+(y+1)*(L+1)),z.push(E+y*(L+1));const p=new u.e;return p.indices=z,p.xa=X,p.ya=F,p.Aa=A,p}function p(T){const z=void 0!==T.xmin&&null!==T.xmin?T.xmin:-1,X=void 0!==T.zmin&&null!==T.zmin?T.zmin:-1,F=void 0!==T.xmax&&null!==T.xmax?T.xmax:1,A=void 0!==T.zmax&&null!==T.zmax?T.zmax:1,y=T.subdivisions||{w:1,h:1},E=T.precision||{w:1,h:1},v=[],k=[],L=[],D=[];let c,p,H,U;y.h=y.h<1?1:y.h,y.w=y.w<1?1:y.w,E.w=E.w<1?1:E.w,E.h=E.h<1?1:E.h;const s=(F-z)/y.w,x=(A-X)/y.h;function K(T,z,X,F){const A=k.length/3,u=E.w+1;for(c=0;c<E.h;c++)for(p=0;p<E.w;p++){const T=[A+p+c*u,A+(p+1)+c*u,A+(p+1)+(c+1)*u,A+p+(c+1)*u];v.push(T[1]),v.push(T[2]),v.push(T[3]),v.push(T[0]),v.push(T[1]),v.push(T[3])}const y=b.j.Zero(),H=new b.j(0,1,0);for(c=0;c<=E.h;c++)for(y.z=c*(F-z)/E.h+z,p=0;p<=E.w;p++)y.x=p*(X-T)/E.w+T,y.y=0,k.push(y.x,y.y,y.z),L.push(H.x,H.y,H.z),D.push(p/E.w,c/E.h)}for(H=0;H<y.h;H++)for(U=0;U<y.w;U++)K(z+U*s,X+H*x,z+(U+1)*s,X+(H+1)*x);const d=new u.e;return d.indices=v,d.xa=k,d.ya=L,d.Aa=D,d}function H(T){const z=[],X=[],A=[],y=[];let E,v;const k=T.colorFilter||new F.b(.3,.59,.11),D=T.alphaFilter||0;let c=!1;if(T.minHeight>T.maxHeight){c=!0;const z=T.maxHeight;T.maxHeight=T.minHeight,T.minHeight=z}for(E=0;E<=T.subdivisions;E++)for(v=0;v<=T.subdivisions;v++){const z=new b.j(v*T.width/T.subdivisions-T.width/2,0,(T.subdivisions-E)*T.height/T.subdivisions-T.height/2),F=4*(((z.x+T.width/2)/T.width*(T.bufferWidth-1)|0)+((1-(z.z+T.height/2)/T.height)*(T.bufferHeight-1)|0)*T.bufferWidth);let u=T.buffer[F]/255,p=T.buffer[F+1]/255,H=T.buffer[F+2]/255;const U=T.buffer[F+3]/255;c&&(u=1-u,p=1-p,H=1-H);const s=u*k.r+p*k.g+H*k.b;z.y=U>=D?T.minHeight+(T.maxHeight-T.minHeight)*s:T.minHeight-L.e,T.heightBuffer&&(T.heightBuffer[E*(T.subdivisions+1)+v]=z.y),X.push(z.x,z.y,z.z),A.push(0,0,0),y.push(v/T.subdivisions,1-E/T.subdivisions)}for(E=0;E<T.subdivisions;E++)for(v=0;v<T.subdivisions;v++){const b=v+1+(E+1)*(T.subdivisions+1),F=v+1+E*(T.subdivisions+1),A=v+E*(T.subdivisions+1),u=v+(E+1)*(T.subdivisions+1),y=X[3*b+1]>=T.minHeight,k=X[3*F+1]>=T.minHeight,L=X[3*A+1]>=T.minHeight;y&&k&&L&&(z.push(b),z.push(F),z.push(A));X[3*u+1]>=T.minHeight&&y&&L&&(z.push(u),z.push(b),z.push(A))}u.e.ComputeNormals(X,z,A);const p=new u.e;return p.indices=z,p.xa=X,p.ya=A,p.Aa=y,p}function U(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const X=new E(T,arguments.length>2?arguments[2]:void 0);X._setReady(!1),X._subdivisionsX=z.subdivisionsX||z.subdivisions||1,X._subdivisionsY=z.subdivisionsY||z.subdivisions||1,X._width=z.width||1,X._height=z.height||1,X._maxX=X._width/2,X._maxZ=X._height/2,X._minX=-X._maxX,X._minZ=-X._maxZ;return c(z).Ca(X,z.updatable),X._setReady(!0),X}function s(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new A.e(T,X);return p(z).Ca(b,z.updatable),b}function x(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const A=X.width||10,u=X.height||10,y=X.subdivisions||1,L=X.minHeight||0,D=X.maxHeight||1,c=X.colorFilter||new F.b(.3,.59,.11),p=X.alphaFilter||0,U=X.updatable,s=X.onReady;b=b||k.e.LastCreatedScene;const x=new E(T,b);let K;x._subdivisionsX=y,x._subdivisionsY=y,x._width=A,x._height=u,x._maxX=x._width/2,x._maxZ=x._height/2,x._minX=-x._maxX,x._minZ=-x._maxZ,x._setReady(!1),X.passHeightBufferInCallback&&(K=new Float32Array((y+1)*(y+1)));const d=(T,z,X)=>{H({width:A,height:u,subdivisions:y,minHeight:L,maxHeight:D,colorFilter:c,buffer:T,bufferWidth:z,bufferHeight:X,alphaFilter:p,heightBuffer:K}).Ca(x,U),s&&s(x,K),x._setReady(!0)};if("string"===typeof z){const T=T=>{var z;const X=T.width,F=T.height;if(b.u)return;const A=null===(z=b)||void 0===z?void 0:z.getEngine().resizeImageBitmap(T,X,F);d(A,X,F)};v.g.LoadImage(z,T,X.onError?X.onError:()=>{},b.offlineProvider)}else d(z.data,z.width,z.height);return x}u.e.CreateGround=c,u.e.CreateTiledGround=p,u.e.CreateGroundFromHeightMap=H,A.e.CreateGround=(T,z,X,b,F,A)=>U(T,{width:z,height:X,subdivisions:b,updatable:A},F),A.e.CreateTiledGround=(T,z,X,b,F,A,u,y,E)=>s(T,{xmin:z,zmin:X,xmax:b,zmax:F,subdivisions:A,precision:u,updatable:E},y),A.e.CreateGroundFromHeightMap=(T,z,X,b,F,A,u,y,E,v,k)=>x(T,z,{width:X,height:b,subdivisions:F,minHeight:A,maxHeight:u,updatable:E,onReady:v,alphaFilter:k},y)},12890:(T,z,X)=>{"use strict";X.d(z,{c:()=>Z,d:()=>G,h:()=>j});var b=X(976),F=X(11933),A=X(11955),u=X(1132),y=X(1207),E=X(12515),v=X(1271),k=X(1122),L=X(1159),D=X(949),c=X(993),p=X(1334),H=X(1032),U=X(1326),s=X(1007),x=X(1310),K=X(1305);const d={effect:null,subMesh:null};class N extends U.c{constructor(T,z,X){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(T,z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new b.d,this._cachedWorldViewProjectionMatrix=new b.d,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=X,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","Jd","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...F}}get shaderPath(){return this._shaderPath}set shaderPath(T){this._shaderPath=T}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(T){-1===this._options.uniforms.indexOf(T)&&this._options.uniforms.push(T)}setTexture(T,z){return-1===this._options.samplers.indexOf(T)&&this._options.samplers.push(T),this._textures[T]=z,this}removeTexture(T){delete this._textures[T]}setTextureArray(T,z){return-1===this._options.samplers.indexOf(T)&&this._options.samplers.push(T),this._checkUniform(T),this._textureArrays[T]=z,this}setExternalTexture(T,z){return-1===this._options.externalTextures.indexOf(T)&&this._options.externalTextures.push(T),this._externalTextures[T]=z,this}setFloat(T,z){return this._checkUniform(T),this._floats[T]=z,this}setInt(T,z){return this._checkUniform(T),this._ints[T]=z,this}setUInt(T,z){return this._checkUniform(T),this._uints[T]=z,this}setFloats(T,z){return this._checkUniform(T),this._floatsArrays[T]=z,this}setColor3(T,z){return this._checkUniform(T),this._colors3[T]=z,this}setColor3Array(T,z){return this._checkUniform(T),this._colors3Arrays[T]=z.reduce(((T,z)=>(z.toArray(T,T.length),T)),[]),this}setColor4(T,z){return this._checkUniform(T),this._colors4[T]=z,this}setColor4Array(T,z){return this._checkUniform(T),this._colors4Arrays[T]=z.reduce(((T,z)=>(z.toArray(T,T.length),T)),[]),this}setVector2(T,z){return this._checkUniform(T),this._vectors2[T]=z,this}setVector3(T,z){return this._checkUniform(T),this._vectors3[T]=z,this}setVector4(T,z){return this._checkUniform(T),this._vectors4[T]=z,this}setQuaternion(T,z){return this._checkUniform(T),this._quaternions[T]=z,this}setQuaternionArray(T,z){return this._checkUniform(T),this._quaternionsArrays[T]=z.reduce(((T,z)=>(z.toArray(T,T.length),T)),[]),this}setMatrix(T,z){return this._checkUniform(T),this._matrices[T]=z,this}setMatrices(T,z){this._checkUniform(T);const X=new Float32Array(16*z.length);for(let b=0;b<z.length;b++){z[b].copyToArray(X,16*b)}return this._matrixArrays[T]=X,this}setMatrix3x3(T,z){return this._checkUniform(T),this._matrices3x3[T]=z,this}setMatrix2x2(T,z){return this._checkUniform(T),this._matrices2x2[T]=z,this}setArray2(T,z){return this._checkUniform(T),this._vectors2Arrays[T]=z,this}setArray3(T,z){return this._checkUniform(T),this._vectors3Arrays[T]=z,this}setArray4(T,z){return this._checkUniform(T),this._vectors4Arrays[T]=z,this}setUniformBuffer(T,z){return-1===this._options.uniformBuffers.indexOf(T)&&this._options.uniformBuffers.push(T),this._uniformBuffers[T]=z,this}setTextureSampler(T,z){return-1===this._options.samplerObjects.indexOf(T)&&this._options.samplerObjects.push(T),this._textureSamplers[T]=z,this}setStorageBuffer(T,z){return-1===this._options.storageBuffers.indexOf(T)&&this._options.storageBuffers.push(T),this._storageBuffers[T]=z,this}setDefine(T,z){const X=T.trimEnd()+" ",b=this.options.defines.findIndex((z=>z===T||z.startsWith(X)));return b>=0&&this.options.defines.splice(b,1),("boolean"!==typeof z||z)&&this.options.defines.push(X+z),this}isReadyForSubMesh(T,z,X){return this.isReady(T,X,z)}isReady(T,z,X){var b;const F=X&&this._storeEffectOnSubMeshes;if(this.isFrozen){const T=F?X._drawWrapper:this._drawWrapper;if(T.effect&&T._wasPreviouslyReady&&T._wasPreviouslyUsingInstances===z)return!0}const A=this.va(),u=A.getEngine(),E=[],v=[],k=new p.d;let D=this._shaderPath,c=this._options.uniforms,H=this._options.uniformBuffers,U=this._options.samplers;u.getCaps().multiview&&A.activeCamera&&A.activeCamera.outputRenderTarget&&A.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,E.push("#define MULTIVIEW"),-1!==c.indexOf("viewProjection")&&-1===c.indexOf("viewProjectionR")&&c.push("viewProjectionR"));for(let y=0;y<this._options.defines.length;y++){const T=0===this._options.defines[y].indexOf("#define")?this._options.defines[y]:`#define ${this._options.defines[y]}`;E.push(T)}for(let y=0;y<this._options.attributes.length;y++)v.push(this._options.attributes[y]);if(T&&T.isVerticesDataPresent(y.e.ColorKind)&&(-1===v.indexOf(y.e.ColorKind)&&v.push(y.e.ColorKind),E.push("#define VERTEXCOLOR")),z&&(E.push("#define INSTANCES"),(0,K.bb)(v,this._materialHelperNeedsPreviousMatrices),null!==T&&void 0!==T&&T.hasThinInstances&&(E.push("#define THIN_INSTANCES"),T&&T.isVerticesDataPresent(y.e.ColorInstanceKind)&&(v.push(y.e.ColorInstanceKind),E.push("#define INSTANCESCOLOR")))),T&&T.useBones&&T.computeBonesUsingShaders&&T.skeleton){v.push(y.e.MatricesIndicesKind),v.push(y.e.MatricesWeightsKind),T.numBoneInfluencers>4&&(v.push(y.e.MatricesIndicesExtraKind),v.push(y.e.MatricesWeightsExtraKind));const z=T.skeleton;E.push("#define NUM_BONE_INFLUENCERS "+T.numBoneInfluencers),k.addCPUSkinningFallback(0,T),z.isUsingTextureForMatrices?(E.push("#define BONETEXTURE"),-1===c.indexOf("boneTextureWidth")&&c.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(E.push("#define BonesPerMesh "+(z.bones.length+1)),-1===c.indexOf("mBones")&&c.push("mBones"))}else E.push("#define NUM_BONE_INFLUENCERS 0");let s=0;const N=T?T.morphTargetManager:null;if(N){const T=N.supportsUVs&&-1!==E.indexOf("#define UV1"),z=N.supportsTangents&&-1!==E.indexOf("#define TANGENT"),X=N.supportsNormals&&-1!==E.indexOf("#define NORMAL");s=N.numMaxInfluencers||N.numInfluencers,T&&E.push("#define MORPHTARGETS_UV"),z&&E.push("#define MORPHTARGETS_TANGENT"),X&&E.push("#define MORPHTARGETS_NORMAL"),s>0&&E.push("#define MORPHTARGETS"),N.isUsingTextureForTargets&&(E.push("#define MORPHTARGETS_TEXTURE"),-1===c.indexOf("morphTargetTextureIndices")&&c.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),E.push("#define NUM_MORPH_INFLUENCERS "+s);for(let b=0;b<s;b++)v.push(y.e.PositionKind+b),X&&v.push(y.e.NormalKind+b),z&&v.push(y.e.TangentKind+b),T&&v.push(y.e.UVKind+"_"+b);s>0&&(c=c.slice(),c.push("morphTargetInfluences"),c.push("morphTargetCount"),c.push("morphTargetTextureInfo"),c.push("morphTargetTextureIndices"))}else E.push("#define NUM_MORPH_INFLUENCERS 0");if(T){const z=T.bakedVertexAnimationManager;z&&z.isEnabled&&(E.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===c.indexOf("bakedVertexAnimationSettings")&&c.push("bakedVertexAnimationSettings"),-1===c.indexOf("bakedVertexAnimationTextureSizeInverted")&&c.push("bakedVertexAnimationTextureSizeInverted"),-1===c.indexOf("bakedVertexAnimationTime")&&c.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,K.z)(v,T,E)}for(const y in this._textures)if(!this._textures[y].isReady())return!1;T&&this._shouldTurnAlphaTestOn(T)&&E.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,x.d)(c),(0,x.j)(this,A,E)),A.fogEnabled&&null!==T&&void 0!==T&&T.applyFog&&A.fogMode!==L.e.FOGMODE_NONE&&(E.push("#define FOG"),-1===c.indexOf("view")&&c.push("view"),-1===c.indexOf("vFogInfos")&&c.push("vFogInfos"),-1===c.indexOf("vFogColor")&&c.push("vFogColor")),this._useLogarithmicDepth&&(E.push("#define LOGARITHMICDEPTH"),-1===c.indexOf("logarithmicDepthConstant")&&c.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(c=c.slice(),H=H.slice(),U=U.slice(),D=this.customShaderNameResolve(this.name,c,H,U,E,v));const l=F?X._getDrawWrapper(void 0,!0):this._drawWrapper,a=(null===l||void 0===l?void 0:l.effect)??null,q=(null===l||void 0===l?void 0:l.defines)??null,V=E.join("\n");let C=a;return q!==V&&(C=u.createEffect(D,{attributes:v,uniformsNames:c,uniformBuffersNames:H,samplers:U,defines:V,fallbacks:k,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:s},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},u),F?X.setEffect(C,V,this._materialContext):l&&l.setEffect(C,V),this._onEffectCreatedObservable&&(d.effect=C,d.subMesh=X??(null===T||void 0===T?void 0:T.ue[0])??null,this._onEffectCreatedObservable.notifyObservers(d))),l._wasPreviouslyUsingInstances=!!z,!((null===(b=C)||void 0===b||!b.isReady())??1)&&(a!==C&&A.resetCachedMaterial(),l._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(T,z){const X=this.va(),b=z??this.getEffect();b&&(-1!==this._options.uniforms.indexOf("world")&&b.setMatrix("world",T),-1!==this._options.uniforms.indexOf("worldView")&&(T.multiplyToRef(X.getViewMatrix(),this._cachedWorldViewMatrix),b.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(T.multiplyToRef(X.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),b.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&b.setMatrix("view",X.getViewMatrix()))}bindForSubMesh(T,z,X){var b;this.bind(T,z,null===(b=X._drawWrapperOverride)||void 0===b?void 0:b.effect,X)}bind(T,z,X,b){const F=b&&this._storeEffectOnSubMeshes,A=X??(F?b.effect:this.getEffect());if(!A)return;const u=this.va();this._activeEffect=A,this.bindOnlyWorldMatrix(T,X);const y=this._options.uniformBuffers;let E=!1;if(A&&y&&y.length>0&&u.getEngine().supportsUniformBuffers)for(let L=0;L<y.length;++L){switch(y[L]){case"Mesh":z&&(z.getMeshUniformBuffer().bindToEffect(A,"Mesh"),z.transferToEffect(T));break;case"Scene":(0,K.q)(A,u.getSceneUniformBuffer()),u.finalizeSceneUbo(),E=!0}}const v=z&&F?this._mustRebind(u,A,b,z.visibility):u.getCachedMaterial()!==this;if(A&&v){let T;for(T in E||-1===this._options.uniforms.indexOf("view")||A.setMatrix("view",u.getViewMatrix()),E||-1===this._options.uniforms.indexOf("projection")||A.setMatrix("projection",u.getProjectionMatrix()),E||-1===this._options.uniforms.indexOf("viewProjection")||(A.setMatrix("viewProjection",u.getTransformMatrix()),this._multiview&&A.setMatrix("viewProjectionR",u._transformMatrixR)),u.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&A.setVector3("cameraPosition",u.activeCamera.globalPosition),(0,K.c)(z,A),(0,x.e)(A,this,u),this._useLogarithmicDepth&&(0,K.l)(F?b.materialDefines:A.defines,A,u),z&&(0,K.d)(u,z,A),this._textures)A.setTexture(T,this._textures[T]);for(T in this._textureArrays)A.setTextureArray(T,this._textureArrays[T]);for(T in this._ints)A.setInt(T,this._ints[T]);for(T in this._uints)A.setUInt(T,this._uints[T]);for(T in this._floats)A.setFloat(T,this._floats[T]);for(T in this._floatsArrays)A.setArray(T,this._floatsArrays[T]);for(T in this._colors3)A.setColor3(T,this._colors3[T]);for(T in this._colors3Arrays)A.setArray3(T,this._colors3Arrays[T]);for(T in this._colors4){const z=this._colors4[T];A.setFloat4(T,z.r,z.g,z.b,z.a)}for(T in this._colors4Arrays)A.setArray4(T,this._colors4Arrays[T]);for(T in this._vectors2)A.setVector2(T,this._vectors2[T]);for(T in this._vectors3)A.setVector3(T,this._vectors3[T]);for(T in this._vectors4)A.setVector4(T,this._vectors4[T]);for(T in this._quaternions)A.setQuaternion(T,this._quaternions[T]);for(T in this._matrices)A.setMatrix(T,this._matrices[T]);for(T in this._matrixArrays)A.setMatrices(T,this._matrixArrays[T]);for(T in this._matrices3x3)A.setMatrix3x3(T,this._matrices3x3[T]);for(T in this._matrices2x2)A.setMatrix2x2(T,this._matrices2x2[T]);for(T in this._vectors2Arrays)A.setArray2(T,this._vectors2Arrays[T]);for(T in this._vectors3Arrays)A.setArray3(T,this._vectors3Arrays[T]);for(T in this._vectors4Arrays)A.setArray4(T,this._vectors4Arrays[T]);for(T in this._quaternionsArrays)A.setArray4(T,this._quaternionsArrays[T]);for(T in this._uniformBuffers){const z=this._uniformBuffers[T].getBuffer();z&&A.bindUniformBuffer(z,T)}const X=u.getEngine(),y=X.setExternalTexture;if(y)for(T in this._externalTextures)y.call(X,T,this._externalTextures[T]);const v=X.setTextureSampler;if(v)for(T in this._textureSamplers)v.call(X,T,this._textureSamplers[T]);const k=X.setStorageBuffer;if(k)for(T in this._storageBuffers)k.call(X,T,this._storageBuffers[T])}if(A&&z&&(v||!this.isFrozen)){const T=z.morphTargetManager;T&&T.numInfluencers>0&&(0,K.m)(z,A);const X=z.bakedVertexAnimationManager;if(X&&X.isEnabled){var k;const T=F?b._drawWrapper:this._drawWrapper;null===(k=z.bakedVertexAnimationManager)||void 0===k||k.bind(A,!!T._wasPreviouslyUsingInstances)}}this._afterBind(z,A,b)}getActiveTextures(){const T=super.getActiveTextures();for(const z in this._textures)T.push(this._textures[z]);for(const z in this._textureArrays){const X=this._textureArrays[z];for(let z=0;z<X.length;z++)T.push(X[z])}return T}hasTexture(T){if(super.hasTexture(T))return!0;for(const z in this._textures)if(this._textures[z]===T)return!0;for(const z in this._textureArrays){const X=this._textureArrays[z];for(let z=0;z<X.length;z++)if(X[z]===T)return!0}return!1}clone(T){const z=k.b.Clone((()=>new N(T,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);z.name=T,z.id=T,"object"===typeof z._shaderPath&&(z._shaderPath={...z._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((T=>{const z=this._options[T];Array.isArray(z)&&(this._options[T]=z.slice(0))})),this.stencil.copyTo(z.stencil);for(const X in this._textures)z.setTexture(X,this._textures[X]);for(const X in this._textureArrays)z.setTextureArray(X,this._textureArrays[X]);for(const X in this._externalTextures)z.setExternalTexture(X,this._externalTextures[X]);for(const X in this._ints)z.setInt(X,this._ints[X]);for(const X in this._uints)z.setUInt(X,this._uints[X]);for(const X in this._floats)z.setFloat(X,this._floats[X]);for(const X in this._floatsArrays)z.setFloats(X,this._floatsArrays[X]);for(const X in this._colors3)z.setColor3(X,this._colors3[X]);for(const X in this._colors3Arrays)z._colors3Arrays[X]=this._colors3Arrays[X];for(const X in this._colors4)z.setColor4(X,this._colors4[X]);for(const X in this._colors4Arrays)z._colors4Arrays[X]=this._colors4Arrays[X];for(const X in this._vectors2)z.setVector2(X,this._vectors2[X]);for(const X in this._vectors3)z.setVector3(X,this._vectors3[X]);for(const X in this._vectors4)z.setVector4(X,this._vectors4[X]);for(const X in this._quaternions)z.setQuaternion(X,this._quaternions[X]);for(const X in this._quaternionsArrays)z._quaternionsArrays[X]=this._quaternionsArrays[X];for(const X in this._matrices)z.setMatrix(X,this._matrices[X]);for(const X in this._matrixArrays)z._matrixArrays[X]=this._matrixArrays[X].slice();for(const X in this._matrices3x3)z.setMatrix3x3(X,this._matrices3x3[X]);for(const X in this._matrices2x2)z.setMatrix2x2(X,this._matrices2x2[X]);for(const X in this._vectors2Arrays)z.setArray2(X,this._vectors2Arrays[X]);for(const X in this._vectors3Arrays)z.setArray3(X,this._vectors3Arrays[X]);for(const X in this._vectors4Arrays)z.setArray4(X,this._vectors4Arrays[X]);for(const X in this._uniformBuffers)z.setUniformBuffer(X,this._uniformBuffers[X]);for(const X in this._textureSamplers)z.setTextureSampler(X,this._textureSamplers[X]);for(const X in this._storageBuffers)z.setStorageBuffer(X,this._storageBuffers[X]);return z}dispose(T,z,X){if(z){let T;for(T in this._textures)this._textures[T].dispose();for(T in this._textureArrays){const z=this._textureArrays[T];for(let T=0;T<z.length;T++)z[T].dispose()}}this._textures={},super.dispose(T,z,X)}serialize(){const T=k.b.Serialize(this);let z;for(z in T.customType="BABYLON.ShaderMaterial",T.uniqueId=this.uniqueId,T.options=this._options,T.shaderPath=this._shaderPath,T.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,T.stencil=this.stencil.serialize(),T.textures={},this._textures)T.textures[z]=this._textures[z].serialize();for(z in T.textureArrays={},this._textureArrays){T.textureArrays[z]=[];const X=this._textureArrays[z];for(let b=0;b<X.length;b++)T.textureArrays[z].push(X[b].serialize())}for(z in T.ints={},this._ints)T.ints[z]=this._ints[z];for(z in T.uints={},this._uints)T.uints[z]=this._uints[z];for(z in T.floats={},this._floats)T.floats[z]=this._floats[z];for(z in T.floatsArrays={},this._floatsArrays)T.floatsArrays[z]=this._floatsArrays[z];for(z in T.colors3={},this._colors3)T.colors3[z]=this._colors3[z].zd();for(z in T.colors3Arrays={},this._colors3Arrays)T.colors3Arrays[z]=this._colors3Arrays[z];for(z in T.colors4={},this._colors4)T.colors4[z]=this._colors4[z].zd();for(z in T.colors4Arrays={},this._colors4Arrays)T.colors4Arrays[z]=this._colors4Arrays[z];for(z in T.vectors2={},this._vectors2)T.vectors2[z]=this._vectors2[z].zd();for(z in T.vectors3={},this._vectors3)T.vectors3[z]=this._vectors3[z].zd();for(z in T.vectors4={},this._vectors4)T.vectors4[z]=this._vectors4[z].zd();for(z in T.quaternions={},this._quaternions)T.quaternions[z]=this._quaternions[z].zd();for(z in T.matrices={},this._matrices)T.matrices[z]=this._matrices[z].zd();for(z in T.matrixArray={},this._matrixArrays)T.matrixArray[z]=this._matrixArrays[z];for(z in T.matrices3x3={},this._matrices3x3)T.matrices3x3[z]=this._matrices3x3[z];for(z in T.matrices2x2={},this._matrices2x2)T.matrices2x2[z]=this._matrices2x2[z];for(z in T.vectors2Arrays={},this._vectors2Arrays)T.vectors2Arrays[z]=this._vectors2Arrays[z];for(z in T.vectors3Arrays={},this._vectors3Arrays)T.vectors3Arrays[z]=this._vectors3Arrays[z];for(z in T.vectors4Arrays={},this._vectors4Arrays)T.vectors4Arrays[z]=this._vectors4Arrays[z];for(z in T.quaternionsArrays={},this._quaternionsArrays)T.quaternionsArrays[z]=this._quaternionsArrays[z];return T}static Parse(T,z,X){const F=k.b.Parse((()=>new N(T.name,z,T.shaderPath,T.options,T.storeEffectOnSubMeshes)),T,z,X);let A;for(A in T.stencil&&F.stencil.parse(T.stencil,z,X),T.textures)F.setTexture(A,D.c.Parse(T.textures[A],z,X));for(A in T.textureArrays){const b=T.textureArrays[A],u=[];for(let T=0;T<b.length;T++)u.push(D.c.Parse(b[T],z,X));F.setTextureArray(A,u)}for(A in T.ints)F.setInt(A,T.ints[A]);for(A in T.uints)F.setUInt(A,T.uints[A]);for(A in T.floats)F.setFloat(A,T.floats[A]);for(A in T.floatsArrays)F.setFloats(A,T.floatsArrays[A]);for(A in T.colors3)F.setColor3(A,u.b.xd(T.colors3[A]));for(A in T.colors3Arrays){const z=T.colors3Arrays[A].reduce(((T,z,X)=>(X%3===0?T.push([z]):T[T.length-1].push(z),T)),[]).map((T=>u.b.xd(T)));F.setColor3Array(A,z)}for(A in T.colors4)F.setColor4(A,u.d.xd(T.colors4[A]));for(A in T.colors4Arrays){const z=T.colors4Arrays[A].reduce(((T,z,X)=>(X%4===0?T.push([z]):T[T.length-1].push(z),T)),[]).map((T=>u.d.xd(T)));F.setColor4Array(A,z)}for(A in T.vectors2)F.setVector2(A,b.i.xd(T.vectors2[A]));for(A in T.vectors3)F.setVector3(A,b.j.xd(T.vectors3[A]));for(A in T.vectors4)F.setVector4(A,b.n.xd(T.vectors4[A]));for(A in T.quaternions)F.setQuaternion(A,b.e.xd(T.quaternions[A]));for(A in T.matrices)F.setMatrix(A,b.d.xd(T.matrices[A]));for(A in T.matrixArray)F._matrixArrays[A]=new Float32Array(T.matrixArray[A]);for(A in T.matrices3x3)F.setMatrix3x3(A,T.matrices3x3[A]);for(A in T.matrices2x2)F.setMatrix2x2(A,T.matrices2x2[A]);for(A in T.vectors2Arrays)F.setArray2(A,T.vectors2Arrays[A]);for(A in T.vectors3Arrays)F.setArray3(A,T.vectors3Arrays[A]);for(A in T.vectors4Arrays)F.setArray4(A,T.vectors4Arrays[A]);for(A in T.quaternionsArrays)F.setArray4(A,T.quaternionsArrays[A]);return F}static ParseFromFileAsync(T,z,X){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((F,A)=>{const u=new H.e;u.addEventListener("readystatechange",(()=>{if(4==u.readyState)if(200==u.status){const z=JSON.parse(u.responseText),A=this.Parse(z,X||s.e.LastCreatedScene,b);T&&(A.name=T),F(A)}else A("Unable to load the ShaderMaterial")})),u.open("GET",z),u.send()}))}static ParseFromSnippetAsync(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((b,F)=>{const A=new H.e;A.addEventListener("readystatechange",(()=>{if(4==A.readyState)if(200==A.status){const F=JSON.parse(JSON.parse(A.responseText).jsonPayload),u=JSON.parse(F.shaderMaterial),y=this.Parse(u,z||s.e.LastCreatedScene,X);y.snippetId=T,b(y)}else F("Unable to load the snippet "+T)})),A.open("GET",this.SnippetUrl+"/"+T.replace(/#/g,"/")),A.send()}))}}N.SnippetUrl="https://snippet.babylonjs.com",N.CreateFromSnippetAsync=N.ParseFromSnippetAsync,(0,c.h)("BABYLON.ShaderMaterial",N),F.e._LinesMeshParser=(T,z)=>l.Parse(T,z);class l extends F.e{_isShaderMaterial(T){return"ShaderMaterial"===T.getClassName()}constructor(T){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>5?arguments[5]:void 0,F=arguments.length>6?arguments[6]:void 0,A=arguments.length>7?arguments[7]:void 0;super(T,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z,arguments.length>4?arguments[4]:void 0),this.useVertexColor=b,this.useVertexAlpha=F,this.color=new u.b(1,1,1),this.alpha=1,this._shaderLanguage=0,z&&(this.color=z.color.clone(),this.alpha=z.alpha,this.useVertexColor=z.useVertexColor,this.useVertexAlpha=z.useVertexAlpha),this.intersectionThreshold=.1;const E={attributes:[y.e.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===F?E.needAlphaBlending=!1:E.defines.push("#define VERTEXALPHA"),b?(E.defines.push("#define VERTEXCOLOR"),E.attributes.push(y.e.ColorKind)):(E.uniforms.push("color"),this._color4=new u.d),A)this.material=A;else{this.va().getEngine().isWebGPU&&!l.ForceGLSL&&(this._shaderLanguage=1),E.shaderLanguage=this._shaderLanguage,E.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([X.e(19).then(X.bind(X,13213)),X.e(48).then(X.bind(X,13222))]):await Promise.all([X.e(26).then(X.bind(X,13225)),X.e(49).then(X.bind(X,13228))])},this.material=new N("colorShader",this.va(),"color",E,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(T){this._lineMaterial=T,this._lineMaterial.fillMode=v.d.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(T){}_bind(T,z){if(!this._geometry)return this;const X=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(z,X):this._geometry._bind(z,X,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:T,g:z,b:X}=this.color;this._color4.set(T,z,X,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(T,z,X){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const b=this.va().getEngine();return this._unIndexed?b.drawArraysType(v.d.LineListDrawMode,T.verticesStart,T.verticesCount,X):b.drawElementsType(v.d.LineListDrawMode,T.indexStart,T.indexCount,X),this}dispose(T){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(T)}clone(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0;return new l(T,this.va(),z,this,X)}Db(T){const z=new a(T,this);if(this.instancedBuffers){z.instancedBuffers={};for(const T in this.instancedBuffers)z.instancedBuffers[T]=this.instancedBuffers[T]}return z}serialize(T){super.serialize(T),T.color=this.color.zd(),T.alpha=this.alpha}static Parse(T,z){const X=new l(T.name,z);return X.color=u.b.xd(T.color),X.alpha=T.alpha,X}}l.ForceGLSL=!1;class a extends E.d{constructor(T,z){super(T,z),this.intersectionThreshold=z.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var q=X(1065);function V(T){const z=[],X=[],b=T.lines,F=T.za,u=[];let y=0;for(let A=0;A<b.length;A++){const T=b[A];for(let b=0;b<T.length;b++){const{x:E,y:v,z:k}=T[b];if(X.push(E,v,k),F){const T=F[A],{r:z,g:X,b:y,a:E}=T[b];u.push(z,X,y,E)}b>0&&(z.push(y-1),z.push(y)),y++}}const E=new A.e;return E.indices=z,E.xa=X,F&&(E.za=u),E}function C(T){const z=T.dashSize||3,X=T.gapSize||1,F=T.dashNb||200,u=T.points,y=[],E=[],v=b.j.Zero();let k=0,L=0,D=0,c=0,p=0,H=0,U=0;for(U=0;U<u.length-1;U++)u[U+1].subtractToRef(u[U],v),k+=v.length();for(D=k/F,c=z*D/(z+X),U=0;U<u.length-1;U++){u[U+1].subtractToRef(u[U],v),L=Math.floor(v.length()/D),v.normalize();for(let T=0;T<L;T++)p=D*T,y.push(u[U].x+p*v.x,u[U].y+p*v.y,u[U].z+p*v.z),y.push(u[U].x+(p+c)*v.x,u[U].y+(p+c)*v.y,u[U].z+(p+c)*v.z),E.push(H,H+1),H+=2}const s=new A.e;return s.xa=y,s.indices=E,s}function G(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=z.instance,F=z.lines,A=z.za;if(b){const T=b.getVerticesData(y.e.PositionKind);let z,X;A&&(z=b.getVerticesData(y.e.ColorKind));let u=0,E=0;for(let b=0;b<F.length;b++){const y=F[b];for(let F=0;F<y.length;F++)T[u]=y[F].x,T[u+1]=y[F].y,T[u+2]=y[F].z,A&&z&&(X=A[b],z[E]=X[F].r,z[E+1]=X[F].g,z[E+2]=X[F].b,z[E+3]=X[F].a,E+=4),u+=3}return b.updateVerticesData(y.e.PositionKind,T,!1,!1),A&&z&&b.updateVerticesData(y.e.ColorKind,z,!1,!1),b.refreshBoundingInfo(),b}const u=new l(T,X,null,void 0,void 0,!!A,z.useVertexAlpha,z.material);return V(z).Ca(u,z.updatable),u}function j(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=z.za?[z.za]:null;return G(T,{lines:[z.points],updatable:z.updatable,instance:z.instance,za:b,useVertexAlpha:z.useVertexAlpha,material:z.material},X)}function Z(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=z.points,u=z.instance,y=z.gapSize||1,E=z.dashSize||3;if(u){const T=T=>{const z=b.j.Zero(),X=T.length/6;let F=0,y=0,E=0,v=0,k=0,L=0,D=0,c=0;for(D=0;D<A.length-1;D++)A[D+1].subtractToRef(A[D],z),F+=z.length();E=F/X;const p=u._creationDataStorage.dashSize;for(v=p*E/(p+u._creationDataStorage.gapSize),D=0;D<A.length-1;D++)for(A[D+1].subtractToRef(A[D],z),y=Math.floor(z.length()/E),z.normalize(),c=0;c<y&&L<T.length;)k=E*c,T[L]=A[D].x+k*z.x,T[L+1]=A[D].y+k*z.y,T[L+2]=A[D].z+k*z.z,T[L+3]=A[D].x+(k+v)*z.x,T[L+4]=A[D].y+(k+v)*z.y,T[L+5]=A[D].z+(k+v)*z.z,L+=6,c++;for(;L<T.length;)T[L]=A[D].x,T[L+1]=A[D].y,T[L+2]=A[D].z,L+=3};return(z.dashNb||z.dashSize||z.gapSize||z.useVertexAlpha||z.material)&&q.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),u.updateMeshPositions(T,!1),u}const v=new l(T,X,null,void 0,void 0,void 0,z.useVertexAlpha,z.material);return C(z).Ca(v,z.updatable),v._creationDataStorage=new F.g,v._creationDataStorage.dashSize=E,v._creationDataStorage.gapSize=y,v}A.e.CreateLineSystem=V,A.e.CreateDashedLines=C,F.e.lb=function(T,z){return j(T,{points:z,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},F.e.CreateDashedLines=function(T,z,X,b,F){return Z(T,{points:z,dashSize:X,gapSize:b,dashNb:F,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12030:(T,z,X)=>{"use strict";X.d(z,{c:()=>y,g:()=>E});var b=X(11933),F=X(11955),A=X(1141);function u(T){const z=[],X=[],b=[],u=[],y=T.width||T.size||1,E=T.height||T.size||1,v=0===T.sideOrientation?0:T.sideOrientation||F.e.DEFAULTSIDE,k=y/2,L=E/2;X.push(-k,-L,0),b.push(0,0,-1),u.push(0,A.c?1:0),X.push(k,-L,0),b.push(0,0,-1),u.push(1,A.c?1:0),X.push(k,L,0),b.push(0,0,-1),u.push(1,A.c?0:1),X.push(-k,L,0),b.push(0,0,-1),u.push(0,A.c?0:1),z.push(0),z.push(1),z.push(2),z.push(0),z.push(2),z.push(3),F.e._ComputeSides(v,X,z,b,u,T.frontUVs,T.backUVs);const D=new F.e;return D.indices=z,D.xa=X,D.ya=b,D.Aa=u,D}function y(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const F=new b.e(T,X);z.sideOrientation=b.e._GetDefaultSideOrientation(z.sideOrientation),F._originalBuilderSideOrientation=z.sideOrientation;return u(z).Ca(F,z.updatable),z.sourcePlane&&(F.translate(z.sourcePlane.Jd,-z.sourcePlane.d),F.setDirection(z.sourcePlane.Jd.scale(-1))),F}const E={Ig:y};F.e.Ig=u,b.e.Ig=(T,z,X,b,F)=>y(T,{size:z,width:z,height:z,sideOrientation:F,updatable:b},X)},12078:(T,z,X)=>{"use strict";X.d(z,{b:()=>E});var b=X(976),F=X(11933),A=X(11955),u=X(1141);function y(T){const z=0|(T.segments||32),X=T.diameterX||T.diameter||1,F=T.diameterY||T.diameter||1,y=T.diameterZ||T.diameter||1,E=T.arc&&(T.arc<=0||T.arc>1)?1:T.arc||1,v=T.slice&&T.slice<=0?1:T.slice||1,k=0===T.sideOrientation?0:T.sideOrientation||A.e.DEFAULTSIDE,L=!!T.dedupTopBottomIndices,D=new b.j(X/2,F/2,y/2),c=2+z,p=2*c,H=[],U=[],s=[],x=[];for(let A=0;A<=c;A++){const T=A/c,z=T*Math.PI*v;for(let X=0;X<=p;X++){const F=X/p,A=F*Math.PI*2*E,y=b.d.RotationZ(-z),v=b.d.RotationY(A),k=b.j.TransformCoordinates(b.j.Up(),y),L=b.j.TransformCoordinates(k,v),c=L.multiply(D),H=L.divide(D).normalize();U.push(c.x,c.y,c.z),s.push(H.x,H.y,H.z),x.push(F,u.c?1-T:T)}if(A>0){const T=U.length/3;for(let z=T-2*(p+1);z+p+2<T;z++)L?(A>1&&(H.push(z),H.push(z+1),H.push(z+p+1)),(A<c||v<1)&&(H.push(z+p+1),H.push(z+1),H.push(z+p+2))):(H.push(z),H.push(z+1),H.push(z+p+1),H.push(z+p+1),H.push(z+1),H.push(z+p+2))}}A.e._ComputeSides(k,U,H,s,x,T.frontUVs,T.backUVs);const K=new A.e;return K.indices=H,K.xa=U,K.ya=s,K.Aa=x,K}function E(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new F.e(T,X);z.sideOrientation=F.e._GetDefaultSideOrientation(z.sideOrientation),b._originalBuilderSideOrientation=z.sideOrientation;return y(z).Ca(b,z.updatable),b}A.e.CreateSphere=y,F.e.CreateSphere=(T,z,X,b,F,A)=>E(T,{segments:z,diameterX:X,diameterY:X,diameterZ:X,sideOrientation:A,updatable:F},b)},12544:(T,z,X)=>{"use strict";X.d(z,{e:()=>L});var b=X(1166),F=X(11005),A=X(11964),u=X(1207),y=X(11955),E=X(1065);function v(T,z,X,b,F){let A=null,u=null,y=null;try{let E;A=new T.Decoder,u=new T.DecoderBuffer,u.Init(z,z.byteLength);const v=A.GetEncodedGeometryType(u);switch(v){case T.TRIANGULAR_MESH:{const z=new T.Mesh;if(E=A.DecodeBufferToMesh(u,z),!E.ok()||0===z.ptr)throw new Error(E.error_msg());const X=3*z.num_faces(),F=4*X,v=T._malloc(F);try{A.GetTrianglesUInt32Array(z,F,v);const u=new Uint32Array(X);u.set(new Uint32Array(T.HEAPF32.buffer,v,X)),b(u)}finally{T._free(v)}y=z;break}case T.POINT_CLOUD:{const z=new T.PointCloud;if(E=A.DecodeBufferToPointCloud(u,z),!E.ok()||!z.ptr)throw new Error(E.error_msg());y=z;break}default:throw new Error(`Invalid geometry type ${v}`)}const k=y.num_points(),L=(z,X,b,A)=>{const u=A.data_type(),y=A.num_components(),E=A.normalized(),v=A.byte_stride(),L=A.byte_offset(),D={[T.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:T.HEAPF32},[T.DT_INT8]:{typedArrayConstructor:Int8Array,heap:T.HEAP8},[T.DT_INT16]:{typedArrayConstructor:Int16Array,heap:T.HEAP16},[T.DT_INT32]:{typedArrayConstructor:Int32Array,heap:T.HEAP32},[T.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:T.HEAPU8},[T.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:T.HEAPU16},[T.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:T.HEAPU32}}[u];if(!D)throw new Error(`Invalid data type ${u}`);const c=k*y,p=c*D.typedArrayConstructor.BYTES_PER_ELEMENT,H=T._malloc(p);try{z.GetAttributeDataArrayForAllPoints(X,A,u,p,H);const T=new D.typedArrayConstructor(D.heap.buffer,H,c);F(b,T.slice(),y,L,v,E)}finally{T._free(H)}};if(X)for(const T in X){const z=X[T],b=A.GetAttributeByUniqueId(y,z);L(A,y,T,b)}else{const z={position:T.POSITION,Jd:T.NORMAL,color:T.COLOR,uv:T.TEX_COORD};for(const T in z){const X=A.GetAttributeId(y,z[T]);if(-1!==X){const z=A.GetAttribute(y,X);L(A,y,T,z)}}}return k}finally{y&&T.destroy(y),u&&T.destroy(u),A&&T.destroy(A)}}function k(){let T;onmessage=z=>{const X=z.data;switch(X.id){case"init":{const z=X.decoder;z.url&&importScripts(z.url);const b=z.wasmBinary?{wasmBinary:z.wasmBinary}:{};T=DracoDecoderModule(b),postMessage({id:"initDone"});break}case"decodeMesh":if(!T)throw new Error("Draco decoder module is not available");T.then((T=>{const z=v(T,X.dataView,X.attributes,(T=>{postMessage({id:"indices",data:T},[T.buffer])}),((T,z,X,b,F,A)=>{postMessage({id:"attribute",kind:T,data:z,size:X,byteOffset:b,byteStride:F,normalized:A},[z.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:z})}))}}}class L{static get DecoderAvailable(){const T=L.Configuration.decoder;return!!(T.wasmUrl&&T.wasmBinaryUrl&&"object"===typeof WebAssembly||T.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return L._Default||(L._Default=new L),L._Default}static ResetDefault(T){L._Default&&(T||L._Default.dispose(),L._Default=null)}constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L.DefaultNumWorkers;const z=L.Configuration.decoder;if(z.workerPool||"object"===typeof T&&T.workerPool)this._workerPoolPromise=Promise.resolve(z.workerPool||T.workerPool);else{const X=z.wasmBinary||"object"===typeof T&&T.wasmBinary,A="number"===typeof T?T:T.numWorkers,u=A&&"function"===typeof Worker&&"function"===typeof URL,y=u||!u&&!z.jsModule,E=z.wasmUrl&&z.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:y?b.g.GetBabylonScriptURL(z.wasmUrl,!0):"",wasmBinaryPromise:X?Promise.resolve(X):b.g.LoadFileAsync(b.g.GetBabylonScriptURL(z.wasmBinaryUrl,!0))}:{url:y?b.g.GetBabylonScriptURL(z.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};u?this._workerPoolPromise=E.wasmBinaryPromise.then((T=>{const z=`${v}(${k})()`,X=URL.createObjectURL(new Blob([z],{type:"application/javascript"}));return new F.d(A,(()=>function(T,z,X){return new Promise(((b,F)=>{const A=z=>{T.removeEventListener("error",A),T.removeEventListener("message",u),F(z)},u=z=>{"initDone"===z.data.id&&(T.removeEventListener("error",A),T.removeEventListener("message",u),b(T))};if(T.addEventListener("error",A),T.addEventListener("message",u),z){const b=z.slice(0);T.postMessage({id:"init",decoder:{url:X,wasmBinary:b}},[b])}else T.postMessage({id:"init",decoder:{url:X}})}))}(new Worker(X),T,E.url)))})):this._decoderModulePromise=E.wasmBinaryPromise.then((async T=>{if("undefined"===typeof DracoDecoderModule&&!z.jsModule){if(!E.url)throw new Error("Draco decoder module is not available");await b.g.LoadBabylonScriptAsync(E.url)}return await(X=T,F=z.jsModule,new Promise((T=>{(F||DracoDecoderModule)({wasmBinary:X}).then((z=>{T({module:z})}))})));var X,F}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((T=>{T.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(T,z,X){const b=T instanceof ArrayBuffer?new Int8Array(T):new Int8Array(T.buffer,T.byteOffset,T.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((T=>new Promise(((F,A)=>{T.push(((T,u)=>{let y=null;const v=[],k=z=>{T.removeEventListener("error",k),T.removeEventListener("message",L),A(z),u()},L=z=>{const b=z.data;switch(b.id){case"decodeMeshDone":T.removeEventListener("error",k),T.removeEventListener("message",L),F({indices:y,attributes:v,totalVertices:b.totalVertices}),u();break;case"indices":y=b.data;break;case"attribute":v.push({kind:b.kind,data:b.data,size:b.size,byteOffset:b.byteOffset,byteStride:b.byteStride,normalized:(A=b.kind,D=b.normalized,X&&void 0!==X[A]?(D!==X[A]&&E.e.Warn(`Normalized flag from Draco data (${D}) does not match normalized flag from glTF accessor (${X[A]}). Using flag from glTF accessor.`),X[A]):D)})}var A,D};T.addEventListener("error",k),T.addEventListener("message",L);const D=b.slice();T.postMessage({id:"decodeMesh",dataView:D,attributes:z},[D.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((T=>{let X=null;const F=[],A=v(T.module,b,z,(T=>{X=T}),((T,z,X,b,A,u)=>{F.push({kind:T,data:z,size:X,byteOffset:b,byteStride:A,normalized:u})}));return{indices:X,attributes:F,totalVertices:A}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(T,z,X,b){const F=await this.decodeMeshToMeshDataAsync(X,b),y=new A.e(T,z);F.indices&&y.setIndices(F.indices);for(const A of F.attributes)y.setVerticesBuffer(new u.e(z.getEngine(),A.data,A.kind,!1,void 0,A.byteStride,void 0,A.byteOffset,A.size,void 0,A.normalized,!0),F.totalVertices);return y}async _decodeMeshToGeometryForGltfAsync(T,z,X,b,F){const y=await this.decodeMeshToMeshDataAsync(X,b,F),E=new A.e(T,z);y.indices&&E.setIndices(y.indices);for(const A of y.attributes)E.setVerticesBuffer(new u.e(z.getEngine(),A.data,A.kind,!1,void 0,A.byteStride,void 0,A.byteOffset,A.size,void 0,A.normalized,!0),y.totalVertices);return E}async decodeMeshAsync(T,z){const X=await this.decodeMeshToMeshDataAsync(T,z),b=new y.e;X.indices&&(b.indices=X.indices);for(const F of X.attributes){const T=u.e.GetFloatData(F.data,F.size,u.e.GetDataType(F.data),F.byteOffset,F.byteStride,F.normalized,X.totalVertices);b.set(T,F.kind)}return b}}L.Configuration={decoder:{wasmUrl:`${b.g._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${b.g._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${b.g._DefaultCdnUrl}/draco_decoder_gltf.js`}},L.DefaultNumWorkers=L.GetDefaultNumWorkers(),L._Default=null},11970:(T,z,X)=>{"use strict";X.d(z,{c:()=>a});var b=X(952),F=X(968),A=X(976),u=X(1207),y=X(11955),E=X(11973),v=X(1198),k=X(1282),L=X(1195);class D{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new A.j(0,0,0),this._diffPositionForCollisions=new A.j(0,0,0),this._collisionResponse=!0}}var c=X(1061),p=X(1295),H=X(1132),U=X(979),s=X(1449),x=X(993),K=X(957),d=X(1071);class N{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=A.j.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class l{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new N,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new D,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class a extends E.e{static get BILLBOARDMODE_NONE(){return E.e.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return E.e.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return E.e.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return E.e.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return E.e.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return E.e.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(T){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=T}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(T){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=T}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(T){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=T}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(T){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=T}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(T){this._internalAbstractMeshDataInfo._collisionRetryCount=T}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(T){this._internalAbstractMeshDataInfo._morphTargetManager!==T&&(this._internalAbstractMeshDataInfo._morphTargetManager=T,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(T){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==T&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=T,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(T){return!!super._updateNonUniformScalingState(T)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(T){this._internalAbstractMeshDataInfo._rawBoundingInfo=T}set Uk(T){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(T)}set onCollisionPositionChange(T){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(T)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(T){if(this._internalAbstractMeshDataInfo._visibility===T)return;const z=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=T,(1===z&&1!==T||1!==z&&1===T)&&this._markSubMeshesAsDirty((T=>{T.markAsMiscDirty(),T.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(T){this._internalAbstractMeshDataInfo._inheritVisibility=T}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let T=this._parentNode;for(;T;){const z=T.isVisible;if("undefined"!==typeof z)return z;T=T.parent}}return this._isVisible}set isVisible(T){this._isVisible=T}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(T){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=T}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(T){this._internalAbstractMeshDataInfo._renderingGroupId=T}get material(){return this._internalAbstractMeshDataInfo._material}set material(T){this._setMaterial(T)}_setMaterial(T){this._internalAbstractMeshDataInfo._material!==T&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=T,T&&T.meshMap&&(T.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.ue&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(T){var z;return null===(z=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===z?void 0:z[T]}setMaterialForRenderPass(T,z){this.resetDrawCache(T),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[T]=z}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(T){this._internalAbstractMeshDataInfo._receiveShadows!==T&&(this._internalAbstractMeshDataInfo._receiveShadows=T,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(T){this._internalAbstractMeshDataInfo._hasVertexAlpha!==T&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=T,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(T){this._internalAbstractMeshDataInfo._useVertexColors!==T&&(this._internalAbstractMeshDataInfo._useVertexColors=T,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(T){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==T&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=T,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(T){this._internalAbstractMeshDataInfo._numBoneInfluencers!==T&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=T,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(T){this._internalAbstractMeshDataInfo._applyFog!==T&&(this._internalAbstractMeshDataInfo._applyFog=T,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(T){this._internalAbstractMeshDataInfo._enableDistantPicking=T}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(T){T!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=T,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(T){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(T)?-1:T}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(T){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=T}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(T){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(T)?-1:T}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(T){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=T}get lightSources(){return this._lightSources}set skeleton(T){const z=this._internalAbstractMeshDataInfo._skeleton;z&&z.needInitialSkinMatrix&&z._unregisterMeshWithPoseMatrix(this),T&&T.needInitialSkinMatrix&&T._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=T,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(T){var z;let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(T,X,!1),z=this,this._internalAbstractMeshDataInfo=new l,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Pe=a.aj,this.onCollideObservable=new F.d,this.onCollisionPositionChangeObservable=new F.d,this.onMaterialChangedObservable=new F.d,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.de=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=H.b.Red(),this.outlineWidth=.02,this.overlayColor=H.b.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.Be=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new A.j(.5,1,.5),this.ellipsoidOffset=new A.j(0,0,0),this.edgesWidth=1,this.edgesColor=new H.d(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,oi:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new F.d,this._onCollisionPositionChange=function(T,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;X.subtractToRef(z._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,z._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),z._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>d.d.CollisionsEpsilon&&z.position.addInPlace(z._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),b&&z.onCollideObservable.notifyObservers(b),z.onCollisionPositionChangeObservable.notifyObservers(z.position)},X=this.va(),X.we(this),this._resyncLightSources(),this._uniformBuffer=new L.c(this.va().getEngine(),void 0,void 0,T,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),X.performancePriority){case 2:this.Da=!0;case 1:this.Be=!0,this.de=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(T){const z=this._uniformBuffer;z._d("world",T),z.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),z.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(T){let z="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");z+=", # of submeshes: "+(this.ue?this.ue.length:0);const X=this._internalAbstractMeshDataInfo._skeleton;return X&&(z+=", skeleton: "+X.name),T&&(z+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],z+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.oi?"YES":"NO")),z}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==E.e.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(z||this.actionManager.isRecursive)){if(!T)return this.actionManager;if(this.actionManager.hasSpecificTrigger(T))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(T,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.ue){for(const T of this.ue)T._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const T of this.va().lights)T.isEnabled()&&T.canAffectMesh(this)&&this._lightSources.push(T);this._markSubMeshesAsLightDirty()}_resyncLightSource(T){const z=T.isEnabled()&&T.canAffectMesh(this),X=this._lightSources.indexOf(T);let b=!1;if(-1===X){if(!z)return;this._lightSources.push(T)}else{if(z)return;b=!0,this._lightSources.splice(X,1)}this._markSubMeshesAsLightDirty(b)}_unBindEffect(){for(const T of this.ue)T.setEffect(null)}_removeLightSource(T,z){const X=this._lightSources.indexOf(T);-1!==X&&(this._lightSources.splice(X,1),this._markSubMeshesAsLightDirty(z))}_markSubMeshesAsDirty(T){if(this.ue)for(const z of this.ue)for(let X=0;X<z._drawWrappers.length;++X){const b=z._drawWrappers[X];b&&b.defines&&b.defines.markAllAsDirty&&T(b.defines)}}_markSubMeshesAsLightDirty(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((z=>z.markAsLightDirty(T)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((T=>T.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((T=>T.markAsMiscDirty()))}Fe(T){return this._currentRenderId=Number.MAX_VALUE,super.Fe(T),this._isDirty=!0,this}resetDrawCache(T){if(this.ue)for(const z of this.ue)z.resetDrawCache(T)}get isBlocked(){return!1}getLOD(T){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Ge(){return null}getVerticesData(T){return null}Ga(T,z,X,b){return this}updateVerticesData(T,z,X,b){return this}setIndices(T,z){return this}isVerticesDataPresent(T){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(T){return this._boundingInfo=T,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(T,z,X){return this._boundingInfo=new k.c(T,z,X),this._boundingInfo}normalizeToUnitCube(){let T=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(T,z,X)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(u.e.MatricesIndicesKind)&&this.isVerticesDataPresent(u.e.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(T){}_activate(T,z){return this._renderId=T,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===E.e.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(T,z,X){return this.position.addInPlace(this.calcMovePOV(T,z,X)),this}calcMovePOV(T,z,X){const b=new A.d;(this.rotationQuaternion?this.rotationQuaternion:A.e.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(b);const F=A.j.Zero(),u=this.definedFacingForward?-1:1;return A.j.TransformCoordinatesFromFloatsToRef(T*u,z,X*u,b,F),F}rotatePOV(T,z,X){return this.rotation.addInPlace(this.calcRotatePOV(T,z,X)),this}calcRotatePOV(T,z,X){const b=this.definedFacingForward?1:-1;return new A.j(T*b,z,X*b)}Fa(T,z){if(T){const X=(0,p.h)(T,0,this.getTotalVertices(),z);this._boundingInfo?this._boundingInfo.reConstruct(X.minimum,X.maximum):this._boundingInfo=new k.c(X.minimum,X.maximum)}if(this.ue)for(let X=0;X<this.ue.length;X++)this.ue[X].refreshBoundingInfo(T);this.Ea()}_refreshBoundingInfoDirect(T){if(this._boundingInfo?this._boundingInfo.reConstruct(T.minimum,T.maximum):this._boundingInfo=new k.c(T.minimum,T.maximum),this.ue)for(let z=0;z<this.ue.length;z++)this.ue[z].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(T,z,X,b,F,y,E){!function(T,z,X,b,F,y,E){const v=A.f.Id[0],k=A.f.Matrix[0],L=A.f.Matrix[1],D=z===u.e.NormalKind?A.j.TransformNormalFromFloatsToRef:A.j.TransformCoordinatesFromFloatsToRef;for(let u=0,c=0;u<T.length;u+=3,c+=4){let z,p;for(k.reset(),z=0;z<4;z++)p=F[c+z],p>0&&(A.d.FromFloat32ArrayToRefScaled(X,Math.floor(16*b[c+z]),p,L),k.addToSelf(L));if(y&&E)for(z=0;z<4;z++)p=E[c+z],p>0&&(A.d.FromFloat32ArrayToRefScaled(X,Math.floor(16*y[c+z]),p,L),k.addToSelf(L));D(T[u],T[u+1],T[u+2],k,v),v.toArray(T,u)}}(T,z,X,b,F,y,E)}_getData(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.e.PositionKind;const b=T.cache,F=T=>{if(b){const z=b._vertexData||(b._vertexData={});return z[T]||this.copyVerticesData(T,z),z[T]}return this.getVerticesData(T)};if(z||(z=F(X)),!z)return null;if(b?(b._outputData?b._outputData.set(z):b._outputData=new Float32Array(z),z=b._outputData):(T.applyMorph&&this.morphTargetManager||T.applySkeleton&&this.skeleton)&&(z=z.slice()),T.applyMorph&&this.morphTargetManager&&function(T,z,X){let b=null;switch(z){case u.e.PositionKind:b=T=>T.getPositions();break;case u.e.NormalKind:b=T=>T.getNormals();break;case u.e.TangentKind:b=T=>T.getTangents();break;case u.e.UVKind:b=T=>T.getUVs();break;default:return}for(let F=0;F<T.length;F++){let z=T[F];for(let A=0;A<X.numTargets;A++){const u=X.getTarget(A),y=u.influence;if(0!==y){const X=b(u);X&&(z+=(X[F]-T[F])*y)}}T[F]=z}}(z,X,this.morphTargetManager),T.applySkeleton&&this.skeleton){const T=F(u.e.MatricesIndicesKind),b=F(u.e.MatricesWeightsKind);if(b&&T){const A=this.numBoneInfluencers>4,y=A?F(u.e.MatricesIndicesExtraKind):null,E=A?F(u.e.MatricesWeightsExtraKind):null,v=this.skeleton.getTransformMatrices(this);a._ApplySkeleton(z,X,v,T,b,y,E)}}if(!1!==T.updatePositionsArray&&X===u.e.PositionKind){const T=this._internalAbstractMeshDataInfo._positions||[],X=T.length;if(T.length=z.length/3,X<T.length)for(let z=X;z<T.length;z++)T[z]=new A.j;for(let b=0,F=0;b<T.length;b++,F+=3)T[b].Cd(z[F],z[F+1],z[F+2]);this._internalAbstractMeshDataInfo._positions=T}return z}getNormalsData(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:T,applyMorph:z,updatePositionsArray:!1},null,u.e.NormalKind)}Sf(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:T,applyMorph:z,updatePositionsArray:!1},X,u.e.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new k.c(A.j.Zero(),A.j.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(T){if(!this.ue)return this;const z=this.ue.length;for(let X=0;X<z;X++){const b=this.ue[X];(z>1||!b.IsGlobal)&&b.updateBoundingInfo(T)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(T){return this.getBoundingInfo().isInFrustum(T,this.Pe)}isCompletelyInFrustum(T){return this.getBoundingInfo().isCompletelyInFrustum(T)}intersectsMesh(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2?arguments[2]:void 0;const b=this.getBoundingInfo(),F=T.getBoundingInfo();if(b.intersects(F,z))return!0;if(X)for(const A of this.getChildMeshes())if(A.intersectsMesh(T,z,!0))return!0;return!1}intersectsPoint(T){return this.getBoundingInfo().intersectsPoint(T)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(T){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=T}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(T){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const z=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=z.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,z.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,T,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(T,z,X){var b;if(this._generatePointsArray(),!this._positions)return this;if(!T._lastColliderWorldVertices||!T._lastColliderTransformMatrix.equals(z)){T._lastColliderTransformMatrix=z.clone(),T._lastColliderWorldVertices=[],T._trianglePlanes=[];const X=T.verticesStart,b=T.verticesStart+T.verticesCount;for(let F=X;F<b;F++)T._lastColliderWorldVertices.push(A.j.TransformCoordinates(this._positions[F],z))}return X._collide(T._trianglePlanes,T._lastColliderWorldVertices,this.Ge(),T.indexStart,T.indexStart+T.indexCount,T.verticesStart,!!T.Ha(),this,this._shouldConvertRHS(),7===(null===(b=T.Ha())||void 0===b?void 0:b.fillMode)),this}_processCollisionsForSubMeshes(T,z){const X=this._scene.getCollidingSubMeshCandidates(this,T),b=X.length;for(let F=0;F<b;F++){const A=X.data[F];b>1&&!A._checkCollision(T)||this._collideForSubMesh(A,z,T)}return this}_shouldConvertRHS(){return!1}_checkCollision(T){if(!this.getBoundingInfo()._checkCollision(T))return this;const z=A.f.Matrix[0],X=A.f.Matrix[1];return A.d.ScalingToRef(1/T._radius.x,1/T._radius.y,1/T._radius.z,z),this.worldMatrixFromCache.multiplyToRef(z,X),this._processCollisionsForSubMeshes(T,X),this}_generatePointsArray(){return!1}intersects(T,z,X){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4?arguments[4]:void 0,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const y=new v.c,E=this.getClassName(),k="InstancedLinesMesh"===E||"LinesMesh"===E||"GreasedLineMesh"===E?this.intersectionThreshold:0,L=this.getBoundingInfo();if(!this.ue)return y;if(!u&&(!T.intersectsSphere(L.boundingSphere,k)||!T.intersectsBox(L.boundingBox,k)))return y;if(b)return y.hit=!u,y.pickedMesh=u?null:this,y.distance=u?0:A.j.Distance(T.origin,L.boundingSphere.center),y.subMeshId=0,y;if(!this._generatePointsArray())return y;let D=null;const c=this._scene.getIntersectingSubMeshCandidates(this,T),p=c.length;let H=!1;for(let A=0;A<p;A++){const T=c.data[A].Ha();if(T&&(7==T.fillMode||0==T.fillMode||1==T.fillMode||2==T.fillMode||4==T.fillMode)){H=!0;break}}if(!H)return y.hit=!0,y.pickedMesh=this,y.distance=A.j.Distance(T.origin,L.boundingSphere.center),y.subMeshId=-1,y;for(let A=0;A<p;A++){const b=c.data[A];if(p>1&&!u&&!b.canIntersects(T))continue;const F=b.intersects(T,this._positions,this.Ge(),z,X);if(F&&(z||!D||F.distance<D.distance)&&(D=F,D.subMeshId=A,z))break}if(D){const z=F??this.getWorldMatrix(),X=A.f.Id[0],b=A.f.Id[1];A.j.TransformCoordinatesToRef(T.origin,z,X),T.direction.scaleToRef(D.distance,b);const u=A.j.TransformNormal(b,z).addInPlace(X);return y.hit=!0,y.distance=A.j.Distance(X,u),y.pickedPoint=u,y.pickedMesh=this,y.bu=D.bu||0,y.bv=D.bv||0,y.subMeshFaceId=D.faceId,y.faceId=D.faceId+c.data[D.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),y.subMeshId=D.subMeshId,y}return y}clone(T,z,X){return null}releaseSubMeshes(){if(this.ue)for(;this.ue.length;)this.ue[0].dispose();else this.ue=[];return this}dispose(T){let z,X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const b=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),b.freeActiveMeshes(),b.freeRenderingGroups(),b.renderingManager.maintainStateBetweenFrames&&b.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((T=>T!==this&&T.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),z=0;z<this._intersectionsInProgress.length;z++){const T=this._intersectionsInProgress[z],X=T._intersectionsInProgress.indexOf(this);T._intersectionsInProgress.splice(X,1)}this._intersectionsInProgress.length=0;b.lights.forEach((T=>{let z=T.includedOnlyMeshes.indexOf(this);-1!==z&&T.includedOnlyMeshes.splice(z,1),z=T.excludedMeshes.indexOf(this),-1!==z&&T.excludedMeshes.splice(z,1);const X=T.getShadowGenerators();if(X){const T=X.values();for(let X=T.next();!0!==X.done;X=T.next()){const T=X.value.getShadowMap();T&&T.renderList&&(z=T.renderList.indexOf(this),-1!==z&&T.renderList.splice(z,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const F=b.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,F.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),F.wipeCaches(),b.ye(this),this._parentContainer){const T=this._parentContainer.meshes.indexOf(this);T>-1&&this._parentContainer.meshes.splice(T,1),this._parentContainer=null}if(X&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!T)for(z=0;z<b.pe.length;z++)b.pe[z].k===this&&(b.pe[z].dispose(),z--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(T,X)}_initFacetData(){const T=this._internalAbstractMeshDataInfo._facetData;T.facetNormals||(T.facetNormals=[]),T.facetPositions||(T.facetPositions=[]),T.facetPartitioning||(T.facetPartitioning=new Array),T.facetNb=this.Ge().length/3|0,T.partitioningSubdivisions=T.partitioningSubdivisions?T.partitioningSubdivisions:10,T.partitioningBBoxRatio=T.partitioningBBoxRatio?T.partitioningBBoxRatio:1.01;for(let z=0;z<T.facetNb;z++)T.facetNormals[z]=A.j.Zero(),T.facetPositions[z]=A.j.Zero();return T.facetDataEnabled=!0,this}updateFacetData(){const T=this._internalAbstractMeshDataInfo._facetData;T.facetDataEnabled||this._initFacetData();const z=this.getVerticesData(u.e.PositionKind),X=this.Ge(),b=this.getVerticesData(u.e.NormalKind),F=this.getBoundingInfo();if(T.facetDepthSort&&!T.facetDepthSortEnabled){if(T.facetDepthSortEnabled=!0,X instanceof Uint16Array)T.depthSortedIndices=new Uint16Array(X);else if(X instanceof Uint32Array)T.depthSortedIndices=new Uint32Array(X);else{let z=!1;for(let T=0;T<X.length;T++)if(X[T]>65535){z=!0;break}T.depthSortedIndices=z?new Uint32Array(X):new Uint16Array(X)}if(T.facetDepthSortFunction=function(T,z){return z.sqDistance-T.sqDistance},!T.facetDepthSortFrom){const z=this.va().activeCamera;T.facetDepthSortFrom=z?z.position:A.j.Zero()}T.depthSortedFacets=[];for(let z=0;z<T.facetNb;z++){const X={ind:3*z,sqDistance:0};T.depthSortedFacets.push(X)}T.invertedMatrix=A.d.Identity(),T.facetDepthSortOrigin=A.j.Zero()}T.bbSize.x=F.maximum.x-F.minimum.x>U.e?F.maximum.x-F.minimum.x:U.e,T.bbSize.y=F.maximum.y-F.minimum.y>U.e?F.maximum.y-F.minimum.y:U.e,T.bbSize.z=F.maximum.z-F.minimum.z>U.e?F.maximum.z-F.minimum.z:U.e;let E=T.bbSize.x>T.bbSize.y?T.bbSize.x:T.bbSize.y;if(E=E>T.bbSize.z?E:T.bbSize.z,T.subDiv.max=T.partitioningSubdivisions,T.subDiv.X=Math.floor(T.subDiv.max*T.bbSize.x/E),T.subDiv.Y=Math.floor(T.subDiv.max*T.bbSize.y/E),T.subDiv.Z=Math.floor(T.subDiv.max*T.bbSize.z/E),T.subDiv.X=T.subDiv.X<1?1:T.subDiv.X,T.subDiv.Y=T.subDiv.Y<1?1:T.subDiv.Y,T.subDiv.Z=T.subDiv.Z<1?1:T.subDiv.Z,T.facetParameters.facetNormals=this.getFacetLocalNormals(),T.facetParameters.facetPositions=this.getFacetLocalPositions(),T.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),T.facetParameters.bInfo=F,T.facetParameters.bbSize=T.bbSize,T.facetParameters.subDiv=T.subDiv,T.facetParameters.ratio=this.partitioningBBoxRatio,T.facetParameters.depthSort=T.facetDepthSort,T.facetDepthSort&&T.facetDepthSortEnabled&&(this.ze(!0),this._worldMatrix.invertToRef(T.invertedMatrix),A.j.TransformCoordinatesToRef(T.facetDepthSortFrom,T.invertedMatrix,T.facetDepthSortOrigin),T.facetParameters.distanceTo=T.facetDepthSortOrigin),T.facetParameters.depthSortedFacets=T.depthSortedFacets,b&&y.e.ComputeNormals(z,X,b,T.facetParameters),T.facetDepthSort&&T.facetDepthSortEnabled){T.depthSortedFacets.sort(T.facetDepthSortFunction);const z=T.depthSortedIndices.length/3|0;for(let b=0;b<z;b++){const z=T.depthSortedFacets[b].ind;T.depthSortedIndices[3*b]=X[z],T.depthSortedIndices[3*b+1]=X[z+1],T.depthSortedIndices[3*b+2]=X[z+2]}this.updateIndices(T.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const T=this._internalAbstractMeshDataInfo._facetData;return T.facetNormals||this.updateFacetData(),T.facetNormals}getFacetLocalPositions(){const T=this._internalAbstractMeshDataInfo._facetData;return T.facetPositions||this.updateFacetData(),T.facetPositions}getFacetLocalPartitioning(){const T=this._internalAbstractMeshDataInfo._facetData;return T.facetPartitioning||this.updateFacetData(),T.facetPartitioning}getFacetPosition(T){const z=A.j.Zero();return this.getFacetPositionToRef(T,z),z}getFacetPositionToRef(T,z){const X=this.getFacetLocalPositions()[T],b=this.getWorldMatrix();return A.j.TransformCoordinatesToRef(X,b,z),this}getFacetNormal(T){const z=A.j.Zero();return this.getFacetNormalToRef(T,z),z}getFacetNormalToRef(T,z){const X=this.getFacetLocalNormals()[T];return A.j.TransformNormalToRef(X,this.getWorldMatrix(),z),this}getFacetsAtLocalCoordinates(T,z,X){const b=this.getBoundingInfo(),F=this._internalAbstractMeshDataInfo._facetData,A=Math.floor((T-b.minimum.x*F.partitioningBBoxRatio)*F.subDiv.X*F.partitioningBBoxRatio/F.bbSize.x),u=Math.floor((z-b.minimum.y*F.partitioningBBoxRatio)*F.subDiv.Y*F.partitioningBBoxRatio/F.bbSize.y),y=Math.floor((X-b.minimum.z*F.partitioningBBoxRatio)*F.subDiv.Z*F.partitioningBBoxRatio/F.bbSize.z);return A<0||A>F.subDiv.max||u<0||u>F.subDiv.max||y<0||y>F.subDiv.max?null:F.facetPartitioning[A+F.subDiv.max*u+F.subDiv.max*F.subDiv.max*y]}getClosestFacetAtCoordinates(T,z,X,b){let F=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const y=this.getWorldMatrix(),E=A.f.Matrix[5];y.invertToRef(E);const v=A.f.Id[8];A.j.TransformCoordinatesFromFloatsToRef(T,z,X,E,v);const k=this.getClosestFacetAtLocalCoordinates(v.x,v.y,v.z,b,F,u);return b&&A.j.TransformCoordinatesFromFloatsToRef(b.x,b.y,b.z,y,b),k}getClosestFacetAtLocalCoordinates(T,z,X,b){let F=arguments.length>4&&void 0!==arguments[4]&&arguments[4],A=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],u=null,y=0,E=0,v=0,k=0,L=0,D=0,c=0,p=0;const H=this.getFacetLocalPositions(),U=this.getFacetLocalNormals(),s=this.getFacetsAtLocalCoordinates(T,z,X);if(!s)return null;let x,K,d,N=Number.MAX_VALUE,l=N;for(let a=0;a<s.length;a++)x=s[a],K=U[x],d=H[x],k=(T-d.x)*K.x+(z-d.y)*K.y+(X-d.z)*K.z,(!F||F&&A&&k>=0||F&&!A&&k<=0)&&(k=K.x*d.x+K.y*d.y+K.z*d.z,L=-(K.x*T+K.y*z+K.z*X-k)/(K.x*K.x+K.y*K.y+K.z*K.z),D=T+K.x*L,c=z+K.y*L,p=X+K.z*L,y=D-T,E=c-z,v=p-X,l=y*y+E*E+v*v,l<N&&(N=l,u=x,b&&(b.x=D,b.y=c,b.z=p)));return u}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const T=this._internalAbstractMeshDataInfo._facetData;return T.facetDataEnabled&&(T.facetDataEnabled=!1,T.facetPositions=[],T.facetNormals=[],T.facetPartitioning=new Array,T.facetParameters=null,T.depthSortedIndices=new Uint32Array(0)),this}updateIndices(T,z){return this}createNormals(T){const z=this.getVerticesData(u.e.PositionKind),X=this.Ge();let b;return b=this.isVerticesDataPresent(u.e.NormalKind)?this.getVerticesData(u.e.NormalKind):[],y.e.ComputeNormals(z,X,b,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(u.e.NormalKind,b,T),this}alignWithNormal(T,z){z||(z=s.b.Y);const X=A.f.Id[0],b=A.f.Id[1];return A.j.CrossToRef(z,T,b),A.j.CrossToRef(T,b,X),this.rotationQuaternion?A.e.RotationQuaternionFromAxisToRef(X,T,b,this.rotationQuaternion):A.j.RotationFromAxisToRef(X,T,b,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,c.d)("EdgesRenderer")}enableEdgesRendering(T,z,X){throw(0,c.d)("EdgesRenderer")}Fj(){return this._scene.pe.filter((T=>T.k===this))}}a.OCCLUSION_TYPE_NONE=0,a.OCCLUSION_TYPE_OPTIMISTIC=1,a.OCCLUSION_TYPE_STRICT=2,a.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,a.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,a.CULLINGSTRATEGY_STANDARD=0,a.aj=1,a.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,a.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,b.c)([K.e.filter((function(){for(var T=arguments.length,z=new Array(T),X=0;X<T;X++)z[X]=arguments[X];let[b,F,A,u,y]=z;return!Array.isArray(b)&&!Array.isArray(F)&&!Array.isArray(A)&&!Array.isArray(u)&&!Array.isArray(y)}))],a,"_ApplySkeleton",null),(0,x.h)("BABYLON.AbstractMesh",a)},11964:(T,z,X)=>{"use strict";X.d(z,{e:()=>U});var b=X(976),F=X(1132),A=X(11955),u=X(1207),y=X(1274),E=X(11966),v=X(1282),k=X(1166),L=X(1128),D=X(1295),c=X(1007),p=X(1141),H=X(1065);class U{get boundingBias(){return this._boundingBias}set boundingBias(T){this._boundingBias?this._boundingBias.p(T):this._boundingBias=T.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(T){const z=new U(U.RandomId(),T.va());return z.Ca(T),z}get meshes(){return this._meshes}constructor(T,z,X){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=z||c.e.LastCreatedScene,this._scene&&(this.id=T,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=b,X?this.setAllVerticesData(X,b):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),F&&(this.Ca(F),F.ze(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let T=0;T<this._meshes.length;T++)if(!this._meshes[T].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const T=new Set;for(const z in this._vertexBuffers)T.add(this._vertexBuffers[z].getWrapperBuffer());T.forEach((T=>{T._rebuild()}))}setAllVerticesData(T,z){T.applyToGeometry(this,z),this._notifyUpdate()}Ga(T,z){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3?arguments[3]:void 0;X&&Array.isArray(z)&&(z=new Float32Array(z));const F=new u.e(this._engine,z,T,{updatable:X,postponeInternalCreation:0===this._meshes.length,stride:b,label:"Geometry_"+this.id+"_"+T});this.setVerticesBuffer(F)}removeVerticesData(T){this._vertexBuffers[T]&&(this._vertexBuffers[T].dispose(),delete this._vertexBuffers[T]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const F=T.getKind();this._vertexBuffers[F]&&X&&this._vertexBuffers[F].dispose(),T._buffer&&T._buffer._increaseReferences(),this._vertexBuffers[F]=T;const A=this._meshes,y=A.length;if(F===u.e.PositionKind){this._totalVertices=z??T._maxVerticesCount,this._updateExtend(T.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const X=this._extend&&this._extend.minimum||new b.j(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),F=this._extend&&this._extend.maximum||new b.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let T=0;T<y;T++){const z=A[T];z.buildBoundingInfo(X,F),z._createGlobalSubMesh(z.isUnIndexed),z.ze(!0),z.synchronizeInstances()}}this._notifyUpdate(F)}updateVerticesDataDirectly(T,z,X){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const F=this.getVertexBuffer(T);F&&(F.updateDirectly(z,X,b),this._notifyUpdate(T))}updateVerticesData(T,z){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const b=this.getVertexBuffer(T);b&&(b.update(z),T===u.e.PositionKind&&this.Ea(X,z),this._notifyUpdate(T))}Ea(T,z){if(T&&this._updateExtend(z),this._resetPointsArrayCache(),T){const T=this._meshes;for(const z of T){z.hasBoundingInfo?z.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):z.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const T=z.ue;for(const z of T)z.refreshBoundingInfo()}}}_bind(T,z,X,b){if(!T)return;void 0===z&&(z=this._indexBuffer);const F=this.getVertexBuffers();if(!F)return;if(z!=this._indexBuffer||!this._vertexArrayObjects&&!b)return void this._engine.bindBuffers(F,z,T,X);const A=b||this._vertexArrayObjects,u=this._engine;A[T.key]||(A[T.key]=u.recordVertexArrayObject(F,z,T,X)),u.bindVertexArrayObject(A[T.key],z)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(T,z,X){const b=this.getVertexBuffer(T);return b?b.getFloatData(this._totalVertices,X||z&&1!==this._meshes.length):null}copyVerticesData(T,z){const X=this.getVertexBuffer(T);if(!X)return;z[T]||(z[T]=new Float32Array(this._totalVertices*X.getSize()));const b=X.getData();b&&function(T,z,X,b,F,A,y,E){const v=z*u.e.GetTypeByteLength(X),k=y*z;if(E.length!==k)throw new Error("Output length is not valid");if(X===u.e.FLOAT&&F===v)if(T instanceof Array){const z=b/4;E.set(T,z)}else if(T instanceof ArrayBuffer){const z=new Float32Array(T,b,k);E.set(z)}else{const z=T.byteOffset+b;if(z%4)return H.e.Warn("CopyFloatData: copied misaligned data."),void E.set(new Float32Array(T.buffer.slice(z,z+4*k)));const X=new Float32Array(T.buffer,z,k);E.set(X)}else u.e.ForEach(T,b,F,z,X,k,A,((T,z)=>E[z]=T))}(b,X.getSize(),X.type,X.byteOffset,X.byteStride,X.normalized,this._totalVertices,z[T])}isVertexBufferUpdatable(T){const z=this._vertexBuffers[T];return!!z&&z.isUpdatable()}getVertexBuffer(T){return this.isReady()?this._vertexBuffers[T]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(T){return this._vertexBuffers?void 0!==this._vertexBuffers[T]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(T)}getVerticesDataKinds(){const T=[];let z;if(!this._vertexBuffers&&this._delayInfo)for(z in this._delayInfo)T.push(z);else for(z in this._vertexBuffers)T.push(z);return T}updateIndices(T,z){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const b=T.length!==this._indices.length;if(X||(this._indices=T.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,T,z),b)for(const T of this._meshes)T._createGlobalSubMesh(!0)}else this.setIndices(T,null,!0)}setIndexBuffer(T,z,X){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=T,this._totalVertices=z,this._totalIndices=X,T.is32Bits||(T.is32Bits=this._totalIndices>65535);for(const b of this._meshes)b._createGlobalSubMesh(!0),b.synchronizeInstances();this._notifyUpdate()}setIndices(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=T,this._indexBufferIsUpdatable=X,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,X,"Geometry_"+this.id+"_IndexBuffer")),void 0!=z&&(this._totalVertices=z);for(const F of this._meshes)F._createGlobalSubMesh(!b),F.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Ge(T,z){if(!this.isReady())return null;const X=this._indices;return z||T&&1!==this._meshes.length?X.slice():X}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;T&&this._vertexArrayObjects&&this._vertexArrayObjects[T.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[T.key]),delete this._vertexArrayObjects[T.key])}releaseForMesh(T,z){const X=this._meshes,b=X.indexOf(T);-1!==b&&(X.splice(b,1),this._vertexArrayObjects&&T._invalidateInstanceVertexArrayObject(),T._geometry=null,0===X.length&&z&&this.dispose())}Ca(T){if(T._geometry===this)return;const z=T._geometry;z&&z.releaseForMesh(T),this._vertexArrayObjects&&T._invalidateInstanceVertexArrayObject();const X=this._meshes;T._geometry=this,T._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),X.push(T),this.isReady()?this._applyToMesh(T):this._boundingInfo&&T.setBoundingInfo(this._boundingInfo)}_updateExtend(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!T&&(T=this.getVerticesData(u.e.PositionKind),!T))return;this._extend=(0,D.h)(T,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(T){const z=this._meshes.length;for(const X in this._vertexBuffers)1===z&&this._vertexBuffers[X].create(),X===u.e.PositionKind&&(this._extend||this._updateExtend(),T.buildBoundingInfo(this._extend.minimum,this._extend.maximum),T._createGlobalSubMesh(T.isUnIndexed),T.Ea());1===z&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),T._syncGeometryWithMorphTargetManager(),T.synchronizeInstances()}_notifyUpdate(T){this.onGeometryUpdated&&this.onGeometryUpdated(this,T),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const z of this._meshes)z._markSubMeshesAsAttributesDirty()}load(T,z){2!==this.delayLoadState&&(this.isReady()?z&&z():(this.delayLoadState=2,this._queueLoad(T,z)))}_queueLoad(T,z){this.delayLoadingFile&&(T.addPendingData(this),T._loadFile(this.delayLoadingFile,(X=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(X),this),this.delayLoadState=1,this._delayInfo=[],T.removePendingData(this);const b=this._meshes,F=b.length;for(let T=0;T<F;T++)this._applyToMesh(b[T]);z&&z()}),void 0,!0))}toLeftHanded(){const T=this.Ge(!1);if(null!=T&&T.length>0){for(let z=0;z<T.length;z+=3){const X=T[z+0];T[z+0]=T[z+2],T[z+2]=X}this.setIndices(T)}const z=this.getVerticesData(u.e.PositionKind,!1);if(null!=z&&z.length>0){for(let T=0;T<z.length;T+=3)z[T+2]=-z[T+2];this.Ga(u.e.PositionKind,z,!1)}const X=this.getVerticesData(u.e.NormalKind,!1);if(null!=X&&X.length>0){for(let T=0;T<X.length;T+=3)X[T+2]=-X[T+2];this.Ga(u.e.NormalKind,X,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const T=this.getVerticesData(u.e.PositionKind);if(!T||0===T.length)return!1;for(let z=3*this._positionsCache.length,X=this._positionsCache.length;z<T.length;z+=3,++X)this._positionsCache[X]=b.j.xd(T,z);for(let z=0,X=0;z<T.length;z+=3,++X)this._positionsCache[X].set(T[0+z],T[1+z],T[2+z]);return this._positionsCache.length=T.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const X in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[X]);this._vertexArrayObjects={};const T=this._meshes,z=T.length;for(let X=0;X<z;X++)T[X]._invalidateInstanceVertexArrayObject()}}dispose(){const T=this._meshes,z=T.length;let X;for(X=0;X<z;X++)this.releaseForMesh(T[X]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const b in this._vertexBuffers)this._vertexBuffers[b].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const T=this._parentContainer.geometries.indexOf(this);T>-1&&this._parentContainer.geometries.splice(T,1),this._parentContainer=null}this._isDisposed=!0}j(T){const z=new A.e;z.indices=[];const X=this.Ge();if(X)for(let A=0;A<X.length;A++)z.indices.push(X[A]);let b,F=!1,u=!1;for(b in this._vertexBuffers){const T=this.getVerticesData(b);if(T&&(T instanceof Float32Array?z.set(new Float32Array(T),b):z.set(T.slice(0),b),!u)){const T=this.getVertexBuffer(b);T&&(F=T.isUpdatable(),u=!F)}}const y=new U(T,this._scene,z,F);for(b in y.delayLoadState=this.delayLoadState,y.delayLoadingFile=this.delayLoadingFile,y._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)y._delayInfo=y._delayInfo||[],y._delayInfo.push(b);return y._boundingInfo=new v.c(this._extend.minimum,this._extend.maximum),y}serialize(){const T={};return T.id=this.id,T.uniqueId=this.uniqueId,T.updatable=this._updatable,L.e&&L.e.HasTags(this)&&(T.tags=L.e.GetTags(this)),T}_toNumberArray(T){return Array.isArray(T)?T:Array.prototype.slice.call(T)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const T in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,T)&&(this._vertexBuffers[T]._buffer._data=null)}serializeVerticeData(){const T=this.serialize();return this.isVerticesDataPresent(u.e.PositionKind)&&(T.xa=this._toNumberArray(this.getVerticesData(u.e.PositionKind)),this.isVertexBufferUpdatable(u.e.PositionKind)&&(T.xa._updatable=!0)),this.isVerticesDataPresent(u.e.NormalKind)&&(T.ya=this._toNumberArray(this.getVerticesData(u.e.NormalKind)),this.isVertexBufferUpdatable(u.e.NormalKind)&&(T.ya._updatable=!0)),this.isVerticesDataPresent(u.e.TangentKind)&&(T.tangents=this._toNumberArray(this.getVerticesData(u.e.TangentKind)),this.isVertexBufferUpdatable(u.e.TangentKind)&&(T.tangents._updatable=!0)),this.isVerticesDataPresent(u.e.UVKind)&&(T.Aa=this._toNumberArray(this.getVerticesData(u.e.UVKind)),this.isVertexBufferUpdatable(u.e.UVKind)&&(T.Aa._updatable=!0)),this.isVerticesDataPresent(u.e.UV2Kind)&&(T.uvs2=this._toNumberArray(this.getVerticesData(u.e.UV2Kind)),this.isVertexBufferUpdatable(u.e.UV2Kind)&&(T.uvs2._updatable=!0)),this.isVerticesDataPresent(u.e.UV3Kind)&&(T.uvs3=this._toNumberArray(this.getVerticesData(u.e.UV3Kind)),this.isVertexBufferUpdatable(u.e.UV3Kind)&&(T.uvs3._updatable=!0)),this.isVerticesDataPresent(u.e.UV4Kind)&&(T.uvs4=this._toNumberArray(this.getVerticesData(u.e.UV4Kind)),this.isVertexBufferUpdatable(u.e.UV4Kind)&&(T.uvs4._updatable=!0)),this.isVerticesDataPresent(u.e.UV5Kind)&&(T.uvs5=this._toNumberArray(this.getVerticesData(u.e.UV5Kind)),this.isVertexBufferUpdatable(u.e.UV5Kind)&&(T.uvs5._updatable=!0)),this.isVerticesDataPresent(u.e.UV6Kind)&&(T.uvs6=this._toNumberArray(this.getVerticesData(u.e.UV6Kind)),this.isVertexBufferUpdatable(u.e.UV6Kind)&&(T.uvs6._updatable=!0)),this.isVerticesDataPresent(u.e.ColorKind)&&(T.za=this._toNumberArray(this.getVerticesData(u.e.ColorKind)),this.isVertexBufferUpdatable(u.e.ColorKind)&&(T.za._updatable=!0)),this.isVerticesDataPresent(u.e.MatricesIndicesKind)&&(T.matricesIndices=this._toNumberArray(this.getVerticesData(u.e.MatricesIndicesKind)),T.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(u.e.MatricesIndicesKind)&&(T.matricesIndices._updatable=!0)),this.isVerticesDataPresent(u.e.MatricesWeightsKind)&&(T.matricesWeights=this._toNumberArray(this.getVerticesData(u.e.MatricesWeightsKind)),this.isVertexBufferUpdatable(u.e.MatricesWeightsKind)&&(T.matricesWeights._updatable=!0)),T.indices=this._toNumberArray(this.Ge()),T}static ExtractFromMesh(T,z){const X=T._geometry;return X?X.j(z):null}static RandomId(){return k.g.RandomId()}static _GetGeometryByLoadedUniqueId(T,z){for(let X=0;X<z.geometries.length;X++)if(z.geometries[X]._loadedUniqueId===T)return z.geometries[X];return null}static _ImportGeometry(T,z){const X=z.va(),b=T.geometryUniqueId,A=T.geometryId;if(b||A){const T=b?this._GetGeometryByLoadedUniqueId(b,X):X.getGeometryById(A);T&&T.Ca(z)}else if(T instanceof ArrayBuffer){const X=z._binaryInfo;if(X.positionsAttrDesc&&X.positionsAttrDesc.count>0){const b=new Float32Array(T,X.positionsAttrDesc.offset,X.positionsAttrDesc.count);z.Ga(u.e.PositionKind,b,!1)}if(X.normalsAttrDesc&&X.normalsAttrDesc.count>0){const b=new Float32Array(T,X.normalsAttrDesc.offset,X.normalsAttrDesc.count);z.Ga(u.e.NormalKind,b,!1)}if(X.tangetsAttrDesc&&X.tangetsAttrDesc.count>0){const b=new Float32Array(T,X.tangetsAttrDesc.offset,X.tangetsAttrDesc.count);z.Ga(u.e.TangentKind,b,!1)}if(X.uvsAttrDesc&&X.uvsAttrDesc.count>0){const b=new Float32Array(T,X.uvsAttrDesc.offset,X.uvsAttrDesc.count);if(p.c)for(let T=1;T<b.length;T+=2)b[T]=1-b[T];z.Ga(u.e.UVKind,b,!1)}if(X.uvs2AttrDesc&&X.uvs2AttrDesc.count>0){const b=new Float32Array(T,X.uvs2AttrDesc.offset,X.uvs2AttrDesc.count);if(p.c)for(let T=1;T<b.length;T+=2)b[T]=1-b[T];z.Ga(u.e.UV2Kind,b,!1)}if(X.uvs3AttrDesc&&X.uvs3AttrDesc.count>0){const b=new Float32Array(T,X.uvs3AttrDesc.offset,X.uvs3AttrDesc.count);if(p.c)for(let T=1;T<b.length;T+=2)b[T]=1-b[T];z.Ga(u.e.UV3Kind,b,!1)}if(X.uvs4AttrDesc&&X.uvs4AttrDesc.count>0){const b=new Float32Array(T,X.uvs4AttrDesc.offset,X.uvs4AttrDesc.count);if(p.c)for(let T=1;T<b.length;T+=2)b[T]=1-b[T];z.Ga(u.e.UV4Kind,b,!1)}if(X.uvs5AttrDesc&&X.uvs5AttrDesc.count>0){const b=new Float32Array(T,X.uvs5AttrDesc.offset,X.uvs5AttrDesc.count);if(p.c)for(let T=1;T<b.length;T+=2)b[T]=1-b[T];z.Ga(u.e.UV5Kind,b,!1)}if(X.uvs6AttrDesc&&X.uvs6AttrDesc.count>0){const b=new Float32Array(T,X.uvs6AttrDesc.offset,X.uvs6AttrDesc.count);if(p.c)for(let T=1;T<b.length;T+=2)b[T]=1-b[T];z.Ga(u.e.UV6Kind,b,!1)}if(X.colorsAttrDesc&&X.colorsAttrDesc.count>0){const b=new Float32Array(T,X.colorsAttrDesc.offset,X.colorsAttrDesc.count);z.Ga(u.e.ColorKind,b,!1,X.colorsAttrDesc.stride)}if(X.matricesIndicesAttrDesc&&X.matricesIndicesAttrDesc.count>0){const b=new Int32Array(T,X.matricesIndicesAttrDesc.offset,X.matricesIndicesAttrDesc.count),F=[];for(let T=0;T<b.length;T++){const z=b[T];F.push(255&z),F.push((65280&z)>>8),F.push((16711680&z)>>16),F.push(z>>24&255)}z.Ga(u.e.MatricesIndicesKind,F,!1)}if(X.matricesIndicesExtraAttrDesc&&X.matricesIndicesExtraAttrDesc.count>0){const b=new Int32Array(T,X.matricesIndicesExtraAttrDesc.offset,X.matricesIndicesExtraAttrDesc.count),F=[];for(let T=0;T<b.length;T++){const z=b[T];F.push(255&z),F.push((65280&z)>>8),F.push((16711680&z)>>16),F.push(z>>24&255)}z.Ga(u.e.MatricesIndicesExtraKind,F,!1)}if(X.matricesWeightsAttrDesc&&X.matricesWeightsAttrDesc.count>0){const b=new Float32Array(T,X.matricesWeightsAttrDesc.offset,X.matricesWeightsAttrDesc.count);z.Ga(u.e.MatricesWeightsKind,b,!1)}if(X.indicesAttrDesc&&X.indicesAttrDesc.count>0){const b=new Int32Array(T,X.indicesAttrDesc.offset,X.indicesAttrDesc.count);z.setIndices(b,null)}if(X.subMeshesAttrDesc&&X.subMeshesAttrDesc.count>0){const b=new Int32Array(T,X.subMeshesAttrDesc.offset,5*X.subMeshesAttrDesc.count);z.ue=[];for(let T=0;T<X.subMeshesAttrDesc.count;T++){const X=b[5*T+0],F=b[5*T+1],A=b[5*T+2],u=b[5*T+3],E=b[5*T+4];y.c.AddToMesh(X,F,A,u,E,z)}}}else if(T.xa&&T.ya&&T.indices){if(z.Ga(u.e.PositionKind,T.xa,T.xa._updatable),z.Ga(u.e.NormalKind,T.ya,T.ya._updatable),T.tangents&&z.Ga(u.e.TangentKind,T.tangents,T.tangents._updatable),T.Aa&&z.Ga(u.e.UVKind,T.Aa,T.Aa._updatable),T.uvs2&&z.Ga(u.e.UV2Kind,T.uvs2,T.uvs2._updatable),T.uvs3&&z.Ga(u.e.UV3Kind,T.uvs3,T.uvs3._updatable),T.uvs4&&z.Ga(u.e.UV4Kind,T.uvs4,T.uvs4._updatable),T.uvs5&&z.Ga(u.e.UV5Kind,T.uvs5,T.uvs5._updatable),T.uvs6&&z.Ga(u.e.UV6Kind,T.uvs6,T.uvs6._updatable),T.za&&z.Ga(u.e.ColorKind,F.d.CheckColors4(T.za,T.xa.length/3),T.za._updatable),T.matricesIndices)if(T.matricesIndices._isExpanded)delete T.matricesIndices._isExpanded,z.Ga(u.e.MatricesIndicesKind,T.matricesIndices,T.matricesIndices._updatable);else{const X=[];for(let z=0;z<T.matricesIndices.length;z++){const b=T.matricesIndices[z];X.push(255&b),X.push((65280&b)>>8),X.push((16711680&b)>>16),X.push(b>>24&255)}z.Ga(u.e.MatricesIndicesKind,X,T.matricesIndices._updatable)}if(T.matricesIndicesExtra)if(T.matricesIndicesExtra._isExpanded)delete T.matricesIndices._isExpanded,z.Ga(u.e.MatricesIndicesExtraKind,T.matricesIndicesExtra,T.matricesIndicesExtra._updatable);else{const X=[];for(let z=0;z<T.matricesIndicesExtra.length;z++){const b=T.matricesIndicesExtra[z];X.push(255&b),X.push((65280&b)>>8),X.push((16711680&b)>>16),X.push(b>>24&255)}z.Ga(u.e.MatricesIndicesExtraKind,X,T.matricesIndicesExtra._updatable)}T.matricesWeights&&(U._CleanMatricesWeights(T,z),z.Ga(u.e.MatricesWeightsKind,T.matricesWeights,T.matricesWeights._updatable)),T.matricesWeightsExtra&&z.Ga(u.e.MatricesWeightsExtraKind,T.matricesWeightsExtra,T.matricesWeights._updatable),z.setIndices(T.indices,null)}if(T.ue){z.ue=[];for(let X=0;X<T.ue.length;X++){const b=T.ue[X];y.c.AddToMesh(b.materialIndex,b.verticesStart,b.verticesCount,b.indexStart,b.indexCount,z)}}z._shouldGenerateFlatShading&&(z.convertToFlatShadedMesh(),z._shouldGenerateFlatShading=!1),z.ze(!0),X.onMeshImportedObservable.notifyObservers(z)}static _CleanMatricesWeights(T,z){const X=.001;if(!E.d.CleanBoneMatrixWeights)return;let b=0;if(!(T.skeletonId>-1))return;{const X=z.va().getLastSkeletonById(T.skeletonId);if(!X)return;b=X.bones.length}const F=z.getVerticesData(u.e.MatricesIndicesKind),A=z.getVerticesData(u.e.MatricesIndicesExtraKind),y=T.matricesWeights,v=T.matricesWeightsExtra,k=T.numBoneInfluencer,L=y.length;for(let u=0;u<L;u+=4){let T=0,z=-1;for(let b=0;b<4;b++){const F=y[u+b];T+=F,F<X&&z<0&&(z=b)}if(v)for(let b=0;b<4;b++){const F=v[u+b];T+=F,F<X&&z<0&&(z=b+4)}if((z<0||z>k-1)&&(z=k-1),T>X){const z=1/T;for(let T=0;T<4;T++)y[u+T]*=z;if(v)for(let T=0;T<4;T++)v[u+T]*=z}else z>=4?(v[u+z-4]=1-T,A[u+z-4]=b):(y[u+z]=1-T,F[u+z]=b)}z.Ga(u.e.MatricesIndicesKind,F),T.matricesWeightsExtra&&z.Ga(u.e.MatricesIndicesExtraKind,A)}static Parse(T,z,X){const F=new U(T.id,z,void 0,T.updatable);return F._loadedUniqueId=T.uniqueId,L.e&&L.e.AddTagsTo(F,T.tags),T.delayLoadingFile?(F.delayLoadState=4,F.delayLoadingFile=X+T.delayLoadingFile,F._boundingInfo=new v.c(b.j.xd(T.boundingBoxMinimum),b.j.xd(T.boundingBoxMaximum)),F._delayInfo=[],T.hasUVs&&F._delayInfo.push(u.e.UVKind),T.hasUVs2&&F._delayInfo.push(u.e.UV2Kind),T.hasUVs3&&F._delayInfo.push(u.e.UV3Kind),T.hasUVs4&&F._delayInfo.push(u.e.UV4Kind),T.hasUVs5&&F._delayInfo.push(u.e.UV5Kind),T.hasUVs6&&F._delayInfo.push(u.e.UV6Kind),T.hasColors&&F._delayInfo.push(u.e.ColorKind),T.hasMatricesIndices&&F._delayInfo.push(u.e.MatricesIndicesKind),T.hasMatricesWeights&&F._delayInfo.push(u.e.MatricesWeightsKind),F._delayLoadingFunction=A.e.ImportVertexData):A.e.ImportVertexData(T,F),z.pushGeometry(F,!0),F}}},12515:(T,z,X)=>{"use strict";X.d(z,{d:()=>D});var b=X(976),F=X(1065),A=X(11970),u=X(11933),y=X(1168),E=X(11973),v=X(1207),k=X(1166),L=X(993);u.e._instancedMeshFactory=(T,z)=>{const X=new D(T,z);if(z.instancedBuffers){X.instancedBuffers={};for(const T in z.instancedBuffers)X.instancedBuffers[T]=z.instancedBuffers[T]}return X};class D extends A.c{constructor(T,z){super(T,z.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,z.Tj(this),this._sourceMesh=z,this._unIndexed=z._unIndexed,this.position.p(z.position),this.rotation.p(z.rotation),this.Pd.p(z.Pd),z.rotationQuaternion&&(this.rotationQuaternion=z.rotationQuaternion.clone()),this.animations=z.animations.slice();for(const X of z.getAnimationRanges())null!=X&&this.createAnimationRange(X.name,X.from,X.to);this.infiniteDistance=z.infiniteDistance,this.setPivotMatrix(z.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(T){var z;(null===(z=this._sourceMesh)||void 0===z?void 0:z.receiveShadows)!==T&&k.g.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(T){var z;(null===(z=this._sourceMesh)||void 0===z?void 0:z.material)!==T&&k.g.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(T){var z;(null===(z=this._sourceMesh)||void 0===z?void 0:z.visibility)!==T&&k.g.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(T){var z;(null===(z=this._sourceMesh)||void 0===z?void 0:z.skeleton)!==T&&k.g.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(T){this._sourceMesh&&T!==this._sourceMesh.renderingGroupId&&F.e.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}Db(T){return this._sourceMesh.Db(T)}isReady(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(T,!0)}getVerticesData(T,z,X){return this._sourceMesh.getVerticesData(T,z,X)}copyVerticesData(T,z){this._sourceMesh.copyVerticesData(T,z)}Ga(T,z,X,b){return this.sourceMesh&&this.sourceMesh.Ga(T,z,X,b),this.sourceMesh}updateVerticesData(T,z,X,b){return this.sourceMesh&&this.sourceMesh.updateVerticesData(T,z,X,b),this.sourceMesh}setIndices(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(T,z),this.sourceMesh}isVerticesDataPresent(T){return this._sourceMesh.isVerticesDataPresent(T)}Ge(){return this._sourceMesh.Ge()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let T,z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;T="object"===typeof z?z:{applySkeleton:z,applyMorph:X};const b=this._sourceMesh.Ee?this._sourceMesh.Ee.boundingBias:null;return this.Fa(this._sourceMesh._getData(T,null,v.e.PositionKind),b),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(T,z){if(super._activate(T,z),this._sourceMesh.ue||F.e.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,T),z){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==E.e.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new b.d);const T=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,b.f.Id[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.ze(!0)),this._currentLOD.position.p(b.f.Id[7]),this._currentLOD._masterMesh=T,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(T){if(!T)return this;const z=this.sourceMesh.getLODLevels();if(z&&0!==z.length){const z=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(T,z.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(T){return this.sourceMesh._preActivateForIntermediateRendering(T)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.ue)for(let T=0;T<this._sourceMesh.ue.length;T++)this._sourceMesh.ue[T].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2?arguments[2]:void 0;const b=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).Db(T);if(y.c.DeepCopy(this,b,["name","ue","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Ej","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),z&&(b.parent=z),!X)for(let F=0;F<this.va().meshes.length;F++){const T=this.va().meshes[F];T.parent===this&&T.clone(T.name,b)}return b.ze(!0),this.onClonedObservable.notifyObservers(b),b}dispose(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Sj(this),super.dispose(T,z)}_serializeAsParent(T){super._serializeAsParent(T),T.parentId=this._sourceMesh.uniqueId,T.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,z=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;const b=this.clone("Clone of "+(this.name||this.id),T||this.parent,!0,z&&z.newSourcedMesh);b&&X&&X(this,b);for(const F of this.getChildTransformNodes(!0))F.instantiateHierarchy(b,z,X);return b}}u.e.prototype.registerInstancedBuffer=function(T,z){var X,b;if(null===(X=this._userInstancedBuffersStorage)||void 0===X||null===(b=X.vertexBuffers[T])||void 0===b||b.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const T of this.instances)T.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[T]=null,this._userInstancedBuffersStorage.strides[T]=z,this._userInstancedBuffersStorage.sizes[T]=32*z,this._userInstancedBuffersStorage.data[T]=new Float32Array(this._userInstancedBuffersStorage.sizes[T]),this._userInstancedBuffersStorage.vertexBuffers[T]=new v.e(this.getEngine(),this._userInstancedBuffersStorage.data[T],T,!0,!1,z,!0);for(const F of this.instances)F.instancedBuffers[T]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},u.e.prototype._processInstancedBuffers=function(T,z){const X=T?T.length:0;for(const b in this.instancedBuffers){let F=this._userInstancedBuffersStorage.sizes[b];const A=this._userInstancedBuffersStorage.strides[b],u=(X+1)*A;for(;F<u;)F*=2;this._userInstancedBuffersStorage.data[b].length!=F&&(this._userInstancedBuffersStorage.data[b]=new Float32Array(F),this._userInstancedBuffersStorage.sizes[b]=F,this._userInstancedBuffersStorage.vertexBuffers[b]&&(this._userInstancedBuffersStorage.vertexBuffers[b].dispose(),this._userInstancedBuffersStorage.vertexBuffers[b]=null));const y=this._userInstancedBuffersStorage.data[b];let E=0;if(z){const T=this.instancedBuffers[b];T.toArray?T.toArray(y,E):T.copyToArray?T.copyToArray(y,E):y[E]=T,E+=A}for(let z=0;z<X;z++){const X=T[z].instancedBuffers[b];X.toArray?X.toArray(y,E):X.copyToArray?X.copyToArray(y,E):y[E]=X,E+=A}this._userInstancedBuffersStorage.vertexBuffers[b]?this._userInstancedBuffersStorage.vertexBuffers[b].updateDirectly(y,0):(this._userInstancedBuffersStorage.vertexBuffers[b]=new v.e(this.getEngine(),this._userInstancedBuffersStorage.data[b],b,!0,!1,A,!0),this._invalidateInstanceVertexArrayObject())}},u.e.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const T in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[T]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},u.e.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const T in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[T]&&this._userInstancedBuffersStorage.vertexBuffers[T].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,L.h)("BABYLON.InstancedMesh",D)},11933:(T,z,X)=>{"use strict";X.d(z,{e:()=>S,g:()=>C});var b=X(968),F=X(1166),A=X(1168),u=X(1128),y=X(11938),E=X(11944),v=X(976),k=X(1132),L=X(11948),D=X(1207),c=X(11955),p=X(11964),H=X(11970),U=X(1274),s=X(1271),x=X(11976),K=X(11966),d=X(1122),N=X(1065),l=X(993),a=X(1061),q=X(1221);class V{constructor(T,z){this.distanceOrScreenCoverage=T,this.mesh=z}}class C{}class G{constructor(){this.visibleInstances={},this.batchCache=new j,this.batchCacheReplacementModeInFrozenMode=new j,this.instancesBufferSize=2048}}class j{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class Z{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class m{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class S extends H.c{static _GetDefaultSideOrientation(T){return T||S.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(T){this._internalMeshDataInfo._useLODScreenCoverage=T,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(T){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==T&&(T&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(D.e.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(D.e.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=T,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new b.d),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new b.d),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new b.d),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new b.d),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new b.d),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(T){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(T)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(T){this._internalMeshDataInfo._forcedInstanceCount=T}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(T){this._internalMeshDataInfo._sideOrientation=T,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===T||!this._scene.useRightHandedSystem&&0===T}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(T){this.sideOrientation=T,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(T){this._internalMeshDataInfo._overrideRenderingFillMode=T}get material(){return this._internalAbstractMeshDataInfo._material}set material(T){T&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(T.sideOrientation=null),this._setMaterial(T)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(T){this._unIndexed!==T&&(this._unIndexed=T,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(T){this._instanceDataStorage.manualUpdate=T}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(T){this._instanceDataStorage.previousManualUpdate=T}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(T){this._instanceDataStorage.forceMatrixUpdates=T}_copySource(T,z){let X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const b=this.va();if(T._geometry&&T._geometry.Ca(this),A.c.DeepCopy(T,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Ee","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Ej","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=T,b.useClonedMeshMap&&(T._internalMeshDataInfo.meshMap||(T._internalMeshDataInfo.meshMap={}),T._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=T._originalBuilderSideOrientation,this._creationDataStorage=T._creationDataStorage,T._ranges){const z=T._ranges;for(const T in z)Object.prototype.hasOwnProperty.call(z,T)&&z[T]&&this.createAnimationRange(T,z[T].from,z[T].to)}if(T.metadata&&T.metadata.clone?this.metadata=T.metadata.clone():this.metadata=T.metadata,this._internalMetadata=T._internalMetadata,u.e&&u.e.HasTags(T)&&u.e.AddTagsTo(this,u.e.GetTags(T,!0)),this.Hg(T.isEnabled(!1)),this.parent=T.parent,this.setPivotMatrix(T.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+T.id,this.material=T.material,!z){const z=T.getDescendants(!0);for(let T=0;T<z.length;T++){const X=z[T];X.clone&&X.clone(this.name+"."+X.name,this)}}if(T.morphTargetManager&&(this.morphTargetManager=T.morphTargetManager),b.getPhysicsEngine){const z=b.getPhysicsEngine();if(X&&z)if(1===z.getPluginVersion()){const X=z.getImpostorForPhysicsObject(T);X&&(this.physicsImpostor=X.clone(this))}else 2===z.getPluginVersion()&&T.physicsBody&&T.physicsBody.clone(this)}for(let F=0;F<b.pe.length;F++){const z=b.pe[F];z.k===T&&z.clone(z.name,this)}this.skeleton=T.skeleton,this.refreshBoundingInfo(!0,!0),this.ze(!0)}constructor(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4?arguments[4]:void 0,u=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(T,z),this._internalMeshDataInfo=new m,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new G,this._thinInstanceDataStorage=new Z,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=S.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,z=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(T,z,X)=>{T&&X&&(this._uniformBuffer?this.transferToEffect(z):X.bindOnlyWorldMatrix(z))},F&&this._copySource(F,A,u),null!==X&&(this.parent=X),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=T=>{T.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new b.d(this._internalMeshDataInfo._onMeshReadyObserverAdded),F&&F.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,z=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;const b=0===this.getTotalVertices()||z&&z.doNotInstantiate&&(!0===z.doNotInstantiate||z.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),T||this.parent,!0):this.Db("instance of "+(this.name||this.id));b.parent=T||this.parent,b.position=this.position.clone(),b.Pd=this.Pd.clone(),this.rotationQuaternion?b.rotationQuaternion=this.rotationQuaternion.clone():b.rotation=this.rotation.clone(),X&&X(this,b);for(const F of this.getChildTransformNodes(!0))"InstancedMesh"===F.getClassName()&&"Mesh"===b.getClassName()&&F.sourceMesh===this?F.instantiateHierarchy(b,{doNotInstantiate:z&&z.doNotInstantiate||!1,newSourcedMesh:b},X):F.instantiateHierarchy(b,z,X);return b}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(T){let z=super.toString(T);if(z+=", n vertices: "+this.getTotalVertices(),z+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let X=0;X<this.animations.length;X++)z+=", animation[0]: "+this.animations[X].toString(T);if(T)if(this._geometry){const T=this.Ge(),X=this.getVerticesData(D.e.PositionKind);X&&T&&(z+=", flat shading: "+(X.length/3===T.length?"YES":"NO"))}else z+=", flat shading: UNKNOWN";return z}_unBindEffect(){super._unBindEffect();for(const T of this.instances)T._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const T=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((z,X)=>z.distanceOrScreenCoverage<X.distanceOrScreenCoverage?T:z.distanceOrScreenCoverage>X.distanceOrScreenCoverage?-T:0))}addLODLevel(T,z){if(z&&z._masterMesh)return N.e.Warn("You cannot use a mesh as LOD level twice"),this;const X=new V(T,z);return this._internalMeshDataInfo._LODLevels.push(X),z&&(z._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(T){const z=this._internalMeshDataInfo;for(let X=0;X<z._LODLevels.length;X++){const b=z._LODLevels[X];if(b.distanceOrScreenCoverage===T)return b.mesh}return null}removeLODLevel(T){const z=this._internalMeshDataInfo;for(let X=0;X<z._LODLevels.length;X++)z._LODLevels[X].mesh===T&&(z._LODLevels.splice(X,1),T&&(T._masterMesh=null));return this._sortLODLevels(),this}getLOD(T,z){const X=this._internalMeshDataInfo;if(!X._LODLevels||0===X._LODLevels.length)return this;const b=z||this.getBoundingInfo().boundingSphere,F=T.mode===E.c.ORTHOGRAPHIC_CAMERA?T.qj:b.centerWorld.Mc(T.globalPosition).length();let A=F,u=1;if(X._useLODScreenCoverage){const z=T.screenArea;let X=b.radiusWorld*T.qj/F;X=X*X*Math.PI,A=X/z,u=-1}if(u*X._LODLevels[X._LODLevels.length-1].distanceOrScreenCoverage>u*A)return this.onLODLevelSelection&&this.onLODLevelSelection(A,this,this),this;for(let y=0;y<X._LODLevels.length;y++){const T=X._LODLevels[y];if(u*T.distanceOrScreenCoverage<u*A){if(T.mesh){if(4===T.mesh.delayLoadState)return T.mesh._checkDelayState(),this;if(2===T.mesh.delayLoadState)return this;T.mesh._preActivate(),T.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(A,this,T.mesh),T.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(A,this,this),this}get Ee(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(T,z,X,b){var F,A;if(!this._geometry)return null;let u=b||null===(F=this._userInstancedBuffersStorage)||void 0===F||null===(A=F.vertexBuffers[T])||void 0===A?void 0:A.getFloatData(this.instances.length+1,X||z&&1!==this._geometry.meshes.length);return u||(u=this._geometry.getVerticesData(T,z,X)),u}copyVerticesData(T,z){this._geometry&&this._geometry.copyVerticesData(T,z)}getVertexBuffer(T,z){var X;return this._geometry?(z||null===(X=this._userInstancedBuffersStorage)||void 0===X?void 0:X.vertexBuffers[T])??this._geometry.getVertexBuffer(T):null}isVerticesDataPresent(T,z){var X;return this._geometry?!z&&void 0!==(null===(X=this._userInstancedBuffersStorage)||void 0===X?void 0:X.vertexBuffers[T])||this._geometry.isVerticesDataPresent(T):!!this._delayInfo&&-1!==this._delayInfo.indexOf(T)}isVertexBufferUpdatable(T,z){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(T);if(!z){var X;const z=null===(X=this._userInstancedBuffersStorage)||void 0===X?void 0:X.vertexBuffers[T];if(z)return z.isUpdatable()}return this._geometry.isVertexBufferUpdatable(T)}getVerticesDataKinds(T){if(!this._geometry){const T=[];return this._delayInfo&&this._delayInfo.forEach((function(z){T.push(z)})),T}const z=this._geometry.getVerticesDataKinds();if(!T&&this._userInstancedBuffersStorage)for(const X in this._userInstancedBuffersStorage.vertexBuffers)-1===z.indexOf(X)&&z.push(X);return z}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Ge(T,z){return this._geometry?this._geometry.Ge(T,z):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(T))return!1;if(!this.ue||0===this.ue.length)return!0;if(!T)return!0;const X=this.getEngine(),b=this.va(),F=z||X.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.ze();const A=this.material||b.defaultMaterial;if(A)if(A._storeEffectOnSubMeshes)for(const D of this.ue){const T=D.Ha();if(T)if(T._storeEffectOnSubMeshes){if(!T.isReadyForSubMesh(this,D,F))return!1}else if(!T.isReady(this,F))return!1}else if(!A.isReady(this,F))return!1;const u=X.currentRenderPassId;for(const D of this.lightSources){const T=D.getShadowGenerators();if(!T)continue;const z=T.values();for(let b=z.next();!0!==b.done;b=z.next()){var y,E,v,k;const T=b.value;if(T&&(null===(y=T.getShadowMap())||void 0===y||!y.renderList||null!==(E=T.getShadowMap())&&void 0!==E&&E.renderList&&-1!==(null===(v=T.getShadowMap())||void 0===v||null===(k=v.renderList)||void 0===k?void 0:k.indexOf(this)))){const z=T.getShadowMap().renderPassIds??[X.currentRenderPassId];for(let b=0;b<z.length;++b){X.currentRenderPassId=z[b];for(const z of this.ue){var L;if(!T.isReady(z,F,(null===(L=z.Ha())||void 0===L?void 0:L.needAlphaBlendingForMesh(this))??!1))return X.currentRenderPassId=u,!1}}X.currentRenderPassId=u}}}for(const D of this._internalMeshDataInfo._LODLevels)if(D.mesh&&!D.mesh.isReady(F))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}mi(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(T){this._instanceDataStorage.overridenInstanceCount=T}_preActivate(){const T=this._internalMeshDataInfo,z=this.va().getRenderId();return T._preActivateId===z||(T._preActivateId=z,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(T){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=T),this}_registerInstanceForRenderId(T,z){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:z,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[z]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=z,this._instanceDataStorage.visibleInstances[z]=new Array),this._instanceDataStorage.visibleInstances[z].push(T),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let T,z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;T="object"===typeof z?z:{applySkeleton:z,applyMorph:X};const b=this.Ee?this.Ee.boundingBias:null;return this.Fa(this._getData(T,null,D.e.PositionKind),b),this}_createGlobalSubMesh(T){const z=this.getTotalVertices();if(!z||!this.Ge())return null;if(this.ue&&this.ue.length>0){const X=this.Ge();if(!X)return null;const b=X.length;let F=!1;if(T)F=!0;else for(const T of this.ue){if(T.indexStart+T.indexCount>b){F=!0;break}if(T.verticesStart+T.verticesCount>z){F=!0;break}}if(!F)return this.ue[0]}return this.releaseSubMeshes(),new U.c(0,0,z,0,this.getTotalIndices(),this)}subdivide(T){if(T<1)return;const z=this.getTotalIndices();let X=z/T|0,b=0;for(;X%3!==0;)X++;this.releaseSubMeshes();for(let F=0;F<T&&!(b>=z);F++)U.c.CreateFromIndices(0,b,F===T-1?z-b:X,this,void 0,!1),b+=X;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(T,z){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(T,z,X,b);else{const b=new c.e;b.set(z,T);const F=this.va();new p.e(p.e.RandomId(),F,b,X,this)}return this}removeVerticesData(T){this._geometry&&this._geometry.removeVerticesData(T)}markVerticesDataAsUpdatable(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const X=this.getVertexBuffer(T);X&&X.isUpdatable()!==z&&this.Ga(T,this.getVerticesData(T),z)}setVerticesBuffer(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=p.e.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(T,null,z),this}updateVerticesData(T,z,X,b){return this._geometry?(b?(this.makeGeometryUnique(),this.updateVerticesData(T,z,X,!1)):this._geometry.updateVerticesData(T,z,X),this):this}updateMeshPositions(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const X=this.getVerticesData(D.e.PositionKind);if(!X)return this;if(T(X),this.updateVerticesData(D.e.PositionKind,X,!1,!1),z){const T=this.Ge(),z=this.getVerticesData(D.e.NormalKind);if(!z)return this;c.e.ComputeNormals(X,T,z),this.updateVerticesData(D.e.NormalKind,z,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const T=this._geometry,z=this._geometry.j(p.e.RandomId());return T.releaseForMesh(this,!0),z.Ca(this),this}setIndexBuffer(T,z,X){let b=this._geometry;b||(b=new p.e(p.e.RandomId(),this.va(),void 0,void 0,this)),b.setIndexBuffer(T,z,X)}setIndices(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(T,z,X,b);else{const z=new c.e;z.indices=T;const b=this.va();new p.e(p.e.RandomId(),b,z,X,this)}return this}updateIndices(T,z){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(T,z,X),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(T,z,X){let b=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const F=this.va().getEngine();let A;if(this._unIndexed)if(this._getRenderingFillMode(X)===s.d.WireFrameFillMode)A=T._getLinesIndexBuffer(this.Ge(),F);else A=null;else switch(this._getRenderingFillMode(X)){case s.d.PointFillMode:A=null;break;case s.d.WireFrameFillMode:A=T._getLinesIndexBuffer(this.Ge(),F);break;default:case s.d.TriangleFillMode:A=this._geometry.getIndexBuffer()}return this._bindDirect(z,A,b)}_bindDirect(T,z){let X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(T),X&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(T,z,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(T,z),this):this}_draw(T,z,X){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const b=this.va().getEngine();return this._unIndexed&&z!==s.d.WireFrameFillMode||z==s.d.PointFillMode?b.drawArraysType(z,T.verticesStart,T.verticesCount,this.forcedInstanceCount||X):z==s.d.WireFrameFillMode?b.drawElementsType(z,0,T._linesIndexCount,this.forcedInstanceCount||X):b.drawElementsType(z,T.indexStart,T.indexCount,this.forcedInstanceCount||X),this}registerBeforeRender(T){return this.onBeforeRenderObservable.add(T),this}unregisterBeforeRender(T){return this.onBeforeRenderObservable.removeCallback(T),this}registerAfterRender(T){return this.onAfterRenderObservable.add(T),this}unregisterAfterRender(T){return this.onAfterRenderObservable.removeCallback(T),this}_getInstancesRenderList(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(z)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[T]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[T]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const X=this.va(),b=X._isInIntermediateRendering(),F=b?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,A=this._instanceDataStorage.batchCache;if(A.mustReturn=!1,A.renderSelf[T]=z||!F&&this.isEnabled()&&this.isVisible,A.visibleInstances[T]=null,this._instanceDataStorage.visibleInstances&&!z){const z=this._instanceDataStorage.visibleInstances,F=X.getRenderId(),u=b?z.intermediateDefaultRenderId:z.defaultRenderId;A.visibleInstances[T]=z[F],!A.visibleInstances[T]&&u&&(A.visibleInstances[T]=z[u])}return A.hardwareInstancedRendering[T]=!z&&this._instanceDataStorage.hardwareInstancedRendering&&null!==A.visibleInstances[T]&&void 0!==A.visibleInstances[T],this._instanceDataStorage.previousBatch=A,A}_renderWithInstances(T,z,X,b,F){const A=X.visibleInstances[T._id],u=A?A.length:0,y=this._instanceDataStorage,E=y.instancesBufferSize;let k=y.instancesBuffer,L=y.instancesPreviousBuffer;const c=16*(u+1)*4;for(;y.instancesBufferSize<c;)y.instancesBufferSize*=2;y.instancesData&&E==y.instancesBufferSize||(y.instancesData=new Float32Array(y.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!y.instancesPreviousData||E!=y.instancesBufferSize)&&(y.instancesPreviousData=new Float32Array(y.instancesBufferSize/4));let p=0,H=0;const U=X.renderSelf[T._id],s=!k||E!==y.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!y.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||y.isFrozen&&!s)H=(U?1:0)+u;else{const z=this.getWorldMatrix();if(U&&(this._scene.needsPreviousWorldMatrices&&(y.masterMeshPreviousWorldMatrix?(y.masterMeshPreviousWorldMatrix.copyToArray(y.instancesPreviousData,p),y.masterMeshPreviousWorldMatrix.p(z)):(y.masterMeshPreviousWorldMatrix=z.clone(),y.masterMeshPreviousWorldMatrix.copyToArray(y.instancesPreviousData,p))),z.copyToArray(y.instancesData,p),p+=16,H++),A){var x;if(S.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(x=T.Ha())&&void 0!==x&&x.needAlphaBlendingForMesh(T.getRenderingMesh())){const T=this._scene.activeCamera.globalPosition;for(let z=0;z<A.length;z++){const X=A[z];X._distanceToCamera=v.j.Distance(X.getBoundingInfo().boundingSphere.centerWorld,T)}A.sort(((T,z)=>T._distanceToCamera>z._distanceToCamera?-1:T._distanceToCamera<z._distanceToCamera?1:0))}for(let T=0;T<A.length;T++){const z=A[T],X=z.getWorldMatrix();X.copyToArray(y.instancesData,p),this._scene.needsPreviousWorldMatrices&&(z._previousWorldMatrix?(z._previousWorldMatrix.copyToArray(y.instancesPreviousData,p),z._previousWorldMatrix.p(X)):(z._previousWorldMatrix=X.clone(),z._previousWorldMatrix.copyToArray(y.instancesPreviousData,p))),p+=16,H++}}}return s?(k&&k.dispose(),L&&L.dispose(),k=new D.b(F,y.instancesData,!0,16,!1,!0),y.instancesBuffer=k,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=k.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=k.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=k.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=k.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(L=new D.b(F,y.instancesPreviousData,!0,16,!1,!0),y.instancesPreviousBuffer=L,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=L.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=L.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=L.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=L.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(k.updateDirectly(y.instancesData,0,H),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||L.updateDirectly(y.instancesPreviousData,0,H)),this._processInstancedBuffers(A,U),this.va()._activeIndices.addCount(T.indexCount*H,!1),F._currentDrawContext&&(F._currentDrawContext.useInstancing=!0),this._bind(T,b,z),this._draw(T,z,H),!this._scene.needsPreviousWorldMatrices||s||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||L.updateDirectly(y.instancesData,0,H),F.unbindInstanceAttributes(),this}_renderWithThinInstances(T,z,X,b){var F;const A=(null===(F=this._thinInstanceDataStorage)||void 0===F?void 0:F.instancesCount)??0;this.va()._activeIndices.addCount(T.indexCount*A,!1),b._currentDrawContext&&(b._currentDrawContext.useInstancing=!0),this._bind(T,X,z),this._draw(T,z,A),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,A):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),b.unbindInstanceAttributes()}_processInstancedBuffers(T,z){}_processRendering(T,z,X,b,F,A,u,y){const E=this.va(),v=E.getEngine();if(b=this._getRenderingFillMode(b),A&&z.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(z,b,X,v),this;if(A)this._renderWithInstances(z,b,F,X,v);else{v._currentDrawContext&&(v._currentDrawContext.useInstancing=!1);let X=0;F.renderSelf[z._id]&&(u&&u(!1,T.getWorldMatrix(),y),X++,this._draw(z,b,this._instanceDataStorage.overridenInstanceCount));const A=F.visibleInstances[z._id];if(A){const T=A.length;X+=T;for(let X=0;X<T;X++){const T=A[X].getWorldMatrix();u&&u(!0,T,y),this._draw(z,b)}}E._activeIndices.addCount(z.indexCount*X,!1)}return this}_rebuild(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(T&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const z in this._userInstancedBuffersStorage.vertexBuffers){const X=this._userInstancedBuffersStorage.vertexBuffers[z];X&&(T&&X.dispose(),this._userInstancedBuffersStorage.vertexBuffers[z]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(T)}_freeze(){if(this.ue){for(let T=0;T<this.ue.length;T++)this._getInstancesRenderList(T);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(T,z,X,b){let F=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const A=this._scene.getEngine(),u=A.currentRenderPassId;if(void 0!==T&&(A.currentRenderPassId=T),b)(!F||F&&b.isInFrustum(this._scene._frustumPlanes))&&this.render(b,!!z,X);else for(let y=0;y<this.ue.length;y++){const T=this.ue[y];(!F||F&&T.isInFrustum(this._scene._frustumPlanes))&&this.render(T,!!z,X)}return void 0!==T&&(A.currentRenderPassId=u),this}directRender(){if(!this.ue)return this;for(const T of this.ue)this.render(T,!1);return this}render(T,z,X){var b,F,A;const u=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const y=(null===(b=u.activeCameras)||void 0===b?void 0:b.length)??0;if((y>1&&u.activeCamera===u.activeCameras[0]||y<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const E=this._getInstancesRenderList(T._id,!!X);if(E.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const v=u.getEngine();let k=0,L=null;this.ignoreCameraMaxZ&&u.activeCamera&&!u._isInIntermediateRendering()&&(k=u.activeCamera.maxZ,L=u.activeCamera,u.activeCamera.maxZ=0,u.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const D=T.getRenderingMesh(),c=E.hardwareInstancedRendering[T._id]||D.hasThinInstances||!!this._userInstancedBuffersStorage&&!T.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,p=this._instanceDataStorage,H=T.Ha();if(!H)return L&&(L.maxZ=k,u.updateTransformMatrix(!0)),this;if(p.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===H){if(H._storeEffectOnSubMeshes&&(null===(F=T._drawWrapper)||void 0===F||!F._wasPreviouslyReady)||!H._storeEffectOnSubMeshes&&!H._getDrawWrapper()._wasPreviouslyReady)return L&&(L.maxZ=k,u.updateTransformMatrix(!0)),this}else{if(H._storeEffectOnSubMeshes){if(!H.isReadyForSubMesh(this,T,c))return L&&(L.maxZ=k,u.updateTransformMatrix(!0)),this}else if(!H.isReady(this,c))return L&&(L.maxZ=k,u.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=H}let U;z&&v.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),U=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?T._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const x=(null===(A=U)||void 0===A?void 0:A.effect)??null;for(const s of u._beforeRenderingMeshStage)s.action(this,T,E,x);if(!U||!x)return L&&(L.maxZ=k,u.updateTransformMatrix(!0)),this;const K=X||this;let d;if(p.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Ke&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)d=p.sideOrientation;else{const T=K._getWorldMatrixDeterminant();d=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),T<0&&(d=d===s.d.ClockWiseSideOrientation?s.d.CounterClockWiseSideOrientation:s.d.ClockWiseSideOrientation),p.sideOrientation=d}const N=this._internalMeshDataInfo._effectiveMaterial._preBind(U,d);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&v.setDepthWrite(!0);const l=this._internalMeshDataInfo._effectiveMaterial,a=l.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),c||this._bind(T,x,a,!1);const q=K.getWorldMatrix();l._storeEffectOnSubMeshes?l.bindForSubMesh(q,this,T):l.bind(q,this),!l.Ke&&l.separateCullingPass&&(v.setState(!0,l.zOffset,!1,!N,l.cullBackFaces,l.stencil,l.zOffsetUnits),this._processRendering(this,T,x,a,E,c,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),v.setState(!0,l.zOffset,!1,N,l.cullBackFaces,l.stencil,l.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(T)),this._processRendering(this,T,x,a,E,c,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const s of u._afterRenderingMeshStage)s.action(this,T,E,x);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),L&&(L.maxZ=k,u.updateTransformMatrix(!0)),2!==u.performancePriority||p.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(D.e.MatricesWeightsKind)&&(this.isVerticesDataPresent(D.e.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const T=this.getVerticesData(D.e.MatricesWeightsKind),z=T.length;for(let X=0;X<z;X+=4){const z=T[X]+T[X+1]+T[X+2]+T[X+3];if(0===z)T[X]=1;else{const b=1/z;T[X]*=b,T[X+1]*=b,T[X+2]*=b,T[X+3]*=b}}this.Ga(D.e.MatricesWeightsKind,T)}_normalizeSkinWeightsAndExtra(){const T=this.getVerticesData(D.e.MatricesWeightsExtraKind),z=this.getVerticesData(D.e.MatricesWeightsKind),X=z.length;for(let b=0;b<X;b+=4){let X=z[b]+z[b+1]+z[b+2]+z[b+3];if(X+=T[b]+T[b+1]+T[b+2]+T[b+3],0===X)z[b]=1;else{const F=1/X;z[b]*=F,z[b+1]*=F,z[b+2]*=F,z[b+3]*=F,T[b]*=F,T[b+1]*=F,T[b+2]*=F,T[b+3]*=F}}this.Ga(D.e.MatricesWeightsKind,z),this.Ga(D.e.MatricesWeightsKind,T)}validateSkinning(){const T=this.getVerticesData(D.e.MatricesWeightsExtraKind),z=this.getVerticesData(D.e.MatricesWeightsKind);if(null===z||null==this.skeleton)return{skinned:!1,valid:!0,Sd:"not skinned"};const X=z.length;let b=0,F=0,A=0,u=0;const y=null===T?4:8,E=[];for(let D=0;D<=y;D++)E[D]=0;for(let D=0;D<X;D+=4){let X=z[D],v=X,k=0===v?0:1;for(let F=1;F<y;F++){const A=F<4?z[D+F]:T[D+F-4];A>X&&b++,0!==A&&k++,v+=A,X=A}if(E[k]++,k>A&&(A=k),0===v)F++;else{const X=1/v;let b=0;for(let F=0;F<y;F++)b+=F<4?Math.abs(z[D+F]-z[D+F]*X):Math.abs(T[D+F-4]-T[D+F-4]*X);b>.001&&u++}}const v=this.skeleton.bones.length,k=this.getVerticesData(D.e.MatricesIndicesKind),L=this.getVerticesData(D.e.MatricesIndicesExtraKind);let c=0;for(let D=0;D<X;D+=4)for(let T=0;T<y;T++){const z=T<4?k[D+T]:L[D+T-4];(z>=v||z<0)&&c++}return{skinned:!0,valid:0===F&&0===u&&0===c,Sd:"Number of Weights = "+X/4+"\nMaximum influences = "+A+"\nMissing Weights = "+F+"\nNot Sorted = "+b+"\nNot Normalized = "+u+"\nWeightCounts = ["+E+"]\nNumber of bones = "+v+"\nBad Bone Indices = "+c}}_checkDelayState(){const T=this.va();return this._geometry?this._geometry.load(T):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(T)),this}_queueLoad(T){T.addPendingData(this);const z=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return F.g.LoadFile(this.delayLoadingFile,(z=>{z instanceof ArrayBuffer?this._delayLoadingFunction(z,this):this._delayLoadingFunction(JSON.parse(z),this),this.instances.forEach((T=>{T.refreshBoundingInfo(),T._syncSubMeshes()})),this.delayLoadState=1,T.removePendingData(this)}),(()=>{}),T.offlineProvider,z),this}isInFrustum(T){return 2!==this.delayLoadState&&(!!super.isInFrustum(T)&&(this._checkDelayState(),!0))}setMaterialById(T){const z=this.va().materials;let X;for(X=z.length-1;X>-1;X--)if(z[X].id===T)return this.material=z[X],this;const b=this.va().multiMaterials;for(X=b.length-1;X>-1;X--)if(b[X].id===T)return this.material=b[X],this;return this}getAnimatables(){const T=[];return this.material&&T.push(this.material),this.skeleton&&T.push(this.skeleton),T}bakeTransformIntoVertices(T){if(!this.isVerticesDataPresent(D.e.PositionKind))return this;const z=this.ue.splice(0);this._resetPointsArrayCache();let X=this.getVerticesData(D.e.PositionKind);const b=v.j.Zero();let F;for(F=0;F<X.length;F+=3)v.j.TransformCoordinatesFromFloatsToRef(X[F],X[F+1],X[F+2],T,b).toArray(X,F);if(this.Ga(D.e.PositionKind,X,this.getVertexBuffer(D.e.PositionKind).isUpdatable()),this.isVerticesDataPresent(D.e.NormalKind)){for(X=this.getVerticesData(D.e.NormalKind),F=0;F<X.length;F+=3)v.j.TransformNormalFromFloatsToRef(X[F],X[F+1],X[F+2],T,b).normalize().toArray(X,F);this.Ga(D.e.NormalKind,X,this.getVertexBuffer(D.e.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(D.e.TangentKind)){for(X=this.getVerticesData(D.e.TangentKind),F=0;F<X.length;F+=4)v.j.TransformNormalFromFloatsToRef(X[F],X[F+1],X[F+2],T,b).normalize().toArray(X,F);this.Ga(D.e.TangentKind,X,this.getVertexBuffer(D.e.TangentKind).isUpdatable())}return T.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.ue=z,this}bakeCurrentTransformIntoVertices(){let T=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.ze(!0)),this.resetLocalMatrix(T),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,z=arguments.length>2?arguments[2]:void 0,X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new S(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),T,this,z,X)}dispose(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const X=this._internalMeshDataInfo;if(X._onBeforeDrawObservable&&X._onBeforeDrawObservable.clear(),X._onBeforeBindObservable&&X._onBeforeBindObservable.clear(),X._onBeforeRenderObservable&&X._onBeforeRenderObservable.clear(),X._onAfterRenderObservable&&X._onAfterRenderObservable.clear(),X._onBetweenPassObservable&&X._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(X.meshMap)for(const T in X.meshMap){const z=X.meshMap[T];z&&(z._internalMeshDataInfo._source=null,X.meshMap[T]=void 0)}X._source&&X._source._internalMeshDataInfo.meshMap&&(X._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const T=this.va().meshes;for(const z of T){const T=z;T._internalMeshDataInfo&&T._internalMeshDataInfo._source&&T._internalMeshDataInfo._source===this&&(T._internalMeshDataInfo._source=null)}}X._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(T,z)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(T,z,X,b,A,u){let y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7?arguments[7]:void 0;const v=this.va();return F.g.LoadImage(T,(T=>{const F=T.width,E=T.height,v=this.getEngine().createCanvas(F,E).getContext("2d");v.drawImage(T,0,0);const k=v.getImageData(0,0,F,E).data;this.applyDisplacementMapFromBuffer(k,F,E,z,X,A,u,y),b&&b(this)}),E||(()=>{}),v.offlineProvider),this}applyDisplacementMapFromBuffer(T,z,X,b,F,A,u){let y=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(D.e.PositionKind)||!this.isVerticesDataPresent(D.e.NormalKind)||!this.isVerticesDataPresent(D.e.UVKind))return N.e.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const E=this.getVerticesData(D.e.PositionKind,!0,!0),k=this.getVerticesData(D.e.NormalKind),L=this.getVerticesData(D.e.UVKind);let p=v.j.Zero();const H=v.j.Zero(),U=v.i.Zero();A=A||v.i.Zero(),u=u||new v.i(1,1);for(let D=0;D<E.length;D+=3){v.j.FromArrayToRef(E,D,p),v.j.FromArrayToRef(k,D,H),v.i.FromArrayToRef(L,D/3*2,U);const y=4*((Math.abs(U.x*u.x+A.x%1)*(z-1)%z|0)+(Math.abs(U.y*u.y+A.y%1)*(X-1)%X|0)*z),c=.3*(T[y]/255)+.59*(T[y+1]/255)+.11*(T[y+2]/255);H.normalize(),H.scaleInPlace(b+(F-b)*c),p=p.add(H),p.toArray(E,D)}return c.e.ComputeNormals(E,this.Ge(),k),y?(this.Ga(D.e.PositionKind,E),this.Ga(D.e.NormalKind,k),this.Ga(D.e.UVKind,L)):(this.updateVerticesData(D.e.PositionKind,E),this.updateVerticesData(D.e.NormalKind,k)),this}_getFlattenedNormals(T,z){const X=new Float32Array(3*T.length);let b=0;const F=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let A=0;A<T.length;A+=3){const u=v.j.xd(z,3*T[A]),y=v.j.xd(z,3*T[A+1]),E=v.j.xd(z,3*T[A+2]),k=u.Mc(y),L=E.Mc(y),D=v.j.Normalize(v.j.Cross(k,L));F&&D.scaleInPlace(-1);for(let T=0;T<3;T++)X[b++]=D.x,X[b++]=D.y,X[b++]=D.z}return X}_convertToUnIndexedMesh(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const z=this.getVerticesDataKinds().filter((T=>{var z;return!(null!==(z=this.getVertexBuffer(T))&&void 0!==z&&z.getIsInstanced())})),X=this.Ge(),b={},F=(T,z)=>{const b=new Float32Array(X.length*z);let F=0;for(let A=0;A<X.length;A++)for(let u=0;u<z;u++)b[F++]=T[X[A]*z+u];return b},A=this.getBoundingInfo(),u=this.Ee?this.ue.slice(0):[];for(const y of z)b[y]=this.getVerticesData(y);for(const y of z){const z=this.getVertexBuffer(y),A=z.getSize();if(T&&y===D.e.NormalKind){const T=this._getFlattenedNormals(X,b[D.e.PositionKind]);this.Ga(D.e.NormalKind,T,z.isUpdatable(),A)}else this.Ga(y,F(b[y],A),z.isUpdatable(),A)}if(this.morphTargetManager){for(let z=0;z<this.morphTargetManager.numTargets;z++){const b=this.morphTargetManager.getTarget(z),A=b.getPositions();b.setPositions(F(A,3));const u=b.getNormals();u&&b.setNormals(T?this._getFlattenedNormals(X,A):F(u,3));const y=b.getTangents();y&&b.setTangents(F(y,3));const E=b.getUVs();E&&b.setUVs(F(E,2))}this.morphTargetManager.synchronize()}for(let y=0;y<X.length;y++)X[y]=y;this.setIndices(X),this._unIndexed=!0,this.releaseSubMeshes();for(const y of u){const T=y.getBoundingInfo();U.c.AddToMesh(y.materialIndex,y.indexStart,y.indexCount,y.indexStart,y.indexCount,this).setBoundingInfo(T)}return this.setBoundingInfo(A),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const z=c.e.ExtractFromMesh(this);let X;if(T&&this.isVerticesDataPresent(D.e.NormalKind)&&z.ya){for(X=0;X<z.ya.length;X++)z.ya[X]*=-1;this.Ga(D.e.NormalKind,z.ya,this.isVertexBufferUpdatable(D.e.NormalKind))}if(z.indices){let T;for(X=0;X<z.indices.length;X+=3)T=z.indices[X+1],z.indices[X+1]=z.indices[X+2],z.indices[X+2]=T;this.setIndices(z.indices,null,this.isVertexBufferUpdatable(D.e.PositionKind),!0)}return this}increaseVertices(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const z=c.e.ExtractFromMesh(this),X=z.indices&&!Array.isArray(z.indices)&&Array.from?Array.from(z.indices):z.indices,b=z.xa&&!Array.isArray(z.xa)&&Array.from?Array.from(z.xa):z.xa,F=z.Aa&&!Array.isArray(z.Aa)&&Array.from?Array.from(z.Aa):z.Aa,A=z.ya&&!Array.isArray(z.ya)&&Array.from?Array.from(z.ya):z.ya;if(X&&b){z.indices=X,z.xa=b,F&&(z.Aa=F),A&&(z.ya=A);const u=T+1,y=new Array;for(let T=0;T<u+1;T++)y[T]=new Array;let E,k;const L=new v.j(0,0,0),c=new v.j(0,0,0),p=new v.i(0,0),H=new Array,U=new Array,s=new Array;let x,K,d,N=b.length;F&&(K=F.length),A&&(d=A.length);for(let T=0;T<X.length;T+=3){U[0]=X[T],U[1]=X[T+1],U[2]=X[T+2];for(let T=0;T<3;T++)if(E=U[T],k=U[(T+1)%3],void 0===s[E]&&void 0===s[k]?(s[E]=new Array,s[k]=new Array):(void 0===s[E]&&(s[E]=new Array),void 0===s[k]&&(s[k]=new Array)),void 0===s[E][k]&&void 0===s[k][E]){s[E][k]=[],L.x=(b[3*k]-b[3*E])/u,L.y=(b[3*k+1]-b[3*E+1])/u,L.z=(b[3*k+2]-b[3*E+2])/u,A&&(c.x=(A[3*k]-A[3*E])/u,c.y=(A[3*k+1]-A[3*E+1])/u,c.z=(A[3*k+2]-A[3*E+2])/u),F&&(p.x=(F[2*k]-F[2*E])/u,p.y=(F[2*k+1]-F[2*E+1])/u),s[E][k].push(E);for(let T=1;T<u;T++)s[E][k].push(b.length/3),b[N++]=b[3*E]+T*L.x,b[N++]=b[3*E+1]+T*L.y,b[N++]=b[3*E+2]+T*L.z,A&&(A[d++]=A[3*E]+T*c.x,A[d++]=A[3*E+1]+T*c.y,A[d++]=A[3*E+2]+T*c.z),F&&(F[K++]=F[2*E]+T*p.x,F[K++]=F[2*E+1]+T*p.y);s[E][k].push(k),s[k][E]=new Array,x=s[E][k].length;for(let T=0;T<x;T++)s[k][E][T]=s[E][k][x-1-T]}y[0][0]=X[T],y[1][0]=s[X[T]][X[T+1]][1],y[1][1]=s[X[T]][X[T+2]][1];for(let z=2;z<u;z++){y[z][0]=s[X[T]][X[T+1]][z],y[z][z]=s[X[T]][X[T+2]][z],L.x=(b[3*y[z][z]]-b[3*y[z][0]])/z,L.y=(b[3*y[z][z]+1]-b[3*y[z][0]+1])/z,L.z=(b[3*y[z][z]+2]-b[3*y[z][0]+2])/z,A&&(c.x=(A[3*y[z][z]]-A[3*y[z][0]])/z,c.y=(A[3*y[z][z]+1]-A[3*y[z][0]+1])/z,c.z=(A[3*y[z][z]+2]-A[3*y[z][0]+2])/z),F&&(p.x=(F[2*y[z][z]]-F[2*y[z][0]])/z,p.y=(F[2*y[z][z]+1]-F[2*y[z][0]+1])/z);for(let T=1;T<z;T++)y[z][T]=b.length/3,b[N++]=b[3*y[z][0]]+T*L.x,b[N++]=b[3*y[z][0]+1]+T*L.y,b[N++]=b[3*y[z][0]+2]+T*L.z,A&&(A[d++]=A[3*y[z][0]]+T*c.x,A[d++]=A[3*y[z][0]+1]+T*c.y,A[d++]=A[3*y[z][0]+2]+T*c.z),F&&(F[K++]=F[2*y[z][0]]+T*p.x,F[K++]=F[2*y[z][0]+1]+T*p.y)}y[u]=s[X[T+1]][X[T+2]],H.push(y[0][0],y[1][0],y[1][1]);for(let T=1;T<u;T++){let z;for(z=0;z<T;z++)H.push(y[T][z],y[T+1][z],y[T+1][z+1]),H.push(y[T][z],y[T+1][z+1],y[T][z+1]);H.push(y[T][z],y[T+1][z],y[T+1][z+1])}}z.indices=H,z.Ca(this,this.isVertexBufferUpdatable(D.e.PositionKind))}else N.e.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const T=c.e.ExtractFromMesh(this),z=T.Aa,X=T.indices,b=T.xa,F=T.za,A=T.matricesIndices,u=T.matricesWeights,y=T.matricesIndicesExtra,E=T.matricesWeightsExtra;if(void 0===X||void 0===b||null===X||null===b)N.e.Warn("VertexData contains empty entries");else{const v=new Array,k=new Array,L=new Array,p=new Array,H=new Array,U=new Array,s=new Array,x=new Array;let K=new Array,d=0;const N={};let l,a;for(let T=0;T<X.length;T+=3){a=[X[T],X[T+1],X[T+2]],K=[];for(let T=0;T<3;T++){K[T]="";for(let z=0;z<3;z++)Math.abs(b[3*a[T]+z])<1e-8&&(b[3*a[T]+z]=0),K[T]+=b[3*a[T]+z]+"|"}if(K[0]!=K[1]&&K[0]!=K[2]&&K[1]!=K[2])for(let T=0;T<3;T++){if(l=N[K[T]],void 0===l){N[K[T]]=d,l=d++;for(let z=0;z<3;z++)v.push(b[3*a[T]+z]);if(null!==F&&void 0!==F)for(let z=0;z<4;z++)p.push(F[4*a[T]+z]);if(null!==z&&void 0!==z)for(let X=0;X<2;X++)L.push(z[2*a[T]+X]);if(null!==A&&void 0!==A)for(let z=0;z<4;z++)H.push(A[4*a[T]+z]);if(null!==u&&void 0!==u)for(let z=0;z<4;z++)U.push(u[4*a[T]+z]);if(null!==y&&void 0!==y)for(let z=0;z<4;z++)s.push(y[4*a[T]+z]);if(null!==E&&void 0!==E)for(let z=0;z<4;z++)x.push(E[4*a[T]+z])}k.push(l)}}const q=new Array;c.e.ComputeNormals(v,k,q),T.xa=v,T.indices=k,T.ya=q,null!==z&&void 0!==z&&(T.Aa=L),null!==F&&void 0!==F&&(T.za=p),null!==A&&void 0!==A&&(T.matricesIndices=H),null!==u&&void 0!==u&&(T.matricesWeights=U),null!==y&&void 0!==y&&(T.matricesIndicesExtra=s),null!==u&&void 0!==u&&(T.matricesWeightsExtra=x),T.Ca(this,this.isVertexBufferUpdatable(D.e.PositionKind))}}static _instancedMeshFactory(T,z){throw(0,a.d)("InstancedMesh")}static _PhysicsImpostorParser(T,z,X){throw(0,a.d)("PhysicsImpostor")}Db(T){const z=S._instancedMeshFactory(T,this);return z.parent=this.parent,z}synchronizeInstances(){for(let T=0;T<this.instances.length;T++){this.instances[T]._syncSubMeshes()}return this}optimizeIndices(T){const z=this.Ge(),X=this.getVerticesData(D.e.PositionKind);if(!X||!z)return this;const b=[];for(let F=0;F<X.length;F+=3)b.push(v.j.xd(X,F));const A=[];return F.d.SyncAsyncForLoop(b.length,40,(T=>{const z=b.length-1-T,X=b[z];for(let F=0;F<z;++F){const T=b[F];if(X.equals(T)){A[z]=F;break}}}),(()=>{for(let T=0;T<z.length;++T)z[T]=A[z[T]]||z[T];const X=this.ue.slice(0);this.setIndices(z),this.ue=X,T&&T(this)})),this}serialize(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};T.name=this.name,T.id=this.id,T.uniqueId=this.uniqueId,T.type=this.getClassName(),u.e&&u.e.HasTags(this)&&(T.tags=u.e.GetTags(this)),T.position=this.position.zd(),this.rotationQuaternion?T.rotationQuaternion=this.rotationQuaternion.zd():this.rotation&&(T.rotation=this.rotation.zd()),T.Pd=this.Pd.zd(),this._postMultiplyPivotMatrix?T.pivotMatrix=this.getPivotMatrix().zd():T.localMatrix=this.getPivotMatrix().zd(),T.isEnabled=this.isEnabled(!1),T.isVisible=this.isVisible,T.infiniteDistance=this.infiniteDistance,T.pickable=this.de,T.receiveShadows=this.receiveShadows,T.billboardMode=this.billboardMode,T.visibility=this.visibility,T.Be=this.Be,T.checkCollisions=this.checkCollisions,T.ellipsoid=this.ellipsoid.zd(),T.ellipsoidOffset=this.ellipsoidOffset.zd(),T.Da=this.Da,T.isBlocker=this.isBlocker,T.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(T),T.isUnIndexed=this.isUnIndexed;const z=this._geometry;if(z&&this.ue){T.geometryUniqueId=z.uniqueId,T.geometryId=z.id,T.ue=[];for(let z=0;z<this.ue.length;z++){const X=this.ue[z];T.ue.push({materialIndex:X.materialIndex,verticesStart:X.verticesStart,verticesCount:X.verticesCount,indexStart:X.indexStart,indexCount:X.indexCount})}}if(this.material?this.material.doNotSerialize||(T.materialUniqueId=this.material.uniqueId,T.materialId=this.material.id):(this.material=null,T.materialUniqueId=this._scene.defaultMaterial.uniqueId,T.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(T.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(T.skeletonId=this.skeleton.id,T.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(q.b.NAME_PHYSICSENGINE)){const z=this.getPhysicsImpostor();z&&(T.physicsMass=z.getParam("mass"),T.physicsFriction=z.getParam("friction"),T.physicsRestitution=z.getParam("mass"),T.physicsImpostor=z.type)}this.metadata&&(T.metadata=this.metadata),T.instances=[];for(let X=0;X<this.instances.length;X++){const z=this.instances[X];if(z.doNotSerialize)continue;const b={name:z.name,id:z.id,isEnabled:z.isEnabled(!1),isVisible:z.isVisible,de:z.de,checkCollisions:z.checkCollisions,position:z.position.zd(),Pd:z.Pd.zd()};if(z.parent&&z.parent._serializeAsParent(b),z.rotationQuaternion?b.rotationQuaternion=z.rotationQuaternion.zd():z.rotation&&(b.rotation=z.rotation.zd()),this.va()._getComponent(q.b.NAME_PHYSICSENGINE)){const T=z.getPhysicsImpostor();T&&(b.physicsMass=T.getParam("mass"),b.physicsFriction=T.getParam("friction"),b.physicsRestitution=T.getParam("mass"),b.physicsImpostor=T.type)}z.metadata&&(b.metadata=z.metadata),z.actionManager&&(b.actions=z.actionManager.serialize(z.name)),T.instances.push(b),d.b.AppendSerializedAnimations(z,b),b.ranges=z.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(T.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const z={data:{},sizes:{},strides:{}};for(const T in this._userThinInstanceBuffersStorage.data)z.data[T]=Array.from(this._userThinInstanceBuffersStorage.data[T]),z.sizes[T]=this._userThinInstanceBuffersStorage.sizes[T],z.strides[T]=this._userThinInstanceBuffersStorage.strides[T];T.thinInstances.userThinInstance=z}return d.b.AppendSerializedAnimations(this,T),T.ranges=this.serializeAnimationRanges(),T.layerMask=this.layerMask,T.alphaIndex=this.alphaIndex,T.hasVertexAlpha=this.hasVertexAlpha,T.overlayAlpha=this.overlayAlpha,T.overlayColor=this.overlayColor.zd(),T.renderOverlay=this.renderOverlay,T.applyFog=this.applyFog,this.actionManager&&(T.actions=this.actionManager.serialize(this.name)),T}_syncGeometryWithMorphTargetManager(){if(!this.Ee)return;this._markSubMeshesAsAttributesDirty();const T=this._internalAbstractMeshDataInfo._morphTargetManager;if(T&&T.vertexCount){if(T.vertexCount!==this.getTotalVertices())return N.e.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(T.isUsingTextureForTargets)return;for(let z=0;z<T.numInfluencers;z++){const X=T.getActiveTarget(z),b=X.getPositions();if(!b)return void N.e.Error("Invalid morph target. Target must have positions.");this.Ee.Ga(D.e.PositionKind+z,b,!1,3);const F=X.getNormals();F&&this.Ee.Ga(D.e.NormalKind+z,F,!1,3);const A=X.getTangents();A&&this.Ee.Ga(D.e.TangentKind+z,A,!1,3);const u=X.getUVs();u&&this.Ee.Ga(D.e.UVKind+"_"+z,u,!1,2)}}else{let T=0;for(;this.Ee.isVerticesDataPresent(D.e.PositionKind+T);)this.Ee.removeVerticesData(D.e.PositionKind+T),this.Ee.isVerticesDataPresent(D.e.NormalKind+T)&&this.Ee.removeVerticesData(D.e.NormalKind+T),this.Ee.isVerticesDataPresent(D.e.TangentKind+T)&&this.Ee.removeVerticesData(D.e.TangentKind+T),this.Ee.isVerticesDataPresent(D.e.UVKind+T)&&this.Ee.removeVerticesData(D.e.UVKind+"_"+T),T++}}static Parse(T,z,X){let b;if(b=T.type&&"LinesMesh"===T.type?S._LinesMeshParser(T,z):T.type&&"GroundMesh"===T.type?S._GroundMeshParser(T,z):T.type&&"GoldbergMesh"===T.type?S._GoldbergMeshParser(T,z):T.type&&"GreasedLineMesh"===T.type?S._GreasedLineMeshParser(T,z):T.type&&"TrailMesh"===T.type?S._TrailMeshParser(T,z):new S(T.name,z),b.id=T.id,b._waitingParsedUniqueId=T.uniqueId,u.e&&u.e.AddTagsTo(b,T.tags),b.position=v.j.xd(T.position),void 0!==T.metadata&&(b.metadata=T.metadata),T.rotationQuaternion?b.rotationQuaternion=v.e.xd(T.rotationQuaternion):T.rotation&&(b.rotation=v.j.xd(T.rotation)),b.Pd=v.j.xd(T.Pd),T.localMatrix?b.setPreTransformMatrix(v.d.xd(T.localMatrix)):T.pivotMatrix&&b.setPivotMatrix(v.d.xd(T.pivotMatrix)),b.Hg(T.isEnabled),b.isVisible=T.isVisible,b.infiniteDistance=T.infiniteDistance,b.Be=!!T.Be,b.showBoundingBox=T.showBoundingBox,b.showSubMeshesBoundingBox=T.showSubMeshesBoundingBox,void 0!==T.applyFog&&(b.applyFog=T.applyFog),void 0!==T.pickable&&(b.de=T.pickable),void 0!==T.alphaIndex&&(b.alphaIndex=T.alphaIndex),b.receiveShadows=T.receiveShadows,void 0!==T.billboardMode&&(b.billboardMode=T.billboardMode),void 0!==T.visibility&&(b.visibility=T.visibility),b.checkCollisions=T.checkCollisions,b.Da=!!T.Da,T.ellipsoid&&(b.ellipsoid=v.j.xd(T.ellipsoid)),T.ellipsoidOffset&&(b.ellipsoidOffset=v.j.xd(T.ellipsoidOffset)),null!=T.overrideMaterialSideOrientation&&(b.sideOrientation=T.overrideMaterialSideOrientation),void 0!==T.sideOrientation&&(b.sideOrientation=T.sideOrientation),void 0!==T.isBlocker&&(b.isBlocker=T.isBlocker),b._shouldGenerateFlatShading=T.useFlatShading,T.oi&&(b._waitingData.oi=T.oi),void 0!==T.parentId&&(b._waitingParentId=T.parentId),void 0!==T.parentInstanceIndex&&(b._waitingParentInstanceIndex=T.parentInstanceIndex),void 0!==T.actions&&(b._waitingData.actions=T.actions),void 0!==T.overlayAlpha&&(b.overlayAlpha=T.overlayAlpha),void 0!==T.overlayColor&&(b.overlayColor=k.b.xd(T.overlayColor)),void 0!==T.renderOverlay&&(b.renderOverlay=T.renderOverlay),b.isUnIndexed=!!T.isUnIndexed,b.hasVertexAlpha=T.hasVertexAlpha,T.delayLoadingFile?(b.delayLoadState=4,b.delayLoadingFile=X+T.delayLoadingFile,b.buildBoundingInfo(v.j.xd(T.boundingBoxMinimum),v.j.xd(T.boundingBoxMaximum)),T._binaryInfo&&(b._binaryInfo=T._binaryInfo),b._delayInfo=[],T.hasUVs&&b._delayInfo.push(D.e.UVKind),T.hasUVs2&&b._delayInfo.push(D.e.UV2Kind),T.hasUVs3&&b._delayInfo.push(D.e.UV3Kind),T.hasUVs4&&b._delayInfo.push(D.e.UV4Kind),T.hasUVs5&&b._delayInfo.push(D.e.UV5Kind),T.hasUVs6&&b._delayInfo.push(D.e.UV6Kind),T.hasColors&&b._delayInfo.push(D.e.ColorKind),T.hasMatricesIndices&&b._delayInfo.push(D.e.MatricesIndicesKind),T.hasMatricesWeights&&b._delayInfo.push(D.e.MatricesWeightsKind),b._delayLoadingFunction=p.e._ImportGeometry,K.d.ForceFullSceneLoadingForIncremental&&b._checkDelayState()):p.e._ImportGeometry(T,b),T.materialUniqueId?b._waitingMaterialId=T.materialUniqueId:T.materialId&&(b._waitingMaterialId=T.materialId),T.morphTargetManagerId>-1&&(b._waitingMorphTargetManagerId=T.morphTargetManagerId),void 0!==T.skeletonId&&null!==T.skeletonId&&(b.skeleton=z.getLastSkeletonById(T.skeletonId),T.numBoneInfluencers&&(b.numBoneInfluencers=T.numBoneInfluencers)),T.animations){for(let z=0;z<T.animations.length;z++){const X=T.animations[z],F=(0,l.e)("BABYLON.Animation");F&&b.animations.push(F.Parse(X))}L.b.ParseAnimationRanges(b,T,z)}if(T.autoAnimate&&z.beginAnimation(b,T.autoAnimateFrom,T.autoAnimateTo,T.autoAnimateLoop,T.autoAnimateSpeed||1),T.layerMask&&!isNaN(T.layerMask)?b.layerMask=Math.abs(parseInt(T.layerMask)):b.layerMask=268435455,T.physicsImpostor&&(b.physicsImpostor=S._PhysicsImpostorParser(z,b,T)),T.lodMeshIds&&(b._waitingData.lods={ids:T.lodMeshIds,distances:T.lodDistances?T.lodDistances:null,coverages:T.lodCoverages?T.lodCoverages:null}),T.instances)for(let F=0;F<T.instances.length;F++){const X=T.instances[F],A=b.Db(X.name);if(X.id&&(A.id=X.id),u.e&&(X.tags?u.e.AddTagsTo(A,X.tags):u.e.AddTagsTo(A,T.tags)),A.position=v.j.xd(X.position),void 0!==X.metadata&&(A.metadata=X.metadata),void 0!==X.parentId&&(A._waitingParentId=X.parentId),void 0!==X.parentInstanceIndex&&(A._waitingParentInstanceIndex=X.parentInstanceIndex),void 0!==X.isEnabled&&null!==X.isEnabled&&A.Hg(X.isEnabled),void 0!==X.isVisible&&null!==X.isVisible&&(A.isVisible=X.isVisible),void 0!==X.de&&null!==X.de&&(A.de=X.de),X.rotationQuaternion?A.rotationQuaternion=v.e.xd(X.rotationQuaternion):X.rotation&&(A.rotation=v.j.xd(X.rotation)),A.Pd=v.j.xd(X.Pd),void 0!=X.checkCollisions&&null!=X.checkCollisions&&(A.checkCollisions=X.checkCollisions),void 0!=X.pickable&&null!=X.pickable&&(A.de=X.pickable),void 0!=X.showBoundingBox&&null!=X.showBoundingBox&&(A.showBoundingBox=X.showBoundingBox),void 0!=X.showSubMeshesBoundingBox&&null!=X.showSubMeshesBoundingBox&&(A.showSubMeshesBoundingBox=X.showSubMeshesBoundingBox),void 0!=X.alphaIndex&&null!=X.showSubMeshesBoundingBox&&(A.alphaIndex=X.alphaIndex),X.physicsImpostor&&(A.physicsImpostor=S._PhysicsImpostorParser(z,A,X)),void 0!==X.actions&&(A._waitingData.actions=X.actions),X.animations){for(let T=0;T<X.animations.length;T++){const z=X.animations[T],b=(0,l.e)("BABYLON.Animation");b&&A.animations.push(b.Parse(z))}L.b.ParseAnimationRanges(A,X,z),X.autoAnimate&&z.beginAnimation(A,X.autoAnimateFrom,X.autoAnimateTo,X.autoAnimateLoop,X.autoAnimateSpeed||1)}}if(T.thinInstances){const z=T.thinInstances;if(b.thinInstanceEnablePicking=!!z.enablePicking,z.matrixData?(b.bk("matrix",new Float32Array(z.matrixData),16,!1),b._thinInstanceDataStorage.matrixBufferSize=z.matrixBufferSize,b._thinInstanceDataStorage.instancesCount=z.instancesCount):b._thinInstanceDataStorage.matrixBufferSize=z.matrixBufferSize,T.thinInstances.userThinInstance){const z=T.thinInstances.userThinInstance;for(const T in z.data)b.bk(T,new Float32Array(z.data[T]),z.strides[T],!1),b._userThinInstanceBuffersStorage.sizes[T]=z.sizes[T]}}return b}setPositionsForCPUSkinning(){const T=this._internalMeshDataInfo;if(!T._sourcePositions){const z=this.getVerticesData(D.e.PositionKind);if(!z)return T._sourcePositions;T._sourcePositions=new Float32Array(z),this.isVertexBufferUpdatable(D.e.PositionKind)||this.Ga(D.e.PositionKind,z,!0)}return T._sourcePositions}setNormalsForCPUSkinning(){const T=this._internalMeshDataInfo;if(!T._sourceNormals){const z=this.getVerticesData(D.e.NormalKind);if(!z)return T._sourceNormals;T._sourceNormals=new Float32Array(z),this.isVertexBufferUpdatable(D.e.NormalKind)||this.Ga(D.e.NormalKind,z,!0)}return T._sourceNormals}applySkeleton(T){if(!this.Ee)return this;if(this.Ee._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.Ee._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(D.e.PositionKind))return this;if(!this.isVerticesDataPresent(D.e.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(D.e.MatricesWeightsKind))return this;const z=this.isVerticesDataPresent(D.e.NormalKind),X=this._internalMeshDataInfo;if(!X._sourcePositions){const T=this.ue.slice();this.setPositionsForCPUSkinning(),this.ue=T}z&&!X._sourceNormals&&this.setNormalsForCPUSkinning();let b=this.getVerticesData(D.e.PositionKind);if(!b)return this;b instanceof Float32Array||(b=new Float32Array(b));let F=this.getVerticesData(D.e.NormalKind);if(z){if(!F)return this;F instanceof Float32Array||(F=new Float32Array(F))}const A=this.getVerticesData(D.e.MatricesIndicesKind),u=this.getVerticesData(D.e.MatricesWeightsKind);if(!u||!A)return this;const y=this.numBoneInfluencers>4,E=y?this.getVerticesData(D.e.MatricesIndicesExtraKind):null,k=y?this.getVerticesData(D.e.MatricesWeightsExtraKind):null,L=T.getTransformMatrices(this),c=v.j.Zero(),p=new v.d,H=new v.d;let U,s=0;for(let D=0;D<b.length;D+=3,s+=4){let T;for(U=0;U<4;U++)T=u[s+U],T>0&&(v.d.FromFloat32ArrayToRefScaled(L,Math.floor(16*A[s+U]),T,H),p.addToSelf(H));if(y)for(U=0;U<4;U++)T=k[s+U],T>0&&(v.d.FromFloat32ArrayToRefScaled(L,Math.floor(16*E[s+U]),T,H),p.addToSelf(H));v.j.TransformCoordinatesFromFloatsToRef(X._sourcePositions[D],X._sourcePositions[D+1],X._sourcePositions[D+2],p,c),c.toArray(b,D),z&&(v.j.TransformNormalFromFloatsToRef(X._sourceNormals[D],X._sourceNormals[D+1],X._sourceNormals[D+2],p,c),c.toArray(F,D)),p.reset()}return this.updateVerticesData(D.e.PositionKind,b),z&&this.updateVerticesData(D.e.NormalKind,F),this}static MinMax(T){let z=null,X=null;return T.forEach((function(T){const b=T.getBoundingInfo().boundingBox;z&&X?(z.minimizeInPlace(b.minimumWorld),X.maximizeInPlace(b.maximumWorld)):(z=b.minimumWorld,X=b.maximumWorld)})),z&&X?{min:z,max:X}:{min:v.j.Zero(),max:v.j.Zero()}}static Center(T){const z=T instanceof Array?S.MinMax(T):T;return v.j.Center(z.min,z.max)}static MergeMeshes(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],X=arguments.length>2?arguments[2]:void 0,b=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0,A=arguments.length>5?arguments[5]:void 0;return(0,y.k)(S._MergeMeshesCoroutine(T,z,X,b,F,A,!1))}static MergeMeshesAsync(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],X=arguments.length>2?arguments[2]:void 0,b=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0,A=arguments.length>5?arguments[5]:void 0;return(0,y.j)(S._MergeMeshesCoroutine(T,z,X,b,F,A,!0),(0,y.e)())}static*_MergeMeshesCoroutine(T){let z,X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=arguments.length>2?arguments[2]:void 0,F=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0,y=arguments.length>6?arguments[6]:void 0;if(0===(T=T.filter(Boolean)).length)return null;if(!b){let X=0;for(z=0;z<T.length;z++)if(X+=T[z].getTotalVertices(),X>=65536)return N.e.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}u&&(A=!1);const E=new Array,v=new Array,k=new Array,L=T[0].sideOrientation;for(z=0;z<T.length;z++){const X=T[z];if(X.isAnInstance)return N.e.Warn("Cannot merge instance meshes."),null;if(L!==X.sideOrientation)return N.e.Warn("Cannot merge meshes with different sideOrientation values."),null;if(A&&k.push(X.getTotalIndices()),u)if(X.material){const T=X.material;if(T instanceof x.c){for(let z=0;z<T.Gg.length;z++)E.indexOf(T.Gg[z])<0&&E.push(T.Gg[z]);for(let z=0;z<X.ue.length;z++)v.push(E.indexOf(T.Gg[X.ue[z].materialIndex])),k.push(X.ue[z].indexCount)}else{E.indexOf(T)<0&&E.push(T);for(let z=0;z<X.ue.length;z++)v.push(E.indexOf(T)),k.push(X.ue[z].indexCount)}}else for(let T=0;T<X.ue.length;T++)v.push(0),k.push(X.ue[T].indexCount)}const D=T[0],p=T=>{const z=T.ze(!0);return{vertexData:c.e.ExtractFromMesh(T,!1,!1),transform:z}},{vertexData:H,transform:s}=p(D);y&&(yield);const K=new Array(T.length-1);for(let c=1;c<T.length;c++)K[c-1]=p(T[c]),y&&(yield);const d=H._mergeCoroutine(s,K,b,y,!X);let l=d.next();for(;!l.done;)y&&(yield),l=d.next();const a=l.value;F||(F=new S(D.name+"_merged",D.va()));const q=a._applyToCoroutine(F,void 0,y);let V=q.next();for(;!V.done;)y&&(yield),V=q.next();if(F.checkCollisions=D.checkCollisions,F.sideOrientation=D.sideOrientation,X)for(z=0;z<T.length;z++)T[z].dispose();if(A||u){F.releaseSubMeshes(),z=0;let T=0;for(;z<k.length;)U.c.CreateFromIndices(0,T,k[z],F,void 0,!1),T+=k[z],z++;for(const z of F.ue)z.refreshBoundingInfo();F.ze(!0)}if(u){const T=new x.c(D.name+"_merged",D.va());T.Gg=E;for(let z=0;z<F.ue.length;z++)F.ue[z].materialIndex=v[z];F.material=T}else F.material=D.material;return F}Tj(T){T._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(T)}Sj(T){const z=T._indexInSourceMeshInstanceArray;if(-1!=z){if(z!==this.instances.length-1){const T=this.instances[this.instances.length-1];this.instances[z]=T,T._indexInSourceMeshInstanceArray=z}T._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===s.d.CounterClockWiseSideOrientation}_getRenderingFillMode(T){const z=this.va();return z.forcePointsCloud?s.d.PointFillMode:z.forceWireframe?s.d.WireFrameFillMode:this.overrideRenderingFillMode??T}setMaterialByID(T){return this.setMaterialById(T)}static CreateRibbon(T,z,X,b,F,A,u,y,E){throw new Error("Import MeshBuilder to populate this function")}static kb(T,z,X,b,F,A){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(T,z,X,b,F){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(T,z,X,b,F,A){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(T,z,X,b){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(T,z,X,b,F,A,u,y,E){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(T,z,X,b,F,A,u){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(T,z,X,b,F,A,u,y,E,v){throw new Error("Import MeshBuilder to populate this function")}static lb(T,z,X,b,F){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(T,z,X,b,F,A,u,y){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(T,z,X,b,F,A,u){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(T,z,X,b,F,A,u,y){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(T,z,X,b,F,A,u,y,E,v){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(T,z,X,b,F,A,u,y,E,v,k,L){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(T,z,X,b,F,A,u){throw new Error("Import MeshBuilder to populate this function")}static Ig(T,z,X,b,F){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(T,z,X,b,F,A){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(T,z,X,b,F,A,u,y,E){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(T,z,X,b,F,A,u,y,E,v,k){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(T,z,X,b,F,A,u,y,E,v){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(T,z,X){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(T,z,X){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(T,z,X,b,F,A){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(T,z,X){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(T){throw new Error("Import MeshBuilder to populate this function")}}S.FRONTSIDE=c.e.FRONTSIDE,S.BACKSIDE=c.e.BACKSIDE,S.DOUBLESIDE=c.e.DOUBLESIDE,S.DEFAULTSIDE=c.e.DEFAULTSIDE,S.NO_CAP=0,S.CAP_START=1,S.CAP_END=2,S.CAP_ALL=3,S.NO_FLIP=0,S.FLIP_TILE=1,S.ROTATE_TILE=2,S.FLIP_ROW=3,S.ROTATE_ROW=4,S.FLIP_N_ROTATE_TILE=5,S.FLIP_N_ROTATE_ROW=6,S.CENTER=0,S.LEFT=1,S.RIGHT=2,S.TOP=3,S.BOTTOM=4,S.INSTANCEDMESH_SORT_TRANSPARENT=!1,S._GroundMeshParser=(T,z)=>{throw(0,a.d)("GroundMesh")},S._GoldbergMeshParser=(T,z)=>{throw(0,a.d)("GoldbergMesh")},S._LinesMeshParser=(T,z)=>{throw(0,a.d)("LinesMesh")},S._GreasedLineMeshParser=(T,z)=>{throw(0,a.d)("GreasedLineMesh")},S._GreasedLineRibbonMeshParser=(T,z)=>{throw(0,a.d)("GreasedLineRibbonMesh")},S._TrailMeshParser=(T,z)=>{throw(0,a.d)("TrailMesh")},(0,l.h)("BABYLON.Mesh",S)},11955:(T,z,X)=>{"use strict";X.d(z,{e:()=>p});var b=X(952),F=X(976),A=X(1207),u=X(1061),y=X(1132),E=X(1065),v=X(957),k=X(11938),L=X(1039),D=X(1274);class c{}class p{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,k.f)(this._applyToCoroutine.bind(this)),this.uniqueId=p._UniqueIDGenerator,p._UniqueIDGenerator++}set(T,z){switch(T.length||E.e.Warn(`Setting vertex data kind '${z}' with an empty array`),z){case A.e.PositionKind:this.xa=T;break;case A.e.NormalKind:this.ya=T;break;case A.e.TangentKind:this.tangents=T;break;case A.e.UVKind:this.Aa=T;break;case A.e.UV2Kind:this.uvs2=T;break;case A.e.UV3Kind:this.uvs3=T;break;case A.e.UV4Kind:this.uvs4=T;break;case A.e.UV5Kind:this.uvs5=T;break;case A.e.UV6Kind:this.uvs6=T;break;case A.e.ColorKind:this.za=T;break;case A.e.MatricesIndicesKind:this.matricesIndices=T;break;case A.e.MatricesWeightsKind:this.matricesWeights=T;break;case A.e.MatricesIndicesExtraKind:this.matricesIndicesExtra=T;break;case A.e.MatricesWeightsExtraKind:this.matricesWeightsExtra=T}}Ca(T,z){return this._applyTo(T,z,!1),this}applyToGeometry(T,z){return this._applyTo(T,z,!1),this}updateMesh(T){return this._update(T),this}updateGeometry(T){return this._update(T),this}*_applyToCoroutine(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2?arguments[2]:void 0;if(this.xa&&(T.Ga(A.e.PositionKind,this.xa,z),X&&(yield)),this.ya&&(T.Ga(A.e.NormalKind,this.ya,z),X&&(yield)),this.tangents&&(T.Ga(A.e.TangentKind,this.tangents,z),X&&(yield)),this.Aa&&(T.Ga(A.e.UVKind,this.Aa,z),X&&(yield)),this.uvs2&&(T.Ga(A.e.UV2Kind,this.uvs2,z),X&&(yield)),this.uvs3&&(T.Ga(A.e.UV3Kind,this.uvs3,z),X&&(yield)),this.uvs4&&(T.Ga(A.e.UV4Kind,this.uvs4,z),X&&(yield)),this.uvs5&&(T.Ga(A.e.UV5Kind,this.uvs5,z),X&&(yield)),this.uvs6&&(T.Ga(A.e.UV6Kind,this.uvs6,z),X&&(yield)),this.za&&(T.Ga(A.e.ColorKind,this.za,z),this.hasVertexAlpha&&void 0!==T.hasVertexAlpha&&(T.hasVertexAlpha=!0),X&&(yield)),this.matricesIndices&&(T.Ga(A.e.MatricesIndicesKind,this.matricesIndices,z),X&&(yield)),this.matricesWeights&&(T.Ga(A.e.MatricesWeightsKind,this.matricesWeights,z),X&&(yield)),this.matricesIndicesExtra&&(T.Ga(A.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,z),X&&(yield)),this.matricesWeightsExtra&&(T.Ga(A.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,z),X&&(yield)),this.indices?(T.setIndices(this.indices,null,z),X&&(yield)):T.setIndices([],null),T.ue&&this.materialInfos&&this.materialInfos.length>1){const z=T;z.ue=[];for(const T of this.materialInfos)new D.c(T.materialIndex,T.verticesStart,T.verticesCount,T.indexStart,T.indexCount,z)}return this}_update(T,z,X){return this.xa&&T.updateVerticesData(A.e.PositionKind,this.xa,z,X),this.ya&&T.updateVerticesData(A.e.NormalKind,this.ya,z,X),this.tangents&&T.updateVerticesData(A.e.TangentKind,this.tangents,z,X),this.Aa&&T.updateVerticesData(A.e.UVKind,this.Aa,z,X),this.uvs2&&T.updateVerticesData(A.e.UV2Kind,this.uvs2,z,X),this.uvs3&&T.updateVerticesData(A.e.UV3Kind,this.uvs3,z,X),this.uvs4&&T.updateVerticesData(A.e.UV4Kind,this.uvs4,z,X),this.uvs5&&T.updateVerticesData(A.e.UV5Kind,this.uvs5,z,X),this.uvs6&&T.updateVerticesData(A.e.UV6Kind,this.uvs6,z,X),this.za&&T.updateVerticesData(A.e.ColorKind,this.za,z,X),this.matricesIndices&&T.updateVerticesData(A.e.MatricesIndicesKind,this.matricesIndices,z,X),this.matricesWeights&&T.updateVerticesData(A.e.MatricesWeightsKind,this.matricesWeights,z,X),this.matricesIndicesExtra&&T.updateVerticesData(A.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,z,X),this.matricesWeightsExtra&&T.updateVerticesData(A.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,z,X),this.indices&&T.setIndices(this.indices,null),this}static _TransformVector3Coordinates(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T.length;const A=F.f.Id[0],u=F.f.Id[1];for(let y=X;y<X+b;y+=3)F.j.FromArrayToRef(T,y,A),F.j.TransformCoordinatesToRef(A,z,u),T[y]=u.x,T[y+1]=u.y,T[y+2]=u.z}static _TransformVector3Normals(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T.length;const A=F.f.Id[0],u=F.f.Id[1];for(let y=X;y<X+b;y+=3)F.j.FromArrayToRef(T,y,A),F.j.TransformNormalToRef(A,z,u),T[y]=u.x,T[y+1]=u.y,T[y+2]=u.z}static _TransformVector4Normals(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T.length;const A=F.f.Vector4[0],u=F.f.Vector4[1];for(let y=X;y<X+b;y+=4)F.n.FromArrayToRef(T,y,A),F.n.TransformNormalToRef(A,z,u),T[y]=u.x,T[y+1]=u.y,T[y+2]=u.z,T[y+3]=u.w}static _FlipFaces(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T.length;for(let b=z;b<z+X;b+=3){const z=T[b+1];T[b+1]=T[b+2],T[b+2]=z}}transform(T){const z=T.determinant()<0;return this.xa&&p._TransformVector3Coordinates(this.xa,T),this.ya&&p._TransformVector3Normals(this.ya,T),this.tangents&&p._TransformVector4Normals(this.tangents,T),z&&this.indices&&p._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const T=[];for(const z of this.materialInfos){const X=new p;if(this.xa&&(X.xa=this.xa.slice(3*z.verticesStart,3*(z.verticesCount+z.verticesStart))),this.ya&&(X.ya=this.ya.slice(3*z.verticesStart,3*(z.verticesCount+z.verticesStart))),this.tangents&&(X.tangents=this.tangents.slice(4*z.verticesStart,4*(z.verticesCount+z.verticesStart))),this.za&&(X.za=this.za.slice(4*z.verticesStart,4*(z.verticesCount+z.verticesStart))),this.Aa&&(X.Aa=this.Aa.slice(2*z.verticesStart,2*(z.verticesCount+z.verticesStart))),this.uvs2&&(X.uvs2=this.uvs2.slice(2*z.verticesStart,2*(z.verticesCount+z.verticesStart))),this.uvs3&&(X.uvs3=this.uvs3.slice(2*z.verticesStart,2*(z.verticesCount+z.verticesStart))),this.uvs4&&(X.uvs4=this.uvs4.slice(2*z.verticesStart,2*(z.verticesCount+z.verticesStart))),this.uvs5&&(X.uvs5=this.uvs5.slice(2*z.verticesStart,2*(z.verticesCount+z.verticesStart))),this.uvs6&&(X.uvs6=this.uvs6.slice(2*z.verticesStart,2*(z.verticesCount+z.verticesStart))),this.matricesIndices&&(X.matricesIndices=this.matricesIndices.slice(4*z.verticesStart,4*(z.verticesCount+z.verticesStart))),this.matricesIndicesExtra&&(X.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*z.verticesStart,4*(z.verticesCount+z.verticesStart))),this.matricesWeights&&(X.matricesWeights=this.matricesWeights.slice(4*z.verticesStart,4*(z.verticesCount+z.verticesStart))),this.matricesWeightsExtra&&(X.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*z.verticesStart,4*(z.verticesCount+z.verticesStart))),this.indices){X.indices=[];for(let T=z.indexStart;T<z.indexStart+z.indexCount;T++)X.indices.push(this.indices[T]-z.verticesStart)}const b=new c;b.indexStart=0,b.indexCount=X.indices?X.indices.length:0,b.materialIndex=z.materialIndex,b.verticesStart=0,b.verticesCount=(X.xa?X.xa.length:0)/3,X.materialInfos=[b],T.push(X)}return T}merge(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const A=Array.isArray(T)?T.map((T=>({vertexData:T}))):[{vertexData:T}];return(0,k.k)(this._mergeCoroutine(void 0,A,z,!1,X,b,F))}*_mergeCoroutine(T,z){var X,b;let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3?arguments[3]:void 0,y=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5],v=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let k=z.map((T=>T.vertexData)),L=this;if(v)for(const A of k)A&&(A._validate(),!this.ya&&A.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&A.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&A.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&A.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&A.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&A.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&A.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&A.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&A.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&A.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&A.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&A.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&A.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const A of k)if(A)if(v)this.ya&&!A.ya&&(A.ya=new Float32Array(A.xa.length)),this.tangents&&!A.tangents&&(A.tangents=new Float32Array(A.xa.length/3*4)),this.Aa&&!A.Aa&&(A.Aa=new Float32Array(A.xa.length/3*2)),this.uvs2&&!A.uvs2&&(A.uvs2=new Float32Array(A.xa.length/3*2)),this.uvs3&&!A.uvs3&&(A.uvs3=new Float32Array(A.xa.length/3*2)),this.uvs4&&!A.uvs4&&(A.uvs4=new Float32Array(A.xa.length/3*2)),this.uvs5&&!A.uvs5&&(A.uvs5=new Float32Array(A.xa.length/3*2)),this.uvs6&&!A.uvs6&&(A.uvs6=new Float32Array(A.xa.length/3*2)),this.za&&!A.za&&(A.za=new Float32Array(A.xa.length/3*4),A.za.fill(1)),this.matricesIndices&&!A.matricesIndices&&(A.matricesIndices=new Float32Array(A.xa.length/3*4)),this.matricesWeights&&!A.matricesWeights&&(A.matricesWeights=new Float32Array(A.xa.length/3*4)),this.matricesIndicesExtra&&!A.matricesIndicesExtra&&(A.matricesIndicesExtra=new Float32Array(A.xa.length/3*4)),this.matricesWeightsExtra&&!A.matricesWeightsExtra&&(A.matricesWeightsExtra=new Float32Array(A.xa.length/3*4));else if(A._validate(),!this.ya!==!A.ya||!this.tangents!==!A.tangents||!this.Aa!==!A.Aa||!this.uvs2!==!A.uvs2||!this.uvs3!==!A.uvs3||!this.uvs4!==!A.uvs4||!this.uvs5!==!A.uvs5||!this.uvs6!==!A.uvs6||!this.za!==!A.za||!this.matricesIndices!==!A.matricesIndices||!this.matricesWeights!==!A.matricesWeights||!this.matricesIndicesExtra!==!A.matricesIndicesExtra||!this.matricesWeightsExtra!==!A.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(E){let X=0,b=0,F=0;const A=[];let u=null;const y=[];for(const z of this.splitBasedOnMaterialID())y.push({vertexData:z,transform:T});for(const T of z)if(T.vertexData)for(const z of T.vertexData.splitBasedOnMaterialID())y.push({vertexData:z,transform:T.transform});y.sort(((T,z)=>{const X=T.vertexData.materialInfos?T.vertexData.materialInfos[0].materialIndex:0,b=z.vertexData.materialInfos?z.vertexData.materialInfos[0].materialIndex:0;return X>b?1:X===b?0:-1}));for(const T of y){const z=T.vertexData;if(X=z.materialInfos?z.materialInfos[0].materialIndex:0,u&&u.materialIndex===X)u.indexCount+=z.indices.length,u.verticesCount+=z.xa.length/3;else{const T=new c;T.materialIndex=X,T.indexStart=b,T.indexCount=z.indices.length,T.verticesStart=F,T.verticesCount=z.xa.length/3,A.push(T),u=T}b+=z.indices.length,F+=z.xa.length/3}const E=y.splice(0,1)[0];L=E.vertexData,T=E.transform,k=y.map((T=>T.vertexData)),z=y,this.materialInfos=A}const D=k.reduce(((T,z)=>{var X;return T+((null===(X=z.indices)||void 0===X?void 0:X.length)??0)}),(null===(X=L.indices)||void 0===X?void 0:X.length)??0);let H=y||k.some((T=>T.indices===L.indices))?null===(b=L.indices)||void 0===b?void 0:b.slice():L.indices;if(D>0){var U;let X=(null===(U=H)||void 0===U?void 0:U.length)??0;if(H||(H=new Array(D)),H.length!==D){if(Array.isArray(H))H.length=D;else{const T=F||H instanceof Uint32Array?new Uint32Array(D):new Uint16Array(D);T.set(H),H=T}T&&T.determinant()<0&&p._FlipFaces(H,0,X)}let b=L.xa?L.xa.length/3:0;for(const{vertexData:T,transform:F}of z)if(T.indices){for(let z=0;z<T.indices.length;z++)H[X+z]=T.indices[z]+b;F&&F.determinant()<0&&p._FlipFaces(H,X,T.indices.length),b+=T.xa.length/3,X+=T.indices.length,u&&(yield)}}return this.indices=H,this.xa=p._MergeElement(A.e.PositionKind,L.xa,T,z.map((T=>[T.vertexData.xa,T.transform]))),u&&(yield),L.ya&&(this.ya=p._MergeElement(A.e.NormalKind,L.ya,T,z.map((T=>[T.vertexData.ya,T.transform]))),u&&(yield)),L.tangents&&(this.tangents=p._MergeElement(A.e.TangentKind,L.tangents,T,z.map((T=>[T.vertexData.tangents,T.transform]))),u&&(yield)),L.Aa&&(this.Aa=p._MergeElement(A.e.UVKind,L.Aa,T,z.map((T=>[T.vertexData.Aa,T.transform]))),u&&(yield)),L.uvs2&&(this.uvs2=p._MergeElement(A.e.UV2Kind,L.uvs2,T,z.map((T=>[T.vertexData.uvs2,T.transform]))),u&&(yield)),L.uvs3&&(this.uvs3=p._MergeElement(A.e.UV3Kind,L.uvs3,T,z.map((T=>[T.vertexData.uvs3,T.transform]))),u&&(yield)),L.uvs4&&(this.uvs4=p._MergeElement(A.e.UV4Kind,L.uvs4,T,z.map((T=>[T.vertexData.uvs4,T.transform]))),u&&(yield)),L.uvs5&&(this.uvs5=p._MergeElement(A.e.UV5Kind,L.uvs5,T,z.map((T=>[T.vertexData.uvs5,T.transform]))),u&&(yield)),L.uvs6&&(this.uvs6=p._MergeElement(A.e.UV6Kind,L.uvs6,T,z.map((T=>[T.vertexData.uvs6,T.transform]))),u&&(yield)),L.za&&(this.za=p._MergeElement(A.e.ColorKind,L.za,T,z.map((T=>[T.vertexData.za,T.transform]))),(void 0!==L.hasVertexAlpha||z.some((T=>void 0!==T.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=L.hasVertexAlpha||z.some((T=>T.vertexData.hasVertexAlpha))),u&&(yield)),L.matricesIndices&&(this.matricesIndices=p._MergeElement(A.e.MatricesIndicesKind,L.matricesIndices,T,z.map((T=>[T.vertexData.matricesIndices,T.transform]))),u&&(yield)),L.matricesWeights&&(this.matricesWeights=p._MergeElement(A.e.MatricesWeightsKind,L.matricesWeights,T,z.map((T=>[T.vertexData.matricesWeights,T.transform]))),u&&(yield)),L.matricesIndicesExtra&&(this.matricesIndicesExtra=p._MergeElement(A.e.MatricesIndicesExtraKind,L.matricesIndicesExtra,T,z.map((T=>[T.vertexData.matricesIndicesExtra,T.transform]))),u&&(yield)),L.matricesWeightsExtra&&(this.matricesWeightsExtra=p._MergeElement(A.e.MatricesWeightsExtraKind,L.matricesWeightsExtra,T,z.map((T=>[T.vertexData.matricesWeightsExtra,T.transform])))),this}static _MergeElement(T,z,X,b){const F=b.filter((T=>null!==T[0]&&void 0!==T[0]));if(!z&&0==F.length)return z;if(!z)return this._MergeElement(T,F[0][0],F[0][1],F.slice(1));const u=F.reduce(((T,z)=>T+z[0].length),z.length),y=T===A.e.PositionKind?p._TransformVector3Coordinates:T===A.e.NormalKind?p._TransformVector3Normals:T===A.e.TangentKind?p._TransformVector4Normals:()=>{};if(z instanceof Float32Array){const T=new Float32Array(u);T.set(z),X&&y(T,X,0,z.length);let b=z.length;for(const[z,X]of F)T.set(z,b),X&&y(T,X,b,z.length),b+=z.length;return T}{const T=new Array(u);for(let X=0;X<z.length;X++)T[X]=z[X];X&&y(T,X,0,z.length);let b=z.length;for(const[z,X]of F){for(let X=0;X<z.length;X++)T[b+X]=z[X];X&&y(T,X,b,z.length),b+=z.length}return T}}_validate(){if(!this.xa)throw new L.i("Positions are required",L.g.MeshInvalidPositionsError);const T=(T,z)=>{const X=A.e.DeduceStride(T);if(z.length%X!==0)throw new Error("The "+T+"s array count must be a multiple of "+X);return z.length/X},z=T(A.e.PositionKind,this.xa),X=(X,b)=>{const F=T(X,b);if(F!==z)throw new Error("The "+X+"s element count ("+F+") does not match the positions count ("+z+")")};this.ya&&X(A.e.NormalKind,this.ya),this.tangents&&X(A.e.TangentKind,this.tangents),this.Aa&&X(A.e.UVKind,this.Aa),this.uvs2&&X(A.e.UV2Kind,this.uvs2),this.uvs3&&X(A.e.UV3Kind,this.uvs3),this.uvs4&&X(A.e.UV4Kind,this.uvs4),this.uvs5&&X(A.e.UV5Kind,this.uvs5),this.uvs6&&X(A.e.UV6Kind,this.uvs6),this.za&&X(A.e.ColorKind,this.za),this.matricesIndices&&X(A.e.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&X(A.e.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&X(A.e.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&X(A.e.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const T=this.serialize();return p.Parse(T)}serialize(){const T={};if(this.xa&&(T.xa=Array.from(this.xa)),this.ya&&(T.ya=Array.from(this.ya)),this.tangents&&(T.tangents=Array.from(this.tangents)),this.Aa&&(T.Aa=Array.from(this.Aa)),this.uvs2&&(T.uvs2=Array.from(this.uvs2)),this.uvs3&&(T.uvs3=Array.from(this.uvs3)),this.uvs4&&(T.uvs4=Array.from(this.uvs4)),this.uvs5&&(T.uvs5=Array.from(this.uvs5)),this.uvs6&&(T.uvs6=Array.from(this.uvs6)),this.za&&(T.za=Array.from(this.za),T.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(T.matricesIndices=Array.from(this.matricesIndices),T.matricesIndices._isExpanded=!0),this.matricesWeights&&(T.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(T.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),T.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(T.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),T.indices=Array.from(this.indices),this.materialInfos){T.materialInfos=[];for(const z of this.materialInfos){const X={indexStart:z.indexStart,indexCount:z.indexCount,materialIndex:z.materialIndex,verticesStart:z.verticesStart,verticesCount:z.verticesCount};T.materialInfos.push(X)}}return T}static ExtractFromMesh(T,z,X){return p._ExtractFrom(T,z,X)}static ExtractFromGeometry(T,z,X){return p._ExtractFrom(T,z,X)}static _ExtractFrom(T,z,X){const b=new p;if(T.isVerticesDataPresent(A.e.PositionKind)&&(b.xa=T.getVerticesData(A.e.PositionKind,z,X)),T.isVerticesDataPresent(A.e.NormalKind)&&(b.ya=T.getVerticesData(A.e.NormalKind,z,X)),T.isVerticesDataPresent(A.e.TangentKind)&&(b.tangents=T.getVerticesData(A.e.TangentKind,z,X)),T.isVerticesDataPresent(A.e.UVKind)&&(b.Aa=T.getVerticesData(A.e.UVKind,z,X)),T.isVerticesDataPresent(A.e.UV2Kind)&&(b.uvs2=T.getVerticesData(A.e.UV2Kind,z,X)),T.isVerticesDataPresent(A.e.UV3Kind)&&(b.uvs3=T.getVerticesData(A.e.UV3Kind,z,X)),T.isVerticesDataPresent(A.e.UV4Kind)&&(b.uvs4=T.getVerticesData(A.e.UV4Kind,z,X)),T.isVerticesDataPresent(A.e.UV5Kind)&&(b.uvs5=T.getVerticesData(A.e.UV5Kind,z,X)),T.isVerticesDataPresent(A.e.UV6Kind)&&(b.uvs6=T.getVerticesData(A.e.UV6Kind,z,X)),T.isVerticesDataPresent(A.e.ColorKind)){const F=T.Ee||T,u=F.getVertexBuffer(A.e.ColorKind),y=F.getVerticesData(A.e.ColorKind,z,X);if(3===u.getSize()){const T=new Float32Array(4*y.length/3);for(let z=0,X=0;z<y.length;z+=3,X+=4)T[X]=y[z],T[X+1]=y[z+1],T[X+2]=y[z+2],T[X+3]=1;b.za=T}else{if(4!==u.getSize())throw new Error(`Unexpected number of color components: ${u.getSize()}`);b.za=y}}return T.isVerticesDataPresent(A.e.MatricesIndicesKind)&&(b.matricesIndices=T.getVerticesData(A.e.MatricesIndicesKind,z,X)),T.isVerticesDataPresent(A.e.MatricesWeightsKind)&&(b.matricesWeights=T.getVerticesData(A.e.MatricesWeightsKind,z,X)),T.isVerticesDataPresent(A.e.MatricesIndicesExtraKind)&&(b.matricesIndicesExtra=T.getVerticesData(A.e.MatricesIndicesExtraKind,z,X)),T.isVerticesDataPresent(A.e.MatricesWeightsExtraKind)&&(b.matricesWeightsExtra=T.getVerticesData(A.e.MatricesWeightsExtraKind,z,X)),b.indices=T.Ge(z,X),b}static CreateRibbon(T){throw(0,u.d)("ribbonBuilder")}static CreateBox(T){throw(0,u.d)("boxBuilder")}static CreateTiledBox(T){throw(0,u.d)("tiledBoxBuilder")}static CreateTiledPlane(T){throw(0,u.d)("tiledPlaneBuilder")}static CreateSphere(T){throw(0,u.d)("sphereBuilder")}static CreateCylinder(T){throw(0,u.d)("cylinderBuilder")}static CreateTorus(T){throw(0,u.d)("torusBuilder")}static CreateLineSystem(T){throw(0,u.d)("linesBuilder")}static CreateDashedLines(T){throw(0,u.d)("linesBuilder")}static CreateGround(T){throw(0,u.d)("groundBuilder")}static CreateTiledGround(T){throw(0,u.d)("groundBuilder")}static CreateGroundFromHeightMap(T){throw(0,u.d)("groundBuilder")}static Ig(T){throw(0,u.d)("planeBuilder")}static kb(T){throw(0,u.d)("discBuilder")}static CreatePolygon(T,z,X,b,F,A,y){throw(0,u.d)("polygonBuilder")}static CreateIcoSphere(T){throw(0,u.d)("icoSphereBuilder")}static CreatePolyhedron(T){throw(0,u.d)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||F.j.Up();throw(0,u.d)("capsuleBuilder")}static CreateTorusKnot(T){throw(0,u.d)("torusKnotBuilder")}static ComputeNormals(T,z,X,b){let A=0,u=0,y=0,E=0,v=0,k=0,L=0,D=0,c=0,p=0,H=0,U=0,s=0,x=0,K=0,d=0,N=0,l=0,a=0,q=0,V=!1,C=!1,G=!1,j=!1,Z=1,m=0,S=null;b&&(V=!!b.facetNormals,C=!!b.facetPositions,G=!!b.facetPartitioning,Z=!0===b.useRightHandedSystem?-1:1,m=b.ratio||0,j=!!b.depthSort,S=b.distanceTo,j&&void 0===S&&(S=F.j.Zero()));let n=0,O=0,P=0,W=0;for(G&&b&&b.bbSize&&(n=b.subDiv.X*m/b.bbSize.x,O=b.subDiv.Y*m/b.bbSize.y,P=b.subDiv.Z*m/b.bbSize.z,W=b.subDiv.max*b.subDiv.max,b.facetPartitioning.length=0),A=0;A<T.length;A++)X[A]=0;const B=z.length/3|0;for(A=0;A<B;A++){if(U=3*z[3*A],s=U+1,x=U+2,K=3*z[3*A+1],d=K+1,N=K+2,l=3*z[3*A+2],a=l+1,q=l+2,u=T[U]-T[K],y=T[s]-T[d],E=T[x]-T[N],v=T[l]-T[K],k=T[a]-T[d],L=T[q]-T[N],D=Z*(y*L-E*k),c=Z*(E*v-u*L),p=Z*(u*k-y*v),H=Math.sqrt(D*D+c*c+p*p),H=0===H?1:H,D/=H,c/=H,p/=H,V&&b&&(b.facetNormals[A].x=D,b.facetNormals[A].y=c,b.facetNormals[A].z=p),C&&b&&(b.facetPositions[A].x=(T[U]+T[K]+T[l])/3,b.facetPositions[A].y=(T[s]+T[d]+T[a])/3,b.facetPositions[A].z=(T[x]+T[N]+T[q])/3),G&&b){const z=Math.floor((b.facetPositions[A].x-b.bInfo.minimum.x*m)*n),X=Math.floor((b.facetPositions[A].y-b.bInfo.minimum.y*m)*O),F=Math.floor((b.facetPositions[A].z-b.bInfo.minimum.z*m)*P),u=Math.floor((T[U]-b.bInfo.minimum.x*m)*n),y=Math.floor((T[s]-b.bInfo.minimum.y*m)*O),E=Math.floor((T[x]-b.bInfo.minimum.z*m)*P),v=Math.floor((T[K]-b.bInfo.minimum.x*m)*n),k=Math.floor((T[d]-b.bInfo.minimum.y*m)*O),L=Math.floor((T[N]-b.bInfo.minimum.z*m)*P),D=Math.floor((T[l]-b.bInfo.minimum.x*m)*n),c=Math.floor((T[a]-b.bInfo.minimum.y*m)*O),p=Math.floor((T[q]-b.bInfo.minimum.z*m)*P),H=u+b.subDiv.max*y+W*E,V=v+b.subDiv.max*k+W*L,C=D+b.subDiv.max*c+W*p,G=z+b.subDiv.max*X+W*F;b.facetPartitioning[G]=b.facetPartitioning[G]?b.facetPartitioning[G]:new Array,b.facetPartitioning[H]=b.facetPartitioning[H]?b.facetPartitioning[H]:new Array,b.facetPartitioning[V]=b.facetPartitioning[V]?b.facetPartitioning[V]:new Array,b.facetPartitioning[C]=b.facetPartitioning[C]?b.facetPartitioning[C]:new Array,b.facetPartitioning[H].push(A),V!=H&&b.facetPartitioning[V].push(A),C!=V&&C!=H&&b.facetPartitioning[C].push(A),G!=H&&G!=V&&G!=C&&b.facetPartitioning[G].push(A)}if(j&&b&&b.facetPositions){const T=b.depthSortedFacets[A];T.ind=3*A,T.sqDistance=F.j.DistanceSquared(b.facetPositions[A],S)}X[U]+=D,X[s]+=c,X[x]+=p,X[K]+=D,X[d]+=c,X[N]+=p,X[l]+=D,X[a]+=c,X[q]+=p}for(A=0;A<X.length/3;A++)D=X[3*A],c=X[3*A+1],p=X[3*A+2],H=Math.sqrt(D*D+c*c+p*p),H=0===H?1:H,D/=H,c/=H,p/=H,X[3*A]=D,X[3*A+1]=c,X[3*A+2]=p}static _ComputeSides(T,z,X,b,A,u,y){const E=X.length,v=b.length;let k,L;switch(T=T||p.DEFAULTSIDE){case p.FRONTSIDE:break;case p.BACKSIDE:for(k=0;k<E;k+=3){const T=X[k];X[k]=X[k+2],X[k+2]=T}for(L=0;L<v;L++)b[L]=-b[L];break;case p.DOUBLESIDE:{const T=z.length,D=T/3;for(let X=0;X<T;X++)z[T+X]=z[X];for(k=0;k<E;k+=3)X[k+E]=X[k+2]+D,X[k+1+E]=X[k+1]+D,X[k+2+E]=X[k]+D;for(L=0;L<v;L++)b[v+L]=-b[L];const c=A.length;let p=0;for(p=0;p<c;p++)A[p+c]=A[p];for(u=u||new F.n(0,0,1,1),y=y||new F.n(0,0,1,1),p=0,k=0;k<c/2;k++)A[p]=u.x+(u.z-u.x)*A[p],A[p+1]=u.y+(u.w-u.y)*A[p+1],A[p+c]=y.x+(y.z-y.x)*A[p+c],A[p+c+1]=y.y+(y.w-y.y)*A[p+c+1],p+=2;break}}}static Parse(T){const z=new p,X=T.xa;X&&z.set(X,A.e.PositionKind);const b=T.ya;b&&z.set(b,A.e.NormalKind);const F=T.tangents;F&&z.set(F,A.e.TangentKind);const u=T.Aa;u&&z.set(u,A.e.UVKind);const E=T.uvs2;E&&z.set(E,A.e.UV2Kind);const v=T.uvs3;v&&z.set(v,A.e.UV3Kind);const k=T.uvs4;k&&z.set(k,A.e.UV4Kind);const L=T.uvs5;L&&z.set(L,A.e.UV5Kind);const D=T.uvs6;D&&z.set(D,A.e.UV6Kind);const H=T.za;H&&(z.set(y.d.CheckColors4(H,X.length/3),A.e.ColorKind),void 0!==T.hasVertexAlpha&&(z.hasVertexAlpha=T.hasVertexAlpha));const U=T.matricesIndices;U&&z.set(U,A.e.MatricesIndicesKind);const s=T.matricesWeights;s&&z.set(s,A.e.MatricesWeightsKind);const x=T.indices;x&&(z.indices=x);const K=T.materialInfos;if(K){z.materialInfos=[];for(const T of K){const X=new c;X.indexCount=T.indexCount,X.indexStart=T.indexStart,X.verticesCount=T.verticesCount,X.verticesStart=T.verticesStart,X.materialIndex=T.materialIndex,z.materialInfos.push(X)}}return z}static ImportVertexData(T,z){const X=p.Parse(T);z.setAllVerticesData(X,T.updatable)}}p.FRONTSIDE=0,p.BACKSIDE=1,p.DOUBLESIDE=2,p.DEFAULTSIDE=0,p._UniqueIDGenerator=0,(0,b.c)([v.e.filter((function(){for(var T=arguments.length,z=new Array(T),X=0;X<T;X++)z[X]=arguments[X];let[b]=z;return!Array.isArray(b)}))],p,"_TransformVector3Coordinates",null),(0,b.c)([v.e.filter((function(){for(var T=arguments.length,z=new Array(T),X=0;X<T;X++)z[X]=arguments[X];let[b]=z;return!Array.isArray(b)}))],p,"_TransformVector3Normals",null),(0,b.c)([v.e.filter((function(){for(var T=arguments.length,z=new Array(T),X=0;X<T;X++)z[X]=arguments[X];let[b]=z;return!Array.isArray(b)}))],p,"_TransformVector4Normals",null),(0,b.c)([v.e.filter((function(){for(var T=arguments.length,z=new Array(T),X=0;X<T;X++)z[X]=arguments[X];let[b]=z;return!Array.isArray(b)}))],p,"_FlipFaces",null)},12886:(T,z,X)=>{"use strict";X.d(z,{e:()=>HT});var b=X(976),F=X(11933),A=X(1207),u=X(11955),y=X(1141);function E(T){let z=T.pathArray;const X=T.closeArray||!1,b=T.closePath||!1,F=T.invertUV||!1,E=Math.floor(z[0].length/2);let v=T.offset||E;v=v>E?E:Math.floor(v);const k=0===T.sideOrientation?0:T.sideOrientation||u.e.DEFAULTSIDE,L=T.Aa,D=T.za,c=[],p=[],H=[],U=[],s=[],x=[],K=[],d=[];let N;const l=[],a=[];let q,V,C;if(z.length<2){const T=[],X=[];for(V=0;V<z[0].length-v;V++)T.push(z[0][V]),X.push(z[0][V+v]);z=[T,X]}let G=0;const j=b?1:0,Z=X?1:0;let m,S,n,O,P,W;for(N=z[0].length,q=0;q<z.length+Z;q++){for(K[q]=0,s[q]=[0],m=q===z.length?z[0]:z[q],S=m.length,N=N<S?N:S,C=0;C<S;)c.push(m[C].x,m[C].y,m[C].z),C>0&&(n=m[C].Mc(m[C-1]).length(),O=n+K[q],s[q].push(O),K[q]=O),C++;b&&(C--,c.push(m[0].x,m[0].y,m[0].z),n=m[C].Mc(m[0]).length(),O=n+K[q],s[q].push(O),K[q]=O),l[q]=S+j,a[q]=G,G+=S+j}let B,e,R=null,Y=null;for(V=0;V<N+j;V++)for(d[V]=0,x[V]=[0],q=0;q<z.length-1+Z;q++)P=z[q],W=q===z.length-1?z[0]:z[q+1],V===N?(R=P[0],Y=W[0]):(R=P[V],Y=W[V]),n=Y.Mc(R).length(),O=n+d[V],x[V].push(O),d[V]=O;if(L)for(q=0;q<L.length;q++)U.push(L[q].x,y.c?1-L[q].y:L[q].y);else for(q=0;q<z.length+Z;q++)for(V=0;V<N+j;V++)B=0!=K[q]?s[q][V]/K[q]:0,e=0!=d[V]?x[V][q]/d[V]:0,F?U.push(e,B):U.push(B,y.c?1-e:e);q=0;let i=0,t=l[q]-1,g=l[q+1]-1,M=t<g?t:g,r=a[1]-a[0];const o=l.length-1;for(;i<=M&&q<o;)p.push(i,i+r,i+1),p.push(i+r+1,i+1,i+r),i+=1,i===M&&(q++,r=a[q+1]-a[q],t=l[q]-1,g=l[q+1]-1,i=a[q],M=t<g?t+i:g+i);if(u.e.ComputeNormals(c,p,H),b){let T=0,X=0;for(q=0;q<z.length;q++){T=3*a[q],X=q+1<z.length?3*(a[q+1]-1):H.length-3,H[T]=.5*(H[T]+H[X]),H[T+1]=.5*(H[T+1]+H[X+1]),H[T+2]=.5*(H[T+2]+H[X+2]);const b=Math.sqrt(H[T]*H[T]+H[T+1]*H[T+1]+H[T+2]*H[T+2]);H[T]/=b,H[T+1]/=b,H[T+2]/=b,H[X]=H[T],H[X+1]=H[T+1],H[X+2]=H[T+2]}}if(X){let T=3*a[0],X=3*a[z.length];for(V=0;V<N+j;V++){H[T]=.5*(H[T]+H[X]),H[T+1]=.5*(H[T+1]+H[X+1]),H[T+2]=.5*(H[T+2]+H[X+2]);const z=Math.sqrt(H[T]*H[T]+H[T+1]*H[T+1]+H[T+2]*H[T+2]);H[T]/=z,H[T+1]/=z,H[T+2]/=z,H[X]=H[T],H[X+1]=H[T+1],H[X+2]=H[T+2],T+=3,X+=3}}u.e._ComputeSides(k,c,p,H,U,T.frontUVs,T.backUVs);let f=null;if(D){f=new Float32Array(4*D.length);for(let T=0;T<D.length;T++)f[4*T]=D[T].r,f[4*T+1]=D[T].g,f[4*T+2]=D[T].b,f[4*T+3]=D[T].a}const h=new u.e,Q=new Float32Array(c),w=new Float32Array(H),J=new Float32Array(U);return h.indices=p,h.xa=Q,h.ya=w,h.Aa=J,f&&h.set(f,A.e.ColorKind),b&&(h._idx=a),h}function v(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const v=z.pathArray,k=z.closeArray,L=z.closePath,D=F.e._GetDefaultSideOrientation(z.sideOrientation),c=z.instance,p=z.updatable;if(c){const T=b.f.Id[0].Gd(Number.MAX_VALUE),X=b.f.Id[1].Gd(-Number.MAX_VALUE),E=z=>{let b=v[0].length;const A=c;let u=0;const y=A._originalBuilderSideOrientation===F.e.DOUBLESIDE?2:1;for(let F=1;F<=y;++F)for(let y=0;y<v.length;++y){const F=v[y],E=F.length;b=b<E?b:E;for(let A=0;A<b;++A){const b=F[A];z[u]=b.x,z[u+1]=b.y,z[u+2]=b.z,T.minimizeInPlaceFromFloats(b.x,b.y,b.z),X.maximizeInPlaceFromFloats(b.x,b.y,b.z),u+=3}if(A._creationDataStorage&&A._creationDataStorage.closePath){const T=F[0];z[u]=T.x,z[u+1]=T.y,z[u+2]=T.z,u+=3}}},k=c.getVerticesData(A.e.PositionKind);if(E(k),c.hasBoundingInfo?c.getBoundingInfo().reConstruct(T,X,c._worldMatrix):c.buildBoundingInfo(T,X,c._worldMatrix),c.updateVerticesData(A.e.PositionKind,k,!1,!1),z.za){const T=c.getVerticesData(A.e.ColorKind);for(let X=0,b=0;X<z.za.length;X++,b+=4){const F=z.za[X];T[b]=F.r,T[b+1]=F.g,T[b+2]=F.b,T[b+3]=F.a}c.updateVerticesData(A.e.ColorKind,T,!1,!1)}if(z.Aa){const T=c.getVerticesData(A.e.UVKind);for(let X=0;X<z.Aa.length;X++)T[2*X]=z.Aa[X].x,T[2*X+1]=y.c?1-z.Aa[X].y:z.Aa[X].y;c.updateVerticesData(A.e.UVKind,T,!1,!1)}if(!c.areNormalsFrozen||c.isFacetDataEnabled){const T=c.Ge(),z=c.getVerticesData(A.e.NormalKind),X=c.isFacetDataEnabled?c.getFacetDataParameters():null;if(u.e.ComputeNormals(k,T,z,X),c._creationDataStorage&&c._creationDataStorage.closePath){let T=0,X=0;for(let b=0;b<v.length;b++)T=3*c._creationDataStorage.idx[b],X=b+1<v.length?3*(c._creationDataStorage.idx[b+1]-1):z.length-3,z[T]=.5*(z[T]+z[X]),z[T+1]=.5*(z[T+1]+z[X+1]),z[T+2]=.5*(z[T+2]+z[X+2]),z[X]=z[T],z[X+1]=z[T+1],z[X+2]=z[T+2]}c.areNormalsFrozen||c.updateVerticesData(A.e.NormalKind,z,!1,!1)}return c}{const b=new F.e(T,X);b._originalBuilderSideOrientation=D,b._creationDataStorage=new F.g;const A=E(z);return L&&(b._creationDataStorage.idx=A._idx),b._creationDataStorage.closePath=L,b._creationDataStorage.closeArray=k,A.Ca(b,p),b}}u.e.CreateRibbon=E,F.e.CreateRibbon=function(T,z){return v(T,{pathArray:z,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var k=X(12092),L=X(11978),D=X(1132);function c(T){const z=T.pattern||F.e.NO_FLIP,X=T.tileWidth||T.tileSize||1,b=T.tileHeight||T.tileSize||1,A=T.alignHorizontal||0,y=T.alignVertical||0,E=T.width||T.size||1,v=Math.floor(E/X);let k=E-v*X;const L=T.height||T.size||1,D=Math.floor(L/b);let c=L-D*b;const p=X*v/2,H=b*D/2;let U=0,s=0,x=0,K=0,d=0,N=0;if(k>0||c>0){switch(x=-p,K=-H,d=p,N=H,A){case F.e.CENTER:k/=2,x-=k,d+=k;break;case F.e.LEFT:d+=k,U=-k/2;break;case F.e.RIGHT:x-=k,U=k/2}switch(y){case F.e.CENTER:c/=2,K-=c,N+=c;break;case F.e.BOTTOM:N+=c,s=-c/2;break;case F.e.TOP:K-=c,s=c/2}}const l=[],a=[],q=[];q[0]=[0,0,1,0,1,1,0,1],q[1]=[0,0,1,0,1,1,0,1],z!==F.e.ROTATE_TILE&&z!==F.e.ROTATE_ROW||(q[1]=[1,1,0,1,0,0,1,0]),z!==F.e.FLIP_TILE&&z!==F.e.FLIP_ROW||(q[1]=[1,0,0,0,0,1,1,1]),z!==F.e.FLIP_N_ROTATE_TILE&&z!==F.e.FLIP_N_ROTATE_ROW||(q[1]=[0,1,1,1,1,0,0,0]);let V=[];const C=[],G=[];let j=0;for(let u=0;u<D;u++)for(let T=0;T<v;T++)l.push(T*X-p+U,u*b-H+s,0),l.push((T+1)*X-p+U,u*b-H+s,0),l.push((T+1)*X-p+U,(u+1)*b-H+s,0),l.push(T*X-p+U,(u+1)*b-H+s,0),G.push(j,j+1,j+3,j+1,j+2,j+3),V=z===F.e.FLIP_TILE||z===F.e.ROTATE_TILE||z===F.e.FLIP_N_ROTATE_TILE?V.concat(q[(T%2+u%2)%2]):z===F.e.FLIP_ROW||z===F.e.ROTATE_ROW||z===F.e.FLIP_N_ROTATE_ROW?V.concat(q[u%2]):V.concat(q[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),j+=4;if(k>0||c>0){const T=c>0&&(y===F.e.CENTER||y===F.e.TOP),u=c>0&&(y===F.e.CENTER||y===F.e.BOTTOM),E=k>0&&(A===F.e.CENTER||A===F.e.RIGHT),L=k>0&&(A===F.e.CENTER||A===F.e.LEFT);let q,Z,m,S,n=[];if(T&&E&&(l.push(x+U,K+s,0),l.push(-p+U,K+s,0),l.push(-p+U,K+c+s,0),l.push(x+U,K+c+s,0),G.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,q=1-k/X,Z=1-c/b,m=1,S=1,n=[q,Z,m,Z,m,S,q,S],z===F.e.ROTATE_ROW&&(n=[1-q,1-Z,1-m,1-Z,1-m,1-S,1-q,1-S]),z===F.e.FLIP_ROW&&(n=[1-q,Z,1-m,Z,1-m,S,1-q,S]),z===F.e.FLIP_N_ROTATE_ROW&&(n=[q,1-Z,m,1-Z,m,1-S,q,1-S]),V=V.concat(n),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),T&&L&&(l.push(p+U,K+s,0),l.push(d+U,K+s,0),l.push(d+U,K+c+s,0),l.push(p+U,K+c+s,0),G.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,q=0,Z=1-c/b,m=k/X,S=1,n=[q,Z,m,Z,m,S,q,S],(z===F.e.ROTATE_ROW||z===F.e.ROTATE_TILE&&v%2===0)&&(n=[1-q,1-Z,1-m,1-Z,1-m,1-S,1-q,1-S]),(z===F.e.FLIP_ROW||z===F.e.FLIP_TILE&&v%2===0)&&(n=[1-q,Z,1-m,Z,1-m,S,1-q,S]),(z===F.e.FLIP_N_ROTATE_ROW||z===F.e.FLIP_N_ROTATE_TILE&&v%2===0)&&(n=[q,1-Z,m,1-Z,m,1-S,q,1-S]),V=V.concat(n),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),u&&E&&(l.push(x+U,H+s,0),l.push(-p+U,H+s,0),l.push(-p+U,N+s,0),l.push(x+U,N+s,0),G.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,q=1-k/X,Z=0,m=1,S=c/b,n=[q,Z,m,Z,m,S,q,S],(z===F.e.ROTATE_ROW&&D%2===1||z===F.e.ROTATE_TILE&&D%1===0)&&(n=[1-q,1-Z,1-m,1-Z,1-m,1-S,1-q,1-S]),(z===F.e.FLIP_ROW&&D%2===1||z===F.e.FLIP_TILE&&D%2===0)&&(n=[1-q,Z,1-m,Z,1-m,S,1-q,S]),(z===F.e.FLIP_N_ROTATE_ROW&&D%2===1||z===F.e.FLIP_N_ROTATE_TILE&&D%2===0)&&(n=[q,1-Z,m,1-Z,m,1-S,q,1-S]),V=V.concat(n),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),u&&L&&(l.push(p+U,H+s,0),l.push(d+U,H+s,0),l.push(d+U,N+s,0),l.push(p+U,N+s,0),G.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,q=0,Z=0,m=k/X,S=c/b,n=[q,Z,m,Z,m,S,q,S],(z===F.e.ROTATE_ROW&&D%2===1||z===F.e.ROTATE_TILE&&(D+v)%2===1)&&(n=[1-q,1-Z,1-m,1-Z,1-m,1-S,1-q,1-S]),(z===F.e.FLIP_ROW&&D%2===1||z===F.e.FLIP_TILE&&(D+v)%2===1)&&(n=[1-q,Z,1-m,Z,1-m,S,1-q,S]),(z===F.e.FLIP_N_ROTATE_ROW&&D%2===1||z===F.e.FLIP_N_ROTATE_TILE&&(D+v)%2===1)&&(n=[q,1-Z,m,1-Z,m,1-S,q,1-S]),V=V.concat(n),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),T){const T=[];q=0,Z=1-c/b,m=1,S=1,T[0]=[q,Z,m,Z,m,S,q,S],T[1]=[q,Z,m,Z,m,S,q,S],z!==F.e.ROTATE_TILE&&z!==F.e.ROTATE_ROW||(T[1]=[1-q,1-Z,1-m,1-Z,1-m,1-S,1-q,1-S]),z!==F.e.FLIP_TILE&&z!==F.e.FLIP_ROW||(T[1]=[1-q,Z,1-m,Z,1-m,S,1-q,S]),z!==F.e.FLIP_N_ROTATE_TILE&&z!==F.e.FLIP_N_ROTATE_ROW||(T[1]=[q,1-Z,m,1-Z,m,1-S,q,1-S]);for(let b=0;b<v;b++)l.push(b*X-p+U,K+s,0),l.push((b+1)*X-p+U,K+s,0),l.push((b+1)*X-p+U,K+c+s,0),l.push(b*X-p+U,K+c+s,0),G.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,V=z===F.e.FLIP_TILE||z===F.e.ROTATE_TILE||z===F.e.FLIP_N_ROTATE_TILE?V.concat(T[(b+1)%2]):z===F.e.FLIP_ROW||z===F.e.ROTATE_ROW||z===F.e.FLIP_N_ROTATE_ROW?V.concat(T[1]):V.concat(T[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(u){const T=[];q=0,Z=0,m=1,S=c/b,T[0]=[q,Z,m,Z,m,S,q,S],T[1]=[q,Z,m,Z,m,S,q,S],z!==F.e.ROTATE_TILE&&z!==F.e.ROTATE_ROW||(T[1]=[1-q,1-Z,1-m,1-Z,1-m,1-S,1-q,1-S]),z!==F.e.FLIP_TILE&&z!==F.e.FLIP_ROW||(T[1]=[1-q,Z,1-m,Z,1-m,S,1-q,S]),z!==F.e.FLIP_N_ROTATE_TILE&&z!==F.e.FLIP_N_ROTATE_ROW||(T[1]=[q,1-Z,m,1-Z,m,1-S,q,1-S]);for(let b=0;b<v;b++)l.push(b*X-p+U,N-c+s,0),l.push((b+1)*X-p+U,N-c+s,0),l.push((b+1)*X-p+U,N+s,0),l.push(b*X-p+U,N+s,0),G.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,V=z===F.e.FLIP_TILE||z===F.e.ROTATE_TILE||z===F.e.FLIP_N_ROTATE_TILE?V.concat(T[(b+D)%2]):z===F.e.FLIP_ROW||z===F.e.ROTATE_ROW||z===F.e.FLIP_N_ROTATE_ROW?V.concat(T[D%2]):V.concat(T[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(E){const T=[];q=1-k/X,Z=0,m=1,S=1,T[0]=[q,Z,m,Z,m,S,q,S],T[1]=[q,Z,m,Z,m,S,q,S],z!==F.e.ROTATE_TILE&&z!==F.e.ROTATE_ROW||(T[1]=[1-q,1-Z,1-m,1-Z,1-m,1-S,1-q,1-S]),z!==F.e.FLIP_TILE&&z!==F.e.FLIP_ROW||(T[1]=[1-q,Z,1-m,Z,1-m,S,1-q,S]),z!==F.e.FLIP_N_ROTATE_TILE&&z!==F.e.FLIP_N_ROTATE_ROW||(T[1]=[q,1-Z,m,1-Z,m,1-S,q,1-S]);for(let X=0;X<D;X++)l.push(x+U,X*b-H+s,0),l.push(x+k+U,X*b-H+s,0),l.push(x+k+U,(X+1)*b-H+s,0),l.push(x+U,(X+1)*b-H+s,0),G.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,V=z===F.e.FLIP_TILE||z===F.e.ROTATE_TILE||z===F.e.FLIP_N_ROTATE_TILE?V.concat(T[(X+1)%2]):z===F.e.FLIP_ROW||z===F.e.ROTATE_ROW||z===F.e.FLIP_N_ROTATE_ROW?V.concat(T[X%2]):V.concat(T[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(L){const T=[];q=0,Z=0,m=k/b,S=1,T[0]=[q,Z,m,Z,m,S,q,S],T[1]=[q,Z,m,Z,m,S,q,S],z!==F.e.ROTATE_TILE&&z!==F.e.ROTATE_ROW||(T[1]=[1-q,1-Z,1-m,1-Z,1-m,1-S,1-q,1-S]),z!==F.e.FLIP_TILE&&z!==F.e.FLIP_ROW||(T[1]=[1-q,Z,1-m,Z,1-m,S,1-q,S]),z!==F.e.FLIP_N_ROTATE_TILE&&z!==F.e.FLIP_N_ROTATE_ROW||(T[1]=[q,1-Z,m,1-Z,m,1-S,q,1-S]);for(let X=0;X<D;X++)l.push(d-k+U,X*b-H+s,0),l.push(d+U,X*b-H+s,0),l.push(d+U,(X+1)*b-H+s,0),l.push(d-k+U,(X+1)*b-H+s,0),G.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,V=z===F.e.FLIP_TILE||z===F.e.ROTATE_TILE||z===F.e.FLIP_N_ROTATE_TILE?V.concat(T[(X+v)%2]):z===F.e.FLIP_ROW||z===F.e.ROTATE_ROW||z===F.e.FLIP_N_ROTATE_ROW?V.concat(T[X%2]):V.concat(T[0]),C.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),a.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const Z=0===T.sideOrientation?0:T.sideOrientation||u.e.DEFAULTSIDE;u.e._ComputeSides(Z,l,G,a,V,T.frontUVs,T.backUVs);const m=new u.e;m.indices=G,m.xa=l,m.ya=a,m.Aa=V;const S=Z===u.e.DOUBLESIDE?C.concat(C):C;return m.za=S,m}function p(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new F.e(T,X);z.sideOrientation=F.e._GetDefaultSideOrientation(z.sideOrientation),b._originalBuilderSideOrientation=z.sideOrientation;return c(z).Ca(b,z.updatable),b}function H(T){const z=T.faceUV||new Array(6),X=T.faceColors,A=T.pattern||F.e.NO_FLIP,E=T.width||T.size||1,v=T.height||T.size||1,k=T.depth||T.size||1,L=T.tileWidth||T.tileSize||1,p=T.tileHeight||T.tileSize||1,H=T.alignHorizontal||0,U=T.alignVertical||0,s=0===T.sideOrientation?0:T.sideOrientation||u.e.DEFAULTSIDE;for(let F=0;F<6;F++)void 0===z[F]&&(z[F]=new b.n(0,0,1,1)),X&&void 0===X[F]&&(X[F]=new D.d(1,1,1,1));const x=E/2,K=v/2,d=k/2,N=[];for(let b=0;b<2;b++)N[b]=c({pattern:A,tileWidth:L,tileHeight:p,width:E,height:v,alignVertical:U,alignHorizontal:H,sideOrientation:s});for(let b=2;b<4;b++)N[b]=c({pattern:A,tileWidth:L,tileHeight:p,width:k,height:v,alignVertical:U,alignHorizontal:H,sideOrientation:s});let l=U;U===F.e.BOTTOM?l=F.e.TOP:U===F.e.TOP&&(l=F.e.BOTTOM);for(let b=4;b<6;b++)N[b]=c({pattern:A,tileWidth:L,tileHeight:p,width:E,height:k,alignVertical:l,alignHorizontal:H,sideOrientation:s});let a=[],q=[],V=[],C=[];const G=[],j=[],Z=[],m=[];let S=0,n=0;for(let F=0;F<6;F++){const T=N[F].xa.length;j[F]=[],Z[F]=[];for(let z=0;z<T/3;z++)j[F].push(new b.j(N[F].xa[3*z],N[F].xa[3*z+1],N[F].xa[3*z+2])),Z[F].push(new b.j(N[F].ya[3*z],N[F].ya[3*z+1],N[F].ya[3*z+2]));S=N[F].Aa.length,m[F]=[];for(let X=0;X<S;X+=2)m[F][X]=z[F].x+(z[F].z-z[F].x)*N[F].Aa[X],m[F][X+1]=z[F].y+(z[F].w-z[F].y)*N[F].Aa[X+1],y.c&&(m[F][X+1]=1-m[F][X+1]);if(V=V.concat(m[F]),C=C.concat(N[F].indices.map((T=>T+n))),n+=j[F].length,X)for(let z=0;z<4;z++)G.push(X[F].r,X[F].g,X[F].b,X[F].a)}const O=new b.j(0,0,d),P=b.d.RotationY(Math.PI);a=j[0].map((T=>b.j.TransformNormal(T,P).add(O))).map((T=>[T.x,T.y,T.z])).reduce(((T,z)=>T.concat(z)),[]),q=Z[0].map((T=>b.j.TransformNormal(T,P))).map((T=>[T.x,T.y,T.z])).reduce(((T,z)=>T.concat(z)),[]),a=a.concat(j[1].map((T=>T.Mc(O))).map((T=>[T.x,T.y,T.z])).reduce(((T,z)=>T.concat(z)),[])),q=q.concat(Z[1].map((T=>[T.x,T.y,T.z])).reduce(((T,z)=>T.concat(z)),[]));const W=new b.j(x,0,0),B=b.d.RotationY(-Math.PI/2);a=a.concat(j[2].map((T=>b.j.TransformNormal(T,B).add(W))).map((T=>[T.x,T.y,T.z])).reduce(((T,z)=>T.concat(z)),[])),q=q.concat(Z[2].map((T=>b.j.TransformNormal(T,B))).map((T=>[T.x,T.y,T.z])).reduce(((T,z)=>T.concat(z)),[]));const e=b.d.RotationY(Math.PI/2);a=a.concat(j[3].map((T=>b.j.TransformNormal(T,e).Mc(W))).map((T=>[T.x,T.y,T.z])).reduce(((T,z)=>T.concat(z)),[])),q=q.concat(Z[3].map((T=>b.j.TransformNormal(T,e))).map((T=>[T.x,T.y,T.z])).reduce(((T,z)=>T.concat(z)),[]));const R=new b.j(0,K,0),Y=b.d.RotationX(Math.PI/2);a=a.concat(j[4].map((T=>b.j.TransformNormal(T,Y).add(R))).map((T=>[T.x,T.y,T.z])).reduce(((T,z)=>T.concat(z)),[])),q=q.concat(Z[4].map((T=>b.j.TransformNormal(T,Y))).map((T=>[T.x,T.y,T.z])).reduce(((T,z)=>T.concat(z)),[]));const i=b.d.RotationX(-Math.PI/2);a=a.concat(j[5].map((T=>b.j.TransformNormal(T,i).Mc(R))).map((T=>[T.x,T.y,T.z])).reduce(((T,z)=>T.concat(z)),[])),q=q.concat(Z[5].map((T=>b.j.TransformNormal(T,i))).map((T=>[T.x,T.y,T.z])).reduce(((T,z)=>T.concat(z)),[])),u.e._ComputeSides(s,a,C,q,V);const t=new u.e;if(t.indices=C,t.xa=a,t.ya=q,t.Aa=V,X){const T=s===u.e.DOUBLESIDE?G.concat(G):G;t.za=T}return t}function U(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new F.e(T,X);z.sideOrientation=F.e._GetDefaultSideOrientation(z.sideOrientation),b._originalBuilderSideOrientation=z.sideOrientation;return H(z).Ca(b,z.updatable),b}u.e.CreateTiledPlane=c;u.e.CreateTiledBox=H;var s=X(12078),x=X(1159),K=X(1449);function d(T){const z=T.height||2;let X=0===T.diameterTop?0:T.diameterTop||T.diameter||1,A=0===T.diameterBottom?0:T.diameterBottom||T.diameter||1;X=X||1e-5,A=A||1e-5;const E=0|(T.dl||24),v=0|(T.subdivisions||1),k=!!T.hasRings,L=!!T.enclose,c=0===T.cap?0:T.cap||F.e.CAP_ALL,p=T.arc&&(T.arc<=0||T.arc>1)?1:T.arc||1,H=0===T.sideOrientation?0:T.sideOrientation||u.e.DEFAULTSIDE,U=T.faceUV||new Array(3),s=T.faceColors,x=2+(1+(1!==p&&L?2:0))*(k?v:1);let d;for(d=0;d<x;d++)s&&void 0===s[d]&&(s[d]=new D.d(1,1,1,1));for(d=0;d<x;d++)U&&void 0===U[d]&&(U[d]=new b.n(0,0,1,1));const N=[],l=[],a=[],q=[],V=[],C=2*Math.PI*p/E;let G,j,Z;const m=(A-X)/2/z,S=b.j.Zero(),n=b.j.Zero(),O=b.j.Zero(),P=b.j.Zero(),W=b.j.Zero(),B=K.b.Y;let e,R,Y,i=1,t=1,g=0,M=0;for(e=0;e<=v;e++)for(j=e/v,Z=(j*(X-A)+A)/2,i=k&&0!==e&&e!==v?2:1,Y=0;Y<i;Y++){for(k&&(t+=Y),L&&(t+=2*Y),R=0;R<=E;R++)G=R*C,S.x=Math.cos(-G)*Z,S.y=-z/2+j*z,S.z=Math.sin(-G)*Z,0===X&&e===v?(n.x=a[a.length-3*(E+1)],n.y=a[a.length-3*(E+1)+1],n.z=a[a.length-3*(E+1)+2]):(n.x=S.x,n.z=S.z,n.y=Math.sqrt(n.x*n.x+n.z*n.z)*m,n.normalize()),0===R&&(O.p(S),P.p(n)),l.push(S.x,S.y,S.z),a.push(n.x,n.y,n.z),M=k?g!==t?U[t].y:U[t].w:U[t].y+(U[t].w-U[t].y)*j,q.push(U[t].x+(U[t].z-U[t].x)*R/E,y.c?1-M:M),s&&V.push(s[t].r,s[t].g,s[t].b,s[t].a);1!==p&&L&&(l.push(S.x,S.y,S.z),l.push(0,S.y,0),l.push(0,S.y,0),l.push(O.x,O.y,O.z),b.j.CrossToRef(B,n,W),W.normalize(),a.push(W.x,W.y,W.z,W.x,W.y,W.z),b.j.CrossToRef(P,B,W),W.normalize(),a.push(W.x,W.y,W.z,W.x,W.y,W.z),M=k?g!==t?U[t+1].y:U[t+1].w:U[t+1].y+(U[t+1].w-U[t+1].y)*j,q.push(U[t+1].x,y.c?1-M:M),q.push(U[t+1].z,y.c?1-M:M),M=k?g!==t?U[t+2].y:U[t+2].w:U[t+2].y+(U[t+2].w-U[t+2].y)*j,q.push(U[t+2].x,y.c?1-M:M),q.push(U[t+2].z,y.c?1-M:M),s&&(V.push(s[t+1].r,s[t+1].g,s[t+1].b,s[t+1].a),V.push(s[t+1].r,s[t+1].g,s[t+1].b,s[t+1].a),V.push(s[t+2].r,s[t+2].g,s[t+2].b,s[t+2].a),V.push(s[t+2].r,s[t+2].g,s[t+2].b,s[t+2].a))),g!==t&&(g=t)}const r=1!==p&&L?E+4:E;for(e=0,t=0;t<v;t++){let T=0,z=0,X=0,b=0;for(R=0;R<E;R++)T=e*(r+1)+R,z=(e+1)*(r+1)+R,X=e*(r+1)+(R+1),b=(e+1)*(r+1)+(R+1),N.push(T,z,X),N.push(b,X,z);1!==p&&L&&(N.push(T+2,z+2,X+2),N.push(b+2,X+2,z+2),N.push(T+4,z+4,X+4),N.push(b+4,X+4,z+4)),e=k?e+2:e+1}const o=T=>{const F=T?X/2:A/2;if(0===F)return;let u,v,k;const L=T?U[x-1]:U[0];let D=null;s&&(D=T?s[x-1]:s[0]);const c=l.length/3,H=T?z/2:-z/2,K=new b.j(0,H,0);l.push(K.x,K.y,K.z),a.push(0,T?1:-1,0);const d=L.y+.5*(L.w-L.y);q.push(L.x+.5*(L.z-L.x),y.c?1-d:d),D&&V.push(D.r,D.g,D.b,D.a);const C=new b.i(.5,.5);for(k=0;k<=E;k++){u=2*Math.PI*k*p/E;const z=Math.cos(-u),X=Math.sin(-u);v=new b.j(z*F,H,X*F);const A=new b.i(z*C.x+.5,X*C.y+.5);l.push(v.x,v.y,v.z),a.push(0,T?1:-1,0);const c=L.y+(L.w-L.y)*A.y;q.push(L.x+(L.z-L.x)*A.x,y.c?1-c:c),D&&V.push(D.r,D.g,D.b,D.a)}for(k=0;k<E;k++)T?(N.push(c),N.push(c+(k+2)),N.push(c+(k+1))):(N.push(c),N.push(c+(k+1)),N.push(c+(k+2)))};c!==F.e.CAP_START&&c!==F.e.CAP_ALL||o(!1),c!==F.e.CAP_END&&c!==F.e.CAP_ALL||o(!0),u.e._ComputeSides(H,l,N,a,q,T.frontUVs,T.backUVs);const f=new u.e;return f.indices=N,f.xa=l,f.ya=a,f.Aa=q,s&&(f.za=V),f}function N(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2?arguments[2]:void 0;const b=new F.e(T,X);z.sideOrientation=F.e._GetDefaultSideOrientation(z.sideOrientation),b._originalBuilderSideOrientation=z.sideOrientation;return d(z).Ca(b,z.updatable),b}function l(T){const z=[],X=[],F=[],A=[],E=T.diameter||1,v=T.thickness||.5,k=0|(T.dl||16),L=0===T.sideOrientation?0:T.sideOrientation||u.e.DEFAULTSIDE,D=k+1;for(let u=0;u<=k;u++){const T=u/k,L=u*Math.PI*2/k-Math.PI/2,c=b.d.Translation(E/2,0,0).multiply(b.d.RotationY(L));for(let E=0;E<=k;E++){const L=1-E/k,p=E*Math.PI*2/k+Math.PI,H=Math.cos(p),U=Math.sin(p);let s=new b.j(H,U,0),x=s.scale(v/2);const K=new b.i(T,L);x=b.j.TransformCoordinates(x,c),s=b.j.TransformNormal(s,c),X.push(x.x,x.y,x.z),F.push(s.x,s.y,s.z),A.push(K.x,y.c?1-K.y:K.y);const d=(u+1)%D,N=(E+1)%D;z.push(u*D+E),z.push(u*D+N),z.push(d*D+E),z.push(u*D+N),z.push(d*D+N),z.push(d*D+E)}}u.e._ComputeSides(L,X,z,F,A,T.frontUVs,T.backUVs);const c=new u.e;return c.indices=z,c.xa=X,c.ya=F,c.Aa=A,c}function a(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2?arguments[2]:void 0;const b=new F.e(T,X);z.sideOrientation=F.e._GetDefaultSideOrientation(z.sideOrientation),b._originalBuilderSideOrientation=z.sideOrientation;return l(z).Ca(b,z.updatable),b}u.e.CreateCylinder=d,F.e.CreateCylinder=(T,z,X,b,A,u,y,E,v)=>{void 0!==y&&y instanceof x.e||(void 0!==y&&(v=E||F.e.DEFAULTSIDE,E=y),y=u,u=1);return N(T,{height:z,diameterTop:X,diameterBottom:b,dl:A,subdivisions:u,sideOrientation:v,updatable:E},y)};function q(T){const z=[],X=[],F=[],A=[],E=T.i||2,v=T.tube||.5,k=T.radialSegments||32,L=T.tubularSegments||32,D=T.p||2,c=T.q||3,p=0===T.sideOrientation?0:T.sideOrientation||u.e.DEFAULTSIDE,H=T=>{const z=Math.cos(T),X=Math.sin(T),F=c/D*T,A=Math.cos(F),u=E*(2+A)*.5*z,y=E*(2+A)*X*.5,v=E*Math.sin(F)*.5;return new b.j(u,y,v)};let U,s;for(U=0;U<=k;U++){const T=U%k/k*2*D*Math.PI,z=H(T),F=H(T+.01),u=F.Mc(z);let E=F.add(z);const c=b.j.Cross(u,E);for(E=b.j.Cross(c,u),c.normalize(),E.normalize(),s=0;s<L;s++){const T=s%L/L*2*Math.PI,b=-v*Math.cos(T),F=v*Math.sin(T);X.push(z.x+b*E.x+F*c.x),X.push(z.y+b*E.y+F*c.y),X.push(z.z+b*E.z+F*c.z),A.push(U/k),A.push(y.c?1-s/L:s/L)}}for(U=0;U<k;U++)for(s=0;s<L;s++){const T=(s+1)%L,X=U*L+s,b=(U+1)*L+s,F=(U+1)*L+T,A=U*L+T;z.push(A),z.push(b),z.push(X),z.push(A),z.push(F),z.push(b)}u.e.ComputeNormals(X,z,F),u.e._ComputeSides(p,X,z,F,A,T.frontUVs,T.backUVs);const x=new u.e;return x.indices=z,x.xa=X,x.ya=F,x.Aa=A,x}function V(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2?arguments[2]:void 0;const b=new F.e(T,X);z.sideOrientation=F.e._GetDefaultSideOrientation(z.sideOrientation),b._originalBuilderSideOrientation=z.sideOrientation;return q(z).Ca(b,z.updatable),b}u.e.CreateTorus=l,F.e.CreateTorus=(T,z,X,b,F,A,u)=>a(T,{diameter:z,thickness:X,dl:b,sideOrientation:u,updatable:A},F);u.e.CreateTorusKnot=q,F.e.CreateTorusKnot=(T,z,X,b,F,A,u,y,E,v)=>V(T,{i:z,tube:X,radialSegments:b,tubularSegments:F,p:A,q:u,sideOrientation:v,updatable:E},y);var C=X(12890),G=X(1065),j=X(1452),Z=X(979),m=X(1007);class S extends b.i{constructor(T,z){super(T.x,T.y),this.index=z}}class n{constructor(){this.elements=[]}add(T){const z=[];return T.forEach((T=>{const X=new S(T,this.elements.length);z.push(X),this.elements.push(X)})),z}computeBounds(){const T=new b.i(this.elements[0].x,this.elements[0].y),z=new b.i(this.elements[0].x,this.elements[0].y);return this.elements.forEach((X=>{X.x<T.x?T.x=X.x:X.x>z.x&&(z.x=X.x),X.y<T.y?T.y=X.y:X.y>z.y&&(z.y=X.y)})),{min:T,max:z,width:z.x-T.x,height:z.y-T.y}}}class O{_addToepoint(T){for(const z of T)this._epoints.push(z.x,z.y)}constructor(T,z,X){let b,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new n,this._outlinepoints=new n,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=F,this._name=T,this._scene=X||m.e.LastCreatedScene,b=z instanceof j.c?z.getPoints():z,this._addToepoint(b),this._points.add(b),this._outlinepoints.add(b),"undefined"===typeof this.bjsEarcut&&G.e.Warn("Earcut was not found, the polygon will not be built.")}addHole(T){this._points.add(T);const z=new n;return z.add(T),this._holes.push(z),this._eholes.push(this._epoints.length/2),this._addToepoint(T),this}build(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const b=new F.e(this._name,this._scene),u=this.buildVertexData(z,X);return b.Ga(A.e.PositionKind,u.xa,T),b.Ga(A.e.NormalKind,u.ya,T),b.Ga(A.e.UVKind,u.Aa,T),b.setIndices(u.indices),b}buildVertexData(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const X=new u.e,b=[],F=[],A=[],y=this._points.computeBounds();this._points.elements.forEach((T=>{b.push(0,1,0),F.push(T.x,0,T.y),A.push((T.x-y.min.x)/y.width,(T.y-y.min.y)/y.height)}));const E=[],v=this.bjsEarcut(this._epoints,this._eholes,2);for(let u=0;u<v.length;u++)E.push(v[u]);if(T>0){const X=F.length/3;this._points.elements.forEach((z=>{b.push(0,-1,0),F.push(z.x,-T,z.y),A.push(1-(z.x-y.min.x)/y.width,1-(z.y-y.min.y)/y.height)}));const u=E.length;for(let T=0;T<u;T+=3){const z=E[T+0],b=E[T+1],F=E[T+2];E.push(F+X),E.push(b+X),E.push(z+X)}this._addSide(F,b,A,E,y,this._outlinepoints,T,!1,z),this._holes.forEach((X=>{this._addSide(F,b,A,E,y,X,T,!0,z)}))}return X.indices=E,X.xa=F,X.ya=b,X.Aa=A,X}_addSide(T,z,X,F,A,u,y,E,v){let k=T.length/3,L=0;for(let D=0;D<u.elements.length;D++){const c=u.elements[D],p=u.elements[(D+1)%u.elements.length];T.push(c.x,0,c.y),T.push(c.x,-y,c.y),T.push(p.x,0,p.y),T.push(p.x,-y,p.y);const H=u.elements[(D+u.elements.length-1)%u.elements.length],U=u.elements[(D+2)%u.elements.length];let s=new b.j(-(p.y-c.y),0,p.x-c.x),x=new b.j(-(c.y-H.y),0,c.x-H.x),K=new b.j(-(U.y-p.y),0,U.x-p.x);E||(s=s.scale(-1),x=x.scale(-1),K=K.scale(-1));const d=s.normalizeToNew();let N=x.normalizeToNew(),l=K.normalizeToNew();const a=b.j.Dot(N,d);N=a>v?a<Z.e-1?new b.j(c.x,0,c.y).Mc(new b.j(p.x,0,p.y)).normalize():x.add(s).normalize():d;const q=b.j.Dot(K,s);l=q>v?q<Z.e-1?new b.j(p.x,0,p.y).Mc(new b.j(c.x,0,c.y)).normalize():K.add(s).normalize():d,X.push(L/A.width,0),X.push(L/A.width,1),L+=s.length(),X.push(L/A.width,0),X.push(L/A.width,1),z.push(N.x,N.y,N.z),z.push(N.x,N.y,N.z),z.push(l.x,l.y,l.z),z.push(l.x,l.y,l.z),E?(F.push(k),F.push(k+2),F.push(k+1),F.push(k+1),F.push(k+2),F.push(k+3)):(F.push(k),F.push(k+1),F.push(k+2),F.push(k+1),F.push(k+3),F.push(k+2)),k+=4}}}function P(T,z,X,F,E,v,k){const L=X||new Array(3),c=F,p=[],H=k||!1;for(let A=0;A<3;A++)void 0===L[A]&&(L[A]=new b.n(0,0,1,1)),c&&void 0===c[A]&&(c[A]=new D.d(1,1,1,1));const U=T.getVerticesData(A.e.PositionKind),s=T.getVerticesData(A.e.NormalKind),x=T.getVerticesData(A.e.UVKind),K=T.Ge(),d=U.length/9;let N=0,l=0,a=0,q=0,V=0;const C=[0];if(H)for(let b=d;b<U.length/3;b+=4)l=U[3*(b+2)]-U[3*b],a=U[3*(b+2)+2]-U[3*b+2],q=Math.sqrt(l*l+a*a),V+=q,C.push(V);let G=0,j=0;for(let b=0;b<s.length;b+=3)Math.abs(s[b+1])<.001&&(j=1),Math.abs(s[b+1]-1)<.001&&(j=0),Math.abs(s[b+1]+1)<.001&&(j=2),G=b/3,1===j?(N=G-d,x[2*G]=N%4<1.5?H?L[j].x+(L[j].z-L[j].x)*C[Math.floor(N/4)]/V:L[j].x:H?L[j].x+(L[j].z-L[j].x)*C[Math.floor(N/4)+1]/V:L[j].z,x[2*G+1]=N%2===0?y.c?1-L[j].w:L[j].w:y.c?1-L[j].y:L[j].y):(x[2*G]=(1-x[2*G])*L[j].x+x[2*G]*L[j].z,x[2*G+1]=(1-x[2*G+1])*L[j].y+x[2*G+1]*L[j].w,y.c&&(x[2*G+1]=1-x[2*G+1])),c&&p.push(c[j].r,c[j].g,c[j].b,c[j].a);u.e._ComputeSides(z,U,K,s,x,E,v);const Z=new u.e;if(Z.indices=K,Z.xa=U,Z.ya=s,Z.Aa=x,c){const T=z===u.e.DOUBLESIDE?p.concat(p):p;Z.za=T}return Z}function W(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;z.sideOrientation=F.e._GetDefaultSideOrientation(z.sideOrientation);const u=z.shape,y=z.holes||[],E=z.depth||0,v=z.smoothingThreshold||2,k=[];let L=[];for(let F=0;F<u.length;F++)k[F]=new b.i(u[F].x,u[F].z);k[0].equalsWithEpsilon(k[k.length-1],1e-8)&&k.pop();const D=new O(T,k,X||m.e.LastCreatedScene,A);for(let F=0;F<y.length;F++){L=[];for(let T=0;T<y[F].length;T++)L.push(new b.i(y[F][T].x,y[F][T].z));D.addHole(L)}const c=D.build(!1,E,v);c._originalBuilderSideOrientation=z.sideOrientation;return P(c,z.sideOrientation,z.faceUV,z.faceColors,z.frontUVs,z.backUVs,z.wrap).Ca(c,z.updatable),c}function B(T,z){return W(T,z,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function e(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=z.path,A=z.shape,u=z.scale||1,y=z.rotation||0,E=0===z.cap?0:z.cap||F.e.NO_CAP,v=z.updatable,k=F.e._GetDefaultSideOrientation(z.sideOrientation),L=z.instance||null,D=z.invertUV||!1,c=z.closeShape||!1;return Y(T,A,b,u,y,null,null,z.closePath||!1,c,E,!1,X,!!v,k,L,D,z.frontUVs||null,z.backUVs||null,z.firstNormal||null,!!z.adjustFrame)}function R(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=z.path,A=z.shape,u=z.scaleFunction||(()=>1),y=z.rotationFunction||(()=>0),E=z.closePath||z.ribbonCloseArray||!1,v=z.closeShape||z.ribbonClosePath||!1,k=0===z.cap?0:z.cap||F.e.NO_CAP,L=z.updatable,D=z.firstNormal||null,c=z.adjustFrame||!1;return Y(T,A,b,null,null,u,y,E,v,k,!0,X,!!L,F.e._GetDefaultSideOrientation(z.sideOrientation),z.instance||null,z.invertUV||!1,z.frontUVs||null,z.backUVs||null,D,c)}function Y(T,z,X,A,u,y,E,k,L,D,c,p,H,U,s,x,K,d,N,l){const a=(T,z,X,A,u,y,E,v,k,L,D)=>{const c=X.getTangents(),p=X.getNormals(),H=X.getBinormals(),U=X.getDistances();if(D)for(let F=0;F<c.length;F++)if(0==c[F].x&&0==c[F].y&&0==c[F].z&&c[F].p(c[F-1]),0==p[F].x&&0==p[F].y&&0==p[F].z&&p[F].p(p[F-1]),0==H[F].x&&0==H[F].y&&0==H[F].z&&H[F].p(H[F-1]),F>0){let T=c[F-1];b.j.Dot(T,c[F])<0&&c[F].scaleInPlace(-1),T=p[F-1],b.j.Dot(T,p[F])<0&&p[F].scaleInPlace(-1),T=H[F-1],b.j.Dot(T,H[F])<0&&H[F].scaleInPlace(-1)}let s=0;const x=L&&v?v:()=>null!==y?y:0,K=L&&E?E:()=>null!==u?u:1;let d=k===F.e.NO_CAP||k===F.e.CAP_END?0:2;const N=b.f.Matrix[0];for(let F=0;F<z.length;F++){const X=[],u=x(F,U[F]),y=K(F,U[F]);b.d.RotationAxisToRef(c[F],s,N);for(let A=0;A<T.length;A++){const u=c[F].scale(T[A].z).add(p[F].scale(T[A].x)).add(H[F].scale(T[A].y)),E=b.j.Zero();b.j.TransformCoordinatesToRef(u,N,E),E.scaleInPlace(y).addInPlace(z[F]),X[A]=E}A[d]=X,s+=u,d++}const l=T=>{const z=Array(),X=b.j.Zero();let F;for(F=0;F<T.length;F++)X.addInPlace(T[F]);for(X.scaleInPlace(1/T.length),F=0;F<T.length;F++)z.push(X);return z};switch(k){case F.e.NO_CAP:break;case F.e.CAP_START:A[0]=l(A[2]),A[1]=A[2];break;case F.e.CAP_END:A[d]=A[d-1],A[d+1]=l(A[d-1]);break;case F.e.CAP_ALL:A[0]=l(A[2]),A[1]=A[2],A[d]=A[d-1],A[d+1]=l(A[d-1])}return A};let q,V;if(s){const T=s._creationDataStorage;return q=N?T.path3D.update(X,N):T.path3D.update(X),V=a(z,X,T.path3D,T.pathArray,A,u,y,E,T.cap,c,l),s=v("",{pathArray:V,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:s},p||void 0)}q=N?new j.e(X,N):new j.e(X);V=a(z,X,q,new Array,A,u,y,E,D=D<0||D>3?0:D,c,l);const C=v(T,{pathArray:V,closeArray:k,closePath:L,updatable:H,sideOrientation:U,invertUV:x,frontUVs:K||void 0,backUVs:d||void 0},p);return C._creationDataStorage.pathArray=V,C._creationDataStorage.path3D=q,C._creationDataStorage.cap=D,C}u.e.CreatePolygon=P,F.e.CreatePolygon=function(T,z,X,b,F,A){return W(T,{shape:z,holes:b,updatable:F,sideOrientation:A},X,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},F.e.ExtrudePolygon=function(T,z,X,b,F,A,u){return B(T,{shape:z,holes:F,depth:X,updatable:A,sideOrientation:u},b,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function i(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=z.arc?z.arc<=0||z.arc>1?1:z.arc:1,u=void 0===z.closed||z.closed,y=z.shape,E=z.i||1,k=z.dl||64,L=z.clip||0,D=z.updatable,c=F.e._GetDefaultSideOrientation(z.sideOrientation),p=z.cap||F.e.NO_CAP,H=2*Math.PI,U=[],s=z.invertUV||!1;let x=0,K=0;const d=H/k*A;let N,l;for(x=0;x<=k-L;x++){for(l=[],p!=F.e.CAP_START&&p!=F.e.CAP_ALL||(l.push(new b.j(0,y[0].y,0)),l.push(new b.j(Math.cos(x*d)*y[0].x*E,y[0].y,Math.sin(x*d)*y[0].x*E))),K=0;K<y.length;K++)N=new b.j(Math.cos(x*d)*y[K].x*E,y[K].y,Math.sin(x*d)*y[K].x*E),l.push(N);p!=F.e.CAP_END&&p!=F.e.CAP_ALL||(l.push(new b.j(Math.cos(x*d)*y[y.length-1].x*E,y[y.length-1].y,Math.sin(x*d)*y[y.length-1].x*E)),l.push(new b.j(0,y[y.length-1].y,0))),U.push(l)}return v(T,{pathArray:U,closeArray:u,sideOrientation:c,updatable:D,invertUV:s,frontUVs:z.frontUVs,backUVs:z.backUVs},X)}F.e.ExtrudeShape=function(T,z,X,b,A,u){let y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7?arguments[7]:void 0,v=arguments.length>8?arguments[8]:void 0,k=arguments.length>9?arguments[9]:void 0;return e(T,{shape:z,path:X,scale:b,rotation:A,cap:0===u?0:u||F.e.NO_CAP,sideOrientation:v,instance:k,updatable:E},y)},F.e.ExtrudeShapeCustom=(T,z,X,b,A,u,y,E,v,k,L,D)=>R(T,{shape:z,path:X,scaleFunction:b,rotationFunction:A,ribbonCloseArray:u,ribbonClosePath:y,cap:0===E?0:E||F.e.NO_CAP,sideOrientation:L,instance:D,updatable:k},v);F.e.CreateLathe=(T,z,X,b,F,A,u)=>i(T,{shape:z,i:X,dl:b,sideOrientation:u,updatable:A},F);var t=X(12030),g=X(11983);function M(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=z.path;let u=z.instance,y=1;void 0!==z.i?y=z.i:u&&(y=u._creationDataStorage.i);const E=z.dl||64,k=z.radiusFunction||null;let L=z.cap||F.e.NO_CAP;const D=z.invertUV||!1,c=z.updatable,p=F.e._GetDefaultSideOrientation(z.sideOrientation);z.arc=z.arc&&(z.arc<=0||z.arc>1)?1:z.arc||1;const H=(T,z,X,A,u,y,E,v)=>{const k=z.getTangents(),L=z.getNormals(),D=z.getDistances(),c=2*Math.PI/u*v,p=y||(()=>A);let H,U,s,x;const K=b.f.Matrix[0];let d=E===F.e.NO_CAP||E===F.e.CAP_END?0:2;for(let F=0;F<T.length;F++){U=p(F,D[F]),H=Array(),s=L[F];for(let z=0;z<u;z++)b.d.RotationAxisToRef(k[F],c*z,K),x=H[z]?H[z]:b.j.Zero(),b.j.TransformCoordinatesToRef(s,K,x),x.scaleInPlace(U).addInPlace(T[F]),H[z]=x;X[d]=H,d++}const N=(z,X)=>{const b=Array();for(let F=0;F<z;F++)b.push(T[X]);return b};switch(E){case F.e.NO_CAP:break;case F.e.CAP_START:X[0]=N(u,0),X[1]=X[2].slice(0);break;case F.e.CAP_END:X[d]=X[d-1].slice(0),X[d+1]=N(u,T.length-1);break;case F.e.CAP_ALL:X[0]=N(u,0),X[1]=X[2].slice(0),X[d]=X[d-1].slice(0),X[d+1]=N(u,T.length-1)}return X};let U,s;if(u){const T=u._creationDataStorage,X=z.arc||T.arc;return U=T.path3D.update(A),s=H(A,U,T.pathArray,y,T.dl,k,T.cap,X),u=v("",{pathArray:s,instance:u}),T.path3D=U,T.pathArray=s,T.arc=X,T.i=y,u}U=new j.e(A);L=L<0||L>3?0:L,s=H(A,U,new Array,y,E,k,L,z.arc);const x=v(T,{pathArray:s,closePath:!0,closeArray:!1,updatable:c,sideOrientation:p,invertUV:D,frontUVs:z.frontUVs,backUVs:z.backUVs},X);return x._creationDataStorage.pathArray=s,x._creationDataStorage.path3D=U,x._creationDataStorage.dl=E,x._creationDataStorage.cap=L,x._creationDataStorage.arc=z.arc,x._creationDataStorage.i=y,x}function r(T){const z=[];z[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},z[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},z[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},z[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},z[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},z[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},z[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},z[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},z[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},z[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},z[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},z[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},z[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},z[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},z[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const X=T.type&&(T.type<0||T.type>=z.length)?0:T.type||0,F=T.size,A=T.sizeX||F||1,E=T.sizeY||F||1,v=T.sizeZ||F||1,k=T.custom||z[X],L=k.face.length,c=T.faceUV||new Array(L),p=T.faceColors,H=void 0===T.flat||T.flat,U=0===T.sideOrientation?0:T.sideOrientation||u.e.DEFAULTSIDE,s=[],x=[],K=[],d=[],N=[];let l=0,a=0;const q=[];let V,C,G,j,Z,m,S=0,n=0;if(H)for(n=0;n<L;n++)p&&void 0===p[n]&&(p[n]=new D.d(1,1,1,1)),c&&void 0===c[n]&&(c[n]=new b.n(0,0,1,1));if(H)for(n=0;n<L;n++){const T=k.face[n].length;for(G=2*Math.PI/T,j=.5*Math.tan(G/2),Z=.5,S=0;S<T;S++)s.push(k.vertex[k.face[n][S]][0]*A,k.vertex[k.face[n][S]][1]*E,k.vertex[k.face[n][S]][2]*v),q.push(l),l++,V=c[n].x+(c[n].z-c[n].x)*(.5+j),C=c[n].y+(c[n].w-c[n].y)*(Z-.5),d.push(V,y.c?1-C:C),m=j*Math.cos(G)-Z*Math.sin(G),Z=j*Math.sin(G)+Z*Math.cos(G),j=m,p&&N.push(p[n].r,p[n].g,p[n].b,p[n].a);for(S=0;S<T-2;S++)x.push(q[0+a],q[S+2+a],q[S+1+a]);a+=T}else{for(S=0;S<k.vertex.length;S++)s.push(k.vertex[S][0]*A,k.vertex[S][1]*E,k.vertex[S][2]*v),d.push(0,y.c?1:0);for(n=0;n<L;n++)for(S=0;S<k.face[n].length-2;S++)x.push(k.face[n][0],k.face[n][S+2],k.face[n][S+1])}u.e.ComputeNormals(s,x,K),u.e._ComputeSides(U,s,x,K,d,T.frontUVs,T.backUVs);const O=new u.e;return O.xa=s,O.indices=x,O.ya=K,O.Aa=d,p&&H&&(O.za=N),O}function o(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new F.e(T,X);z.sideOrientation=F.e._GetDefaultSideOrientation(z.sideOrientation),b._originalBuilderSideOrientation=z.sideOrientation;return r(z).Ca(b,z.updatable),b}F.e.CreateTube=(T,z,X,b,F,A,u,y,E,v)=>M(T,{path:z,i:X,dl:b,radiusFunction:F,arc:1,cap:A,updatable:y,sideOrientation:E,instance:v},u);function f(T){const z=T.sideOrientation||u.e.DEFAULTSIDE,X=T.i||1,F=void 0===T.flat||T.flat,A=0|(T.subdivisions||4),E=T.radiusX||X,v=T.radiusY||X,k=T.radiusZ||X,L=(1+Math.sqrt(5))/2,D=[-1,L,-0,1,L,0,-1,-L,0,1,-L,0,0,-1,-L,0,1,-L,0,-1,L,0,1,L,L,0,1,L,0,-1,-L,0,1,-L,0,-1],c=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],p=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],H=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],U=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],s=[],x=[],K=[],d=[];let N=0;const l=new Array(3),a=new Array(3);let q;for(q=0;q<3;q++)l[q]=b.j.Zero(),a[q]=b.i.Zero();for(let u=0;u<20;u++){for(q=0;q<3;q++){const T=c[3*u+q];l[q].Cd(D[3*p[T]],D[3*p[T]+1],D[3*p[T]+2]),l[q].normalize(),a[q].Cd(.134765625*H[2*T]+.05859375+-.0390625*U[u],.2333984375*H[2*T+1]+.025390625+.01953125*U[u])}const T=(T,z,X,u)=>{const L=b.j.Lerp(l[0],l[2],z/A),D=b.j.Lerp(l[1],l[2],z/A),c=A===z?l[2]:b.j.Lerp(L,D,T/(A-z));let p;if(c.normalize(),F){const T=b.j.Lerp(l[0],l[2],u/A),z=b.j.Lerp(l[1],l[2],u/A);p=b.j.Lerp(T,z,X/(A-u))}else p=new b.j(c.x,c.y,c.z);p.x/=E,p.y/=v,p.z/=k,p.normalize();const H=b.i.Lerp(a[0],a[2],z/A),U=b.i.Lerp(a[1],a[2],z/A),q=A===z?a[2]:b.i.Lerp(H,U,T/(A-z));x.push(c.x*E,c.y*v,c.z*k),K.push(p.x,p.y,p.z),d.push(q.x,y.c?1-q.y:q.y),s.push(N),N++};for(let z=0;z<A;z++)for(let X=0;X+z<A;X++)T(X,z,X+1/3,z+1/3),T(X+1,z,X+1/3,z+1/3),T(X,z+1,X+1/3,z+1/3),X+z+1<A&&(T(X+1,z,X+2/3,z+2/3),T(X+1,z+1,X+2/3,z+2/3),T(X,z+1,X+2/3,z+2/3))}u.e._ComputeSides(z,x,s,K,d,T.frontUVs,T.backUVs);const V=new u.e;return V.indices=s,V.xa=x,V.ya=K,V.Aa=d,V}function h(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=new F.e(T,X);z.sideOrientation=F.e._GetDefaultSideOrientation(z.sideOrientation),b._originalBuilderSideOrientation=z.sideOrientation;return f(z).Ca(b,z.updatable),b}u.e.CreatePolyhedron=r,F.e.CreatePolyhedron=(T,z,X)=>o(T,z,X);u.e.CreateIcoSphere=f,F.e.CreateIcoSphere=(T,z,X)=>h(T,z,X);var Q=X(1014);const w=new b.j(1,0,0),J=new b.j(-1,0,0),I=new b.j(0,1,0),TT=new b.j(0,-1,0),zT=new b.j(0,0,1),XT=new b.j(0,0,-1);class bT{constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.j.Zero(),z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.j.Up(),X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.i.Zero(),F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,E=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=T,this.Jd=z,this.uv=X,this.vertexIdx=F,this.vertexIdxForBones=A,this.localPositionOverride=u,this.localNormalOverride=y,this.matrixIndicesOverride=E,this.matrixWeightsOverride=v}clone(){var T,z,X,b;return new bT(this.position.clone(),this.Jd.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(T=this.localPositionOverride)||void 0===T?void 0:T.slice(),null===(z=this.localNormalOverride)||void 0===z?void 0:z.slice(),null===(X=this.matrixIndicesOverride)||void 0===X?void 0:X.slice(),null===(b=this.matrixWeightsOverride)||void 0===b?void 0:b.slice())}}function FT(T,z,X){var E,v,k,L;const D=!!z.skeleton,c=X.localMode||D,p=z.Ge(),H=D?z.Sf(!0,!0):z.getVerticesData(A.e.PositionKind),U=D?z.getNormalsData(!0,!0):z.getVerticesData(A.e.NormalKind),s=c?D?z.getVerticesData(A.e.PositionKind):H:null,x=c?D?z.getVerticesData(A.e.NormalKind):U:null,K=z.getVerticesData(A.e.UVKind),d=D?z.getVerticesData(A.e.MatricesIndicesKind):null,N=D?z.getVerticesData(A.e.MatricesWeightsKind):null,l=D?z.getVerticesData(A.e.MatricesIndicesExtraKind):null,a=D?z.getVerticesData(A.e.MatricesWeightsExtraKind):null,q=X.position||b.j.Zero();let V=X.Jd||b.j.Up();const C=X.size||b.j.One(),G=X.angle||0;if(!V){const T=new b.j(0,0,1),X=z.va().activeCamera,F=b.j.TransformCoordinates(T,X.getWorldMatrix());V=X.globalPosition.Mc(F)}const j=-Math.atan2(V.z,V.x)-Math.PI/2,Z=Math.sqrt(V.x*V.x+V.z*V.z),m=Math.atan2(V.y,Z),S=new u.e;S.indices=[],S.xa=[],S.ya=[],S.Aa=[],S.matricesIndices=D?[]:null,S.matricesWeights=D?[]:null,S.matricesIndicesExtra=l?[]:null,S.matricesWeightsExtra=a?[]:null;let n=0;const O=(T,z)=>{const F=new bT;if(!p||!H||!U)return F;const A=p[T];if(F.vertexIdx=3*A,F.vertexIdxForBones=4*A,F.position=new b.j(H[3*A],H[3*A+1],H[3*A+2]),b.j.TransformCoordinatesToRef(F.position,z,F.position),F.Jd=new b.j(U[3*A],U[3*A+1],U[3*A+2]),b.j.TransformNormalToRef(F.Jd,z,F.Jd),X.captureUVS&&K){const T=K[2*A+1];F.uv=new b.i(K[2*A],y.c?1-T:T)}return F},P=[0,0,0,0],W=(T,z)=>{if(0===T.length)return T;const X=.5*Math.abs(b.j.Dot(C,z)),F=(T,z,X,b)=>{for(let F=0;F<b;++F)if(T[X+F]===z)return X+F;return-1},A=(T,A)=>{const u=b.j.GetClipFactor(T.position,A.position,z,X);let y=P,E=P;if(d&&N){const z=T.matrixIndicesOverride?0:T.vertexIdxForBones,X=T.matrixIndicesOverride??d,b=T.matrixWeightsOverride??N,v=A.matrixIndicesOverride?0:A.vertexIdxForBones,k=A.matrixIndicesOverride??d,L=A.matrixWeightsOverride??N;y=[0,0,0,0],E=[0,0,0,0];let D=0;for(let T=0;T<4;++T)if(b[z+T]>0){const A=F(k,X[z+T],v,4);y[D]=X[z+T],E[D]=(0,Q.p)(b[z+T],A>=0?L[A]:0,u),D++}for(let T=0;T<4&&D<4;++T){const b=k[v+T];-1===F(X,b,z,4)&&(y[D]=b,E[D]=(0,Q.p)(0,L[v+T],u),D++)}const c=E[0]+E[1]+E[2]+E[3];E[0]/=c,E[1]/=c,E[2]/=c,E[3]/=c}const v=T.localPositionOverride?T.localPositionOverride[0]:(null===s||void 0===s?void 0:s[T.vertexIdx])??0,k=T.localPositionOverride?T.localPositionOverride[1]:(null===s||void 0===s?void 0:s[T.vertexIdx+1])??0,L=T.localPositionOverride?T.localPositionOverride[2]:(null===s||void 0===s?void 0:s[T.vertexIdx+2])??0,D=A.localPositionOverride?A.localPositionOverride[0]:(null===s||void 0===s?void 0:s[A.vertexIdx])??0,c=A.localPositionOverride?A.localPositionOverride[1]:(null===s||void 0===s?void 0:s[A.vertexIdx+1])??0,p=A.localPositionOverride?A.localPositionOverride[2]:(null===s||void 0===s?void 0:s[A.vertexIdx+2])??0,H=T.localNormalOverride?T.localNormalOverride[0]:(null===x||void 0===x?void 0:x[T.vertexIdx])??0,U=T.localNormalOverride?T.localNormalOverride[1]:(null===x||void 0===x?void 0:x[T.vertexIdx+1])??0,K=T.localNormalOverride?T.localNormalOverride[2]:(null===x||void 0===x?void 0:x[T.vertexIdx+2])??0,l=H+((A.localNormalOverride?A.localNormalOverride[0]:(null===x||void 0===x?void 0:x[A.vertexIdx])??0)-H)*u,a=U+((A.localNormalOverride?A.localNormalOverride[1]:(null===x||void 0===x?void 0:x[A.vertexIdx+1])??0)-U)*u,q=K+((A.localNormalOverride?A.localNormalOverride[2]:(null===x||void 0===x?void 0:x[A.vertexIdx+2])??0)-K)*u,V=Math.sqrt(l*l+a*a+q*q);return new bT(b.j.Lerp(T.position,A.position,u),b.j.Lerp(T.Jd,A.Jd,u).normalize(),b.i.Lerp(T.uv,A.uv,u),-1,-1,s?[v+(D-v)*u,k+(c-k)*u,L+(p-L)*u]:null,x?[l/V,a/V,q/V]:null,y,E)};let u=null;T.length>3&&(u=[]);for(let y=0;y<T.length;y+=3){let F=0,E=null,v=null,k=null,L=null;const D=b.j.Dot(T[y].position,z)-X>0,c=b.j.Dot(T[y+1].position,z)-X>0,p=b.j.Dot(T[y+2].position,z)-X>0;switch(F=(D?1:0)+(c?1:0)+(p?1:0),F){case 0:T.length>3?(u.push(T[y]),u.push(T[y+1]),u.push(T[y+2])):u=T;break;case 1:if(u=u??new Array,D&&(E=T[y+1],v=T[y+2],k=A(T[y],E),L=A(T[y],v)),c){E=T[y],v=T[y+2],k=A(T[y+1],E),L=A(T[y+1],v),u.push(k),u.push(v.clone()),u.push(E.clone()),u.push(v.clone()),u.push(k.clone()),u.push(L);break}p&&(E=T[y],v=T[y+1],k=A(T[y+2],E),L=A(T[y+2],v)),E&&v&&k&&L&&(u.push(E.clone()),u.push(v.clone()),u.push(k),u.push(L),u.push(k.clone()),u.push(v.clone()));break;case 2:u=u??new Array,D||(E=T[y].clone(),v=A(E,T[y+1]),k=A(E,T[y+2]),u.push(E),u.push(v),u.push(k)),c||(E=T[y+1].clone(),v=A(E,T[y+2]),k=A(E,T[y]),u.push(E),u.push(v),u.push(k)),p||(E=T[y+2].clone(),v=A(E,T[y]),k=A(E,T[y+1]),u.push(E),u.push(v),u.push(k))}}return u},B=z instanceof F.e?z:null,e=null===B||void 0===B?void 0:B._thinInstanceDataStorage.matrixData,R=(null===B||void 0===B?void 0:B.Zj)||1,Y=b.f.Matrix[0];Y.p(b.d.IdentityReadOnly);for(let F=0;F<R;++F){if(null!==B&&void 0!==B&&B.hasThinInstances&&e){const T=16*F;Y.setRowFromFloats(0,e[T+0],e[T+1],e[T+2],e[T+3]),Y.setRowFromFloats(1,e[T+4],e[T+5],e[T+6],e[T+7]),Y.setRowFromFloats(2,e[T+8],e[T+9],e[T+10],e[T+11]),Y.setRowFromFloats(3,e[T+12],e[T+13],e[T+14],e[T+15])}const T=b.d.RotationYawPitchRoll(j,m,G).multiply(b.d.Translation(q.x,q.y,q.z)),A=b.d.Invert(T),u=z.getWorldMatrix(),E=Y.multiply(u).multiply(A),v=new Array(3);for(let z=0;z<p.length;z+=3){let T=v;if(T[0]=O(z,E),T[1]=O(z+1,E),T[2]=O(z+2,E),!(X.cullBackFaces&&-T[0].Jd.z<=0&&-T[1].Jd.z<=0&&-T[2].Jd.z<=0)&&(T=W(T,w),T&&(T=W(T,J),T&&(T=W(T,I),T&&(T=W(T,TT),T&&(T=W(T,zT),T&&(T=W(T,XT),T)))))))for(let z=0;z<T.length;z++){const b=T[z];if(S.indices.push(n),c?(b.localPositionOverride?(S.xa[3*n]=b.localPositionOverride[0],S.xa[3*n+1]=b.localPositionOverride[1],S.xa[3*n+2]=b.localPositionOverride[2]):s&&(S.xa[3*n]=s[b.vertexIdx],S.xa[3*n+1]=s[b.vertexIdx+1],S.xa[3*n+2]=s[b.vertexIdx+2]),b.localNormalOverride?(S.ya[3*n]=b.localNormalOverride[0],S.ya[3*n+1]=b.localNormalOverride[1],S.ya[3*n+2]=b.localNormalOverride[2]):x&&(S.ya[3*n]=x[b.vertexIdx],S.ya[3*n+1]=x[b.vertexIdx+1],S.ya[3*n+2]=x[b.vertexIdx+2])):(b.position.toArray(S.xa,3*n),b.Jd.toArray(S.ya,3*n)),S.matricesIndices&&S.matricesWeights&&(b.matrixIndicesOverride?(S.matricesIndices[4*n]=b.matrixIndicesOverride[0],S.matricesIndices[4*n+1]=b.matrixIndicesOverride[1],S.matricesIndices[4*n+2]=b.matrixIndicesOverride[2],S.matricesIndices[4*n+3]=b.matrixIndicesOverride[3]):(d&&(S.matricesIndices[4*n]=d[b.vertexIdxForBones],S.matricesIndices[4*n+1]=d[b.vertexIdxForBones+1],S.matricesIndices[4*n+2]=d[b.vertexIdxForBones+2],S.matricesIndices[4*n+3]=d[b.vertexIdxForBones+3]),l&&S.matricesIndicesExtra&&(S.matricesIndicesExtra[4*n]=l[b.vertexIdxForBones],S.matricesIndicesExtra[4*n+1]=l[b.vertexIdxForBones+1],S.matricesIndicesExtra[4*n+2]=l[b.vertexIdxForBones+2],S.matricesIndicesExtra[4*n+3]=l[b.vertexIdxForBones+3])),b.matrixWeightsOverride?(S.matricesWeights[4*n]=b.matrixWeightsOverride[0],S.matricesWeights[4*n+1]=b.matrixWeightsOverride[1],S.matricesWeights[4*n+2]=b.matrixWeightsOverride[2],S.matricesWeights[4*n+3]=b.matrixWeightsOverride[3]):(N&&(S.matricesWeights[4*n]=N[b.vertexIdxForBones],S.matricesWeights[4*n+1]=N[b.vertexIdxForBones+1],S.matricesWeights[4*n+2]=N[b.vertexIdxForBones+2],S.matricesWeights[4*n+3]=N[b.vertexIdxForBones+3]),a&&S.matricesWeightsExtra&&(S.matricesWeightsExtra[4*n]=a[b.vertexIdxForBones],S.matricesWeightsExtra[4*n+1]=a[b.vertexIdxForBones+1],S.matricesWeightsExtra[4*n+2]=a[b.vertexIdxForBones+2],S.matricesWeightsExtra[4*n+3]=a[b.vertexIdxForBones+3]))),X.captureUVS)b.uv.toArray(S.Aa,2*n);else{S.Aa.push(.5+b.position.x/C.x);const T=.5+b.position.y/C.y;S.Aa.push(y.c?1-T:T)}n++}}}0===S.indices.length&&(S.indices=null),0===S.xa.length&&(S.xa=null),0===S.ya.length&&(S.ya=null),0===S.Aa.length&&(S.Aa=null),0===(null===(E=S.matricesIndices)||void 0===E?void 0:E.length)&&(S.matricesIndices=null),0===(null===(v=S.matricesWeights)||void 0===v?void 0:v.length)&&(S.matricesWeights=null),0===(null===(k=S.matricesIndicesExtra)||void 0===k?void 0:k.length)&&(S.matricesIndicesExtra=null),0===(null===(L=S.matricesWeightsExtra)||void 0===L?void 0:L.length)&&(S.matricesWeightsExtra=null);const i=new F.e(T,z.va());return S.Ca(i),c?(i.skeleton=z.skeleton,i.parent=z):(i.position=q.clone(),i.rotation=new b.j(m,j,G)),i.ze(!0),i.refreshBoundingInfo(!0,!0),i}function AT(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,dl:16,height:1,i:.25,capSubdivisions:6};const z=0|Math.max(T.subdivisions?T.subdivisions:2,1),X=0|Math.max(T.dl?T.dl:16,3),F=Math.max(T.height?T.height:1,0),A=Math.max(T.i?T.i:.25,0),E=0|Math.max(T.capSubdivisions?T.capSubdivisions:6,1),v=X,k=z,L=Math.max(T.radiusTop?T.radiusTop:A,0),D=Math.max(T.radiusBottom?T.radiusBottom:A,0),c=F-(L+D),p=2*Math.PI,H=Math.max(T.topCapSubdivisions?T.topCapSubdivisions:E,1),U=Math.max(T.bottomCapSubdivisions?T.bottomCapSubdivisions:E,1),s=Math.acos((D-L)/F);let x=[];const K=[],d=[],N=[];let l=0;const a=[],q=.5*c,V=.5*Math.PI;let C,G;const j=b.j.Zero(),Z=b.j.Zero(),m=Math.cos(s),S=Math.sin(s),n=new b.i(L*S,q+L*m).Mc(new b.i(D*S,D*m-q)).length(),O=L*s+n+D*(V-s);let P=0;for(G=0;G<=H;G++){const T=[],z=V-s*(G/H);P+=L*s/H;const X=Math.cos(z),b=Math.sin(z),F=X*L;for(C=0;C<=v;C++){const z=C/v,A=z*p+0,u=Math.sin(A),E=Math.cos(A);Z.x=F*u,Z.y=q+b*L,Z.z=F*E,K.push(Z.x,Z.y,Z.z),j.set(X*u,b,X*E),d.push(j.x,j.y,j.z),N.push(z,y.c?P/O:1-P/O),T.push(l),l++}a.push(T)}const W=F-L-D+m*L-m*D,B=S*(D-L)/W;for(G=1;G<=k;G++){const T=[];P+=n/k;const z=S*(G*(D-L)/k+L);for(C=0;C<=v;C++){const X=C/v,b=X*p+0,F=Math.sin(b),A=Math.cos(b);Z.x=z*F,Z.y=q+m*L-G*W/k,Z.z=z*A,K.push(Z.x,Z.y,Z.z),j.set(F,B,A).normalize(),d.push(j.x,j.y,j.z),N.push(X,y.c?P/O:1-P/O),T.push(l),l++}a.push(T)}for(G=1;G<=U;G++){const T=[],z=V-s-(Math.PI-s)*(G/U);P+=D*s/U;const X=Math.cos(z),b=Math.sin(z),F=X*D;for(C=0;C<=v;C++){const z=C/v,A=z*p+0,u=Math.sin(A),E=Math.cos(A);Z.x=F*u,Z.y=b*D-q,Z.z=F*E,K.push(Z.x,Z.y,Z.z),j.set(X*u,b,X*E),d.push(j.x,j.y,j.z),N.push(z,y.c?P/O:1-P/O),T.push(l),l++}a.push(T)}for(C=0;C<v;C++)for(G=0;G<H+k+U;G++){const T=a[G][C],z=a[G+1][C],X=a[G+1][C+1],b=a[G][C+1];x.push(T),x.push(z),x.push(b),x.push(z),x.push(X),x.push(b)}if(x=x.reverse(),T.orientation&&!T.orientation.equals(b.j.Up())){const z=new b.d;T.orientation.clone().scale(.5*Math.PI).cross(b.j.Up()).toQuaternion().toRotationMatrix(z);const X=b.j.Zero();for(let T=0;T<K.length;T+=3)X.set(K[T],K[T+1],K[T+2]),b.j.TransformCoordinatesToRef(X.clone(),z,X),K[T]=X.x,K[T+1]=X.y,K[T+2]=X.z}const e=new u.e;return e.xa=K,e.ya=d,e.Aa=N,e.indices=x,e}function uT(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:b.j.Up(),subdivisions:2,dl:16,height:1,i:.25,capSubdivisions:6,updatable:!1},X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=new F.e(T,X);return AT(z).Ca(A,z.updatable),A}F.e.CreateDecal=(T,z,X,b,F,A)=>FT(T,z,{position:X,Jd:b,size:F,angle:A});F.e.CreateCapsule=(T,z,X)=>uT(T,z,X),u.e.CreateCapsule=AT;class yT{constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=T,this.y=z,T!==Math.floor(T)&&(T=Math.floor(T),G.e.Warn("x is not an integer, floor(x) used")),z!==Math.floor(z)&&(z=Math.floor(z),G.e.Warn("y is not an integer, floor(y) used"))}clone(){return new yT(this.x,this.y)}rotate60About(T){const z=this.x;return this.x=T.x+T.y-this.y,this.y=z+this.y-T.x,this}rotateNeg60About(T){const z=this.x;return this.x=z+this.y-T.y,this.y=T.x+T.y-z,this}rotate120(T,z){T!==Math.floor(T)&&(T=Math.floor(T),G.e.Warn("m not an integer only floor(m) used")),z!==Math.floor(z)&&(z=Math.floor(z),G.e.Warn("n not an integer only floor(n) used"));const X=this.x;return this.x=T-X-this.y,this.y=z+X,this}rotateNeg120(T,z){T!==Math.floor(T)&&(T=Math.floor(T),G.e.Warn("m is not an integer, floor(m) used")),z!==Math.floor(z)&&(z=Math.floor(z),G.e.Warn("n is not an integer,   floor(n) used"));const X=this.x;return this.x=this.y-z,this.y=T+z-X-this.y,this}toCartesianOrigin(T,z){const X=b.j.Zero();return X.x=T.x+2*this.x*z+this.y*z,X.y=T.y+Math.sqrt(3)*this.y*z,X}static Zero(){return new yT(0,0)}}class ET{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new vT("icosahedron","Regular",[[0,Z.g,-1],[-Z.g,1,0],[-1,0,-Z.g],[1,0,-Z.g],[Z.g,1,0],[0,Z.g,1],[-1,0,Z.g],[-Z.g,-1,0],[0,-Z.g,-1],[Z.g,-1,0],[1,0,Z.g],[0,-Z.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let T=12;const z={},X=this.m,b=this.n;let F,A,u,y,E,v=X,k=1,L=0;0!==b&&(v=(0,Q.i)(X,b)),k=X/v,L=b/v;const D=yT.Zero(),c=new yT(X,b),p=new yT(-b,X+b),H=yT.Zero(),U=yT.Zero(),s=yT.Zero();let x,K,d,N,l=[];const a=[],q=this.vertByDist,V=(X,b,F,A)=>{x=X+"|"+F,K=b+"|"+A,x in z||K in z?x in z&&!(K in z)?z[K]=z[x]:K in z&&!(x in z)&&(z[x]=z[K]):(z[x]=T,z[K]=T,T++),q[F][0]>2?a[z[x]]=[-q[F][0],q[F][1],z[x]]:a[z[x]]=[l[q[F][0]],q[F][1],z[x]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let C=0;C<20;C++){if(l=this.IDATA.face[C],u=l[2],y=l[1],E=l[0],d=D.x+"|"+D.y,x=C+"|"+d,x in z||(z[x]=u,a[u]=[l[q[d][0]],q[d][1]]),d=c.x+"|"+c.y,x=C+"|"+d,x in z||(z[x]=y,a[y]=[l[q[d][0]],q[d][1]]),d=p.x+"|"+p.y,x=C+"|"+d,x in z||(z[x]=E,a[E]=[l[q[d][0]],q[d][1]]),F=this.IDATA.edgematch[C][0],A=this.IDATA.edgematch[C][1],"B"===A)for(let T=1;T<v;T++)U.x=X-T*(k+L),U.y=b+T*k,s.x=-T*L,s.y=T*(k+L),d=U.x+"|"+U.y,N=s.x+"|"+s.y,V(C,F,d,N);if("O"===A)for(let T=1;T<v;T++)s.x=-T*L,s.y=T*(k+L),H.x=T*k,H.y=T*L,d=s.x+"|"+s.y,N=H.x+"|"+H.y,V(C,F,d,N);if(F=this.IDATA.edgematch[C][2],A=this.IDATA.edgematch[C][3],A&&"A"===A)for(let T=1;T<v;T++)H.x=T*k,H.y=T*L,U.x=X-(v-T)*(k+L),U.y=b+(v-T)*k,d=H.x+"|"+H.y,N=U.x+"|"+U.y,V(C,F,d,N);for(let X=0;X<this.vertices.length;X++)d=this.vertices[X].x+"|"+this.vertices[X].y,x=C+"|"+d,x in z||(z[x]=T++,q[d][0]>2?a[z[x]]=[-q[d][0],q[d][1],z[x]]:a[z[x]]=[l[q[d][0]],q[d][1],z[x]])}this.closestTo=a,this.vecToidx=z}calcCoeffs(){const T=this.m,z=this.n,X=Math.sqrt(3)/3,b=T*T+z*z+T*z;this.coau=(T+z)/b,this.cobu=-z/b,this.coav=-X*(T-z)/b,this.cobv=X*(2*T+z)/b}createInnerFacets(){const T=this.m,z=this.n;for(let X=0;X<z+T+1;X++)for(let T=this.min[X];T<this.max[X]+1;T++)T<this.max[X]&&T<this.max[X+1]+1&&this.innerFacets.push(["|"+T+"|"+X,"|"+T+"|"+(X+1),"|"+(T+1)+"|"+X]),X>0&&T<this.max[X-1]&&T+1<this.max[X]+1&&this.innerFacets.push(["|"+T+"|"+X,"|"+(T+1)+"|"+X,"|"+(T+1)+"|"+(X-1)])}edgeVecsABOB(){const T=this.m,z=this.n,X=new yT(-z,T+z);for(let b=1;b<T+z;b++){const T=new yT(this.min[b],b),z=new yT(this.min[b-1],b-1),F=new yT(this.min[b+1],b+1),A=T.clone(),u=z.clone(),y=F.clone();A.rotate60About(X),u.rotate60About(X),y.rotate60About(X);const E=new yT(this.max[A.y],A.y),v=new yT(this.max[A.y-1],A.y-1),k=new yT(this.max[A.y-1]-1,A.y-1);A.x===E.x&&A.y===E.y||(A.x!==v.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([T,v,k]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([T,k,E])):A.y===y.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([T,z,v]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([T,v,F])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([T,z,v]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([T,v,E])))}}mapABOBtoOBOA(){const T=new yT(0,0);for(let z=0;z<this.isoVecsABOB.length;z++){const X=[];for(let b=0;b<3;b++)T.x=this.isoVecsABOB[z][b].x,T.y=this.isoVecsABOB[z][b].y,0===this.vertexTypes[z][b]&&T.rotateNeg120(this.m,this.n),X.push(T.clone());this.isoVecsOBOA.push(X)}}mapABOBtoBAOA(){const T=new yT(0,0);for(let z=0;z<this.isoVecsABOB.length;z++){const X=[];for(let b=0;b<3;b++)T.x=this.isoVecsABOB[z][b].x,T.y=this.isoVecsABOB[z][b].y,1===this.vertexTypes[z][b]&&T.rotate120(this.m,this.n),X.push(T.clone());this.isoVecsBAOA.push(X)}}MapToFace(T,z){const X=this.IDATA.face[T],F=X[2],A=X[1],u=X[0],y=b.j.xd(this.IDATA.vertex[F]),E=b.j.xd(this.IDATA.vertex[A]),v=b.j.xd(this.IDATA.vertex[u]),k=E.Mc(y),L=v.Mc(y),D=k.scale(this.coau).add(L.scale(this.cobu)),c=k.scale(this.coav).add(L.scale(this.cobv)),p=[];let H,U=b.f.Id[0];for(let b=0;b<this.cartesian.length;b++)U=D.scale(this.cartesian[b].x).add(c.scale(this.cartesian[b].y)).add(y),p[b]=[U.x,U.y,U.z],H=T+"|"+this.vertices[b].x+"|"+this.vertices[b].y,z.vertex[this.vecToidx[H]]=[U.x,U.y,U.z]}build(T,z){const X=[],b=yT.Zero(),F=new yT(T,z),A=new yT(-z,T+z);X.push(b,F,A);for(let d=z;d<T+1;d++)for(let z=0;z<T+1-d;z++)X.push(new yT(z,d));if(z>0){const b=(0,Q.i)(T,z),F=T/b,A=z/b;for(let y=1;y<b;y++)X.push(new yT(y*F,y*A)),X.push(new yT(-y*A,y*(F+A))),X.push(new yT(T-y*(F+A),z+y*F));const u=T/z;for(let y=1;y<z;y++)for(let b=0;b<y*u;b++)X.push(new yT(b,y)),X.push(new yT(b,y).rotate120(T,z)),X.push(new yT(b,y).rotateNeg120(T,z))}X.sort(((T,z)=>T.x-z.x)),X.sort(((T,z)=>T.y-z.y));const u=new Array(T+z+1),y=new Array(T+z+1);for(let d=0;d<u.length;d++)u[d]=1/0,y[d]=-1/0;let E=0,v=0;const k=X.length;for(let d=0;d<k;d++)v=X[d].x,E=X[d].y,u[E]=Math.min(v,u[E]),y[E]=Math.max(v,y[E]);const L=(X,b)=>{const F=X.clone();return"A"===b&&F.rotateNeg120(T,z),"B"===b&&F.rotate120(T,z),F.x<0?F.y:F.x+F.y},D=[],c=[],p=[],H=[],U={},s=[];let x=-1,K=-1;for(let d=0;d<k;d++)D[d]=X[d].toCartesianOrigin(new yT(0,0),.5),c[d]=L(X[d],"O"),p[d]=L(X[d],"A"),H[d]=L(X[d],"B"),c[d]===p[d]&&p[d]===H[d]?(x=3,K=c[d]):c[d]===p[d]?(x=4,K=c[d]):p[d]===H[d]?(x=5,K=p[d]):H[d]===c[d]&&(x=6,K=c[d]),c[d]<p[d]&&c[d]<H[d]&&(x=2,K=c[d]),p[d]<c[d]&&p[d]<H[d]&&(x=1,K=p[d]),H[d]<p[d]&&H[d]<c[d]&&(x=0,K=H[d]),s.push([x,K,X[d].x,X[d].y]);s.sort(((T,z)=>T[2]-z[2])),s.sort(((T,z)=>T[3]-z[3])),s.sort(((T,z)=>T[1]-z[1])),s.sort(((T,z)=>T[0]-z[0]));for(let d=0;d<s.length;d++)U[s[d][2]+"|"+s[d][3]]=[s[d][0],s[d][1],d];return this.m=T,this.n=z,this.vertices=X,this.vertByDist=U,this.cartesian=D,this.min=u,this.max=y,this}}class vT{constructor(T,z,X,b){this.name=T,this.category=z,this.vertex=X,this.face=b}}class kT extends vT{innerToData(T,z){for(let X=0;X<z.innerFacets.length;X++)this.face.push(z.innerFacets[X].map((X=>z.vecToidx[T+X])))}mapABOBtoDATA(T,z){const X=z.IDATA.edgematch[T][0];for(let b=0;b<z.isoVecsABOB.length;b++){const F=[];for(let A=0;A<3;A++)0===z.vertexTypes[b][A]?F.push(T+"|"+z.isoVecsABOB[b][A].x+"|"+z.isoVecsABOB[b][A].y):F.push(X+"|"+z.isoVecsABOB[b][A].x+"|"+z.isoVecsABOB[b][A].y);this.face.push([z.vecToidx[F[0]],z.vecToidx[F[1]],z.vecToidx[F[2]]])}}mapOBOAtoDATA(T,z){const X=z.IDATA.edgematch[T][0];for(let b=0;b<z.isoVecsOBOA.length;b++){const F=[];for(let A=0;A<3;A++)1===z.vertexTypes[b][A]?F.push(T+"|"+z.isoVecsOBOA[b][A].x+"|"+z.isoVecsOBOA[b][A].y):F.push(X+"|"+z.isoVecsOBOA[b][A].x+"|"+z.isoVecsOBOA[b][A].y);this.face.push([z.vecToidx[F[0]],z.vecToidx[F[1]],z.vecToidx[F[2]]])}}mapBAOAtoDATA(T,z){const X=z.IDATA.edgematch[T][2];for(let b=0;b<z.isoVecsBAOA.length;b++){const F=[];for(let A=0;A<3;A++)1===z.vertexTypes[b][A]?F.push(T+"|"+z.isoVecsBAOA[b][A].x+"|"+z.isoVecsBAOA[b][A].y):F.push(X+"|"+z.isoVecsBAOA[b][A].x+"|"+z.isoVecsBAOA[b][A].y);this.face.push([z.vecToidx[F[0]],z.vecToidx[F[1]],z.vecToidx[F[2]]])}}orderData(T){const z=[];for(let A=0;A<13;A++)z[A]=[];const X=T.closestTo;for(let A=0;A<X.length;A++)X[A][0]>-1?X[A][1]>0&&z[X[A][0]].push([A,X[A][1]]):z[12].push([A,X[A][0]]);const b=[];for(let A=0;A<12;A++)b[A]=A;let F=12;for(let A=0;A<12;A++){z[A].sort(((T,z)=>T[1]-z[1]));for(let T=0;T<z[A].length;T++)b[z[A][T][0]]=F++}for(let A=0;A<z[12].length;A++)b[z[12][A][0]]=F++;for(let A=0;A<this.vertex.length;A++)this.vertex[A].push(b[A]);this.vertex.sort(((T,z)=>T[3]-z[3]));for(let A=0;A<this.vertex.length;A++)this.vertex[A].pop();for(let A=0;A<this.face.length;A++)for(let T=0;T<this.face[A].length;T++)this.face[A][T]=b[this.face[A][T]];this.sharedNodes=z[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(T,z){const X=[],b=[];let F=z.pop();b.push(F);let A=this.face[F].indexOf(T);A=(A+2)%3;let u=this.face[F][A];X.push(u);let y=0;for(;z.length>0;)F=z[y],this.face[F].indexOf(u)>-1?(A=(this.face[F].indexOf(u)+1)%3,u=this.face[F][A],X.push(u),b.push(F),z.splice(y,1),y=0):y++;return this.adjacentFaces.push(X),b}toGoldbergPolyhedronData(){const T=new vT("GeoDual","Goldberg",[],[]);T.name="GD dual";const z=this.vertex.length,X=new Array(z);for(let E=0;E<z;E++)X[E]=[];for(let E=0;E<this.face.length;E++)for(let T=0;T<3;T++)X[this.face[E][T]].push(E);let b=0,F=0,A=0,u=[],y=[];this.adjacentFaces=[];for(let E=0;E<X.length;E++)T.face[E]=this.setOrder(E,X[E].concat([])),X[E].forEach((z=>{b=0,F=0,A=0,u=this.face[z];for(let T=0;T<3;T++)y=this.vertex[u[T]],b+=y[0],F+=y[1],A+=y[2];T.vertex[z]=[b/3,F/3,A/3]}));return T}static BuildGeodesicData(T){const z=new kT("Geodesic-m-n","Geodesic",[[0,Z.g,-1],[-Z.g,1,0],[-1,0,-Z.g],[1,0,-Z.g],[Z.g,1,0],[0,Z.g,1],[-1,0,Z.g],[-Z.g,-1,0],[0,-Z.g,-1],[Z.g,-1,0],[1,0,Z.g],[0,-Z.g,1]],[]);T.setIndices(),T.calcCoeffs(),T.createInnerFacets(),T.edgeVecsABOB(),T.mapABOBtoOBOA(),T.mapABOBtoBAOA();for(let X=0;X<T.IDATA.face.length;X++)T.MapToFace(X,z),z.innerToData(X,T),"B"===T.IDATA.edgematch[X][1]&&z.mapABOBtoDATA(X,T),"O"===T.IDATA.edgematch[X][1]&&z.mapOBOAtoDATA(X,T),"A"===T.IDATA.edgematch[X][3]&&z.mapBAOAtoDATA(X,T);z.orderData(T);return z.vertex=z.vertex.map((function(T){const z=T[0],X=T[1],b=T[2],F=Math.sqrt(z*z+X*X+b*b);return T[0]*=1/F,T[1]*=1/F,T[2]*=1/F,T})),z}}F.e._GoldbergMeshParser=(T,z)=>LT.Parse(T,z);class LT extends F.e{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(T,z){return void 0===z?(T>this.goldbergData.nbUnsharedFaces-1&&(G.e.Warn("Maximum number of unshared faces used"),T=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+T):(T>11&&(G.e.Warn("Last pole used"),T=11),z>this.goldbergData.nbFacesAtPole-1&&(G.e.Warn("Maximum number of faces at a pole used"),z=this.goldbergData.nbFacesAtPole-1),12+T*this.goldbergData.nbFacesAtPole+z)}_changeGoldbergFaceColors(T){for(let X=0;X<T.length;X++){const z=T[X][0],b=T[X][1],F=T[X][2];for(let T=z;T<b+1;T++)this.goldbergData.faceColors[T]=F}const z=[];for(let X=0;X<12;X++)for(let T=0;T<5;T++)z.push(this.goldbergData.faceColors[X].r,this.goldbergData.faceColors[X].g,this.goldbergData.faceColors[X].b,this.goldbergData.faceColors[X].a);for(let X=12;X<this.goldbergData.faceColors.length;X++)for(let T=0;T<6;T++)z.push(this.goldbergData.faceColors[X].r,this.goldbergData.faceColors[X].g,this.goldbergData.faceColors[X].b,this.goldbergData.faceColors[X].a);return z}setGoldbergFaceColors(T){const z=this._changeGoldbergFaceColors(T);this.Ga(A.e.ColorKind,z)}updateGoldbergFaceColors(T){const z=this._changeGoldbergFaceColors(T);this.updateVerticesData(A.e.ColorKind,z)}_changeGoldbergFaceUVs(T){const z=this.getVerticesData(A.e.UVKind);for(let X=0;X<T.length;X++){const b=T[X][0],F=T[X][1],A=T[X][2],u=T[X][3],y=T[X][4],E=[],v=[];let k,L;for(let T=0;T<5;T++)k=A.x+u*Math.cos(y+T*Math.PI/2.5),L=A.y+u*Math.sin(y+T*Math.PI/2.5),k<0&&(k=0),k>1&&(k=1),E.push(k,L);for(let T=0;T<6;T++)k=A.x+u*Math.cos(y+T*Math.PI/3),L=A.y+u*Math.sin(y+T*Math.PI/3),k<0&&(k=0),k>1&&(k=1),v.push(k,L);for(let T=b;T<Math.min(12,F+1);T++)for(let X=0;X<5;X++)z[10*T+2*X]=E[2*X],z[10*T+2*X+1]=E[2*X+1];for(let T=Math.max(12,b);T<F+1;T++)for(let X=0;X<6;X++)z[12*T-24+2*X]=v[2*X],z[12*T-23+2*X]=v[2*X+1]}return z}setGoldbergFaceUVs(T){const z=this._changeGoldbergFaceUVs(T);this.Ga(A.e.UVKind,z)}updateGoldbergFaceUVs(T){const z=this._changeGoldbergFaceUVs(T);this.updateVerticesData(A.e.UVKind,z)}placeOnGoldbergFaceAt(T,z,X){const F=b.j.RotationFromAxis(this.goldbergData.faceXaxis[z],this.goldbergData.faceYaxis[z],this.goldbergData.faceZaxis[z]);T.rotation=F,T.position=this.goldbergData.faceCenters[z].add(this.goldbergData.faceXaxis[z].scale(X.x)).add(this.goldbergData.faceYaxis[z].scale(X.y)).add(this.goldbergData.faceZaxis[z].scale(X.z))}serialize(T){super.serialize(T),T.type="GoldbergMesh";const z={};if(z.adjacentFaces=this.goldbergData.adjacentFaces,z.nbSharedFaces=this.goldbergData.nbSharedFaces,z.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,z.nbFaces=this.goldbergData.nbFaces,z.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){z.faceColors=[];for(const T of this.goldbergData.faceColors)z.faceColors.push(T.zd())}if(this.goldbergData.faceCenters){z.faceCenters=[];for(const T of this.goldbergData.faceCenters)z.faceCenters.push(T.zd())}if(this.goldbergData.faceZaxis){z.faceZaxis=[];for(const T of this.goldbergData.faceZaxis)z.faceZaxis.push(T.zd())}if(this.goldbergData.faceYaxis){z.faceYaxis=[];for(const T of this.goldbergData.faceYaxis)z.faceYaxis.push(T.zd())}if(this.goldbergData.faceXaxis){z.faceXaxis=[];for(const T of this.goldbergData.faceXaxis)z.faceXaxis.push(T.zd())}T.goldbergData=z}static Parse(T,z){const X=T.goldbergData;X.faceColors=X.faceColors.map((T=>D.d.xd(T))),X.faceCenters=X.faceCenters.map((T=>b.j.xd(T))),X.faceZaxis=X.faceZaxis.map((T=>b.j.xd(T))),X.faceXaxis=X.faceXaxis.map((T=>b.j.xd(T))),X.faceYaxis=X.faceYaxis.map((T=>b.j.xd(T)));const F=new LT(T.name,z);return F.goldbergData=X,F}}var DT=X(11973);class cT{constructor(T){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=T}moveTo(T,z){this._currentPath=new j.c(T,z),this._tempPaths.push(this._currentPath)}lineTo(T,z){this._currentPath.addLineTo(T,z)}quadraticCurveTo(T,z,X,b){this._currentPath.addQuadraticCurveTo(T,z,X,b,this._resolution)}bezierCurveTo(T,z,X,b,F,A){this._currentPath.addBezierCurveTo(T,z,X,b,F,A,this._resolution)}extractHoles(){for(const T of this._tempPaths)T.area()>0?this._holes.push(T):this._paths.push(T);if(!this._paths.length&&this._holes.length){const T=this._holes;this._holes=this._paths,this._paths=T}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function pT(T,z,X,b,F,A){const u=A.glyphs[T]||A.glyphs["?"];if(!u)return null;const y=new cT(F);if(u.o){const T=u.o.split(" ");for(let F=0,A=T.length;F<A;){switch(T[F++]){case"m":{const A=parseInt(T[F++])*z+X,u=parseInt(T[F++])*z+b;y.moveTo(A,u);break}case"l":{const A=parseInt(T[F++])*z+X,u=parseInt(T[F++])*z+b;y.lineTo(A,u);break}case"q":{const A=parseInt(T[F++])*z+X,u=parseInt(T[F++])*z+b,E=parseInt(T[F++])*z+X,v=parseInt(T[F++])*z+b;y.quadraticCurveTo(E,v,A,u);break}case"b":{const A=parseInt(T[F++])*z+X,u=parseInt(T[F++])*z+b,E=parseInt(T[F++])*z+X,v=parseInt(T[F++])*z+b,k=parseInt(T[F++])*z+X,L=parseInt(T[F++])*z+b;y.bezierCurveTo(E,v,k,L,A,u);break}}}}return y.extractHoles(),{offsetX:u.ha*z,shapePath:y}}const HT={CreateBox:L.f,CreateTiledBox:U,CreateSphere:s.b,kb:k.e,CreateIcoSphere:h,CreateRibbon:v,CreateCylinder:N,CreateTorus:a,CreateTorusKnot:V,CreateLineSystem:C.d,lb:C.h,CreateDashedLines:C.c,ExtrudeShape:e,ExtrudeShapeCustom:R,CreateLathe:i,CreateTiledPlane:p,Ig:t.c,CreateGround:g.d,CreateTiledGround:g.e,CreateGroundFromHeightMap:g.b,CreatePolygon:W,ExtrudePolygon:B,CreateTube:M,CreatePolyhedron:o,CreateGeodesic:function(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=z.m||1;b!==Math.floor(b)&&(b=Math.floor(b),G.e.Warn("m not an integer only floor(m) used"));let F=z.n||0;if(F!==Math.floor(F)&&(F=Math.floor(F),G.e.Warn("n not an integer only floor(n) used")),F>b){const T=F;F=b,b=T,G.e.Warn("n > m therefore m and n swapped")}const A=new ET;return A.build(b,F),o(T,{custom:kT.BuildGeodesicData(A),size:z.size,sizeX:z.sizeX,sizeY:z.sizeY,sizeZ:z.sizeZ,faceUV:z.faceUV,faceColors:z.faceColors,flat:z.flat,updatable:z.updatable,sideOrientation:z.sideOrientation,frontUVs:z.frontUVs,backUVs:z.backUVs},X)},CreateGoldberg:function(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const A=z.size,E=z.sizeX||A||1,v=z.sizeY||A||1,k=z.sizeZ||A||1;let L=z.m||1;L!==Math.floor(L)&&(L=Math.floor(L),G.e.Warn("m not an integer only floor(m) used"));let c=z.n||0;if(c!==Math.floor(c)&&(c=Math.floor(c),G.e.Warn("n not an integer only floor(n) used")),c>L){const T=c;c=L,L=T,G.e.Warn("n > m therefore m and n swapped")}const p=new ET;p.build(L,c);const H=kT.BuildGeodesicData(p),U=H.toGoldbergPolyhedronData(),s=new LT(T,X);z.sideOrientation=F.e._GetDefaultSideOrientation(z.sideOrientation),s._originalBuilderSideOrientation=z.sideOrientation;(function(T,z){const X=T.size,F=T.sizeX||X||1,A=T.sizeY||X||1,E=T.sizeZ||X||1,v=0===T.sideOrientation?0:T.sideOrientation||u.e.DEFAULTSIDE,k=[],L=[],D=[],c=[];let p=1/0,H=-1/0,U=1/0,s=-1/0;for(let b=0;b<z.vertex.length;b++)p=Math.min(p,z.vertex[b][0]*F),H=Math.max(H,z.vertex[b][0]*F),U=Math.min(U,z.vertex[b][1]*A),s=Math.max(s,z.vertex[b][1]*A);let x=0;for(let u=0;u<z.face.length;u++){const T=z.face[u],X=b.j.xd(z.vertex[T[0]]),v=b.j.xd(z.vertex[T[2]]),K=b.j.xd(z.vertex[T[1]]),d=v.Mc(X),N=K.Mc(X),l=b.j.Cross(N,d).normalize();for(let b=0;b<T.length;b++){D.push(l.x,l.y,l.z);const X=z.vertex[T[b]];k.push(X[0]*F,X[1]*A,X[2]*E);const u=(X[1]*A-U)/(s-U);c.push((X[0]*F-p)/(H-p),y.c?1-u:u)}for(let z=0;z<T.length-2;z++)L.push(x,x+z+2,x+z+1);x+=T.length}u.e._ComputeSides(v,k,L,D,c);const K=new u.e;return K.xa=k,K.indices=L,K.ya=D,K.Aa=c,K})(z,U).Ca(s,z.updatable),s.goldbergData.nbSharedFaces=H.sharedNodes,s.goldbergData.nbUnsharedFaces=H.poleNodes,s.goldbergData.adjacentFaces=H.adjacentFaces,s.goldbergData.nbFaces=s.goldbergData.nbSharedFaces+s.goldbergData.nbUnsharedFaces,s.goldbergData.nbFacesAtPole=(s.goldbergData.nbUnsharedFaces-12)/12;for(let F=0;F<H.vertex.length;F++)s.goldbergData.faceCenters.push(b.j.xd(H.vertex[F])),s.goldbergData.faceCenters[F].x*=E,s.goldbergData.faceCenters[F].y*=v,s.goldbergData.faceCenters[F].z*=k,s.goldbergData.faceColors.push(new D.d(1,1,1,1));for(let F=0;F<U.face.length;F++){const T=U.face[F],z=b.j.xd(U.vertex[T[0]]),X=b.j.xd(U.vertex[T[2]]),A=b.j.xd(U.vertex[T[1]]),u=X.Mc(z),y=A.Mc(z),E=b.j.Cross(y,u).normalize(),v=b.j.Cross(y,E).normalize();s.goldbergData.faceXaxis.push(y.normalize()),s.goldbergData.faceYaxis.push(E),s.goldbergData.faceZaxis.push(v)}return s},CreateDecal:FT,CreateCapsule:uT,CreateText:function(T,z,X){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const E=function(T,z,X,b){const F=Array.from(T),A=z/b.resolution,u=(b.boundingBox.yMax-b.boundingBox.yMin+b.underlineThickness)*A,y=[];let E=0,v=0;for(let k=0;k<F.length;k++){const T=F[k];if("\n"===T)E=0,v-=u;else{const z=pT(T,A,E,v,X,b);z&&(E+=z.offsetX,y.push(z.shapePath))}}return y}(z,A.size||50,A.resolution||8,X),v=[];let k=0;for(const p of E){if(!p.paths.length)continue;const z=p.holes.slice();for(const X of p.paths){var L,D;const E=[],c=[],p=X.getPoints();for(const T of p)c.push(new b.j(T.x,0,T.y));const H=z.slice();for(const T of H){const F=T.getPoints();let A=!1;for(const T of F)if(X.isPointInside(T)){A=!0;break}if(!A)continue;const u=[];for(const T of F)u.push(new b.j(T.x,0,T.y));E.push(u),z.splice(z.indexOf(T),1)}if(!E.length&&z.length)for(const T of z){const z=T.getPoints(),X=[];for(const T of z)X.push(new b.j(T.x,0,T.y));E.push(X)}const U=B(T,{shape:c,holes:E.length?E:void 0,depth:A.depth||1,faceUV:A.faceUV||(null===(L=A.perLetterFaceUV)||void 0===L?void 0:L.call(A,k)),faceColors:A.faceColors||(null===(D=A.perLetterFaceColors)||void 0===D?void 0:D.call(A,k)),sideOrientation:F.e._GetDefaultSideOrientation(A.sideOrientation||F.e.DOUBLESIDE)},u,y);v.push(U),k++}}const c=F.e.MergeMeshes(v,!0,!0);if(c){const z=c.getBoundingInfo().boundingBox;c.position.x+=-(z.minimumWorld.x+z.maximumWorld.x)/2,c.position.y+=-(z.minimumWorld.y+z.maximumWorld.y)/2,c.position.z+=-(z.minimumWorld.z+z.maximumWorld.z)/2+z.extendSize.z,c.name=T;const X=new DT.e("pivot",u);X.rotation.x=-Math.PI/2,c.parent=X,c.bakeCurrentTransformIntoVertices(),c.parent=null,X.dispose()}return c}}},12538:(T,z,X)=>{"use strict";var b=X(11933),F=X(1207),A=X(976),u=X(1065),y=X(1282);b.e.prototype.thinInstanceAdd=function(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return u.e.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(T)?T.length:1);const X=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(T))for(let b=0;b<T.length;++b)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,T[b],b===T.length-1&&z);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,T,z);return X},b.e.prototype.thinInstanceAddSelf=function(){let T=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(A.d.IdentityReadOnly,T)},b.e.prototype.thinInstanceRegisterAttribute=function(T,z){T===F.e.ColorKind&&(T=F.e.ColorInstanceKind),this.removeVerticesData(T),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[T]=z,this._userThinInstanceBuffersStorage.sizes[T]=z*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[T]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[T]),this._userThinInstanceBuffersStorage.vertexBuffers[T]=new F.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[T],T,!0,!1,z,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[T])},b.e.prototype.thinInstanceSetMatrixAt=function(T,z){let X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||T>=this._thinInstanceDataStorage.instancesCount)return!1;const b=this._thinInstanceDataStorage.matrixData;return z.copyToArray(b,16*T),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[T]=z),X&&(this.ak("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},b.e.prototype.thinInstanceSetAttributeAt=function(T,z,X){let b=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return T===F.e.ColorKind&&(T=F.e.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[T]||z>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(T,0),this._userThinInstanceBuffersStorage.data[T].set(X,z*this._userThinInstanceBuffersStorage.strides[T]),b&&this.ak(T),!0)},Object.defineProperty(b.e.prototype,"Zj",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(T){var z;const X=this._thinInstanceDataStorage.matrixData??(null===(z=this.source)||void 0===z?void 0:z._thinInstanceDataStorage.matrixData);T<=(X?X.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=T)},enumerable:!0,configurable:!0}),b.e.prototype._thinInstanceCreateMatrixBuffer=function(T,z){let X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const b=new F.b(this.getEngine(),z,!X,16,!1,!0);for(let F=0;F<4;F++)this.setVerticesBuffer(b.createVertexBuffer(T+F,4*F,4));return b},b.e.prototype.bk=function(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,b=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var A;if(X=X||16,"matrix"===T)null===(A=this._thinInstanceDataStorage.matrixBuffer)||void 0===A||A.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=z?z.length:32*X,this._thinInstanceDataStorage.matrixData=z,this._thinInstanceDataStorage.worldMatrices=null,null!==z?(this._thinInstanceDataStorage.instancesCount=z.length/X,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",z,b),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===T){var u;null===(u=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===u||u.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=z,null!==z&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",z,b))}else{var y;if(T===F.e.ColorKind&&(T=F.e.ColorInstanceKind),null===z)null!==(y=this._userThinInstanceBuffersStorage)&&void 0!==y&&y.data[T]&&(this.removeVerticesData(T),delete this._userThinInstanceBuffersStorage.data[T],delete this._userThinInstanceBuffersStorage.strides[T],delete this._userThinInstanceBuffersStorage.sizes[T],delete this._userThinInstanceBuffersStorage.vertexBuffers[T]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[T]=z,this._userThinInstanceBuffersStorage.strides[T]=X,this._userThinInstanceBuffersStorage.sizes[T]=z.length,this._userThinInstanceBuffersStorage.vertexBuffers[T]=new F.e(this.getEngine(),z,T,!b,!1,X,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[T])}},b.e.prototype.ak=function(T){var z;if("matrix"===T)this.Yj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(T),null===(z=this._thinInstanceDataStorage.matrixBuffer)||void 0===z||z.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===T){var X;this.Yj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(T),null===(X=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===X||X.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var b;T===F.e.ColorKind&&(T=F.e.ColorInstanceKind),null!==(b=this._userThinInstanceBuffersStorage)&&void 0!==b&&b.vertexBuffers[T]&&(this.Yj&&!this._userThinInstanceBuffersStorage.vertexBuffers[T].isUpdatable()&&this._thinInstanceRecreateBuffer(T),this._userThinInstanceBuffersStorage.vertexBuffers[T].updateDirectly(this._userThinInstanceBuffersStorage.data[T],0))}},b.e.prototype.thinInstancePartialBufferUpdate=function(T,z,X){var b;"matrix"===T?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(z,X):(T===F.e.ColorKind&&(T=F.e.ColorInstanceKind),null!==(b=this._userThinInstanceBuffersStorage)&&void 0!==b&&b.vertexBuffers[T]&&this._userThinInstanceBuffersStorage.vertexBuffers[T].updateDirectly(z,X))},b.e.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const T=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let z=0;z<this._thinInstanceDataStorage.instancesCount;++z)this._thinInstanceDataStorage.worldMatrices[z]=A.d.xd(T,16*z)}return this._thinInstanceDataStorage.worldMatrices},b.e.prototype.thinInstanceRefreshBoundingInfo=function(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const b=this._thinInstanceDataStorage.boundingVectors;if(T||!this.rawBoundingInfo){b.length=0,this.refreshBoundingInfo(z,X);const T=this.getBoundingInfo();this.rawBoundingInfo=new y.c(T.minimum,T.maximum)}const F=this.getBoundingInfo(),u=this._thinInstanceDataStorage.matrixData;if(0===b.length)for(let A=0;A<F.boundingBox.vectors.length;++A)b.push(F.boundingBox.vectors[A].clone());A.f.Id[0].Gd(Number.POSITIVE_INFINITY),A.f.Id[1].Gd(Number.NEGATIVE_INFINITY);for(let y=0;y<this._thinInstanceDataStorage.instancesCount;++y){A.d.FromArrayToRef(u,16*y,A.f.Matrix[0]);for(let T=0;T<b.length;++T)A.j.TransformCoordinatesToRef(b[T],A.f.Matrix[0],A.f.Id[2]),A.f.Id[0].minimizeInPlace(A.f.Id[2]),A.f.Id[1].maximizeInPlace(A.f.Id[2])}F.reConstruct(A.f.Id[0],A.f.Id[1]),this.Ea()},b.e.prototype._thinInstanceRecreateBuffer=function(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var X;if("matrix"===T)null===(X=this._thinInstanceDataStorage.matrixBuffer)||void 0===X||X.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,z);else if("previousMatrix"===T){var b;if(this._scene.needsPreviousWorldMatrices)null===(b=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===b||b.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,z)}else{var A;T===F.e.ColorKind&&(T=F.e.ColorInstanceKind),null===(A=this._userThinInstanceBuffersStorage.vertexBuffers[T])||void 0===A||A.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[T]=new F.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[T],T,!z,!1,this._userThinInstanceBuffersStorage.strides[T],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[T])}},b.e.prototype._thinInstanceUpdateBufferSize=function(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;T===F.e.ColorKind&&(T=F.e.ColorInstanceKind);const X="matrix"===T;if(!X&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[T]))return;const b=X?16:this._userThinInstanceBuffersStorage.strides[T],A=X?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[T];let u=X?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[T];const y=(this._thinInstanceDataStorage.instancesCount+z)*b;let E=A;for(;E<y;)E*=2;if(!u||A!=E){if(u){const T=new Float32Array(E);T.set(u,0),u=T}else u=new Float32Array(E);var v,k,L;if(X){if(null===(v=this._thinInstanceDataStorage.matrixBuffer)||void 0===v||v.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",u,!1),this._thinInstanceDataStorage.matrixData=u,this._thinInstanceDataStorage.matrixBufferSize=E,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(k=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===k||k.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",u,!1)}else null===(L=this._userThinInstanceBuffersStorage.vertexBuffers[T])||void 0===L||L.dispose(),this._userThinInstanceBuffersStorage.data[T]=u,this._userThinInstanceBuffersStorage.sizes[T]=E,this._userThinInstanceBuffersStorage.vertexBuffers[T]=new F.e(this.getEngine(),u,T,!0,!1,b,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[T])}},b.e.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},b.e.prototype._disposeThinInstanceSpecificData=function(){var T;null!==(T=this._thinInstanceDataStorage)&&void 0!==T&&T.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11973:(T,z,X)=>{"use strict";X.d(z,{e:()=>L});var b=X(952),F=X(957),A=X(1122),u=X(968),y=X(976),E=X(11948),v=X(993);const k=y.d.Compose(y.j.One(),y.e.FromEulerAngles(0,Math.PI,0),y.j.Zero());class L extends E.b{get billboardMode(){return this._billboardMode}set billboardMode(T){this._billboardMode!==T&&(this._billboardMode=T,this._cache.useBillboardPosition=0!==(this._billboardMode&L.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(T){T!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=T,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==L.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(T){this._infiniteDistance!==T&&(this._infiniteDistance=T)}constructor(T){let z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(T,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new y.j(0,0,1),this._up=new y.j(0,1,0),this._right=new y.j(1,0,0),this._position=y.j.Zero(),this._rotation=y.j.Zero(),this._rotationQuaternion=null,this._scaling=y.j.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=L.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this._j=y.d.Zero(),this._usePivotMatrix=!1,this._absolutePosition=y.j.Zero(),this._absoluteScaling=y.j.Zero(),this._absoluteRotationQuaternion=y.e.Identity(),this._pivotMatrix=y.d.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new u.d,this._nonUniformScaling=!1,z&&this.va().addTransformNode(this)}getClassName(){return"mb"}get position(){return this._position}set position(T){this._position=T,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(T){this._rotation=T,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Pd(){return this._scaling}set Pd(T){this._scaling=T,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(T){this._rotationQuaternion=T,T&&this._rotation.Gd(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return y.j.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return y.j.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return y.j.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(T){return this._poseMatrix?(this._poseMatrix.p(T),this):(this._poseMatrix=T.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=y.d.Identity()),this._poseMatrix}_isSynchronized(){const T=this._cache;return this._billboardMode===T.billboardMode&&this._billboardMode===L.BILLBOARDMODE_NONE&&(!T.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const T=this._cache;T.localMatrixUpdated=!1,T.billboardMode=-1,T.infiniteDistance=!1,T.useBillboardPosition=!1,T.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(T){return this.setPivotMatrix(T,!1)}setPivotMatrix(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(T),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=z,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=y.d.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,z=arguments.length>1?arguments[1]:void 0,X=arguments.length>2?arguments[2]:void 0;const b=this.clone("Clone of "+(this.name||this.id),T||this.parent,!0);b&&X&&X(this,b);for(const F of this.getChildTransformNodes(!0))F.instantiateHierarchy(b,z,X);return b}oi(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return T?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.Gd(0),this._rotationQuaternion=this._rotationQuaternion||y.e.Identity(),T.decompose(this._scaling,this._rotationQuaternion,this._position),this.ze(!0)):(this._worldMatrix=T,this._absolutePosition.Cd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.ze(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.ze(!0),this}get Ej(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.ze(),this._absolutePosition}setAbsolutePosition(T){if(!T)return this;let z,X,b;if(void 0===T.x){if(arguments.length<3)return this;z=arguments[0],X=arguments[1],b=arguments[2]}else z=T.x,X=T.y,b=T.z;if(this.parent){const T=y.f.Matrix[0];this.parent.getWorldMatrix().invertToRef(T),y.j.TransformCoordinatesFromFloatsToRef(z,X,b,T,this.position)}else this.position.x=z,this.position.y=X,this.position.z=b;return this._absolutePosition.p(T),this}setPositionWithLocalVector(T){return this.ze(),this.position=y.j.TransformNormal(T,this._j),this}getPositionExpressedInLocalSpace(){this.ze();const T=y.f.Matrix[0];return this._j.invertToRef(T),y.j.TransformNormal(this.position,T)}locallyTranslate(T){return this.ze(!0),this.position=y.j.TransformCoordinates(T,this._j),this}lookAt(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const A=L._LookAtVectorCache,u=0===F?this.position:this.getAbsolutePosition();if(T.subtractToRef(u,A),this.setDirection(A,z,X,b),1===F&&this.parent)if(this.rotationQuaternion){const T=y.f.Matrix[0];this.rotationQuaternion.toRotationMatrix(T);const z=y.f.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(z),z.invert(),T.multiplyToRef(z,T),this.rotationQuaternion.fromRotationMatrix(T)}else{const T=y.f.Quaternion[0];y.e.FromEulerVectorToRef(this.rotation,T);const z=y.f.Matrix[0];T.toRotationMatrix(z);const X=y.f.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(X),X.invert(),z.multiplyToRef(X,z),T.fromRotationMatrix(z),T.toEulerAnglesToRef(this.rotation)}return this}me(T){const z=y.j.Zero();return this.getDirectionToRef(T,z),z}getDirectionToRef(T,z){return y.j.TransformNormalToRef(T,this.getWorldMatrix(),z),this}setDirection(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const F=-Math.atan2(T.z,T.x)+Math.PI/2,A=Math.sqrt(T.x*T.x+T.z*T.z),u=-Math.atan2(T.y,A);return this.rotationQuaternion?y.e.RotationYawPitchRollToRef(F+z,u+X,b,this.rotationQuaternion):(this.rotation.x=u+X,this.rotation.y=F+z,this.rotation.z=b),this}setPivotPoint(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.ze(!0);const X=this.getWorldMatrix();if(1==z){const z=y.f.Matrix[0];X.invertToRef(z),T=y.j.TransformCoordinates(T,z)}return this.setPivotMatrix(y.d.Translation(-T.x,-T.y,-T.z),!0)}getPivotPoint(){const T=y.j.Zero();return this.getPivotPointToRef(T),T}getPivotPointToRef(T){return T.x=-this._pivotMatrix.m[12],T.y=-this._pivotMatrix.m[13],T.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const T=y.j.Zero();return this.getAbsolutePivotPointToRef(T),T}getAbsolutePivotPointToRef(T){return this.getPivotPointToRef(T),y.j.TransformCoordinatesToRef(T,this.getWorldMatrix(),T),this}Fe(T){if(this._isDirty)return this;if(this._children)for(const z of this._children)z.Fe(T);return super.Fe(T)}setParent(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!T&&!this.parent)return this;const b=y.f.Quaternion[0],F=y.f.Id[0],A=y.f.Id[1],u=y.f.Matrix[1];y.d.IdentityToRef(u);const E=y.f.Matrix[0];this.ze(!0);let v=this.rotationQuaternion;return v||(v=L._TmpRotation,y.e.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,v)),y.d.ComposeToRef(this.Pd,v,this.position,E),this.parent&&E.multiplyToRef(this.parent.ze(!0),E),T&&(T.ze(!0).invertToRef(u),E.multiplyToRef(u,E)),E.decompose(A,b,F,z?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(b):b.toEulerAnglesToRef(this.rotation),this.Pd.p(A),this.position.p(F),this.parent=T,X&&this.setPivotMatrix(y.d.Identity()),this}addChild(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return T.setParent(this,z),this}removeChild(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return T.setParent(null,z),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(T){return this._nonUniformScaling!==T&&(this._nonUniformScaling=T,!0)}attachToBone(T,z){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=z,this.parent=T,T.getSkeleton().prepare(!0),T.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=T?this._currentParentWhenAttachingToBone:null,this):(T&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(T,z,X){let b;if(T.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.Gd(0)),X&&0!==X){if(this.parent){const X=this.parent.getWorldMatrix(),b=y.f.Matrix[0];X.invertToRef(b),T=y.j.TransformNormal(T,b),X.determinant()<0&&(z*=-1)}b=y.e.RotationAxisToRef(T,z,L._RotationAxisCache),b.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else b=y.e.RotationAxisToRef(T,z,L._RotationAxisCache),this.rotationQuaternion.multiplyToRef(b,this.rotationQuaternion);return this}rotateAround(T,z,X){z.normalize(),this.rotationQuaternion||(this.rotationQuaternion=y.e.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.Gd(0));const b=y.f.Id[0],F=y.f.Id[1],A=y.f.Id[2],u=y.f.Quaternion[0],E=y.f.Matrix[0],v=y.f.Matrix[1],k=y.f.Matrix[2],L=y.f.Matrix[3];return T.subtractToRef(this.position,b),y.d.TranslationToRef(b.x,b.y,b.z,E),y.d.TranslationToRef(-b.x,-b.y,-b.z,v),y.d.RotationAxisToRef(z,X,k),v.multiplyToRef(k,L),L.multiplyToRef(E,L),L.decompose(F,u,A),this.position.addInPlace(A),u.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(T,z,X){const b=T.scale(z);if(X&&0!==X)this.setAbsolutePosition(this.getAbsolutePosition().add(b));else{const T=this.getPositionExpressedInLocalSpace().add(b);this.setPositionWithLocalVector(T)}return this}addRotation(T,z,X){let b;this.rotationQuaternion?b=this.rotationQuaternion:(b=y.f.Quaternion[1],y.e.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,b));const F=y.f.Quaternion[0];return y.e.RotationYawPitchRollToRef(z,T,X,F),b.multiplyInPlace(F),this.rotationQuaternion||b.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==L.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}ze(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const X=this.va().getRenderId();if(!this._isDirty&&!T&&(this._currentRenderId===X||this.isSynchronized()))return this._currentRenderId=X,this._worldMatrix;z=z||this.va().activeCamera,this._updateCache();const b=this._cache;b.pivotMatrixUpdated=!1,b.billboardMode=this.billboardMode,b.infiniteDistance=this.infiniteDistance,b.parent=this._parentNode,this._currentRenderId=X,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const F=this._getEffectiveParent(),A=L._TmpScaling;let u,E=this._position;if(this._infiniteDistance&&!this.parent&&z){const T=z.getWorldMatrix(),X=new y.j(T.m[12],T.m[13],T.m[14]);E=L._TmpTranslation,E.Cd(this._position.x+X.x,this._position.y+X.y,this._position.z+X.z)}if(A.Cd(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,u=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(y.e.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Cd(0,0,0))}}else u=L._TmpRotation,y.e.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,u);if(this._usePivotMatrix){const T=y.f.Matrix[1];y.d.ScalingToRef(A.x,A.y,A.z,T);const z=y.f.Matrix[0];u.toRotationMatrix(z),this._pivotMatrix.multiplyToRef(T,y.f.Matrix[4]),y.f.Matrix[4].multiplyToRef(z,this._j),this._postMultiplyPivotMatrix&&this._j.multiplyToRef(this._pivotMatrixInverse,this._j),this._j.addTranslationFromFloats(E.x,E.y,E.z)}else y.d.ComposeToRef(A,u,E,this._j);if(F&&F.getWorldMatrix){if(T&&F.ze(T),b.useBillboardPath){if(this._transformToBoneReferal){const T=this.parent;T.getSkeleton().prepare(),T.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),y.f.Matrix[7])}else y.f.Matrix[7].p(F.getWorldMatrix());const T=y.f.Id[5],z=y.f.Id[6],X=y.f.Quaternion[0];y.f.Matrix[7].decompose(z,X,T),y.d.ScalingToRef(z.x,z.y,z.z,y.f.Matrix[7]),y.f.Matrix[7].setTranslation(T),L.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(X,T),this._j.setTranslation(T)),this._j.multiplyToRef(y.f.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const T=this.parent;T.getSkeleton().prepare(),this._j.multiplyToRef(T.getFinalMatrix(),y.f.Matrix[6]),y.f.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this._j.multiplyToRef(F.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this._j);if(b.useBillboardPath&&z&&this.billboardMode&&!b.useBillboardPosition){const T=y.f.Id[0];if(this._worldMatrix.getTranslationToRef(T),y.f.Matrix[1].p(z.getViewMatrix()),this._scene.useRightHandedSystem&&y.f.Matrix[1].multiplyToRef(k,y.f.Matrix[1]),y.f.Matrix[1].setTranslationFromFloats(0,0,0),y.f.Matrix[1].invertToRef(y.f.Matrix[0]),(this.billboardMode&L.BILLBOARDMODE_ALL)!==L.BILLBOARDMODE_ALL){y.f.Matrix[0].decompose(void 0,y.f.Quaternion[0],void 0);const T=y.f.Id[1];y.f.Quaternion[0].toEulerAnglesToRef(T),(this.billboardMode&L.BILLBOARDMODE_X)!==L.BILLBOARDMODE_X&&(T.x=0),(this.billboardMode&L.BILLBOARDMODE_Y)!==L.BILLBOARDMODE_Y&&(T.y=0),(this.billboardMode&L.BILLBOARDMODE_Z)!==L.BILLBOARDMODE_Z&&(T.z=0),y.d.RotationYawPitchRollToRef(T.y,T.x,T.z,y.f.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(y.f.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(y.f.Id[0])}else if(b.useBillboardPath&&z&&b.useBillboardPosition){const T=y.f.Id[0];this._worldMatrix.getTranslationToRef(T);const X=z.globalPosition;this._worldMatrix.invertToRef(y.f.Matrix[1]);const b=y.f.Id[1];y.j.TransformCoordinatesToRef(X,y.f.Matrix[1],b),b.normalize();const F=-Math.atan2(b.z,b.x)+Math.PI/2,A=Math.sqrt(b.x*b.x+b.z*b.z),u=-Math.atan2(b.y,A);if(y.e.RotationYawPitchRollToRef(F,u,0,y.f.Quaternion[0]),(this.billboardMode&L.BILLBOARDMODE_ALL)!==L.BILLBOARDMODE_ALL){const T=y.f.Id[1];y.f.Quaternion[0].toEulerAnglesToRef(T),(this.billboardMode&L.BILLBOARDMODE_X)!==L.BILLBOARDMODE_X&&(T.x=0),(this.billboardMode&L.BILLBOARDMODE_Y)!==L.BILLBOARDMODE_Y&&(T.y=0),(this.billboardMode&L.BILLBOARDMODE_Z)!==L.BILLBOARDMODE_Z&&(T.z=0),y.d.RotationYawPitchRollToRef(T.y,T.x,T.z,y.f.Matrix[0])}else y.d.FromQuaternionToRef(y.f.Quaternion[0],y.f.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(y.f.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(y.f.Id[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):F&&F._nonUniformScaling?this._updateNonUniformScalingState(F._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Cd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=y.d.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let T=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.ze(),T){const T=this.getChildren();for(let z=0;z<T.length;++z){const X=T[z];if(X){X.ze();const T=y.f.Matrix[0];X._j.multiplyToRef(this._j,T);const z=y.f.Quaternion[0];T.decompose(X.Pd,z,X.position),X.rotationQuaternion?X.rotationQuaternion.p(z):z.toEulerAnglesToRef(X.rotation)}}}this.Pd.Cd(1,1,1),this.position.Cd(0,0,0),this.rotation.Cd(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=y.e.Identity()),this._worldMatrix=y.d.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(T){return this.onAfterWorldMatrixUpdateObservable.add(T),this}unregisterAfterWorldMatrixUpdate(T){return this.onAfterWorldMatrixUpdateObservable.removeCallback(T),this}getPositionInCameraSpace(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return T||(T=this.va().activeCamera),y.j.TransformCoordinates(this.getAbsolutePosition(),T.getViewMatrix())}getDistanceToCamera(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return T||(T=this.va().activeCamera),this.getAbsolutePosition().Mc(T.globalPosition).length()}clone(T,z,X){const b=A.b.Clone((()=>new L(T,this.va())),this);if(b.name=T,b.id=T,z&&(b.parent=z),!X){const z=this.getDescendants(!0);for(let X=0;X<z.length;X++){const F=z[X];F.clone&&F.clone(T+"."+F.name,b)}}return b}serialize(T){const z=A.b.Serialize(this,T);return z.type=this.getClassName(),z.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(z),z.localMatrix=this.getPivotMatrix().zd(),z.isEnabled=this.isEnabled(),A.b.AppendSerializedAnimations(this,z),z.ranges=this.serializeAnimationRanges(),z}static Parse(T,z,X){const b=A.b.Parse((()=>new L(T.name,z)),T,z,X);if(T.localMatrix?b.setPreTransformMatrix(y.d.xd(T.localMatrix)):T.pivotMatrix&&b.setPivotMatrix(y.d.xd(T.pivotMatrix)),b.Hg(T.isEnabled),b._waitingParsedUniqueId=T.uniqueId,void 0!==T.parentId&&(b._waitingParentId=T.parentId),void 0!==T.parentInstanceIndex&&(b._waitingParentInstanceIndex=T.parentInstanceIndex),T.animations){for(let z=0;z<T.animations.length;z++){const X=T.animations[z],F=(0,v.e)("BABYLON.Animation");F&&b.animations.push(F.Parse(X))}E.b.ParseAnimationRanges(b,T,z)}return T.autoAnimate&&z.beginAnimation(b,T.autoAnimateFrom,T.autoAnimateTo,T.autoAnimateLoop,T.autoAnimateSpeed||1),b}getChildTransformNodes(T,z){const X=[];return this._getDescendants(X,T,(T=>(!z||z(T))&&T instanceof L)),X}dispose(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const T=this._parentContainer.transformNodes.indexOf(this);T>-1&&this._parentContainer.transformNodes.splice(T,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),T){const T=this.getChildTransformNodes(!0);for(const z of T)z.parent=null,z.ze(!0)}super.dispose(T,z)}normalizeToUnitCube(){let T=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2?arguments[2]:void 0,b=null,F=null;z&&(this.rotationQuaternion?(F=this.rotationQuaternion.clone(),this.rotationQuaternion.Cd(0,0,0,1)):this.rotation&&(b=this.rotation.clone(),this.rotation.Cd(0,0,0)));const A=this.getHierarchyBoundingVectors(T,X),u=A.max.Mc(A.min),y=Math.max(u.x,u.y,u.z);if(0===y)return this;const E=1/y;return this.Pd.scaleInPlace(E),z&&(this.rotationQuaternion&&F?this.rotationQuaternion.p(F):this.rotation&&b&&this.rotation.p(b)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}L.BILLBOARDMODE_NONE=0,L.BILLBOARDMODE_X=1,L.BILLBOARDMODE_Y=2,L.BILLBOARDMODE_Z=4,L.BILLBOARDMODE_ALL=7,L.BILLBOARDMODE_USE_POSITION=128,L.BillboardUseParentOrientation=!1,L._TmpRotation=y.e.Zero(),L._TmpScaling=y.j.Zero(),L._TmpTranslation=y.j.Zero(),L._LookAtVectorCache=new y.j(0,0,0),L._RotationAxisCache=new y.e,(0,b.c)([(0,F.C)("position")],L.prototype,"_position",void 0),(0,b.c)([(0,F.C)("rotation")],L.prototype,"_rotation",void 0),(0,b.c)([(0,F.w)("rotationQuaternion")],L.prototype,"_rotationQuaternion",void 0),(0,b.c)([(0,F.C)("Pd")],L.prototype,"_scaling",void 0),(0,b.c)([(0,F.E)("billboardMode")],L.prototype,"_billboardMode",void 0),(0,b.c)([(0,F.E)()],L.prototype,"scalingDeterminant",void 0),(0,b.c)([(0,F.E)("infiniteDistance")],L.prototype,"_infiniteDistance",void 0),(0,b.c)([(0,F.E)()],L.prototype,"ignoreNonUniformScaling",void 0),(0,b.c)([(0,F.E)()],L.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},12499:(T,z,X)=>{"use strict";X.d(z,{d:()=>u});var b=X(949),F=X(10976);let A=0;const u=T=>{if(!T.environmentBRDFTexture){const z=T.useDelayedTextureLoading;T.useDelayedTextureLoading=!1;const X=T._blockEntityCollection;T._blockEntityCollection=!1;const u=b.c.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+A++,T,!0,!1,b.c.BILINEAR_SAMPLINGMODE);T._blockEntityCollection=X;const y=T.getEngine().getLoadedTexturesCache(),E=y.indexOf(u.getInternalTexture());-1!==E&&y.splice(E,1),u.isRGBD=!0,u.wrapU=b.c.CLAMP_ADDRESSMODE,u.wrapV=b.c.CLAMP_ADDRESSMODE,T.environmentBRDFTexture=u,T.useDelayedTextureLoading=z,F.c.ExpandRGBDTexture(u);const v=T.getEngine().onContextRestoredObservable.add((()=>{u.isRGBD=!0;const z=T.onBeforeRenderObservable.add((()=>{u.isReady()&&(T.onBeforeRenderObservable.remove(z),F.c.ExpandRGBDTexture(u))}))}));T.Qd.add((()=>{T.getEngine().onContextRestoredObservable.remove(v)}))}return T.environmentBRDFTexture}},11938:(T,z,X)=>{"use strict";function b(T,z,X){try{const b=T.next();b.done?z(b):b.value?b.value.then((()=>{b.value=void 0,z(b)}),X):z(b)}catch(b){X(b)}}function F(){let T,z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(X,F,A)=>{const u=performance.now();void 0===T||u-T>z?(T=u,setTimeout((()=>{b(X,F,A)}),0)):b(X,F,A)}}function A(T,z,X,b,F){const A=()=>{let u;const y=T=>{T.done?X(T.value):void 0===u?u=!0:A()};do{u=void 0,F&&F.aborted?b(new Error("Aborted")):z(T,y,b),void 0===u&&(u=!1)}while(u)};A()}function u(T,z){let X;return A(T,b,(T=>X=T),(T=>{throw T}),z),X}function y(T,z,X){return new Promise(((b,F)=>{A(T,z,b,F,X)}))}function E(T,z){return function(){return u(T(...arguments),z)}}X.d(z,{e:()=>F,f:()=>E,j:()=>y,k:()=>u})},11005:(T,z,X)=>{"use strict";X.d(z,{d:()=>F});class b{constructor(T){this._pendingActions=new Array,this._workerInfos=T.map((T=>({workerPromise:Promise.resolve(T),idle:!0})))}dispose(){for(const T of this._workerInfos)T.workerPromise.then((T=>{T.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(T){this._executeOnIdleWorker(T)||this._pendingActions.push(T)}_executeOnIdleWorker(T){for(const z of this._workerInfos)if(z.idle)return this._execute(z,T),!0;return!1}_execute(T,z){T.idle=!1,T.workerPromise.then((X=>{z(X,(()=>{const z=this._pendingActions.shift();z?this._execute(T,z):T.idle=!0}))}))}}class F extends b{constructor(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.DefaultOptions;super([]),this._maxWorkers=T,this._createWorkerAsync=z,this._options=X}push(T){if(!this._executeOnIdleWorker(T))if(this._workerInfos.length<this._maxWorkers){const z={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(z),this._execute(z,T)}else this._pendingActions.push(T)}_execute(T,z){T.timeoutId&&(clearTimeout(T.timeoutId),delete T.timeoutId),super._execute(T,((X,b)=>{z(X,(()=>{b(),T.idle&&(T.timeoutId=setTimeout((()=>{T.workerPromise.then((T=>{T.terminate()}));const z=this._workerInfos.indexOf(T);-1!==z&&this._workerInfos.splice(z,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}F.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},12066:(T,z,X)=>{"use strict";X.d(z,{e:()=>sT});var b=X(976),F=X(1317);class A extends F.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var u=X(1132),y=(X(1411),X(993));class E{get noiseTexture(){return this._noiseTexture}set noiseTexture(T){this._noiseTexture!==T&&(this._noiseTexture=T,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(T){this._isAnimationSheetEnabled!=T&&(this._isAnimationSheetEnabled=T,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(T){this._useLogarithmicDepth=T&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:b.j.Zero()}set direction1(T){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=T)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:b.j.Zero()}set direction2(T){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=T)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:b.j.Zero()}set minEmitBox(T){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=T)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:b.j.Zero()}set maxEmitBox(T){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=T)}get billboardMode(){return this._billboardMode}set billboardMode(T){this._billboardMode!==T&&(this._billboardMode=T,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(T){this._isBillboardBased!==T&&(this._isBillboardBased=T,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(T){this._attachImageProcessingConfiguration(T)}_attachImageProcessingConfiguration(T){T!==this._imageProcessingConfiguration&&(!T&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=T)}_reset(){}_removeGradientAndTexture(T,z,X){if(!z)return this;let b=0;for(const F of z){if(F.gradient===T){z.splice(b,1);break}b++}return X&&X.dispose(),this}constructor(T){this.animations=[],this.renderingGroupId=0,this.k=b.j.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new b.j(10,10,10),this.onAnimationEnd=null,this.blendMode=E.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new b.i(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.yg=new b.j(0,0,0),this._useLogarithmicDepth=!1,this.gravity=b.j.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new u.d(1,1,1,1),this.color2=new u.d(1,1,1,1),this.colorDead=new u.d(0,0,0,1),this.textureMask=new u.d(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new A,this.id=T,this.name=T}createPointEmitter(T,z){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new b.j(0,1,0),arguments.length>2&&void 0!==arguments[2]||new b.j(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new b.j(0,1,0),arguments.length>4&&void 0!==arguments[4]||new b.j(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new b.j(0,1,0),arguments.length>3&&void 0!==arguments[3]||new b.j(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(T,z,X,b){throw new Error("Method not implemented.")}}E.BLENDMODE_ONEONE=0,E.BLENDMODE_STANDARD=1,E.BLENDMODE_ADD=2,E.BLENDMODE_MULTIPLY=3,E.BLENDMODE_MULTIPLYADD=4,(0,y.h)("BABYLON.BaseParticleSystem",E);var v=X(1014),k=X(1168);class L{constructor(){this.direction1=new b.j(0,1,0),this.direction2=new b.j(0,1,0),this.minEmitBox=new b.j(-.5,-.5,-.5),this.maxEmitBox=new b.j(.5,.5,.5)}startDirectionFunction(T,z,X,F){const A=(0,v.s)(this.direction1.x,this.direction2.x),u=(0,v.s)(this.direction1.y,this.direction2.y),y=(0,v.s)(this.direction1.z,this.direction2.z);if(F)return z.x=A,z.y=u,void(z.z=y);b.j.TransformNormalFromFloatsToRef(A,u,y,T,z)}startPositionFunction(T,z,X,F){const A=(0,v.s)(this.minEmitBox.x,this.maxEmitBox.x),u=(0,v.s)(this.minEmitBox.y,this.maxEmitBox.y),y=(0,v.s)(this.minEmitBox.z,this.maxEmitBox.z);if(F)return z.x=A,z.y=u,void(z.z=y);b.j.TransformCoordinatesFromFloatsToRef(A,u,y,T,z)}clone(){const T=new L;return k.c.DeepCopy(this,T),T}applyToShader(T){T.setVector3("direction1",this.direction1),T.setVector3("direction2",this.direction2),T.setVector3("minEmitBox",this.minEmitBox),T.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(T){T.addUniform("direction1",3),T.addUniform("direction2",3),T.addUniform("minEmitBox",3),T.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const T={};return T.type=this.getClassName(),T.direction1=this.direction1.zd(),T.direction2=this.direction2.zd(),T.minEmitBox=this.minEmitBox.zd(),T.maxEmitBox=this.maxEmitBox.zd(),T}parse(T){b.j.FromArrayToRef(T.direction1,0,this.direction1),b.j.FromArrayToRef(T.direction2,0,this.direction2),b.j.FromArrayToRef(T.minEmitBox,0,this.minEmitBox),b.j.FromArrayToRef(T.maxEmitBox,0,this.maxEmitBox)}}class D{get i(){return this._radius}set i(T){this._radius=T,this._buildHeight()}get angle(){return this._angle}set angle(T){this._angle=T,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=X,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=z,this.i=T}startDirectionFunction(T,z,X,F){F?b.f.Id[0].p(X.Eg).normalize():X.position.subtractToRef(T.getTranslation(),b.f.Id[0]).normalize();const A=(0,v.s)(0,this.directionRandomizer),u=(0,v.s)(0,this.directionRandomizer),y=(0,v.s)(0,this.directionRandomizer);z.x=b.f.Id[0].x+A,z.y=b.f.Id[0].y+u,z.z=b.f.Id[0].z+y,z.normalize()}startPositionFunction(T,z,X,F){const A=(0,v.s)(0,2*Math.PI);let u;this.emitFromSpawnPointOnly?u=1e-4:(u=(0,v.s)(0,this.heightRange),u=1-u*u);let y=this._radius-(0,v.s)(0,this._radius*this.radiusRange);y*=u;const E=y*Math.sin(A),k=y*Math.cos(A),L=u*this._height;if(F)return z.x=E,z.y=L,void(z.z=k);b.j.TransformCoordinatesFromFloatsToRef(E,L,k,T,z)}clone(){const T=new D(this._radius,this._angle,this.directionRandomizer);return k.c.DeepCopy(this,T),T}applyToShader(T){T.setFloat2("i",this._radius,this.radiusRange),T.setFloat("coneAngle",this._angle),T.setFloat2("height",this._height,this.heightRange),T.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(T){T.addUniform("i",2),T.addUniform("coneAngle",1),T.addUniform("height",2),T.addUniform("directionRandomizer",1)}getEffectDefines(){let T="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(T+="\n#define CONEEMITTERSPAWNPOINT"),T}getClassName(){return"ConeParticleEmitter"}serialize(){const T={};return T.type=this.getClassName(),T.i=this._radius,T.angle=this._angle,T.directionRandomizer=this.directionRandomizer,T.radiusRange=this.radiusRange,T.heightRange=this.heightRange,T.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,T}parse(T){this.i=T.i,this.angle=T.angle,this.directionRandomizer=T.directionRandomizer,this.radiusRange=void 0!==T.radiusRange?T.radiusRange:1,this.heightRange=void 0!==T.radiusRange?T.heightRange:1,this.emitFromSpawnPointOnly=void 0!==T.emitFromSpawnPointOnly&&T.emitFromSpawnPointOnly}}class c extends D{constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.j(0,1,0),F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b.j(0,1,0);super(T,z),this.direction1=X,this.direction2=F}startDirectionFunction(T,z){const X=(0,v.s)(this.direction1.x,this.direction2.x),F=(0,v.s)(this.direction1.y,this.direction2.y),A=(0,v.s)(this.direction1.z,this.direction2.z);b.j.TransformNormalFromFloatsToRef(X,F,A,T,z)}clone(){const T=new c(this.i,this.angle,this.direction1,this.direction2);return k.c.DeepCopy(this,T),T}applyToShader(T){T.setFloat("i",this.i),T.setFloat("radiusRange",this.radiusRange),T.setVector3("direction1",this.direction1),T.setVector3("direction2",this.direction2)}buildUniformLayout(T){T.addUniform("i",1),T.addUniform("radiusRange",1),T.addUniform("direction1",3),T.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const T=super.serialize();return T.direction1=this.direction1.zd(),T.direction2=this.direction2.zd(),T}parse(T){super.parse(T),this.direction1.p(T.direction1),this.direction2.p(T.direction2)}}class p{constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.i=T,this.height=z,this.radiusRange=X,this.directionRandomizer=F,this._tempVector=b.j.Zero()}startDirectionFunction(T,z,X,F,A){X.position.subtractToRef(T.getTranslation(),this._tempVector),this._tempVector.normalize(),b.j.TransformNormalToRef(this._tempVector,A,this._tempVector);const u=(0,v.s)(-this.directionRandomizer/2,this.directionRandomizer/2);let y=Math.atan2(this._tempVector.x,this._tempVector.z);y+=(0,v.s)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=u,this._tempVector.x=Math.sin(y),this._tempVector.z=Math.cos(y),this._tempVector.normalize(),F?z.p(this._tempVector):b.j.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,T,z)}startPositionFunction(T,z,X,F){const A=(0,v.s)(-this.height/2,this.height/2),u=(0,v.s)(0,2*Math.PI),y=(0,v.s)((1-this.radiusRange)*(1-this.radiusRange),1),E=Math.sqrt(y)*this.i,k=E*Math.cos(u),L=E*Math.sin(u);F?z.Cd(k,A,L):b.j.TransformCoordinatesFromFloatsToRef(k,A,L,T,z)}clone(){const T=new p(this.i,this.directionRandomizer);return k.c.DeepCopy(this,T),T}applyToShader(T){T.setFloat("i",this.i),T.setFloat("height",this.height),T.setFloat("radiusRange",this.radiusRange),T.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(T){T.addUniform("i",1),T.addUniform("height",1),T.addUniform("radiusRange",1),T.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const T={};return T.type=this.getClassName(),T.i=this.i,T.height=this.height,T.radiusRange=this.radiusRange,T.directionRandomizer=this.directionRandomizer,T}parse(T){this.i=T.i,this.height=T.height,this.radiusRange=T.radiusRange,this.directionRandomizer=T.directionRandomizer}}class H extends p{constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b.j(0,1,0),A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new b.j(0,1,0);super(T,z,X),this.direction1=F,this.direction2=A}startDirectionFunction(T,z,X,F){const A=(0,v.s)(this.direction1.x,this.direction2.x),u=(0,v.s)(this.direction1.y,this.direction2.y),y=(0,v.s)(this.direction1.z,this.direction2.z);F?z.Cd(A,u,y):b.j.TransformNormalFromFloatsToRef(A,u,y,T,z)}clone(){const T=new H(this.i,this.height,this.radiusRange,this.direction1,this.direction2);return k.c.DeepCopy(this,T),T}applyToShader(T){T.setFloat("i",this.i),T.setFloat("height",this.height),T.setFloat("radiusRange",this.radiusRange),T.setVector3("direction1",this.direction1),T.setVector3("direction2",this.direction2)}buildUniformLayout(T){T.addUniform("i",1),T.addUniform("height",1),T.addUniform("radiusRange",1),T.addUniform("direction1",3),T.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const T=super.serialize();return T.direction1=this.direction1.zd(),T.direction2=this.direction2.zd(),T}parse(T){super.parse(T),b.j.FromArrayToRef(T.direction1,0,this.direction1),b.j.FromArrayToRef(T.direction2,0,this.direction2)}}class U{constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=T,this.radiusRange=z,this.directionRandomizer=X}startDirectionFunction(T,z,X,F){const A=X.position.Mc(T.getTranslation()).normalize(),u=(0,v.s)(0,this.directionRandomizer),y=(0,v.s)(0,this.directionRandomizer),E=(0,v.s)(0,this.directionRandomizer);A.x+=u,A.y+=y,A.z+=E,A.normalize(),F?z.p(A):b.j.TransformNormalFromFloatsToRef(A.x,A.y,A.z,T,z)}startPositionFunction(T,z,X,F){const A=this.i-(0,v.s)(0,this.i*this.radiusRange),u=(0,v.s)(0,1),y=(0,v.s)(0,2*Math.PI),E=Math.acos(2*u-1),k=A*Math.cos(y)*Math.sin(E),L=A*Math.cos(E),D=A*Math.sin(y)*Math.sin(E);F?z.Cd(k,Math.abs(L),D):b.j.TransformCoordinatesFromFloatsToRef(k,Math.abs(L),D,T,z)}clone(){const T=new U(this.i,this.directionRandomizer);return k.c.DeepCopy(this,T),T}applyToShader(T){T.setFloat("i",this.i),T.setFloat("radiusRange",this.radiusRange),T.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(T){T.addUniform("i",1),T.addUniform("radiusRange",1),T.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const T={};return T.type=this.getClassName(),T.i=this.i,T.radiusRange=this.radiusRange,T.directionRandomizer=this.directionRandomizer,T}parse(T){this.i=T.i,this.radiusRange=T.radiusRange,this.directionRandomizer=T.directionRandomizer}}class s{constructor(){this.direction1=new b.j(0,1,0),this.direction2=new b.j(0,1,0)}startDirectionFunction(T,z,X,F){const A=(0,v.s)(this.direction1.x,this.direction2.x),u=(0,v.s)(this.direction1.y,this.direction2.y),y=(0,v.s)(this.direction1.z,this.direction2.z);F?z.Cd(A,u,y):b.j.TransformNormalFromFloatsToRef(A,u,y,T,z)}startPositionFunction(T,z,X,F){F?z.Cd(0,0,0):b.j.TransformCoordinatesFromFloatsToRef(0,0,0,T,z)}clone(){const T=new s;return k.c.DeepCopy(this,T),T}applyToShader(T){T.setVector3("direction1",this.direction1),T.setVector3("direction2",this.direction2)}buildUniformLayout(T){T.addUniform("direction1",3),T.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const T={};return T.type=this.getClassName(),T.direction1=this.direction1.zd(),T.direction2=this.direction2.zd(),T}parse(T){b.j.FromArrayToRef(T.direction1,0,this.direction1),b.j.FromArrayToRef(T.direction2,0,this.direction2)}}class x{constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=T,this.radiusRange=z,this.directionRandomizer=X}startDirectionFunction(T,z,X,F){const A=X.position.Mc(T.getTranslation()).normalize(),u=(0,v.s)(0,this.directionRandomizer),y=(0,v.s)(0,this.directionRandomizer),E=(0,v.s)(0,this.directionRandomizer);A.x+=u,A.y+=y,A.z+=E,A.normalize(),F?z.p(A):b.j.TransformNormalFromFloatsToRef(A.x,A.y,A.z,T,z)}startPositionFunction(T,z,X,F){const A=this.i-(0,v.s)(0,this.i*this.radiusRange),u=(0,v.s)(0,1),y=(0,v.s)(0,2*Math.PI),E=Math.acos(2*u-1),k=A*Math.cos(y)*Math.sin(E),L=A*Math.cos(E),D=A*Math.sin(y)*Math.sin(E);F?z.Cd(k,L,D):b.j.TransformCoordinatesFromFloatsToRef(k,L,D,T,z)}clone(){const T=new x(this.i,this.directionRandomizer);return k.c.DeepCopy(this,T),T}applyToShader(T){T.setFloat("i",this.i),T.setFloat("radiusRange",this.radiusRange),T.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(T){T.addUniform("i",1),T.addUniform("radiusRange",1),T.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const T={};return T.type=this.getClassName(),T.i=this.i,T.radiusRange=this.radiusRange,T.directionRandomizer=this.directionRandomizer,T}parse(T){this.i=T.i,this.radiusRange=T.radiusRange,this.directionRandomizer=T.directionRandomizer}}class K extends x{constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new b.j(0,1,0),X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.j(0,1,0);super(T),this.direction1=z,this.direction2=X}startDirectionFunction(T,z){const X=(0,v.s)(this.direction1.x,this.direction2.x),F=(0,v.s)(this.direction1.y,this.direction2.y),A=(0,v.s)(this.direction1.z,this.direction2.z);b.j.TransformNormalFromFloatsToRef(X,F,A,T,z)}clone(){const T=new K(this.i,this.direction1,this.direction2);return k.c.DeepCopy(this,T),T}applyToShader(T){T.setFloat("i",this.i),T.setFloat("radiusRange",this.radiusRange),T.setVector3("direction1",this.direction1),T.setVector3("direction2",this.direction2)}buildUniformLayout(T){T.addUniform("i",1),T.addUniform("radiusRange",1),T.addUniform("direction1",3),T.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const T=super.serialize();return T.direction1=this.direction1.zd(),T.direction2=this.direction2.zd(),T}parse(T){super.parse(T),this.direction1.p(T.direction1),this.direction2.p(T.direction2)}}class d{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(T,z,X,F){const A=b.f.Id[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,X,A);const T=b.f.Id[1];A.subtractToRef(X.position,T),T.scaleToRef(1/X.lifeTime,A)}else A.set(0,0,0);F?z.p(A):b.j.TransformNormalToRef(A,T,z)}startPositionFunction(T,z,X,F){const A=b.f.Id[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,X,A):A.set(0,0,0),F?z.p(A):b.j.TransformCoordinatesToRef(A,T,z)}clone(){const T=new d;return k.c.DeepCopy(this,T),T}applyToShader(T){}buildUniformLayout(T){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const T={};return T.type=this.getClassName(),T.particlePositionGenerator=this.particlePositionGenerator,T.particleDestinationGenerator=this.particleDestinationGenerator,T}parse(T){T.particlePositionGenerator&&(this.particlePositionGenerator=T.particlePositionGenerator),T.particleDestinationGenerator&&(this.particleDestinationGenerator=T.particleDestinationGenerator)}}var N=X(1207);class l{get mesh(){return this.Oe}set mesh(T){this.Oe!==T&&(this.Oe=T,T?(this._indices=T.Ge(),this._positions=T.getVerticesData(N.e.PositionKind),this._normals=T.getVerticesData(N.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=b.j.Zero(),this.Oe=null,this.direction1=new b.j(0,1,0),this.direction2=new b.j(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=T}startDirectionFunction(T,z,X,F){if(this.useMeshNormalsForDirection&&this._normals)return void b.j.TransformNormalToRef(this._storedNormal,T,z);const A=(0,v.s)(this.direction1.x,this.direction2.x),u=(0,v.s)(this.direction1.y,this.direction2.y),y=(0,v.s)(this.direction1.z,this.direction2.z);F?z.Cd(A,u,y):b.j.TransformNormalFromFloatsToRef(A,u,y,T,z)}startPositionFunction(T,z,X,F){if(!this._indices||!this._positions)return;const A=3*Math.random()*(this._indices.length/3)|0,u=Math.random(),y=Math.random()*(1-u),E=1-u-y,v=this._indices[A],k=this._indices[A+1],L=this._indices[A+2],D=b.f.Id[0],c=b.f.Id[1],p=b.f.Id[2],H=b.f.Id[3];b.j.FromArrayToRef(this._positions,3*v,D),b.j.FromArrayToRef(this._positions,3*k,c),b.j.FromArrayToRef(this._positions,3*L,p),H.x=u*D.x+y*c.x+E*p.x,H.y=u*D.y+y*c.y+E*p.y,H.z=u*D.z+y*c.z+E*p.z,F?z.Cd(H.x,H.y,H.z):b.j.TransformCoordinatesFromFloatsToRef(H.x,H.y,H.z,T,z),this.useMeshNormalsForDirection&&this._normals&&(b.j.FromArrayToRef(this._normals,3*v,D),b.j.FromArrayToRef(this._normals,3*k,c),b.j.FromArrayToRef(this._normals,3*L,p),this._storedNormal.x=u*D.x+y*c.x+E*p.x,this._storedNormal.y=u*D.y+y*c.y+E*p.y,this._storedNormal.z=u*D.z+y*c.z+E*p.z)}clone(){const T=new l(this.mesh);return k.c.DeepCopy(this,T),T}applyToShader(T){T.setVector3("direction1",this.direction1),T.setVector3("direction2",this.direction2)}buildUniformLayout(T){T.addUniform("direction1",3),T.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var T;const z={};return z.type=this.getClassName(),z.direction1=this.direction1.zd(),z.direction2=this.direction2.zd(),z.meshId=null===(T=this.mesh)||void 0===T?void 0:T.id,z.useMeshNormalsForDirection=this.useMeshNormalsForDirection,z}parse(T,z){b.j.FromArrayToRef(T.direction1,0,this.direction1),b.j.FromArrayToRef(T.direction2,0,this.direction2),T.meshId&&z&&(this.mesh=z.getLastMeshById(T.meshId)),this.useMeshNormalsForDirection=T.useMeshNormalsForDirection}}var a=X(1079);class q{_isUbo(T){return void 0!==T.addUniform}constructor(T){this._isUbo(T)?(this.setMatrix3x3=T.updateMatrix3x3.bind(T),this.setMatrix2x2=T.updateMatrix2x2.bind(T),this.setFloat=T.updateFloat.bind(T),this.setFloat2=T.updateFloat2.bind(T),this.setFloat3=T.updateFloat3.bind(T),this.setFloat4=T.updateFloat4.bind(T),this.setFloatArray=T.updateFloatArray.bind(T),this.setArray=T.updateArray.bind(T),this.setIntArray=T.updateIntArray.bind(T),this.setMatrix=T._d.bind(T),this.setMatrices=T.updateMatrices.bind(T),this.setVector3=T.updateVector3.bind(T),this.setVector4=T.updateVector4.bind(T),this.setColor3=T.updateColor3.bind(T),this.setColor4=T.updateColor4.bind(T),this.setDirectColor4=T.updateDirectColor4.bind(T),this.setInt=T.updateInt.bind(T),this.setInt2=T.updateInt2.bind(T),this.setInt3=T.updateInt3.bind(T),this.setInt4=T.updateInt4.bind(T)):(this.setMatrix3x3=T.setMatrix3x3.bind(T),this.setMatrix2x2=T.setMatrix2x2.bind(T),this.setFloat=T.setFloat.bind(T),this.setFloat2=T.setFloat2.bind(T),this.setFloat3=T.setFloat3.bind(T),this.setFloat4=T.setFloat4.bind(T),this.setFloatArray=T.setFloatArray.bind(T),this.setArray=T.setArray.bind(T),this.setIntArray=T.setIntArray.bind(T),this.setMatrix=T.setMatrix.bind(T),this.setMatrices=T.setMatrices.bind(T),this.setVector3=T.setVector3.bind(T),this.setVector4=T.setVector4.bind(T),this.setColor3=T.setColor3.bind(T),this.setColor4=T.setColor4.bind(T),this.setDirectColor4=T.setDirectColor4.bind(T),this.setInt=T.setInt.bind(T),this.setInt2=T.setInt2.bind(T),this.setInt3=T.setInt3.bind(T),this.setInt4=T.setInt4.bind(T))}}var V=X(1082);const C="gpuUpdateParticlesPixelShader",G="#version 300 es\nvoid main() {discard;}\n";V.d.ShadersStore[C]=G;const j="gpuUpdateParticlesVertexShader",Z="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";V.d.ShadersStore[j]=Z;(0,y.h)("BABYLON.WebGL2ParticleSystem",class{constructor(T,z){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=T,this._engine=z,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","i","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var T;return(null===(T=this._updateEffect)||void 0===T?void 0:T.isReady())??!1}createUpdateBuffer(T){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof d&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=T,this._updateEffect=new a.b("gpuUpdateParticles",this._updateEffectOptions,this._engine),new q(this._updateEffect)}createVertexBuffers(T,z){this._updateVAO.push(this._createUpdateVAO(T)),this._renderVAO.push(this._engine.recordVertexArrayObject(z,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=z}createParticleBuffer(T){return T}bindDrawBuffers(T,z,X){X?this._engine.bindBuffers(this._renderVertexBuffers,X,z):this._engine.bindVertexArrayObject(this._renderVAO[T],null)}preUpdateParticleBuffer(){const T=this._engine;if(this._engine.enableEffect(this._updateEffect),!T.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(T,z,X){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[T],null);const b=this._engine;b.bindTransformFeedbackBuffer(z.getBuffer()),b.setRasterizerState(!1),b.beginTransformFeedback(!0),b.drawArraysType(3,0,X),b.endTransformFeedback(),b.setRasterizerState(!0),b.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let T=0;T<this._updateVAO.length;T++)this._engine.releaseVertexArrayObject(this._updateVAO[T]);this._updateVAO.length=0;for(let T=0;T<this._renderVAO.length;T++)this._engine.releaseVertexArrayObject(this._renderVAO[T]);this._renderVAO.length=0}_createUpdateVAO(T){const z={};z.position=T.createVertexBuffer("position",0,3);let X=3;z.age=T.createVertexBuffer("age",X,1),X+=1,z.size=T.createVertexBuffer("size",X,3),X+=3,z.life=T.createVertexBuffer("life",X,1),X+=1,z.seed=T.createVertexBuffer("seed",X,4),X+=4,z.direction=T.createVertexBuffer("direction",X,3),X+=3,this._parent.particleEmitterType instanceof d&&(z.initialPosition=T.createVertexBuffer("initialPosition",X,3),X+=3),this._parent._colorGradientsTexture||(z.color=T.createVertexBuffer("color",X,4),X+=4),this._parent._isBillboardBased||(z.initialDirection=T.createVertexBuffer("initialDirection",X,3),X+=3),this._parent.noiseTexture&&(z.noiseCoordinates1=T.createVertexBuffer("noiseCoordinates1",X,3),X+=3,z.noiseCoordinates2=T.createVertexBuffer("noiseCoordinates2",X,3),X+=3),this._parent._angularSpeedGradientsTexture?(z.angle=T.createVertexBuffer("angle",X,1),X+=1):(z.angle=T.createVertexBuffer("angle",X,2),X+=2),this._parent._isAnimationSheetEnabled&&(z.cellIndex=T.createVertexBuffer("cellIndex",X,1),X+=1,this._parent.spriteRandomStartCell&&(z.cellStartOffset=T.createVertexBuffer("cellStartOffset",X,1),X+=1));const b=this._engine.recordVertexArrayObject(z,null,this._updateEffect);return this._engine.bindArrayBuffer(null),b}});class m{constructor(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,b=arguments.length>3?arguments[3]:void 0;this._engine=T,this._label=b,this._engine._storageBuffers.push(this),this._create(z,X)}_create(T,z){this._bufferSize=T,this._creationFlags=z,this._buffer=this._engine.createStorageBuffer(T,z,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(T,z,X){this._buffer&&this._engine.updateStorageBuffer(this._buffer,T,z,X)}read(T,z,X,b){return this._engine.readFromStorageBuffer(this._buffer,T,z,X,b)}dispose(){const T=this._engine._storageBuffers,z=T.indexOf(this);-1!==z&&(T[z]=T[T.length-1],T.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var S=X(952),n=X(957),O=X(1122),P=X(949),W=X(1256),B=X(1065),e=X(1105),R=X(1242);class Y{constructor(){this._gpuTimeInFrameId=-1,this.counter=new R.b}_addDuration(T,z){T<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==T?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(z,!1),this._gpuTimeInFrameId=T):this.counter.addCount(z,!1))}}class i{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(T,z,X){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=T,this._engine=z,this.uniqueId=W.c.UniqueId,z.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new Y),this._engine.getCaps().supportComputeShaders?b.bindingsMapping?(this._context=z.createComputeContext(),this._shaderPath=X,this._options={bindingsMapping:{},defines:[],...b}):B.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):B.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(T,z){let X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const b=this._bindings[T];this._bindings[T]={type:X?0:4,object:z,indexInGroupEntries:null===b||void 0===b?void 0:b.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!b||b.object!==z||b.type!==this._bindings[T].type)}setStorageTexture(T,z){const X=this._bindings[T];this._contextIsDirty||(this._contextIsDirty=!X||X.object!==z),this._bindings[T]={type:1,object:z,indexInGroupEntries:null===X||void 0===X?void 0:X.indexInGroupEntries}}setExternalTexture(T,z){const X=this._bindings[T];this._contextIsDirty||(this._contextIsDirty=!X||X.object!==z),this._bindings[T]={type:6,object:z,indexInGroupEntries:null===X||void 0===X?void 0:X.indexInGroupEntries}}setVideoTexture(T,z){return!!z.externalTexture&&(this.setExternalTexture(T,z.externalTexture),!0)}setUniformBuffer(T,z){const X=this._bindings[T];this._contextIsDirty||(this._contextIsDirty=!X||X.object!==z),this._bindings[T]={type:i._BufferIsDataBuffer(z)?7:2,object:z,indexInGroupEntries:null===X||void 0===X?void 0:X.indexInGroupEntries}}setStorageBuffer(T,z){const X=this._bindings[T];this._contextIsDirty||(this._contextIsDirty=!X||X.object!==z),this._bindings[T]={type:i._BufferIsDataBuffer(z)?7:3,object:z,indexInGroupEntries:null===X||void 0===X?void 0:X.indexInGroupEntries}}setTextureSampler(T,z){const X=this._bindings[T];this._contextIsDirty||(this._contextIsDirty=!X||!z.compareSampler(X.object)),this._bindings[T]={type:5,object:z,indexInGroupEntries:null===X||void 0===X?void 0:X.indexInGroupEntries}}isReady(){let T=this._effect;for(const F in this._bindings){const T=this._bindings[F],z=T.type,X=T.object;switch(z){case 0:case 4:case 1:if(!X.isReady())return!1;break;case 6:if(!X.isReady())return!1;break}}const z=[],X=this._shaderPath;if(this._options.defines)for(let F=0;F<this._options.defines.length;F++)z.push(this._options.defines[F]);const b=z.join("\n");return this._cachedDefines!==b&&(this._cachedDefines=b,T=this._engine.createComputeEffect(X,{defines:b,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=T),!!T.isReady()}dispatch(T,z,X){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,T,z,X,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const X=i._BufferIsDataBuffer(T)?T:T.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,X,z,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const z in this._bindings){const X=this._bindings[z];if(!this._options.bindingsMapping[z])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+z+"'");switch(X.type){case 0:{const b=this._samplers[z],F=X.object;var T;if(!b||!F._texture||!b.compareSampler(F._texture))this._samplers[z]=(new e.e).setParameters(F.wrapU,F.wrapV,F.wrapR,F.anisotropicFilteringLevel,F._texture.samplingMode,null===(T=F._texture)||void 0===T?void 0:T._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const T=X.object;T.getBuffer()!==X.buffer&&(X.buffer=T.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(T,z,X){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((F=>{const A=()=>{this.dispatch(T,z,X)?F():setTimeout(A,b)};A()}))}serialize(){const T=O.b.Serialize(this);T.options=this._options,T.shaderPath=this._shaderPath,T.Lj={},T.textures={};for(const z in this._bindings){const X=this._bindings[z],b=X.object;switch(X.type){case 0:case 4:case 1:{const F=b.serialize();F&&(T.textures[z]=F,T.Lj[z]={type:X.type});break}}}return T}static Parse(T,z,X){const b=O.b.Parse((()=>new i(T.name,z.getEngine(),T.shaderPath,T.options)),T,z,X);for(const F in T.textures){const A=T.Lj[F],u=P.c.Parse(T.textures[F],z,X);0===A.type?b.setTexture(F,u):4===A.type?b.setTexture(F,u,!1):b.setStorageTexture(F,u)}return b}static _BufferIsDataBuffer(T){return void 0!==T.underlyingResource}}(0,S.c)([(0,n.E)()],i.prototype,"name",void 0),(0,S.c)([(0,n.E)()],i.prototype,"fastMode",void 0),(0,y.h)("BABYLON.ComputeShader",i);var t=X(1195);const g="gpuUpdateParticlesComputeShader",M="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";V.d.ShadersStoreWGSL[g]=M;(0,y.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(T,z){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=T,this._engine=z}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var T;return(null===(T=this._updateComputeShader)||void 0===T?void 0:T.isReady())??!1}createUpdateBuffer(T){var z;const X={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(X.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(X.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(X.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(X.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(X.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(X.noiseTexture={group:1,binding:11}),this._updateComputeShader=new i("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:X,defines:T.split("\n")}),null===(z=this._simParamsComputeShader)||void 0===z||z.dispose(),this._simParamsComputeShader=new t.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new q(this._simParamsComputeShader)}createVertexBuffers(T,z){this._renderVertexBuffers.push(z)}createParticleBuffer(T){const z=new m(this._engine,4*T.length,11,"ComputeShaderParticleSystemBuffer");return z.update(T),this._bufferComputeShader.push(z),z.getBuffer()}bindDrawBuffers(T,z,X){this._engine.bindBuffers(this._renderVertexBuffers[T],X,z)}preUpdateParticleBuffer(){}updateParticleBuffer(T,z,X){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[T]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^T]),this._updateComputeShader.dispatch(Math.ceil(X/64))}releaseBuffers(){var T;for(let z=0;z<this._bufferComputeShader.length;++z)this._bufferComputeShader[z].dispose();this._bufferComputeShader.length=0,null===(T=this._simParamsComputeShader)||void 0===T||T.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class r{constructor(T,z,X){this.gradient=T,this.color1=z,this.color2=X}getColorToRef(T){this.color2?u.d.LerpToRef(this.color1,this.color2,Math.random(),T):T.p(this.color1)}}class o{constructor(T,z){this.gradient=T,this.color=z}}class f{constructor(T,z,X){this.gradient=T,this.factor1=z,this.factor2=X}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class h{static GetCurrentGradient(T,z,X){if(z[0].gradient>T)return void X(z[0],z[0],1);for(let F=0;F<z.length-1;F++){const b=z[F],A=z[F+1];if(T>=b.gradient&&T<=A.gradient){return void X(b,A,(T-b.gradient)/(A.gradient-b.gradient))}}const b=z.length-1;X(z[b],z[b],1)}}var Q=X(968),w=X(12071),J=X(1007);class I{constructor(T){this.particleSystem=T,this.position=b.j.Zero(),this.direction=b.j.Zero(),this.color=new u.d(0,0,0,0),this.colorStep=new u.d(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new b.i(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new u.d(0,0,0,0),this._currentColor2=new u.d(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=I._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let T=this.age,z=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===z?(z=1,T=this._randomCellOffset):T+=this._randomCellOffset);const X=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let b;b=this._initialSpriteCellLoop?(0,v.d)(T*z%this.lifeTime/this.lifeTime):(0,v.d)(T*z/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+b*X|0}_inheritParticleInfoToSubEmitter(T){if(T.particleSystem.k.position){const z=T.particleSystem.k;if(z.position.p(this.position),T.inheritDirection){const T=b.f.Id[0];this.direction.normalizeToRef(T),z.setDirection(T,0,Math.PI/2)}}else{T.particleSystem.k.p(this.position)}this.direction.scaleToRef(T.inheritedVelocityAmount/2,b.f.Id[0]),T.particleSystem._inheritedVelocityOffset.p(b.f.Id[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((T=>{this._inheritParticleInfoToSubEmitter(T)}))}_reset(){this.age=0,this.id=I._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(T){T.position.p(this.position),this._initialDirection?T._initialDirection?T._initialDirection.p(this._initialDirection):T._initialDirection=this._initialDirection.clone():T._initialDirection=null,T.direction.p(this.direction),this.Eg&&(T.Eg?T.Eg.p(this.Eg):T.Eg=this.Eg.clone()),T.color.p(this.color),T.colorStep.p(this.colorStep),T.lifeTime=this.lifeTime,T.age=this.age,T._randomCellOffset=this._randomCellOffset,T.size=this.size,T.scale.p(this.scale),T.angle=this.angle,T.angularSpeed=this.angularSpeed,T.particleSystem=this.particleSystem,T.cellIndex=this.cellIndex,T.id=this.id,T._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(T._currentColorGradient=this._currentColorGradient,T._currentColor1.p(this._currentColor1),T._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(T._currentSizeGradient=this._currentSizeGradient,T._currentSize1=this._currentSize1,T._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(T._currentAngularSpeedGradient=this._currentAngularSpeedGradient,T._currentAngularSpeed1=this._currentAngularSpeed1,T._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(T._currentVelocityGradient=this._currentVelocityGradient,T._currentVelocity1=this._currentVelocity1,T._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(T._currentLimitVelocityGradient=this._currentLimitVelocityGradient,T._currentLimitVelocity1=this._currentLimitVelocity1,T._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(T._currentDragGradient=this._currentDragGradient,T._currentDrag1=this._currentDrag1,T._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(T._initialStartSpriteCellID=this._initialStartSpriteCellID,T._initialEndSpriteCellID=this._initialEndSpriteCellID,T._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(T.remapData&&this.remapData?T.remapData.p(this.remapData):T.remapData=new b.n(0,0,0,0)),this._randomNoiseCoordinates1&&(T._randomNoiseCoordinates1?(T._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),T._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(T._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),T._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}I._Count=0;var TT=X(1300),zT=(X(1402),X(1310)),XT=X(1305),bT=X(1189);class FT extends E{set onDispose(T){this._onDisposeObserver&&this.Qd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Qd.add(T)}get useRampGradients(){return this._useRampGradients}set useRampGradients(T){this._useRampGradients!==T&&(this._useRampGradients=T,this._resetEffect())}get particles(){return this.Gj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.Gj.length}getClassName(){return"Ie"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var T;let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(T=this._customWrappers[z])||void 0===T?void 0:T.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[T]??this._customWrappers[0]}setCustomEffect(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[z]=new TT.b(this._engine),this._customWrappers[z].effect=T,this._customWrappers[z].drawContext&&(this._customWrappers[z].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new Q.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(T,z,X){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]&&arguments[4],y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(T),this._emitterInverseWorldMatrix=b.d.Identity(),this._inheritedVelocityOffset=new b.j,this.Qd=new Q.d,this.onStoppedObservable=new Q.d,this.Gj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new u.d(0,0,0,0),this._colorDiff=new u.d(0,0,0,0),this._scaledDirection=b.j.Zero(),this._scaledGravity=b.j.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=T=>{},this.recycleParticle=T=>{const z=this.Gj.pop();z!==T&&z.copyTo(T),this._stockParticles.push(z)},this._createParticle=()=>{let T;return 0!==this._stockParticles.length?(T=this._stockParticles.pop(),T._reset()):T=new I(this),this._prepareParticle(T),T},this._shadersLoaded=!1,this._capacity=z,this._epsilon=y,this._isAnimationSheetEnabled=A,X&&"Scene"!==X.getClassName()?(this._engine=X,this.defaultProjectionMatrix=b.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=X||J.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.pe.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new TT.b(this._engine)},this._customWrappers[0].effect=F,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new L;let E=null;this.updateFunction=T=>{let z=null;var X;this.noiseTexture&&(z=this.noiseTexture.getSize(),null===(X=this.noiseTexture.getContent())||void 0===X||X.then((T=>{E=T})));const F=T===this.Gj;for(let A=0;A<T.length;A++){const X=T[A];let y=this._scaledUpdateSpeed;const k=X.age;if(X.age+=y,X.age>X.lifeTime){const T=X.age-k;y=(X.lifeTime-k)*y/T,X.age=X.lifeTime}const L=X.age/X.lifeTime;this._colorGradients&&this._colorGradients.length>0?h.GetCurrentGradient(L,this._colorGradients,((T,z,b)=>{T!==X._currentColorGradient&&(X._currentColor1.p(X._currentColor2),z.getColorToRef(X._currentColor2),X._currentColorGradient=T),u.d.LerpToRef(X._currentColor1,X._currentColor2,b,X.color)})):(X.colorStep.scaleToRef(y,this._scaledColorStep),X.color.addInPlace(this._scaledColorStep),X.color.a<0&&(X.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&h.GetCurrentGradient(L,this._angularSpeedGradients,((T,z,b)=>{T!==X._currentAngularSpeedGradient&&(X._currentAngularSpeed1=X._currentAngularSpeed2,X._currentAngularSpeed2=z.getFactor(),X._currentAngularSpeedGradient=T),X.angularSpeed=(0,v.p)(X._currentAngularSpeed1,X._currentAngularSpeed2,b)})),X.angle+=X.angularSpeed*y;let D=y;if(this._velocityGradients&&this._velocityGradients.length>0&&h.GetCurrentGradient(L,this._velocityGradients,((T,z,b)=>{T!==X._currentVelocityGradient&&(X._currentVelocity1=X._currentVelocity2,X._currentVelocity2=z.getFactor(),X._currentVelocityGradient=T),D*=(0,v.p)(X._currentVelocity1,X._currentVelocity2,b)})),X.direction.scaleToRef(D,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&h.GetCurrentGradient(L,this._limitVelocityGradients,((T,z,b)=>{T!==X._currentLimitVelocityGradient&&(X._currentLimitVelocity1=X._currentLimitVelocity2,X._currentLimitVelocity2=z.getFactor(),X._currentLimitVelocityGradient=T);const F=(0,v.p)(X._currentLimitVelocity1,X._currentLimitVelocity2,b);X.direction.length()>F&&X.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&h.GetCurrentGradient(L,this._dragGradients,((T,z,b)=>{T!==X._currentDragGradient&&(X._currentDrag1=X._currentDrag2,X._currentDrag2=z.getFactor(),X._currentDragGradient=T);const F=(0,v.p)(X._currentDrag1,X._currentDrag2,b);this._scaledDirection.scaleInPlace(1-F)})),this.isLocal&&X.Eg?(X.Eg.addInPlace(this._scaledDirection),b.j.TransformCoordinatesToRef(X.Eg,this._emitterWorldMatrix,X.position)):X.position.addInPlace(this._scaledDirection),E&&z&&X._randomNoiseCoordinates1){const T=this._fetchR(X._randomNoiseCoordinates1.x,X._randomNoiseCoordinates1.y,z.width,z.height,E),F=this._fetchR(X._randomNoiseCoordinates1.z,X._randomNoiseCoordinates2.x,z.width,z.height,E),A=this._fetchR(X._randomNoiseCoordinates2.y,X._randomNoiseCoordinates2.z,z.width,z.height,E),u=b.f.Id[0],v=b.f.Id[1];u.Cd((2*T-1)*this.noiseStrength.x,(2*F-1)*this.noiseStrength.y,(2*A-1)*this.noiseStrength.z),u.scaleToRef(y,v),X.direction.addInPlace(v)}this.gravity.scaleToRef(y,this._scaledGravity),X.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&h.GetCurrentGradient(L,this._sizeGradients,((T,z,b)=>{T!==X._currentSizeGradient&&(X._currentSize1=X._currentSize2,X._currentSize2=z.getFactor(),X._currentSizeGradient=T),X.size=(0,v.p)(X._currentSize1,X._currentSize2,b)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&h.GetCurrentGradient(L,this._colorRemapGradients,((T,z,b)=>{const F=(0,v.p)(T.factor1,z.factor1,b),A=(0,v.p)(T.factor2,z.factor2,b);X.remapData.x=F,X.remapData.y=A-F})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&h.GetCurrentGradient(L,this._alphaRemapGradients,((T,z,b)=>{const F=(0,v.p)(T.factor1,z.factor1,b),A=(0,v.p)(T.factor2,z.factor2,b);X.remapData.z=F,X.remapData.w=A-F}))),this._isAnimationSheetEnabled&&X.updateCellIndex(),X._inheritParticleInfoToSubEmitters(),X.age>=X.lifeTime&&(this._emitFromParticle(X),X._attachedSubEmitters&&(X._attachedSubEmitters.forEach((T=>{T.particleSystem.disposeOnStop=!0,T.particleSystem.stop()})),X._attachedSubEmitters=null),this.recycleParticle(X),F&&A--)}}}serialize(T){throw new Error("Method not implemented.")}clone(T,z){throw new Error("Method not implemented.")}_addFactorGradient(T,z,X,b){const F=new f(z,X,b);T.push(F),T.sort(((T,z)=>T.gradient<z.gradient?-1:T.gradient>z.gradient?1:0))}_removeFactorGradient(T,z){if(!T)return;let X=0;for(const b of T){if(b.gradient===z){T.splice(X,1);break}X++}}addLifeTimeGradient(T,z,X){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,T,z,X),this}removeLifeTimeGradient(T){return this._removeFactorGradient(this._lifeTimeGradients,T),this}addSizeGradient(T,z,X){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,T,z,X),this}removeSizeGradient(T){return this._removeFactorGradient(this._sizeGradients,T),this}addColorRemapGradient(T,z,X){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,T,z,X),this}removeColorRemapGradient(T){return this._removeFactorGradient(this._colorRemapGradients,T),this}addAlphaRemapGradient(T,z,X){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,T,z,X),this}removeAlphaRemapGradient(T){return this._removeFactorGradient(this._alphaRemapGradients,T),this}addAngularSpeedGradient(T,z,X){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,T,z,X),this}removeAngularSpeedGradient(T){return this._removeFactorGradient(this._angularSpeedGradients,T),this}addVelocityGradient(T,z,X){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,T,z,X),this}removeVelocityGradient(T){return this._removeFactorGradient(this._velocityGradients,T),this}addLimitVelocityGradient(T,z,X){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,T,z,X),this}removeLimitVelocityGradient(T){return this._removeFactorGradient(this._limitVelocityGradients,T),this}addDragGradient(T,z,X){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,T,z,X),this}removeDragGradient(T){return this._removeFactorGradient(this._dragGradients,T),this}addEmitRateGradient(T,z,X){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,T,z,X),this}removeEmitRateGradient(T){return this._removeFactorGradient(this._emitRateGradients,T),this}addStartSizeGradient(T,z,X){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,T,z,X),this}removeStartSizeGradient(T){return this._removeFactorGradient(this._startSizeGradients,T),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const T=new Uint8Array(4*this._rawTextureWidth),z=u.h.Wd[0];for(let X=0;X<this._rawTextureWidth;X++){const b=X/this._rawTextureWidth;h.GetCurrentGradient(b,this._rampGradients,((b,F,A)=>{u.b.LerpToRef(b.color,F.color,A,z),T[4*X]=255*z.r,T[4*X+1]=255*z.g,T[4*X+2]=255*z.b,T[4*X+3]=255}))}this._rampGradientsTexture=w.c.CreateRGBATexture(T,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((T,z)=>T.gradient<z.gradient?-1:T.gradient>z.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(T,z){this._rampGradients||(this._rampGradients=[]);const X=new o(T,z);return this._rampGradients.push(X),this._syncRampGradientTexture(),this}removeRampGradient(T){return this._removeGradientAndTexture(T,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(T,z,X){this._colorGradients||(this._colorGradients=[]);const b=new r(T,z,X);return this._colorGradients.push(b),this._colorGradients.sort(((T,z)=>T.gradient<z.gradient?-1:T.gradient>z.gradient?1:0)),this}removeColorGradient(T){if(!this._colorGradients)return this;let z=0;for(const X of this._colorGradients){if(X.gradient===T){this._colorGradients.splice(z,1);break}z++}return this}resetDrawCache(){for(const T of this._drawWrappers)if(T)for(const z of T)null===z||void 0===z||z.dispose();this._drawWrappers=[]}_fetchR(T,z,X,b,F){return F[4*(((T=.5*Math.abs(T)+.5)*X%X|0)+((z=.5*Math.abs(z)+.5)*b%b|0)*X)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const T=this._engine,z=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*z),this._vertexBuffer=new N.b(T,this._vertexData,!0,z);let X=0;const b=this._vertexBuffer.createVertexBuffer(N.e.PositionKind,X,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[N.e.PositionKind]=b,X+=3;const F=this._vertexBuffer.createVertexBuffer(N.e.ColorKind,X,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[N.e.ColorKind]=F,X+=4;const A=this._vertexBuffer.createVertexBuffer("angle",X,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=A,X+=1;const u=this._vertexBuffer.createVertexBuffer("size",X,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=u,X+=2,this._isAnimationSheetEnabled){const T=this._vertexBuffer.createVertexBuffer("cellIndex",X,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=T,X+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const T=this._vertexBuffer.createVertexBuffer("direction",X,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=T,X+=3}if(this._useRampGradients){const T=this._vertexBuffer.createVertexBuffer("remapData",X,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=T,X+=4}let y;if(this._useInstancing){const z=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new N.b(T,z,!1,2),y=this._spriteBuffer.createVertexBuffer("offset",0,2)}else y=this._vertexBuffer.createVertexBuffer("offset",X,2,this._vertexBufferSize,this._useInstancing),X+=2;this._vertexBuffers.offset=y,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const T=[],z=[];let X=0;for(let b=0;b<this._capacity;b++)T.push(X),T.push(X+1),T.push(X+2),T.push(X),T.push(X+2),T.push(X+3),z.push(X,X+1,X+1,X+2,X+2,X+3,X+3,X,X,X+3),X+=4;this._indexBuffer=this._engine.createIndexBuffer(T),this._linesIndexBuffer=this._engine.createIndexBuffer(z)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(T)setTimeout((()=>{this.start(0)}),T);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var z;-1!==(null===(z=this.k)||void 0===z?void 0:z.getClassName().indexOf("Mesh"))&&this.k.ze(!0);const T=this.noiseTexture;if(T&&T.onGeneratedObservable)T.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let z=0;z<this.preWarmCycles;z++)this.animate(!0),T.render()}))}));else for(let z=0;z<this.preWarmCycles;z++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let T=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(T))}_postStop(T){}reset(){this._stockParticles.length=0,this.Gj.length=0}_appendParticleVertex(T,z,X,F){let A=T*this._vertexBufferSize;if(this._vertexData[A++]=z.position.x+this.yg.x,this._vertexData[A++]=z.position.y+this.yg.y,this._vertexData[A++]=z.position.z+this.yg.z,this._vertexData[A++]=z.color.r,this._vertexData[A++]=z.color.g,this._vertexData[A++]=z.color.b,this._vertexData[A++]=z.color.a,this._vertexData[A++]=z.angle,this._vertexData[A++]=z.scale.x*z.size,this._vertexData[A++]=z.scale.y*z.size,this._isAnimationSheetEnabled&&(this._vertexData[A++]=z.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[A++]=z.direction.x,this._vertexData[A++]=z.direction.y,this._vertexData[A++]=z.direction.z);else if(z._initialDirection){let T=z._initialDirection;this.isLocal&&(b.j.TransformNormalToRef(T,this._emitterWorldMatrix,b.f.Id[0]),T=b.f.Id[0]),0===T.x&&0===T.z&&(T.x=.001),this._vertexData[A++]=T.x,this._vertexData[A++]=T.y,this._vertexData[A++]=T.z}else{let T=z.direction;this.isLocal&&(b.j.TransformNormalToRef(T,this._emitterWorldMatrix,b.f.Id[0]),T=b.f.Id[0]),0===T.x&&0===T.z&&(T.x=.001),this._vertexData[A++]=T.x,this._vertexData[A++]=T.y,this._vertexData[A++]=T.z}this._useRampGradients&&z.remapData&&(this._vertexData[A++]=z.remapData.x,this._vertexData[A++]=z.remapData.y,this._vertexData[A++]=z.remapData.z,this._vertexData[A++]=z.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===X?X=this._epsilon:1===X&&(X=1-this._epsilon),0===F?F=this._epsilon:1===F&&(F=1-this._epsilon)),this._vertexData[A++]=X,this._vertexData[A++]=F)}_prepareParticle(T){}_update(T){if(this._alive=this.Gj.length>0,this.k.position){const T=this.k;this._emitterWorldMatrix=T.getWorldMatrix()}else{const T=this.k;this._emitterWorldMatrix=b.d.Translation(T.x,T.y,T.z)}let z;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Gj);for(let X=0;X<T&&this.Gj.length!==this._capacity;X++){if(z=this._createParticle(),this.Gj.push(z),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const T=(0,v.d)(this._actualFrame/this.targetStopDuration);h.GetCurrentGradient(T,this._lifeTimeGradients,((X,b)=>{const F=X,A=b,u=F.getFactor(),y=A.getFactor(),E=(T-F.gradient)/(A.gradient-F.gradient);z.lifeTime=(0,v.p)(u,y,E)}))}else z.lifeTime=(0,v.s)(this.minLifeTime,this.maxLifeTime);const T=(0,v.s)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,z.position,z,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,z.position,z,this.isLocal),this.isLocal&&(z.Eg?z.Eg.p(z.position):z.Eg=z.position.clone(),b.j.TransformCoordinatesToRef(z.Eg,this._emitterWorldMatrix,z.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,z.direction,z,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,z.direction,z,this.isLocal,this._emitterInverseWorldMatrix),0===T?z._initialDirection?z._initialDirection.p(z.direction):z._initialDirection=z.direction.clone():z._initialDirection=null,z.direction.scaleInPlace(T),this._sizeGradients&&0!==this._sizeGradients.length?(z._currentSizeGradient=this._sizeGradients[0],z._currentSize1=z._currentSizeGradient.getFactor(),z.size=z._currentSize1,this._sizeGradients.length>1?z._currentSize2=this._sizeGradients[1].getFactor():z._currentSize2=z._currentSize1):z.size=(0,v.s)(this.minSize,this.maxSize),z.scale.Cd((0,v.s)(this.minScaleX,this.maxScaleX),(0,v.s)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const T=this._actualFrame/this.targetStopDuration;h.GetCurrentGradient(T,this._startSizeGradients,((T,X,b)=>{T!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=X.getFactor(),this._currentStartSizeGradient=T);const F=(0,v.p)(this._currentStartSize1,this._currentStartSize2,b);z.scale.scaleInPlace(F)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(z._currentAngularSpeedGradient=this._angularSpeedGradients[0],z.angularSpeed=z._currentAngularSpeedGradient.getFactor(),z._currentAngularSpeed1=z.angularSpeed,this._angularSpeedGradients.length>1?z._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():z._currentAngularSpeed2=z._currentAngularSpeed1):z.angularSpeed=(0,v.s)(this.minAngularSpeed,this.maxAngularSpeed),z.angle=(0,v.s)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(z._currentVelocityGradient=this._velocityGradients[0],z._currentVelocity1=z._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?z._currentVelocity2=this._velocityGradients[1].getFactor():z._currentVelocity2=z._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(z._currentLimitVelocityGradient=this._limitVelocityGradients[0],z._currentLimitVelocity1=z._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?z._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():z._currentLimitVelocity2=z._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(z._currentDragGradient=this._dragGradients[0],z._currentDrag1=z._currentDragGradient.getFactor(),this._dragGradients.length>1?z._currentDrag2=this._dragGradients[1].getFactor():z._currentDrag2=z._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)z._currentColorGradient=this._colorGradients[0],z._currentColorGradient.getColorToRef(z.color),z._currentColor1.p(z.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(z._currentColor2):z._currentColor2.p(z.color);else{const T=(0,v.s)(0,1);u.d.LerpToRef(this.color1,this.color2,T,z.color),this.colorDead.subtractToRef(z.color,this._colorDiff),this._colorDiff.scaleToRef(1/z.lifeTime,z.colorStep)}this._isAnimationSheetEnabled&&(z._initialStartSpriteCellID=this.startSpriteCellID,z._initialEndSpriteCellID=this.endSpriteCellID,z._initialSpriteCellLoop=this.spriteCellLoop),z.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(z.remapData=new b.n(0,1,0,1)),this.noiseTexture&&(z._randomNoiseCoordinates1?(z._randomNoiseCoordinates1.Cd(Math.random(),Math.random(),Math.random()),z._randomNoiseCoordinates2.Cd(Math.random(),Math.random(),Math.random())):(z._randomNoiseCoordinates1=new b.j(Math.random(),Math.random(),Math.random()),z._randomNoiseCoordinates2=new b.j(Math.random(),Math.random(),Math.random()))),z._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const b=[N.e.PositionKind,N.e.ColorKind,"angle","offset","size"];return T&&b.push("cellIndex"),z||b.push("direction"),X&&b.push("remapData"),b}static _GetEffectCreationOptions(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const b=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,zT.d)(b),T&&b.push("particlesInfos"),z&&b.push("logarithmicDepthConstant"),X&&(b.push("vFogInfos"),b.push("vFogColor")),b}fillDefines(T,z){let X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,zT.j)(this,this._scene,T),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&T.push("#define FOG")),this._isAnimationSheetEnabled&&T.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&T.push("#define LOGARITHMICDEPTH"),z===E.BLENDMODE_MULTIPLY&&T.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&T.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(T.push("#define BILLBOARD"),this.billboardMode){case 2:T.push("#define BILLBOARDY");break;case 8:case 9:T.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&T.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:T.push("#define BILLBOARDMODE_ALL")}X&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),T.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(T,z,X){z.push(...FT._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),T.push(...FT._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),X.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,bT.g)(T,this._imageProcessingConfigurationDefines),(0,bT.d)(X,this._imageProcessingConfigurationDefines))}_getWrapper(T){const z=this._getCustomDrawWrapper(T);if(null!==z&&void 0!==z&&z.effect)return z;const X=[];this.fillDefines(X,T);const b=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let F=this._drawWrappers[b];F||(F=this._drawWrappers[b]=[]);let A=F[T];A||(A=new TT.b(this._engine),A.drawContext&&(A.drawContext.useInstancing=this._useInstancing),F[T]=A);const u=X.join("\n");if(A.defines!==u){const T=[],z=[],X=[];this.fillUniformsAttributesAndSamplerNames(z,T,X),A.setEffect(this._engine.createEffect("particles",T,z,X,u,void 0,void 0,void 0,void 0,this._shaderLanguage),u)}return A}animate(){var T;let z,X=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!X&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(X?this.preWarmStepOffset:(null===(T=this._scene)||void 0===T?void 0:T.getAnimationRatio())||1),this.manualEmitCount>-1)z=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let T=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const z=this._actualFrame/this.targetStopDuration;h.GetCurrentGradient(z,this._emitRateGradients,((z,X,b)=>{z!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=X.getFactor(),this._currentEmitRateGradient=z),T=(0,v.p)(this._currentEmitRate1,this._currentEmitRate2,b)}))}z=T*this._scaledUpdateSpeed|0,this._newPartsExcess+=T*this._scaledUpdateSpeed-z}if(this._newPartsExcess>1&&(z+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?z=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(z),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!X){let T=0;for(let z=0;z<this.Gj.length;z++){const X=this.Gj[z];this._appendParticleVertices(T,X),T+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Gj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(T,z){this._appendParticleVertex(T++,z,0,0),this._useInstancing||(this._appendParticleVertex(T++,z,1,0),this._appendParticleVertex(T++,z,1,1),this._appendParticleVertex(T++,z,0,1))}rebuild(){var T;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(T=this._spriteBuffer)||void 0===T||T._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!FT.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(X.bind(X,12113)),Promise.resolve().then(X.bind(X,12105))])):await Promise.all([Promise.resolve().then(X.bind(X,12103)),Promise.resolve().then(X.bind(X,12099))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==E.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(E.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(E.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(T){const z=this._getWrapper(T),X=z.effect,F=this._engine;F.enableEffect(z);const A=this.defaultViewMatrix??this._scene.getViewMatrix();if(X.setTexture("diffuseSampler",this.particleTexture),X.setMatrix("view",A),X.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const T=this.particleTexture.getBaseSize();X.setFloat3("particlesInfos",this.spriteCellWidth/T.width,this.spriteCellHeight/T.height,this.spriteCellWidth/T.width)}if(X.setVector2("translationPivot",this.translationPivot),X.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const T=this._scene.activeCamera;X.setVector3("eyePosition",T.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),X.setTexture("rampSampler",this._rampGradientsTexture));const u=X.defines;var y,v,k,L,D,c;(this._scene&&((0,zT.e)(X,this,this._scene),this.applyFog&&(0,XT.d)(this._scene,void 0,X)),u.indexOf("#define BILLBOARDMODE_ALL")>=0&&(A.invertToRef(b.f.Matrix[0]),X.setMatrix("invView",b.f.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?F.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,X):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,X)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(v=this._scene)&&void 0!==v&&v.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?F.bindBuffers(this._vertexBuffers,null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?this._linesIndexBuffer:this._indexBuffer,X):F.bindBuffers(this._vertexBuffers,null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?this._linesIndexBufferUseInstancing:null,X);switch(this.useLogarithmicDepth&&this._scene&&(0,XT.l)(u,X,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(X),T){case E.BLENDMODE_ADD:F.setAlphaMode(1);break;case E.BLENDMODE_ONEONE:F.setAlphaMode(6);break;case E.BLENDMODE_STANDARD:F.setAlphaMode(2);break;case E.BLENDMODE_MULTIPLY:F.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(X),this._useInstancing)?null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?F.drawElementsType(6,0,10,this.Gj.length):F.drawArraysType(7,0,4,this.Gj.length):null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?F.drawElementsType(1,0,10*this.Gj.length):F.drawElementsType(0,0,6*this.Gj.length);return this.Gj.length}render(){if(!this.isReady()||!this.Gj.length)return 0;const T=this._engine;T.setState&&(T.setState(!1),this.forceDepthWrite&&T.setDepthWrite(!0));let z=0;return z=this.blendMode===E.BLENDMODE_MULTIPLYADD?this._render(E.BLENDMODE_MULTIPLY)+this._render(E.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),z}_onDispose(){}dispose(){let T=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),T&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),T&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(z,X),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const T=this._scene.pe.indexOf(this);T>-1&&this._scene.pe.splice(T,1),this._scene._activeParticleSystems.dispose()}this.Qd.notifyObservers(this),this.Qd.clear(),this.onStoppedObservable.clear(),this.reset()}}FT.ForceGLSL=!1;var AT,uT=X(1061);!function(T){T[T.ATTACHED=0]="ATTACHED",T[T.END=1]="END"}(AT||(AT={}));class yT{constructor(T){if(this.particleSystem=T,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!T.k||!T.k.dispose){const z=(0,y.e)("BABYLON.AbstractMesh");T.k=new z("SubemitterSystemEmitter",T.va()),T._disposeEmitterOnDispose=!0}}clone(){let T=this.particleSystem.k;if(T){if(T instanceof b.j)T=T.clone();else if(-1!==T.getClassName().indexOf("Mesh")){T=new((0,y.e)("BABYLON.Mesh"))("",T.va()),T.isVisible=!1}}else T=new b.j;const z=new yT(this.particleSystem.clone(this.particleSystem.name,T));return z.particleSystem.name+="Clone",z.type=this.type,z.inheritDirection=this.inheritDirection,z.inheritedVelocityAmount=this.inheritedVelocityAmount,z.particleSystem._disposeEmitterOnDispose=!0,z.particleSystem.disposeOnStop=!0,z}serialize(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const z={};return z.type=this.type,z.inheritDirection=this.inheritDirection,z.inheritedVelocityAmount=this.inheritedVelocityAmount,z.particleSystem=this.particleSystem.serialize(T),z}static _ParseParticleSystem(T,z,X){throw(0,uT.d)("ParseParticle")}static Parse(T,z,X){const b=T.particleSystem,F=new yT(yT._ParseParticleSystem(b,z,X,!0));return F.type=T.type,F.inheritDirection=T.inheritDirection,F.inheritedVelocityAmount=T.inheritedVelocityAmount,F.particleSystem._isSubEmitter=!0,F}dispose(){this.particleSystem.dispose()}}var ET=X(1071);function vT(T,z){const X=new s;return X.direction1=T,X.direction2=z,X}function kT(){return new U(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function LT(){return new x(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function DT(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new b.j(0,1,0),X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.j(0,1,0);return new K(T,z,X)}function cT(){return new p(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function pT(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b.j(0,1,0),A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new b.j(0,1,0);return new H(T,z,X,F,A)}function HT(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new D(T,z)}function UT(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.j(0,1,0),F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b.j(0,1,0);return new c(T,z,X,F)}class sT extends FT{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=T=>{if(!this._subEmitters||0===this._subEmitters.length)return;const z=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[z].forEach((z=>{if(1===z.type){const X=z.clone();T._inheritParticleInfoToSubEmitter(X),X.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(X.particleSystem),X.particleSystem.start()}}))}}createPointEmitter(T,z){const X=vT(T,z);return this.particleEmitterType=X,X}createHemisphericEmitter(){const T=kT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=T,T}createSphereEmitter(){const T=LT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=T,T}createDirectedSphereEmitter(){const T=DT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new b.j(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.j(0,1,0));return this.particleEmitterType=T,T}createCylinderEmitter(){const T=cT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=T,T}createDirectedCylinderEmitter(){const T=pT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b.j(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new b.j(0,1,0));return this.particleEmitterType=T,T}createConeEmitter(){const T=HT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=T,T}createDirectedConeEmitter(){const T=UT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.j(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b.j(0,1,0));return this.particleEmitterType=T,T}createBoxEmitter(T,z,X,b){const F=new L;return this.particleEmitterType=F,this.direction1=T,this.direction2=z,this.minEmitBox=X,this.maxEmitBox=b,F}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((T=>{T instanceof sT?this._subEmitters.push([new yT(T)]):T instanceof yT?this._subEmitters.push([T]):T instanceof Array&&this._subEmitters.push(T)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((T=>{T.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const T=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==T&&this._rootParticleSystem.activeSubSystems.splice(T,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(T){T&&this._stopSubEmitters()}_prepareParticle(T){if(this._subEmitters&&this._subEmitters.length>0){const z=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];T._attachedSubEmitters=[],z.forEach((z=>{if(0===z.type){const X=z.clone();T._attachedSubEmitters.push(X),X.particleSystem.start()}}))}}_onDispose(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var X;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),T)&&(null===(X=this.particles)||void 0===X||X.forEach((T=>{if(T._attachedSubEmitters)for(let z=T._attachedSubEmitters.length-1;z>=0;z-=1)T._attachedSubEmitters[z].dispose()})));if(z&&this.activeSubSystems)for(let b=this.activeSubSystems.length-1;b>=0;b-=1)this.activeSubSystems[b].dispose();if(this._subEmitters&&this._subEmitters.length){for(let T=0;T<this._subEmitters.length;T++)for(const z of this._subEmitters[T])z.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(T,z,X,F){let A;A=X instanceof ET.d?null:X;const E=(0,y.e)("BABYLON.Texture");if(E&&A&&(T.texture?z.particleTexture=E.Parse(T.texture,A,F):T.textureName&&(z.particleTexture=new E(F+T.textureName,A,!1,void 0===T.invertY||T.invertY),z.particleTexture.name=T.textureName)),T.emitterId||0===T.emitterId||void 0!==T.k?T.emitterId&&A?z.k=A.getLastMeshById(T.emitterId):z.k=b.j.xd(T.k):z.k=b.j.Zero(),z.isLocal=!!T.isLocal,void 0!==T.renderingGroupId&&(z.renderingGroupId=T.renderingGroupId),void 0!==T.isBillboardBased&&(z.isBillboardBased=T.isBillboardBased),void 0!==T.billboardMode&&(z.billboardMode=T.billboardMode),void 0!==T.useLogarithmicDepth&&(z.useLogarithmicDepth=T.useLogarithmicDepth),T.animations){for(let X=0;X<T.animations.length;X++){const b=T.animations[X],F=(0,y.e)("BABYLON.Animation");F&&z.animations.push(F.Parse(b))}z.beginAnimationOnStart=T.beginAnimationOnStart,z.beginAnimationFrom=T.beginAnimationFrom,z.beginAnimationTo=T.beginAnimationTo,z.beginAnimationLoop=T.beginAnimationLoop}if(T.autoAnimate&&A&&A.beginAnimation(z,T.autoAnimateFrom,T.autoAnimateTo,T.autoAnimateLoop,T.autoAnimateSpeed||1),z.startDelay=0|T.startDelay,z.minAngularSpeed=T.minAngularSpeed,z.maxAngularSpeed=T.maxAngularSpeed,z.minSize=T.minSize,z.maxSize=T.maxSize,T.minScaleX&&(z.minScaleX=T.minScaleX,z.maxScaleX=T.maxScaleX,z.minScaleY=T.minScaleY,z.maxScaleY=T.maxScaleY),void 0!==T.preWarmCycles&&(z.preWarmCycles=T.preWarmCycles,z.preWarmStepOffset=T.preWarmStepOffset),void 0!==T.minInitialRotation&&(z.minInitialRotation=T.minInitialRotation,z.maxInitialRotation=T.maxInitialRotation),z.minLifeTime=T.minLifeTime,z.maxLifeTime=T.maxLifeTime,z.minEmitPower=T.minEmitPower,z.maxEmitPower=T.maxEmitPower,z.emitRate=T.emitRate,z.gravity=b.j.xd(T.gravity),T.noiseStrength&&(z.noiseStrength=b.j.xd(T.noiseStrength)),z.color1=u.d.xd(T.color1),z.color2=u.d.xd(T.color2),z.colorDead=u.d.xd(T.colorDead),z.updateSpeed=T.updateSpeed,z.targetStopDuration=T.targetStopDuration,z.blendMode=T.blendMode,T.colorGradients)for(const b of T.colorGradients)z.addColorGradient(b.gradient,u.d.xd(b.color1),b.color2?u.d.xd(b.color2):void 0);if(T.rampGradients){for(const X of T.rampGradients)z.addRampGradient(X.gradient,u.b.xd(X.color));z.useRampGradients=T.useRampGradients}if(T.colorRemapGradients)for(const b of T.colorRemapGradients)z.addColorRemapGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(T.alphaRemapGradients)for(const b of T.alphaRemapGradients)z.addAlphaRemapGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(T.sizeGradients)for(const b of T.sizeGradients)z.addSizeGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(T.angularSpeedGradients)for(const b of T.angularSpeedGradients)z.addAngularSpeedGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(T.velocityGradients)for(const b of T.velocityGradients)z.addVelocityGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(T.dragGradients)for(const b of T.dragGradients)z.addDragGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(T.emitRateGradients)for(const b of T.emitRateGradients)z.addEmitRateGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(T.startSizeGradients)for(const b of T.startSizeGradients)z.addStartSizeGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(T.lifeTimeGradients)for(const b of T.lifeTimeGradients)z.addLifeTimeGradient(b.gradient,void 0!==b.factor1?b.factor1:b.factor,b.factor2);if(T.limitVelocityGradients){for(const X of T.limitVelocityGradients)z.addLimitVelocityGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);z.limitVelocityDamping=T.limitVelocityDamping}if(T.noiseTexture&&A){const X=(0,y.e)("BABYLON.ProceduralTexture");z.noiseTexture=X.Parse(T.noiseTexture,A,F)}let v;if(T.particleEmitterType){switch(T.particleEmitterType.type){case"SphereParticleEmitter":v=new x;break;case"SphereDirectedParticleEmitter":v=new K;break;case"ConeEmitter":case"ConeParticleEmitter":v=new D;break;case"ConeDirectedParticleEmitter":v=new c;break;case"CylinderParticleEmitter":v=new p;break;case"CylinderDirectedParticleEmitter":v=new H;break;case"HemisphericParticleEmitter":v=new U;break;case"PointParticleEmitter":v=new s;break;case"MeshParticleEmitter":v=new l;break;case"CustomParticleEmitter":v=new d;break;default:v=new L}v.parse(T.particleEmitterType,A)}else v=new L,v.parse(T,A);z.particleEmitterType=v,z.startSpriteCellID=T.startSpriteCellID,z.endSpriteCellID=T.endSpriteCellID,z.spriteCellLoop=T.spriteCellLoop??!0,z.spriteCellWidth=T.spriteCellWidth,z.spriteCellHeight=T.spriteCellHeight,z.spriteCellChangeSpeed=T.spriteCellChangeSpeed,z.spriteRandomStartCell=T.spriteRandomStartCell,z.disposeOnStop=T.disposeOnStop??!1,z.manualEmitCount=T.manualEmitCount??-1}static Parse(T,z,X){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3],A=arguments.length>4?arguments[4]:void 0;const y=T.name;let E,v,k=null,L=null;if(z instanceof ET.d?E=z:(v=z,E=v.getEngine()),T.customShader&&E.createEffectForParticles){L=T.customShader;const z=L.shaderOptions.defines.length>0?L.shaderOptions.defines.join("\n"):"";k=E.createEffectForParticles(L.shaderPath.fragmentElement,L.shaderOptions.uniforms,L.shaderOptions.samplers,z)}const D=new sT(y,A||T.qd,z,k,T.isAnimationSheetEnabled);if(D.customShader=L,D._rootUrl=X,T.id&&(D.id=T.id),T.subEmitters){D.subEmitters=[];for(const b of T.subEmitters){const T=[];for(const F of b)T.push(yT.Parse(F,z,X));D.subEmitters.push(T)}}return sT._Parse(T,D,z,X),T.textureMask&&(D.textureMask=u.d.xd(T.textureMask)),T.yg&&(D.yg=b.j.xd(T.yg)),T.preventAutoStart&&(D.preventAutoStart=T.preventAutoStart),F||D.preventAutoStart||D.start(),D}serialize(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const z={};if(sT._Serialize(z,this,T),z.textureMask=this.textureMask.zd(),z.customShader=this.customShader,z.preventAutoStart=this.preventAutoStart,z.yg=this.yg.zd(),this.subEmitters){z.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const X of this._subEmitters){const b=[];for(const z of X)b.push(z.serialize(T));z.subEmitters.push(b)}}return z}static _Serialize(T,z,X){if(T.name=z.name,T.id=z.id,T.qd=z.getCapacity(),T.disposeOnStop=z.disposeOnStop,T.manualEmitCount=z.manualEmitCount,z.k.position){const X=z.k;T.emitterId=X.id}else{const X=z.k;T.k=X.zd()}z.particleEmitterType&&(T.particleEmitterType=z.particleEmitterType.serialize()),z.particleTexture&&(X?T.texture=z.particleTexture.serialize():(T.textureName=z.particleTexture.name,T.invertY=!!z.particleTexture._invertY)),T.isLocal=z.isLocal,O.b.AppendSerializedAnimations(z,T),T.beginAnimationOnStart=z.beginAnimationOnStart,T.beginAnimationFrom=z.beginAnimationFrom,T.beginAnimationTo=z.beginAnimationTo,T.beginAnimationLoop=z.beginAnimationLoop,T.startDelay=z.startDelay,T.renderingGroupId=z.renderingGroupId,T.isBillboardBased=z.isBillboardBased,T.billboardMode=z.billboardMode,T.minAngularSpeed=z.minAngularSpeed,T.maxAngularSpeed=z.maxAngularSpeed,T.minSize=z.minSize,T.maxSize=z.maxSize,T.minScaleX=z.minScaleX,T.maxScaleX=z.maxScaleX,T.minScaleY=z.minScaleY,T.maxScaleY=z.maxScaleY,T.minEmitPower=z.minEmitPower,T.maxEmitPower=z.maxEmitPower,T.minLifeTime=z.minLifeTime,T.maxLifeTime=z.maxLifeTime,T.emitRate=z.emitRate,T.gravity=z.gravity.zd(),T.noiseStrength=z.noiseStrength.zd(),T.color1=z.color1.zd(),T.color2=z.color2.zd(),T.colorDead=z.colorDead.zd(),T.updateSpeed=z.updateSpeed,T.targetStopDuration=z.targetStopDuration,T.blendMode=z.blendMode,T.preWarmCycles=z.preWarmCycles,T.preWarmStepOffset=z.preWarmStepOffset,T.minInitialRotation=z.minInitialRotation,T.maxInitialRotation=z.maxInitialRotation,T.startSpriteCellID=z.startSpriteCellID,T.spriteCellLoop=z.spriteCellLoop,T.endSpriteCellID=z.endSpriteCellID,T.spriteCellChangeSpeed=z.spriteCellChangeSpeed,T.spriteCellWidth=z.spriteCellWidth,T.spriteCellHeight=z.spriteCellHeight,T.spriteRandomStartCell=z.spriteRandomStartCell,T.isAnimationSheetEnabled=z.isAnimationSheetEnabled,T.useLogarithmicDepth=z.useLogarithmicDepth;const b=z.getColorGradients();if(b){T.colorGradients=[];for(const z of b){const X={gradient:z.gradient,color1:z.color1.zd()};z.color2?X.color2=z.color2.zd():X.color2=z.color1.zd(),T.colorGradients.push(X)}}const F=z.getRampGradients();if(F){T.rampGradients=[];for(const z of F){const X={gradient:z.gradient,color:z.color.zd()};T.rampGradients.push(X)}T.useRampGradients=z.useRampGradients}const A=z.getColorRemapGradients();if(A){T.colorRemapGradients=[];for(const z of A){const X={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?X.factor2=z.factor2:X.factor2=z.factor1,T.colorRemapGradients.push(X)}}const u=z.getAlphaRemapGradients();if(u){T.alphaRemapGradients=[];for(const z of u){const X={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?X.factor2=z.factor2:X.factor2=z.factor1,T.alphaRemapGradients.push(X)}}const y=z.getSizeGradients();if(y){T.sizeGradients=[];for(const z of y){const X={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?X.factor2=z.factor2:X.factor2=z.factor1,T.sizeGradients.push(X)}}const E=z.getAngularSpeedGradients();if(E){T.angularSpeedGradients=[];for(const z of E){const X={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?X.factor2=z.factor2:X.factor2=z.factor1,T.angularSpeedGradients.push(X)}}const v=z.getVelocityGradients();if(v){T.velocityGradients=[];for(const z of v){const X={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?X.factor2=z.factor2:X.factor2=z.factor1,T.velocityGradients.push(X)}}const k=z.getDragGradients();if(k){T.dragGradients=[];for(const z of k){const X={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?X.factor2=z.factor2:X.factor2=z.factor1,T.dragGradients.push(X)}}const L=z.getEmitRateGradients();if(L){T.emitRateGradients=[];for(const z of L){const X={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?X.factor2=z.factor2:X.factor2=z.factor1,T.emitRateGradients.push(X)}}const D=z.getStartSizeGradients();if(D){T.startSizeGradients=[];for(const z of D){const X={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?X.factor2=z.factor2:X.factor2=z.factor1,T.startSizeGradients.push(X)}}const c=z.getLifeTimeGradients();if(c){T.lifeTimeGradients=[];for(const z of c){const X={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?X.factor2=z.factor2:X.factor2=z.factor1,T.lifeTimeGradients.push(X)}}const p=z.getLimitVelocityGradients();if(p){T.limitVelocityGradients=[];for(const z of p){const X={gradient:z.gradient,factor1:z.factor1};void 0!==z.factor2?X.factor2=z.factor2:X.factor2=z.factor1,T.limitVelocityGradients.push(X)}T.limitVelocityDamping=z.limitVelocityDamping}z.noiseTexture&&(T.noiseTexture=z.noiseTexture.serialize())}clone(T,z){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const b={...this._customWrappers};let F=null;const A=this._engine;if(A.createEffectForParticles&&null!=this.customShader){F=this.customShader;const T=F.shaderOptions.defines.length>0?F.shaderOptions.defines.join("\n"):"",z=A.createEffectForParticles(F.shaderPath.fragmentElement,F.shaderOptions.uniforms,F.shaderOptions.samplers,T);b[0]?b[0].effect=z:this.setCustomEffect(z,0)}const u=this.serialize(X),y=sT.Parse(u,this._scene||this._engine,this._rootUrl);return y.name=T,y.customShader=F,y._customWrappers=b,void 0===z&&(z=this.k),this.noiseTexture&&(y.noiseTexture=this.noiseTexture.clone()),y.k=z,this.preventAutoStart||y.start(),y}}sT.BILLBOARDMODE_Y=2,sT.BILLBOARDMODE_ALL=7,sT.BILLBOARDMODE_STRETCHED=8,sT.BILLBOARDMODE_STRETCHED_LOCAL=9,yT._ParseParticleSystem=sT.Parse;var xT=X(1175),KT=X(1159),dT=X(1373);dT.e.prototype.createTransformFeedback=function(){const T=this._gl.createTransformFeedback();if(!T)throw new Error("Unable to create Transform Feedback");return T},dT.e.prototype.deleteTransformFeedback=function(T){this._gl.deleteTransformFeedback(T)},dT.e.prototype.bindTransformFeedback=function(T){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,T)},dT.e.prototype.beginTransformFeedback=function(){let T=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(T?this._gl.POINTS:this._gl.TRIANGLES)},dT.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},dT.e.prototype.setTranformFeedbackVaryings=function(T,z){this._gl.transformFeedbackVaryings(T,z,this._gl.INTERLEAVED_ATTRIBS)},dT.e.prototype.bindTransformFeedbackBuffer=function(T){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,T?T.underlyingResource:null)},dT.e.prototype.readTransformFeedbackBuffer=function(T){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,T)};const NT="clipPlaneFragmentDeclaration2",lT="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";V.d.IncludesShadersStore[NT]=lT;X(11536),X(11398),X(11326),X(11544),X(11571),X(11574),X(11599),X(11603);const aT="gpuRenderParticlesPixelShader",qT="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";V.d.ShadersStore[aT]=qT;const VT="clipPlaneVertexDeclaration2",CT="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";V.d.IncludesShadersStore[VT]=CT;X(11375),X(11454),X(11457),X(11475);const GT="gpuRenderParticlesVertexShader",jT="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";V.d.ShadersStore[GT]=jT;class ZT extends E{static get IsSupported(){if(!J.e.LastCreatedEngine)return!1;const T=J.e.LastCreatedEngine.getCaps();return T.supportTransformFeedbacks||T.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(T){this._maxActiveParticleCount=Math.min(T,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(T){this.maxActiveParticleCount=T}createPointEmitter(T,z){const X=vT(T,z);return this.particleEmitterType=X,X}createHemisphericEmitter(){const T=kT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=T,T}createSphereEmitter(){const T=LT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=T,T}createDirectedSphereEmitter(){const T=DT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new b.j(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.j(0,1,0));return this.particleEmitterType=T,T}createCylinderEmitter(){const T=cT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=T,T}createDirectedCylinderEmitter(){const T=pT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b.j(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new b.j(0,1,0));return this.particleEmitterType=T,T}createConeEmitter(){const T=HT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=T,T}createDirectedConeEmitter(){const T=UT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.j(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b.j(0,1,0));return this.particleEmitterType=T,T}createBoxEmitter(T,z,X,b){const F=new L;return this.particleEmitterType=F,this.direction1=T,this.direction2=z,this.minEmitBox=X,this.maxEmitBox=b,F}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==sT.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(sT.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(sT.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";T?setTimeout((()=>{this.start(0)}),T):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var T;let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(T=this._customWrappers[z])||void 0===T?void 0:T.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[T]??this._customWrappers[0]}setCustomEffect(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[z]=new TT.b(this._engine),this._customWrappers[z].effect=T}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new Q.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(T,z,X){return super._removeGradientAndTexture(T,z,X),this._releaseBuffers(),this}addColorGradient(T,z){this._colorGradients||(this._colorGradients=[]);const X=new r(T,z);return this._colorGradients.push(X),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(T&&this._colorGradients.sort(((T,z)=>T.gradient<z.gradient?-1:T.gradient>z.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(T){return this._removeGradientAndTexture(T,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const z in this._drawWrappers){var T;null===(T=this._drawWrappers[z].drawContext)||void 0===T||T.reset()}}_addFactorGradient(T,z,X){const b=new f(z,X);T.push(b),this._releaseBuffers()}addSizeGradient(T,z){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,T,z),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(T){return this._removeGradientAndTexture(T,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(T,z){if(!T)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&T.sort(((T,z)=>T.gradient<z.gradient?-1:T.gradient>z.gradient?1:0));const X=this;X[z]&&(X[z].dispose(),X[z]=null)}addAngularSpeedGradient(T,z){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,T,z),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(T){return this._removeGradientAndTexture(T,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(T,z){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,T,z),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(T){return this._removeGradientAndTexture(T,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(T,z){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,T,z),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(T){return this._removeGradientAndTexture(T,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(T,z){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,T,z),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(T){return this._removeGradientAndTexture(T,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(T){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(T,z,X){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(T),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Qd=new Q.d,this.onStoppedObservable=new Q.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,X&&"Scene"!==X.getClassName()?(this._engine=X,this.defaultProjectionMatrix=b.d.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=X||J.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.pe.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,y.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,y.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,y.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,y.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new TT.b(this._engine)},this._customWrappers[0].effect=F,this._drawWrappers={0:new TT.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(z=z??{}).randomTextureSize||delete z.randomTextureSize;const u={qd:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...z},E=z;isFinite(E)&&(u.qd=E),this._capacity=u.qd,this._maxActiveParticleCount=u.qd,this._currentActiveCount=0,this._isAnimationSheetEnabled=A,this.particleEmitterType=new L;const v=Math.min(this._engine.getCaps().maxTextureSize,u.randomTextureSize);let k=[];for(let b=0;b<v;++b)k.push(Math.random()),k.push(Math.random()),k.push(Math.random()),k.push(Math.random());this._randomTexture=new w.c(new Float32Array(k),v,1,5,X,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,k=[];for(let b=0;b<v;++b)k.push(Math.random()),k.push(Math.random()),k.push(Math.random()),k.push(Math.random());this._randomTexture2=new w.c(new Float32Array(k),v,1,5,X,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=v}_reset(){this._releaseBuffers()}_createVertexBuffers(T,z,X){const b={};b.position=z.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let F=3;b.age=z.createVertexBuffer("age",F,1,this._attributesStrideSize,!0),F+=1,b.size=z.createVertexBuffer("size",F,3,this._attributesStrideSize,!0),F+=3,b.life=z.createVertexBuffer("life",F,1,this._attributesStrideSize,!0),F+=1,F+=4,this.billboardMode===sT.BILLBOARDMODE_STRETCHED&&(b.direction=z.createVertexBuffer("direction",F,3,this._attributesStrideSize,!0)),F+=3,this._platform.alignDataInBuffer&&(F+=1),this.particleEmitterType instanceof d&&(F+=3,this._platform.alignDataInBuffer&&(F+=1)),this._colorGradientsTexture||(b.color=z.createVertexBuffer("color",F,4,this._attributesStrideSize,!0),F+=4),this._isBillboardBased||(b.initialDirection=z.createVertexBuffer("initialDirection",F,3,this._attributesStrideSize,!0),F+=3,this._platform.alignDataInBuffer&&(F+=1)),this.noiseTexture&&(b.noiseCoordinates1=z.createVertexBuffer("noiseCoordinates1",F,3,this._attributesStrideSize,!0),F+=3,this._platform.alignDataInBuffer&&(F+=1),b.noiseCoordinates2=z.createVertexBuffer("noiseCoordinates2",F,3,this._attributesStrideSize,!0),F+=3,this._platform.alignDataInBuffer&&(F+=1)),b.angle=z.createVertexBuffer("angle",F,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?F++:F+=2,this._isAnimationSheetEnabled&&(b.cellIndex=z.createVertexBuffer("cellIndex",F,1,this._attributesStrideSize,!0),F+=1,this.spriteRandomStartCell&&(b.cellStartOffset=z.createVertexBuffer("cellStartOffset",F,1,this._attributesStrideSize,!0),F+=1)),b.offset=X.createVertexBuffer("offset",0,2),b.uv=X.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(b),this._platform.createVertexBuffers(T,b),this.resetDrawCache()}_initialize(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!T)return;const z=this._engine,X=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof d&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const F=this.particleEmitterType instanceof d,A=b.f.Id[0];let u=0;for(let b=0;b<this._capacity;b++)if(X.push(0),X.push(0),X.push(0),X.push(0),X.push(0),X.push(0),X.push(0),X.push(0),X.push(Math.random()),X.push(Math.random()),X.push(Math.random()),X.push(Math.random()),F?(this.particleEmitterType.particleDestinationGenerator(b,null,A),X.push(A.x),X.push(A.y),X.push(A.z)):(X.push(0),X.push(0),X.push(0)),this._platform.alignDataInBuffer&&X.push(0),u+=16,F&&(this.particleEmitterType.particlePositionGenerator(b,null,A),X.push(A.x),X.push(A.y),X.push(A.z),this._platform.alignDataInBuffer&&X.push(0),u+=4),this._colorGradientsTexture||(X.push(0),X.push(0),X.push(0),X.push(0),u+=4),this.isBillboardBased||(X.push(0),X.push(0),X.push(0),this._platform.alignDataInBuffer&&X.push(0),u+=4),this.noiseTexture&&(X.push(Math.random()),X.push(Math.random()),X.push(Math.random()),this._platform.alignDataInBuffer&&X.push(0),X.push(Math.random()),X.push(Math.random()),X.push(Math.random()),this._platform.alignDataInBuffer&&X.push(0),u+=8),X.push(0),u+=1,this._angularSpeedGradientsTexture||(X.push(0),u+=1),this._isAnimationSheetEnabled&&(X.push(0),u+=1,this.spriteRandomStartCell&&(X.push(0),u+=1)),this._platform.alignDataInBuffer){let T=3-(u+3&3);for(u+=T;T-- >0;)X.push(0)}const y=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),E=this._platform.createParticleBuffer(X),v=this._platform.createParticleBuffer(X);this._buffer0=new N.b(z,E,!1,this._attributesStrideSize),this._buffer1=new N.b(z,v,!1,this._attributesStrideSize),this._spriteBuffer=new N.b(z,y,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let T=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(T+="\n#define BILLBOARD"),this._colorGradientsTexture&&(T+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(T+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(T+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(T+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(T+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(T+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(T+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(T+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(T+="\n#define NOISE"),this.isLocal&&(T+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===T||(this._cachedUpdateDefines=T,this._updateBuffer=this._platform.createUpdateBuffer(T)),this._platform.isUpdateBufferReady()}_getWrapper(T){const z=this._getCustomDrawWrapper(T);if(null!==z&&void 0!==z&&z.effect)return z;const X=[];this.fillDefines(X,T);let b=this._drawWrappers[T];b||(b=new TT.b(this._engine),b.drawContext&&(b.drawContext.useInstancing=!0),this._drawWrappers[T]=b);const F=X.join("\n");if(b.defines!==F){const T=[],z=[],X=[];this.fillUniformsAttributesAndSamplerNames(z,T,X),b.setEffect(this._engine.createEffect("gpuRenderParticles",T,z,X,F),F)}return b}static _GetAttributeNamesOrOptions(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const F=[N.e.PositionKind,"age","life","size","angle"];return T||F.push(N.e.ColorKind),z&&F.push("cellIndex"),X||F.push("initialDirection"),b&&F.push("direction"),F.push("offset",N.e.UVKind),F}static _GetEffectCreationOptions(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const b=["emitterWM","yg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,zT.d)(b),T&&b.push("sheetInfos"),z&&b.push("logarithmicDepthConstant"),X&&(b.push("vFogInfos"),b.push("vFogColor")),b}fillDefines(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,zT.j)(this,this._scene,T),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==KT.e.FOGMODE_NONE&&T.push("#define FOG")),z===sT.BLENDMODE_MULTIPLY&&T.push("#define BLENDMULTIPLYMODE"),this.isLocal&&T.push("#define LOCAL"),this.useLogarithmicDepth&&T.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(T.push("#define BILLBOARD"),this.billboardMode){case sT.BILLBOARDMODE_Y:T.push("#define BILLBOARDY");break;case sT.BILLBOARDMODE_STRETCHED:T.push("#define BILLBOARDSTRETCHED");break;case sT.BILLBOARDMODE_ALL:T.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&T.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&T.push("#define ANIMATESHEET"),X&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),T.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(T,z,X){z.push(...ZT._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===sT.BILLBOARDMODE_STRETCHED)),T.push(...ZT._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),X.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(xT.c.PrepareUniforms(T,this._imageProcessingConfigurationDefines),xT.c.PrepareSamplers(X,this._imageProcessingConfigurationDefines))}animate(){var T;let z=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(z?this.preWarmStepOffset:(null===(T=this._scene)||void 0===T?void 0:T.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(T,z){const X=this[z];if(!T||!T.length||X)return;const b=new Float32Array(this._rawTextureWidth);for(let F=0;F<this._rawTextureWidth;F++){const z=F/this._rawTextureWidth;h.GetCurrentGradient(z,T,((T,z,X)=>{b[F]=(0,v.p)(T.factor1,z.factor1,X)}))}this[z]=w.c.CreateRTexture(b,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[z].name=z.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const T=new Uint8Array(4*this._rawTextureWidth),z=u.h.Xd[0];for(let X=0;X<this._rawTextureWidth;X++){const b=X/this._rawTextureWidth;h.GetCurrentGradient(b,this._colorGradients,((b,F,A)=>{u.d.LerpToRef(b.color1,F.color1,A,z),T[4*X]=255*z.r,T[4*X+1]=255*z.g,T[4*X+2]=255*z.b,T[4*X+3]=255*z.a}))}this._colorGradientsTexture=w.c.CreateRGBATexture(T,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(T,z){var X,F,A,u;const y=this._getWrapper(T),E=y.effect;this._engine.enableEffect(y);const v=(null===(X=this._scene)||void 0===X?void 0:X.getViewMatrix())||b.d.IdentityReadOnly;if(E.setMatrix("view",v),E.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),E.setTexture("diffuseSampler",this.particleTexture),E.setVector2("translationPivot",this.translationPivot),E.setVector3("yg",this.yg),this.isLocal&&E.setMatrix("emitterWM",z),this._colorGradientsTexture?E.setTexture("colorGradientSampler",this._colorGradientsTexture):E.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const T=this.particleTexture.getBaseSize();E.setFloat3("sheetInfos",this.spriteCellWidth/T.width,this.spriteCellHeight/T.height,T.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const T=this._scene.activeCamera;E.setVector3("eyePosition",T.globalPosition)}const k=E.defines;if(this._scene&&((0,zT.e)(E,this,this._scene),this.applyFog&&(0,XT.d)(this._scene,void 0,E)),k.indexOf("#define BILLBOARDMODE_ALL")>=0){const T=v.clone();T.invert(),E.setMatrix("invView",T)}switch(this.useLogarithmicDepth&&this._scene&&(0,XT.l)(k,E,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(E),T){case sT.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case sT.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case sT.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case sT.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,E,null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(E),null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(u=this._scene)&&void 0!==u&&u.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(T){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!T)if(this.k.position){T=this.k.getWorldMatrix()}else{const z=this.k;T=b.f.Matrix[0],b.d.TranslationToRef(z.x,z.y,z.z,T)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",T),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const z=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=z}render(){let T,z=arguments.length>0&&void 0!==arguments[0]&&arguments[0],X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!z&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let T=0;T<this.preWarmCycles;T++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const T=0|this._accumulatedCount;this._accumulatedCount-=T,this._currentActiveCount+=T}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){T=this.k.getWorldMatrix()}else{const z=this.k;T=b.f.Matrix[0],b.d.TranslationToRef(z.x,z.y,z.z,T)}const F=this._engine;this.updateInAnimate||this._update(T);let A=0;return z||X||(F.setState(!1),this.forceDepthWrite&&F.setDepthWrite(!0),A=this.blendMode===sT.BLENDMODE_MULTIPLYADD?this._render(sT.BLENDMODE_MULTIPLY,T)+this._render(sT.BLENDMODE_ADD,T):this._render(this.blendMode,T),this._engine.setAlphaMode(0)),A}rebuild(){const T=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(T,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,T()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let T=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const z in this._drawWrappers){this._drawWrappers[z].dispose()}if(this._drawWrappers={},this._scene){const T=this._scene.pe.indexOf(this);T>-1&&this._scene.pe.splice(T,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let z=0;z<this._renderVertexBuffers.length;++z){const T=this._renderVertexBuffers[z];for(const z in T)T[z].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),T&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),T&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Qd.notifyObservers(this),this.Qd.clear()}clone(T,z){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const b={...this._customWrappers};let F=null;const A=this._engine;if(A.createEffectForParticles&&null!=this.customShader){F=this.customShader;const T=F.shaderOptions.defines.length>0?F.shaderOptions.defines.join("\n"):"";b[0]=A.createEffectForParticles(F.shaderPath.fragmentElement,F.shaderOptions.uniforms,F.shaderOptions.samplers,T,void 0,void 0,void 0,this)}const u=this.serialize(X),y=ZT.Parse(u,this._scene||this._engine,this._rootUrl);return y.name=T,y.customShader=F,y._customWrappers=b,void 0===z&&(z=this.k),this.noiseTexture&&(y.noiseTexture=this.noiseTexture.clone()),y.k=z,y}serialize(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const z={};return sT._Serialize(z,this,T),z.activeParticleCount=this.activeParticleCount,z.randomTextureSize=this._randomTextureSize,z.customShader=this.customShader,z}static Parse(T,z,X){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4?arguments[4]:void 0;const A=T.name;let u,y;z instanceof ET.d?u=z:(y=z,u=y.getEngine());const E=new ZT(A,{qd:F||T.qd,randomTextureSize:T.randomTextureSize},z,null,T.isAnimationSheetEnabled);if(E._rootUrl=X,T.customShader&&u.createEffectForParticles){const z=T.customShader,X=z.shaderOptions.defines.length>0?z.shaderOptions.defines.join("\n"):"",b=u.createEffectForParticles(z.shaderPath.fragmentElement,z.shaderOptions.uniforms,z.shaderOptions.samplers,X,void 0,void 0,void 0,E);E.setCustomEffect(b,0),E.customShader=z}return T.id&&(E.id=T.id),T.activeParticleCount&&(E.activeParticleCount=T.activeParticleCount),sT._Parse(T,E,z,X),T.preventAutoStart&&(E.preventAutoStart=T.preventAutoStart),b||E.preventAutoStart||E.start(),E}}var mT=X(1166),ST=X(12078),nT=X(1150);class OT{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(T){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const z of this.systems)z.k=T;this._emitterNode=T}setEmitterAsSphere(T,z,X){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:T,renderingGroupId:z};const b=(0,ST.b)("emitterSphere",{diameter:T.diameter,segments:T.segments},X);b.renderingGroupId=z;const F=new nT.c("emitterSphereMaterial",X);F.emissiveColor=T.color,b.material=F;for(const A of this.systems)A.k=b;this._emitterNode=b}start(T){for(const z of this.systems)T&&(z.k=T),z.start()}dispose(){for(const T of this.systems)T.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const z={systems:[]};for(const X of this.systems)z.systems.push(X.serialize(T));return this._emitterNode&&(z.k=this._emitterCreationOptions),z}static Parse(T,z){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3?arguments[3]:void 0;const F=new OT,A=this.BaseAssetsUrl+"/textures/";z=z||J.e.LastCreatedScene;for(const u of T.systems)F.systems.push(X?ZT.Parse(u,z,A,!0,b):sT.Parse(u,z,A,!0,b));if(T.k){const X=T.k.options;if("Sphere"===T.k.kind)F.setEmitterAsSphere({diameter:X.diameter,segments:X.segments,color:u.b.xd(X.color)},T.k.renderingGroupId,z)}return F}}OT.BaseAssetsUrl="https://assets.babylonjs.com/particles";var PT=X(1032);class WT{static CreateDefault(T){let z,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,b=arguments.length>2?arguments[2]:void 0;return z=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new ZT("default system",{qd:X},b):new sT("default system",X,b),z.k=T,z.particleTexture=new P.c("https://assets.babylonjs.com/textures/flare.png",z.va()),z.createConeEmitter(.1,Math.PI/4),z.color1=new u.d(1,1,1,1),z.color2=new u.d(1,1,1,1),z.colorDead=new u.d(1,1,1,0),z.minSize=.1,z.maxSize=.1,z.minEmitPower=2,z.maxEmitPower=2,z.updateSpeed=1/60,z.emitRate=30,z}static CreateAsync(T,z){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3?arguments[3]:void 0;z||(z=J.e.LastCreatedScene);const F={};return z.addPendingData(F),new Promise(((A,u)=>{if(X&&!ZT.IsSupported)return z.removePendingData(F),u("Particle system with GPU is not supported.");mT.g.LoadFile(`${WT.BaseAssetsUrl}/systems/${T}.json`,(T=>{z.removePendingData(F);const u=JSON.parse(T.toString());return A(OT.Parse(u,z,X,b))}),void 0,void 0,void 0,(()=>(z.removePendingData(F),u(`An error occurred with the creation of your particle system. Check if your type '${T}' exists.`))))}))}static ExportSet(T){const z=new OT;for(const X of T)z.systems.push(X);return z}static ParseFromFileAsync(T,z,X){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3],F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",A=arguments.length>5?arguments[5]:void 0;return new Promise(((u,y)=>{const E=new PT.e;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){const z=JSON.parse(E.responseText);let y;y=b?ZT.Parse(z,X,F,!1,A):sT.Parse(z,X,F,!1,A),T&&(y.name=T),u(y)}else y("Unable to load the particle system")})),E.open("GET",z),E.send()}))}static ParseFromSnippetAsync(T,z){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",F=arguments.length>4?arguments[4]:void 0;if("_BLANK"===T){const T=this.CreateDefault(null);return T.start(),Promise.resolve(T)}return new Promise(((A,u)=>{const y=new PT.e;y.addEventListener("readystatechange",(()=>{if(4==y.readyState)if(200==y.status){const u=JSON.parse(JSON.parse(y.responseText).jsonPayload),E=JSON.parse(u.particleSystem);let v;v=X?ZT.Parse(E,z,b,!1,F):sT.Parse(E,z,b,!1,F),v.snippetId=T,A(v)}else u("Unable to load the snippet "+T)})),y.open("GET",this.SnippetUrl+"/"+T.replace(/#/g,"/")),y.send()}))}}WT.BaseAssetsUrl=OT.BaseAssetsUrl,WT.SnippetUrl="https://snippet.babylonjs.com",WT.CreateFromSnippetAsync=WT.ParseFromSnippetAsync;var BT=X(11933),eT=X(1221),RT=X(12084);(0,RT.f)(eT.b.NAME_PARTICLESYSTEM,((T,z,X,b)=>{const F=(0,RT.h)(eT.b.NAME_PARTICLESYSTEM);if(F&&void 0!==T.pe&&null!==T.pe)for(let A=0,u=T.pe.length;A<u;A++){const u=T.pe[A];X.pe.push(F(u,z,b))}})),(0,RT.b)(eT.b.NAME_PARTICLESYSTEM,((T,z,X)=>{if(T.activeParticleCount){return ZT.Parse(T,z,X)}return sT.Parse(T,z,X)})),ET.d.prototype.createEffectForParticles=function(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",A=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0,y=arguments.length>6?arguments[6]:void 0,E=arguments.length>7?arguments[7]:void 0,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,k=[],L=[];const D=[];return E?E.fillUniformsAttributesAndSamplerNames(L,k,D):(k=sT._GetAttributeNamesOrOptions(),L=sT._GetEffectCreationOptions()),-1===F.indexOf(" BILLBOARD")&&(F+="\n#define BILLBOARD\n"),null!==E&&void 0!==E&&E.isAnimationSheetEnabled&&-1===F.indexOf(" ANIMATESHEET")&&(F+="\n#define ANIMATESHEET\n"),-1===b.indexOf("diffuseSampler")&&b.push("diffuseSampler"),this.createEffect({vertex:(null===E||void 0===E?void 0:E.vertexShaderName)??"particles",fragmentElement:T},k,L.concat(z),D.concat(b),F,A,u,y,void 0,v,(async()=>{0===v?await Promise.resolve().then(X.bind(X,12103)):await Promise.resolve().then(X.bind(X,12113))}))},BT.e.prototype.getEmittedParticleSystems=function(){const T=[];for(let z=0;z<this.va().pe.length;z++){const X=this.va().pe[z];X.k===this&&T.push(X)}return T},BT.e.prototype.getHierarchyEmittedParticleSystems=function(){const T=[],z=this.getDescendants();z.push(this);for(let X=0;X<this.va().pe.length;X++){const b=this.va().pe[X],F=b.k;F.position&&-1!==z.indexOf(F)&&T.push(b)}return T};X(1282),X(1289),X(11970);X(11955),X(12092),X(1449),X(1274),X(11976);X(1442);var YT;X(12096),X(1021);!function(T){T[T.Color=2]="Color",T[T.UV=1]="UV",T[T.Random=0]="Random",T[T.Stated=3]="Stated"}(YT||(YT={}));X(12099),X(12103),X(12105),X(12113)},11256:(T,z,X)=>{"use strict";const b="clipPlaneFragment",F="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";X(1082).d.IncludesShadersStoreWGSL[b]=F},11238:(T,z,X)=>{"use strict";const b="clipPlaneFragmentDeclaration",F="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";X(1082).d.IncludesShadersStoreWGSL[b]=F},11170:(T,z,X)=>{"use strict";const b="clipPlaneVertex",F="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";X(1082).d.IncludesShadersStoreWGSL[b]=F},11094:(T,z,X)=>{"use strict";const b="clipPlaneVertexDeclaration",F="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";X(1082).d.IncludesShadersStoreWGSL[b]=F},11288:(T,z,X)=>{"use strict";const b="fogFragment",F="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";X(1082).d.IncludesShadersStoreWGSL[b]=F},11247:(T,z,X)=>{"use strict";const b="fogFragmentDeclaration",F="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";X(1082).d.IncludesShadersStoreWGSL[b]=F},11173:(T,z,X)=>{"use strict";const b="fogVertex",F="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";X(1082).d.IncludesShadersStoreWGSL[b]=F},11103:(T,z,X)=>{"use strict";const b="fogVertexDeclaration",F="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";X(1082).d.IncludesShadersStoreWGSL[b]=F},11050:(T,z,X)=>{"use strict";const b="helperFunctions",F="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";X(1082).d.IncludesShadersStoreWGSL[b]=F},11221:(T,z,X)=>{"use strict";const b="imageProcessingDeclaration",F="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";X(1082).d.IncludesShadersStoreWGSL[b]=F},11224:(T,z,X)=>{"use strict";const b="imageProcessingFunctions",F="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";X(1082).d.IncludesShadersStoreWGSL[b]=F},11127:(T,z,X)=>{"use strict";const b="logDepthDeclaration",F="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";X(1082).d.IncludesShadersStoreWGSL[b]=F},11284:(T,z,X)=>{"use strict";const b="logDepthFragment",F="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";X(1082).d.IncludesShadersStoreWGSL[b]=F},11183:(T,z,X)=>{"use strict";const b="logDepthVertex",F="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";X(1082).d.IncludesShadersStoreWGSL[b]=F},12105:(T,z,X)=>{"use strict";X.r(z),X.d(z,{particlesPixelShaderWGSL:()=>u});var b=X(1082);X(11238),X(11221),X(11127),X(11050),X(11224),X(11247),X(11256),X(11284),X(11288);const F="particlesPixelShader",A="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";b.d.ShadersStoreWGSL[F]=A;const u={name:F,shader:A}},12113:(T,z,X)=>{"use strict";X.r(z),X.d(z,{particlesVertexShaderWGSL:()=>u});var b=X(1082);X(11094),X(11103),X(11127),X(11170),X(11173),X(11183);const F="particlesVertexShader",A="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";b.d.ShadersStoreWGSL[F]=A;const u={name:F,shader:A}},11574:(T,z,X)=>{"use strict";const b="clipPlaneFragment",F="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";X(1082).d.IncludesShadersStore[b]=F},11563:(T,z,X)=>{"use strict";const b="clipPlaneFragmentDeclaration",F="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";X(1082).d.IncludesShadersStore[b]=F},11454:(T,z,X)=>{"use strict";const b="clipPlaneVertex",F="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";X(1082).d.IncludesShadersStore[b]=F},11372:(T,z,X)=>{"use strict";const b="clipPlaneVertexDeclaration",F="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";X(1082).d.IncludesShadersStore[b]=F},11603:(T,z,X)=>{"use strict";const b="fogFragment",F="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";X(1082).d.IncludesShadersStore[b]=F},11571:(T,z,X)=>{"use strict";const b="fogFragmentDeclaration",F="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";X(1082).d.IncludesShadersStore[b]=F},11457:(T,z,X)=>{"use strict";const b="fogVertex",F="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";X(1082).d.IncludesShadersStore[b]=F},11375:(T,z,X)=>{"use strict";const b="fogVertexDeclaration",F="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";X(1082).d.IncludesShadersStore[b]=F},11326:(T,z,X)=>{"use strict";const b="helperFunctions",F="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";X(1082).d.IncludesShadersStore[b]=F},11536:(T,z,X)=>{"use strict";const b="imageProcessingDeclaration",F="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";X(1082).d.IncludesShadersStore[b]=F},11544:(T,z,X)=>{"use strict";const b="imageProcessingFunctions",F="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";X(1082).d.IncludesShadersStore[b]=F},11398:(T,z,X)=>{"use strict";const b="logDepthDeclaration",F="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";X(1082).d.IncludesShadersStore[b]=F},11599:(T,z,X)=>{"use strict";const b="logDepthFragment",F="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";X(1082).d.IncludesShadersStore[b]=F},11475:(T,z,X)=>{"use strict";const b="logDepthVertex",F="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";X(1082).d.IncludesShadersStore[b]=F},12099:(T,z,X)=>{"use strict";X.r(z),X.d(z,{particlesPixelShader:()=>u});var b=X(1082);X(11563),X(11536),X(11398),X(11326),X(11544),X(11571),X(11574),X(11599),X(11603);const F="particlesPixelShader",A="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";b.d.ShadersStore[F]=A;const u={name:F,shader:A}},12103:(T,z,X)=>{"use strict";X.r(z),X.d(z,{particlesVertexShader:()=>u});var b=X(1082);X(11372),X(11375),X(11398),X(11454),X(11457),X(11475);const F="particlesVertexShader",A="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";b.d.ShadersStore[F]=A;const u={name:F,shader:A}},11948:(T,z,X)=>{"use strict";X.d(z,{b:()=>L});var b=X(952),F=X(976),A=X(957),u=X(968),y=X(1007),E=X(1061),v=X(1122);class k{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new u.d,this._onClonedObservable=new u.d}}class L{static AddNodeConstructor(T,z){this._NodeConstructors[T]=z}static Construct(T,z,X,b){const F=this._NodeConstructors[T];return F?F(z,X,b):null}set accessibilityTag(T){this._accessibilityTag=T,this.onAccessibilityTagChangedObservable.notifyObservers(T)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(T){this._nodeDataStorage._doNotSerialize=T}u(){return this._nodeDataStorage._isDisposed}set parent(T){if(this._parentNode===T)return;const z=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const z=this._parentNode._children.indexOf(this);-1!==z&&this._parentNode._children.splice(z,1),T||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=T,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),z||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(T){T.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const T=this._scene.rootNodes,z=T.length-1;T[this._nodeDataStorage._sceneRootNodesIndex]=T[z],T[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(T){this._animationPropertiesOverride=T}getClassName(){return"Node"}set onDispose(T){this._onDisposeObserver&&this.Qd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Qd.add(T)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new k,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new u.d,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=F.d.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.Qd=new u.d,this._onDisposeObserver=null,this._behaviors=new Array,this.name=T,this.id=T,this._scene=z||y.e.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),X&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(T)||(T.init(),this._scene.isLoading&&!z?this._scene.onDataLoadedObservable.addOnce((()=>{T.attach(this)})):T.attach(this),this._behaviors.push(T)),this}removeBehavior(T){const z=this._behaviors.indexOf(T);return-1===z||(this._behaviors[z].detach(),this._behaviors.splice(z,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(T){for(const z of this._behaviors)if(z.name===T)return z;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.ze(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(T){!T&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(T){return this.parent?this.parent._getActionManagerForTrigger(T,!1):null}_updateCache(T){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}Fe(T){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((T=>{T._syncParentEnabledState()}))}Hg(T){this._nodeDataStorage._isEnabled!==T&&(this._nodeDataStorage._isEnabled=T,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(T))}isDescendantOf(T){return!!this.parent&&(this.parent===T||this.parent.isDescendantOf(T))}_getDescendants(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2?arguments[2]:void 0;if(this._children)for(let b=0;b<this._children.length;b++){const F=this._children[b];X&&!X(F)||T.push(F),z||F._getDescendants(T,!1,X)}}getDescendants(T,z){const X=[];return this._getDescendants(X,T,z),X}getChildMeshes(T,z){const X=[];return this._getDescendants(X,T,(T=>(!z||z(T))&&void 0!==T.Pe)),X}getChildren(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(z,T)}_setReady(T){T!==this._nodeDataStorage._isReady&&(T?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(T){for(let z=0;z<this.animations.length;z++){const X=this.animations[z];if(X.name===T)return X}return null}createAnimationRange(T,z,X){if(!this._ranges[T]){this._ranges[T]=L._AnimationRangeFactory(T,z,X);for(let b=0,F=this.animations.length;b<F;b++)this.animations[b]&&this.animations[b].createRange(T,z,X)}}deleteAnimationRange(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let X=0,b=this.animations.length;X<b;X++)this.animations[X]&&this.animations[X].deleteRange(T,z);this._ranges[T]=null}getAnimationRange(T){return this._ranges[T]||null}clone(T,z,X){const b=v.b.Clone((()=>new L(T,this.va())),this);if(z&&(b.parent=z),!X){const z=this.getDescendants(!0);for(let X=0;X<z.length;X++){const F=z[X];F.clone(T+"."+F.name,b)}}return b}getAnimationRanges(){const T=[];let z;for(z in this._ranges)T.push(this._ranges[z]);return T}beginAnimation(T,z,X,b){const F=this.getAnimationRange(T);return F?this._scene.beginAnimation(this,F.from,F.to,z,X,b):null}serializeAnimationRanges(){const T=[];for(const z in this._ranges){const X=this._ranges[z];if(!X)continue;const b={};b.name=z,b.from=X.from,b.to=X.to,T.push(b)}return T}ze(T){return this._worldMatrix||(this._worldMatrix=F.d.Identity()),this._worldMatrix}dispose(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!T){const X=this.getDescendants(!0);for(const b of X)b.dispose(T,z)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.Qd.notifyObservers(this),this.Qd.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const X of this._behaviors)X.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(T,z,X){if(z.ranges)for(let b=0;b<z.ranges.length;b++){const X=z.ranges[b];T.createAnimationRange(X.name,X.from,X.to)}}getHierarchyBoundingVectors(){let T,z,X=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.ze(!0);const A=this;if(A.getBoundingInfo&&A.ue){const X=A.getBoundingInfo();T=X.boundingBox.minimumWorld.clone(),z=X.boundingBox.maximumWorld.clone()}else T=new F.j(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),z=new F.j(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(X){const X=this.getDescendants(!1);for(const A of X){const X=A;if(X.ze(!0),b&&!b(X))continue;if(!X.getBoundingInfo||0===X.getTotalVertices())continue;const u=X.getBoundingInfo().boundingBox,y=u.minimumWorld,E=u.maximumWorld;F.j.CheckExtends(y,T,z),F.j.CheckExtends(E,T,z)}}return{min:T,max:z}}}L._AnimationRangeFactory=(T,z,X)=>{throw(0,E.d)("AnimationRange")},L._NodeConstructors={},(0,b.c)([(0,A.E)()],L.prototype,"name",void 0),(0,b.c)([(0,A.E)()],L.prototype,"id",void 0),(0,b.c)([(0,A.E)()],L.prototype,"uniqueId",void 0),(0,b.c)([(0,A.E)()],L.prototype,"state",void 0),(0,b.c)([(0,A.E)()],L.prototype,"metadata",void 0)},12478:(T,z,X)=>{"use strict";class b{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((T,z)=>{this._resolve=T,this._reject=z}))}}var F=X(976),A=X(1132),u=X(1166),y=X(11944),E=X(12482),v=X(12491),k=X(968),L=X(12071),D=X(12493),c=X(12496),p=X(1007),H=X(1065),U=X(1168);class s{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(T){this._useTextureToStoreBoneMatrices=T,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(T){this._animationPropertiesOverride=T}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(T,z,X){this.name=T,this.id=z,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=F.d.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new k.d,this.bones=[],this._scene=X||p.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const b=this._scene.getEngine().getCaps();this._canUseTextureForBones=b.textureFloat&&b.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((T=>!T.getParent()))}getTransformMatrices(T){if(this.needInitialSkinMatrix){if(!T)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return T._bonesTransformMatrices||this.prepare(!0),T._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(T){return this.needInitialSkinMatrix&&T._transformMatrixTexture?T._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(T){let z=`Name: ${this.name}, nBones: ${this.bones.length}`;if(z+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,T){z+=", Ranges: {";let T=!0;for(const X in this._ranges)T&&(z+=", ",T=!1),z+=X;z+="}"}return z}getBoneIndexByName(T){for(let z=0,X=this.bones.length;z<X;z++)if(this.bones[z].name===T)return z;return-1}createAnimationRange(T,z,X){if(!this._ranges[T]){this._ranges[T]=new c.c(T,z,X);for(let b=0,F=this.bones.length;b<F;b++)this.bones[b].animations[0]&&this.bones[b].animations[0].createRange(T,z,X)}}deleteAnimationRange(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let X=0,b=this.bones.length;X<b;X++)this.bones[X].animations[0]&&this.bones[X].animations[0].deleteRange(T,z);this._ranges[T]=null}getAnimationRange(T){return this._ranges[T]||null}getAnimationRanges(){const T=[];let z;for(z in this._ranges)T.push(this._ranges[z]);return T}copyAnimationRange(T,z){let X=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[z]||!T.getAnimationRange(z))return!1;let b=!0;const F=this._getHighestAnimationFrame()+1,A={},u=T.bones;let y,E;for(E=0,y=u.length;E<y;E++)A[u[E].name]=u[E];this.bones.length!==u.length&&(H.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${u.length}`),b=!1);const v=X&&this.dimensionsAtRest&&T.dimensionsAtRest?this.dimensionsAtRest.divide(T.dimensionsAtRest):null;for(E=0,y=this.bones.length;E<y;E++){const T=this.bones[E].name,u=A[T];u?b=b&&this.bones[E].copyAnimationRange(u,z,F,X,v):(H.e.Warn("copyAnimationRange: not same rig, missing source bone "+T),b=!1)}const k=T.getAnimationRange(z);return k&&(this._ranges[z]=new c.c(z,k.from+F,k.to+F)),b}returnToRest(){for(const T of this.bones)-1!==T._index&&T.returnToRest()}_getHighestAnimationFrame(){let T=0;for(let z=0,X=this.bones.length;z<X;z++)if(this.bones[z].animations[0]){const X=this.bones[z].animations[0].getHighestFrame();T<X&&(T=X)}return T}beginAnimation(T,z,X,b){const F=this.getAnimationRange(T);return F?this._scene.beginAnimation(this,F.from,F.to,z,X,b):null}static MakeAnimationAdditive(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2?arguments[2]:void 0;const b=T.getAnimationRange(X);if(!b)return null;const F=T._scene.getAllAnimatablesByTarget(T);let A=null;for(let y=0;y<F.length;y++){const T=F[y];if(T.fromFrame===(null===b||void 0===b?void 0:b.from)&&T.toFrame===(null===b||void 0===b?void 0:b.to)){A=T;break}}const u=T.getAnimatables();for(let y=0;y<u.length;y++){const T=u[y].animations;if(T)for(let b=0;b<T.length;b++)D.e.MakeAnimationAdditive(T[b],z,X)}return A&&(A.isAdditive=!0),T}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(T){this._meshesWithPoseMatrix.push(T)}_unregisterMeshWithPoseMatrix(T){const z=this._meshesWithPoseMatrix.indexOf(T);z>-1&&this._meshesWithPoseMatrix.splice(z,1)}_computeTransformMatrices(T,z){this.onBeforeComputeObservable.notifyObservers(this);for(let X=0;X<this.bones.length;X++){const b=this.bones[X];b._childUpdateId++;const F=b.getParent();if(F?b.getLocalMatrix().multiplyToRef(F.getFinalMatrix(),b.getFinalMatrix()):z?b.getLocalMatrix().multiplyToRef(z,b.getFinalMatrix()):b.getFinalMatrix().p(b.getLocalMatrix()),-1!==b._index){const z=null===b._index?X:b._index;b.getAbsoluteInverseBindMatrix().multiplyToArray(b.getFinalMatrix(),T,16*z)}}this._identity.copyToArray(T,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const T=this.va().getRenderId();if(this._currentRenderId===T)return;this._currentRenderId=T}if(this._numBonesWithLinkedTransformNode>0)for(const T of this.bones)if(T._linkedTransformNode){const z=T._linkedTransformNode;T.position=z.position,z.rotationQuaternion?T.rotationQuaternion=z.rotationQuaternion:T.rotation=z.rotation,T.Pd=z.Pd}if(this.needInitialSkinMatrix)for(const T of this._meshesWithPoseMatrix){const z=T.getPoseMatrix();let X=this._isDirty;if(T._bonesTransformMatrices&&T._bonesTransformMatrices.length===16*(this.bones.length+1)||(T._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),X=!0),X){if(this._synchronizedWithMesh!==T){this._synchronizedWithMesh=T;for(const T of this.bones)if(!T.getParent()){T.getBindMatrix().multiplyToRef(z,F.f.Matrix[1]),T._updateAbsoluteBindMatrices(F.f.Matrix[1])}if(this.isUsingTextureForMatrices){const z=4*(this.bones.length+1);T._transformMatrixTexture&&T._transformMatrixTexture.getSize().width===z||(T._transformMatrixTexture&&T._transformMatrixTexture.dispose(),T._transformMatrixTexture=L.c.CreateRGBATexture(T._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(T._bonesTransformMatrices,z),this.isUsingTextureForMatrices&&T._transformMatrixTexture&&T._transformMatrixTexture.update(T._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=L.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let T=0;T<this.bones.length;T++)this._animatables.push(this.bones[T])}return this._animatables}clone(T,z){const X=new s(T,z||T,this._scene);X.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let b=0;b<this.bones.length;b++){const T=this.bones[b];let z=null;const F=T.getParent();if(F){const T=this.bones.indexOf(F);z=X.bones[T]}const A=new v.d(T.name,X,z,T.getBindMatrix().clone(),T.getRestMatrix().clone());A._index=T._index,T._linkedTransformNode&&A.linkTransformNode(T._linkedTransformNode),U.c.DeepCopy(T.animations,A.animations)}if(this._ranges){X._ranges={};for(const T in this._ranges){const z=this._ranges[T];z&&(X._ranges[T]=z.clone())}}return this._isDirty=!0,X.prepare(!0),X}enableBlending(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((z=>{z.animations.forEach((z=>{z.enableBlending=!0,z.blendingSpeed=T}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const T=this._parentContainer.skeletons.indexOf(this);T>-1&&this._parentContainer.skeletons.splice(T,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const T={};T.name=this.name,T.id=this.id,this.dimensionsAtRest&&(T.dimensionsAtRest=this.dimensionsAtRest.zd()),T.bones=[],T.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let X=0;X<this.bones.length;X++){var z;const b=this.bones[X],F=b.getParent(),A={parentBoneIndex:F?this.bones.indexOf(F):-1,index:b.getIndex(),name:b.name,id:b.id,matrix:b.getBindMatrix().zd(),rest:b.getRestMatrix().zd(),linkedTransformNodeId:null===(z=b.getTransformNode())||void 0===z?void 0:z.id};T.bones.push(A),b.length&&(A.length=b.length),b.metadata&&(A.metadata=b.metadata),b.animations&&b.animations.length>0&&(A.animation=b.animations[0].serialize()),T.ranges=[];for(const z in this._ranges){const X=this._ranges[z];if(!X)continue;const b={};b.name=z,b.from=X.from,b.to=X.to,T.ranges.push(b)}}return T}static Parse(T,z){const X=new s(T.name,T.id,z);let b;for(T.dimensionsAtRest&&(X.dimensionsAtRest=F.j.xd(T.dimensionsAtRest)),X.needInitialSkinMatrix=T.needInitialSkinMatrix,b=0;b<T.bones.length;b++){const z=T.bones[b],A=T.bones[b].index;let u=null;z.parentBoneIndex>-1&&(u=X.bones[z.parentBoneIndex]);const y=z.rest?F.d.xd(z.rest):null,E=new v.d(z.name,X,u,F.d.xd(z.matrix),y,null,A);void 0!==z.id&&null!==z.id&&(E.id=z.id),z.length&&(E.length=z.length),z.metadata&&(E.metadata=z.metadata),z.animation&&E.animations.push(D.e.Parse(z.animation)),void 0!==z.linkedTransformNodeId&&null!==z.linkedTransformNodeId&&(X._hasWaitingData=!0,E._waitingTransformNodeId=z.linkedTransformNodeId)}if(T.ranges)for(b=0;b<T.ranges.length;b++){const z=T.ranges[b];X.createAnimationRange(z.name,z.from,z.to)}return X}computeAbsoluteMatrices(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||T)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let T=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(T)}getPoseMatrix(){let T=null;return this._meshesWithPoseMatrix.length>0&&(T=this._meshesWithPoseMatrix[0].getPoseMatrix()),T}sortBones(){const T=[],z=new Array(this.bones.length);for(let X=0;X<this.bones.length;X++)this._sortBones(X,T,z);this.bones=T}_sortBones(T,z,X){if(X[T])return;X[T]=!0;const b=this.bones[T];if(!b)return;void 0===b._index&&(b._index=T);const F=b.getParent();F&&this._sortBones(this.bones.indexOf(F),z,X),z.push(b)}setCurrentPoseAsRest(){this.bones.forEach((T=>{T.setCurrentPoseAsRest()}))}}var x=X(1271),K=X(952),d=X(957),N=X(12499),l=X(12505),a=X(993),q=X(1122);class V extends l.b{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(T){this.subSurface.refractionTexture=T,T?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(T){this.subSurface.indexOfRefraction=T}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(T){this.subSurface.invertRefractionY=T}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(T){this.subSurface.linkRefractionWithTransparency=T,T&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===l.b.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(T){T!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=T?l.b.LIGHTFALLOFF_PHYSICAL:l.b.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===l.b.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(T){T!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=T?l.b.LIGHTFALLOFF_GLTF:l.b.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(T){this._attachImageProcessingConfiguration(T),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(T){this.imageProcessingConfiguration.colorCurvesEnabled=T}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(T){this.imageProcessingConfiguration.colorGradingEnabled=T}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(T){this._imageProcessingConfiguration.toneMappingEnabled=T}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(T){this._imageProcessingConfiguration.exposure=T}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(T){this._imageProcessingConfiguration.contrast=T}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(T){this._imageProcessingConfiguration.colorGradingTexture=T}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(T){this._imageProcessingConfiguration.colorCurves=T}constructor(T,z){super(T,z,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=V.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=A.b.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new A.b(0,0,0),this.albedoColor=new A.b(1,1,1),this.reflectivityColor=new A.b(1,1,1),this.reflectionColor=new A.b(1,1,1),this.emissiveColor=new A.b(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,N.d)(this.va())}getClassName(){return"PBRMaterial"}clone(T){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const b=q.b.Clone((()=>new V(T,this.va())),this,{cloneTexturesOnlyOnce:z});return b.id=T,b.name=T,this.stencil.copyTo(b.stencil),this._clonePlugins(b,X),b}serialize(){const T=super.serialize();return T.customType="BABYLON.PBRMaterial",T}static Parse(T,z,X){const b=q.b.Parse((()=>new V(T.name,z)),T,z,X);return T.stencil&&b.stencil.parse(T.stencil,z,X),x.d._ParsePlugins(T,b,z,X),T.clearCoat&&b.clearCoat.parse(T.clearCoat,z,X),T.anisotropy&&b.anisotropy.parse(T.anisotropy,z,X),T.brdf&&b.brdf.parse(T.brdf,z,X),T.sheen&&b.sheen.parse(T.sheen,z,X),T.subSurface&&b.subSurface.parse(T.subSurface,z,X),T.iridescence&&b.iridescence.parse(T.iridescence,z,X),b}}V.PBRMATERIAL_OPAQUE=l.b.PBRMATERIAL_OPAQUE,V.PBRMATERIAL_ALPHATEST=l.b.PBRMATERIAL_ALPHATEST,V.PBRMATERIAL_ALPHABLEND=l.b.PBRMATERIAL_ALPHABLEND,V.PBRMATERIAL_ALPHATESTANDBLEND=l.b.PBRMATERIAL_ALPHATESTANDBLEND,V.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=l.b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"directIntensity",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"emissiveIntensity",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"environmentIntensity",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"specularIntensity",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"disableBumpMap",void 0),(0,K.c)([(0,d.x)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"albedoTexture",void 0),(0,K.c)([(0,d.x)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"ambientTexture",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"ambientTextureStrength",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,K.c)([(0,d.x)(),(0,d.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],V.prototype,"opacityTexture",void 0),(0,K.c)([(0,d.x)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"reflectionTexture",void 0),(0,K.c)([(0,d.x)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"emissiveTexture",void 0),(0,K.c)([(0,d.x)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"reflectivityTexture",void 0),(0,K.c)([(0,d.x)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"metallicTexture",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"metallic",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"roughness",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"metallicF0Factor",void 0),(0,K.c)([(0,d.k)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"metallicReflectanceColor",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,K.c)([(0,d.x)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"metallicReflectanceTexture",void 0),(0,K.c)([(0,d.x)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"reflectanceTexture",void 0),(0,K.c)([(0,d.x)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"microSurfaceTexture",void 0),(0,K.c)([(0,d.x)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"bumpTexture",void 0),(0,K.c)([(0,d.x)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty",null)],V.prototype,"lightmapTexture",void 0),(0,K.c)([(0,d.k)("ambient"),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"ambientColor",void 0),(0,K.c)([(0,d.k)("albedo"),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"albedoColor",void 0),(0,K.c)([(0,d.k)("reflectivity"),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"reflectivityColor",void 0),(0,K.c)([(0,d.k)("reflection"),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"reflectionColor",void 0),(0,K.c)([(0,d.k)("emissive"),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"emissiveColor",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"microSurface",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useLightmapAsShadowmap",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],V.prototype,"useAlphaFromAlbedoTexture",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],V.prototype,"forceAlphaTest",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],V.prototype,"alphaCutOff",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useSpecularOverAlpha",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useAmbientInGrayScale",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,K.c)([(0,d.E)()],V.prototype,"usePhysicalLightFalloff",null),(0,K.c)([(0,d.E)()],V.prototype,"useGLTFLightFalloff",null),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useRadianceOverAlpha",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useObjectSpaceNormalMap",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useParallax",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useParallaxOcclusion",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"parallaxScaleBias",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsLightsDirty")],V.prototype,"disableLighting",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"forceIrradianceInFragment",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsLightsDirty")],V.prototype,"maxSimultaneousLights",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"invertNormalMapX",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"invertNormalMapY",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"twoSidedLighting",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useAlphaFresnel",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useLinearAlphaFresnel",void 0),(0,K.c)([(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"environmentBRDFTexture",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"forceNormalForward",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"enableSpecularAntiAliasing",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useHorizonOcclusion",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"useRadianceOcclusion",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsMiscDirty")],V.prototype,"unlit",void 0),(0,K.c)([(0,d.E)(),(0,d.b)("_markAllSubMeshesAsMiscDirty")],V.prototype,"applyDecalMapAfterDetailMap",void 0),(0,a.h)("BABYLON.PBRMaterial",V);var C=X(949),G=X(11973),j=X(1207),Z=X(11964),m=X(11970),S=X(11933);class n{get influence(){return this._influence}set influence(T){if(this._influence===T)return;const z=this._influence;this._influence=T,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===z||0===T)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(T){this._animationPropertiesOverride=T}constructor(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=T,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new k.d,this._onDataLayoutChanged=new k.d,this._animationPropertiesOverride=null,this.id=T,this._scene=X||p.e.LastCreatedScene,this.influence=z,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(T){const z=this.hasPositions;this._positions=T,z!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(T){const z=this.hasNormals;this._normals=T,z!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(T){const z=this.hasTangents;this._tangents=T,z!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(T){const z=this.hasUVs;this._uvs=T,z!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const T=q.b.Clone((()=>new n(this.name,this.influence,this._scene)),this);return T._positions=this._positions,T._normals=this._normals,T._tangents=this._tangents,T._uvs=this._uvs,T}serialize(){const T={};return T.name=this.name,T.influence=this.influence,T.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(T.id=this.id),this.hasNormals&&(T.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(T.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(T.Aa=Array.prototype.slice.call(this.getUVs())),q.b.AppendSerializedAnimations(this,T),T}getClassName(){return"MorphTarget"}static Parse(T,z){const X=new n(T.name,T.influence);if(X.setPositions(T.xa),null!=T.id&&(X.id=T.id),T.ya&&X.setNormals(T.ya),T.tangents&&X.setTangents(T.tangents),T.Aa&&X.setUVs(T.Aa),T.animations){for(let z=0;z<T.animations.length;z++){const b=T.animations[z],F=(0,a.e)("BABYLON.Animation");F&&X.animations.push(F.Parse(b))}T.autoAnimate&&z&&z.beginAnimation(X,T.autoAnimateFrom,T.autoAnimateTo,T.autoAnimateLoop,T.autoAnimateSpeed||1)}return X}static FromMesh(T,z,X){z||(z=T.name);const b=new n(z,X,T.va());return b.setPositions(T.getVerticesData(j.e.PositionKind)),T.isVerticesDataPresent(j.e.NormalKind)&&b.setNormals(T.getVerticesData(j.e.NormalKind)),T.isVerticesDataPresent(j.e.TangentKind)&&b.setTangents(T.getVerticesData(j.e.TangentKind)),T.isVerticesDataPresent(j.e.UVKind)&&b.setUVs(T.getVerticesData(j.e.UVKind)),b}}(0,K.c)([(0,d.E)()],n.prototype,"id",void 0);var O=X(1154),P=X(1517);class W{set areUpdatesFrozen(T){T?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new O.h(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,T||(T=p.e.LastCreatedScene),this._scene=T,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const T=this._scene.getEngine().getCaps();this._canUseTextureForTargets=T.canUseGLVertexID&&T.textureFloat&&T.maxVertexTextureImageUnits>0&&T.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(T){this._numMaxInfluencers!==T&&(this._numMaxInfluencers=T,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(T){this._useTextureToStoreTargets=T}get isUsingTextureForTargets(){var T;return W.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(T=this._scene)&&void 0!==T&&T.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(T){return this._activeTargets.data[T]}getTarget(T){return this._targets[T]}getTargetByName(T){for(const z of this._targets)if(z.name===T)return z;return null}addTarget(T){this._targets.push(T),this._targetInfluenceChangedObservers.push(T.onInfluenceChanged.add((T=>{this._syncActiveTargets(T)}))),this._targetDataLayoutChangedObservers.push(T._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(T){const z=this._targets.indexOf(T);z>=0&&(this._targets.splice(z,1),T.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(z,1)[0]),T._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(z,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(T)}_bind(T){T.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),T.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),T.setTexture("morphTargets",this._targetStoreTexture),T.setInt("morphTargetCount",this.numInfluencers)}clone(){const T=new W(this._scene);for(const z of this._targets)T.addTarget(z.clone());return T.enableNormalMorphing=this.enableNormalMorphing,T.enableTangentMorphing=this.enableTangentMorphing,T.enableUVMorphing=this.enableUVMorphing,T}serialize(){const T={};T.id=this.uniqueId,T.targets=[];for(const z of this._targets)T.targets.push(z.serialize());return T}_syncActiveTargets(T){if(this.areUpdatesFrozen)return;let z=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let X=-1;for(const b of this._targets){if(X++,0===b.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=W.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(b),this._morphTargetTextureIndices[z]=X,this._tempInfluences[z++]=b.influence,this._supportsNormals=this._supportsNormals&&b.hasNormals,this._supportsTangents=this._supportsTangents&&b.hasTangents,this._supportsUVs=this._supportsUVs&&b.hasUVs;const T=b.getPositions();if(T){const z=T.length/3;if(0===this._vertexCount)this._vertexCount=z;else if(this._vertexCount!==z)return void H.e.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==z&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,z)),this._influences&&this._influences.length===z||(this._influences=new Float32Array(z));for(let b=0;b<z;b++)this._influences[b]=this._tempInfluences[b];T&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const T=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>T&&(this._textureHeight=Math.ceil(this._textureWidth/T),this._textureWidth=T);let z=!0;if(this._targetStoreTexture){const T=this._targetStoreTexture.getSize();T.width===this._textureWidth&&T.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(z=!1)}if(z){this._targetStoreTexture&&this._targetStoreTexture.dispose();const T=this._targets.length,z=new Float32Array(T*this._textureWidth*this._textureHeight*4);let X=0;for(let b=0;b<T;b++){const T=this._targets[b],F=T.getPositions(),A=T.getNormals(),u=T.getUVs(),y=T.getTangents();if(!F)return void(0===b&&H.e.Error("Invalid morph target. Target must have positions."));X=b*this._textureWidth*this._textureHeight*4;for(let b=0;b<this._vertexCount;b++)z[X]=F[3*b],z[X+1]=F[3*b+1],z[X+2]=F[3*b+2],X+=4,this._supportsNormals&&A&&(z[X]=A[3*b],z[X+1]=A[3*b+1],z[X+2]=A[3*b+2],X+=4),this._supportsUVs&&u&&(z[X]=u[2*b],z[X+1]=u[2*b+1],X+=4),this._supportsTangents&&y&&(z[X]=y[3*b],z[X+1]=y[3*b+1],z[X+2]=y[3*b+2],X+=4)}this._targetStoreTexture=P.d.CreateRGBATexture(z,this._textureWidth,this._textureHeight,T,this._scene,!1,!1,1,1)}}for(const T of this._scene.meshes)T.morphTargetManager===this&&T._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const T=this._parentContainer.morphTargetManagers.indexOf(this);T>-1&&this._parentContainer.morphTargetManagers.splice(T,1),this._parentContainer=null}for(const T of this._targets)this._scene.stopAnimation(T)}}static Parse(T,z){const X=new W(z);for(const b of T.targets)X.addTarget(n.Parse(b,z));return X}}W.EnableTextureStorage=!0,W.MaxActiveMorphTargetsInVertexAttributeMode=8;var B=X(12508),e=X(1030),R=X(1282);function Y(T,z,X,b){return F.j.xd(z,X).scaleInPlace(b)}class i{constructor(T,z,X,b){this.type=T,this.name=z,this.getValue=X,this.getStride=b}_buildAnimation(T,z,X){const b=new D.e(T,this.name,z,this.type);return b.setKeys(X),b}}class t extends i{buildAnimations(T,z,X,b,F){F(T._babylonTransformNode,this._buildAnimation(z,X,b))}}const g={translation:[new t(D.e.ANIMATIONTYPE_VECTOR3,"position",Y,(()=>3))],rotation:[new t(D.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(T,z,X,b){return F.e.xd(z,X).scaleInPlace(b)}),(()=>4))],scale:[new t(D.e.ANIMATIONTYPE_VECTOR3,"Pd",Y,(()=>3))],weights:[new class extends i{buildAnimations(T,z,X,b,F){if(T._numMorphTargets)for(let A=0;A<T._numMorphTargets;A++){const u=new D.e(`${z}_${A}`,this.name,X,this.type);if(u.setKeys(b.map((T=>({frame:T.frame,inTangent:T.inTangent?T.inTangent[A]:void 0,value:T.value[A],outTangent:T.outTangent?T.outTangent[A]:void 0,interpolation:T.interpolation})))),T._primitiveBabylonMeshes)for(const z of T._primitiveBabylonMeshes)if(z.morphTargetManager){const T=z.morphTargetManager.getTarget(A),X=u.clone();T.animations.push(X),F(T,X)}}}}(D.e.ANIMATIONTYPE_FLOAT,"influence",(function(T,z,X,b){const F=new Array(T._numMorphTargets);for(let A=0;A<F.length;A++)F[A]=z[X++]*b;return F}),(T=>T._numMorphTargets))]},M=new Map,r=M;function o(T,z,X){f(T)&&H.e.Warn(`Extension with the name '${T}' already exists`),M.set(T,{isGLTFExtension:z,factory:X})}function f(T){return M.delete(T)}function h(){const T=T=>T&&"object"===typeof T;for(var z=arguments.length,X=new Array(z),b=0;b<z;b++)X[b]=arguments[b];return X.reduce(((z,X)=>(Object.keys(X).forEach((b=>{const F=z[b],A=X[b];Array.isArray(F)&&Array.isArray(A)?z[b]=F.concat(...A):T(F)&&T(A)?z[b]=h(F,A):z[b]=A})),z)),{})}class Q{static Get(T,z,X){if(!z||void 0==X||!z[X])throw new Error(`${T}: Failed to find index (${X})`);return z[X]}static TryGet(T,z){return T&&void 0!=z&&T[z]?T[z]:null}static Assign(T){if(T)for(let z=0;z<T.length;z++)T[z].index=z}}class w{static RegisterExtension(T,z){o(T,!1,z)}static UnregisterExtension(T){return f(T)}get kj(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(T){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=T}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((T=>T.dispose&&T.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(T,z,X,b,F,A){let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=z,this._assetContainer=X,this._loadData(b);let A=null;if(T){const z={};if(this._gltf.nodes)for(const T of this._gltf.nodes)T.name&&(z[T.name]=T.index);A=(T instanceof Array?T:[T]).map((T=>{const X=z[T];if(void 0===X)throw new Error(`Failed to find node '${T}'`);return X}))}return this._loadAsync(F,u,A,(()=>({meshes:this._getMeshes(),pe:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(T,z,X,b){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=T,this._loadData(z),this._loadAsync(X,F,null,(()=>{})))))}_loadAsync(T,z,X,b){return Promise.resolve().then((async()=>{this._rootUrl=T,this._uniqueRootUrl=!T.startsWith("file:")&&z?T:`${T}${Date.now()}/`,this._fileName=z,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const F=`${B.k[B.k.LOADING]} => ${B.k[B.k.READY]}`,A=`${B.k[B.k.LOADING]} => ${B.k[B.k.COMPLETE]}`;this._parent._startPerformanceCounter(F),this._parent._startPerformanceCounter(A),this._parent._setState(B.k.LOADING),this._extensionsOnLoading();const y=new Array;if(!this.parent.loadOnlyMaterials)if(X)y.push(this.loadSceneAsync("/nodes",{nodes:X,index:-1}));else if(void 0!=this._gltf.ve||this._gltf.scenes&&this._gltf.scenes[0]){const T=Q.Get("/scene",this._gltf.scenes,this._gltf.ve||0);y.push(this.loadSceneAsync(`/scenes/${T.index}`,T))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let T=0;T<this._gltf.materials.length;++T){const z=this._gltf.materials[T],X="/materials/"+T,b=x.d.TriangleFillMode;y.push(this._loadMaterialAsync(X,z,null,b,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&y.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&y.push(this._compileShadowGeneratorsAsync());return Promise.all(y).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Hg(!0),this._extensionsOnReady(),this._parent._setState(B.k.READY),this._startAnimations(),b()))).then((T=>(this._parent._endPerformanceCounter(F),u.g.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(A),this._parent._setState(B.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(T=>{this._parent.onErrorObservable.notifyObservers(T),this._parent.onErrorObservable.clear(),this.dispose()}))})),T)))})).catch((T=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(T),this._parent.onErrorObservable.clear(),this.dispose()),T}))}_loadData(T){if(this._gltf=T.json,this._setupData(),T.bin){const z=this._gltf.buffers;if(z&&z[0]&&!z[0].uri){const X=z[0];(X.byteLength<T.bin.byteLength-3||X.byteLength>T.bin.byteLength)&&H.e.Warn(`Binary buffer length (${X.byteLength}) from JSON does not match chunk length (${T.bin.byteLength})`),this._bin=T.bin}else H.e.Warn("Unexpected BIN chunk")}}_setupData(){if(Q.Assign(this._gltf.accessors),Q.Assign(this._gltf.animations),Q.Assign(this._gltf.buffers),Q.Assign(this._gltf.bufferViews),Q.Assign(this._gltf.cameras),Q.Assign(this._gltf.images),Q.Assign(this._gltf.materials),Q.Assign(this._gltf.meshes),Q.Assign(this._gltf.nodes),Q.Assign(this._gltf.samplers),Q.Assign(this._gltf.scenes),Q.Assign(this._gltf.skins),Q.Assign(this._gltf.textures),this._gltf.nodes){const T={};for(const X of this._gltf.nodes)if(X.children)for(const z of X.children)T[z]=X.index;const z=this._createRootNode();for(const X of this._gltf.nodes){const b=T[X.index];X.parent=void 0===b?z:this._gltf.nodes[b]}}}async _loadExtensionsAsync(){const T=[];if(r.forEach(((z,X)=>{var b;!1===(null===(b=this.parent.extensionOptions[X])||void 0===b?void 0:b.enabled)?z.isGLTFExtension&&this.isExtensionUsed(X)&&H.e.Warn(`Extension ${X} is used but has been explicitly disabled.`):z.isGLTFExtension&&!this.isExtensionUsed(X)||T.push((async()=>{const T=await z.factory(this);return T.name!==X&&H.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${T.name} !== ${X}`),this._parent.onExtensionLoadedObservable.notifyObservers(T),T})())})),this._extensions.push(...await Promise.all(T)),this._extensions.sort(((T,z)=>(T.order||Number.MAX_VALUE)-(z.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const X of this._gltf.extensionsRequired){if(!this._extensions.some((T=>T.name===X&&T.enabled))){var z;if(!1===(null===(z=this.parent.extensionOptions[X])||void 0===z?void 0:z.enabled))throw new Error(`Required extension ${X} is disabled`);throw new Error(`Required extension ${X} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new S.e("__root__",this._babylonScene);this._rootBabylonMesh=T,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Hg(!1);const z={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case B.j.AUTO:this._babylonScene.useRightHandedSystem||(z.rotation=[0,1,0,0],z.scale=[1,1,-1],w._LoadTransform(z,this._rootBabylonMesh));break;case B.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(T),z}loadSceneAsync(T,z){const X=this._extensionsLoadSceneAsync(T,z);if(X)return X;const b=new Array;if(this.logOpen(`${T} ${z.name||""}`),z.nodes)for(const F of z.nodes){const z=Q.Get(`${T}/nodes/${F}`,this._gltf.nodes,F);b.push(this.loadNodeAsync(`/nodes/${z.index}`,z,(T=>{T.parent=this._rootBabylonMesh})))}for(const F of this._postSceneLoadActions)F();return b.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(b).then((()=>{}))}_forEachPrimitive(T,z){if(T._primitiveBabylonMeshes)for(const X of T._primitiveBabylonMeshes)z(X)}_getGeometries(){const T=[],z=this._gltf.nodes;if(z)for(const X of z)this._forEachPrimitive(X,(z=>{const X=z.Ee;X&&-1===T.indexOf(X)&&T.push(X)}));return T}_getMeshes(){const T=[];this._rootBabylonMesh instanceof m.c&&T.push(this._rootBabylonMesh);const z=this._gltf.nodes;if(z)for(const X of z)this._forEachPrimitive(X,(z=>{T.push(z)}));return T}_getTransformNodes(){const T=[],z=this._gltf.nodes;if(z)for(const X of z)X._babylonTransformNode&&"mb"===X._babylonTransformNode.getClassName()&&T.push(X._babylonTransformNode),X._babylonTransformNodeForSkin&&T.push(X._babylonTransformNodeForSkin);return T}_getSkeletons(){const T=[],z=this._gltf.skins;if(z)for(const X of z)X._data&&T.push(X._data.babylonSkeleton);return T}_getAnimationGroups(){const T=[],z=this._gltf.animations;if(z)for(const X of z)X._babylonAnimationGroup&&T.push(X._babylonAnimationGroup);return T}_startAnimations(){switch(this._parent.animationStartMode){case B.g.NONE:break;case B.g.FIRST:{const T=this._getAnimationGroups();0!==T.length&&T[0].start(!0);break}case B.g.ALL:{const T=this._getAnimationGroups();for(const z of T)z.start(!0);break}default:return void H.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const b=this._extensionsLoadNodeAsync(T,z,X);if(b)return b;if(z._babylonTransformNode)throw new Error(`${T}: Invalid recursive node hierarchy`);const F=new Array;this.logOpen(`${T} ${z.name||""}`);const A=b=>{if(w.AddPointerMetadata(b,T),w._LoadTransform(z,b),void 0!=z.camera){const X=Q.Get(`${T}/camera`,this._gltf.cameras,z.camera);F.push(this.loadCameraAsync(`/cameras/${X.index}`,X,(T=>{T.parent=b})))}if(z.children)for(const X of z.children){const z=Q.Get(`${T}/children/${X}`,this._gltf.nodes,X);F.push(this.loadNodeAsync(`/nodes/${z.index}`,z,(T=>{T.parent=b})))}X(b)},u=void 0!=z.mesh,y=this._parent.loadSkins&&void 0!=z.skin;if(!u||y){const T=z.name||`node${z.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const X=new G.e(T,this._babylonScene);X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==z.mesh?z._babylonTransformNode=X:z._babylonTransformNodeForSkin=X,A(X)}if(u)if(y){const X=Q.Get(`${T}/mesh`,this._gltf.meshes,z.mesh);F.push(this._loadMeshAsync(`/meshes/${X.index}`,z,X,(X=>{const b=z._babylonTransformNodeForSkin;X.metadata=h(b.metadata,X.metadata||{});const A=Q.Get(`${T}/skin`,this._gltf.skins,z.skin);F.push(this._loadSkinAsync(`/skins/${A.index}`,z,A,(T=>{this._forEachPrimitive(z,(z=>{z.skeleton=T})),this._postSceneLoadActions.push((()=>{if(void 0!=A.skeleton){const T=Q.Get(`/skins/${A.index}/skeleton`,this._gltf.nodes,A.skeleton).parent;z.index===T.index?X.parent=b.parent:X.parent=T._babylonTransformNode}else X.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:b,skinnedNode:X})}))})))})))}else{const X=Q.Get(`${T}/mesh`,this._gltf.meshes,z.mesh);F.push(this._loadMeshAsync(`/meshes/${X.index}`,z,X,A))}return this.logClose(),Promise.all(F).then((()=>(this._forEachPrimitive(z,(T=>{T.Ee&&T.Ee.useBoundingInfoFromGeometry?T.Ea():T.refreshBoundingInfo(!0,!0)})),z._babylonTransformNode)))}_loadMeshAsync(T,z,X,b){const F=X.primitives;if(!F||!F.length)throw new Error(`${T}: Primitives are missing`);void 0==F[0].index&&Q.Assign(F);const A=new Array;this.logOpen(`${T} ${X.name||""}`);const u=z.name||`node${z.index}`;if(1===F.length){const b=X.primitives[0];A.push(this._loadMeshPrimitiveAsync(`${T}/primitives/${b.index}`,u,z,X,b,(T=>{z._babylonTransformNode=T,z._primitiveBabylonMeshes=[T]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,z._babylonTransformNode=new G.e(u,this._babylonScene),z._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z._primitiveBabylonMeshes=[];for(const b of F)A.push(this._loadMeshPrimitiveAsync(`${T}/primitives/${b.index}`,`${u}_primitive${b.index}`,z,X,b,(T=>{T.parent=z._babylonTransformNode,z._primitiveBabylonMeshes.push(T)})))}return b(z._babylonTransformNode),this.logClose(),Promise.all(A).then((()=>z._babylonTransformNode))}_loadMeshPrimitiveAsync(T,z,X,b,F,A){const u=this._extensionsLoadMeshPrimitiveAsync(T,z,X,b,F,A);if(u)return u;this.logOpen(`${T}`);const y=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==X.skin&&!b.primitives[0].targets;let E,v;if(y&&F._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,E=F._instanceData.babylonSourceMesh.Db(z),E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v=F._instanceData.promise;else{const A=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new S.e(z,this._babylonScene);u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u.sideOrientation=this._babylonScene.useRightHandedSystem?x.d.CounterClockWiseSideOrientation:x.d.ClockWiseSideOrientation,this._createMorphTargets(T,X,b,F,u),A.push(this._loadVertexDataAsync(T,F,u).then((z=>this._loadMorphTargetsAsync(T,F,u,z).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,z.Ca(u),z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const k=w._GetDrawMode(T,F.mode);if(void 0==F.material){let T=this._defaultBabylonMaterialData[k];T||(T=this._createDefaultMaterial("__GLTFLoader._default",k),this._parent.onMaterialLoadedObservable.notifyObservers(T),this._defaultBabylonMaterialData[k]=T),u.material=T}else if(!this.parent.skipMaterials){const z=Q.Get(`${T}/material`,this._gltf.materials,F.material);A.push(this._loadMaterialAsync(`/materials/${z.index}`,z,u,k,(T=>{u.material=T})))}v=Promise.all(A),y&&(F._instanceData={babylonSourceMesh:u,promise:v}),E=u}return w.AddPointerMetadata(E,T),this._parent.onMeshLoadedObservable.notifyObservers(E),A(E),this.logClose(),v.then((()=>E))}_loadVertexDataAsync(T,z,X){const b=this._extensionsLoadVertexDataAsync(T,z,X);if(b)return b;const A=z.attributes;if(!A)throw new Error(`${T}: Attributes are missing`);const u=new Array,y=new Z.e(X.name,this._babylonScene);if(void 0==z.indices)X.isUnIndexed=!0;else{const X=Q.Get(`${T}/indices`,this._gltf.accessors,z.indices);u.push(this._loadIndicesAccessorAsync(`/accessors/${X.index}`,X).then((T=>{y.setIndices(T)})))}const E=(z,b,E)=>{if(void 0==A[z])return;X._delayInfo=X._delayInfo||[],-1===X._delayInfo.indexOf(b)&&X._delayInfo.push(b);const v=Q.Get(`${T}/attributes/${z}`,this._gltf.accessors,A[z]);u.push(this._loadVertexAccessorAsync(`/accessors/${v.index}`,v,b).then((T=>{if(T.getKind()===j.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!X.skeleton&&v.min&&v.max){const T=F.f.Id[0].Cd(...v.min),z=F.f.Id[1].Cd(...v.max);if(v.normalized&&5126!==v.componentType){let X=1;switch(v.componentType){case 5120:X=127;break;case 5121:X=255;break;case 5122:X=32767;break;case 5123:X=65535}const b=1/X;T.scaleInPlace(b),z.scaleInPlace(b)}y._boundingInfo=new R.c(T,z),y.useBoundingInfoFromGeometry=!0}y.setVerticesBuffer(T,v.count)}))),b==j.e.MatricesIndicesExtraKind&&(X.numBoneInfluencers=8),E&&E(v)};return E("POSITION",j.e.PositionKind),E("NORMAL",j.e.NormalKind),E("TANGENT",j.e.TangentKind),E("TEXCOORD_0",j.e.UVKind),E("TEXCOORD_1",j.e.UV2Kind),E("TEXCOORD_2",j.e.UV3Kind),E("TEXCOORD_3",j.e.UV4Kind),E("TEXCOORD_4",j.e.UV5Kind),E("TEXCOORD_5",j.e.UV6Kind),E("JOINTS_0",j.e.MatricesIndicesKind),E("WEIGHTS_0",j.e.MatricesWeightsKind),E("JOINTS_1",j.e.MatricesIndicesExtraKind),E("WEIGHTS_1",j.e.MatricesWeightsExtraKind),E("COLOR_0",j.e.ColorKind,(T=>{"VEC4"===T.type&&(X.hasVertexAlpha=!0)})),Promise.all(u).then((()=>y))}_createMorphTargets(T,z,X,b,F){if(!b.targets||!this._parent.loadMorphTargets)return;if(void 0==z._numMorphTargets)z._numMorphTargets=b.targets.length;else if(b.targets.length!==z._numMorphTargets)throw new Error(`${T}: Primitives do not have the same number of targets`);const A=X.extras?X.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,F.morphTargetManager=new W(this._babylonScene),F.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F.morphTargetManager.areUpdatesFrozen=!0;for(let u=0;u<b.targets.length;u++){const T=z.weights?z.weights[u]:X.weights?X.weights[u]:0,b=A?A[u]:`morphTarget${u}`;F.morphTargetManager.addTarget(new n(b,T,F.va()))}}_loadMorphTargetsAsync(T,z,X,b){if(!z.targets||!this._parent.loadMorphTargets)return Promise.resolve();const F=new Array,A=X.morphTargetManager;for(let u=0;u<A.numTargets;u++){const X=A.getTarget(u);F.push(this._loadMorphTargetVertexDataAsync(`${T}/targets/${u}`,b,z.targets[u],X))}return Promise.all(F).then((()=>{A.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(T,z,X,b){const F=new Array,A=(b,A,u)=>{if(void 0==X[b])return;const y=z.getVertexBuffer(A);if(!y)return;const E=Q.Get(`${T}/${b}`,this._gltf.accessors,X[b]);F.push(this._loadFloatAccessorAsync(`/accessors/${E.index}`,E).then((T=>{u(y,T)})))};return A("POSITION",j.e.PositionKind,((T,z)=>{const X=new Float32Array(z.length);T.forEach(z.length,((T,b)=>{X[b]=z[b]+T})),b.setPositions(X)})),A("NORMAL",j.e.NormalKind,((T,z)=>{const X=new Float32Array(z.length);T.forEach(X.length,((T,b)=>{X[b]=z[b]+T})),b.setNormals(X)})),A("TANGENT",j.e.TangentKind,((T,z)=>{const X=new Float32Array(z.length/3*4);let F=0;T.forEach(z.length/3*4,((T,b)=>{(b+1)%4!==0&&(X[F]=z[F]+T,F++)})),b.setTangents(X)})),Promise.all(F).then((()=>{}))}static _LoadTransform(T,z){if(void 0!=T.skin)return;let X=F.j.Zero(),b=F.e.Identity(),A=F.j.One();if(T.matrix){F.d.xd(T.matrix).decompose(A,b,X)}else T.translation&&(X=F.j.xd(T.translation)),T.rotation&&(b=F.e.xd(T.rotation)),T.scale&&(A=F.j.xd(T.scale));z.position=X,z.rotationQuaternion=b,z.Pd=A}_loadSkinAsync(T,z,X,b){if(!this._parent.loadSkins)return Promise.resolve();const F=this._extensionsLoadSkinAsync(T,z,X);if(F)return F;if(X._data)return b(X._data.babylonSkeleton),X._data.promise;const A=`skeleton${X.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new s(X.name||A,A,this._babylonScene);u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(T,X,u);const y=this._loadSkinInverseBindMatricesDataAsync(T,X).then((T=>{this._updateBoneMatrices(u,T)}));return X._data={babylonSkeleton:u,promise:y},b(u),y}_loadBones(T,z,X){if(void 0==z.skeleton||this._parent.alwaysComputeSkeletonRootNode){const X=this._findSkeletonRootNode(`${T}/joints`,z.joints);if(X)if(void 0===z.skeleton)z.skeleton=X.index;else{const b=(T,z)=>{for(;z.parent;z=z.parent)if(z.parent===T)return!0;return!1},F=Q.Get(`${T}/skeleton`,this._gltf.nodes,z.skeleton);F===X||b(F,X)||(H.e.Warn(`${T}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),z.skeleton=X.index)}else H.e.Warn(`${T}: Failed to find common root`)}const b={};for(const F of z.joints){const A=Q.Get(`${T}/joints/${F}`,this._gltf.nodes,F);this._loadBone(A,z,X,b)}}_findSkeletonRootNode(T,z){if(0===z.length)return null;const X={};for(const F of z){const z=[];let b=Q.Get(`${T}/${F}`,this._gltf.nodes,F);for(;-1!==b.index;)z.unshift(b),b=b.parent;X[F]=z}let b=null;for(let F=0;;++F){let T=X[z[0]];if(F>=T.length)return b;const A=T[F];for(let u=1;u<z.length;++u)if(T=X[z[u]],F>=T.length||A!==T[F])return b;b=A}}_loadBone(T,z,X,b){T._isJoint=!0;let F=b[T.index];if(F)return F;let A=null;T.index!==z.skeleton&&(T.parent&&-1!==T.parent.index?A=this._loadBone(T.parent,z,X,b):void 0!==z.skeleton&&H.e.Warn(`/skins/${z.index}/skeleton: Skeleton node is not a common root`));const u=z.joints.indexOf(T.index);return F=new v.d(T.name||`joint${T.index}`,X,A,this._getNodeMatrix(T),null,null,u),b[T.index]=F,this._postSceneLoadActions.push((()=>{F.linkTransformNode(T._babylonTransformNode)})),F}_loadSkinInverseBindMatricesDataAsync(T,z){if(void 0==z.inverseBindMatrices)return Promise.resolve(null);const X=Q.Get(`${T}/inverseBindMatrices`,this._gltf.accessors,z.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${X.index}`,X)}_updateBoneMatrices(T,z){for(const X of T.bones){const T=F.d.Identity(),b=X._index;z&&-1!==b&&(F.d.FromArrayToRef(z,16*b,T),T.invertToRef(T));const A=X.getParent();A&&T.multiplyToRef(A.getAbsoluteInverseBindMatrix(),T),X._d(T,!1,!1),X._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(T){return T.matrix?F.d.xd(T.matrix):F.d.Compose(T.scale?F.j.xd(T.scale):F.j.One(),T.rotation?F.e.xd(T.rotation):F.e.Identity(),T.translation?F.j.xd(T.translation):F.j.Zero())}loadCameraAsync(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const b=this._extensionsLoadCameraAsync(T,z,X);if(b)return b;const A=new Array;this.logOpen(`${T} ${z.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new E.d(z.name||`camera${z.index}`,F.j.Zero(),this._babylonScene,!1);switch(u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u.ignoreParentScaling=!0,z._babylonCamera=u,u.rotation.set(0,Math.PI,0),z.type){case"perspective":{const X=z.perspective;if(!X)throw new Error(`${T}: Camera perspective properties are missing`);u.fov=X.yfov,u.qj=X.znear,u.maxZ=X.zfar||0;break}case"orthographic":if(!z.orthographic)throw new Error(`${T}: Camera orthographic properties are missing`);u.mode=y.c.ORTHOGRAPHIC_CAMERA,u.orthoLeft=-z.orthographic.xmag,u.orthoRight=z.orthographic.xmag,u.orthoBottom=-z.orthographic.ymag,u.orthoTop=z.orthographic.ymag,u.qj=z.orthographic.znear,u.maxZ=z.orthographic.zfar;break;default:throw new Error(`${T}: Invalid camera type (${z.type})`)}return w.AddPointerMetadata(u,T),this._parent.onCameraLoadedObservable.notifyObservers(u),X(u),this.logClose(),Promise.all(A).then((()=>u))}_loadAnimationsAsync(){const T=this._gltf.animations;if(!T)return Promise.resolve();const z=new Array;for(let X=0;X<T.length;X++){const b=T[X];z.push(this.loadAnimationAsync(`/animations/${b.index}`,b).then((T=>{0===T.targetedAnimations.length&&T.dispose()})))}return Promise.all(z).then((()=>{}))}loadAnimationAsync(T,z){const b=this._extensionsLoadAnimationAsync(T,z);return b||X.e(43).then(X.bind(X,13172)).then((X=>{let{AnimationGroup:b}=X;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new b(z.name||`animation${z.index}`,this._babylonScene);F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z._babylonAnimationGroup=F;const A=new Array;Q.Assign(z.channels),Q.Assign(z.samplers);for(const u of z.channels)A.push(this._loadAnimationChannelAsync(`${T}/channels/${u.index}`,T,z,u,((T,z)=>{T.animations=T.animations||[],T.animations.push(z),F.addTargetedAnimation(z,T)})));return Promise.all(A).then((()=>(F.normalize(0),F)))}))}_loadAnimationChannelAsync(T,z,X,b,F){const A=this._extensionsLoadAnimationChannelAsync(T,z,X,b,F);if(A)return A;if(void 0==b.target.node)return Promise.resolve();const u=Q.Get(`${T}/target/node`,this._gltf.nodes,b.target.node),y=b.target.path,E="weights"===y;if(E&&!u._numMorphTargets||!E&&!u._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!E&&!u._isJoint)return Promise.resolve();let v;switch(y){case"translation":v=g.translation;break;case"rotation":v=g.rotation;break;case"scale":v=g.scale;break;case"weights":v=g.weights;break;default:throw new Error(`${T}/target/path: Invalid value (${b.target.path})`)}const k={object:u,info:v};return this._loadAnimationChannelFromTargetInfoAsync(T,z,X,b,k,F)}_loadAnimationChannelFromTargetInfoAsync(T,z,X,b,F,A){const u=this.parent.targetFps,y=1/u,E=Q.Get(`${T}/sampler`,X.samplers,b.sampler);return this._loadAnimationSamplerAsync(`${z}/samplers/${b.sampler}`,E).then((T=>{let z=0;const E=F.object,v=F.info;for(const F of v){const v=F.getStride(E),k=T.input,L=T.output,D=new Array(k.length);let c=0;switch(T.interpolation){case"STEP":for(let T=0;T<k.length;T++){const z=F.getValue(E,L,c,1);c+=v,D[T]={frame:k[T]*u,value:z,interpolation:1}}break;case"CUBICSPLINE":for(let T=0;T<k.length;T++){const z=F.getValue(E,L,c,y);c+=v;const X=F.getValue(E,L,c,1);c+=v;const b=F.getValue(E,L,c,y);c+=v,D[T]={frame:k[T]*u,inTangent:z,value:X,outTangent:b}}break;case"LINEAR":for(let T=0;T<k.length;T++){const z=F.getValue(E,L,c,1);c+=v,D[T]={frame:k[T]*u,value:z}}}if(c>0){const T=`${X.name||`animation${X.index}`}_channel${b.index}_${z}`;F.buildAnimations(E,T,u,D,((T,X)=>{++z,A(T,X)}))}}}))}_loadAnimationSamplerAsync(T,z){if(z._data)return z._data;const X=z.interpolation||"LINEAR";switch(X){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${T}/interpolation: Invalid value (${z.interpolation})`)}const b=Q.Get(`${T}/input`,this._gltf.accessors,z.input),F=Q.Get(`${T}/output`,this._gltf.accessors,z.output);return z._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${b.index}`,b),this._loadFloatAccessorAsync(`/accessors/${F.index}`,F)]).then((T=>{let[z,b]=T;return{input:z,interpolation:X,output:b}})),z._data}loadBufferAsync(T,z,X,b){const F=this._extensionsLoadBufferAsync(T,z,X,b);if(F)return F;if(!z._data)if(z.uri)z._data=this.loadUriAsync(`${T}/uri`,z,z.uri);else{if(!this._bin)throw new Error(`${T}: Uri is missing or the binary glTF is missing its binary chunk`);z._data=this._bin.readAsync(0,z.byteLength)}return z._data.then((z=>{try{return new Uint8Array(z.buffer,z.byteOffset+X,b)}catch(F){throw new Error(`${T}: ${F.message}`)}}))}loadBufferViewAsync(T,z){const X=this._extensionsLoadBufferViewAsync(T,z);if(X)return X;if(z._data)return z._data;const b=Q.Get(`${T}/buffer`,this._gltf.buffers,z.buffer);return z._data=this.loadBufferAsync(`/buffers/${b.index}`,b,z.byteOffset||0,z.byteLength),z._data}_loadAccessorAsync(T,z,X){if(z._data)return z._data;const b=w._GetNumComponents(T,z.type),F=b*j.e.GetTypeByteLength(z.componentType),A=b*z.count;if(void 0==z.bufferView)z._data=Promise.resolve(new X(A));else{const u=Q.Get(`${T}/bufferView`,this._gltf.bufferViews,z.bufferView);z._data=this.loadBufferViewAsync(`/bufferViews/${u.index}`,u).then((y=>{if(5126!==z.componentType||z.normalized||u.byteStride&&u.byteStride!==F){const T=new X(A);return j.e.ForEach(y,z.byteOffset||0,u.byteStride||F,b,z.componentType,T.length,z.normalized||!1,((z,X)=>{T[X]=z})),T}return w._GetTypedArray(T,z.componentType,y,z.byteOffset,A)}))}if(z.sparse){const A=z.sparse;z._data=z._data.then((u=>{const y=u,E=Q.Get(`${T}/sparse/indices/bufferView`,this._gltf.bufferViews,A.indices.bufferView),v=Q.Get(`${T}/sparse/values/bufferView`,this._gltf.bufferViews,A.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${E.index}`,E),this.loadBufferViewAsync(`/bufferViews/${v.index}`,v)]).then((u=>{let[E,v]=u;const k=w._GetTypedArray(`${T}/sparse/indices`,A.indices.componentType,E,A.indices.byteOffset,A.count),L=b*A.count;let D;if(5126!==z.componentType||z.normalized){const u=w._GetTypedArray(`${T}/sparse/values`,z.componentType,v,A.values.byteOffset,L);D=new X(L),j.e.ForEach(u,0,F,b,z.componentType,D.length,z.normalized||!1,((T,z)=>{D[z]=T}))}else D=w._GetTypedArray(`${T}/sparse/values`,z.componentType,v,A.values.byteOffset,L);let c=0;for(let T=0;T<k.length;T++){let z=k[T]*b;for(let T=0;T<b;T++)y[z++]=D[c++]}return y}))}))}return z._data}_loadFloatAccessorAsync(T,z){return this._loadAccessorAsync(T,z,Float32Array)}_loadIndicesAccessorAsync(T,z){if("SCALAR"!==z.type)throw new Error(`${T}/type: Invalid value ${z.type}`);if(5121!==z.componentType&&5123!==z.componentType&&5125!==z.componentType)throw new Error(`${T}/componentType: Invalid value ${z.componentType}`);if(z._data)return z._data;if(z.sparse){const X=w._GetTypedArrayConstructor(`${T}/componentType`,z.componentType);z._data=this._loadAccessorAsync(T,z,X)}else{const X=Q.Get(`${T}/bufferView`,this._gltf.bufferViews,z.bufferView);z._data=this.loadBufferViewAsync(`/bufferViews/${X.index}`,X).then((X=>w._GetTypedArray(T,z.componentType,X,z.byteOffset,z.count)))}return z._data}_loadVertexBufferViewAsync(T){if(T._babylonBuffer)return T._babylonBuffer;const z=this._babylonScene.getEngine();return T._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${T.index}`,T).then((T=>new j.b(z,T,!1))),T._babylonBuffer}_loadVertexAccessorAsync(T,z,X){var b;if(null!==(b=z._babylonVertexBuffer)&&void 0!==b&&b[X])return z._babylonVertexBuffer[X];z._babylonVertexBuffer||(z._babylonVertexBuffer={});const F=this._babylonScene.getEngine();if(z.sparse||void 0==z.bufferView)z._babylonVertexBuffer[X]=this._loadFloatAccessorAsync(T,z).then((T=>new j.e(F,T,X,!1)));else{const b=Q.Get(`${T}/bufferView`,this._gltf.bufferViews,z.bufferView);z._babylonVertexBuffer[X]=this._loadVertexBufferViewAsync(b).then((A=>{const u=w._GetNumComponents(T,z.type);return new j.e(F,A,X,!1,void 0,b.byteStride,void 0,z.byteOffset,u,z.componentType,z.normalized,!0,void 0,!0)}))}return z._babylonVertexBuffer[X]}_loadMaterialMetallicRoughnessPropertiesAsync(T,z,X){if(!(X instanceof V))throw new Error(`${T}: Material type not supported`);const b=new Array;return z&&(z.baseColorFactor?(X.albedoColor=A.b.xd(z.baseColorFactor),X.alpha=z.baseColorFactor[3]):X.albedoColor=A.b.White(),X.metallic=void 0==z.metallicFactor?1:z.metallicFactor,X.roughness=void 0==z.roughnessFactor?1:z.roughnessFactor,z.baseColorTexture&&b.push(this.loadTextureInfoAsync(`${T}/baseColorTexture`,z.baseColorTexture,(T=>{T.name=`${X.name} (Base Color)`,X.albedoTexture=T}))),z.metallicRoughnessTexture&&(z.metallicRoughnessTexture.nonColorData=!0,b.push(this.loadTextureInfoAsync(`${T}/metallicRoughnessTexture`,z.metallicRoughnessTexture,(T=>{T.name=`${X.name} (Metallic Roughness)`,X.metallicTexture=T}))),X.useMetallnessFromMetallicTextureBlue=!0,X.useRoughnessFromMetallicTextureGreen=!0,X.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(b).then((()=>{}))}_loadMaterialAsync(T,z,X,b){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const A=this._extensionsLoadMaterialAsync(T,z,X,b,F);if(A)return A;z._data=z._data||{};let u=z._data[b];if(!u){this.logOpen(`${T} ${z.name||""}`);const X=this.createMaterial(T,z,b);u={babylonMaterial:X,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(T,z,X)},z._data[b]=u,w.AddPointerMetadata(X,T),this._parent.onMaterialLoadedObservable.notifyObservers(X),this.logClose()}return X&&(u.babylonMeshes.push(X),X.Qd.addOnce((()=>{const T=u.babylonMeshes.indexOf(X);-1!==T&&u.babylonMeshes.splice(T,1)}))),F(u.babylonMaterial),u.promise.then((()=>u.babylonMaterial))}_createDefaultMaterial(T,z){this._babylonScene._blockEntityCollection=!!this._assetContainer;const X=new V(T,this._babylonScene);return X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,X.fillMode=z,X.enableSpecularAntiAliasing=!0,X.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,X.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,X.transparencyMode=V.PBRMATERIAL_OPAQUE,X.metallic=1,X.roughness=1,X}createMaterial(T,z,X){const b=this._extensionsCreateMaterial(T,z,X);if(b)return b;const F=z.name||`material${z.index}`;return this._createDefaultMaterial(F,X)}loadMaterialPropertiesAsync(T,z,X){const b=this._extensionsLoadMaterialPropertiesAsync(T,z,X);if(b)return b;const F=new Array;return F.push(this.loadMaterialBasePropertiesAsync(T,z,X)),z.pbrMetallicRoughness&&F.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${T}/pbrMetallicRoughness`,z.pbrMetallicRoughness,X)),this.loadMaterialAlphaProperties(T,z,X),Promise.all(F).then((()=>{}))}loadMaterialBasePropertiesAsync(T,z,X){if(!(X instanceof V))throw new Error(`${T}: Material type not supported`);const b=new Array;return X.emissiveColor=z.emissiveFactor?A.b.xd(z.emissiveFactor):new A.b(0,0,0),z.doubleSided&&(X.Ke=!1,X.twoSidedLighting=!0),z.normalTexture&&(z.normalTexture.nonColorData=!0,b.push(this.loadTextureInfoAsync(`${T}/normalTexture`,z.normalTexture,(T=>{T.name=`${X.name} (Normal)`,X.bumpTexture=T}))),X.invertNormalMapX=!this._babylonScene.useRightHandedSystem,X.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=z.normalTexture.scale&&X.bumpTexture&&(X.bumpTexture.level=z.normalTexture.scale),X.forceIrradianceInFragment=!0),z.occlusionTexture&&(z.occlusionTexture.nonColorData=!0,b.push(this.loadTextureInfoAsync(`${T}/occlusionTexture`,z.occlusionTexture,(T=>{T.name=`${X.name} (Occlusion)`,X.ambientTexture=T}))),X.useAmbientInGrayScale=!0,void 0!=z.occlusionTexture.strength&&(X.ambientTextureStrength=z.occlusionTexture.strength)),z.emissiveTexture&&b.push(this.loadTextureInfoAsync(`${T}/emissiveTexture`,z.emissiveTexture,(T=>{T.name=`${X.name} (Emissive)`,X.emissiveTexture=T}))),Promise.all(b).then((()=>{}))}loadMaterialAlphaProperties(T,z,X){if(!(X instanceof V))throw new Error(`${T}: Material type not supported`);switch(z.alphaMode||"OPAQUE"){case"OPAQUE":X.transparencyMode=V.PBRMATERIAL_OPAQUE,X.alpha=1;break;case"MASK":X.transparencyMode=V.PBRMATERIAL_ALPHATEST,X.alphaCutOff=void 0==z.alphaCutoff?.5:z.alphaCutoff,X.albedoTexture&&(X.albedoTexture.ld=!0);break;case"BLEND":X.transparencyMode=V.PBRMATERIAL_ALPHABLEND,X.albedoTexture&&(X.albedoTexture.ld=!0,X.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${T}/alphaMode: Invalid value (${z.alphaMode})`)}}loadTextureInfoAsync(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const b=this._extensionsLoadTextureInfoAsync(T,z,X);if(b)return b;if(this.logOpen(`${T}`),z.texCoord>=6)throw new Error(`${T}/texCoord: Invalid value (${z.texCoord})`);const F=Q.Get(`${T}/index`,this._gltf.textures,z.index);F._textureInfo=z;const A=this._loadTextureAsync(`/textures/${z.index}`,F,(b=>{b.coordinatesIndex=z.texCoord||0,w.AddPointerMetadata(b,T),this._parent.onTextureLoadedObservable.notifyObservers(b),X(b)}));return this.logClose(),A}_loadTextureAsync(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const b=this._extensionsLoadTextureAsync(T,z,X);if(b)return b;this.logOpen(`${T} ${z.name||""}`);const F=void 0==z.sampler?w.DefaultSampler:Q.Get(`${T}/sampler`,this._gltf.samplers,z.sampler),A=Q.Get(`${T}/source`,this._gltf.images,z.source),u=this._createTextureAsync(T,F,A,X,void 0,!z._textureInfo.nonColorData);return this.logClose(),u}_createTextureAsync(T,z,X){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},A=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0;const y=this._loadSampler(`/samplers/${z.index}`,z),E=new Array,v=new b;this._babylonScene._blockEntityCollection=!!this._assetContainer;const k={noMipmap:y.noMipMaps,invertY:!1,samplingMode:y.samplingMode,X:()=>{this._disposed||v.resolve()},onError:(z,X)=>{this._disposed||v.reject(new Error(`${T}: ${X&&X.message?X.message:z||"Failed to load texture"}`))},mimeType:X.mimeType,loaderOptions:A,useSRGBBuffer:!!u&&this._parent.useSRGBBuffers},L=new C.c(null,this._babylonScene,k);return L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E.push(v.promise),E.push(this.loadImageAsync(`/images/${X.index}`,X).then((T=>{const z=X.uri||`${this._fileName}#image${X.index}`,b=`data:${this._uniqueRootUrl}${z}`;L.updateURL(b,T);const F=L.getInternalTexture();F&&(F.label=X.name)}))),L.wrapU=y.wrapU,L.wrapV=y.wrapV,F(L),this._parent.useGltfTextureNames&&(L.name=X.name||X.uri||`image${X.index}`),Promise.all(E).then((()=>L))}_loadSampler(T,z){return z._data||(z._data={noMipMaps:9728===z.minFilter||9729===z.minFilter,samplingMode:w._GetTextureSamplingMode(T,z),wrapU:w._GetTextureWrapMode(`${T}/wrapS`,z.wrapS),wrapV:w._GetTextureWrapMode(`${T}/wrapT`,z.wrapT)}),z._data}loadImageAsync(T,z){if(!z._data){if(this.logOpen(`${T} ${z.name||""}`),z.uri)z._data=this.loadUriAsync(`${T}/uri`,z,z.uri);else{const X=Q.Get(`${T}/bufferView`,this._gltf.bufferViews,z.bufferView);z._data=this.loadBufferViewAsync(`/bufferViews/${X.index}`,X)}this.logClose()}return z._data}loadUriAsync(T,z,X){const b=this._extensionsLoadUriAsync(T,z,X);if(b)return b;if(!w._ValidateUri(X))throw new Error(`${T}: '${X}' is invalid`);if((0,e.i)(X)){const z=new Uint8Array((0,e.d)(X));return this.log(`${T}: Decoded ${X.substring(0,64)}... (${z.length} bytes)`),Promise.resolve(z)}return this.log(`${T}: Loading ${X}`),this._parent.preprocessUrlAsync(this._rootUrl+X).then((z=>new Promise(((b,F)=>{this._parent._loadFile(this._babylonScene,z,(z=>{this._disposed||(this.log(`${T}: Loaded ${X} (${z.byteLength} bytes)`),b(new Uint8Array(z)))}),!0,(z=>{F(new e.l(`${T}: Failed to load '${X}'${z?": "+z.status+" "+z.statusText:""}`,z))}))}))))}static AddPointerMetadata(T,z){T.metadata=T.metadata||{};const X=T._internalMetadata=T._internalMetadata||{},b=X.kj=X.kj||{};(b.pointers=b.pointers||[]).push(z)}static _GetTextureWrapMode(T,z){switch(z=void 0==z?10497:z){case 33071:return C.c.CLAMP_ADDRESSMODE;case 33648:return C.c.MIRROR_ADDRESSMODE;case 10497:return C.c.WRAP_ADDRESSMODE;default:return H.e.Warn(`${T}: Invalid value (${z})`),C.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(T,z){const X=void 0==z.magFilter?9729:z.magFilter,b=void 0==z.minFilter?9987:z.minFilter;if(9729===X)switch(b){case 9728:return C.c.LINEAR_NEAREST;case 9729:return C.c.LINEAR_LINEAR;case 9984:return C.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return C.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return C.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return C.c.LINEAR_LINEAR_MIPLINEAR;default:return H.e.Warn(`${T}/minFilter: Invalid value (${b})`),C.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==X&&H.e.Warn(`${T}/magFilter: Invalid value (${X})`),b){case 9728:return C.c.NEAREST_NEAREST;case 9729:return C.c.NEAREST_LINEAR;case 9984:return C.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return C.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return C.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return C.c.NEAREST_LINEAR_MIPLINEAR;default:return H.e.Warn(`${T}/minFilter: Invalid value (${b})`),C.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(T,z){switch(z){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${T}: Invalid component type ${z}`)}}static _GetTypedArray(T,z,X,b,F){const A=X.buffer;b=X.byteOffset+(b||0);const u=w._GetTypedArrayConstructor(`${T}/componentType`,z),y=j.e.GetTypeByteLength(z);return b%y!==0?(H.e.Warn(`${T}: Copying buffer as byte offset (${b}) is not a multiple of component type byte length (${y})`),new u(A.slice(b,b+F*y),0)):new u(A,b,F)}static _GetNumComponents(T,z){switch(z){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${T}: Invalid type (${z})`)}static _ValidateUri(T){return u.g.IsBase64(T)||-1===T.indexOf("..")}static _GetDrawMode(T,z){switch(void 0==z&&(z=4),z){case 0:return x.d.PointListDrawMode;case 1:return x.d.LineListDrawMode;case 2:return x.d.LineLoopDrawMode;case 3:return x.d.LineStripDrawMode;case 4:return x.d.TriangleFillMode;case 5:return x.d.TriangleStripDrawMode;case 6:return x.d.TriangleFanDrawMode}throw new Error(`${T}: Invalid mesh primitive mode (${z})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const T=new Array;if(this._gltf.materials)for(const z of this._gltf.materials)if(z._data)for(const X in z._data){const b=z._data[X];for(const z of b.babylonMeshes){z.ze(!0);const X=b.babylonMaterial;T.push(X.forceCompilationAsync(z)),T.push(X.forceCompilationAsync(z,{useInstances:!0})),this._parent.useClipPlane&&(T.push(X.forceCompilationAsync(z,{clipPlane:!0})),T.push(X.forceCompilationAsync(z,{clipPlane:!0,useInstances:!0})))}}return Promise.all(T).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const T=new Array,z=this._babylonScene.lights;for(const X of z){const z=X.getShadowGenerator();z&&T.push(z.forceCompilationAsync())}return Promise.all(T).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(T){for(const z of this._extensions)z.enabled&&T(z)}_applyExtensions(T,z,X){for(const b of this._extensions)if(b.enabled){const F=`${b.name}.${z}`,A=T;A._activeLoaderExtensionFunctions=A._activeLoaderExtensionFunctions||{};const u=A._activeLoaderExtensionFunctions;if(!u[F]){u[F]=!0;try{const T=X(b);if(T)return T}finally{delete u[F]}}}return null}_extensionsOnLoading(){this._forEachExtensions((T=>T.onLoading&&T.onLoading()))}_extensionsOnReady(){this._forEachExtensions((T=>T.onReady&&T.onReady()))}_extensionsLoadSceneAsync(T,z){return this._applyExtensions(z,"loadScene",(X=>X.loadSceneAsync&&X.loadSceneAsync(T,z)))}_extensionsLoadNodeAsync(T,z,X){return this._applyExtensions(z,"loadNode",(b=>b.loadNodeAsync&&b.loadNodeAsync(T,z,X)))}_extensionsLoadCameraAsync(T,z,X){return this._applyExtensions(z,"loadCamera",(b=>b.loadCameraAsync&&b.loadCameraAsync(T,z,X)))}_extensionsLoadVertexDataAsync(T,z,X){return this._applyExtensions(z,"loadVertexData",(b=>b._loadVertexDataAsync&&b._loadVertexDataAsync(T,z,X)))}_extensionsLoadMeshPrimitiveAsync(T,z,X,b,F,A){return this._applyExtensions(F,"loadMeshPrimitive",(u=>u._loadMeshPrimitiveAsync&&u._loadMeshPrimitiveAsync(T,z,X,b,F,A)))}_extensionsLoadMaterialAsync(T,z,X,b,F){return this._applyExtensions(z,"loadMaterial",(A=>A._loadMaterialAsync&&A._loadMaterialAsync(T,z,X,b,F)))}_extensionsCreateMaterial(T,z,X){return this._applyExtensions(z,"createMaterial",(b=>b.createMaterial&&b.createMaterial(T,z,X)))}_extensionsLoadMaterialPropertiesAsync(T,z,X){return this._applyExtensions(z,"loadMaterialProperties",(b=>b.loadMaterialPropertiesAsync&&b.loadMaterialPropertiesAsync(T,z,X)))}_extensionsLoadTextureInfoAsync(T,z,X){return this._applyExtensions(z,"loadTextureInfo",(b=>b.loadTextureInfoAsync&&b.loadTextureInfoAsync(T,z,X)))}_extensionsLoadTextureAsync(T,z,X){return this._applyExtensions(z,"loadTexture",(b=>b._loadTextureAsync&&b._loadTextureAsync(T,z,X)))}_extensionsLoadAnimationAsync(T,z){return this._applyExtensions(z,"loadAnimation",(X=>X.loadAnimationAsync&&X.loadAnimationAsync(T,z)))}_extensionsLoadAnimationChannelAsync(T,z,X,b,F){return this._applyExtensions(X,"loadAnimationChannel",(A=>A._loadAnimationChannelAsync&&A._loadAnimationChannelAsync(T,z,X,b,F)))}_extensionsLoadSkinAsync(T,z,X){return this._applyExtensions(X,"loadSkin",(b=>b._loadSkinAsync&&b._loadSkinAsync(T,z,X)))}_extensionsLoadUriAsync(T,z,X){return this._applyExtensions(z,"loadUri",(b=>b._loadUriAsync&&b._loadUriAsync(T,z,X)))}_extensionsLoadBufferViewAsync(T,z){return this._applyExtensions(z,"loadBufferView",(X=>X.loadBufferViewAsync&&X.loadBufferViewAsync(T,z)))}_extensionsLoadBufferAsync(T,z,X,b){return this._applyExtensions(z,"loadBuffer",(F=>F.loadBufferAsync&&F.loadBufferAsync(T,z,X,b)))}static LoadExtensionAsync(T,z,X,b){if(!z.extensions)return null;const F=z.extensions[X];return F?b(`${T}/extensions/${X}`,F):null}static LoadExtraAsync(T,z,X,b){if(!z.extras)return null;const F=z.extras[X];return F?b(`${T}/extras/${X}`,F):null}isExtensionUsed(T){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(T)}logOpen(T){this._parent._logOpen(T)}logClose(){this._parent._logClose()}log(T){this._parent._log(T)}startPerformanceCounter(T){this._parent._startPerformanceCounter(T)}endPerformanceCounter(T){this._parent._endPerformanceCounter(T)}}w.DefaultSampler={index:-1},B.d._CreateGLTF2Loader=T=>new w(T);var J=X(1437),I=X(10969),TT=X(12530);class zT extends TT.e{constructor(T,z,X){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",T),this._texture=T.getEngine().createRawCubeTexture(z,X,b,F,A,u,y,E)}update(T,z,X,b){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,T,z,X,b,F)}updateRGBDAsync(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,I.i)(this._texture,T,z,X,b).then((()=>{}))}clone(){return q.b.Clone((()=>{const T=this.va(),z=this._texture,X=new zT(T,z._bufferViewArray,z.width,z.format,z.type,z.generateMipMaps,z.invertY,z.samplingMode,z._compression);return 13===z.source&&X.updateRGBDAsync(z._bufferViewArrayArray,z._sphericalPolynomial,z._lodGenerationScale,z._lodGenerationOffset),X}),this)}}const XT="EXT_lights_image_based";class bT{constructor(T){this.name=XT,this._loader=T,this.enabled=this._loader.isExtensionUsed(XT)}dispose(){this._loader=null,delete this._lights}onLoading(){const T=this._loader.kj.extensions;if(T&&T[this.name]){const z=T[this.name];this._lights=z.lights}}loadSceneAsync(T,z){return w.LoadExtensionAsync(T,z,this.name,((X,b)=>{this._loader._allMaterialsDirtyRequired=!0;const F=new Array;F.push(this._loader.loadSceneAsync(T,z)),this._loader.logOpen(`${X}`);const A=Q.Get(`${X}/light`,this._lights,b.eb);return F.push(this._loadLightAsync(`/extensions/${this.name}/lights/${b.eb}`,A).then((T=>{this._loader.babylonScene.environmentTexture=T}))),this._loader.logClose(),Promise.all(F).then((()=>{}))}))}_loadLightAsync(T,z){if(!z._loaded){const X=new Array;this._loader.logOpen(`${T}`);const b=new Array(z.specularImages.length);for(let F=0;F<z.specularImages.length;F++){const A=z.specularImages[F];b[F]=new Array(A.length);for(let z=0;z<A.length;z++){const u=`${T}/specularImages/${F}/${z}`;this._loader.logOpen(`${u}`);const y=A[z],E=Q.Get(u,this._loader.kj.images,y);X.push(this._loader.loadImageAsync(`/images/${y}`,E).then((T=>{b[F][z]=T}))),this._loader.logClose()}}this._loader.logClose(),z._loaded=Promise.all(X).then((()=>{const X=new zT(this._loader.babylonScene,null,z.specularImageSize);if(X.name=z.name||"environment",z._babylonTexture=X,void 0!=z.uj&&(X.level=z.uj),z.rotation){let T=F.e.xd(z.rotation);this._loader.babylonScene.useRightHandedSystem||(T=F.e.Inverse(T)),F.d.FromQuaternionToRef(T,X.getReflectionTextureMatrix())}if(!z.irradianceCoefficients)throw new Error(`${T}: Irradiance coefficients are missing`);const A=J.c.xd(z.irradianceCoefficients);A.scaleInPlace(z.uj),A.convertIrradianceToLambertianRadiance();const u=J.e.FromHarmonics(A),y=(b.length-1)/Math.log2(z.specularImageSize);return X.updateRGBDAsync(b,u,y)}))}return z._loaded.then((()=>z._babylonTexture))}}f(XT),o(XT,!0,(T=>new bT(T)));X(12538);const FT="EXT_mesh_gpu_instancing";class AT{constructor(T){this.name=FT,this._loader=T,this.enabled=this._loader.isExtensionUsed(FT)}dispose(){this._loader=null}loadNodeAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((T,b)=>{this._loader._disableInstancedMesh++;const A=this._loader.loadNodeAsync(`/nodes/${z.index}`,z,X);if(this._loader._disableInstancedMesh--,!z._primitiveBabylonMeshes)return A;const u=new Array;let y=0;const E=z=>{if(void 0==b.attributes[z])return void u.push(Promise.resolve(null));const X=Q.Get(`${T}/attributes/${z}`,this._loader.kj.accessors,b.attributes[z]);if(u.push(this._loader._loadFloatAccessorAsync(`/accessors/${X.bufferView}`,X)),0===y)y=X.count;else if(y!==X.count)throw new Error(`${T}/attributes: Instance buffer accessors do not have the same count.`)};return E("TRANSLATION"),E("ROTATION"),E("SCALE"),A.then((T=>Promise.all(u).then((X=>{let[b,A,u]=X;const E=new Float32Array(16*y);F.f.Id[0].Cd(0,0,0),F.f.Quaternion[0].Cd(0,0,0,1),F.f.Id[1].Cd(1,1,1);for(let T=0;T<y;++T)b&&F.j.FromArrayToRef(b,3*T,F.f.Id[0]),A&&F.e.FromArrayToRef(A,4*T,F.f.Quaternion[0]),u&&F.j.FromArrayToRef(u,3*T,F.f.Id[1]),F.d.ComposeToRef(F.f.Id[1],F.f.Quaternion[0],F.f.Id[0],F.f.Matrix[0]),F.f.Matrix[0].copyToArray(E,16*T);for(const T of z._primitiveBabylonMeshes)T.bk("matrix",E,16,!0);return T}))))}))}}f(FT),o(FT,!0,(T=>new AT(T)));class uT{static get Default(){return uT._Default||(uT._Default=new uT),uT._Default}constructor(){const T=uT.Configuration.decoder;this._decoderModulePromise=u.g.LoadBabylonScriptAsync(T.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(T,z,X,b,F){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const A=await MeshoptDecoder.decodeGltfBufferAsync(z,X,T,b,F);return MeshoptDecoder.useWorkers(0),A}))}}uT.Configuration={decoder:{url:`${u.g._DefaultCdnUrl}/meshopt_decoder.js`}},uT._Default=null;const yT="EXT_meshopt_compression";class ET{constructor(T){this.name=yT,this.enabled=T.isExtensionUsed(yT),this._loader=T}dispose(){this._loader=null}loadBufferViewAsync(T,z){return w.LoadExtensionAsync(T,z,this.name,((X,b)=>{const F=z;if(F._meshOptData)return F._meshOptData;const A=Q.Get(`${T}/buffer`,this._loader.kj.buffers,b.buffer);return F._meshOptData=this._loader.loadBufferAsync(`/buffers/${A.index}`,A,b.byteOffset||0,b.byteLength).then((T=>uT.Default.decodeGltfBufferAsync(T,b.count,b.byteStride,b.mode,b.filter))),F._meshOptData}))}}f(yT),o(yT,!0,(T=>new ET(T)));const vT="EXT_texture_webp";class kT{constructor(T){this.name=vT,this._loader=T,this.enabled=T.isExtensionUsed(vT)}dispose(){this._loader=null}_loadTextureAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>{const A=void 0==z.sampler?w.DefaultSampler:Q.Get(`${T}/sampler`,this._loader.kj.samplers,z.sampler),u=Q.Get(`${b}/source`,this._loader.kj.images,F.source);return this._loader._createTextureAsync(T,A,u,(T=>{X(T)}),void 0,!z._textureInfo.nonColorData)}))}}f(vT),o(vT,!0,(T=>new kT(T)));const LT="EXT_texture_avif";class DT{constructor(T){this.name=LT,this._loader=T,this.enabled=T.isExtensionUsed(LT)}dispose(){this._loader=null}_loadTextureAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>{const A=void 0==z.sampler?w.DefaultSampler:Q.Get(`${T}/sampler`,this._loader.kj.samplers,z.sampler),u=Q.Get(`${b}/source`,this._loader.kj.images,F.source);return this._loader._createTextureAsync(T,A,u,(T=>{X(T)}),void 0,!z._textureInfo.nonColorData)}))}}f(LT),o(LT,!0,(T=>new DT(T)));var cT=X(12544);const pT="KHR_draco_mesh_compression";class HT{constructor(T){this.name=pT,this.useNormalizedFlagFromAccessor=!0,this._loader=T,this.enabled=cT.e.DecoderAvailable&&this._loader.isExtensionUsed(pT)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>{if(void 0!=z.mode&&4!==z.mode&&5!==z.mode)throw new Error(`${T}: Unsupported mode ${z.mode}`);const A={},u={},y=(T,b)=>{const y=F.attributes[T];if(void 0!=y&&(X._delayInfo=X._delayInfo||[],-1===X._delayInfo.indexOf(b)&&X._delayInfo.push(b),A[b]=y,this.useNormalizedFlagFromAccessor)){const X=Q.TryGet(this._loader.kj.accessors,z.attributes[T]);X&&(u[b]=X.normalized||!1)}};y("POSITION",j.e.PositionKind),y("NORMAL",j.e.NormalKind),y("TANGENT",j.e.TangentKind),y("TEXCOORD_0",j.e.UVKind),y("TEXCOORD_1",j.e.UV2Kind),y("TEXCOORD_2",j.e.UV3Kind),y("TEXCOORD_3",j.e.UV4Kind),y("TEXCOORD_4",j.e.UV5Kind),y("TEXCOORD_5",j.e.UV6Kind),y("JOINTS_0",j.e.MatricesIndicesKind),y("WEIGHTS_0",j.e.MatricesWeightsKind),y("COLOR_0",j.e.ColorKind);const E=Q.Get(b,this._loader.kj.bufferViews,F.bufferView);return E._dracoBabylonGeometry||(E._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${E.index}`,E).then((z=>(this.dracoCompression||cT.e.Default)._decodeMeshToGeometryForGltfAsync(X.name,this._loader.babylonScene,z,A,u).catch((z=>{throw new Error(`${T}: ${z.message}`)}))))),E._dracoBabylonGeometry}))}}f(pT),o(pT,!0,(T=>new HT(T)));var UT=X(12548),sT=X(11948),xT=X(12521),KT=X(12554);sT.b.AddNodeConstructor("Light_Type_0",((T,z)=>()=>new dT(T,F.j.Zero(),z)));class dT extends KT.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(T){this._shadowAngle=T,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(T){const z=this.needCube();if(this._direction=T,this.needCube()!==z&&this._shadowGenerators){const T=this._shadowGenerators.values();for(let z=T.next();!0!==z.done;z=T.next()){z.value.recreateShadowMap()}}}constructor(T,z,X){super(T,X),this._shadowAngle=Math.PI/2,this.position=z}getClassName(){return"PointLight"}getTypeID(){return xT.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(T){if(this.direction)return super.getShadowDirection(T);switch(T){case 0:return new F.j(1,0,0);case 1:return new F.j(-1,0,0);case 2:return new F.j(0,-1,0);case 3:return new F.j(0,1,0);case 4:return new F.j(0,0,1);case 5:return new F.j(0,0,-1)}return F.j.Zero()}_setDefaultShadowProjectionMatrix(T,z,X){const b=this.va().activeCamera;if(!b)return;const A=void 0!==this.shadowMinZ?this.shadowMinZ:b.qj,u=void 0!==this.shadowMaxZ?this.shadowMaxZ:b.maxZ,y=this.va().getEngine().useReverseDepthBuffer;F.d.PerspectiveFovLHToRef(this.shadowAngle,1,y?u:A,y?A:u,T,!0,this._scene.getEngine().isNDCHalfZRange,void 0,y)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(T,z){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,z):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,z),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,z),this}transferToNodeMaterialEffect(T,z){return this.computeTransformedInformation()?T.setFloat3(z,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):T.setFloat3(z,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(T,z){T["POINTLIGHT"+z]=!0}}(0,K.c)([(0,d.E)()],dT.prototype,"shadowAngle",null),(0,a.h)("BABYLON.PointLight",dT),sT.b.AddNodeConstructor("Light_Type_2",((T,z)=>()=>new NT(T,F.j.Zero(),F.j.Zero(),0,0,z)));class NT extends KT.b{get angle(){return this._angle}set angle(T){this._angle=T,this._cosHalfAngle=Math.cos(.5*T),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(T){this._innerAngle=T,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(T){this._shadowAngleScale=T,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(T){this._projectionTextureLightNear=T,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(T){this._projectionTextureLightFar=T,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(T){this._projectionTextureUpDirection=T,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(T){this._projectionTexture!==T&&(this._projectionTexture=T,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(NT._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):NT._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(T){return void 0!==T.onGeneratedObservable}static _IsTexture(T){return void 0!==T.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(T){this._projectionTextureProjectionLightMatrix=T,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(T,z,X,b,A,u){super(T,u),this._innerAngle=0,this._projectionTextureMatrix=F.d.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=F.j.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=F.j.Zero(),this._projectionTextureViewLightMatrix=F.d.Zero(),this._projectionTextureProjectionLightMatrix=F.d.Zero(),this._projectionTextureScalingMatrix=F.d.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=z,this.direction=X,this.angle=b,this.exponent=A}getClassName(){return"SpotLight"}getTypeID(){return xT.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(T){super._setDirection(T),this._projectionTextureViewLightDirty=!0}_setPosition(T){super._setPosition(T),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(T,z,X){const b=this.va().activeCamera;if(!b)return;this._shadowAngleScale=this._shadowAngleScale||1;const A=this._shadowAngleScale*this._angle,u=void 0!==this.shadowMinZ?this.shadowMinZ:b.qj,y=void 0!==this.shadowMaxZ?this.shadowMaxZ:b.maxZ,E=this.va().getEngine().useReverseDepthBuffer;F.d.PerspectiveFovLHToRef(A,1,E?y:u,E?u:y,T,!0,this._scene.getEngine().isNDCHalfZRange,void 0,E)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),F.d.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const T=this.projectionTextureLightFar,z=this.projectionTextureLightNear,X=T/(T-z),b=-X*z,A=1/Math.tan(this._angle/2);F.d.FromValuesToRef(A/1,0,0,0,0,A,0,0,0,0,X,1,0,0,b,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof C.c){const T=this._projectionTexture.uScale/2,z=this._projectionTexture.vScale/2;F.d.FromValuesToRef(T,0,0,0,0,z,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(T,z){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),T.setMatrix("textureProjectionMatrix"+z,this._projectionTextureMatrix),T.setTexture("projectionLightTexture"+z,this.projectionTexture)),this}transferToEffect(T,z){let X;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,z),X=F.j.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,z),X=F.j.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",X.x,X.y,X.z,this._cosHalfAngle,z),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,z),this}transferToNodeMaterialEffect(T,z){let X;return X=this.computeTransformedInformation()?F.j.Normalize(this.transformedDirection):F.j.Normalize(this.direction),this.va().useRightHandedSystem?T.setFloat3(z,-X.x,-X.y,-X.z):T.setFloat3(z,X.x,X.y,X.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(T){const z=this._scene.getEngine(),X=void 0!==this.shadowMinZ?this.shadowMinZ:T.qj;return z.useReverseDepthBuffer&&z.isNDCHalfZRange?X:this._scene.getEngine().isNDCHalfZRange?0:X}getDepthMaxZ(T){const z=this._scene.getEngine(),X=void 0!==this.shadowMaxZ?this.shadowMaxZ:T.maxZ;return z.useReverseDepthBuffer&&z.isNDCHalfZRange?0:X}prepareLightSpecificDefines(T,z){T["SPOTLIGHT"+z]=!0,T["PROJECTEDLIGHTTEXTURE"+z]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,K.c)([(0,d.E)()],NT.prototype,"angle",null),(0,K.c)([(0,d.E)()],NT.prototype,"innerAngle",null),(0,K.c)([(0,d.E)()],NT.prototype,"shadowAngleScale",null),(0,K.c)([(0,d.E)()],NT.prototype,"exponent",void 0),(0,K.c)([(0,d.E)()],NT.prototype,"projectionTextureLightNear",null),(0,K.c)([(0,d.E)()],NT.prototype,"projectionTextureLightFar",null),(0,K.c)([(0,d.E)()],NT.prototype,"projectionTextureUpDirection",null),(0,K.c)([(0,d.x)("projectedLightTexture")],NT.prototype,"_projectionTexture",void 0),(0,a.h)("BABYLON.SpotLight",NT);const lT="KHR_lights_punctual";class aT{constructor(T){this.name=lT,this._loader=T,this.enabled=this._loader.isExtensionUsed(lT)}dispose(){this._loader=null,delete this._lights}onLoading(){const T=this._loader.kj.extensions;if(T&&T[this.name]){const z=T[this.name];this._lights=z.lights,Q.Assign(this._lights)}}loadNodeAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,u)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(T,z,(T=>{let z;const y=Q.Get(b,this._lights,u.eb),E=y.name||T.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,y.type){case"directional":{const T=new UT.d(E,F.j.Backward(),this._loader.babylonScene);T.position.Gd(0),z=T;break}case"point":z=new dT(E,F.j.Zero(),this._loader.babylonScene);break;case"spot":{const T=new NT(E,F.j.Zero(),F.j.Backward(),0,1,this._loader.babylonScene);T.angle=2*(y.spot&&y.spot.outerConeAngle||Math.PI/4),T.innerAngle=2*(y.spot&&y.spot.innerConeAngle||0),z=T;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${b}: Invalid light type (${y.type})`)}z._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,y._babylonLight=z,z.falloffType=xT.c.FALLOFF_GLTF,z.Yh=y.color?A.b.xd(y.color):A.b.White(),z.uj=void 0==y.uj?1:y.uj,z.range=void 0==y.range?Number.MAX_VALUE:y.range,z.parent=T,this._loader._babylonLights.push(z),w.AddPointerMetadata(z,b),X(T)})))))}}f(lT),o(lT,!0,(T=>new aT(T)));const qT="KHR_materials_pbrSpecularGlossiness";class VT{constructor(T){this.name=qT,this.order=200,this._loader=T,this.enabled=this._loader.isExtensionUsed(qT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>{const A=new Array;return A.push(this._loader.loadMaterialBasePropertiesAsync(T,z,X)),A.push(this._loadSpecularGlossinessPropertiesAsync(b,F,X)),this._loader.loadMaterialAlphaProperties(T,z,X),Promise.all(A).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(T,z,X){if(!(X instanceof V))throw new Error(`${T}: Material type not supported`);const b=new Array;return X.metallic=null,X.roughness=null,z.diffuseFactor?(X.albedoColor=A.b.xd(z.diffuseFactor),X.alpha=z.diffuseFactor[3]):X.albedoColor=A.b.White(),X.reflectivityColor=z.specularFactor?A.b.xd(z.specularFactor):A.b.White(),X.microSurface=void 0==z.glossinessFactor?1:z.glossinessFactor,z.diffuseTexture&&b.push(this._loader.loadTextureInfoAsync(`${T}/diffuseTexture`,z.diffuseTexture,(T=>{T.name=`${X.name} (Diffuse)`,X.albedoTexture=T}))),z.specularGlossinessTexture&&(b.push(this._loader.loadTextureInfoAsync(`${T}/specularGlossinessTexture`,z.specularGlossinessTexture,(T=>{T.name=`${X.name} (Specular Glossiness)`,X.reflectivityTexture=T,X.reflectivityTexture.ld=!0}))),X.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(b).then((()=>{}))}}f(qT),o(qT,!0,(T=>new VT(T)));const CT="KHR_materials_unlit";class GT{constructor(T){this.name=CT,this.order=210,this._loader=T,this.enabled=this._loader.isExtensionUsed(CT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,(()=>this._loadUnlitPropertiesAsync(T,z,X)))}_loadUnlitPropertiesAsync(T,z,X){if(!(X instanceof V))throw new Error(`${T}: Material type not supported`);const b=new Array;X.unlit=!0;const F=z.pbrMetallicRoughness;return F&&(F.baseColorFactor?(X.albedoColor=A.b.xd(F.baseColorFactor),X.alpha=F.baseColorFactor[3]):X.albedoColor=A.b.White(),F.baseColorTexture&&b.push(this._loader.loadTextureInfoAsync(`${T}/baseColorTexture`,F.baseColorTexture,(T=>{T.name=`${X.name} (Base Color)`,X.albedoTexture=T})))),z.doubleSided&&(X.Ke=!1,X.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(T,z,X),Promise.all(b).then((()=>{}))}}f(CT),o(CT,!0,(T=>new GT(T)));const jT="KHR_materials_clearcoat";class ZT{constructor(T){this.name=jT,this.order=190,this._loader=T,this.enabled=this._loader.isExtensionUsed(jT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(T,z,X)),A.push(this._loadClearCoatPropertiesAsync(b,F,X)),Promise.all(A).then((()=>{}))}))}_loadClearCoatPropertiesAsync(T,z,X){if(!(X instanceof V))throw new Error(`${T}: Material type not supported`);const b=new Array;return X.clearCoat.isEnabled=!0,X.clearCoat.useRoughnessFromMainTexture=!1,X.clearCoat.remapF0OnInterfaceChange=!1,void 0!=z.clearcoatFactor?X.clearCoat.uj=z.clearcoatFactor:X.clearCoat.uj=0,z.clearcoatTexture&&b.push(this._loader.loadTextureInfoAsync(`${T}/clearcoatTexture`,z.clearcoatTexture,(T=>{T.name=`${X.name} (ClearCoat)`,X.clearCoat.texture=T}))),void 0!=z.clearcoatRoughnessFactor?X.clearCoat.roughness=z.clearcoatRoughnessFactor:X.clearCoat.roughness=0,z.clearcoatRoughnessTexture&&(z.clearcoatRoughnessTexture.nonColorData=!0,b.push(this._loader.loadTextureInfoAsync(`${T}/clearcoatRoughnessTexture`,z.clearcoatRoughnessTexture,(T=>{T.name=`${X.name} (ClearCoat Roughness)`,X.clearCoat.textureRoughness=T})))),z.clearcoatNormalTexture&&(z.clearcoatNormalTexture.nonColorData=!0,b.push(this._loader.loadTextureInfoAsync(`${T}/clearcoatNormalTexture`,z.clearcoatNormalTexture,(T=>{T.name=`${X.name} (ClearCoat Normal)`,X.clearCoat.bumpTexture=T}))),X.invertNormalMapX=!X.va().useRightHandedSystem,X.invertNormalMapY=X.va().useRightHandedSystem,void 0!=z.clearcoatNormalTexture.scale&&(X.clearCoat.bumpTexture.level=z.clearcoatNormalTexture.scale)),Promise.all(b).then((()=>{}))}}f(jT),o(jT,!0,(T=>new ZT(T)));const mT="KHR_materials_iridescence";class ST{constructor(T){this.name=mT,this.order=195,this._loader=T,this.enabled=this._loader.isExtensionUsed(mT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(T,z,X)),A.push(this._loadIridescencePropertiesAsync(b,F,X)),Promise.all(A).then((()=>{}))}))}_loadIridescencePropertiesAsync(T,z,X){if(!(X instanceof V))throw new Error(`${T}: Material type not supported`);const b=new Array;return X.iridescence.isEnabled=!0,X.iridescence.uj=z.iridescenceFactor??0,X.iridescence.indexOfRefraction=z.iridescenceIor??z.iridescenceIOR??1.3,X.iridescence.minimumThickness=z.iridescenceThicknessMinimum??100,X.iridescence.maximumThickness=z.iridescenceThicknessMaximum??400,z.iridescenceTexture&&b.push(this._loader.loadTextureInfoAsync(`${T}/iridescenceTexture`,z.iridescenceTexture,(T=>{T.name=`${X.name} (Iridescence)`,X.iridescence.texture=T}))),z.iridescenceThicknessTexture&&b.push(this._loader.loadTextureInfoAsync(`${T}/iridescenceThicknessTexture`,z.iridescenceThicknessTexture,(T=>{T.name=`${X.name} (Iridescence Thickness)`,X.iridescence.thicknessTexture=T}))),Promise.all(b).then((()=>{}))}}f(mT),o(mT,!0,(T=>new ST(T)));const nT="KHR_materials_anisotropy";class OT{constructor(T){this.name=nT,this.order=195,this._loader=T,this.enabled=this._loader.isExtensionUsed(nT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(T,z,X)),A.push(this._loadIridescencePropertiesAsync(b,F,X)),Promise.all(A).then((()=>{}))}))}_loadIridescencePropertiesAsync(T,z,X){if(!(X instanceof V))throw new Error(`${T}: Material type not supported`);const b=new Array;return X.anisotropy.isEnabled=!0,X.anisotropy.uj=z.anisotropyStrength??0,X.anisotropy.angle=z.anisotropyRotation??0,z.anisotropyTexture&&(z.anisotropyTexture.nonColorData=!0,b.push(this._loader.loadTextureInfoAsync(`${T}/anisotropyTexture`,z.anisotropyTexture,(T=>{T.name=`${X.name} (Anisotropy Intensity)`,X.anisotropy.texture=T})))),Promise.all(b).then((()=>{}))}}f(nT),o(nT,!0,(T=>new OT(T)));const PT="KHR_materials_emissive_strength";class WT{constructor(T){this.name=PT,this.order=170,this._loader=T,this.enabled=this._loader.isExtensionUsed(PT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>this._loader.loadMaterialPropertiesAsync(T,z,X).then((()=>{this._loadEmissiveProperties(b,F,X)}))))}_loadEmissiveProperties(T,z,X){if(!(X instanceof V))throw new Error(`${T}: Material type not supported`);void 0!==z.emissiveStrength&&(X.emissiveIntensity=z.emissiveStrength)}}f(PT),o(PT,!0,(T=>new WT(T)));const BT="KHR_materials_sheen";class eT{constructor(T){this.name=BT,this.order=190,this._loader=T,this.enabled=this._loader.isExtensionUsed(BT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(T,z,X)),A.push(this._loadSheenPropertiesAsync(b,F,X)),Promise.all(A).then((()=>{}))}))}_loadSheenPropertiesAsync(T,z,X){if(!(X instanceof V))throw new Error(`${T}: Material type not supported`);const b=new Array;return X.sheen.isEnabled=!0,X.sheen.uj=1,void 0!=z.sheenColorFactor?X.sheen.color=A.b.xd(z.sheenColorFactor):X.sheen.color=A.b.Black(),z.sheenColorTexture&&b.push(this._loader.loadTextureInfoAsync(`${T}/sheenColorTexture`,z.sheenColorTexture,(T=>{T.name=`${X.name} (Sheen Color)`,X.sheen.texture=T}))),void 0!==z.sheenRoughnessFactor?X.sheen.roughness=z.sheenRoughnessFactor:X.sheen.roughness=0,z.sheenRoughnessTexture&&(z.sheenRoughnessTexture.nonColorData=!0,b.push(this._loader.loadTextureInfoAsync(`${T}/sheenRoughnessTexture`,z.sheenRoughnessTexture,(T=>{T.name=`${X.name} (Sheen Roughness)`,X.sheen.textureRoughness=T})))),X.sheen.albedoScaling=!0,X.sheen.useRoughnessFromMainTexture=!1,Promise.all(b).then((()=>{}))}}f(BT),o(BT,!0,(T=>new eT(T)));const RT="KHR_materials_specular";class YT{constructor(T){this.name=RT,this.order=190,this._loader=T,this.enabled=this._loader.isExtensionUsed(RT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(T,z,X)),A.push(this._loadSpecularPropertiesAsync(b,F,X)),Promise.all(A).then((()=>{}))}))}_loadSpecularPropertiesAsync(T,z,X){if(!(X instanceof V))throw new Error(`${T}: Material type not supported`);const b=new Array;return void 0!==z.specularFactor&&(X.metallicF0Factor=z.specularFactor),void 0!==z.specularColorFactor&&(X.metallicReflectanceColor=A.b.xd(z.specularColorFactor)),z.specularTexture&&(z.specularTexture.nonColorData=!0,b.push(this._loader.loadTextureInfoAsync(`${T}/specularTexture`,z.specularTexture,(T=>{T.name=`${X.name} (Specular)`,X.metallicReflectanceTexture=T,X.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),z.specularColorTexture&&b.push(this._loader.loadTextureInfoAsync(`${T}/specularColorTexture`,z.specularColorTexture,(T=>{T.name=`${X.name} (Specular Color)`,X.reflectanceTexture=T}))),Promise.all(b).then((()=>{}))}}f(RT),o(RT,!0,(T=>new YT(T)));const iT="KHR_materials_ior";class tT{constructor(T){this.name=iT,this.order=180,this._loader=T,this.enabled=this._loader.isExtensionUsed(iT)}dispose(){this._loader=null}loadMaterialPropertiesAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(T,z,X)),A.push(this._loadIorPropertiesAsync(b,F,X)),Promise.all(A).then((()=>{}))}))}_loadIorPropertiesAsync(T,z,X){if(!(X instanceof V))throw new Error(`${T}: Material type not supported`);return void 0!==z.ior?X.indexOfRefraction=z.ior:X.indexOfRefraction=tT._DEFAULT_IOR,Promise.resolve()}}tT._DEFAULT_IOR=1.5,f(iT),o(iT,!0,(T=>new tT(T)));const gT="KHR_materials_variants";class MT{constructor(T){this.name=gT,this._loader=T,this.enabled=this._loader.isExtensionUsed(gT)}dispose(){this._loader=null}static GetAvailableVariants(T){const z=this._GetExtensionMetadata(T);return z?Object.keys(z.variants):[]}getAvailableVariants(T){return MT.GetAvailableVariants(T)}static SelectVariant(T,z){const X=this._GetExtensionMetadata(T);if(!X)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${gT} extension`);const b=T=>{const z=X.variants[T];if(z)for(const X of z)X.mesh.material=X.material};if(z instanceof Array)for(const F of z)b(F);else b(z);X.lastSelected=z}selectVariant(T,z){MT.SelectVariant(T,z)}static Reset(T){const z=this._GetExtensionMetadata(T);if(!z)throw new Error(`Cannot reset on a glTF mesh that does not have the ${gT} extension`);for(const X of z.original)X.mesh.material=X.material;z.lastSelected=null}reset(T){MT.Reset(T)}static GetLastSelectedVariant(T){const z=this._GetExtensionMetadata(T);if(!z)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${gT} extension`);return z.lastSelected}getLastSelectedVariant(T){return MT.GetLastSelectedVariant(T)}static _GetExtensionMetadata(T){var z,X;return(null===T||void 0===T||null===(z=T._internalMetadata)||void 0===z||null===(X=z.kj)||void 0===X?void 0:X[gT])||null}onLoading(){const T=this._loader.kj.extensions;if(T&&T[this.name]){const z=T[this.name];this._variants=z.variants}}_loadMeshPrimitiveAsync(T,z,X,b,F,A){return w.LoadExtensionAsync(T,F,this.name,((u,y)=>{const E=new Array;return E.push(this._loader._loadMeshPrimitiveAsync(T,z,X,b,F,(z=>{if(A(z),z instanceof S.e){const X=w._GetDrawMode(T,F.mode),b=this._loader.rootBabylonMesh,A=b?b._internalMetadata=b._internalMetadata||{}:{},v=A.kj=A.kj||{},k=v[gT]=v[gT]||{lastSelected:null,original:[],variants:{}};k.original.push({mesh:z,material:z.material});for(let T=0;T<y.mappings.length;++T){const F=y.mappings[T],A=Q.Get(`${u}/mappings/${T}/material`,this._loader.kj.materials,F.material);E.push(this._loader._loadMaterialAsync(`#/materials/${F.material}`,A,z,X,(T=>{for(let X=0;X<F.variants.length;++X){const A=F.variants[X],u=Q.Get(`/extensions/${gT}/variants/${A}`,this._variants,A);k.variants[u.name]=k.variants[u.name]||[],k.variants[u.name].push({mesh:z,material:T}),z.onClonedObservable.add((T=>{const X=T;let F=null,A=X;do{if(A=A.parent,!A)return;F=MT._GetExtensionMetadata(A)}while(null===F);if(b&&F===MT._GetExtensionMetadata(b)){A._internalMetadata={};for(const T in b._internalMetadata)A._internalMetadata[T]=b._internalMetadata[T];A._internalMetadata.kj=[];for(const T in b._internalMetadata.kj)A._internalMetadata.kj[T]=b._internalMetadata.kj[T];A._internalMetadata.kj[gT]={lastSelected:null,original:[],variants:{}};for(const T of F.original)A._internalMetadata.kj[gT].original.push({mesh:T.mesh,material:T.material});for(const T in F.variants)if(Object.prototype.hasOwnProperty.call(F.variants,T)){A._internalMetadata.kj[gT].variants[T]=[];for(const z of F.variants[T])A._internalMetadata.kj[gT].variants[T].push({mesh:z.mesh,material:z.material})}F=A._internalMetadata.kj[gT]}for(const b of F.original)b.mesh===z&&(b.mesh=X);for(const b of F.variants[u.name])b.mesh===z&&(b.mesh=X)}))}})))}}}))),Promise.all(E).then((T=>{let[z]=T;return z}))}))}}f(gT),o(gT,!0,(T=>new MT(T)));var rT=X(1483);class oT{}oT.AUTOSAMPLERSUFFIX="Sampler",oT.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",oT.ALPHA_DISABLE=0,oT.ALPHA_ADD=1,oT.ALPHA_COMBINE=2,oT.ALPHA_SUBTRACT=3,oT.ALPHA_MULTIPLY=4,oT.ALPHA_MAXIMIZED=5,oT.ALPHA_ONEONE=6,oT.ALPHA_PREMULTIPLIED=7,oT.ALPHA_PREMULTIPLIED_PORTERDUFF=8,oT.ALPHA_INTERPOLATE=9,oT.ALPHA_SCREENMODE=10,oT.ALPHA_ONEONE_ONEONE=11,oT.ALPHA_ALPHATOCOLOR=12,oT.ALPHA_REVERSEONEMINUS=13,oT.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,oT.ALPHA_ONEONE_ONEZERO=15,oT.ALPHA_EXCLUSION=16,oT.ALPHA_LAYER_ACCUMULATE=17,oT.ALPHA_EQUATION_ADD=0,oT.ALPHA_EQUATION_SUBSTRACT=1,oT.ALPHA_EQUATION_REVERSE_SUBTRACT=2,oT.ALPHA_EQUATION_MAX=3,oT.ALPHA_EQUATION_MIN=4,oT.ALPHA_EQUATION_DARKEN=5,oT.DELAYLOADSTATE_NONE=0,oT.DELAYLOADSTATE_LOADED=1,oT.DELAYLOADSTATE_LOADING=2,oT.DELAYLOADSTATE_NOTLOADED=4,oT.NEVER=512,oT.ALWAYS=519,oT.LESS=513,oT.EQUAL=514,oT.LEQUAL=515,oT.GREATER=516,oT.GEQUAL=518,oT.NOTEQUAL=517,oT.KEEP=7680,oT.ZERO=0,oT.REPLACE=7681,oT.INCR=7682,oT.DECR=7683,oT.INVERT=5386,oT.INCR_WRAP=34055,oT.DECR_WRAP=34056,oT.TEXTURE_CLAMP_ADDRESSMODE=0,oT.TEXTURE_WRAP_ADDRESSMODE=1,oT.TEXTURE_MIRROR_ADDRESSMODE=2,oT.TEXTURE_CREATIONFLAG_STORAGE=1,oT.TEXTUREFORMAT_ALPHA=0,oT.TEXTUREFORMAT_LUMINANCE=1,oT.TEXTUREFORMAT_LUMINANCE_ALPHA=2,oT.TEXTUREFORMAT_RGB=4,oT.TEXTUREFORMAT_RGBA=5,oT.TEXTUREFORMAT_RED=6,oT.TEXTUREFORMAT_R=6,oT.TEXTUREFORMAT_RG=7,oT.TEXTUREFORMAT_RED_INTEGER=8,oT.TEXTUREFORMAT_R_INTEGER=8,oT.TEXTUREFORMAT_RG_INTEGER=9,oT.TEXTUREFORMAT_RGB_INTEGER=10,oT.TEXTUREFORMAT_RGBA_INTEGER=11,oT.TEXTUREFORMAT_BGRA=12,oT.TEXTUREFORMAT_DEPTH24_STENCIL8=13,oT.TEXTUREFORMAT_DEPTH32_FLOAT=14,oT.TEXTUREFORMAT_DEPTH16=15,oT.TEXTUREFORMAT_DEPTH24=16,oT.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,oT.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,oT.TEXTUREFORMAT_STENCIL8=19,oT.TEXTUREFORMAT_UNDEFINED=4294967295,oT.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,oT.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,oT.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,oT.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,oT.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,oT.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,oT.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,oT.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,oT.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,oT.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,oT.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,oT.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,oT.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,oT.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,oT.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,oT.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,oT.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,oT.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,oT.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,oT.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,oT.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,oT.TEXTURETYPE_UNSIGNED_BYTE=0,oT.TEXTURETYPE_UNSIGNED_INT=0,oT.TEXTURETYPE_FLOAT=1,oT.TEXTURETYPE_HALF_FLOAT=2,oT.TEXTURETYPE_BYTE=3,oT.TEXTURETYPE_SHORT=4,oT.TEXTURETYPE_UNSIGNED_SHORT=5,oT.TEXTURETYPE_INT=6,oT.TEXTURETYPE_UNSIGNED_INTEGER=7,oT.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,oT.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,oT.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,oT.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,oT.TEXTURETYPE_UNSIGNED_INT_24_8=12,oT.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,oT.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,oT.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,oT.TEXTURETYPE_UNDEFINED=16,oT.TEXTURE_2D=3553,oT.TEXTURE_2D_ARRAY=35866,oT.TEXTURE_CUBE_MAP=34067,oT.TEXTURE_CUBE_MAP_ARRAY=3735928559,oT.TEXTURE_3D=32879,oT.TEXTURE_NEAREST_SAMPLINGMODE=1,oT.TEXTURE_NEAREST_NEAREST=1,oT.TEXTURE_BILINEAR_SAMPLINGMODE=2,oT.TEXTURE_LINEAR_LINEAR=2,oT.TEXTURE_TRILINEAR_SAMPLINGMODE=3,oT.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,oT.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,oT.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,oT.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,oT.TEXTURE_NEAREST_LINEAR=7,oT.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,oT.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,oT.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,oT.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,oT.TEXTURE_LINEAR_NEAREST=12,oT.TEXTURE_EXPLICIT_MODE=0,oT.TEXTURE_SPHERICAL_MODE=1,oT.TEXTURE_PLANAR_MODE=2,oT.TEXTURE_CUBIC_MODE=3,oT.TEXTURE_PROJECTION_MODE=4,oT.TEXTURE_SKYBOX_MODE=5,oT.TEXTURE_INVCUBIC_MODE=6,oT.TEXTURE_EQUIRECTANGULAR_MODE=7,oT.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,oT.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,oT.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,oT.TEXTURE_FILTERING_QUALITY_HIGH=64,oT.TEXTURE_FILTERING_QUALITY_MEDIUM=16,oT.TEXTURE_FILTERING_QUALITY_LOW=8,oT.SCALEMODE_FLOOR=1,oT.SCALEMODE_NEAREST=2,oT.SCALEMODE_CEILING=3,oT.MATERIAL_TextureDirtyFlag=1,oT.MATERIAL_LightDirtyFlag=2,oT.MATERIAL_FresnelDirtyFlag=4,oT.MATERIAL_AttributesDirtyFlag=8,oT.MATERIAL_MiscDirtyFlag=16,oT.MATERIAL_PrePassDirtyFlag=32,oT.MATERIAL_AllDirtyFlag=63,oT.MATERIAL_TriangleFillMode=0,oT.MATERIAL_WireFrameFillMode=1,oT.MATERIAL_PointFillMode=2,oT.MATERIAL_PointListDrawMode=3,oT.MATERIAL_LineListDrawMode=4,oT.MATERIAL_LineLoopDrawMode=5,oT.MATERIAL_LineStripDrawMode=6,oT.MATERIAL_TriangleStripDrawMode=7,oT.MATERIAL_TriangleFanDrawMode=8,oT.MATERIAL_ClockWiseSideOrientation=0,oT.MATERIAL_CounterClockWiseSideOrientation=1,oT.ACTION_NothingTrigger=0,oT.ACTION_OnPickTrigger=1,oT.ACTION_OnLeftPickTrigger=2,oT.ACTION_OnRightPickTrigger=3,oT.ACTION_OnCenterPickTrigger=4,oT.ACTION_OnPickDownTrigger=5,oT.ACTION_OnDoublePickTrigger=6,oT.ACTION_OnPickUpTrigger=7,oT.ACTION_OnPickOutTrigger=16,oT.ACTION_OnLongPressTrigger=8,oT.ACTION_OnPointerOverTrigger=9,oT.ACTION_OnPointerOutTrigger=10,oT.ACTION_OnEveryFrameTrigger=11,oT.ACTION_OnIntersectionEnterTrigger=12,oT.ACTION_OnIntersectionExitTrigger=13,oT.ACTION_OnKeyDownTrigger=14,oT.ACTION_OnKeyUpTrigger=15,oT.PARTICLES_BILLBOARDMODE_Y=2,oT.PARTICLES_BILLBOARDMODE_ALL=7,oT.PARTICLES_BILLBOARDMODE_STRETCHED=8,oT.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,oT.MESHES_CULLINGSTRATEGY_STANDARD=0,oT.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,oT.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,oT.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,oT.SCENELOADER_NO_LOGGING=0,oT.SCENELOADER_MINIMAL_LOGGING=1,oT.SCENELOADER_SUMMARY_LOGGING=2,oT.SCENELOADER_DETAILED_LOGGING=3,oT.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,oT.PREPASS_POSITION_TEXTURE_TYPE=1,oT.PREPASS_VELOCITY_TEXTURE_TYPE=2,oT.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,oT.PREPASS_COLOR_TEXTURE_TYPE=4,oT.PREPASS_DEPTH_TEXTURE_TYPE=5,oT.PREPASS_NORMAL_TEXTURE_TYPE=6,oT.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,oT.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,oT.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,oT.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,oT.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,oT.PREPASS_ALBEDO_TEXTURE_TYPE=12,oT.BUFFER_CREATIONFLAG_READ=1,oT.BUFFER_CREATIONFLAG_WRITE=2,oT.BUFFER_CREATIONFLAG_READWRITE=3,oT.BUFFER_CREATIONFLAG_UNIFORM=4,oT.BUFFER_CREATIONFLAG_VERTEX=8,oT.BUFFER_CREATIONFLAG_INDEX=16,oT.BUFFER_CREATIONFLAG_STORAGE=32,oT.BUFFER_CREATIONFLAG_INDIRECT=64,oT.RENDERPASS_MAIN=0,oT.INPUT_ALT_KEY=18,oT.INPUT_CTRL_KEY=17,oT.INPUT_META_KEY1=91,oT.INPUT_META_KEY2=92,oT.INPUT_META_KEY3=93,oT.INPUT_SHIFT_KEY=16,oT.SNAPSHOTRENDERING_STANDARD=0,oT.SNAPSHOTRENDERING_FAST=1,oT.PERSPECTIVE_CAMERA=0,oT.ORTHOGRAPHIC_CAMERA=1,oT.FOVMODE_VERTICAL_FIXED=0,oT.FOVMODE_HORIZONTAL_FIXED=1,oT.RIG_MODE_NONE=0,oT.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,oT.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,oT.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,oT.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,oT.RIG_MODE_STEREOSCOPIC_INTERLACED=14,oT.RIG_MODE_VR=20,oT.RIG_MODE_CUSTOM=22,oT.MAX_SUPPORTED_UV_SETS=6,oT.GL_ALPHA_EQUATION_ADD=32774,oT.GL_ALPHA_EQUATION_MIN=32775,oT.GL_ALPHA_EQUATION_MAX=32776,oT.GL_ALPHA_EQUATION_SUBTRACT=32778,oT.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,oT.GL_ALPHA_FUNCTION_SRC=768,oT.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,oT.GL_ALPHA_FUNCTION_SRC_ALPHA=770,oT.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,oT.GL_ALPHA_FUNCTION_DST_ALPHA=772,oT.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,oT.GL_ALPHA_FUNCTION_DST_COLOR=774,oT.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,oT.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,oT.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,oT.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,oT.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,oT.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,oT.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,oT.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,oT.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,oT.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,oT.SnippetUrl="https://snippet.babylonjs.com",oT.FOGMODE_NONE=0,oT.FOGMODE_EXP=1,oT.FOGMODE_EXP2=2,oT.FOGMODE_LINEAR=3,oT.BYTE=5120,oT.UNSIGNED_BYTE=5121,oT.SHORT=5122,oT.UNSIGNED_SHORT=5123,oT.INT=5124,oT.UNSIGNED_INT=5125,oT.FLOAT=5126,oT.PositionKind="position",oT.NormalKind="Jd",oT.TangentKind="tangent",oT.UVKind="uv",oT.UV2Kind="uv2",oT.UV3Kind="uv3",oT.UV4Kind="uv4",oT.UV5Kind="uv5",oT.UV6Kind="uv6",oT.ColorKind="color",oT.ColorInstanceKind="instanceColor",oT.MatricesIndicesKind="matricesIndices",oT.MatricesWeightsKind="matricesWeights",oT.MatricesIndicesExtraKind="matricesIndicesExtra",oT.MatricesWeightsExtraKind="matricesWeightsExtra";class fT{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:oT.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(T,z){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...fT._GetDefaultOptions(),...T},this._scene=z,this._scene._transmissionHelper=this,this.onErrorObservable=new k.d,this._scene.Qd.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(T){if(!Object.keys(T).filter((z=>this._options[z]!==T[z])).length)return;const z={...this._options,...T},X=this._options;this._options=z,z.renderSize===X.renderSize&&z.renderTargetTextureType===X.renderTargetTextureType&&z.generateMipmaps===X.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=z.samples,this._opaqueRenderTarget.lodGenerationScale=z.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=z.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(T){return!!T&&!!(T instanceof V&&T.subSurface.isRefractionEnabled)}_addMesh(T){this._materialObservers[T.uniqueId]=T.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),u.g.SetImmediate((()=>{this._shouldRenderAsTransmission(T.material)?(T.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(T)&&this._transparentMeshesCache.push(T)):-1===this._opaqueMeshesCache.indexOf(T)&&this._opaqueMeshesCache.push(T)}))}_removeMesh(T){T.onMaterialChangedObservable.remove(this._materialObservers[T.uniqueId]),delete this._materialObservers[T.uniqueId];let z=this._transparentMeshesCache.indexOf(T);-1!==z&&this._transparentMeshesCache.splice(z,1),z=this._opaqueMeshesCache.indexOf(T),-1!==z&&this._opaqueMeshesCache.splice(z,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(T){const z=this._transparentMeshesCache.indexOf(T),X=this._opaqueMeshesCache.indexOf(T);this._shouldRenderAsTransmission(T.material)?(T.material instanceof V&&(T.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==X?(this._opaqueMeshesCache.splice(X,1),this._transparentMeshesCache.push(T)):-1===z&&this._transparentMeshesCache.push(T)):-1!==z?(this._transparentMeshesCache.splice(z,1),this._opaqueMeshesCache.push(T)):-1===X&&this._opaqueMeshesCache.push(T)}_isRenderTargetValid(){var T;return null!==(null===(T=this._opaqueRenderTarget)||void 0===T?void 0:T.getInternalTexture())}_setupRenderTargets(){var T;let z,X;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new rT.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(T=this._options.clearColor)||void 0===T?void 0:T.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((T=>{X=this._scene.environmentIntensity,this._scene.environmentIntensity=1,z=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?T.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(T.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=X,this._scene.imageProcessingConfiguration._applyByPostProcess=z})),this._transparentMeshesCache.forEach((T=>{this._shouldRenderAsTransmission(T.material)&&(T.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const hT="KHR_materials_transmission";class QT{constructor(T){this.name=hT,this.order=175,this._loader=T,this.enabled=this._loader.isExtensionUsed(hT),this.enabled&&(T.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(T,z,X)),A.push(this._loadTransparentPropertiesAsync(b,z,X,F)),Promise.all(A).then((()=>{}))}))}_loadTransparentPropertiesAsync(T,z,X,b){if(!(X instanceof V))throw new Error(`${T}: Material type not supported`);const F=X;if(F.subSurface.isRefractionEnabled=!0,F.subSurface.volumeIndexOfRefraction=1,F.subSurface.useAlbedoToTintRefraction=!0,void 0===b.transmissionFactor)return F.subSurface.refractionIntensity=0,F.subSurface.isRefractionEnabled=!1,Promise.resolve();{var A;F.subSurface.refractionIntensity=b.transmissionFactor;const T=F.va();if(F.subSurface.refractionIntensity&&!T._transmissionHelper)new fT({},F.va());else if(F.subSurface.refractionIntensity&&(null===(A=T._transmissionHelper)||void 0===A||!A._isRenderTargetValid())){var u;null===(u=T._transmissionHelper)||void 0===u||u._setupRenderTargets()}}return F.subSurface.minimumThickness=0,F.subSurface.maximumThickness=0,b.transmissionTexture?(b.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${T}/transmissionTexture`,b.transmissionTexture,void 0).then((T=>{T.name=`${X.name} (Transmission)`,F.subSurface.refractionIntensityTexture=T,F.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}f(hT),o(hT,!0,(T=>new QT(T)));const wT="KHR_materials_diffuse_transmission";class JT{constructor(T){this.name=wT,this.order=174,this._loader=T,this.enabled=this._loader.isExtensionUsed(wT),this.enabled&&(T.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(T,z,X)),A.push(this._loadTranslucentPropertiesAsync(b,z,X,F)),Promise.all(A).then((()=>{}))}))}_loadTranslucentPropertiesAsync(T,z,X,b){if(!(X instanceof V))throw new Error(`${T}: Material type not supported`);const F=X;if(F.subSurface.isTranslucencyEnabled=!0,F.subSurface.volumeIndexOfRefraction=1,F.subSurface.minimumThickness=0,F.subSurface.maximumThickness=0,F.subSurface.useAlbedoToTintTranslucency=!1,void 0===b.diffuseTransmissionFactor)return F.subSurface.translucencyIntensity=0,F.subSurface.isTranslucencyEnabled=!1,Promise.resolve();F.subSurface.translucencyIntensity=b.diffuseTransmissionFactor;const u=new Array;return F.subSurface.useGltfStyleTextures=!0,b.diffuseTransmissionTexture&&(b.diffuseTransmissionTexture.nonColorData=!0,u.push(this._loader.loadTextureInfoAsync(`${T}/diffuseTransmissionTexture`,b.diffuseTransmissionTexture).then((T=>{T.name=`${X.name} (Diffuse Transmission)`,F.subSurface.translucencyIntensityTexture=T})))),void 0!==b.diffuseTransmissionColorFactor?F.subSurface.translucencyColor=A.b.xd(b.diffuseTransmissionColorFactor):F.subSurface.translucencyColor=A.b.White(),b.diffuseTransmissionColorTexture&&u.push(this._loader.loadTextureInfoAsync(`${T}/diffuseTransmissionColorTexture`,b.diffuseTransmissionColorTexture).then((T=>{T.name=`${X.name} (Diffuse Transmission Color)`,F.subSurface.translucencyColorTexture=T}))),Promise.all(u).then((()=>{}))}}f(wT),o(wT,!0,(T=>new JT(T)));const IT="KHR_materials_volume";class Tz{constructor(T){this.name=IT,this.order=173,this._loader=T,this.enabled=this._loader.isExtensionUsed(IT),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(T,z,X)),A.push(this._loadVolumePropertiesAsync(b,z,X,F)),Promise.all(A).then((()=>{}))}))}_loadVolumePropertiesAsync(T,z,X,b){if(!(X instanceof V))throw new Error(`${T}: Material type not supported`);if(!X.subSurface.isRefractionEnabled&&!X.subSurface.isTranslucencyEnabled||!b.thicknessFactor)return Promise.resolve();X.subSurface.volumeIndexOfRefraction=X.indexOfRefraction;const F=void 0!==b.attenuationDistance?b.attenuationDistance:Number.MAX_VALUE;return X.subSurface.tintColorAtDistance=F,void 0!==b.attenuationColor&&3==b.attenuationColor.length&&X.subSurface.tintColor.Cd(b.attenuationColor[0],b.attenuationColor[1],b.attenuationColor[2]),X.subSurface.minimumThickness=0,X.subSurface.maximumThickness=b.thicknessFactor,X.subSurface.useThicknessAsDepth=!0,b.thicknessTexture?(b.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${T}/thicknessTexture`,b.thicknessTexture).then((T=>{T.name=`${X.name} (Thickness)`,X.subSurface.thicknessTexture=T,X.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}f(IT),o(IT,!0,(T=>new Tz(T)));const zz="KHR_materials_dispersion";class Xz{constructor(T){this.name=zz,this.order=174,this._loader=T,this.enabled=this._loader.isExtensionUsed(zz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>{const A=new Array;return A.push(this._loader.loadMaterialPropertiesAsync(T,z,X)),A.push(this._loadDispersionPropertiesAsync(b,z,X,F)),Promise.all(A).then((()=>{}))}))}_loadDispersionPropertiesAsync(T,z,X,b){if(!(X instanceof V))throw new Error(`${T}: Material type not supported`);return X.subSurface.isRefractionEnabled&&b.dispersion?(X.subSurface.isDispersionEnabled=!0,X.subSurface.dispersion=b.dispersion,Promise.resolve()):Promise.resolve()}}f(zz),o(zz,!0,(T=>new Xz(T)));const bz="KHR_mesh_quantization";class Fz{constructor(T){this.name=bz,this.enabled=T.isExtensionUsed(bz)}dispose(){}}f(bz),o(bz,!0,(T=>new Fz(T)));const Az="KHR_texture_basisu";class uz{constructor(T){this.name=Az,this._loader=T,this.enabled=T.isExtensionUsed(Az)}dispose(){this._loader=null}_loadTextureAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>{const A=void 0==z.sampler?w.DefaultSampler:Q.Get(`${T}/sampler`,this._loader.kj.samplers,z.sampler),u=Q.Get(`${b}/source`,this._loader.kj.images,F.source);return this._loader._createTextureAsync(T,A,u,(T=>{X(T)}),z._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!z._textureInfo.nonColorData)}))}}f(Az),o(Az,!0,(T=>new uz(T)));const yz="KHR_texture_transform";class Ez{constructor(T){this.name=yz,this._loader=T,this.enabled=this._loader.isExtensionUsed(yz)}dispose(){this._loader=null}loadTextureInfoAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((b,F)=>this._loader.loadTextureInfoAsync(T,z,(T=>{if(!(T instanceof C.c))throw new Error(`${b}: Texture type not supported`);F.offset&&(T.uOffset=F.offset[0],T.vOffset=F.offset[1]),T.uRotationCenter=0,T.vRotationCenter=0,F.rotation&&(T.wAng=-F.rotation),F.scale&&(T.uScale=F.scale[0],T.vScale=F.scale[1]),void 0!=F.texCoord&&(T.coordinatesIndex=F.texCoord),X(T)}))))}}f(yz),o(yz,!0,(T=>new Ez(T)));const vz="KHR_xmp_json_ld";class kz{constructor(T){this.name=vz,this.order=100,this._loader=T,this.enabled=this._loader.isExtensionUsed(vz)}dispose(){this._loader=null}onLoading(){var T,z,X;if(null===this._loader.rootBabylonMesh)return;const b=null===(T=this._loader.kj.extensions)||void 0===T?void 0:T.KHR_xmp_json_ld,F=null===(z=this._loader.kj.asset)||void 0===z||null===(X=z.extensions)||void 0===X?void 0:X.KHR_xmp_json_ld;if(b&&F){const T=+F.packet;b.packets&&T<b.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=b.packets[T])}}}function Lz(T,z,X,b){return A.b.xd(z,X).scale(b)}function Dz(T,z,X,b){return z[X]*b}function cz(T,z,X,b){return-z[X]*b}function pz(T,z,X,b){return z[X+1]*b}function Hz(T,z,X,b){return z[X]*b*2}function Uz(T){return{scale:[new xz(D.e.ANIMATIONTYPE_FLOAT,`${T}.uScale`,Dz,(()=>2)),new xz(D.e.ANIMATIONTYPE_FLOAT,`${T}.vScale`,pz,(()=>2))],offset:[new xz(D.e.ANIMATIONTYPE_FLOAT,`${T}.uOffset`,Dz,(()=>2)),new xz(D.e.ANIMATIONTYPE_FLOAT,`${T}.vOffset`,pz,(()=>2))],rotation:[new xz(D.e.ANIMATIONTYPE_FLOAT,`${T}.wAng`,cz,(()=>1))]}}f(vz),o(vz,!0,(T=>new kz(T)));class sz extends i{buildAnimations(T,z,X,b,F){F(T._babylonCamera,this._buildAnimation(z,X,b))}}class xz extends i{buildAnimations(T,z,X,b,F){for(const A in T._data)F(T._data[A].babylonMaterial,this._buildAnimation(z,X,b))}}class Kz extends i{buildAnimations(T,z,X,b,F){F(T._babylonLight,this._buildAnimation(z,X,b))}}const dz={__array__:{__target__:!0,...g}},Nz={__array__:{__target__:!0,orthographic:{xmag:[new sz(D.e.ANIMATIONTYPE_FLOAT,"orthoLeft",cz,(()=>1)),new sz(D.e.ANIMATIONTYPE_FLOAT,"orthoRight",pz,(()=>1))],ymag:[new sz(D.e.ANIMATIONTYPE_FLOAT,"orthoBottom",cz,(()=>1)),new sz(D.e.ANIMATIONTYPE_FLOAT,"orthoTop",pz,(()=>1))],zfar:[new sz(D.e.ANIMATIONTYPE_FLOAT,"maxZ",Dz,(()=>1))],znear:[new sz(D.e.ANIMATIONTYPE_FLOAT,"qj",Dz,(()=>1))]},perspective:{yfov:[new sz(D.e.ANIMATIONTYPE_FLOAT,"fov",Dz,(()=>1))],zfar:[new sz(D.e.ANIMATIONTYPE_FLOAT,"maxZ",Dz,(()=>1))],znear:[new sz(D.e.ANIMATIONTYPE_FLOAT,"qj",Dz,(()=>1))]}}},lz={nodes:dz,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new xz(D.e.ANIMATIONTYPE_COLOR3,"albedoColor",Lz,(()=>4)),new xz(D.e.ANIMATIONTYPE_FLOAT,"alpha",(function(T,z,X,b){return z[X+3]*b}),(()=>4))],metallicFactor:[new xz(D.e.ANIMATIONTYPE_FLOAT,"metallic",Dz,(()=>1))],roughnessFactor:[new xz(D.e.ANIMATIONTYPE_FLOAT,"roughness",Dz,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:Uz("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:Uz("metallicTexture")}}},emissiveFactor:[new xz(D.e.ANIMATIONTYPE_COLOR3,"emissiveColor",Lz,(()=>3))],normalTexture:{scale:[new xz(D.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Dz,(()=>1))],extensions:{KHR_texture_transform:Uz("bumpTexture")}},occlusionTexture:{strength:[new xz(D.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Dz,(()=>1))],extensions:{KHR_texture_transform:Uz("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:Uz("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new xz(D.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Dz,(()=>1))],anisotropyRotation:[new xz(D.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Dz,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:Uz("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new xz(D.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Dz,(()=>1))],clearcoatRoughnessFactor:[new xz(D.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Dz,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:Uz("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new xz(D.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Dz,(()=>1))],extensions:{KHR_texture_transform:Uz("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:Uz("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new xz(D.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Dz,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new xz(D.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Dz,(()=>1))]},KHR_materials_ior:{ior:[new xz(D.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Dz,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new xz(D.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Dz,(()=>1))],iridescenceIor:[new xz(D.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Dz,(()=>1))],iridescenceThicknessMinimum:[new xz(D.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Dz,(()=>1))],iridescenceThicknessMaximum:[new xz(D.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Dz,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:Uz("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:Uz("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new xz(D.e.ANIMATIONTYPE_COLOR3,"sheen.color",Lz,(()=>3))],sheenRoughnessFactor:[new xz(D.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",Dz,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:Uz("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:Uz("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new xz(D.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Dz,(()=>1))],specularColorFactor:[new xz(D.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Lz,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:Uz("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:Uz("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new xz(D.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Dz,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:Uz("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new xz(D.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Lz,(()=>3))],attenuationDistance:[new xz(D.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Dz,(()=>1))],thicknessFactor:[new xz(D.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Dz,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:Uz("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new xz(D.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Dz,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:Uz("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new xz(D.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Lz,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:Uz("subSurface.translucencyColorTexture")}}}}}},cameras:Nz,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new Kz(D.e.ANIMATIONTYPE_COLOR3,"diffuse",Lz,(()=>3))],uj:[new Kz(D.e.ANIMATIONTYPE_FLOAT,"intensity",Dz,(()=>1))],range:[new Kz(D.e.ANIMATIONTYPE_FLOAT,"range",Dz,(()=>1))],spot:{innerConeAngle:[new Kz(D.e.ANIMATIONTYPE_FLOAT,"innerAngle",Hz,(()=>1))],outerConeAngle:[new Kz(D.e.ANIMATIONTYPE_FLOAT,"angle",Hz,(()=>1))]}}}}}};class az{constructor(T,z){this._gltf=T,this._infoTree=z}convert(T){let z,X=this._gltf,b=this._infoTree;if(!T.startsWith("/"))throw new Error("Path must start with a /");const F=T.split("/");F.shift();for(const A of F){if(b.__array__)b=b.__array__;else if(b=b[A],!b)throw new Error(`Path ${T} is invalid`);if(void 0===X)throw new Error(`Path ${T} is invalid`);X=X[A],b.__target__&&(z=X)}return{object:z,info:b}}}const qz="KHR_animation_pointer";class Vz extends az{constructor(T){super(T,lz)}}class Cz{constructor(T){this.name=qz,this._loader=T,this._pathToObjectConverter=new Vz(this._loader.kj)}get enabled(){return this._loader.isExtensionUsed(qz)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(T,z,X,b,F){var A;const u=null===(A=b.target.extensions)||void 0===A?void 0:A.KHR_animation_pointer;if(!u||!this._pathToObjectConverter)return null;"pointer"!==b.target.path&&H.e.Warn(`${T}/target/path: Value (${b.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=b.target.node&&H.e.Warn(`${T}/target/node: Value (${b.target.node}) must not be present when using the ${this.name} extension`);const y=`${T}/extensions/${this.name}`,E=u.pointer;if(!E)throw new Error(`${y}: Pointer is missing`);try{const A=this._pathToObjectConverter.convert(E);return this._loader._loadAnimationChannelFromTargetInfoAsync(T,z,X,b,A,F)}catch(v){return H.e.Warn(`${y}/pointer: Invalid pointer (${E}) skipped`),null}}}f(qz),o(qz,!0,(T=>new Cz(T)));class Gz{constructor(T,z,X){this.frame=T,this.action=z,this.onlyOnce=X,this.isDone=!1}_clone(){return new Gz(this.frame,this.action,this.onlyOnce)}}var jz=X(1061),Zz=X(1071);class mz{get loop(){return this._loop}set loop(T){T!==this._loop&&(this._loop=T,this.updateOptions({loop:T}))}get currentTime(){var T;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(T=Zz.d.audioEngine)&&void 0!==T&&T.audioContext&&(this.isPlaying||this.isPaused)){const T=this.isPaused?0:Zz.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+T}return 0}get spatialSound(){return this._spatialSound}set spatialSound(T){if(T==this._spatialSound)return;const z=this.isPlaying;this.pause(),T?(this._spatialSound=T,this._updateSpatialParameters()):this._disableSpatialSound(),z&&this.play()}constructor(T,z,X){var b;let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new k.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=F.j.Zero(),this._localDirection=new F.j(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=T,X=X||p.e.LastCreatedScene)if(this._scene=X,mz._SceneComponentInitialization(X),this._readyToPlayCallback=A,this._customAttenuationFunction=(T,z,X,b,F)=>z<X?T*(1-z/X):0,y&&(this.autoplay=y.autoplay||!1,this._loop=y.loop||!1,void 0!==y.volume&&(this._volume=y.volume),this._spatialSound=y.spatialSound??!1,this.maxDistance=y.maxDistance??100,this.useCustomAttenuation=y.useCustomAttenuation??!1,this.rolloffFactor=y.rolloffFactor||1,this.refDistance=y.refDistance||1,this.distanceModel=y.distanceModel||"linear",this._playbackRate=y.playbackRate||1,this._streaming=y.streaming??!1,this._length=y.length,this._offset=y.offset),null!==(b=Zz.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&Zz.d.audioEngine.audioContext){this._soundGain=Zz.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let T=!0;if(z)try{"string"===typeof z?(this._urlType="String",this._url=z):z instanceof ArrayBuffer?this._urlType="ArrayBuffer":z instanceof HTMLMediaElement?this._urlType="MediaElement":z instanceof MediaStream?this._urlType="MediaStream":z instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(z)&&(this._urlType="Array");let X=[],b=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Zz.d.audioEngine.audioContext.createMediaElementSource(z),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Zz.d.audioEngine.audioContext.createMediaStreamSource(z),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":z.byteLength>0&&(b=!0,this._soundLoaded(z));break;case"AudioBuffer":this._audioBufferLoaded(z);break;case"String":X.push(z);case"Array":0===X.length&&(X=z);for(let T=0;T<X.length;T++){const z=X[T];if(b=y&&y.skipCodecCheck||-1!==z.indexOf(".mp3",z.length-4)&&Zz.d.audioEngine.isMP3supported||-1!==z.indexOf(".ogg",z.length-4)&&Zz.d.audioEngine.isOGGsupported||-1!==z.indexOf(".wav",z.length-4)||-1!==z.indexOf(".m4a",z.length-4)||-1!==z.indexOf(".mp4",z.length-4)||-1!==z.indexOf("blob:"),b){this._streaming?(this._htmlAudioElement=new Audio(z),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,u.g.SetCorsBehavior(z,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(z,(T=>{this._soundLoaded(T)}),void 0,!0,!0,(T=>{T&&H.e.Error("XHR "+T.status+" error on: "+z+"."),H.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:T=!1}T?b||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):H.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(E){H.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Zz.d.audioEngine&&!Zz.d.audioEngine.WarnedWebAudioUnsupported&&(H.e.Error("Web Audio is not supported by your browser."),Zz.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var T;null!==(T=Zz.d.audioEngine)&&void 0!==T&&T.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(T){var z;null!==(z=Zz.d.audioEngine)&&void 0!==z&&z.audioContext&&(this._audioBuffer=T,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(T){var z;null!==(z=Zz.d.audioEngine)&&void 0!==z&&z.audioContext&&Zz.d.audioEngine.audioContext.decodeAudioData(T,(T=>{this._audioBufferLoaded(T)}),(T=>{H.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+T)}))}setAudioBuffer(T){var z;null!==(z=Zz.d.audioEngine)&&void 0!==z&&z.canUseWebAudio&&(this._audioBuffer=T,this._isReadyToPlay=!0)}updateOptions(T){T&&(this.loop=T.loop??this.loop,this.maxDistance=T.maxDistance??this.maxDistance,this.useCustomAttenuation=T.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=T.rolloffFactor??this.rolloffFactor,this.refDistance=T.refDistance??this.refDistance,this.distanceModel=T.distanceModel??this.distanceModel,this._playbackRate=T.playbackRate??this._playbackRate,this._length=T.length??void 0,this.spatialSound=T.spatialSound??this._spatialSound,this._setOffset(T.offset??void 0),this.setVolume(T.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var T;null!==(T=Zz.d.audioEngine)&&void 0!==T&&T.canUseWebAudio&&Zz.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Zz.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var T;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(T=this._soundPanner)||void 0===T||T.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var T;null!==(T=Zz.d.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(T){var z;null!==(z=Zz.d.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(T),this._isOutputConnected=!0)}setDirectionalCone(T,z,X){z<T?H.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=T,this._coneOuterAngle=z,this._coneOuterGain=X,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(T){if(T!=this._coneInnerAngle){var z;if(this._coneOuterAngle<T)return void H.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=T,null!==(z=Zz.d.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(T){if(T!=this._coneOuterAngle){var z;if(T<this._coneInnerAngle)return void H.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=T,null!==(z=Zz.d.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(T){var z;T.equals(this._position)||(this._position.p(T),null!==(z=Zz.d.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(T){var z;this._localDirection=T,null!==(z=Zz.d.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const T=this._connectedTransformNode.getWorldMatrix(),z=F.j.TransformNormal(this._localDirection,T);z.normalize(),this._soundPanner.orientationX.value=z.x,this._soundPanner.orientationY.value=z.y,this._soundPanner.orientationZ.value=z.z}updateDistanceFromListener(){var T;if(null!==(T=Zz.d.audioEngine)&&void 0!==T&&T.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const T=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Mc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,T,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(T){this._customAttenuationFunction=T}play(T,z,X){var b;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(b=Zz.d.audioEngine)&&void 0!==b&&b.audioContext)try{var F,A;this._clearTimeoutsAndObservers();let b=T?(null===(F=Zz.d.audioEngine)||void 0===F?void 0:F.audioContext.currentTime)+T:null===(A=Zz.d.audioEngine)||void 0===A?void 0:A.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Zz.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const T=()=>{var X;if(null!==(X=Zz.d.audioEngine)&&void 0!==X&&X.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=z??0;const X=this._htmlAudioElement.play();void 0!==X&&X.catch((()=>{var z,X;(null===(z=Zz.d.audioEngine)||void 0===z||z.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(X=Zz.d.audioEngine)||void 0===X?void 0:X.onAudioUnlockedObservable.addOnce((()=>{T()})))}))}else{var b;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(b=Zz.d.audioEngine)||void 0===b?void 0:b.onAudioUnlockedObservable.addOnce((()=>{T()}))}};T()}}else{var u;const F=()=>{var F;if(null!==(F=Zz.d.audioEngine)&&void 0!==F&&F.audioContext){var A;if(X=X||this._length,void 0!==z&&this._setOffset(z),this._soundSource){const T=this._soundSource;T.onended=()=>{T.disconnect()}}if(this._soundSource=null===(A=Zz.d.audioEngine)||void 0===A?void 0:A.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var u;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==z&&(this._soundSource.loopStart=z),void 0!==X&&(this._soundSource.loopEnd=(0|z)+X),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},b=T?(null===(u=Zz.d.audioEngine)||void 0===u?void 0:u.audioContext.currentTime)+T:Zz.d.audioEngine.audioContext.currentTime;const F=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(b,F,this.loop?void 0:X)}}};"suspended"===(null===(u=Zz.d.audioEngine)||void 0===u?void 0:u.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var T;"suspended"===(null===(T=Zz.d.audioEngine)||void 0===T?void 0:T.audioContext.state)?(Zz.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Zz.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{F()})))):F()}),500):F()}this._startTime=b,this.isPlaying=!0,this.isPaused=!1}catch(y){H.e.Error("Error while trying to play audio: "+this.name+", "+y.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(T){var z;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var X;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(X=this._streamingSource)||void 0===X||X.disconnect();this.isPlaying=!1}else if(null!==(z=Zz.d.audioEngine)&&void 0!==z&&z.audioContext&&this._soundSource){const z=T?Zz.d.audioEngine.audioContext.currentTime+T:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(z)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var T;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var z;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(z=this._streamingSource)||void 0===z||z.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(T=Zz.d.audioEngine)&&void 0!==T&&T.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Zz.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(T,z){var X;null!==(X=Zz.d.audioEngine)&&void 0!==X&&X.canUseWebAudio&&this._soundGain&&(z&&Zz.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Zz.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Zz.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(T,Zz.d.audioEngine.audioContext.currentTime+z)):this._soundGain.gain.value=T),this._volume=T}setPlaybackRate(T){this._playbackRate=T,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(T){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=T,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=T=>this._onRegisterAfterWorldMatrixUpdate(T),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(T){var z;if(T.getBoundingInfo){const z=T.getBoundingInfo();this.setPosition(z.boundingSphere.centerWorld)}else this.setPosition(T.absolutePosition);null!==(z=Zz.d.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const T=()=>{this._isReadyToPlay?(X._audioBuffer=this.getAudioBuffer(),X._isReadyToPlay=!0,X.autoplay&&X.play(0,this._offset,this._length)):setTimeout(T,300)},z={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},X=new mz(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,z);return this.useCustomAttenuation&&X.setAttenuationFunction(this._customAttenuationFunction),X.setPosition(this._position),X.setPlaybackRate(this._playbackRate),T(),X}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const T={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(T.connectedMeshId=this._connectedTransformNode.id),T.position=this._position.zd(),T.refDistance=this.refDistance,T.distanceModel=this.distanceModel,T.isDirectional=this._isDirectional,T.localDirectionToMesh=this._localDirection.zd(),T.coneInnerAngle=this._coneInnerAngle,T.coneOuterAngle=this._coneOuterAngle,T.coneOuterGain=this._coneOuterGain),T}static Parse(T,z,X,b){const A=T.name;let u;u=T.url?X+T.url:X+A;const y={autoplay:T.autoplay,loop:T.loop,volume:T.volume,spatialSound:T.spatialSound,maxDistance:T.maxDistance,rolloffFactor:T.rolloffFactor,refDistance:T.refDistance,distanceModel:T.distanceModel,playbackRate:T.playbackRate};let E;if(b){const T=()=>{b._isReadyToPlay?(E._audioBuffer=b.getAudioBuffer(),E._isReadyToPlay=!0,E.autoplay&&E.play(0,E._offset,E._length)):setTimeout(T,300)};E=new mz(A,new ArrayBuffer(0),z,null,y),T()}else E=new mz(A,u,z,(()=>{z.removePendingData(E)}),y),z.addPendingData(E);if(T.position){const z=F.j.xd(T.position);E.setPosition(z)}if(T.isDirectional&&(E.setDirectionalCone(T.coneInnerAngle||360,T.coneOuterAngle||360,T.coneOuterGain||0),T.localDirectionToMesh)){const z=F.j.xd(T.localDirectionToMesh);E.setLocalDirectionToMesh(z)}if(T.connectedMeshId){const X=z.getMeshById(T.connectedMeshId);X&&E.attachToMesh(X)}return T.metadata&&(E.metadata=T.metadata),E}_setOffset(T){this._offset!==T&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=T)}_clearTimeoutsAndObservers(){var T;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(T=Zz.d.audioEngine)||void 0===T||T.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}mz._SceneComponentInitialization=T=>{throw(0,jz.d)("AudioSceneComponent")},(0,a.h)("BABYLON.Sound",mz);class Sz{constructor(T,z,X){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],z.length!==X.length)throw new Error("Sounds length does not equal weights length");this.loop=T,this._weights=X;let b=0;for(const A of X)b+=A;const F=b>0?1/b:0;for(let A=0;A<this._weights.length;A++)this._weights[A]*=F;this._sounds=z;for(const A of this._sounds)A.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(T){if(T!==this._coneInnerAngle){if(this._coneOuterAngle<T)return void H.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=T;for(const z of this._sounds)z.directionalConeInnerAngle=T}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(T){if(T!==this._coneOuterAngle){if(T<this._coneInnerAngle)return void H.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=T;for(const z of this._sounds)z.directionalConeOuterAngle=T}}get volume(){return this._volume}set volume(T){if(T!==this._volume)for(const z of this._sounds)z.setVolume(T)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(T){if(!this.isPaused){this.stop();const T=Math.random();let z=0;for(let X=0;X<this._weights.length;X++)if(z+=this._weights[X],T<=z){this._currentIndex=X;break}}const z=this._sounds[this._currentIndex??0];z.isReady()?z.play(0,this.isPaused?void 0:T):z.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class nz{constructor(T){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(T=T||p.e.LastCreatedScene)&&(this._scene=T,this.soundCollection=[],this._options=z,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var T;null!==(T=Zz.d.audioEngine)&&void 0!==T&&T.canUseWebAudio&&Zz.d.audioEngine.audioContext&&(this._outputAudioNode=Zz.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Zz.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Zz.d.audioEngine&&Zz.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(T){var z;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(z=Zz.d.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._outputAudioNode&&T.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==T.soundTrackId&&(-1===T.soundTrackId?this._scene.mainSoundTrack.removeSound(T):this._scene.soundTracks&&this._scene.soundTracks[T.soundTrackId].removeSound(T)),this.soundCollection.push(T),T.soundTrackId=this.id}removeSound(T){const z=this.soundCollection.indexOf(T);-1!==z&&this.soundCollection.splice(z,1)}setVolume(T){var z;null!==(z=Zz.d.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=T)}switchPanningModelToHRTF(){var T;if(null!==(T=Zz.d.audioEngine)&&void 0!==T&&T.canUseWebAudio)for(let z=0;z<this.soundCollection.length;z++)this.soundCollection[z].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var T;if(null!==(T=Zz.d.audioEngine)&&void 0!==T&&T.canUseWebAudio)for(let z=0;z<this.soundCollection.length;z++)this.soundCollection[z].switchPanningModelToEqualPower()}connectToAnalyser(T){var z;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=T,null!==(z=Zz.d.audioEngine)&&void 0!==z&&z.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Zz.d.audioEngine.masterGain))}}var Oz=X(1221),Pz=X(1159),Wz=(X(1514),X(1096));(0,X(12084).f)(Oz.b.NAME_AUDIO,((T,z,X,b)=>{let F,A=[];if(X.qe=X.qe||[],void 0!==T.qe&&null!==T.qe)for(let y=0,E=T.qe.length;y<E;y++){var u;const E=T.qe[y];null!==(u=Zz.d.audioEngine)&&void 0!==u&&u.canUseWebAudio?(E.url||(E.url=E.name),A[E.url]?X.qe.push(mz.Parse(E,z,b,A[E.url])):(F=mz.Parse(E,z,b),A[E.url]=F,X.qe.push(F))):X.qe.push(new mz(E.name,null,z))}A=[]})),Object.defineProperty(Pz.e.prototype,"mainSoundTrack",{get:function(){let T=this._getComponent(Oz.b.NAME_AUDIO);return T||(T=new Bz(this),this.ne(T)),this._mainSoundTrack||(this._mainSoundTrack=new nz(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Pz.e.prototype.getSoundByName=function(T){let z;for(z=0;z<this.mainSoundTrack.soundCollection.length;z++)if(this.mainSoundTrack.soundCollection[z].name===T)return this.mainSoundTrack.soundCollection[z];if(this.soundTracks)for(let X=0;X<this.soundTracks.length;X++)for(z=0;z<this.soundTracks[X].soundCollection.length;z++)if(this.soundTracks[X].soundCollection[z].name===T)return this.soundTracks[X].soundCollection[z];return null},Object.defineProperty(Pz.e.prototype,"audioEnabled",{get:function(){let T=this._getComponent(Oz.b.NAME_AUDIO);return T||(T=new Bz(this),this.ne(T)),T.audioEnabled},set:function(T){let z=this._getComponent(Oz.b.NAME_AUDIO);z||(z=new Bz(this),this.ne(z)),T?z.enableAudio():z.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Pz.e.prototype,"headphone",{get:function(){let T=this._getComponent(Oz.b.NAME_AUDIO);return T||(T=new Bz(this),this.ne(T)),T.headphone},set:function(T){let z=this._getComponent(Oz.b.NAME_AUDIO);z||(z=new Bz(this),this.ne(z)),T?z.switchAudioModeForHeadphones():z.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Pz.e.prototype,"audioListenerPositionProvider",{get:function(){let T=this._getComponent(Oz.b.NAME_AUDIO);return T||(T=new Bz(this),this.ne(T)),T.audioListenerPositionProvider},set:function(T){let z=this._getComponent(Oz.b.NAME_AUDIO);if(z||(z=new Bz(this),this.ne(z)),T&&"function"!==typeof T)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");z.audioListenerPositionProvider=T},enumerable:!0,configurable:!0}),Object.defineProperty(Pz.e.prototype,"audioListenerRotationProvider",{get:function(){let T=this._getComponent(Oz.b.NAME_AUDIO);return T||(T=new Bz(this),this.ne(T)),T.audioListenerRotationProvider},set:function(T){let z=this._getComponent(Oz.b.NAME_AUDIO);if(z||(z=new Bz(this),this.ne(z)),T&&"function"!==typeof T)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");z.audioListenerRotationProvider=T},enumerable:!0,configurable:!0}),Object.defineProperty(Pz.e.prototype,"audioPositioningRefreshRate",{get:function(){let T=this._getComponent(Oz.b.NAME_AUDIO);return T||(T=new Bz(this),this.ne(T)),T.audioPositioningRefreshRate},set:function(T){let z=this._getComponent(Oz.b.NAME_AUDIO);z||(z=new Bz(this),this.ne(z)),z.audioPositioningRefreshRate=T},enumerable:!0,configurable:!0});class Bz{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(T){this.name=Oz.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new F.j,this._cachedCameraPosition=new F.j,this._lastCheck=0,this._invertMatrixTemp=new F.d,this._cameraDirectionTemp=new F.j,(T=T||p.e.LastCreatedScene)&&(this.ve=T,T.soundTracks=[],T.qe=[])}register(){this.ve._afterRenderStage.registerStep(Oz.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(T){if(T.qe=[],this.ve.soundTracks)for(let z=0;z<this.ve.soundTracks.length;z++){const X=this.ve.soundTracks[z];for(let z=0;z<X.soundCollection.length;z++)T.qe.push(X.soundCollection[z].serialize())}}addFromContainer(T){T.qe&&T.qe.forEach((T=>{T.play(),T.autoplay=!0,this.ve.mainSoundTrack.addSound(T)}))}removeFromContainer(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];T.qe&&T.qe.forEach((T=>{T.stop(),T.autoplay=!1,this.ve.mainSoundTrack.removeSound(T),z&&T.dispose()}))}dispose(){const T=this.ve;if(T._mainSoundTrack&&T.mainSoundTrack.dispose(),T.soundTracks)for(let z=0;z<T.soundTracks.length;z++)T.soundTracks[z].dispose()}disableAudio(){const T=this.ve;let z;for(this._audioEnabled=!1,Zz.d.audioEngine&&Zz.d.audioEngine.audioContext&&Zz.d.audioEngine.audioContext.suspend(),z=0;z<T.mainSoundTrack.soundCollection.length;z++)T.mainSoundTrack.soundCollection[z].pause();if(T.soundTracks)for(z=0;z<T.soundTracks.length;z++)for(let X=0;X<T.soundTracks[z].soundCollection.length;X++)T.soundTracks[z].soundCollection[X].pause()}enableAudio(){const T=this.ve;let z;for(this._audioEnabled=!0,Zz.d.audioEngine&&Zz.d.audioEngine.audioContext&&Zz.d.audioEngine.audioContext.resume(),z=0;z<T.mainSoundTrack.soundCollection.length;z++)T.mainSoundTrack.soundCollection[z].isPaused&&T.mainSoundTrack.soundCollection[z].play();if(T.soundTracks)for(z=0;z<T.soundTracks.length;z++)for(let X=0;X<T.soundTracks[z].soundCollection.length;X++)T.soundTracks[z].soundCollection[X].isPaused&&T.soundTracks[z].soundCollection[X].play()}switchAudioModeForHeadphones(){const T=this.ve;if(this._headphone=!0,T.mainSoundTrack.switchPanningModelToHRTF(),T.soundTracks)for(let z=0;z<T.soundTracks.length;z++)T.soundTracks[z].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const T=this.ve;if(this._headphone=!1,T.mainSoundTrack.switchPanningModelToEqualPower(),T.soundTracks)for(let z=0;z<T.soundTracks.length;z++)T.soundTracks[z].switchPanningModelToEqualPower()}_afterRender(){const T=Wz.c.Now;if(this._lastCheck&&T-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=T;const z=this.ve;if(!this._audioEnabled||!z._mainSoundTrack||!z.soundTracks||0===z._mainSoundTrack.soundCollection.length&&1===z.soundTracks.length)return;const X=Zz.d.audioEngine;if(X&&X.audioContext){let T,b=z.activeCamera;if(z.activeCameras&&z.activeCameras.length>0&&(b=z.activeCameras[0]),this.audioListenerPositionProvider){const T=this.audioListenerPositionProvider();X.audioContext.listener.setPosition(T.x||0,T.y||0,T.z||0)}else b?this._cachedCameraPosition.equals(b.globalPosition)||(this._cachedCameraPosition.p(b.globalPosition),X.audioContext.listener.setPosition(b.globalPosition.x,b.globalPosition.y,b.globalPosition.z)):X.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const T=this.audioListenerRotationProvider();X.audioContext.listener.setOrientation(T.x||0,T.y||0,T.z||0,0,1,0)}else b?(b.rigCameras&&b.rigCameras.length>0&&(b=b.rigCameras[0]),b.getViewMatrix().invertToRef(this._invertMatrixTemp),F.j.TransformNormalToRef(Bz._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),X.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):X.audioContext.listener.setOrientation(0,0,0,0,1,0);for(T=0;T<z.mainSoundTrack.soundCollection.length;T++){const X=z.mainSoundTrack.soundCollection[T];X.useCustomAttenuation&&X.updateDistanceFromListener()}if(z.soundTracks)for(T=0;T<z.soundTracks.length;T++)for(let X=0;X<z.soundTracks[T].soundCollection.length;X++){const b=z.soundTracks[T].soundCollection[X];b.useCustomAttenuation&&b.updateDistanceFromListener()}}}}Bz._CameraDirection=new F.j(0,0,-1),mz._SceneComponentInitialization=T=>{let z=T._getComponent(Oz.b.NAME_AUDIO);z||(z=new Bz(T),T.ne(z))};const ez="MSFT_audio_emitter";class Rz{constructor(T){this.name=ez,this._loader=T,this.enabled=this._loader.isExtensionUsed(ez)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const T=this._loader.kj.extensions;if(T&&T[this.name]){const z=T[this.name];this._clips=z.clips,this._emitters=z.emitters,Q.Assign(this._clips),Q.Assign(this._emitters)}}loadSceneAsync(T,z){return w.LoadExtensionAsync(T,z,this.name,((X,b)=>{const F=new Array;F.push(this._loader.loadSceneAsync(T,z));for(const T of b.emitters){const z=Q.Get(`${X}/emitters`,this._emitters,T);if(void 0!=z.refDistance||void 0!=z.maxDistance||void 0!=z.rolloffFactor||void 0!=z.distanceModel||void 0!=z.innerAngle||void 0!=z.outerAngle)throw new Error(`${X}: Direction or Distance properties are not allowed on emitters attached to a scene`);F.push(this._loadEmitterAsync(`${X}/emitters/${z.index}`,z))}return Promise.all(F).then((()=>{}))}))}loadNodeAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((T,b)=>{const A=new Array;return this._loader.loadNodeAsync(T,z,(z=>{for(const X of b.emitters){const b=Q.Get(`${T}/emitters`,this._emitters,X);A.push(this._loadEmitterAsync(`${T}/emitters/${b.index}`,b).then((()=>{for(const T of b._babylonSounds)T.attachToMesh(z),void 0==b.innerAngle&&void 0==b.outerAngle||(T.setLocalDirectionToMesh(F.j.Forward()),T.setDirectionalCone(2*u.g.ToDegrees(void 0==b.innerAngle?Math.PI:b.innerAngle),2*u.g.ToDegrees(void 0==b.outerAngle?Math.PI:b.outerAngle),0))})))}X(z)})).then((T=>Promise.all(A).then((()=>T))))}))}loadAnimationAsync(T,z){return w.LoadExtensionAsync(T,z,this.name,((X,b)=>this._loader.loadAnimationAsync(T,z).then((F=>{const A=new Array;Q.Assign(b.events);for(const u of b.events)A.push(this._loadAnimationEventAsync(`${X}/events/${u.index}`,T,z,u,F));return Promise.all(A).then((()=>F))}))))}_loadClipAsync(T,z){if(z._objectURL)return z._objectURL;let X;if(z.uri)X=this._loader.loadUriAsync(T,z,z.uri);else{const b=Q.Get(`${T}/bufferView`,this._loader.kj.bufferViews,z.bufferView);X=this._loader.loadBufferViewAsync(`/bufferViews/${b.index}`,b)}return z._objectURL=X.then((T=>URL.createObjectURL(new Blob([T],{type:z.mimeType})))),z._objectURL}_loadEmitterAsync(T,z){if(z._babylonSounds=z._babylonSounds||[],!z._babylonData){const T=new Array,X=z.name||`emitter${z.index}`,b={loop:!1,autoplay:!1,volume:void 0==z.volume?1:z.volume};for(let A=0;A<z.clips.length;A++){const F=`/extensions/${this.name}/clips`,u=Q.Get(F,this._clips,z.clips[A].clip);T.push(this._loadClipAsync(`${F}/${z.clips[A].clip}`,u).then((T=>{const F=z._babylonSounds[A]=new mz(X,T,this._loader.babylonScene,null,b);F.refDistance=z.refDistance||1,F.maxDistance=z.maxDistance||256,F.rolloffFactor=z.rolloffFactor||1,F.distanceModel=z.distanceModel||"exponential"})))}const F=Promise.all(T).then((()=>{const T=z.clips.map((T=>T.weight||1)),X=new Sz(z.loop||!1,z._babylonSounds,T);z.innerAngle&&(X.directionalConeInnerAngle=2*u.g.ToDegrees(z.innerAngle)),z.outerAngle&&(X.directionalConeOuterAngle=2*u.g.ToDegrees(z.outerAngle)),z.volume&&(X.volume=z.volume),z._babylonData.sound=X}));z._babylonData={loaded:F}}return z._babylonData.loaded}_getEventAction(T,z,X,b,F){switch(X){case"play":return T=>{const X=(F||0)+(T-b);z.play(X)};case"stop":return()=>{z.stop()};case"pause":return()=>{z.pause()};default:throw new Error(`${T}: Unsupported action ${X}`)}}_loadAnimationEventAsync(T,z,X,b,F){if(0==F.targetedAnimations.length)return Promise.resolve();const A=F.targetedAnimations[0],u=b.k,y=Q.Get(`/extensions/${this.name}/emitters`,this._emitters,u);return this._loadEmitterAsync(T,y).then((()=>{const z=y._babylonData.sound;if(z){const X=new Gz(b.time,this._getEventAction(T,z,b.action,b.time,b.startOffset));A.animation.addEvent(X),F.onAnimationGroupEndObservable.add((()=>{z.stop()})),F.onAnimationGroupPauseObservable.add((()=>{z.pause()}))}}))}}f(ez),o(ez,!0,(T=>new Rz(T)));const Yz="MSFT_lod";class iz{constructor(T){var z;this.name=Yz,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new k.d,this.onMaterialLODsLoadedObservable=new k.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=T,this.maxLODsToLoad=(null===(z=this._loader.parent.extensionOptions[Yz])||void 0===z?void 0:z.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Yz)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let T=0;T<this._nodePromiseLODs.length;T++){const z=Promise.all(this._nodePromiseLODs[T]).then((()=>{0!==T&&(this._loader.endPerformanceCounter(`Node LOD ${T}`),this._loader.log(`Loaded node LOD ${T}`)),this.onNodeLODsLoadedObservable.notifyObservers(T),T!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${T+1}`),this._loadBufferLOD(this._nodeBufferLODs,T+1),this._nodeSignalLODs[T]&&this._nodeSignalLODs[T].resolve())}));this._loader._completePromises.push(z)}for(let T=0;T<this._materialPromiseLODs.length;T++){const z=Promise.all(this._materialPromiseLODs[T]).then((()=>{0!==T&&(this._loader.endPerformanceCounter(`Material LOD ${T}`),this._loader.log(`Loaded material LOD ${T}`)),this.onMaterialLODsLoadedObservable.notifyObservers(T),T!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${T+1}`),this._loadBufferLOD(this._materialBufferLODs,T+1),this._materialSignalLODs[T]&&this._materialSignalLODs[T].resolve())}));this._loader._completePromises.push(z)}}loadSceneAsync(T,z){const X=this._loader.loadSceneAsync(T,z);return this._loadBufferLOD(this._bufferLODs,0),X}loadNodeAsync(T,z,X){return w.LoadExtensionAsync(T,z,this.name,((T,F)=>{let A;const u=this._getLODs(T,z,this._loader.kj.nodes,F.ids);this._loader.logOpen(`${T}`);for(let z=0;z<u.length;z++){const T=u[z];0!==z&&(this._nodeIndexLOD=z,this._nodeSignalLODs[z]=this._nodeSignalLODs[z]||new b);const F=T=>{X(T),T.Hg(!1)},y=this._loader.loadNodeAsync(`/nodes/${T.index}`,T,F).then((T=>{if(0!==z){const T=u[z-1];T._babylonTransformNode&&(this._disposeTransformNode(T._babylonTransformNode),delete T._babylonTransformNode)}return T.Hg(!0),T}));this._nodePromiseLODs[z]=this._nodePromiseLODs[z]||[],0===z?A=y:(this._nodeIndexLOD=null,this._nodePromiseLODs[z].push(y))}return this._loader.logClose(),A}))}_loadMaterialAsync(T,z,X,b,F){return this._nodeIndexLOD?null:w.LoadExtensionAsync(T,z,this.name,((T,A)=>{let u;const y=this._getLODs(T,z,this._loader.kj.materials,A.ids);this._loader.logOpen(`${T}`);for(let z=0;z<y.length;z++){const T=y[z];0!==z&&(this._materialIndexLOD=z);const A=this._loader._loadMaterialAsync(`/materials/${T.index}`,T,X,b,(T=>{0===z&&F(T)})).then((T=>{if(0!==z){F(T);const X=y[z-1]._data;X[b]&&(this._disposeMaterials([X[b].babylonMaterial]),delete X[b])}return T}));this._materialPromiseLODs[z]=this._materialPromiseLODs[z]||[],0===z?u=A:(this._materialIndexLOD=null,this._materialPromiseLODs[z].push(A))}return this._loader.logClose(),u}))}_loadUriAsync(T,z,X){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const F=this._nodeIndexLOD-1;return this._nodeSignalLODs[F]=this._nodeSignalLODs[F]||new b,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(T,z,X)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const F=this._materialIndexLOD-1;return this._materialSignalLODs[F]=this._materialSignalLODs[F]||new b,this._materialSignalLODs[F].promise.then((()=>this._loader.loadUriAsync(T,z,X)))}return null}loadBufferAsync(T,z,X,F){if(this._loader.parent.useRangeRequests&&!z.uri){if(!this._loader.bin)throw new Error(`${T}: Uri is missing or the binary glTF is missing its binary chunk`);const z=(T,z)=>{const A=X,u=A+F-1;let y=T[z];return y?(y.start=Math.min(y.start,A),y.end=Math.max(y.end,u)):(y={start:A,end:u,loaded:new b},T[z]=y),y.loaded.promise.then((T=>new Uint8Array(T.buffer,T.byteOffset+X-y.start,F)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?z(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?z(this._materialBufferLODs,this._materialIndexLOD):z(this._bufferLODs,0)}return null}_loadBufferLOD(T,z){const X=T[z];X&&(this._loader.log(`Loading buffer range [${X.start}-${X.end}]`),this._loader.bin.readAsync(X.start,X.end-X.start+1).then((T=>{X.loaded.resolve(T)}),(T=>{X.loaded.reject(T)})))}_getLODs(T,z,X,b){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const F=[];for(let A=b.length-1;A>=0;A--)if(F.push(Q.Get(`${T}/ids/${b[A]}`,X,b[A])),F.length===this.maxLODsToLoad)return F;return F.push(z),F}_disposeTransformNode(T){const z=[],X=T.material;X&&z.push(X);for(const F of T.getChildMeshes())F.material&&z.push(F.material);T.dispose();const b=z.filter((T=>this._loader.babylonScene.meshes.every((z=>z.material!=T))));this._disposeMaterials(b)}_disposeMaterials(T){const z={};for(const X of T){for(const T of X.getActiveTextures())z[T.uniqueId]=T;X.dispose()}for(const X in z)for(const T of this._loader.babylonScene.materials)T.hasTexture(z[X])&&delete z[X];for(const X in z)z[X].dispose()}}f(Yz),o(Yz,!0,(T=>new iz(T)));const tz="MSFT_minecraftMesh";class gz{constructor(T){this.name=tz,this._loader=T,this.enabled=this._loader.isExtensionUsed(tz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(T,z,X){return w.LoadExtraAsync(T,z,this.name,((b,F)=>{if(F){if(!(X instanceof V))throw new Error(`${b}: Material type not supported`);const F=this._loader.loadMaterialPropertiesAsync(T,z,X);return X.needAlphaBlending()&&(X.forceDepthWrite=!0,X.separateCullingPass=!0),X.Ke=X.forceDepthWrite,X.twoSidedLighting=!0,F}return null}))}}f(tz),o(tz,!0,(T=>new gz(T)));const Mz="MSFT_sRGBFactors";class rz{constructor(T){this.name=Mz,this._loader=T,this.enabled=this._loader.isExtensionUsed(Mz)}dispose(){this._loader=null}loadMaterialPropertiesAsync(T,z,X){return w.LoadExtraAsync(T,z,this.name,((b,F)=>{if(F){if(!(X instanceof V))throw new Error(`${b}: Material type not supported`);const F=this._loader.loadMaterialPropertiesAsync(T,z,X),A=X.va().getEngine().useExactSrgbConversions;return X.albedoTexture||X.albedoColor.toLinearSpaceToRef(X.albedoColor,A),X.reflectivityTexture||X.reflectivityColor.toLinearSpaceToRef(X.reflectivityColor,A),F}return null}))}}f(Mz),o(Mz,!0,(T=>new rz(T)));var oz,fz=X(1025);!function(T){T[T.Input=0]="Input",T[T.Output=1]="Output"}(oz||(oz={}));class hz{constructor(T,z,X){this._ownerBlock=X,this._connectedPoint=[],this.uniqueId=(0,fz.b)(),this.connectedPointIds=[],this.name=T,this._connectionType=z}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(T){if(this._connectionType===T._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||T._isSingularConnection()&&T._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(T),T._connectedPoint.push(this)}serialize(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};T.uniqueId=this.uniqueId,T.name=this.name,T._connectionType=this._connectionType,T.connectedPointIds=[],T.className=this.getClassName();for(const z of this._connectedPoint)T.connectedPointIds.push(z.uniqueId)}getClassName(){return"FGConnection"}deserialize(T){this.uniqueId=T.uniqueId,this.name=T.name,this._connectionType=T._connectionType,this.connectedPointIds=T.connectedPointIds}static Parse(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},z=arguments.length>1?arguments[1]:void 0;const X=new(u.g.Instantiate(T.className))(T.name,T._connectionType,z);return X.deserialize(T),X}}class Qz{constructor(T){this.value=this._toInt(T)}_toInt(T){return 0|T}add(T){return new Qz(this.value+T.value)}Mc(T){return new Qz(this.value-T.value)}multiply(T){return new Qz(Math.imul(this.value,T.value))}divide(T){return new Qz(this.value/T.value)}getClassName(){return Qz.ClassName}equals(T){return this.value===T.value}static Parse(T){return new Qz(T.value)}}Qz.ClassName="FlowGraphInteger",(0,a.h)("FlowGraphInteger",Qz);class wz{constructor(T,z){this.typeName=T,this.defaultValue=z}serialize(T){T.typeName=this.typeName,T.defaultValue=this.defaultValue}static Parse(T){return new wz(T.typeName,T.defaultValue)}}const Jz=new wz("any",void 0),Iz=(new wz("string",""),new wz("number",0)),TX=new wz("boolean",!1),zX=new wz("Vector2",F.i.Zero()),XX=new wz("Id",F.j.Zero()),bX=(new wz("Vector4",F.n.Zero()),new wz("Matrix",F.d.Identity())),FX=(new wz("Wd",A.b.Black()),new wz("Xd",new A.d(0,0,0,0)),new wz("Quaternion",F.e.Identity()),new wz("FlowGraphInteger",new Qz(0)));class AX extends hz{constructor(T,z,X,b){super(T,z,X),this.richType=b}_isSingularConnection(){return 0===this.connectionType}setValue(T,z){z._setConnectionValue(this,T)}connectTo(T){super.connectTo(T)}_getValueOrDefault(T){return T._hasConnectionValue(this)?T._getConnectionValue(this):this.richType.defaultValue}getValue(T){return 1===this.connectionType?(T._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(T),this._getValueOrDefault(T)):this.isConnected()?this._connectedPoint[0].getValue(T):this._getValueOrDefault(T)}getClassName(){return"FGDataConnection"}serialize(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(T),T.richType={},this.richType.serialize(T.richType)}static Parse(T,z){const X=hz.Parse(T,z);return X.richType=wz.Parse(T.richType),X}}function uX(T){return"Mesh"===T||"AbstractMesh"===T||"GroundMesh"===T||"InstanceMesh"===T||"LinesMesh"===T||"GoldbergMesh"===T||"GreasedLineMesh"===T||"TrailMesh"===T}function yX(T){return"Vector2"===T||"Id"===T||"Vector4"===T||"Quaternion"===T||"Wd"===T||"Xd"===T}function EX(T,z,X){var b;const F=(null===z||void 0===z||null===(b=z.getClassName)||void 0===b?void 0:b.call(z))??"";uX(F)?X[T]={name:z.name,className:F}:yX(F)?X[T]={value:z.zd(),className:F}:X[T]=z}function vX(T,z,X){const b=z[T];let u;const y=null===b||void 0===b?void 0:b.className;return u=uX(y)?X.getMeshByName(b.name):yX(y)?function(T,z){if("Vector2"===T)return F.i.xd(z);if("Id"===T)return F.j.xd(z);if("Vector4"===T)return F.n.xd(z);if("Quaternion"===T)return F.e.xd(z);if("Wd"===T)return new A.b(z[0],z[1],z[2]);if("Xd"===T)return new A.d(z[0],z[1],z[2],z[3]);throw new Error(`Unknown vector class name ${T}`)}(y,b.value):"Matrix"===y?F.d.xd(b.value):y===Qz.ClassName?Qz.Parse(b):b&&void 0!==b.value?b.value:b,u}(0,a.h)("FGDataConnection",AX);class kX{constructor(T){var z;this.config=T,this.uniqueId=(0,fz.b)(),this.name=(null===(z=this.config)||void 0===z?void 0:z.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(T){}registerDataInput(T,z){const X=new AX(T,0,this,z);return this.dataInputs.push(X),X}registerDataOutput(T,z){const X=new AX(T,1,this,z);return this.dataOutputs.push(X),X}getDataInput(T){return this.dataInputs.find((z=>z.name===T))}getDataOutput(T){return this.dataOutputs.find((z=>z.name===T))}serialize(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};T.uniqueId=this.uniqueId,T.config={},this.config&&(T.config.name=this.config.name),T.dataInputs=[],T.dataOutputs=[],T.className=this.getClassName();for(const z of this.dataInputs){const X={};z.serialize(X),T.dataInputs.push(X)}for(const z of this.dataOutputs){const X={};z.serialize(X),T.dataOutputs.push(X)}}getClassName(){return"FGBlock"}static Parse(T,z){const X=u.g.Instantiate(T.className),b={},F=z.valueParseFunction??vX;if(T.config)for(const u in T.config)b[u]=F(u,T.config,z.ve);var A;("FGSetPropertyBlock"===(A=T.className)||"FGGetPropertyBlock"===A||"FGPlayAnimationBlock"===A||"FGMeshPickEventBlock"===A)&&(b.pathConverter=z.pathConverter);const y=new X(b);y.uniqueId=T.uniqueId;for(let u=0;u<T.dataInputs.length;u++){const z=y.getDataInput(T.dataInputs[u].name);if(!z)throw new Error("Could not find data input with name "+T.dataInputs[u].name+" in block "+T.className);z.deserialize(T.dataInputs[u])}for(let u=0;u<T.dataOutputs.length;u++){const z=y.getDataOutput(T.dataOutputs[u].name);if(!z)throw new Error("Could not find data output with name "+T.dataOutputs[u].name+" in block "+T.className);z.deserialize(T.dataOutputs[u])}return y.metadata=T.metadata,y.deserialize&&y.deserialize(T),y}}class LX extends hz{_isSingularConnection(){return 1===this.connectionType}_activateSignal(T){var z;0===this.connectionType?(T._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(T,this),T._increaseExecutionId()):null===(z=this._connectedPoint[0])||void 0===z||z._activateSignal(T)}}(0,a.h)("FlowGraphSignalConnection",LX);class DX extends kX{constructor(T){super(T),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(T){const z=new LX(T,0,this);return this.signalInputs.push(z),z}_registerSignalOutput(T){const z=new LX(T,1,this);return this.signalOutputs.push(z),z}getSignalInput(T){return this.signalInputs.find((z=>z.name===T))}getSignalOutput(T){return this.signalOutputs.find((z=>z.name===T))}serialize(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(T),T.signalInputs=[],T.signalOutputs=[];for(const z of this.signalInputs){const X={};z.serialize(X),T.signalInputs.push(X)}for(const z of this.signalOutputs){const X={};z.serialize(X),T.signalOutputs.push(X)}}deserialize(T){for(let z=0;z<T.signalInputs.length;z++){const X=this.getSignalInput(T.signalInputs[z].name);if(!X)throw new Error("Could not find signal input with name "+T.signalInputs[z].name+" in block "+T.className);X.deserialize(T.signalInputs[z])}for(let z=0;z<T.signalOutputs.length;z++){const X=this.getSignalOutput(T.signalOutputs[z].name);if(!X)throw new Error("Could not find signal output with name "+T.signalOutputs[z].name+" in block "+T.className);X.deserialize(T.signalOutputs[z])}}getClassName(){return"FGExecutionBlock"}}class cX extends DX{constructor(T){super(T),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(T){this._preparePendingTasks(T),T._addPendingBlock(this)}}class pX extends cX{_execute(T){T._notifyExecuteNode(this),this.out._activateSignal(T)}}class HX{constructor(T){this.uniqueId=(0,fz.b)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new k.d,this._configuration=T}hasVariable(T){return T in this._userVariables}setVariable(T,z){this._userVariables[T]=z}getVariable(T){return this._userVariables[T]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(T,z){return`${T.uniqueId}_${z}`}_setExecutionVariable(T,z,X){this._executionVariables[this._getUniqueIdPrefixedName(T,z)]=X}_getExecutionVariable(T,z,X){return this._hasExecutionVariable(T,z)?this._executionVariables[this._getUniqueIdPrefixedName(T,z)]:X}_deleteExecutionVariable(T,z){delete this._executionVariables[this._getUniqueIdPrefixedName(T,z)]}_hasExecutionVariable(T,z){return this._getUniqueIdPrefixedName(T,z)in this._executionVariables}_hasConnectionValue(T){return T.uniqueId in this._connectionValues}_setConnectionValue(T,z){this._connectionValues[T.uniqueId]=z}_getConnectionValue(T){return this._connectionValues[T.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(T){this._pendingBlocks.push(T)}_removePendingBlock(T){const z=this._pendingBlocks.indexOf(T);-1!==z&&this._pendingBlocks.splice(z,1)}_clearPendingBlocks(){for(const T of this._pendingBlocks)T._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(T){this.onNodeExecutedObservable.notifyObservers(T)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:EX;T.uniqueId=this.uniqueId,T._userVariables={};for(const X in this._userVariables)z(X,this._userVariables[X],T._userVariables);T._connectionValues={};for(const X in this._connectionValues)z(X,this._connectionValues[X],T._connectionValues)}getClassName(){return"FGContext"}static Parse(T,z){const X=z.graph.createContext(),b=z.valueParseFunction??vX;X.uniqueId=T.uniqueId;for(const F in T._userVariables){const z=b(F,T._userVariables,X._configuration.ve);X._userVariables[F]=z}for(const F in T._connectionValues){const z=b(F,T._connectionValues,X._configuration.ve);X._connectionValues[F]=z}return X}}(0,K.c)([(0,d.E)()],HX.prototype,"uniqueId",void 0);var UX,sX,xX=X(1224);function KX(T,z){return!(!T.parent||T.parent!==z&&!KX(T.parent,z))}class dX extends pX{constructor(T){super(T),this.config=T}_getReferencedMesh(){const T=this.config.pathConverter.convert(this.config.path),z=T.info.getObject(T.object);if(!z||!(z instanceof m.c))throw new Error("Mesh pick event block requires a valid mesh");return z}_preparePendingTasks(T){let z=T._getExecutionVariable(this,"meshPickObserver");if(!z){const X=this._getReferencedMesh();T._setExecutionVariable(this,"mesh",X),z=X.va().onPointerObservable.add((z=>{var b,F,A;z.type===xX.c.POINTERPICK&&null!==(b=z.pickInfo)&&void 0!==b&&b.pickedMesh&&((null===(F=z.pickInfo)||void 0===F?void 0:F.pickedMesh)===X||KX(null===(A=z.pickInfo)||void 0===A?void 0:A.pickedMesh,X))&&this._execute(T)}));const b=X.Qd.add((()=>this._onDispose));T._setExecutionVariable(this,"meshPickObserver",z),T._setExecutionVariable(this,"meshDisposeObserver",b)}}_onDispose(T){this._cancelPendingTasks(T),T._removePendingBlock(this)}_cancelPendingTasks(T){const z=T._getExecutionVariable(this,"mesh"),X=T._getExecutionVariable(this,"meshPickObserver"),b=T._getExecutionVariable(this,"meshDisposeObserver");z.va().onPointerObservable.remove(X),z.Qd.remove(b),T._deleteExecutionVariable(this,"mesh"),T._deleteExecutionVariable(this,"meshPickObserver"),T._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return dX.ClassName}serialize(T){super.serialize(T),T.config.path=this.config.path}}dX.ClassName="FGMeshPickEventBlock",(0,a.h)(dX.ClassName,dX),function(T){T[T.Stopped=0]="Stopped",T[T.Started=1]="Started"}(UX||(UX={}));class NX{constructor(T){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=T.ve,this._coordinator=T.coordinator,this._sceneDisposeObserver=this._scene.Qd.add((()=>this.dispose()))}createContext(){const T=new HX({ve:this._scene,coordinator:this._coordinator});return this._executionContexts.push(T),T}getContext(T){return this._executionContexts[T]}addEventBlock(T){this._eventBlocks.push(T)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const T of this._executionContexts){const z=this._getContextualOrder();for(const X of z)X._startPendingTasks(T)}}}_getContextualOrder(){const T=[];for(const z of this._eventBlocks)if(z.getClassName()===dX.ClassName){const X=z._getReferencedMesh();let b=0;for(;b<T.length;b++){const z=T[b]._getReferencedMesh();if(X&&z&&KX(X,z))break}T.splice(b,0,z)}else T.push(z);return T}dispose(){if(0!==this.state){this.state=0;for(const T of this._executionContexts)T._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.Qd.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(T){const z=[],X=new Set;for(const b of this._eventBlocks)z.push(b),X.add(b.uniqueId);for(;z.length>0;){const b=z.pop();T(b);for(const T of b.dataInputs)for(const b of T._connectedPoint)X.has(b._ownerBlock.uniqueId)||(z.push(b._ownerBlock),X.add(b._ownerBlock.uniqueId));if(b instanceof DX)for(const T of b.signalOutputs)for(const b of T._connectedPoint)X.has(b._ownerBlock.uniqueId)||(z.push(b._ownerBlock),X.add(b._ownerBlock.uniqueId))}}serialize(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},z=arguments.length>1?arguments[1]:void 0;T.allBlocks=[],this.visitAllBlocks((z=>{const X={};z.serialize(X),T.allBlocks.push(X)})),T.executionContexts=[];for(const X of this._executionContexts){const b={};X.serialize(b,z),T.executionContexts.push(b)}}static GetDataOutConnectionByUniqueId(T,z){for(const X of T)for(const T of X.dataOutputs)if(T.uniqueId===z)return T;throw new Error("Could not find data out connection with unique id "+z)}static GetSignalInConnectionByUniqueId(T,z){for(const X of T)if(X instanceof DX)for(const T of X.signalInputs)if(T.uniqueId===z)return T;throw new Error("Could not find signal in connection with unique id "+z)}static Parse(T,z){const X=z.coordinator.createGraph(),b=[],F=z.valueParseFunction??vX;for(const A of T.allBlocks){const T=kX.Parse(A,{ve:z.coordinator.config.ve,pathConverter:z.pathConverter,valueParseFunction:F});b.push(T),T instanceof pX&&X.addEventBlock(T)}for(const A of b){for(const T of A.dataInputs)for(const z of T.connectedPointIds){const X=NX.GetDataOutConnectionByUniqueId(b,z);T.connectTo(X)}if(A instanceof DX)for(const T of A.signalOutputs)for(const z of T.connectedPointIds){const X=NX.GetSignalInConnectionByUniqueId(b,z);T.connectTo(X)}}for(const A of T.executionContexts)HX.Parse(A,{graph:X,valueParseFunction:F});return X}}class lX{constructor(T){this.config=T,this._flowGraphs=[],this._customEventsMap=new Map,this.config.ve.Qd.add((()=>{this.dispose()}));(lX.SceneCoordinators.get(this.config.ve)??[]).push(this)}createGraph(){const T=new NX({ve:this.config.ve,coordinator:this});return this._flowGraphs.push(T),T}removeGraph(T){const z=this._flowGraphs.indexOf(T);-1!==z&&(T.dispose(),this._flowGraphs.splice(z,1))}start(){this._flowGraphs.forEach((T=>T.start()))}dispose(){this._flowGraphs.forEach((T=>T.dispose())),this._flowGraphs.length=0;const T=lX.SceneCoordinators.get(this.config.ve)??[],z=T.indexOf(this);-1!==z&&T.splice(z,1)}serialize(T,z){T._flowGraphs=[],this._flowGraphs.forEach((X=>{const b={};X.serialize(b,z),T._flowGraphs.push(b)}))}static Parse(T,z){var X;const b=z.valueParseFunction??vX,F=new lX({ve:z.ve});return null===(X=T._flowGraphs)||void 0===X||X.forEach((T=>{NX.Parse(T,{coordinator:F,valueParseFunction:b,pathConverter:z.pathConverter})})),F}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(T){let z=this._customEventsMap.get(T);return z||(z=new k.d,this._customEventsMap.set(T,z)),z}notifyCustomEvent(T,z){const X=this._customEventsMap.get(T);X&&X.notifyObservers(z)}}lX.SceneCoordinators=new Map;class aX extends pX{_preparePendingTasks(T){if(!T._getExecutionVariable(this,"sceneReadyObserver")){const z=T.configuration.ve.onReadyObservable.add((()=>{this._execute(T)}));T._setExecutionVariable(this,"sceneReadyObserver",z)}}_cancelPendingTasks(T){const z=T._getExecutionVariable(this,"sceneReadyObserver");T.configuration.ve.onReadyObservable.remove(z),T._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return aX.ClassName}}aX.ClassName="FGSceneReadyEventBlock",(0,a.h)("FGSceneReadyEventBlock",aX);class qX extends pX{_preparePendingTasks(T){if(!T._getExecutionVariable(this,"sceneBeforeRender")){const z=T.configuration.ve.onBeforeRenderObservable.add((()=>{this._execute(T)}));T._setExecutionVariable(this,"sceneBeforeRender",z)}}_cancelPendingTasks(T){const z=T._getExecutionVariable(this,"sceneBeforeRender");T.configuration.ve.onBeforeRenderObservable.remove(z),T._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return qX.ClassName}}qX.ClassName="FGSceneTickEventBlock",(0,a.h)(qX.ClassName,qX);class VX extends DX{constructor(T){super(T),this.out=this._registerSignalOutput("out")}}class CX extends VX{constructor(T){super(T),this.message=this.registerDataInput("message",Jz)}_execute(T){const z=this.message.getValue(T);H.e.Log(z),this.out._activateSignal(T)}getClassName(){return CX.ClassName}}CX.ClassName="FGConsoleLogBlock",(0,a.h)(CX.ClassName,CX),function(T){T[T.INIT=0]="INIT",T[T.STARTED=1]="STARTED",T[T.ENDED=2]="ENDED"}(sX||(sX={}));class GX{constructor(T){this.onEachCountObservable=new k.d,this.onTimerAbortedObservable=new k.d,this.onTimerEndedObservable=new k.d,this.onStateChangedObservable=new k.d,this._observer=null,this._breakOnNextTick=!1,this._tick=T=>{const z=Date.now();this._timer=z-this._startTime;const X={startTime:this._startTime,currentTime:z,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:T},b=this._breakOnNextTick||this._breakCondition(X);b||this._timer>=this._timeToEnd?this._stop(X,b):this.onEachCountObservable.notifyObservers(X)},this._setState(0),this._contextObservable=T.contextObservable,this._observableParameters=T.observableParameters??{},this._breakCondition=T.breakCondition??(()=>!1),this._timeToEnd=T.timeout,T.onEnded&&this.onTimerEndedObservable.add(T.onEnded),T.Ei&&this.onEachCountObservable.add(T.Ei),T.onAborted&&this.onTimerAbortedObservable.add(T.onAborted)}set breakCondition(T){this._breakCondition=T}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=T,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(T){this._state=T,this.onStateChangedObservable.notifyObservers(this._state)}_stop(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),z?this.onTimerAbortedObservable.notifyObservers(T):this.onTimerEndedObservable.notifyObservers(T)}}class jX extends cX{constructor(T){super(T),this.timeout=this.registerDataInput("timeout",Iz)}_preparePendingTasks(T){const z=this.timeout.getValue(T);if(void 0!==z&&z>=0){const X=T._getExecutionVariable(this,"runningTimers")||[],b=T.configuration.ve,F=new GX({timeout:z,contextObservable:b.onBeforeRenderObservable,onEnded:()=>this._onEnded(F,T)});F.start(),X.push(F),T._setExecutionVariable(this,"runningTimers",X)}}_execute(T){this._startPendingTasks(T),this.out._activateSignal(T)}_onEnded(T,z){const X=z._getExecutionVariable(this,"runningTimers")||[],b=X.indexOf(T);-1!==b?X.splice(b,1):u.g.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),z._removePendingBlock(this),this.done._activateSignal(z)}_cancelPendingTasks(T){const z=T._getExecutionVariable(this,"runningTimers")||[];for(const X of z)X.dispose();T._deleteExecutionVariable(this,"runningTimers")}getClassName(){return jX.ClassName}}jX.ClassName="FGTimerBlock",(0,a.h)("FGTimerBlock",jX);class ZX extends VX{constructor(T){super(T),this.config=T;for(let z=0;z<this.config.eventData.length;z++){const T=this.config.eventData[z];this.registerDataInput(T,Jz)}}_execute(T){const z=this.config.eventId,X=this.dataInputs.map((z=>z.getValue(T)));T.configuration.coordinator.notifyCustomEvent(z,X),this.out._activateSignal(T)}getClassName(){return ZX.ClassName}}ZX.ClassName="FGSendCustomEventBlock",(0,a.h)("FGSendCustomEventBlock",ZX);class mX extends pX{constructor(T){super(T),this.config=T;for(let z=0;z<this.config.eventData.length;z++){const T=this.config.eventData[z];this.registerDataOutput(T,Jz)}}_preparePendingTasks(T){const z=T.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=z.add((z=>{for(let X=0;X<z.length;X++)this.dataOutputs[X].setValue(z[X],T);this._execute(T)}))}_cancelPendingTasks(T){const z=T.configuration.coordinator.getCustomEventObservable(this.config.eventId);z?z.remove(this._eventObserver):u.g.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return mX.ClassName}serialize(T){super.serialize(T),T.eventId=this.config.eventId,T.eventData=this.config.eventData}}mX.ClassName="FGReceiveCustomEventBlock",(0,a.h)(mX.ClassName,mX);class SX extends DX{constructor(T){super(T),this.config=T,this.outFlows=[];for(let z=0;z<this.config.numberOutputFlows;z++)this.outFlows.push(this._registerSignalOutput(`${z}`))}_execute(T){for(let z=0;z<this.config.numberOutputFlows;z++)this.outFlows[z]._activateSignal(T)}getClassName(){return SX.ClassName}}SX.ClassName="FGSequenceBlock",(0,a.h)(SX.ClassName,SX);const nX=new RegExp(/\{(\w+)\}/g);class OX{constructor(T,z){this.path=T,this.ownerBlock=z,this.templatedInputs=[];let X=nX.exec(T);for(;X;){const[,b]=X;this.templatedInputs.push(z.registerDataInput(b,FX)),X=nX.exec(T)}}getAccessor(T,z){let X=this.path;for(const b of this.templatedInputs){const T=b.getValue(z).value;X=X.replace(`{${b.name}}`,T.toString())}return T.convert(X)}}class PX extends kX{constructor(T){super(T),this.config=T,this.value=this.registerDataOutput("value",Jz),this.templateComponent=new OX(T.path,this)}_updateOutputs(T){const z=this.templateComponent.getAccessor(this.config.pathConverter,T),X=z.info.get(z.object);this.value.setValue(X,T)}getClassName(){return PX.ClassName}serialize(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(T),T.config.path=this.config.path}}PX.ClassName="FGGetPropertyBlock",(0,a.h)(PX.ClassName,PX);class WX extends VX{constructor(T){super(T),this.config=T,this.a=this.registerDataInput("a",Jz),this.templateComponent=new OX(T.path,this)}_execute(T){const z=this.a.getValue(T),X=this.templateComponent.getAccessor(this.config.pathConverter,T);X.info.set(z,X.object),this.out._activateSignal(T)}serialize(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(T),T.config.path=this.config.path}getClassName(){return WX.ClassName}}WX.ClassName="FGSetPropertyBlock",(0,a.h)("FGSetPropertyBlock",WX);const BX="cachedOperationValue",eX="cachedExecutionId";class RX extends kX{constructor(T,z){super(z),this.value=this.registerDataOutput("value",T)}_updateOutputs(T){const z=T._getExecutionVariable(this,eX),X=T._getExecutionVariable(this,BX);if(void 0!==X&&z===T.executionId)this.value.setValue(X,T);else{const z=this._doOperation(T);T._setExecutionVariable(this,BX,z),T._setExecutionVariable(this,eX,T.executionId),this.value.setValue(z,T)}}}class YX extends RX{constructor(T,z,X,b,F,A){super(X,A),this._operation=b,this._className=F,this.a=this.registerDataInput("a",T),this.b=this.registerDataInput("b",z)}_doOperation(T){return this._operation(this.a.getValue(T),this.b.getValue(T))}getClassName(){return this._className}}class iX extends RX{constructor(T,z,X,b){super(T,b),this._operation=z,this._className=X}_doOperation(T){return this._operation()}getClassName(){return this._className}}class tX extends RX{constructor(T,z,X,b,F){super(z,F),this._operation=X,this._className=b,this.a=this.registerDataInput("a",T)}_doOperation(T){return this._operation(this.a.getValue(T))}getClassName(){return this._className}}class gX extends RX{constructor(T,z,X,b,F,A,u){super(b,u),this._operation=F,this._className=A,this.a=this.registerDataInput("a",T),this.b=this.registerDataInput("b",z),this.c=this.registerDataInput("c",X)}_doOperation(T){return this._operation(this.a.getValue(T),this.b.getValue(T),this.c.getValue(T))}getClassName(){return this._className}}function MX(T){return T.getClassName?T.getClassName():""}function rX(T,z){return"Vector2"===T&&"Vector2"===z||"Id"===T&&"Id"===z||"Vector4"===T&&"Vector4"===z}function oX(T,z){return"Matrix"===T&&"Matrix"===z}function fX(T,z){return"FlowGraphInteger"===T&&"FlowGraphInteger"===z}class hX extends YX{constructor(T){super(Jz,Jz,Jz,((T,z)=>this._polymorphicAdd(T,z)),hX.ClassName,T)}_polymorphicAdd(T,z){const X=MX(T),b=MX(z);return rX(X,b)||oX(X,b)||fX(X,b)?T.add(z):T+z}}hX.ClassName="FGAddBlock",(0,a.h)(hX.ClassName,hX);class QX extends YX{constructor(T){super(Jz,Jz,Jz,((T,z)=>this._polymorphicAdd(T,z)),QX.ClassName,T)}_polymorphicAdd(T,z){const X=MX(T),b=MX(z);return rX(X,b)||fX(X,b)?T.Mc(z):oX(X,b)?T.add(z.scale(-1)):T-z}}QX.ClassName="FGSubBlock",(0,a.h)(QX.ClassName,QX);class wX extends YX{constructor(T){super(Jz,Jz,Jz,((T,z)=>this._polymorphicMultiply(T,z)),wX.ClassName,T)}_polymorphicMultiply(T,z){const X=MX(T),b=MX(z);return rX(X,b)||fX(X,b)?T.multiply(z):oX(X,b)?F.d.FromValues(T.m[0]*z.m[0],T.m[4]*z.m[4],T.m[8]*z.m[8],T.m[12]*z.m[12],T.m[1]*z.m[1],T.m[5]*z.m[5],T.m[9]*z.m[9],T.m[13]*z.m[13],T.m[2]*z.m[2],T.m[6]*z.m[6],T.m[10]*z.m[10],T.m[14]*z.m[14],T.m[3]*z.m[3],T.m[7]*z.m[7],T.m[11]*z.m[11],T.m[15]*z.m[15]):T*z}}wX.ClassName="FGMultiplyBlock",(0,a.h)(wX.ClassName,wX);class JX extends YX{constructor(T){super(Jz,Jz,Jz,((T,z)=>this._polymorphicDivide(T,z)),JX.ClassName,T)}_polymorphicDivide(T,z){const X=MX(T),b=MX(z);return rX(X,b)||fX(X,b)?T.divide(z):oX(X,b)?F.d.FromValues(T.m[0]/z.m[0],T.m[4]/z.m[4],T.m[8]/z.m[8],T.m[12]/z.m[12],T.m[1]/z.m[1],T.m[5]/z.m[5],T.m[9]/z.m[9],T.m[13]/z.m[13],T.m[2]/z.m[2],T.m[6]/z.m[6],T.m[10]/z.m[10],T.m[14]/z.m[14],T.m[3]/z.m[3],T.m[7]/z.m[7],T.m[11]/z.m[11],T.m[15]/z.m[15]):T/z}}JX.ClassName="FGDivideBlock",(0,a.h)(JX.ClassName,JX);class IX extends iX{constructor(T){super(Iz,(()=>Math.random()),IX.ClassName,T)}}IX.ClassName="FGRandomBlock",(0,a.h)(IX.ClassName,IX);class Tb extends YX{constructor(T){super(Jz,Jz,Iz,((T,z)=>this._polymorphicDot(T,z)),Tb.ClassName,T)}_polymorphicDot(T,z){switch(MX(T)){case"Vector2":return F.i.Dot(T,z);case"Id":return F.j.Dot(T,z);case"Vector4":return F.n.Dot(T,z);default:throw new Error(`Cannot get dot product of ${T} and ${z}`)}}}Tb.ClassName="FGDotBlock",(0,a.h)(Tb.ClassName,Tb);class zb extends iX{constructor(T){super(Iz,(()=>Math.E),zb.ClassName,T)}}zb.ClassName="FGEBlock",(0,a.h)(zb.ClassName,zb);class Xb extends iX{constructor(T){super(Iz,(()=>Math.PI),Xb.ClassName,T)}}Xb.ClassName="FGPIBlock",(0,a.h)(Xb.ClassName,Xb);class bb extends iX{constructor(T){super(Iz,(()=>Number.POSITIVE_INFINITY),bb.ClassName,T)}}bb.ClassName="FGInfBlock",(0,a.h)(bb.ClassName,bb);class Fb extends iX{constructor(T){super(Iz,(()=>Number.NaN),Fb.ClassName,T)}}function Ab(T,z){switch(MX(T)){case"FlowGraphInteger":return new Qz(z(T.value));case"Vector2":return new F.i(z(T.x),z(T.y));case"Id":return new F.j(z(T.x),z(T.y),z(T.z));case"Vector4":return new F.n(z(T.x),z(T.y),z(T.z),z(T.w));case"Matrix":return F.d.FromValues(z(T.m[0]),z(T.m[4]),z(T.m[8]),z(T.m[12]),z(T.m[1]),z(T.m[5]),z(T.m[9]),z(T.m[13]),z(T.m[2]),z(T.m[6]),z(T.m[10]),z(T.m[14]),z(T.m[3]),z(T.m[7]),z(T.m[11]),z(T.m[15]));default:return z(T)}}Fb.ClassName="FGNaNBlock",(0,a.h)(Fb.ClassName,Fb);class ub extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicAbs(T)),ub.ClassName,T)}_polymorphicAbs(T){return Ab(T,Math.abs)}}ub.ClassName="FGAbsBlock",(0,a.h)(ub.ClassName,ub);class yb extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicSign(T)),yb.ClassName,T)}_polymorphicSign(T){return Ab(T,Math.sign)}}yb.ClassName="FGSignBlock",(0,a.h)(yb.ClassName,yb);class Eb extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicTrunc(T)),Eb.ClassName,T)}_polymorphicTrunc(T){return Ab(T,Math.trunc)}}Eb.ClassName="FGTruncBlock",(0,a.h)(Eb.ClassName,Eb);class vb extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicFloor(T)),vb.ClassName,T)}_polymorphicFloor(T){return Ab(T,Math.floor)}}vb.ClassName="FGFloorBlock",(0,a.h)(vb.ClassName,vb);class kb extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicCeiling(T)),kb.ClassName,T)}_polymorphicCeiling(T){return Ab(T,Math.ceil)}}kb.ClassName="FGCeilBlock",(0,a.h)(kb.ClassName,kb);class Lb extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicFract(T)),Lb.ClassName,T)}_polymorphicFract(T){return Ab(T,(T=>T-Math.floor(T)))}}Lb.ClassName="FGFractBlock",(0,a.h)(Lb.ClassName,Lb);class Db extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicNeg(T)),Db.ClassName,T)}_polymorphicNeg(T){return Ab(T,(T=>-T))}}function cb(T,z,X){switch(MX(T)){case"FlowGraphInteger":return new Qz(X(T.value,z.value));case"Vector2":return new F.i(X(T.x,z.x),X(T.y,z.y));case"Id":return new F.j(X(T.x,z.x),X(T.y,z.y),X(T.z,z.z));case"Vector4":return new F.n(X(T.x,z.x),X(T.y,z.y),X(T.z,z.z),X(T.w,z.w));case"Matrix":return F.d.FromValues(X(T.m[0],z.m[0]),X(T.m[4],z.m[4]),X(T.m[8],z.m[8]),X(T.m[12],z.m[12]),X(T.m[1],z.m[1]),X(T.m[5],z.m[5]),X(T.m[9],z.m[9]),X(T.m[13],z.m[13]),X(T.m[2],z.m[2]),X(T.m[6],z.m[6]),X(T.m[10],z.m[10]),X(T.m[14],z.m[14]),X(T.m[3],z.m[3]),X(T.m[7],z.m[7]),X(T.m[11],z.m[11]),X(T.m[15],z.m[15]));default:return X(T,z)}}Db.ClassName="FGNegBlock",(0,a.h)(Db.ClassName,Db);class pb extends YX{constructor(T){super(Jz,Jz,Jz,((T,z)=>this._polymorphicRemainder(T,z)),pb.ClassName,T)}_polymorphicRemainder(T,z){return cb(T,z,((T,z)=>T%z))}}pb.ClassName="FGRemainderBlock",(0,a.h)(pb.ClassName,pb);class Hb extends YX{constructor(T){super(Jz,Jz,Jz,((T,z)=>this._polymorphicMin(T,z)),Hb.ClassName,T)}_polymorphicMin(T,z){return cb(T,z,Math.min)}}Hb.ClassName="FGMinBlock",(0,a.h)(Hb.ClassName,Hb);class Ub extends YX{constructor(T){super(Jz,Jz,Jz,((T,z)=>this._polymorphicMax(T,z)),Ub.ClassName,T)}_polymorphicMax(T,z){return cb(T,z,Math.max)}}function sb(T,z,X){return Math.min(Math.max(T,Math.min(z,X)),Math.max(z,X))}function xb(T,z,X,b){switch(MX(T)){case"FlowGraphInteger":return new Qz(b(T.value,z.value,X.value));case"Vector2":return new F.i(b(T.x,z.x,X.x),b(T.y,z.y,X.y));case"Id":return new F.j(b(T.x,z.x,X.x),b(T.y,z.y,X.y),b(T.z,z.z,X.z));case"Vector4":return new F.n(b(T.x,z.x,X.x),b(T.y,z.y,X.y),b(T.z,z.z,X.z),b(T.w,z.w,X.w));case"Matrix":return F.d.FromValues(b(T.m[0],z.m[0],X.m[0]),b(T.m[4],z.m[4],X.m[4]),b(T.m[8],z.m[8],X.m[8]),b(T.m[12],z.m[12],X.m[12]),b(T.m[1],z.m[1],X.m[1]),b(T.m[5],z.m[5],X.m[5]),b(T.m[9],z.m[9],X.m[9]),b(T.m[13],z.m[13],X.m[13]),b(T.m[2],z.m[2],X.m[2]),b(T.m[6],z.m[6],X.m[6]),b(T.m[10],z.m[10],X.m[10]),b(T.m[14],z.m[14],X.m[14]),b(T.m[3],z.m[3],X.m[3]),b(T.m[7],z.m[7],X.m[7]),b(T.m[11],z.m[11],X.m[11]),b(T.m[15],z.m[15],X.m[15]));default:return b(T,z,X)}}Ub.ClassName="FGMaxBlock",(0,a.h)(Ub.ClassName,Ub);class Kb extends gX{constructor(T){super(Jz,Jz,Jz,Jz,((T,z,X)=>this._polymorphicClamp(T,z,X)),Kb.ClassName,T)}_polymorphicClamp(T,z,X){return xb(T,z,X,sb)}}function db(T){return Math.min(Math.max(T,0),1)}Kb.ClassName="FGClampBlock",(0,a.h)(Kb.ClassName,Kb);class Nb extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicSaturate(T)),Nb.ClassName,T)}_polymorphicSaturate(T){return Ab(T,db)}}Nb.ClassName="FGSaturateBlock",(0,a.h)(Nb.ClassName,Nb);class lb extends gX{constructor(T){super(Jz,Jz,Jz,Jz,((T,z,X)=>this._polymorphicInterpolate(T,z,X)),lb.ClassName,T)}_interpolate(T,z,X){return(1-X)*T+X*z}_polymorphicInterpolate(T,z,X){return xb(T,z,X,this._interpolate)}}lb.ClassName="FGInterpolateBlock",(0,a.h)(lb.ClassName,lb);class ab extends YX{constructor(T){super(Jz,Jz,TX,((T,z)=>this._polymorphicEq(T,z)),ab.ClassName,T)}_polymorphicEq(T,z){const X=MX(T),b=MX(z);return rX(X,b)||oX(X,b)||fX(X,b)?T.equals(z):T===z}}function qb(T,z,X){const b=MX(T);if(b===MX(z)){if(""===b)return X(T,z);if("FlowGraphInteger"===b)return X(T.value,z.value);throw new Error(`Cannot compare ${T} and ${z}`)}throw new Error(`${T} and ${z} are of different types.`)}ab.ClassName="FGEqBlock",(0,a.h)(ab.ClassName,ab);class Vb extends YX{constructor(T){super(Jz,Jz,TX,((T,z)=>this._polymorphicLessThan(T,z)),Vb.ClassName,T)}_polymorphicLessThan(T,z){return qb(T,z,((T,z)=>T<z))}}Vb.ClassName="FGLessThanBlock",(0,a.h)(Vb.ClassName,Vb);class Cb extends YX{constructor(T){super(Jz,Jz,TX,((T,z)=>this._polymorphicLessThanOrEqual(T,z)),Cb.ClassName,T)}_polymorphicLessThanOrEqual(T,z){return qb(T,z,((T,z)=>T<=z))}}Cb.ClassName="FGLessThanOrEqualBlock";class Gb extends YX{constructor(T){super(Jz,Jz,TX,((T,z)=>this._polymorphicGreaterThan(T,z)),Gb.ClassName,T)}_polymorphicGreaterThan(T,z){return qb(T,z,((T,z)=>T>z))}}Gb.ClassName="FGGreaterThanBlock",(0,a.h)(Gb.ClassName,Gb);class jb extends YX{constructor(T){super(Jz,Jz,TX,((T,z)=>this._polymorphicGreaterThanOrEqual(T,z)),jb.ClassName,T)}_polymorphicGreaterThanOrEqual(T,z){return qb(T,z,((T,z)=>T>=z))}}jb.ClassName="FGGreaterThanOrEqualBlock",(0,a.h)(jb.ClassName,jb);class Zb extends tX{constructor(T){super(Jz,TX,(T=>this._polymorphicIsNan(T)),Zb.ClassName,T)}_polymorphicIsNan(T){const z=MX(T);if(""===z)return isNaN(T);if("FlowGraphInteger"===z)return isNaN(T.value);throw new Error(`Cannot get NaN of ${T}`)}}Zb.ClassName="FGIsNanBlock",(0,a.h)(Zb.ClassName,Zb);class mb extends tX{constructor(T){super(Jz,TX,(T=>this._polymorphicIsInf(T)),mb.ClassName,T)}_polymorphicIsInf(T){const z=MX(T);if(""===z)return!isFinite(T);if("FlowGraphInteger"===z)return!isFinite(T.value);throw new Error(`Cannot get isInf of ${T}`)}}mb.ClassName="FGIsInfBlock";class Sb extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicDegToRad(T)),Sb.ClassName,T)}_degToRad(T){return T*Math.PI/180}_polymorphicDegToRad(T){return Ab(T,this._degToRad)}}Sb.ClassName="FGDegToRadBlock",(0,a.h)(Sb.ClassName,Sb);class nb extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicRadToDeg(T)),nb.ClassName,T)}_radToDeg(T){return 180*T/Math.PI}_polymorphicRadToDeg(T){return Ab(T,this._radToDeg)}}nb.ClassName="FGRadToDegBlock",(0,a.h)(nb.ClassName,nb);class Ob extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicSin(T)),Ob.ClassName,T)}_polymorphicSin(T){return Ab(T,Math.sin)}}Ob.ClassName="FGSinBlock",(0,a.h)(Ob.ClassName,Ob);class Pb extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicCos(T)),Pb.ClassName,T)}_polymorphicCos(T){return Ab(T,Math.cos)}}Pb.ClassName="FGCosBlock",(0,a.h)(Pb.ClassName,Pb);class Wb extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicTan(T)),Wb.ClassName,T)}_polymorphicTan(T){return Ab(T,Math.tan)}}Wb.ClassName="FGTanBlock",(0,a.h)(Wb.ClassName,Wb);class Bb extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicAsin(T)),Bb.ClassName,T)}_polymorphicAsin(T){return Ab(T,Math.asin)}}Bb.ClassName="FGAsinBlock",(0,a.h)(Bb.ClassName,Bb);class eb extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicAcos(T)),eb.ClassName,T)}_polymorphicAcos(T){return Ab(T,Math.acos)}}eb.ClassName="FGAcosBlock",(0,a.h)(eb.ClassName,eb);class Rb extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicAtan(T)),Rb.ClassName,T)}_polymorphicAtan(T){return Ab(T,Math.atan)}}Rb.ClassName="FGAtanBlock",(0,a.h)(Rb.ClassName,Rb);class Yb extends YX{constructor(T){super(Jz,Jz,Jz,((T,z)=>this._polymorphicAtan2(T,z)),Yb.ClassName,T)}_polymorphicAtan2(T,z){return cb(T,z,Math.atan2)}}Yb.ClassName="FGAtan2Block",(0,a.h)(Yb.ClassName,Yb);class ib extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicSinh(T)),ib.ClassName,T)}_polymorphicSinh(T){return Ab(T,Math.sinh)}}ib.ClassName="FGSinhBlock",(0,a.h)(ib.ClassName,ib);class tb extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicCosh(T)),tb.ClassName,T)}_polymorphicCosh(T){return Ab(T,Math.cosh)}}tb.ClassName="FGCoshBlock",(0,a.h)(tb.ClassName,tb);class gb extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicTanh(T)),gb.ClassName,T)}_polymorphicTanh(T){return Ab(T,Math.tanh)}}gb.ClassName="FGTanhBlock",(0,a.h)(gb.ClassName,gb);class Mb extends tX{constructor(T){super(Jz,Iz,(T=>this._polymorphicAsinh(T)),Mb.ClassName,T)}_polymorphicAsinh(T){return Ab(T,Math.asinh)}}Mb.ClassName="FGAsinhBlock",(0,a.h)(Mb.ClassName,Mb);class rb extends tX{constructor(T){super(Jz,Iz,(T=>this._polymorphicAcosh(T)),rb.ClassName,T)}_polymorphicAcosh(T){return Ab(T,Math.acosh)}}rb.ClassName="FGAcoshBlock",(0,a.h)(rb.ClassName,rb);class ob extends tX{constructor(T){super(Jz,Iz,(T=>this._polymorphicAtanh(T)),ob.ClassName,T)}_polymorphicAtanh(T){return Ab(T,Math.atanh)}}ob.ClassName="FGAtanhBlock",(0,a.h)(ob.ClassName,ob);class fb extends tX{constructor(T){super(Jz,Iz,(T=>this._polymorphicExp(T)),fb.ClassName,T)}_polymorphicExp(T){return Ab(T,Math.exp)}}fb.ClassName="FGExpBlock",(0,a.h)(fb.ClassName,fb);class hb extends tX{constructor(T){super(Jz,Iz,(T=>this._polymorphicLog(T)),hb.ClassName,T)}_polymorphicLog(T){return Ab(T,Math.log)}}hb.ClassName="FGLogBlock",(0,a.h)(hb.ClassName,hb);class Qb extends tX{constructor(T){super(Jz,Iz,(T=>this._polymorphicLog2(T)),Qb.ClassName,T)}_polymorphicLog2(T){return Ab(T,Math.log2)}}Qb.ClassName="FGLog2Block",(0,a.h)(Qb.ClassName,Qb);class wb extends tX{constructor(T){super(Jz,Iz,(T=>this._polymorphicLog10(T)),wb.ClassName,T)}_polymorphicLog10(T){return Ab(T,Math.log10)}}wb.ClassName="FGLog10Block",(0,a.h)(wb.ClassName,wb);class Jb extends tX{constructor(T){super(Jz,Iz,(T=>this._polymorphicSqrt(T)),Jb.ClassName,T)}_polymorphicSqrt(T){return Ab(T,Math.sqrt)}}Jb.ClassName="FGSqrtBlock",(0,a.h)(Jb.ClassName,Jb);class Ib extends tX{constructor(T){super(Jz,Iz,(T=>this._polymorphicCubeRoot(T)),Ib.ClassName,T)}_polymorphicCubeRoot(T){return Ab(T,Math.cbrt)}}Ib.ClassName="FGCubeRootBlock",(0,a.h)(Ib.ClassName,Ib);class TF extends YX{constructor(T){super(Jz,Iz,Iz,((T,z)=>this._polymorphicPow(T,z)),TF.ClassName,T)}_polymorphicPow(T,z){return cb(T,z,Math.pow)}}TF.ClassName="FGPowBlock",(0,a.h)(TF.ClassName,TF);class zF extends tX{constructor(T){super(Jz,Iz,(T=>this._polymorphicLength(T)),zF.ClassName,T)}_polymorphicLength(T){switch(MX(T)){case"Vector2":case"Id":case"Vector4":return T.length();default:throw new Error(`Cannot compute length of value ${T}`)}}}zF.ClassName="FGLengthBlock",(0,a.h)(zF.ClassName,zF);class XF extends tX{constructor(T){super(Jz,Jz,(T=>this._polymorphicNormalize(T)),XF.ClassName,T)}_polymorphicNormalize(T){switch(MX(T)){case"Vector2":case"Id":case"Vector4":return T.normalize();default:throw new Error(`Cannot normalize value ${T}`)}}}XF.ClassName="FGNormalizeBlock",(0,a.h)(XF.ClassName,XF);class bF extends YX{constructor(T){super(XX,XX,XX,((T,z)=>F.j.Cross(T,z)),bF.ClassName,T)}}bF.ClassName="FGCrossBlock",(0,a.h)(bF.ClassName,bF);class FF extends YX{constructor(T){super(zX,Iz,zX,((T,z)=>F.i.Transform(T,F.d.RotationZ(z))),FF.ClassName,T)}}FF.ClassName="FGRotate2DBlock",(0,a.h)(FF.ClassName,FF);class AF extends gX{constructor(T){super(XX,XX,Iz,XX,((T,z,X)=>F.j.TransformCoordinates(T,F.d.RotationAxis(z,X))),AF.ClassName,T)}}AF.ClassName="FGRotate3DBlock",(0,a.h)(AF.ClassName,AF);class uF extends tX{constructor(T){super(bX,bX,(T=>F.d.Transpose(T)),uF.ClassName,T)}}uF.ClassName="FGTransposeBlock",(0,a.h)(uF.ClassName,uF);class yF extends tX{constructor(T){super(bX,Iz,(T=>T.determinant()),yF.ClassName,T)}}yF.ClassName="FGDeterminantBlock",(0,a.h)(yF.ClassName,yF);class EF extends tX{constructor(T){super(bX,bX,(T=>F.d.Invert(T)),EF.ClassName,T)}}EF.ClassName="FGInvertMatrixBlock",(0,a.h)(EF.ClassName,EF);class vF extends YX{constructor(T){super(bX,bX,bX,((T,z)=>z.multiply(T)),vF.ClassName,T)}}vF.ClassName="FGMatMulBlock",(0,a.h)(vF.ClassName,vF);class kF extends tX{constructor(T){super(FX,FX,(T=>new Qz(~T.value)),kF.ClassName,T)}}kF.ClassName="FGBitwiseNotBlock",(0,a.h)(kF.ClassName,kF);class LF extends YX{constructor(T){super(FX,FX,FX,((T,z)=>new Qz(T.value&z.value)),LF.ClassName,T)}}LF.ClassName="FGBitwiseAndBlock",(0,a.h)(LF.ClassName,LF);class DF extends YX{constructor(T){super(FX,FX,FX,((T,z)=>new Qz(T.value|z.value)),DF.ClassName,T)}}DF.ClassName="FGBitwiseOrBlock",(0,a.h)(DF.ClassName,DF);class cF extends YX{constructor(T){super(FX,FX,FX,((T,z)=>new Qz(T.value^z.value)),cF.ClassName,T)}}cF.ClassName="FGBitwiseXorBlock",(0,a.h)(cF.ClassName,cF);class pF extends YX{constructor(T){super(FX,FX,FX,((T,z)=>new Qz(T.value<<z.value)),pF.ClassName,T)}}pF.ClassName="FGBitwiseLeftShiftBlock",(0,a.h)(pF.ClassName,pF);class HF extends YX{constructor(T){super(FX,FX,FX,((T,z)=>new Qz(T.value>>z.value)),HF.ClassName,T)}}HF.ClassName="FGBitwiseRightShiftBlock",(0,a.h)(HF.ClassName,HF);class UF extends tX{constructor(T){super(FX,FX,(T=>new Qz(Math.clz32(T.value))),UF.ClassName,T)}}UF.ClassName="FGCountLeadingZerosBlock",(0,a.h)(UF.ClassName,UF);class sF extends tX{constructor(T){super(FX,FX,(T=>new Qz(T.value?31-Math.clz32(T.value&-T.value):32)),sF.ClassName,T)}}sF.ClassName="FGCountTrailingZerosBlock",(0,a.h)(sF.ClassName,sF);class xF extends tX{constructor(T){super(FX,FX,(T=>new Qz(function(T){let z=0;for(;T;)z+=1&T,T>>=1;return z}(T.value))),xF.ClassName,T)}}xF.ClassName="FGCountOneBitsBlock",(0,a.h)(xF.ClassName,xF);class KF extends VX{constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new Qz(0)};super(T),this.config=T,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",FX),this.value=this.registerDataOutput("value",FX)}_execute(T,z){if(z===this.reset)this.value.setValue(this.config.startIndex,T);else{const z=this.value.getValue(T);z.value<this.n.getValue(T).value&&(this.value.setValue(new Qz(z.value+1),T),this.out._activateSignal(T))}}getClassName(){return KF.ClassName}}KF.ClassName="FGDoNBlock",(0,a.h)(KF.ClassName,KF);class dF extends kX{constructor(T){super(T),this.config=T,this.output=this.registerDataOutput(T.variableName,Jz)}_updateOutputs(T){const z=this.config.variableName;T.hasVariable(z)&&this.output.setValue(T.getVariable(z),T)}getClassName(){return dF.ClassName}serialize(T){super.serialize(T),T.config.variableName=this.config.variableName}}dF.ClassName="FGGetVariableBlock",(0,a.h)(dF.ClassName,dF);class NF extends VX{constructor(T){super(T),this.config=T,this.input=this.registerDataInput(T.variableName,Jz)}_execute(T){const z=this.config.variableName,X=this.input.getValue(T);T.setVariable(z,X),this.out._activateSignal(T)}getClassName(){return NF.ClassName}}NF.ClassName="FGSetVariableBlock",(0,a.h)(NF.ClassName,NF);class lF extends VX{constructor(T){super(T),this.config=T,this.condition=this.registerDataInput("condition",TX),this.loopBody=this._registerSignalOutput("loopBody")}_execute(T,z){var X;let b=this.condition.getValue(T);for(null!==(X=this.config)&&void 0!==X&&X.isDo&&!b&&this.loopBody._activateSignal(T);b;)this.loopBody._activateSignal(T),b=this.condition.getValue(T);this.out._activateSignal(T)}getClassName(){return lF.ClassName}serialize(T){var z;super.serialize(T),T.isDo=null===(z=this.config)||void 0===z?void 0:z.isDo}}lF.ClassName="FGWhileLoopBlock",(0,a.h)(lF.ClassName,lF);const aF={"lifecycle/onStart":aX.ClassName,"lifecycle/onTick":qX.ClassName,log:CX.ClassName,"flow/delay":jX.ClassName,"customEvent/send":ZX.ClassName,"customEvent/receive":mX.ClassName,"flow/sequence":SX.ClassName,"world/get":PX.ClassName,"world/set":WX.ClassName,"flow/doN":KF.ClassName,"variable/get":dF.ClassName,"variable/set":NF.ClassName,"flow/whileLoop":lF.ClassName,"math/random":IX.ClassName,"math/e":zb.ClassName,"math/pi":Xb.ClassName,"math/inf":bb.ClassName,"math/nan":Fb.ClassName,"math/abs":ub.ClassName,"math/sign":yb.ClassName,"math/trunc":Eb.ClassName,"math/floor":vb.ClassName,"math/ceil":kb.ClassName,"math/fract":Lb.ClassName,"math/neg":Db.ClassName,"math/add":hX.ClassName,"math/sub":QX.ClassName,"math/mul":wX.ClassName,"math/div":JX.ClassName,"math/rem":pb.ClassName,"math/min":Hb.ClassName,"math/max":Ub.ClassName,"math/clamp":Kb.ClassName,"math/saturate":Nb.ClassName,"math/mix":lb.ClassName,"math/eq":ab.ClassName,"math/lt":Vb.ClassName,"math/le":Cb.ClassName,"math/gt":Gb.ClassName,"math/ge":jb.ClassName,"math/isnan":Zb.ClassName,"math/isinf":mb.ClassName,"math/rad":Sb.ClassName,"math/deg":nb.ClassName,"math/sin":Ob.ClassName,"math/cos":Pb.ClassName,"math/tan":Wb.ClassName,"math/asin":Bb.ClassName,"math/acos":eb.ClassName,"math/atan":Rb.ClassName,"math/atan2":Yb.ClassName,"math/sinh":ib.ClassName,"math/cosh":tb.ClassName,"math/tanh":gb.ClassName,"math/asinh":Mb.ClassName,"math/acosh":rb.ClassName,"math/atanh":ob.ClassName,"math/exp":fb.ClassName,"math/log":hb.ClassName,"math/log2":Qb.ClassName,"math/log10":wb.ClassName,"math/sqrt":Jb.ClassName,"math/cbrt":Ib.ClassName,"math/pow":TF.ClassName,"math/length":zF.ClassName,"math/normalize":XF.ClassName,"math/dot":Tb.ClassName,"math/cross":bF.ClassName,"math/rotate2d":FF.ClassName,"math/rotate3d":AF.ClassName,"math/transpose":uF.ClassName,"math/determinant":yF.ClassName,"math/inverse":EF.ClassName,"math/matmul":vF.ClassName,"math/not":kF.ClassName,"math/and":LF.ClassName,"math/or":DF.ClassName,"math/xor":cF.ClassName,"math/asr":HF.ClassName,"math/lsl":pF.ClassName,"math/clz":UF.ClassName,"math/ctz":sF.ClassName,"math/popcnt":xF.ClassName},qF={float2:"Vector2",float3:"Id",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function VF(T,z,X){if(void 0!==T.type){const b=z.types&&z.types[T.type];if(!b)throw new Error(`${X}: Unknown type: ${T.type}`);const F=b.signature;if(!F)throw new Error(`${X}: Type ${T.type} has no signature`);const A=qF[F];return{value:T.value,className:A}}return T.value}function CF(T,z,X){const b=aF[z.type];if(!b)throw new Error(`/extensions/KHR_interactivity/nodes/${T}: Unknown block type: ${z.type}`);const F=T.toString(),A=function(T,z,X){const b={},F=T.configuration??[];for(const A of F)if("customEvent"===A.id){const T=z.customEvents&&z.customEvents[A.value];if(!T)throw new Error(`/extensions/KHR_interactivity/nodes/${X}: Unknown custom event: ${A.value}`);b.eventId=T.id,b.eventData=T.values.map((T=>T.id))}else if("variable"===A.id){const T=z.variables&&z.variables[A.value];if(!T)throw new Error(`/extensions/KHR_interactivity/nodes/${X}: Unknown variable: ${A.value}`);b.variableName=T.id}else if("path"===A.id){const T=A.value;b.path=T}else b[A.id]=VF(A,z,`/extensions/KHR_interactivity/nodes/${X}`);return b}(z,X,F);return{className:b,config:A,uniqueId:F,metadata:z.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class GF extends az{constructor(T){super(T,ZF)}}const jF={__array__:{__target__:!0,translation:{type:"Id",get:T=>T._babylonTransformNode.position,set:(T,z)=>{z._babylonTransformNode.position=T},getObject:T=>T._babylonTransformNode}}},ZF={nodes:jF},mF="KHR_interactivity";class SF{constructor(T){this._loader=T,this.name=mF,this.enabled=this._loader.isExtensionUsed(mF),this._pathConverter=new GF(this._loader.kj)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var T;if(!this._loader.babylonScene||!this._pathConverter)return;const z=this._loader.babylonScene,X=function(T){const z={uniqueId:(0,fz.b)(),_userVariables:{},_connectionValues:{}},X=[z],b=[];for(let A=0;A<T.nodes.length;A++){const z=CF(A,T.nodes[A],T);b.push(z)}for(let A=0;A<T.nodes.length;A++){const X=T.nodes[A],F=b[A],u=X.flows??[];for(const T of u){const z=T.id,X={uniqueId:(0,fz.b)(),name:z,_connectionType:1,connectedPointIds:[]};F.signalOutputs.push(X);const u=T.node,y=T.socket,E=b[u];if(!E)throw new Error(`/extensions/KHR_interactivity/nodes/${A}: Could not find node with id ${u} that connects its input with with node ${A}'s output ${z}`);let v=E.signalInputs.find((T=>T.name===y));v||(v={uniqueId:(0,fz.b)(),name:y,_connectionType:0,connectedPointIds:[]},E.signalInputs.push(v)),v.connectedPointIds.push(X.uniqueId),X.connectedPointIds.push(v.uniqueId)}const y=X.values??[];for(const E of y){const X=E.id,u={uniqueId:(0,fz.b)(),name:X,_connectionType:0,connectedPointIds:[]};if(F.dataInputs.push(u),void 0!==E.value){const X=VF(E,T,`/extensions/KHR_interactivity/nodes/${A}`);z._connectionValues[u.uniqueId]=X}else{if(void 0===E.node||void 0===E.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${A}: Invalid socket ${X} in node ${A}`);{const T=E.node,z=E.socket,F=b[T];if(!F)throw new Error(`/extensions/KHR_interactivity/nodes/${A}: Could not find node with id ${T} that connects its output with node${A}'s input ${X}`);let y=F.dataOutputs.find((T=>T.name===z));y||(y={uniqueId:(0,fz.b)(),name:z,_connectionType:1,connectedPointIds:[]},F.dataOutputs.push(y)),u.connectedPointIds.push(y.uniqueId),y.connectedPointIds.push(u.uniqueId)}}}}const F=T.variables??[];for(let A=0;A<F.length;A++){const X=F[A],b=X.id;z._userVariables[b]=VF(X,T,`/extensions/KHR_interactivity/variables/${A}`)}return{allBlocks:b,executionContexts:X}}(null===(T=this._loader.kj.extensions)||void 0===T?void 0:T.KHR_interactivity),b=new lX({ve:z});NX.Parse(X,{coordinator:b,pathConverter:this._pathConverter}),b.start()}}f(mF),o(mF,!0,(T=>new SF(T)));const nF="KHR_node_visibility";class OF{constructor(T){this.name=nF,this._loader=T,this.enabled=T.isExtensionUsed(nF)}async onReady(){var T;null===(T=this._loader.kj.nodes)||void 0===T||T.forEach((T=>{var z,X,b,F;(null===(z=T._primitiveBabylonMeshes)||void 0===z||z.forEach((T=>{T.inheritVisibility=!0})),null!==(X=T.extensions)&&void 0!==X&&X.KHR_node_visibility)&&(!1===(null===(b=T.extensions)||void 0===b?void 0:b.KHR_node_visibility.visible)&&(T._babylonTransformNode&&(T._babylonTransformNode.isVisible=!1),null===(F=T._primitiveBabylonMeshes)||void 0===F||F.forEach((T=>{T.isVisible=!1}))))}))}dispose(){this._loader=null}}f(nF),o(nF,!0,(T=>new OF(T)));const PF="ExtrasAsMetadata";class WF{_assignExtras(T,z){if(z.extras&&Object.keys(z.extras).length>0){const X=T.metadata=T.metadata||{};(X.kj=X.kj||{}).extras=z.extras}}constructor(T){this.name=PF,this.enabled=!0,this._loader=T}dispose(){this._loader=null}loadNodeAsync(T,z,X){return this._loader.loadNodeAsync(T,z,(T=>{this._assignExtras(T,z),X(T)}))}loadCameraAsync(T,z,X){return this._loader.loadCameraAsync(T,z,(T=>{this._assignExtras(T,z),X(T)}))}createMaterial(T,z,X){const b=this._loader.createMaterial(T,z,X);return this._assignExtras(b,z),b}}f(PF),o(PF,!1,(T=>new WF(T)))},12508:(T,z,X)=>{"use strict";X.d(z,{d:()=>m,g:()=>q,j:()=>a,k:()=>V});var b=X(968),F=X(1166),A=X(12025),u=X(11933),y=X(11973),E=X(11970),v=X(1065),k=X(1007),L=X(12515),D=X(12521),c=X(11944);class p{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.pe=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.qe=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(T){this._environmentTexture=T}getNodes(){let T=[];return T=T.concat(this.meshes),T=T.concat(this.lights),T=T.concat(this.cameras),T=T.concat(this.transformNodes),this.skeletons.forEach((z=>T=T.concat(z.bones))),T}}class H extends p{}class U{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((T=>{T.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((T=>{T.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((T=>{T.dispose()})),this.animationGroups.length=0}}class s extends p{constructor(T){super(),this._wasAddedToScene=!1,(T=T||k.e.LastCreatedScene)&&(this.ve=T,this.proceduralTextures=[],T.Qd.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=T.getEngine().onContextRestoredObservable.add((()=>{for(const T of this.geometries)T._rebuild();for(const T of this.meshes)T._rebuild();for(const T of this.pe)T.rebuild();for(const T of this.textures)T._rebuild()})))}_topologicalSort(T){const z=new Map;for(const u of T)z.set(u.uniqueId,u);const X={dependsOn:new Map,dependedBy:new Map};for(const u of T){const T=u.uniqueId;X.dependsOn.set(T,new Set),X.dependedBy.set(T,new Set)}for(const u of T){const T=u.uniqueId,b=X.dependsOn.get(T);if(u instanceof L.d){const F=u.sourceMesh;z.has(F.uniqueId)&&(b.add(F.uniqueId),X.dependedBy.get(F.uniqueId).add(T))}const F=X.dependedBy.get(T);for(const A of u.getDescendants()){const b=A.uniqueId;if(z.has(b)){F.add(b);X.dependsOn.get(b).add(T)}}}const b=[],F=[];for(const u of T){const T=u.uniqueId;0===X.dependsOn.get(T).size&&(F.push(u),z.delete(T))}const A=F;for(;A.length>0;){const T=A.shift();b.push(T);const F=X.dependedBy.get(T.uniqueId);for(const b of Array.from(F.values())){const F=X.dependsOn.get(b);F.delete(T.uniqueId),0===F.size&&z.get(b)&&(A.push(z.get(b)),z.delete(b))}}return z.size>0&&(v.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),z.forEach((T=>v.e.Error(T.name)))),b}_addNodeAndDescendantsToList(T,z,X,b){if(X&&(!b||b(X))&&!z.has(X.uniqueId)){T.push(X),z.add(X.uniqueId);for(const F of X.getDescendants(!0))this._addNodeAndDescendantsToList(T,z,F,b)}}_isNodeInContainer(T){return T instanceof E.c&&-1!==this.meshes.indexOf(T)||(T instanceof y.e&&-1!==this.transformNodes.indexOf(T)||(T instanceof D.c&&-1!==this.lights.indexOf(T)||T instanceof c.c&&-1!==this.cameras.indexOf(T)))}_isValidHierarchy(){for(const T of this.meshes)if(T.parent&&!this._isNodeInContainer(T.parent))return v.e.Warn(`Node ${T.name} has a parent that is not in the container.`),!1;for(const T of this.transformNodes)if(T.parent&&!this._isNodeInContainer(T.parent))return v.e.Warn(`Node ${T.name} has a parent that is not in the container.`),!1;for(const T of this.lights)if(T.parent&&!this._isNodeInContainer(T.parent))return v.e.Warn(`Node ${T.name} has a parent that is not in the container.`),!1;for(const T of this.cameras)if(T.parent&&!this._isNodeInContainer(T.parent))return v.e.Warn(`Node ${T.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(T){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],X=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||F.g.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const b={},A={},y=new U,E=[],v=[],k={doNotInstantiate:!0,...X},L=[],D=new Set;for(const F of this.transformNodes)null===F.parent&&this._addNodeAndDescendantsToList(L,D,F,k.predicate);for(const F of this.meshes)null===F.parent&&this._addNodeAndDescendantsToList(L,D,F,k.predicate);const c=this._topologicalSort(L),p=(X,F)=>{if(((z,X)=>{if(b[z.uniqueId]=X.uniqueId,A[X.uniqueId]=X,T&&(X.name=T(z.name)),X instanceof u.e){const T=X;if(T.morphTargetManager){const X=z.morphTargetManager;T.morphTargetManager=X.clone();for(let z=0;z<X.numTargets;z++){const F=X.getTarget(z),u=T.morphTargetManager.getTarget(z);b[F.uniqueId]=u.uniqueId,A[u.uniqueId]=u}}}})(X,F),X.parent){const T=b[X.parent.uniqueId],z=A[T];F.parent=z||X.parent}if(F.position&&X.position&&F.position.p(X.position),F.rotationQuaternion&&X.rotationQuaternion&&F.rotationQuaternion.p(X.rotationQuaternion),F.rotation&&X.rotation&&F.rotation.p(X.rotation),F.Pd&&X.Pd&&F.Pd.p(X.Pd),F.material){const u=F;if(u.material)if(z){const z=X.material;if(-1===v.indexOf(z)){let X=z.clone(T?T(z.name):"Clone of "+z.name);if(v.push(z),b[z.uniqueId]=X.uniqueId,A[X.uniqueId]=X,"MultiMaterial"===z.getClassName()){const F=z;for(const z of F.Gg)z&&(X=z.clone(T?T(z.name):"Clone of "+z.name),v.push(z),b[z.uniqueId]=X.uniqueId,A[X.uniqueId]=X);F.Gg=F.Gg.map((T=>T&&A[b[T.uniqueId]]))}}"InstancedMesh"!==u.getClassName()&&(u.material=A[b[z.uniqueId]])}else"MultiMaterial"===u.material.getClassName()?-1===this.ve.multiMaterials.indexOf(u.material)&&this.ve.addMultiMaterial(u.material):-1===this.ve.materials.indexOf(u.material)&&this.ve.addMaterial(u.material)}null===F.parent&&y.rootNodes.push(F)};return c.forEach((T=>{if("InstancedMesh"===T.getClassName()){const z=T,X=z.sourceMesh,F=b[X.uniqueId],u=("number"===typeof F?A[F]:X).Db(z.name);p(z,u)}else{let z=!0;"mb"===T.getClassName()||"Node"===T.getClassName()||T.skeleton||!T.getTotalVertices||0===T.getTotalVertices()?z=!1:k.doNotInstantiate&&(z="function"===typeof k.doNotInstantiate?!k.doNotInstantiate(T):!k.doNotInstantiate);const X=z?T.Db(`instance of ${T.name}`):T.clone(`Clone of ${T.name}`,null,!0);if(!X)throw new Error(`Could not clone or instantiate node on Asset Container ${T.name}`);p(T,X)}})),this.skeletons.forEach((z=>{if(k.predicate&&!k.predicate(z))return;const X=z.clone(T?T(z.name):"Clone of "+z.name);for(const T of this.meshes)if(T.skeleton===z&&!T.isAnInstance){const z=A[b[T.uniqueId]];if(!z||z.isAnInstance)continue;if(z.skeleton=X,-1!==E.indexOf(X))continue;E.push(X);for(const T of X.bones)T._linkedTransformNode&&(T._linkedTransformNode=A[b[T._linkedTransformNode.uniqueId]])}y.skeletons.push(X)})),this.animationGroups.forEach((z=>{if(k.predicate&&!k.predicate(z))return;const X=z.clone(T?T(z.name):"Clone of "+z.name,(T=>A[b[T.uniqueId]]||T));y.animationGroups.push(X)})),y}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||F.g.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.ve.environmentTexture=this.environmentTexture);for(const T of this.ve._serializableComponents)T.addFromContainer(this);this.ve.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const z=[];this.cameras.forEach((X=>{T&&!T(X)||(this.ve.addCamera(X),z.push(X))})),this.lights.forEach((X=>{T&&!T(X)||(this.ve.addLight(X),z.push(X))})),this.meshes.forEach((X=>{T&&!T(X)||(this.ve.we(X),z.push(X))})),this.skeletons.forEach((z=>{T&&!T(z)||this.ve.addSkeleton(z)})),this.animations.forEach((z=>{T&&!T(z)||this.ve.addAnimation(z)})),this.animationGroups.forEach((z=>{T&&!T(z)||this.ve.addAnimationGroup(z)})),this.multiMaterials.forEach((z=>{T&&!T(z)||this.ve.addMultiMaterial(z)})),this.materials.forEach((z=>{T&&!T(z)||this.ve.addMaterial(z)})),this.morphTargetManagers.forEach((z=>{T&&!T(z)||this.ve.addMorphTargetManager(z)})),this.geometries.forEach((z=>{T&&!T(z)||this.ve.addGeometry(z)})),this.transformNodes.forEach((X=>{T&&!T(X)||(this.ve.addTransformNode(X),z.push(X))})),this.actionManagers.forEach((z=>{T&&!T(z)||this.ve.addActionManager(z)})),this.textures.forEach((z=>{T&&!T(z)||this.ve.addTexture(z)})),this.reflectionProbes.forEach((z=>{T&&!T(z)||this.ve.addReflectionProbe(z)}));for(const X of z)X.parent&&-1===this.ve.getNodes().indexOf(X.parent)&&(X.setParent?X.setParent(null):X.parent=null)}removeAllFromScene(){this._isValidHierarchy()||F.g.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.ve.environmentTexture&&(this.ve.environmentTexture=null);for(const T of this.ve._serializableComponents)T.removeFromContainer(this)}removeFromScene(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((z=>{T&&!T(z)||this.ve.removeCamera(z)})),this.lights.forEach((z=>{T&&!T(z)||this.ve.removeLight(z)})),this.meshes.forEach((z=>{T&&!T(z)||this.ve.ye(z,!0)})),this.skeletons.forEach((z=>{T&&!T(z)||this.ve.removeSkeleton(z)})),this.animations.forEach((z=>{T&&!T(z)||this.ve.removeAnimation(z)})),this.animationGroups.forEach((z=>{T&&!T(z)||this.ve.removeAnimationGroup(z)})),this.multiMaterials.forEach((z=>{T&&!T(z)||this.ve.removeMultiMaterial(z)})),this.materials.forEach((z=>{T&&!T(z)||this.ve.removeMaterial(z)})),this.morphTargetManagers.forEach((z=>{T&&!T(z)||this.ve.removeMorphTargetManager(z)})),this.geometries.forEach((z=>{T&&!T(z)||this.ve.removeGeometry(z)})),this.transformNodes.forEach((z=>{T&&!T(z)||this.ve.removeTransformNode(z)})),this.actionManagers.forEach((z=>{T&&!T(z)||this.ve.removeActionManager(z)})),this.textures.forEach((z=>{T&&!T(z)||this.ve.removeTexture(z)})),this.reflectionProbes.forEach((z=>{T&&!T(z)||this.ve.removeReflectionProbe(z)}))}dispose(){this.cameras.slice(0).forEach((T=>{T.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((T=>{T.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((T=>{T.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((T=>{T.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((T=>{T.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((T=>{T.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((T=>{T.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((T=>{T.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((T=>{T.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((T=>{T.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((T=>{T.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((T=>{T.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((T=>{T.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const T of this.ve._serializableComponents)T.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.ve.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(T,z,X){if(T&&z)for(const b of T){let T=!0;if(X)for(const z of X)if(b===z){T=!1;break}T&&(z.push(b),b._parentContainer=this)}}moveAllFromScene(T){this._wasAddedToScene=!1,void 0===T&&(T=new H);for(const z in this)Object.prototype.hasOwnProperty.call(this,z)&&(this[z]=this[z]||("_environmentTexture"===z?null:[]),this._moveAssets(this.ve[z],this[z],T[z]));this.environmentTexture=this.ve.environmentTexture,this.removeAllFromScene()}createRootMesh(){const T=new u.e("assetContainerRootMesh",this.ve);return this.meshes.forEach((z=>{z.parent||T.addChild(z)})),this.meshes.unshift(T),T}mergeAnimationsTo(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.e.LastCreatedScene,z=arguments.length>1?arguments[1]:void 0,X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!T)return v.e.Error("No scene available to merge animations to"),[];const b=X||(z=>{let X=null;const b=z.animations.length?z.animations[0].targetProperty:"",F=z.name.split(".").join("").split("_primitive")[0];switch(b){case"position":case"rotationQuaternion":X=T.getTransformNodeByName(z.name)||T.getTransformNodeByName(F);break;case"influence":X=T.getMorphTargetByName(z.name)||T.getMorphTargetByName(F);break;default:X=T.getNodeByName(z.name)||T.getNodeByName(F)}return X});this.getNodes().forEach((T=>{const z=b(T);if(null!==z){for(const X of T.animations){const T=z.animations.filter((T=>T.targetProperty===X.targetProperty));for(const X of T){const T=z.animations.indexOf(X,0);T>-1&&z.animations.splice(T,1)}}z.animations=z.animations.concat(T.animations)}}));const F=[];return this.animationGroups.slice().forEach((T=>{F.push(T.clone(T.name,b)),T.animatables.forEach((T=>{T.stop()}))})),z.forEach((z=>{const X=b(z.target);X&&(T.beginAnimation(X,z.fromFrame,z.toFrame,z.loopAnimation,z.speedRatio,z.onAnimationEnd?z.onAnimationEnd:void 0,void 0,!0,void 0,z.onAnimationLoop?z.onAnimationLoop:void 0),T.stopAnimation(z.target))})),F}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((T=>{T.parent||-1!==this.rootNodes.indexOf(T)||this.rootNodes.push(T)})),this.transformNodes.forEach((T=>{T.parent||-1!==this.rootNodes.indexOf(T)||this.rootNodes.push(T)})),this.lights.forEach((T=>{T.parent||-1!==this.rootNodes.indexOf(T)||this.rootNodes.push(T)})),this.cameras.forEach((T=>{T.parent||-1!==this.rootNodes.indexOf(T)||this.rootNodes.push(T)}))}addAllAssetsToContainer(T){if(!T)return;const z=[],X=new Set;for(z.push(T);z.length>0;){const T=z.pop();if(T instanceof u.e?(T.Ee&&-1===this.geometries.indexOf(T.Ee)&&this.geometries.push(T.Ee),this.meshes.push(T)):T instanceof y.e?this.transformNodes.push(T):T instanceof D.c?this.lights.push(T):T instanceof c.c&&this.cameras.push(T),T instanceof E.c){if(T.material&&-1===this.materials.indexOf(T.material)){this.materials.push(T.material);for(const z of T.material.getActiveTextures())-1===this.textures.indexOf(z)&&this.textures.push(z)}T.skeleton&&-1===this.skeletons.indexOf(T.skeleton)&&this.skeletons.push(T.skeleton),T.morphTargetManager&&-1===this.morphTargetManagers.indexOf(T.morphTargetManager)&&this.morphTargetManagers.push(T.morphTargetManager)}for(const b of T.getChildren())X.has(b)||z.push(b);X.add(T)}this.populateRootNodes()}}var x=X(1044);class K{constructor(T){this.byteOffset=0,this.buffer=T}loadAsync(T){return this.buffer.readAsync(this.byteOffset,T).then((T=>{this._dataView=new DataView(T.buffer,T.byteOffset,T.byteLength),this._dataByteOffset=0}))}readUint32(){const T=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,T}readUint8Array(T){const z=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,T);return this._dataByteOffset+=T,this.byteOffset+=T,z}readString(T){return(0,x.j)(this.readUint8Array(T))}skipBytes(T){this._dataByteOffset+=T,this.byteOffset+=T}}var d=X(12525);const N="Z2xURg",l={name:"kj",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:T=>-1!==T.indexOf("asset")&&-1!==T.indexOf("version")||T.startsWith("data:base64,"+N)||T.startsWith("data:;base64,"+N)||T.startsWith("data:application/octet-stream;base64,"+N)||T.startsWith("data:model/gltf-binary;base64,"+N)};var a,q,V,C=X(1030),G=X(1039);function j(T,z,X){try{return Promise.resolve(new Uint8Array(T,z,X))}catch(b){return Promise.reject(b)}}!function(T){T[T.AUTO=0]="AUTO",T[T.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(a||(a={})),function(T){T[T.NONE=0]="NONE",T[T.FIRST=1]="FIRST",T[T.ALL=2]="ALL"}(q||(q={})),function(T){T[T.LOADING=0]="LOADING",T[T.READY=1]="READY",T[T.COMPLETE=2]="COMPLETE"}(V||(V={}));class Z{constructor(){this.coordinateSystemMode=a.AUTO,this.animationStartMode=q.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=T=>Promise.resolve(T),this.extensionOptions={}}p(T){T&&(this.onParsed=T.onParsed,this.coordinateSystemMode=T.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=T.animationStartMode??this.animationStartMode,this.loadNodeAnimations=T.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=T.loadSkins??this.loadSkins,this.loadMorphTargets=T.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=T.compileMaterials??this.compileMaterials,this.useClipPlane=T.useClipPlane??this.useClipPlane,this.compileShadowGenerators=T.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=T.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=T.useRangeRequests??this.useRangeRequests,this.createInstances=T.createInstances??this.createInstances,this.alwaysComputeBoundingBox=T.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=T.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=T.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=T.skipMaterials??this.skipMaterials,this.useSRGBBuffers=T.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=T.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=T.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=T.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=T.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=T.customRootNode,this.onMeshLoaded=T.onMeshLoaded,this.onSkinLoaded=T.onSkinLoaded,this.onTextureLoaded=T.onTextureLoaded,this.onMaterialLoaded=T.onMaterialLoaded,this.onCameraLoaded=T.onCameraLoaded,this.extensionOptions=T.extensionOptions??this.extensionOptions)}}class m extends Z{constructor(T){super(),this.onParsedObservable=new b.d,this.onMeshLoadedObservable=new b.d,this.onSkinLoadedObservable=new b.d,this.onTextureLoadedObservable=new b.d,this.onMaterialLoadedObservable=new b.d,this.onCameraLoadedObservable=new b.d,this.onCompleteObservable=new b.d,this.onErrorObservable=new b.d,this.Qd=new b.d,this.onExtensionLoadedObservable=new b.d,this.validate=!1,this.onValidatedObservable=new b.d,this._loader=null,this._state=null,this._requests=new Array,this.name=l.name,this.extensions=l.extensions,this.onLoaderStateChangedObservable=new b.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(T)}set onParsed(T){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),T&&(this._onParsedObserver=this.onParsedObservable.add(T))}set onMeshLoaded(T){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),T&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(T))}set onSkinLoaded(T){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),T&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((z=>T(z.node,z.skinnedNode))))}set onTextureLoaded(T){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),T&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(T))}set onMaterialLoaded(T){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),T&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(T))}set onCameraLoaded(T){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),T&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(T))}set onComplete(T){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(T)}set onError(T){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(T)}set onDispose(T){this._onDisposeObserver&&this.Qd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Qd.add(T)}set onExtensionLoaded(T){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(T)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(T){this._loggingEnabled!==T&&(this._loggingEnabled=T,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(T){this._capturePerformanceCounters!==T&&(this._capturePerformanceCounters=T,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(T){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(T)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const T of this._requests)T.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=T=>Promise.resolve(T),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Qd.notifyObservers(void 0),this.Qd.clear()}loadFile(T,z,X,A,u,y,E,k){if(ArrayBuffer.isView(z))return this._loadBinary(T,z,X,A,E,k),null;this._progressCallback=u;const L=z.name||F.g.GetFilename(z);if(y){if(this.useRangeRequests){this.validate&&v.e.Warn("glTF validation is not supported when range requests are enabled");const X={abort:()=>{},onCompleteObservable:new b.d},F={readAsync:(X,b)=>new Promise(((F,A)=>{this._loadFile(T,z,(T=>{F(new Uint8Array(T))}),!0,(T=>{A(T)}),(T=>{T.setRequestHeader("Range",`bytes=${X}-${X+b-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new K(F)).then((T=>{X.onCompleteObservable.notifyObservers(X),A(T)}),E?T=>E(void 0,T):void 0),X}return this._loadFile(T,z,(z=>{this._validate(T,new Uint8Array(z,0,z.byteLength),X,L),this._unpackBinaryAsync(new K({readAsync:(T,X)=>j(z,T,X),byteLength:z.byteLength})).then((T=>{A(T)}),E?T=>E(void 0,T):void 0)}),!0,E)}return this._loadFile(T,z,(z=>{try{this._validate(T,z,X,L),A({json:this._parseJson(z)})}catch{E&&E()}}),!1,E)}_loadBinary(T,z,X,b,F,A){this._validate(T,new Uint8Array(z.buffer,z.byteOffset,z.byteLength),X,A),this._unpackBinaryAsync(new K({readAsync:(T,X)=>function(T,z,X){try{if(z<0||z>=T.byteLength)throw new RangeError("Offset is out of range.");if(z+X>T.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(T.buffer,T.byteOffset+z,X))}catch(b){return Promise.reject(b)}}(z,T,X),byteLength:z.byteLength})).then((T=>{b(T)}),F?T=>F(void 0,T):void 0)}importMeshAsync(T,z,X,b,F,A){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(X),this.onParsedObservable.clear(),this._log(`Loading ${A||""}`),this._loader=this._getLoader(X),this._loader.importMeshAsync(T,z,null,X,b,F,A))))}loadAsync(T,z,X,b,F){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(z),this.onParsedObservable.clear(),this._log(`Loading ${F||""}`),this._loader=this._getLoader(z),this._loader.loadAsync(T,z,X,b,F))))}loadAssetContainerAsync(T,z,X,b,F){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(z),this.onParsedObservable.clear(),this._log(`Loading ${F||""}`),this._loader=this._getLoader(z);const A=new s(T),u=[];this.onMaterialLoadedObservable.add((T=>{u.push(T)}));const y=[];this.onTextureLoadedObservable.add((T=>{y.push(T)}));const E=[];this.onCameraLoadedObservable.add((T=>{E.push(T)}));const v=[];return this.onMeshLoadedObservable.add((T=>{T.morphTargetManager&&v.push(T.morphTargetManager)})),this._loader.importMeshAsync(null,T,A,z,X,b,F).then((T=>(Array.prototype.push.apply(A.geometries,T.geometries),Array.prototype.push.apply(A.meshes,T.meshes),Array.prototype.push.apply(A.pe,T.pe),Array.prototype.push.apply(A.skeletons,T.skeletons),Array.prototype.push.apply(A.animationGroups,T.animationGroups),Array.prototype.push.apply(A.materials,u),Array.prototype.push.apply(A.textures,y),Array.prototype.push.apply(A.lights,T.lights),Array.prototype.push.apply(A.transformNodes,T.transformNodes),Array.prototype.push.apply(A.cameras,E),Array.prototype.push.apply(A.morphTargetManagers,v),A)))}))}canDirectLoad(T){return l.canDirectLoad(T)}directLoad(T,z){if(z.startsWith("base64,"+N)||z.startsWith(";base64,"+N)||z.startsWith("application/octet-stream;base64,"+N)||z.startsWith("model/gltf-binary;base64,"+N)){const X=(0,C.d)(z);return this._validate(T,new Uint8Array(X,0,X.byteLength)),this._unpackBinaryAsync(new K({readAsync:(T,z)=>j(X,T,z),byteLength:X.byteLength}))}return this._validate(T,z),Promise.resolve({json:this._parseJson(z)})}createPlugin(T){return new m(T[l.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((T,z)=>{this.onCompleteObservable.addOnce((()=>{T()})),this.onErrorObservable.addOnce((T=>{z(T)}))}))}_setState(T){this._state!==T&&(this._state=T,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(V[this._state]))}_loadFile(T,z,X,b,F,A){const u=T._loadFile(z,X,(T=>{this._onProgress(T,u)}),!0,b,F,A);return u.onCompleteObservable.add((()=>{u._lengthComputable=!0,u._total=u._loaded})),this._requests.push(u),u}_onProgress(T,z){if(!this._progressCallback)return;z._lengthComputable=T.lengthComputable,z._loaded=T.loaded,z._total=T.total;let X=!0,b=0,F=0;for(const A of this._requests){if(void 0===A._lengthComputable||void 0===A._loaded||void 0===A._total)return;X=X&&A._lengthComputable,b+=A._loaded,F+=A._total}this._progressCallback({lengthComputable:X,loaded:b,total:X?F:0})}_validate(T,z){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),d.d.ValidateAsync(z,X,b,(z=>this.preprocessUrlAsync(X+z).then((z=>T._loadFileAsync(z,void 0,!0,!0).then((T=>new Uint8Array(T,0,T.byteLength))))))).then((T=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(T),this.onValidatedObservable.clear()}),(T=>{this._endPerformanceCounter("Validate JSON"),F.g.Warn(`Failed to validate: ${T.message}`),this.onValidatedObservable.clear()})))}_getLoader(T){const z=T.json.asset||{};this._log(`Asset version: ${z.version}`),z.minVersion&&this._log(`Asset minimum version: ${z.minVersion}`),z.generator&&this._log(`Asset generator: ${z.generator}`);const X=m._parseVersion(z.version);if(!X)throw new Error("Invalid version: "+z.version);if(void 0!==z.minVersion){const T=m._parseVersion(z.minVersion);if(!T)throw new Error("Invalid minimum version: "+z.minVersion);if(m._compareVersion(T,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+z.minVersion)}const b={1:m._CreateGLTF1Loader,2:m._CreateGLTF2Loader}[X.major];if(!b)throw new Error("Unsupported version: "+z.version);return b(this)}_parseJson(T){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${T.length}`);const z=JSON.parse(T);return this._endPerformanceCounter("Parse JSON"),z}_unpackBinaryAsync(T){return this._startPerformanceCounter("Unpack Binary"),T.loadAsync(20).then((()=>{const z=T.readUint32();if(1179937895!==z)throw new G.i("Unexpected magic: "+z,G.g.GLTFLoaderUnexpectedMagicError);const X=T.readUint32();this.loggingEnabled&&this._log(`Binary version: ${X}`);const b=T.readUint32();let F;switch(this.useRangeRequests||b===T.buffer.byteLength||v.e.Warn(`Length in header does not match actual data length: ${b} != ${T.buffer.byteLength}`),X){case 1:F=this._unpackBinaryV1Async(T,b);break;case 2:F=this._unpackBinaryV2Async(T,b);break;default:throw new Error("Unsupported version: "+X)}return this._endPerformanceCounter("Unpack Binary"),F}))}_unpackBinaryV1Async(T,z){const X=T.readUint32(),b=T.readUint32();if(0!==b)throw new Error(`Unexpected content format: ${b}`);const F=z-T.byteOffset,A={json:this._parseJson(T.readString(X)),bin:null};if(0!==F){const z=T.byteOffset;A.bin={readAsync:(X,b)=>T.buffer.readAsync(z+X,b),byteLength:F}}return Promise.resolve(A)}_unpackBinaryV2Async(T,z){const X=1313821514,b=5130562,F=T.readUint32();if(T.readUint32()!==X)throw new Error("First chunk format is not JSON");return T.byteOffset+F===z?T.loadAsync(F).then((()=>({json:this._parseJson(T.readString(F)),bin:null}))):T.loadAsync(F+8).then((()=>{const A={json:this._parseJson(T.readString(F)),bin:null},u=()=>{const F=T.readUint32();switch(T.readUint32()){case X:throw new Error("Unexpected JSON chunk");case b:{const z=T.byteOffset;A.bin={readAsync:(X,b)=>T.buffer.readAsync(z+X,b),byteLength:F},T.skipBytes(F);break}default:T.skipBytes(F)}return T.byteOffset!==z?T.loadAsync(8).then(u):Promise.resolve(A)};return u()}))}static _parseVersion(T){if("1.0"===T||"1.0.1"===T)return{major:1,minor:0};const z=(T+"").match(/^(\d+)\.(\d+)/);return z?{major:parseInt(z[1]),minor:parseInt(z[2])}:null}static _compareVersion(T,z){return T.major>z.major?1:T.major<z.major?-1:T.minor>z.minor?1:T.minor<z.minor?-1:0}_logOpen(T){this._log(T),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(T){const z=m._logSpaces.substring(0,2*this._logIndentLevel);v.e.Log(`${z}${T}`)}_logDisabled(T){}_startPerformanceCounterEnabled(T){F.g.StartPerformanceCounter(T)}_startPerformanceCounterDisabled(T){}_endPerformanceCounterEnabled(T){F.g.EndPerformanceCounter(T)}_endPerformanceCounterDisabled(T){}}m.IncrementalLoading=!0,m.HomogeneousCoordinates=!1,m._logSpaces="                                ",(0,A.h)(new m)},12525:(T,z,X)=>{"use strict";X.d(z,{d:()=>u});var b=X(1166);function F(T,z,X,b){const F={externalResourceFunction:b};return X&&(F.uri="file:"===z?X:z+X),ArrayBuffer.isView(T)?GLTFValidator.validateBytes(T,F):GLTFValidator.validateString(T,F)}function A(){const T=[];onmessage=z=>{const X=z.data;switch(X.id){case"init":importScripts(X.url);break;case"validate":F(X.data,X.rootUrl,X.fileName,(z=>new Promise(((X,b)=>{const F=T.length;T.push({resolve:X,reject:b}),postMessage({id:"getExternalResource",index:F,uri:z})})))).then((T=>{postMessage({id:"validate.resolve",value:T})}),(T=>{postMessage({id:"validate.reject",reason:T})}));break;case"getExternalResource.resolve":T[X.index].resolve(X.value);break;case"getExternalResource.reject":T[X.index].reject(X.reason)}}}class u{static ValidateAsync(T,z,X,u){return"function"===typeof Worker?new Promise(((y,E)=>{const v=`${F}(${A})()`,k=URL.createObjectURL(new Blob([v],{type:"application/javascript"})),L=new Worker(k),D=T=>{L.removeEventListener("error",D),L.removeEventListener("message",c),E(T)},c=T=>{const z=T.data;switch(z.id){case"getExternalResource":u(z.uri).then((T=>{L.postMessage({id:"getExternalResource.resolve",index:z.index,value:T},[T.buffer])}),(T=>{L.postMessage({id:"getExternalResource.reject",index:z.index,reason:T})}));break;case"validate.resolve":L.removeEventListener("error",D),L.removeEventListener("message",c),y(z.value),L.terminate();break;case"validate.reject":L.removeEventListener("error",D),L.removeEventListener("message",c),E(z.reason),L.terminate()}};if(L.addEventListener("error",D),L.addEventListener("message",c),L.postMessage({id:"init",url:b.g.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(T)){const b=T.slice();L.postMessage({id:"validate",data:b,rootUrl:z,fileName:X},[b.buffer])}else L.postMessage({id:"validate",data:T,rootUrl:z,fileName:X})})):(this._LoadScriptPromise||(this._LoadScriptPromise=b.g.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>F(T,z,X,u))))}}u.Configuration={url:`${b.g._DefaultCdnUrl}/gltf_validator.js`}},12900:(T,z,X)=>{"use strict";X.d(z,{c:()=>a});var b=X(952),F=X(957),A=X(1122),u=X(976),y=X(1317),E=X(1326),v=X(1207),k=X(1159),L=X(993),D=X(1082);X(11563),X(11398),X(11571),X(11326),X(11574),X(11599),X(11603);const c="imageProcessingCompatibility",p="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";D.d.IncludesShadersStore[c]=p;const H="skyPixelShader",U="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";D.d.ShadersStore[H]=U;X(11372),X(11375),X(11454),X(11475),X(11457);const s="skyVertexShader",x="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";D.d.ShadersStore[s]=x;var K=X(1334),d=X(1310),N=X(1305);class l extends y.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class a extends E.c{constructor(T,z){super(T,z),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new u.j(0,100,0),this.useSunPosition=!1,this.cameraOffset=u.j.Zero(),this.up=u.j.Up(),this.dithering=!1,this._cameraPosition=u.j.Zero(),this._skyOrientation=new u.e}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(T,z){const X=z._drawWrapper;if(this.isFrozen&&X.effect&&X._wasPreviouslyReady)return!0;z.materialDefines||(z.materialDefines=new l);const b=z.materialDefines,F=this.va();if(this._isReadyForSubMesh(z))return!0;if((0,N.U)(T,F,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,b),(0,N.K)(T,b,!0,!1),b.IMAGEPROCESSINGPOSTPROCESS!==F.imageProcessingConfiguration.applyByPostProcess&&b.markAsMiscDirty(),b.DITHER!==this.dithering&&b.markAsMiscDirty(),b.isDirty){b.markAsProcessed(),F.resetCachedMaterial();const T=new K.d;b.FOG&&T.addFallback(1,"FOG"),b.IMAGEPROCESSINGPOSTPROCESS=F.imageProcessingConfiguration.applyByPostProcess,b.DITHER=this.dithering;const X=[v.e.PositionKind];b.VERTEXCOLOR&&X.push(v.e.ColorKind);const A="sky",u=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,d.d)(u);const y=b.toString();z.setEffect(F.getEngine().createEffect(A,X,u,[],y,T,this.onCompiled,this.onError),b,this._materialContext)}return!(!z.effect||!z.effect.isReady())&&(b._renderId=F.getRenderId(),X._wasPreviouslyReady=!0,!0)}bindForSubMesh(T,z,X){const b=this.va(),F=X.materialDefines;if(!F)return;const A=X.effect;if(!A)return;this._activeEffect=A,this.bindOnlyWorldMatrix(T),this._activeEffect.setMatrix("viewProjection",b.getTransformMatrix()),this._mustRebind(b,A,X)&&((0,d.e)(A,this,b),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,N.l)(F,A,b)),b.fogEnabled&&z.applyFog&&b.fogMode!==k.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",b.getViewMatrix()),(0,N.d)(b,z,this._activeEffect);const y=b.activeCamera;if(y){const T=y.getWorldMatrix();this._cameraPosition.x=T.m[12],this._cameraPosition.y=T.m[13],this._cameraPosition.z=T.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const T=Math.PI*(this.inclination-.5),z=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(z)*Math.cos(T),this.sunPosition.y=this.distance*Math.sin(-T),this.sunPosition.z=this.distance*Math.sin(z)*Math.cos(T),u.e.FromUnitVectorsToRef(u.j.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(z,this._activeEffect,X)}getAnimatables(){return[]}dispose(T){super.dispose(T)}clone(T){return A.b.Clone((()=>new a(T,this.va())),this)}serialize(){const T=super.serialize();return T.customType="BABYLON.SkyMaterial",T}getClassName(){return"SkyMaterial"}static Parse(T,z,X){return A.b.Parse((()=>new a(T.name,z)),T,z,X)}}(0,b.c)([(0,F.E)()],a.prototype,"luminance",void 0),(0,b.c)([(0,F.E)()],a.prototype,"turbidity",void 0),(0,b.c)([(0,F.E)()],a.prototype,"rayleigh",void 0),(0,b.c)([(0,F.E)()],a.prototype,"mieCoefficient",void 0),(0,b.c)([(0,F.E)()],a.prototype,"mieDirectionalG",void 0),(0,b.c)([(0,F.E)()],a.prototype,"distance",void 0),(0,b.c)([(0,F.E)()],a.prototype,"inclination",void 0),(0,b.c)([(0,F.E)()],a.prototype,"azimuth",void 0),(0,b.c)([(0,F.C)()],a.prototype,"sunPosition",void 0),(0,b.c)([(0,F.E)()],a.prototype,"useSunPosition",void 0),(0,b.c)([(0,F.C)()],a.prototype,"cameraOffset",void 0),(0,b.c)([(0,F.C)()],a.prototype,"up",void 0),(0,b.c)([(0,F.E)()],a.prototype,"dithering",void 0),(0,L.h)("BABYLON.SkyMaterial",a)},11695:(T,z,X)=>{"use strict";function b(T,z){z.headers=T.headers||{},z.statusMessage=T.statusText,z.statusCode=T.status,z.data=T.response}function F(T,z,X){return new Promise((function(F,A){X=X||{};var u,y,E,v=new XMLHttpRequest,k=X.body,L=X.headers||{};for(u in X.timeout&&(v.timeout=X.timeout),v.ontimeout=v.onerror=function(T){T.timeout="timeout"==T.type,A(T)},v.open(T,z.href||z),v.onload=function(){for(E=v.getAllResponseHeaders().trim().split(/[\r\n]+/),b(v,v);y=E.shift();)y=y.split(": "),v.headers[y.shift().toLowerCase()]=y.join(": ");if((y=v.headers["content-type"])&&~y.indexOf("application/json"))try{v.data=JSON.parse(v.data,X.reviver)}catch(T){return b(v,T),A(T)}(v.status>=400?A:F)(v)},typeof FormData<"u"&&k instanceof FormData||k&&"object"==typeof k&&(L["content-type"]="application/json",k=JSON.stringify(k)),v.withCredentials=!!X.withCredentials,L)v.setRequestHeader(u,L[u]);v.send(k)}))}X.r(z),X.d(z,{del:()=>E,get:()=>A,patch:()=>y,post:()=>u,put:()=>v,send:()=>F});var A=F.bind(F,"GET"),u=F.bind(F,"POST"),y=F.bind(F,"PATCH"),E=F.bind(F,"DELETE"),v=F.bind(F,"PUT")},12997:(T,z,X)=>{"use strict";X.d(z,{e:()=>L});const b=.5*(Math.sqrt(3)-1),F=(3-Math.sqrt(3))/6,A=1/3,u=1/6,y=(Math.sqrt(5)-1)/4,E=(5-Math.sqrt(5))/20,v=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),k=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const L=class{constructor(){let T=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const z="function"==typeof T?T:function(T){let z=0,X=0,b=0,F=1;const A=function(){let T=4022871197;return function(z){z=z.toString();for(let X=0;X<z.length;X++){T+=z.charCodeAt(X);let b=.02519603282416938*T;T=b>>>0,b-=T,b*=T,T=b>>>0,b-=T,T+=4294967296*b}return 2.3283064365386963e-10*(T>>>0)}}();z=A(" "),X=A(" "),b=A(" "),z-=A(T),z<0&&(z+=1);X-=A(T),X<0&&(X+=1);b-=A(T),b<0&&(b+=1);return function(){const T=2091639*z+2.3283064365386963e-10*F;return z=X,X=b,b=T-(F=0|T)}}(T);this.p=function(T){const z=new Uint8Array(256);for(let X=0;X<256;X++)z[X]=X;for(let X=0;X<255;X++){const b=X+~~(T()*(256-X)),F=z[X];z[X]=z[b],z[b]=F}return z}(z),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let X=0;X<512;X++)this.perm[X]=this.p[255&X],this.permMod12[X]=this.perm[X]%12}noise2D(T,z){const X=this.permMod12,A=this.perm;let u=0,y=0,E=0;const k=(T+z)*b,L=Math.floor(T+k),D=Math.floor(z+k),c=(L+D)*F,p=T-(L-c),H=z-(D-c);let U,s;p>H?(U=1,s=0):(U=0,s=1);const x=p-U+F,K=H-s+F,d=p-1+2*F,N=H-1+2*F,l=255&L,a=255&D;let q=.5-p*p-H*H;if(q>=0){const T=3*X[l+A[a]];q*=q,u=q*q*(v[T]*p+v[T+1]*H)}let V=.5-x*x-K*K;if(V>=0){const T=3*X[l+U+A[a+s]];V*=V,y=V*V*(v[T]*x+v[T+1]*K)}let C=.5-d*d-N*N;if(C>=0){const T=3*X[l+1+A[a+1]];C*=C,E=C*C*(v[T]*d+v[T+1]*N)}return 70*(u+y+E)}noise3D(T,z,X){const b=this.permMod12,F=this.perm;let y,E,k,L;const D=(T+z+X)*A,c=Math.floor(T+D),p=Math.floor(z+D),H=Math.floor(X+D),U=(c+p+H)*u,s=T-(c-U),x=z-(p-U),K=X-(H-U);let d,N,l,a,q,V;s>=x?x>=K?(d=1,N=0,l=0,a=1,q=1,V=0):s>=K?(d=1,N=0,l=0,a=1,q=0,V=1):(d=0,N=0,l=1,a=1,q=0,V=1):x<K?(d=0,N=0,l=1,a=0,q=1,V=1):s<K?(d=0,N=1,l=0,a=0,q=1,V=1):(d=0,N=1,l=0,a=1,q=1,V=0);const C=s-d+u,G=x-N+u,j=K-l+u,Z=s-a+2*u,m=x-q+2*u,S=K-V+2*u,n=s-1+.5,O=x-1+.5,P=K-1+.5,W=255&c,B=255&p,e=255&H;let R=.6-s*s-x*x-K*K;if(R<0)y=0;else{const T=3*b[W+F[B+F[e]]];R*=R,y=R*R*(v[T]*s+v[T+1]*x+v[T+2]*K)}let Y=.6-C*C-G*G-j*j;if(Y<0)E=0;else{const T=3*b[W+d+F[B+N+F[e+l]]];Y*=Y,E=Y*Y*(v[T]*C+v[T+1]*G+v[T+2]*j)}let i=.6-Z*Z-m*m-S*S;if(i<0)k=0;else{const T=3*b[W+a+F[B+q+F[e+V]]];i*=i,k=i*i*(v[T]*Z+v[T+1]*m+v[T+2]*S)}let t=.6-n*n-O*O-P*P;if(t<0)L=0;else{const T=3*b[W+1+F[B+1+F[e+1]]];t*=t,L=t*t*(v[T]*n+v[T+1]*O+v[T+2]*P)}return 32*(y+E+k+L)}noise4D(T,z,X,b){const F=this.perm;let A,u,v,L,D;const c=(T+z+X+b)*y,p=Math.floor(T+c),H=Math.floor(z+c),U=Math.floor(X+c),s=Math.floor(b+c),x=(p+H+U+s)*E,K=T-(p-x),d=z-(H-x),N=X-(U-x),l=b-(s-x);let a=0,q=0,V=0,C=0;K>d?a++:q++,K>N?a++:V++,K>l?a++:C++,d>N?q++:V++,d>l?q++:C++,N>l?V++:C++;const G=a>=3?1:0,j=q>=3?1:0,Z=V>=3?1:0,m=C>=3?1:0,S=a>=2?1:0,n=q>=2?1:0,O=V>=2?1:0,P=C>=2?1:0,W=a>=1?1:0,B=q>=1?1:0,e=V>=1?1:0,R=C>=1?1:0,Y=K-G+E,i=d-j+E,t=N-Z+E,g=l-m+E,M=K-S+2*E,r=d-n+2*E,o=N-O+2*E,f=l-P+2*E,h=K-W+3*E,Q=d-B+3*E,w=N-e+3*E,J=l-R+3*E,I=K-1+4*E,TT=d-1+4*E,zT=N-1+4*E,XT=l-1+4*E,bT=255&p,FT=255&H,AT=255&U,uT=255&s;let yT=.6-K*K-d*d-N*N-l*l;if(yT<0)A=0;else{const T=F[bT+F[FT+F[AT+F[uT]]]]%32*4;yT*=yT,A=yT*yT*(k[T]*K+k[T+1]*d+k[T+2]*N+k[T+3]*l)}let ET=.6-Y*Y-i*i-t*t-g*g;if(ET<0)u=0;else{const T=F[bT+G+F[FT+j+F[AT+Z+F[uT+m]]]]%32*4;ET*=ET,u=ET*ET*(k[T]*Y+k[T+1]*i+k[T+2]*t+k[T+3]*g)}let vT=.6-M*M-r*r-o*o-f*f;if(vT<0)v=0;else{const T=F[bT+S+F[FT+n+F[AT+O+F[uT+P]]]]%32*4;vT*=vT,v=vT*vT*(k[T]*M+k[T+1]*r+k[T+2]*o+k[T+3]*f)}let kT=.6-h*h-Q*Q-w*w-J*J;if(kT<0)L=0;else{const T=F[bT+W+F[FT+B+F[AT+e+F[uT+R]]]]%32*4;kT*=kT,L=kT*kT*(k[T]*h+k[T+1]*Q+k[T+2]*w+k[T+3]*J)}let LT=.6-I*I-TT*TT-zT*zT-XT*XT;if(LT<0)D=0;else{const T=F[bT+1+F[FT+1+F[AT+1+F[uT+1]]]]%32*4;LT*=LT,D=LT*LT*(k[T]*I+k[T+1]*TT+k[T+2]*zT+k[T+3]*XT)}return 27*(A+u+v+L+D)}}}}]);