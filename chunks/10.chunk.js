/*! For license information please see yycq4v.10.ffae0943.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[10],{12075:(f,Q,H)=>{"use strict";var X=H(12077),i=H(12081),S=H(12088);H.g.__TYPEDARRAY_POOL||(H.g.__TYPEDARRAY_POOL={UINT8:i([32,0]),UINT16:i([32,0]),UINT32:i([32,0]),INT8:i([32,0]),INT16:i([32,0]),INT32:i([32,0]),FLOAT:i([32,0]),DOUBLE:i([32,0]),DATA:i([32,0]),UINT8C:i([32,0]),BUFFER:i([32,0])});var x="undefined"!==typeof Uint8ClampedArray,K=H.g.__TYPEDARRAY_POOL;K.UINT8C||(K.UINT8C=i([32,0])),K.BUFFER||(K.BUFFER=i([32,0]));var Z=K.DATA,B=K.BUFFER;function N(f){if(f){var Q=f.length||f.byteLength,H=X.log2(Q);Z[H].push(f)}}function J(f){f=X.nextPow2(f);var Q=X.log2(f),H=Z[Q];return H.length>0?H.pop():new ArrayBuffer(f)}function g(f){return new Uint8Array(J(f),0,f)}function z(f){return new Uint16Array(J(2*f),0,f)}function v(f){return new Uint32Array(J(4*f),0,f)}function Y(f){return new Int8Array(J(f),0,f)}function O(f){return new Int16Array(J(2*f),0,f)}function n(f){return new Int32Array(J(4*f),0,f)}function e(f){return new Float32Array(J(4*f),0,f)}function G(f){return new Float64Array(J(8*f),0,f)}function I(f){return x?new Uint8ClampedArray(J(f),0,f):g(f)}function l(f){return new DataView(J(f),0,f)}Q.free=function(f){if(S(f))B[X.log2(f.length)].push(f);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(f)&&(f=f.buffer),!f)return;var Q=f.length||f.byteLength,H=0|X.log2(Q);Z[H].push(f)}},Q.freeUint8=Q.freeUint16=Q.freeUint32=Q.freeInt8=Q.freeInt16=Q.freeInt32=Q.freeFloat32=Q.freeFloat=Q.freeFloat64=Q.freeDouble=Q.freeUint8Clamped=Q.freeDataView=function(f){N(f.buffer)},Q.freeArrayBuffer=N,Q.freeBuffer=function(f){B[X.log2(f.length)].push(f)},Q.malloc=function(f,Q){if(void 0===Q||"arraybuffer"===Q)return J(f);switch(Q){case"uint8":return g(f);case"uint16":return z(f);case"uint32":return v(f);case"int8":return Y(f);case"int16":return O(f);case"int32":return n(f);case"float":case"float32":return e(f);case"double":case"float64":return G(f);case"uint8_clamped":return I(f);case"buffer":throw"Buffer not supported";case"data":case"dataview":return l(f);default:return null}return null},Q.mallocArrayBuffer=J,Q.mallocUint8=g,Q.mallocUint16=z,Q.mallocUint32=v,Q.mallocInt8=Y,Q.mallocInt16=O,Q.mallocInt32=n,Q.mallocFloat32=Q.mallocFloat=e,Q.mallocFloat64=Q.mallocDouble=G,Q.mallocUint8Clamped=I,Q.mallocDataView=l,Q.clearCache=function(){for(var f=0;f<32;++f)K.UINT8[f].length=0,K.UINT16[f].length=0,K.UINT32[f].length=0,K.INT8[f].length=0,K.INT16[f].length=0,K.INT32[f].length=0,K.FLOAT[f].length=0,K.DOUBLE[f].length=0,K.UINT8C[f].length=0,Z[f].length=0,B[f].length=0}},12152:(f,Q,H)=>{f.exports=i;var X=H(11595);function i(f,Q){if(!(this instanceof i))return new i(f,Q);var H=X.create();X.add(H,f,Q),this.Qd=X.min(X.create(),f,H),this.xh=X.clone(Q),this.max=X.max(X.create(),f,H),this.mag=X.length(this.xh)}var S=i.prototype;S.width=function(){return this.xh[0]},S.height=function(){return this.xh[1]},S.depth=function(){return this.xh[2]},S.x0=function(){return this.Qd[0]},S.y0=function(){return this.Qd[1]},S.z0=function(){return this.Qd[2]},S.x1=function(){return this.max[0]},S.y1=function(){return this.max[1]},S.z1=function(){return this.max[2]},S.translate=function(f){return X.add(this.max,this.max,f),X.add(this.Qd,this.Qd,f),this},S.setPosition=function(f){return X.add(this.max,f,this.xh),X.j(this.Qd,f),this},S.expand=function(f){var Q=X.create(),H=X.create();return X.max(Q,f.max,this.max),X.min(H,f.Qd,this.Qd),X.hd(Q,Q,H),new i(H,Q)},S.intersects=function(f){return!(f.Qd[0]>this.max[0])&&(!(f.Qd[1]>this.max[1])&&(!(f.Qd[2]>this.max[2])&&(!(f.max[0]<this.Qd[0])&&(!(f.max[1]<this.Qd[1])&&!(f.max[2]<this.Qd[2])))))},S.touches=function(f){var Q=this.union(f);return null!==Q&&(0==Q.width()||0==Q.height()||0==Q.depth())},S.union=function(f){if(!this.intersects(f))return null;var Q=Math.max(f.Qd[0],this.Qd[0]),H=Math.max(f.Qd[1],this.Qd[1]),X=Math.max(f.Qd[2],this.Qd[2]);return new i([Q,H,X],[Math.min(f.max[0],this.max[0])-Q,Math.min(f.max[1],this.max[1])-H,Math.min(f.max[2],this.max[2])-X])}},12077:(f,Q)=>{"use strict";function H(f){var Q=32;return(f&=-f)&&Q--,65535&f&&(Q-=16),16711935&f&&(Q-=8),252645135&f&&(Q-=4),858993459&f&&(Q-=2),1431655765&f&&(Q-=1),Q}Q.INT_BITS=32,Q.INT_MAX=2147483647,Q.INT_MIN=-1<<31,Q.sign=function(f){return(f>0)-(f<0)},Q.abs=function(f){var Q=f>>31;return(f^Q)-Q},Q.min=function(f,Q){return Q^(f^Q)&-(f<Q)},Q.max=function(f,Q){return f^(f^Q)&-(f<Q)},Q.isPow2=function(f){return!(f&f-1)&&!!f},Q.log2=function(f){var Q,H;return Q=(f>65535)<<4,Q|=H=((f>>>=Q)>255)<<3,Q|=H=((f>>>=H)>15)<<2,(Q|=H=((f>>>=H)>3)<<1)|(f>>>=H)>>1},Q.log10=function(f){return f>=1e9?9:f>=1e8?8:f>=1e7?7:f>=1e6?6:f>=1e5?5:f>=1e4?4:f>=1e3?3:f>=100?2:f>=10?1:0},Q.popCount=function(f){return 16843009*((f=(858993459&(f-=f>>>1&1431655765))+(f>>>2&858993459))+(f>>>4)&252645135)>>>24},Q.countTrailingZeros=H,Q.nextPow2=function(f){return f+=0===f,--f,f|=f>>>1,f|=f>>>2,f|=f>>>4,f|=f>>>8,(f|=f>>>16)+1},Q.prevPow2=function(f){return f|=f>>>1,f|=f>>>2,f|=f>>>4,f|=f>>>8,(f|=f>>>16)-(f>>>1)},Q.parity=function(f){return f^=f>>>16,f^=f>>>8,f^=f>>>4,27030>>>(f&=15)&1};var X=new Array(256);!function(f){for(var Q=0;Q<256;++Q){var H=Q,X=Q,i=7;for(H>>>=1;H;H>>>=1)X<<=1,X|=1&H,--i;f[Q]=X<<i&255}}(X),Q.reverse=function(f){return X[255&f]<<24|X[f>>>8&255]<<16|X[f>>>16&255]<<8|X[f>>>24&255]},Q.interleave2=function(f,Q){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f&=65535)|f<<8))|f<<4))|f<<2))|f<<1))|(Q=1431655765&((Q=858993459&((Q=252645135&((Q=16711935&((Q&=65535)|Q<<8))|Q<<4))|Q<<2))|Q<<1))<<1},Q.deinterleave2=function(f,Q){return(f=65535&((f=16711935&((f=252645135&((f=858993459&((f=f>>>Q&1431655765)|f>>>1))|f>>>2))|f>>>4))|f>>>16))<<16>>16},Q.interleave3=function(f,Q,H){return f=1227133513&((f=3272356035&((f=251719695&((f=4278190335&((f&=1023)|f<<16))|f<<8))|f<<4))|f<<2),(f|=(Q=1227133513&((Q=3272356035&((Q=251719695&((Q=4278190335&((Q&=1023)|Q<<16))|Q<<8))|Q<<4))|Q<<2))<<1)|(H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2))<<2},Q.deinterleave3=function(f,Q){return(f=1023&((f=4278190335&((f=251719695&((f=3272356035&((f=f>>>Q&1227133513)|f>>>2))|f>>>4))|f>>>8))|f>>>16))<<22>>22},Q.nextCombination=function(f){var Q=f|f-1;return Q+1|(~Q&-~Q)-1>>>H(f)+1}},12072:(f,Q,H)=>{"use strict";f.exports=function(f,Q,H){switch(arguments.length){case 1:return X=[],B(i=f,i,N,!0),X;case 2:return"function"===typeof Q?B(f,f,Q,!0):function(f,Q){return X=[],B(f,Q,N,!1),X}(f,Q);case 3:return B(f,Q,H,!1);default:throw new Error("box-intersect: Invalid arguments")}var i};var X,i=H(12075),S=H(12094),x=H(12106);function K(f,Q){for(var H=0;H<f;++H)if(!(Q[H]<=Q[H+f]))return!0;return!1}function Z(f,Q,H,X){for(var i=0,S=0,x=0,Z=f.length;x<Z;++x){var B=f[x];if(!K(Q,B)){for(var N=0;N<2*Q;++N)H[i++]=B[N];X[S++]=x}}return S}function B(f,Q,H,X){var K=f.length,B=Q.length;if(!(K<=0||B<=0)){var N=f[0].length>>>1;if(!(N<=0)){var J,g=i.mallocDouble(2*N*K),z=i.mallocInt32(K);if((K=Z(f,N,g,z))>0){if(1===N&&X)S.init(K),J=S.sweepComplete(N,H,0,K,g,z,0,K,g,z);else{var v=i.mallocDouble(2*N*B),Y=i.mallocInt32(B);(B=Z(Q,N,v,Y))>0&&(S.init(K+B),J=1===N?S.sweepBipartite(N,H,0,K,g,z,0,B,v,Y):x(N,H,X,K,g,z,B,v,Y),i.free(v),i.free(Y))}i.free(g),i.free(z)}return J}}}function N(f,Q){X.push([f,Q])}},12113:(f,Q)=>{"use strict";var H="d",X="ax",i="fp",S="es",x="rs",K="re",Z="rb",B="bs",N="be",J="bb",g=[H,X,"vv",x,K,Z,"ri",B,N,J,"bi"];function z(f){var Q="bruteForce"+(f?"Full":"Partial"),X=[],x=g.slice();f||x.splice(3,0,i);var K=["function "+Q+"("+x.join()+"){"];function Z(Q,i){var x=function(f,Q,X){var i="bruteForce"+(f?"Red":"Blue")+(Q?"Flip":"")+(X?"Full":""),x=["function ",i,"(",g.join(),"){","var ",S,"=2*",H,";"],K="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",Z="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(X?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return f?x.push(K,"Q",":",Z):x.push(Z,"Q",":",K),X?x.push("if(y1<x0||x1<y0)continue;"):Q?x.push("if(y0<=x0||x1<y0)continue;"):x.push("if(y0<x0||x1<y0)continue;"),x.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),Q?x.push("yi,xi"):x.push("xi,yi"),x.push(");if(rv!==void 0)return rv;}}}"),{name:i,code:x.join("")}}(Q,i,f);X.push(x.code),K.push("return "+x.name+"("+g.join()+");")}K.push("if(re-rs>be-bs){"),f?(Z(!0,!1),K.push("}else{"),Z(!1,!1)):(K.push("if(fp){"),Z(!0,!0),K.push("}else{"),Z(!0,!1),K.push("}}else{if(fp){"),Z(!1,!0),K.push("}else{"),Z(!1,!1),K.push("}")),K.push("}}return "+Q);var B=X.join("")+K.join("");return new Function(B)()}Q.partial=z(!1),Q.full=z(!0)},12106:(f,Q,H)=>{"use strict";f.exports=function(f,Q,H,S,N,P,m,c,W){!function(f,Q){var H=8*i.log2(Q+1)*(f+1)|0,S=i.nextPow2(I*H);q.length<S&&(X.free(q),q=X.mallocInt32(S));var x=i.nextPow2(l*H);D.length<x&&(X.free(D),D=X.mallocDouble(x))}(f,S+m);var R,U=0,E=2*f;d(U++,0,0,S,0,m,H?16:0,-1/0,1/0),H||d(U++,0,0,m,0,S,1,-1/0,1/0);for(;U>0;){var t=(U-=1)*I,u=q[t],L=q[t+1],A=q[t+2],a=q[t+3],V=q[t+4],M=q[t+5],r=U*l,j=D[r],T=D[r+1],k=1&M,y=!!(16&M),h=N,w=P,b=c,o=W;if(k&&(h=c,w=W,b=N,o=P),!(2&M&&L>=(A=O(f,u,L,A,h,w,T)))&&!(4&M&&(L=n(f,u,L,A,h,w,j))>=A)){var p=A-L,C=V-a;if(y){if(f*p*(p+C)<z){if(void 0!==(R=Z.scanComplete(f,u,Q,L,A,h,w,a,V,b,o)))return R;continue}}else{if(f*Math.min(p,C)<J){if(void 0!==(R=x(f,u,Q,k,L,A,h,w,a,V,b,o)))return R;continue}if(f*p*C<g){if(void 0!==(R=Z.scanBipartite(f,u,Q,k,L,A,h,w,a,V,b,o)))return R;continue}}var ff=v(f,u,L,A,h,w,j,T);if(L<ff)if(f*(ff-L)<J){if(void 0!==(R=K(f,u+1,Q,L,ff,h,w,a,V,b,o)))return R}else if(u===f-2){if(void 0!==(R=k?Z.sweepBipartite(f,Q,a,V,b,o,L,ff,h,w):Z.sweepBipartite(f,Q,L,ff,h,w,a,V,b,o)))return R}else d(U++,u+1,L,ff,a,V,k,-1/0,1/0),d(U++,u+1,a,V,L,ff,1^k,-1/0,1/0);if(ff<A){var Qf=B(f,u,a,V,b,o),Hf=b[E*Qf+u],Xf=Y(f,u,Qf,V,b,o,Hf);if(Xf<V&&d(U++,u,ff,A,Xf,V,(4|k)+(y?16:0),Hf,T),a<Qf&&d(U++,u,ff,A,a,Qf,(2|k)+(y?16:0),j,Hf),Qf+1===Xf){if(void 0!==(R=y?F(f,u,Q,ff,A,h,w,Qf,b,o[Qf]):s(f,u,Q,k,ff,A,h,w,Qf,b,o[Qf])))return R}else if(Qf<Xf){var Sf;if(y){if(ff<(Sf=e(f,u,ff,A,h,w,Hf))){var xf=Y(f,u,ff,Sf,h,w,Hf);if(u===f-2){if(ff<xf&&void 0!==(R=Z.sweepComplete(f,Q,ff,xf,h,w,Qf,Xf,b,o)))return R;if(xf<Sf&&void 0!==(R=Z.sweepBipartite(f,Q,xf,Sf,h,w,Qf,Xf,b,o)))return R}else ff<xf&&d(U++,u+1,ff,xf,Qf,Xf,16,-1/0,1/0),xf<Sf&&(d(U++,u+1,xf,Sf,Qf,Xf,0,-1/0,1/0),d(U++,u+1,Qf,Xf,xf,Sf,1,-1/0,1/0))}}else ff<(Sf=k?G(f,u,ff,A,h,w,Hf):e(f,u,ff,A,h,w,Hf))&&(u===f-2?R=k?Z.sweepBipartite(f,Q,Qf,Xf,b,o,ff,Sf,h,w):Z.sweepBipartite(f,Q,ff,Sf,h,w,Qf,Xf,b,o):(d(U++,u+1,ff,Sf,Qf,Xf,k,-1/0,1/0),d(U++,u+1,Qf,Xf,ff,Sf,1^k,-1/0,1/0)))}}}}};var X=H(12075),i=H(12077),S=H(12113),x=S.partial,K=S.full,Z=H(12094),B=H(12118),N=H(12123),J=128,g=1<<22,z=1<<22,v=N("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),Y=N("lo===p0",["p0"]),O=N("lo<p0",["p0"]),n=N("hi<=p0",["p0"]),e=N("lo<=p0&&p0<=hi",["p0"]),G=N("lo<p0&&p0<=hi",["p0"]),I=6,l=2,q=X.mallocInt32(1024),D=X.mallocDouble(1024);function d(f,Q,H,X,i,S,x,K,Z){var B=I*f;q[B]=Q,q[B+1]=H,q[B+2]=X,q[B+3]=i,q[B+4]=S,q[B+5]=x;var N=l*f;D[N]=K,D[N+1]=Z}function s(f,Q,H,X,i,S,x,K,Z,B,N){var J=2*f,g=Z*J,z=B[g+Q];f:for(var v=i,Y=i*J;v<S;++v,Y+=J){var O=x[Y+Q],n=x[Y+Q+f];if(!(z<O||n<z)&&(!X||z!==O)){for(var e,G=K[v],I=Q+1;I<f;++I){O=x[Y+I],n=x[Y+I+f];var l=B[g+I],q=B[g+I+f];if(n<l||q<O)continue f}if(void 0!==(e=X?H(N,G):H(G,N)))return e}}}function F(f,Q,H,X,i,S,x,K,Z,B){var N=2*f,J=K*N,g=Z[J+Q];f:for(var z=X,v=X*N;z<i;++z,v+=N){var Y=x[z];if(Y!==B){var O=S[v+Q],n=S[v+Q+f];if(!(g<O||n<g)){for(var e=Q+1;e<f;++e){O=S[v+e],n=S[v+e+f];var G=Z[J+e],I=Z[J+e+f];if(n<G||I<O)continue f}var l=H(Y,B);if(void 0!==l)return l}}}}},12118:(f,Q,H)=>{"use strict";f.exports=function(f,Q,H,x,K,Z){if(x<=H+1)return H;var B=H,N=x,J=x+H>>>1,g=2*f,z=J,v=K[g*J+Q];for(;B<N;){if(N-B<i){S(f,Q,B,N,K,Z),v=K[g*J+Q];break}var Y=N-B,O=Math.random()*Y+B|0,n=K[g*O+Q],e=Math.random()*Y+B|0,G=K[g*e+Q],I=Math.random()*Y+B|0,l=K[g*I+Q];n<=G?l>=G?(z=e,v=G):n>=l?(z=O,v=n):(z=I,v=l):G>=l?(z=e,v=G):l>=n?(z=O,v=n):(z=I,v=l);for(var q=g*(N-1),D=g*z,d=0;d<g;++d,++q,++D){var s=K[q];K[q]=K[D],K[D]=s}var F=Z[N-1];Z[N-1]=Z[z],Z[z]=F;for(q=g*(N-1),D=g*(z=X(f,Q,B,N-1,K,Z,v)),d=0;d<g;++d,++q,++D){s=K[q];K[q]=K[D],K[D]=s}F=Z[N-1];if(Z[N-1]=Z[z],Z[z]=F,J<z){for(N=z-1;B<N&&K[g*(N-1)+Q]===v;)N-=1;N+=1}else{if(!(z<J))break;for(B=z+1;B<N&&K[g*B+Q]===v;)B+=1}}return X(f,Q,H,J,K,Z,K[g*J+Q])};var X=H(12123)("lo<p0",["p0"]),i=8;function S(f,Q,H,X,i,S){for(var x=2*f,K=x*(H+1)+Q,Z=H+1;Z<X;++Z,K+=x)for(var B=i[K],N=Z,J=x*(Z-1);N>H&&i[J+Q]>B;--N,J-=x){for(var g=J,z=J+x,v=0;v<x;++v,++g,++z){var Y=i[g];i[g]=i[z],i[z]=Y}var O=S[N];S[N]=S[N-1],S[N-1]=O}}},12123:f=>{"use strict";f.exports=function(f,H){var X="abcdef".split("").concat(H),i=[];f.indexOf("lo")>=0&&i.push("lo=e[k+n]");f.indexOf("hi")>=0&&i.push("hi=e[k+o]");return X.push(Q.replace("_",i.join()).replace("$",f)),Function.apply(void 0,X)};var Q="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12103:f=>{"use strict";f.exports=function(f,X){X<=4*Q?H(0,X-1,f):B(0,X-1,f)};var Q=32;function H(f,Q,H){for(var X=2*(f+1),i=f+1;i<=Q;++i){for(var S=H[X++],x=H[X++],K=i,Z=X-2;K-- >f;){var B=H[Z-2],N=H[Z-1];if(B<S)break;if(B===S&&N<x)break;H[Z]=B,H[Z+1]=N,Z-=2}H[Z]=S,H[Z+1]=x}}function X(f,Q,H){Q*=2;var X=H[f*=2],i=H[f+1];H[f]=H[Q],H[f+1]=H[Q+1],H[Q]=X,H[Q+1]=i}function i(f,Q,H){Q*=2,H[f*=2]=H[Q],H[f+1]=H[Q+1]}function S(f,Q,H,X){Q*=2,H*=2;var i=X[f*=2],S=X[f+1];X[f]=X[Q],X[f+1]=X[Q+1],X[Q]=X[H],X[Q+1]=X[H+1],X[H]=i,X[H+1]=S}function x(f,Q,H,X,i){Q*=2,i[f*=2]=i[Q],i[Q]=H,i[f+1]=i[Q+1],i[Q+1]=X}function K(f,Q,H){Q*=2;var X=H[f*=2],i=H[Q];return!(X<i)&&(X!==i||H[f+1]>H[Q+1])}function Z(f,Q,H,X){var i=X[f*=2];return i<Q||i===Q&&X[f+1]<H}function B(f,N,J){var g=(N-f+1)/6|0,z=f+g,v=N-g,Y=f+N>>1,O=Y-g,n=Y+g,e=z,G=O,I=Y,l=n,q=v,D=f+1,d=N-1,s=0;K(e,G,J)&&(s=e,e=G,G=s),K(l,q,J)&&(s=l,l=q,q=s),K(e,I,J)&&(s=e,e=I,I=s),K(G,I,J)&&(s=G,G=I,I=s),K(e,l,J)&&(s=e,e=l,l=s),K(I,l,J)&&(s=I,I=l,l=s),K(G,q,J)&&(s=G,G=q,q=s),K(G,I,J)&&(s=G,G=I,I=s),K(l,q,J)&&(s=l,l=q,q=s);for(var F=J[2*G],P=J[2*G+1],m=J[2*l],c=J[2*l+1],W=2*e,R=2*I,U=2*q,E=2*z,t=2*Y,u=2*v,L=0;L<2;++L){var A=J[W+L],a=J[R+L],V=J[U+L];J[E+L]=A,J[t+L]=a,J[u+L]=V}i(O,f,J),i(n,N,J);for(var M=D;M<=d;++M)if(Z(M,F,P,J))M!==D&&X(M,D,J),++D;else if(!Z(M,m,c,J))for(;;){if(Z(d,m,c,J)){Z(d,F,P,J)?(S(M,D,d,J),++D,--d):(X(M,d,J),--d);break}if(--d<M)break}x(f,D-1,F,P,J),x(N,d+1,m,c,J),D-2-f<=Q?H(f,D-2,J):B(f,D-2,J),N-(d+2)<=Q?H(d+2,N,J):B(d+2,N,J),d-D<=Q?H(D,d,J):B(D,d,J)}},12094:(f,Q,H)=>{"use strict";f.exports={init:function(f){var Q=i.nextPow2(f);Z.length<Q&&(X.free(Z),Z=X.mallocInt32(Q));B.length<Q&&(X.free(B),B=X.mallocInt32(Q));N.length<Q&&(X.free(N),N=X.mallocInt32(Q));J.length<Q&&(X.free(J),J=X.mallocInt32(Q));g.length<Q&&(X.free(g),g=X.mallocInt32(Q));z.length<Q&&(X.free(z),z=X.mallocInt32(Q));var H=8*Q;v.length<H&&(X.free(v),v=X.mallocDouble(H))},sweepBipartite:function(f,Q,H,X,i,K,g,z,n,e){for(var G=0,I=2*f,l=f-1,q=I-1,D=H;D<X;++D){var d=K[D],s=I*D;v[G++]=i[s+l],v[G++]=-(d+1),v[G++]=i[s+q],v[G++]=d}for(D=g;D<z;++D){d=e[D]+x;var F=I*D;v[G++]=n[F+l],v[G++]=-d,v[G++]=n[F+q],v[G++]=d}var P=G>>>1;S(v,P);var m=0,c=0;for(D=0;D<P;++D){var W=0|v[2*D+1];if(W>=x)Y(N,J,c--,W=W-x|0);else if(W>=0)Y(Z,B,m--,W);else if(W<=-x){W=-W-x|0;for(var R=0;R<m;++R){if(void 0!==(U=Q(Z[R],W)))return U}O(N,J,c++,W)}else{W=-W-1|0;for(R=0;R<c;++R){var U;if(void 0!==(U=Q(W,N[R])))return U}O(Z,B,m++,W)}}},sweepComplete:function(f,Q,H,X,i,x,K,n,e,G){for(var I=0,l=2*f,q=f-1,D=l-1,d=H;d<X;++d){var s=x[d]+1<<1,F=l*d;v[I++]=i[F+q],v[I++]=-s,v[I++]=i[F+D],v[I++]=s}for(d=K;d<n;++d){s=G[d]+1<<1;var P=l*d;v[I++]=e[P+q],v[I++]=1|-s,v[I++]=e[P+D],v[I++]=1|s}var m=I>>>1;S(v,m);var c=0,W=0,R=0;for(d=0;d<m;++d){var U=0|v[2*d+1],E=1&U;if(d<m-1&&U>>1===v[2*d+3]>>1&&(E=2,d+=1),U<0){for(var t=-(U>>1)-1,u=0;u<R;++u){if(void 0!==(L=Q(g[u],t)))return L}if(0!==E)for(u=0;u<c;++u){if(void 0!==(L=Q(Z[u],t)))return L}if(1!==E)for(u=0;u<W;++u){var L;if(void 0!==(L=Q(N[u],t)))return L}0===E?O(Z,B,c++,t):1===E?O(N,J,W++,t):2===E&&O(g,z,R++,t)}else{t=(U>>1)-1;0===E?Y(Z,B,c--,t):1===E?Y(N,J,W--,t):2===E&&Y(g,z,R--,t)}}},scanBipartite:function(f,Q,H,X,i,K,N,J,g,z,n,e){var G=0,I=2*f,l=Q,q=Q+f,D=1,d=1;X?d=x:D=x;for(var s=i;s<K;++s){var F=s+D,P=I*s;v[G++]=N[P+l],v[G++]=-F,v[G++]=N[P+q],v[G++]=F}for(s=g;s<z;++s){F=s+d;var m=I*s;v[G++]=n[m+l],v[G++]=-F}var c=G>>>1;S(v,c);var W=0;for(s=0;s<c;++s){var R=0|v[2*s+1];if(R<0){var U=!1;if((F=-R)>=x?(U=!X,F-=x):(U=!!X,F-=1),U)O(Z,B,W++,F);else{var E=e[F],t=I*F,u=n[t+Q+1],L=n[t+Q+1+f];f:for(var A=0;A<W;++A){var a=Z[A],V=I*a;if(!(L<N[V+Q+1]||N[V+Q+1+f]<u)){for(var M=Q+2;M<f;++M)if(n[t+M+f]<N[V+M]||N[V+M+f]<n[t+M])continue f;var r,j=J[a];if(void 0!==(r=X?H(E,j):H(j,E)))return r}}}}else Y(Z,B,W--,R-D)}},scanComplete:function(f,Q,H,X,i,K,B,N,J,g,z){for(var Y=0,O=2*f,n=Q,e=Q+f,G=X;G<i;++G){var I=G+x,l=O*G;v[Y++]=K[l+n],v[Y++]=-I,v[Y++]=K[l+e],v[Y++]=I}for(G=N;G<J;++G){I=G+1;var q=O*G;v[Y++]=g[q+n],v[Y++]=-I}var D=Y>>>1;S(v,D);var d=0;for(G=0;G<D;++G){var s=0|v[2*G+1];if(s<0){if((I=-s)>=x)Z[d++]=I-x;else{var F=z[I-=1],P=O*I,m=g[P+Q+1],c=g[P+Q+1+f];f:for(var W=0;W<d;++W){var R=Z[W],U=B[R];if(U===F)break;var E=O*R;if(!(c<K[E+Q+1]||K[E+Q+1+f]<m)){for(var t=Q+2;t<f;++t)if(g[P+t+f]<K[E+t]||K[E+t+f]<g[P+t])continue f;var u=H(U,F);if(void 0!==u)return u}}}}else{for(I=s-x,W=d-1;W>=0;--W)if(Z[W]===I){for(t=W+1;t<d;++t)Z[t-1]=Z[t];break}--d}}}};var X=H(12075),i=H(12077),S=H(12103),x=1<<28,K=1024,Z=X.mallocInt32(K),B=X.mallocInt32(K),N=X.mallocInt32(K),J=X.mallocInt32(K),g=X.mallocInt32(K),z=X.mallocInt32(K),v=X.mallocDouble(8192);function Y(f,Q,H,X){var i=Q[X],S=f[H-1];f[i]=S,Q[S]=i}function O(f,Q,H,X){f[H]=X,Q[X]=H}},12081:f=>{"use strict";function Q(f,H,X){var i=0|f[X];if(i<=0)return[];var S,x=new Array(i);if(X===f.length-1)for(S=0;S<i;++S)x[S]=H;else for(S=0;S<i;++S)x[S]=Q(f,H,X+1);return x}f.exports=function(f,H){switch("undefined"===typeof H&&(H=0),typeof f){case"number":if(f>0)return function(f,Q){var H,X;for(H=new Array(f),X=0;X<f;++X)H[X]=Q;return H}(0|f,H);break;case"object":if("number"===typeof f.length)return Q(f,H,0)}return[]}},12043:(f,Q,H)=>{f.exports=function(){var f=this;this.components={},this.comps=this.components;var Q=this.components,H=1,i={},S=[],x=[],K={timeout:!1,removals:[],multiComps:[]};function Z(f,H){var X=Q[H],S=i[H],x=S.hash[f];x&&(S.remove(f),X.ab&&(X.multi?(x.forEach((Q=>{Q&&X.ab(f,Q)})),x.length=0):X.ab(f,x)),K.removals.push(S),B())}function B(){K.timeout||(K.timeout=!0,setTimeout(N,1))}function N(){K.timeout=!1,J()}function J(){K.multiComps.length&&function(f){for(var Q=0;Q<f.length;Q++){var{entID:H,data:X}=f[Q],i=X.hash[H];if(i){for(var S=0;S<i.length;S++)i[S]||(i.splice(S,1),S--);0===i.length&&(X.remove(H),K.removals.push(X))}}f.length=0}(K.multiComps),K.removals.length&&function(f){for(var Q=0;Q<f.length;Q++){f[Q].flush()}f.length=0}(K.removals)}this.Zi=i,this._systems=S,this._renderSystems=x,this.Bh=function(Q){var X=H++;return Array.isArray(Q)&&Q.forEach((Q=>f.yf(X,Q))),X},this.deleteEntity=function(Q){return Object.keys(i).forEach((f=>{i[f].hash[Q]&&Z(Q,f)})),f},this.Vh=function(f){if(!f)throw new Error("Missing component definition");var H=f.name;if(!H)throw new Error("Component definition must have a name property.");if("string"!==typeof H)throw new Error("Component name must be a string.");if(""===H)throw new Error("Component name must be a non-empty string.");if(i[H])throw new Error(`Component ${H} already exists.`);var K={};return K.name=H,K.multi=!!f.multi,K.order=isNaN(f.order)?99:f.order,K.stateConstructor=f.stateConstructor||null,K.state=f.state||{},K.Ff=f.Ff||null,K.ab=f.ab||null,K.system=f.system||null,K.Yg=f.Yg||null,Q[H]=K,i[H]=new X,i[H]._pendingMultiCleanup=!1,i[H]._multiCleanupIDs=K.multi?[]:null,K.system&&(S.push(H),S.sort(((f,H)=>Q[f].order-Q[H].order))),K.Yg&&(x.push(H),x.sort(((f,H)=>Q[f].order-Q[H].order))),H},this.overwriteComponent=function(f,H){var X=Q[f];if(!X)throw new Error(`Unknown component: ${f}`);if(!H)throw new Error("Missing component definition");if(X.name!==H.name)throw new Error("Overwriting component must use the same name property.");var K={};K.name=f,K.multi=!!H.multi,K.order=isNaN(H.order)?99:H.order,K.state=H.state||{},K.Ff=H.Ff||null,K.ab=H.ab||null,K.system=H.system||null,K.Yg=H.Yg||null,Q[f]=K,i[f]._pendingMultiCleanup=!1,i[f]._multiCleanupIDs=K.multi?[]:null;var Z=S.indexOf(f);K.system&&Z<0&&S.push(f),!K.system&&Z>=0&&S.splice(Z,1),S.sort(((f,H)=>Q[f].order-Q[H].order));var B=x.indexOf(f);K.Yg&&B<0&&x.push(f),!K.Yg&&B>=0&&x.splice(B,1),x.sort(((f,H)=>Q[f].order-Q[H].order));var N=K.state;return this.ah(f).forEach((f=>{for(var Q in N)Q in f||(f[Q]=N[Q]);K.Ff&&K.Ff(f.Xg,f)})),f},this.deleteComponent=function(H){var X=i[H];if(!X)throw new Error(`Unknown component: ${H}`);X.flush(),X.list.forEach((f=>{f&&Z(f.Xg||f[0].Xg,H)}));var K=S.indexOf(H),B=x.indexOf(H);return K>-1&&S.splice(K,1),B>-1&&x.splice(B,1),i[H].dispose(),delete i[H],delete Q[H],f},this.yf=function(f,H,X){var S,x=Q[H],K=i[H];if(!K)throw new Error(`Unknown component: ${H}.`);if(K.hash[f]&&!x.multi)throw new Error(`Entity ${f} already has component: ${H}.`);if(x.stateConstructor){if(!(S=new x.stateConstructor).hasOwnProperty("Xg"))throw new Error(`Component ${x.name} stateConstructor type does not have property __id`)}else S=Object.assign({},{Xg:f},x.state,X);if(S.Xg=f,x.multi){var Z=K.hash[f];Z||(Z=[],K.add(f,Z)),Z.push(S)}else K.add(f,S);return x.Ff&&x.Ff(f,S),this},this.Mf=function(f,Q){var H=i[Q];if(!H)throw new Error(`Unknown component: ${Q}.`);return!!H.hash[f]},this.Cf=function(Q,H){if(!i[H])throw new Error(`Unknown component: ${H}.`);return Z(Q,H),f},this.getState=function(f,Q){var H=i[Q];if(!H)throw new Error(`Unknown component: ${Q}.`);return H.hash[f]},this.ah=function(f){var Q=i[f];if(!Q)throw new Error(`Unknown component: ${f}.`);return J(),Q.list},this.Gk=function(f){if(!i[f])throw new Error(`Unknown component: ${f}.`);var Q=i[f].hash;return f=>Q[f]},this.Jk=function(f){if(!i[f])throw new Error(`Unknown component: ${f}.`);var Q=i[f].hash;return f=>!!Q[f]},this.if=function(H){J();for(var X=0;X<S.length;X++){var x=S[X],K=Q[x],Z=i[x];K.system(H,Z.list),J()}return f},this.render=function(H){J();for(var X=0;X<x.length;X++){var S=x[X],K=Q[S],Z=i[S];K.Yg(H,Z.list),J()}return f},this.removeMultiComponent=function(H,X,S){var x=Q[X],Z=i[X];if(!Z)throw new Error(`Unknown component: ${X}.`);if(!x.multi)throw new Error("removeMultiComponent called on non-multi component");return function(f,Q,H,X){var i=H.hash[f];if(i){var S=i[X];S&&(i[X]=null,Q.ab&&Q.ab(f,S),K.multiComps.push({entID:f,data:H}),B())}}(H,x,Z,S),f}};var X=H(12052)},12052:f=>{function Q(f,Q){var H=f._map[Q];if(delete f.hash[Q],delete f._map[Q],H===f.list.length-1)f.list.pop();else{var X=f.list.pop();if(f.list[H]=X,null===X||null===X[0]){var i=f.list.length;for(var S in f._map)if(f._map[S]===i)return void(f._map[S]=H)}else{var x=X.Xg||X[0].Xg;f._map[x]=H}}}f.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(f,Q){if("number"===typeof this._map[f]){var H=this._map[f];this.hash[f]=Q,this.list[H]=Q}else this._map[f]=this.list.length,this.hash[f]=Q,this.list.push(Q)}remove(f){var Q=this._map[f];this.hash[f]=null,this.list[Q]=null,this._pendingRemovals.push(f)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var f=0;f<this._pendingRemovals.length;f++){var H=this._pendingRemovals[f];null===this.hash[H]&&Q(this,H)}this._pendingRemovals.length=0}}},12002:f=>{"use strict";var Q,H="object"===typeof Reflect?Reflect:null,X=function(f,Q,H){return Function.prototype.apply.call(f,Q,H)};Q=H&&"function"===typeof H.ownKeys?H.ownKeys:Object.getOwnPropertySymbols?function(f){return Object.getOwnPropertyNames(f).concat(Object.getOwnPropertySymbols(f))}:function(f){return Object.getOwnPropertyNames(f)};var i=Number.isNaN||function(f){return f!==f};function S(){S.init.call(this)}f.exports=S,f.exports.once=function(f,Q){return new Promise((function(H,X){function i(H){f.removeListener(Q,S),X(H)}function S(){"function"===typeof f.removeListener&&f.removeListener("error",i),H([].slice.call(arguments))}Y(f,Q,S,{once:!0}),"error"!==Q&&function(f,Q,H){"function"===typeof f.on&&Y(f,"error",Q,H)}(f,i,{once:!0})}))},S.EventEmitter=S,S.prototype._events=void 0,S.prototype._eventsCount=0,S.prototype._maxListeners=void 0;var x=10;function K(f){if("function"!==typeof f)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof f)}function Z(f){return void 0===f._maxListeners?S.defaultMaxListeners:f._maxListeners}function B(f,Q,H,X){var i,S,x,B;if(K(H),void 0===(S=f._events)?(S=f._events=Object.create(null),f._eventsCount=0):(void 0!==S.newListener&&(f.emit("newListener",Q,H.listener?H.listener:H),S=f._events),x=S[Q]),void 0===x)x=S[Q]=H,++f._eventsCount;else if("function"===typeof x?x=S[Q]=X?[H,x]:[x,H]:X?x.unshift(H):x.push(H),(i=Z(f))>0&&x.length>i&&!x.warned){x.warned=!0;var N=new Error("Possible EventEmitter memory leak detected. "+x.length+" "+String(Q)+" listeners added. Use emitter.setMaxListeners() to increase limit");N.name="MaxListenersExceededWarning",N.k=f,N.type=Q,N.count=x.length,B=N,console&&console.warn&&console.warn(B)}return f}function N(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function J(f,Q,H){var X={fired:!1,wrapFn:void 0,target:f,type:Q,listener:H},i=N.bind(X);return i.listener=H,X.wrapFn=i,i}function g(f,Q,H){var X=f._events;if(void 0===X)return[];var i=X[Q];return void 0===i?[]:"function"===typeof i?H?[i.listener||i]:[i]:H?function(f){for(var Q=new Array(f.length),H=0;H<Q.length;++H)Q[H]=f[H].listener||f[H];return Q}(i):v(i,i.length)}function z(f){var Q=this._events;if(void 0!==Q){var H=Q[f];if("function"===typeof H)return 1;if(void 0!==H)return H.length}return 0}function v(f,Q){for(var H=new Array(Q),X=0;X<Q;++X)H[X]=f[X];return H}function Y(f,Q,H,X){if("function"===typeof f.on)X.once?f.once(Q,H):f.on(Q,H);else{if("function"!==typeof f.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof f);f.addEventListener(Q,(function i(S){X.once&&f.removeEventListener(Q,i),H(S)}))}}Object.defineProperty(S,"defaultMaxListeners",{enumerable:!0,get:function(){return x},set:function(f){if("number"!==typeof f||f<0||i(f))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+f+".");x=f}}),S.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},S.prototype.setMaxListeners=function(f){if("number"!==typeof f||f<0||i(f))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+f+".");return this._maxListeners=f,this},S.prototype.getMaxListeners=function(){return Z(this)},S.prototype.emit=function(f){for(var Q=[],H=1;H<arguments.length;H++)Q.push(arguments[H]);var i="error"===f,S=this._events;if(void 0!==S)i=i&&void 0===S.error;else if(!i)return!1;if(i){var x;if(Q.length>0&&(x=Q[0]),x instanceof Error)throw x;var K=new Error("Unhandled error."+(x?" ("+x.message+")":""));throw K.context=x,K}var Z=S[f];if(void 0===Z)return!1;if("function"===typeof Z)X(Z,this,Q);else{var B=Z.length,N=v(Z,B);for(H=0;H<B;++H)X(N[H],this,Q)}return!0},S.prototype.addListener=function(f,Q){return B(this,f,Q,!1)},S.prototype.on=S.prototype.addListener,S.prototype.prependListener=function(f,Q){return B(this,f,Q,!0)},S.prototype.once=function(f,Q){return K(Q),this.on(f,J(this,f,Q)),this},S.prototype.prependOnceListener=function(f,Q){return K(Q),this.prependListener(f,J(this,f,Q)),this},S.prototype.removeListener=function(f,Q){var H,X,i,S,x;if(K(Q),void 0===(X=this._events))return this;if(void 0===(H=X[f]))return this;if(H===Q||H.listener===Q)0===--this._eventsCount?this._events=Object.create(null):(delete X[f],X.removeListener&&this.emit("removeListener",f,H.listener||Q));else if("function"!==typeof H){for(i=-1,S=H.length-1;S>=0;S--)if(H[S]===Q||H[S].listener===Q){x=H[S].listener,i=S;break}if(i<0)return this;0===i?H.shift():function(f,Q){for(;Q+1<f.length;Q++)f[Q]=f[Q+1];f.pop()}(H,i),1===H.length&&(X[f]=H[0]),void 0!==X.removeListener&&this.emit("removeListener",f,x||Q)}return this},S.prototype.off=S.prototype.removeListener,S.prototype.removeAllListeners=function(f){var Q,H,X;if(void 0===(H=this._events))return this;if(void 0===H.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==H[f]&&(0===--this._eventsCount?this._events=Object.create(null):delete H[f]),this;if(0===arguments.length){var i,S=Object.keys(H);for(X=0;X<S.length;++X)"removeListener"!==(i=S[X])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(Q=H[f]))this.removeListener(f,Q);else if(void 0!==Q)for(X=Q.length-1;X>=0;X--)this.removeListener(f,Q[X]);return this},S.prototype.listeners=function(f){return g(this,f,!0)},S.prototype.rawListeners=function(f){return g(this,f,!1)},S.listenerCount=function(f,Q){return"function"===typeof f.listenerCount?f.listenerCount(Q):z.call(f,Q)},S.prototype.listenerCount=z,S.prototype.eventNames=function(){return this._eventsCount>0?Q(this._events):[]}},12277:f=>{"use strict";f.exports=function(f,Q,H,X,i,S){var x=+Q[0],K=+Q[1],Z=+Q[2],B=+H[0],N=+H[1],J=+H[2],g=Math.sqrt(B*B+N*N+J*J);if(0===g)throw new Error("Can't raycast along a zero vector");return function(f,Q,H,X,i,S,x,K,Z,B){for(var N=0,J=Math.floor,g=0|J(Q),z=0|J(H),v=0|J(X),Y=i>0?1:-1,O=S>0?1:-1,n=x>0?1:-1,e=Math.abs(1/i),G=Math.abs(1/S),I=Math.abs(1/x),l=e<1/0?e*(Y>0?g+1-Q:Q-g):1/0,q=G<1/0?G*(O>0?z+1-H:H-z):1/0,D=I<1/0?I*(n>0?v+1-X:X-v):1/0,d=-1;N<=K;){var s=f(g,z,v);if(s)return Z&&(Z[0]=Q+N*i,Z[1]=H+N*S,Z[2]=X+N*x),B&&(B[0]=B[1]=B[2]=0,0===d&&(B[0]=-Y),1===d&&(B[1]=-O),2===d&&(B[2]=-n)),s;l<q?l<D?(g+=Y,N=l,l+=e,d=0):(v+=n,N=D,D+=I,d=2):q<D?(z+=O,N=q,q+=G,d=1):(v+=n,N=D,D+=I,d=2)}return Z&&(Z[0]=Q+N*i,Z[1]=H+N*S,Z[2]=X+N*x),B&&(B[0]=B[1]=B[2]=0),0}(f,x,K,Z,B/=g,N/=g,J/=g,X="undefined"===typeof X?64:+X,i,S)}},12313:(f,Q,H)=>{"use strict";H.d(Q,{b:()=>S});var X=H(12002);function i(){this.Gj=!1,this.stopPropagation=!1,this.Hj=!1,this.disabled=!1}class S{constructor(f,Q){this.version="0.7.0";var H=Object.assign({},new i,Q||{});this.element=f||document,this.Gj=!!H.Gj,this.stopPropagation=!!H.stopPropagation,this.Hj=!!H.Hj,this.disabled=!!H.disabled,this.filterEvents=(f,Q)=>!0,this.down=new X.EventEmitter,this.up=new X.EventEmitter,this.state={},this.Pg={dx:0,dy:0,xk:0,Ng:0,yk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?K(this):document.addEventListener("DOMContentLoaded",(f=>{K(this)}),{once:!0})}bind(f){for(var Q=arguments.length,H=new Array(Q>1?Q-1:0),X=1;X<Q;X++)H[X-1]=arguments[X];H.forEach((Q=>{var H=this._keyBindmap[Q]||[];H.includes(f)||(H.push(f),this._keyBindmap[Q]=H)})),this.state[f]=!!this.state[f],this.pressCount[f]=this.pressCount[f]||0,this.releaseCount[f]=this.releaseCount[f]||0}unbind(f){for(var Q in this._keyBindmap){var H=this._keyBindmap[Q],X=H.indexOf(f);X>-1&&H.splice(X,1)}}getBindings(){var f={};for(var Q in this._keyBindmap){this._keyBindmap[Q].forEach((H=>{f[H]=f[H]||[],f[H].push(Q)}))}return f}if(){x(this.Pg),x(this.pressCount),x(this.releaseCount)}}function x(f){for(var Q in f)f[Q]=0}function K(f){window.addEventListener("keydown",v.bind(null,f,!0),!1),window.addEventListener("keyup",v.bind(null,f,!1),!1);var Q={passive:!0};f.element.addEventListener("touchstart",J.bind(void 0,f),{passive:!1}),f.element.addEventListener("touchend",z.bind(void 0,f),Q),f.element.addEventListener("mousedown",Y.bind(null,f,!0),Q),window.document.addEventListener("mouseup",Y.bind(null,f,!1),Q),f.element.addEventListener("touchmove",O.bind(null,f),Q),f.element.addEventListener("mousemove",O.bind(null,f),Q),window.PointerEvent,f.element.addEventListener("wheel",n.bind(null,f),Q),f.element.addEventListener("contextmenu",e.bind(null,f),!1),window.addEventListener("blur",G.bind(null,f),!1)}var Z=0,B=0,N=null;function J(f,Q){Q.preventDefault(),g(Q)}function g(f){let Q=!1;for(let H=0;H<f.touches.length;++H)if(f.touches[H].identifier===N){Q=!0;break}if(!Q){const Q=f.changedTouches[0];Z=Q.clientX,B=Q.clientY,N=Q.identifier}}function z(f,Q){for(var H=Q.changedTouches,X=0;X<H.length;++X)H[X].identifier===N&&(N=null)}function v(f,Q,H){I(H.code,Q,f,H)}function Y(f,Q,H){if("pointerId"in H)if(Q){if(null!==f._touches.currID)return;f._touches.currID=H.pointerId}else{if(f._touches.currID!==H.pointerId)return;f._touches.currID=null}return I("Mouse"+("button"in H?H.button+1:1),Q,f,H),!1}function O(f,Q){var H=Q.movementX||Q.mozMovementX||0,X=Q.movementY||Q.mozMovementY||0;if(Q.touches&&0===(H|X)){var i=function(f){g(f);for(let Q=0;Q<f.changedTouches.length;++Q)if(f.changedTouches[Q].identifier==N){const H=f.changedTouches[Q],X=[H.clientX-Z,H.clientY-B];return Z=H.clientX,B=H.clientY,X}return console.error(`Did not find touch id ${N}`),[0,0]}(Q);H=i[0],X=i[1]}f.Pg.dx+=H,f.Pg.dy+=X}function n(f,Q){var H=1;switch(Q.deltaMode){case 0:H=1;break;case 1:H=12;break;case 2:H=f.element.clientHeight||window.innerHeight}f.Pg.xk+=(Q.deltaX||0)*H,f.Pg.Ng+=(Q.deltaY||0)*H,f.Pg.yk+=(Q.deltaZ||0)*H}function e(f,Q){if(!f.Hj)return Q.preventDefault(),!1}function G(f){for(var Q in f._keyStates)f._keyStates[Q]&&(/^Mouse\d/.test(Q)||I(Q,!1,f,{code:Q,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function I(f,Q,H,X){var i=H._keyBindmap[f];i&&(l(H._keyStates[f],Q)&&(H._keyStates[f]=Q,i.forEach((f=>{(!H.filterEvents||H.filterEvents(X,f))&&function(f,Q,H,X){var i=Q?H.pressCount:H.releaseCount;i[f]=(i[f]||0)+1;var S=H._bindPressCount[f]||0;(S+=Q?1:-1)<0&&(S=0);H._bindPressCount[f]=S;var x=H.state[f];if(l(x,S)){H.state[f]=S>0;var K=Q?H.down:H.up;H.disabled||K.emit(f,X)}}(f,Q,H,X)}))),"button"in X||(H.Gj&&!X.defaultPrevented&&X.preventDefault(),H.stopPropagation&&X.stopPropagation()))}function l(f,Q){return f?!Q:Q}},11671:f=>{f.exports=function(f,Q,H){return f[0]=Q[0]+H[0],f[1]=Q[1]+H[1],f[2]=Q[2]+H[2],f}},11618:(f,Q,H)=>{f.exports=function(f,Q){var H=X(f[0],f[1],f[2]),x=X(Q[0],Q[1],Q[2]);i(H,H),i(x,x);var K=S(H,x);return K>1?0:Math.acos(K)};var X=H(11626),i=H(11632),S=H(11640)},11736:f=>{f.exports=function(f,Q){return f[0]=Math.ceil(Q[0]),f[1]=Math.ceil(Q[1]),f[2]=Math.ceil(Q[2]),f}},11615:f=>{f.exports=function(f){var Q=new Float32Array(3);return Q[0]=f[0],Q[1]=f[1],Q[2]=f[2],Q}},11648:f=>{f.exports=function(f,Q){return f[0]=Q[0],f[1]=Q[1],f[2]=Q[2],f}},11608:f=>{f.exports=function(){var f=new Float32Array(3);return f[0]=0,f[1]=0,f[2]=0,f}},11814:f=>{f.exports=function(f,Q,H){var X=Q[0],i=Q[1],S=Q[2],x=H[0],K=H[1],Z=H[2];return f[0]=i*Z-S*K,f[1]=S*x-X*Z,f[2]=X*K-i*x,f}},11758:(f,Q,H)=>{f.exports=H(11756)},11756:f=>{f.exports=function(f,Q){var H=Q[0]-f[0],X=Q[1]-f[1],i=Q[2]-f[2];return Math.sqrt(H*H+X*X+i*i)}},11709:(f,Q,H)=>{f.exports=H(11704)},11704:f=>{f.exports=function(f,Q,H){return f[0]=Q[0]/H[0],f[1]=Q[1]/H[1],f[2]=Q[2]/H[2],f}},11640:f=>{f.exports=function(f,Q){return f[0]*Q[0]+f[1]*Q[1]+f[2]*Q[2]}},11601:f=>{f.exports=1e-6},11660:(f,Q,H)=>{f.exports=function(f,Q){var H=f[0],i=f[1],S=f[2],x=Q[0],K=Q[1],Z=Q[2];return Math.abs(H-x)<=X*Math.max(1,Math.abs(H),Math.abs(x))&&Math.abs(i-K)<=X*Math.max(1,Math.abs(i),Math.abs(K))&&Math.abs(S-Z)<=X*Math.max(1,Math.abs(S),Math.abs(Z))};var X=H(11601)},11664:f=>{f.exports=function(f,Q){return f[0]===Q[0]&&f[1]===Q[1]&&f[2]===Q[2]}},11727:f=>{f.exports=function(f,Q){return f[0]=Math.floor(Q[0]),f[1]=Math.floor(Q[1]),f[2]=Math.floor(Q[2]),f}},11864:(f,Q,H)=>{f.exports=function(f,Q,H,i,S,x){var K,Z;Q||(Q=3);H||(H=0);Z=i?Math.min(i*Q+H,f.length):f.length;for(K=H;K<Z;K+=Q)X[0]=f[K],X[1]=f[K+1],X[2]=f[K+2],S(X,X,x),f[K]=X[0],f[K+1]=X[1],f[K+2]=X[2];return f};var X=H(11608)()},11626:f=>{f.exports=function(f,Q,H){var X=new Float32Array(3);return X[0]=f,X[1]=Q,X[2]=H,X}},11595:(f,Q,H)=>{f.exports={EPSILON:H(11601),create:H(11608),clone:H(11615),angle:H(11618),Fd:H(11626),j:H(11648),set:H(11651),equals:H(11660),exactEquals:H(11664),add:H(11671),hd:H(11680),sub:H(11688),multiply:H(11692),mul:H(11701),divide:H(11704),div:H(11709),min:H(11713),max:H(11718),floor:H(11727),ceil:H(11736),round:H(11740),scale:H(11743),Gd:H(11748),distance:H(11756),dist:H(11758),Id:H(11761),sqrDist:H(11767),length:H(11775),len:H(11781),squaredLength:H(11784),Jd:H(11792),negate:H(11800),inverse:H(11808),normalize:H(11632),dot:H(11640),cross:H(11814),ud:H(11816),random:H(11824),transformMat4:H(11827),transformMat3:H(11832),transformQuat:H(11841),Kd:H(11847),Md:H(11852),Nd:H(11860),forEach:H(11864)}},11808:f=>{f.exports=function(f,Q){return f[0]=1/Q[0],f[1]=1/Q[1],f[2]=1/Q[2],f}},11781:(f,Q,H)=>{f.exports=H(11775)},11775:f=>{f.exports=function(f){var Q=f[0],H=f[1],X=f[2];return Math.sqrt(Q*Q+H*H+X*X)}},11816:f=>{f.exports=function(f,Q,H,X){var i=Q[0],S=Q[1],x=Q[2];return f[0]=i+X*(H[0]-i),f[1]=S+X*(H[1]-S),f[2]=x+X*(H[2]-x),f}},11718:f=>{f.exports=function(f,Q,H){return f[0]=Math.max(Q[0],H[0]),f[1]=Math.max(Q[1],H[1]),f[2]=Math.max(Q[2],H[2]),f}},11713:f=>{f.exports=function(f,Q,H){return f[0]=Math.min(Q[0],H[0]),f[1]=Math.min(Q[1],H[1]),f[2]=Math.min(Q[2],H[2]),f}},11701:(f,Q,H)=>{f.exports=H(11692)},11692:f=>{f.exports=function(f,Q,H){return f[0]=Q[0]*H[0],f[1]=Q[1]*H[1],f[2]=Q[2]*H[2],f}},11800:f=>{f.exports=function(f,Q){return f[0]=-Q[0],f[1]=-Q[1],f[2]=-Q[2],f}},11632:f=>{f.exports=function(f,Q){var H=Q[0],X=Q[1],i=Q[2],S=H*H+X*X+i*i;S>0&&(S=1/Math.sqrt(S),f[0]=Q[0]*S,f[1]=Q[1]*S,f[2]=Q[2]*S);return f}},11824:f=>{f.exports=function(f,Q){Q=Q||1;var H=2*Math.random()*Math.PI,X=2*Math.random()-1,i=Math.sqrt(1-X*X)*Q;return f[0]=Math.cos(H)*i,f[1]=Math.sin(H)*i,f[2]=X*Q,f}},11847:f=>{f.exports=function(f,Q,H,X){var i=H[1],S=H[2],x=Q[1]-i,K=Q[2]-S,Z=Math.sin(X),B=Math.cos(X);return f[0]=Q[0],f[1]=i+x*B-K*Z,f[2]=S+x*Z+K*B,f}},11852:f=>{f.exports=function(f,Q,H,X){var i=H[0],S=H[2],x=Q[0]-i,K=Q[2]-S,Z=Math.sin(X),B=Math.cos(X);return f[0]=i+K*Z+x*B,f[1]=Q[1],f[2]=S+K*B-x*Z,f}},11860:f=>{f.exports=function(f,Q,H,X){var i=H[0],S=H[1],x=Q[0]-i,K=Q[1]-S,Z=Math.sin(X),B=Math.cos(X);return f[0]=i+x*B-K*Z,f[1]=S+x*Z+K*B,f[2]=Q[2],f}},11740:f=>{f.exports=function(f,Q){return f[0]=Math.round(Q[0]),f[1]=Math.round(Q[1]),f[2]=Math.round(Q[2]),f}},11743:f=>{f.exports=function(f,Q,H){return f[0]=Q[0]*H,f[1]=Q[1]*H,f[2]=Q[2]*H,f}},11748:f=>{f.exports=function(f,Q,H,X){return f[0]=Q[0]+H[0]*X,f[1]=Q[1]+H[1]*X,f[2]=Q[2]+H[2]*X,f}},11651:f=>{f.exports=function(f,Q,H,X){return f[0]=Q,f[1]=H,f[2]=X,f}},11767:(f,Q,H)=>{f.exports=H(11761)},11792:(f,Q,H)=>{f.exports=H(11784)},11761:f=>{f.exports=function(f,Q){var H=Q[0]-f[0],X=Q[1]-f[1],i=Q[2]-f[2];return H*H+X*X+i*i}},11784:f=>{f.exports=function(f){var Q=f[0],H=f[1],X=f[2];return Q*Q+H*H+X*X}},11688:(f,Q,H)=>{f.exports=H(11680)},11680:f=>{f.exports=function(f,Q,H){return f[0]=Q[0]-H[0],f[1]=Q[1]-H[1],f[2]=Q[2]-H[2],f}},11832:f=>{f.exports=function(f,Q,H){var X=Q[0],i=Q[1],S=Q[2];return f[0]=X*H[0]+i*H[3]+S*H[6],f[1]=X*H[1]+i*H[4]+S*H[7],f[2]=X*H[2]+i*H[5]+S*H[8],f}},11827:f=>{f.exports=function(f,Q,H){var X=Q[0],i=Q[1],S=Q[2],x=H[3]*X+H[7]*i+H[11]*S+H[15];return x=x||1,f[0]=(H[0]*X+H[4]*i+H[8]*S+H[12])/x,f[1]=(H[1]*X+H[5]*i+H[9]*S+H[13])/x,f[2]=(H[2]*X+H[6]*i+H[10]*S+H[14])/x,f}},11841:f=>{f.exports=function(f,Q,H){var X=Q[0],i=Q[1],S=Q[2],x=H[0],K=H[1],Z=H[2],B=H[3],N=B*X+K*S-Z*i,J=B*i+Z*X-x*S,g=B*S+x*i-K*X,z=-x*X-K*i-Z*S;return f[0]=N*B+z*-x+J*-Z-g*-K,f[1]=J*B+z*-K+g*-x-N*-Z,f[2]=g*B+z*-Z+N*-K-J*-x,f}},12025:f=>{"use strict";f.exports=function(f){for(var Q=new Array(f),H=0;H<f;++H)Q[H]=H;return Q}},12088:f=>{f.exports=function(f){return null!=f&&null!=f.constructor&&"function"===typeof f.constructor.isBuffer&&f.constructor.isBuffer(f)}},12285:(f,Q,H)=>{"use strict";H.d(Q,{e:()=>X});class X{constructor(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.zi=!1,this.Ai=!1,this.xi=30,this.yi=0,this.Ii=!1,this.fullscreen=!1,this.Ci=function(f){},this.Di=function(){},this.Gi=function(){},this.bb=function(){},this.Ei=function(f){},this.onFullscreenChanged=function(f){},B((()=>{!function(f,Q){f._nowObject=performance||Date,f._lastTick=0,f._renderAccum=0,f._rt=0,f._frameCB=K.bind(null,f),requestAnimationFrame(f._frameCB),Q>0&&(f._intervalCB=x.bind(null,f),f._interval=setInterval(f._intervalCB,Math.max(Q,1e3/f.xi/2)))}(this,Q),function(f,Q){if(!Q)return;var H=!1,X=!1;document.addEventListener("pointerlockchange",(X=>{H=document.pointerLockElement===Q,f.Ei(H)})),document.addEventListener("fullscreenchange",(H=>{X=document.fullscreenElement===Q,f.onFullscreenChanged(X)})),Object.defineProperty(f,"Ii",{get:()=>H,set:f=>{f&&!H?Z(Q):H&&!f&&function(f){f.exitPointerLock&&f.exitPointerLock()}(document)}}),Object.defineProperty(f,"fullscreen",{get:()=>X,set:f=>{f&&!X?Q.requestFullscreen():X&&!f&&document.exitFullscreen()}}),Q.addEventListener("click",(i=>{f.zi&&!H&&Z(Q),f.Ai&&!X&&Q.requestFullscreen()}));var i=()=>f.bb();if(window.ResizeObserver){new ResizeObserver(i).observe(Q)}else window.addEventListener("resize",i)}(this,f),this.Gi()}))}}var i=3,S=20;function x(f){for(var Q=1e3/f.xi,H=f._nowObject.now()+S,X=0;f._nowObject.now()>=f._lastTick+Q&&f._nowObject.now()<H&&++X<=i;)f.Ci(Q),f._lastTick+=Q;var x=5*(Q+5),K=f._nowObject.now();if(K-f._lastTick>x)for(;K>=f._lastTick+Q;)f._lastTick+=Q}function K(f){requestAnimationFrame(f._frameCB),x(f);var Q=f._nowObject.now(),H=Q-f._rt;if(f._rt=Q,f.yi>0){f._renderAccum+=H;var X=1e3/f.yi;if(f._renderAccum<X)return;f._renderAccum=Math.min(f._renderAccum-X,X)}var i=1e3/f.xi,S=(Q-f._lastTick)/i;f.Di(H,S,i)}function Z(f){f.requestPointerLock&&f.requestPointerLock()}var B=f=>{if("loading"===document.readyState){var Q=()=>{document.removeEventListener("readystatechange",Q),f()};document.addEventListener("readystatechange",Q)}else setTimeout(f,1)}},12021:(f,Q,H)=>{var X=H(12025),i=H(12030),S="undefined"!==typeof Float64Array;function x(f,Q){return f[0]-Q[0]}function K(){var f,Q=this.stride,H=new Array(Q.length);for(f=0;f<H.length;++f)H[f]=[Math.abs(Q[f]),f];H.sort(x);var X=new Array(H.length);for(f=0;f<X.length;++f)X[f]=H[f][1];return X}function Z(f,Q){var H=["View",Q,"d",f].join("");Q<0&&(H="View_Nil"+f);var i="generic"===f;if(-1===Q){var S="function "+H+"(a){this.data=a;};var proto="+H+".prototype;proto.dtype='"+f+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+H+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+H+"(a){return new "+H+"(a);}";return new Function(S)()}if(0===Q){S="function "+H+"(a,d) {this.data = a;this.offset = d};var proto="+H+".prototype;proto.dtype='"+f+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+H+"_copy() {return new "+H+"(this.data,this.offset)};proto.pick=function "+H+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+H+"_get(){return "+(i?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+H+"_set(v){return "+(i?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+H+"(a,b,c,d){return new "+H+"(a,d)}";return new Function("TrivialArray",S)(B[f][0])}S=["'use strict'"];var x=X(Q),Z=x.map((function(f){return"i"+f})),N="this.offset+"+x.map((function(f){return"this.stride["+f+"]*i"+f})).join("+"),J=x.map((function(f){return"b"+f})).join(","),g=x.map((function(f){return"c"+f})).join(",");S.push("function "+H+"(a,"+J+","+g+",d){this.data=a","this.shape=["+J+"]","this.stride=["+g+"]","this.offset=d|0}","var proto="+H+".prototype","proto.dtype='"+f+"'","proto.dimension="+Q),S.push("Object.defineProperty(proto,'size',{get:function "+H+"_size(){return "+x.map((function(f){return"this.shape["+f+"]"})).join("*"),"}})"),1===Q?S.push("proto.order=[0]"):(S.push("Object.defineProperty(proto,'order',{get:"),Q<4?(S.push("function "+H+"_order(){"),2===Q?S.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===Q&&S.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):S.push("ORDER})")),S.push("proto.set=function "+H+"_set("+Z.join(",")+",v){"),i?S.push("return this.data.set("+N+",v)}"):S.push("return this.data["+N+"]=v}"),S.push("proto.get=function "+H+"_get("+Z.join(",")+"){"),i?S.push("return this.data.get("+N+")}"):S.push("return this.data["+N+"]}"),S.push("proto.index=function "+H+"_index(",Z.join(),"){return "+N+"}"),S.push("proto.hi=function "+H+"_hi("+Z.join(",")+"){return new "+H+"(this.data,"+x.map((function(f){return["(typeof i",f,"!=='number'||i",f,"<0)?this.shape[",f,"]:i",f,"|0"].join("")})).join(",")+","+x.map((function(f){return"this.stride["+f+"]"})).join(",")+",this.offset)}");var z=x.map((function(f){return"a"+f+"=this.shape["+f+"]"})),v=x.map((function(f){return"c"+f+"=this.stride["+f+"]"}));S.push("proto.lo=function "+H+"_lo("+Z.join(",")+"){var b=this.offset,d=0,"+z.join(",")+","+v.join(","));for(var Y=0;Y<Q;++Y)S.push("if(typeof i"+Y+"==='number'&&i"+Y+">=0){d=i"+Y+"|0;b+=c"+Y+"*d;a"+Y+"-=d}");S.push("return new "+H+"(this.data,"+x.map((function(f){return"a"+f})).join(",")+","+x.map((function(f){return"c"+f})).join(",")+",b)}"),S.push("proto.step=function "+H+"_step("+Z.join(",")+"){var "+x.map((function(f){return"a"+f+"=this.shape["+f+"]"})).join(",")+","+x.map((function(f){return"b"+f+"=this.stride["+f+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Y=0;Y<Q;++Y)S.push("if(typeof i"+Y+"==='number'){d=i"+Y+"|0;if(d<0){c+=b"+Y+"*(a"+Y+"-1);a"+Y+"=ceil(-a"+Y+"/d)}else{a"+Y+"=ceil(a"+Y+"/d)}b"+Y+"*=d}");S.push("return new "+H+"(this.data,"+x.map((function(f){return"a"+f})).join(",")+","+x.map((function(f){return"b"+f})).join(",")+",c)}");var O=new Array(Q),n=new Array(Q);for(Y=0;Y<Q;++Y)O[Y]="a[i"+Y+"]",n[Y]="b[i"+Y+"]";S.push("proto.transpose=function "+H+"_transpose("+Z+"){"+Z.map((function(f,Q){return f+"=("+f+"===undefined?"+Q+":"+f+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+H+"(this.data,"+O.join(",")+","+n.join(",")+",this.offset)}"),S.push("proto.pick=function "+H+"_pick("+Z+"){var a=[],b=[],c=this.offset");for(Y=0;Y<Q;++Y)S.push("if(typeof i"+Y+"==='number'&&i"+Y+">=0){c=(c+this.stride["+Y+"]*i"+Y+")|0}else{a.push(this.shape["+Y+"]);b.push(this.stride["+Y+"])}");return S.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),S.push("return function construct_"+H+"(data,shape,stride,offset){return new "+H+"(data,"+x.map((function(f){return"shape["+f+"]"})).join(",")+","+x.map((function(f){return"stride["+f+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",S.join("\n"))(B[f],K)}var B={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};f.exports=function(f,Q,H,X){if(void 0===f)return(0,B.array[0])([]);"number"===typeof f&&(f=[f]),void 0===Q&&(Q=[f.length]);var x=Q.length;if(void 0===H){H=new Array(x);for(var K=x-1,N=1;K>=0;--K)H[K]=N,N*=Q[K]}if(void 0===X){X=0;for(K=0;K<x;++K)H[K]<0&&(X-=(Q[K]-1)*H[K])}for(var J=function(f){if(i(f))return"buffer";if(S)switch(Object.prototype.toString.call(f)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(f)?"array":"generic"}(f),g=B[J];g.length<=x+1;)g.push(Z(J,g.length-1));return(0,g[x+1])(f,Q,H,X)}},12030:f=>{function Q(f){return!!f.constructor&&"function"===typeof f.constructor.isBuffer&&f.constructor.isBuffer(f)}f.exports=function(f){return null!=f&&(Q(f)||function(f){return"function"===typeof f.readFloatLE&&"function"===typeof f.slice&&Q(f.slice(0,0))}(f)||!!f._isBuffer)}},12159:f=>{"use strict";var Q=[],H=[],X=[],i=[],S=[],x=[],K=[],Z=[],B=[],N=[],J=[],g=[];f.exports=function(f,z,v,Y,O,n){for(var e=K,G=B,I=N,l=g,q=0;q<3;q++)e[q]=+v[q],I[q]=+z.max[q],G[q]=+z.Qd[q];n||(n=1e-10);var D=function(f,K,B,N,g,z){var v=Q,Y=H,O=X,n=i,e=S,G=x,I=Z,l=Math.floor,q=0,D=0,d=0,s=0,F=0;if(P(),0===d)return 0;for(s=W();D<=d;){if(m(s)&&c())return q;s=W()}for(q+=d,F=0;F<3;F++)N[F]+=B[F],g[F]+=B[F];return q;function P(){if(D=0,0!==(d=Math.sqrt(B[0]*B[0]+B[1]*B[1]+B[2]*B[2])))for(var f=0;f<3;f++){var Q=B[f]>=0;n[f]=Q?1:-1;var H=Q?g[f]:N[f];v[f]=Q?N[f]:g[f],Y[f]=R(H,n[f]),O[f]=U(v[f],n[f]),I[f]=B[f]/d,e[f]=Math.abs(1/I[f]);var X=Q?Y[f]+1-H:H-Y[f];G[f]=e[f]<1/0?e[f]*X:1/0}}function m(Q){for(var H=n[0],X=0===Q?Y[0]:O[0],i=Y[0]+H,S=n[1],x=1===Q?Y[1]:O[1],K=Y[1]+S,Z=n[2],B=2===Q?Y[2]:O[2],N=Y[2]+Z,J=X;J!=i;J+=H)for(var g=x;g!=K;g+=S)for(var z=B;z!=N;z+=Z)if(f(J,g,z))return!0;return!1}function c(){q+=D;var f=n[s],Q=D/d,H=J;for(F=0;F<3;F++){var X=B[F]*Q;N[F]+=X,g[F]+=X,H[F]=B[F]-X}if(f>0?g[s]=Math.round(g[s]):N[s]=Math.round(N[s]),K(q,s,f,H))return!0;for(F=0;F<3;F++)B[F]=H[F];return P(),0===d}function W(){var f=G[0]<G[1]?G[0]<G[2]?0:2:G[1]<G[2]?1:2,Q=G[f]-D;for(D=G[f],Y[f]+=n[f],G[f]+=e[f],F=0;F<3;F++)v[F]+=Q*I[F],O[F]=U(v[F],n[F]);return f}function R(f,Q){return l(f-Q*z)}function U(f,Q){return l(f+Q*z)}}(f,Y,e,G,I,n);if(!O){for(q=0;q<3;q++)l[q]=v[q]>0?I[q]-z.max[q]:G[q]-z.Qd[q];z.translate(l)}return D}},12316:(f,Q,H)=>{"use strict";H.d(Q,{b:()=>J});var X=H(12152),i=H(11595);class S{constructor(f,Q,H,S,x,K,Z){this.$g=new X(f.Qd,f.xh),this.mass=Q,this.friction=H,this.restitution=S,this.ld=x,this.Rk=K,this.md=!!Z,this.uh=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.El=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.jg=i.create(),this.Vg=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=i.create(),this._impulses=i.create(),this._sleepFrameCount=10}loadFromCopy(f){i.j(this.$g.Qd,f.$g.Qd),i.j(this.$g.xh,f.$g.xh),i.j(this.$g.max,f.$g.max),this.$g.mag=f.$g.mag,this.mass=f.mass,this.friction=f.friction,this.restitution=f.restitution,this.ld=f.ld,this.Rk=f.Rk,this.md=f.md,this.uh=f.uh,this.fluidDrag=f.fluidDrag,this.El=f.El,this.preventFallOffEdge=f.preventFallOffEdge,this.rolledBackLastTick=f.rolledBackLastTick,i.j(this.jg,f.jg),i.j(this.Vg,f.Vg),this.inFluid=f.inFluid,this._ratioInFluid=f._ratioInFluid,i.j(this._forces,f._forces),i.j(this._impulses,f._impulses),this._sleepFrameCount=f._sleepFrameCount}setPosition(f){x(f),i.hd(f,f,this.$g.Qd),this.$g.translate(f),this.pg()}cb(){return i.clone(this.$g.Qd)}applyForce(f){x(f),i.add(this._forces,this._forces,f),this.pg()}applyImpulse(f){x(f),i.add(this._impulses,this._impulses,f),this.pg()}pg(){this._sleepFrameCount=10}atRestX(){return this.Vg[0]}atRestY(){return this.Vg[1]}atRestZ(){return this.Vg[2]}}var x=f=>{};var K=H(12152),Z=H(11595),B=H(12159);function N(){this.uh=.1,this.fluidDrag=.4,this.td=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function J(f,Q,H){f=Object.assign(new N,f),this.gravity=f.gravity||[0,-10,0],this.uh=f.uh||.1,this.td=f.td||2,this.fluidDrag=f.fluidDrag||.4,this.minBounceImpulse=f.minBounceImpulse,this.bodies=[],this.mk=f.mk,this.testSolid=Q,this.testFluid=H}J.prototype.Yk=function(f,Q,H,X,i,x){f=f||new K([0,0,0],[1,1,1]),"undefined"==typeof Q&&(Q=1),"undefined"==typeof H&&(H=1),"undefined"==typeof X&&(X=0),"undefined"==typeof i&&(i=1);var Z=new S(f,Q,H,X,i,x);return this.bodies.push(Z),Z},J.prototype.Zk=function(f){var Q=this.bodies.indexOf(f);Q<0||(this.bodies.splice(Q,1),f.$g=f.Rk=null)};var g=Z.create(),z=Z.create(),v=Z.create(),Y=Z.create(),O=Z.create(),n=Z.create(),e=Z.create(),G=new K([0,0,0],[1,1,1]),I=new S(G,1,1,0,1,(()=>{}),!1);function l(f,Q,H){return Q=H,Q*=1-(1-f.ratioInFluid)**2}J.prototype.if=function(f){f/=1e3;var Q=A(0,Z.squaredLength(this.gravity));this.bodies.forEach((H=>function(f,Q,H,X){Z.j(O,Q.Vg),f.mk&&I.loadFromCopy(Q);if(Q.mass<=0)return Z.set(Q.jg,0,0,0),Z.set(Q._forces,0,0,0),void Z.set(Q._impulses,0,0,0);var i=X||0===Q.ld;if(function(f,Q,H,X){if(Q._sleepFrameCount>0)return!1;if(X)return!0;var i=!1,S=.5*H*H*Q.ld;return Z.scale(L,f.gravity,S),B(f.testSolid,Q.$g,L,(function(){return i=!0,!0}),!0),i}(f,Q,H,i))return;Q._sleepFrameCount--,function(f,Q){var H=Q.$g,X=Math.floor(H.Qd[0]),i=Math.floor(H.Qd[2]),S=Math.floor(H.Qd[1]),x=Math.floor(H.max[1]);if(!f.testFluid(X,S,i))return Q.inFluid=!1,void(Q.ratioInFluid=0);var K=1,B=S+1;for(;B<=x&&f.testFluid(X,B,i);)K++,B++;var N=(S+K-H.Qd[1])/H.xh[1];N>1&&(N=1);var J=H.xh[0]*H.xh[1]*H.xh[2]*N,g=D;Z.scale(g,f.gravity,-f.td*J*Q.ld),Q.applyForce(g),Q.inFluid=!0,Q.ratioInFluid=N}(f,Q),V(Q._forces),V(Q._impulses),V(Q.jg),V(Q.Vg),Z.scale(g,Q._forces,1/Q.mass),Z.Gd(g,g,f.gravity,Q.ld),Z.scale(z,Q._impulses,1/Q.mass),Z.Gd(z,z,g,H),Z.add(Q.jg,Q.jg,z),Q.friction&&(d(f,0,Q,z,H),d(f,1,Q,z,H),d(f,2,Q,z,H));var S=Q.fluidDrag>=0?Q.fluidDrag:f.fluidDrag,x=Q.uh>=0?Q.uh:f.uh,K=x,N=x;Q.inFluid&&(K=l(Q,K,Q.fluidDragHoriz>=0?Q.fluidDragHoriz:S),N=l(Q,N,Q.fluidDragVert>=0?Q.fluidDragVert:S));K=Math.max(1-K*H/Q.mass,0),N=Math.max(1-N*H/Q.mass,0),Z.set(q,K,N,K),Z.multiply(Q.jg,Q.jg,q),Z.scale(v,Q.jg,H),Z.set(Q._forces,0,0,0),Z.set(Q._impulses,0,0,0),Q.md&&a(P,Q.$g);Z.j(n,v),Z.set(e,0,0,0),Q.preventFallOffEdge&&function(f,Q,H,X){if(!Q.Vg[1]||H[1]>0)return;var i=E;a(i,Q.$g);for(var S=0;S<3;S+=2){Z.set(U,0,0,0),U[S]=H[S];var x=!0;(x=(x=(x=(x=x&&!u(f,i.Qd[0]+U[0]+1e-5,i.Qd[1],i.Qd[2]+U[2]+1e-5))&&!u(f,i.max[0]+U[0]-1e-5,i.Qd[1],i.Qd[2]+U[2]+1e-5))&&!u(f,i.Qd[0]+U[0]+1e-5,i.Qd[1],i.max[2]+U[2]-1e-5))&&!u(f,i.max[0]+U[0]-1e-5,i.Qd[1],i.max[2]+U[2]-1e-5))?(X[S]=H[S]>0?1:-1,H[S]=0):0===S&&(Z.set(t,H[0],0,0),F(f,i,t,X,Q.slideOnCollision))}}(f,Q,v,e);F(f,Q.$g,v,Q.Vg,Q.slideOnCollision),Q.md&&function(f,Q,H,X){if(Q.Vg[1]>=0&&!Q.inFluid)return;var i=0!==Q.Vg[0],S=0!==Q.Vg[2];if(!i&&!S)return;var x=Math.abs(X[0]/X[2]),K=4;if(!i&&x>K)return;if(!S&&x<1/K)return;Z.add(c,H.Qd,X);var N=f.testSolid;B(N,H,X,(function(f,Q,H,X){if(1!==Q)return!0;X[Q]=0}));var J=H.Qd[1],g=Q.inFluid?1.951:1.001,z=Math.floor(J+g)-J;Z.set(W,0,z,0);var v=!1;if(B(N,H,W,(function(f,Q,H,X){return v=!0,!0})),v)return;Z.hd(R,c,H.Qd),R[1]=0,F(f,H,R,m,!0);var Y=A(H.Qd[0],c[0]),O=A(H.Qd[2],c[2]);if(i&&!Y&&(!O||!S))return;if(S&&(!Y||!i)&&!O)return;var n=!0;if(n=n&&!u(f,H.Qd[0]+1e-5,H.Qd[1],H.Qd[2]+1e-5),n=n&&!u(f,H.max[0]-1e-5,H.Qd[1],H.Qd[2]+1e-5),n=n&&!u(f,H.Qd[0]+1e-5,H.Qd[1],H.max[2]-1e-5),n=n&&!u(f,H.max[0]-1e-5,H.Qd[1],H.max[2]-1e-5),n)return;a(Q.$g,H),Q.Vg[0]=m[0],Q.Vg[2]=m[2],Q.El&&Q.El()}(f,Q,P,n);for(var J=0;J<3;++J)Q.Vg[J]=Q.Vg[J]||e[J],Y[J]=0,Q.Vg[J]&&(O[J]||(Y[J]=-Q.jg[J]),Q.jg[J]=0);var G=Z.length(Y);G>.001&&(Z.scale(Y,Y,Q.mass),Q.Rk&&Q.Rk(Y),Q.restitution>0&&G>f.minBounceImpulse&&(Z.scale(Y,Y,Q.restitution),Q.applyImpulse(Y)));var s=Z.squaredLength(Q.jg);s>1e-5&&Q.pg();f.mk&&f.mk(Q)?(Q.loadFromCopy(I),Q.rolledBackLastTick=!0):Q.rolledBackLastTick=!1}(this,H,f,Q)))};var q=Z.create([0,0,0]);var D=Z.create();function d(f,Q,H,X,i){var S=H.Vg[Q],x=X[Q];if(!H.alwaysApplyHorizFriction||1!==Q){if(0===S)return;if(S*x<=0)return}Z.j(s,H.jg),s[Q]=0;var K=Z.length(s);if(!A(K,0)){var B=Math.abs(H.friction*f.gravity[Q]*i),N=K>B?(K-B)/K:0;H.jg[(Q+1)%3]*=N,H.jg[(Q+2)%3]*=N}}var s=Z.create();function F(f,Q,H,X,i){return Z.set(X,0,0,0),B(f.testSolid,Q,H,(function(f,Q,H,S){X[Q]=H,S[Q]=0,i||(S[0]=0,S[1]=0,S[2]=0)}))}var P=new K([],[]),m=Z.create(),c=Z.create(),W=Z.create(),R=Z.create();var U=Z.create(),E=new K([],[]),t=Z.create();function u(f,Q,H,X){return f.testSolid(Math.floor(Q),Math.floor(H-1),Math.floor(X))}var L=Z.create();function A(f,Q){return Math.abs(f-Q)<1e-5}function a(f,Q){for(var H=0;H<3;H++)f.Qd[H]=Q.Qd[H],f.max[H]=Q.max[H],f.xh[H]=Q.xh[H]}var V=function(f){}},11085:function(f,Q){!function(f){"use strict";var Q=function(f,H){return Q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,Q){f.__proto__=Q}||function(f,Q){for(var H in Q)Object.prototype.hasOwnProperty.call(Q,H)&&(f[H]=Q[H])},Q(f,H)};function H(f,H){if("function"!==typeof H&&null!==H)throw new TypeError("Class extends value "+String(H)+" is not a constructor or null");function X(){this.constructor=f}Q(f,H),f.prototype=null===H?Object.create(H):(X.prototype=H.prototype,new X)}function X(f,Q,H,X){var i,S=arguments.length,x=S<3?Q:null===X?X=Object.getOwnPropertyDescriptor(Q,H):X;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)x=Reflect.decorate(f,Q,H,X);else for(var K=f.length-1;K>=0;K--)(i=f[K])&&(x=(S<3?i(x):S>3?i(Q,H,x):i(Q,H))||x);return S>3&&x&&Object.defineProperty(Q,H,x),x}function i(f,Q,H){if(H||2===arguments.length)for(var X,i=0,S=Q.length;i<S;i++)!X&&i in Q||(X||(X=Array.prototype.slice.call(Q,0,i)),X[i]=Q[i]);return f.concat(X||Array.prototype.slice.call(Q))}var S,x=255,K=213;f.OPERATION=void 0,(S=f.OPERATION||(f.OPERATION={}))[S.ADD=128]="ADD",S[S.REPLACE=0]="REPLACE",S[S.DELETE=64]="DELETE",S[S.DELETE_AND_ADD=192]="DELETE_AND_ADD",S[S.TOUCH=1]="TOUCH",S[S.CLEAR=10]="CLEAR";var Z=function(){function Q(f,Q,H){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=f,this.setParent(Q,H)}return Q.prototype.setParent=function(f,Q,H){var X=this;if(this.indexes||(this.indexes=this.ref instanceof Uf?this.ref._definition.indexes:{}),this.parent=f,this.parentIndex=H,Q)if(this.root=Q,this.ref instanceof Uf){var i=this.ref._definition;for(var S in i.schema){var x=this.ref[S];if(x&&x.$changes){var K=i.indexes[S];x.$changes.setParent(this.ref,Q,K)}}}else"object"===typeof this.ref&&this.ref.forEach((function(f,Q){if(f instanceof Uf){var H=f.$changes,i=X.ref.$changes.indexes[Q];H.setParent(X.ref,X.root,i)}}))},Q.prototype.operation=function(f){this.changes.set(--this.currentCustomOperation,f)},Q.prototype.change=function(Q,H){void 0===H&&(H=f.OPERATION.ADD);var X="number"===typeof Q?Q:this.indexes[Q];this.assertValidIndex(X,Q);var i=this.changes.get(X);i&&i.op!==f.OPERATION.DELETE&&i.op!==f.OPERATION.TOUCH||this.changes.set(X,{op:i&&i.op===f.OPERATION.DELETE?f.OPERATION.DELETE_AND_ADD:H,index:X}),this.allChanges.add(X),this.changed=!0,this.touchParents()},Q.prototype.touch=function(Q){var H="number"===typeof Q?Q:this.indexes[Q];this.assertValidIndex(H,Q),this.changes.has(H)||this.changes.set(H,{op:f.OPERATION.TOUCH,index:H}),this.allChanges.add(H),this.touchParents()},Q.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},Q.prototype.getType=function(f){if(this.ref._definition)return(Q=this.ref._definition).schema[Q.fieldsByIndex[f]];var Q,H=(Q=this.parent._definition).schema[Q.fieldsByIndex[this.parentIndex]];return Object.values(H)[0]},Q.prototype.getChildrenFilter=function(){var f=this.parent._definition.childFilters;return f&&f[this.parentIndex]},Q.prototype.getValue=function(f){return this.ref.getByIndex(f)},Q.prototype.delete=function(Q){var H="number"===typeof Q?Q:this.indexes[Q];if(void 0!==H){var X=this.getValue(H);this.changes.set(H,{op:f.OPERATION.DELETE,index:H}),this.allChanges.delete(H),delete this.caches[H],X&&X.$changes&&(X.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(Q," (").concat(H,")"))},Q.prototype.discard=function(Q,H){var X=this;void 0===Q&&(Q=!1),void 0===H&&(H=!1),this.ref instanceof Uf||this.changes.forEach((function(Q){if(Q.op===f.OPERATION.DELETE){var H=X.ref.getIndex(Q.index);delete X.indexes[H]}})),this.changes.clear(),this.changed=Q,H&&this.allChanges.clear(),this.currentCustomOperation=0},Q.prototype.discardAll=function(){var f=this;this.changes.forEach((function(Q){var H=f.getValue(Q.index);H&&H.$changes&&H.$changes.discardAll()})),this.discard()},Q.prototype.cache=function(f,Q){this.caches[f]=Q},Q.prototype.clone=function(){return new Q(this.ref,this.parent,this.root)},Q.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},Q.prototype.assertValidIndex=function(f,Q){if(void 0===f)throw new Error('ChangeTree: missing index for field "'.concat(Q,'"'))},Q}();function B(f,Q,H,X){return f[Q]||(f[Q]=[]),f[Q].push(H),null===X||void 0===X||X.forEach((function(f,Q){return H(f,Q)})),function(){return J(f[Q],f[Q].indexOf(H))}}function N(Q){var H=this,X="string"!==typeof this.$changes.getType();this.$items.forEach((function(i,S){Q.push({refId:H.$changes.refId,op:f.OPERATION.DELETE,field:S,value:void 0,previousValue:i}),X&&H.$changes.root.removeRef(i.$changes.refId)}))}function J(f,Q){if(-1===Q||Q>=f.length)return!1;for(var H=f.length-1,X=Q;X<H;X++)f[X]=f[X+1];return f.length=H,!0}var g=function(f,Q){var H=f.toString(),X=Q.toString();return H<X?-1:H>X?1:0};function z(f){return f.$proxy=!0,f=new Proxy(f,{get:function(f,Q){return"symbol"===typeof Q||isNaN(Q)?f[Q]:f.at(Q)},set:function(f,Q,H){if("symbol"===typeof Q||isNaN(Q))f[Q]=H;else{var X=Array.from(f.$items.keys()),i=parseInt(X[Q]||Q);void 0===H||null===H?f.deleteAt(i):f.setAt(i,H)}return!0},deleteProperty:function(f,Q){return"number"===typeof Q?f.deleteAt(Q):delete f[Q],!0}})}var v=function(){function Q(){for(var f=[],Q=0;Q<arguments.length;Q++)f[Q]=arguments[Q];this.$changes=new Z(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,f)}return Q.prototype.Ff=function(Q,H){return void 0===H&&(H=!0),B(this.$callbacks||(this.$callbacks=[]),f.OPERATION.ADD,Q,H?this.$items:void 0)},Q.prototype.ab=function(Q){return B(this.$callbacks||(this.$callbacks=[]),f.OPERATION.DELETE,Q)},Q.prototype.onChange=function(Q){return B(this.$callbacks||(this.$callbacks=[]),f.OPERATION.REPLACE,Q)},Q.is=function(f){return Array.isArray(f)||void 0!==f.array},Object.defineProperty(Q.prototype,"length",{get:function(){return this.$items.size},set:function(f){0===f?this.clear():this.splice(f,this.length-f)},enumerable:!1,configurable:!0}),Q.prototype.push=function(){for(var f,Q=this,H=[],X=0;X<arguments.length;X++)H[X]=arguments[X];return H.forEach((function(H){f=Q.$refId++,Q.setAt(f,H)})),f},Q.prototype.pop=function(){var f=Array.from(this.$indexes.values()).pop();if(void 0!==f){this.$changes.delete(f),this.$indexes.delete(f);var Q=this.$items.get(f);return this.$items.delete(f),Q}},Q.prototype.at=function(f){var Q=Array.from(this.$items.keys())[f];return this.$items.get(Q)},Q.prototype.setAt=function(Q,H){var X,i;if(void 0!==H&&null!==H){if(this.$items.get(Q)!==H){void 0!==H.$changes&&H.$changes.setParent(this,this.$changes.root,Q);var S=null!==(i=null===(X=this.$changes.indexes[Q])||void 0===X?void 0:X.op)&&void 0!==i?i:f.OPERATION.ADD;this.$changes.indexes[Q]=Q,this.$indexes.set(Q,Q),this.$items.set(Q,H),this.$changes.change(Q,S)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},Q.prototype.deleteAt=function(f){var Q=Array.from(this.$items.keys())[f];return void 0!==Q&&this.$deleteAt(Q)},Q.prototype.$deleteAt=function(f){return this.$changes.delete(f),this.$indexes.delete(f),this.$items.delete(f)},Q.prototype.clear=function(Q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Q&&N.call(this,Q),this.$items.clear(),this.$changes.operation({index:0,op:f.OPERATION.CLEAR}),this.$changes.touchParents()},Q.prototype.concat=function(){for(var f,H=[],X=0;X<arguments.length;X++)H[X]=arguments[X];return new(Q.bind.apply(Q,i([void 0],(f=Array.from(this.$items.values())).concat.apply(f,H),!1)))},Q.prototype.join=function(f){return Array.from(this.$items.values()).join(f)},Q.prototype.reverse=function(){var f=this,Q=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(H,X){f.setAt(Q[X],H)})),this},Q.prototype.shift=function(){var f=Array.from(this.$items.keys()).shift();if(void 0!==f){var Q=this.$items.get(f);return this.$deleteAt(f),Q}},Q.prototype.slice=function(f,H){var X=new Q;return X.push.apply(X,Array.from(this.$items.values()).slice(f,H)),X},Q.prototype.sort=function(f){var Q=this;void 0===f&&(f=g);var H=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(f).forEach((function(f,X){Q.setAt(H[X],f)})),this},Q.prototype.splice=function(f,Q){void 0===Q&&(Q=this.length-f);for(var H=Array.from(this.$items.keys()),X=[],i=f;i<f+Q;i++)X.push(this.$items.get(H[i])),this.$deleteAt(H[i]);return X},Q.prototype.unshift=function(){for(var f=this,Q=[],H=0;H<arguments.length;H++)Q[H]=arguments[H];var X=this.length,i=Q.length,S=Array.from(this.$items.values());return Q.forEach((function(Q,H){f.setAt(H,Q)})),S.forEach((function(Q,H){f.setAt(i+H,Q)})),X+i},Q.prototype.indexOf=function(f,Q){return Array.from(this.$items.values()).indexOf(f,Q)},Q.prototype.lastIndexOf=function(f,Q){return void 0===Q&&(Q=this.length-1),Array.from(this.$items.values()).lastIndexOf(f,Q)},Q.prototype.every=function(f,Q){return Array.from(this.$items.values()).every(f,Q)},Q.prototype.some=function(f,Q){return Array.from(this.$items.values()).some(f,Q)},Q.prototype.forEach=function(f,Q){Array.from(this.$items.values()).forEach(f,Q)},Q.prototype.map=function(f,Q){return Array.from(this.$items.values()).map(f,Q)},Q.prototype.filter=function(f,Q){return Array.from(this.$items.values()).filter(f,Q)},Q.prototype.reduce=function(f,Q){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},Q.prototype.reduceRight=function(f,Q){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},Q.prototype.find=function(f,Q){return Array.from(this.$items.values()).find(f,Q)},Q.prototype.findIndex=function(f,Q){return Array.from(this.$items.values()).findIndex(f,Q)},Q.prototype.fill=function(f,Q,H){throw new Error("ArraySchema#fill() not implemented")},Q.prototype.copyWithin=function(f,Q,H){throw new Error("ArraySchema#copyWithin() not implemented")},Q.prototype.toString=function(){return this.$items.toString()},Q.prototype.toLocaleString=function(){return this.$items.toLocaleString()},Q.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(Q,Symbol.species,{get:function(){return Q},enumerable:!1,configurable:!0}),Q.prototype.entries=function(){return this.$items.entries()},Q.prototype.keys=function(){return this.$items.keys()},Q.prototype.values=function(){return this.$items.values()},Q.prototype.includes=function(f,Q){return Array.from(this.$items.values()).includes(f,Q)},Q.prototype.flatMap=function(f,Q){throw new Error("ArraySchema#flatMap() is not supported.")},Q.prototype.flat=function(f){throw new Error("ArraySchema#flat() is not supported.")},Q.prototype.findLast=function(){var f=Array.from(this.$items.values());return f.findLast.apply(f,arguments)},Q.prototype.findLastIndex=function(){var f=Array.from(this.$items.values());return f.findLastIndex.apply(f,arguments)},Q.prototype.setIndex=function(f,Q){this.$indexes.set(f,Q)},Q.prototype.getIndex=function(f){return this.$indexes.get(f)},Q.prototype.getByIndex=function(f){return this.$items.get(this.$indexes.get(f))},Q.prototype.deleteByIndex=function(f){var Q=this.$indexes.get(f);this.$items.delete(Q),this.$indexes.delete(f)},Q.prototype.toArray=function(){return Array.from(this.$items.values())},Q.prototype.toJSON=function(){return this.toArray().map((function(f){return"function"===typeof f.toJSON?f.toJSON():f}))},Q.prototype.clone=function(f){return f?new(Q.bind.apply(Q,i([void 0],Array.from(this.$items.values()),!1))):new(Q.bind.apply(Q,i([void 0],this.map((function(f){return f.$changes?f.clone():f})),!1)))},Q}();function Y(f){return f.$proxy=!0,f=new Proxy(f,{get:function(f,Q){return"symbol"!==typeof Q&&"undefined"===typeof f[Q]?f.get(Q):f[Q]},set:function(f,Q,H){return"symbol"!==typeof Q&&-1===Q.indexOf("$")&&"Ff"!==Q&&"ab"!==Q&&"onChange"!==Q?f.set(Q,H):f[Q]=H,!0},deleteProperty:function(f,Q){return f.delete(Q),!0}})}var O=function(){function Q(f){var H=this;if(this.$changes=new Z(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,f)if(f instanceof Map||f instanceof Q)f.forEach((function(f,Q){return H.set(Q,f)}));else for(var X in f)this.set(X,f[X])}return Q.prototype.Ff=function(Q,H){return void 0===H&&(H=!0),B(this.$callbacks||(this.$callbacks=[]),f.OPERATION.ADD,Q,H?this.$items:void 0)},Q.prototype.ab=function(Q){return B(this.$callbacks||(this.$callbacks=[]),f.OPERATION.DELETE,Q)},Q.prototype.onChange=function(Q){return B(this.$callbacks||(this.$callbacks=[]),f.OPERATION.REPLACE,Q)},Q.is=function(f){return void 0!==f.map},Q.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(Q.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(Q,Symbol.species,{get:function(){return Q},enumerable:!1,configurable:!0}),Q.prototype.set=function(Q,H){if(void 0===H||null===H)throw new Error("MapSchema#set('".concat(Q,"', ").concat(H,"): trying to set ").concat(H," value on '").concat(Q,"'."));Q=Q.toString();var X="undefined"!==typeof this.$changes.indexes[Q],i=X?this.$changes.indexes[Q]:this.$refId++,S=X?f.OPERATION.REPLACE:f.OPERATION.ADD,x=void 0!==H.$changes;if(x&&H.$changes.setParent(this,this.$changes.root,i),X){if(!x&&this.$items.get(Q)===H)return;x&&this.$items.get(Q)!==H&&(S=f.OPERATION.ADD)}else this.$changes.indexes[Q]=i,this.$indexes.set(i,Q);return this.$items.set(Q,H),this.$changes.change(Q,S),this},Q.prototype.get=function(f){return this.$items.get(f)},Q.prototype.delete=function(f){return this.$changes.delete(f),this.$items.delete(f)},Q.prototype.clear=function(Q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Q&&N.call(this,Q),this.$items.clear(),this.$changes.operation({index:0,op:f.OPERATION.CLEAR}),this.$changes.touchParents()},Q.prototype.has=function(f){return this.$items.has(f)},Q.prototype.forEach=function(f){this.$items.forEach(f)},Q.prototype.entries=function(){return this.$items.entries()},Q.prototype.keys=function(){return this.$items.keys()},Q.prototype.values=function(){return this.$items.values()},Object.defineProperty(Q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Q.prototype.setIndex=function(f,Q){this.$indexes.set(f,Q)},Q.prototype.getIndex=function(f){return this.$indexes.get(f)},Q.prototype.getByIndex=function(f){return this.$items.get(this.$indexes.get(f))},Q.prototype.deleteByIndex=function(f){var Q=this.$indexes.get(f);this.$items.delete(Q),this.$indexes.delete(f)},Q.prototype.toJSON=function(){var f={};return this.forEach((function(Q,H){f[H]="function"===typeof Q.toJSON?Q.toJSON():Q})),f},Q.prototype.clone=function(f){var H;return f?H=Object.assign(new Q,this):(H=new Q,this.forEach((function(f,Q){f.$changes?H.set(Q,f.clone()):H.set(Q,f)}))),H},Q}(),n={};function e(f,Q){n[f]=Q}function G(f){return n[f]}var I=function(){function f(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return f.create=function(Q){var H=new f;return H.schema=Object.assign({},Q&&Q.schema||{}),H.indexes=Object.assign({},Q&&Q.indexes||{}),H.fieldsByIndex=Object.assign({},Q&&Q.fieldsByIndex||{}),H.descriptors=Object.assign({},Q&&Q.descriptors||{}),H.deprecated=Object.assign({},Q&&Q.deprecated||{}),H},f.prototype.addField=function(f,Q){var H=this.getNextFieldIndex();this.fieldsByIndex[H]=f,this.indexes[f]=H,this.schema[f]=Array.isArray(Q)?{array:Q[0]}:Q},f.prototype.hasField=function(f){return void 0!==this.indexes[f]},f.prototype.addFilter=function(f,Q){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[f]]=Q,this.indexesWithFilters.push(this.indexes[f]),!0},f.prototype.addChildrenFilter=function(f,Q){var H=this.indexes[f],X=this.schema[f];if(G(Object.keys(X)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[H]=Q,!0;console.warn("@filterChildren: field '".concat(f,"' can't have children. Ignoring filter."))},f.prototype.getChildrenFilter=function(f){return this.childFilters&&this.childFilters[this.indexes[f]]},f.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},f}();function l(f){return f._context&&f._context.useFilters}var q=function(){function f(){this.types={},this.schemas=new Map,this.useFilters=!1}return f.prototype.has=function(f){return this.schemas.has(f)},f.prototype.get=function(f){return this.types[f]},f.prototype.add=function(f,Q){void 0===Q&&(Q=this.schemas.size),f._definition=I.create(f._definition),f._typeid=Q,this.types[Q]=f,this.schemas.set(f,Q)},f.create=function(Q){return void 0===Q&&(Q={}),function(H){return Q.context||(Q.context=new f),d(H,Q)}},f}(),D=new q;function d(f,Q){return void 0===Q&&(Q={}),function(H,X){var S=Q.context||D,x=H.constructor;if(x._context=S,!f)throw new Error("".concat(x.name,': @type() reference provided for "').concat(X,"\" is undefined. Make sure you don't have any circular dependencies."));S.has(x)||S.add(x);var K=x._definition;if(K.addField(X,f),K.descriptors[X]){if(K.deprecated[X])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(X,"' definition on '").concat(x.name,"'.\nCheck @type() annotation"))}catch(n){var Z=n.stack.split("\n")[4].trim();throw new Error("".concat(n.message," ").concat(Z))}}var B=v.is(f),N=!B&&O.is(f);if("string"!==typeof f&&!Uf.is(f)){var J=Object.values(f)[0];"string"===typeof J||S.has(J)||S.add(J)}if(Q.manual)K.descriptors[X]={enumerable:!0,configurable:!0,writable:!0};else{var g="_".concat(X);K.descriptors[g]={enumerable:!1,configurable:!1,writable:!0},K.descriptors[X]={get:function(){return this[g]},set:function(f){f!==this[g]&&(void 0!==f&&null!==f?(!B||f instanceof v||(f=new(v.bind.apply(v,i([void 0],f,!1)))),!N||f instanceof O||(f=new O(f)),void 0===f.$proxy&&(N?f=Y(f):B&&(f=z(f))),this.$changes.change(X),f.$changes&&f.$changes.setParent(this,this.$changes.root,this._definition.indexes[X])):this[g]&&this.$changes.delete(X),this[g]=f)},enumerable:!0,configurable:!0}}}}function s(f){return function(Q,H){var X=Q.constructor;X._definition.addFilter(H,f)&&(X._context.useFilters=!0)}}function F(f){return function(Q,H){var X=Q.constructor;X._definition.addChildrenFilter(H,f)&&(X._context.useFilters=!0)}}function P(f){return void 0===f&&(f=!0),function(Q,H){var X=Q.constructor._definition;X.deprecated[H]=!0,f&&(X.descriptors[H]={get:function(){throw new Error("".concat(H," is deprecated."))},set:function(f){},enumerable:!1,configurable:!0})}}function m(f,Q,H){for(var X in void 0===H&&(H={}),H.context||(H.context=f._context||H.context||D),Q)d(Q[X],H)(f.prototype,X);return f}function c(f){for(var Q=0,H=0,X=0,i=f.length;X<i;X++)(Q=f.charCodeAt(X))<128?H+=1:Q<2048?H+=2:Q<55296||Q>=57344?H+=3:(X++,H+=4);return H}function W(f,Q,H){for(var X=0,i=0,S=H.length;i<S;i++)(X=H.charCodeAt(i))<128?f[Q++]=X:X<2048?(f[Q++]=192|X>>6,f[Q++]=128|63&X):X<55296||X>=57344?(f[Q++]=224|X>>12,f[Q++]=128|X>>6&63,f[Q++]=128|63&X):(i++,X=65536+((1023&X)<<10|1023&H.charCodeAt(i)),f[Q++]=240|X>>18,f[Q++]=128|X>>12&63,f[Q++]=128|X>>6&63,f[Q++]=128|63&X)}function R(f,Q){f.push(255&Q)}function U(f,Q){f.push(255&Q)}function E(f,Q){f.push(255&Q),f.push(Q>>8&255)}function t(f,Q){f.push(255&Q),f.push(Q>>8&255)}function u(f,Q){f.push(255&Q),f.push(Q>>8&255),f.push(Q>>16&255),f.push(Q>>24&255)}function L(f,Q){var H=Q>>24,X=Q>>16,i=Q>>8,S=Q;f.push(255&S),f.push(255&i),f.push(255&X),f.push(255&H)}function A(f,Q){var H=Math.floor(Q/Math.pow(2,32));L(f,Q>>>0),L(f,H)}function a(f,Q){var H=Q/Math.pow(2,32)|0;L(f,Q>>>0),L(f,H)}function V(f,Q){k(f,Q)}function M(f,Q){y(f,Q)}var r=new Int32Array(2),j=new Float32Array(r.buffer),T=new Float64Array(r.buffer);function k(f,Q){j[0]=Q,u(f,r[0])}function y(f,Q){T[0]=Q,u(f,r[0]),u(f,r[1])}function h(f,Q){return U(f,Q?1:0)}function w(f,Q){Q||(Q="");var H=c(Q),X=0;if(H<32)f.push(160|H),X=1;else if(H<256)f.push(217),U(f,H),X=2;else if(H<65536)f.push(218),t(f,H),X=3;else{if(!(H<4294967296))throw new Error("String too long");f.push(219),L(f,H),X=5}return W(f,f.length,Q),X+H}function b(f,Q){return isNaN(Q)?b(f,0):isFinite(Q)?Q!==(0|Q)?(f.push(203),y(f,Q),9):Q>=0?Q<128?(U(f,Q),1):Q<256?(f.push(204),U(f,Q),2):Q<65536?(f.push(205),t(f,Q),3):Q<4294967296?(f.push(206),L(f,Q),5):(f.push(207),a(f,Q),9):Q>=-32?(f.push(224|Q+32),1):Q>=-128?(f.push(208),R(f,Q),2):Q>=-32768?(f.push(209),E(f,Q),3):Q>=-2147483648?(f.push(210),u(f,Q),5):(f.push(211),A(f,Q),9):b(f,Q>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var o=Object.freeze({__proto__:null,utf8Write:W,int8:R,uint8:U,int16:E,uint16:t,int32:u,uint32:L,int64:A,uint64:a,float32:V,float64:M,writeFloat32:k,writeFloat64:y,boolean:h,string:w,number:b});function p(f,Q,H){for(var X="",i=0,S=Q,x=Q+H;S<x;S++){var K=f[S];0!==(128&K)?192!==(224&K)?224!==(240&K)?240!==(248&K)?console.error("Invalid byte "+K.toString(16)):(i=(7&K)<<18|(63&f[++S])<<12|(63&f[++S])<<6|63&f[++S])>=65536?(i-=65536,X+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):X+=String.fromCharCode(i):X+=String.fromCharCode((15&K)<<12|(63&f[++S])<<6|63&f[++S]):X+=String.fromCharCode((31&K)<<6|63&f[++S]):X+=String.fromCharCode(K)}return X}function C(f,Q){return ff(f,Q)<<24>>24}function ff(f,Q){return f[Q.offset++]}function Qf(f,Q){return Hf(f,Q)<<16>>16}function Hf(f,Q){return f[Q.offset++]|f[Q.offset++]<<8}function Xf(f,Q){return f[Q.offset++]|f[Q.offset++]<<8|f[Q.offset++]<<16|f[Q.offset++]<<24}function Sf(f,Q){return Xf(f,Q)>>>0}function xf(f,Q){return zf(f,Q)}function Kf(f,Q){return vf(f,Q)}function Zf(f,Q){var H=Sf(f,Q);return Xf(f,Q)*Math.pow(2,32)+H}function Bf(f,Q){var H=Sf(f,Q);return Sf(f,Q)*Math.pow(2,32)+H}var Nf=new Int32Array(2),Jf=new Float32Array(Nf.buffer),gf=new Float64Array(Nf.buffer);function zf(f,Q){return Nf[0]=Xf(f,Q),Jf[0]}function vf(f,Q){return Nf[0]=Xf(f,Q),Nf[1]=Xf(f,Q),gf[0]}function Yf(f,Q){return ff(f,Q)>0}function Of(f,Q){var H,X=f[Q.offset++];X<192?H=31&X:217===X?H=ff(f,Q):218===X?H=Hf(f,Q):219===X&&(H=Sf(f,Q));var i=p(f,Q.offset,H);return Q.offset+=H,i}function nf(f,Q){var H=f[Q.offset];return H<192&&H>160||217===H||218===H||219===H}function ef(f,Q){var H=f[Q.offset++];return H<128?H:202===H?zf(f,Q):203===H?vf(f,Q):204===H?ff(f,Q):205===H?Hf(f,Q):206===H?Sf(f,Q):207===H?Bf(f,Q):208===H?C(f,Q):209===H?Qf(f,Q):210===H?Xf(f,Q):211===H?Zf(f,Q):H>223?-1*(255-H+1):void 0}function Gf(f,Q){var H=f[Q.offset];return H<128||H>=202&&H<=211}function If(f,Q){return f[Q.offset]<160}function lf(f,Q){return f[Q.offset-1]===x&&(f[Q.offset]<128||f[Q.offset]>=202&&f[Q.offset]<=211)}var qf=Object.freeze({__proto__:null,int8:C,uint8:ff,int16:Qf,uint16:Hf,int32:Xf,uint32:Sf,float32:xf,float64:Kf,int64:Zf,uint64:Bf,readFloat32:zf,readFloat64:vf,boolean:Yf,string:Of,stringCheck:nf,number:ef,numberCheck:Gf,arrayCheck:If,switchStructureCheck:lf}),Df=function(){function Q(f){var Q=this;this.$changes=new Z(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,f&&f.forEach((function(f){return Q.add(f)}))}return Q.prototype.Ff=function(Q,H){return void 0===H&&(H=!0),B(this.$callbacks||(this.$callbacks=[]),f.OPERATION.ADD,Q,H?this.$items:void 0)},Q.prototype.ab=function(Q){return B(this.$callbacks||(this.$callbacks=[]),f.OPERATION.DELETE,Q)},Q.prototype.onChange=function(Q){return B(this.$callbacks||(this.$callbacks=[]),f.OPERATION.REPLACE,Q)},Q.is=function(f){return void 0!==f.collection},Q.prototype.add=function(f){var Q=this.$refId++;return void 0!==f.$changes&&f.$changes.setParent(this,this.$changes.root,Q),this.$changes.indexes[Q]=Q,this.$indexes.set(Q,Q),this.$items.set(Q,f),this.$changes.change(Q),Q},Q.prototype.at=function(f){var Q=Array.from(this.$items.keys())[f];return this.$items.get(Q)},Q.prototype.entries=function(){return this.$items.entries()},Q.prototype.delete=function(f){for(var Q,H,X=this.$items.entries();(H=X.next())&&!H.done;)if(f===H.value[1]){Q=H.value[0];break}return void 0!==Q&&(this.$changes.delete(Q),this.$indexes.delete(Q),this.$items.delete(Q))},Q.prototype.clear=function(Q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Q&&N.call(this,Q),this.$items.clear(),this.$changes.operation({index:0,op:f.OPERATION.CLEAR}),this.$changes.touchParents()},Q.prototype.has=function(f){return Array.from(this.$items.values()).some((function(Q){return Q===f}))},Q.prototype.forEach=function(f){var Q=this;this.$items.forEach((function(H,X,i){return f(H,X,Q)}))},Q.prototype.values=function(){return this.$items.values()},Object.defineProperty(Q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Q.prototype.setIndex=function(f,Q){this.$indexes.set(f,Q)},Q.prototype.getIndex=function(f){return this.$indexes.get(f)},Q.prototype.getByIndex=function(f){return this.$items.get(this.$indexes.get(f))},Q.prototype.deleteByIndex=function(f){var Q=this.$indexes.get(f);this.$items.delete(Q),this.$indexes.delete(f)},Q.prototype.toArray=function(){return Array.from(this.$items.values())},Q.prototype.toJSON=function(){var f=[];return this.forEach((function(Q,H){f.push("function"===typeof Q.toJSON?Q.toJSON():Q)})),f},Q.prototype.clone=function(f){var H;return f?H=Object.assign(new Q,this):(H=new Q,this.forEach((function(f){f.$changes?H.add(f.clone()):H.add(f)}))),H},Q}(),df=function(){function Q(f){var Q=this;this.$changes=new Z(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,f&&f.forEach((function(f){return Q.add(f)}))}return Q.prototype.Ff=function(Q,H){return void 0===H&&(H=!0),B(this.$callbacks||(this.$callbacks=[]),f.OPERATION.ADD,Q,H?this.$items:void 0)},Q.prototype.ab=function(Q){return B(this.$callbacks||(this.$callbacks=[]),f.OPERATION.DELETE,Q)},Q.prototype.onChange=function(Q){return B(this.$callbacks||(this.$callbacks=[]),f.OPERATION.REPLACE,Q)},Q.is=function(f){return void 0!==f.set},Q.prototype.add=function(Q){var H,X;if(this.has(Q))return!1;var i=this.$refId++;void 0!==Q.$changes&&Q.$changes.setParent(this,this.$changes.root,i);var S=null!==(X=null===(H=this.$changes.indexes[i])||void 0===H?void 0:H.op)&&void 0!==X?X:f.OPERATION.ADD;return this.$changes.indexes[i]=i,this.$indexes.set(i,i),this.$items.set(i,Q),this.$changes.change(i,S),i},Q.prototype.entries=function(){return this.$items.entries()},Q.prototype.delete=function(f){for(var Q,H,X=this.$items.entries();(H=X.next())&&!H.done;)if(f===H.value[1]){Q=H.value[0];break}return void 0!==Q&&(this.$changes.delete(Q),this.$indexes.delete(Q),this.$items.delete(Q))},Q.prototype.clear=function(Q){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),Q&&N.call(this,Q),this.$items.clear(),this.$changes.operation({index:0,op:f.OPERATION.CLEAR}),this.$changes.touchParents()},Q.prototype.has=function(f){for(var Q,H=this.$items.values(),X=!1;(Q=H.next())&&!Q.done;)if(f===Q.value){X=!0;break}return X},Q.prototype.forEach=function(f){var Q=this;this.$items.forEach((function(H,X,i){return f(H,X,Q)}))},Q.prototype.values=function(){return this.$items.values()},Object.defineProperty(Q.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),Q.prototype.setIndex=function(f,Q){this.$indexes.set(f,Q)},Q.prototype.getIndex=function(f){return this.$indexes.get(f)},Q.prototype.getByIndex=function(f){return this.$items.get(this.$indexes.get(f))},Q.prototype.deleteByIndex=function(f){var Q=this.$indexes.get(f);this.$items.delete(Q),this.$indexes.delete(f)},Q.prototype.toArray=function(){return Array.from(this.$items.values())},Q.prototype.toJSON=function(){var f=[];return this.forEach((function(Q,H){f.push("function"===typeof Q.toJSON?Q.toJSON():Q)})),f},Q.prototype.clone=function(f){var H;return f?H=Object.assign(new Q,this):(H=new Q,this.forEach((function(f){f.$changes?H.add(f.clone()):H.add(f)}))),H},Q}(),sf=function(){function f(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return f.prototype.addRefId=function(f){this.refIds.has(f)||(this.refIds.add(f),this.containerIndexes.set(f,new Set))},f.get=function(Q){return void 0===Q.$filterState&&(Q.$filterState=new f),Q.$filterState},f}(),Ff=function(){function f(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return f.prototype.getNextUniqueId=function(){return this.nextUniqueId++},f.prototype.addRef=function(f,Q,H){void 0===H&&(H=!0),this.refs.set(f,Q),H&&(this.refCounts[f]=(this.refCounts[f]||0)+1)},f.prototype.removeRef=function(f){this.refCounts[f]=this.refCounts[f]-1,this.deletedRefs.add(f)},f.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},f.prototype.garbageCollectDeletedRefs=function(){var f=this;this.deletedRefs.forEach((function(Q){if(!(f.refCounts[Q]>0)){var H=f.refs.get(Q);if(H instanceof Uf)for(var X in H._definition.schema)"string"!==typeof H._definition.schema[X]&&H[X]&&H[X].$changes&&f.removeRef(H[X].$changes.refId);else{var i=H.$changes.parent._definition,S=i.schema[i.fieldsByIndex[H.$changes.parentIndex]];"function"===typeof Object.values(S)[0]&&Array.from(H.values()).forEach((function(Q){return f.removeRef(Q.$changes.refId)}))}f.refs.delete(Q),delete f.refCounts[Q]}})),this.deletedRefs.clear()},f}(),Pf=function(f){function Q(){return null!==f&&f.apply(this,arguments)||this}return H(Q,f),Q}(Error);function mf(f,Q,H,X){var i,S=!1;switch(Q){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":i="number",isNaN(f)&&console.log('trying to encode "NaN" in '.concat(H.constructor.name,"#").concat(X));break;case"string":i="string",S=!0;break;case"boolean":return}if(typeof f!==i&&(!S||S&&null!==f)){var x="'".concat(JSON.stringify(f),"'").concat(f&&f.constructor&&" (".concat(f.constructor.name,")")||"");throw new Pf("a '".concat(i,"' was expected, but ").concat(x," was provided in ").concat(H.constructor.name,"#").concat(X))}}function cf(f,Q,H,X){if(!(f instanceof Q))throw new Pf("a '".concat(Q.name,"' was expected, but '").concat(f.constructor.name,"' was provided in ").concat(H.constructor.name,"#").concat(X))}function Wf(f,Q,H,X,i){mf(H,f,X,i);var S=o[f];if(!S)throw new Pf("a '".concat(f,"' was expected, but ").concat(H," was provided in ").concat(X.constructor.name,"#").concat(i));S(Q,H)}function Rf(f,Q,H){return qf[f](Q,H)}var Uf=function(){function Q(){for(var f=[],Q=0;Q<arguments.length;Q++)f[Q]=arguments[Q];Object.defineProperties(this,{$changes:{value:new Z(this,void 0,new Ff),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var H=this._definition.descriptors;H&&Object.defineProperties(this,H),f[0]&&this.assign(f[0])}return Q.onError=function(f){console.error(f)},Q.is=function(f){return f._definition&&void 0!==f._definition.schema},Q.prototype.onChange=function(Q){return B(this.$callbacks||(this.$callbacks=[]),f.OPERATION.REPLACE,Q)},Q.prototype.ab=function(Q){return B(this.$callbacks||(this.$callbacks=[]),f.OPERATION.DELETE,Q)},Q.prototype.assign=function(f){return Object.assign(this,f),this},Object.defineProperty(Q.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),Q.prototype.setDirty=function(f,Q){this.$changes.change(f,Q)},Q.prototype.listen=function(f,Q,H){var X=this;return void 0===H&&(H=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[f]||(this.$callbacks[f]=[]),this.$callbacks[f].push(Q),H&&void 0!==this[f]&&Q(this[f],void 0),function(){return J(X.$callbacks[f],X.$callbacks[f].indexOf(Q))}},Q.prototype.decode=function(H,X,i){var S;void 0===X&&(X={offset:0}),void 0===i&&(i=this);var K=[],Z=this.$changes.root,B=H.length,N=0;for(Z.refs.set(N,this);X.offset<B;){var J=H[X.offset++];if(J!=x){var g=i.$changes,z=void 0!==i._definition,Y=z?J>>6<<6:J;if(Y!==f.OPERATION.CLEAR){var n=z?J%(Y||255):ef(H,X),e=z?i._definition.fieldsByIndex[n]:"",I=g.getType(n),l=void 0,q=void 0,D=void 0;if(z?q=i["_".concat(e)]:(q=i.getByIndex(n),(Y&f.OPERATION.ADD)===f.OPERATION.ADD?(D=i instanceof O?Of(H,X):n,i.setIndex(n,D)):D=i.getIndex(n)),(Y&f.OPERATION.DELETE)===f.OPERATION.DELETE&&(Y!==f.OPERATION.DELETE_AND_ADD&&i.deleteByIndex(n),q&&q.$changes&&Z.removeRef(q.$changes.refId),l=null),void 0!==e){if(Y===f.OPERATION.DELETE);else if(Q.is(I)){var d=ef(H,X);if(l=Z.refs.get(d),Y!==f.OPERATION.REPLACE){var s=this.getSchemaType(H,X,I);l||((l=this.createTypeInstance(s)).$changes.refId=d,q&&(l.$callbacks=q.$callbacks,q.$changes.refId&&d!==q.$changes.refId&&Z.removeRef(q.$changes.refId))),Z.addRef(d,l,l!==q)}}else if("string"===typeof I)l=Rf(I,H,X);else{var F=G(Object.keys(I)[0]),P=ef(H,X),m=Z.refs.has(P)?q||Z.refs.get(P):new F.constructor;if((l=m.clone(!0)).$changes.refId=P,q&&(l.$callbacks=q.$callbacks,q.$changes.refId&&P!==q.$changes.refId)){Z.removeRef(q.$changes.refId);for(var c=q.entries(),W=void 0;(W=c.next())&&!W.done;){var R=(S=W.value)[0],U=S[1];K.push({refId:P,op:f.OPERATION.DELETE,field:R,value:void 0,previousValue:U})}}Z.addRef(P,l,m!==q)}if(null!==l&&void 0!==l)if(l.$changes&&l.$changes.setParent(g.ref,g.root,n),i instanceof Q)i[e]=l;else if(i instanceof O)R=D,i.$items.set(R,l),i.$changes.allChanges.add(n);else if(i instanceof v)i.setAt(n,l);else if(i instanceof Df){var E=i.add(l);i.setIndex(n,E)}else i instanceof df&&!1!==(E=i.add(l))&&i.setIndex(n,E);q!==l&&K.push({refId:N,op:Y,field:e,dynamicIndex:D,value:l,previousValue:q})}else{console.warn("@colyseus/schema: definition mismatch");for(var t={offset:X.offset};X.offset<B&&(!lf(H,X)||(t.offset=X.offset+1,!Z.refs.has(ef(H,t))));)X.offset++}}else i.clear(K)}else{N=ef(H,X);var u=Z.refs.get(N);if(!u)throw new Error('"refId" not found: '.concat(N));i=u}}return this._triggerChanges(K),Z.garbageCollectDeletedRefs(),K},Q.prototype.encode=function(H,X,i){void 0===H&&(H=!1),void 0===X&&(X=[]),void 0===i&&(i=!1);for(var S=this.$changes,K=new WeakSet,Z=[S],B=1,N=0;N<B;N++){var J=Z[N],g=J.ref,z=g instanceof Q;J.ensureRefId(),K.add(J),J!==S&&(J.changed||H)&&(U(X,x),b(X,J.refId));for(var v=H?Array.from(J.allChanges):Array.from(J.changes.values()),Y=0,n=v.length;Y<n;Y++){var e=H?{op:f.OPERATION.ADD,index:v[Y]}:v[Y],I=e.index,l=z?g._definition.fieldsByIndex&&g._definition.fieldsByIndex[I]:I,q=X.length;if(e.op!==f.OPERATION.TOUCH)if(z)U(X,I|e.op);else{if(U(X,e.op),e.op===f.OPERATION.CLEAR)continue;b(X,I)}if(z||(e.op&f.OPERATION.ADD)!=f.OPERATION.ADD||g instanceof O&&w(X,J.ref.$indexes.get(I)),e.op!==f.OPERATION.DELETE){var D=J.getType(I),d=J.getValue(I);if(d&&d.$changes&&!K.has(d.$changes)&&(Z.push(d.$changes),d.$changes.ensureRefId(),B++),e.op!==f.OPERATION.TOUCH){if(Q.is(D))cf(d,D,g,l),b(X,d.$changes.refId),(e.op&f.OPERATION.ADD)===f.OPERATION.ADD&&this.tryEncodeTypeId(X,D,d.constructor);else if("string"===typeof D)Wf(D,X,d,g,l);else{var s=G(Object.keys(D)[0]);cf(g["_".concat(l)],s.constructor,g,l),b(X,d.$changes.refId)}i&&J.cache(I,X.slice(q))}}}H||i||J.discard()}return X},Q.prototype.encodeAll=function(f){return this.encode(!0,[],f)},Q.prototype.applyFilters=function(H,X){var i,S;void 0===X&&(X=!1);for(var K=this,Z=new Set,B=sf.get(H),N=[this.$changes],J=1,g=[],z=function(z){var v=N[z];if(Z.has(v.refId))return"continue";var Y=v.ref,n=Y instanceof Q;U(g,x),b(g,v.refId);var e=B.refIds.has(v),G=X||!e;B.addRefId(v);var I=B.containerIndexes.get(v),l=G?Array.from(v.allChanges):Array.from(v.changes.values());!X&&n&&Y._definition.indexesWithFilters&&Y._definition.indexesWithFilters.forEach((function(Q){!I.has(Q)&&v.allChanges.has(Q)&&(G?l.push(Q):l.push({op:f.OPERATION.ADD,index:Q}))}));for(var q=0,D=l.length;q<D;q++){var d=G?{op:f.OPERATION.ADD,index:l[q]}:l[q];if(d.op!==f.OPERATION.CLEAR){var s=d.index;if(d.op!==f.OPERATION.DELETE){var F=v.getValue(s),P=v.getType(s);if(n){if((m=Y._definition.filters&&Y._definition.filters[s])&&!m.call(Y,H,F,K)){F&&F.$changes&&Z.add(F.$changes.refId);continue}}else{var m,c=v.parent;if((m=v.getChildrenFilter())&&!m.call(c,H,Y.$indexes.get(s),F,K)){F&&F.$changes&&Z.add(F.$changes.refId);continue}}if(F.$changes&&(N.push(F.$changes),J++),d.op!==f.OPERATION.TOUCH)if(d.op===f.OPERATION.ADD||n)g.push.apply(g,null!==(i=v.caches[s])&&void 0!==i?i:[]),I.add(s);else if(I.has(s))g.push.apply(g,null!==(S=v.caches[s])&&void 0!==S?S:[]);else{if(I.add(s),U(g,f.OPERATION.ADD),b(g,s),Y instanceof O){var W=v.ref.$indexes.get(s);w(g,W)}F.$changes?b(g,F.$changes.refId):o[P](g,F)}else F.$changes&&!n&&(U(g,f.OPERATION.ADD),b(g,s),Y instanceof O&&(W=v.ref.$indexes.get(s),w(g,W)),b(g,F.$changes.refId))}else n?U(g,d.op|s):(U(g,d.op),b(g,s))}else U(g,d.op)}},v=0;v<J;v++)z(v);return g},Q.prototype.clone=function(){var f,Q=new this.constructor,H=this._definition.schema;for(var X in H)"object"===typeof this[X]&&"function"===typeof(null===(f=this[X])||void 0===f?void 0:f.clone)?Q[X]=this[X].clone():Q[X]=this[X];return Q},Q.prototype.toJSON=function(){var f=this._definition.schema,Q=this._definition.deprecated,H={};for(var X in f)Q[X]||null===this[X]||"undefined"===typeof this[X]||(H[X]="function"===typeof this[X].toJSON?this[X].toJSON():this["_".concat(X)]);return H},Q.prototype.discardAllChanges=function(){this.$changes.discardAll()},Q.prototype.getByIndex=function(f){return this[this._definition.fieldsByIndex[f]]},Q.prototype.deleteByIndex=function(f){this[this._definition.fieldsByIndex[f]]=void 0},Q.prototype.tryEncodeTypeId=function(f,Q,H){Q._typeid!==H._typeid&&(U(f,K),b(f,H._typeid))},Q.prototype.getSchemaType=function(f,Q,H){var X;return f[Q.offset]===K&&(Q.offset++,X=this.constructor._context.get(ef(f,Q))),X||H},Q.prototype.createTypeInstance=function(f){var Q=new f;return Q.$changes.root=this.$changes.root,Q},Q.prototype._triggerChanges=function(H){for(var X,i,S,x,K,Z,B,N,J,g=new Set,z=this.$changes.root.refs,v=function(v){var Y=H[v],O=Y.refId,n=z.get(O),e=n.$callbacks;if((Y.op&f.OPERATION.DELETE)===f.OPERATION.DELETE&&Y.previousValue instanceof Q&&(null===(i=null===(X=Y.previousValue.$callbacks)||void 0===X?void 0:X[f.OPERATION.DELETE])||void 0===i||i.forEach((function(f){return f()}))),!e)return"continue";if(n instanceof Q){if(!g.has(O))try{null===(S=null===e||void 0===e?void 0:e[f.OPERATION.REPLACE])||void 0===S||S.forEach((function(f){return f()}))}catch(G){Q.onError(G)}try{e.hasOwnProperty(Y.field)&&(null===(x=e[Y.field])||void 0===x||x.forEach((function(f){return f(Y.value,Y.previousValue)})))}catch(G){Q.onError(G)}}else Y.op===f.OPERATION.ADD&&void 0===Y.previousValue?null===(K=e[f.OPERATION.ADD])||void 0===K||K.forEach((function(f){var Q;return f(Y.value,null!==(Q=Y.dynamicIndex)&&void 0!==Q?Q:Y.field)})):Y.op===f.OPERATION.DELETE?void 0!==Y.previousValue&&(null===(Z=e[f.OPERATION.DELETE])||void 0===Z||Z.forEach((function(f){var Q;return f(Y.previousValue,null!==(Q=Y.dynamicIndex)&&void 0!==Q?Q:Y.field)}))):Y.op===f.OPERATION.DELETE_AND_ADD&&(void 0!==Y.previousValue&&(null===(B=e[f.OPERATION.DELETE])||void 0===B||B.forEach((function(f){var Q;return f(Y.previousValue,null!==(Q=Y.dynamicIndex)&&void 0!==Q?Q:Y.field)}))),null===(N=e[f.OPERATION.ADD])||void 0===N||N.forEach((function(f){var Q;return f(Y.value,null!==(Q=Y.dynamicIndex)&&void 0!==Q?Q:Y.field)}))),Y.value!==Y.previousValue&&(null===(J=e[f.OPERATION.REPLACE])||void 0===J||J.forEach((function(f){var Q;return f(Y.value,null!==(Q=Y.dynamicIndex)&&void 0!==Q?Q:Y.field)})));g.add(O)},Y=0;Y<H.length;Y++)v(Y)},Q._definition=I.create(),Q}();function Ef(f){for(var Q=[f.$changes],H=1,X={},i=X,S=function(f){var H=Q[f];H.changes.forEach((function(f){var Q=H.ref,X=f.index,S=Q._definition?Q._definition.fieldsByIndex[X]:Q.$indexes.get(X);i[S]=H.getValue(X)}))},x=0;x<H;x++)S(x);return X}var tf={context:new q},uf=function(f){function Q(){return null!==f&&f.apply(this,arguments)||this}return H(Q,f),X([d("string",tf)],Q.prototype,"name",void 0),X([d("string",tf)],Q.prototype,"type",void 0),X([d("number",tf)],Q.prototype,"referencedType",void 0),Q}(Uf),Lf=function(f){function Q(){var Q=null!==f&&f.apply(this,arguments)||this;return Q.fields=new v,Q}return H(Q,f),X([d("number",tf)],Q.prototype,"id",void 0),X([d([uf],tf)],Q.prototype,"fields",void 0),Q}(Uf),Af=function(f){function Q(){var Q=null!==f&&f.apply(this,arguments)||this;return Q.types=new v,Q}return H(Q,f),Q.encode=function(f){var H=f.constructor,X=new Q;X.rootType=H._typeid;var i=function(f,Q){for(var H in Q){var i=new uf;i.name=H;var S=void 0;if("string"===typeof Q[H])S=Q[H];else{var x=Q[H],K=void 0;Uf.is(x)?(S="ref",K=Q[H]):"string"===typeof x[S=Object.keys(x)[0]]?S+=":"+x[S]:K=x[S],i.referencedType=K?K._typeid:-1}i.type=S,f.fields.push(i)}X.types.push(f)},S=H._context.types;for(var x in S){var K=new Lf;K.id=Number(x),i(K,S[x]._definition.schema)}return X.encodeAll()},Q.decode=function(f,X){var i=new q,S=new Q;S.decode(f,X);var x=S.types.reduce((function(f,Q){var X=function(f){function Q(){return null!==f&&f.apply(this,arguments)||this}return H(Q,f),Q}(Uf),S=Q.id;return f[S]=X,i.add(X,S),f}),{});S.types.forEach((function(f){var Q=x[f.id];f.fields.forEach((function(f){var H;if(void 0!==f.referencedType){var X=f.type,S=x[f.referencedType];if(!S){var K=f.type.split(":");X=K[0],S=K[1]}"ref"===X?d(S,{context:i})(Q.prototype,f.name):d(((H={})[X]=S,H),{context:i})(Q.prototype,f.name)}else d(f.type,{context:i})(Q.prototype,f.name)}))}));var K=x[S.rootType],Z=new K;for(var B in K._definition.schema){var N=K._definition.schema[B];"string"!==typeof N&&(Z[B]="function"===typeof N?new N:new(G(Object.keys(N)[0]).constructor))}return Z},X([d([Lf],tf)],Q.prototype,"types",void 0),X([d("number",tf)],Q.prototype,"rootType",void 0),Q}(Uf);e("map",{constructor:O}),e("array",{constructor:v}),e("set",{constructor:df}),e("collection",{constructor:Df}),f.ArraySchema=v,f.CollectionSchema=Df,f.Context=q,f.MapSchema=O,f.Reflection=Af,f.ReflectionField=uf,f.ReflectionType=Lf,f.Schema=Uf,f.SchemaDefinition=I,f.SetSchema=df,f.decode=qf,f.defineTypes=m,f.deprecated=P,f.dumpChanges=Ef,f.encode=o,f.filter=s,f.filterChildren=F,f.hasFilter=l,f.registerType=e,f.type=d,Object.defineProperty(f,"__esModule",{value:!0})}(Q)},12193:f=>{"use strict";f.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12189:(f,Q,H)=>{var X=H(12193),i=H(12197),S=Object.hasOwnProperty,x=Object.create(null);for(var K in X)S.call(X,K)&&(x[X[K]]=K);var Z=f.exports={to:{},get:{}};function B(f,Q,H){return Math.min(Math.max(Q,f),H)}function N(f){var Q=Math.round(f).toString(16).toUpperCase();return Q.length<2?"0"+Q:Q}Z.get=function(f){var Q,H;switch(f.substring(0,3).toLowerCase()){case"hsl":Q=Z.get.hsl(f),H="hsl";break;case"hwb":Q=Z.get.hwb(f),H="hwb";break;default:Q=Z.get.rgb(f),H="rgb"}return Q?{model:H,value:Q}:null},Z.get.rgb=function(f){if(!f)return null;var Q,H,i,x=[0,0,0,1];if(Q=f.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(i=Q[2],Q=Q[1],H=0;H<3;H++){var K=2*H;x[H]=parseInt(Q.slice(K,K+2),16)}i&&(x[3]=parseInt(i,16)/255)}else if(Q=f.match(/^#([a-f0-9]{3,4})$/i)){for(i=(Q=Q[1])[3],H=0;H<3;H++)x[H]=parseInt(Q[H]+Q[H],16);i&&(x[3]=parseInt(i+i,16)/255)}else if(Q=f.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(H=0;H<3;H++)x[H]=parseInt(Q[H+1],0);Q[4]&&(Q[5]?x[3]=.01*parseFloat(Q[4]):x[3]=parseFloat(Q[4]))}else{if(!(Q=f.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(Q=f.match(/^(\w+)$/))?"transparent"===Q[1]?[0,0,0,0]:S.call(X,Q[1])?((x=X[Q[1]])[3]=1,x):null:null;for(H=0;H<3;H++)x[H]=Math.round(2.55*parseFloat(Q[H+1]));Q[4]&&(Q[5]?x[3]=.01*parseFloat(Q[4]):x[3]=parseFloat(Q[4]))}for(H=0;H<3;H++)x[H]=B(x[H],0,255);return x[3]=B(x[3],0,1),x},Z.get.hsl=function(f){if(!f)return null;var Q=f.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(Q){var H=parseFloat(Q[4]);return[(parseFloat(Q[1])%360+360)%360,B(parseFloat(Q[2]),0,100),B(parseFloat(Q[3]),0,100),B(isNaN(H)?1:H,0,1)]}return null},Z.get.hwb=function(f){if(!f)return null;var Q=f.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(Q){var H=parseFloat(Q[4]);return[(parseFloat(Q[1])%360+360)%360,B(parseFloat(Q[2]),0,100),B(parseFloat(Q[3]),0,100),B(isNaN(H)?1:H,0,1)]}return null},Z.to.hex=function(){var f=i(arguments);return"#"+N(f[0])+N(f[1])+N(f[2])+(f[3]<1?N(Math.round(255*f[3])):"")},Z.to.rgb=function(){var f=i(arguments);return f.length<4||1===f[3]?"rgb("+Math.round(f[0])+", "+Math.round(f[1])+", "+Math.round(f[2])+")":"rgba("+Math.round(f[0])+", "+Math.round(f[1])+", "+Math.round(f[2])+", "+f[3]+")"},Z.to.rgb.percent=function(){var f=i(arguments),Q=Math.round(f[0]/255*100),H=Math.round(f[1]/255*100),X=Math.round(f[2]/255*100);return f.length<4||1===f[3]?"rgb("+Q+"%, "+H+"%, "+X+"%)":"rgba("+Q+"%, "+H+"%, "+X+"%, "+f[3]+")"},Z.to.hsl=function(){var f=i(arguments);return f.length<4||1===f[3]?"hsl("+f[0]+", "+f[1]+"%, "+f[2]+"%)":"hsla("+f[0]+", "+f[1]+"%, "+f[2]+"%, "+f[3]+")"},Z.to.hwb=function(){var f=i(arguments),Q="";return f.length>=4&&1!==f[3]&&(Q=", "+f[3]),"hwb("+f[0]+", "+f[1]+"%, "+f[2]+"%"+Q+")"},Z.to.keyword=function(f){return x[f.slice(0,3)]}},12181:(f,Q,H)=>{const X=H(12189),i=H(12205),S=["keyword","gray","hex"],x={};for(const z of Object.keys(i))x[[...i[z].labels].sort().join("")]=z;const K={};function Z(f,Q){if(!(this instanceof Z))return new Z(f,Q);if(Q&&Q in S&&(Q=null),Q&&!(Q in i))throw new Error("Unknown model: "+Q);let H,B;if(null==f)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(f instanceof Z)this.model=f.model,this.color=[...f.color],this.valpha=f.valpha;else if("string"===typeof f){const Q=X.get(f);if(null===Q)throw new Error("Unable to parse color from string: "+f);this.model=Q.model,B=i[this.model].channels,this.color=Q.value.slice(0,B),this.valpha="number"===typeof Q.value[B]?Q.value[B]:1}else if(f.length>0){this.model=Q||"rgb",B=i[this.model].channels;const H=Array.prototype.slice.call(f,0,B);this.color=g(H,B),this.valpha="number"===typeof f[B]?f[B]:1}else if("number"===typeof f)this.model="rgb",this.color=[f>>16&255,f>>8&255,255&f],this.valpha=1;else{this.valpha=1;const Q=Object.keys(f);"alpha"in f&&(Q.splice(Q.indexOf("alpha"),1),this.valpha="number"===typeof f.alpha?f.alpha:0);const X=Q.sort().join("");if(!(X in x))throw new Error("Unable to parse color from object: "+JSON.stringify(f));this.model=x[X];const{labels:S}=i[this.model],K=[];for(H=0;H<S.length;H++)K.push(f[S[H]]);this.color=g(K)}if(K[this.model])for(B=i[this.model].channels,H=0;H<B;H++){const f=K[this.model][H];f&&(this.color[H]=f(this.color[H]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}Z.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(f){let Q=this.model in X.to?this:this.rgb();Q=Q.round("number"===typeof f?f:1);const H=1===Q.valpha?Q.color:[...Q.color,this.valpha];return X.to[Q.model](H)},percentString(f){const Q=this.rgb().round("number"===typeof f?f:1),H=1===Q.valpha?Q.color:[...Q.color,this.valpha];return X.to.rgb.percent(H)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const f={},{channels:Q}=i[this.model],{labels:H}=i[this.model];for(let X=0;X<Q;X++)f[H[X]]=this.color[X];return 1!==this.valpha&&(f.alpha=this.valpha),f},unitArray(){const f=this.rgb().color;return f[0]/=255,f[1]/=255,f[2]/=255,1!==this.valpha&&f.push(this.valpha),f},unitObject(){const f=this.rgb().object();return f.r/=255,f.g/=255,f.b/=255,1!==this.valpha&&(f.alpha=this.valpha),f},round(f){return f=Math.max(f||0,0),new Z([...this.color.map(B(f)),this.valpha],this.model)},alpha(f){return void 0!==f?new Z([...this.color,Math.max(0,Math.min(1,f))],this.model):this.valpha},red:N("rgb",0,J(255)),green:N("rgb",1,J(255)),blue:N("rgb",2,J(255)),hue:N(["hsl","hsv","hsl","hwb","hcg"],0,(f=>(f%360+360)%360)),saturationl:N("hsl",1,J(100)),lightness:N("hsl",2,J(100)),saturationv:N("hsv",1,J(100)),value:N("hsv",2,J(100)),chroma:N("hcg",1,J(100)),gray:N("hcg",2,J(100)),white:N("hwb",1,J(100)),wblack:N("hwb",2,J(100)),cyan:N("cmyk",0,J(100)),magenta:N("cmyk",1,J(100)),yellow:N("cmyk",2,J(100)),black:N("cmyk",3,J(100)),x:N("xyz",0,J(95.047)),y:N("xyz",1,J(100)),z:N("xyz",2,J(108.833)),l:N("lab",0,J(100)),a:N("lab",1),b:N("lab",2),keyword(f){return void 0!==f?new Z(f):i[this.model].keyword(this.color)},hex(f){return void 0!==f?new Z(f):X.to.hex(this.rgb().round().color)},hexa(f){if(void 0!==f)return new Z(f);const Q=this.rgb().round().color;let H=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===H.length&&(H="0"+H),X.to.hex(Q)+H},rgbNumber(){const f=this.rgb().color;return(255&f[0])<<16|(255&f[1])<<8|255&f[2]},luminosity(){const f=this.rgb().color,Q=[];for(const[H,X]of f.entries()){const f=X/255;Q[H]=f<=.04045?f/12.92:((f+.055)/1.055)**2.4}return.2126*Q[0]+.7152*Q[1]+.0722*Q[2]},contrast(f){const Q=this.luminosity(),H=f.luminosity();return Q>H?(Q+.05)/(H+.05):(H+.05)/(Q+.05)},level(f){const Q=this.contrast(f);return Q>=7?"AAA":Q>=4.5?"AA":""},isDark(){const f=this.rgb().color;return(2126*f[0]+7152*f[1]+722*f[2])/1e4<128},isLight(){return!this.isDark()},negate(){const f=this.rgb();for(let Q=0;Q<3;Q++)f.color[Q]=255-f.color[Q];return f},lighten(f){const Q=this.hsl();return Q.color[2]+=Q.color[2]*f,Q},darken(f){const Q=this.hsl();return Q.color[2]-=Q.color[2]*f,Q},saturate(f){const Q=this.hsl();return Q.color[1]+=Q.color[1]*f,Q},desaturate(f){const Q=this.hsl();return Q.color[1]-=Q.color[1]*f,Q},whiten(f){const Q=this.hwb();return Q.color[1]+=Q.color[1]*f,Q},blacken(f){const Q=this.hwb();return Q.color[2]+=Q.color[2]*f,Q},grayscale(){const f=this.rgb().color,Q=.3*f[0]+.59*f[1]+.11*f[2];return Z.rgb(Q,Q,Q)},fade(f){return this.alpha(this.valpha-this.valpha*f)},opaquer(f){return this.alpha(this.valpha+this.valpha*f)},rotate(f){const Q=this.hsl();let H=Q.color[0];return H=(H+f)%360,H=H<0?360+H:H,Q.color[0]=H,Q},mix(f,Q){if(!f||!f.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof f);const H=f.rgb(),X=this.rgb(),i=void 0===Q?.5:Q,S=2*i-1,x=H.alpha()-X.alpha(),K=((S*x===-1?S:(S+x)/(1+S*x))+1)/2,B=1-K;return Z.rgb(K*H.red()+B*X.red(),K*H.green()+B*X.green(),K*H.blue()+B*X.blue(),H.alpha()*i+X.alpha()*(1-i))}};for(const z of Object.keys(i)){if(S.includes(z))continue;const{channels:f}=i[z];Z.prototype[z]=function(){if(this.model===z)return new Z(this);for(var f=arguments.length,Q=new Array(f),H=0;H<f;H++)Q[H]=arguments[H];return Q.length>0?new Z(Q,z):new Z([...(X=i[this.model][z].raw(this.color),Array.isArray(X)?X:[X]),this.valpha],z);var X},Z[z]=function(){for(var Q=arguments.length,H=new Array(Q),X=0;X<Q;X++)H[X]=arguments[X];let i=H[0];return"number"===typeof i&&(i=g(H,f)),new Z(i,z)}}function B(f){return function(Q){return function(f,Q){return Number(f.toFixed(Q))}(Q,f)}}function N(f,Q,H){f=Array.isArray(f)?f:[f];for(const X of f)(K[X]||(K[X]=[]))[Q]=H;return f=f[0],function(X){let i;return void 0!==X?(H&&(X=H(X)),i=this[f](),i.color[Q]=X,i):(i=this[f]().color[Q],H&&(i=H(i)),i)}}function J(f){return function(Q){return Math.max(0,Math.min(f,Q))}}function g(f,Q){for(let H=0;H<Q;H++)"number"!==typeof f[H]&&(f[H]=0);return f}f.exports=Z},12208:(f,Q,H)=>{const X=H(12217),i={};for(const x of Object.keys(X))i[X[x]]=x;const S={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};f.exports=S;for(const x of Object.keys(S)){if(!("channels"in S[x]))throw new Error("missing channels property: "+x);if(!("labels"in S[x]))throw new Error("missing channel labels property: "+x);if(S[x].labels.length!==S[x].channels)throw new Error("channel and label counts mismatch: "+x);const{channels:f,labels:Q}=S[x];delete S[x].channels,delete S[x].labels,Object.defineProperty(S[x],"channels",{value:f}),Object.defineProperty(S[x],"labels",{value:Q})}S.rgb.hsl=function(f){const Q=f[0]/255,H=f[1]/255,X=f[2]/255,i=Math.min(Q,H,X),S=Math.max(Q,H,X),x=S-i;let K,Z;S===i?K=0:Q===S?K=(H-X)/x:H===S?K=2+(X-Q)/x:X===S&&(K=4+(Q-H)/x),K=Math.min(60*K,360),K<0&&(K+=360);const B=(i+S)/2;return Z=S===i?0:B<=.5?x/(S+i):x/(2-S-i),[K,100*Z,100*B]},S.rgb.hsv=function(f){let Q,H,X,i,S;const x=f[0]/255,K=f[1]/255,Z=f[2]/255,B=Math.max(x,K,Z),N=B-Math.min(x,K,Z),J=function(f){return(B-f)/6/N+.5};return 0===N?(i=0,S=0):(S=N/B,Q=J(x),H=J(K),X=J(Z),x===B?i=X-H:K===B?i=1/3+Q-X:Z===B&&(i=2/3+H-Q),i<0?i+=1:i>1&&(i-=1)),[360*i,100*S,100*B]},S.rgb.hwb=function(f){const Q=f[0],H=f[1];let X=f[2];const i=S.rgb.hsl(f)[0],x=1/255*Math.min(Q,Math.min(H,X));return X=1-1/255*Math.max(Q,Math.max(H,X)),[i,100*x,100*X]},S.rgb.cmyk=function(f){const Q=f[0]/255,H=f[1]/255,X=f[2]/255,i=Math.min(1-Q,1-H,1-X);return[100*((1-Q-i)/(1-i)||0),100*((1-H-i)/(1-i)||0),100*((1-X-i)/(1-i)||0),100*i]},S.rgb.keyword=function(f){const Q=i[f];if(Q)return Q;let H,S=1/0;for(const i of Object.keys(X)){const Q=X[i],Z=(K=Q,((x=f)[0]-K[0])**2+(x[1]-K[1])**2+(x[2]-K[2])**2);Z<S&&(S=Z,H=i)}var x,K;return H},S.keyword.rgb=function(f){return X[f]},S.rgb.xyz=function(f){let Q=f[0]/255,H=f[1]/255,X=f[2]/255;Q=Q>.04045?((Q+.055)/1.055)**2.4:Q/12.92,H=H>.04045?((H+.055)/1.055)**2.4:H/12.92,X=X>.04045?((X+.055)/1.055)**2.4:X/12.92;return[100*(.4124*Q+.3576*H+.1805*X),100*(.2126*Q+.7152*H+.0722*X),100*(.0193*Q+.1192*H+.9505*X)]},S.rgb.lab=function(f){const Q=S.rgb.xyz(f);let H=Q[0],X=Q[1],i=Q[2];H/=95.047,X/=100,i/=108.883,H=H>.008856?H**(1/3):7.787*H+16/116,X=X>.008856?X**(1/3):7.787*X+16/116,i=i>.008856?i**(1/3):7.787*i+16/116;return[116*X-16,500*(H-X),200*(X-i)]},S.hsl.rgb=function(f){const Q=f[0]/360,H=f[1]/100,X=f[2]/100;let i,S,x;if(0===H)return x=255*X,[x,x,x];i=X<.5?X*(1+H):X+H-X*H;const K=2*X-i,Z=[0,0,0];for(let B=0;B<3;B++)S=Q+1/3*-(B-1),S<0&&S++,S>1&&S--,x=6*S<1?K+6*(i-K)*S:2*S<1?i:3*S<2?K+(i-K)*(2/3-S)*6:K,Z[B]=255*x;return Z},S.hsl.hsv=function(f){const Q=f[0];let H=f[1]/100,X=f[2]/100,i=H;const S=Math.max(X,.01);X*=2,H*=X<=1?X:2-X,i*=S<=1?S:2-S;return[Q,100*(0===X?2*i/(S+i):2*H/(X+H)),100*((X+H)/2)]},S.hsv.rgb=function(f){const Q=f[0]/60,H=f[1]/100;let X=f[2]/100;const i=Math.floor(Q)%6,S=Q-Math.floor(Q),x=255*X*(1-H),K=255*X*(1-H*S),Z=255*X*(1-H*(1-S));switch(X*=255,i){case 0:return[X,Z,x];case 1:return[K,X,x];case 2:return[x,X,Z];case 3:return[x,K,X];case 4:return[Z,x,X];case 5:return[X,x,K]}},S.hsv.hsl=function(f){const Q=f[0],H=f[1]/100,X=f[2]/100,i=Math.max(X,.01);let S,x;x=(2-H)*X;const K=(2-H)*i;return S=H*i,S/=K<=1?K:2-K,S=S||0,x/=2,[Q,100*S,100*x]},S.hwb.rgb=function(f){const Q=f[0]/360;let H=f[1]/100,X=f[2]/100;const i=H+X;let S;i>1&&(H/=i,X/=i);const x=Math.floor(6*Q),K=1-X;S=6*Q-x,0!==(1&x)&&(S=1-S);const Z=H+S*(K-H);let B,N,J;switch(x){default:case 6:case 0:B=K,N=Z,J=H;break;case 1:B=Z,N=K,J=H;break;case 2:B=H,N=K,J=Z;break;case 3:B=H,N=Z,J=K;break;case 4:B=Z,N=H,J=K;break;case 5:B=K,N=H,J=Z}return[255*B,255*N,255*J]},S.cmyk.rgb=function(f){const Q=f[0]/100,H=f[1]/100,X=f[2]/100,i=f[3]/100;return[255*(1-Math.min(1,Q*(1-i)+i)),255*(1-Math.min(1,H*(1-i)+i)),255*(1-Math.min(1,X*(1-i)+i))]},S.xyz.rgb=function(f){const Q=f[0]/100,H=f[1]/100,X=f[2]/100;let i,S,x;return i=3.2406*Q+-1.5372*H+-.4986*X,S=-.9689*Q+1.8758*H+.0415*X,x=.0557*Q+-.204*H+1.057*X,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,S=S>.0031308?1.055*S**(1/2.4)-.055:12.92*S,x=x>.0031308?1.055*x**(1/2.4)-.055:12.92*x,i=Math.min(Math.max(0,i),1),S=Math.min(Math.max(0,S),1),x=Math.min(Math.max(0,x),1),[255*i,255*S,255*x]},S.xyz.lab=function(f){let Q=f[0],H=f[1],X=f[2];Q/=95.047,H/=100,X/=108.883,Q=Q>.008856?Q**(1/3):7.787*Q+16/116,H=H>.008856?H**(1/3):7.787*H+16/116,X=X>.008856?X**(1/3):7.787*X+16/116;return[116*H-16,500*(Q-H),200*(H-X)]},S.lab.xyz=function(f){let Q,H,X;H=(f[0]+16)/116,Q=f[1]/500+H,X=H-f[2]/200;const i=H**3,S=Q**3,x=X**3;return H=i>.008856?i:(H-16/116)/7.787,Q=S>.008856?S:(Q-16/116)/7.787,X=x>.008856?x:(X-16/116)/7.787,Q*=95.047,H*=100,X*=108.883,[Q,H,X]},S.lab.lch=function(f){const Q=f[0],H=f[1],X=f[2];let i;i=360*Math.atan2(X,H)/2/Math.PI,i<0&&(i+=360);return[Q,Math.sqrt(H*H+X*X),i]},S.lch.lab=function(f){const Q=f[0],H=f[1],X=f[2]/360*2*Math.PI;return[Q,H*Math.cos(X),H*Math.sin(X)]},S.rgb.ansi16=function(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[H,X,i]=f;let x=null===Q?S.rgb.hsv(f)[2]:Q;if(x=Math.round(x/50),0===x)return 30;let K=30+(Math.round(i/255)<<2|Math.round(X/255)<<1|Math.round(H/255));return 2===x&&(K+=60),K},S.hsv.ansi16=function(f){return S.rgb.ansi16(S.hsv.rgb(f),f[2])},S.rgb.ansi256=function(f){const Q=f[0],H=f[1],X=f[2];if(Q===H&&H===X)return Q<8?16:Q>248?231:Math.round((Q-8)/247*24)+232;return 16+36*Math.round(Q/255*5)+6*Math.round(H/255*5)+Math.round(X/255*5)},S.ansi16.rgb=function(f){let Q=f%10;if(0===Q||7===Q)return f>50&&(Q+=3.5),Q=Q/10.5*255,[Q,Q,Q];const H=.5*(1+~~(f>50));return[(1&Q)*H*255,(Q>>1&1)*H*255,(Q>>2&1)*H*255]},S.ansi256.rgb=function(f){if(f>=232){const Q=10*(f-232)+8;return[Q,Q,Q]}let Q;f-=16;return[Math.floor(f/36)/5*255,Math.floor((Q=f%36)/6)/5*255,Q%6/5*255]},S.rgb.hex=function(f){const Q=(((255&Math.round(f[0]))<<16)+((255&Math.round(f[1]))<<8)+(255&Math.round(f[2]))).toString(16).toUpperCase();return"000000".substring(Q.length)+Q},S.hex.rgb=function(f){const Q=f.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!Q)return[0,0,0];let H=Q[0];3===Q[0].length&&(H=H.split("").map((f=>f+f)).join(""));const X=parseInt(H,16);return[X>>16&255,X>>8&255,255&X]},S.rgb.hcg=function(f){const Q=f[0]/255,H=f[1]/255,X=f[2]/255,i=Math.max(Math.max(Q,H),X),S=Math.min(Math.min(Q,H),X),x=i-S;let K,Z;return K=x<1?S/(1-x):0,Z=x<=0?0:i===Q?(H-X)/x%6:i===H?2+(X-Q)/x:4+(Q-H)/x,Z/=6,Z%=1,[360*Z,100*x,100*K]},S.hsl.hcg=function(f){const Q=f[1]/100,H=f[2]/100,X=H<.5?2*Q*H:2*Q*(1-H);let i=0;return X<1&&(i=(H-.5*X)/(1-X)),[f[0],100*X,100*i]},S.hsv.hcg=function(f){const Q=f[1]/100,H=f[2]/100,X=Q*H;let i=0;return X<1&&(i=(H-X)/(1-X)),[f[0],100*X,100*i]},S.hcg.rgb=function(f){const Q=f[0]/360,H=f[1]/100,X=f[2]/100;if(0===H)return[255*X,255*X,255*X];const i=[0,0,0],S=Q%1*6,x=S%1,K=1-x;let Z=0;switch(Math.floor(S)){case 0:i[0]=1,i[1]=x,i[2]=0;break;case 1:i[0]=K,i[1]=1,i[2]=0;break;case 2:i[0]=0,i[1]=1,i[2]=x;break;case 3:i[0]=0,i[1]=K,i[2]=1;break;case 4:i[0]=x,i[1]=0,i[2]=1;break;default:i[0]=1,i[1]=0,i[2]=K}return Z=(1-H)*X,[255*(H*i[0]+Z),255*(H*i[1]+Z),255*(H*i[2]+Z)]},S.hcg.hsv=function(f){const Q=f[1]/100,H=Q+f[2]/100*(1-Q);let X=0;return H>0&&(X=Q/H),[f[0],100*X,100*H]},S.hcg.hsl=function(f){const Q=f[1]/100,H=f[2]/100*(1-Q)+.5*Q;let X=0;return H>0&&H<.5?X=Q/(2*H):H>=.5&&H<1&&(X=Q/(2*(1-H))),[f[0],100*X,100*H]},S.hcg.hwb=function(f){const Q=f[1]/100,H=Q+f[2]/100*(1-Q);return[f[0],100*(H-Q),100*(1-H)]},S.hwb.hcg=function(f){const Q=f[1]/100,H=1-f[2]/100,X=H-Q;let i=0;return X<1&&(i=(H-X)/(1-X)),[f[0],100*X,100*i]},S.apple.rgb=function(f){return[f[0]/65535*255,f[1]/65535*255,f[2]/65535*255]},S.rgb.apple=function(f){return[f[0]/255*65535,f[1]/255*65535,f[2]/255*65535]},S.gray.rgb=function(f){return[f[0]/100*255,f[0]/100*255,f[0]/100*255]},S.gray.hsl=function(f){return[0,0,f[0]]},S.gray.hsv=S.gray.hsl,S.gray.hwb=function(f){return[0,100,f[0]]},S.gray.cmyk=function(f){return[0,0,0,f[0]]},S.gray.lab=function(f){return[f[0],0,0]},S.gray.hex=function(f){const Q=255&Math.round(f[0]/100*255),H=((Q<<16)+(Q<<8)+Q).toString(16).toUpperCase();return"000000".substring(H.length)+H},S.rgb.gray=function(f){return[(f[0]+f[1]+f[2])/3/255*100]}},12205:(f,Q,H)=>{const X=H(12208),i=H(12220),S={};Object.keys(X).forEach((f=>{S[f]={},Object.defineProperty(S[f],"channels",{value:X[f].channels}),Object.defineProperty(S[f],"labels",{value:X[f].labels});const Q=i(f);Object.keys(Q).forEach((H=>{const X=Q[H];S[f][H]=function(f){const Q=function(){for(var Q=arguments.length,H=new Array(Q),X=0;X<Q;X++)H[X]=arguments[X];const i=H[0];if(void 0===i||null===i)return i;i.length>1&&(H=i);const S=f(H);if("object"===typeof S)for(let f=S.length,x=0;x<f;x++)S[x]=Math.round(S[x]);return S};return"conversion"in f&&(Q.conversion=f.conversion),Q}(X),S[f][H].raw=function(f){const Q=function(){for(var Q=arguments.length,H=new Array(Q),X=0;X<Q;X++)H[X]=arguments[X];const i=H[0];return void 0===i||null===i?i:(i.length>1&&(H=i),f(H))};return"conversion"in f&&(Q.conversion=f.conversion),Q}(X)}))})),f.exports=S},12220:(f,Q,H)=>{const X=H(12208);function i(f){const Q=function(){const f={},Q=Object.keys(X);for(let H=Q.length,X=0;X<H;X++)f[Q[X]]={distance:-1,parent:null};return f}(),H=[f];for(Q[f].distance=0;H.length;){const f=H.pop(),i=Object.keys(X[f]);for(let X=i.length,S=0;S<X;S++){const X=i[S],x=Q[X];-1===x.distance&&(x.distance=Q[f].distance+1,x.parent=f,H.unshift(X))}}return Q}function S(f,Q){return function(H){return Q(f(H))}}function x(f,Q){const H=[Q[f].parent,f];let i=X[Q[f].parent][f],x=Q[f].parent;for(;Q[x].parent;)H.unshift(Q[x].parent),i=S(X[Q[x].parent][x],i),x=Q[x].parent;return i.conversion=H,i}f.exports=function(f){const Q=i(f),H={},X=Object.keys(Q);for(let i=X.length,S=0;S<i;S++){const f=X[S];null!==Q[f].parent&&(H[f]=x(f,Q))}return H}},12217:f=>{"use strict";f.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11090:function(f,Q,H){"use strict";var X=this&&this.__createBinding||(Object.create?function(f,Q,H,X){void 0===X&&(X=H);var i=Object.getOwnPropertyDescriptor(Q,H);i&&!("get"in i?!Q.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return Q[H]}}),Object.defineProperty(f,X,i)}:function(f,Q,H,X){void 0===X&&(X=H),f[X]=Q[H]}),i=this&&this.__setModuleDefault||(Object.create?function(f,Q){Object.defineProperty(f,"default",{enumerable:!0,value:Q})}:function(f,Q){f.default=Q}),S=this&&this.__importStar||function(f){if(f&&f.__esModule)return f;var Q={};if(null!=f)for(var H in f)"default"!==H&&Object.prototype.hasOwnProperty.call(f,H)&&X(Q,f,H);return i(Q,f),Q},x=this&&this.__awaiter||function(f,Q,H,X){return new(H||(H=Promise))((function(i,S){function x(f){try{Z(X.next(f))}catch(Q){S(Q)}}function K(f){try{Z(X.throw(f))}catch(Q){S(Q)}}function Z(f){var Q;f.done?i(f.value):(Q=f.value,Q instanceof H?Q:new H((function(f){f(Q)}))).then(x,K)}Z((X=X.apply(f,Q||[])).next())}))};Object.defineProperty(Q,"__esModule",{value:!0}),Q.Auth=Q.Platform=void 0;const K=S(H(11028)),Z=H(11099),B="colyseus-auth-token";!function(f){f.ios="ios",f.android="android"}(Q.Platform||(Q.Platform={}));Q.Auth=class{constructor(f){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=f.replace("ws","http"),(0,Z.getItem)(B,(f=>this.token=f))}get hasToken(){return!!this.token}login(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return x(this,void 0,void 0,(function*(){const Q=Object.assign({},f);this.hasToken&&(Q.token=this.token);const H=yield this.request("post","/auth",Q);this.token=H.token,(0,Z.setItem)(B,this.token);for(let f in H)this.hasOwnProperty(f)&&(this[f]=H[f]);return this.registerPingService(),this}))}save(){return x(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return x(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return x(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return x(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(f){return x(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:f})}))}acceptFriendRequest(f){return x(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:f})}))}declineFriendRequest(f){return x(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:f})}))}blockUser(f){return x(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:f})}))}unblockUser(f){return x(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:f})}))}request(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},X=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return x(this,void 0,void 0,(function*(){i.Accept="application/json",this.hasToken&&(i.Authorization="Bearer "+this.token);const S=[];for(const f in H)S.push(`${f}=${H[f]}`);const x=S.length>0?`?${S.join("&")}`:"",Z={headers:i};return X&&(Z.body=X),(yield K[f](`${this.endpoint}${Q}${x}`,Z)).data}))}logout(){this.token=void 0,(0,Z.removeItem)(B),this.unregisterPingService()}registerPingService(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),f)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11022:function(f,Q,H){"use strict";var X,i=this&&this.__awaiter||function(f,Q,H,X){return new(H||(H=Promise))((function(i,S){function x(f){try{Z(X.next(f))}catch(Q){S(Q)}}function K(f){try{Z(X.throw(f))}catch(Q){S(Q)}}function Z(f){var Q;f.done?i(f.value):(Q=f.value,Q instanceof H?Q:new H((function(f){f(Q)}))).then(x,K)}Z((X=X.apply(f,Q||[])).next())}))};Object.defineProperty(Q,"__esModule",{value:!0}),Q.Client=Q.MatchMakeError=void 0;const S=H(11028),x=H(11035),K=H(11037);class Z extends Error{constructor(f,Q){super(f),this.code=Q,Object.setPrototypeOf(this,Z.prototype)}}Q.MatchMakeError=Z;const B="undefined"!==typeof window&&"undefined"!==typeof(null===(X=null===window||void 0===window?void 0:window.location)||void 0===X?void 0:X.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";Q.Client=class{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B;if("string"===typeof f){const Q=new URL(f),H="https:"===Q.protocol||"wss:"===Q.protocol,X=Number(Q.port||(H?443:80));this.settings={hostname:Q.hostname,pathname:"/"!==Q.pathname?Q.pathname:"",port:X,secure:H}}else void 0===f.port&&(f.port=f.secure?443:80),void 0===f.pathname&&(f.pathname=""),this.settings=f}joinOrCreate(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return i(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",f,Q,H)}))}create(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return i(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",f,Q,H)}))}join(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return i(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",f,Q,H)}))}joinById(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return i(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",f,Q,H)}))}reconnect(f,Q){return i(this,void 0,void 0,(function*(){if("string"===typeof f&&"string"===typeof Q)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[H,X]=f.split(":");return yield this.createMatchMakeRequest("reconnect",H,{reconnectionToken:X},Q)}))}getAvailableRooms(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return i(this,void 0,void 0,(function*(){return(yield(0,S.get)(this.getHttpEndpoint(`${f}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(f,Q,H){return i(this,void 0,void 0,(function*(){const X=this.createRoom(f.room.name,Q);X.roomId=f.room.roomId,X.sessionId=f.sessionId;const S={sessionId:X.sessionId};f.reconnectionToken&&(S.reconnectionToken=f.reconnectionToken);const K=H||X;return X.connect(this.buildEndpoint(f.room,S),f.devMode&&(()=>i(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${X.roomId}'...`);let H=0;const S=()=>i(this,void 0,void 0,(function*(){H++;try{yield this.consumeSeatReservation(f,Q,K),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${X.roomId}'`)}catch(i){H<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${H} out of 8)`),setTimeout(S,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(S,2e3)}))),K),new Promise(((f,Q)=>{const H=(f,H)=>Q(new x.ServerError(f,H));K.onError.once(H),K.onJoin.once((()=>{K.onError.remove(H),f(K)}))}))}))}createMatchMakeRequest(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},X=arguments.length>3?arguments[3]:void 0,x=arguments.length>4?arguments[4]:void 0;return i(this,void 0,void 0,(function*(){const i=(yield(0,S.post)(this.getHttpEndpoint(`${f}/${Q}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(H)})).data;if(i.error)throw new Z(i.error,i.code);return"reconnect"===f&&(i.reconnectionToken=H.reconnectionToken),yield this.consumeSeatReservation(i,X,x)}))}createRoom(f,Q){return new K.Room(f,Q)}buildEndpoint(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const H=[];for(const i in Q)Q.hasOwnProperty(i)&&H.push(`${i}=${Q[i]}`);let X=this.settings.secure?"wss://":"ws://";return f.publicAddress?X+=`${f.publicAddress}`:X+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${X}/${f.processId}/${f.roomId}?${H.join("&")}`}getHttpEndpoint(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${f}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11044:(f,Q,H)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Connection=void 0;const X=H(11053);Q.Connection=class{constructor(){this.events={},this.transport=new X.WebSocketTransport(this.events)}send(f){this.transport.send(f)}connect(f){this.transport.connect(f)}close(f,Q){this.transport.close(f,Q)}get isOpen(){return this.transport.isOpen}}},11061:(f,Q)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.utf8Length=Q.utf8Read=Q.ErrorCode=Q.Protocol=void 0,function(f){f[f.HANDSHAKE=9]="HANDSHAKE",f[f.JOIN_ROOM=10]="JOIN_ROOM",f[f.ERROR=11]="ERROR",f[f.LEAVE_ROOM=12]="LEAVE_ROOM",f[f.ROOM_DATA=13]="ROOM_DATA",f[f.ROOM_STATE=14]="ROOM_STATE",f[f.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",f[f.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",f[f.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(Q.Protocol||(Q.Protocol={})),function(f){f[f.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",f[f.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",f[f.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",f[f.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",f[f.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",f[f.AUTH_FAILED=4215]="AUTH_FAILED",f[f.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(Q.ErrorCode||(Q.ErrorCode={})),Q.utf8Read=function(f,Q){const H=f[Q++];for(var X="",i=0,S=Q,x=Q+H;S<x;S++){var K=f[S];if(0!==(128&K))if(192!==(224&K))if(224!==(240&K)){if(240!==(248&K))throw new Error("Invalid byte "+K.toString(16));(i=(7&K)<<18|(63&f[++S])<<12|(63&f[++S])<<6|63&f[++S])>=65536?(i-=65536,X+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):X+=String.fromCharCode(i)}else X+=String.fromCharCode((15&K)<<12|(63&f[++S])<<6|63&f[++S]);else X+=String.fromCharCode((31&K)<<6|63&f[++S]);else X+=String.fromCharCode(K)}return X},Q.utf8Length=function(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",Q=0,H=0;for(let X=0,i=f.length;X<i;X++)Q=f.charCodeAt(X),Q<128?H+=1:Q<2048?H+=2:Q<55296||Q>=57344?H+=3:(X++,H+=4);return H+1}},11037:function(f,Q,H){"use strict";var X=this&&this.__createBinding||(Object.create?function(f,Q,H,X){void 0===X&&(X=H);var i=Object.getOwnPropertyDescriptor(Q,H);i&&!("get"in i?!Q.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return Q[H]}}),Object.defineProperty(f,X,i)}:function(f,Q,H,X){void 0===X&&(X=H),f[X]=Q[H]}),i=this&&this.__setModuleDefault||(Object.create?function(f,Q){Object.defineProperty(f,"default",{enumerable:!0,value:Q})}:function(f,Q){f.default=Q}),S=this&&this.__importStar||function(f){if(f&&f.__esModule)return f;var Q={};if(null!=f)for(var H in f)"default"!==H&&Object.prototype.hasOwnProperty.call(f,H)&&X(Q,f,H);return i(Q,f),Q};Object.defineProperty(Q,"__esModule",{value:!0}),Q.Room=void 0;const x=S(H(11039)),K=H(11044),Z=H(11061),B=H(11066),N=H(11073),J=H(11077),g=H(11085),z=H(11035);class v{constructor(f,Q){this.onStateChange=(0,J.createSignal)(),this.onError=(0,J.createSignal)(),this.onLeave=(0,J.createSignal)(),this.onJoin=(0,J.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,N.createNanoEvents)(),this.roomId=null,this.name=f,Q&&(this.serializer=new((0,B.getSerializer)("schema")),this.rootSchema=Q,this.serializer.state=new Q),this.onError(((f,Q)=>{var H;return null===(H=console.warn)||void 0===H?void 0:H.call(console,`colyseus.js - onError => (${f}) ${Q}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const X=new K.Connection;H.connection=X,X.events.onmessage=v.prototype.onMessageCallback.bind(H),X.events.onclose=function(f){var X;if(!H.hasJoined)return null===(X=console.warn)||void 0===X||X.call(console,`Room connection was closed unexpectedly (${f.code}): ${f.reason}`),void H.onError.invoke(f.code,f.reason);f.code===z.CloseCode.DEVMODE_RESTART&&Q?Q():(H.onLeave.invoke(f.code),H.destroy())},X.events.onerror=function(f){var Q;null===(Q=console.warn)||void 0===Q||Q.call(console,`Room, onError (${f.code}): ${f.reason}`),H.onError.invoke(f.code,f.reason)},X.connect(f)}leave(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((Q=>{this.onLeave((f=>Q(f))),this.connection?f?this.connection.send([Z.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(z.CloseCode.CONSENTED)}))}onMessage(f,Q){return this.onMessageHandlers.on(this.getMessageHandlerKey(f),Q)}send(f,Q){const H=[Z.Protocol.ROOM_DATA];let X;if("string"===typeof f?g.encode.string(H,f):g.encode.number(H,f),void 0!==Q){const f=x.encode(Q);X=new Uint8Array(H.length+f.byteLength),X.set(new Uint8Array(H),0),X.set(new Uint8Array(f),H.length)}else X=new Uint8Array(H);this.connection.send(X.buffer)}sendBytes(f,Q){const H=[Z.Protocol.ROOM_DATA_BYTES];let X;"string"===typeof f?g.encode.string(H,f):g.encode.number(H,f),X=new Uint8Array(H.length+(Q.byteLength||Q.length)),X.set(new Uint8Array(H),0),X.set(new Uint8Array(Q),H.length),this.connection.send(X.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(f){const Q=Array.from(new Uint8Array(f.data)),H=Q[0];if(H===Z.Protocol.JOIN_ROOM){let f=1;const H=(0,Z.utf8Read)(Q,f);if(f+=(0,Z.utf8Length)(H),this.serializerId=(0,Z.utf8Read)(Q,f),f+=(0,Z.utf8Length)(this.serializerId),!this.serializer){const f=(0,B.getSerializer)(this.serializerId);this.serializer=new f}Q.length>f&&this.serializer.handshake&&this.serializer.handshake(Q,{offset:f}),this.reconnectionToken=`${this.roomId}:${H}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([Z.Protocol.JOIN_ROOM])}else if(H===Z.Protocol.ERROR){const f={offset:1},H=g.decode.number(Q,f),X=g.decode.string(Q,f);this.onError.invoke(H,X)}else if(H===Z.Protocol.LEAVE_ROOM)this.leave();else if(H===Z.Protocol.ROOM_DATA_SCHEMA){const f={offset:1},H=this.serializer.getState().constructor._context.get(g.decode.number(Q,f)),X=new H;X.decode(Q,f),this.dispatchMessage(H,X)}else if(H===Z.Protocol.ROOM_STATE)Q.shift(),this.setState(Q);else if(H===Z.Protocol.ROOM_STATE_PATCH)Q.shift(),this.patch(Q);else if(H===Z.Protocol.ROOM_DATA){const H={offset:1},X=g.decode.stringCheck(Q,H)?g.decode.string(Q,H):g.decode.number(Q,H),i=Q.length>H.offset?x.decode(f.data,H.offset):void 0;this.dispatchMessage(X,i)}else if(H===Z.Protocol.ROOM_DATA_BYTES){const f={offset:1},H=g.decode.stringCheck(Q,f)?g.decode.string(Q,f):g.decode.number(Q,f);this.dispatchMessage(H,new Uint8Array(Q.slice(f.offset)))}}setState(f){this.serializer.setState(f),this.onStateChange.invoke(this.serializer.getState())}patch(f){this.serializer.patch(f),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(f,Q){var H;const X=this.getMessageHandlerKey(f);this.onMessageHandlers.events[X]?this.onMessageHandlers.emit(X,Q):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",f,Q):null===(H=console.warn)||void 0===H||H.call(console,`colyseus.js: onMessage() not registered for type '${f}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(f){switch(typeof f){case"function":return`$${f._typeid}`;case"string":return f;case"number":return`i${f}`;default:throw new Error("invalid message type.")}}}Q.Room=v},11099:(f,Q)=>{"use strict";let H;function X(){return H||(H="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(f,Q){this.cache[f]=Q},getItem:function(f){this.cache[f]},removeItem:function(f){delete this.cache[f]}}),H}Object.defineProperty(Q,"__esModule",{value:!0}),Q.getItem=Q.removeItem=Q.setItem=void 0,Q.setItem=function(f,Q){X().setItem(f,Q)},Q.removeItem=function(f){X().removeItem(f)},Q.getItem=function(f,Q){const H=X().getItem(f);"undefined"!==typeof Promise&&H instanceof Promise?H.then((f=>Q(f))):Q(H)}},11073:(f,Q)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.createNanoEvents=void 0;Q.createNanoEvents=()=>({emit(f){let Q=this.events[f]||[];for(var H=arguments.length,X=new Array(H>1?H-1:0),i=1;i<H;i++)X[i-1]=arguments[i];for(let S=0,x=Q.length;S<x;S++)Q[S](...X)},events:{},on(f,Q){var H;return(null===(H=this.events[f])||void 0===H?void 0:H.push(Q))||(this.events[f]=[Q]),()=>{var H;this.events[f]=null===(H=this.events[f])||void 0===H?void 0:H.filter((f=>Q!==f))}}})},11077:(f,Q)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.createSignal=Q.EventEmitter=void 0;class H{constructor(){this.handlers=[]}register(f){return this.handlers.push(f),this}invoke(){for(var f=arguments.length,Q=new Array(f),H=0;H<f;H++)Q[H]=arguments[H];this.handlers.forEach((f=>f.apply(this,Q)))}invokeAsync(){for(var f=arguments.length,Q=new Array(f),H=0;H<f;H++)Q[H]=arguments[H];return Promise.all(this.handlers.map((f=>f.apply(this,Q))))}remove(f){const Q=this.handlers.indexOf(f);this.handlers[Q]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}Q.EventEmitter=H,Q.createSignal=function(){const f=new H;function Q(Q){return f.register(Q,null===this)}return Q.once=Q=>{const H=function(){for(var X=arguments.length,i=new Array(X),S=0;S<X;S++)i[S]=arguments[S];Q.apply(this,i),f.remove(H)};f.register(H)},Q.remove=Q=>f.remove(Q),Q.invoke=function(){return f.invoke(...arguments)},Q.invokeAsync=function(){return f.invokeAsync(...arguments)},Q.clear=()=>f.clear(),Q}},11035:(f,Q)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.ServerError=Q.CloseCode=void 0,function(f){f[f.CONSENTED=4e3]="CONSENTED",f[f.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(Q.CloseCode||(Q.CloseCode={}));class H extends Error{constructor(f,Q){super(Q),this.name="ServerError",this.code=f}}Q.ServerError=H},11009:(f,Q,H)=>{"use strict";Q.c=void 0,H(11014);var X=H(11022);Object.defineProperty(Q,"c",{enumerable:!0,get:function(){return X.Client}});var i=H(11061);var S=H(11037);var x=H(11090);const K=H(11105);const Z=H(11107),B=H(11066);(0,B.registerSerializer)("schema",K.SchemaSerializer),(0,B.registerSerializer)("none",Z.NoneSerializer)},11014:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=f=>null!==f&&"object"===typeof f&&f.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11039:(f,Q)=>{"use strict";function H(f,Q){if(this._offset=Q,f instanceof ArrayBuffer)this._buffer=f,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(f))throw new Error("Invalid argument");this._buffer=f.buffer,this._view=new DataView(this._buffer,f.byteOffset,f.byteLength)}}Object.defineProperty(Q,"__esModule",{value:!0}),Q.decode=Q.encode=void 0,H.prototype._array=function(f){for(var Q=new Array(f),H=0;H<f;H++)Q[H]=this._parse();return Q},H.prototype._map=function(f){for(var Q={},H=0;H<f;H++)Q[this._parse()]=this._parse();return Q},H.prototype._str=function(f){var Q=function(f,Q,H){for(var X="",i=0,S=Q,x=Q+H;S<x;S++){var K=f.getUint8(S);if(0!==(128&K))if(192!==(224&K))if(224!==(240&K)){if(240!==(248&K))throw new Error("Invalid byte "+K.toString(16));(i=(7&K)<<18|(63&f.getUint8(++S))<<12|(63&f.getUint8(++S))<<6|63&f.getUint8(++S))>=65536?(i-=65536,X+=String.fromCharCode(55296+(i>>>10),56320+(1023&i))):X+=String.fromCharCode(i)}else X+=String.fromCharCode((15&K)<<12|(63&f.getUint8(++S))<<6|63&f.getUint8(++S));else X+=String.fromCharCode((31&K)<<6|63&f.getUint8(++S));else X+=String.fromCharCode(K)}return X}(this._view,this._offset,f);return this._offset+=f,Q},H.prototype._bin=function(f){var Q=this._buffer.slice(this._offset,this._offset+f);return this._offset+=f,Q},H.prototype._parse=function(){var f,Q=this._view.getUint8(this._offset++),H=0,X=0,i=0,S=0;if(Q<192)return Q<128?Q:Q<144?this._map(15&Q):Q<160?this._array(15&Q):this._str(31&Q);if(Q>223)return-1*(255-Q+1);switch(Q){case 192:return null;case 194:return!1;case 195:return!0;case 196:return H=this._view.getUint8(this._offset),this._offset+=1,this._bin(H);case 197:return H=this._view.getUint16(this._offset),this._offset+=2,this._bin(H);case 198:return H=this._view.getUint32(this._offset),this._offset+=4,this._bin(H);case 199:if(H=this._view.getUint8(this._offset),X=this._view.getInt8(this._offset+1),this._offset+=2,-1===X){var x=this._view.getUint32(this._offset);return i=this._view.getInt32(this._offset+4),S=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*i+S)+x/1e6)}return[X,this._bin(H)];case 200:return H=this._view.getUint16(this._offset),X=this._view.getInt8(this._offset+2),this._offset+=3,[X,this._bin(H)];case 201:return H=this._view.getUint32(this._offset),X=this._view.getInt8(this._offset+4),this._offset+=5,[X,this._bin(H)];case 202:return f=this._view.getFloat32(this._offset),this._offset+=4,f;case 203:return f=this._view.getFloat64(this._offset),this._offset+=8,f;case 204:return f=this._view.getUint8(this._offset),this._offset+=1,f;case 205:return f=this._view.getUint16(this._offset),this._offset+=2,f;case 206:return f=this._view.getUint32(this._offset),this._offset+=4,f;case 207:return i=this._view.getUint32(this._offset)*Math.pow(2,32),S=this._view.getUint32(this._offset+4),this._offset+=8,i+S;case 208:return f=this._view.getInt8(this._offset),this._offset+=1,f;case 209:return f=this._view.getInt16(this._offset),this._offset+=2,f;case 210:return f=this._view.getInt32(this._offset),this._offset+=4,f;case 211:return i=this._view.getInt32(this._offset)*Math.pow(2,32),S=this._view.getUint32(this._offset+4),this._offset+=8,i+S;case 212:return X=this._view.getInt8(this._offset),this._offset+=1,0===X?void(this._offset+=1):[X,this._bin(1)];case 213:return X=this._view.getInt8(this._offset),this._offset+=1,[X,this._bin(2)];case 214:return X=this._view.getInt8(this._offset),this._offset+=1,-1===X?(f=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*f)):[X,this._bin(4)];case 215:return X=this._view.getInt8(this._offset),this._offset+=1,0===X?(i=this._view.getInt32(this._offset)*Math.pow(2,32),S=this._view.getUint32(this._offset+4),this._offset+=8,new Date(i+S)):-1===X?(i=this._view.getUint32(this._offset),S=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&i)+S)+(i>>>2)/1e6)):[X,this._bin(8)];case 216:return X=this._view.getInt8(this._offset),this._offset+=1,[X,this._bin(16)];case 217:return H=this._view.getUint8(this._offset),this._offset+=1,this._str(H);case 218:return H=this._view.getUint16(this._offset),this._offset+=2,this._str(H);case 219:return H=this._view.getUint32(this._offset),this._offset+=4,this._str(H);case 220:return H=this._view.getUint16(this._offset),this._offset+=2,this._array(H);case 221:return H=this._view.getUint32(this._offset),this._offset+=4,this._array(H);case 222:return H=this._view.getUint16(this._offset),this._offset+=2,this._map(H);case 223:return H=this._view.getUint32(this._offset),this._offset+=4,this._map(H)}throw new Error("Could not parse")},Q.decode=function(f){var Q=new H(f,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),X=Q._parse();if(Q._offset!==f.byteLength)throw new Error(f.byteLength-Q._offset+" trailing bytes");return X};function X(f,Q,H){for(var X=0,i=0,S=H.length;i<S;i++)(X=H.charCodeAt(i))<128?f.setUint8(Q++,X):X<2048?(f.setUint8(Q++,192|X>>6),f.setUint8(Q++,128|63&X)):X<55296||X>=57344?(f.setUint8(Q++,224|X>>12),f.setUint8(Q++,128|X>>6&63),f.setUint8(Q++,128|63&X)):(i++,X=65536+((1023&X)<<10|1023&H.charCodeAt(i)),f.setUint8(Q++,240|X>>18),f.setUint8(Q++,128|X>>12&63),f.setUint8(Q++,128|X>>6&63),f.setUint8(Q++,128|63&X))}function i(f,Q,H){var X=typeof H,S=0,x=0,K=0,Z=0,B=0,N=0;if("string"===X){if(B=function(f){for(var Q=0,H=0,X=0,i=f.length;X<i;X++)(Q=f.charCodeAt(X))<128?H+=1:Q<2048?H+=2:Q<55296||Q>=57344?H+=3:(X++,H+=4);return H}(H),B<32)f.push(160|B),N=1;else if(B<256)f.push(217,B),N=2;else if(B<65536)f.push(218,B>>8,B),N=3;else{if(!(B<4294967296))throw new Error("String too long");f.push(219,B>>24,B>>16,B>>8,B),N=5}return Q.push({_str:H,_length:B,_offset:f.length}),N+B}if("number"===X)return Math.floor(H)===H&&isFinite(H)?H>=0?H<128?(f.push(H),1):H<256?(f.push(204,H),2):H<65536?(f.push(205,H>>8,H),3):H<4294967296?(f.push(206,H>>24,H>>16,H>>8,H),5):(K=H/Math.pow(2,32)|0,Z=H>>>0,f.push(207,K>>24,K>>16,K>>8,K,Z>>24,Z>>16,Z>>8,Z),9):H>=-32?(f.push(H),1):H>=-128?(f.push(208,H),2):H>=-32768?(f.push(209,H>>8,H),3):H>=-2147483648?(f.push(210,H>>24,H>>16,H>>8,H),5):(K=Math.floor(H/Math.pow(2,32)),Z=H>>>0,f.push(211,K>>24,K>>16,K>>8,K,Z>>24,Z>>16,Z>>8,Z),9):(f.push(203),Q.push({_float:H,_length:8,_offset:f.length}),9);if("object"===X){if(null===H)return f.push(192),1;if(Array.isArray(H)){if((B=H.length)<16)f.push(144|B),N=1;else if(B<65536)f.push(220,B>>8,B),N=3;else{if(!(B<4294967296))throw new Error("Array too large");f.push(221,B>>24,B>>16,B>>8,B),N=5}for(S=0;S<B;S++)N+=i(f,Q,H[S]);return N}if(H instanceof Date){var J=H.getTime(),g=Math.floor(J/1e3),z=1e6*(J-1e3*g);return g>=0&&z>=0&&g<=17179869183?0===z&&g<=4294967295?(f.push(214,255,g>>24,g>>16,g>>8,g),6):(K=g/4294967296,Z=4294967295&g,f.push(215,255,z>>22,z>>14,z>>6,K,Z>>24,Z>>16,Z>>8,Z),10):(K=Math.floor(g/4294967296),Z=g>>>0,f.push(199,12,255,z>>24,z>>16,z>>8,z,K>>24,K>>16,K>>8,K,Z>>24,Z>>16,Z>>8,Z),15)}if(H instanceof ArrayBuffer){if((B=H.byteLength)<256)f.push(196,B),N=2;else if(B<65536)f.push(197,B>>8,B),N=3;else{if(!(B<4294967296))throw new Error("Buffer too large");f.push(198,B>>24,B>>16,B>>8,B),N=5}return Q.push({_bin:H,_length:B,_offset:f.length}),N+B}if("function"===typeof H.toJSON)return i(f,Q,H.toJSON());var v=[],Y="",O=Object.keys(H);for(S=0,x=O.length;S<x;S++)void 0!==H[Y=O[S]]&&"function"!==typeof H[Y]&&v.push(Y);if((B=v.length)<16)f.push(128|B),N=1;else if(B<65536)f.push(222,B>>8,B),N=3;else{if(!(B<4294967296))throw new Error("Object too large");f.push(223,B>>24,B>>16,B>>8,B),N=5}for(S=0;S<B;S++)N+=i(f,Q,Y=v[S]),N+=i(f,Q,H[Y]);return N}if("boolean"===X)return f.push(H?195:194),1;if("undefined"===X)return f.push(192),1;if("function"===typeof H.toJSON)return i(f,Q,H.toJSON());throw new Error("Could not encode")}Q.encode=function(f){var Q=[],H=[],S=i(Q,H,f),x=new ArrayBuffer(S),K=new DataView(x),Z=0,B=0,N=-1;H.length>0&&(N=H[0]._offset);for(var J,g=0,z=0,v=0,Y=Q.length;v<Y;v++)if(K.setUint8(B+v,Q[v]),v+1===N){if(g=(J=H[Z])._length,z=B+N,J._bin)for(var O=new Uint8Array(J._bin),n=0;n<g;n++)K.setUint8(z+n,O[n]);else J._str?X(K,z,J._str):void 0!==J._float&&K.setFloat64(z,J._float);B+=g,H[++Z]&&(N=H[Z]._offset)}return x}},11107:(f,Q)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.NoneSerializer=void 0;Q.NoneSerializer=class{setState(f){}getState(){return null}patch(f){}teardown(){}handshake(f){}}},11105:(f,Q,H)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.SchemaSerializer=void 0;const X=H(11085);Q.SchemaSerializer=class{setState(f){return this.state.decode(f)}getState(){return this.state}patch(f){return this.state.decode(f)}teardown(){var f,Q;null===(Q=null===(f=this.state)||void 0===f?void 0:f.$changes)||void 0===Q||Q.root.clearRefs()}handshake(f,Q){if(this.state){(new X.Reflection).decode(f,Q)}else this.state=X.Reflection.decode(f,Q)}}},11066:(f,Q)=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.getSerializer=Q.registerSerializer=void 0;const H={};Q.registerSerializer=function(f,Q){H[f]=Q},Q.getSerializer=function(f){const Q=H[f];if(!Q)throw new Error("missing serializer: "+f);return Q}},11053:function(f,Q,H){"use strict";var X=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(Q,"__esModule",{value:!0}),Q.WebSocketTransport=void 0;const i=X(H(11057)),S=globalThis.WebSocket||i.default;Q.WebSocketTransport=class{constructor(f){this.events=f}send(f){f instanceof ArrayBuffer?this.ws.send(f):Array.isArray(f)&&this.ws.send(new Uint8Array(f).buffer)}connect(f){this.ws=new S(f,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(f,Q){this.ws.close(f,Q)}get isOpen(){return this.ws.readyState===S.OPEN}}},11057:f=>{"use strict";f.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},11155:f=>{"use strict";f.exports=function(f){for(var Q=new Array(f),H=0;H<f;++H)Q[H]=H;return Q}},11157:f=>{function Q(f){return!!f.constructor&&"function"===typeof f.constructor.isBuffer&&f.constructor.isBuffer(f)}f.exports=function(f){return null!=f&&(Q(f)||function(f){return"function"===typeof f.readFloatLE&&"function"===typeof f.slice&&Q(f.slice(0,0))}(f)||!!f._isBuffer)}},11153:(f,Q,H)=>{var X=H(11155),i=H(11157),S="undefined"!==typeof Float64Array;function x(f,Q){return f[0]-Q[0]}function K(){var f,Q=this.stride,H=new Array(Q.length);for(f=0;f<H.length;++f)H[f]=[Math.abs(Q[f]),f];H.sort(x);var X=new Array(H.length);for(f=0;f<X.length;++f)X[f]=H[f][1];return X}function Z(f,Q){var H=["View",Q,"d",f].join("");Q<0&&(H="View_Nil"+f);var i="generic"===f;if(-1===Q){var S="function "+H+"(a){this.data=a;};var proto="+H+".prototype;proto.dtype='"+f+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+H+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+H+"(a){return new "+H+"(a);}";return new Function(S)()}if(0===Q){S="function "+H+"(a,d) {this.data = a;this.offset = d};var proto="+H+".prototype;proto.dtype='"+f+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+H+"_copy() {return new "+H+"(this.data,this.offset)};proto.pick=function "+H+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+H+"_get(){return "+(i?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+H+"_set(v){return "+(i?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+H+"(a,b,c,d){return new "+H+"(a,d)}";return new Function("TrivialArray",S)(B[f][0])}S=["'use strict'"];var x=X(Q),Z=x.map((function(f){return"i"+f})),N="this.offset+"+x.map((function(f){return"this.stride["+f+"]*i"+f})).join("+"),J=x.map((function(f){return"b"+f})).join(","),g=x.map((function(f){return"c"+f})).join(",");S.push("function "+H+"(a,"+J+","+g+",d){this.data=a","this.shape=["+J+"]","this.stride=["+g+"]","this.offset=d|0}","var proto="+H+".prototype","proto.dtype='"+f+"'","proto.dimension="+Q),S.push("Object.defineProperty(proto,'size',{get:function "+H+"_size(){return "+x.map((function(f){return"this.shape["+f+"]"})).join("*"),"}})"),1===Q?S.push("proto.order=[0]"):(S.push("Object.defineProperty(proto,'order',{get:"),Q<4?(S.push("function "+H+"_order(){"),2===Q?S.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===Q&&S.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):S.push("ORDER})")),S.push("proto.set=function "+H+"_set("+Z.join(",")+",v){"),i?S.push("return this.data.set("+N+",v)}"):S.push("return this.data["+N+"]=v}"),S.push("proto.get=function "+H+"_get("+Z.join(",")+"){"),i?S.push("return this.data.get("+N+")}"):S.push("return this.data["+N+"]}"),S.push("proto.index=function "+H+"_index(",Z.join(),"){return "+N+"}"),S.push("proto.hi=function "+H+"_hi("+Z.join(",")+"){return new "+H+"(this.data,"+x.map((function(f){return["(typeof i",f,"!=='number'||i",f,"<0)?this.shape[",f,"]:i",f,"|0"].join("")})).join(",")+","+x.map((function(f){return"this.stride["+f+"]"})).join(",")+",this.offset)}");var z=x.map((function(f){return"a"+f+"=this.shape["+f+"]"})),v=x.map((function(f){return"c"+f+"=this.stride["+f+"]"}));S.push("proto.lo=function "+H+"_lo("+Z.join(",")+"){var b=this.offset,d=0,"+z.join(",")+","+v.join(","));for(var Y=0;Y<Q;++Y)S.push("if(typeof i"+Y+"==='number'&&i"+Y+">=0){d=i"+Y+"|0;b+=c"+Y+"*d;a"+Y+"-=d}");S.push("return new "+H+"(this.data,"+x.map((function(f){return"a"+f})).join(",")+","+x.map((function(f){return"c"+f})).join(",")+",b)}"),S.push("proto.step=function "+H+"_step("+Z.join(",")+"){var "+x.map((function(f){return"a"+f+"=this.shape["+f+"]"})).join(",")+","+x.map((function(f){return"b"+f+"=this.stride["+f+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(Y=0;Y<Q;++Y)S.push("if(typeof i"+Y+"==='number'){d=i"+Y+"|0;if(d<0){c+=b"+Y+"*(a"+Y+"-1);a"+Y+"=ceil(-a"+Y+"/d)}else{a"+Y+"=ceil(a"+Y+"/d)}b"+Y+"*=d}");S.push("return new "+H+"(this.data,"+x.map((function(f){return"a"+f})).join(",")+","+x.map((function(f){return"b"+f})).join(",")+",c)}");var O=new Array(Q),n=new Array(Q);for(Y=0;Y<Q;++Y)O[Y]="a[i"+Y+"]",n[Y]="b[i"+Y+"]";S.push("proto.transpose=function "+H+"_transpose("+Z+"){"+Z.map((function(f,Q){return f+"=("+f+"===undefined?"+Q+":"+f+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+H+"(this.data,"+O.join(",")+","+n.join(",")+",this.offset)}"),S.push("proto.pick=function "+H+"_pick("+Z+"){var a=[],b=[],c=this.offset");for(Y=0;Y<Q;++Y)S.push("if(typeof i"+Y+"==='number'&&i"+Y+">=0){c=(c+this.stride["+Y+"]*i"+Y+")|0}else{a.push(this.shape["+Y+"]);b.push(this.stride["+Y+"])}");return S.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),S.push("return function construct_"+H+"(data,shape,stride,offset){return new "+H+"(data,"+x.map((function(f){return"shape["+f+"]"})).join(",")+","+x.map((function(f){return"stride["+f+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",S.join("\n"))(B[f],K)}var B={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};f.exports=function(f,Q,H,X){if(void 0===f)return(0,B.array[0])([]);"number"===typeof f&&(f=[f]),void 0===Q&&(Q=[f.length]);var x=Q.length;if(void 0===H){H=new Array(x);for(var K=x-1,N=1;K>=0;--K)H[K]=N,N*=Q[K]}if(void 0===X){X=0;for(K=0;K<x;++K)H[K]<0&&(X-=(Q[K]-1)*H[K])}for(var J=function(f){if(i(f))return"buffer";if(S)switch(Object.prototype.toString.call(f)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(f)?"array":"generic"}(f),g=B[J];g.length<=x+1;)g.push(Z(J,g.length-1));return(0,g[x+1])(f,Q,H,X)}},11122:f=>{var Q;self,Q=()=>(()=>{"use strict";var f={d:(Q,H)=>{for(var X in H)f.o(H,X)&&!f.o(Q,X)&&Object.defineProperty(Q,X,{enumerable:!0,get:H[X]})},o:(f,Q)=>Object.prototype.hasOwnProperty.call(f,Q)},Q={};f.d(Q,{default:()=>U});var H,X=function(f,Q){var H=Q.x-f.x,X=Q.y-f.y;return Math.sqrt(H*H+X*X)},i=function(f){return f*(Math.PI/180)},S=new Map,x=function(f){S.has(f)&&clearTimeout(S.get(f)),S.set(f,setTimeout(f,100))},K=function(f,Q,H){for(var X,i=Q.split(/[ ,]+/g),S=0;S<i.length;S+=1)X=i[S],f.addEventListener?f.addEventListener(X,H,!1):f.attachEvent&&f.attachEvent(X,H)},Z=function(f,Q,H){for(var X,i=Q.split(/[ ,]+/g),S=0;S<i.length;S+=1)X=i[S],f.removeEventListener?f.removeEventListener(X,H):f.detachEvent&&f.detachEvent(X,H)},B=function(f){return f.preventDefault(),f.type.match(/^touch/)?f.changedTouches:f},N=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},J=function(f,Q){Q.top||Q.right||Q.bottom||Q.left?(f.style.top=Q.top,f.style.right=Q.right,f.style.bottom=Q.bottom,f.style.left=Q.left):(f.style.left=Q.x+"px",f.style.top=Q.y+"px")},g=function(f,Q,H){var X=z(f);for(var i in X)if(X.hasOwnProperty(i))if("string"==typeof Q)X[i]=Q+" "+H;else{for(var S="",x=0,K=Q.length;x<K;x+=1)S+=Q[x]+" "+H+", ";X[i]=S.slice(0,-2)}return X},z=function(f){var Q={};return Q[f]="",["webkit","Moz","o"].forEach((function(H){Q[H+f.charAt(0).toUpperCase()+f.slice(1)]=""})),Q},v=function(f,Q){for(var H in Q)Q.hasOwnProperty(H)&&(f[H]=Q[H]);return f},Y=function(f,Q){if(f.length)for(var H=0,X=f.length;H<X;H+=1)Q(f[H]);else Q(f)},O="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,n=window.matchMedia("(any-hover: none)").matches,e=!!("ontouchstart"in window),G=!!window.PointerEvent,I=!!window.MSPointerEvent,l={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},q={start:"mousedown",move:"mousemove",end:"mouseup"},D={};function d(){}O&&!n?H=l:G?H={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:I?H={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:e?(H=l,D=q):H=q,d.prototype.on=function(f,Q){var H,X=this,i=f.split(/[ ,]+/g);X._handlers_=X._handlers_||{};for(var S=0;S<i.length;S+=1)H=i[S],X._handlers_[H]=X._handlers_[H]||[],X._handlers_[H].push(Q);return X},d.prototype.off=function(f,Q){var H=this;return H._handlers_=H._handlers_||{},void 0===f?H._handlers_={}:void 0===Q?H._handlers_[f]=null:H._handlers_[f]&&H._handlers_[f].indexOf(Q)>=0&&H._handlers_[f].splice(H._handlers_[f].indexOf(Q),1),H},d.prototype.trigger=function(f,Q){var H,X=this,i=f.split(/[ ,]+/g);X._handlers_=X._handlers_||{};for(var S=0;S<i.length;S+=1)H=i[S],X._handlers_[H]&&X._handlers_[H].length&&X._handlers_[H].forEach((function(f){f.call(X,{type:H,target:X},Q)}))},d.prototype.config=function(f){var Q=this;Q.options=Q.defaults||{},f&&(Q.options=function(f,Q){var H={};for(var X in f)f.hasOwnProperty(X)&&Q.hasOwnProperty(X)?H[X]=Q[X]:f.hasOwnProperty(X)&&(H[X]=f[X]);return H}(Q.options,f))},d.prototype.bindEvt=function(f,Q){var X=this;return X._domHandlers_=X._domHandlers_||{},X._domHandlers_[Q]=function(){"function"==typeof X["on"+Q]?X["on"+Q].apply(X,arguments):console.warn('[WARNING] : Missing "on'+Q+'" handler.')},K(f,H[Q],X._domHandlers_[Q]),D[Q]&&K(f,D[Q],X._domHandlers_[Q]),X},d.prototype.unbindEvt=function(f,Q){var X=this;return X._domHandlers_=X._domHandlers_||{},Z(f,H[Q],X._domHandlers_[Q]),D[Q]&&Z(f,D[Q],X._domHandlers_[Q]),delete X._domHandlers_[Q],this};const s=d;function F(f,Q){return this.identifier=Q.identifier,this.position=Q.position,this.frontPosition=Q.frontPosition,this.collection=f,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(Q),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=F.id,F.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}F.prototype=new s,F.constructor=F,F.id=0,F.prototype.buildEl=function(f){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},F.prototype.stylize=function(){if(this.options.dataOnly)return this;var f=this.options.fadeTime+"ms",Q=function(){var f=z("borderRadius");for(var Q in f)f.hasOwnProperty(Q)&&(f[Q]="50%");return f}(),H=g("transition","opacity",f),X={};return X.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},X.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},X.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},v(X.el,H),"circle"===this.options.shape&&v(X.back,Q),v(X.front,Q),this.applyStyles(X),this},F.prototype.applyStyles=function(f){for(var Q in this.ui)if(this.ui.hasOwnProperty(Q))for(var H in f[Q])this.ui[Q].style[H]=f[Q][H];return this},F.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},F.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},F.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},F.prototype.show=function(f){var Q=this;return Q.options.dataOnly||(clearTimeout(Q.removeTimeout),clearTimeout(Q.showTimeout),clearTimeout(Q.restTimeout),Q.addToDom(),Q.restCallback(),setTimeout((function(){Q.ui.el.style.opacity=1}),0),Q.showTimeout=setTimeout((function(){Q.trigger("shown",Q.instance),"function"==typeof f&&f.call(this)}),Q.options.fadeTime)),Q},F.prototype.hide=function(f){var Q=this;if(Q.options.dataOnly)return Q;if(Q.ui.el.style.opacity=Q.options.restOpacity,clearTimeout(Q.removeTimeout),clearTimeout(Q.showTimeout),clearTimeout(Q.restTimeout),Q.removeTimeout=setTimeout((function(){var H="dynamic"===Q.options.mode?"none":"block";Q.ui.el.style.display=H,"function"==typeof f&&f.call(Q),Q.trigger("hidden",Q.instance)}),Q.options.fadeTime),Q.options.restJoystick){var H=Q.options.restJoystick,X={};X.x=!0===H||!1!==H.x?0:Q.instance.frontPosition.x,X.y=!0===H||!1!==H.y?0:Q.instance.frontPosition.y,Q.setPosition(f,X)}return Q},F.prototype.setPosition=function(f,Q){var H=this;H.frontPosition={x:Q.x,y:Q.y};var X=H.options.fadeTime+"ms",i={};i.front=g("transition",["transform"],X);var S={front:{}};S.front={transform:"translate("+H.frontPosition.x+"px,"+H.frontPosition.y+"px)"},H.applyStyles(i),H.applyStyles(S),H.restTimeout=setTimeout((function(){"function"==typeof f&&f.call(H),H.restCallback()}),H.options.fadeTime)},F.prototype.restCallback=function(){var f=this,Q={};Q.front=g("transition","none",""),f.applyStyles(Q),f.trigger("rested",f.instance)},F.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},F.prototype.computeDirection=function(f){var Q,H,X,i=f.angle.radian,S=Math.PI/4,x=Math.PI/2;if(i>S&&i<3*S&&!f.lockX?Q="up":i>-S&&i<=S&&!f.lockY?Q="left":i>3*-S&&i<=-S&&!f.lockX?Q="down":f.lockY||(Q="right"),f.lockY||(H=i>-x&&i<x?"left":"right"),f.lockX||(X=i>0?"up":"down"),f.force>this.options.threshold){var K,Z={};for(K in this.direction)this.direction.hasOwnProperty(K)&&(Z[K]=this.direction[K]);var B={};for(K in this.direction={x:H,y:X,angle:Q},f.direction=this.direction,Z)Z[K]===this.direction[K]&&(B[K]=!0);if(B.x&&B.y&&B.angle)return f;B.x&&B.y||this.trigger("plain",f),B.x||this.trigger("plain:"+H,f),B.y||this.trigger("plain:"+X,f),B.angle||this.trigger("dir dir:"+Q,f)}else this.resetDirection();return f};const P=F;function m(f,Q){var H=this;H.nipples=[],H.idles=[],H.actives=[],H.ids=[],H.pressureIntervals={},H.manager=f,H.id=m.id,m.id+=1,H.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},H.config(Q),"static"!==H.options.mode&&"semi"!==H.options.mode||(H.options.multitouch=!1),H.options.multitouch||(H.options.maxNumberOfNipples=1);var X=getComputedStyle(H.options.zone.parentElement);return X&&"flex"===X.display&&(H.parentIsFlex=!0),H.updateBox(),H.prepareNipples(),H.Ij(),H.begin(),H.nipples}m.prototype=new s,m.constructor=m,m.id=0,m.prototype.prepareNipples=function(){var f=this,Q=f.nipples;Q.on=f.on.bind(f),Q.off=f.off.bind(f),Q.options=f.options,Q.destroy=f.destroy.bind(f),Q.ids=f.ids,Q.id=f.id,Q.processOnMove=f.processOnMove.bind(f),Q.processOnEnd=f.processOnEnd.bind(f),Q.get=function(f){if(void 0===f)return Q[0];for(var H=0,X=Q.length;H<X;H+=1)if(Q[H].identifier===f)return Q[H];return!1}},m.prototype.Ij=function(){var f=this;f.bindEvt(f.options.zone,"start"),f.options.zone.style.touchAction="none",f.options.zone.style.msTouchAction="none"},m.prototype.begin=function(){var f=this,Q=f.options;if("static"===Q.mode){var H=f.createNipple(Q.position,f.manager.getIdentifier());H.add(),f.idles.push(H)}},m.prototype.createNipple=function(f,Q){var H=this,X=H.manager.scroll,i={},S=H.options,x=H.parentIsFlex?X.x:X.x+H.box.left,K=H.parentIsFlex?X.y:X.y+H.box.top;if(f.x&&f.y)i={x:f.x-x,y:f.y-K};else if(f.top||f.right||f.bottom||f.left){var Z=document.createElement("DIV");Z.style.display="hidden",Z.style.top=f.top,Z.style.right=f.right,Z.style.bottom=f.bottom,Z.style.left=f.left,Z.style.position="absolute",S.zone.appendChild(Z);var B=Z.getBoundingClientRect();S.zone.removeChild(Z),i=f,f={x:B.left+X.x,y:B.top+X.y}}var N=new P(H,{color:S.color,size:S.size,threshold:S.threshold,fadeTime:S.fadeTime,dataOnly:S.dataOnly,restJoystick:S.restJoystick,restOpacity:S.restOpacity,mode:S.mode,identifier:Q,position:f,zone:S.zone,frontPosition:{x:0,y:0},shape:S.shape});return S.dataOnly||(J(N.ui.el,i),J(N.ui.front,N.frontPosition)),H.nipples.push(N),H.trigger("added "+N.identifier+":added",N),H.manager.trigger("added "+N.identifier+":added",N),H.bindNipple(N),N},m.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},m.prototype.bindNipple=function(f){var Q,H=this,X=function(f,X){Q=f.type+" "+X.id+":"+f.type,H.trigger(Q,X)};f.on("destroyed",H.onDestroyed.bind(H)),f.on("shown hidden rested dir plain",X),f.on("dir:up dir:right dir:down dir:left",X),f.on("plain:up plain:right plain:down plain:left",X)},m.prototype.pressureFn=function(f,Q,H){var X=this,i=0;clearInterval(X.pressureIntervals[H]),X.pressureIntervals[H]=setInterval(function(){var H=f.force||f.pressure||f.webkitForce||0;H!==i&&(Q.trigger("pressure",H),X.trigger("pressure "+Q.identifier+":pressure",H),i=H)}.bind(X),100)},m.prototype.onstart=function(f){var Q=this,H=Q.options,X=f;return f=B(f),Q.updateBox(),Y(f,(function(i){Q.actives.length<H.maxNumberOfNipples?Q.processOnStart(i):X.type.match(/^touch/)&&(Object.keys(Q.manager.ids).forEach((function(H){if(Object.values(X.touches).findIndex((function(f){return f.identifier===H}))<0){var i=[f[0]];i.identifier=H,Q.processOnEnd(i)}})),Q.actives.length<H.maxNumberOfNipples&&Q.processOnStart(i))})),Q.manager.bindDocument(),!1},m.prototype.processOnStart=function(f){var Q,H=this,i=H.options,S=H.manager.getIdentifier(f),x=f.force||f.pressure||f.webkitForce||0,K={x:f.pageX,y:f.pageY},Z=H.getOrCreate(S,K);Z.identifier!==S&&H.manager.removeIdentifier(Z.identifier),Z.identifier=S;var B=function(Q){Q.trigger("start",Q),H.trigger("start "+Q.id+":start",Q),Q.show(),x>0&&H.pressureFn(f,Q,Q.identifier),H.processOnMove(f)};if((Q=H.idles.indexOf(Z))>=0&&H.idles.splice(Q,1),H.actives.push(Z),H.ids.push(Z.identifier),"semi"!==i.mode)B(Z);else{if(!(X(K,Z.position)<=i.catchDistance))return Z.destroy(),void H.processOnStart(f);B(Z)}return Z},m.prototype.getOrCreate=function(f,Q){var H,X=this,i=X.options;return/(semi|static)/.test(i.mode)?(H=X.idles[0])?(X.idles.splice(0,1),H):"semi"===i.mode?X.createNipple(Q,f):(console.warn("Coudln't find the needed nipple."),!1):H=X.createNipple(Q,f)},m.prototype.processOnMove=function(f){var Q=this,H=Q.options,S=Q.manager.getIdentifier(f),x=Q.nipples.get(S),K=Q.manager.scroll;if(function(f){return isNaN(f.buttons)?0!==f.pressure:0!==f.buttons}(f)){if(!x)return console.error("Found zombie joystick with ID "+S),void Q.manager.removeIdentifier(S);if(H.dynamicPage){var Z=x.el.getBoundingClientRect();x.position={x:K.x+Z.left,y:K.y+Z.top}}x.identifier=S;var B=x.options.size/2,N={x:f.pageX,y:f.pageY};H.lockX&&(N.y=x.position.y),H.lockY&&(N.x=x.position.x);var J,g,z,v,Y,O,n,e,G,I,l=X(N,x.position),q=(J=N,z=(g=x.position).x-J.x,v=g.y-J.y,function(f){return f*(180/Math.PI)}(Math.atan2(v,z))),D=i(q),d=l/B,s={distance:l,position:N};if("circle"===x.options.shape?(Y=Math.min(l,B),n=x.position,e=Y,I={x:0,y:0},G=i(G=q),I.x=n.x-e*Math.cos(G),I.y=n.y-e*Math.sin(G),O=I):(O=function(f,Q,H){return{x:Math.min(Math.max(f.x,Q.x-H),Q.x+H),y:Math.min(Math.max(f.y,Q.y-H),Q.y+H)}}(N,x.position,B),Y=X(O,x.position)),H.follow){if(l>B){var F=N.x-O.x,P=N.y-O.y;x.position.x+=F,x.position.y+=P,x.el.style.top=x.position.y-(Q.box.top+K.y)+"px",x.el.style.left=x.position.x-(Q.box.left+K.x)+"px",l=X(N,x.position)}}else N=O,l=Y;var m=N.x-x.position.x,c=N.y-x.position.y;x.frontPosition={x:m,y:c},H.dataOnly||(x.ui.front.style.transform="translate("+m+"px,"+c+"px)");var W={identifier:x.identifier,position:N,force:d,pressure:f.force||f.pressure||f.webkitForce||0,distance:l,angle:{radian:D,degree:q},vector:{x:m/B,y:-c/B},raw:s,instance:x,lockX:H.lockX,lockY:H.lockY};(W=x.computeDirection(W)).angle={radian:i(180-q),degree:180-q},x.trigger("move",W),Q.trigger("move "+x.id+":move",W)}else this.processOnEnd(f)},m.prototype.processOnEnd=function(f){var Q=this,H=Q.options,X=Q.manager.getIdentifier(f),i=Q.nipples.get(X),S=Q.manager.removeIdentifier(i.identifier);i&&(H.dataOnly||i.hide((function(){"dynamic"===H.mode&&(i.trigger("removed",i),Q.trigger("removed "+i.id+":removed",i),Q.manager.trigger("removed "+i.id+":removed",i),i.destroy())})),clearInterval(Q.pressureIntervals[i.identifier]),i.resetDirection(),i.trigger("end",i),Q.trigger("end "+i.id+":end",i),Q.ids.indexOf(i.identifier)>=0&&Q.ids.splice(Q.ids.indexOf(i.identifier),1),Q.actives.indexOf(i)>=0&&Q.actives.splice(Q.actives.indexOf(i),1),/(semi|static)/.test(H.mode)?Q.idles.push(i):Q.nipples.indexOf(i)>=0&&Q.nipples.splice(Q.nipples.indexOf(i),1),Q.manager.unbindDocument(),/(semi|static)/.test(H.mode)&&(Q.manager.ids[S.id]=S.identifier))},m.prototype.onDestroyed=function(f,Q){var H=this;H.nipples.indexOf(Q)>=0&&H.nipples.splice(H.nipples.indexOf(Q),1),H.actives.indexOf(Q)>=0&&H.actives.splice(H.actives.indexOf(Q),1),H.idles.indexOf(Q)>=0&&H.idles.splice(H.idles.indexOf(Q),1),H.ids.indexOf(Q.identifier)>=0&&H.ids.splice(H.ids.indexOf(Q.identifier),1),H.manager.removeIdentifier(Q.identifier),H.manager.unbindDocument()},m.prototype.destroy=function(){var f=this;for(var Q in f.unbindEvt(f.options.zone,"start"),f.nipples.forEach((function(f){f.destroy()})),f.pressureIntervals)f.pressureIntervals.hasOwnProperty(Q)&&clearInterval(f.pressureIntervals[Q]);f.trigger("destroyed",f.nipples),f.manager.unbindDocument(),f.off()};const c=m;function W(f){var Q=this;Q.ids={},Q.index=0,Q.collections=[],Q.scroll=N(),Q.config(f),Q.prepareCollections();var H=function(){var f;Q.collections.forEach((function(H){H.forEach((function(H){f=H.el.getBoundingClientRect(),H.position={x:Q.scroll.x+f.left,y:Q.scroll.y+f.top}}))}))};K(window,"resize",(function(){x(H)}));var X=function(){Q.scroll=N()};return K(window,"scroll",(function(){x(X)})),Q.collections}W.prototype=new s,W.constructor=W,W.prototype.prepareCollections=function(){var f=this;f.collections.create=f.create.bind(f),f.collections.on=f.on.bind(f),f.collections.off=f.off.bind(f),f.collections.destroy=f.destroy.bind(f),f.collections.get=function(Q){var H;return f.collections.every((function(f){return!(H=f.get(Q))})),H}},W.prototype.create=function(f){return this.createCollection(f)},W.prototype.createCollection=function(f){var Q=this,H=new c(Q,f);return Q.bindCollection(H),Q.collections.push(H),H},W.prototype.bindCollection=function(f){var Q,H=this,X=function(f,X){Q=f.type+" "+X.id+":"+f.type,H.trigger(Q,X)};f.on("destroyed",H.onDestroyed.bind(H)),f.on("shown hidden rested dir plain",X),f.on("dir:up dir:right dir:down dir:left",X),f.on("plain:up plain:right plain:down plain:left",X)},W.prototype.bindDocument=function(){var f=this;f.binded||(f.bindEvt(document,"move").bindEvt(document,"end"),f.binded=!0)},W.prototype.unbindDocument=function(f){var Q=this;Object.keys(Q.ids).length&&!0!==f||(Q.unbindEvt(document,"move").unbindEvt(document,"end"),Q.binded=!1)},W.prototype.getIdentifier=function(f){var Q;return f?void 0===(Q=void 0===f.identifier?f.pointerId:f.identifier)&&(Q=this.latest||0):Q=this.index,void 0===this.ids[Q]&&(this.ids[Q]=this.index,this.index+=1),this.latest=Q,this.ids[Q]},W.prototype.removeIdentifier=function(f){var Q={};for(var H in this.ids)if(this.ids[H]===f){Q.id=H,Q.identifier=this.ids[H],delete this.ids[H];break}return Q},W.prototype.onmove=function(f){return this.onAny("move",f),!1},W.prototype.onend=function(f){return this.onAny("end",f),!1},W.prototype.oncancel=function(f){return this.onAny("end",f),!1},W.prototype.onAny=function(f,Q){var H,X=this,i="processOn"+f.charAt(0).toUpperCase()+f.slice(1);Q=B(Q);var S=function(f,Q,H){H.ids.indexOf(Q)>=0&&(H[i](f),f._found_=!0)};return Y(Q,(function(f){H=X.getIdentifier(f),Y(X.collections,S.bind(null,f,H)),f._found_||X.removeIdentifier(H)})),!1},W.prototype.destroy=function(){var f=this;f.unbindDocument(!0),f.ids={},f.index=0,f.collections.forEach((function(f){f.destroy()})),f.off()},W.prototype.onDestroyed=function(f,Q){var H=this;if(H.collections.indexOf(Q)<0)return!1;H.collections.splice(H.collections.indexOf(Q),1)};var R=new W;const U={create:function(f){return R.create(f)},factory:R};return Q.default})(),f.exports=Q()},11177:(f,Q,H)=>{"use strict";const{Deflate:X,deflate:i,deflateRaw:S,gzip:x}=H(11184),{Inflate:K,inflate:Z,inflateRaw:B,ungzip:N}=H(11239),J=H(11217);f.exports.Deflate=X,f.exports.deflate=i,f.exports.deflateRaw=S,f.exports.gzip=x,f.exports.Inflate=K,f.exports.inflate=Z,f.exports.inflateRaw=B,f.exports.ungzip=N,f.exports.constants=J},11184:(f,Q,H)=>{"use strict";const X=H(11186),i=H(11220),S=H(11226),x=H(11215),K=H(11232),Z=Object.prototype.toString,{Z_NO_FLUSH:B,Z_SYNC_FLUSH:N,Z_FULL_FLUSH:J,Z_FINISH:g,Z_OK:z,Z_STREAM_END:v,Z_DEFAULT_COMPRESSION:Y,Z_DEFAULT_STRATEGY:O,Z_DEFLATED:n}=H(11217);function e(f){this.options=i.assign({level:Y,method:n,Ja:16384,windowBits:15,memLevel:8,strategy:O},f||{});let Q=this.options;Q.raw&&Q.windowBits>0?Q.windowBits=-Q.windowBits:Q.gzip&&Q.windowBits>0&&Q.windowBits<16&&(Q.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new K,this.strm.avail_out=0;let H=X.deflateInit2(this.strm,Q.level,Q.method,Q.windowBits,Q.memLevel,Q.strategy);if(H!==z)throw new Error(x[H]);if(Q.header&&X.deflateSetHeader(this.strm,Q.header),Q.dictionary){let f;if(f="string"===typeof Q.dictionary?S.string2buf(Q.dictionary):"[object ArrayBuffer]"===Z.call(Q.dictionary)?new Uint8Array(Q.dictionary):Q.dictionary,H=X.deflateSetDictionary(this.strm,f),H!==z)throw new Error(x[H]);this._dict_set=!0}}function G(f,Q){const H=new e(Q);if(H.push(f,!0),H.err)throw H.msg||x[H.err];return H.result}e.prototype.push=function(f,Q){const H=this.strm,i=this.options.Ja;let x,K;if(this.ended)return!1;for(K=Q===~~Q?Q:!0===Q?g:B,"string"===typeof f?H.input=S.string2buf(f):"[object ArrayBuffer]"===Z.call(f)?H.input=new Uint8Array(f):H.input=f,H.next_in=0,H.avail_in=H.input.length;;)if(0===H.avail_out&&(H.output=new Uint8Array(i),H.next_out=0,H.avail_out=i),(K===N||K===J)&&H.avail_out<=6)this.onData(H.output.subarray(0,H.next_out)),H.avail_out=0;else{if(x=X.deflate(H,K),x===v)return H.next_out>0&&this.onData(H.output.subarray(0,H.next_out)),x=X.deflateEnd(this.strm),this.onEnd(x),this.ended=!0,x===z;if(0!==H.avail_out){if(K>0&&H.next_out>0)this.onData(H.output.subarray(0,H.next_out)),H.avail_out=0;else if(0===H.avail_in)break}else this.onData(H.output)}return!0},e.prototype.onData=function(f){this.chunks.push(f)},e.prototype.onEnd=function(f){f===z&&(this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},f.exports.Deflate=e,f.exports.deflate=G,f.exports.deflateRaw=function(f,Q){return(Q=Q||{}).raw=!0,G(f,Q)},f.exports.gzip=function(f,Q){return(Q=Q||{}).gzip=!0,G(f,Q)},f.exports.constants=H(11217)},11239:(f,Q,H)=>{"use strict";const X=H(11246),i=H(11220),S=H(11226),x=H(11215),K=H(11232),Z=H(11258),B=Object.prototype.toString,{Z_NO_FLUSH:N,Z_FINISH:J,Z_OK:g,Z_STREAM_END:z,Z_NEED_DICT:v,Z_STREAM_ERROR:Y,Z_DATA_ERROR:O,Z_MEM_ERROR:n}=H(11217);function e(f){this.options=i.assign({Ja:65536,windowBits:15,to:""},f||{});const Q=this.options;Q.raw&&Q.windowBits>=0&&Q.windowBits<16&&(Q.windowBits=-Q.windowBits,0===Q.windowBits&&(Q.windowBits=-15)),!(Q.windowBits>=0&&Q.windowBits<16)||f&&f.windowBits||(Q.windowBits+=32),Q.windowBits>15&&Q.windowBits<48&&0===(15&Q.windowBits)&&(Q.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new K,this.strm.avail_out=0;let H=X.inflateInit2(this.strm,Q.windowBits);if(H!==g)throw new Error(x[H]);if(this.header=new Z,X.inflateGetHeader(this.strm,this.header),Q.dictionary&&("string"===typeof Q.dictionary?Q.dictionary=S.string2buf(Q.dictionary):"[object ArrayBuffer]"===B.call(Q.dictionary)&&(Q.dictionary=new Uint8Array(Q.dictionary)),Q.raw&&(H=X.inflateSetDictionary(this.strm,Q.dictionary),H!==g)))throw new Error(x[H])}function G(f,Q){const H=new e(Q);if(H.push(f),H.err)throw H.msg||x[H.err];return H.result}e.prototype.push=function(f,Q){const H=this.strm,i=this.options.Ja,x=this.options.dictionary;let K,Z,e;if(this.ended)return!1;for(Z=Q===~~Q?Q:!0===Q?J:N,"[object ArrayBuffer]"===B.call(f)?H.input=new Uint8Array(f):H.input=f,H.next_in=0,H.avail_in=H.input.length;;){for(0===H.avail_out&&(H.output=new Uint8Array(i),H.next_out=0,H.avail_out=i),K=X.inflate(H,Z),K===v&&x&&(K=X.inflateSetDictionary(H,x),K===g?K=X.inflate(H,Z):K===O&&(K=v));H.avail_in>0&&K===z&&H.state.wrap>0&&0!==f[H.next_in];)X.inflateReset(H),K=X.inflate(H,Z);switch(K){case Y:case O:case v:case n:return this.onEnd(K),this.ended=!0,!1}if(e=H.avail_out,H.next_out&&(0===H.avail_out||K===z))if("string"===this.options.to){let f=S.utf8border(H.output,H.next_out),Q=H.next_out-f,X=S.buf2string(H.output,f);H.next_out=Q,H.avail_out=i-Q,Q&&H.output.set(H.output.subarray(f,f+Q),0),this.onData(X)}else this.onData(H.output.length===H.next_out?H.output:H.output.subarray(0,H.next_out));if(K!==g||0!==e){if(K===z)return K=X.inflateEnd(this.strm),this.onEnd(K),this.ended=!0,!0;if(0===H.avail_in)break}}return!0},e.prototype.onData=function(f){this.chunks.push(f)},e.prototype.onEnd=function(f){f===g&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},f.exports.Inflate=e,f.exports.inflate=G,f.exports.inflateRaw=function(f,Q){return(Q=Q||{}).raw=!0,G(f,Q)},f.exports.ungzip=G,f.exports.constants=H(11217)},11220:f=>{"use strict";const Q=(f,Q)=>Object.prototype.hasOwnProperty.call(f,Q);f.exports.assign=function(f){const H=Array.prototype.slice.call(arguments,1);for(;H.length;){const X=H.shift();if(X){if("object"!==typeof X)throw new TypeError(X+"must be non-object");for(const H in X)Q(X,H)&&(f[H]=X[H])}}return f},f.exports.flattenChunks=f=>{let Q=0;for(let X=0,i=f.length;X<i;X++)Q+=f[X].length;const H=new Uint8Array(Q);for(let X=0,i=0,S=f.length;X<S;X++){let Q=f[X];H.set(Q,i),i+=Q.length}return H}},11226:f=>{"use strict";let Q=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(X){Q=!1}const H=new Uint8Array(256);for(let i=0;i<256;i++)H[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;H[254]=H[254]=1,f.exports.string2buf=f=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(f);let Q,H,X,i,S,x=f.length,K=0;for(i=0;i<x;i++)H=f.charCodeAt(i),55296===(64512&H)&&i+1<x&&(X=f.charCodeAt(i+1),56320===(64512&X)&&(H=65536+(H-55296<<10)+(X-56320),i++)),K+=H<128?1:H<2048?2:H<65536?3:4;for(Q=new Uint8Array(K),S=0,i=0;S<K;i++)H=f.charCodeAt(i),55296===(64512&H)&&i+1<x&&(X=f.charCodeAt(i+1),56320===(64512&X)&&(H=65536+(H-55296<<10)+(X-56320),i++)),H<128?Q[S++]=H:H<2048?(Q[S++]=192|H>>>6,Q[S++]=128|63&H):H<65536?(Q[S++]=224|H>>>12,Q[S++]=128|H>>>6&63,Q[S++]=128|63&H):(Q[S++]=240|H>>>18,Q[S++]=128|H>>>12&63,Q[S++]=128|H>>>6&63,Q[S++]=128|63&H);return Q};f.exports.buf2string=(f,X)=>{const i=X||f.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(f.subarray(0,X));let S,x;const K=new Array(2*i);for(x=0,S=0;S<i;){let Q=f[S++];if(Q<128){K[x++]=Q;continue}let X=H[Q];if(X>4)K[x++]=65533,S+=X-1;else{for(Q&=2===X?31:3===X?15:7;X>1&&S<i;)Q=Q<<6|63&f[S++],X--;X>1?K[x++]=65533:Q<65536?K[x++]=Q:(Q-=65536,K[x++]=55296|Q>>10&1023,K[x++]=56320|1023&Q)}}return((f,H)=>{if(H<65534&&f.subarray&&Q)return String.fromCharCode.apply(null,f.length===H?f:f.subarray(0,H));let X="";for(let Q=0;Q<H;Q++)X+=String.fromCharCode(f[Q]);return X})(K,x)},f.exports.utf8border=(f,Q)=>{(Q=Q||f.length)>f.length&&(Q=f.length);let X=Q-1;for(;X>=0&&128===(192&f[X]);)X--;return X<0||0===X?Q:X+H[f[X]]>Q?X:Q}},11202:f=>{"use strict";f.exports=(f,Q,H,X)=>{let i=65535&f,S=f>>>16&65535,x=0;for(;0!==H;){x=H>2e3?2e3:H,H-=x;do{i=i+Q[X++]|0,S=S+i|0}while(--x);i%=65521,S%=65521}return i|S<<16}},11217:f=>{"use strict";f.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11207:f=>{"use strict";const Q=new Uint32Array((()=>{let f,Q=[];for(var H=0;H<256;H++){f=H;for(var X=0;X<8;X++)f=1&f?3988292384^f>>>1:f>>>1;Q[H]=f}return Q})());f.exports=(f,H,X,i)=>{const S=Q,x=i+X;f^=-1;for(let Q=i;Q<x;Q++)f=f>>>8^S[255&(f^H[Q])];return~f}},11186:(f,Q,H)=>{"use strict";const{_tr_init:X,_tr_stored_block:i,_tr_flush_block:S,_tr_tally:x,_tr_align:K}=H(11194),Z=H(11202),B=H(11207),N=H(11215),{Z_NO_FLUSH:J,Z_PARTIAL_FLUSH:g,Z_FULL_FLUSH:z,Z_FINISH:v,Z_BLOCK:Y,Z_OK:O,Z_STREAM_END:n,Z_STREAM_ERROR:e,Z_DATA_ERROR:G,Z_BUF_ERROR:I,Z_DEFAULT_COMPRESSION:l,Z_FILTERED:q,Z_HUFFMAN_ONLY:D,Z_RLE:d,Z_FIXED:s,Z_DEFAULT_STRATEGY:F,Z_UNKNOWN:P,Z_DEFLATED:m}=H(11217),c=258,W=262,R=103,U=113,E=666,t=(f,Q)=>(f.msg=N[Q],Q),u=f=>(f<<1)-(f>4?9:0),L=f=>{let Q=f.length;for(;--Q>=0;)f[Q]=0};let A=(f,Q,H)=>(Q<<f.hash_shift^H)&f.hash_mask;const a=f=>{const Q=f.state;let H=Q.pending;H>f.avail_out&&(H=f.avail_out),0!==H&&(f.output.set(Q.pending_buf.subarray(Q.pending_out,Q.pending_out+H),f.next_out),f.next_out+=H,Q.pending_out+=H,f.total_out+=H,f.avail_out-=H,Q.pending-=H,0===Q.pending&&(Q.pending_out=0))},V=(f,Q)=>{S(f,f.block_start>=0?f.block_start:-1,f.strstart-f.block_start,Q),f.block_start=f.strstart,a(f.strm)},M=(f,Q)=>{f.pending_buf[f.pending++]=Q},r=(f,Q)=>{f.pending_buf[f.pending++]=Q>>>8&255,f.pending_buf[f.pending++]=255&Q},j=(f,Q,H,X)=>{let i=f.avail_in;return i>X&&(i=X),0===i?0:(f.avail_in-=i,Q.set(f.input.subarray(f.next_in,f.next_in+i),H),1===f.state.wrap?f.adler=Z(f.adler,Q,i,H):2===f.state.wrap&&(f.adler=B(f.adler,Q,i,H)),f.next_in+=i,f.total_in+=i,i)},T=(f,Q)=>{let H,X,i=f.max_chain_length,S=f.strstart,x=f.prev_length,K=f.nice_match;const Z=f.strstart>f.w_size-W?f.strstart-(f.w_size-W):0,B=f.window,N=f.w_mask,J=f.prev,g=f.strstart+c;let z=B[S+x-1],v=B[S+x];f.prev_length>=f.good_match&&(i>>=2),K>f.lookahead&&(K=f.lookahead);do{if(H=Q,B[H+x]===v&&B[H+x-1]===z&&B[H]===B[S]&&B[++H]===B[S+1]){S+=2,H++;do{}while(B[++S]===B[++H]&&B[++S]===B[++H]&&B[++S]===B[++H]&&B[++S]===B[++H]&&B[++S]===B[++H]&&B[++S]===B[++H]&&B[++S]===B[++H]&&B[++S]===B[++H]&&S<g);if(X=c-(g-S),S=g-c,X>x){if(f.match_start=Q,x=X,X>=K)break;z=B[S+x-1],v=B[S+x]}}}while((Q=J[Q&N])>Z&&0!==--i);return x<=f.lookahead?x:f.lookahead},k=f=>{const Q=f.w_size;let H,X,i,S,x;do{if(S=f.window_size-f.lookahead-f.strstart,f.strstart>=Q+(Q-W)){f.window.set(f.window.subarray(Q,Q+Q),0),f.match_start-=Q,f.strstart-=Q,f.block_start-=Q,X=f.hash_size,H=X;do{i=f.head[--H],f.head[H]=i>=Q?i-Q:0}while(--X);X=Q,H=X;do{i=f.prev[--H],f.prev[H]=i>=Q?i-Q:0}while(--X);S+=Q}if(0===f.strm.avail_in)break;if(X=j(f.strm,f.window,f.strstart+f.lookahead,S),f.lookahead+=X,f.lookahead+f.insert>=3)for(x=f.strstart-f.insert,f.ins_h=f.window[x],f.ins_h=A(f,f.ins_h,f.window[x+1]);f.insert&&(f.ins_h=A(f,f.ins_h,f.window[x+3-1]),f.prev[x&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=x,x++,f.insert--,!(f.lookahead+f.insert<3)););}while(f.lookahead<W&&0!==f.strm.avail_in)},y=(f,Q)=>{let H,X;for(;;){if(f.lookahead<W){if(k(f),f.lookahead<W&&Q===J)return 1;if(0===f.lookahead)break}if(H=0,f.lookahead>=3&&(f.ins_h=A(f,f.ins_h,f.window[f.strstart+3-1]),H=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),0!==H&&f.strstart-H<=f.w_size-W&&(f.match_length=T(f,H)),f.match_length>=3)if(X=x(f,f.strstart-f.match_start,f.match_length-3),f.lookahead-=f.match_length,f.match_length<=f.max_lazy_match&&f.lookahead>=3){f.match_length--;do{f.strstart++,f.ins_h=A(f,f.ins_h,f.window[f.strstart+3-1]),H=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart}while(0!==--f.match_length);f.strstart++}else f.strstart+=f.match_length,f.match_length=0,f.ins_h=f.window[f.strstart],f.ins_h=A(f,f.ins_h,f.window[f.strstart+1]);else X=x(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++;if(X&&(V(f,!1),0===f.strm.avail_out))return 1}return f.insert=f.strstart<2?f.strstart:2,Q===v?(V(f,!0),0===f.strm.avail_out?3:4):f.last_lit&&(V(f,!1),0===f.strm.avail_out)?1:2},h=(f,Q)=>{let H,X,i;for(;;){if(f.lookahead<W){if(k(f),f.lookahead<W&&Q===J)return 1;if(0===f.lookahead)break}if(H=0,f.lookahead>=3&&(f.ins_h=A(f,f.ins_h,f.window[f.strstart+3-1]),H=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),f.prev_length=f.match_length,f.prev_match=f.match_start,f.match_length=2,0!==H&&f.prev_length<f.max_lazy_match&&f.strstart-H<=f.w_size-W&&(f.match_length=T(f,H),f.match_length<=5&&(f.strategy===q||3===f.match_length&&f.strstart-f.match_start>4096)&&(f.match_length=2)),f.prev_length>=3&&f.match_length<=f.prev_length){i=f.strstart+f.lookahead-3,X=x(f,f.strstart-1-f.prev_match,f.prev_length-3),f.lookahead-=f.prev_length-1,f.prev_length-=2;do{++f.strstart<=i&&(f.ins_h=A(f,f.ins_h,f.window[f.strstart+3-1]),H=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart)}while(0!==--f.prev_length);if(f.match_available=0,f.match_length=2,f.strstart++,X&&(V(f,!1),0===f.strm.avail_out))return 1}else if(f.match_available){if(X=x(f,0,f.window[f.strstart-1]),X&&V(f,!1),f.strstart++,f.lookahead--,0===f.strm.avail_out)return 1}else f.match_available=1,f.strstart++,f.lookahead--}return f.match_available&&(X=x(f,0,f.window[f.strstart-1]),f.match_available=0),f.insert=f.strstart<2?f.strstart:2,Q===v?(V(f,!0),0===f.strm.avail_out?3:4):f.last_lit&&(V(f,!1),0===f.strm.avail_out)?1:2};function w(f,Q,H,X,i){this.good_length=f,this.max_lazy=Q,this.nice_length=H,this.max_chain=X,this.func=i}const b=[new w(0,0,0,0,((f,Q)=>{let H=65535;for(H>f.pending_buf_size-5&&(H=f.pending_buf_size-5);;){if(f.lookahead<=1){if(k(f),0===f.lookahead&&Q===J)return 1;if(0===f.lookahead)break}f.strstart+=f.lookahead,f.lookahead=0;const X=f.block_start+H;if((0===f.strstart||f.strstart>=X)&&(f.lookahead=f.strstart-X,f.strstart=X,V(f,!1),0===f.strm.avail_out))return 1;if(f.strstart-f.block_start>=f.w_size-W&&(V(f,!1),0===f.strm.avail_out))return 1}return f.insert=0,Q===v?(V(f,!0),0===f.strm.avail_out?3:4):(f.strstart>f.block_start&&(V(f,!1),f.strm.avail_out),1)})),new w(4,4,8,4,y),new w(4,5,16,8,y),new w(4,6,32,32,y),new w(4,4,16,16,h),new w(8,16,32,32,h),new w(8,16,128,128,h),new w(8,32,128,256,h),new w(32,128,258,1024,h),new w(32,258,258,4096,h)];function o(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=m,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),L(this.dyn_ltree),L(this.dyn_dtree),L(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),L(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),L(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const p=f=>{if(!f||!f.state)return t(f,e);f.total_in=f.total_out=0,f.data_type=P;const Q=f.state;return Q.pending=0,Q.pending_out=0,Q.wrap<0&&(Q.wrap=-Q.wrap),Q.status=Q.wrap?42:U,f.adler=2===Q.wrap?0:1,Q.last_flush=J,X(Q),O},C=f=>{const Q=p(f);var H;return Q===O&&((H=f.state).window_size=2*H.w_size,L(H.head),H.max_lazy_match=b[H.level].max_lazy,H.good_match=b[H.level].good_length,H.nice_match=b[H.level].nice_length,H.max_chain_length=b[H.level].max_chain,H.strstart=0,H.block_start=0,H.lookahead=0,H.insert=0,H.match_length=H.prev_length=2,H.match_available=0,H.ins_h=0),Q},ff=(f,Q,H,X,i,S)=>{if(!f)return e;let x=1;if(Q===l&&(Q=6),X<0?(x=0,X=-X):X>15&&(x=2,X-=16),i<1||i>9||H!==m||X<8||X>15||Q<0||Q>9||S<0||S>s)return t(f,e);8===X&&(X=9);const K=new o;return f.state=K,K.strm=f,K.wrap=x,K.gzhead=null,K.w_bits=X,K.w_size=1<<K.w_bits,K.w_mask=K.w_size-1,K.hash_bits=i+7,K.hash_size=1<<K.hash_bits,K.hash_mask=K.hash_size-1,K.hash_shift=~~((K.hash_bits+3-1)/3),K.window=new Uint8Array(2*K.w_size),K.head=new Uint16Array(K.hash_size),K.prev=new Uint16Array(K.w_size),K.lit_bufsize=1<<i+6,K.pending_buf_size=4*K.lit_bufsize,K.pending_buf=new Uint8Array(K.pending_buf_size),K.d_buf=1*K.lit_bufsize,K.l_buf=3*K.lit_bufsize,K.level=Q,K.strategy=S,K.method=H,C(f)};f.exports.deflateInit=(f,Q)=>ff(f,Q,m,15,8,F),f.exports.deflateInit2=ff,f.exports.deflateReset=C,f.exports.deflateResetKeep=p,f.exports.deflateSetHeader=(f,Q)=>f&&f.state?2!==f.state.wrap?e:(f.state.gzhead=Q,O):e,f.exports.deflate=(f,Q)=>{let H,X;if(!f||!f.state||Q>Y||Q<0)return f?t(f,e):e;const S=f.state;if(!f.output||!f.input&&0!==f.avail_in||S.status===E&&Q!==v)return t(f,0===f.avail_out?I:e);S.strm=f;const Z=S.last_flush;if(S.last_flush=Q,42===S.status)if(2===S.wrap)f.adler=0,M(S,31),M(S,139),M(S,8),S.gzhead?(M(S,(S.gzhead.text?1:0)+(S.gzhead.hcrc?2:0)+(S.gzhead.extra?4:0)+(S.gzhead.name?8:0)+(S.gzhead.comment?16:0)),M(S,255&S.gzhead.time),M(S,S.gzhead.time>>8&255),M(S,S.gzhead.time>>16&255),M(S,S.gzhead.time>>24&255),M(S,9===S.level?2:S.strategy>=D||S.level<2?4:0),M(S,255&S.gzhead.os),S.gzhead.extra&&S.gzhead.extra.length&&(M(S,255&S.gzhead.extra.length),M(S,S.gzhead.extra.length>>8&255)),S.gzhead.hcrc&&(f.adler=B(f.adler,S.pending_buf,S.pending,0)),S.gzindex=0,S.status=69):(M(S,0),M(S,0),M(S,0),M(S,0),M(S,0),M(S,9===S.level?2:S.strategy>=D||S.level<2?4:0),M(S,3),S.status=U);else{let Q=m+(S.w_bits-8<<4)<<8,H=-1;H=S.strategy>=D||S.level<2?0:S.level<6?1:6===S.level?2:3,Q|=H<<6,0!==S.strstart&&(Q|=32),Q+=31-Q%31,S.status=U,r(S,Q),0!==S.strstart&&(r(S,f.adler>>>16),r(S,65535&f.adler)),f.adler=1}if(69===S.status)if(S.gzhead.extra){for(H=S.pending;S.gzindex<(65535&S.gzhead.extra.length)&&(S.pending!==S.pending_buf_size||(S.gzhead.hcrc&&S.pending>H&&(f.adler=B(f.adler,S.pending_buf,S.pending-H,H)),a(f),H=S.pending,S.pending!==S.pending_buf_size));)M(S,255&S.gzhead.extra[S.gzindex]),S.gzindex++;S.gzhead.hcrc&&S.pending>H&&(f.adler=B(f.adler,S.pending_buf,S.pending-H,H)),S.gzindex===S.gzhead.extra.length&&(S.gzindex=0,S.status=73)}else S.status=73;if(73===S.status)if(S.gzhead.name){H=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>H&&(f.adler=B(f.adler,S.pending_buf,S.pending-H,H)),a(f),H=S.pending,S.pending===S.pending_buf_size)){X=1;break}X=S.gzindex<S.gzhead.name.length?255&S.gzhead.name.charCodeAt(S.gzindex++):0,M(S,X)}while(0!==X);S.gzhead.hcrc&&S.pending>H&&(f.adler=B(f.adler,S.pending_buf,S.pending-H,H)),0===X&&(S.gzindex=0,S.status=91)}else S.status=91;if(91===S.status)if(S.gzhead.comment){H=S.pending;do{if(S.pending===S.pending_buf_size&&(S.gzhead.hcrc&&S.pending>H&&(f.adler=B(f.adler,S.pending_buf,S.pending-H,H)),a(f),H=S.pending,S.pending===S.pending_buf_size)){X=1;break}X=S.gzindex<S.gzhead.comment.length?255&S.gzhead.comment.charCodeAt(S.gzindex++):0,M(S,X)}while(0!==X);S.gzhead.hcrc&&S.pending>H&&(f.adler=B(f.adler,S.pending_buf,S.pending-H,H)),0===X&&(S.status=R)}else S.status=R;if(S.status===R&&(S.gzhead.hcrc?(S.pending+2>S.pending_buf_size&&a(f),S.pending+2<=S.pending_buf_size&&(M(S,255&f.adler),M(S,f.adler>>8&255),f.adler=0,S.status=U)):S.status=U),0!==S.pending){if(a(f),0===f.avail_out)return S.last_flush=-1,O}else if(0===f.avail_in&&u(Q)<=u(Z)&&Q!==v)return t(f,I);if(S.status===E&&0!==f.avail_in)return t(f,I);if(0!==f.avail_in||0!==S.lookahead||Q!==J&&S.status!==E){let H=S.strategy===D?((f,Q)=>{let H;for(;;){if(0===f.lookahead&&(k(f),0===f.lookahead)){if(Q===J)return 1;break}if(f.match_length=0,H=x(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++,H&&(V(f,!1),0===f.strm.avail_out))return 1}return f.insert=0,Q===v?(V(f,!0),0===f.strm.avail_out?3:4):f.last_lit&&(V(f,!1),0===f.strm.avail_out)?1:2})(S,Q):S.strategy===d?((f,Q)=>{let H,X,i,S;const K=f.window;for(;;){if(f.lookahead<=c){if(k(f),f.lookahead<=c&&Q===J)return 1;if(0===f.lookahead)break}if(f.match_length=0,f.lookahead>=3&&f.strstart>0&&(i=f.strstart-1,X=K[i],X===K[++i]&&X===K[++i]&&X===K[++i])){S=f.strstart+c;do{}while(X===K[++i]&&X===K[++i]&&X===K[++i]&&X===K[++i]&&X===K[++i]&&X===K[++i]&&X===K[++i]&&X===K[++i]&&i<S);f.match_length=c-(S-i),f.match_length>f.lookahead&&(f.match_length=f.lookahead)}if(f.match_length>=3?(H=x(f,1,f.match_length-3),f.lookahead-=f.match_length,f.strstart+=f.match_length,f.match_length=0):(H=x(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++),H&&(V(f,!1),0===f.strm.avail_out))return 1}return f.insert=0,Q===v?(V(f,!0),0===f.strm.avail_out?3:4):f.last_lit&&(V(f,!1),0===f.strm.avail_out)?1:2})(S,Q):b[S.level].func(S,Q);if(3!==H&&4!==H||(S.status=E),1===H||3===H)return 0===f.avail_out&&(S.last_flush=-1),O;if(2===H&&(Q===g?K(S):Q!==Y&&(i(S,0,0,!1),Q===z&&(L(S.head),0===S.lookahead&&(S.strstart=0,S.block_start=0,S.insert=0))),a(f),0===f.avail_out))return S.last_flush=-1,O}return Q!==v?O:S.wrap<=0?n:(2===S.wrap?(M(S,255&f.adler),M(S,f.adler>>8&255),M(S,f.adler>>16&255),M(S,f.adler>>24&255),M(S,255&f.total_in),M(S,f.total_in>>8&255),M(S,f.total_in>>16&255),M(S,f.total_in>>24&255)):(r(S,f.adler>>>16),r(S,65535&f.adler)),a(f),S.wrap>0&&(S.wrap=-S.wrap),0!==S.pending?O:n)},f.exports.deflateEnd=f=>{if(!f||!f.state)return e;const Q=f.state.status;return 42!==Q&&69!==Q&&73!==Q&&91!==Q&&Q!==R&&Q!==U&&Q!==E?t(f,e):(f.state=null,Q===U?t(f,G):O)},f.exports.deflateSetDictionary=(f,Q)=>{let H=Q.length;if(!f||!f.state)return e;const X=f.state,i=X.wrap;if(2===i||1===i&&42!==X.status||X.lookahead)return e;if(1===i&&(f.adler=Z(f.adler,Q,H,0)),X.wrap=0,H>=X.w_size){0===i&&(L(X.head),X.strstart=0,X.block_start=0,X.insert=0);let f=new Uint8Array(X.w_size);f.set(Q.subarray(H-X.w_size,H),0),Q=f,H=X.w_size}const S=f.avail_in,x=f.next_in,K=f.input;for(f.avail_in=H,f.next_in=0,f.input=Q,k(X);X.lookahead>=3;){let f=X.strstart,Q=X.lookahead-2;do{X.ins_h=A(X,X.ins_h,X.window[f+3-1]),X.prev[f&X.w_mask]=X.head[X.ins_h],X.head[X.ins_h]=f,f++}while(--Q);X.strstart=f,X.lookahead=2,k(X)}return X.strstart+=X.lookahead,X.block_start=X.strstart,X.insert=X.lookahead,X.lookahead=0,X.match_length=X.prev_length=2,X.match_available=0,f.next_in=x,f.input=K,f.avail_in=S,X.wrap=i,O},f.exports.deflateInfo="pako deflate (from Nodeca project)"},11258:f=>{"use strict";f.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11248:f=>{"use strict";f.exports=function(f,Q){let H,X,i,S,x,K,Z,B,N,J,g,z,v,Y,O,n,e,G,I,l,q,D,d,s;const F=f.state;H=f.next_in,d=f.input,X=H+(f.avail_in-5),i=f.next_out,s=f.output,S=i-(Q-f.avail_out),x=i+(f.avail_out-257),K=F.dmax,Z=F.wsize,B=F.whave,N=F.wnext,J=F.window,g=F.hold,z=F.bits,v=F.lencode,Y=F.distcode,O=(1<<F.lenbits)-1,n=(1<<F.distbits)-1;f:do{z<15&&(g+=d[H++]<<z,z+=8,g+=d[H++]<<z,z+=8),e=v[g&O];Q:for(;;){if(G=e>>>24,g>>>=G,z-=G,G=e>>>16&255,0===G)s[i++]=65535&e;else{if(!(16&G)){if(0===(64&G)){e=v[(65535&e)+(g&(1<<G)-1)];continue Q}if(32&G){F.mode=12;break f}f.msg="invalid literal/length code",F.mode=30;break f}I=65535&e,G&=15,G&&(z<G&&(g+=d[H++]<<z,z+=8),I+=g&(1<<G)-1,g>>>=G,z-=G),z<15&&(g+=d[H++]<<z,z+=8,g+=d[H++]<<z,z+=8),e=Y[g&n];H:for(;;){if(G=e>>>24,g>>>=G,z-=G,G=e>>>16&255,!(16&G)){if(0===(64&G)){e=Y[(65535&e)+(g&(1<<G)-1)];continue H}f.msg="invalid distance code",F.mode=30;break f}if(l=65535&e,G&=15,z<G&&(g+=d[H++]<<z,z+=8,z<G&&(g+=d[H++]<<z,z+=8)),l+=g&(1<<G)-1,l>K){f.msg="invalid distance too far back",F.mode=30;break f}if(g>>>=G,z-=G,G=i-S,l>G){if(G=l-G,G>B&&F.sane){f.msg="invalid distance too far back",F.mode=30;break f}if(q=0,D=J,0===N){if(q+=Z-G,G<I){I-=G;do{s[i++]=J[q++]}while(--G);q=i-l,D=s}}else if(N<G){if(q+=Z+N-G,G-=N,G<I){I-=G;do{s[i++]=J[q++]}while(--G);if(q=0,N<I){G=N,I-=G;do{s[i++]=J[q++]}while(--G);q=i-l,D=s}}}else if(q+=N-G,G<I){I-=G;do{s[i++]=J[q++]}while(--G);q=i-l,D=s}for(;I>2;)s[i++]=D[q++],s[i++]=D[q++],s[i++]=D[q++],I-=3;I&&(s[i++]=D[q++],I>1&&(s[i++]=D[q++]))}else{q=i-l;do{s[i++]=s[q++],s[i++]=s[q++],s[i++]=s[q++],I-=3}while(I>2);I&&(s[i++]=s[q++],I>1&&(s[i++]=s[q++]))}break}}break}}while(H<X&&i<x);I=z>>3,H-=I,z-=I<<3,g&=(1<<z)-1,f.next_in=H,f.next_out=i,f.avail_in=H<X?X-H+5:5-(H-X),f.avail_out=i<x?x-i+257:257-(i-x),F.hold=g,F.bits=z}},11246:(f,Q,H)=>{"use strict";const X=H(11202),i=H(11207),S=H(11248),x=H(11255),{Z_FINISH:K,Z_BLOCK:Z,Z_TREES:B,Z_OK:N,Z_STREAM_END:J,Z_NEED_DICT:g,Z_STREAM_ERROR:z,Z_DATA_ERROR:v,Z_MEM_ERROR:Y,Z_BUF_ERROR:O,Z_DEFLATED:n}=H(11217),e=12,G=30,I=f=>(f>>>24&255)+(f>>>8&65280)+((65280&f)<<8)+((255&f)<<24);function l(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const q=f=>{if(!f||!f.state)return z;const Q=f.state;return f.total_in=f.total_out=Q.total=0,f.msg="",Q.wrap&&(f.adler=1&Q.wrap),Q.mode=1,Q.last=0,Q.havedict=0,Q.dmax=32768,Q.head=null,Q.hold=0,Q.bits=0,Q.lencode=Q.lendyn=new Int32Array(852),Q.distcode=Q.distdyn=new Int32Array(592),Q.sane=1,Q.back=-1,N},D=f=>{if(!f||!f.state)return z;const Q=f.state;return Q.wsize=0,Q.whave=0,Q.wnext=0,q(f)},d=(f,Q)=>{let H;if(!f||!f.state)return z;const X=f.state;return Q<0?(H=0,Q=-Q):(H=1+(Q>>4),Q<48&&(Q&=15)),Q&&(Q<8||Q>15)?z:(null!==X.window&&X.wbits!==Q&&(X.window=null),X.wrap=H,X.wbits=Q,D(f))},s=(f,Q)=>{if(!f)return z;const H=new l;f.state=H,H.window=null;const X=d(f,Q);return X!==N&&(f.state=null),X};let F,P,m=!0;const c=f=>{if(m){F=new Int32Array(512),P=new Int32Array(32);let Q=0;for(;Q<144;)f.lens[Q++]=8;for(;Q<256;)f.lens[Q++]=9;for(;Q<280;)f.lens[Q++]=7;for(;Q<288;)f.lens[Q++]=8;for(x(1,f.lens,0,288,F,0,f.work,{bits:9}),Q=0;Q<32;)f.lens[Q++]=5;x(2,f.lens,0,32,P,0,f.work,{bits:5}),m=!1}f.lencode=F,f.lenbits=9,f.distcode=P,f.distbits=5},W=(f,Q,H,X)=>{let i;const S=f.state;return null===S.window&&(S.wsize=1<<S.wbits,S.wnext=0,S.whave=0,S.window=new Uint8Array(S.wsize)),X>=S.wsize?(S.window.set(Q.subarray(H-S.wsize,H),0),S.wnext=0,S.whave=S.wsize):(i=S.wsize-S.wnext,i>X&&(i=X),S.window.set(Q.subarray(H-X,H-X+i),S.wnext),(X-=i)?(S.window.set(Q.subarray(H-X,H),0),S.wnext=X,S.whave=S.wsize):(S.wnext+=i,S.wnext===S.wsize&&(S.wnext=0),S.whave<S.wsize&&(S.whave+=i))),0};f.exports.inflateReset=D,f.exports.inflateReset2=d,f.exports.inflateResetKeep=q,f.exports.inflateInit=f=>s(f,15),f.exports.inflateInit2=s,f.exports.inflate=(f,Q)=>{let H,l,q,D,d,s,F,P,m,R,U,E,t,u,L,A,a,V,M,r,j,T,k=0;const y=new Uint8Array(4);let h,w;const b=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!f||!f.state||!f.output||!f.input&&0!==f.avail_in)return z;H=f.state,H.mode===e&&(H.mode=13),d=f.next_out,q=f.output,F=f.avail_out,D=f.next_in,l=f.input,s=f.avail_in,P=H.hold,m=H.bits,R=s,U=F,T=N;f:for(;;)switch(H.mode){case 1:if(0===H.wrap){H.mode=13;break}for(;m<16;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}if(2&H.wrap&&35615===P){H.check=0,y[0]=255&P,y[1]=P>>>8&255,H.check=i(H.check,y,2,0),P=0,m=0,H.mode=2;break}if(H.flags=0,H.head&&(H.head.done=!1),!(1&H.wrap)||(((255&P)<<8)+(P>>8))%31){f.msg="incorrect header check",H.mode=G;break}if((15&P)!==n){f.msg="unknown compression method",H.mode=G;break}if(P>>>=4,m-=4,j=8+(15&P),0===H.wbits)H.wbits=j;else if(j>H.wbits){f.msg="invalid window size",H.mode=G;break}H.dmax=1<<H.wbits,f.adler=H.check=1,H.mode=512&P?10:e,P=0,m=0;break;case 2:for(;m<16;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}if(H.flags=P,(255&H.flags)!==n){f.msg="unknown compression method",H.mode=G;break}if(57344&H.flags){f.msg="unknown header flags set",H.mode=G;break}H.head&&(H.head.text=P>>8&1),512&H.flags&&(y[0]=255&P,y[1]=P>>>8&255,H.check=i(H.check,y,2,0)),P=0,m=0,H.mode=3;case 3:for(;m<32;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}H.head&&(H.head.time=P),512&H.flags&&(y[0]=255&P,y[1]=P>>>8&255,y[2]=P>>>16&255,y[3]=P>>>24&255,H.check=i(H.check,y,4,0)),P=0,m=0,H.mode=4;case 4:for(;m<16;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}H.head&&(H.head.xflags=255&P,H.head.os=P>>8),512&H.flags&&(y[0]=255&P,y[1]=P>>>8&255,H.check=i(H.check,y,2,0)),P=0,m=0,H.mode=5;case 5:if(1024&H.flags){for(;m<16;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}H.length=P,H.head&&(H.head.extra_len=P),512&H.flags&&(y[0]=255&P,y[1]=P>>>8&255,H.check=i(H.check,y,2,0)),P=0,m=0}else H.head&&(H.head.extra=null);H.mode=6;case 6:if(1024&H.flags&&(E=H.length,E>s&&(E=s),E&&(H.head&&(j=H.head.extra_len-H.length,H.head.extra||(H.head.extra=new Uint8Array(H.head.extra_len)),H.head.extra.set(l.subarray(D,D+E),j)),512&H.flags&&(H.check=i(H.check,l,E,D)),s-=E,D+=E,H.length-=E),H.length))break f;H.length=0,H.mode=7;case 7:if(2048&H.flags){if(0===s)break f;E=0;do{j=l[D+E++],H.head&&j&&H.length<65536&&(H.head.name+=String.fromCharCode(j))}while(j&&E<s);if(512&H.flags&&(H.check=i(H.check,l,E,D)),s-=E,D+=E,j)break f}else H.head&&(H.head.name=null);H.length=0,H.mode=8;case 8:if(4096&H.flags){if(0===s)break f;E=0;do{j=l[D+E++],H.head&&j&&H.length<65536&&(H.head.comment+=String.fromCharCode(j))}while(j&&E<s);if(512&H.flags&&(H.check=i(H.check,l,E,D)),s-=E,D+=E,j)break f}else H.head&&(H.head.comment=null);H.mode=9;case 9:if(512&H.flags){for(;m<16;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}if(P!==(65535&H.check)){f.msg="header crc mismatch",H.mode=G;break}P=0,m=0}H.head&&(H.head.hcrc=H.flags>>9&1,H.head.done=!0),f.adler=H.check=0,H.mode=e;break;case 10:for(;m<32;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}f.adler=H.check=I(P),P=0,m=0,H.mode=11;case 11:if(0===H.havedict)return f.next_out=d,f.avail_out=F,f.next_in=D,f.avail_in=s,H.hold=P,H.bits=m,g;f.adler=H.check=1,H.mode=e;case e:if(Q===Z||Q===B)break f;case 13:if(H.last){P>>>=7&m,m-=7&m,H.mode=27;break}for(;m<3;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}switch(H.last=1&P,P>>>=1,m-=1,3&P){case 0:H.mode=14;break;case 1:if(c(H),H.mode=20,Q===B){P>>>=2,m-=2;break f}break;case 2:H.mode=17;break;case 3:f.msg="invalid block type",H.mode=G}P>>>=2,m-=2;break;case 14:for(P>>>=7&m,m-=7&m;m<32;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}if((65535&P)!==(P>>>16^65535)){f.msg="invalid stored block lengths",H.mode=G;break}if(H.length=65535&P,P=0,m=0,H.mode=15,Q===B)break f;case 15:H.mode=16;case 16:if(E=H.length,E){if(E>s&&(E=s),E>F&&(E=F),0===E)break f;q.set(l.subarray(D,D+E),d),s-=E,D+=E,F-=E,d+=E,H.length-=E;break}H.mode=e;break;case 17:for(;m<14;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}if(H.nlen=257+(31&P),P>>>=5,m-=5,H.ndist=1+(31&P),P>>>=5,m-=5,H.ncode=4+(15&P),P>>>=4,m-=4,H.nlen>286||H.ndist>30){f.msg="too many length or distance symbols",H.mode=G;break}H.have=0,H.mode=18;case 18:for(;H.have<H.ncode;){for(;m<3;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}H.lens[b[H.have++]]=7&P,P>>>=3,m-=3}for(;H.have<19;)H.lens[b[H.have++]]=0;if(H.lencode=H.lendyn,H.lenbits=7,h={bits:H.lenbits},T=x(0,H.lens,0,19,H.lencode,0,H.work,h),H.lenbits=h.bits,T){f.msg="invalid code lengths set",H.mode=G;break}H.have=0,H.mode=19;case 19:for(;H.have<H.nlen+H.ndist;){for(;k=H.lencode[P&(1<<H.lenbits)-1],L=k>>>24,A=k>>>16&255,a=65535&k,!(L<=m);){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}if(a<16)P>>>=L,m-=L,H.lens[H.have++]=a;else{if(16===a){for(w=L+2;m<w;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}if(P>>>=L,m-=L,0===H.have){f.msg="invalid bit length repeat",H.mode=G;break}j=H.lens[H.have-1],E=3+(3&P),P>>>=2,m-=2}else if(17===a){for(w=L+3;m<w;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}P>>>=L,m-=L,j=0,E=3+(7&P),P>>>=3,m-=3}else{for(w=L+7;m<w;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}P>>>=L,m-=L,j=0,E=11+(127&P),P>>>=7,m-=7}if(H.have+E>H.nlen+H.ndist){f.msg="invalid bit length repeat",H.mode=G;break}for(;E--;)H.lens[H.have++]=j}}if(H.mode===G)break;if(0===H.lens[256]){f.msg="invalid code -- missing end-of-block",H.mode=G;break}if(H.lenbits=9,h={bits:H.lenbits},T=x(1,H.lens,0,H.nlen,H.lencode,0,H.work,h),H.lenbits=h.bits,T){f.msg="invalid literal/lengths set",H.mode=G;break}if(H.distbits=6,H.distcode=H.distdyn,h={bits:H.distbits},T=x(2,H.lens,H.nlen,H.ndist,H.distcode,0,H.work,h),H.distbits=h.bits,T){f.msg="invalid distances set",H.mode=G;break}if(H.mode=20,Q===B)break f;case 20:H.mode=21;case 21:if(s>=6&&F>=258){f.next_out=d,f.avail_out=F,f.next_in=D,f.avail_in=s,H.hold=P,H.bits=m,S(f,U),d=f.next_out,q=f.output,F=f.avail_out,D=f.next_in,l=f.input,s=f.avail_in,P=H.hold,m=H.bits,H.mode===e&&(H.back=-1);break}for(H.back=0;k=H.lencode[P&(1<<H.lenbits)-1],L=k>>>24,A=k>>>16&255,a=65535&k,!(L<=m);){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}if(A&&0===(240&A)){for(V=L,M=A,r=a;k=H.lencode[r+((P&(1<<V+M)-1)>>V)],L=k>>>24,A=k>>>16&255,a=65535&k,!(V+L<=m);){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}P>>>=V,m-=V,H.back+=V}if(P>>>=L,m-=L,H.back+=L,H.length=a,0===A){H.mode=26;break}if(32&A){H.back=-1,H.mode=e;break}if(64&A){f.msg="invalid literal/length code",H.mode=G;break}H.extra=15&A,H.mode=22;case 22:if(H.extra){for(w=H.extra;m<w;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}H.length+=P&(1<<H.extra)-1,P>>>=H.extra,m-=H.extra,H.back+=H.extra}H.was=H.length,H.mode=23;case 23:for(;k=H.distcode[P&(1<<H.distbits)-1],L=k>>>24,A=k>>>16&255,a=65535&k,!(L<=m);){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}if(0===(240&A)){for(V=L,M=A,r=a;k=H.distcode[r+((P&(1<<V+M)-1)>>V)],L=k>>>24,A=k>>>16&255,a=65535&k,!(V+L<=m);){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}P>>>=V,m-=V,H.back+=V}if(P>>>=L,m-=L,H.back+=L,64&A){f.msg="invalid distance code",H.mode=G;break}H.offset=a,H.extra=15&A,H.mode=24;case 24:if(H.extra){for(w=H.extra;m<w;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}H.offset+=P&(1<<H.extra)-1,P>>>=H.extra,m-=H.extra,H.back+=H.extra}if(H.offset>H.dmax){f.msg="invalid distance too far back",H.mode=G;break}H.mode=25;case 25:if(0===F)break f;if(E=U-F,H.offset>E){if(E=H.offset-E,E>H.whave&&H.sane){f.msg="invalid distance too far back",H.mode=G;break}E>H.wnext?(E-=H.wnext,t=H.wsize-E):t=H.wnext-E,E>H.length&&(E=H.length),u=H.window}else u=q,t=d-H.offset,E=H.length;E>F&&(E=F),F-=E,H.length-=E;do{q[d++]=u[t++]}while(--E);0===H.length&&(H.mode=21);break;case 26:if(0===F)break f;q[d++]=H.length,F--,H.mode=21;break;case 27:if(H.wrap){for(;m<32;){if(0===s)break f;s--,P|=l[D++]<<m,m+=8}if(U-=F,f.total_out+=U,H.total+=U,U&&(f.adler=H.check=H.flags?i(H.check,q,U,d-U):X(H.check,q,U,d-U)),U=F,(H.flags?P:I(P))!==H.check){f.msg="incorrect data check",H.mode=G;break}P=0,m=0}H.mode=28;case 28:if(H.wrap&&H.flags){for(;m<32;){if(0===s)break f;s--,P+=l[D++]<<m,m+=8}if(P!==(4294967295&H.total)){f.msg="incorrect length check",H.mode=G;break}P=0,m=0}H.mode=29;case 29:T=J;break f;case G:T=v;break f;case 31:return Y;default:return z}return f.next_out=d,f.avail_out=F,f.next_in=D,f.avail_in=s,H.hold=P,H.bits=m,(H.wsize||U!==f.avail_out&&H.mode<G&&(H.mode<27||Q!==K))&&W(f,f.output,f.next_out,U-f.avail_out)?(H.mode=31,Y):(R-=f.avail_in,U-=f.avail_out,f.total_in+=R,f.total_out+=U,H.total+=U,H.wrap&&U&&(f.adler=H.check=H.flags?i(H.check,q,U,f.next_out-U):X(H.check,q,U,f.next_out-U)),f.data_type=H.bits+(H.last?64:0)+(H.mode===e?128:0)+(20===H.mode||15===H.mode?256:0),(0===R&&0===U||Q===K)&&T===N&&(T=O),T)},f.exports.inflateEnd=f=>{if(!f||!f.state)return z;let Q=f.state;return Q.window&&(Q.window=null),f.state=null,N},f.exports.inflateGetHeader=(f,Q)=>{if(!f||!f.state)return z;const H=f.state;return 0===(2&H.wrap)?z:(H.head=Q,Q.done=!1,N)},f.exports.inflateSetDictionary=(f,Q)=>{const H=Q.length;let i,S,x;return f&&f.state?(i=f.state,0!==i.wrap&&11!==i.mode?z:11===i.mode&&(S=1,S=X(S,Q,H,0),S!==i.check)?v:(x=W(f,Q,H,H),x?(i.mode=31,Y):(i.havedict=1,N))):z},f.exports.inflateInfo="pako inflate (from Nodeca project)"},11255:f=>{"use strict";const Q=15,H=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),X=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),i=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),S=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);f.exports=(f,x,K,Z,B,N,J,g)=>{const z=g.bits;let v,Y,O,n,e,G,I=0,l=0,q=0,D=0,d=0,s=0,F=0,P=0,m=0,c=0,W=null,R=0;const U=new Uint16Array(16),E=new Uint16Array(16);let t,u,L,A=null,a=0;for(I=0;I<=Q;I++)U[I]=0;for(l=0;l<Z;l++)U[x[K+l]]++;for(d=z,D=Q;D>=1&&0===U[D];D--);if(d>D&&(d=D),0===D)return B[N++]=20971520,B[N++]=20971520,g.bits=1,0;for(q=1;q<D&&0===U[q];q++);for(d<q&&(d=q),P=1,I=1;I<=Q;I++)if(P<<=1,P-=U[I],P<0)return-1;if(P>0&&(0===f||1!==D))return-1;for(E[1]=0,I=1;I<Q;I++)E[I+1]=E[I]+U[I];for(l=0;l<Z;l++)0!==x[K+l]&&(J[E[x[K+l]]++]=l);if(0===f?(W=A=J,G=19):1===f?(W=H,R-=257,A=X,a-=257,G=256):(W=i,A=S,G=-1),c=0,l=0,I=q,e=N,s=d,F=0,O=-1,m=1<<d,n=m-1,1===f&&m>852||2===f&&m>592)return 1;for(;;){t=I-F,J[l]<G?(u=0,L=J[l]):J[l]>G?(u=A[a+J[l]],L=W[R+J[l]]):(u=96,L=0),v=1<<I-F,Y=1<<s,q=Y;do{Y-=v,B[e+(c>>F)+Y]=t<<24|u<<16|L}while(0!==Y);for(v=1<<I-1;c&v;)v>>=1;if(0!==v?(c&=v-1,c+=v):c=0,l++,0===--U[I]){if(I===D)break;I=x[K+J[l]]}if(I>d&&(c&n)!==O){for(0===F&&(F=d),e+=q,s=I-F,P=1<<s;s+F<D&&(P-=U[s+F],!(P<=0));)s++,P<<=1;if(m+=1<<s,1===f&&m>852||2===f&&m>592)return 1;O=c&n,B[O]=d<<24|s<<16|e-N}}return 0!==c&&(B[e+c]=I-F<<24|64<<16),g.bits=d,0}},11215:f=>{"use strict";f.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11194:f=>{"use strict";function Q(f){let Q=f.length;for(;--Q>=0;)f[Q]=0}const H=256,X=286,i=30,S=15,x=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),K=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Z=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),B=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),N=new Array(576);Q(N);const J=new Array(60);Q(J);const g=new Array(512);Q(g);const z=new Array(256);Q(z);const v=new Array(29);Q(v);const Y=new Array(i);function O(f,Q,H,X,i){this.static_tree=f,this.extra_bits=Q,this.extra_base=H,this.elems=X,this.max_length=i,this.has_stree=f&&f.length}let n,e,G;function I(f,Q){this.dyn_tree=f,this.max_code=0,this.stat_desc=Q}Q(Y);const l=f=>f<256?g[f]:g[256+(f>>>7)],q=(f,Q)=>{f.pending_buf[f.pending++]=255&Q,f.pending_buf[f.pending++]=Q>>>8&255},D=(f,Q,H)=>{f.bi_valid>16-H?(f.bi_buf|=Q<<f.bi_valid&65535,q(f,f.bi_buf),f.bi_buf=Q>>16-f.bi_valid,f.bi_valid+=H-16):(f.bi_buf|=Q<<f.bi_valid&65535,f.bi_valid+=H)},d=(f,Q,H)=>{D(f,H[2*Q],H[2*Q+1])},s=(f,Q)=>{let H=0;do{H|=1&f,f>>>=1,H<<=1}while(--Q>0);return H>>>1},F=(f,Q,H)=>{const X=new Array(16);let i,x,K=0;for(i=1;i<=S;i++)X[i]=K=K+H[i-1]<<1;for(x=0;x<=Q;x++){let Q=f[2*x+1];0!==Q&&(f[2*x]=s(X[Q]++,Q))}},P=f=>{let Q;for(Q=0;Q<X;Q++)f.dyn_ltree[2*Q]=0;for(Q=0;Q<i;Q++)f.dyn_dtree[2*Q]=0;for(Q=0;Q<19;Q++)f.bl_tree[2*Q]=0;f.dyn_ltree[512]=1,f.opt_len=f.static_len=0,f.last_lit=f.matches=0},m=f=>{f.bi_valid>8?q(f,f.bi_buf):f.bi_valid>0&&(f.pending_buf[f.pending++]=f.bi_buf),f.bi_buf=0,f.bi_valid=0},c=(f,Q,H,X)=>{const i=2*Q,S=2*H;return f[i]<f[S]||f[i]===f[S]&&X[Q]<=X[H]},W=(f,Q,H)=>{const X=f.heap[H];let i=H<<1;for(;i<=f.heap_len&&(i<f.heap_len&&c(Q,f.heap[i+1],f.heap[i],f.depth)&&i++,!c(Q,X,f.heap[i],f.depth));)f.heap[H]=f.heap[i],H=i,i<<=1;f.heap[H]=X},R=(f,Q,X)=>{let i,S,Z,B,N=0;if(0!==f.last_lit)do{i=f.pending_buf[f.d_buf+2*N]<<8|f.pending_buf[f.d_buf+2*N+1],S=f.pending_buf[f.l_buf+N],N++,0===i?d(f,S,Q):(Z=z[S],d(f,Z+H+1,Q),B=x[Z],0!==B&&(S-=v[Z],D(f,S,B)),i--,Z=l(i),d(f,Z,X),B=K[Z],0!==B&&(i-=Y[Z],D(f,i,B)))}while(N<f.last_lit);d(f,256,Q)},U=(f,Q)=>{const H=Q.dyn_tree,X=Q.stat_desc.static_tree,i=Q.stat_desc.has_stree,x=Q.stat_desc.elems;let K,Z,B,N=-1;for(f.heap_len=0,f.heap_max=573,K=0;K<x;K++)0!==H[2*K]?(f.heap[++f.heap_len]=N=K,f.depth[K]=0):H[2*K+1]=0;for(;f.heap_len<2;)B=f.heap[++f.heap_len]=N<2?++N:0,H[2*B]=1,f.depth[B]=0,f.opt_len--,i&&(f.static_len-=X[2*B+1]);for(Q.max_code=N,K=f.heap_len>>1;K>=1;K--)W(f,H,K);B=x;do{K=f.heap[1],f.heap[1]=f.heap[f.heap_len--],W(f,H,1),Z=f.heap[1],f.heap[--f.heap_max]=K,f.heap[--f.heap_max]=Z,H[2*B]=H[2*K]+H[2*Z],f.depth[B]=(f.depth[K]>=f.depth[Z]?f.depth[K]:f.depth[Z])+1,H[2*K+1]=H[2*Z+1]=B,f.heap[1]=B++,W(f,H,1)}while(f.heap_len>=2);f.heap[--f.heap_max]=f.heap[1],((f,Q)=>{const H=Q.dyn_tree,X=Q.max_code,i=Q.stat_desc.static_tree,x=Q.stat_desc.has_stree,K=Q.stat_desc.extra_bits,Z=Q.stat_desc.extra_base,B=Q.stat_desc.max_length;let N,J,g,z,v,Y,O=0;for(z=0;z<=S;z++)f.bl_count[z]=0;for(H[2*f.heap[f.heap_max]+1]=0,N=f.heap_max+1;N<573;N++)J=f.heap[N],z=H[2*H[2*J+1]+1]+1,z>B&&(z=B,O++),H[2*J+1]=z,J>X||(f.bl_count[z]++,v=0,J>=Z&&(v=K[J-Z]),Y=H[2*J],f.opt_len+=Y*(z+v),x&&(f.static_len+=Y*(i[2*J+1]+v)));if(0!==O){do{for(z=B-1;0===f.bl_count[z];)z--;f.bl_count[z]--,f.bl_count[z+1]+=2,f.bl_count[B]--,O-=2}while(O>0);for(z=B;0!==z;z--)for(J=f.bl_count[z];0!==J;)g=f.heap[--N],g>X||(H[2*g+1]!==z&&(f.opt_len+=(z-H[2*g+1])*H[2*g],H[2*g+1]=z),J--)}})(f,Q),F(H,N,f.bl_count)},E=(f,Q,H)=>{let X,i,S=-1,x=Q[1],K=0,Z=7,B=4;for(0===x&&(Z=138,B=3),Q[2*(H+1)+1]=65535,X=0;X<=H;X++)i=x,x=Q[2*(X+1)+1],++K<Z&&i===x||(K<B?f.bl_tree[2*i]+=K:0!==i?(i!==S&&f.bl_tree[2*i]++,f.bl_tree[32]++):K<=10?f.bl_tree[34]++:f.bl_tree[36]++,K=0,S=i,0===x?(Z=138,B=3):i===x?(Z=6,B=3):(Z=7,B=4))},t=(f,Q,H)=>{let X,i,S=-1,x=Q[1],K=0,Z=7,B=4;for(0===x&&(Z=138,B=3),X=0;X<=H;X++)if(i=x,x=Q[2*(X+1)+1],!(++K<Z&&i===x)){if(K<B)do{d(f,i,f.bl_tree)}while(0!==--K);else 0!==i?(i!==S&&(d(f,i,f.bl_tree),K--),d(f,16,f.bl_tree),D(f,K-3,2)):K<=10?(d(f,17,f.bl_tree),D(f,K-3,3)):(d(f,18,f.bl_tree),D(f,K-11,7));K=0,S=i,0===x?(Z=138,B=3):i===x?(Z=6,B=3):(Z=7,B=4)}};let u=!1;const L=(f,Q,H,X)=>{D(f,0+(X?1:0),3),((f,Q,H,X)=>{m(f),X&&(q(f,H),q(f,~H)),f.pending_buf.set(f.window.subarray(Q,Q+H),f.pending),f.pending+=H})(f,Q,H,!0)};f.exports._tr_init=f=>{u||((()=>{let f,Q,H,B,I;const l=new Array(16);for(H=0,B=0;B<28;B++)for(v[B]=H,f=0;f<1<<x[B];f++)z[H++]=B;for(z[H-1]=B,I=0,B=0;B<16;B++)for(Y[B]=I,f=0;f<1<<K[B];f++)g[I++]=B;for(I>>=7;B<i;B++)for(Y[B]=I<<7,f=0;f<1<<K[B]-7;f++)g[256+I++]=B;for(Q=0;Q<=S;Q++)l[Q]=0;for(f=0;f<=143;)N[2*f+1]=8,f++,l[8]++;for(;f<=255;)N[2*f+1]=9,f++,l[9]++;for(;f<=279;)N[2*f+1]=7,f++,l[7]++;for(;f<=287;)N[2*f+1]=8,f++,l[8]++;for(F(N,287,l),f=0;f<i;f++)J[2*f+1]=5,J[2*f]=s(f,5);n=new O(N,x,257,X,S),e=new O(J,K,0,i,S),G=new O(new Array(0),Z,0,19,7)})(),u=!0),f.l_desc=new I(f.dyn_ltree,n),f.d_desc=new I(f.dyn_dtree,e),f.bl_desc=new I(f.bl_tree,G),f.bi_buf=0,f.bi_valid=0,P(f)},f.exports._tr_stored_block=L,f.exports._tr_flush_block=(f,Q,X,i)=>{let S,x,K=0;f.level>0?(2===f.strm.data_type&&(f.strm.data_type=(f=>{let Q,X=4093624447;for(Q=0;Q<=31;Q++,X>>>=1)if(1&X&&0!==f.dyn_ltree[2*Q])return 0;if(0!==f.dyn_ltree[18]||0!==f.dyn_ltree[20]||0!==f.dyn_ltree[26])return 1;for(Q=32;Q<H;Q++)if(0!==f.dyn_ltree[2*Q])return 1;return 0})(f)),U(f,f.l_desc),U(f,f.d_desc),K=(f=>{let Q;for(E(f,f.dyn_ltree,f.l_desc.max_code),E(f,f.dyn_dtree,f.d_desc.max_code),U(f,f.bl_desc),Q=18;Q>=3&&0===f.bl_tree[2*B[Q]+1];Q--);return f.opt_len+=3*(Q+1)+5+5+4,Q})(f),S=f.opt_len+3+7>>>3,x=f.static_len+3+7>>>3,x<=S&&(S=x)):S=x=X+5,X+4<=S&&-1!==Q?L(f,Q,X,i):4===f.strategy||x===S?(D(f,2+(i?1:0),3),R(f,N,J)):(D(f,4+(i?1:0),3),((f,Q,H,X)=>{let i;for(D(f,Q-257,5),D(f,H-1,5),D(f,X-4,4),i=0;i<X;i++)D(f,f.bl_tree[2*B[i]+1],3);t(f,f.dyn_ltree,Q-1),t(f,f.dyn_dtree,H-1)})(f,f.l_desc.max_code+1,f.d_desc.max_code+1,K+1),R(f,f.dyn_ltree,f.dyn_dtree)),P(f),i&&m(f)},f.exports._tr_tally=(f,Q,X)=>(f.pending_buf[f.d_buf+2*f.last_lit]=Q>>>8&255,f.pending_buf[f.d_buf+2*f.last_lit+1]=255&Q,f.pending_buf[f.l_buf+f.last_lit]=255&X,f.last_lit++,0===Q?f.dyn_ltree[2*X]++:(f.matches++,Q--,f.dyn_ltree[2*(z[X]+H+1)]++,f.dyn_dtree[2*l(Q)]++),f.last_lit===f.lit_bufsize-1),f.exports._tr_align=f=>{D(f,2,3),d(f,256,N),(f=>{16===f.bi_valid?(q(f,f.bi_buf),f.bi_buf=0,f.bi_valid=0):f.bi_valid>=8&&(f.pending_buf[f.pending++]=255&f.bi_buf,f.bi_buf>>=8,f.bi_valid-=8)})(f)}},11232:f=>{"use strict";f.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11591:f=>{function Q(f,Q,H){for(var X=f.length,i=-1/0,S=1/0,x=0;x<X;x++){var K=(H[0][x]-f[x])/Q[x],Z=(H[1][x]-f[x])/Q[x];if(K>Z){var B=K;K=Z,Z=B}if(Z<i||K>S)return 1/0;K>i&&(i=K),Z<S&&(S=Z)}return i>S?1/0:i}f.exports=function(f,H,X,i){var S=Q(H,X,i);if(S===1/0)f=null;else{f=f||[];for(var x=0;x<H.length;x++)f[x]=H[x]+X[x]*S}return f},f.exports.distance=Q},12239:(f,Q,H)=>{"use strict";H.d(Q,{b:()=>S});var X=H(41),i=H(2453),S=function(f){var Q=(0,i.d)(f);(0,X.useEffect)((function(){var f=function(f){var H;if(null!=Q.current&&(H=Q.current(f)),f.defaultPrevented&&(f.returnValue=""),"string"===typeof H)return f.returnValue=H,H};return window.addEventListener("beforeunload",f),function(){window.removeEventListener("beforeunload",f)}}),[])}},12197:(f,Q,H)=>{"use strict";var X=H(12200),i=Array.prototype.concat,S=Array.prototype.slice,x=f.exports=function(f){for(var Q=[],H=0,x=f.length;H<x;H++){var K=f[H];X(K)?Q=i.call(Q,S.call(K)):Q.push(K)}return Q};x.wrap=function(f){return function(){return f(x(arguments))}}},12200:f=>{f.exports=function(f){return!(!f||"string"===typeof f)&&(f instanceof Array||Array.isArray(f)||f.length>=0&&(f.splice instanceof Function||Object.getOwnPropertyDescriptor(f,f.length-1)&&"String"!==f.constructor.name))}},11138:(f,Q,H)=>{var X=H(11144);function i(f){for(var Q,H,i=0,S=f.length,x=0;x<f.length;){for(Q=f[x],H=0;x<S&&f[x]===Q;)++x,++H;i+=X.log2(H)/7|0,i+=X.log2(Q>>>0)/7|0,i+=2}return i}Q.size=i,Q.encode=function(f,Q){Q||(Q=new Uint8Array(i(f)));for(var H,X,S=0,x=Q.length,K=0;K<f.length;){for(H=f[K],X=0;K<f.length&&f[K]===H;)++K,++X;for(;S<x&&X>=128;)Q[S++]=128+(127&X),X>>>=7;if(S>=x)throw new Error("RLE buffer overflow");for(Q[S++]=X,H>>>=0;S<x&&H>=128;)Q[S++]=128+(127&H),H>>>=7;if(S>=x)throw new Error("RLE buffer overflow");Q[S++]=H}return Q},Q.decode=function(f,Q){for(var H,X,i,S,x=Q.length,K=f.length,Z=0,B=0;B<K;){for(H=0,X=0;B<K&&f[B]>=128;)H+=(127&f[B++])<<X,X+=7;if(H+=f[B++]<<X,B>=K)throw new Error("RLE buffer underrun");if(Z+H>x)throw new Error("Chunk buffer overflow");for(i=0,X=0;B<K&&f[B]>=128;)i+=(127&f[B++])<<X,X+=7;if(B>=K)throw new Error("RLE buffer underrun");for(i+=f[B++]<<X,S=0;S<H;++S)Q[Z++]=i}return Q}},11144:(f,Q)=>{"use strict";function H(f){var Q=32;return(f&=-f)&&Q--,65535&f&&(Q-=16),16711935&f&&(Q-=8),252645135&f&&(Q-=4),858993459&f&&(Q-=2),1431655765&f&&(Q-=1),Q}Q.INT_BITS=32,Q.INT_MAX=2147483647,Q.INT_MIN=-1<<31,Q.sign=function(f){return(f>0)-(f<0)},Q.abs=function(f){var Q=f>>31;return(f^Q)-Q},Q.min=function(f,Q){return Q^(f^Q)&-(f<Q)},Q.max=function(f,Q){return f^(f^Q)&-(f<Q)},Q.isPow2=function(f){return!(f&f-1)&&!!f},Q.log2=function(f){var Q,H;return Q=(f>65535)<<4,Q|=H=((f>>>=Q)>255)<<3,Q|=H=((f>>>=H)>15)<<2,(Q|=H=((f>>>=H)>3)<<1)|(f>>>=H)>>1},Q.log10=function(f){return f>=1e9?9:f>=1e8?8:f>=1e7?7:f>=1e6?6:f>=1e5?5:f>=1e4?4:f>=1e3?3:f>=100?2:f>=10?1:0},Q.popCount=function(f){return 16843009*((f=(858993459&(f-=f>>>1&1431655765))+(f>>>2&858993459))+(f>>>4)&252645135)>>>24},Q.countTrailingZeros=H,Q.nextPow2=function(f){return f+=0===f,--f,f|=f>>>1,f|=f>>>2,f|=f>>>4,f|=f>>>8,(f|=f>>>16)+1},Q.prevPow2=function(f){return f|=f>>>1,f|=f>>>2,f|=f>>>4,f|=f>>>8,(f|=f>>>16)-(f>>>1)},Q.parity=function(f){return f^=f>>>16,f^=f>>>8,f^=f>>>4,27030>>>(f&=15)&1};var X=new Array(256);!function(f){for(var Q=0;Q<256;++Q){var H=Q,X=Q,i=7;for(H>>>=1;H;H>>>=1)X<<=1,X|=1&H,--i;f[Q]=X<<i&255}}(X),Q.reverse=function(f){return X[255&f]<<24|X[f>>>8&255]<<16|X[f>>>16&255]<<8|X[f>>>24&255]},Q.interleave2=function(f,Q){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f&=65535)|f<<8))|f<<4))|f<<2))|f<<1))|(Q=1431655765&((Q=858993459&((Q=252645135&((Q=16711935&((Q&=65535)|Q<<8))|Q<<4))|Q<<2))|Q<<1))<<1},Q.deinterleave2=function(f,Q){return(f=65535&((f=16711935&((f=252645135&((f=858993459&((f=f>>>Q&1431655765)|f>>>1))|f>>>2))|f>>>4))|f>>>16))<<16>>16},Q.interleave3=function(f,Q,H){return f=1227133513&((f=3272356035&((f=251719695&((f=4278190335&((f&=1023)|f<<16))|f<<8))|f<<4))|f<<2),(f|=(Q=1227133513&((Q=3272356035&((Q=251719695&((Q=4278190335&((Q&=1023)|Q<<16))|Q<<8))|Q<<4))|Q<<2))<<1)|(H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2))<<2},Q.deinterleave3=function(f,Q){return(f=1023&((f=4278190335&((f=251719695&((f=3272356035&((f=f>>>Q&1227133513)|f>>>2))|f>>>4))|f>>>8))|f>>>16))<<22>>22},Q.nextCombination=function(f){var Q=f|f-1;return Q+1|(~Q&-~Q)-1>>>H(f)+1}},11171:f=>{"use strict";f.exports=function(f,Q,H,X){var i=self||window;try{try{var S;try{S=new i.Blob([f])}catch(B){(S=new(i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder)).append(f),S=S.getBlob()}var x=i.URL||i.webkitURL,K=x.createObjectURL(S),Z=new i[Q](K,H);return x.revokeObjectURL(K),Z}catch(B){return new i[Q]("data:application/javascript,".concat(encodeURIComponent(f)),H)}}catch(B){if(!X)throw Error("Inline worker is not supported");return new i[Q](X,H)}}},11576:(f,Q,H)=>{"use strict";function X(f,Q,H,X,i){var S={};return Object.keys(X).forEach((function(f){S[f]=X[f]})),S.enumerable=!!S.enumerable,S.configurable=!!S.configurable,("value"in S||S.initializer)&&(S.writable=!0),S=H.slice().reverse().reduce((function(H,X){return X(f,Q,H)||H}),S),i&&void 0!==S.initializer&&(S.value=S.initializer?S.initializer.call(i):void 0,S.initializer=void 0),void 0===S.initializer&&(Object.defineProperty(f,Q,S),S=null),S}H.d(Q,{b:()=>X})},11572:(f,Q,H)=>{"use strict";function X(f,Q,H,X){H&&Object.defineProperty(f,Q,{enumerable:H.enumerable,configurable:H.configurable,writable:H.writable,value:H.initializer?H.initializer.call(X):void 0})}H.d(Q,{c:()=>X})},11903:(f,Q,H)=>{"use strict";H.d(Q,{d:()=>G,f:()=>O,h:()=>n,l:()=>g,m:()=>Y,p:()=>v,r:()=>z});var X=H(1003),i=H(1161),S=H(1034),x=H(1022),K=H(11911),Z=H(11314),B=H(1146),N=H(1055),J=H(1151);const g=Object.freeze(new X.i(0,0,0,0)),z=Object.freeze(X.p.Zero()),v=Object.freeze(X.m.Zero()),Y=Object.freeze(B.e.Zero()),O=Object.freeze(i.e.Black()),n=Object.freeze(new i.h(0,0,0,0)),e={key:0,repeatCount:0,loopMode:2};class G{static _PrepareAnimation(f,Q,H,S,x,K,Z,N){let J;if(!isNaN(parseFloat(x))&&isFinite(x)?J=G.ANIMATIONTYPE_FLOAT:x instanceof X.i?J=G.ANIMATIONTYPE_QUATERNION:x instanceof X.p?J=G.ANIMATIONTYPE_VECTOR3:x instanceof X.m?J=G.ANIMATIONTYPE_VECTOR2:x instanceof i.e?J=G.ANIMATIONTYPE_COLOR3:x instanceof i.h?J=G.ANIMATIONTYPE_COLOR4:x instanceof B.e&&(J=G.ANIMATIONTYPE_SIZE),void 0==J)return null;const g=new G(f,Q,H,J,Z),z=[{frame:0,value:x},{frame:S,value:K}];return g.setKeys(z),void 0!==N&&g.setEasingFunction(N),g}static CreateAnimation(f,Q,H,X){const i=new G(f+"Animation",f,H,Q,G.ANIMATIONLOOPMODE_CONSTANT);return i.setEasingFunction(X),i}static CreateAndStartAnimation(f,Q,H,X,i,S,x,K,Z,B,N){const J=G._PrepareAnimation(f,H,X,i,S,x,K,Z);return J?(Q.va&&(N=Q.va()),N?N.beginDirectAnimation(Q,[J],0,i,1===J.loopMode,1,B):null):null}static CreateAndStartHierarchyAnimation(f,Q,H,X,i,S,x,K,Z,B,N){const J=G._PrepareAnimation(f,X,i,S,x,K,Z,B);if(!J)return null;return Q.va().beginDirectHierarchyAnimation(Q,H,[J],0,S,1===J.loopMode,1,N)}static CreateMergeAndStartAnimation(f,Q,H,X,i,S,x,K,Z,B){const N=G._PrepareAnimation(f,H,X,i,S,x,K,Z);return N?(Q.animations.push(N),Q.va().beginAnimation(Q,0,i,1===N.loopMode,1,B)):null}static MakeAnimationAdditive(f,Q,H){let i;i="object"===typeof Q?Q:{referenceFrame:Q??0,range:H,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let S=f;if(i.cloneOriginalAnimation&&(S=f.clone(),S.name=i.clonedAnimationName||S.name),!S._keys.length)return S;const x=i.referenceFrame&&i.referenceFrame>=0?i.referenceFrame:0;let K=0;const Z=S._keys[0];let B=S._keys.length-1;const N=S._keys[B],J={referenceValue:Z.value,referencePosition:X.l.Wd[0],referenceQuaternion:X.l.Quaternion[0],referenceScaling:X.l.Wd[1],keyPosition:X.l.Wd[2],keyQuaternion:X.l.Quaternion[1],keyScaling:X.l.Wd[3]};let g=Z.frame,z=N.frame;if(i.range){const f=S.getRange(i.range);f&&(g=f.from,z=f.to)}else g=i.fromFrame??g,z=i.toFrame??z;if(g!==Z.frame&&(K=S.createKeyForFrame(g)),z!==N.frame&&(B=S.createKeyForFrame(z)),1===S._keys.length){const f=S._getKeyValue(S._keys[0]);J.referenceValue=f.clone?f.clone():f}else if(x<=Z.frame){const f=S._getKeyValue(Z.value);J.referenceValue=f.clone?f.clone():f}else if(x>=N.frame){const f=S._getKeyValue(N.value);J.referenceValue=f.clone?f.clone():f}else{e.key=0;const f=S._interpolate(x,e);J.referenceValue=f.clone?f.clone():f}S.dataType===G.ANIMATIONTYPE_QUATERNION?J.referenceValue.normalize().conjugateInPlace():S.dataType===G.ANIMATIONTYPE_MATRIX&&(J.referenceValue.decompose(J.referenceScaling,J.referenceQuaternion,J.referencePosition),J.referenceQuaternion.normalize().conjugateInPlace());let v=Number.MAX_VALUE;const Y=i.clipKeys?[]:null;for(let O=K;O<=B;O++){let f=S._keys[O];if((Y||i.cloneOriginalAnimation)&&(f={frame:f.frame,value:f.value.clone?f.value.clone():f.value,inTangent:f.inTangent,outTangent:f.outTangent,interpolation:f.interpolation,lockedTangent:f.lockedTangent},Y&&(v===Number.MAX_VALUE&&(v=f.frame),f.frame-=v,Y.push(f))),!O||S.dataType===G.ANIMATIONTYPE_FLOAT||f.value!==Z.value)switch(S.dataType){case G.ANIMATIONTYPE_MATRIX:f.value.decompose(J.keyScaling,J.keyQuaternion,J.keyPosition),J.keyPosition.be(J.referencePosition),J.keyScaling.divideInPlace(J.referenceScaling),J.referenceQuaternion.multiplyToRef(J.keyQuaternion,J.keyQuaternion),X.e.ComposeToRef(J.keyScaling,J.keyQuaternion,J.keyPosition,f.value);break;case G.ANIMATIONTYPE_QUATERNION:J.referenceValue.multiplyToRef(f.value,f.value);break;case G.ANIMATIONTYPE_VECTOR2:case G.ANIMATIONTYPE_VECTOR3:case G.ANIMATIONTYPE_COLOR3:case G.ANIMATIONTYPE_COLOR4:f.value.subtractToRef(J.referenceValue,f.value);break;case G.ANIMATIONTYPE_SIZE:f.value.width-=J.referenceValue.width,f.value.height-=J.referenceValue.height;break;default:f.value-=J.referenceValue}}return Y&&S.setKeys(Y,!0),S}static TransitionTo(f,Q,H,X,i,S,x){let K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(x<=0)return H[f]=Q,K&&K(),null;const Z=i*(x/1e3);S.setKeys([{frame:0,value:H[f].clone?H[f].clone():H[f]},{frame:Z,value:Q}]),H.animations||(H.animations=[]),H.animations.push(S);const B=X.beginAnimation(H,0,Z,!1);return B.onAnimationEnd=K,B}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const f of this._runtimeAnimations)if(!f.isStopped())return!0;return!1}constructor(f,Q,H,X,i,S){this.name=f,this.targetProperty=Q,this.framePerSecond=H,this.dataType=X,this.loopMode=i,this.enableBlending=S,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=Q.split("."),this.dataType=X,this.loopMode=void 0===i?G.ANIMATIONLOOPMODE_CYCLE:i,this.uniqueId=G._UniqueIdGenerator++}toString(f){let Q="Name: "+this.name+", property: "+this.targetProperty;if(Q+=", datatype: "+["Float","Wd","Quaternion","Matrix","Fe","Vector2"][this.dataType],Q+=", nKeys: "+(this._keys?this._keys.length:"none"),Q+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),f){Q+=", Ranges: {";let f=!0;for(const H in this._ranges)f&&(Q+=", ",f=!1),Q+=H;Q+="}"}return Q}addEvent(f){this._events.push(f),this._events.sort(((f,Q)=>f.frame-Q.frame))}removeEvents(f){for(let Q=0;Q<this._events.length;Q++)this._events[Q].frame===f&&(this._events.splice(Q,1),Q--)}getEvents(){return this._events}createRange(f,Q,H){this._ranges[f]||(this._ranges[f]=new K.c(f,Q,H))}deleteRange(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const H=this._ranges[f];if(H){if(Q){const f=H.from,Q=H.to;for(let H=this._keys.length-1;H>=0;H--)this._keys[H].frame>=f&&this._keys[H].frame<=Q&&this._keys.splice(H,1)}this._ranges[f]=null}}getRange(f){return this._ranges[f]}getKeys(){return this._keys}getHighestFrame(){let f=0;for(let Q=0,H=this._keys.length;Q<H;Q++)f<this._keys[Q].frame&&(f=this._keys[Q].frame);return f}getEasingFunction(){return this._easingFunction}setEasingFunction(f){this._easingFunction=f}floatInterpolateFunction(f,Q,H){return(0,S.n)(f,Q,H)}floatInterpolateFunctionWithTangents(f,Q,H,X,i){return(0,S.f)(f,Q,H,X,i)}quaternionInterpolateFunction(f,Q,H){return X.i.Slerp(f,Q,H)}quaternionInterpolateFunctionWithTangents(f,Q,H,i,S){return X.i.Hermite(f,Q,H,i,S).normalize()}vector3InterpolateFunction(f,Q,H){return X.p.Lerp(f,Q,H)}vector3InterpolateFunctionWithTangents(f,Q,H,i,S){return X.p.Hermite(f,Q,H,i,S)}vector2InterpolateFunction(f,Q,H){return X.m.Lerp(f,Q,H)}vector2InterpolateFunctionWithTangents(f,Q,H,i,S){return X.m.Hermite(f,Q,H,i,S)}sizeInterpolateFunction(f,Q,H){return B.e.Lerp(f,Q,H)}color3InterpolateFunction(f,Q,H){return i.e.Lerp(f,Q,H)}color3InterpolateFunctionWithTangents(f,Q,H,X,S){return i.e.Hermite(f,Q,H,X,S)}color4InterpolateFunction(f,Q,H){return i.h.Lerp(f,Q,H)}color4InterpolateFunctionWithTangents(f,Q,H,X,S){return i.h.Hermite(f,Q,H,X,S)}_getKeyValue(f){return"function"===typeof f?f():f}evaluate(f){return e.key=0,this._interpolate(f,e)}_interpolate(f,Q){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Q.loopMode===G.ANIMATIONLOOPMODE_CONSTANT&&Q.repeatCount>0)return Q.highLimitValue.clone?Q.highLimitValue.clone():Q.highLimitValue;const X=this._keys,i=X.length;let S=Q.key;for(;S>=0&&f<X[S].frame;)--S;for(;S+1<=i-1&&f>=X[S+1].frame;)++S;if(Q.key=S,S<0)return H?void 0:this._getKeyValue(X[0].value);if(S+1>i-1)return H?void 0:this._getKeyValue(X[i-1].value);const x=X[S],K=X[S+1];if(H&&(f===x.frame||f===K.frame))return;const Z=this._getKeyValue(x.value),B=this._getKeyValue(K.value);if(1===x.interpolation)return K.frame>f?Z:B;const N=void 0!==x.outTangent&&void 0!==K.inTangent,J=K.frame-x.frame;let e=(f-x.frame)/J;const I=x.easingFunction||this.getEasingFunction();switch(null!==I&&(e=I.ease(e)),this.dataType){case G.ANIMATIONTYPE_FLOAT:{const f=N?this.floatInterpolateFunctionWithTangents(Z,x.outTangent*J,B,K.inTangent*J,e):this.floatInterpolateFunction(Z,B,e);switch(Q.loopMode){case G.ANIMATIONLOOPMODE_CYCLE:case G.ANIMATIONLOOPMODE_CONSTANT:case G.ANIMATIONLOOPMODE_YOYO:return f;case G.ANIMATIONLOOPMODE_RELATIVE:case G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(Q.offsetValue??0)*Q.repeatCount+f}break}case G.ANIMATIONTYPE_QUATERNION:{const f=N?this.quaternionInterpolateFunctionWithTangents(Z,x.outTangent.scale(J),B,K.inTangent.scale(J),e):this.quaternionInterpolateFunction(Z,B,e);switch(Q.loopMode){case G.ANIMATIONLOOPMODE_CYCLE:case G.ANIMATIONLOOPMODE_CONSTANT:case G.ANIMATIONLOOPMODE_YOYO:return f;case G.ANIMATIONLOOPMODE_RELATIVE:case G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return f.addInPlace((Q.offsetValue||g).scale(Q.repeatCount))}return f}case G.ANIMATIONTYPE_VECTOR3:{const f=N?this.vector3InterpolateFunctionWithTangents(Z,x.outTangent.scale(J),B,K.inTangent.scale(J),e):this.vector3InterpolateFunction(Z,B,e);switch(Q.loopMode){case G.ANIMATIONLOOPMODE_CYCLE:case G.ANIMATIONLOOPMODE_CONSTANT:case G.ANIMATIONLOOPMODE_YOYO:return f;case G.ANIMATIONLOOPMODE_RELATIVE:case G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return f.add((Q.offsetValue||z).scale(Q.repeatCount))}break}case G.ANIMATIONTYPE_VECTOR2:{const f=N?this.vector2InterpolateFunctionWithTangents(Z,x.outTangent.scale(J),B,K.inTangent.scale(J),e):this.vector2InterpolateFunction(Z,B,e);switch(Q.loopMode){case G.ANIMATIONLOOPMODE_CYCLE:case G.ANIMATIONLOOPMODE_CONSTANT:case G.ANIMATIONLOOPMODE_YOYO:return f;case G.ANIMATIONLOOPMODE_RELATIVE:case G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return f.add((Q.offsetValue||v).scale(Q.repeatCount))}break}case G.ANIMATIONTYPE_SIZE:switch(Q.loopMode){case G.ANIMATIONLOOPMODE_CYCLE:case G.ANIMATIONLOOPMODE_CONSTANT:case G.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(Z,B,e);case G.ANIMATIONLOOPMODE_RELATIVE:case G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(Z,B,e).add((Q.offsetValue||Y).scale(Q.repeatCount))}break;case G.ANIMATIONTYPE_COLOR3:{const f=N?this.color3InterpolateFunctionWithTangents(Z,x.outTangent.scale(J),B,K.inTangent.scale(J),e):this.color3InterpolateFunction(Z,B,e);switch(Q.loopMode){case G.ANIMATIONLOOPMODE_CYCLE:case G.ANIMATIONLOOPMODE_CONSTANT:case G.ANIMATIONLOOPMODE_YOYO:return f;case G.ANIMATIONLOOPMODE_RELATIVE:case G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return f.add((Q.offsetValue||O).scale(Q.repeatCount))}break}case G.ANIMATIONTYPE_COLOR4:{const f=N?this.color4InterpolateFunctionWithTangents(Z,x.outTangent.scale(J),B,K.inTangent.scale(J),e):this.color4InterpolateFunction(Z,B,e);switch(Q.loopMode){case G.ANIMATIONLOOPMODE_CYCLE:case G.ANIMATIONLOOPMODE_CONSTANT:case G.ANIMATIONLOOPMODE_YOYO:return f;case G.ANIMATIONLOOPMODE_RELATIVE:case G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return f.add((Q.offsetValue||n).scale(Q.repeatCount))}break}case G.ANIMATIONTYPE_MATRIX:switch(Q.loopMode){case G.ANIMATIONLOOPMODE_CYCLE:case G.ANIMATIONLOOPMODE_CONSTANT:case G.ANIMATIONLOOPMODE_YOYO:return G.AllowMatricesInterpolation?this.matrixInterpolateFunction(Z,B,e,Q.workValue):Z;case G.ANIMATIONLOOPMODE_RELATIVE:case G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return Z}}return 0}matrixInterpolateFunction(f,Q,H,i){return G.AllowMatrixDecomposeForInterpolation?i?(X.e.DecomposeLerpToRef(f,Q,H,i),i):X.e.DecomposeLerp(f,Q,H):i?(X.e.LerpToRef(f,Q,H,i),i):X.e.Lerp(f,Q,H)}clone(){const f=new G(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(f.enableBlending=this.enableBlending,f.blendingSpeed=this.blendingSpeed,this._keys&&f.setKeys(this._keys),this._ranges){f._ranges={};for(const Q in this._ranges){const H=this._ranges[Q];H&&(f._ranges[Q]=H.clone())}}return f}setKeys(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=Q?f:f.slice(0)}createKeyForFrame(f){e.key=0;const Q=this._interpolate(f,e,!0);if(!Q)return this._keys[e.key].frame===f?e.key:e.key+1;const H={frame:f,value:Q.clone?Q.clone():Q};return this._keys.splice(e.key+1,0,H),e.key+1}serialize(){const f={};f.name=this.name,f.property=this.targetProperty,f.framePerSecond=this.framePerSecond,f.dataType=this.dataType,f.loopBehavior=this.loopMode,f.enableBlending=this.enableBlending,f.blendingSpeed=this.blendingSpeed;const Q=this.dataType;f.keys=[];const H=this.getKeys();for(let X=0;X<H.length;X++){const i=H[X],S={};switch(S.frame=i.frame,Q){case G.ANIMATIONTYPE_FLOAT:S.values=[i.value],void 0!==i.inTangent&&S.values.push(i.inTangent),void 0!==i.outTangent&&(void 0===i.inTangent&&S.values.push(void 0),S.values.push(i.outTangent)),void 0!==i.interpolation&&(void 0===i.inTangent&&S.values.push(void 0),void 0===i.outTangent&&S.values.push(void 0),S.values.push(i.interpolation));break;case G.ANIMATIONTYPE_QUATERNION:case G.ANIMATIONTYPE_MATRIX:case G.ANIMATIONTYPE_VECTOR3:case G.ANIMATIONTYPE_COLOR3:case G.ANIMATIONTYPE_COLOR4:S.values=i.value.ke(),void 0!=i.inTangent&&S.values.push(i.inTangent.ke()),void 0!=i.outTangent&&(void 0===i.inTangent&&S.values.push(void 0),S.values.push(i.outTangent.ke())),void 0!==i.interpolation&&(void 0===i.inTangent&&S.values.push(void 0),void 0===i.outTangent&&S.values.push(void 0),S.values.push(i.interpolation))}f.keys.push(S)}f.ranges=[];for(const X in this._ranges){const Q=this._ranges[X];if(!Q)continue;const H={};H.name=X,H.from=Q.from,H.to=Q.to,f.ranges.push(H)}return f}static _UniversalLerp(f,Q,H){const X=f.constructor;return X.Lerp?X.Lerp(f,Q,H):X.Slerp?X.Slerp(f,Q,H):f.toFixed?f*(1-H)+H*Q:Q}static Parse(f){const Q=new G(f.name,f.property,f.framePerSecond,f.dataType,f.loopBehavior),H=f.dataType,S=[];let x,K;for(f.enableBlending&&(Q.enableBlending=f.enableBlending),f.blendingSpeed&&(Q.blendingSpeed=f.blendingSpeed),K=0;K<f.keys.length;K++){const Q=f.keys[K];let Z,B,N;switch(H){case G.ANIMATIONTYPE_FLOAT:x=Q.values[0],Q.values.length>=2&&(Z=Q.values[1]),Q.values.length>=3&&(B=Q.values[2]),Q.values.length>=4&&(N=Q.values[3]);break;case G.ANIMATIONTYPE_QUATERNION:if(x=X.i.Zd(Q.values),Q.values.length>=8){const f=X.i.Zd(Q.values.slice(4,8));f.equals(X.i.Zero())||(Z=f)}if(Q.values.length>=12){const f=X.i.Zd(Q.values.slice(8,12));f.equals(X.i.Zero())||(B=f)}Q.values.length>=13&&(N=Q.values[12]);break;case G.ANIMATIONTYPE_MATRIX:x=X.e.Zd(Q.values),Q.values.length>=17&&(N=Q.values[16]);break;case G.ANIMATIONTYPE_COLOR3:x=i.e.Zd(Q.values),Q.values[3]&&(Z=i.e.Zd(Q.values[3])),Q.values[4]&&(B=i.e.Zd(Q.values[4])),Q.values[5]&&(N=Q.values[5]);break;case G.ANIMATIONTYPE_COLOR4:x=i.h.Zd(Q.values),Q.values[4]&&(Z=i.h.Zd(Q.values[4])),Q.values[5]&&(B=i.h.Zd(Q.values[5])),Q.values[6]&&(N=i.h.Zd(Q.values[6]));break;case G.ANIMATIONTYPE_VECTOR3:default:x=X.p.Zd(Q.values),Q.values[3]&&(Z=X.p.Zd(Q.values[3])),Q.values[4]&&(B=X.p.Zd(Q.values[4])),Q.values[5]&&(N=Q.values[5])}const J={};J.frame=Q.frame,J.value=x,void 0!=Z&&(J.inTangent=Z),void 0!=B&&(J.outTangent=B),void 0!=N&&(J.interpolation=N),S.push(J)}if(Q.setKeys(S),f.ranges)for(K=0;K<f.ranges.length;K++)x=f.ranges[K],Q.createRange(x.name,x.from,x.to);return Q}static AppendSerializedAnimations(f,Q){J.b.AppendSerializedAnimations(f,Q)}static ParseFromFileAsync(f,Q){return new Promise(((H,X)=>{const i=new N.d;i.addEventListener("readystatechange",(()=>{if(4==i.readyState)if(200==i.status){let Q=JSON.parse(i.responseText);if(Q.animations&&(Q=Q.animations),Q.length){const f=[];for(const H of Q)f.push(this.Parse(H));H(f)}else{const X=this.Parse(Q);f&&(X.name=f),H(X)}}else X("Unable to load the animation")})),i.open("GET",Q),i.send()}))}static ParseFromSnippetAsync(f){return new Promise(((Q,H)=>{const X=new N.d;X.addEventListener("readystatechange",(()=>{if(4==X.readyState)if(200==X.status){const H=JSON.parse(JSON.parse(X.responseText).jsonPayload);if(H.animations){const X=JSON.parse(H.animations),i=[];for(const Q of X.animations){const H=this.Parse(Q);H.snippetId=f,i.push(H)}Q(i)}else{const X=JSON.parse(H.animation),i=this.Parse(X);i.snippetId=f,Q(i)}}else H("Unable to load the snippet "+f)})),X.open("GET",this.SnippetUrl+"/"+f.replace(/#/g,"/")),X.send()}))}}G._UniqueIdGenerator=0,G.AllowMatricesInterpolation=!1,G.AllowMatrixDecomposeForInterpolation=!0,G.SnippetUrl="https://snippet.babylonjs.com",G.ANIMATIONTYPE_FLOAT=0,G.ANIMATIONTYPE_VECTOR3=1,G.ANIMATIONTYPE_QUATERNION=2,G.ANIMATIONTYPE_MATRIX=3,G.ANIMATIONTYPE_COLOR3=4,G.ANIMATIONTYPE_COLOR4=7,G.ANIMATIONTYPE_VECTOR2=5,G.ANIMATIONTYPE_SIZE=6,G.ANIMATIONLOOPMODE_RELATIVE=0,G.ANIMATIONLOOPMODE_CYCLE=1,G.ANIMATIONLOOPMODE_CONSTANT=2,G.ANIMATIONLOOPMODE_YOYO=4,G.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,G.CreateFromSnippetAsync=G.ParseFromSnippetAsync,(0,x.h)("BABYLON.Animation",G),Z.e._AnimationRangeFactory=(f,Q,H)=>new K.c(f,Q,H)},11911:(f,Q,H)=>{"use strict";H.d(Q,{c:()=>X});class X{constructor(f,Q,H){this.name=f,this.from=Q,this.to=H}clone(){return new X(this.name,this.from,this.to)}}},11901:(f,Q,H)=>{"use strict";H.d(Q,{e:()=>x});var X=H(1003),i=H(1017),S=H(11314);class x extends S.e{get _matrix(){return this._compose(),this.Yj}set _matrix(f){(f.updateFlag!==this.Yj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Yj.p(f),this._markAsDirtyAndDecompose())}constructor(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,x=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(f,Q.va(),!1),this.name=f,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=Q,this.Yj=(null===i||void 0===i?void 0:i.clone())??X.e.Identity(),this._restMatrix=S??this.Yj.clone(),this._bindMatrix=x??this.Yj.clone(),this._index=K,this._absoluteMatrix=new X.e,this._absoluteBindMatrix=new X.e,this._absoluteInverseBindMatrix=new X.e,this._finalMatrix=new X.e,Q.bones.push(this),this.setParent(H,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(f){this.setParent(f)}setParent(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==f){if(this.parent){const f=this.parent.children.indexOf(this);-1!==f&&this.parent.children.splice(f,1)}this._parentNode=f,this.parent&&this.parent.children.push(this),Q&&this._updateAbsoluteBindMatrices(),this.ve()}}getLocalMatrix(){return this._compose(),this.Yj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(f){this._restMatrix.p(f)}setRestPose(f){this.setRestMatrix(f)}getBindPose(){return this.getBindMatrix()}setBindMatrix(f){this.Be(f)}setBindPose(f){this.setBindMatrix(f)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const f=X.l.Wd[0],Q=X.l.Quaternion[0],H=X.l.Wd[1];this.getRestMatrix().decompose(f,Q,H),this._linkedTransformNode.position.p(H),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??X.i.Identity(),this._linkedTransformNode.rotationQuaternion.p(Q),this._linkedTransformNode.He.p(f)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(f){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=f,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.xg}set position(f){this._decompose(),this.xg.p(f),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(f){this.setRotation(f)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(f){this.setRotationQuaternion(f)}get He(){return this.getScale()}set He(f){this.setScale(f)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=X.p.Zero(),this._localRotation=X.i.Zero(),this.xg=X.p.Zero()),this.Yj.decompose(this._localScaling,this._localRotation,this.xg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,X.e.ComposeToRef(this._localScaling,this._localRotation,this.xg,this.Yj)):this._needToCompose=!1)}Be(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(f),Q&&this._updateAbsoluteBindMatrices(),H?this._matrix=f:this.ve()}_updateAbsoluteBindMatrices(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(f||(f=this._bindMatrix),this.parent?f.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(f),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),Q)for(let H=0;H<this.children.length;H++)this.children[H]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}ve(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.ve(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.ve(),this._needToDecompose=!0}_updatePosition(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const S=this.getLocalMatrix();if(0==Q)i?(S.addAtIndex(12,f.x),S.addAtIndex(13,f.y),S.addAtIndex(14,f.z)):S.setTranslationFromFloats(f.x,f.y,f.z);else{let Q=null;H&&(Q=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const K=x._TmpMats[0],Z=x._TmpVecs[0];this.parent?H&&Q?(K.p(this.parent.getAbsoluteMatrix()),K.multiplyToRef(Q,K)):K.p(this.parent.getAbsoluteMatrix()):X.e.IdentityToRef(K),i&&K.setTranslationFromFloats(0,0,0),K.invert(),X.p.TransformCoordinatesToRef(f,K,Z),i?(S.addAtIndex(12,Z.x),S.addAtIndex(13,Z.y),S.addAtIndex(14,Z.z)):S.setTranslationFromFloats(Z.x,Z.y,Z.z)}this._markAsDirtyAndDecompose()}translate(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;this._updatePosition(f,Q,H,!0)}setPosition(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;this._updatePosition(f,Q,H,!1)}setAbsolutePosition(f,Q){this.setPosition(f,1,Q)}scale(f,Q,H){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const S=this.getLocalMatrix(),K=x._TmpMats[0];X.e.ScalingToRef(f,Q,H,K),K.multiplyToRef(S,S),K.invert();for(const X of this.children){const i=X.getLocalMatrix();i.multiplyToRef(K,i),i.multiplyAtIndex(12,f),i.multiplyAtIndex(13,Q),i.multiplyAtIndex(14,H),X._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),i)for(const X of this.children)X.scale(f,Q,H,i)}setScale(f){this._decompose(),this._localScaling.p(f),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(f){this._decompose(),f.p(this._localScaling)}setYawPitchRoll(f,Q,H){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=arguments.length>4?arguments[4]:void 0;if(0===i){const K=x._TmpQuat;return X.i.RotationYawPitchRollToRef(f,Q,H,K),void this.setRotationQuaternion(K,i,S)}const K=x._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(K,S))return;const Z=x._TmpMats[1];X.e.RotationYawPitchRollToRef(f,Q,H,Z),K.multiplyToRef(Z,Z),this._rotateWithMatrix(Z,i,S)}rotate(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const S=x._TmpMats[0];S.setTranslationFromFloats(0,0,0),X.e.RotationAxisToRef(f,Q,S),this._rotateWithMatrix(S,H,i)}setAxisAngle(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;if(0===H){const S=x._TmpQuat;return X.i.RotationAxisToRef(f,Q,S),void this.setRotationQuaternion(S,H,i)}const S=x._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(S,i))return;const K=x._TmpMats[1];X.e.RotationAxisToRef(f,Q,K),S.multiplyToRef(K,K),this._rotateWithMatrix(K,H,i)}setRotation(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(f.y,f.x,f.z,Q,H)}setRotationQuaternion(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;if(0===Q)return this._decompose(),this._localRotation.p(f),void this._markAsDirtyAndCompose();const i=x._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(i,H))return;const S=x._TmpMats[1];X.e.FromQuaternionToRef(f,S),i.multiplyToRef(S,S),this._rotateWithMatrix(S,Q,H)}setRotationMatrix(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;if(0===Q){const i=x._TmpQuat;return X.i.FromRotationMatrixToRef(f,i),void this.setRotationQuaternion(i,Q,H)}const i=x._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(i,H))return;const S=x._TmpMats[1];S.p(f),i.multiplyToRef(f,S),this._rotateWithMatrix(S,Q,H)}_rotateWithMatrix(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;const X=this.getLocalMatrix(),i=X.m[12],S=X.m[13],K=X.m[14],Z=this.getParent(),B=x._TmpMats[3],N=x._TmpMats[4];Z&&1==Q?(H?(B.p(H.getWorldMatrix()),Z.getAbsoluteMatrix().multiplyToRef(B,B)):B.p(Z.getAbsoluteMatrix()),N.p(B),N.invert(),X.multiplyToRef(B,X),X.multiplyToRef(f,X),X.multiplyToRef(N,X)):1==Q&&H?(B.p(H.getWorldMatrix()),N.p(B),N.invert(),X.multiplyToRef(B,X),X.multiplyToRef(f,X),X.multiplyToRef(N,X)):X.multiplyToRef(f,X),X.setTranslationFromFloats(i,S,K),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(f,Q){const H=x._TmpMats[2];return f.p(this.getAbsoluteMatrix()),Q?(f.multiplyToRef(Q.getWorldMatrix(),f),X.e.ScalingToRef(Q.He.x,Q.He.y,Q.He.z,H)):X.e.IdentityToRef(H),f.invert(),!isNaN(f.m[0])&&(H.multiplyAtIndex(0,this._scalingDeterminant),f.multiplyToRef(H,f),!0)}cb(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=X.p.Zero();return this.getPositionToRef(f,Q,H),H}getPositionToRef(){let f=arguments.length>1?arguments[1]:void 0,Q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const f=this.getLocalMatrix();Q.x=f.m[12],Q.y=f.m[13],Q.z=f.m[14]}else{let H=null;f&&(H=f.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let X=x._TmpMats[0];f&&H?(X.p(this.getAbsoluteMatrix()),X.multiplyToRef(H,X)):X=this.getAbsoluteMatrix(),Q.x=X.m[12],Q.y=X.m[13],Q.z=X.m[14]}}getAbsolutePosition(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const Q=X.p.Zero();return this.getPositionToRef(1,f,Q),Q}getAbsolutePositionToRef(f,Q){this.getPositionToRef(1,f,Q)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Yj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Yj);const f=this._skeleton.getPoseMatrix();f&&this._absoluteMatrix.multiplyToRef(f,this._absoluteMatrix)}const f=this.children,Q=f.length;for(let H=0;H<Q;H++)f[H].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}mf(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=X.p.Zero();return this.getDirectionToRef(f,Q,H),H}getDirectionToRef(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,i=null;Q&&(i=Q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const S=x._TmpMats[0];S.p(this.getAbsoluteMatrix()),Q&&i&&S.multiplyToRef(i,S),X.p.TransformNormalToRef(f,S,H),H.normalize()}getRotation(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=X.p.Zero();return this.getRotationToRef(f,Q,H),H}getRotationToRef(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0;const X=x._TmpQuat;this.getRotationQuaternionToRef(f,Q,X),X.toEulerAnglesToRef(H)}getRotationQuaternion(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=X.i.Identity();return this.getRotationQuaternionToRef(f,Q,H),H}getRotationQuaternionToRef(){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),Q.p(this._localRotation);else{const H=x._TmpMats[0],X=this.getAbsoluteMatrix();f?X.multiplyToRef(f.getWorldMatrix(),H):H.p(X),H.multiplyAtIndex(0,this._scalingDeterminant),H.multiplyAtIndex(1,this._scalingDeterminant),H.multiplyAtIndex(2,this._scalingDeterminant),H.decompose(void 0,Q,void 0)}}getRotationMatrix(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Q=arguments.length>1?arguments[1]:void 0;const H=X.e.Identity();return this.getRotationMatrixToRef(f,Q,H),H}getRotationMatrixToRef(){let f=arguments.length>1?arguments[1]:void 0,Q=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(Q);else{const H=x._TmpMats[0],X=this.getAbsoluteMatrix();f?X.multiplyToRef(f.getWorldMatrix(),H):H.p(X),H.multiplyAtIndex(0,this._scalingDeterminant),H.multiplyAtIndex(1,this._scalingDeterminant),H.multiplyAtIndex(2,this._scalingDeterminant),H.getRotationMatrixToRef(Q)}}getAbsolutePositionFromLocal(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=X.p.Zero();return this.getAbsolutePositionFromLocalToRef(f,Q,H),H}getAbsolutePositionFromLocalToRef(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,i=null;Q&&(i=Q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const S=x._TmpMats[0];S.p(this.getAbsoluteMatrix()),Q&&i&&S.multiplyToRef(i,S),X.p.TransformCoordinatesToRef(f,S,H)}getLocalPositionFromAbsolute(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=X.p.Zero();return this.getLocalPositionFromAbsoluteToRef(f,Q,H),H}getLocalPositionFromAbsoluteToRef(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,i=null;Q&&(i=Q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const S=x._TmpMats[0];S.p(this.getAbsoluteMatrix()),Q&&i&&S.multiplyToRef(i,S),S.invert(),X.p.TransformCoordinatesToRef(f,S,H)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}x._TmpVecs=(0,i.c)(2,X.p.Zero),x._TmpQuat=X.i.Identity(),x._TmpMats=(0,i.c)(5,X.e.Identity)},12228:(f,Q,H)=>{"use strict";H.d(Q,{e:()=>R});var X=H(978),i=H(982),S=H(994),x=H(1003),K=H(11314),Z=H(11301),B=H(1290),N=H(1126),J=H(1011);class g{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(f){this._zoomStopsAnimation=f}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(f){this._idleRotationSpeed=f}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(f){this._idleRotationWaitTime=f}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(f){this._idleRotationSpinupTime=f}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(f){this._attachedCamera=f;const Q=this._attachedCamera.va();this._onPrePointerObservableObserver=Q.onPrePointerObservable.add((f=>{f.type!==B.c.POINTERDOWN?f.type===B.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=f.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const f=N.c.Now;let Q=0;null!=this._lastFrameTime&&(Q=f-this._lastFrameTime),this._lastFrameTime=f,this._applyUserInteraction();const H=f-this._lastInteractionTime-this._idleRotationWaitTime,X=Math.max(Math.min(H/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*X,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(Q/1e3))}))}detach(){if(!this._attachedCamera)return;const f=this._attachedCamera.va();this._onPrePointerObservableObserver&&f.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(f){this._lastInteractionTime=f??N.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<J.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let f=!1;return this._lastFrameRadius===this._attachedCamera.i&&0!==this._attachedCamera.inertialRadiusOffset&&(f=!0),this._lastFrameRadius=this._attachedCamera.i,this._zoomStopsAnimation?f:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=N.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}H(1498);class z{constructor(){this._easingMode=z.EASINGMODE_EASEIN}setEasingMode(f){const Q=Math.min(Math.max(f,0),2);this._easingMode=Q}getEasingMode(){return this._easingMode}easeInCore(f){throw new Error("You must implement this method")}ease(f){switch(this._easingMode){case z.EASINGMODE_EASEIN:return this.easeInCore(f);case z.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-f)}return f>=.5?.5*(1-this.easeInCore(2*(1-f)))+.5:.5*this.easeInCore(2*f)}}z.EASINGMODE_EASEIN=0,z.EASINGMODE_EASEOUT=1,z.EASINGMODE_EASEINOUT=2;var v=H(11903);class Y{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(f){if(this._autoTransitionRange===f)return;this._autoTransitionRange=f;const Q=this._attachedCamera;Q&&(f?this._onMeshTargetChangedObserver=Q.onMeshTargetChangedObservable.add((f=>{if(f&&(f.re(!0),f.getBoundingInfo)){const Q=f.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*Q,this.upperRadiusTransitionRange=.05*Q}})):this._onMeshTargetChangedObserver&&Q.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(f){this._attachedCamera=f,this._onAfterCheckInputsObserver=f.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(f){return!!this._attachedCamera&&(this._attachedCamera.i===f&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(f){if(!this._attachedCamera)return;this._radiusBounceTransition||(Y.EasingFunction.setEasingMode(Y.EasingMode),this._radiusBounceTransition=v.d.CreateAnimation("i",v.d.ANIMATIONTYPE_FLOAT,60,Y.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const Q=v.d.TransitionTo("i",this._attachedCamera.i+f,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));Q&&this._animatables.push(Q)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}Y.EasingFunction=new class extends z{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=f}easeInCore(f){const Q=Math.max(0,this.amplitude);return Math.pow(f,3)-f*Q*Math.sin(3.141592653589793*f)}}(.3),Y.EasingMode=z.EASINGMODE_EASEOUT;class O{constructor(){this.onTargetFramingAnimationEndObservable=new S.e,this._mode=O.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(f){this._mode=f}get mode(){return this._mode}set radiusScale(f){this._radiusScale=f}get radiusScale(){return this._radiusScale}set positionScale(f){this._positionScale=f}get positionScale(){return this._positionScale}set defaultElevation(f){this._defaultElevation=f}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(f){this._elevationReturnTime=f}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(f){this._elevationReturnWaitTime=f}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(f){this._zoomStopsAnimation=f}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(f){this._framingTime=f}get framingTime(){return this._framingTime}init(){}attach(f){this._attachedCamera=f;const Q=this._attachedCamera.va();O.EasingFunction.setEasingMode(O.EasingMode),this._onPrePointerObservableObserver=Q.onPrePointerObservable.add((f=>{f.type!==B.c.POINTERDOWN?f.type===B.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=f.onMeshTargetChangedObservable.add((f=>{f&&f.getBoundingInfo&&this.zoomOnMesh(f,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=f.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const f=this._attachedCamera.va();this._onPrePointerObservableObserver&&f.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;f.re(!0);const X=f.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(X.minimumWorld,X.maximumWorld,Q,H)}zoomOnMeshHierarchy(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;f.re(!0);const X=f.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(X.min,X.max,Q,H)}zoomOnMeshesHierarchy(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new x.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new x.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let S=0;S<f.length;S++){const Q=f[S].getHierarchyBoundingVectors(!0);x.p.CheckExtends(Q.min,X,i),x.p.CheckExtends(Q.max,X,i)}this.zoomOnBoundingInfo(X,i,Q,H)}zoomOnBoundingInfo(f,Q){let H,X=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const S=f.y,K=S+(Q.y-S)*this._positionScale,Z=Q.hd(f).scale(.5);if(X)H=new x.p(0,K,0);else{const Q=f.add(Z);H=new x.p(Q.x,K,Q.z)}this._vectorTransition||(this._vectorTransition=v.d.CreateAnimation("target",v.d.ANIMATIONTYPE_VECTOR3,60,O.EasingFunction)),this._betaIsAnimating=!0;let B=v.d.TransitionTo("target",H,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);B&&this._animatables.push(B);let N=0;if(this._mode===O.FitFrustumSidesMode){const H=this._calculateLowerRadiusFromModelBoundingSphere(f,Q);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=Z.length()+this._attachedCamera.nj),N=H}else this._mode===O.IgnoreBoundsSizeMode&&(N=this._calculateLowerRadiusFromModelBoundingSphere(f,Q),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.nj));if(this.autoCorrectCameraLimitsAndSensibility){const H=Q.hd(f).length();this._attachedCamera.panningSensibility=5e3/H,this._attachedCamera.wheelPrecision=100/N}return this._radiusTransition||(this._radiusTransition=v.d.CreateAnimation("i",v.d.ANIMATIONTYPE_FLOAT,60,O.EasingFunction)),B=v.d.TransitionTo("i",N,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),i&&i(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),B&&this._animatables.push(B),!0}_calculateLowerRadiusFromModelBoundingSphere(f,Q){const H=this._attachedCamera;if(!H)return 0;let X=H._calculateLowerRadiusFromModelBoundingSphere(f,Q,this._radiusScale);return H.lowerRadiusLimit&&this._mode===O.IgnoreBoundsSizeMode&&(X=X<H.lowerRadiusLimit?H.lowerRadiusLimit:X),H.upperRadiusLimit&&(X=X>H.upperRadiusLimit?H.upperRadiusLimit:X),X}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const f=N.c.Now-this._lastInteractionTime,Q=.5*Math.PI-this._defaultElevation,H=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>H&&f>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=v.d.CreateAnimation("beta",v.d.ANIMATIONTYPE_FLOAT,60,O.EasingFunction));const f=v.d.TransitionTo("beta",Q,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));f&&this._animatables.push(f)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=N.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}O.EasingFunction=new class extends z{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=f}easeInCore(f){return this.exponent<=0?f:(Math.exp(this.exponent*f)-1)/(Math.exp(this.exponent)-1)}},O.EasingMode=z.EASINGMODE_EASEINOUT,O.IgnoreBoundsSizeMode=0,O.FitFrustumSidesMode=1;var n=H(11311),e=H(11890),G=H(11892),I=H(1203);class l{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(f){f=I.g.BackCompatCameraNoPreventDefault(arguments);const Q=this.camera.getEngine(),H=Q.getInputElement();let X=0,i=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=S=>{var x,K;const Z=S.event,N="touch"===Z.pointerType;if(S.type!==B.c.POINTERMOVE&&-1===this.buttons.indexOf(Z.button))return;const J=Z.target;if(this._altKey=Z.altKey,this._ctrlKey=Z.ctrlKey,this._metaKey=Z.metaKey,this._shiftKey=Z.shiftKey,this._buttonsPressed=Z.buttons,Q.isPointerLock){const f=Z.movementX,Q=Z.movementY;this.onTouch(null,f,Q),this._pointA=null,this._pointB=null}else{if(S.type!==B.c.POINTERDOWN&&S.type!==B.c.POINTERDOUBLETAP&&N&&(null===(x=this._pointA)||void 0===x?void 0:x.pointerId)!==Z.pointerId&&(null===(K=this._pointB)||void 0===K?void 0:K.pointerId)!==Z.pointerId)return;if(S.type!==B.c.POINTERDOWN||-1!==this._currentActiveButton&&!N)if(S.type===B.c.POINTERDOUBLETAP)this.onDoubleTap(Z.pointerType);else if(S.type!==B.c.POINTERUP||this._currentActiveButton!==Z.button&&!N){if(S.type===B.c.POINTERMOVE)if(f||Z.preventDefault(),this._pointA&&null===this._pointB){const f=Z.clientX-this._pointA.x,Q=Z.clientY-this._pointA.y;this._pointA.x=Z.clientX,this._pointA.y=Z.clientY,this.onTouch(this._pointA,f,Q)}else if(this._pointA&&this._pointB){const f=this._pointA.pointerId===Z.pointerId?this._pointA:this._pointB;f.x=Z.clientX,f.y=Z.clientY;const Q=this._pointA.x-this._pointB.x,H=this._pointA.y-this._pointB.y,x=Q*Q+H*H,K={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:Z.pointerId,type:S.type};this.onMultiTouch(this._pointA,this._pointB,X,x,i,K),i=K,X=x}}else{try{null===J||void 0===J||J.releasePointerCapture(Z.pointerId)}catch(g){}N||(this._pointB=null),Q._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==Z.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==Z.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==X||i)&&(this.onMultiTouch(this._pointA,this._pointB,X,0,i,null),X=0,i=null),this._currentActiveButton=-1,this.onButtonUp(Z),f||Z.preventDefault()}else{try{null===J||void 0===J||J.setPointerCapture(Z.pointerId)}catch(g){}if(null===this._pointA)this._pointA={x:Z.clientX,y:Z.clientY,pointerId:Z.pointerId,type:Z.pointerType};else{if(null!==this._pointB)return;this._pointB={x:Z.clientX,y:Z.clientY,pointerId:Z.pointerId,type:Z.pointerType}}-1!==this._currentActiveButton||N||(this._currentActiveButton=Z.button),this.onButtonDown(Z),f||(Z.preventDefault(),H&&H.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,B.c.POINTERDOWN|B.c.POINTERUP|B.c.POINTERMOVE|B.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,X=0,i=null,this.onLostFocus()},this._contextMenuBind=f=>this.onContextMenu(f),H&&H.addEventListener("contextmenu",this._contextMenuBind,!1);const S=this.camera.va().getEngine().getHostWindow();S&&I.g.RegisterTopRootEvents(S,[{name:"blur",handler:this._onLostFocus}])}Ue(){if(this._onLostFocus){const f=this.camera.va().getEngine().getHostWindow();f&&I.g.UnregisterTopRootEvents(f,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const f=this.camera.va().getEngine().getInputElement();f&&f.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(f){}onTouch(f,Q,H){}onMultiTouch(f,Q,H,X,i,S){}onContextMenu(f){f.preventDefault()}onButtonDown(f){}onButtonUp(f){}onLostFocus(){}}(0,X.d)([(0,i.G)()],l.prototype,"buttons",void 0);class q extends l{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(f,Q){if(0!==this.panningSensibility&&f&&Q){const H=Q.x-f.x,X=Q.y-f.y;this.camera.inertialPanningX+=-H/this.panningSensibility,this.camera.inertialPanningY+=X/this.panningSensibility}}_computePinchZoom(f,Q){const H=this.camera.i||q.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.i=H*Math.sqrt(f)/Math.sqrt(Q):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(Q-f)*H*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(Q-f)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(f,Q,H){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-Q/this.panningSensibility,this.camera.inertialPanningY+=H/this.panningSensibility):(this.camera.inertialAlphaOffset-=Q/this.angularSensibilityX,this.camera.inertialBetaOffset-=H/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(f,Q,H,X,i,S){0===H&&null===i||0===X&&null===S||(this.multiTouchPanAndZoom?(this._computePinchZoom(H,X),this._computeMultiTouchPanning(i,S)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(X)-Math.sqrt(H))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(H,X),this._isPinching=!0):this._computeMultiTouchPanning(i,S)):this.multiTouchPanning?this._computeMultiTouchPanning(i,S):this.pinchZoom&&this._computePinchZoom(H,X))}onButtonDown(f){this._isPanClick=f.button===this.camera._panningMouseButton}onButtonUp(f){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}q.MinimumRadiusForPinch=.001,(0,X.d)([(0,i.G)()],q.prototype,"buttons",void 0),(0,X.d)([(0,i.G)()],q.prototype,"angularSensibilityX",void 0),(0,X.d)([(0,i.G)()],q.prototype,"angularSensibilityY",void 0),(0,X.d)([(0,i.G)()],q.prototype,"pinchPrecision",void 0),(0,X.d)([(0,i.G)()],q.prototype,"pinchDeltaPercentage",void 0),(0,X.d)([(0,i.G)()],q.prototype,"useNaturalPinchZoom",void 0),(0,X.d)([(0,i.G)()],q.prototype,"pinchZoom",void 0),(0,X.d)([(0,i.G)()],q.prototype,"panningSensibility",void 0),(0,X.d)([(0,i.G)()],q.prototype,"multiTouchPanning",void 0),(0,X.d)([(0,i.G)()],q.prototype,"multiTouchPanAndZoom",void 0),G.e.ArcRotateCameraPointersInput=q;var D=H(1298);class d{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(f){f=I.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((Q=>{const H=Q.event;if(!H.metaKey)if(Q.type===D.d.KEYDOWN){if(this._ctrlPressed=H.ctrlKey,this._altPressed=H.altKey,-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysReset.indexOf(H.keyCode)){-1===this._keys.indexOf(H.keyCode)&&this._keys.push(H.keyCode),H.preventDefault&&(f||H.preventDefault())}}else if(-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysReset.indexOf(H.keyCode)){const Q=this._keys.indexOf(H.keyCode);Q>=0&&this._keys.splice(Q,1),H.preventDefault&&(f||H.preventDefault())}})))}Ue(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const f=this.camera;for(let Q=0;Q<this._keys.length;Q++){const H=this._keys[Q];-1!==this.keysLeft.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?f.inertialPanningX-=1/this.panningSensibility:f.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?f.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?f.inertialRadiusOffset+=1/this.zoomingSensibility:f.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?f.inertialPanningX+=1/this.panningSensibility:f.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?f.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?f.inertialRadiusOffset-=1/this.zoomingSensibility:f.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(H)&&f.useInputToRestoreState&&f.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,X.d)([(0,i.G)()],d.prototype,"keysUp",void 0),(0,X.d)([(0,i.G)()],d.prototype,"keysDown",void 0),(0,X.d)([(0,i.G)()],d.prototype,"keysLeft",void 0),(0,X.d)([(0,i.G)()],d.prototype,"keysRight",void 0),(0,X.d)([(0,i.G)()],d.prototype,"keysReset",void 0),(0,X.d)([(0,i.G)()],d.prototype,"panningSensibility",void 0),(0,X.d)([(0,i.G)()],d.prototype,"zoomingSensibility",void 0),(0,X.d)([(0,i.G)()],d.prototype,"useAltToZoom",void 0),(0,X.d)([(0,i.G)()],d.prototype,"angularSpeed",void 0),G.e.ArcRotateCameraKeyboardMoveInput=d;var s=H(1175),F=H(1303),P=H(1034);class m{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new x.p(0,0,0),this._globalOffset=new x.p(0,0,0),this._inertialPanning=x.p.Zero()}_computeDeltaFromMouseWheelLegacyEvent(f,Q){let H=0;const X=.01*f*this.wheelDeltaPercentage*Q;return H=f>0?X/(1+this.wheelDeltaPercentage):X*(1+this.wheelDeltaPercentage),H}attachControl(f){f=I.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=Q=>{if(Q.type!==B.c.POINTERWHEEL)return;const H=Q.event;let X=0;const i=H.deltaMode===F.b.DOM_DELTA_LINE?40:1,S=-H.deltaY*i;if(this.customComputeDeltaFromMouseWheel)X=this.customComputeDeltaFromMouseWheel(S,this,H);else if(this.wheelDeltaPercentage){if(X=this._computeDeltaFromMouseWheelLegacyEvent(S,this.camera.i),X>0){let f=this.camera.i,Q=this.camera.inertialRadiusOffset+X;for(let H=0;H<20&&Math.abs(Q)>.001;H++)f-=Q,Q*=this.camera.inertia;f=(0,P.c)(f,0,Number.MAX_VALUE),X=this._computeDeltaFromMouseWheelLegacyEvent(S,f)}}else X=S/(40*this.wheelPrecision);X&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(X)):this.camera.inertialRadiusOffset+=X),H.preventDefault&&(f||H.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,B.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning._d(0)}Ue(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const f=this.camera;0+f.inertialAlphaOffset+f.inertialBetaOffset+f.inertialRadiusOffset&&(this._updateHitPlane(),f.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(f.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const f=this.camera,Q=f.target.hd(f.position);this._hitPlane=s.d.FromPositionAndNormal(f.target,Q)}_getPosition(){const f=this.camera,Q=f.va(),H=Q.createPickingRay(Q.pointerX,Q.pointerY,x.e.Identity(),f,!1);0===f.targetScreenOffset.x&&0===f.targetScreenOffset.y||(this._viewOffset.set(f.targetScreenOffset.x,f.targetScreenOffset.y,0),f.getViewMatrix().invertToRef(f._cameraTransformMatrix),this._globalOffset=x.p.TransformNormal(this._viewOffset,f._cameraTransformMatrix),H.origin.addInPlace(this._globalOffset));let X=0;return this._hitPlane&&(X=H.intersectsPlane(this._hitPlane)??0),H.origin.addInPlace(H.direction.scaleInPlace(X))}_zoomToMouse(f){const Q=this.camera,H=1-Q.inertia;if(Q.lowerRadiusLimit){const X=Q.lowerRadiusLimit??0;Q.i-(Q.inertialRadiusOffset+f)/H<X&&(f=(Q.i-X)*H-Q.inertialRadiusOffset)}if(Q.upperRadiusLimit){const X=Q.upperRadiusLimit??0;Q.i-(Q.inertialRadiusOffset+f)/H>X&&(f=(Q.i-X)*H-Q.inertialRadiusOffset)}const X=f/H/Q.i,i=this._getPosition(),S=x.l.Wd[6];i.subtractToRef(Q.target,S),S.scaleInPlace(X),S.scaleInPlace(H),this._inertialPanning.addInPlace(S),Q.inertialRadiusOffset+=f}_zeroIfClose(f){Math.abs(f.x)<J.c&&(f.x=0),Math.abs(f.y)<J.c&&(f.y=0),Math.abs(f.z)<J.c&&(f.z=0)}}(0,X.d)([(0,i.G)()],m.prototype,"wheelPrecision",void 0),(0,X.d)([(0,i.G)()],m.prototype,"zoomToMouseLocation",void 0),(0,X.d)([(0,i.G)()],m.prototype,"wheelDeltaPercentage",void 0),G.e.ArcRotateCameraMouseWheelInput=m;class c extends G.h{constructor(f){super(f)}addMouseWheel(){return this.add(new m),this}addPointers(){return this.add(new q),this}addKeyboard(){return this.add(new d),this}}var W=H(1022);K.e.AddNodeConstructor("ArcRotateCamera",((f,Q)=>()=>new R(f,0,0,1,x.p.Zero(),Q)));class R extends e.e{get target(){return this._target}set target(f){this.setTarget(f)}get targetHost(){return this._targetHost}set targetHost(f){f&&this.setTarget(f)}getTarget(){return this.target}get position(){return this._position}set position(f){this.setPosition(f)}set upVector(f){this._upToYMatrix||(this._yToUpMatrix=new x.e,this._upToYMatrix=new x.e,this._upVector=x.p.Zero()),f.normalize(),this._upVector.p(f),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){x.e.RotationAlignToRef(x.p.UpReadOnly,this._upVector,this._yToUpMatrix),x.e.RotationAlignToRef(this._upVector,x.p.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const f=this.inputs.attached.pointers;return f?f.angularSensibilityX:0}set angularSensibilityX(f){const Q=this.inputs.attached.pointers;Q&&(Q.angularSensibilityX=f)}get angularSensibilityY(){const f=this.inputs.attached.pointers;return f?f.angularSensibilityY:0}set angularSensibilityY(f){const Q=this.inputs.attached.pointers;Q&&(Q.angularSensibilityY=f)}get pinchPrecision(){const f=this.inputs.attached.pointers;return f?f.pinchPrecision:0}set pinchPrecision(f){const Q=this.inputs.attached.pointers;Q&&(Q.pinchPrecision=f)}get pinchDeltaPercentage(){const f=this.inputs.attached.pointers;return f?f.pinchDeltaPercentage:0}set pinchDeltaPercentage(f){const Q=this.inputs.attached.pointers;Q&&(Q.pinchDeltaPercentage=f)}get useNaturalPinchZoom(){const f=this.inputs.attached.pointers;return!!f&&f.useNaturalPinchZoom}set useNaturalPinchZoom(f){const Q=this.inputs.attached.pointers;Q&&(Q.useNaturalPinchZoom=f)}get panningSensibility(){const f=this.inputs.attached.pointers;return f?f.panningSensibility:0}set panningSensibility(f){const Q=this.inputs.attached.pointers;Q&&(Q.panningSensibility=f)}get keysUp(){const f=this.inputs.attached.keyboard;return f?f.keysUp:[]}set keysUp(f){const Q=this.inputs.attached.keyboard;Q&&(Q.keysUp=f)}get keysDown(){const f=this.inputs.attached.keyboard;return f?f.keysDown:[]}set keysDown(f){const Q=this.inputs.attached.keyboard;Q&&(Q.keysDown=f)}get keysLeft(){const f=this.inputs.attached.keyboard;return f?f.keysLeft:[]}set keysLeft(f){const Q=this.inputs.attached.keyboard;Q&&(Q.keysLeft=f)}get keysRight(){const f=this.inputs.attached.keyboard;return f?f.keysRight:[]}set keysRight(f){const Q=this.inputs.attached.keyboard;Q&&(Q.keysRight=f)}get wheelPrecision(){const f=this.inputs.attached.mousewheel;return f?f.wheelPrecision:0}set wheelPrecision(f){const Q=this.inputs.attached.mousewheel;Q&&(Q.wheelPrecision=f)}get zoomToMouseLocation(){const f=this.inputs.attached.mousewheel;return!!f&&f.zoomToMouseLocation}set zoomToMouseLocation(f){const Q=this.inputs.attached.mousewheel;Q&&(Q.zoomToMouseLocation=f)}get wheelDeltaPercentage(){const f=this.inputs.attached.mousewheel;return f?f.wheelDeltaPercentage:0}set wheelDeltaPercentage(f){const Q=this.inputs.attached.mousewheel;Q&&(Q.wheelDeltaPercentage=f)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(f){f!==this.useBouncingBehavior&&(f?(this._bouncingBehavior=new Y,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(f){f!==this.useFramingBehavior&&(f?(this._framingBehavior=new O,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(f){f!==this.useAutoRotationBehavior&&(f?(this._autoRotationBehavior=new g,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(f,Q,H,X,i,K){var Z;let B=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(f,x.p.Zero(),K,B),Z=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=x.p.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=x.m.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new x.e,this.panningAxis=new x.p(1,1,0),this._transformedDirection=new x.p,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new S.e,this.checkCollisions=!1,this.collisionRadius=new x.p(.5,.5,.5),this._previousPosition=x.p.Zero(),this._collisionVelocity=x.p.Zero(),this._newPosition=x.p.Zero(),this._computationVector=x.p.Zero(),this._onCollisionPositionChange=function(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;H?(Z.setPosition(Q),Z.Rk&&Z.Rk(H)):Z._previousPosition.p(Z._position);const X=Math.cos(Z.alpha),i=Math.sin(Z.alpha),S=Math.cos(Z.beta);let x=Math.sin(Z.beta);0===x&&(x=1e-4);const K=Z._getTargetPosition();Z._computationVector.Xd(Z.i*X*x,Z.i*S,Z.i*i*x),K.addToRef(Z._computationVector,Z._newPosition),Z._position.p(Z._newPosition);let B=Z.upVector;Z.allowUpsideDown&&Z.beta<0&&(B=B.clone(),B=B.negate()),Z._computeViewMatrix(Z._position,K,B),Z._viewMatrix.addAtIndex(12,Z.targetScreenOffset.x),Z._viewMatrix.addAtIndex(13,Z.targetScreenOffset.y),Z._collisionTriggered=!1},this._target=x.p.Zero(),i&&this.setTarget(i),this.alpha=Q,this.beta=H,this.i=X,this.getViewMatrix(),this.inputs=new c(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new x.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.i=void 0,this._cache.targetScreenOffset=x.m.Zero()}_updateCache(f){f||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.i=this.i,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const f=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?f.addToRef(this._targetBoundingCenter,this._target):this._target.p(f)}const f=this._getLockedTargetPosition();return f||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.i,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>J.c&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.i=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.i===this.i&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(f,Q){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const i=arguments;Q=I.g.BackCompatCameraNoPreventDefault(i),this._useCtrlForPanning=H,this._panningMouseButton=X,"boolean"===typeof i[0]&&(i.length>1&&(this._useCtrlForPanning=i[1]),i.length>2&&(this._panningMouseButton=i[2])),this.inputs.attachElement(Q),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Ue(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const f=this._scene.getEngine().getDeltaTime()/1e3,Q=1-Math.pow(2,-f/this.restoreStateInterpolationFactor);this.setTarget(x.p.Lerp(this.getTarget(),this._storedTarget,Q)),x.i.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,x.l.Quaternion[0]),x.i.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,x.l.Quaternion[1]),x.i.SlerpToRef(x.l.Quaternion[1],x.l.Quaternion[0],Q,x.l.Quaternion[2]),x.l.Quaternion[2].normalize(),x.l.Quaternion[2].toAlphaBetaGammaToRef(x.l.Wd[0]),this.alpha=x.l.Wd[0].x,this.beta=x.l.Wd[0].y,this.i+=(this._storedRadius-this.i)*Q,x.m.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,Q,this.targetScreenOffset),(x.p.DistanceSquared(this.getTarget(),this._storedTarget)<J.c&&x.l.Quaternion[2].equalsWithEpsilon(x.l.Quaternion[0])&&Math.pow(this._storedRadius-this.i,2)<J.c&&x.m.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<J.c||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const f=this.invertRotation?-1:1,Q=this._calculateHandednessMultiplier();let H=this.inertialAlphaOffset*Q;this.beta<0&&(H*=-1),this.alpha+=H*f,this.beta+=this.inertialBetaOffset*f,this.i-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<J.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<J.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*J.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const f=new x.p(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),f.multiplyInPlace(this.panningAxis),x.p.TransformNormalToRef(f,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const f=this.upVector,Q=x.p.CrossToRef(this._transformedDirection,f,this._transformedDirection);x.p.CrossToRef(f,Q,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);x.p.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const f=x.l.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(f),f.transposeToRef(f),x.p.TransformCoordinatesToRef(this._transformedDirection,f,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*J.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*J.c&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.i<this.lowerRadiusLimit&&(this.i=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.i>this.upperRadiusLimit&&(this.i=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||x.p.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.i=this._computationVector.length(),0===this.i&&(this.i=1e-4);const f=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const Q=Math.round((f-this.alpha)/(2*Math.PI));this.alpha+=2*Q*Math.PI,this.beta=Math.acos(this._computationVector.y/this.i),this._checkLimits()}setPosition(f){this._position.equals(f)||(this._position.p(f),this.rebuildAnglesAndRadius())}setTarget(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(X=this.overrideCloneAlphaBetaRadius??X,f.re)Q&&f.getBoundingInfo?this._targetBoundingCenter=f.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,f.re(),this._targetHost=f,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const Q=f,X=this._getTargetPosition();if(X&&!H&&X.equals(Q))return;this._targetHost=null,this._target=Q,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}X||this.rebuildAnglesAndRadius()}_getViewMatrix(){const f=Math.cos(this.alpha),Q=Math.sin(this.alpha),H=Math.cos(this.beta);let X=Math.sin(this.beta);0===X&&(X=1e-4),0===this.i&&(this.i=1e-4);const i=this._getTargetPosition();if(this._computationVector.Xd(this.i*f*X,this.i*H,this.i*Q*X),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||x.p.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),i.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const f=this.va().collisionCoordinator;this._collider||(this._collider=f.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,f.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let f=this.upVector;this.allowUpsideDown&&X<0&&(f=f.negate()),this._computeViewMatrix(this._position,i,f),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=i,this._viewMatrix}zoomOn(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f=f||this.va().meshes;const H=Z.b.MinMax(f);let X=this._calculateLowerRadiusFromModelBoundingSphere(H.min,H.max);X=Math.max(Math.min(X,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.i=X*this.zoomOnFactor,this.focusOn({min:H.min,max:H.max,distance:X},Q)}focusOn(f){let Q,H,X=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===f.min){const X=f||this.va().meshes;Q=Z.b.MinMax(X),H=x.p.Distance(Q.min,Q.max)}else{Q=f,H=f.distance}this._target=Z.b.Center(Q),X||(this.maxZ=2*H)}createRigCamera(f,Q){let H=0;switch(this.cameraRigMode){case n.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case n.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case n.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case n.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case n.c.RIG_MODE_VR:H=this._cameraRigParams.stereoHalfAngle*(0===Q?1:-1);break;case n.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:H=this._cameraRigParams.stereoHalfAngle*(0===Q?-1:1)}const X=new R(f,this.alpha+H,this.beta,this.i,this._target,this.va());return X._cameraRigParams={},X.isRigCamera=!0,X.rigParent=this,X.upVector=this.upVector,X.mode=this.mode,X.orthoLeft=this.orthoLeft,X.orthoRight=this.orthoRight,X.orthoBottom=this.orthoBottom,X.orthoTop=this.orthoTop,X}_updateRigCameras(){const f=this._rigCameras[0],Q=this._rigCameras[1];switch(f.beta=Q.beta=this.beta,this.cameraRigMode){case n.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case n.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case n.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case n.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case n.c.RIG_MODE_VR:f.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,Q.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case n.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:f.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,Q.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const X=x.p.Distance(f,Q),i=this.va().getEngine().getAspectRatio(this),S=Math.tan(this.fov/2),K=S*i,Z=.5*X*H,B=Z*Math.sqrt(1+1/(K*K)),N=Z*Math.sqrt(1+1/(S*S));return Math.max(B,N)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,X.d)([(0,i.G)()],R.prototype,"alpha",void 0),(0,X.d)([(0,i.G)()],R.prototype,"beta",void 0),(0,X.d)([(0,i.G)()],R.prototype,"i",void 0),(0,X.d)([(0,i.G)()],R.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,X.d)([(0,i.F)("target")],R.prototype,"_target",void 0),(0,X.d)([(0,i.t)("targetHost")],R.prototype,"_targetHost",void 0),(0,X.d)([(0,i.G)()],R.prototype,"inertialAlphaOffset",void 0),(0,X.d)([(0,i.G)()],R.prototype,"inertialBetaOffset",void 0),(0,X.d)([(0,i.G)()],R.prototype,"inertialRadiusOffset",void 0),(0,X.d)([(0,i.G)()],R.prototype,"lowerAlphaLimit",void 0),(0,X.d)([(0,i.G)()],R.prototype,"upperAlphaLimit",void 0),(0,X.d)([(0,i.G)()],R.prototype,"lowerBetaLimit",void 0),(0,X.d)([(0,i.G)()],R.prototype,"upperBetaLimit",void 0),(0,X.d)([(0,i.G)()],R.prototype,"lowerRadiusLimit",void 0),(0,X.d)([(0,i.G)()],R.prototype,"upperRadiusLimit",void 0),(0,X.d)([(0,i.G)()],R.prototype,"inertialPanningX",void 0),(0,X.d)([(0,i.G)()],R.prototype,"inertialPanningY",void 0),(0,X.d)([(0,i.G)()],R.prototype,"pinchToPanMaxDistance",void 0),(0,X.d)([(0,i.G)()],R.prototype,"panningDistanceLimit",void 0),(0,X.d)([(0,i.F)()],R.prototype,"panningOriginTarget",void 0),(0,X.d)([(0,i.G)()],R.prototype,"panningInertia",void 0),(0,X.d)([(0,i.G)()],R.prototype,"zoomToMouseLocation",null),(0,X.d)([(0,i.G)()],R.prototype,"zoomOnFactor",void 0),(0,X.d)([(0,i.C)()],R.prototype,"targetScreenOffset",void 0),(0,X.d)([(0,i.G)()],R.prototype,"allowUpsideDown",void 0),(0,X.d)([(0,i.G)()],R.prototype,"useInputToRestoreState",void 0),(0,X.d)([(0,i.G)()],R.prototype,"restoreStateInterpolationFactor",void 0),(0,W.h)("BABYLON.ArcRotateCamera",R)},11311:(f,Q,H)=>{"use strict";H.d(Q,{c:()=>O});var X=H(978),i=H(982),S=H(1190),x=H(1203),K=H(994),Z=H(1003),B=H(11314),N=H(1092),J=H(1022),g=H(1082),z=H(1506),v=H(1325),Y=H(1151);class O extends B.e{get position(){return this._position}set position(f){this._position=f}set upVector(f){this._upVector=f}get upVector(){return this._upVector}get screenArea(){let f=0,Q=0;if(this.mode===O.PERSPECTIVE_CAMERA)this.fovMode===O.FOVMODE_VERTICAL_FIXED?(Q=2*this.nj*Math.tan(this.fov/2),f=this.getEngine().getAspectRatio(this)*Q):(f=2*this.nj*Math.tan(this.fov/2),Q=f/this.getEngine().getAspectRatio(this));else{const H=this.getEngine().getRenderWidth()/2,X=this.getEngine().getRenderHeight()/2;f=(this.orthoRight??H)-(this.orthoLeft??-H),Q=(this.orthoTop??X)-(this.orthoBottom??-X)}return f*Q}set orthoLeft(f){this._orthoLeft=f;for(const Q of this._rigCameras)Q.orthoLeft=f}get orthoLeft(){return this._orthoLeft}set orthoRight(f){this._orthoRight=f;for(const Q of this._rigCameras)Q.orthoRight=f}get orthoRight(){return this._orthoRight}set orthoBottom(f){this._orthoBottom=f;for(const Q of this._rigCameras)Q.orthoBottom=f}get orthoBottom(){return this._orthoBottom}set orthoTop(f){this._orthoTop=f;for(const Q of this._rigCameras)Q.orthoTop=f}get orthoTop(){return this._orthoTop}set mode(f){this._mode=f;for(const Q of this._rigCameras)Q.mode=f}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(f,Q,H){let X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(f,H,!1),this._position=Z.p.Zero(),this._upVector=Z.p.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.nj=1,this.maxZ=1e4,this.inertia=.9,this._mode=O.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new z.d(0,0,1,1),this.layerMask=268435455,this.fovMode=O.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=O.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new K.e,this.onProjectionMatrixChangedObservable=new K.e,this.onAfterCheckInputsObservable=new K.e,this.onRestoreStateObservable=new K.e,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new Z.e,this._postProcesses=new Array,this._activeMeshes=new S.g(256),this._globalPosition=Z.p.Zero(),this._computedViewMatrix=Z.e.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=Z.e.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=Z.i.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),X&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=Q,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${f}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Oh"}toString(f){let Q="Name: "+this.name;if(Q+=", type: "+this.getClassName(),this.animations)for(let H=0;H<this.animations.length;H++)Q+=", animation[0]: "+this.animations[H].toString(f);return Q}applyVerticalCorrection(){const f=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-f.x:f.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(f){return-1!==this._activeMeshes.indexOf(f)}isReady(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(f)for(const Q of this._postProcesses)if(Q&&!Q.isReady())return!1;return super.isReady(f)}_initCache(){super._initCache(),this._cache.position=new Z.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new Z.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.nj=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(f){f||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let f=this._cache.mode===this.mode&&this._cache.nj===this.nj&&this._cache.maxZ===this.maxZ;if(!f)return!1;const Q=this.getEngine();return this.mode===O.PERSPECTIVE_CAMERA?f=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===Q.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(f=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===Q.getRenderWidth()&&this._cache.renderHeight===Q.getRenderHeight(),this.oblique&&(f=f&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),f}attachControl(f,Q){}Ue(f){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==O.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let f=0;f<this._postProcesses.length;f++)if(null!==this._postProcesses[f])return this._postProcesses[f];return null}_cascadePostProcessesToRigCams(){const f=this._getFirstPostProcess();f&&f.markTextureDirty();for(let Q=0,H=this._rigCameras.length;Q<H;Q++){const f=this._rigCameras[Q],H=f._rigPostProcess;if(H){"pass"===H.getEffectName()&&(f.isIntermediate=0===this._postProcesses.length),f._postProcesses=this._postProcesses.slice(0).concat(H),H.markTextureDirty()}else f._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!f.isReusable()&&this._postProcesses.indexOf(f)>-1?(N.b.Error("You're trying to reuse a post process not defined as reusable."),0):(null==Q||Q<0?this._postProcesses.push(f):null===this._postProcesses[Q]?this._postProcesses[Q]=f:this._postProcesses.splice(Q,0,f),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.ve(),this._postProcesses.indexOf(f))}detachPostProcess(f){const Q=this._postProcesses.indexOf(f);-1!==Q&&(this._postProcesses[Q]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.ve(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return Z.e.Identity()}getViewMatrix(f){return!f&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(f){this._doNotComputeProjectionMatrix=!0,void 0!==f&&(this._projectionMatrix=f)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(f){if(this._doNotComputeProjectionMatrix||!f&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.nj=this.nj,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const Q=this.getEngine(),H=this.va(),X=Q.useReverseDepthBuffer;if(this.mode===O.PERSPECTIVE_CAMERA){let f;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=Q.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.nj<=0&&(this.nj=.1),f=H.useRightHandedSystem?Z.e.PerspectiveFovRHToRef:Z.e.PerspectiveFovLHToRef,f(this.fov,Q.getAspectRatio(this),X?this.maxZ:this.nj,X?this.nj:this.maxZ,this._projectionMatrix,this.fovMode===O.FOVMODE_VERTICAL_FIXED,Q.isNDCHalfZRange,this.projectionPlaneTilt,X)}else{var i,S,x;const f=Q.getRenderWidth()/2,K=Q.getRenderHeight()/2;H.useRightHandedSystem?this.oblique?Z.e.ObliqueOffCenterRHToRef(this.orthoLeft??-f,this.orthoRight??f,this.orthoBottom??-K,this.orthoTop??K,X?this.maxZ:this.nj,X?this.nj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,Q.isNDCHalfZRange):Z.e.OrthoOffCenterRHToRef(this.orthoLeft??-f,this.orthoRight??f,this.orthoBottom??-K,this.orthoTop??K,X?this.maxZ:this.nj,X?this.nj:this.maxZ,this._projectionMatrix,Q.isNDCHalfZRange):this.oblique?Z.e.ObliqueOffCenterLHToRef(this.orthoLeft??-f,this.orthoRight??f,this.orthoBottom??-K,this.orthoTop??K,X?this.maxZ:this.nj,X?this.nj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,Q.isNDCHalfZRange):Z.e.OrthoOffCenterLHToRef(this.orthoLeft??-f,this.orthoRight??f,this.orthoBottom??-K,this.orthoTop??K,X?this.maxZ:this.nj,X?this.nj:this.maxZ,this._projectionMatrix,Q.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(i=this.oblique)||void 0===i?void 0:i.angle,this._cache.obliqueLength=null===(S=this.oblique)||void 0===S?void 0:S.length,this._cache.obliqueOffset=null===(x=this.oblique)||void 0===x?void 0:x.offset,this._cache.renderWidth=Q.getRenderWidth(),this._cache.renderHeight=Q.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(f){return(this.i||(this.target?Z.p.Distance(this.position,this.target):this.position.length()))+f}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?v.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=v.e.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),Q&&this.rigCameras.length>0){let Q=!1;return this.rigCameras.forEach((H=>{H._updateFrustumPlanes(),Q=Q||f.isInFrustum(H._frustumPlanes)})),Q}return f.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(f){return this._updateFrustumPlanes(),f.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,g.c)("Ray")}getForwardRayToRef(f){throw(0,g.c)("Ray")}dispose(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const f=this._rigCameras.pop();f&&f.dispose()}if(this._parentContainer){const f=this._parentContainer.cameras.indexOf(this);f>-1&&this._parentContainer.cameras.splice(f,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==O.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let f=this._postProcesses.length;for(;--f>=0;){const Q=this._postProcesses[f];Q&&Q.dispose(this)}}let H=this.customRenderTargets.length;for(;--H>=0;)this.customRenderTargets[H].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(f,Q)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(f,Q){if(this.cameraRigMode!==f){for(;this._rigCameras.length>0;){const f=this._rigCameras.pop();f&&f.dispose()}if(this.cameraRigMode=f,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=Q.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=x.g.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==O.RIG_MODE_NONE){const f=this.createRigCamera(this.name+"_L",0);f&&(f._isLeftCamera=!0);const Q=this.createRigCamera(this.name+"_R",1);Q&&(Q._isRightCamera=!0),f&&Q&&(this._rigCameras.push(f),this._rigCameras.push(Q))}this._setRigMode(Q),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(f){}_getVRProjectionMatrix(){return Z.e.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.nj,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(f,Q){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[f]=Q,"interaxialDistance"===f&&(this._cameraRigParams.stereoHalfAngle=x.g.ToRadians(Q/.0637))}createRigCamera(f,Q){return null}_updateRigCameras(){for(let f=0;f<this._rigCameras.length;f++)this._rigCameras[f].nj=this.nj,this._rigCameras[f].maxZ=this.maxZ,this._rigCameras[f].fov=this.fov,this._rigCameras[f].upVector.p(this.upVector);this.cameraRigMode===O.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const f=Y.b.Serialize(this);return f.uniqueId=this.uniqueId,f.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(f),this.inputs&&this.inputs.serialize(f),Y.b.AppendSerializedAnimations(this,f),f.ranges=this.serializeAnimationRanges(),f.isEnabled=this.isEnabled(),f}clone(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=Y.b.Clone(O.GetConstructorFromName(this.getClassName(),f,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return H.name=f,H.parent=Q,this.onClonedObservable.notifyObservers(H),H}mf(f){const Q=Z.p.Zero();return this.getDirectionToRef(f,Q),Q}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(f,Q){Z.p.TransformNormalToRef(f,this.getWorldMatrix(),Q)}static GetConstructorFromName(f,Q,H){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const S=B.e.Construct(f,Q,H,{interaxial_distance:X,isStereoscopicSideBySide:i});return S||(()=>O._CreateDefaultParsedCamera(Q,H))}re(){return this.getWorldMatrix()}static Parse(f,Q){const H=f.type,X=O.GetConstructorFromName(H,f.name,Q,f.interaxial_distance,f.isStereoscopicSideBySide),i=Y.b.Parse(X,f,Q);if(void 0!==f.parentId&&(i._waitingParentId=f.parentId),void 0!==f.parentInstanceIndex&&(i._waitingParentInstanceIndex=f.parentInstanceIndex),i.inputs&&(i.inputs.parse(f),i._setupInputs()),f.upVector&&(i.upVector=Z.p.Zd(f.upVector)),i.setPosition&&(i.position.Xd(0,0,0),i.setPosition(Z.p.Zd(f.position))),f.target&&i.setTarget&&i.setTarget(Z.p.Zd(f.target)),f.cameraRigMode){const Q=f.interaxial_distance?{interaxialDistance:f.interaxial_distance}:{};i.setCameraRigMode(f.cameraRigMode,Q)}if(f.animations){for(let Q=0;Q<f.animations.length;Q++){const H=f.animations[Q],X=(0,J.e)("BABYLON.Animation");X&&i.animations.push(X.Parse(H))}B.e.ParseAnimationRanges(i,f,Q)}return f.autoAnimate&&Q.beginAnimation(i,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1),void 0!==f.isEnabled&&i.Dg(f.isEnabled),i}_calculateHandednessMultiplier(){let f=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(f*=-1),f}}O._CreateDefaultParsedCamera=(f,Q)=>{throw(0,g.c)("UniversalCamera")},O.PERSPECTIVE_CAMERA=0,O.ORTHOGRAPHIC_CAMERA=1,O.FOVMODE_VERTICAL_FIXED=0,O.FOVMODE_HORIZONTAL_FIXED=1,O.RIG_MODE_NONE=0,O.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,O.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,O.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,O.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,O.RIG_MODE_STEREOSCOPIC_INTERLACED=14,O.RIG_MODE_VR=20,O.RIG_MODE_CUSTOM=22,O.ForceAttachControlToAlwaysPreventDefault=!1,(0,X.d)([(0,i.F)("position")],O.prototype,"_position",void 0),(0,X.d)([(0,i.F)("upVector")],O.prototype,"_upVector",void 0),(0,X.d)([(0,i.G)()],O.prototype,"orthoLeft",null),(0,X.d)([(0,i.G)()],O.prototype,"orthoRight",null),(0,X.d)([(0,i.G)()],O.prototype,"orthoBottom",null),(0,X.d)([(0,i.G)()],O.prototype,"orthoTop",null),(0,X.d)([(0,i.G)()],O.prototype,"fov",void 0),(0,X.d)([(0,i.G)()],O.prototype,"projectionPlaneTilt",void 0),(0,X.d)([(0,i.G)()],O.prototype,"nj",void 0),(0,X.d)([(0,i.G)()],O.prototype,"maxZ",void 0),(0,X.d)([(0,i.G)()],O.prototype,"inertia",void 0),(0,X.d)([(0,i.G)()],O.prototype,"mode",null),(0,X.d)([(0,i.G)()],O.prototype,"layerMask",void 0),(0,X.d)([(0,i.G)()],O.prototype,"fovMode",void 0),(0,X.d)([(0,i.G)()],O.prototype,"cameraRigMode",void 0),(0,X.d)([(0,i.G)()],O.prototype,"interaxialDistance",void 0),(0,X.d)([(0,i.G)()],O.prototype,"isStereoscopicSideBySide",void 0)},11892:(f,Q,H)=>{"use strict";H.d(Q,{e:()=>x,h:()=>K});var X=H(1092),i=H(1151),S=H(11311),x={};class K{constructor(f){this.attachedToElement=!1,this.attached={},this.camera=f,this.checkInputs=()=>{}}add(f){const Q=f.getSimpleName();this.attached[Q]?X.b.Warn("camera input of type "+Q+" already exists on camera"):(this.attached[Q]=f,f.camera=this.camera,f.checkInputs&&(this.checkInputs=this._addCheckInputs(f.checkInputs.bind(f))),this.attachedToElement&&f.attachControl(this.noPreventDefault))}remove(f){for(const Q in this.attached){const H=this.attached[Q];if(H===f)return H.Ue(),H.camera=null,delete this.attached[Q],void this.rebuildInputCheck()}}removeByType(f){for(const Q in this.attached){const H=this.attached[Q];H.getClassName()===f&&(H.Ue(),H.camera=null,delete this.attached[Q],this.rebuildInputCheck())}}_addCheckInputs(f){const Q=this.checkInputs;return()=>{Q(),f()}}attachInput(f){this.attachedToElement&&f.attachControl(this.noPreventDefault)}attachElement(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){f=!S.c.ForceAttachControlToAlwaysPreventDefault&&f,this.attachedToElement=!0,this.noPreventDefault=f;for(const Q in this.attached)this.attached[Q].attachControl(f)}}detachElement(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const Q in this.attached)this.attached[Q].Ue(),f&&(this.attached[Q].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const f in this.attached){const Q=this.attached[f];Q.checkInputs&&(this.checkInputs=this._addCheckInputs(Q.checkInputs.bind(Q)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(f){const Q={};for(const H in this.attached){const f=this.attached[H],X=i.b.Serialize(f);Q[f.getClassName()]=X}f.inputsmgr=Q}parse(f){const Q=f.inputsmgr;if(Q){this.clear();for(const f in Q){const H=x[f];if(H){const X=Q[f],S=i.b.Parse((()=>new H),X,null);this.add(S)}}}else for(const H in this.attached){const Q=x[this.attached[H].getClassName()];if(Q){const X=i.b.Parse((()=>new Q),f,null);this.remove(this.attached[H]),this.add(X)}}}}},11882:(f,Q,H)=>{"use strict";H.d(Q,{b:()=>q});var X=H(978),i=H(982),S=H(1003),x=H(11890),K=H(11892),Z=H(1298),B=H(1203);class N{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(f){f=B.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((Q=>{const H=Q.event;if(!H.metaKey)if(Q.type===Z.d.KEYDOWN){if(-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysUpward.indexOf(H.keyCode)||-1!==this.keysDownward.indexOf(H.keyCode)||-1!==this.keysRotateLeft.indexOf(H.keyCode)||-1!==this.keysRotateRight.indexOf(H.keyCode)||-1!==this.keysRotateUp.indexOf(H.keyCode)||-1!==this.keysRotateDown.indexOf(H.keyCode)){-1===this._keys.indexOf(H.keyCode)&&this._keys.push(H.keyCode),f||H.preventDefault()}}else if(-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysUpward.indexOf(H.keyCode)||-1!==this.keysDownward.indexOf(H.keyCode)||-1!==this.keysRotateLeft.indexOf(H.keyCode)||-1!==this.keysRotateRight.indexOf(H.keyCode)||-1!==this.keysRotateUp.indexOf(H.keyCode)||-1!==this.keysRotateDown.indexOf(H.keyCode)){const Q=this._keys.indexOf(H.keyCode);Q>=0&&this._keys.splice(Q,1),f||H.preventDefault()}})))}Ue(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const f=this.camera;for(let Q=0;Q<this._keys.length;Q++){const H=this._keys[Q],X=f._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(H)?f._localDirection.Xd(-X,0,0):-1!==this.keysUp.indexOf(H)?f._localDirection.Xd(0,0,X):-1!==this.keysRight.indexOf(H)?f._localDirection.Xd(X,0,0):-1!==this.keysDown.indexOf(H)?f._localDirection.Xd(0,0,-X):-1!==this.keysUpward.indexOf(H)?f._localDirection.Xd(0,X,0):-1!==this.keysDownward.indexOf(H)?f._localDirection.Xd(0,-X,0):-1!==this.keysRotateLeft.indexOf(H)?(f._localDirection.Xd(0,0,0),f.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(H)?(f._localDirection.Xd(0,0,0),f.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(H)?(f._localDirection.Xd(0,0,0),f.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(H)&&(f._localDirection.Xd(0,0,0),f.cameraRotation.x+=this._getLocalRotation()),f.va().useRightHandedSystem&&(f._localDirection.z*=-1),f.getViewMatrix().invertToRef(f._cameraTransformMatrix),S.p.TransformNormalToRef(f._localDirection,f._cameraTransformMatrix,f._transformedDirection),f.cameraDirection.addInPlace(f._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const f=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*f}}(0,X.d)([(0,i.G)()],N.prototype,"keysUp",void 0),(0,X.d)([(0,i.G)()],N.prototype,"keysUpward",void 0),(0,X.d)([(0,i.G)()],N.prototype,"keysDown",void 0),(0,X.d)([(0,i.G)()],N.prototype,"keysDownward",void 0),(0,X.d)([(0,i.G)()],N.prototype,"keysLeft",void 0),(0,X.d)([(0,i.G)()],N.prototype,"keysRight",void 0),(0,X.d)([(0,i.G)()],N.prototype,"rotationSpeed",void 0),(0,X.d)([(0,i.G)()],N.prototype,"keysRotateLeft",void 0),(0,X.d)([(0,i.G)()],N.prototype,"keysRotateRight",void 0),(0,X.d)([(0,i.G)()],N.prototype,"keysRotateUp",void 0),(0,X.d)([(0,i.G)()],N.prototype,"keysRotateDown",void 0),K.e.FreeCameraKeyboardMoveInput=N;var J=H(994),g=H(1290);class z{constructor(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=f,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new J.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(f){f=B.g.BackCompatCameraNoPreventDefault(arguments);const Q=this.camera.getEngine(),H=Q.getInputElement();this._pointerInput||(this._pointerInput=X=>{const i=X.event,S="touch"===i.pointerType;if(!this.touchEnabled&&S)return;if(X.type!==g.c.POINTERMOVE&&-1===this.buttons.indexOf(i.button))return;const x=i.target;if(X.type===g.c.POINTERDOWN){if(S&&-1!==this._activePointerId||!S&&-1!==this._currentActiveButton)return;this._activePointerId=i.pointerId;try{null===x||void 0===x||x.setPointerCapture(i.pointerId)}catch(K){}-1===this._currentActiveButton&&(this._currentActiveButton=i.button),this._previousPosition={x:i.clientX,y:i.clientY},f||(i.preventDefault(),H&&H.focus()),Q.isPointerLock&&this._onMouseMove&&this._onMouseMove(X.event)}else if(X.type===g.c.POINTERUP){if(S&&this._activePointerId!==i.pointerId||!S&&this._currentActiveButton!==i.button)return;try{null===x||void 0===x||x.releasePointerCapture(i.pointerId)}catch(K){}this._currentActiveButton=-1,this._previousPosition=null,f||i.preventDefault(),this._activePointerId=-1}else if(X.type===g.c.POINTERMOVE&&(this._activePointerId===i.pointerId||!S))if(Q.isPointerLock&&this._onMouseMove)this._onMouseMove(X.event);else if(this._previousPosition){const Q=this.camera._calculateHandednessMultiplier(),H=(i.clientX-this._previousPosition.x)*Q,X=i.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=H/this.angularSensibility,this.camera.cameraRotation.x+=X/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:H,offsetY:X}),this._previousPosition={x:i.clientX,y:i.clientY},f||i.preventDefault()}}),this._onMouseMove=H=>{if(!Q.isPointerLock)return;const X=this.camera._calculateHandednessMultiplier(),i=H.movementX*X;this.camera.cameraRotation.y+=i/this.angularSensibility;const S=H.movementY;this.camera.cameraRotation.x+=S/this.angularSensibility,this._previousPosition=null,f||H.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,g.c.POINTERDOWN|g.c.POINTERUP|g.c.POINTERMOVE),H&&(this._contextMenuBind=f=>this.onContextMenu(f),H.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(f){f.preventDefault()}Ue(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const f=this.camera.getEngine().getInputElement();f&&f.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,X.d)([(0,i.G)()],z.prototype,"buttons",void 0),(0,X.d)([(0,i.G)()],z.prototype,"angularSensibility",void 0),K.e.FreeCameraMouseInput=z;var v,Y=H(1303);class O{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new J.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(f){f=B.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=Q=>{if(Q.type!==g.c.POINTERWHEEL)return;const H=Q.event,X=H.deltaMode===Y.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*X*H.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*X*H.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*X*H.deltaZ/this._normalize,H.preventDefault&&(f||H.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,g.c.POINTERWHEEL)}Ue(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,X.d)([(0,i.G)()],O.prototype,"wheelPrecisionX",void 0),(0,X.d)([(0,i.G)()],O.prototype,"wheelPrecisionY",void 0),(0,X.d)([(0,i.G)()],O.prototype,"wheelPrecisionZ",void 0),function(f){f[f.MoveRelative=0]="MoveRelative",f[f.RotateRelative=1]="RotateRelative",f[f.MoveScene=2]="MoveScene"}(v||(v={}));class n extends O{constructor(){super(...arguments),this._moveRelative=S.p.Zero(),this._rotateRelative=S.p.Zero(),this._moveScene=S.p.Zero(),this._wheelXAction=v.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=v.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(f){null===f&&this._wheelXAction!==v.MoveRelative||(this._wheelXAction=v.MoveRelative,this._wheelXActionCoordinate=f)}get wheelXMoveRelative(){return this._wheelXAction!==v.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(f){null===f&&this._wheelYAction!==v.MoveRelative||(this._wheelYAction=v.MoveRelative,this._wheelYActionCoordinate=f)}get wheelYMoveRelative(){return this._wheelYAction!==v.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(f){null===f&&this._wheelZAction!==v.MoveRelative||(this._wheelZAction=v.MoveRelative,this._wheelZActionCoordinate=f)}get wheelZMoveRelative(){return this._wheelZAction!==v.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(f){null===f&&this._wheelXAction!==v.RotateRelative||(this._wheelXAction=v.RotateRelative,this._wheelXActionCoordinate=f)}get wheelXRotateRelative(){return this._wheelXAction!==v.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(f){null===f&&this._wheelYAction!==v.RotateRelative||(this._wheelYAction=v.RotateRelative,this._wheelYActionCoordinate=f)}get wheelYRotateRelative(){return this._wheelYAction!==v.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(f){null===f&&this._wheelZAction!==v.RotateRelative||(this._wheelZAction=v.RotateRelative,this._wheelZActionCoordinate=f)}get wheelZRotateRelative(){return this._wheelZAction!==v.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(f){null===f&&this._wheelXAction!==v.MoveScene||(this._wheelXAction=v.MoveScene,this._wheelXActionCoordinate=f)}get wheelXMoveScene(){return this._wheelXAction!==v.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(f){null===f&&this._wheelYAction!==v.MoveScene||(this._wheelYAction=v.MoveScene,this._wheelYActionCoordinate=f)}get wheelYMoveScene(){return this._wheelYAction!==v.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(f){null===f&&this._wheelZAction!==v.MoveScene||(this._wheelZAction=v.MoveScene,this._wheelZActionCoordinate=f)}get wheelZMoveScene(){return this._wheelZAction!==v.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative._d(0),this._rotateRelative._d(0),this._moveScene._d(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const f=S.e.Zero();this.camera.getViewMatrix().invertToRef(f);const Q=S.p.Zero();S.p.TransformNormalToRef(this._moveRelative,f,Q),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(Q),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(f,Q,H){if(0===f)return;if(null===Q||null===H)return;let X=null;switch(Q){case v.MoveRelative:X=this._moveRelative;break;case v.RotateRelative:X=this._rotateRelative;break;case v.MoveScene:X=this._moveScene}switch(H){case 0:X.set(f,0,0);break;case 1:X.set(0,f,0);break;case 2:X.set(0,0,f)}}}(0,X.d)([(0,i.G)()],n.prototype,"wheelXMoveRelative",null),(0,X.d)([(0,i.G)()],n.prototype,"wheelYMoveRelative",null),(0,X.d)([(0,i.G)()],n.prototype,"wheelZMoveRelative",null),(0,X.d)([(0,i.G)()],n.prototype,"wheelXRotateRelative",null),(0,X.d)([(0,i.G)()],n.prototype,"wheelYRotateRelative",null),(0,X.d)([(0,i.G)()],n.prototype,"wheelZRotateRelative",null),(0,X.d)([(0,i.G)()],n.prototype,"wheelXMoveScene",null),(0,X.d)([(0,i.G)()],n.prototype,"wheelYMoveScene",null),(0,X.d)([(0,i.G)()],n.prototype,"wheelZMoveScene",null),K.e.FreeCameraMouseWheelInput=n;class e{constructor(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=f,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=B.g.IsSafari()}attachControl(f){f=B.g.BackCompatCameraNoPreventDefault(arguments);let Q=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=H=>{const X=H.event,i="mouse"===X.pointerType||this._isSafari&&"undefined"===typeof X.pointerType;if(this.allowMouse||!i)if(H.type===g.c.POINTERDOWN){if(f||X.preventDefault(),this._pointerPressed.push(X.pointerId),1!==this._pointerPressed.length)return;Q={x:X.clientX,y:X.clientY}}else if(H.type===g.c.POINTERUP){f||X.preventDefault();const H=this._pointerPressed.indexOf(X.pointerId);if(-1===H)return;if(this._pointerPressed.splice(H,1),0!=H)return;Q=null,this._offsetX=null,this._offsetY=null}else if(H.type===g.c.POINTERMOVE){if(f||X.preventDefault(),!Q)return;if(0!=this._pointerPressed.indexOf(X.pointerId))return;this._offsetX=X.clientX-Q.x,this._offsetY=-(X.clientY-Q.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,g.c.POINTERDOWN|g.c.POINTERUP|g.c.POINTERMOVE),this._onLostFocus){const f=this.camera.getEngine().getInputElement();f&&f.addEventListener("blur",this._onLostFocus)}}Ue(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const f=this.camera.getEngine().getInputElement();f&&f.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const f=this.camera,Q=f._calculateHandednessMultiplier();f.cameraRotation.y=Q*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)f.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const Q=f._computeLocalCameraSpeed(),H=new S.p(0,0,0!==this.touchMoveSensibility?Q*this._offsetY/this.touchMoveSensibility:0);S.e.RotationYawPitchRollToRef(f.rotation.y,f.rotation.x,0,f._cameraRotationMatrix),f.cameraDirection.addInPlace(S.p.TransformCoordinates(H,f._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,X.d)([(0,i.G)()],e.prototype,"touchAngularSensibility",void 0),(0,X.d)([(0,i.G)()],e.prototype,"touchMoveSensibility",void 0),K.e.FreeCameraTouchInput=e;class G extends K.h{constructor(f){super(f),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new N),this}addMouse(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new z(f),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new n,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new e),this}clear(){super.clear(),this._mouseInput=null}}var I=H(1022),l=H(1102);class q extends x.e{get angularSensibility(){const f=this.inputs.attached.mouse;return f?f.angularSensibility:0}set angularSensibility(f){const Q=this.inputs.attached.mouse;Q&&(Q.angularSensibility=f)}get keysUp(){const f=this.inputs.attached.keyboard;return f?f.keysUp:[]}set keysUp(f){const Q=this.inputs.attached.keyboard;Q&&(Q.keysUp=f)}get keysUpward(){const f=this.inputs.attached.keyboard;return f?f.keysUpward:[]}set keysUpward(f){const Q=this.inputs.attached.keyboard;Q&&(Q.keysUpward=f)}get keysDown(){const f=this.inputs.attached.keyboard;return f?f.keysDown:[]}set keysDown(f){const Q=this.inputs.attached.keyboard;Q&&(Q.keysDown=f)}get keysDownward(){const f=this.inputs.attached.keyboard;return f?f.keysDownward:[]}set keysDownward(f){const Q=this.inputs.attached.keyboard;Q&&(Q.keysDownward=f)}get keysLeft(){const f=this.inputs.attached.keyboard;return f?f.keysLeft:[]}set keysLeft(f){const Q=this.inputs.attached.keyboard;Q&&(Q.keysLeft=f)}get keysRight(){const f=this.inputs.attached.keyboard;return f?f.keysRight:[]}set keysRight(f){const Q=this.inputs.attached.keyboard;Q&&(Q.keysRight=f)}get keysRotateLeft(){const f=this.inputs.attached.keyboard;return f?f.keysRotateLeft:[]}set keysRotateLeft(f){const Q=this.inputs.attached.keyboard;Q&&(Q.keysRotateLeft=f)}get keysRotateRight(){const f=this.inputs.attached.keyboard;return f?f.keysRotateRight:[]}set keysRotateRight(f){const Q=this.inputs.attached.keyboard;Q&&(Q.keysRotateRight=f)}get keysRotateUp(){const f=this.inputs.attached.keyboard;return f?f.keysRotateUp:[]}set keysRotateUp(f){const Q=this.inputs.attached.keyboard;Q&&(Q.keysRotateUp=f)}get keysRotateDown(){const f=this.inputs.attached.keyboard;return f?f.keysRotateDown:[]}set keysRotateDown(f){const Q=this.inputs.attached.keyboard;Q&&(Q.keysRotateDown=f)}constructor(f,Q,H){var X;super(f,Q,H,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),X=this,this.ellipsoid=new S.p(.5,1,.5),this.ellipsoidOffset=new S.p(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=S.p.Zero(),this._diffPosition=S.p.Zero(),this._newPosition=S.p.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;X._newPosition.p(Q),X._newPosition.subtractToRef(X._oldPosition,X._diffPosition),X._diffPosition.length()>l.b.CollisionsEpsilon&&(X.position.addToRef(X._diffPosition,X._deferredPositionUpdate),X._deferOnly?X._deferredUpdated=!0:X.position.p(X._deferredPositionUpdate),X.Rk&&H&&X.Rk(H))},this.inputs=new G(this),this.inputs.addKeyboard().addMouse()}attachControl(f,Q){Q=B.g.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(Q)}Ue(){this.inputs.detachElement(),this.cameraDirection=new S.p(0,0,0),this.cameraRotation=new S.m(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(f){this._collisionMask=isNaN(f)?-1:f}_collideWithWorld(f){let Q;Q=this.parent?S.p.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,Q.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const H=this.va().collisionCoordinator;this._collider||(this._collider=H.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let X=f;this.applyGravity&&(X=f.add(this.va().gravity)),H.getNewPosition(this._oldPosition,X,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=S.p.Zero(),this._transformedDirection=S.p.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(f){this._needMoveForGravity=f}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fb"}}(0,X.d)([(0,i.F)()],q.prototype,"ellipsoid",void 0),(0,X.d)([(0,i.F)()],q.prototype,"ellipsoidOffset",void 0),(0,X.d)([(0,i.G)()],q.prototype,"checkCollisions",void 0),(0,X.d)([(0,i.G)()],q.prototype,"applyGravity",void 0),(0,I.h)("BABYLON.FreeCamera",q)},11890:(f,Q,H)=>{"use strict";H.d(Q,{e:()=>B});var X=H(978),i=H(982),S=H(11311),x=H(1003),K=H(1011),Z=H(1495);H(11314).e.AddNodeConstructor("TargetCamera",((f,Q)=>()=>new B(f,x.p.Zero(),Q)));class B extends S.c{constructor(f,Q,H){super(f,Q,H,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=x.p.Zero(),this._tmpTargetVector=x.p.Zero(),this.cameraDirection=new x.p(0,0,0),this.cameraRotation=new x.m(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new x.i,this.rotation=new x.p(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=x.p.Zero(),this._initialFocalDistance=1,this._viewMatrix=x.e.Zero(),this._camMatrix=x.e.Zero(),this._cameraTransformMatrix=x.e.Zero(),this._cameraRotationMatrix=x.e.Zero(),this._referencePoint=new x.p(0,0,1),this._transformedReferencePoint=x.p.Zero(),this._deferredPositionUpdate=new x.p,this._deferredRotationQuaternionUpdate=new x.i,this._deferredRotationUpdate=new x.p,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=x.p.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(f){this.getWorldMatrix();const Q=this.getTarget().hd(this.position);return Q.normalize(),Q.scaleInPlace(f),this.globalPosition.add(Q)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const f=this.lockedTarget;f.re().getTranslationToRef(f.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Xd(0,0,0),this.cameraRotation.Xd(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new x.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new x.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new x.i(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(f){f||super._updateCache();const Q=this._getLockedTargetPosition();Q?this._cache.lockedTarget?this._cache.lockedTarget.p(Q):this._cache.lockedTarget=Q.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const f=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(f):!f)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const f=this.getEngine();return this.speed*Math.sqrt(f.getDeltaTime()/(100*f.getFps()))}setTarget(f){this.upVector.normalize(),this._initialFocalDistance=f.hd(this.position).length(),this.position.z===f.z&&(this.position.z+=K.c),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),x.e.LookAtLHToRef(this.position,f,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const Q=f.hd(this.position);Q.x>=0?this.rotation.y=-Math.atan(Q.z/Q.x)+Math.PI/2:this.rotation.y=-Math.atan(Q.z/Q.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&x.i.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(f){this.setTarget(f)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(x.l.Matrix[0]),x.p.TransformNormalToRef(this.cameraDirection,x.l.Matrix[0],x.l.Wd[0]),this._deferredPositionUpdate.addInPlace(x.l.Wd[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const f=this.invertRotation?-this.inverseRotationSpeed:1,Q=this._decideIfNeedsToMove(),H=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),Q&&this._updatePosition(),H){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*f,this._deferredRotationUpdate.y+=this.cameraRotation.y*f,!this.noRotationConstraint){const f=1.570796;this._deferredRotationUpdate.x>f&&(this._deferredRotationUpdate.x=f),this._deferredRotationUpdate.x<-f&&(this._deferredRotationUpdate.x=-f)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(x.i.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}Q&&(Math.abs(this.cameraDirection.x)<this.speed*K.c&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*K.c&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*K.c&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),H&&(Math.abs(this.cameraRotation.x)<this.speed*K.c&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*K.c&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):x.e.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return x.p.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),x.p.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?Z.b.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(x.i.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),Z.b.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(f,Q,H){if(this.ignoreParentScaling){if(this.parent){const X=this.parent.getWorldMatrix();x.p.TransformCoordinatesToRef(f,X,this._globalPosition),x.p.TransformCoordinatesToRef(Q,X,this._tmpTargetVector),x.p.TransformNormalToRef(H,X,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(f),this._tmpTargetVector.p(Q),this._tmpUpVector.p(H);this.va().useRightHandedSystem?x.e.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):x.e.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?x.e.LookAtRHToRef(f,Q,H,this._viewMatrix):x.e.LookAtLHToRef(f,Q,H,this._viewMatrix),this.parent){const f=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(f,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(f)}createRigCamera(f,Q){if(this.cameraRigMode!==S.c.RIG_MODE_NONE){const Q=new B(f,this.position.clone(),this.va());return Q.isRigCamera=!0,Q.rigParent=this,this.cameraRigMode===S.c.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new x.i),Q._cameraRigParams={},Q.rotationQuaternion=new x.i),Q.mode=this.mode,Q.orthoLeft=this.orthoLeft,Q.orthoRight=this.orthoRight,Q.orthoTop=this.orthoTop,Q.orthoBottom=this.orthoBottom,Q}return null}_updateRigCameras(){const f=this._rigCameras[0],Q=this._rigCameras[1];switch(this.re(),this.cameraRigMode){case S.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case S.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case S.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case S.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case S.c.RIG_MODE_STEREOSCOPIC_INTERLACED:{const H=this.cameraRigMode===S.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,X=this.cameraRigMode===S.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*H,f),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*X,Q);break}case S.c.RIG_MODE_VR:f.rotationQuaternion?(f.rotationQuaternion.p(this.rotationQuaternion),Q.rotationQuaternion.p(this.rotationQuaternion)):(f.rotation.p(this.rotation),Q.rotation.p(this.rotation)),f.position.p(this.position),Q.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(f,Q){this.getTarget().subtractToRef(this.position,B._TargetFocalPoint),B._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const H=B._TargetFocalPoint.addInPlace(this.position);x.e.TranslationToRef(-H.x,-H.y,-H.z,B._TargetTransformMatrix),B._TargetTransformMatrix.multiplyToRef(x.e.RotationAxis(Q.upVector,f),B._RigCamTransformMatrix),x.e.TranslationToRef(H.x,H.y,H.z,B._TargetTransformMatrix),B._RigCamTransformMatrix.multiplyToRef(B._TargetTransformMatrix,B._RigCamTransformMatrix),x.p.TransformCoordinatesToRef(this.position,B._RigCamTransformMatrix,Q.position),Q.setTarget(H)}getClassName(){return"TargetCamera"}}B._RigCamTransformMatrix=new x.e,B._TargetTransformMatrix=new x.e,B._TargetFocalPoint=new x.p,(0,X.d)([(0,i.F)()],B.prototype,"rotation",void 0),(0,X.d)([(0,i.G)()],B.prototype,"speed",void 0),(0,X.d)([(0,i.t)("lockedTargetId")],B.prototype,"lockedTarget",void 0)},12292:(f,Q,H)=>{"use strict";H.d(Q,{c:()=>S});var X=H(1190),i=H(12298);class S{constructor(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=H,this.Li=[],this._maxBlockCapacity=Q||64,this._selectionContent=new X.d(1024),this._creationFunc=f}update(f,Q,H){i.d._CreateBlocks(f,Q,H,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}bf(f){for(let Q=0;Q<this.Uh.length;Q++){this.Uh[Q].addEntry(f)}}cf(f){for(let Q=0;Q<this.Uh.length;Q++){this.Uh[Q].removeEntry(f)}}select(f,Q){this._selectionContent.reset();for(let H=0;H<this.Uh.length;H++){this.Uh[H].select(f,this._selectionContent,Q)}return Q?this._selectionContent.concat(this.Li):this._selectionContent.concatWithNoDuplicate(this.Li),this._selectionContent}intersects(f,Q,H){this._selectionContent.reset();for(let X=0;X<this.Uh.length;X++){this.Uh[X].intersects(f,Q,this._selectionContent,H)}return H?this._selectionContent.concat(this.Li):this._selectionContent.concatWithNoDuplicate(this.Li),this._selectionContent}intersectsRay(f){this._selectionContent.reset();for(let Q=0;Q<this.Uh.length;Q++){this.Uh[Q].intersectsRay(f,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Li),this._selectionContent}}S.CreationFuncForMeshes=(f,Q)=>{const H=f.getBoundingInfo();!f.isBlocked&&H.boundingBox.intersectsMinMax(Q.Pi,Q.Qi)&&Q.entries.push(f)},S.CreationFuncForSubMeshes=(f,Q)=>{f.getBoundingInfo().boundingBox.intersectsMinMax(Q.Pi,Q.Qi)&&Q.entries.push(f)}},12298:(f,Q,H)=>{"use strict";H.d(Q,{d:()=>S});var X=H(1003),i=H(1364);class S{constructor(f,Q,H,X,i,S){this.entries=[],this.Ri=new Array,this._capacity=H,this._depth=X,this._maxDepth=i,this._creationFunc=S,this._minPoint=f,this._maxPoint=Q,this.Ri.push(f.clone()),this.Ri.push(Q.clone()),this.Ri.push(f.clone()),this.Ri[2].x=Q.x,this.Ri.push(f.clone()),this.Ri[3].y=Q.y,this.Ri.push(f.clone()),this.Ri[4].z=Q.z,this.Ri.push(Q.clone()),this.Ri[5].z=f.z,this.Ri.push(Q.clone()),this.Ri[6].x=f.x,this.Ri.push(Q.clone()),this.Ri[7].y=f.y}get Td(){return this._capacity}get Pi(){return this._minPoint}get Qi(){return this._maxPoint}addEntry(f){if(this.Uh)for(let Q=0;Q<this.Uh.length;Q++){this.Uh[Q].addEntry(f)}else this._creationFunc(f,this),this.entries.length>this.Td&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(f){if(this.Uh){for(let Q=0;Q<this.Uh.length;Q++){this.Uh[Q].removeEntry(f)}return}const Q=this.entries.indexOf(f);Q>-1&&this.entries.splice(Q,1)}addEntries(f){for(let Q=0;Q<f.length;Q++){const H=f[Q];this.addEntry(H)}}select(f,Q,H){if(i.e.IsInFrustum(this.Ri,f)){if(this.Uh){for(let X=0;X<this.Uh.length;X++){this.Uh[X].select(f,Q,H)}return}H?Q.concat(this.entries):Q.concatWithNoDuplicate(this.entries)}}intersects(f,Q,H,X){if(i.e.IntersectsSphere(this._minPoint,this._maxPoint,f,Q)){if(this.Uh){for(let i=0;i<this.Uh.length;i++){this.Uh[i].intersects(f,Q,H,X)}return}X?H.concat(this.entries):H.concatWithNoDuplicate(this.entries)}}intersectsRay(f,Q){if(f.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Uh){for(let H=0;H<this.Uh.length;H++){this.Uh[H].intersectsRay(f,Q)}return}Q.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){S._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(f,Q,H,i,x,K,Z,B){Z.Uh=new Array;const N=new X.p((Q.x-f.x)/2,(Q.y-f.y)/2,(Q.z-f.z)/2);for(let X=0;X<2;X++)for(let Q=0;Q<2;Q++)for(let J=0;J<2;J++){const g=f.add(N.multiplyByFloats(X,Q,J)),z=f.add(N.multiplyByFloats(X+1,Q+1,J+1)),v=new S(g,z,i,x+1,K,B);v.addEntries(H),Z.Uh.push(v)}}}},12304:(f,Q,H)=>{"use strict";H.d(Q,{d:()=>N});var X=H(1196),i=H(1003),S=H(11337),x=H(11462),K=H(1281),Z=H(12292),B=H(1027);X.e.prototype.createOrUpdateSelectionOctree=function(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,H=this._getComponent(K.e.NAME_OCTREE);H||(H=new N(this),this._e(H)),this.Ji||(this.Ji=new Z.c(Z.c.CreationFuncForMeshes,f,Q));const X=this.getWorldExtends();return this.Ji.update(X.min,X.max,this.meshes),this.Ji},Object.defineProperty(X.e.prototype,"selectionOctree",{get:function(){return this.Ji},enumerable:!0,configurable:!0}),S.c.prototype.createOrUpdateSubmeshesOctree=function(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const H=this.va();let X=H._getComponent(K.e.NAME_OCTREE);X||(X=new N(H),H._e(X)),this._submeshesOctree||(this._submeshesOctree=new Z.c(Z.c.CreationFuncForSubMeshes,f,Q)),this.re(!0);const i=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(i.minimumWorld,i.maximumWorld,this.ge),this._submeshesOctree};class N{constructor(f){this.name=K.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new x.d(i.p.Zero(),new i.p(1,1,1)),(f=f||B.e.LastCreatedScene)&&(this.Re=f,this.Re.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Re.getActiveSubMeshCandidates=f=>this.getActiveSubMeshCandidates(f),this.Re.getCollidingSubMeshCandidates=(f,Q)=>this.getCollidingSubMeshCandidates(f,Q),this.Re.getIntersectingSubMeshCandidates=(f,Q)=>this.getIntersectingSubMeshCandidates(f,Q))}register(){this.Re.onMeshRemovedObservable.add((f=>{const Q=this.Re.selectionOctree;if(void 0!==Q&&null!==Q){const H=Q.Li.indexOf(f);-1!==H&&Q.Li.splice(H,1)}})),this.Re.onMeshImportedObservable.add((f=>{const Q=this.Re.selectionOctree;void 0!==Q&&null!==Q&&Q.bf(f)}))}getActiveMeshCandidates(){var f;return(null===(f=this.Re.Ji)||void 0===f?void 0:f.select(this.Re.frustumPlanes))||this.Re._getDefaultMeshCandidates()}getActiveSubMeshCandidates(f){if(f._submeshesOctree&&f.useOctreeForRenderingSelection){return f._submeshesOctree.select(this.Re.frustumPlanes)}return this.Re._getDefaultSubMeshCandidates(f)}getIntersectingSubMeshCandidates(f,Q){if(f._submeshesOctree&&f.useOctreeForPicking){x.d.TransformToRef(Q,f.getWorldMatrix(),this._tempRay);return f._submeshesOctree.intersectsRay(this._tempRay)}return this.Re._getDefaultSubMeshCandidates(f)}getCollidingSubMeshCandidates(f,Q){if(f._submeshesOctree&&f.useOctreeForCollisions){const H=Q._velocityWorldLength+Math.max(Q._radius.x,Q._radius.y,Q._radius.z);return f._submeshesOctree.intersects(Q._basePointWorld,H)}return this.Re._getDefaultSubMeshCandidates(f)}rebuild(){}dispose(){}}},11462:(f,Q,H)=>{"use strict";H.d(Q,{d:()=>z});var X=H(1196),i=H(11311),S=H(1011),x=H(1003),K=H(1017),Z=H(1358),B=H(1246),N=H(1027),J=H(1310);const g={internalPickerForMesh:void 0};class z{constructor(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.c;this.origin=f,this.direction=Q,this.length=H,this.epsilon=X}clone(){return new z(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const X=z._TmpVector3[0].Xd(f.x-H,f.y-H,f.z-H),i=z._TmpVector3[1].Xd(Q.x+H,Q.y+H,Q.z+H);let S,x,K,Z,B=0,N=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<X.x||this.origin.x>i.x)return!1}else if(S=1/this.direction.x,x=(X.x-this.origin.x)*S,K=(i.x-this.origin.x)*S,K===-1/0&&(K=1/0),x>K&&(Z=x,x=K,K=Z),B=Math.max(x,B),N=Math.min(K,N),B>N)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<X.y||this.origin.y>i.y)return!1}else if(S=1/this.direction.y,x=(X.y-this.origin.y)*S,K=(i.y-this.origin.y)*S,K===-1/0&&(K=1/0),x>K&&(Z=x,x=K,K=Z),B=Math.max(x,B),N=Math.min(K,N),B>N)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<X.z||this.origin.z>i.z)return!1}else if(S=1/this.direction.z,x=(X.z-this.origin.z)*S,K=(i.z-this.origin.z)*S,K===-1/0&&(K=1/0),x>K&&(Z=x,x=K,K=Z),B=Math.max(x,B),N=Math.min(K,N),B>N)return!1;return!0}intersectsBox(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(f.minimum,f.maximum,Q)}intersectsSphere(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const H=f.center.x-this.origin.x,X=f.center.y-this.origin.y,i=f.center.z-this.origin.z,S=H*H+X*X+i*i,x=f.i+Q,K=x*x;if(S<=K)return!0;const Z=H*this.direction.x+X*this.direction.y+i*this.direction.z;if(Z<0)return!1;return S-Z*Z<=K}intersectsTriangle(f,Q,H){const X=z._TmpVector3[0],i=z._TmpVector3[1],S=z._TmpVector3[2],K=z._TmpVector3[3],B=z._TmpVector3[4];Q.subtractToRef(f,X),H.subtractToRef(f,i),x.p.CrossToRef(this.direction,i,S);const N=x.p.Dot(X,S);if(0===N)return null;const J=1/N;this.origin.subtractToRef(f,K);const g=x.p.Dot(K,S)*J;if(g<-this.epsilon||g>1+this.epsilon)return null;x.p.CrossToRef(K,X,B);const v=x.p.Dot(this.direction,B)*J;if(v<-this.epsilon||g+v>1+this.epsilon)return null;const Y=x.p.Dot(i,B)*J;return Y>this.length?null:new Z.b(1-g-v,g,Y)}intersectsPlane(f){let Q;const H=x.p.Dot(f.se,this.direction);if(Math.abs(H)<9.99999997475243e-7)return null;{const X=x.p.Dot(f.se,this.origin);return Q=(-f.d-X)/H,Q<0?Q<-9.99999997475243e-7?null:0:Q}}intersectsAxis(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(f){case"y":{const f=(this.origin.y-Q)/this.direction.y;return f>0?null:new x.p(this.origin.x+this.direction.x*-f,Q,this.origin.z+this.direction.z*-f)}case"x":{const f=(this.origin.x-Q)/this.direction.x;return f>0?null:new x.p(Q,this.origin.y+this.direction.y*-f,this.origin.z+this.direction.z*-f)}case"z":{const f=(this.origin.z-Q)/this.direction.z;return f>0?null:new x.p(this.origin.x+this.direction.x*-f,this.origin.y+this.direction.y*-f,Q)}default:return null}}intersectsMesh(f,Q,H){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,S=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const K=x.l.Matrix[0];return f.getWorldMatrix().invertToRef(K),this._tmpRay?z.TransformToRef(this,K,this._tmpRay):this._tmpRay=z.Transform(this,K),f.intersects(this._tmpRay,Q,H,X,i,S)}intersectsMeshes(f,Q,H){H?H.length=0:H=[];for(let X=0;X<f.length;X++){const i=this.intersectsMesh(f[X],Q);i.hit&&H.push(i)}return H.sort(this._comparePickingInfo),H}_comparePickingInfo(f,Q){return f.distance<Q.distance?-1:f.distance>Q.distance?1:0}intersectionSegment(f,Q,H){const X=this.origin,i=x.l.Wd[0],S=x.l.Wd[1],K=x.l.Wd[2],Z=x.l.Wd[3];Q.subtractToRef(f,i),this.direction.scaleToRef(z._Rayl,K),X.addToRef(K,S),f.subtractToRef(X,Z);const B=x.p.Dot(i,i),N=x.p.Dot(i,K),J=x.p.Dot(K,K),g=x.p.Dot(i,Z),v=x.p.Dot(K,Z),Y=B*J-N*N;let O,n,e=Y,G=Y;Y<z._Smallnum?(O=0,e=1,n=v,G=J):(O=N*v-J*g,n=B*v-N*g,O<0?(O=0,n=v,G=J):O>e&&(O=e,n=v+N,G=J)),n<0?(n=0,-g<0?O=0:-g>B?O=e:(O=-g,e=B)):n>G&&(n=G,-g+N<0?O=0:-g+N>B?O=e:(O=-g+N,e=B));const I=Math.abs(O)<z._Smallnum?0:O/e,l=Math.abs(n)<z._Smallnum?0:n/G,q=x.l.Wd[4];K.scaleToRef(l,q);const D=x.l.Wd[5];i.scaleToRef(I,D),D.addInPlace(Z);const d=x.l.Wd[6];D.subtractToRef(q,d);return l>0&&l<=this.length&&d.lengthSquared()<H*H?D.length():-1}update(f,Q,H,X,i,S,K){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){z._RayDistant||(z._RayDistant=z.Zero()),z._RayDistant.unprojectRayToRef(f,Q,H,X,x.e.IdentityReadOnly,S,K);const Z=x.l.Matrix[0];i.invertToRef(Z),z.TransformToRef(z._RayDistant,Z,this)}else this.unprojectRayToRef(f,Q,H,X,i,S,K);return this}static Zero(){return new z(x.p.Zero(),x.p.Zero())}static CreateNew(f,Q,H,X,i,S,x){return z.Zero().update(f,Q,H,X,i,S,x)}static CreateNewFromTo(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x.e.IdentityReadOnly;const X=new z(new x.p(0,0,0),new x.p(0,0,0));return z.CreateFromToToRef(f,Q,X,H)}static CreateFromToToRef(f,Q,H){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x.e.IdentityReadOnly;H.origin.p(f);const i=Q.subtractToRef(f,H.direction),S=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);return H.length=S,H.direction.normalize(),z.TransformToRef(H,X,H)}static Transform(f,Q){const H=new z(new x.p(0,0,0),new x.p(0,0,0));return z.TransformToRef(f,Q,H),H}static TransformToRef(f,Q,H){x.p.TransformCoordinatesToRef(f.origin,Q,H.origin),x.p.TransformNormalToRef(f.direction,Q,H.direction),H.length=f.length,H.epsilon=f.epsilon;const X=H.direction,i=X.length();if(0!==i&&1!==i){const f=1/i;X.x*=f,X.y*=f,X.z*=f,H.length*=i}return H}unprojectRayToRef(f,Q,H,X,i,S,K){const Z=x.l.Matrix[0];i.multiplyToRef(S,Z),Z.multiplyToRef(K,Z),Z.invert();const B=N.e.LastCreatedEngine,J=x.l.Wd[0];J.x=f/H*2-1,J.y=-(Q/X*2-1),J.z=null!==B&&void 0!==B&&B.useReverseDepthBuffer?1:null!==B&&void 0!==B&&B.isNDCHalfZRange?0:-1;const g=x.l.Wd[1].Xd(J.x,J.y,1-1e-8),z=x.l.Wd[2],v=x.l.Wd[3];x.p._UnprojectFromInvertedMatrixToRef(J,Z,z),x.p._UnprojectFromInvertedMatrixToRef(g,Z,v),this.origin.p(z),v.subtractToRef(z,this.direction),this.direction.normalize()}}function v(f,Q,H,X,i){let S=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const x=z.Zero();return Y(f,Q,H,X,x,i,S),x}function Y(f,Q,H,X,i,S){let K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Z=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const B=f.getEngine();if(!S&&!(S=f.activeCamera))return f;const N=S.viewport,J=B.getRenderHeight(),{x:g,y:z,width:v,height:Y}=N.toGlobal(B.getRenderWidth(),J),O=1/B.getHardwareScalingLevel();return Q=Q*O-g,H=H*O-(J-z-Y),i.update(Q,H,v,Y,X||x.e.IdentityReadOnly,K?x.e.IdentityReadOnly:S.getViewMatrix(),S.getProjectionMatrix(),Z),f}function O(f,Q,H,X,i){if(!B.d)return f;const S=f.getEngine();if(!i&&!(i=f.activeCamera))throw new Error("Active camera not set");const K=i.viewport,Z=S.getRenderHeight(),{x:N,y:J,width:g,height:z}=K.toGlobal(S.getRenderWidth(),Z),v=x.e.Identity(),Y=1/S.getHardwareScalingLevel();return Q=Q*Y-N,H=H*Y-(Z-J-z),X.update(Q,H,g,z,v,v,i.getProjectionMatrix()),f}function n(f,Q,H,X,i,S,x,K){const Z=Q(X,H.enableDistantPicking),B=H.intersects(Z,i,x,S,X,K);return B&&B.hit?!i&&null!=f&&B.distance>=f.distance?null:B:null}function e(f,Q,H,X,i,S){let K=null;const Z=!!(f.activeCameras&&f.activeCameras.length>1&&f.cameraToUseForPointers!==f.activeCamera),N=f.cameraToUseForPointers||f.activeCamera,J=g.internalPickerForMesh||n;for(let B=0;B<f.meshes.length;B++){const g=f.meshes[B];if(H){if(!H(g,-1))continue}else if(!g.isEnabled()||!g.isVisible||!g.Te)continue;const z=Z&&g.isWorldMatrixCameraDependent(),v=g.re(z,N);if(g.hasThinInstances&&g.thinInstanceEnablePicking){const f=J(K,Q,g,v,!0,!0,S);if(f){if(i)return f;const Z=x.l.Matrix[1],B=g.thinInstanceGetWorldMatrices();for(let f=0;f<B.length;f++){if(H&&!H(g,f))continue;B[f].multiplyToRef(v,Z);const x=J(K,Q,g,Z,X,i,S,!0);if(x&&(K=x,K.thinInstanceIndex=f,X))return K}}}else{const f=J(K,Q,g,v,X,i,S);if(f&&(K=f,X))return K}}return K||new B.d}function G(f,Q,H,X){if(!B.d)return null;const i=[],S=!!(f.activeCameras&&f.activeCameras.length>1&&f.cameraToUseForPointers!==f.activeCamera),K=f.cameraToUseForPointers||f.activeCamera,Z=g.internalPickerForMesh||n;for(let B=0;B<f.meshes.length;B++){const N=f.meshes[B];if(H){if(!H(N,-1))continue}else if(!N.isEnabled()||!N.isVisible||!N.Te)continue;const J=S&&N.isWorldMatrixCameraDependent(),g=N.re(J,K);if(N.hasThinInstances&&N.thinInstanceEnablePicking){if(Z(null,Q,N,g,!0,!0,X)){const f=x.l.Matrix[1],S=N.thinInstanceGetWorldMatrices();for(let x=0;x<S.length;x++){if(H&&!H(N,x))continue;S[x].multiplyToRef(g,f);const K=Z(null,Q,N,f,!1,!1,X,!0);K&&(K.thinInstanceIndex=x,i.push(K))}}}else{const f=Z(null,Q,N,g,!1,!1,X);f&&i.push(f)}}return i}function I(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,X=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;X||(X=f.getWorldMatrix()),Q.length=H,i?Q.origin.p(i):Q.origin.p(f.position);const S=x.l.Wd[2];S.set(0,0,f._scene.useRightHandedSystem?-1:1);const K=x.l.Wd[3];return x.p.TransformNormalToRef(S,X,K),x.p.NormalizeToRef(K,Q.direction),Q}var l,q;z._TmpVector3=(0,K.c)(6,x.p.Zero),z._RayDistant=z.Zero(),z._Smallnum=1e-8,z._Rayl=1e9,l=X.e,(q=i.c)&&(q.prototype.getForwardRay=function(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,Q=arguments.length>1?arguments[1]:void 0,H=arguments.length>2?arguments[2]:void 0;return I(this,new z(x.p.Zero(),x.p.Zero(),f),f,Q,H)},q.prototype.getForwardRayToRef=function(f){return I(this,f,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),l&&(J.d._IsPickingAvailable=!0,l.prototype.createPickingRay=function(f,Q,H,X){return v(this,f,Q,H,X,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),X.e.prototype.createPickingRayToRef=function(f,Q,H,X,i){return Y(this,f,Q,H,X,i,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},X.e.prototype.createPickingRayInCameraSpace=function(f,Q,H){return function(f,Q,H,X){const i=z.Zero();return O(f,Q,H,i,X),i}(this,f,Q,H)},X.e.prototype.createPickingRayInCameraSpaceToRef=function(f,Q,H,X){return O(this,f,Q,H,X)},X.e.prototype.pickWithBoundingInfo=function(f,Q,H,X,i){return function(f,Q,H,X,i,S){if(!B.d)return null;const K=e(f,(X=>(f._tempPickingRay||(f._tempPickingRay=z.Zero()),Y(f,Q,H,X,f._tempPickingRay,S||null),f._tempPickingRay)),X,i,!0);return K&&(K.ray=v(f,Q,H,x.e.Identity(),S||null)),K}(this,f,Q,H,X,i)},X.e.prototype.ed=function(f,Q,H,X,i,S){return function(f,Q,H,X,i,S,K){const Z=e(f,((X,i)=>(f._tempPickingRay||(f._tempPickingRay=z.Zero()),Y(f,Q,H,X,f._tempPickingRay,S||null,!1,i),f._tempPickingRay)),X,i,!1,K);return Z&&(Z.ray=v(f,Q,H,x.e.Identity(),S||null)),Z}(this,f,Q,H,X,i,S)},X.e.prototype.pickWithRay=function(f,Q,H,X){return function(f,Q,H,X,i){const S=e(f,(H=>(f._pickWithRayInverseMatrix||(f._pickWithRayInverseMatrix=x.e.Identity()),H.invertToRef(f._pickWithRayInverseMatrix),f._cachedRayForTransform||(f._cachedRayForTransform=z.Zero()),z.TransformToRef(Q,f._pickWithRayInverseMatrix,f._cachedRayForTransform),f._cachedRayForTransform)),H,X,!1,i);return S&&(S.ray=Q),S}(this,f,Q,H,X)},X.e.prototype.multiPick=function(f,Q,H,X,i){return function(f,Q,H,X,i,S){return G(f,(X=>v(f,Q,H,X,i||null)),X,S)}(this,f,Q,H,X,i)},X.e.prototype.multiPickWithRay=function(f,Q,H){return function(f,Q,H,X){return G(f,(H=>(f._pickWithRayInverseMatrix||(f._pickWithRayInverseMatrix=x.e.Identity()),H.invertToRef(f._pickWithRayInverseMatrix),f._cachedRayForTransform||(f._cachedRayForTransform=z.Zero()),z.TransformToRef(Q,f._pickWithRayInverseMatrix,f._cachedRayForTransform),f._cachedRayForTransform)),H,X)}(this,f,Q,H)}},12308:(f,Q,H)=>{"use strict";H(1092);var X=H(1439);H(1133),H(1261),H(1025),H(1472),H(1449);X.d},11164:(f,Q,H)=>{"use strict";H.r(Q),H.d(Q,{SceneInstrumentation:()=>S});var X=H(1203),i=H(1319);class S{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(f){f!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=f,f?(this._onBeforeActiveMeshesEvaluationObserver=this.Re.onBeforeActiveMeshesEvaluationObservable.add((()=>{X.g.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Re.onAfterActiveMeshesEvaluationObservable.add((()=>{X.g.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Re.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Re.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(f){f!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=f,f?(this._onBeforeRenderTargetsRenderObserver=this.Re.onBeforeRenderTargetsRenderObservable.add((()=>{X.g.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Re.onAfterRenderTargetsRenderObservable.add((()=>{X.g.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Re.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Re.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(f){f!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=f,f?(this._onBeforeParticlesRenderingObserver=this.Re.onBeforeParticlesRenderingObservable.add((()=>{X.g.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Re.onAfterParticlesRenderingObservable.add((()=>{X.g.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Re.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Re.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(f){f!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=f,this.Re.spriteManagers&&(f?(this._onBeforeSpritesRenderingObserver=this.Re.onBeforeSpritesRenderingObservable.add((()=>{X.g.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Re.onAfterSpritesRenderingObservable.add((()=>{X.g.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Re.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Re.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(f){f!==this._capturePhysicsTime&&this.Re.onBeforePhysicsObservable&&(this._capturePhysicsTime=f,f?(this._onBeforePhysicsObserver=this.Re.onBeforePhysicsObservable.add((()=>{X.g.StartPerformanceCounter("gb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Re.onAfterPhysicsObservable.add((()=>{X.g.EndPerformanceCounter("gb"),this._physicsTime.endMonitoring()}))):(this.Re.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Re.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(f){f!==this._captureAnimationsTime&&(this._captureAnimationsTime=f,f?this._onAfterAnimationsObserver=this.Re.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Re.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(f){this._captureFrameTime=f}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(f){this._captureInterFrameTime=f}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(f){f!==this._captureRenderTime&&(this._captureRenderTime=f,f?(this._onBeforeDrawPhaseObserver=this.Re.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),X.g.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Re.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),X.g.EndPerformanceCounter("Main render")}))):(this.Re.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Re.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(f){f!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=f,f?(this._onBeforeCameraRenderObserver=this.Re.onBeforeCameraRenderObservable.add((f=>{this._cameraRenderTime.beginMonitoring(),X.g.StartPerformanceCounter(`Rendering camera ${f.name}`)})),this._onAfterCameraRenderObserver=this.Re.onAfterCameraRenderObservable.add((f=>{this._cameraRenderTime.endMonitoring(!1),X.g.EndPerformanceCounter(`Rendering camera ${f.name}`)}))):(this.Re.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Re.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Re.getEngine()._drawCalls}constructor(f){this.Re=f,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new i.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new i.d,this._captureFrameTime=!1,this._frameTime=new i.d,this._captureRenderTime=!1,this._renderTime=new i.d,this._captureInterFrameTime=!1,this._interFrameTime=new i.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new i.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new i.d,this._capturePhysicsTime=!1,this._physicsTime=new i.d,this._captureAnimationsTime=!1,this._animationsTime=new i.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new i.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=f.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(X.g.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Re.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=f.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(X.g.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.de(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.de(),this._captureParticlesRenderTime&&this._particlesRenderTime.de(),this._captureSpritesRenderTime&&this._spritesRenderTime.de(),this._captureRenderTime&&this._renderTime.de(),this._captureCameraRenderTime&&this._cameraRenderTime.de()}))}dispose(){this.Re.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Re.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Re.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Re.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Re.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Re.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Re.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Re.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Re.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Re.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Re.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Re.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Re.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Re.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Re.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Re.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Re.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Re=null}}},11956:(f,Q,H)=>{"use strict";H.d(Q,{b:()=>N});var X=H(978),i=H(982),S=H(1003),x=H(11314),K=H(11932),Z=H(11965),B=H(1022);x.e.AddNodeConstructor("Light_Type_1",((f,Q)=>()=>new N(f,S.p.Zero(),Q)));class N extends Z.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(f){this._shadowFrustumSize=f,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(f){this._shadowOrthoScale=f,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(f){this._orthoLeft=f}get orthoRight(){return this._orthoRight}set orthoRight(f){this._orthoRight=f}get orthoTop(){return this._orthoTop}set orthoTop(f){this._orthoTop=f}get orthoBottom(){return this._orthoBottom}set orthoBottom(f){this._orthoBottom=f}constructor(f,Q,H){super(f,H),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=Q.scale(-1),this.direction=Q}getClassName(){return"kb"}getTypeID(){return K.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(f,Q,H){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(f):this._setDefaultAutoExtendShadowProjectionMatrix(f,Q,H)}_setDefaultFixedFrustumShadowProjectionMatrix(f){const Q=this.va().activeCamera;Q&&S.e.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:Q.nj,void 0!==this.shadowMaxZ?this.shadowMaxZ:Q.maxZ,f,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(f,Q,H){const X=this.va().activeCamera;if(!X)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const f=S.p.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let X=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let x=0;x<H.length;x++){const K=H[x];if(!K)continue;const Z=K.getBoundingInfo().boundingBox;for(let H=0;H<Z.vectorsWorld.length;H++)S.p.TransformCoordinatesToRef(Z.vectorsWorld[H],Q,f),f.x<this._orthoLeft&&(this._orthoLeft=f.x),f.y<this._orthoBottom&&(this._orthoBottom=f.y),f.x>this._orthoRight&&(this._orthoRight=f.x),f.y>this._orthoTop&&(this._orthoTop=f.y),this.autoCalcShadowZBounds&&(f.z<X&&(X=f.z),f.z>i&&(i=f.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=X,this._shadowMaxZ=i)}const i=this._orthoRight-this._orthoLeft,x=this._orthoTop-this._orthoBottom,K=void 0!==this.shadowMinZ?this.shadowMinZ:X.nj,Z=void 0!==this.shadowMaxZ?this.shadowMaxZ:X.maxZ,B=this.va().getEngine().useReverseDepthBuffer;S.e.OrthoOffCenterLHToRef(this._orthoLeft-i*this.shadowOrthoScale,this._orthoRight+i*this.shadowOrthoScale,this._orthoBottom-x*this.shadowOrthoScale,this._orthoTop+x*this.shadowOrthoScale,B?Z:K,B?K:Z,f,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(f,Q){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,Q),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,Q),this)}transferToNodeMaterialEffect(f,Q){return this.computeTransformedInformation()?(f.setFloat3(Q,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(f.setFloat3(Q,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(f){const Q=this._scene.getEngine();return!Q.useReverseDepthBuffer&&Q.isNDCHalfZRange?0:1}getDepthMaxZ(f){const Q=this._scene.getEngine();return Q.useReverseDepthBuffer&&Q.isNDCHalfZRange?0:1}prepareLightSpecificDefines(f,Q){f["DIRLIGHT"+Q]=!0}}(0,X.d)([(0,i.G)()],N.prototype,"shadowFrustumSize",null),(0,X.d)([(0,i.G)()],N.prototype,"shadowOrthoScale",null),(0,X.d)([(0,i.G)()],N.prototype,"autoUpdateExtends",void 0),(0,X.d)([(0,i.G)()],N.prototype,"autoCalcShadowZBounds",void 0),(0,X.d)([(0,i.G)("orthoLeft")],N.prototype,"_orthoLeft",void 0),(0,X.d)([(0,i.G)("orthoRight")],N.prototype,"_orthoRight",void 0),(0,X.d)([(0,i.G)("orthoTop")],N.prototype,"_orthoTop",void 0),(0,X.d)([(0,i.G)("orthoBottom")],N.prototype,"_orthoBottom",void 0),(0,B.h)("BABYLON.DirectionalLight",N)},12230:(f,Q,H)=>{"use strict";H.d(Q,{e:()=>N});var X=H(978),i=H(982),S=H(1003),x=H(1161),K=H(11314),Z=H(11932),B=H(1022);K.e.AddNodeConstructor("Light_Type_3",((f,Q)=>()=>new N(f,S.p.Zero(),Q)));class N extends Z.b{constructor(f,Q,H){super(f,H),this.groundColor=new x.e(0,0,0),this.direction=Q||S.p.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"mb"}setDirectionToTarget(f){return this.direction=S.p.Normalize(f.hd(S.p.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(f,Q){const H=S.p.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",H.x,H.y,H.z,0,Q),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.rj),Q),this}transferToNodeMaterialEffect(f,Q){const H=S.p.Normalize(this.direction);return f.setFloat3(Q,H.x,H.y,H.z),this}re(){return this._worldMatrix||(this._worldMatrix=S.e.Identity()),this._worldMatrix}getTypeID(){return Z.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(f,Q){f["HEMILIGHT"+Q]=!0}}(0,X.d)([(0,i.k)()],N.prototype,"groundColor",void 0),(0,X.d)([(0,i.F)()],N.prototype,"direction",void 0),(0,B.h)("BABYLON.HemisphericLight",N)},11932:(f,Q,H)=>{"use strict";H.d(Q,{b:()=>g});var X=H(978),i=H(982),S=H(1003),x=H(1161),K=H(11314),Z=H(1238),B=H(1022),N=H(1335),J=H(1151);class g extends K.e{get range(){return this._range}set range(f){this._range=f,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(f){this._intensityMode=f,this._computePhotometricScale()}get i(){return this._radius}set i(f){this._radius=f,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(f){this._shadowEnabled!==f&&(this._shadowEnabled=f,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(f){this._includedOnlyMeshes=f,this._hookArrayForIncludedOnly(f)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(f){this._excludedMeshes=f,this._hookArrayForExcluded(f)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(f){this._excludeWithLayerMask=f,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(f){this._includeOnlyWithLayerMask=f,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(f){this._lightmapMode!==f&&(this._lightmapMode=f,this._markMeshesAsLightDirty())}getViewMatrix(f){return null}getProjectionMatrix(f,Q){return null}constructor(f,Q){super(f,Q,!1),this.Ph=new x.e(1,1,1),this.Ce=new x.e(1,1,1),this.falloffType=g.FALLOFF_DEFAULT,this.rj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=g.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new Z.b(this.va().getEngine(),void 0,void 0,f),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(f,Q){return this}_bindLight(f,Q,H,X){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const S=f.toString();let K=!1;if(this._uniformBuffer.bindToEffect(H,"Light"+S),this._renderId!==Q.getRenderId()||this._lastUseSpecular!==X||!this._uniformBuffer.useUbo){this._renderId=Q.getRenderId(),this._lastUseSpecular=X;const f=this.getScaledIntensity();this.transferToEffect(H,S),this.Ph.scaleToRef(f,x.k.Fe[0]),this._uniformBuffer.updateColor4("vLightDiffuse",x.k.Fe[0],this.range,S),X&&(this.Ce.scaleToRef(f,x.k.Fe[1]),this._uniformBuffer.updateColor4("vLightSpecular",x.k.Fe[1],this.i,S)),K=!0}if(this.transferTexturesToEffect(H,S),Q.shadowsEnabled&&this.shadowEnabled&&i){const f=this.getShadowGenerator(Q.activeCamera)??this.getShadowGenerator();f&&(f.bindShadowLight(S,H),K=!0)}K?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(f){let Q="Name: "+this.name;if(Q+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let H=0;H<this.animations.length;H++)Q+=", animation[0]: "+this.animations[H].toString(f);return Q}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Dg(f){super.Dg(f),this._resyncMeshes()}getShadowGenerator(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(f)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return S.p.Zero()}canAffectMesh(f){return!f||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(f))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(f))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&f.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&f.layerMask)))}dispose(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const f=this._shadowGenerators.values();for(let Q=f.next();!0!==Q.done;Q=f.next()){Q.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const f=this._parentContainer.lights.indexOf(this);f>-1&&this._parentContainer.lights.splice(f,1),this._parentContainer=null}for(const H of this.va().meshes)H._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(f,Q)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.rj}clone(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=g.GetConstructorFromName(this.getTypeID(),f,this.va());if(!H)return null;const X=J.b.Clone(H,this);return f&&(X.name=f),Q&&(X.parent=Q),X.Dg(this.isEnabled()),this.onClonedObservable.notifyObservers(X),X}serialize(){const f=J.b.Serialize(this);return f.uniqueId=this.uniqueId,f.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(f),this.excludedMeshes.length>0&&(f.excludedMeshesIds=[],this.excludedMeshes.forEach((Q=>{f.excludedMeshesIds.push(Q.id)}))),this.includedOnlyMeshes.length>0&&(f.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((Q=>{f.includedOnlyMeshesIds.push(Q.id)}))),J.b.AppendSerializedAnimations(this,f),f.ranges=this.serializeAnimationRanges(),f.isEnabled=this.isEnabled(),f}static GetConstructorFromName(f,Q,H){const X=K.e.Construct("Light_Type_"+f,Q,H);return X||null}static Parse(f,Q){const H=g.GetConstructorFromName(f.type,f.name,Q);if(!H)return null;const X=J.b.Parse(H,f,Q);if(f.excludedMeshesIds&&(X._excludedMeshesIds=f.excludedMeshesIds),f.includedOnlyMeshesIds&&(X._includedOnlyMeshesIds=f.includedOnlyMeshesIds),void 0!==f.parentId&&(X._waitingParentId=f.parentId),void 0!==f.parentInstanceIndex&&(X._waitingParentInstanceIndex=f.parentInstanceIndex),void 0!==f.falloffType&&(X.falloffType=f.falloffType),void 0!==f.lightmapMode&&(X.lightmapMode=f.lightmapMode),f.animations){for(let Q=0;Q<f.animations.length;Q++){const H=f.animations[Q],i=(0,B.e)("BABYLON.Animation");i&&X.animations.push(i.Parse(H))}K.e.ParseAnimationRanges(X,f,Q)}return f.autoAnimate&&Q.beginAnimation(X,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1),void 0!==f.isEnabled&&X.Dg(f.isEnabled),X}_hookArrayForExcluded(f){var Q=this;const H=f.push;f.push=function(){for(var X=arguments.length,i=new Array(X),S=0;S<X;S++)i[S]=arguments[S];const x=H.apply(f,i);for(const f of i)f._resyncLightSource(Q);return x};const X=f.splice;f.splice=(Q,H)=>{const i=X.apply(f,[Q,H]);for(const f of i)f._resyncLightSource(this);return i};for(const i of f)i._resyncLightSource(this)}_hookArrayForIncludedOnly(f){var Q=this;const H=f.push;f.push=function(){for(var X=arguments.length,i=new Array(X),S=0;S<X;S++)i[S]=arguments[S];const x=H.apply(f,i);return Q._resyncMeshes(),x};const X=f.splice;f.splice=(Q,H)=>{const i=X.apply(f,[Q,H]);return this._resyncMeshes(),i},this._resyncMeshes()}_resyncMeshes(){for(const f of this.va().meshes)f._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const f of this.va().meshes)-1!==f.lightSources.indexOf(this)&&f._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let f=0;const Q=this.getTypeID();let H=this.intensityMode;switch(H===g.INTENSITYMODE_AUTOMATIC&&(H=Q===g.LIGHTTYPEID_DIRECTIONALLIGHT?g.INTENSITYMODE_ILLUMINANCE:g.INTENSITYMODE_LUMINOUSINTENSITY),Q){case g.LIGHTTYPEID_POINTLIGHT:case g.LIGHTTYPEID_SPOTLIGHT:switch(H){case g.INTENSITYMODE_LUMINOUSPOWER:f=1/(4*Math.PI);break;case g.INTENSITYMODE_LUMINOUSINTENSITY:f=1;break;case g.INTENSITYMODE_LUMINANCE:f=this.i*this.i}break;case g.LIGHTTYPEID_DIRECTIONALLIGHT:switch(H){case g.INTENSITYMODE_ILLUMINANCE:f=1;break;case g.INTENSITYMODE_LUMINANCE:{let Q=this.i;Q=Math.max(Q,.001);f=2*Math.PI*(1-Math.cos(Q));break}}break;case g.LIGHTTYPEID_HEMISPHERICLIGHT:f=1}return f}_reorderLightsInScene(){const f=this.va();0!=this._renderPriority&&(f.requireLightSorting=!0),this.va().sortLightsByPriority()}}g.FALLOFF_DEFAULT=N.e.FALLOFF_DEFAULT,g.FALLOFF_PHYSICAL=N.e.FALLOFF_PHYSICAL,g.FALLOFF_GLTF=N.e.FALLOFF_GLTF,g.FALLOFF_STANDARD=N.e.FALLOFF_STANDARD,g.LIGHTMAP_DEFAULT=N.e.LIGHTMAP_DEFAULT,g.LIGHTMAP_SPECULAR=N.e.LIGHTMAP_SPECULAR,g.LIGHTMAP_SHADOWSONLY=N.e.LIGHTMAP_SHADOWSONLY,g.INTENSITYMODE_AUTOMATIC=N.e.INTENSITYMODE_AUTOMATIC,g.INTENSITYMODE_LUMINOUSPOWER=N.e.INTENSITYMODE_LUMINOUSPOWER,g.INTENSITYMODE_LUMINOUSINTENSITY=N.e.INTENSITYMODE_LUMINOUSINTENSITY,g.INTENSITYMODE_ILLUMINANCE=N.e.INTENSITYMODE_ILLUMINANCE,g.INTENSITYMODE_LUMINANCE=N.e.INTENSITYMODE_LUMINANCE,g.LIGHTTYPEID_POINTLIGHT=N.e.LIGHTTYPEID_POINTLIGHT,g.LIGHTTYPEID_DIRECTIONALLIGHT=N.e.LIGHTTYPEID_DIRECTIONALLIGHT,g.LIGHTTYPEID_SPOTLIGHT=N.e.LIGHTTYPEID_SPOTLIGHT,g.LIGHTTYPEID_HEMISPHERICLIGHT=N.e.LIGHTTYPEID_HEMISPHERICLIGHT,(0,X.d)([(0,i.k)()],g.prototype,"diffuse",void 0),(0,X.d)([(0,i.k)()],g.prototype,"specular",void 0),(0,X.d)([(0,i.G)()],g.prototype,"falloffType",void 0),(0,X.d)([(0,i.G)()],g.prototype,"intensity",void 0),(0,X.d)([(0,i.G)()],g.prototype,"range",null),(0,X.d)([(0,i.G)()],g.prototype,"intensityMode",null),(0,X.d)([(0,i.G)()],g.prototype,"i",null),(0,X.d)([(0,i.G)()],g.prototype,"_renderPriority",void 0),(0,X.d)([(0,i.c)("_reorderLightsInScene")],g.prototype,"renderPriority",void 0),(0,X.d)([(0,i.G)("shadowEnabled")],g.prototype,"_shadowEnabled",void 0),(0,X.d)([(0,i.G)("excludeWithLayerMask")],g.prototype,"_excludeWithLayerMask",void 0),(0,X.d)([(0,i.G)("includeOnlyWithLayerMask")],g.prototype,"_includeOnlyWithLayerMask",void 0),(0,X.d)([(0,i.G)("lightmapMode")],g.prototype,"_lightmapMode",void 0)},11965:(f,Q,H)=>{"use strict";H.d(Q,{d:()=>Z});var X=H(978),i=H(982),S=H(1003),x=H(11932),K=H(1495);class Z extends x.b{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=S.e.Identity(),this._projectionMatrix=S.e.Identity()}_setPosition(f){this._position=f}get position(){return this._position}set position(f){this._setPosition(f)}_setDirection(f){this._direction=f}get direction(){return this._direction}set direction(f){this._setDirection(f)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(f){this._shadowMinZ=f,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(f){this._shadowMaxZ=f,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=S.p.Zero()),S.p.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=S.p.Zero()),S.p.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(f){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(f){return this.direction=S.p.Normalize(f.hd(this.position)),this.direction}getRotation(){this.direction.normalize();const f=S.p.Cross(this.direction,K.b.Y),Q=S.p.Cross(f,this.direction);return S.p.RotationFromAxis(f,Q,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=S.p.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}re(f){return!f&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=S.e.Identity()),S.e.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(f){return void 0!==this.shadowMinZ?this.shadowMinZ:f.nj}getDepthMaxZ(f){return void 0!==this.shadowMaxZ?this.shadowMaxZ:f.maxZ}setShadowProjectionMatrix(f,Q,H){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(Q,H,f):this._setDefaultShadowProjectionMatrix(f,Q,H),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(f){const Q=S.l.Wd[0];let H=this.position;this.computeTransformedInformation()&&(H=this.transformedPosition),S.p.NormalizeToRef(this.getShadowDirection(f),Q),1===Math.abs(S.p.Dot(Q,S.p.Up()))&&(Q.z=1e-13);const X=S.l.Wd[1];return H.addToRef(Q,X),S.e.LookAtLHToRef(H,X,S.p.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(f,Q){return this.setShadowProjectionMatrix(this._projectionMatrix,f??this._viewMatrix,Q??[]),this._projectionMatrix}}(0,X.d)([(0,i.F)()],Z.prototype,"position",null),(0,X.d)([(0,i.F)()],Z.prototype,"direction",null),(0,X.d)([(0,i.G)()],Z.prototype,"shadowMinZ",null),(0,X.d)([(0,i.G)()],Z.prototype,"shadowMaxZ",null)},11450:(f,Q,H)=>{"use strict";H.d(Q,{b:()=>x,d:()=>S,h:()=>K});const X={},i={};function S(f,Q){X[f]=Q}function x(f,Q){i[f]=Q}function K(f){return i[f]?i[f]:null}},11399:(f,Q,H)=>{"use strict";H.d(Q,{d:()=>U,f:()=>q});var X,i=H(1203),S=H(994),x=H(1196),K=H(1027),Z=H(1092),B=H(11334),N=H(1051),J=H(1067),g=H(1045),z=H(1102);!function(f){f[f.Clean=0]="Clean",f[f.Stop=1]="Stop",f[f.Sync=2]="Sync",f[f.NoSync=3]="NoSync"}(X||(X={}));const v=new S.e,Y={};let O=!1;function n(){return Y[".babylon"]}function e(f){const Q=Y[f];return Q||(Z.b.Warn("Unable to find a plugin to load "+f+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),n())}function G(f,Q,H){let X="Unable to load from "+(f.rawData?"binary data":f.url);return Q?X+=`: ${Q}`:H&&(X+=`: ${H}`),X}function I(f,Q,H,X,i,S,x,K,Z){var B;const J="data:"===(g=f.url).substring(0,5)?g.substring(5):null;var g;if(f.rawData&&!x)throw"When using ArrayBufferView to load data the file extension must be provided.";const O=x?e(x):J?function(f){for(const Q in Y){const H=Y[Q].plugin;if(H.canDirectLoad&&H.canDirectLoad(f))return Y[Q]}return n()}(f.url):function(f){const Q=f.indexOf("?");-1!==Q&&(f=f.substring(0,Q));const H=f.lastIndexOf(".");return e(f.substring(H,f.length).toLowerCase())}(f.url);if(!O)throw new Error(`No plugin or fallback for ${x??f.url}`);if(!1===(null===Z||void 0===Z||null===(B=Z[O.plugin.name])||void 0===B?void 0:B.enabled))throw new Error(`The '${O.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(f.rawData&&!O.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(f=>{if(O.plugin.createPlugin){const Q=O.plugin.createPlugin(Z??{});return Q instanceof Promise?(Q.then(f).catch((f=>{i("Error instantiating plugin.",f)})),null):(f(Q),Q)}return f(O.plugin),O.plugin})((Z=>{var B;if(!Z)throw`The loader plugin corresponding to the '${x}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(v.notifyObservers(Z),J&&(Z.canDirectLoad&&Z.canDirectLoad(f.url)||!(0,N.i)(f.url))){if(Z.directLoad){const f=Z.directLoad(Q,J);f instanceof Promise?f.then((f=>{H(Z,f)})).catch((f=>{i("Error in directLoad of _loadData: "+f,f)})):H(Z,f)}else H(Z,J);return}const g=O.isBinary,Y=(f,X)=>{Q.u?i("Scene has been disposed"):H(Z,f,X)};let n=null,e=!1;null===(B=Z.fe)||void 0===B||B.add((()=>{e=!0,n&&(n.abort(),n=null),S()}));const G=()=>{if(e)return;const H=(f,Q)=>{i(null===f||void 0===f?void 0:f.statusText,Q)};if(!Z.loadFile&&f.rawData)throw"Plugin does not support loading ArrayBufferView.";n=Z.loadFile?Z.loadFile(Q,f.rawData||f.file||f.url,f.rootUrl,Y,X,g,H,K):Q._loadFile(f.file||f.url,Y,X,!0,g,H)},I=Q.getEngine();let l=I.enableOfflineSupport;if(l){let H=!1;for(const X of Q.disableOfflineSupportExceptionRules)if(X.test(f.url)){H=!0;break}l=!H}l&&z.b.OfflineProviderFactory?Q.offlineProvider=z.b.OfflineProviderFactory(f.url,G,I.disableManifestCheck):G()}))}function l(f,Q){let H,X,S=null,x=null;if(Q)if(Q.name)H=`file:${Q.name}`,X=Q.name,S=Q;else if(ArrayBuffer.isView(Q))H="",X=(0,g.c)(),x=Q;else if(Q.startsWith("data:"))H=Q,X="";else if(f){const S=Q;if("/"===S.substring(0,1))return i.g.Error("Wrong sceneFilename parameter"),null;H=f+S,X=S}else H=Q,X=i.g.GetFilename(Q),f=i.g.GetFolderPath(Q);else H=f,X=i.g.GetFilename(f),f=i.g.GetFolderPath(f);return{url:H,rootUrl:f,name:X,file:S,rawData:x}}function q(f){if("string"===typeof f.extensions){const Q=f.extensions;Y[Q.toLowerCase()]={plugin:f,isBinary:!1}}else{const Q=f.extensions;Object.keys(Q).forEach((H=>{Y[H.toLowerCase()]={plugin:f,isBinary:Q[H].isBinary}}))}}function D(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:K.e.LastCreatedScene,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!X)return Z.b.Error("No scene available to import mesh to"),null;const z=l(Q,H);if(!z)return null;const v={};X.addPendingData(v);const Y=()=>{X.removePendingData(v)},O=(f,Q)=>{const H=G(z,f,Q);x?x(X,H,new J.f(H,J.e.SceneLoaderError,Q)):Z.b.Error(H),Y()},n=S?f=>{try{S(f)}catch(Q){O("Error in onProgress callback: "+Q,Q)}}:void 0,e=(f,Q,H,S,x,K,Z,B)=>{if(X.importedMeshesFiles.push(z.url),i)try{i(f,Q,H,S,x,K,Z,B)}catch(N){O("Error in onSuccess callback: "+N,N)}X.removePendingData(v)};return I(z,X,((Q,H,i)=>{if(Q.rewriteRootURL&&(z.rootUrl=Q.rewriteRootURL(z.rootUrl,i)),Q.importMesh){const i=[],S=[],x=[];if(!Q.importMesh(f,X,H,z.rootUrl,i,S,x,O))return;X.loadingPluginName=Q.name,e(i,S,x,[],[],[],[],[])}else{Q.importMeshAsync(f,X,H,z.rootUrl,n,z.name).then((f=>{X.loadingPluginName=Q.name,e(f.meshes,f.pe,f.skeletons,f.animationGroups,f.transformNodes,f.geometries,f.lights,f.spriteManagers)})).catch((f=>{O(f.message,f)}))}}),n,O,Y,B,N,g)}function d(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.e.LastCreatedEngine,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return H?F(f,Q,new x.e(H),X,S,Z,B,N,J):(i.g.Error("No engine available"),null)}function s(f,Q,H,X,i,S,x){return new Promise(((K,Z)=>{d(f,Q,H,(f=>{K(f)}),X,((f,Q,H)=>{Z(H||new Error(Q))}),i,S,x)}))}function F(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.e.LastCreatedScene,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!H)return Z.b.Error("No scene available to append to"),null;const z=l(f,Q);if(!z)return null;const v={};H.addPendingData(v);const Y=()=>{H.removePendingData(v)};B.c.ShowLoadingScreen&&!O&&(O=!0,H.getEngine().displayLoadingUI(),H.executeWhenReady((()=>{H.getEngine().hideLoadingUI(),O=!1})));const n=(f,Q)=>{const X=G(z,f,Q);S?S(H,X,new J.f(X,J.e.SceneLoaderError,Q)):Z.b.Error(X),Y()},e=i?f=>{try{i(f)}catch(Q){n("Error in onProgress callback",Q)}}:void 0,q=()=>{if(X)try{X(H)}catch(f){n("Error in onSuccess callback",f)}H.removePendingData(v)};return I(z,H,((f,Q)=>{if(f.load){if(!f.load(H,Q,z.rootUrl,n))return;H.loadingPluginName=f.name,q()}else{f.loadAsync(H,Q,z.rootUrl,e,z.name).then((()=>{H.loadingPluginName=f.name,q()})).catch((f=>{n(f.message,f)}))}}),e,n,Y,x,N,g)}function P(f,Q,H,X,i,S,x){return new Promise(((K,Z)=>{F(f,Q,H,(f=>{K(f)}),X,((f,Q,H)=>{Z(H||new Error(Q))}),i,S,x)}))}function m(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.e.LastCreatedScene,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!H)return Z.b.Error("No scene available to load asset container to"),null;const g=l(f,Q);if(!g)return null;const z={};H.addPendingData(z);const v=()=>{H.removePendingData(z)},Y=(f,Q)=>{const X=G(g,f,Q);S?S(H,X,new J.f(X,J.e.SceneLoaderError,Q)):Z.b.Error(X),v()},O=i?f=>{try{i(f)}catch(Q){Y("Error in onProgress callback",Q)}}:void 0,n=f=>{if(X)try{X(f)}catch(Q){Y("Error in onSuccess callback",Q)}H.removePendingData(z)};return I(g,H,((f,Q)=>{if(f.loadAssetContainer){const X=f.loadAssetContainer(H,Q,g.rootUrl,Y);if(!X)return;X.populateRootNodes(),H.loadingPluginName=f.name,n(X)}else if(f.loadAssetContainerAsync){f.loadAssetContainerAsync(H,Q,g.rootUrl,O,g.name).then((Q=>{Q.populateRootNodes(),H.loadingPluginName=f.name,n(Q)})).catch((f=>{Y(f.message,f)}))}else Y("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),O,Y,v,x,B,N)}function c(f,Q,H,X,i,S,x){return new Promise(((K,Z)=>{m(f,Q,H,(f=>{K(f)}),X,((f,Q,H)=>{Z(H||new Error(Q))}),i,S,x)}))}function W(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.e.LastCreatedScene,X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,J=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!H)return void Z.b.Error("No scene available to load animations to");if(X){for(const f of H.animatables)f.reset();H.stopAllAnimations(),H.animationGroups.slice().forEach((f=>{f.dispose()}));H.getNodes().forEach((f=>{f.animations&&(f.animations=[])}))}else switch(i){case 0:H.animationGroups.slice().forEach((f=>{f.dispose()}));break;case 1:H.animationGroups.forEach((f=>{f.stop()}));break;case 2:H.animationGroups.forEach((f=>{f.reset(),f.restart()}));break;case 3:break;default:return void Z.b.Error("Unknown animation group loading mode value '"+i+"'")}const v=H.animatables.length;m(f,Q,H,(f=>{f.mergeAnimationsTo(H,H.animatables.slice(v),S),f.dispose(),H.onAnimationFileImportedObservable.notifyObservers(H),x&&x(H)}),B,N,J,g,z)}function R(f,Q,H,X,i,S,x,K,Z,B){return new Promise(((N,J)=>{W(f,Q,H,X,i,S,(f=>{N(f)}),x,((f,Q,H)=>{J(H||new Error(Q))}),K,Z,B)}))}class U{static get ForceFullSceneLoadingForIncremental(){return B.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(f){B.c.ForceFullSceneLoadingForIncremental=f}static get ShowLoadingScreen(){return B.c.ShowLoadingScreen}static set ShowLoadingScreen(f){B.c.ShowLoadingScreen=f}static get loggingLevel(){return B.c.loggingLevel}static set loggingLevel(f){B.c.loggingLevel=f}static get CleanBoneMatrixWeights(){return B.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(f){B.c.CleanBoneMatrixWeights=f}static GetDefaultPlugin(){return n()}static GetPluginForExtension(f){var Q;return null===(Q=e(f))||void 0===Q?void 0:Q.plugin}static IsPluginForExtensionAvailable(f){return function(f){return!!Y[f]}(f)}static RegisterPlugin(f){q(f)}static ImportMesh(f,Q,H,X,i,S,x,K,Z){return D(f,Q,H,X,i,S,x,K,Z)}static ImportMeshAsync(f,Q,H,X,i,S,x){return function(f,Q,H,X,i,S,x,K){return new Promise(((Z,B)=>{D(f,Q,H,X,((f,Q,H,X,i,S,x,K)=>{Z({meshes:f,pe:Q,skeletons:H,animationGroups:X,transformNodes:i,geometries:S,lights:x,spriteManagers:K})}),i,((f,Q,H)=>{B(H||new Error(Q))}),S,x,K)}))}(f,Q,H,X,i,S,x)}static Load(f,Q,H,X,i,S,x,K){return d(f,Q,H,X,i,S,x,K)}static LoadAsync(f,Q,H,X,i,S){return s(f,Q,H,X,i,S)}static Append(f,Q,H,X,i,S,x,K){return F(f,Q,H,X,i,S,x,K)}static AppendAsync(f,Q,H,X,i,S){return P(f,Q,H,X,i,S)}static LoadAssetContainer(f,Q,H,X,i,S,x,K){return m(f,Q,H,X,i,S,x,K)}static LoadAssetContainerAsync(f,Q,H,X,i,S){return c(f,Q,H,X,i,S)}static ImportAnimations(f,Q,H,X,i,S,x,K,Z,B,N){W(f,Q,H,X,i,S,x,K,Z,B,N)}static ImportAnimationsAsync(f,Q,H,X,i,S,x,K,Z,B,N){return R(f,Q,H,X,i,S,K,B,N)}}U.NO_LOGGING=0,U.MINIMAL_LOGGING=1,U.SUMMARY_LOGGING=2,U.DETAILED_LOGGING=3,U.OnPluginActivatedObservable=v},11334:(f,Q,H)=>{"use strict";H.d(Q,{c:()=>X});class X{static get ForceFullSceneLoadingForIncremental(){return X._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(f){X._ForceFullSceneLoadingForIncremental=f}static get ShowLoadingScreen(){return X._ShowLoadingScreen}static set ShowLoadingScreen(f){X._ShowLoadingScreen=f}static get loggingLevel(){return X._LoggingLevel}static set loggingLevel(f){X._LoggingLevel=f}static get CleanBoneMatrixWeights(){return X._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(f){X._CleanBoneMatrixWeights=f}}X._ForceFullSceneLoadingForIncremental=!1,X._ShowLoadingScreen=!0,X._CleanBoneMatrixWeights=!1,X._LoggingLevel=0},11922:(f,Q,H)=>{"use strict";H.d(Q,{c:()=>V});var X=H(978),i=H(982),S=H(1092),x=H(1190),K=H(11916),Z=H(1196),B=H(1003),N=H(1253),J=H(1401),g=H(1422);class z extends J.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class v extends g.c{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(f,"PBRBRDF",90,new z,Q),this._useEnergyConservation=v.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=v.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=v.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=v.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=v.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=v.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=v.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=v.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=f._dirtyCallbacks[16],this._enable(!0)}prepareDefines(f){f.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,f.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,f.SPHERICAL_HARMONICS=this._useSphericalHarmonics,f.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}v.DEFAULT_USE_ENERGY_CONSERVATION=!0,v.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,v.DEFAULT_USE_SPHERICAL_HARMONICS=!0,v.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsMiscDirty")],v.prototype,"useEnergyConservation",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsMiscDirty")],v.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsMiscDirty")],v.prototype,"useSphericalHarmonics",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsMiscDirty")],v.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var Y=H(1343),O=H(1161),n=H(1223),e=H(1352),G=H(1404),I=H(974),l=H(1411),q=(H(10263),H(1416)),D=H(1389);class d extends J.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class s extends g.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(f,"PBRClearCoat",100,new d,Q),this._isEnabled=!1,this.isEnabled=!1,this.rj=1,this.roughness=0,this._indexOfRefraction=s._DefaultIndexOfRefraction,this.indexOfRefraction=s._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=O.e.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=f._dirtyCallbacks[1]}isReadyForSubMesh(f,Q,H){if(!this._isEnabled)return!0;const X=this._material._disableBumpMap;if(f._areTexturesDirty&&Q.texturesEnabled){if(this._texture&&l.e.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&l.e.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(H.getCaps().standardDerivatives&&this._bumpTexture&&l.e.ClearCoatBumpTextureEnabled&&!X&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&l.e.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(f,Q){this._isEnabled?(f.CLEARCOAT=!0,f.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,f.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,f._areTexturesDirty&&Q.texturesEnabled&&(this._texture&&l.e.ClearCoatTextureEnabled?(0,D.W)(this._texture,f,"CLEARCOAT_TEXTURE"):f.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&l.e.ClearCoatTextureEnabled?(0,D.W)(this._textureRoughness,f,"CLEARCOAT_TEXTURE_ROUGHNESS"):f.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&l.e.ClearCoatBumpTextureEnabled?(0,D.W)(this._bumpTexture,f,"CLEARCOAT_BUMP"):f.CLEARCOAT_BUMP=!1,f.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===s._DefaultIndexOfRefraction,this._isTintEnabled?(f.CLEARCOAT_TINT=!0,this._tintTexture&&l.e.ClearCoatTintTextureEnabled?((0,D.W)(this._tintTexture,f,"CLEARCOAT_TINT_TEXTURE"),f.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):f.CLEARCOAT_TINT_TEXTURE=!1):(f.CLEARCOAT_TINT=!1,f.CLEARCOAT_TINT_TEXTURE=!1))):(f.CLEARCOAT=!1,f.CLEARCOAT_TEXTURE=!1,f.CLEARCOAT_TEXTURE_ROUGHNESS=!1,f.CLEARCOAT_BUMP=!1,f.CLEARCOAT_TINT=!1,f.CLEARCOAT_TINT_TEXTURE=!1,f.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,f.CLEARCOAT_DEFAULTIOR=!1,f.CLEARCOAT_TEXTUREDIRECTUV=0,f.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,f.CLEARCOAT_BUMPDIRECTUV=0,f.CLEARCOAT_REMAP_F0=!1,f.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,f.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(f,Q,H,X){if(!this._isEnabled)return;const i=X.materialDefines,S=this._material.isFrozen,x=this._material._disableBumpMap,K=this._material._invertNormalMapX,Z=this._material._invertNormalMapY;if(!f.useUbo||!S||!f.isSync){var B,N,J,g;if((this._texture||this._textureRoughness)&&l.e.ClearCoatTextureEnabled)f.updateFloat4("vClearCoatInfos",(null===(B=this._texture)||void 0===B?void 0:B.coordinatesIndex)??0,(null===(N=this._texture)||void 0===N?void 0:N.level)??0,(null===(J=this._textureRoughness)||void 0===J?void 0:J.coordinatesIndex)??0,(null===(g=this._textureRoughness)||void 0===g?void 0:g.level)??0),this._texture&&(0,D.u)(this._texture,f,"clearCoat"),this._textureRoughness&&!i.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,D.u)(this._textureRoughness,f,"clearCoatRoughness");this._bumpTexture&&H.getCaps().standardDerivatives&&l.e.ClearCoatTextureEnabled&&!x&&(f.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,D.u)(this._bumpTexture,f,"clearCoatBump"),Q._mirroredCameraPosition?f.updateFloat2("vClearCoatTangentSpaceParams",K?1:-1,Z?1:-1):f.updateFloat2("vClearCoatTangentSpaceParams",K?-1:1,Z?-1:1)),this._tintTexture&&l.e.ClearCoatTintTextureEnabled&&(f.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,D.u)(this._tintTexture,f,"clearCoatTint")),f.updateFloat2("vClearCoatParams",this.rj,this.roughness);const X=1-this._indexOfRefraction,S=1+this._indexOfRefraction,z=Math.pow(-X/S,2),v=1/this._indexOfRefraction;f.updateFloat4("vClearCoatRefractionParams",z,v,X,S),this._isTintEnabled&&(f.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),f.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}Q.texturesEnabled&&(this._texture&&l.e.ClearCoatTextureEnabled&&f.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!i.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&l.e.ClearCoatTextureEnabled&&f.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&H.getCaps().standardDerivatives&&l.e.ClearCoatBumpTextureEnabled&&!x&&f.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&l.e.ClearCoatTintTextureEnabled&&f.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(f){return this._texture===f||(this._textureRoughness===f||(this._bumpTexture===f||this._tintTexture===f))}getActiveTextures(f){this._texture&&f.push(this._texture),this._textureRoughness&&f.push(this._textureRoughness),this._bumpTexture&&f.push(this._bumpTexture),this._tintTexture&&f.push(this._tintTexture)}getAnimatables(f){this._texture&&this._texture.animations&&this._texture.animations.length>0&&f.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&f.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&f.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&f.push(this._tintTexture)}dispose(f){var Q,H,X,i;f&&(null===(Q=this._texture)||void 0===Q||Q.dispose(),null===(H=this._textureRoughness)||void 0===H||H.dispose(),null===(X=this._bumpTexture)||void 0===X||X.dispose(),null===(i=this._tintTexture)||void 0===i||i.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(f,Q,H){return f.CLEARCOAT_BUMP&&Q.addFallback(H++,"CLEARCOAT_BUMP"),f.CLEARCOAT_TINT&&Q.addFallback(H++,"CLEARCOAT_TINT"),f.CLEARCOAT&&Q.addFallback(H++,"CLEARCOAT"),H}getSamplers(f){f.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}s._DefaultIndexOfRefraction=1.5,(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"isEnabled",void 0),(0,X.d)([(0,i.G)()],s.prototype,"intensity",void 0),(0,X.d)([(0,i.G)()],s.prototype,"roughness",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"indexOfRefraction",void 0),(0,X.d)([(0,i.A)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"texture",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useRoughnessFromMainTexture",void 0),(0,X.d)([(0,i.A)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"textureRoughness",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"remapF0OnInterfaceChange",void 0),(0,X.d)([(0,i.A)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"bumpTexture",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"isTintEnabled",void 0),(0,X.d)([(0,i.k)()],s.prototype,"tintColor",void 0),(0,X.d)([(0,i.G)()],s.prototype,"tintColorAtDistance",void 0),(0,X.d)([(0,i.G)()],s.prototype,"tintThickness",void 0),(0,X.d)([(0,i.A)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"tintTexture",void 0);class F extends J.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class P extends g.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(f,"PBRIridescence",110,new F,Q),this._isEnabled=!1,this.isEnabled=!1,this.rj=1,this.minimumThickness=P._DefaultMinimumThickness,this.maximumThickness=P._DefaultMaximumThickness,this.indexOfRefraction=P._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=f._dirtyCallbacks[1]}isReadyForSubMesh(f,Q){if(!this._isEnabled)return!0;if(f._areTexturesDirty&&Q.texturesEnabled){if(this._texture&&l.e.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&l.e.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(f,Q){this._isEnabled?(f.IRIDESCENCE=!0,f._areTexturesDirty&&Q.texturesEnabled&&(this._texture&&l.e.IridescenceTextureEnabled?(0,D.W)(this._texture,f,"IRIDESCENCE_TEXTURE"):f.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&l.e.IridescenceTextureEnabled?(0,D.W)(this._thicknessTexture,f,"IRIDESCENCE_THICKNESS_TEXTURE"):f.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(f.IRIDESCENCE=!1,f.IRIDESCENCE_TEXTURE=!1,f.IRIDESCENCE_THICKNESS_TEXTURE=!1,f.IRIDESCENCE_TEXTUREDIRECTUV=0,f.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(f,Q){if(!this._isEnabled)return;const H=this._material.isFrozen;if(!f.useUbo||!H||!f.isSync){var X,i,S,x;if((this._texture||this._thicknessTexture)&&l.e.IridescenceTextureEnabled)f.updateFloat4("vIridescenceInfos",(null===(X=this._texture)||void 0===X?void 0:X.coordinatesIndex)??0,(null===(i=this._texture)||void 0===i?void 0:i.level)??0,(null===(S=this._thicknessTexture)||void 0===S?void 0:S.coordinatesIndex)??0,(null===(x=this._thicknessTexture)||void 0===x?void 0:x.level)??0),this._texture&&(0,D.u)(this._texture,f,"iridescence"),this._thicknessTexture&&(0,D.u)(this._thicknessTexture,f,"iridescenceThickness");f.updateFloat4("vIridescenceParams",this.rj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}Q.texturesEnabled&&(this._texture&&l.e.IridescenceTextureEnabled&&f.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&l.e.IridescenceTextureEnabled&&f.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(f){return this._texture===f||this._thicknessTexture===f}getActiveTextures(f){this._texture&&f.push(this._texture),this._thicknessTexture&&f.push(this._thicknessTexture)}getAnimatables(f){this._texture&&this._texture.animations&&this._texture.animations.length>0&&f.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&f.push(this._thicknessTexture)}dispose(f){var Q,H;f&&(null===(Q=this._texture)||void 0===Q||Q.dispose(),null===(H=this._thicknessTexture)||void 0===H||H.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(f,Q,H){return f.IRIDESCENCE&&Q.addFallback(H++,"IRIDESCENCE"),H}getSamplers(f){f.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}P._DefaultMinimumThickness=100,P._DefaultMaximumThickness=400,P._DefaultIndexOfRefraction=1.3,(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isEnabled",void 0),(0,X.d)([(0,i.G)()],P.prototype,"intensity",void 0),(0,X.d)([(0,i.G)()],P.prototype,"minimumThickness",void 0),(0,X.d)([(0,i.G)()],P.prototype,"maximumThickness",void 0),(0,X.d)([(0,i.G)()],P.prototype,"indexOfRefraction",void 0),(0,X.d)([(0,i.A)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"texture",void 0),(0,X.d)([(0,i.A)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"thicknessTexture",void 0);class m extends J.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class c extends g.c{set angle(f){this.direction.x=Math.cos(f),this.direction.y=Math.sin(f)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(f,"PBRAnisotropic",110,new m,Q),this._isEnabled=!1,this.isEnabled=!1,this.rj=1,this.direction=new B.m(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=f._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=f._dirtyCallbacks[16]}isReadyForSubMesh(f,Q){return!this._isEnabled||!(f._areTexturesDirty&&Q.texturesEnabled&&this._texture&&l.e.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(f,Q,H){this._isEnabled?(f.ANISOTROPIC=this._isEnabled,this._isEnabled&&!H.isVerticesDataPresent(N.e.TangentKind)&&(f._needUVs=!0,f.MAINUV1=!0),f._areTexturesDirty&&Q.texturesEnabled&&(this._texture&&l.e.AnisotropicTextureEnabled?(0,D.W)(this._texture,f,"ANISOTROPIC_TEXTURE"):f.ANISOTROPIC_TEXTURE=!1),f._areMiscDirty&&(f.ANISOTROPIC_LEGACY=this._legacy)):(f.ANISOTROPIC=!1,f.ANISOTROPIC_TEXTURE=!1,f.ANISOTROPIC_TEXTUREDIRECTUV=0,f.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(f,Q){if(!this._isEnabled)return;const H=this._material.isFrozen;f.useUbo&&H&&f.isSync||(this._texture&&l.e.AnisotropicTextureEnabled&&(f.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,D.u)(this._texture,f,"anisotropy")),f.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.rj)),Q.texturesEnabled&&this._texture&&l.e.AnisotropicTextureEnabled&&f.setTexture("anisotropySampler",this._texture)}hasTexture(f){return this._texture===f}getActiveTextures(f){this._texture&&f.push(this._texture)}getAnimatables(f){this._texture&&this._texture.animations&&this._texture.animations.length>0&&f.push(this._texture)}dispose(f){f&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(f,Q,H){return f.ANISOTROPIC&&Q.addFallback(H++,"ANISOTROPIC"),H}getSamplers(f){f.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(f,Q,H){super.parse(f,Q,H),void 0===f.legacy&&(this.legacy=!0)}}(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"isEnabled",void 0),(0,X.d)([(0,i.G)()],c.prototype,"intensity",void 0),(0,X.d)([(0,i.C)()],c.prototype,"direction",void 0),(0,X.d)([(0,i.A)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"texture",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsMiscDirty")],c.prototype,"legacy",void 0);class W extends J.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class R extends g.c{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(f,"Sheen",120,new W,Q),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.rj=1,this.color=O.e.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=f._dirtyCallbacks[1]}isReadyForSubMesh(f,Q){if(!this._isEnabled)return!0;if(f._areTexturesDirty&&Q.texturesEnabled){if(this._texture&&l.e.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&l.e.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(f,Q){this._isEnabled?(f.SHEEN=!0,f.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,f.SHEEN_ROUGHNESS=null!==this._roughness,f.SHEEN_ALBEDOSCALING=this._albedoScaling,f.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,f._areTexturesDirty&&Q.texturesEnabled&&(this._texture&&l.e.SheenTextureEnabled?((0,D.W)(this._texture,f,"SHEEN_TEXTURE"),f.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):f.SHEEN_TEXTURE=!1,this._textureRoughness&&l.e.SheenTextureEnabled?(0,D.W)(this._textureRoughness,f,"SHEEN_TEXTURE_ROUGHNESS"):f.SHEEN_TEXTURE_ROUGHNESS=!1)):(f.SHEEN=!1,f.SHEEN_TEXTURE=!1,f.SHEEN_TEXTURE_ROUGHNESS=!1,f.SHEEN_LINKWITHALBEDO=!1,f.SHEEN_ROUGHNESS=!1,f.SHEEN_ALBEDOSCALING=!1,f.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,f.SHEEN_GAMMATEXTURE=!1,f.SHEEN_TEXTUREDIRECTUV=0,f.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(f,Q,H,X){if(!this._isEnabled)return;const i=X.materialDefines,S=this._material.isFrozen;if(!f.useUbo||!S||!f.isSync){var x,K,Z,B;if((this._texture||this._textureRoughness)&&l.e.SheenTextureEnabled)f.updateFloat4("vSheenInfos",(null===(x=this._texture)||void 0===x?void 0:x.coordinatesIndex)??0,(null===(K=this._texture)||void 0===K?void 0:K.level)??0,(null===(Z=this._textureRoughness)||void 0===Z?void 0:Z.coordinatesIndex)??0,(null===(B=this._textureRoughness)||void 0===B?void 0:B.level)??0),this._texture&&(0,D.u)(this._texture,f,"sheen"),this._textureRoughness&&!i.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,D.u)(this._textureRoughness,f,"sheenRoughness");f.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.rj),null!==this._roughness&&f.updateFloat("vSheenRoughness",this._roughness)}Q.texturesEnabled&&(this._texture&&l.e.SheenTextureEnabled&&f.setTexture("sheenSampler",this._texture),this._textureRoughness&&!i.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&l.e.SheenTextureEnabled&&f.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(f){return this._texture===f||this._textureRoughness===f}getActiveTextures(f){this._texture&&f.push(this._texture),this._textureRoughness&&f.push(this._textureRoughness)}getAnimatables(f){this._texture&&this._texture.animations&&this._texture.animations.length>0&&f.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&f.push(this._textureRoughness)}dispose(f){var Q,H;f&&(null===(Q=this._texture)||void 0===Q||Q.dispose(),null===(H=this._textureRoughness)||void 0===H||H.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(f,Q,H){return f.SHEEN&&Q.addFallback(H++,"SHEEN"),H}getSamplers(f){f.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"isEnabled",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"linkSheenWithAlbedo",void 0),(0,X.d)([(0,i.G)()],R.prototype,"intensity",void 0),(0,X.d)([(0,i.k)()],R.prototype,"color",void 0),(0,X.d)([(0,i.A)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"texture",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"useRoughnessFromMainTexture",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"roughness",void 0),(0,X.d)([(0,i.A)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"textureRoughness",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"albedoScaling",void 0);class U extends J.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class E extends g.c{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(f){this._scene.enableSubSurfaceForPrePass()&&f&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(f))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(f){this._volumeIndexOfRefraction=f>=1?f:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(f,"PBRSubSurface",130,new U,Q),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=O.e.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=O.e.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=f.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=f._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=f._dirtyCallbacks[32]}isReadyForSubMesh(f,Q){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(f._areTexturesDirty&&Q.texturesEnabled){if(this._thicknessTexture&&l.e.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&l.e.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&l.e.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const f=this._getRefractionTexture(Q);if(f&&l.e.RefractionTextureEnabled&&!f.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(f,Q){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return f.SUBSURFACE=!1,f.SS_DISPERSION=!1,f.SS_TRANSLUCENCY=!1,f.SS_SCATTERING=!1,f.SS_REFRACTION=!1,f.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,f.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,f.SS_THICKNESSANDMASK_TEXTURE=!1,f.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,f.SS_HAS_THICKNESS=!1,f.SS_REFRACTIONINTENSITY_TEXTURE=!1,f.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,f.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,f.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,f.SS_REFRACTIONMAP_3D=!1,f.SS_REFRACTIONMAP_OPPOSITEZ=!1,f.SS_LODINREFRACTIONALPHA=!1,f.SS_GAMMAREFRACTION=!1,f.SS_RGBDREFRACTION=!1,f.SS_LINEARSPECULARREFRACTION=!1,f.SS_LINKREFRACTIONTOTRANSPARENCY=!1,f.SS_ALBEDOFORREFRACTIONTINT=!1,f.SS_ALBEDOFORTRANSLUCENCYTINT=!1,f.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,f.SS_USE_THICKNESS_AS_DEPTH=!1,f.SS_USE_GLTF_TEXTURES=!1,f.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(f.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(f._areTexturesDirty){if(f.SUBSURFACE=!0,f.SS_DISPERSION=this._isDispersionEnabled,f.SS_TRANSLUCENCY=this._isTranslucencyEnabled,f.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,f.SS_SCATTERING=this._isScatteringEnabled,f.SS_THICKNESSANDMASK_TEXTURE=!1,f.SS_REFRACTIONINTENSITY_TEXTURE=!1,f.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,f.SS_HAS_THICKNESS=!1,f.SS_USE_GLTF_TEXTURES=!1,f.SS_REFRACTION=!1,f.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,f.SS_REFRACTIONMAP_3D=!1,f.SS_GAMMAREFRACTION=!1,f.SS_RGBDREFRACTION=!1,f.SS_LINEARSPECULARREFRACTION=!1,f.SS_REFRACTIONMAP_OPPOSITEZ=!1,f.SS_LODINREFRACTIONALPHA=!1,f.SS_LINKREFRACTIONTOTRANSPARENCY=!1,f.SS_ALBEDOFORREFRACTIONTINT=!1,f.SS_ALBEDOFORTRANSLUCENCYTINT=!1,f.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,f.SS_USE_THICKNESS_AS_DEPTH=!1,f.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,f._areTexturesDirty&&Q.texturesEnabled&&(this._thicknessTexture&&l.e.ThicknessTextureEnabled&&(0,D.W)(this._thicknessTexture,f,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&l.e.RefractionIntensityTextureEnabled&&(0,D.W)(this._refractionIntensityTexture,f,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&l.e.TranslucencyIntensityTextureEnabled&&(0,D.W)(this._translucencyIntensityTexture,f,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&l.e.TranslucencyColorTextureEnabled&&(0,D.W)(this._translucencyColorTexture,f,"SS_TRANSLUCENCYCOLOR_TEXTURE")),f.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,f.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,f.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,f.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&Q.texturesEnabled){const H=this._getRefractionTexture(Q);H&&l.e.RefractionTextureEnabled&&(f.SS_REFRACTION=!0,f.SS_REFRACTIONMAP_3D=H.isCube,f.SS_GAMMAREFRACTION=H.gammaSpace,f.SS_RGBDREFRACTION=H.isRGBD,f.SS_LINEARSPECULARREFRACTION=H.linearSpecularLOD,f.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&H.isCube?!H.invertZ:H.invertZ,f.SS_LODINREFRACTIONALPHA=H.lodLevelInAlpha,f.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,f.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,f.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=H.isCube&&H.boundingBoxSize,f.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(f.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(f,Q,H,X){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)f.updateFloat2("vThicknessParam",0,0);else{X.getRenderingMesh().getWorldMatrix().decompose(B.l.Wd[0]);const Q=Math.max(Math.abs(B.l.Wd[0].x),Math.abs(B.l.Wd[0].y),Math.abs(B.l.Wd[0].z));f.updateFloat2("vThicknessParam",this.minimumThickness*Q,(this.maximumThickness-this.minimumThickness)*Q)}}bindForSubMesh(f,Q,H,X){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const i=X.materialDefines,S=this._material.isFrozen,x=this._material.realTimeFiltering,K=i.LODBASEDMICROSFURACE,Z=this._getRefractionTexture(Q);if(!f.useUbo||!S||!f.isSync){if(this._thicknessTexture&&l.e.ThicknessTextureEnabled&&(f.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,D.u)(this._thicknessTexture,f,"thickness")),this._refractionIntensityTexture&&l.e.RefractionIntensityTextureEnabled&&i.SS_REFRACTIONINTENSITY_TEXTURE&&(f.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,D.u)(this._refractionIntensityTexture,f,"refractionIntensity")),this._translucencyColorTexture&&l.e.TranslucencyColorTextureEnabled&&i.SS_TRANSLUCENCYCOLOR_TEXTURE&&(f.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,D.u)(this._translucencyColorTexture,f,"translucencyColor")),this._translucencyIntensityTexture&&l.e.TranslucencyIntensityTextureEnabled&&i.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(f.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,D.u)(this._translucencyIntensityTexture,f,"translucencyIntensity")),Z&&l.e.RefractionTextureEnabled){f.Be("refractionMatrix",Z.getRefractionTextureMatrix());let Q=1;Z.isCube||Z.depth&&(Q=Z.depth);const H=Z.getSize().width,X=this.volumeIndexOfRefraction;if(f.updateFloat4("vRefractionInfos",Z.level,1/X,Q,this._invertRefractionY?-1:1),f.updateFloat4("vRefractionMicrosurfaceInfos",H,Z.lodGenerationScale,Z.lodGenerationOffset,1/this.indexOfRefraction),x&&f.updateFloat2("vRefractionFilteringInfo",H,Math.log2(H)),Z.boundingBoxSize){const Q=Z;f.updateVector3("vRefractionPosition",Q.boundingBoxPosition),f.updateVector3("vRefractionSize",Q.boundingBoxSize)}}this._isScatteringEnabled&&f.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),f.updateColor3("vDiffusionDistance",this.diffusionDistance),f.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),f.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),f.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),f.updateFloat("dispersion",this.dispersion)}Q.texturesEnabled&&(this._thicknessTexture&&l.e.ThicknessTextureEnabled&&f.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&l.e.RefractionIntensityTextureEnabled&&i.SS_REFRACTIONINTENSITY_TEXTURE&&f.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&l.e.TranslucencyIntensityTextureEnabled&&i.SS_TRANSLUCENCYINTENSITY_TEXTURE&&f.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&l.e.TranslucencyColorTextureEnabled&&i.SS_TRANSLUCENCYCOLOR_TEXTURE&&f.setTexture("translucencyColorSampler",this._translucencyColorTexture),Z&&l.e.RefractionTextureEnabled&&(K?f.setTexture("refractionSampler",Z):(f.setTexture("refractionSampler",Z._lodTextureMid||Z),f.setTexture("refractionSamplerLow",Z._lodTextureLow||Z),f.setTexture("refractionSamplerHigh",Z._lodTextureHigh||Z))))}_getRefractionTexture(f){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?f.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(f){l.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&f.push(this._refractionTexture)}hasTexture(f){return this._thicknessTexture===f||(this._refractionTexture===f||(this._refractionIntensityTexture===f||(this._translucencyIntensityTexture===f||this._translucencyColorTexture===f)))}hasRenderTargetTextures(){return!!(l.e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(f){this._thicknessTexture&&f.push(this._thicknessTexture),this._refractionTexture&&f.push(this._refractionTexture),this._translucencyColorTexture&&f.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&f.push(this._translucencyIntensityTexture)}getAnimatables(f){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&f.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&f.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&f.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&f.push(this._translucencyIntensityTexture)}dispose(f){f&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(f,Q,H){return f.SS_SCATTERING&&Q.addFallback(H++,"SS_SCATTERING"),f.SS_TRANSLUCENCY&&Q.addFallback(H++,"SS_TRANSLUCENCY"),H}getSamplers(f){f.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"isRefractionEnabled",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"isTranslucencyEnabled",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"isDispersionEnabled",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markScenePrePassDirty")],E.prototype,"isScatteringEnabled",void 0),(0,X.d)([(0,i.G)()],E.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,X.d)([(0,i.G)()],E.prototype,"refractionIntensity",void 0),(0,X.d)([(0,i.G)()],E.prototype,"translucencyIntensity",void 0),(0,X.d)([(0,i.G)()],E.prototype,"useAlbedoToTintRefraction",void 0),(0,X.d)([(0,i.G)()],E.prototype,"useAlbedoToTintTranslucency",void 0),(0,X.d)([(0,i.A)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"thicknessTexture",void 0),(0,X.d)([(0,i.A)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"refractionTexture",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"indexOfRefraction",void 0),(0,X.d)([(0,i.G)()],E.prototype,"_volumeIndexOfRefraction",void 0),(0,X.d)([(0,i.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"volumeIndexOfRefraction",null),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"invertRefractionY",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"linkRefractionWithTransparency",void 0),(0,X.d)([(0,i.G)()],E.prototype,"minimumThickness",void 0),(0,X.d)([(0,i.G)()],E.prototype,"maximumThickness",void 0),(0,X.d)([(0,i.G)()],E.prototype,"useThicknessAsDepth",void 0),(0,X.d)([(0,i.k)()],E.prototype,"tintColor",void 0),(0,X.d)([(0,i.G)()],E.prototype,"tintColorAtDistance",void 0),(0,X.d)([(0,i.G)()],E.prototype,"dispersion",void 0),(0,X.d)([(0,i.k)()],E.prototype,"diffusionDistance",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useMaskFromThicknessTexture",void 0),(0,X.d)([(0,i.A)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"refractionIntensityTexture",void 0),(0,X.d)([(0,i.A)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"translucencyIntensityTexture",void 0),(0,X.d)([(0,i.k)()],E.prototype,"translucencyColor",void 0),(0,X.d)([(0,i.A)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"translucencyColorTexture",void 0),(0,X.d)([(0,i.G)(),(0,i.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useGltfStyleTextures",void 0);var t=H(1418),u=H(1395),L=H(1429);const A={effect:null,subMesh:null};class a extends J.d{constructor(f){super(f),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class V extends G.c{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(f){this._realTimeFiltering=f,this.ve(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(f){this._realTimeFilteringQuality=f,this.ve(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(f){f!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=f||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(f,Q){super(f,Q,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||V.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new B.s(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=V.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=O.e.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new O.e(0,0,0),this._albedoColor=new O.e(1,1,1),this._reflectivityColor=new O.e(1,1,1),this._reflectionColor=new O.e(1,1,1),this._emissiveColor=new O.e(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=V.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new x.g(16),this._globalAmbientColor=new O.e(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new v(this),this.clearCoat=new s(this),this.iridescence=new P(this),this.anisotropy=new c(this),this.sheen=new R(this),this.subSurface=new E(this),this.detailMap=new t.c(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),l.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,K.e)(this.va()),this.prePassConfiguration=new Y.c}get hasRenderTargetTextures(){return!!(l.e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var f;return this._transparencyMode===V.PBRMATERIAL_OPAQUE||this._transparencyMode===V.PBRMATERIAL_ALPHATEST||(null===(f=this.subSurface)||void 0===f?void 0:f.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var f;return!!this._forceAlphaTest||(null===(f=this.subSurface)||void 0===f||!f.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===V.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.qc&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==V.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.qc||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(f,Q,H){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const X=Q._drawWrapper;if(X.effect&&this.isFrozen&&X._wasPreviouslyReady&&X._wasPreviouslyUsingInstances===H)return!0;Q.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),Q.materialDefines=new a(this._eventInfo.defineNames));const i=Q.materialDefines;if(this._isReadyForSubMesh(Q))return!0;const x=this.va(),K=x.getEngine();if(i._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,x.texturesEnabled)){if(this._albedoTexture&&l.e.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&l.e.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&l.e.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const f=this._getReflectionTexture();if(f&&l.e.ReflectionTextureEnabled){if(!f.isReadyOrNotBlocking())return!1;var Z;if(f.irradianceTexture){if(!f.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!f.sphericalPolynomial&&null!==(Z=f.getInternalTexture())&&void 0!==Z&&Z._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&l.e.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&l.e.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(l.e.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(K.getCaps().standardDerivatives&&this._bumpTexture&&l.e.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&l.e.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=i,this._eventInfo.subMesh=Q,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(i._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;K.getCaps().standardDerivatives||f.isVerticesDataPresent(N.e.NormalKind)||(f.createNormals(!0),S.b.Warn("PBRMaterial: Normals have been created for the mesh: "+f.name));const B=Q.effect,J=i._areLightsDisposed;let g=this._prepareEffect(f,i,this.onCompiled,this.onError,H,null,Q.getRenderingMesh().hasThinInstances),z=!1;if(g)if(this._onEffectCreatedObservable&&(A.effect=g,A.subMesh=Q,this._onEffectCreatedObservable.notifyObservers(A)),this.allowShaderHotSwapping&&B&&!g.isReady()){if(g=B,i.markAsUnprocessed(),z=this.isFrozen,J)return i._areLightsDisposed=!0,!1}else x.resetCachedMaterial(),Q.setEffect(g,i,this._materialContext);return!(!Q.effect||!Q.effect.isReady())&&(i._renderId=x.getRenderId(),X._wasPreviouslyReady=!z,X._wasPreviouslyUsingInstances=!!H,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(f,Q){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,x=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(f,Q,S,x,K),!Q.isDirty)return null;Q.markAsProcessed();const Z=this.va().getEngine(),B=new q.c;let J=0;Q.USESPHERICALINVERTEX&&B.addFallback(J++,"USESPHERICALINVERTEX"),Q.FOG&&B.addFallback(J,"FOG"),Q.SPECULARAA&&B.addFallback(J,"SPECULARAA"),Q.POINTSIZE&&B.addFallback(J,"POINTSIZE"),Q.LOGARITHMICDEPTH&&B.addFallback(J,"LOGARITHMICDEPTH"),Q.PARALLAX&&B.addFallback(J,"PARALLAX"),Q.PARALLAX_RHS&&B.addFallback(J,"PARALLAX_RHS"),Q.PARALLAXOCCLUSION&&B.addFallback(J++,"PARALLAXOCCLUSION"),Q.ENVIRONMENTBRDF&&B.addFallback(J++,"ENVIRONMENTBRDF"),Q.TANGENT&&B.addFallback(J++,"TANGENT"),Q.BUMP&&B.addFallback(J++,"BUMP"),J=(0,D.w)(Q,B,this._maxSimultaneousLights,J++),Q.SPECULARTERM&&B.addFallback(J++,"SPECULARTERM"),Q.USESPHERICALFROMREFLECTIONMAP&&B.addFallback(J++,"USESPHERICALFROMREFLECTIONMAP"),Q.USEIRRADIANCEMAP&&B.addFallback(J++,"USEIRRADIANCEMAP"),Q.LIGHTMAP&&B.addFallback(J++,"LIGHTMAP"),Q.NORMAL&&B.addFallback(J++,"NORMAL"),Q.AMBIENT&&B.addFallback(J++,"AMBIENT"),Q.EMISSIVE&&B.addFallback(J++,"EMISSIVE"),Q.VERTEXCOLOR&&B.addFallback(J++,"VERTEXCOLOR"),Q.MORPHTARGETS&&B.addFallback(J++,"MORPHTARGETS"),Q.MULTIVIEW&&B.addFallback(0,"MULTIVIEW");const g=[N.e.PositionKind];Q.NORMAL&&g.push(N.e.NormalKind),Q.TANGENT&&g.push(N.e.TangentKind);for(let H=1;H<=6;++H)Q["UV"+H]&&g.push(`uv${1===H?"":H}`);Q.VERTEXCOLOR&&g.push(N.e.ColorKind),(0,D.D)(g,f,Q,B),(0,D.H)(g,Q),(0,D.L)(g,f,Q),(0,D.A)(g,f,Q);let z="pbr";const v=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],O=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],e=["Material","Scene","Mesh"],G={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:Q.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=B,this._eventInfo.fallbackRank=J,this._eventInfo.defines=Q,this._eventInfo.uniforms=v,this._eventInfo.attributes=g,this._eventInfo.samplers=O,this._eventInfo.uniformBuffersNames=e,this._eventInfo.customCode=void 0,this._eventInfo.mesh=f,this._eventInfo.indexParameters=G,this._callbackPluginEventGeneric(128,this._eventInfo),L.e.AddUniformsAndSamplers(v,O),Y.c.AddUniforms(v),Y.c.AddSamplers(O),(0,u.b)(v),n.e&&(n.e.PrepareUniforms(v,Q),n.e.PrepareSamplers(O,Q)),(0,D.hb)({uniformsNames:v,uniformBuffersNames:e,samplers:O,defines:Q,maxSimultaneousLights:this._maxSimultaneousLights});const I={};this.customShaderNameResolve&&(z=this.customShaderNameResolve(z,v,e,O,Q,g,I));const l=Q.toString(),d=Z.createEffect(z,{attributes:g,uniformsNames:v,uniformBuffersNames:e,samplers:O,defines:l,fallbacks:B,onCompiled:X,onError:i,indexParameters:G,processFinalCode:I.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:Q.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([H.e(15),H.e(44)]).then(H.bind(H,12552)),Promise.all([H.e(16),H.e(45)]).then(H.bind(H,12573))]):await Promise.all([Promise.all([H.e(21),H.e(46)]).then(H.bind(H,12575)),Promise.all([H.e(23),H.e(47)]).then(H.bind(H,12589))]),this._shadersLoaded=!0}},Z);return this._eventInfo.customCode=void 0,d}_prepareDefines(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const S=this.va(),x=S.getEngine();(0,D.U)(S,f,Q,!0,this._maxSimultaneousLights,this._disableLighting),Q._needNormals=!0,(0,D._)(S,Q);const K=this.needAlphaBlendingForMesh(f)&&this.va().useOrderIndependentTransparency;if((0,D.db)(S,Q,this.canRenderToMRT&&!K),(0,D.$)(S,Q,K),L.e.PrepareDefines(x.currentRenderPassId,f,Q),Q.METALLICWORKFLOW=this.isMetallicWorkflow(),Q._areTexturesDirty){Q._needUVs=!1;for(let f=1;f<=6;++f)Q["MAINUV"+f]=!1;if(S.texturesEnabled){Q.ALBEDODIRECTUV=0,Q.AMBIENTDIRECTUV=0,Q.OPACITYDIRECTUV=0,Q.EMISSIVEDIRECTUV=0,Q.REFLECTIVITYDIRECTUV=0,Q.MICROSURFACEMAPDIRECTUV=0,Q.METALLIC_REFLECTANCEDIRECTUV=0,Q.REFLECTANCEDIRECTUV=0,Q.BUMPDIRECTUV=0,Q.LIGHTMAPDIRECTUV=0,x.getCaps().textureLOD&&(Q.LODBASEDMICROSFURACE=!0),this._albedoTexture&&l.e.DiffuseTextureEnabled?((0,D.W)(this._albedoTexture,Q,"ALBEDO"),Q.GAMMAALBEDO=this._albedoTexture.gammaSpace):Q.ALBEDO=!1,this._ambientTexture&&l.e.AmbientTextureEnabled?((0,D.W)(this._ambientTexture,Q,"AMBIENT"),Q.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):Q.AMBIENT=!1,this._opacityTexture&&l.e.OpacityTextureEnabled?((0,D.W)(this._opacityTexture,Q,"OPACITY"),Q.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):Q.OPACITY=!1;const f=this._getReflectionTexture();if(f&&l.e.ReflectionTextureEnabled){switch(Q.REFLECTION=!0,Q.GAMMAREFLECTION=f.gammaSpace,Q.RGBDREFLECTION=f.isRGBD,Q.LODINREFLECTIONALPHA=f.lodLevelInAlpha,Q.LINEARSPECULARREFLECTION=f.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(Q.NUM_SAMPLES=""+this.realTimeFilteringQuality,x._features.needTypeSuffixInShaderConstants&&(Q.NUM_SAMPLES=Q.NUM_SAMPLES+"u"),Q.REALTIME_FILTERING=!0):Q.REALTIME_FILTERING=!1,Q.INVERTCUBICMAP=f.coordinatesMode===I.b.INVCUBIC_MODE,Q.REFLECTIONMAP_3D=f.isCube,Q.REFLECTIONMAP_OPPOSITEZ=Q.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!f.invertZ:f.invertZ,Q.REFLECTIONMAP_CUBIC=!1,Q.REFLECTIONMAP_EXPLICIT=!1,Q.REFLECTIONMAP_PLANAR=!1,Q.REFLECTIONMAP_PROJECTION=!1,Q.REFLECTIONMAP_SKYBOX=!1,Q.REFLECTIONMAP_SPHERICAL=!1,Q.REFLECTIONMAP_EQUIRECTANGULAR=!1,Q.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,Q.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,f.coordinatesMode){case I.b.EXPLICIT_MODE:Q.REFLECTIONMAP_EXPLICIT=!0;break;case I.b.PLANAR_MODE:Q.REFLECTIONMAP_PLANAR=!0;break;case I.b.PROJECTION_MODE:Q.REFLECTIONMAP_PROJECTION=!0;break;case I.b.SKYBOX_MODE:Q.REFLECTIONMAP_SKYBOX=!0;break;case I.b.SPHERICAL_MODE:Q.REFLECTIONMAP_SPHERICAL=!0;break;case I.b.EQUIRECTANGULAR_MODE:Q.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case I.b.FIXED_EQUIRECTANGULAR_MODE:Q.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case I.b.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:Q.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case I.b.CUBIC_MODE:case I.b.INVCUBIC_MODE:default:Q.REFLECTIONMAP_CUBIC=!0,Q.USE_LOCAL_REFLECTIONMAP_CUBIC=!!f.boundingBoxSize}f.coordinatesMode!==I.b.SKYBOX_MODE&&(f.irradianceTexture?(Q.USEIRRADIANCEMAP=!0,Q.USESPHERICALFROMREFLECTIONMAP=!1):f.isCube&&(Q.USESPHERICALFROMREFLECTIONMAP=!0,Q.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||x.getCaps().maxVaryingVectors<=8?Q.USESPHERICALINVERTEX=!1:Q.USESPHERICALINVERTEX=!0))}else Q.REFLECTION=!1,Q.REFLECTIONMAP_3D=!1,Q.REFLECTIONMAP_SPHERICAL=!1,Q.REFLECTIONMAP_PLANAR=!1,Q.REFLECTIONMAP_CUBIC=!1,Q.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,Q.REFLECTIONMAP_PROJECTION=!1,Q.REFLECTIONMAP_SKYBOX=!1,Q.REFLECTIONMAP_EXPLICIT=!1,Q.REFLECTIONMAP_EQUIRECTANGULAR=!1,Q.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,Q.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,Q.INVERTCUBICMAP=!1,Q.USESPHERICALFROMREFLECTIONMAP=!1,Q.USEIRRADIANCEMAP=!1,Q.USESPHERICALINVERTEX=!1,Q.REFLECTIONMAP_OPPOSITEZ=!1,Q.LODINREFLECTIONALPHA=!1,Q.GAMMAREFLECTION=!1,Q.RGBDREFLECTION=!1,Q.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&l.e.LightmapTextureEnabled?((0,D.W)(this._lightmapTexture,Q,"LIGHTMAP"),Q.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,Q.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,Q.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):Q.LIGHTMAP=!1,this._emissiveTexture&&l.e.EmissiveTextureEnabled?((0,D.W)(this._emissiveTexture,Q,"EMISSIVE"),Q.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):Q.EMISSIVE=!1,l.e.SpecularTextureEnabled?(this._metallicTexture?((0,D.W)(this._metallicTexture,Q,"REFLECTIVITY"),Q.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,Q.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,Q.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,Q.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,Q.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,D.W)(this._reflectivityTexture,Q,"REFLECTIVITY"),Q.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,Q.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,Q.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):Q.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(Q.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,D.W)(this._metallicReflectanceTexture,Q,"METALLIC_REFLECTANCE"),Q.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):Q.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,D.W)(this._reflectanceTexture,Q,"REFLECTANCE"),Q.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):Q.REFLECTANCE=!1):(Q.METALLIC_REFLECTANCE=!1,Q.REFLECTANCE=!1),this._microSurfaceTexture?(0,D.W)(this._microSurfaceTexture,Q,"MICROSURFACEMAP"):Q.MICROSURFACEMAP=!1):(Q.REFLECTIVITY=!1,Q.MICROSURFACEMAP=!1),x.getCaps().standardDerivatives&&this._bumpTexture&&l.e.BumpTextureEnabled&&!this._disableBumpMap?((0,D.W)(this._bumpTexture,Q,"BUMP"),this._useParallax&&this._albedoTexture&&l.e.DiffuseTextureEnabled?(Q.PARALLAX=!0,Q.PARALLAX_RHS=S.useRightHandedSystem,Q.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):Q.PARALLAX=!1,Q.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(Q.BUMP=!1,Q.PARALLAX=!1,Q.PARALLAX_RHS=!1,Q.PARALLAXOCCLUSION=!1,Q.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&l.e.ReflectionTextureEnabled?(Q.ENVIRONMENTBRDF=!0,Q.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(Q.ENVIRONMENTBRDF=!1,Q.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?Q.ALPHAFROMALBEDO=!0:Q.ALPHAFROMALBEDO=!1}Q.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===V.LIGHTFALLOFF_STANDARD?(Q.USEPHYSICALLIGHTFALLOFF=!1,Q.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===V.LIGHTFALLOFF_GLTF?(Q.USEPHYSICALLIGHTFALLOFF=!1,Q.USEGLTFLIGHTFALLOFF=!0):(Q.USEPHYSICALLIGHTFALLOFF=!0,Q.USEGLTFLIGHTFALLOFF=!1),Q.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.we&&this._twoSidedLighting?Q.TWOSIDEDLIGHTING=!0:Q.TWOSIDEDLIGHTING=!1,Q.SPECULARAA=x.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(Q._areTexturesDirty||Q._areMiscDirty)&&(Q.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,Q.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,Q.ALPHABLEND=this.needAlphaBlendingForMesh(f),Q.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,Q.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),Q._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(Q),Q.FORCENORMALFORWARD=this._forceNormalForward,Q.RADIANCEOCCLUSION=this._useRadianceOcclusion,Q.HORIZONOCCLUSION=this._useHorizonOcclusion,Q._areMiscDirty&&((0,D.Y)(f,S,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(f)||this._forceAlphaTest,Q,this._applyDecalMapAfterDetailMap),Q.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!f.isVerticesDataPresent(N.e.NormalKind),Q.DEBUGMODE=this._debugMode),(0,D.R)(S,x,this,Q,!!H,X,i),this._eventInfo.defines=Q,this._eventInfo.mesh=f,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,D.O)(f,Q,!0,!0,!0,this._transparencyMode!==V.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(f,Q,H){const X={clipPlane:!1,useInstances:!1,...H};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const H=new a(this._eventInfo.defineNames),i=this._prepareEffect(f,H,void 0,void 0,X.useInstances,X.clipPlane,f.hasThinInstances);this._onEffectCreatedObservable&&(A.effect=i,A.subMesh=null,this._onEffectCreatedObservable.notifyObservers(A)),i.isReady()?Q&&Q(this):i.onCompileObservable.add((()=>{Q&&Q(this)}))})()}buildUniformLayout(){const f=this._uniformBuffer;f.addUniform("vAlbedoInfos",2),f.addUniform("vAmbientInfos",4),f.addUniform("vOpacityInfos",2),f.addUniform("vEmissiveInfos",2),f.addUniform("vLightmapInfos",2),f.addUniform("vReflectivityInfos",3),f.addUniform("vMicroSurfaceSamplerInfos",2),f.addUniform("vReflectionInfos",2),f.addUniform("vReflectionFilteringInfo",2),f.addUniform("vReflectionPosition",3),f.addUniform("vReflectionSize",3),f.addUniform("vBumpInfos",3),f.addUniform("albedoMatrix",16),f.addUniform("ambientMatrix",16),f.addUniform("opacityMatrix",16),f.addUniform("emissiveMatrix",16),f.addUniform("lightmapMatrix",16),f.addUniform("reflectivityMatrix",16),f.addUniform("microSurfaceSamplerMatrix",16),f.addUniform("bumpMatrix",16),f.addUniform("vTangentSpaceParams",2),f.addUniform("reflectionMatrix",16),f.addUniform("vReflectionColor",3),f.addUniform("vAlbedoColor",4),f.addUniform("vLightingIntensity",4),f.addUniform("vReflectionMicrosurfaceInfos",3),f.addUniform("pointSize",1),f.addUniform("vReflectivityColor",4),f.addUniform("vEmissiveColor",3),f.addUniform("vAmbientColor",3),f.addUniform("vDebugMode",2),f.addUniform("vMetallicReflectanceFactors",4),f.addUniform("vMetallicReflectanceInfos",2),f.addUniform("metallicReflectanceMatrix",16),f.addUniform("vReflectanceInfos",2),f.addUniform("reflectanceMatrix",16),f.addUniform("vSphericalL00",3),f.addUniform("vSphericalL1_1",3),f.addUniform("vSphericalL10",3),f.addUniform("vSphericalL11",3),f.addUniform("vSphericalL2_2",3),f.addUniform("vSphericalL2_1",3),f.addUniform("vSphericalL20",3),f.addUniform("vSphericalL21",3),f.addUniform("vSphericalL22",3),f.addUniform("vSphericalX",3),f.addUniform("vSphericalY",3),f.addUniform("vSphericalZ",3),f.addUniform("vSphericalXX_ZZ",3),f.addUniform("vSphericalYY_ZZ",3),f.addUniform("vSphericalZZ",3),f.addUniform("vSphericalXY",3),f.addUniform("vSphericalYZ",3),f.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(f,Q,H){const X=this.va(),i=H.materialDefines;if(!i)return;const S=H.effect;if(!S)return;this._activeEffect=S,Q.getMeshUniformBuffer().bindToEffect(S,"Mesh"),Q.transferToEffect(f);const x=X.getEngine();this._uniformBuffer.bindToEffect(S,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,X,Q,f,this.isFrozen),L.e.Bind(x.currentRenderPassId,this._activeEffect,Q,f),this._eventInfo.subMesh=H,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),i.OBJECTSPACE_NORMALMAP&&(f.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const K=this._mustRebind(X,S,H,Q.visibility);(0,D.e)(Q,this._activeEffect,this.prePassConfiguration);let B=null;const N=this._uniformBuffer;if(K){if(this.bindViewProjection(S),B=this._getReflectionTexture(),!N.useUbo||!this.isFrozen||!N.isSync||H._drawWrapper._forceRebindOnNextCall){var J;if(X.texturesEnabled){if(this._albedoTexture&&l.e.DiffuseTextureEnabled&&(N.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,D.u)(this._albedoTexture,N,"albedo")),this._ambientTexture&&l.e.AmbientTextureEnabled&&(N.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,D.u)(this._ambientTexture,N,"ambient")),this._opacityTexture&&l.e.OpacityTextureEnabled&&(N.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,D.u)(this._opacityTexture,N,"opacity")),B&&l.e.ReflectionTextureEnabled){if(N.Be("reflectionMatrix",B.getReflectionTextureMatrix()),N.updateFloat2("vReflectionInfos",B.level,0),B.boundingBoxSize){const f=B;N.updateVector3("vReflectionPosition",f.boundingBoxPosition),N.updateVector3("vReflectionSize",f.boundingBoxSize)}if(this.realTimeFiltering){const f=B.getSize().width;N.updateFloat2("vReflectionFilteringInfo",f,Math.log2(f))}if(!i.USEIRRADIANCEMAP){const f=B.sphericalPolynomial;if(i.USESPHERICALFROMREFLECTIONMAP&&f)if(i.SPHERICAL_HARMONICS){const Q=f.preScaledHarmonics;N.updateVector3("vSphericalL00",Q.l00),N.updateVector3("vSphericalL1_1",Q.l1_1),N.updateVector3("vSphericalL10",Q.l10),N.updateVector3("vSphericalL11",Q.l11),N.updateVector3("vSphericalL2_2",Q.l2_2),N.updateVector3("vSphericalL2_1",Q.l2_1),N.updateVector3("vSphericalL20",Q.l20),N.updateVector3("vSphericalL21",Q.l21),N.updateVector3("vSphericalL22",Q.l22)}else N.updateFloat3("vSphericalX",f.x.x,f.x.y,f.x.z),N.updateFloat3("vSphericalY",f.y.x,f.y.y,f.y.z),N.updateFloat3("vSphericalZ",f.z.x,f.z.y,f.z.z),N.updateFloat3("vSphericalXX_ZZ",f.xx.x-f.zz.x,f.xx.y-f.zz.y,f.xx.z-f.zz.z),N.updateFloat3("vSphericalYY_ZZ",f.yy.x-f.zz.x,f.yy.y-f.zz.y,f.yy.z-f.zz.z),N.updateFloat3("vSphericalZZ",f.zz.x,f.zz.y,f.zz.z),N.updateFloat3("vSphericalXY",f.xy.x,f.xy.y,f.xy.z),N.updateFloat3("vSphericalYZ",f.yz.x,f.yz.y,f.yz.z),N.updateFloat3("vSphericalZX",f.zx.x,f.zx.y,f.zx.z)}N.updateFloat3("vReflectionMicrosurfaceInfos",B.getSize().width,B.lodGenerationScale,B.lodGenerationOffset)}this._emissiveTexture&&l.e.EmissiveTextureEnabled&&(N.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,D.u)(this._emissiveTexture,N,"emissive")),this._lightmapTexture&&l.e.LightmapTextureEnabled&&(N.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,D.u)(this._lightmapTexture,N,"lightmap")),l.e.SpecularTextureEnabled&&(this._metallicTexture?(N.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,D.u)(this._metallicTexture,N,"reflectivity")):this._reflectivityTexture&&(N.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,D.u)(this._reflectivityTexture,N,"reflectivity")),this._metallicReflectanceTexture&&(N.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,D.u)(this._metallicReflectanceTexture,N,"metallicReflectance")),this._reflectanceTexture&&i.REFLECTANCE&&(N.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,D.u)(this._reflectanceTexture,N,"reflectance")),this._microSurfaceTexture&&(N.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,D.u)(this._microSurfaceTexture,N,"microSurfaceSampler"))),this._bumpTexture&&x.getCaps().standardDerivatives&&l.e.BumpTextureEnabled&&!this._disableBumpMap&&(N.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,D.u)(this._bumpTexture,N,"bump"),X._mirroredCameraPosition?N.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):N.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&N.updateFloat("pointSize",this.pointSize),i.METALLICWORKFLOW){var g;O.k.Fe[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,O.k.Fe[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,N.updateColor4("vReflectivityColor",O.k.Fe[0],1);const f=(null===(g=this.subSurface)||void 0===g?void 0:g._indexOfRefraction)??1.5,Q=1,H=Math.pow((f-Q)/(f+Q),2);this._metallicReflectanceColor.scaleToRef(H*this._metallicF0Factor,O.k.Fe[0]);const X=this._metallicF0Factor;N.updateColor4("vMetallicReflectanceFactors",O.k.Fe[0],X)}else N.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);N.updateColor3("vEmissiveColor",l.e.EmissiveTextureEnabled?this._emissiveColor:O.e.BlackReadOnly),N.updateColor3("vReflectionColor",this._reflectionColor),!i.SS_REFRACTION&&null!==(J=this.subSurface)&&void 0!==J&&J._linkRefractionWithTransparency?N.updateColor4("vAlbedoColor",this._albedoColor,1):N.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*X.environmentIntensity,this._lightingInfos.w=this._specularIntensity,N.updateVector4("vLightingIntensity",this._lightingInfos),X.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),N.updateColor3("vAmbientColor",this._globalAmbientColor),N.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}X.texturesEnabled&&(this._albedoTexture&&l.e.DiffuseTextureEnabled&&N.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&l.e.AmbientTextureEnabled&&N.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&l.e.OpacityTextureEnabled&&N.setTexture("opacitySampler",this._opacityTexture),B&&l.e.ReflectionTextureEnabled&&(i.LODBASEDMICROSFURACE?N.setTexture("reflectionSampler",B):(N.setTexture("reflectionSampler",B._lodTextureMid||B),N.setTexture("reflectionSamplerLow",B._lodTextureLow||B),N.setTexture("reflectionSamplerHigh",B._lodTextureHigh||B)),i.USEIRRADIANCEMAP&&N.setTexture("irradianceSampler",B.irradianceTexture)),i.ENVIRONMENTBRDF&&N.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&l.e.EmissiveTextureEnabled&&N.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&l.e.LightmapTextureEnabled&&N.setTexture("lightmapSampler",this._lightmapTexture),l.e.SpecularTextureEnabled&&(this._metallicTexture?N.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&N.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&N.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&i.REFLECTANCE&&N.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&N.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&x.getCaps().standardDerivatives&&l.e.BumpTextureEnabled&&!this._disableBumpMap&&N.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(Q)&&this.va().depthPeelingRenderer.bind(S),this._eventInfo.subMesh=H,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,u.f)(this._activeEffect,this,X),this.bindEyePosition(S)}else X.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(K||!this.isFrozen){var z;if(X.lightsEnabled&&!this._disableLighting&&(0,D.j)(X,Q,this._activeEffect,i,this._maxSimultaneousLights),(X.fogEnabled&&Q.applyFog&&X.fogMode!==Z.e.FOGMODE_NONE||B||this.subSurface.refractionTexture||Q.receiveShadows||i.PREPASS)&&this.bindView(S),(0,D.h)(X,Q,this._activeEffect,!0),i.NUM_MORPH_INFLUENCERS&&(0,D.p)(Q,this._activeEffect),i.BAKED_VERTEX_ANIMATION_TEXTURE)null===(z=Q.bakedVertexAnimationManager)||void 0===z||z.bind(S,i.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,D.m)(i,this._activeEffect,X)}this._afterBind(Q,this._activeEffect,H),N.update()}getAnimatables(){const f=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&f.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&f.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&f.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&f.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&f.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?f.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&f.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&f.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&f.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&f.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&f.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&f.push(this._microSurfaceTexture),f}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const f=super.getActiveTextures();return this._albedoTexture&&f.push(this._albedoTexture),this._ambientTexture&&f.push(this._ambientTexture),this._opacityTexture&&f.push(this._opacityTexture),this._reflectionTexture&&f.push(this._reflectionTexture),this._emissiveTexture&&f.push(this._emissiveTexture),this._reflectivityTexture&&f.push(this._reflectivityTexture),this._metallicTexture&&f.push(this._metallicTexture),this._metallicReflectanceTexture&&f.push(this._metallicReflectanceTexture),this._reflectanceTexture&&f.push(this._reflectanceTexture),this._microSurfaceTexture&&f.push(this._microSurfaceTexture),this._bumpTexture&&f.push(this._bumpTexture),this._lightmapTexture&&f.push(this._lightmapTexture),f}hasTexture(f){return!!super.hasTexture(f)||(this._albedoTexture===f||(this._ambientTexture===f||(this._opacityTexture===f||(this._reflectionTexture===f||(this._emissiveTexture===f||(this._reflectivityTexture===f||(this._metallicTexture===f||(this._metallicReflectanceTexture===f||(this._reflectanceTexture===f||(this._microSurfaceTexture===f||(this._bumpTexture===f||this._lightmapTexture===f)))))))))))}setPrePassRenderer(){var f;if(null===(f=this.subSurface)||void 0===f||!f.isScatteringEnabled)return!1;const Q=this.va().enableSubSurfaceForPrePass();return Q&&(Q.enabled=!0),!0}dispose(f,Q){var H,X,i,S,x,K,Z,B,N,J,g,z;(this._breakShaderLoadedCheck=!0,Q)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(H=this._albedoTexture)||void 0===H||H.dispose(),null===(X=this._ambientTexture)||void 0===X||X.dispose(),null===(i=this._opacityTexture)||void 0===i||i.dispose(),null===(S=this._reflectionTexture)||void 0===S||S.dispose(),null===(x=this._emissiveTexture)||void 0===x||x.dispose(),null===(K=this._metallicTexture)||void 0===K||K.dispose(),null===(Z=this._reflectivityTexture)||void 0===Z||Z.dispose(),null===(B=this._bumpTexture)||void 0===B||B.dispose(),null===(N=this._lightmapTexture)||void 0===N||N.dispose(),null===(J=this._metallicReflectanceTexture)||void 0===J||J.dispose(),null===(g=this._reflectanceTexture)||void 0===g||g.dispose(),null===(z=this._microSurfaceTexture)||void 0===z||z.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(f,Q)}}V.PBRMATERIAL_OPAQUE=e.e.MATERIAL_OPAQUE,V.PBRMATERIAL_ALPHATEST=e.e.MATERIAL_ALPHATEST,V.PBRMATERIAL_ALPHABLEND=e.e.MATERIAL_ALPHABLEND,V.PBRMATERIAL_ALPHATESTANDBLEND=e.e.MATERIAL_ALPHATESTANDBLEND,V.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,V.LIGHTFALLOFF_PHYSICAL=0,V.LIGHTFALLOFF_GLTF=1,V.LIGHTFALLOFF_STANDARD=2,V.ForceGLSL=!1,(0,X.d)([(0,i.p)()],V.prototype,"_imageProcessingConfiguration",void 0),(0,X.d)([(0,i.c)("_markAllSubMeshesAsMiscDirty")],V.prototype,"debugMode",void 0)},11946:(f,Q,H)=>{"use strict";H.d(Q,{e:()=>g});var X=H(978),i=H(982),S=H(1203),x=H(1003),K=H(1036),Z=H(974),B=H(1022),N=H(994),J=H(1151);H(1559);class g extends K.b{set boundingBoxSize(f){if(this._boundingBoxSize&&this._boundingBoxSize.equals(f))return;this._boundingBoxSize=f;const Q=this.va();Q&&Q.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(f){this._rotationY=f,this.setReflectionTextureMatrix(x.e.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(f,Q,H){let X="";return f.forEach((f=>X+=f)),new g(X,Q,null,H,f)}static CreateFromPrefilteredData(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=Q.useDelayedTextureLoading;Q.useDelayedTextureLoading=!1;const S=new g(f,Q,null,!1,null,null,null,void 0,!0,H,X);return Q.useDelayedTextureLoading=i,S}constructor(f,Q){var H;let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,g=arguments.length>8&&void 0!==arguments[8]&&arguments[8],z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,v=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,O=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,n=arguments.length>13?arguments[13]:void 0,e=arguments.length>14?arguments[14]:void 0;super(Q),this.onLoadObservable=new N.e,this.boundingBoxPosition=x.p.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new x.e,this._buffer=null,this.name=f,this.url=f,this._noMipmap=i,this.qc=!1,this.isCube=!0,this._textureMatrix=x.e.Identity(),this.coordinatesMode=Z.b.CUBIC_MODE;let G=null,I=null;null===X||Array.isArray(X)?(this._noMipmap=i,this._format=J,this._createPolynomials=v,G=X,this._loaderOptions=n,this._useSRGBBuffer=e,this._lodScale=Y,this._lodOffset=O):(G=X.extensions??null,this._noMipmap=X.noMipmap??!1,S=X.files??null,I=X.buffer??null,this._format=X.format??5,g=X.prefiltered??!1,z=X.forcedExtension??null,this._createPolynomials=X.createPolynomials??!1,this._lodScale=X.lodScale??.8,this._lodOffset=X.lodOffset??0,this._loaderOptions=X.loaderOptions,this._useSRGBBuffer=X.useSRGBBuffer,K=X.X??null,B=X.onError??null),(f||S)&&this.updateURL(f,z,K,g,B,G,null===(H=this.va())||void 0===H?void 0:H.useDelayedTextureLoading,S,I)}getClassName(){return"CubeTexture"}updateURL(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,S=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,x=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=f),this.url=f,Q&&(this._forcedExtension=Q);const B=f.lastIndexOf("."),N=Q||(B>-1?f.substring(B).toLowerCase():""),J=0===N.indexOf(".dds"),g=0===N.indexOf(".env"),z=0===N.indexOf(".basis");if(g?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=X,X&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),K)this._files=K;else if(z||g||J||S||(S=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,S){for(let Q=0;Q<S.length;Q++)this._files.push(f+S[Q]);this._extensions=S}this._buffer=Z,x?(this.delayLoadState=4,this._delayedOnLoad=H,this._delayedOnError=i):this._loadTexture(H,i)}delayLoad(f){4===this.delayLoadState&&(f&&(this._forcedExtension=f),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(f){var Q,H;if(f.updateFlag===this._textureMatrix.updateFlag)return;f.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(H=this.va())||void 0===H||H.markAllMaterialsAsDirty(1,(f=>-1!==f.getActiveTextures().indexOf(this))));if(this._textureMatrix=f,null===(Q=this.va())||void 0===Q||!Q.useRightHandedSystem)return;const X=x.l.Wd[0],i=x.l.Quaternion[0],S=x.l.Wd[1];this._textureMatrix.decompose(X,i,S),i.z*=-1,i.w*=-1,x.e.ComposeToRef(X,i,S,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var f;return null!==(f=this.va())&&void 0!==f&&f.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=this.va(),X=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const i=()=>{var Q;(this.onLoadObservable.notifyObservers(this),X)&&(X.dispose(),null===(Q=this.va())||void 0===Q||Q.markAllMaterialsAsDirty(1));f&&f()},x=(f,H)=>{this._loadingError=!0,this._errorObject={message:f,exception:H},Q&&Q(f,H),Z.b.OnTextureLoadErrorObservable.notifyObservers(this)};var K;this._texture?this._texture.isReady?S.g.SetImmediate((()=>i())):this._texture.onLoadedObservable.add((()=>i())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,H,this._lodScale,this._lodOffset,f,x,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,H,this._files,this._noMipmap,f,x,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(K=this._texture)||void 0===K||K.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(f,Q,H){const X=J.b.Parse((()=>{let X=!1;return f.prefiltered&&(X=f.prefiltered),new g(H+(f.url??f.name),Q,f.extensions,!1,f.files||null,null,null,void 0,X,f.forcedExtension)}),f,Q);if(f.boundingBoxPosition&&(X.boundingBoxPosition=x.p.Zd(f.boundingBoxPosition)),f.boundingBoxSize&&(X.boundingBoxSize=x.p.Zd(f.boundingBoxSize)),f.animations)for(let i=0;i<f.animations.length;i++){const Q=f.animations[i],H=(0,B.e)("BABYLON.Animation");H&&X.animations.push(H.Parse(Q))}return X}clone(){let f=0;const Q=J.b.Clone((()=>{const Q=new g(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return f=Q.uniqueId,Q}),this);return Q.uniqueId=f,Q}}(0,X.d)([(0,i.G)()],g.prototype,"url",void 0),(0,X.d)([(0,i.F)()],g.prototype,"boundingBoxPosition",void 0),(0,X.d)([(0,i.F)()],g.prototype,"boundingBoxSize",null),(0,X.d)([(0,i.G)("rotationY")],g.prototype,"rotationY",null),(0,X.d)([(0,i.G)("files")],g.prototype,"_files",void 0),(0,X.d)([(0,i.G)("forcedExtension")],g.prototype,"_forcedExtension",void 0),(0,X.d)([(0,i.G)("extensions")],g.prototype,"_extensions",void 0),(0,X.d)([(0,i.s)("textureMatrix")],g.prototype,"_textureMatrix",void 0),(0,X.d)([(0,i.s)("textureMatrixRefraction")],g.prototype,"_textureMatrixRefraction",void 0),Z.b._CubeTextureParser=g.Parse,(0,B.h)("BABYLON.CubeTexture",g)},12263:(f,Q,H)=>{"use strict";H.d(Q,{b:()=>Z});var X=H(1092),i=H(974),S=H(1214),x=H(1445),K=H(1133);x.ThinEngine.prototype.createDynamicTexture=function(f,Q,H,X){const i=new K.c(this,4);return i.baseWidth=f,i.baseHeight=Q,H&&(f=this.needPOTTextures?(0,S.g)(f,this._caps.maxTextureSize):f,Q=this.needPOTTextures?(0,S.g)(Q,this._caps.maxTextureSize):Q),i.width=f,i.height=Q,i.isReady=!1,i.generateMipMaps=H,i.samplingMode=X,this.updateTextureSamplingMode(X,i),this._internalTexturesCache.push(i),i},x.ThinEngine.prototype.updateDynamicTexture=function(f,Q,H){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,S=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!f)return;const x=this._gl,K=x.TEXTURE_2D,Z=this._bindTextureDirectly(K,f,!0,S);this._unpackFlipY(void 0===H?f.invertY:H),X&&x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const B=this._getWebGLTextureType(f.type),N=this._getInternalFormat(i||f.format),J=this._getRGBABufferInternalSizedFormat(f.type,N);x.texImage2D(K,0,J,N,B,Q),f.generateMipMaps&&x.generateMipmap(K),Z||this._bindTextureDirectly(K,null),X&&x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),i&&(f.format=i),f._dynamicTextureSource=Q,f._premulAlpha=X,f.invertY=H||!1,f.isReady=!0};class Z extends i.b{constructor(f,Q,H){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,x=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,K=arguments.length>6?arguments[6]:void 0;const Z=!H||H._isScene;super(null,Z?H:null===H||void 0===H?void 0:H.Re,Z?!X:H,K,S,void 0,void 0,void 0,void 0,x),this.name=f,this.wrapU=i.b.CLAMP_ADDRESSMODE,this.wrapV=i.b.CLAMP_ADDRESSMODE,this._generateMipMaps=X;const B=this._getEngine();if(!B)return;if(Q.getContext)this._canvas=Q,this._ownCanvas=!1,this._texture=B.createDynamicTexture(this._canvas.width,this._canvas.height,X,S);else{this._canvas=B.createCanvas(1,1),this._ownCanvas=!0;const f=Q;f.width||0===f.width?this._texture=B.createDynamicTexture(f.width,f.height,X,S):this._texture=B.createDynamicTexture(Q,Q,X,S)}const N=this.getSize();this._canvas.width!==N.width&&(this._canvas.width=N.width),this._canvas.height!==N.height&&(this._canvas.height=N.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(f){this._canvas.width=f.width,this._canvas.height=f.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(f.width,f.height,this._generateMipMaps,this.samplingMode)}scale(f){const Q=this.getSize();Q.width*=f,Q.height*=f,this._recreate(Q)}scaleTo(f,Q){const H=this.getSize();H.width=f,H.height=Q,this._recreate(H)}getContext(){return this._context}clear(f){const Q=this.getSize();f&&(this._context.fillStyle=f),this._context.clearRect(0,0,Q.width,Q.height)}update(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===f||f,Q,this._format||void 0,void 0,H)}drawText(f,Q,H,X,i,S,x){let K=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const Z=this.getSize();if(S&&(this._context.fillStyle=S,this._context.fillRect(0,0,Z.width,Z.height)),this._context.font=X,null===Q||void 0===Q){const H=this._context.measureText(f);Q=(Z.width-H.width)/2}if(null===H||void 0===H){const f=parseInt(X.replace(/\D/g,""));H=Z.height/2+f/3.65}this._context.fillStyle=i||"",this._context.fillText(f,Q,H),K&&this.update(x)}dispose(){var f,Q;(super.dispose(),this._ownCanvas)&&(null===(f=this._canvas)||void 0===f||null===(Q=f.remove)||void 0===Q||Q.call(f));this._canvas=null,this._context=null}clone(){const f=this.va();if(!f)return this;const Q=this.getSize(),H=new Z(this.name,Q,f,this._generateMipMaps);return H.qc=this.qc,H.level=this.level,H.wrapU=this.wrapU,H.wrapV=this.wrapV,H}serialize(){const f=this.va();f&&!f.isReady()&&X.b.Warn("The scene must be ready before serializing the dynamic texture");const Q=super.serialize();return Z._IsCanvasElement(this._canvas)&&(Q.base64String=this._canvas.toDataURL()),Q.invertY=this._invertY,Q.samplingMode=this.samplingMode,Q}static _IsCanvasElement(f){return void 0!==f.toDataURL}_rebuild(){this.update()}}},11443:(f,Q,H)=>{"use strict";H.d(Q,{b:()=>i});var X=H(974);class i extends X.b{constructor(f,Q,H,i,S){let x=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,N=arguments.length>9?arguments[9]:void 0,J=arguments.length>10?arguments[10]:void 0;super(null,S,!x,K,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,N),this.format=i,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==B||(Z=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==B||(Z=1),this._texture=this._engine.createRawTexture(f,Q,H,i,x,K,Z,null,B,N??0,J??!1),this.wrapU=X.b.CLAMP_ADDRESSMODE,this.wrapV=X.b.CLAMP_ADDRESSMODE)}update(f){this._getEngine().updateRawTexture(this._texture,f,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const f=new i(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return f._texture=this._texture,this._texture.incrementReferences(),f}static CreateLuminanceTexture(f,Q,H,X){return new i(f,Q,H,1,X,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(f,Q,H,X){return new i(f,Q,H,2,X,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(f,Q,H,X){return new i(f,Q,H,0,X,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(f,Q,H,X){return new i(f,Q,H,4,X,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(f,Q,H,X){return new i(f,Q,H,5,X,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(f,Q,H,X){return new i(f,Q,H,5,X,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(f,Q,H,S){let x=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],K=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:X.b.TRILINEAR_SAMPLINGMODE;return new i(f,Q,H,6,S,x,K,Z,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(f,Q,H,S){let x=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],K=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:X.b.TRILINEAR_SAMPLINGMODE;return new i(f,Q,H,6,S,x,K,Z,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11349:(f,Q,H)=>{"use strict";H.d(Q,{b:()=>x});var X=H(1352),i=H(1156),S=H(1022);class x extends X.e{get Cg(){return this._subMaterials}set Cg(f){this._subMaterials=f,this._hookArray(f)}getChildren(){return this.Cg}constructor(f,Q){super(f,Q,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.Cg=[],this._storeEffectOnSubMeshes=!0}_hookArray(f){var Q=this;const H=f.push;f.push=function(){for(var X=arguments.length,i=new Array(X),S=0;S<X;S++)i[S]=arguments[S];const x=H.apply(f,i);return Q._markAllSubMeshesAsTexturesDirty(),x};const X=f.splice;f.splice=(Q,H)=>{const i=X.apply(f,[Q,H]);return this._markAllSubMeshesAsTexturesDirty(),i}}getSubMaterial(f){return f<0||f>=this.Cg.length?this.va().defaultMaterial:this.Cg[f]}getActiveTextures(){return super.getActiveTextures().concat(...this.Cg.map((f=>f?f.getActiveTextures():[])))}hasTexture(f){if(super.hasTexture(f))return!0;for(let H=0;H<this.Cg.length;H++){var Q;if(null!==(Q=this.Cg[H])&&void 0!==Q&&Q.hasTexture(f))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(f,Q,H){for(let X=0;X<this.Cg.length;X++){const i=this.Cg[X];if(i){if(i._storeEffectOnSubMeshes){if(!i.isReadyForSubMesh(f,Q,H))return!1;continue}if(!i.isReady(f))return!1}}return!0}clone(f,Q){const H=new x(f,this.va());for(let X=0;X<this.Cg.length;X++){let i=null;const S=this.Cg[X];i=Q&&S?S.clone(f+"-"+S.name):this.Cg[X],H.Cg.push(i)}return H}serialize(){const f={};f.name=this.name,f.id=this.id,f.uniqueId=this.uniqueId,i.b&&(f.tags=i.b.GetTags(this)),f.materialsUniqueIds=[],f.materials=[];for(let Q=0;Q<this.Cg.length;Q++){const H=this.Cg[Q];H?(f.materialsUniqueIds.push(H.uniqueId),f.materials.push(H.id)):(f.materialsUniqueIds.push(null),f.materials.push(null))}return f}dispose(f,Q,H){const X=this.va();if(!X)return;if(H)for(let S=0;S<this.Cg.length;S++){const H=this.Cg[S];H&&H.dispose(f,Q)}const i=X.multiMaterials.indexOf(this);i>=0&&X.multiMaterials.splice(i,1),super.dispose(f,Q)}static ParseMultiMaterial(f,Q){const H=new x(f.name,Q);return H.id=f.id,H._loadedUniqueId=f.uniqueId,i.b&&i.b.AddTagsTo(H,f.tags),f.materialsUniqueIds?H._waitingSubMaterialsUniqueIds=f.materialsUniqueIds:f.materials.forEach((f=>H.Cg.push(Q.getLastMaterialById(f)))),H}}(0,S.h)("BABYLON.MultiMaterial",x)},11356:(f,Q,H)=>{"use strict";H.d(Q,{b:()=>N,f:()=>B});var X=H(1003),i=H(1161),S=H(11301),x=H(11322),K=H(1183);H(11363);function Z(f){let Q=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const H=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],S=[];let Z=[];const B=f.width||f.size||1,N=f.height||f.size||1,J=f.depth||f.size||1,g=f.wrap||!1;let z=void 0===f.topBaseAt?1:f.topBaseAt,v=void 0===f.bottomBaseAt?0:f.bottomBaseAt;z=(z+4)%4,v=(v+4)%4;let Y=[2,0,3,1][z],O=[2,0,1,3][v],n=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(g){Q=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],n=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let f=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],H=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const X=[17,18,19,16],i=[22,23,20,21];for(;Y>0;)f.unshift(f.pop()),X.unshift(X.pop()),Y--;for(;O>0;)H.unshift(H.pop()),i.unshift(i.pop()),O--;f=f.flat(),H=H.flat(),n=n.concat(f).concat(H),Q.push(X[0],X[2],X[3],X[0],X[1],X[2]),Q.push(i[0],i[2],i[3],i[0],i[1],i[2])}const e=[B/2,N/2,J/2];Z=n.reduce(((f,Q,H)=>f.concat(Q*e[H%3])),[]);const G=0===f.sideOrientation?0:f.sideOrientation||x.b.DEFAULTSIDE,I=f.faceUV||new Array(6),l=f.faceColors,q=[];for(let x=0;x<6;x++)void 0===I[x]&&(I[x]=new X.s(0,0,1,1)),l&&void 0===l[x]&&(l[x]=new i.h(1,1,1,1));for(let X=0;X<6;X++)if(S.push(I[X].z,K.e?1-I[X].w:I[X].w),S.push(I[X].x,K.e?1-I[X].w:I[X].w),S.push(I[X].x,K.e?1-I[X].y:I[X].y),S.push(I[X].z,K.e?1-I[X].y:I[X].y),l)for(let f=0;f<4;f++)q.push(l[X].r,l[X].g,l[X].b,l[X].a);x.b._ComputeSides(G,Z,Q,H,S,f.frontUVs,f.backUVs);const D=new x.b;if(D.indices=Q,D.xa=Z,D.ya=H,D.Aa=S,l){const f=G===x.b.DOUBLESIDE?q.concat(q):q;D.za=f}return D}function B(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new S.b(f,H);Q.sideOrientation=S.b._GetDefaultSideOrientation(Q.sideOrientation),X._originalBuilderSideOrientation=Q.sideOrientation;return Z(Q).Ca(X,Q.updatable),X}const N={CreateBox:B};x.b.CreateBox=Z,S.b.CreateBox=function(f,Q){return B(f,{size:Q,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11459:(f,Q,H)=>{"use strict";H.d(Q,{d:()=>K});var X=H(11301),i=H(11322),S=H(1183);function x(f){const Q=[],H=[],X=[],x=[],K=f.i||.5,Z=f.al||64,B=f.arc&&(f.arc<=0||f.arc>1)?1:f.arc||1,N=0===f.sideOrientation?0:f.sideOrientation||i.b.DEFAULTSIDE;Q.push(0,0,0),x.push(.5,.5);const J=2*Math.PI*B,g=1===B?J/Z:J/(Z-1);let z=0;for(let i=0;i<Z;i++){const f=Math.cos(z),H=Math.sin(z),X=(f+1)/2,i=(1-H)/2;Q.push(K*f,K*H,0),x.push(X,S.e?1-i:i),z+=g}1===B&&(Q.push(Q[3],Q[4],Q[5]),x.push(x[2],S.e?1-x[3]:x[3]));const v=Q.length/3;for(let i=1;i<v-1;i++)H.push(i+1,0,i);i.b.ComputeNormals(Q,H,X),i.b._ComputeSides(N,Q,H,X,x,f.frontUVs,f.backUVs);const Y=new i.b;return Y.indices=H,Y.xa=Q,Y.ya=X,Y.Aa=x,Y}function K(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new X.b(f,H);Q.sideOrientation=X.b._GetDefaultSideOrientation(Q.sideOrientation),i._originalBuilderSideOrientation=Q.sideOrientation;return x(Q).Ca(i,Q.updatable),i}i.b.nb=x,X.b.nb=function(f,Q,H){return K(f,{i:Q,al:H,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11363:(f,Q,H)=>{"use strict";H.d(Q,{f:()=>O,e:()=>e,i:()=>n});var X=H(1003),i=H(1161),S=H(11301),x=H(11322),K=H(1253);S.b._GroundMeshParser=(f,Q)=>Z.Parse(f,Q);class Z extends S.b{constructor(f,Q){super(f,Q),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=f,this._subdivisionsY=f,this.subdivide(f);const H=this;H.createOrUpdateSubmeshesOctree&&H.createOrUpdateSubmeshesOctree(Q)}getHeightAtCoordinates(f,Q){const H=this.getWorldMatrix(),i=X.l.Matrix[5];H.invertToRef(i);const S=X.l.Wd[8];if(X.p.TransformCoordinatesFromFloatsToRef(f,0,Q,i,S),f=S.x,Q=S.z,f<this._minX||f>=this._maxX||Q<=this._minZ||Q>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const x=this._getFacetAt(f,Q),K=-(x.x*f+x.z*Q+x.w)/x.y;return X.p.TransformCoordinatesFromFloatsToRef(0,K,0,H,S),S.y}getNormalAtCoordinates(f,Q){const H=new X.p(0,1,0);return this.getNormalAtCoordinatesToRef(f,Q,H),H}getNormalAtCoordinatesToRef(f,Q,H){const i=this.getWorldMatrix(),S=X.l.Matrix[5];i.invertToRef(S);const x=X.l.Wd[8];if(X.p.TransformCoordinatesFromFloatsToRef(f,0,Q,S,x),f=x.x,Q=x.z,f<this._minX||f>this._maxX||Q<this._minZ||Q>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const K=this._getFacetAt(f,Q);return X.p.TransformNormalFromFloatsToRef(K.x,K.y,K.z,i,H),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(f,Q){const H=Math.floor((f+this._maxX)*this._subdivisionsX/this._width),X=Math.floor(-(Q+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),i=this._heightQuads[X*this._subdivisionsX+H];let S;return S=Q<i.slope.x*f+i.slope.y?i.facet1:i.facet2,S}_initHeightQuads(){const f=this._subdivisionsX,Q=this._subdivisionsY;this._heightQuads=new Array;for(let H=0;H<Q;H++)for(let Q=0;Q<f;Q++){const i={slope:X.m.Zero(),facet1:new X.s(0,0,0,0),facet2:new X.s(0,0,0,0)};this._heightQuads[H*f+Q]=i}return this}_computeHeightQuads(){const f=this.getVerticesData(K.e.PositionKind);if(!f)return this;const Q=X.l.Wd[3],H=X.l.Wd[2],i=X.l.Wd[1],S=X.l.Wd[0],x=X.l.Wd[4],Z=X.l.Wd[5],B=X.l.Wd[6],N=X.l.Wd[7],J=X.l.Wd[8];let g=0,z=0,v=0,Y=0,O=0,n=0,e=0;const G=this._subdivisionsX,I=this._subdivisionsY;for(let K=0;K<I;K++)for(let I=0;I<G;I++){g=3*I,z=K*(G+1)*3,v=(K+1)*(G+1)*3,Q.x=f[z+g],Q.y=f[z+g+1],Q.z=f[z+g+2],H.x=f[z+g+3],H.y=f[z+g+4],H.z=f[z+g+5],i.x=f[v+g],i.y=f[v+g+1],i.z=f[v+g+2],S.x=f[v+g+3],S.y=f[v+g+4],S.z=f[v+g+5],Y=(S.z-Q.z)/(S.x-Q.x),O=Q.z-Y*Q.x,H.subtractToRef(Q,x),i.subtractToRef(Q,Z),S.subtractToRef(Q,B),X.p.CrossToRef(B,Z,N),X.p.CrossToRef(x,B,J),N.normalize(),J.normalize(),n=-(N.x*Q.x+N.y*Q.y+N.z*Q.z),e=-(J.x*H.x+J.y*H.y+J.z*H.z);const l=this._heightQuads[K*G+I];l.slope.Xd(Y,O),l.facet1.Xd(N.x,N.y,N.z,n),l.facet2.Xd(J.x,J.y,J.z,e)}return this}serialize(f){super.serialize(f),f.subdivisionsX=this._subdivisionsX,f.subdivisionsY=this._subdivisionsY,f.minX=this._minX,f.maxX=this._maxX,f.nj=this._minZ,f.maxZ=this._maxZ,f.width=this._width,f.height=this._height}static Parse(f,Q){const H=new Z(f.name,Q);return H._subdivisionsX=f.subdivisionsX||1,H._subdivisionsY=f.subdivisionsY||1,H._minX=f.minX,H._maxX=f.maxX,H._minZ=f.nj,H._maxZ=f.maxZ,H._width=f.width,H._height=f.height,H}}var B=H(1203),N=H(1027),J=H(1011),g=H(1183);function z(f){const Q=[],H=[],i=[],S=[];let K,Z;const B=f.width||f.size||1,N=f.height||f.size||1,J=0|(f.subdivisionsX||f.subdivisions||1),z=0|(f.subdivisionsY||f.subdivisions||1);for(K=0;K<=z;K++)for(Z=0;Z<=J;Z++){const f=new X.p(Z*B/J-B/2,0,(z-K)*N/z-N/2),Q=new X.p(0,1,0);H.push(f.x,f.y,f.z),i.push(Q.x,Q.y,Q.z),S.push(Z/J,g.e?K/z:1-K/z)}for(K=0;K<z;K++)for(Z=0;Z<J;Z++)Q.push(Z+1+(K+1)*(J+1)),Q.push(Z+1+K*(J+1)),Q.push(Z+K*(J+1)),Q.push(Z+(K+1)*(J+1)),Q.push(Z+1+(K+1)*(J+1)),Q.push(Z+K*(J+1));const v=new x.b;return v.indices=Q,v.xa=H,v.ya=i,v.Aa=S,v}function v(f){const Q=void 0!==f.xmin&&null!==f.xmin?f.xmin:-1,H=void 0!==f.zmin&&null!==f.zmin?f.zmin:-1,i=void 0!==f.xmax&&null!==f.xmax?f.xmax:1,S=void 0!==f.zmax&&null!==f.zmax?f.zmax:1,K=f.subdivisions||{w:1,h:1},Z=f.precision||{w:1,h:1},B=[],N=[],J=[],g=[];let z,v,Y,O;K.h=K.h<1?1:K.h,K.w=K.w<1?1:K.w,Z.w=Z.w<1?1:Z.w,Z.h=Z.h<1?1:Z.h;const n=(i-Q)/K.w,e=(S-H)/K.h;function G(f,Q,H,i){const S=N.length/3,x=Z.w+1;for(z=0;z<Z.h;z++)for(v=0;v<Z.w;v++){const f=[S+v+z*x,S+(v+1)+z*x,S+(v+1)+(z+1)*x,S+v+(z+1)*x];B.push(f[1]),B.push(f[2]),B.push(f[3]),B.push(f[0]),B.push(f[1]),B.push(f[3])}const K=X.p.Zero(),Y=new X.p(0,1,0);for(z=0;z<=Z.h;z++)for(K.z=z*(i-Q)/Z.h+Q,v=0;v<=Z.w;v++)K.x=v*(H-f)/Z.w+f,K.y=0,N.push(K.x,K.y,K.z),J.push(Y.x,Y.y,Y.z),g.push(v/Z.w,z/Z.h)}for(Y=0;Y<K.h;Y++)for(O=0;O<K.w;O++)G(Q+O*n,H+Y*e,Q+(O+1)*n,H+(Y+1)*e);const I=new x.b;return I.indices=B,I.xa=N,I.ya=J,I.Aa=g,I}function Y(f){const Q=[],H=[],S=[],K=[];let Z,B;const N=f.colorFilter||new i.e(.3,.59,.11),g=f.alphaFilter||0;let z=!1;if(f.minHeight>f.maxHeight){z=!0;const Q=f.maxHeight;f.maxHeight=f.minHeight,f.minHeight=Q}for(Z=0;Z<=f.subdivisions;Z++)for(B=0;B<=f.subdivisions;B++){const Q=new X.p(B*f.width/f.subdivisions-f.width/2,0,(f.subdivisions-Z)*f.height/f.subdivisions-f.height/2),i=4*(((Q.x+f.width/2)/f.width*(f.bufferWidth-1)|0)+((1-(Q.z+f.height/2)/f.height)*(f.bufferHeight-1)|0)*f.bufferWidth);let x=f.buffer[i]/255,v=f.buffer[i+1]/255,Y=f.buffer[i+2]/255;const O=f.buffer[i+3]/255;z&&(x=1-x,v=1-v,Y=1-Y);const n=x*N.r+v*N.g+Y*N.b;Q.y=O>=g?f.minHeight+(f.maxHeight-f.minHeight)*n:f.minHeight-J.c,f.heightBuffer&&(f.heightBuffer[Z*(f.subdivisions+1)+B]=Q.y),H.push(Q.x,Q.y,Q.z),S.push(0,0,0),K.push(B/f.subdivisions,1-Z/f.subdivisions)}for(Z=0;Z<f.subdivisions;Z++)for(B=0;B<f.subdivisions;B++){const X=B+1+(Z+1)*(f.subdivisions+1),i=B+1+Z*(f.subdivisions+1),S=B+Z*(f.subdivisions+1),x=B+(Z+1)*(f.subdivisions+1),K=H[3*X+1]>=f.minHeight,N=H[3*i+1]>=f.minHeight,J=H[3*S+1]>=f.minHeight;K&&N&&J&&(Q.push(X),Q.push(i),Q.push(S));H[3*x+1]>=f.minHeight&&K&&J&&(Q.push(x),Q.push(X),Q.push(S))}x.b.ComputeNormals(H,Q,S);const v=new x.b;return v.indices=Q,v.xa=H,v.ya=S,v.Aa=K,v}function O(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const H=new Z(f,arguments.length>2?arguments[2]:void 0);H._setReady(!1),H._subdivisionsX=Q.subdivisionsX||Q.subdivisions||1,H._subdivisionsY=Q.subdivisionsY||Q.subdivisions||1,H._width=Q.width||1,H._height=Q.height||1,H._maxX=H._width/2,H._maxZ=H._height/2,H._minX=-H._maxX,H._minZ=-H._maxZ;return z(Q).Ca(H,Q.updatable),H._setReady(!0),H}function n(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new S.b(f,H);return v(Q).Ca(X,Q.updatable),X}function e(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const S=H.width||10,x=H.height||10,K=H.subdivisions||1,J=H.minHeight||0,g=H.maxHeight||1,z=H.colorFilter||new i.e(.3,.59,.11),v=H.alphaFilter||0,O=H.updatable,n=H.onReady;X=X||N.e.LastCreatedScene;const e=new Z(f,X);let G;e._subdivisionsX=K,e._subdivisionsY=K,e._width=S,e._height=x,e._maxX=e._width/2,e._maxZ=e._height/2,e._minX=-e._maxX,e._minZ=-e._maxZ,e._setReady(!1),H.passHeightBufferInCallback&&(G=new Float32Array((K+1)*(K+1)));const I=(f,Q,H)=>{Y({width:S,height:x,subdivisions:K,minHeight:J,maxHeight:g,colorFilter:z,buffer:f,bufferWidth:Q,bufferHeight:H,alphaFilter:v,heightBuffer:G}).Ca(e,O),n&&n(e,G),e._setReady(!0)};if("string"===typeof Q){const f=f=>{var Q;const H=f.width,i=f.height;if(X.u)return;const S=null===(Q=X)||void 0===Q?void 0:Q.getEngine().resizeImageBitmap(f,H,i);I(S,H,i)};B.g.LoadImage(Q,f,H.onError?H.onError:()=>{},X.offlineProvider)}else I(Q.data,Q.width,Q.height);return e}x.b.CreateGround=z,x.b.CreateTiledGround=v,x.b.CreateGroundFromHeightMap=Y,S.b.CreateGround=(f,Q,H,X,i,S)=>O(f,{width:Q,height:H,subdivisions:X,updatable:S},i),S.b.CreateTiledGround=(f,Q,H,X,i,S,x,K,Z)=>n(f,{xmin:Q,zmin:H,xmax:X,zmax:i,subdivisions:S,precision:x,updatable:Z},K),S.b.CreateGroundFromHeightMap=(f,Q,H,X,i,S,x,K,Z,B,N)=>e(f,Q,{width:H,height:X,subdivisions:i,minHeight:S,maxHeight:x,updatable:Z,onReady:B,alphaFilter:N},K)},12256:(f,Q,H)=>{"use strict";H.d(Q,{e:()=>c,f:()=>P,h:()=>m});var X=H(1003),i=H(11301),S=H(11322),x=H(1161),K=H(1253),Z=H(11929),B=H(1352),N=H(1151),J=H(1196),g=H(974),z=H(1022),v=H(1416),Y=H(1055),O=H(1404),n=H(1027),e=H(1395),G=H(1389);const I={effect:null,subMesh:null};class l extends O.c{constructor(f,Q,H){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(f,Q,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new X.e,this._cachedWorldViewProjectionMatrix=new X.e,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=H,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","se","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...i}}get shaderPath(){return this._shaderPath}set shaderPath(f){this._shaderPath=f}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(f){-1===this._options.uniforms.indexOf(f)&&this._options.uniforms.push(f)}setTexture(f,Q){return-1===this._options.samplers.indexOf(f)&&this._options.samplers.push(f),this._textures[f]=Q,this}removeTexture(f){delete this._textures[f]}setTextureArray(f,Q){return-1===this._options.samplers.indexOf(f)&&this._options.samplers.push(f),this._checkUniform(f),this._textureArrays[f]=Q,this}setExternalTexture(f,Q){return-1===this._options.externalTextures.indexOf(f)&&this._options.externalTextures.push(f),this._externalTextures[f]=Q,this}setFloat(f,Q){return this._checkUniform(f),this._floats[f]=Q,this}setInt(f,Q){return this._checkUniform(f),this._ints[f]=Q,this}setUInt(f,Q){return this._checkUniform(f),this._uints[f]=Q,this}setFloats(f,Q){return this._checkUniform(f),this._floatsArrays[f]=Q,this}setColor3(f,Q){return this._checkUniform(f),this._colors3[f]=Q,this}setColor3Array(f,Q){return this._checkUniform(f),this._colors3Arrays[f]=Q.reduce(((f,Q)=>(Q.toArray(f,f.length),f)),[]),this}setColor4(f,Q){return this._checkUniform(f),this._colors4[f]=Q,this}setColor4Array(f,Q){return this._checkUniform(f),this._colors4Arrays[f]=Q.reduce(((f,Q)=>(Q.toArray(f,f.length),f)),[]),this}setVector2(f,Q){return this._checkUniform(f),this._vectors2[f]=Q,this}setVector3(f,Q){return this._checkUniform(f),this._vectors3[f]=Q,this}setVector4(f,Q){return this._checkUniform(f),this._vectors4[f]=Q,this}setQuaternion(f,Q){return this._checkUniform(f),this._quaternions[f]=Q,this}setQuaternionArray(f,Q){return this._checkUniform(f),this._quaternionsArrays[f]=Q.reduce(((f,Q)=>(Q.toArray(f,f.length),f)),[]),this}setMatrix(f,Q){return this._checkUniform(f),this._matrices[f]=Q,this}setMatrices(f,Q){this._checkUniform(f);const H=new Float32Array(16*Q.length);for(let X=0;X<Q.length;X++){Q[X].copyToArray(H,16*X)}return this._matrixArrays[f]=H,this}setMatrix3x3(f,Q){return this._checkUniform(f),this._matrices3x3[f]=Q,this}setMatrix2x2(f,Q){return this._checkUniform(f),this._matrices2x2[f]=Q,this}setArray2(f,Q){return this._checkUniform(f),this._vectors2Arrays[f]=Q,this}setArray3(f,Q){return this._checkUniform(f),this._vectors3Arrays[f]=Q,this}setArray4(f,Q){return this._checkUniform(f),this._vectors4Arrays[f]=Q,this}setUniformBuffer(f,Q){return-1===this._options.uniformBuffers.indexOf(f)&&this._options.uniformBuffers.push(f),this._uniformBuffers[f]=Q,this}setTextureSampler(f,Q){return-1===this._options.samplerObjects.indexOf(f)&&this._options.samplerObjects.push(f),this._textureSamplers[f]=Q,this}setStorageBuffer(f,Q){return-1===this._options.storageBuffers.indexOf(f)&&this._options.storageBuffers.push(f),this._storageBuffers[f]=Q,this}setDefine(f,Q){const H=f.trimEnd()+" ",X=this.options.defines.findIndex((Q=>Q===f||Q.startsWith(H)));return X>=0&&this.options.defines.splice(X,1),("boolean"!==typeof Q||Q)&&this.options.defines.push(H+Q),this}isReadyForSubMesh(f,Q,H){return this.isReady(f,H,Q)}isReady(f,Q,H){var X;const i=H&&this._storeEffectOnSubMeshes;if(this.isFrozen){const f=i?H._drawWrapper:this._drawWrapper;if(f.effect&&f._wasPreviouslyReady&&f._wasPreviouslyUsingInstances===Q)return!0}const S=this.va(),x=S.getEngine(),Z=[],B=[],N=new v.c;let g=this._shaderPath,z=this._options.uniforms,Y=this._options.uniformBuffers,O=this._options.samplers;x.getCaps().multiview&&S.activeCamera&&S.activeCamera.outputRenderTarget&&S.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,Z.push("#define MULTIVIEW"),-1!==z.indexOf("viewProjection")&&-1===z.indexOf("viewProjectionR")&&z.push("viewProjectionR"));for(let K=0;K<this._options.defines.length;K++){const f=0===this._options.defines[K].indexOf("#define")?this._options.defines[K]:`#define ${this._options.defines[K]}`;Z.push(f)}for(let K=0;K<this._options.attributes.length;K++)B.push(this._options.attributes[K]);if(f&&f.isVerticesDataPresent(K.e.ColorKind)&&(-1===B.indexOf(K.e.ColorKind)&&B.push(K.e.ColorKind),Z.push("#define VERTEXCOLOR")),Q&&(Z.push("#define INSTANCES"),(0,G.jb)(B,this._materialHelperNeedsPreviousMatrices),null!==f&&void 0!==f&&f.hasThinInstances&&(Z.push("#define THIN_INSTANCES"),f&&f.isVerticesDataPresent(K.e.ColorInstanceKind)&&(B.push(K.e.ColorInstanceKind),Z.push("#define INSTANCESCOLOR")))),f&&f.useBones&&f.computeBonesUsingShaders&&f.skeleton){B.push(K.e.MatricesIndicesKind),B.push(K.e.MatricesWeightsKind),f.numBoneInfluencers>4&&(B.push(K.e.MatricesIndicesExtraKind),B.push(K.e.MatricesWeightsExtraKind));const Q=f.skeleton;Z.push("#define NUM_BONE_INFLUENCERS "+f.numBoneInfluencers),N.addCPUSkinningFallback(0,f),Q.isUsingTextureForMatrices?(Z.push("#define BONETEXTURE"),-1===z.indexOf("boneTextureWidth")&&z.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(Z.push("#define BonesPerMesh "+(Q.bones.length+1)),-1===z.indexOf("mBones")&&z.push("mBones"))}else Z.push("#define NUM_BONE_INFLUENCERS 0");let n=0;const l=f?f.morphTargetManager:null;if(l){const f=l.supportsUVs&&-1!==Z.indexOf("#define UV1"),Q=l.supportsTangents&&-1!==Z.indexOf("#define TANGENT"),H=l.supportsNormals&&-1!==Z.indexOf("#define NORMAL");n=l.numMaxInfluencers||l.numInfluencers,f&&Z.push("#define MORPHTARGETS_UV"),Q&&Z.push("#define MORPHTARGETS_TANGENT"),H&&Z.push("#define MORPHTARGETS_NORMAL"),n>0&&Z.push("#define MORPHTARGETS"),l.isUsingTextureForTargets&&(Z.push("#define MORPHTARGETS_TEXTURE"),-1===z.indexOf("morphTargetTextureIndices")&&z.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),Z.push("#define NUM_MORPH_INFLUENCERS "+n);for(let X=0;X<n;X++)B.push(K.e.PositionKind+X),H&&B.push(K.e.NormalKind+X),Q&&B.push(K.e.TangentKind+X),f&&B.push(K.e.UVKind+"_"+X);n>0&&(z=z.slice(),z.push("morphTargetInfluences"),z.push("morphTargetCount"),z.push("morphTargetTextureInfo"),z.push("morphTargetTextureIndices"))}else Z.push("#define NUM_MORPH_INFLUENCERS 0");if(f){const Q=f.bakedVertexAnimationManager;Q&&Q.isEnabled&&(Z.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===z.indexOf("bakedVertexAnimationSettings")&&z.push("bakedVertexAnimationSettings"),-1===z.indexOf("bakedVertexAnimationTextureSizeInverted")&&z.push("bakedVertexAnimationTextureSizeInverted"),-1===z.indexOf("bakedVertexAnimationTime")&&z.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,G.A)(B,f,Z)}for(const K in this._textures)if(!this._textures[K].isReady())return!1;f&&this._shouldTurnAlphaTestOn(f)&&Z.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,e.b)(z),(0,e.n)(this,S,Z)),S.fogEnabled&&null!==f&&void 0!==f&&f.applyFog&&S.fogMode!==J.e.FOGMODE_NONE&&(Z.push("#define FOG"),-1===z.indexOf("view")&&z.push("view"),-1===z.indexOf("vFogInfos")&&z.push("vFogInfos"),-1===z.indexOf("vFogColor")&&z.push("vFogColor")),this._useLogarithmicDepth&&(Z.push("#define LOGARITHMICDEPTH"),-1===z.indexOf("logarithmicDepthConstant")&&z.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(z=z.slice(),Y=Y.slice(),O=O.slice(),g=this.customShaderNameResolve(this.name,z,Y,O,Z,B));const q=i?H._getDrawWrapper(void 0,!0):this._drawWrapper,D=(null===q||void 0===q?void 0:q.effect)??null,d=(null===q||void 0===q?void 0:q.defines)??null,s=Z.join("\n");let F=D;return d!==s&&(F=x.createEffect(g,{attributes:B,uniformsNames:z,uniformBuffersNames:Y,samplers:O,defines:s,fallbacks:N,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:n},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},x),i?H.setEffect(F,s,this._materialContext):q&&q.setEffect(F,s),this._onEffectCreatedObservable&&(I.effect=F,I.subMesh=H??(null===f||void 0===f?void 0:f.ge[0])??null,this._onEffectCreatedObservable.notifyObservers(I))),q._wasPreviouslyUsingInstances=!!Q,!((null===(X=F)||void 0===X||!X.isReady())??1)&&(D!==F&&S.resetCachedMaterial(),q._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(f,Q){const H=this.va(),X=Q??this.getEffect();X&&(-1!==this._options.uniforms.indexOf("world")&&X.setMatrix("world",f),-1!==this._options.uniforms.indexOf("worldView")&&(f.multiplyToRef(H.getViewMatrix(),this._cachedWorldViewMatrix),X.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(f.multiplyToRef(H.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),X.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&X.setMatrix("view",H.getViewMatrix()))}bindForSubMesh(f,Q,H){var X;this.bind(f,Q,null===(X=H._drawWrapperOverride)||void 0===X?void 0:X.effect,H)}bind(f,Q,H,X){const i=X&&this._storeEffectOnSubMeshes,S=H??(i?X.effect:this.getEffect());if(!S)return;const x=this.va();this._activeEffect=S,this.bindOnlyWorldMatrix(f,H);const K=this._options.uniformBuffers;let Z=!1;if(S&&K&&K.length>0&&x.getEngine().supportsUniformBuffers)for(let J=0;J<K.length;++J){switch(K[J]){case"Mesh":Q&&(Q.getMeshUniformBuffer().bindToEffect(S,"Mesh"),Q.transferToEffect(f));break;case"Scene":(0,G.s)(S,x.getSceneUniformBuffer()),x.finalizeSceneUbo(),Z=!0}}const B=Q&&i?this._mustRebind(x,S,X,Q.visibility):x.getCachedMaterial()!==this;if(S&&B){let f;for(f in Z||-1===this._options.uniforms.indexOf("view")||S.setMatrix("view",x.getViewMatrix()),Z||-1===this._options.uniforms.indexOf("projection")||S.setMatrix("projection",x.getProjectionMatrix()),Z||-1===this._options.uniforms.indexOf("viewProjection")||(S.setMatrix("viewProjection",x.getTransformMatrix()),this._multiview&&S.setMatrix("viewProjectionR",x._transformMatrixR)),x.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&S.setVector3("cameraPosition",x.activeCamera.globalPosition),(0,G.e)(Q,S),(0,e.f)(S,this,x),this._useLogarithmicDepth&&(0,G.m)(i?X.materialDefines:S.defines,S,x),Q&&(0,G.h)(x,Q,S),this._textures)S.setTexture(f,this._textures[f]);for(f in this._textureArrays)S.setTextureArray(f,this._textureArrays[f]);for(f in this._ints)S.setInt(f,this._ints[f]);for(f in this._uints)S.setUInt(f,this._uints[f]);for(f in this._floats)S.setFloat(f,this._floats[f]);for(f in this._floatsArrays)S.setArray(f,this._floatsArrays[f]);for(f in this._colors3)S.setColor3(f,this._colors3[f]);for(f in this._colors3Arrays)S.setArray3(f,this._colors3Arrays[f]);for(f in this._colors4){const Q=this._colors4[f];S.setFloat4(f,Q.r,Q.g,Q.b,Q.a)}for(f in this._colors4Arrays)S.setArray4(f,this._colors4Arrays[f]);for(f in this._vectors2)S.setVector2(f,this._vectors2[f]);for(f in this._vectors3)S.setVector3(f,this._vectors3[f]);for(f in this._vectors4)S.setVector4(f,this._vectors4[f]);for(f in this._quaternions)S.setQuaternion(f,this._quaternions[f]);for(f in this._matrices)S.setMatrix(f,this._matrices[f]);for(f in this._matrixArrays)S.setMatrices(f,this._matrixArrays[f]);for(f in this._matrices3x3)S.setMatrix3x3(f,this._matrices3x3[f]);for(f in this._matrices2x2)S.setMatrix2x2(f,this._matrices2x2[f]);for(f in this._vectors2Arrays)S.setArray2(f,this._vectors2Arrays[f]);for(f in this._vectors3Arrays)S.setArray3(f,this._vectors3Arrays[f]);for(f in this._vectors4Arrays)S.setArray4(f,this._vectors4Arrays[f]);for(f in this._quaternionsArrays)S.setArray4(f,this._quaternionsArrays[f]);for(f in this._uniformBuffers){const Q=this._uniformBuffers[f].getBuffer();Q&&S.bindUniformBuffer(Q,f)}const H=x.getEngine(),K=H.setExternalTexture;if(K)for(f in this._externalTextures)K.call(H,f,this._externalTextures[f]);const B=H.setTextureSampler;if(B)for(f in this._textureSamplers)B.call(H,f,this._textureSamplers[f]);const N=H.setStorageBuffer;if(N)for(f in this._storageBuffers)N.call(H,f,this._storageBuffers[f])}if(S&&Q&&(B||!this.isFrozen)){const f=Q.morphTargetManager;f&&f.numInfluencers>0&&(0,G.p)(Q,S);const H=Q.bakedVertexAnimationManager;if(H&&H.isEnabled){var N;const f=i?X._drawWrapper:this._drawWrapper;null===(N=Q.bakedVertexAnimationManager)||void 0===N||N.bind(S,!!f._wasPreviouslyUsingInstances)}}this._afterBind(Q,S,X)}getActiveTextures(){const f=super.getActiveTextures();for(const Q in this._textures)f.push(this._textures[Q]);for(const Q in this._textureArrays){const H=this._textureArrays[Q];for(let Q=0;Q<H.length;Q++)f.push(H[Q])}return f}hasTexture(f){if(super.hasTexture(f))return!0;for(const Q in this._textures)if(this._textures[Q]===f)return!0;for(const Q in this._textureArrays){const H=this._textureArrays[Q];for(let Q=0;Q<H.length;Q++)if(H[Q]===f)return!0}return!1}clone(f){const Q=N.b.Clone((()=>new l(f,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);Q.name=f,Q.id=f,"object"===typeof Q._shaderPath&&(Q._shaderPath={...Q._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((f=>{const Q=this._options[f];Array.isArray(Q)&&(this._options[f]=Q.slice(0))})),this.stencil.copyTo(Q.stencil);for(const H in this._textures)Q.setTexture(H,this._textures[H]);for(const H in this._textureArrays)Q.setTextureArray(H,this._textureArrays[H]);for(const H in this._externalTextures)Q.setExternalTexture(H,this._externalTextures[H]);for(const H in this._ints)Q.setInt(H,this._ints[H]);for(const H in this._uints)Q.setUInt(H,this._uints[H]);for(const H in this._floats)Q.setFloat(H,this._floats[H]);for(const H in this._floatsArrays)Q.setFloats(H,this._floatsArrays[H]);for(const H in this._colors3)Q.setColor3(H,this._colors3[H]);for(const H in this._colors3Arrays)Q._colors3Arrays[H]=this._colors3Arrays[H];for(const H in this._colors4)Q.setColor4(H,this._colors4[H]);for(const H in this._colors4Arrays)Q._colors4Arrays[H]=this._colors4Arrays[H];for(const H in this._vectors2)Q.setVector2(H,this._vectors2[H]);for(const H in this._vectors3)Q.setVector3(H,this._vectors3[H]);for(const H in this._vectors4)Q.setVector4(H,this._vectors4[H]);for(const H in this._quaternions)Q.setQuaternion(H,this._quaternions[H]);for(const H in this._quaternionsArrays)Q._quaternionsArrays[H]=this._quaternionsArrays[H];for(const H in this._matrices)Q.setMatrix(H,this._matrices[H]);for(const H in this._matrixArrays)Q._matrixArrays[H]=this._matrixArrays[H].slice();for(const H in this._matrices3x3)Q.setMatrix3x3(H,this._matrices3x3[H]);for(const H in this._matrices2x2)Q.setMatrix2x2(H,this._matrices2x2[H]);for(const H in this._vectors2Arrays)Q.setArray2(H,this._vectors2Arrays[H]);for(const H in this._vectors3Arrays)Q.setArray3(H,this._vectors3Arrays[H]);for(const H in this._vectors4Arrays)Q.setArray4(H,this._vectors4Arrays[H]);for(const H in this._uniformBuffers)Q.setUniformBuffer(H,this._uniformBuffers[H]);for(const H in this._textureSamplers)Q.setTextureSampler(H,this._textureSamplers[H]);for(const H in this._storageBuffers)Q.setStorageBuffer(H,this._storageBuffers[H]);return Q}dispose(f,Q,H){if(Q){let f;for(f in this._textures)this._textures[f].dispose();for(f in this._textureArrays){const Q=this._textureArrays[f];for(let f=0;f<Q.length;f++)Q[f].dispose()}}this._textures={},super.dispose(f,Q,H)}serialize(){const f=N.b.Serialize(this);let Q;for(Q in f.customType="BABYLON.ShaderMaterial",f.uniqueId=this.uniqueId,f.options=this._options,f.shaderPath=this._shaderPath,f.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,f.stencil=this.stencil.serialize(),f.textures={},this._textures)f.textures[Q]=this._textures[Q].serialize();for(Q in f.textureArrays={},this._textureArrays){f.textureArrays[Q]=[];const H=this._textureArrays[Q];for(let X=0;X<H.length;X++)f.textureArrays[Q].push(H[X].serialize())}for(Q in f.ints={},this._ints)f.ints[Q]=this._ints[Q];for(Q in f.uints={},this._uints)f.uints[Q]=this._uints[Q];for(Q in f.floats={},this._floats)f.floats[Q]=this._floats[Q];for(Q in f.floatsArrays={},this._floatsArrays)f.floatsArrays[Q]=this._floatsArrays[Q];for(Q in f.colors3={},this._colors3)f.colors3[Q]=this._colors3[Q].ke();for(Q in f.colors3Arrays={},this._colors3Arrays)f.colors3Arrays[Q]=this._colors3Arrays[Q];for(Q in f.colors4={},this._colors4)f.colors4[Q]=this._colors4[Q].ke();for(Q in f.colors4Arrays={},this._colors4Arrays)f.colors4Arrays[Q]=this._colors4Arrays[Q];for(Q in f.vectors2={},this._vectors2)f.vectors2[Q]=this._vectors2[Q].ke();for(Q in f.vectors3={},this._vectors3)f.vectors3[Q]=this._vectors3[Q].ke();for(Q in f.vectors4={},this._vectors4)f.vectors4[Q]=this._vectors4[Q].ke();for(Q in f.quaternions={},this._quaternions)f.quaternions[Q]=this._quaternions[Q].ke();for(Q in f.matrices={},this._matrices)f.matrices[Q]=this._matrices[Q].ke();for(Q in f.matrixArray={},this._matrixArrays)f.matrixArray[Q]=this._matrixArrays[Q];for(Q in f.matrices3x3={},this._matrices3x3)f.matrices3x3[Q]=this._matrices3x3[Q];for(Q in f.matrices2x2={},this._matrices2x2)f.matrices2x2[Q]=this._matrices2x2[Q];for(Q in f.vectors2Arrays={},this._vectors2Arrays)f.vectors2Arrays[Q]=this._vectors2Arrays[Q];for(Q in f.vectors3Arrays={},this._vectors3Arrays)f.vectors3Arrays[Q]=this._vectors3Arrays[Q];for(Q in f.vectors4Arrays={},this._vectors4Arrays)f.vectors4Arrays[Q]=this._vectors4Arrays[Q];for(Q in f.quaternionsArrays={},this._quaternionsArrays)f.quaternionsArrays[Q]=this._quaternionsArrays[Q];return f}static Parse(f,Q,H){const i=N.b.Parse((()=>new l(f.name,Q,f.shaderPath,f.options,f.storeEffectOnSubMeshes)),f,Q,H);let S;for(S in f.stencil&&i.stencil.parse(f.stencil,Q,H),f.textures)i.setTexture(S,g.b.Parse(f.textures[S],Q,H));for(S in f.textureArrays){const X=f.textureArrays[S],x=[];for(let f=0;f<X.length;f++)x.push(g.b.Parse(X[f],Q,H));i.setTextureArray(S,x)}for(S in f.ints)i.setInt(S,f.ints[S]);for(S in f.uints)i.setUInt(S,f.uints[S]);for(S in f.floats)i.setFloat(S,f.floats[S]);for(S in f.floatsArrays)i.setFloats(S,f.floatsArrays[S]);for(S in f.colors3)i.setColor3(S,x.e.Zd(f.colors3[S]));for(S in f.colors3Arrays){const Q=f.colors3Arrays[S].reduce(((f,Q,H)=>(H%3===0?f.push([Q]):f[f.length-1].push(Q),f)),[]).map((f=>x.e.Zd(f)));i.setColor3Array(S,Q)}for(S in f.colors4)i.setColor4(S,x.h.Zd(f.colors4[S]));for(S in f.colors4Arrays){const Q=f.colors4Arrays[S].reduce(((f,Q,H)=>(H%4===0?f.push([Q]):f[f.length-1].push(Q),f)),[]).map((f=>x.h.Zd(f)));i.setColor4Array(S,Q)}for(S in f.vectors2)i.setVector2(S,X.m.Zd(f.vectors2[S]));for(S in f.vectors3)i.setVector3(S,X.p.Zd(f.vectors3[S]));for(S in f.vectors4)i.setVector4(S,X.s.Zd(f.vectors4[S]));for(S in f.quaternions)i.setQuaternion(S,X.i.Zd(f.quaternions[S]));for(S in f.matrices)i.setMatrix(S,X.e.Zd(f.matrices[S]));for(S in f.matrixArray)i._matrixArrays[S]=new Float32Array(f.matrixArray[S]);for(S in f.matrices3x3)i.setMatrix3x3(S,f.matrices3x3[S]);for(S in f.matrices2x2)i.setMatrix2x2(S,f.matrices2x2[S]);for(S in f.vectors2Arrays)i.setArray2(S,f.vectors2Arrays[S]);for(S in f.vectors3Arrays)i.setArray3(S,f.vectors3Arrays[S]);for(S in f.vectors4Arrays)i.setArray4(S,f.vectors4Arrays[S]);for(S in f.quaternionsArrays)i.setArray4(S,f.quaternionsArrays[S]);return i}static ParseFromFileAsync(f,Q,H){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((i,S)=>{const x=new Y.d;x.addEventListener("readystatechange",(()=>{if(4==x.readyState)if(200==x.status){const Q=JSON.parse(x.responseText),S=this.Parse(Q,H||n.e.LastCreatedScene,X);f&&(S.name=f),i(S)}else S("Unable to load the ShaderMaterial")})),x.open("GET",Q),x.send()}))}static ParseFromSnippetAsync(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((X,i)=>{const S=new Y.d;S.addEventListener("readystatechange",(()=>{if(4==S.readyState)if(200==S.status){const i=JSON.parse(JSON.parse(S.responseText).jsonPayload),x=JSON.parse(i.shaderMaterial),K=this.Parse(x,Q||n.e.LastCreatedScene,H);K.snippetId=f,X(K)}else i("Unable to load the snippet "+f)})),S.open("GET",this.SnippetUrl+"/"+f.replace(/#/g,"/")),S.send()}))}}l.SnippetUrl="https://snippet.babylonjs.com",l.CreateFromSnippetAsync=l.ParseFromSnippetAsync,(0,z.h)("BABYLON.ShaderMaterial",l),i.b._LinesMeshParser=(f,Q)=>q.Parse(f,Q);class q extends i.b{_isShaderMaterial(f){return"ShaderMaterial"===f.getClassName()}constructor(f){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,S=arguments.length>7?arguments[7]:void 0;super(f,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q,arguments.length>4?arguments[4]:void 0),this.useVertexColor=X,this.useVertexAlpha=i,this.color=new x.e(1,1,1),this.alpha=1,this._shaderLanguage=0,Q&&(this.color=Q.color.clone(),this.alpha=Q.alpha,this.useVertexColor=Q.useVertexColor,this.useVertexAlpha=Q.useVertexAlpha),this.intersectionThreshold=.1;const Z={attributes:[K.e.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===i?Z.needAlphaBlending=!1:Z.defines.push("#define VERTEXALPHA"),X?(Z.defines.push("#define VERTEXCOLOR"),Z.attributes.push(K.e.ColorKind)):(Z.uniforms.push("color"),this._color4=new x.h),S)this.material=S;else{this.va().getEngine().isWebGPU&&!q.ForceGLSL&&(this._shaderLanguage=1),Z.shaderLanguage=this._shaderLanguage,Z.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([H.e(19).then(H.bind(H,12593)),H.e(48).then(H.bind(H,12595))]):await Promise.all([H.e(26).then(H.bind(H,12598)),H.e(49).then(H.bind(H,12607))])},this.material=new l("colorShader",this.va(),"color",Z,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(f){this._lineMaterial=f,this._lineMaterial.fillMode=B.e.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(f){}_bind(f,Q){if(!this._geometry)return this;const H=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(Q,H):this._geometry._bind(Q,H,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:f,g:Q,b:H}=this.color;this._color4.set(f,Q,H,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(f,Q,H){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const X=this.va().getEngine();return this._unIndexed?X.drawArraysType(B.e.LineListDrawMode,f.verticesStart,f.verticesCount,H):X.drawElementsType(B.e.LineListDrawMode,f.indexStart,f.indexCount,H),this}dispose(f){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(f)}clone(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0;return new q(f,this.va(),Q,this,H)}yd(f){const Q=new D(f,this);if(this.instancedBuffers){Q.instancedBuffers={};for(const f in this.instancedBuffers)Q.instancedBuffers[f]=this.instancedBuffers[f]}return Q}serialize(f){super.serialize(f),f.color=this.color.ke(),f.alpha=this.alpha}static Parse(f,Q){const H=new q(f.name,Q);return H.color=x.e.Zd(f.color),H.alpha=f.alpha,H}}q.ForceGLSL=!1;class D extends Z.e{constructor(f,Q){super(f,Q),this.intersectionThreshold=Q.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var d=H(1092);function s(f){const Q=[],H=[],X=f.lines,i=f.za,x=[];let K=0;for(let S=0;S<X.length;S++){const f=X[S];for(let X=0;X<f.length;X++){const{x:Z,y:B,z:N}=f[X];if(H.push(Z,B,N),i){const f=i[S],{r:Q,g:H,b:K,a:Z}=f[X];x.push(Q,H,K,Z)}X>0&&(Q.push(K-1),Q.push(K)),K++}}const Z=new S.b;return Z.indices=Q,Z.xa=H,i&&(Z.za=x),Z}function F(f){const Q=f.dashSize||3,H=f.gapSize||1,i=f.dashNb||200,x=f.points,K=[],Z=[],B=X.p.Zero();let N=0,J=0,g=0,z=0,v=0,Y=0,O=0;for(O=0;O<x.length-1;O++)x[O+1].subtractToRef(x[O],B),N+=B.length();for(g=N/i,z=Q*g/(Q+H),O=0;O<x.length-1;O++){x[O+1].subtractToRef(x[O],B),J=Math.floor(B.length()/g),B.normalize();for(let f=0;f<J;f++)v=g*f,K.push(x[O].x+v*B.x,x[O].y+v*B.y,x[O].z+v*B.z),K.push(x[O].x+(v+z)*B.x,x[O].y+(v+z)*B.y,x[O].z+(v+z)*B.z),Z.push(Y,Y+1),Y+=2}const n=new S.b;return n.xa=K,n.indices=Z,n}function P(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=Q.instance,i=Q.lines,S=Q.za;if(X){const f=X.getVerticesData(K.e.PositionKind);let Q,H;S&&(Q=X.getVerticesData(K.e.ColorKind));let x=0,Z=0;for(let X=0;X<i.length;X++){const K=i[X];for(let i=0;i<K.length;i++)f[x]=K[i].x,f[x+1]=K[i].y,f[x+2]=K[i].z,S&&Q&&(H=S[X],Q[Z]=H[i].r,Q[Z+1]=H[i].g,Q[Z+2]=H[i].b,Q[Z+3]=H[i].a,Z+=4),x+=3}return X.updateVerticesData(K.e.PositionKind,f,!1,!1),S&&Q&&X.updateVerticesData(K.e.ColorKind,Q,!1,!1),X.refreshBoundingInfo(),X}const x=new q(f,H,null,void 0,void 0,!!S,Q.useVertexAlpha,Q.material);return s(Q).Ca(x,Q.updatable),x}function m(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=Q.za?[Q.za]:null;return P(f,{lines:[Q.points],updatable:Q.updatable,instance:Q.instance,za:X,useVertexAlpha:Q.useVertexAlpha,material:Q.material},H)}function c(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=Q.points,x=Q.instance,K=Q.gapSize||1,Z=Q.dashSize||3;if(x){const f=f=>{const Q=X.p.Zero(),H=f.length/6;let i=0,K=0,Z=0,B=0,N=0,J=0,g=0,z=0;for(g=0;g<S.length-1;g++)S[g+1].subtractToRef(S[g],Q),i+=Q.length();Z=i/H;const v=x._creationDataStorage.dashSize;for(B=v*Z/(v+x._creationDataStorage.gapSize),g=0;g<S.length-1;g++)for(S[g+1].subtractToRef(S[g],Q),K=Math.floor(Q.length()/Z),Q.normalize(),z=0;z<K&&J<f.length;)N=Z*z,f[J]=S[g].x+N*Q.x,f[J+1]=S[g].y+N*Q.y,f[J+2]=S[g].z+N*Q.z,f[J+3]=S[g].x+(N+B)*Q.x,f[J+4]=S[g].y+(N+B)*Q.y,f[J+5]=S[g].z+(N+B)*Q.z,J+=6,z++;for(;J<f.length;)f[J]=S[g].x,f[J+1]=S[g].y,f[J+2]=S[g].z,J+=3};return(Q.dashNb||Q.dashSize||Q.gapSize||Q.useVertexAlpha||Q.material)&&d.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),x.updateMeshPositions(f,!1),x}const B=new q(f,H,null,void 0,void 0,void 0,Q.useVertexAlpha,Q.material);return F(Q).Ca(B,Q.updatable),B._creationDataStorage=new i.d,B._creationDataStorage.dashSize=Z,B._creationDataStorage.gapSize=K,B}S.b.CreateLineSystem=s,S.b.CreateDashedLines=F,i.b.ob=function(f,Q){return m(f,{points:Q,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},i.b.CreateDashedLines=function(f,Q,H,X,i){return c(f,{points:Q,dashSize:H,gapSize:X,dashNb:i,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11402:(f,Q,H)=>{"use strict";H.d(Q,{c:()=>K,d:()=>Z});var X=H(11301),i=H(11322),S=H(1183);function x(f){const Q=[],H=[],X=[],x=[],K=f.width||f.size||1,Z=f.height||f.size||1,B=0===f.sideOrientation?0:f.sideOrientation||i.b.DEFAULTSIDE,N=K/2,J=Z/2;H.push(-N,-J,0),X.push(0,0,-1),x.push(0,S.e?1:0),H.push(N,-J,0),X.push(0,0,-1),x.push(1,S.e?1:0),H.push(N,J,0),X.push(0,0,-1),x.push(1,S.e?0:1),H.push(-N,J,0),X.push(0,0,-1),x.push(0,S.e?0:1),Q.push(0),Q.push(1),Q.push(2),Q.push(0),Q.push(2),Q.push(3),i.b._ComputeSides(B,H,Q,X,x,f.frontUVs,f.backUVs);const g=new i.b;return g.indices=Q,g.xa=H,g.ya=X,g.Aa=x,g}function K(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new X.b(f,H);Q.sideOrientation=X.b._GetDefaultSideOrientation(Q.sideOrientation),i._originalBuilderSideOrientation=Q.sideOrientation;return x(Q).Ca(i,Q.updatable),Q.sourcePlane&&(i.translate(Q.sourcePlane.se,-Q.sourcePlane.d),i.setDirection(Q.sourcePlane.se.scale(-1))),i}const Z={Eg:K};i.b.Eg=x,X.b.Eg=(f,Q,H,X,i)=>K(f,{size:Q,width:Q,height:Q,sideOrientation:i,updatable:X},H)},11445:(f,Q,H)=>{"use strict";H.d(Q,{d:()=>Z});var X=H(1003),i=H(11301),S=H(11322),x=H(1183);function K(f){const Q=0|(f.segments||32),H=f.diameterX||f.diameter||1,i=f.diameterY||f.diameter||1,K=f.diameterZ||f.diameter||1,Z=f.arc&&(f.arc<=0||f.arc>1)?1:f.arc||1,B=f.slice&&f.slice<=0?1:f.slice||1,N=0===f.sideOrientation?0:f.sideOrientation||S.b.DEFAULTSIDE,J=!!f.dedupTopBottomIndices,g=new X.p(H/2,i/2,K/2),z=2+Q,v=2*z,Y=[],O=[],n=[],e=[];for(let S=0;S<=z;S++){const f=S/z,Q=f*Math.PI*B;for(let H=0;H<=v;H++){const i=H/v,S=i*Math.PI*2*Z,K=X.e.RotationZ(-Q),B=X.e.RotationY(S),N=X.p.TransformCoordinates(X.p.Up(),K),J=X.p.TransformCoordinates(N,B),z=J.multiply(g),Y=J.divide(g).normalize();O.push(z.x,z.y,z.z),n.push(Y.x,Y.y,Y.z),e.push(i,x.e?1-f:f)}if(S>0){const f=O.length/3;for(let Q=f-2*(v+1);Q+v+2<f;Q++)J?(S>1&&(Y.push(Q),Y.push(Q+1),Y.push(Q+v+1)),(S<z||B<1)&&(Y.push(Q+v+1),Y.push(Q+1),Y.push(Q+v+2))):(Y.push(Q),Y.push(Q+1),Y.push(Q+v+1),Y.push(Q+v+1),Y.push(Q+1),Y.push(Q+v+2))}}S.b._ComputeSides(N,O,Y,n,e,f.frontUVs,f.backUVs);const G=new S.b;return G.indices=Y,G.xa=O,G.ya=n,G.Aa=e,G}function Z(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new i.b(f,H);Q.sideOrientation=i.b._GetDefaultSideOrientation(Q.sideOrientation),X._originalBuilderSideOrientation=Q.sideOrientation;return K(Q).Ca(X,Q.updatable),X}S.b.CreateSphere=K,i.b.CreateSphere=(f,Q,H,X,i,S)=>Z(f,{segments:Q,diameterX:H,diameterY:H,diameterZ:H,sideOrientation:S,updatable:i},X)},11953:(f,Q,H)=>{"use strict";H.d(Q,{d:()=>J});var X=H(1203),i=H(10279),S=H(11327),x=H(1253),K=H(11322),Z=H(1092);function B(f,Q,H,X,i){let S=null,x=null,K=null;try{let Z;S=new f.Decoder,x=new f.DecoderBuffer,x.Init(Q,Q.byteLength);const B=S.GetEncodedGeometryType(x);switch(B){case f.TRIANGULAR_MESH:{const Q=new f.Mesh;if(Z=S.DecodeBufferToMesh(x,Q),!Z.ok()||0===Q.ptr)throw new Error(Z.error_msg());const H=3*Q.num_faces(),i=4*H,B=f._malloc(i);try{S.GetTrianglesUInt32Array(Q,i,B);const x=new Uint32Array(H);x.set(new Uint32Array(f.HEAPF32.buffer,B,H)),X(x)}finally{f._free(B)}K=Q;break}case f.POINT_CLOUD:{const Q=new f.PointCloud;if(Z=S.DecodeBufferToPointCloud(x,Q),!Z.ok()||!Q.ptr)throw new Error(Z.error_msg());K=Q;break}default:throw new Error(`Invalid geometry type ${B}`)}const N=K.num_points(),J=(Q,H,X,S)=>{const x=S.data_type(),K=S.num_components(),Z=S.normalized(),B=S.byte_stride(),J=S.byte_offset(),g={[f.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:f.HEAPF32},[f.DT_INT8]:{typedArrayConstructor:Int8Array,heap:f.HEAP8},[f.DT_INT16]:{typedArrayConstructor:Int16Array,heap:f.HEAP16},[f.DT_INT32]:{typedArrayConstructor:Int32Array,heap:f.HEAP32},[f.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:f.HEAPU8},[f.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:f.HEAPU16},[f.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:f.HEAPU32}}[x];if(!g)throw new Error(`Invalid data type ${x}`);const z=N*K,v=z*g.typedArrayConstructor.BYTES_PER_ELEMENT,Y=f._malloc(v);try{Q.GetAttributeDataArrayForAllPoints(H,S,x,v,Y);const f=new g.typedArrayConstructor(g.heap.buffer,Y,z);i(X,f.slice(),K,J,B,Z)}finally{f._free(Y)}};if(H)for(const f in H){const Q=H[f],X=S.GetAttributeByUniqueId(K,Q);J(S,K,f,X)}else{const Q={position:f.POSITION,se:f.NORMAL,color:f.COLOR,uv:f.TEX_COORD};for(const f in Q){const H=S.GetAttributeId(K,Q[f]);if(-1!==H){const Q=S.GetAttribute(K,H);J(S,K,f,Q)}}}return N}finally{K&&f.destroy(K),x&&f.destroy(x),S&&f.destroy(S)}}function N(){let f;onmessage=Q=>{const H=Q.data;switch(H.id){case"init":{const Q=H.decoder;Q.url&&importScripts(Q.url);const X=Q.wasmBinary?{wasmBinary:Q.wasmBinary}:{};f=DracoDecoderModule(X),postMessage({id:"initDone"});break}case"decodeMesh":if(!f)throw new Error("Draco decoder module is not available");f.then((f=>{const Q=B(f,H.dataView,H.attributes,(f=>{postMessage({id:"indices",data:f},[f.buffer])}),((f,Q,H,X,i,S)=>{postMessage({id:"attribute",kind:f,data:Q,size:H,byteOffset:X,byteStride:i,normalized:S},[Q.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:Q})}))}}}class J{static get DecoderAvailable(){const f=J.Configuration.decoder;return!!(f.wasmUrl&&f.wasmBinaryUrl&&"object"===typeof WebAssembly||f.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return J._Default||(J._Default=new J),J._Default}static ResetDefault(f){J._Default&&(f||J._Default.dispose(),J._Default=null)}constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.DefaultNumWorkers;const Q=J.Configuration.decoder;if(Q.workerPool||"object"===typeof f&&f.workerPool)this._workerPoolPromise=Promise.resolve(Q.workerPool||f.workerPool);else{const H=Q.wasmBinary||"object"===typeof f&&f.wasmBinary,S="number"===typeof f?f:f.numWorkers,x=S&&"function"===typeof Worker&&"function"===typeof URL,K=x||!x&&!Q.jsModule,Z=Q.wasmUrl&&Q.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:K?X.g.GetBabylonScriptURL(Q.wasmUrl,!0):"",wasmBinaryPromise:H?Promise.resolve(H):X.g.LoadFileAsync(X.g.GetBabylonScriptURL(Q.wasmBinaryUrl,!0))}:{url:K?X.g.GetBabylonScriptURL(Q.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};x?this._workerPoolPromise=Z.wasmBinaryPromise.then((f=>{const Q=`${B}(${N})()`,H=URL.createObjectURL(new Blob([Q],{type:"application/javascript"}));return new i.e(S,(()=>function(f,Q,H){return new Promise(((X,i)=>{const S=Q=>{f.removeEventListener("error",S),f.removeEventListener("message",x),i(Q)},x=Q=>{"initDone"===Q.data.id&&(f.removeEventListener("error",S),f.removeEventListener("message",x),X(f))};if(f.addEventListener("error",S),f.addEventListener("message",x),Q){const X=Q.slice(0);f.postMessage({id:"init",decoder:{url:H,wasmBinary:X}},[X])}else f.postMessage({id:"init",decoder:{url:H}})}))}(new Worker(H),f,Z.url)))})):this._decoderModulePromise=Z.wasmBinaryPromise.then((async f=>{if("undefined"===typeof DracoDecoderModule&&!Q.jsModule){if(!Z.url)throw new Error("Draco decoder module is not available");await X.g.LoadBabylonScriptAsync(Z.url)}return await(H=f,i=Q.jsModule,new Promise((f=>{(i||DracoDecoderModule)({wasmBinary:H}).then((Q=>{f({module:Q})}))})));var H,i}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((f=>{f.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(f,Q,H){const X=f instanceof ArrayBuffer?new Int8Array(f):new Int8Array(f.buffer,f.byteOffset,f.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((f=>new Promise(((i,S)=>{f.push(((f,x)=>{let K=null;const B=[],N=Q=>{f.removeEventListener("error",N),f.removeEventListener("message",J),S(Q),x()},J=Q=>{const X=Q.data;switch(X.id){case"decodeMeshDone":f.removeEventListener("error",N),f.removeEventListener("message",J),i({indices:K,attributes:B,totalVertices:X.totalVertices}),x();break;case"indices":K=X.data;break;case"attribute":B.push({kind:X.kind,data:X.data,size:X.size,byteOffset:X.byteOffset,byteStride:X.byteStride,normalized:(S=X.kind,g=X.normalized,H&&void 0!==H[S]?(g!==H[S]&&Z.b.Warn(`Normalized flag from Draco data (${g}) does not match normalized flag from glTF accessor (${H[S]}). Using flag from glTF accessor.`),H[S]):g)})}var S,g};f.addEventListener("error",N),f.addEventListener("message",J);const g=X.slice();f.postMessage({id:"decodeMesh",dataView:g,attributes:Q},[g.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((f=>{let H=null;const i=[],S=B(f.module,X,Q,(f=>{H=f}),((f,Q,H,X,S,x)=>{i.push({kind:f,data:Q,size:H,byteOffset:X,byteStride:S,normalized:x})}));return{indices:H,attributes:i,totalVertices:S}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(f,Q,H,X){const i=await this.decodeMeshToMeshDataAsync(H,X),K=new S.b(f,Q);i.indices&&K.setIndices(i.indices);for(const S of i.attributes)K.setVerticesBuffer(new x.e(Q.getEngine(),S.data,S.kind,!1,void 0,S.byteStride,void 0,S.byteOffset,S.size,void 0,S.normalized,!0),i.totalVertices);return K}async _decodeMeshToGeometryForGltfAsync(f,Q,H,X,i){const K=await this.decodeMeshToMeshDataAsync(H,X,i),Z=new S.b(f,Q);K.indices&&Z.setIndices(K.indices);for(const S of K.attributes)Z.setVerticesBuffer(new x.e(Q.getEngine(),S.data,S.kind,!1,void 0,S.byteStride,void 0,S.byteOffset,S.size,void 0,S.normalized,!0),K.totalVertices);return Z}async decodeMeshAsync(f,Q){const H=await this.decodeMeshToMeshDataAsync(f,Q),X=new K.b;H.indices&&(X.indices=H.indices);for(const i of H.attributes){const f=x.e.GetFloatData(i.data,i.size,x.e.GetDataType(i.data),i.byteOffset,i.byteStride,i.normalized,H.totalVertices);X.set(f,i.kind)}return X}}J.Configuration={decoder:{wasmUrl:`${X.g._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${X.g._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${X.g._DefaultCdnUrl}/draco_decoder_gltf.js`}},J.DefaultNumWorkers=J.GetDefaultNumWorkers(),J._Default=null},11337:(f,Q,H)=>{"use strict";H.d(Q,{c:()=>D});var X=H(978),i=H(994),S=H(1003),x=H(1253),K=H(11322),Z=H(11345),B=H(1246),N=H(1362),J=H(1238);class g{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new S.p(0,0,0),this._diffPositionForCollisions=new S.p(0,0,0),this._collisionResponse=!0}}var z=H(1082),v=H(1379),Y=H(1161),O=H(1011),n=H(1495),e=H(1022),G=H(982),I=H(1102);class l{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=S.p.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class q{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new l,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new g,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class D extends Z.d{static get BILLBOARDMODE_NONE(){return Z.d.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return Z.d.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return Z.d.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return Z.d.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return Z.d.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return Z.d.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(f){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=f}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(f){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=f}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(f){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=f}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(f){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=f}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(f){this._internalAbstractMeshDataInfo._collisionRetryCount=f}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(f){this._internalAbstractMeshDataInfo._morphTargetManager!==f&&(this._internalAbstractMeshDataInfo._morphTargetManager=f,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(f){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==f&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=f,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(f){return!!super._updateNonUniformScalingState(f)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(f){this._internalAbstractMeshDataInfo._rawBoundingInfo=f}set Rk(f){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(f)}set onCollisionPositionChange(f){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(f)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(f){if(this._internalAbstractMeshDataInfo._visibility===f)return;const Q=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=f,(1===Q&&1!==f||1!==Q&&1===f)&&this._markSubMeshesAsDirty((f=>{f.markAsMiscDirty(),f.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(f){this._internalAbstractMeshDataInfo._inheritVisibility=f}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let f=this._parentNode;for(;f;){const Q=f.isVisible;if("undefined"!==typeof Q)return Q;f=f.parent}}return this._isVisible}set isVisible(f){this._isVisible=f}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(f){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=f}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(f){this._internalAbstractMeshDataInfo._renderingGroupId=f}get material(){return this._internalAbstractMeshDataInfo._material}set material(f){this._setMaterial(f)}_setMaterial(f){this._internalAbstractMeshDataInfo._material!==f&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=f,f&&f.meshMap&&(f.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.ge&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(f){var Q;return null===(Q=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===Q?void 0:Q[f]}setMaterialForRenderPass(f,Q){this.resetDrawCache(f),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[f]=Q}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(f){this._internalAbstractMeshDataInfo._receiveShadows!==f&&(this._internalAbstractMeshDataInfo._receiveShadows=f,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(f){this._internalAbstractMeshDataInfo._hasVertexAlpha!==f&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=f,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(f){this._internalAbstractMeshDataInfo._useVertexColors!==f&&(this._internalAbstractMeshDataInfo._useVertexColors=f,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(f){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==f&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=f,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(f){this._internalAbstractMeshDataInfo._numBoneInfluencers!==f&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=f,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(f){this._internalAbstractMeshDataInfo._applyFog!==f&&(this._internalAbstractMeshDataInfo._applyFog=f,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(f){this._internalAbstractMeshDataInfo._enableDistantPicking=f}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(f){f!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=f,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(f){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(f)?-1:f}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(f){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=f}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(f){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(f)?-1:f}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(f){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=f}get lightSources(){return this._lightSources}set skeleton(f){const Q=this._internalAbstractMeshDataInfo._skeleton;Q&&Q.needInitialSkinMatrix&&Q._unregisterMeshWithPoseMatrix(this),f&&f.needInitialSkinMatrix&&f._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=f,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(f){var Q;let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(f,H,!1),Q=this,this._internalAbstractMeshDataInfo=new q,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Ke=D.$i,this.onCollideObservable=new i.e,this.onCollisionPositionChangeObservable=new i.e,this.onMaterialChangedObservable=new i.e,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Te=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=Y.e.Red(),this.outlineWidth=.02,this.overlayColor=Y.e.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.ef=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new S.p(.5,1,.5),this.ellipsoidOffset=new S.p(0,0,0),this.edgesWidth=1,this.edgesColor=new Y.h(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,hi:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new i.e,this._onCollisionPositionChange=function(f,H){let X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;H.subtractToRef(Q._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,Q._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),Q._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>I.b.CollisionsEpsilon&&Q.position.addInPlace(Q._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),X&&Q.onCollideObservable.notifyObservers(X),Q.onCollisionPositionChangeObservable.notifyObservers(Q.position)},H=this.va(),H.bf(this),this._resyncLightSources(),this._uniformBuffer=new J.b(this.va().getEngine(),void 0,void 0,f,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),H.performancePriority){case 2:this.Da=!0;case 1:this.ef=!0,this.Te=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(f){const Q=this._uniformBuffer;Q.Be("world",f),Q.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),Q.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(f){let Q="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");Q+=", # of submeshes: "+(this.ge?this.ge.length:0);const H=this._internalAbstractMeshDataInfo._skeleton;return H&&(Q+=", skeleton: "+H.name),f&&(Q+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],Q+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.hi?"YES":"NO")),Q}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==Z.d.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(Q||this.actionManager.isRecursive)){if(!f)return this.actionManager;if(this.actionManager.hasSpecificTrigger(f))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(f,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.ge){for(const f of this.ge)f._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const f of this.va().lights)f.isEnabled()&&f.canAffectMesh(this)&&this._lightSources.push(f);this._markSubMeshesAsLightDirty()}_resyncLightSource(f){const Q=f.isEnabled()&&f.canAffectMesh(this),H=this._lightSources.indexOf(f);let X=!1;if(-1===H){if(!Q)return;this._lightSources.push(f)}else{if(Q)return;X=!0,this._lightSources.splice(H,1)}this._markSubMeshesAsLightDirty(X)}_unBindEffect(){for(const f of this.ge)f.setEffect(null)}_removeLightSource(f,Q){const H=this._lightSources.indexOf(f);-1!==H&&(this._lightSources.splice(H,1),this._markSubMeshesAsLightDirty(Q))}_markSubMeshesAsDirty(f){if(this.ge)for(const Q of this.ge)for(let H=0;H<Q._drawWrappers.length;++H){const X=Q._drawWrappers[H];X&&X.defines&&X.defines.markAllAsDirty&&f(X.defines)}}_markSubMeshesAsLightDirty(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((Q=>Q.markAsLightDirty(f)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((f=>f.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((f=>f.markAsMiscDirty()))}ve(f){return this._currentRenderId=Number.MAX_VALUE,super.ve(f),this._isDirty=!0,this}resetDrawCache(f){if(this.ge)for(const Q of this.ge)Q.resetDrawCache(f)}get isBlocked(){return!1}getLOD(f){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Ud(){return null}getVerticesData(f){return null}Ga(f,Q,H,X){return this}updateVerticesData(f,Q,H,X){return this}setIndices(f,Q){return this}isVerticesDataPresent(f){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(f){return this._boundingInfo=f,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(f,Q,H){return this._boundingInfo=new N.d(f,Q,H),this._boundingInfo}normalizeToUnitCube(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(f,Q,H)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(x.e.MatricesIndicesKind)&&this.isVerticesDataPresent(x.e.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(f){}_activate(f,Q){return this._renderId=f,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===Z.d.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(f,Q,H){return this.position.addInPlace(this.calcMovePOV(f,Q,H)),this}calcMovePOV(f,Q,H){const X=new S.e;(this.rotationQuaternion?this.rotationQuaternion:S.i.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(X);const i=S.p.Zero(),x=this.definedFacingForward?-1:1;return S.p.TransformCoordinatesFromFloatsToRef(f*x,Q,H*x,X,i),i}rotatePOV(f,Q,H){return this.rotation.addInPlace(this.calcRotatePOV(f,Q,H)),this}calcRotatePOV(f,Q,H){const X=this.definedFacingForward?1:-1;return new S.p(f*X,Q,H*X)}Fa(f,Q){if(f){const H=(0,v.e)(f,0,this.getTotalVertices(),Q);this._boundingInfo?this._boundingInfo.reConstruct(H.minimum,H.maximum):this._boundingInfo=new N.d(H.minimum,H.maximum)}if(this.ge)for(let H=0;H<this.ge.length;H++)this.ge[H].refreshBoundingInfo(f);this.Ea()}_refreshBoundingInfoDirect(f){if(this._boundingInfo?this._boundingInfo.reConstruct(f.minimum,f.maximum):this._boundingInfo=new N.d(f.minimum,f.maximum),this.ge)for(let Q=0;Q<this.ge.length;Q++)this.ge[Q].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(f,Q,H,X,i,K,Z){!function(f,Q,H,X,i,K,Z){const B=S.l.Wd[0],N=S.l.Matrix[0],J=S.l.Matrix[1],g=Q===x.e.NormalKind?S.p.TransformNormalFromFloatsToRef:S.p.TransformCoordinatesFromFloatsToRef;for(let x=0,z=0;x<f.length;x+=3,z+=4){let Q,v;for(N.reset(),Q=0;Q<4;Q++)v=i[z+Q],v>0&&(S.e.FromFloat32ArrayToRefScaled(H,Math.floor(16*X[z+Q]),v,J),N.addToSelf(J));if(K&&Z)for(Q=0;Q<4;Q++)v=Z[z+Q],v>0&&(S.e.FromFloat32ArrayToRefScaled(H,Math.floor(16*K[z+Q]),v,J),N.addToSelf(J));g(f[x],f[x+1],f[x+2],N,B),B.toArray(f,x)}}(f,Q,H,X,i,K,Z)}_getData(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x.e.PositionKind;const X=f.cache,i=f=>{if(X){const Q=X._vertexData||(X._vertexData={});return Q[f]||this.copyVerticesData(f,Q),Q[f]}return this.getVerticesData(f)};if(Q||(Q=i(H)),!Q)return null;if(X?(X._outputData?X._outputData.set(Q):X._outputData=new Float32Array(Q),Q=X._outputData):(f.applyMorph&&this.morphTargetManager||f.applySkeleton&&this.skeleton)&&(Q=Q.slice()),f.applyMorph&&this.morphTargetManager&&function(f,Q,H){let X=null;switch(Q){case x.e.PositionKind:X=f=>f.getPositions();break;case x.e.NormalKind:X=f=>f.getNormals();break;case x.e.TangentKind:X=f=>f.getTangents();break;case x.e.UVKind:X=f=>f.getUVs();break;default:return}for(let i=0;i<f.length;i++){let Q=f[i];for(let S=0;S<H.numTargets;S++){const x=H.getTarget(S),K=x.influence;if(0!==K){const H=X(x);H&&(Q+=(H[i]-f[i])*K)}}f[i]=Q}}(Q,H,this.morphTargetManager),f.applySkeleton&&this.skeleton){const f=i(x.e.MatricesIndicesKind),X=i(x.e.MatricesWeightsKind);if(X&&f){const S=this.numBoneInfluencers>4,K=S?i(x.e.MatricesIndicesExtraKind):null,Z=S?i(x.e.MatricesWeightsExtraKind):null,B=this.skeleton.getTransformMatrices(this);D._ApplySkeleton(Q,H,B,f,X,K,Z)}}if(!1!==f.updatePositionsArray&&H===x.e.PositionKind){const f=this._internalAbstractMeshDataInfo._positions||[],H=f.length;if(f.length=Q.length/3,H<f.length)for(let Q=H;Q<f.length;Q++)f[Q]=new S.p;for(let X=0,i=0;X<f.length;X++,i+=3)f[X].Xd(Q[i],Q[i+1],Q[i+2]);this._internalAbstractMeshDataInfo._positions=f}return Q}getNormalsData(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:f,applyMorph:Q,updatePositionsArray:!1},null,x.e.NormalKind)}Kf(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:f,applyMorph:Q,updatePositionsArray:!1},H,x.e.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new N.d(S.p.Zero(),S.p.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(f){if(!this.ge)return this;const Q=this.ge.length;for(let H=0;H<Q;H++){const X=this.ge[H];(Q>1||!X.IsGlobal)&&X.updateBoundingInfo(f)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(f){return this.getBoundingInfo().isInFrustum(f,this.Ke)}isCompletelyInFrustum(f){return this.getBoundingInfo().isCompletelyInFrustum(f)}intersectsMesh(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2?arguments[2]:void 0;const X=this.getBoundingInfo(),i=f.getBoundingInfo();if(X.intersects(i,Q))return!0;if(H)for(const S of this.getChildMeshes())if(S.intersectsMesh(f,Q,!0))return!0;return!1}intersectsPoint(f){return this.getBoundingInfo().intersectsPoint(f)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(f){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=f}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(f){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const Q=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=Q.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,Q.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,f,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(f,Q,H){var X;if(this._generatePointsArray(),!this._positions)return this;if(!f._lastColliderWorldVertices||!f._lastColliderTransformMatrix.equals(Q)){f._lastColliderTransformMatrix=Q.clone(),f._lastColliderWorldVertices=[],f._trianglePlanes=[];const H=f.verticesStart,X=f.verticesStart+f.verticesCount;for(let i=H;i<X;i++)f._lastColliderWorldVertices.push(S.p.TransformCoordinates(this._positions[i],Q))}return H._collide(f._trianglePlanes,f._lastColliderWorldVertices,this.Ud(),f.indexStart,f.indexStart+f.indexCount,f.verticesStart,!!f.Ha(),this,this._shouldConvertRHS(),7===(null===(X=f.Ha())||void 0===X?void 0:X.fillMode)),this}_processCollisionsForSubMeshes(f,Q){const H=this._scene.getCollidingSubMeshCandidates(this,f),X=H.length;for(let i=0;i<X;i++){const S=H.data[i];X>1&&!S._checkCollision(f)||this._collideForSubMesh(S,Q,f)}return this}_shouldConvertRHS(){return!1}_checkCollision(f){if(!this.getBoundingInfo()._checkCollision(f))return this;const Q=S.l.Matrix[0],H=S.l.Matrix[1];return S.e.ScalingToRef(1/f._radius.x,1/f._radius.y,1/f._radius.z,Q),this.worldMatrixFromCache.multiplyToRef(Q,H),this._processCollisionsForSubMeshes(f,H),this}_generatePointsArray(){return!1}intersects(f,Q,H){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,x=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const K=new B.d,Z=this.getClassName(),N="InstancedLinesMesh"===Z||"LinesMesh"===Z||"GreasedLineMesh"===Z?this.intersectionThreshold:0,J=this.getBoundingInfo();if(!this.ge)return K;if(!x&&(!f.intersectsSphere(J.boundingSphere,N)||!f.intersectsBox(J.boundingBox,N)))return K;if(X)return K.hit=!x,K.pickedMesh=x?null:this,K.distance=x?0:S.p.Distance(f.origin,J.boundingSphere.center),K.subMeshId=0,K;if(!this._generatePointsArray())return K;let g=null;const z=this._scene.getIntersectingSubMeshCandidates(this,f),v=z.length;let Y=!1;for(let S=0;S<v;S++){const f=z.data[S].Ha();if(f&&(7==f.fillMode||0==f.fillMode||1==f.fillMode||2==f.fillMode||4==f.fillMode)){Y=!0;break}}if(!Y)return K.hit=!0,K.pickedMesh=this,K.distance=S.p.Distance(f.origin,J.boundingSphere.center),K.subMeshId=-1,K;for(let S=0;S<v;S++){const X=z.data[S];if(v>1&&!x&&!X.canIntersects(f))continue;const i=X.intersects(f,this._positions,this.Ud(),Q,H);if(i&&(Q||!g||i.distance<g.distance)&&(g=i,g.subMeshId=S,Q))break}if(g){const Q=i??this.getWorldMatrix(),H=S.l.Wd[0],X=S.l.Wd[1];S.p.TransformCoordinatesToRef(f.origin,Q,H),f.direction.scaleToRef(g.distance,X);const x=S.p.TransformNormal(X,Q).addInPlace(H);return K.hit=!0,K.distance=S.p.Distance(H,x),K.pickedPoint=x,K.pickedMesh=this,K.bu=g.bu||0,K.bv=g.bv||0,K.subMeshFaceId=g.faceId,K.faceId=g.faceId+z.data[g.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),K.subMeshId=g.subMeshId,K}return K}clone(f,Q,H){return null}releaseSubMeshes(){if(this.ge)for(;this.ge.length;)this.ge[0].dispose();else this.ge=[];return this}dispose(f){let Q,H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const X=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),X.freeActiveMeshes(),X.freeRenderingGroups(),X.renderingManager.maintainStateBetweenFrames&&X.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((f=>f!==this&&f.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),Q=0;Q<this._intersectionsInProgress.length;Q++){const f=this._intersectionsInProgress[Q],H=f._intersectionsInProgress.indexOf(this);f._intersectionsInProgress.splice(H,1)}this._intersectionsInProgress.length=0;X.lights.forEach((f=>{let Q=f.includedOnlyMeshes.indexOf(this);-1!==Q&&f.includedOnlyMeshes.splice(Q,1),Q=f.excludedMeshes.indexOf(this),-1!==Q&&f.excludedMeshes.splice(Q,1);const H=f.getShadowGenerators();if(H){const f=H.values();for(let H=f.next();!0!==H.done;H=f.next()){const f=H.value.getShadowMap();f&&f.renderList&&(Q=f.renderList.indexOf(this),-1!==Q&&f.renderList.splice(Q,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const i=X.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,i.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),i.wipeCaches(),X.cf(this),this._parentContainer){const f=this._parentContainer.meshes.indexOf(this);f>-1&&this._parentContainer.meshes.splice(f,1),this._parentContainer=null}if(H&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!f)for(Q=0;Q<X.pe.length;Q++)X.pe[Q].k===this&&(X.pe[Q].dispose(),Q--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(f,H)}_initFacetData(){const f=this._internalAbstractMeshDataInfo._facetData;f.facetNormals||(f.facetNormals=[]),f.facetPositions||(f.facetPositions=[]),f.facetPartitioning||(f.facetPartitioning=new Array),f.facetNb=this.Ud().length/3|0,f.partitioningSubdivisions=f.partitioningSubdivisions?f.partitioningSubdivisions:10,f.partitioningBBoxRatio=f.partitioningBBoxRatio?f.partitioningBBoxRatio:1.01;for(let Q=0;Q<f.facetNb;Q++)f.facetNormals[Q]=S.p.Zero(),f.facetPositions[Q]=S.p.Zero();return f.facetDataEnabled=!0,this}updateFacetData(){const f=this._internalAbstractMeshDataInfo._facetData;f.facetDataEnabled||this._initFacetData();const Q=this.getVerticesData(x.e.PositionKind),H=this.Ud(),X=this.getVerticesData(x.e.NormalKind),i=this.getBoundingInfo();if(f.facetDepthSort&&!f.facetDepthSortEnabled){if(f.facetDepthSortEnabled=!0,H instanceof Uint16Array)f.depthSortedIndices=new Uint16Array(H);else if(H instanceof Uint32Array)f.depthSortedIndices=new Uint32Array(H);else{let Q=!1;for(let f=0;f<H.length;f++)if(H[f]>65535){Q=!0;break}f.depthSortedIndices=Q?new Uint32Array(H):new Uint16Array(H)}if(f.facetDepthSortFunction=function(f,Q){return Q.sqDistance-f.sqDistance},!f.facetDepthSortFrom){const Q=this.va().activeCamera;f.facetDepthSortFrom=Q?Q.position:S.p.Zero()}f.depthSortedFacets=[];for(let Q=0;Q<f.facetNb;Q++){const H={ind:3*Q,sqDistance:0};f.depthSortedFacets.push(H)}f.invertedMatrix=S.e.Identity(),f.facetDepthSortOrigin=S.p.Zero()}f.bbSize.x=i.maximum.x-i.minimum.x>O.c?i.maximum.x-i.minimum.x:O.c,f.bbSize.y=i.maximum.y-i.minimum.y>O.c?i.maximum.y-i.minimum.y:O.c,f.bbSize.z=i.maximum.z-i.minimum.z>O.c?i.maximum.z-i.minimum.z:O.c;let Z=f.bbSize.x>f.bbSize.y?f.bbSize.x:f.bbSize.y;if(Z=Z>f.bbSize.z?Z:f.bbSize.z,f.subDiv.max=f.partitioningSubdivisions,f.subDiv.X=Math.floor(f.subDiv.max*f.bbSize.x/Z),f.subDiv.Y=Math.floor(f.subDiv.max*f.bbSize.y/Z),f.subDiv.Z=Math.floor(f.subDiv.max*f.bbSize.z/Z),f.subDiv.X=f.subDiv.X<1?1:f.subDiv.X,f.subDiv.Y=f.subDiv.Y<1?1:f.subDiv.Y,f.subDiv.Z=f.subDiv.Z<1?1:f.subDiv.Z,f.facetParameters.facetNormals=this.getFacetLocalNormals(),f.facetParameters.facetPositions=this.getFacetLocalPositions(),f.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),f.facetParameters.bInfo=i,f.facetParameters.bbSize=f.bbSize,f.facetParameters.subDiv=f.subDiv,f.facetParameters.ratio=this.partitioningBBoxRatio,f.facetParameters.depthSort=f.facetDepthSort,f.facetDepthSort&&f.facetDepthSortEnabled&&(this.re(!0),this._worldMatrix.invertToRef(f.invertedMatrix),S.p.TransformCoordinatesToRef(f.facetDepthSortFrom,f.invertedMatrix,f.facetDepthSortOrigin),f.facetParameters.distanceTo=f.facetDepthSortOrigin),f.facetParameters.depthSortedFacets=f.depthSortedFacets,X&&K.b.ComputeNormals(Q,H,X,f.facetParameters),f.facetDepthSort&&f.facetDepthSortEnabled){f.depthSortedFacets.sort(f.facetDepthSortFunction);const Q=f.depthSortedIndices.length/3|0;for(let X=0;X<Q;X++){const Q=f.depthSortedFacets[X].ind;f.depthSortedIndices[3*X]=H[Q],f.depthSortedIndices[3*X+1]=H[Q+1],f.depthSortedIndices[3*X+2]=H[Q+2]}this.updateIndices(f.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const f=this._internalAbstractMeshDataInfo._facetData;return f.facetNormals||this.updateFacetData(),f.facetNormals}getFacetLocalPositions(){const f=this._internalAbstractMeshDataInfo._facetData;return f.facetPositions||this.updateFacetData(),f.facetPositions}getFacetLocalPartitioning(){const f=this._internalAbstractMeshDataInfo._facetData;return f.facetPartitioning||this.updateFacetData(),f.facetPartitioning}getFacetPosition(f){const Q=S.p.Zero();return this.getFacetPositionToRef(f,Q),Q}getFacetPositionToRef(f,Q){const H=this.getFacetLocalPositions()[f],X=this.getWorldMatrix();return S.p.TransformCoordinatesToRef(H,X,Q),this}getFacetNormal(f){const Q=S.p.Zero();return this.getFacetNormalToRef(f,Q),Q}getFacetNormalToRef(f,Q){const H=this.getFacetLocalNormals()[f];return S.p.TransformNormalToRef(H,this.getWorldMatrix(),Q),this}getFacetsAtLocalCoordinates(f,Q,H){const X=this.getBoundingInfo(),i=this._internalAbstractMeshDataInfo._facetData,S=Math.floor((f-X.minimum.x*i.partitioningBBoxRatio)*i.subDiv.X*i.partitioningBBoxRatio/i.bbSize.x),x=Math.floor((Q-X.minimum.y*i.partitioningBBoxRatio)*i.subDiv.Y*i.partitioningBBoxRatio/i.bbSize.y),K=Math.floor((H-X.minimum.z*i.partitioningBBoxRatio)*i.subDiv.Z*i.partitioningBBoxRatio/i.bbSize.z);return S<0||S>i.subDiv.max||x<0||x>i.subDiv.max||K<0||K>i.subDiv.max?null:i.facetPartitioning[S+i.subDiv.max*x+i.subDiv.max*i.subDiv.max*K]}getClosestFacetAtCoordinates(f,Q,H,X){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],x=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const K=this.getWorldMatrix(),Z=S.l.Matrix[5];K.invertToRef(Z);const B=S.l.Wd[8];S.p.TransformCoordinatesFromFloatsToRef(f,Q,H,Z,B);const N=this.getClosestFacetAtLocalCoordinates(B.x,B.y,B.z,X,i,x);return X&&S.p.TransformCoordinatesFromFloatsToRef(X.x,X.y,X.z,K,X),N}getClosestFacetAtLocalCoordinates(f,Q,H,X){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],S=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],x=null,K=0,Z=0,B=0,N=0,J=0,g=0,z=0,v=0;const Y=this.getFacetLocalPositions(),O=this.getFacetLocalNormals(),n=this.getFacetsAtLocalCoordinates(f,Q,H);if(!n)return null;let e,G,I,l=Number.MAX_VALUE,q=l;for(let D=0;D<n.length;D++)e=n[D],G=O[e],I=Y[e],N=(f-I.x)*G.x+(Q-I.y)*G.y+(H-I.z)*G.z,(!i||i&&S&&N>=0||i&&!S&&N<=0)&&(N=G.x*I.x+G.y*I.y+G.z*I.z,J=-(G.x*f+G.y*Q+G.z*H-N)/(G.x*G.x+G.y*G.y+G.z*G.z),g=f+G.x*J,z=Q+G.y*J,v=H+G.z*J,K=g-f,Z=z-Q,B=v-H,q=K*K+Z*Z+B*B,q<l&&(l=q,x=e,X&&(X.x=g,X.y=z,X.z=v)));return x}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const f=this._internalAbstractMeshDataInfo._facetData;return f.facetDataEnabled&&(f.facetDataEnabled=!1,f.facetPositions=[],f.facetNormals=[],f.facetPartitioning=new Array,f.facetParameters=null,f.depthSortedIndices=new Uint32Array(0)),this}updateIndices(f,Q){return this}createNormals(f){const Q=this.getVerticesData(x.e.PositionKind),H=this.Ud();let X;return X=this.isVerticesDataPresent(x.e.NormalKind)?this.getVerticesData(x.e.NormalKind):[],K.b.ComputeNormals(Q,H,X,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(x.e.NormalKind,X,f),this}alignWithNormal(f,Q){Q||(Q=n.b.Y);const H=S.l.Wd[0],X=S.l.Wd[1];return S.p.CrossToRef(Q,f,X),S.p.CrossToRef(f,X,H),this.rotationQuaternion?S.i.RotationQuaternionFromAxisToRef(H,f,X,this.rotationQuaternion):S.p.RotationFromAxisToRef(H,f,X,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,z.c)("EdgesRenderer")}enableEdgesRendering(f,Q,H){throw(0,z.c)("EdgesRenderer")}Cj(){return this._scene.pe.filter((f=>f.k===this))}}D.OCCLUSION_TYPE_NONE=0,D.OCCLUSION_TYPE_OPTIMISTIC=1,D.OCCLUSION_TYPE_STRICT=2,D.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,D.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,D.CULLINGSTRATEGY_STANDARD=0,D.$i=1,D.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,D.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,X.d)([G.e.filter((function(){for(var f=arguments.length,Q=new Array(f),H=0;H<f;H++)Q[H]=arguments[H];let[X,i,S,x,K]=Q;return!Array.isArray(X)&&!Array.isArray(i)&&!Array.isArray(S)&&!Array.isArray(x)&&!Array.isArray(K)}))],D,"_ApplySkeleton",null),(0,e.h)("BABYLON.AbstractMesh",D)},11327:(f,Q,H)=>{"use strict";H.d(Q,{b:()=>O});var X=H(1003),i=H(1161),S=H(11322),x=H(1253),K=H(1355),Z=H(11334),B=H(1362),N=H(1203),J=H(1156),g=H(1379),z=H(1027),v=H(1183),Y=H(1092);class O{get boundingBias(){return this._boundingBias}set boundingBias(f){this._boundingBias?this._boundingBias.p(f):this._boundingBias=f.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(f){const Q=new O(O.RandomId(),f.va());return Q.Ca(f),Q}get meshes(){return this._meshes}constructor(f,Q,H){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=Q||z.e.LastCreatedScene,this._scene&&(this.id=f,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=X,H?this.setAllVerticesData(H,X):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),i&&(this.Ca(i),i.re(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let f=0;f<this._meshes.length;f++)if(!this._meshes[f].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const f=new Set;for(const Q in this._vertexBuffers)f.add(this._vertexBuffers[Q].getWrapperBuffer());f.forEach((f=>{f._rebuild()}))}setAllVerticesData(f,Q){f.applyToGeometry(this,Q),this._notifyUpdate()}Ga(f,Q){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3?arguments[3]:void 0;H&&Array.isArray(Q)&&(Q=new Float32Array(Q));const i=new x.e(this._engine,Q,f,{updatable:H,postponeInternalCreation:0===this._meshes.length,stride:X,label:"Geometry_"+this.id+"_"+f});this.setVerticesBuffer(i)}removeVerticesData(f){this._vertexBuffers[f]&&(this._vertexBuffers[f].dispose(),delete this._vertexBuffers[f]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=f.getKind();this._vertexBuffers[i]&&H&&this._vertexBuffers[i].dispose(),f._buffer&&f._buffer._increaseReferences(),this._vertexBuffers[i]=f;const S=this._meshes,K=S.length;if(i===x.e.PositionKind){this._totalVertices=Q??f._maxVerticesCount,this._updateExtend(f.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const H=this._extend&&this._extend.minimum||new X.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i=this._extend&&this._extend.maximum||new X.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let f=0;f<K;f++){const Q=S[f];Q.buildBoundingInfo(H,i),Q._createGlobalSubMesh(Q.isUnIndexed),Q.re(!0),Q.synchronizeInstances()}}this._notifyUpdate(i)}updateVerticesDataDirectly(f,Q,H){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=this.getVertexBuffer(f);i&&(i.updateDirectly(Q,H,X),this._notifyUpdate(f))}updateVerticesData(f,Q){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X=this.getVertexBuffer(f);X&&(X.update(Q),f===x.e.PositionKind&&this.Ea(H,Q),this._notifyUpdate(f))}Ea(f,Q){if(f&&this._updateExtend(Q),this._resetPointsArrayCache(),f){const f=this._meshes;for(const Q of f){Q.hasBoundingInfo?Q.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):Q.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const f=Q.ge;for(const Q of f)Q.refreshBoundingInfo()}}}_bind(f,Q,H,X){if(!f)return;void 0===Q&&(Q=this._indexBuffer);const i=this.getVertexBuffers();if(!i)return;if(Q!=this._indexBuffer||!this._vertexArrayObjects&&!X)return void this._engine.bindBuffers(i,Q,f,H);const S=X||this._vertexArrayObjects,x=this._engine;S[f.key]||(S[f.key]=x.recordVertexArrayObject(i,Q,f,H)),x.bindVertexArrayObject(S[f.key],Q)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(f,Q,H){const X=this.getVertexBuffer(f);return X?X.getFloatData(this._totalVertices,H||Q&&1!==this._meshes.length):null}copyVerticesData(f,Q){const H=this.getVertexBuffer(f);if(!H)return;Q[f]||(Q[f]=new Float32Array(this._totalVertices*H.getSize()));const X=H.getData();X&&function(f,Q,H,X,i,S,K,Z){const B=Q*x.e.GetTypeByteLength(H),N=K*Q;if(Z.length!==N)throw new Error("Output length is not valid");if(H===x.e.FLOAT&&i===B)if(f instanceof Array){const Q=X/4;Z.set(f,Q)}else if(f instanceof ArrayBuffer){const Q=new Float32Array(f,X,N);Z.set(Q)}else{const Q=f.byteOffset+X;if(Q%4)return Y.b.Warn("CopyFloatData: copied misaligned data."),void Z.set(new Float32Array(f.buffer.slice(Q,Q+4*N)));const H=new Float32Array(f.buffer,Q,N);Z.set(H)}else x.e.ForEach(f,X,i,Q,H,N,S,((f,Q)=>Z[Q]=f))}(X,H.getSize(),H.type,H.byteOffset,H.byteStride,H.normalized,this._totalVertices,Q[f])}isVertexBufferUpdatable(f){const Q=this._vertexBuffers[f];return!!Q&&Q.isUpdatable()}getVertexBuffer(f){return this.isReady()?this._vertexBuffers[f]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(f){return this._vertexBuffers?void 0!==this._vertexBuffers[f]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(f)}getVerticesDataKinds(){const f=[];let Q;if(!this._vertexBuffers&&this._delayInfo)for(Q in this._delayInfo)f.push(Q);else for(Q in this._vertexBuffers)f.push(Q);return f}updateIndices(f,Q){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const X=f.length!==this._indices.length;if(H||(this._indices=f.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,f,Q),X)for(const f of this._meshes)f._createGlobalSubMesh(!0)}else this.setIndices(f,null,!0)}setIndexBuffer(f,Q,H){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=f,this._totalVertices=Q,this._totalIndices=H,f.is32Bits||(f.is32Bits=this._totalIndices>65535);for(const X of this._meshes)X._createGlobalSubMesh(!0),X.synchronizeInstances();this._notifyUpdate()}setIndices(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=f,this._indexBufferIsUpdatable=H,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,H,"Geometry_"+this.id+"_IndexBuffer")),void 0!=Q&&(this._totalVertices=Q);for(const i of this._meshes)i._createGlobalSubMesh(!X),i.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Ud(f,Q){if(!this.isReady())return null;const H=this._indices;return Q||f&&1!==this._meshes.length?H.slice():H}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;f&&this._vertexArrayObjects&&this._vertexArrayObjects[f.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[f.key]),delete this._vertexArrayObjects[f.key])}releaseForMesh(f,Q){const H=this._meshes,X=H.indexOf(f);-1!==X&&(H.splice(X,1),this._vertexArrayObjects&&f._invalidateInstanceVertexArrayObject(),f._geometry=null,0===H.length&&Q&&this.dispose())}Ca(f){if(f._geometry===this)return;const Q=f._geometry;Q&&Q.releaseForMesh(f),this._vertexArrayObjects&&f._invalidateInstanceVertexArrayObject();const H=this._meshes;f._geometry=this,f._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),H.push(f),this.isReady()?this._applyToMesh(f):this._boundingInfo&&f.setBoundingInfo(this._boundingInfo)}_updateExtend(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!f&&(f=this.getVerticesData(x.e.PositionKind),!f))return;this._extend=(0,g.e)(f,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(f){const Q=this._meshes.length;for(const H in this._vertexBuffers)1===Q&&this._vertexBuffers[H].create(),H===x.e.PositionKind&&(this._extend||this._updateExtend(),f.buildBoundingInfo(this._extend.minimum,this._extend.maximum),f._createGlobalSubMesh(f.isUnIndexed),f.Ea());1===Q&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),f._syncGeometryWithMorphTargetManager(),f.synchronizeInstances()}_notifyUpdate(f){this.onGeometryUpdated&&this.onGeometryUpdated(this,f),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const Q of this._meshes)Q._markSubMeshesAsAttributesDirty()}load(f,Q){2!==this.delayLoadState&&(this.isReady()?Q&&Q():(this.delayLoadState=2,this._queueLoad(f,Q)))}_queueLoad(f,Q){this.delayLoadingFile&&(f.addPendingData(this),f._loadFile(this.delayLoadingFile,(H=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(H),this),this.delayLoadState=1,this._delayInfo=[],f.removePendingData(this);const X=this._meshes,i=X.length;for(let f=0;f<i;f++)this._applyToMesh(X[f]);Q&&Q()}),void 0,!0))}toLeftHanded(){const f=this.Ud(!1);if(null!=f&&f.length>0){for(let Q=0;Q<f.length;Q+=3){const H=f[Q+0];f[Q+0]=f[Q+2],f[Q+2]=H}this.setIndices(f)}const Q=this.getVerticesData(x.e.PositionKind,!1);if(null!=Q&&Q.length>0){for(let f=0;f<Q.length;f+=3)Q[f+2]=-Q[f+2];this.Ga(x.e.PositionKind,Q,!1)}const H=this.getVerticesData(x.e.NormalKind,!1);if(null!=H&&H.length>0){for(let f=0;f<H.length;f+=3)H[f+2]=-H[f+2];this.Ga(x.e.NormalKind,H,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const f=this.getVerticesData(x.e.PositionKind);if(!f||0===f.length)return!1;for(let Q=3*this._positionsCache.length,H=this._positionsCache.length;Q<f.length;Q+=3,++H)this._positionsCache[H]=X.p.Zd(f,Q);for(let Q=0,H=0;Q<f.length;Q+=3,++H)this._positionsCache[H].set(f[0+Q],f[1+Q],f[2+Q]);return this._positionsCache.length=f.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const H in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[H]);this._vertexArrayObjects={};const f=this._meshes,Q=f.length;for(let H=0;H<Q;H++)f[H]._invalidateInstanceVertexArrayObject()}}dispose(){const f=this._meshes,Q=f.length;let H;for(H=0;H<Q;H++)this.releaseForMesh(f[H]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const X in this._vertexBuffers)this._vertexBuffers[X].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const f=this._parentContainer.geometries.indexOf(this);f>-1&&this._parentContainer.geometries.splice(f,1),this._parentContainer=null}this._isDisposed=!0}j(f){const Q=new S.b;Q.indices=[];const H=this.Ud();if(H)for(let S=0;S<H.length;S++)Q.indices.push(H[S]);let X,i=!1,x=!1;for(X in this._vertexBuffers){const f=this.getVerticesData(X);if(f&&(f instanceof Float32Array?Q.set(new Float32Array(f),X):Q.set(f.slice(0),X),!x)){const f=this.getVertexBuffer(X);f&&(i=f.isUpdatable(),x=!i)}}const K=new O(f,this._scene,Q,i);for(X in K.delayLoadState=this.delayLoadState,K.delayLoadingFile=this.delayLoadingFile,K._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)K._delayInfo=K._delayInfo||[],K._delayInfo.push(X);return K._boundingInfo=new B.d(this._extend.minimum,this._extend.maximum),K}serialize(){const f={};return f.id=this.id,f.uniqueId=this.uniqueId,f.updatable=this._updatable,J.b&&J.b.HasTags(this)&&(f.tags=J.b.GetTags(this)),f}_toNumberArray(f){return Array.isArray(f)?f:Array.prototype.slice.call(f)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const f in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,f)&&(this._vertexBuffers[f]._buffer._data=null)}serializeVerticeData(){const f=this.serialize();return this.isVerticesDataPresent(x.e.PositionKind)&&(f.xa=this._toNumberArray(this.getVerticesData(x.e.PositionKind)),this.isVertexBufferUpdatable(x.e.PositionKind)&&(f.xa._updatable=!0)),this.isVerticesDataPresent(x.e.NormalKind)&&(f.ya=this._toNumberArray(this.getVerticesData(x.e.NormalKind)),this.isVertexBufferUpdatable(x.e.NormalKind)&&(f.ya._updatable=!0)),this.isVerticesDataPresent(x.e.TangentKind)&&(f.tangents=this._toNumberArray(this.getVerticesData(x.e.TangentKind)),this.isVertexBufferUpdatable(x.e.TangentKind)&&(f.tangents._updatable=!0)),this.isVerticesDataPresent(x.e.UVKind)&&(f.Aa=this._toNumberArray(this.getVerticesData(x.e.UVKind)),this.isVertexBufferUpdatable(x.e.UVKind)&&(f.Aa._updatable=!0)),this.isVerticesDataPresent(x.e.UV2Kind)&&(f.uvs2=this._toNumberArray(this.getVerticesData(x.e.UV2Kind)),this.isVertexBufferUpdatable(x.e.UV2Kind)&&(f.uvs2._updatable=!0)),this.isVerticesDataPresent(x.e.UV3Kind)&&(f.uvs3=this._toNumberArray(this.getVerticesData(x.e.UV3Kind)),this.isVertexBufferUpdatable(x.e.UV3Kind)&&(f.uvs3._updatable=!0)),this.isVerticesDataPresent(x.e.UV4Kind)&&(f.uvs4=this._toNumberArray(this.getVerticesData(x.e.UV4Kind)),this.isVertexBufferUpdatable(x.e.UV4Kind)&&(f.uvs4._updatable=!0)),this.isVerticesDataPresent(x.e.UV5Kind)&&(f.uvs5=this._toNumberArray(this.getVerticesData(x.e.UV5Kind)),this.isVertexBufferUpdatable(x.e.UV5Kind)&&(f.uvs5._updatable=!0)),this.isVerticesDataPresent(x.e.UV6Kind)&&(f.uvs6=this._toNumberArray(this.getVerticesData(x.e.UV6Kind)),this.isVertexBufferUpdatable(x.e.UV6Kind)&&(f.uvs6._updatable=!0)),this.isVerticesDataPresent(x.e.ColorKind)&&(f.za=this._toNumberArray(this.getVerticesData(x.e.ColorKind)),this.isVertexBufferUpdatable(x.e.ColorKind)&&(f.za._updatable=!0)),this.isVerticesDataPresent(x.e.MatricesIndicesKind)&&(f.matricesIndices=this._toNumberArray(this.getVerticesData(x.e.MatricesIndicesKind)),f.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(x.e.MatricesIndicesKind)&&(f.matricesIndices._updatable=!0)),this.isVerticesDataPresent(x.e.MatricesWeightsKind)&&(f.matricesWeights=this._toNumberArray(this.getVerticesData(x.e.MatricesWeightsKind)),this.isVertexBufferUpdatable(x.e.MatricesWeightsKind)&&(f.matricesWeights._updatable=!0)),f.indices=this._toNumberArray(this.Ud()),f}static ExtractFromMesh(f,Q){const H=f._geometry;return H?H.j(Q):null}static RandomId(){return N.g.RandomId()}static _GetGeometryByLoadedUniqueId(f,Q){for(let H=0;H<Q.geometries.length;H++)if(Q.geometries[H]._loadedUniqueId===f)return Q.geometries[H];return null}static _ImportGeometry(f,Q){const H=Q.va(),X=f.geometryUniqueId,S=f.geometryId;if(X||S){const f=X?this._GetGeometryByLoadedUniqueId(X,H):H.getGeometryById(S);f&&f.Ca(Q)}else if(f instanceof ArrayBuffer){const H=Q._binaryInfo;if(H.positionsAttrDesc&&H.positionsAttrDesc.count>0){const X=new Float32Array(f,H.positionsAttrDesc.offset,H.positionsAttrDesc.count);Q.Ga(x.e.PositionKind,X,!1)}if(H.normalsAttrDesc&&H.normalsAttrDesc.count>0){const X=new Float32Array(f,H.normalsAttrDesc.offset,H.normalsAttrDesc.count);Q.Ga(x.e.NormalKind,X,!1)}if(H.tangetsAttrDesc&&H.tangetsAttrDesc.count>0){const X=new Float32Array(f,H.tangetsAttrDesc.offset,H.tangetsAttrDesc.count);Q.Ga(x.e.TangentKind,X,!1)}if(H.uvsAttrDesc&&H.uvsAttrDesc.count>0){const X=new Float32Array(f,H.uvsAttrDesc.offset,H.uvsAttrDesc.count);if(v.e)for(let f=1;f<X.length;f+=2)X[f]=1-X[f];Q.Ga(x.e.UVKind,X,!1)}if(H.uvs2AttrDesc&&H.uvs2AttrDesc.count>0){const X=new Float32Array(f,H.uvs2AttrDesc.offset,H.uvs2AttrDesc.count);if(v.e)for(let f=1;f<X.length;f+=2)X[f]=1-X[f];Q.Ga(x.e.UV2Kind,X,!1)}if(H.uvs3AttrDesc&&H.uvs3AttrDesc.count>0){const X=new Float32Array(f,H.uvs3AttrDesc.offset,H.uvs3AttrDesc.count);if(v.e)for(let f=1;f<X.length;f+=2)X[f]=1-X[f];Q.Ga(x.e.UV3Kind,X,!1)}if(H.uvs4AttrDesc&&H.uvs4AttrDesc.count>0){const X=new Float32Array(f,H.uvs4AttrDesc.offset,H.uvs4AttrDesc.count);if(v.e)for(let f=1;f<X.length;f+=2)X[f]=1-X[f];Q.Ga(x.e.UV4Kind,X,!1)}if(H.uvs5AttrDesc&&H.uvs5AttrDesc.count>0){const X=new Float32Array(f,H.uvs5AttrDesc.offset,H.uvs5AttrDesc.count);if(v.e)for(let f=1;f<X.length;f+=2)X[f]=1-X[f];Q.Ga(x.e.UV5Kind,X,!1)}if(H.uvs6AttrDesc&&H.uvs6AttrDesc.count>0){const X=new Float32Array(f,H.uvs6AttrDesc.offset,H.uvs6AttrDesc.count);if(v.e)for(let f=1;f<X.length;f+=2)X[f]=1-X[f];Q.Ga(x.e.UV6Kind,X,!1)}if(H.colorsAttrDesc&&H.colorsAttrDesc.count>0){const X=new Float32Array(f,H.colorsAttrDesc.offset,H.colorsAttrDesc.count);Q.Ga(x.e.ColorKind,X,!1,H.colorsAttrDesc.stride)}if(H.matricesIndicesAttrDesc&&H.matricesIndicesAttrDesc.count>0){const X=new Int32Array(f,H.matricesIndicesAttrDesc.offset,H.matricesIndicesAttrDesc.count),i=[];for(let f=0;f<X.length;f++){const Q=X[f];i.push(255&Q),i.push((65280&Q)>>8),i.push((16711680&Q)>>16),i.push(Q>>24&255)}Q.Ga(x.e.MatricesIndicesKind,i,!1)}if(H.matricesIndicesExtraAttrDesc&&H.matricesIndicesExtraAttrDesc.count>0){const X=new Int32Array(f,H.matricesIndicesExtraAttrDesc.offset,H.matricesIndicesExtraAttrDesc.count),i=[];for(let f=0;f<X.length;f++){const Q=X[f];i.push(255&Q),i.push((65280&Q)>>8),i.push((16711680&Q)>>16),i.push(Q>>24&255)}Q.Ga(x.e.MatricesIndicesExtraKind,i,!1)}if(H.matricesWeightsAttrDesc&&H.matricesWeightsAttrDesc.count>0){const X=new Float32Array(f,H.matricesWeightsAttrDesc.offset,H.matricesWeightsAttrDesc.count);Q.Ga(x.e.MatricesWeightsKind,X,!1)}if(H.indicesAttrDesc&&H.indicesAttrDesc.count>0){const X=new Int32Array(f,H.indicesAttrDesc.offset,H.indicesAttrDesc.count);Q.setIndices(X,null)}if(H.subMeshesAttrDesc&&H.subMeshesAttrDesc.count>0){const X=new Int32Array(f,H.subMeshesAttrDesc.offset,5*H.subMeshesAttrDesc.count);Q.ge=[];for(let f=0;f<H.subMeshesAttrDesc.count;f++){const H=X[5*f+0],i=X[5*f+1],S=X[5*f+2],x=X[5*f+3],Z=X[5*f+4];K.c.AddToMesh(H,i,S,x,Z,Q)}}}else if(f.xa&&f.ya&&f.indices){if(Q.Ga(x.e.PositionKind,f.xa,f.xa._updatable),Q.Ga(x.e.NormalKind,f.ya,f.ya._updatable),f.tangents&&Q.Ga(x.e.TangentKind,f.tangents,f.tangents._updatable),f.Aa&&Q.Ga(x.e.UVKind,f.Aa,f.Aa._updatable),f.uvs2&&Q.Ga(x.e.UV2Kind,f.uvs2,f.uvs2._updatable),f.uvs3&&Q.Ga(x.e.UV3Kind,f.uvs3,f.uvs3._updatable),f.uvs4&&Q.Ga(x.e.UV4Kind,f.uvs4,f.uvs4._updatable),f.uvs5&&Q.Ga(x.e.UV5Kind,f.uvs5,f.uvs5._updatable),f.uvs6&&Q.Ga(x.e.UV6Kind,f.uvs6,f.uvs6._updatable),f.za&&Q.Ga(x.e.ColorKind,i.h.CheckColors4(f.za,f.xa.length/3),f.za._updatable),f.matricesIndices)if(f.matricesIndices._isExpanded)delete f.matricesIndices._isExpanded,Q.Ga(x.e.MatricesIndicesKind,f.matricesIndices,f.matricesIndices._updatable);else{const H=[];for(let Q=0;Q<f.matricesIndices.length;Q++){const X=f.matricesIndices[Q];H.push(255&X),H.push((65280&X)>>8),H.push((16711680&X)>>16),H.push(X>>24&255)}Q.Ga(x.e.MatricesIndicesKind,H,f.matricesIndices._updatable)}if(f.matricesIndicesExtra)if(f.matricesIndicesExtra._isExpanded)delete f.matricesIndices._isExpanded,Q.Ga(x.e.MatricesIndicesExtraKind,f.matricesIndicesExtra,f.matricesIndicesExtra._updatable);else{const H=[];for(let Q=0;Q<f.matricesIndicesExtra.length;Q++){const X=f.matricesIndicesExtra[Q];H.push(255&X),H.push((65280&X)>>8),H.push((16711680&X)>>16),H.push(X>>24&255)}Q.Ga(x.e.MatricesIndicesExtraKind,H,f.matricesIndicesExtra._updatable)}f.matricesWeights&&(O._CleanMatricesWeights(f,Q),Q.Ga(x.e.MatricesWeightsKind,f.matricesWeights,f.matricesWeights._updatable)),f.matricesWeightsExtra&&Q.Ga(x.e.MatricesWeightsExtraKind,f.matricesWeightsExtra,f.matricesWeights._updatable),Q.setIndices(f.indices,null)}if(f.ge){Q.ge=[];for(let H=0;H<f.ge.length;H++){const X=f.ge[H];K.c.AddToMesh(X.materialIndex,X.verticesStart,X.verticesCount,X.indexStart,X.indexCount,Q)}}Q._shouldGenerateFlatShading&&(Q.convertToFlatShadedMesh(),Q._shouldGenerateFlatShading=!1),Q.re(!0),H.onMeshImportedObservable.notifyObservers(Q)}static _CleanMatricesWeights(f,Q){const H=.001;if(!Z.c.CleanBoneMatrixWeights)return;let X=0;if(!(f.skeletonId>-1))return;{const H=Q.va().getLastSkeletonById(f.skeletonId);if(!H)return;X=H.bones.length}const i=Q.getVerticesData(x.e.MatricesIndicesKind),S=Q.getVerticesData(x.e.MatricesIndicesExtraKind),K=f.matricesWeights,B=f.matricesWeightsExtra,N=f.numBoneInfluencer,J=K.length;for(let x=0;x<J;x+=4){let f=0,Q=-1;for(let X=0;X<4;X++){const i=K[x+X];f+=i,i<H&&Q<0&&(Q=X)}if(B)for(let X=0;X<4;X++){const i=B[x+X];f+=i,i<H&&Q<0&&(Q=X+4)}if((Q<0||Q>N-1)&&(Q=N-1),f>H){const Q=1/f;for(let f=0;f<4;f++)K[x+f]*=Q;if(B)for(let f=0;f<4;f++)B[x+f]*=Q}else Q>=4?(B[x+Q-4]=1-f,S[x+Q-4]=X):(K[x+Q]=1-f,i[x+Q]=X)}Q.Ga(x.e.MatricesIndicesKind,i),f.matricesWeightsExtra&&Q.Ga(x.e.MatricesIndicesExtraKind,S)}static Parse(f,Q,H){const i=new O(f.id,Q,void 0,f.updatable);return i._loadedUniqueId=f.uniqueId,J.b&&J.b.AddTagsTo(i,f.tags),f.delayLoadingFile?(i.delayLoadState=4,i.delayLoadingFile=H+f.delayLoadingFile,i._boundingInfo=new B.d(X.p.Zd(f.boundingBoxMinimum),X.p.Zd(f.boundingBoxMaximum)),i._delayInfo=[],f.hasUVs&&i._delayInfo.push(x.e.UVKind),f.hasUVs2&&i._delayInfo.push(x.e.UV2Kind),f.hasUVs3&&i._delayInfo.push(x.e.UV3Kind),f.hasUVs4&&i._delayInfo.push(x.e.UV4Kind),f.hasUVs5&&i._delayInfo.push(x.e.UV5Kind),f.hasUVs6&&i._delayInfo.push(x.e.UV6Kind),f.hasColors&&i._delayInfo.push(x.e.ColorKind),f.hasMatricesIndices&&i._delayInfo.push(x.e.MatricesIndicesKind),f.hasMatricesWeights&&i._delayInfo.push(x.e.MatricesWeightsKind),i._delayLoadingFunction=S.b.ImportVertexData):S.b.ImportVertexData(f,i),Q.pushGeometry(i,!0),i}}},11929:(f,Q,H)=>{"use strict";H.d(Q,{e:()=>g});var X=H(1003),i=H(1092),S=H(11337),x=H(11301),K=H(1207),Z=H(11345),B=H(1253),N=H(1203),J=H(1022);x.b._instancedMeshFactory=(f,Q)=>{const H=new g(f,Q);if(Q.instancedBuffers){H.instancedBuffers={};for(const f in Q.instancedBuffers)H.instancedBuffers[f]=Q.instancedBuffers[f]}return H};class g extends S.c{constructor(f,Q){super(f,Q.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,Q.Qj(this),this._sourceMesh=Q,this._unIndexed=Q._unIndexed,this.position.p(Q.position),this.rotation.p(Q.rotation),this.He.p(Q.He),Q.rotationQuaternion&&(this.rotationQuaternion=Q.rotationQuaternion.clone()),this.animations=Q.animations.slice();for(const H of Q.getAnimationRanges())null!=H&&this.createAnimationRange(H.name,H.from,H.to);this.infiniteDistance=Q.infiniteDistance,this.setPivotMatrix(Q.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(f){var Q;(null===(Q=this._sourceMesh)||void 0===Q?void 0:Q.receiveShadows)!==f&&N.g.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(f){var Q;(null===(Q=this._sourceMesh)||void 0===Q?void 0:Q.material)!==f&&N.g.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(f){var Q;(null===(Q=this._sourceMesh)||void 0===Q?void 0:Q.visibility)!==f&&N.g.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(f){var Q;(null===(Q=this._sourceMesh)||void 0===Q?void 0:Q.skeleton)!==f&&N.g.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(f){this._sourceMesh&&f!==this._sourceMesh.renderingGroupId&&i.b.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}yd(f){return this._sourceMesh.yd(f)}isReady(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(f,!0)}getVerticesData(f,Q,H){return this._sourceMesh.getVerticesData(f,Q,H)}copyVerticesData(f,Q){this._sourceMesh.copyVerticesData(f,Q)}Ga(f,Q,H,X){return this.sourceMesh&&this.sourceMesh.Ga(f,Q,H,X),this.sourceMesh}updateVerticesData(f,Q,H,X){return this.sourceMesh&&this.sourceMesh.updateVerticesData(f,Q,H,X),this.sourceMesh}setIndices(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(f,Q),this.sourceMesh}isVerticesDataPresent(f){return this._sourceMesh.isVerticesDataPresent(f)}Ud(){return this._sourceMesh.Ud()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let f,Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;f="object"===typeof Q?Q:{applySkeleton:Q,applyMorph:H};const X=this._sourceMesh.ze?this._sourceMesh.ze.boundingBias:null;return this.Fa(this._sourceMesh._getData(f,null,B.e.PositionKind),X),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(f,Q){if(super._activate(f,Q),this._sourceMesh.ge||i.b.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,f),Q){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==Z.d.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new X.e);const f=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,X.l.Wd[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.re(!0)),this._currentLOD.position.p(X.l.Wd[7]),this._currentLOD._masterMesh=f,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(f){if(!f)return this;const Q=this.sourceMesh.getLODLevels();if(Q&&0!==Q.length){const Q=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(f,Q.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(f){return this.sourceMesh._preActivateForIntermediateRendering(f)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.ge)for(let f=0;f<this._sourceMesh.ge.length;f++)this._sourceMesh.ge[f].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0;const X=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).yd(f);if(K.b.DeepCopy(this,X,["name","ge","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Bj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),Q&&(X.parent=Q),!H)for(let i=0;i<this.va().meshes.length;i++){const f=this.va().meshes[i];f.parent===this&&f.clone(f.name,X)}return X.re(!0),this.onClonedObservable.notifyObservers(X),X}dispose(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Pj(this),super.dispose(f,Q)}_serializeAsParent(f){super._serializeAsParent(f),f.parentId=this._sourceMesh.uniqueId,f.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Q=arguments.length>1?arguments[1]:void 0,H=arguments.length>2?arguments[2]:void 0;const X=this.clone("Clone of "+(this.name||this.id),f||this.parent,!0,Q&&Q.newSourcedMesh);X&&H&&H(this,X);for(const i of this.getChildTransformNodes(!0))i.instantiateHierarchy(X,Q,H);return X}}x.b.prototype.registerInstancedBuffer=function(f,Q){var H,X;if(null===(H=this._userInstancedBuffersStorage)||void 0===H||null===(X=H.vertexBuffers[f])||void 0===X||X.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const f of this.instances)f.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[f]=null,this._userInstancedBuffersStorage.strides[f]=Q,this._userInstancedBuffersStorage.sizes[f]=32*Q,this._userInstancedBuffersStorage.data[f]=new Float32Array(this._userInstancedBuffersStorage.sizes[f]),this._userInstancedBuffersStorage.vertexBuffers[f]=new B.e(this.getEngine(),this._userInstancedBuffersStorage.data[f],f,!0,!1,Q,!0);for(const i of this.instances)i.instancedBuffers[f]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},x.b.prototype._processInstancedBuffers=function(f,Q){const H=f?f.length:0;for(const X in this.instancedBuffers){let i=this._userInstancedBuffersStorage.sizes[X];const S=this._userInstancedBuffersStorage.strides[X],x=(H+1)*S;for(;i<x;)i*=2;this._userInstancedBuffersStorage.data[X].length!=i&&(this._userInstancedBuffersStorage.data[X]=new Float32Array(i),this._userInstancedBuffersStorage.sizes[X]=i,this._userInstancedBuffersStorage.vertexBuffers[X]&&(this._userInstancedBuffersStorage.vertexBuffers[X].dispose(),this._userInstancedBuffersStorage.vertexBuffers[X]=null));const K=this._userInstancedBuffersStorage.data[X];let Z=0;if(Q){const f=this.instancedBuffers[X];f.toArray?f.toArray(K,Z):f.copyToArray?f.copyToArray(K,Z):K[Z]=f,Z+=S}for(let Q=0;Q<H;Q++){const H=f[Q].instancedBuffers[X];H.toArray?H.toArray(K,Z):H.copyToArray?H.copyToArray(K,Z):K[Z]=H,Z+=S}this._userInstancedBuffersStorage.vertexBuffers[X]?this._userInstancedBuffersStorage.vertexBuffers[X].updateDirectly(K,0):(this._userInstancedBuffersStorage.vertexBuffers[X]=new B.e(this.getEngine(),this._userInstancedBuffersStorage.data[X],X,!0,!1,S,!0),this._invalidateInstanceVertexArrayObject())}},x.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const f in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[f]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},x.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const f in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[f]&&this._userInstancedBuffersStorage.vertexBuffers[f].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,J.h)("BABYLON.InstancedMesh",g)},11301:(f,Q,H)=>{"use strict";H.d(Q,{b:()=>R,d:()=>F});var X=H(994),i=H(1203),S=H(1207),x=H(1156),K=H(11308),Z=H(11311),B=H(1003),N=H(1161),J=H(11314),g=H(1253),z=H(11322),v=H(11327),Y=H(11337),O=H(1355),n=H(1352),e=H(11349),G=H(11334),I=H(1151),l=H(1092),q=H(1022),D=H(1082),d=H(1281);class s{constructor(f,Q){this.distanceOrScreenCoverage=f,this.mesh=Q}}class F{}class P{constructor(){this.visibleInstances={},this.batchCache=new m,this.batchCacheReplacementModeInFrozenMode=new m,this.instancesBufferSize=2048}}class m{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class c{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class W{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class R extends Y.c{static _GetDefaultSideOrientation(f){return f||R.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(f){this._internalMeshDataInfo._useLODScreenCoverage=f,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(f){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==f&&(f&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(g.e.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(g.e.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=f,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new X.e),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new X.e),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new X.e),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new X.e),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new X.e),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(f){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(f)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(f){this._internalMeshDataInfo._forcedInstanceCount=f}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(f){this._internalMeshDataInfo._sideOrientation=f,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===f||!this._scene.useRightHandedSystem&&0===f}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(f){this.sideOrientation=f,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(f){this._internalMeshDataInfo._overrideRenderingFillMode=f}get material(){return this._internalAbstractMeshDataInfo._material}set material(f){f&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(f.sideOrientation=null),this._setMaterial(f)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(f){this._unIndexed!==f&&(this._unIndexed=f,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(f){this._instanceDataStorage.manualUpdate=f}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(f){this._instanceDataStorage.previousManualUpdate=f}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(f){this._instanceDataStorage.forceMatrixUpdates=f}_copySource(f,Q){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const X=this.va();if(f._geometry&&f._geometry.Ca(this),S.b.DeepCopy(f,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","ze","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Bj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=f,X.useClonedMeshMap&&(f._internalMeshDataInfo.meshMap||(f._internalMeshDataInfo.meshMap={}),f._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=f._originalBuilderSideOrientation,this._creationDataStorage=f._creationDataStorage,f._ranges){const Q=f._ranges;for(const f in Q)Object.prototype.hasOwnProperty.call(Q,f)&&Q[f]&&this.createAnimationRange(f,Q[f].from,Q[f].to)}if(f.metadata&&f.metadata.clone?this.metadata=f.metadata.clone():this.metadata=f.metadata,this._internalMetadata=f._internalMetadata,x.b&&x.b.HasTags(f)&&x.b.AddTagsTo(this,x.b.GetTags(f,!0)),this.Dg(f.isEnabled(!1)),this.parent=f.parent,this.setPivotMatrix(f.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+f.id,this.material=f.material,!Q){const Q=f.getDescendants(!0);for(let f=0;f<Q.length;f++){const H=Q[f];H.clone&&H.clone(this.name+"."+H.name,this)}}if(f.morphTargetManager&&(this.morphTargetManager=f.morphTargetManager),X.getPhysicsEngine){const Q=X.getPhysicsEngine();if(H&&Q)if(1===Q.getPluginVersion()){const H=Q.getImpostorForPhysicsObject(f);H&&(this.physicsImpostor=H.clone(this))}else 2===Q.getPluginVersion()&&f.physicsBody&&f.physicsBody.clone(this)}for(let i=0;i<X.pe.length;i++){const Q=X.pe[i];Q.k===f&&Q.clone(Q.name,this)}this.skeleton=f.skeleton,this.refreshBoundingInfo(!0,!0),this.re(!0)}constructor(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4?arguments[4]:void 0,x=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(f,Q),this._internalMeshDataInfo=new W,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new P,this._thinInstanceDataStorage=new c,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=R.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,Q=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(f,Q,H)=>{f&&H&&(this._uniformBuffer?this.transferToEffect(Q):H.bindOnlyWorldMatrix(Q))},i&&this._copySource(i,S,x),null!==H&&(this.parent=H),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=f=>{f.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new X.e(this._internalMeshDataInfo._onMeshReadyObserverAdded),i&&i.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Q=arguments.length>1?arguments[1]:void 0,H=arguments.length>2?arguments[2]:void 0;const X=0===this.getTotalVertices()||Q&&Q.doNotInstantiate&&(!0===Q.doNotInstantiate||Q.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),f||this.parent,!0):this.yd("instance of "+(this.name||this.id));X.parent=f||this.parent,X.position=this.position.clone(),X.He=this.He.clone(),this.rotationQuaternion?X.rotationQuaternion=this.rotationQuaternion.clone():X.rotation=this.rotation.clone(),H&&H(this,X);for(const i of this.getChildTransformNodes(!0))"InstancedMesh"===i.getClassName()&&"Mesh"===X.getClassName()&&i.sourceMesh===this?i.instantiateHierarchy(X,{doNotInstantiate:Q&&Q.doNotInstantiate||!1,newSourcedMesh:X},H):i.instantiateHierarchy(X,Q,H);return X}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(f){let Q=super.toString(f);if(Q+=", n vertices: "+this.getTotalVertices(),Q+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let H=0;H<this.animations.length;H++)Q+=", animation[0]: "+this.animations[H].toString(f);if(f)if(this._geometry){const f=this.Ud(),H=this.getVerticesData(g.e.PositionKind);H&&f&&(Q+=", flat shading: "+(H.length/3===f.length?"YES":"NO"))}else Q+=", flat shading: UNKNOWN";return Q}_unBindEffect(){super._unBindEffect();for(const f of this.instances)f._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const f=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((Q,H)=>Q.distanceOrScreenCoverage<H.distanceOrScreenCoverage?f:Q.distanceOrScreenCoverage>H.distanceOrScreenCoverage?-f:0))}addLODLevel(f,Q){if(Q&&Q._masterMesh)return l.b.Warn("You cannot use a mesh as LOD level twice"),this;const H=new s(f,Q);return this._internalMeshDataInfo._LODLevels.push(H),Q&&(Q._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(f){const Q=this._internalMeshDataInfo;for(let H=0;H<Q._LODLevels.length;H++){const X=Q._LODLevels[H];if(X.distanceOrScreenCoverage===f)return X.mesh}return null}removeLODLevel(f){const Q=this._internalMeshDataInfo;for(let H=0;H<Q._LODLevels.length;H++)Q._LODLevels[H].mesh===f&&(Q._LODLevels.splice(H,1),f&&(f._masterMesh=null));return this._sortLODLevels(),this}getLOD(f,Q){const H=this._internalMeshDataInfo;if(!H._LODLevels||0===H._LODLevels.length)return this;const X=Q||this.getBoundingInfo().boundingSphere,i=f.mode===Z.c.ORTHOGRAPHIC_CAMERA?f.nj:X.centerWorld.hd(f.globalPosition).length();let S=i,x=1;if(H._useLODScreenCoverage){const Q=f.screenArea;let H=X.radiusWorld*f.nj/i;H=H*H*Math.PI,S=H/Q,x=-1}if(x*H._LODLevels[H._LODLevels.length-1].distanceOrScreenCoverage>x*S)return this.onLODLevelSelection&&this.onLODLevelSelection(S,this,this),this;for(let K=0;K<H._LODLevels.length;K++){const f=H._LODLevels[K];if(x*f.distanceOrScreenCoverage<x*S){if(f.mesh){if(4===f.mesh.delayLoadState)return f.mesh._checkDelayState(),this;if(2===f.mesh.delayLoadState)return this;f.mesh._preActivate(),f.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(S,this,f.mesh),f.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(S,this,this),this}get ze(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(f,Q,H,X){var i,S;if(!this._geometry)return null;let x=X||null===(i=this._userInstancedBuffersStorage)||void 0===i||null===(S=i.vertexBuffers[f])||void 0===S?void 0:S.getFloatData(this.instances.length+1,H||Q&&1!==this._geometry.meshes.length);return x||(x=this._geometry.getVerticesData(f,Q,H)),x}copyVerticesData(f,Q){this._geometry&&this._geometry.copyVerticesData(f,Q)}getVertexBuffer(f,Q){var H;return this._geometry?(Q||null===(H=this._userInstancedBuffersStorage)||void 0===H?void 0:H.vertexBuffers[f])??this._geometry.getVertexBuffer(f):null}isVerticesDataPresent(f,Q){var H;return this._geometry?!Q&&void 0!==(null===(H=this._userInstancedBuffersStorage)||void 0===H?void 0:H.vertexBuffers[f])||this._geometry.isVerticesDataPresent(f):!!this._delayInfo&&-1!==this._delayInfo.indexOf(f)}isVertexBufferUpdatable(f,Q){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(f);if(!Q){var H;const Q=null===(H=this._userInstancedBuffersStorage)||void 0===H?void 0:H.vertexBuffers[f];if(Q)return Q.isUpdatable()}return this._geometry.isVertexBufferUpdatable(f)}getVerticesDataKinds(f){if(!this._geometry){const f=[];return this._delayInfo&&this._delayInfo.forEach((function(Q){f.push(Q)})),f}const Q=this._geometry.getVerticesDataKinds();if(!f&&this._userInstancedBuffersStorage)for(const H in this._userInstancedBuffersStorage.vertexBuffers)-1===Q.indexOf(H)&&Q.push(H);return Q}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Ud(f,Q){return this._geometry?this._geometry.Ud(f,Q):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(f))return!1;if(!this.ge||0===this.ge.length)return!0;if(!f)return!0;const H=this.getEngine(),X=this.va(),i=Q||H.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.re();const S=this.material||X.defaultMaterial;if(S)if(S._storeEffectOnSubMeshes)for(const g of this.ge){const f=g.Ha();if(f)if(f._storeEffectOnSubMeshes){if(!f.isReadyForSubMesh(this,g,i))return!1}else if(!f.isReady(this,i))return!1}else if(!S.isReady(this,i))return!1;const x=H.currentRenderPassId;for(const g of this.lightSources){const f=g.getShadowGenerators();if(!f)continue;const Q=f.values();for(let X=Q.next();!0!==X.done;X=Q.next()){var K,Z,B,N;const f=X.value;if(f&&(null===(K=f.getShadowMap())||void 0===K||!K.renderList||null!==(Z=f.getShadowMap())&&void 0!==Z&&Z.renderList&&-1!==(null===(B=f.getShadowMap())||void 0===B||null===(N=B.renderList)||void 0===N?void 0:N.indexOf(this)))){const Q=f.getShadowMap().renderPassIds??[H.currentRenderPassId];for(let X=0;X<Q.length;++X){H.currentRenderPassId=Q[X];for(const Q of this.ge){var J;if(!f.isReady(Q,i,(null===(J=Q.Ha())||void 0===J?void 0:J.needAlphaBlendingForMesh(this))??!1))return H.currentRenderPassId=x,!1}}H.currentRenderPassId=x}}}for(const g of this._internalMeshDataInfo._LODLevels)if(g.mesh&&!g.mesh.isReady(i))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}ei(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(f){this._instanceDataStorage.overridenInstanceCount=f}_preActivate(){const f=this._internalMeshDataInfo,Q=this.va().getRenderId();return f._preActivateId===Q||(f._preActivateId=Q,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(f){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=f),this}_registerInstanceForRenderId(f,Q){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:Q,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[Q]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=Q,this._instanceDataStorage.visibleInstances[Q]=new Array),this._instanceDataStorage.visibleInstances[Q].push(f),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let f,Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;f="object"===typeof Q?Q:{applySkeleton:Q,applyMorph:H};const X=this.ze?this.ze.boundingBias:null;return this.Fa(this._getData(f,null,g.e.PositionKind),X),this}_createGlobalSubMesh(f){const Q=this.getTotalVertices();if(!Q||!this.Ud())return null;if(this.ge&&this.ge.length>0){const H=this.Ud();if(!H)return null;const X=H.length;let i=!1;if(f)i=!0;else for(const f of this.ge){if(f.indexStart+f.indexCount>X){i=!0;break}if(f.verticesStart+f.verticesCount>Q){i=!0;break}}if(!i)return this.ge[0]}return this.releaseSubMeshes(),new O.c(0,0,Q,0,this.getTotalIndices(),this)}subdivide(f){if(f<1)return;const Q=this.getTotalIndices();let H=Q/f|0,X=0;for(;H%3!==0;)H++;this.releaseSubMeshes();for(let i=0;i<f&&!(X>=Q);i++)O.c.CreateFromIndices(0,X,i===f-1?Q-X:H,this,void 0,!1),X+=H;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(f,Q){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(f,Q,H,X);else{const X=new z.b;X.set(Q,f);const i=this.va();new v.b(v.b.RandomId(),i,X,H,this)}return this}removeVerticesData(f){this._geometry&&this._geometry.removeVerticesData(f)}markVerticesDataAsUpdatable(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const H=this.getVertexBuffer(f);H&&H.isUpdatable()!==Q&&this.Ga(f,this.getVerticesData(f),Q)}setVerticesBuffer(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=v.b.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(f,null,Q),this}updateVerticesData(f,Q,H,X){return this._geometry?(X?(this.makeGeometryUnique(),this.updateVerticesData(f,Q,H,!1)):this._geometry.updateVerticesData(f,Q,H),this):this}updateMeshPositions(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const H=this.getVerticesData(g.e.PositionKind);if(!H)return this;if(f(H),this.updateVerticesData(g.e.PositionKind,H,!1,!1),Q){const f=this.Ud(),Q=this.getVerticesData(g.e.NormalKind);if(!Q)return this;z.b.ComputeNormals(H,f,Q),this.updateVerticesData(g.e.NormalKind,Q,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const f=this._geometry,Q=this._geometry.j(v.b.RandomId());return f.releaseForMesh(this,!0),Q.Ca(this),this}setIndexBuffer(f,Q,H){let X=this._geometry;X||(X=new v.b(v.b.RandomId(),this.va(),void 0,void 0,this)),X.setIndexBuffer(f,Q,H)}setIndices(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(f,Q,H,X);else{const Q=new z.b;Q.indices=f;const X=this.va();new v.b(v.b.RandomId(),X,Q,H,this)}return this}updateIndices(f,Q){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(f,Q,H),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(f,Q,H){let X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const i=this.va().getEngine();let S;if(this._unIndexed)if(this._getRenderingFillMode(H)===n.e.WireFrameFillMode)S=f._getLinesIndexBuffer(this.Ud(),i);else S=null;else switch(this._getRenderingFillMode(H)){case n.e.PointFillMode:S=null;break;case n.e.WireFrameFillMode:S=f._getLinesIndexBuffer(this.Ud(),i);break;default:case n.e.TriangleFillMode:S=this._geometry.getIndexBuffer()}return this._bindDirect(Q,S,X)}_bindDirect(f,Q){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(f),H&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(f,Q,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(f,Q),this):this}_draw(f,Q,H){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const X=this.va().getEngine();return this._unIndexed&&Q!==n.e.WireFrameFillMode||Q==n.e.PointFillMode?X.drawArraysType(Q,f.verticesStart,f.verticesCount,this.forcedInstanceCount||H):Q==n.e.WireFrameFillMode?X.drawElementsType(Q,0,f._linesIndexCount,this.forcedInstanceCount||H):X.drawElementsType(Q,f.indexStart,f.indexCount,this.forcedInstanceCount||H),this}registerBeforeRender(f){return this.onBeforeRenderObservable.add(f),this}unregisterBeforeRender(f){return this.onBeforeRenderObservable.removeCallback(f),this}registerAfterRender(f){return this.onAfterRenderObservable.add(f),this}unregisterAfterRender(f){return this.onAfterRenderObservable.removeCallback(f),this}_getInstancesRenderList(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(Q)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[f]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[f]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const H=this.va(),X=H._isInIntermediateRendering(),i=X?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,S=this._instanceDataStorage.batchCache;if(S.mustReturn=!1,S.renderSelf[f]=Q||!i&&this.isEnabled()&&this.isVisible,S.visibleInstances[f]=null,this._instanceDataStorage.visibleInstances&&!Q){const Q=this._instanceDataStorage.visibleInstances,i=H.getRenderId(),x=X?Q.intermediateDefaultRenderId:Q.defaultRenderId;S.visibleInstances[f]=Q[i],!S.visibleInstances[f]&&x&&(S.visibleInstances[f]=Q[x])}return S.hardwareInstancedRendering[f]=!Q&&this._instanceDataStorage.hardwareInstancedRendering&&null!==S.visibleInstances[f]&&void 0!==S.visibleInstances[f],this._instanceDataStorage.previousBatch=S,S}_renderWithInstances(f,Q,H,X,i){const S=H.visibleInstances[f._id],x=S?S.length:0,K=this._instanceDataStorage,Z=K.instancesBufferSize;let N=K.instancesBuffer,J=K.instancesPreviousBuffer;const z=16*(x+1)*4;for(;K.instancesBufferSize<z;)K.instancesBufferSize*=2;K.instancesData&&Z==K.instancesBufferSize||(K.instancesData=new Float32Array(K.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!K.instancesPreviousData||Z!=K.instancesBufferSize)&&(K.instancesPreviousData=new Float32Array(K.instancesBufferSize/4));let v=0,Y=0;const O=H.renderSelf[f._id],n=!N||Z!==K.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!K.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||K.isFrozen&&!n)Y=(O?1:0)+x;else{const Q=this.getWorldMatrix();if(O&&(this._scene.needsPreviousWorldMatrices&&(K.masterMeshPreviousWorldMatrix?(K.masterMeshPreviousWorldMatrix.copyToArray(K.instancesPreviousData,v),K.masterMeshPreviousWorldMatrix.p(Q)):(K.masterMeshPreviousWorldMatrix=Q.clone(),K.masterMeshPreviousWorldMatrix.copyToArray(K.instancesPreviousData,v))),Q.copyToArray(K.instancesData,v),v+=16,Y++),S){var e;if(R.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(e=f.Ha())&&void 0!==e&&e.needAlphaBlendingForMesh(f.getRenderingMesh())){const f=this._scene.activeCamera.globalPosition;for(let Q=0;Q<S.length;Q++){const H=S[Q];H._distanceToCamera=B.p.Distance(H.getBoundingInfo().boundingSphere.centerWorld,f)}S.sort(((f,Q)=>f._distanceToCamera>Q._distanceToCamera?-1:f._distanceToCamera<Q._distanceToCamera?1:0))}for(let f=0;f<S.length;f++){const Q=S[f],H=Q.getWorldMatrix();H.copyToArray(K.instancesData,v),this._scene.needsPreviousWorldMatrices&&(Q._previousWorldMatrix?(Q._previousWorldMatrix.copyToArray(K.instancesPreviousData,v),Q._previousWorldMatrix.p(H)):(Q._previousWorldMatrix=H.clone(),Q._previousWorldMatrix.copyToArray(K.instancesPreviousData,v))),v+=16,Y++}}}return n?(N&&N.dispose(),J&&J.dispose(),N=new g.d(i,K.instancesData,!0,16,!1,!0),K.instancesBuffer=N,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=N.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=N.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=N.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=N.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(J=new g.d(i,K.instancesPreviousData,!0,16,!1,!0),K.instancesPreviousBuffer=J,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=J.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=J.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=J.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=J.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(N.updateDirectly(K.instancesData,0,Y),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||J.updateDirectly(K.instancesPreviousData,0,Y)),this._processInstancedBuffers(S,O),this.va()._activeIndices.addCount(f.indexCount*Y,!1),i._currentDrawContext&&(i._currentDrawContext.useInstancing=!0),this._bind(f,X,Q),this._draw(f,Q,Y),!this._scene.needsPreviousWorldMatrices||n||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||J.updateDirectly(K.instancesData,0,Y),i.unbindInstanceAttributes(),this}_renderWithThinInstances(f,Q,H,X){var i;const S=(null===(i=this._thinInstanceDataStorage)||void 0===i?void 0:i.instancesCount)??0;this.va()._activeIndices.addCount(f.indexCount*S,!1),X._currentDrawContext&&(X._currentDrawContext.useInstancing=!0),this._bind(f,H,Q),this._draw(f,Q,S),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,S):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),X.unbindInstanceAttributes()}_processInstancedBuffers(f,Q){}_processRendering(f,Q,H,X,i,S,x,K){const Z=this.va(),B=Z.getEngine();if(X=this._getRenderingFillMode(X),S&&Q.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(Q,X,H,B),this;if(S)this._renderWithInstances(Q,X,i,H,B);else{B._currentDrawContext&&(B._currentDrawContext.useInstancing=!1);let H=0;i.renderSelf[Q._id]&&(x&&x(!1,f.getWorldMatrix(),K),H++,this._draw(Q,X,this._instanceDataStorage.overridenInstanceCount));const S=i.visibleInstances[Q._id];if(S){const f=S.length;H+=f;for(let H=0;H<f;H++){const f=S[H].getWorldMatrix();x&&x(!0,f,K),this._draw(Q,X)}}Z._activeIndices.addCount(Q.indexCount*H,!1)}return this}_rebuild(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(f&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const Q in this._userInstancedBuffersStorage.vertexBuffers){const H=this._userInstancedBuffersStorage.vertexBuffers[Q];H&&(f&&H.dispose(),this._userInstancedBuffersStorage.vertexBuffers[Q]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(f)}_freeze(){if(this.ge){for(let f=0;f<this.ge.length;f++)this._getInstancesRenderList(f);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(f,Q,H,X){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const S=this._scene.getEngine(),x=S.currentRenderPassId;if(void 0!==f&&(S.currentRenderPassId=f),X)(!i||i&&X.isInFrustum(this._scene._frustumPlanes))&&this.render(X,!!Q,H);else for(let K=0;K<this.ge.length;K++){const f=this.ge[K];(!i||i&&f.isInFrustum(this._scene._frustumPlanes))&&this.render(f,!!Q,H)}return void 0!==f&&(S.currentRenderPassId=x),this}directRender(){if(!this.ge)return this;for(const f of this.ge)this.render(f,!1);return this}render(f,Q,H){var X,i,S;const x=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const K=(null===(X=x.activeCameras)||void 0===X?void 0:X.length)??0;if((K>1&&x.activeCamera===x.activeCameras[0]||K<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const Z=this._getInstancesRenderList(f._id,!!H);if(Z.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const B=x.getEngine();let N=0,J=null;this.ignoreCameraMaxZ&&x.activeCamera&&!x._isInIntermediateRendering()&&(N=x.activeCamera.maxZ,J=x.activeCamera,x.activeCamera.maxZ=0,x.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const g=f.getRenderingMesh(),z=Z.hardwareInstancedRendering[f._id]||g.hasThinInstances||!!this._userInstancedBuffersStorage&&!f.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,v=this._instanceDataStorage,Y=f.Ha();if(!Y)return J&&(J.maxZ=N,x.updateTransformMatrix(!0)),this;if(v.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===Y){if(Y._storeEffectOnSubMeshes&&(null===(i=f._drawWrapper)||void 0===i||!i._wasPreviouslyReady)||!Y._storeEffectOnSubMeshes&&!Y._getDrawWrapper()._wasPreviouslyReady)return J&&(J.maxZ=N,x.updateTransformMatrix(!0)),this}else{if(Y._storeEffectOnSubMeshes){if(!Y.isReadyForSubMesh(this,f,z))return J&&(J.maxZ=N,x.updateTransformMatrix(!0)),this}else if(!Y.isReady(this,z))return J&&(J.maxZ=N,x.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=Y}let O;Q&&B.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),O=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?f._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const e=(null===(S=O)||void 0===S?void 0:S.effect)??null;for(const n of x._beforeRenderingMeshStage)n.action(this,f,Z,e);if(!O||!e)return J&&(J.maxZ=N,x.updateTransformMatrix(!0)),this;const G=H||this;let I;if(v.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.we&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)I=v.sideOrientation;else{const f=G._getWorldMatrixDeterminant();I=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),f<0&&(I=I===n.e.ClockWiseSideOrientation?n.e.CounterClockWiseSideOrientation:n.e.ClockWiseSideOrientation),v.sideOrientation=I}const l=this._internalMeshDataInfo._effectiveMaterial._preBind(O,I);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&B.setDepthWrite(!0);const q=this._internalMeshDataInfo._effectiveMaterial,D=q.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),z||this._bind(f,e,D,!1);const d=G.getWorldMatrix();q._storeEffectOnSubMeshes?q.bindForSubMesh(d,this,f):q.bind(d,this),!q.we&&q.separateCullingPass&&(B.setState(!0,q.zOffset,!1,!l,q.cullBackFaces,q.stencil,q.zOffsetUnits),this._processRendering(this,f,e,D,Z,z,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),B.setState(!0,q.zOffset,!1,l,q.cullBackFaces,q.stencil,q.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(f)),this._processRendering(this,f,e,D,Z,z,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const n of x._afterRenderingMeshStage)n.action(this,f,Z,e);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),J&&(J.maxZ=N,x.updateTransformMatrix(!0)),2!==x.performancePriority||v.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(g.e.MatricesWeightsKind)&&(this.isVerticesDataPresent(g.e.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const f=this.getVerticesData(g.e.MatricesWeightsKind),Q=f.length;for(let H=0;H<Q;H+=4){const Q=f[H]+f[H+1]+f[H+2]+f[H+3];if(0===Q)f[H]=1;else{const X=1/Q;f[H]*=X,f[H+1]*=X,f[H+2]*=X,f[H+3]*=X}}this.Ga(g.e.MatricesWeightsKind,f)}_normalizeSkinWeightsAndExtra(){const f=this.getVerticesData(g.e.MatricesWeightsExtraKind),Q=this.getVerticesData(g.e.MatricesWeightsKind),H=Q.length;for(let X=0;X<H;X+=4){let H=Q[X]+Q[X+1]+Q[X+2]+Q[X+3];if(H+=f[X]+f[X+1]+f[X+2]+f[X+3],0===H)Q[X]=1;else{const i=1/H;Q[X]*=i,Q[X+1]*=i,Q[X+2]*=i,Q[X+3]*=i,f[X]*=i,f[X+1]*=i,f[X+2]*=i,f[X+3]*=i}}this.Ga(g.e.MatricesWeightsKind,Q),this.Ga(g.e.MatricesWeightsKind,f)}validateSkinning(){const f=this.getVerticesData(g.e.MatricesWeightsExtraKind),Q=this.getVerticesData(g.e.MatricesWeightsKind);if(null===Q||null==this.skeleton)return{skinned:!1,valid:!0,Qe:"not skinned"};const H=Q.length;let X=0,i=0,S=0,x=0;const K=null===f?4:8,Z=[];for(let g=0;g<=K;g++)Z[g]=0;for(let g=0;g<H;g+=4){let H=Q[g],B=H,N=0===B?0:1;for(let i=1;i<K;i++){const S=i<4?Q[g+i]:f[g+i-4];S>H&&X++,0!==S&&N++,B+=S,H=S}if(Z[N]++,N>S&&(S=N),0===B)i++;else{const H=1/B;let X=0;for(let i=0;i<K;i++)X+=i<4?Math.abs(Q[g+i]-Q[g+i]*H):Math.abs(f[g+i-4]-f[g+i-4]*H);X>.001&&x++}}const B=this.skeleton.bones.length,N=this.getVerticesData(g.e.MatricesIndicesKind),J=this.getVerticesData(g.e.MatricesIndicesExtraKind);let z=0;for(let g=0;g<H;g+=4)for(let f=0;f<K;f++){const Q=f<4?N[g+f]:J[g+f-4];(Q>=B||Q<0)&&z++}return{skinned:!0,valid:0===i&&0===x&&0===z,Qe:"Number of Weights = "+H/4+"\nMaximum influences = "+S+"\nMissing Weights = "+i+"\nNot Sorted = "+X+"\nNot Normalized = "+x+"\nWeightCounts = ["+Z+"]\nNumber of bones = "+B+"\nBad Bone Indices = "+z}}_checkDelayState(){const f=this.va();return this._geometry?this._geometry.load(f):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(f)),this}_queueLoad(f){f.addPendingData(this);const Q=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return i.g.LoadFile(this.delayLoadingFile,(Q=>{Q instanceof ArrayBuffer?this._delayLoadingFunction(Q,this):this._delayLoadingFunction(JSON.parse(Q),this),this.instances.forEach((f=>{f.refreshBoundingInfo(),f._syncSubMeshes()})),this.delayLoadState=1,f.removePendingData(this)}),(()=>{}),f.offlineProvider,Q),this}isInFrustum(f){return 2!==this.delayLoadState&&(!!super.isInFrustum(f)&&(this._checkDelayState(),!0))}setMaterialById(f){const Q=this.va().materials;let H;for(H=Q.length-1;H>-1;H--)if(Q[H].id===f)return this.material=Q[H],this;const X=this.va().multiMaterials;for(H=X.length-1;H>-1;H--)if(X[H].id===f)return this.material=X[H],this;return this}getAnimatables(){const f=[];return this.material&&f.push(this.material),this.skeleton&&f.push(this.skeleton),f}bakeTransformIntoVertices(f){if(!this.isVerticesDataPresent(g.e.PositionKind))return this;const Q=this.ge.splice(0);this._resetPointsArrayCache();let H=this.getVerticesData(g.e.PositionKind);const X=B.p.Zero();let i;for(i=0;i<H.length;i+=3)B.p.TransformCoordinatesFromFloatsToRef(H[i],H[i+1],H[i+2],f,X).toArray(H,i);if(this.Ga(g.e.PositionKind,H,this.getVertexBuffer(g.e.PositionKind).isUpdatable()),this.isVerticesDataPresent(g.e.NormalKind)){for(H=this.getVerticesData(g.e.NormalKind),i=0;i<H.length;i+=3)B.p.TransformNormalFromFloatsToRef(H[i],H[i+1],H[i+2],f,X).normalize().toArray(H,i);this.Ga(g.e.NormalKind,H,this.getVertexBuffer(g.e.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(g.e.TangentKind)){for(H=this.getVerticesData(g.e.TangentKind),i=0;i<H.length;i+=4)B.p.TransformNormalFromFloatsToRef(H[i],H[i+1],H[i+2],f,X).normalize().toArray(H,i);this.Ga(g.e.TangentKind,H,this.getVertexBuffer(g.e.TangentKind).isUpdatable())}return f.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.ge=Q,this}bakeCurrentTransformIntoVertices(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.re(!0)),this.resetLocalMatrix(f),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0,H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new R(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),f,this,Q,H)}dispose(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const H=this._internalMeshDataInfo;if(H._onBeforeDrawObservable&&H._onBeforeDrawObservable.clear(),H._onBeforeBindObservable&&H._onBeforeBindObservable.clear(),H._onBeforeRenderObservable&&H._onBeforeRenderObservable.clear(),H._onAfterRenderObservable&&H._onAfterRenderObservable.clear(),H._onBetweenPassObservable&&H._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(H.meshMap)for(const f in H.meshMap){const Q=H.meshMap[f];Q&&(Q._internalMeshDataInfo._source=null,H.meshMap[f]=void 0)}H._source&&H._source._internalMeshDataInfo.meshMap&&(H._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const f=this.va().meshes;for(const Q of f){const f=Q;f._internalMeshDataInfo&&f._internalMeshDataInfo._source&&f._internalMeshDataInfo._source===this&&(f._internalMeshDataInfo._source=null)}}H._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(f,Q)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(f,Q,H,X,S,x){let K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Z=arguments.length>7?arguments[7]:void 0;const B=this.va();return i.g.LoadImage(f,(f=>{const i=f.width,Z=f.height,B=this.getEngine().createCanvas(i,Z).getContext("2d");B.drawImage(f,0,0);const N=B.getImageData(0,0,i,Z).data;this.applyDisplacementMapFromBuffer(N,i,Z,Q,H,S,x,K),X&&X(this)}),Z||(()=>{}),B.offlineProvider),this}applyDisplacementMapFromBuffer(f,Q,H,X,i,S,x){let K=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(g.e.PositionKind)||!this.isVerticesDataPresent(g.e.NormalKind)||!this.isVerticesDataPresent(g.e.UVKind))return l.b.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const Z=this.getVerticesData(g.e.PositionKind,!0,!0),N=this.getVerticesData(g.e.NormalKind),J=this.getVerticesData(g.e.UVKind);let v=B.p.Zero();const Y=B.p.Zero(),O=B.m.Zero();S=S||B.m.Zero(),x=x||new B.m(1,1);for(let g=0;g<Z.length;g+=3){B.p.FromArrayToRef(Z,g,v),B.p.FromArrayToRef(N,g,Y),B.m.FromArrayToRef(J,g/3*2,O);const K=4*((Math.abs(O.x*x.x+S.x%1)*(Q-1)%Q|0)+(Math.abs(O.y*x.y+S.y%1)*(H-1)%H|0)*Q),z=.3*(f[K]/255)+.59*(f[K+1]/255)+.11*(f[K+2]/255);Y.normalize(),Y.scaleInPlace(X+(i-X)*z),v=v.add(Y),v.toArray(Z,g)}return z.b.ComputeNormals(Z,this.Ud(),N),K?(this.Ga(g.e.PositionKind,Z),this.Ga(g.e.NormalKind,N),this.Ga(g.e.UVKind,J)):(this.updateVerticesData(g.e.PositionKind,Z),this.updateVerticesData(g.e.NormalKind,N)),this}_getFlattenedNormals(f,Q){const H=new Float32Array(3*f.length);let X=0;const i=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let S=0;S<f.length;S+=3){const x=B.p.Zd(Q,3*f[S]),K=B.p.Zd(Q,3*f[S+1]),Z=B.p.Zd(Q,3*f[S+2]),N=x.hd(K),J=Z.hd(K),g=B.p.Normalize(B.p.Cross(N,J));i&&g.scaleInPlace(-1);for(let f=0;f<3;f++)H[X++]=g.x,H[X++]=g.y,H[X++]=g.z}return H}_convertToUnIndexedMesh(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Q=this.getVerticesDataKinds().filter((f=>{var Q;return!(null!==(Q=this.getVertexBuffer(f))&&void 0!==Q&&Q.getIsInstanced())})),H=this.Ud(),X={},i=(f,Q)=>{const X=new Float32Array(H.length*Q);let i=0;for(let S=0;S<H.length;S++)for(let x=0;x<Q;x++)X[i++]=f[H[S]*Q+x];return X},S=this.getBoundingInfo(),x=this.ze?this.ge.slice(0):[];for(const K of Q)X[K]=this.getVerticesData(K);for(const K of Q){const Q=this.getVertexBuffer(K),S=Q.getSize();if(f&&K===g.e.NormalKind){const f=this._getFlattenedNormals(H,X[g.e.PositionKind]);this.Ga(g.e.NormalKind,f,Q.isUpdatable(),S)}else this.Ga(K,i(X[K],S),Q.isUpdatable(),S)}if(this.morphTargetManager){for(let Q=0;Q<this.morphTargetManager.numTargets;Q++){const X=this.morphTargetManager.getTarget(Q),S=X.getPositions();X.setPositions(i(S,3));const x=X.getNormals();x&&X.setNormals(f?this._getFlattenedNormals(H,S):i(x,3));const K=X.getTangents();K&&X.setTangents(i(K,3));const Z=X.getUVs();Z&&X.setUVs(i(Z,2))}this.morphTargetManager.synchronize()}for(let K=0;K<H.length;K++)H[K]=K;this.setIndices(H),this._unIndexed=!0,this.releaseSubMeshes();for(const K of x){const f=K.getBoundingInfo();O.c.AddToMesh(K.materialIndex,K.indexStart,K.indexCount,K.indexStart,K.indexCount,this).setBoundingInfo(f)}return this.setBoundingInfo(S),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Q=z.b.ExtractFromMesh(this);let H;if(f&&this.isVerticesDataPresent(g.e.NormalKind)&&Q.ya){for(H=0;H<Q.ya.length;H++)Q.ya[H]*=-1;this.Ga(g.e.NormalKind,Q.ya,this.isVertexBufferUpdatable(g.e.NormalKind))}if(Q.indices){let f;for(H=0;H<Q.indices.length;H+=3)f=Q.indices[H+1],Q.indices[H+1]=Q.indices[H+2],Q.indices[H+2]=f;this.setIndices(Q.indices,null,this.isVertexBufferUpdatable(g.e.PositionKind),!0)}return this}increaseVertices(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const Q=z.b.ExtractFromMesh(this),H=Q.indices&&!Array.isArray(Q.indices)&&Array.from?Array.from(Q.indices):Q.indices,X=Q.xa&&!Array.isArray(Q.xa)&&Array.from?Array.from(Q.xa):Q.xa,i=Q.Aa&&!Array.isArray(Q.Aa)&&Array.from?Array.from(Q.Aa):Q.Aa,S=Q.ya&&!Array.isArray(Q.ya)&&Array.from?Array.from(Q.ya):Q.ya;if(H&&X){Q.indices=H,Q.xa=X,i&&(Q.Aa=i),S&&(Q.ya=S);const x=f+1,K=new Array;for(let f=0;f<x+1;f++)K[f]=new Array;let Z,N;const J=new B.p(0,0,0),z=new B.p(0,0,0),v=new B.m(0,0),Y=new Array,O=new Array,n=new Array;let e,G,I,l=X.length;i&&(G=i.length),S&&(I=S.length);for(let f=0;f<H.length;f+=3){O[0]=H[f],O[1]=H[f+1],O[2]=H[f+2];for(let f=0;f<3;f++)if(Z=O[f],N=O[(f+1)%3],void 0===n[Z]&&void 0===n[N]?(n[Z]=new Array,n[N]=new Array):(void 0===n[Z]&&(n[Z]=new Array),void 0===n[N]&&(n[N]=new Array)),void 0===n[Z][N]&&void 0===n[N][Z]){n[Z][N]=[],J.x=(X[3*N]-X[3*Z])/x,J.y=(X[3*N+1]-X[3*Z+1])/x,J.z=(X[3*N+2]-X[3*Z+2])/x,S&&(z.x=(S[3*N]-S[3*Z])/x,z.y=(S[3*N+1]-S[3*Z+1])/x,z.z=(S[3*N+2]-S[3*Z+2])/x),i&&(v.x=(i[2*N]-i[2*Z])/x,v.y=(i[2*N+1]-i[2*Z+1])/x),n[Z][N].push(Z);for(let f=1;f<x;f++)n[Z][N].push(X.length/3),X[l++]=X[3*Z]+f*J.x,X[l++]=X[3*Z+1]+f*J.y,X[l++]=X[3*Z+2]+f*J.z,S&&(S[I++]=S[3*Z]+f*z.x,S[I++]=S[3*Z+1]+f*z.y,S[I++]=S[3*Z+2]+f*z.z),i&&(i[G++]=i[2*Z]+f*v.x,i[G++]=i[2*Z+1]+f*v.y);n[Z][N].push(N),n[N][Z]=new Array,e=n[Z][N].length;for(let f=0;f<e;f++)n[N][Z][f]=n[Z][N][e-1-f]}K[0][0]=H[f],K[1][0]=n[H[f]][H[f+1]][1],K[1][1]=n[H[f]][H[f+2]][1];for(let Q=2;Q<x;Q++){K[Q][0]=n[H[f]][H[f+1]][Q],K[Q][Q]=n[H[f]][H[f+2]][Q],J.x=(X[3*K[Q][Q]]-X[3*K[Q][0]])/Q,J.y=(X[3*K[Q][Q]+1]-X[3*K[Q][0]+1])/Q,J.z=(X[3*K[Q][Q]+2]-X[3*K[Q][0]+2])/Q,S&&(z.x=(S[3*K[Q][Q]]-S[3*K[Q][0]])/Q,z.y=(S[3*K[Q][Q]+1]-S[3*K[Q][0]+1])/Q,z.z=(S[3*K[Q][Q]+2]-S[3*K[Q][0]+2])/Q),i&&(v.x=(i[2*K[Q][Q]]-i[2*K[Q][0]])/Q,v.y=(i[2*K[Q][Q]+1]-i[2*K[Q][0]+1])/Q);for(let f=1;f<Q;f++)K[Q][f]=X.length/3,X[l++]=X[3*K[Q][0]]+f*J.x,X[l++]=X[3*K[Q][0]+1]+f*J.y,X[l++]=X[3*K[Q][0]+2]+f*J.z,S&&(S[I++]=S[3*K[Q][0]]+f*z.x,S[I++]=S[3*K[Q][0]+1]+f*z.y,S[I++]=S[3*K[Q][0]+2]+f*z.z),i&&(i[G++]=i[2*K[Q][0]]+f*v.x,i[G++]=i[2*K[Q][0]+1]+f*v.y)}K[x]=n[H[f+1]][H[f+2]],Y.push(K[0][0],K[1][0],K[1][1]);for(let f=1;f<x;f++){let Q;for(Q=0;Q<f;Q++)Y.push(K[f][Q],K[f+1][Q],K[f+1][Q+1]),Y.push(K[f][Q],K[f+1][Q+1],K[f][Q+1]);Y.push(K[f][Q],K[f+1][Q],K[f+1][Q+1])}}Q.indices=Y,Q.Ca(this,this.isVertexBufferUpdatable(g.e.PositionKind))}else l.b.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const f=z.b.ExtractFromMesh(this),Q=f.Aa,H=f.indices,X=f.xa,i=f.za,S=f.matricesIndices,x=f.matricesWeights,K=f.matricesIndicesExtra,Z=f.matricesWeightsExtra;if(void 0===H||void 0===X||null===H||null===X)l.b.Warn("VertexData contains empty entries");else{const B=new Array,N=new Array,J=new Array,v=new Array,Y=new Array,O=new Array,n=new Array,e=new Array;let G=new Array,I=0;const l={};let q,D;for(let f=0;f<H.length;f+=3){D=[H[f],H[f+1],H[f+2]],G=[];for(let f=0;f<3;f++){G[f]="";for(let Q=0;Q<3;Q++)Math.abs(X[3*D[f]+Q])<1e-8&&(X[3*D[f]+Q]=0),G[f]+=X[3*D[f]+Q]+"|"}if(G[0]!=G[1]&&G[0]!=G[2]&&G[1]!=G[2])for(let f=0;f<3;f++){if(q=l[G[f]],void 0===q){l[G[f]]=I,q=I++;for(let Q=0;Q<3;Q++)B.push(X[3*D[f]+Q]);if(null!==i&&void 0!==i)for(let Q=0;Q<4;Q++)v.push(i[4*D[f]+Q]);if(null!==Q&&void 0!==Q)for(let H=0;H<2;H++)J.push(Q[2*D[f]+H]);if(null!==S&&void 0!==S)for(let Q=0;Q<4;Q++)Y.push(S[4*D[f]+Q]);if(null!==x&&void 0!==x)for(let Q=0;Q<4;Q++)O.push(x[4*D[f]+Q]);if(null!==K&&void 0!==K)for(let Q=0;Q<4;Q++)n.push(K[4*D[f]+Q]);if(null!==Z&&void 0!==Z)for(let Q=0;Q<4;Q++)e.push(Z[4*D[f]+Q])}N.push(q)}}const d=new Array;z.b.ComputeNormals(B,N,d),f.xa=B,f.indices=N,f.ya=d,null!==Q&&void 0!==Q&&(f.Aa=J),null!==i&&void 0!==i&&(f.za=v),null!==S&&void 0!==S&&(f.matricesIndices=Y),null!==x&&void 0!==x&&(f.matricesWeights=O),null!==K&&void 0!==K&&(f.matricesIndicesExtra=n),null!==x&&void 0!==x&&(f.matricesWeightsExtra=e),f.Ca(this,this.isVertexBufferUpdatable(g.e.PositionKind))}}static _instancedMeshFactory(f,Q){throw(0,D.c)("InstancedMesh")}static _PhysicsImpostorParser(f,Q,H){throw(0,D.c)("PhysicsImpostor")}yd(f){const Q=R._instancedMeshFactory(f,this);return Q.parent=this.parent,Q}synchronizeInstances(){for(let f=0;f<this.instances.length;f++){this.instances[f]._syncSubMeshes()}return this}optimizeIndices(f){const Q=this.Ud(),H=this.getVerticesData(g.e.PositionKind);if(!H||!Q)return this;const X=[];for(let i=0;i<H.length;i+=3)X.push(B.p.Zd(H,i));const S=[];return i.c.SyncAsyncForLoop(X.length,40,(f=>{const Q=X.length-1-f,H=X[Q];for(let i=0;i<Q;++i){const f=X[i];if(H.equals(f)){S[Q]=i;break}}}),(()=>{for(let f=0;f<Q.length;++f)Q[f]=S[Q[f]]||Q[f];const H=this.ge.slice(0);this.setIndices(Q),this.ge=H,f&&f(this)})),this}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f.name=this.name,f.id=this.id,f.uniqueId=this.uniqueId,f.type=this.getClassName(),x.b&&x.b.HasTags(this)&&(f.tags=x.b.GetTags(this)),f.position=this.position.ke(),this.rotationQuaternion?f.rotationQuaternion=this.rotationQuaternion.ke():this.rotation&&(f.rotation=this.rotation.ke()),f.He=this.He.ke(),this._postMultiplyPivotMatrix?f.pivotMatrix=this.getPivotMatrix().ke():f.localMatrix=this.getPivotMatrix().ke(),f.isEnabled=this.isEnabled(!1),f.isVisible=this.isVisible,f.infiniteDistance=this.infiniteDistance,f.pickable=this.Te,f.receiveShadows=this.receiveShadows,f.billboardMode=this.billboardMode,f.visibility=this.visibility,f.ef=this.ef,f.checkCollisions=this.checkCollisions,f.ellipsoid=this.ellipsoid.ke(),f.ellipsoidOffset=this.ellipsoidOffset.ke(),f.Da=this.Da,f.isBlocker=this.isBlocker,f.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(f),f.isUnIndexed=this.isUnIndexed;const Q=this._geometry;if(Q&&this.ge){f.geometryUniqueId=Q.uniqueId,f.geometryId=Q.id,f.ge=[];for(let Q=0;Q<this.ge.length;Q++){const H=this.ge[Q];f.ge.push({materialIndex:H.materialIndex,verticesStart:H.verticesStart,verticesCount:H.verticesCount,indexStart:H.indexStart,indexCount:H.indexCount})}}if(this.material?this.material.doNotSerialize||(f.materialUniqueId=this.material.uniqueId,f.materialId=this.material.id):(this.material=null,f.materialUniqueId=this._scene.defaultMaterial.uniqueId,f.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(f.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(f.skeletonId=this.skeleton.id,f.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(d.e.NAME_PHYSICSENGINE)){const Q=this.getPhysicsImpostor();Q&&(f.physicsMass=Q.getParam("mass"),f.physicsFriction=Q.getParam("friction"),f.physicsRestitution=Q.getParam("mass"),f.physicsImpostor=Q.type)}this.metadata&&(f.metadata=this.metadata),f.instances=[];for(let H=0;H<this.instances.length;H++){const Q=this.instances[H];if(Q.doNotSerialize)continue;const X={name:Q.name,id:Q.id,isEnabled:Q.isEnabled(!1),isVisible:Q.isVisible,Te:Q.Te,checkCollisions:Q.checkCollisions,position:Q.position.ke(),He:Q.He.ke()};if(Q.parent&&Q.parent._serializeAsParent(X),Q.rotationQuaternion?X.rotationQuaternion=Q.rotationQuaternion.ke():Q.rotation&&(X.rotation=Q.rotation.ke()),this.va()._getComponent(d.e.NAME_PHYSICSENGINE)){const f=Q.getPhysicsImpostor();f&&(X.physicsMass=f.getParam("mass"),X.physicsFriction=f.getParam("friction"),X.physicsRestitution=f.getParam("mass"),X.physicsImpostor=f.type)}Q.metadata&&(X.metadata=Q.metadata),Q.actionManager&&(X.actions=Q.actionManager.serialize(Q.name)),f.instances.push(X),I.b.AppendSerializedAnimations(Q,X),X.ranges=Q.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(f.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const Q={data:{},sizes:{},strides:{}};for(const f in this._userThinInstanceBuffersStorage.data)Q.data[f]=Array.from(this._userThinInstanceBuffersStorage.data[f]),Q.sizes[f]=this._userThinInstanceBuffersStorage.sizes[f],Q.strides[f]=this._userThinInstanceBuffersStorage.strides[f];f.thinInstances.userThinInstance=Q}return I.b.AppendSerializedAnimations(this,f),f.ranges=this.serializeAnimationRanges(),f.layerMask=this.layerMask,f.alphaIndex=this.alphaIndex,f.hasVertexAlpha=this.hasVertexAlpha,f.overlayAlpha=this.overlayAlpha,f.overlayColor=this.overlayColor.ke(),f.renderOverlay=this.renderOverlay,f.applyFog=this.applyFog,this.actionManager&&(f.actions=this.actionManager.serialize(this.name)),f}_syncGeometryWithMorphTargetManager(){if(!this.ze)return;this._markSubMeshesAsAttributesDirty();const f=this._internalAbstractMeshDataInfo._morphTargetManager;if(f&&f.vertexCount){if(f.vertexCount!==this.getTotalVertices())return l.b.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(f.isUsingTextureForTargets)return;for(let Q=0;Q<f.numInfluencers;Q++){const H=f.getActiveTarget(Q),X=H.getPositions();if(!X)return void l.b.Error("Invalid morph target. Target must have positions.");this.ze.Ga(g.e.PositionKind+Q,X,!1,3);const i=H.getNormals();i&&this.ze.Ga(g.e.NormalKind+Q,i,!1,3);const S=H.getTangents();S&&this.ze.Ga(g.e.TangentKind+Q,S,!1,3);const x=H.getUVs();x&&this.ze.Ga(g.e.UVKind+"_"+Q,x,!1,2)}}else{let f=0;for(;this.ze.isVerticesDataPresent(g.e.PositionKind+f);)this.ze.removeVerticesData(g.e.PositionKind+f),this.ze.isVerticesDataPresent(g.e.NormalKind+f)&&this.ze.removeVerticesData(g.e.NormalKind+f),this.ze.isVerticesDataPresent(g.e.TangentKind+f)&&this.ze.removeVerticesData(g.e.TangentKind+f),this.ze.isVerticesDataPresent(g.e.UVKind+f)&&this.ze.removeVerticesData(g.e.UVKind+"_"+f),f++}}static Parse(f,Q,H){let X;if(X=f.type&&"LinesMesh"===f.type?R._LinesMeshParser(f,Q):f.type&&"GroundMesh"===f.type?R._GroundMeshParser(f,Q):f.type&&"GoldbergMesh"===f.type?R._GoldbergMeshParser(f,Q):f.type&&"GreasedLineMesh"===f.type?R._GreasedLineMeshParser(f,Q):f.type&&"TrailMesh"===f.type?R._TrailMeshParser(f,Q):new R(f.name,Q),X.id=f.id,X._waitingParsedUniqueId=f.uniqueId,x.b&&x.b.AddTagsTo(X,f.tags),X.position=B.p.Zd(f.position),void 0!==f.metadata&&(X.metadata=f.metadata),f.rotationQuaternion?X.rotationQuaternion=B.i.Zd(f.rotationQuaternion):f.rotation&&(X.rotation=B.p.Zd(f.rotation)),X.He=B.p.Zd(f.He),f.localMatrix?X.setPreTransformMatrix(B.e.Zd(f.localMatrix)):f.pivotMatrix&&X.setPivotMatrix(B.e.Zd(f.pivotMatrix)),X.Dg(f.isEnabled),X.isVisible=f.isVisible,X.infiniteDistance=f.infiniteDistance,X.ef=!!f.ef,X.showBoundingBox=f.showBoundingBox,X.showSubMeshesBoundingBox=f.showSubMeshesBoundingBox,void 0!==f.applyFog&&(X.applyFog=f.applyFog),void 0!==f.pickable&&(X.Te=f.pickable),void 0!==f.alphaIndex&&(X.alphaIndex=f.alphaIndex),X.receiveShadows=f.receiveShadows,void 0!==f.billboardMode&&(X.billboardMode=f.billboardMode),void 0!==f.visibility&&(X.visibility=f.visibility),X.checkCollisions=f.checkCollisions,X.Da=!!f.Da,f.ellipsoid&&(X.ellipsoid=B.p.Zd(f.ellipsoid)),f.ellipsoidOffset&&(X.ellipsoidOffset=B.p.Zd(f.ellipsoidOffset)),null!=f.overrideMaterialSideOrientation&&(X.sideOrientation=f.overrideMaterialSideOrientation),void 0!==f.sideOrientation&&(X.sideOrientation=f.sideOrientation),void 0!==f.isBlocker&&(X.isBlocker=f.isBlocker),X._shouldGenerateFlatShading=f.useFlatShading,f.hi&&(X._waitingData.hi=f.hi),void 0!==f.parentId&&(X._waitingParentId=f.parentId),void 0!==f.parentInstanceIndex&&(X._waitingParentInstanceIndex=f.parentInstanceIndex),void 0!==f.actions&&(X._waitingData.actions=f.actions),void 0!==f.overlayAlpha&&(X.overlayAlpha=f.overlayAlpha),void 0!==f.overlayColor&&(X.overlayColor=N.e.Zd(f.overlayColor)),void 0!==f.renderOverlay&&(X.renderOverlay=f.renderOverlay),X.isUnIndexed=!!f.isUnIndexed,X.hasVertexAlpha=f.hasVertexAlpha,f.delayLoadingFile?(X.delayLoadState=4,X.delayLoadingFile=H+f.delayLoadingFile,X.buildBoundingInfo(B.p.Zd(f.boundingBoxMinimum),B.p.Zd(f.boundingBoxMaximum)),f._binaryInfo&&(X._binaryInfo=f._binaryInfo),X._delayInfo=[],f.hasUVs&&X._delayInfo.push(g.e.UVKind),f.hasUVs2&&X._delayInfo.push(g.e.UV2Kind),f.hasUVs3&&X._delayInfo.push(g.e.UV3Kind),f.hasUVs4&&X._delayInfo.push(g.e.UV4Kind),f.hasUVs5&&X._delayInfo.push(g.e.UV5Kind),f.hasUVs6&&X._delayInfo.push(g.e.UV6Kind),f.hasColors&&X._delayInfo.push(g.e.ColorKind),f.hasMatricesIndices&&X._delayInfo.push(g.e.MatricesIndicesKind),f.hasMatricesWeights&&X._delayInfo.push(g.e.MatricesWeightsKind),X._delayLoadingFunction=v.b._ImportGeometry,G.c.ForceFullSceneLoadingForIncremental&&X._checkDelayState()):v.b._ImportGeometry(f,X),f.materialUniqueId?X._waitingMaterialId=f.materialUniqueId:f.materialId&&(X._waitingMaterialId=f.materialId),f.morphTargetManagerId>-1&&(X._waitingMorphTargetManagerId=f.morphTargetManagerId),void 0!==f.skeletonId&&null!==f.skeletonId&&(X.skeleton=Q.getLastSkeletonById(f.skeletonId),f.numBoneInfluencers&&(X.numBoneInfluencers=f.numBoneInfluencers)),f.animations){for(let Q=0;Q<f.animations.length;Q++){const H=f.animations[Q],i=(0,q.e)("BABYLON.Animation");i&&X.animations.push(i.Parse(H))}J.e.ParseAnimationRanges(X,f,Q)}if(f.autoAnimate&&Q.beginAnimation(X,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1),f.layerMask&&!isNaN(f.layerMask)?X.layerMask=Math.abs(parseInt(f.layerMask)):X.layerMask=268435455,f.physicsImpostor&&(X.physicsImpostor=R._PhysicsImpostorParser(Q,X,f)),f.lodMeshIds&&(X._waitingData.lods={ids:f.lodMeshIds,distances:f.lodDistances?f.lodDistances:null,coverages:f.lodCoverages?f.lodCoverages:null}),f.instances)for(let i=0;i<f.instances.length;i++){const H=f.instances[i],S=X.yd(H.name);if(H.id&&(S.id=H.id),x.b&&(H.tags?x.b.AddTagsTo(S,H.tags):x.b.AddTagsTo(S,f.tags)),S.position=B.p.Zd(H.position),void 0!==H.metadata&&(S.metadata=H.metadata),void 0!==H.parentId&&(S._waitingParentId=H.parentId),void 0!==H.parentInstanceIndex&&(S._waitingParentInstanceIndex=H.parentInstanceIndex),void 0!==H.isEnabled&&null!==H.isEnabled&&S.Dg(H.isEnabled),void 0!==H.isVisible&&null!==H.isVisible&&(S.isVisible=H.isVisible),void 0!==H.Te&&null!==H.Te&&(S.Te=H.Te),H.rotationQuaternion?S.rotationQuaternion=B.i.Zd(H.rotationQuaternion):H.rotation&&(S.rotation=B.p.Zd(H.rotation)),S.He=B.p.Zd(H.He),void 0!=H.checkCollisions&&null!=H.checkCollisions&&(S.checkCollisions=H.checkCollisions),void 0!=H.pickable&&null!=H.pickable&&(S.Te=H.pickable),void 0!=H.showBoundingBox&&null!=H.showBoundingBox&&(S.showBoundingBox=H.showBoundingBox),void 0!=H.showSubMeshesBoundingBox&&null!=H.showSubMeshesBoundingBox&&(S.showSubMeshesBoundingBox=H.showSubMeshesBoundingBox),void 0!=H.alphaIndex&&null!=H.showSubMeshesBoundingBox&&(S.alphaIndex=H.alphaIndex),H.physicsImpostor&&(S.physicsImpostor=R._PhysicsImpostorParser(Q,S,H)),void 0!==H.actions&&(S._waitingData.actions=H.actions),H.animations){for(let f=0;f<H.animations.length;f++){const Q=H.animations[f],X=(0,q.e)("BABYLON.Animation");X&&S.animations.push(X.Parse(Q))}J.e.ParseAnimationRanges(S,H,Q),H.autoAnimate&&Q.beginAnimation(S,H.autoAnimateFrom,H.autoAnimateTo,H.autoAnimateLoop,H.autoAnimateSpeed||1)}}if(f.thinInstances){const Q=f.thinInstances;if(X.thinInstanceEnablePicking=!!Q.enablePicking,Q.matrixData?(X.$j("matrix",new Float32Array(Q.matrixData),16,!1),X._thinInstanceDataStorage.matrixBufferSize=Q.matrixBufferSize,X._thinInstanceDataStorage.instancesCount=Q.instancesCount):X._thinInstanceDataStorage.matrixBufferSize=Q.matrixBufferSize,f.thinInstances.userThinInstance){const Q=f.thinInstances.userThinInstance;for(const f in Q.data)X.$j(f,new Float32Array(Q.data[f]),Q.strides[f],!1),X._userThinInstanceBuffersStorage.sizes[f]=Q.sizes[f]}}return X}setPositionsForCPUSkinning(){const f=this._internalMeshDataInfo;if(!f._sourcePositions){const Q=this.getVerticesData(g.e.PositionKind);if(!Q)return f._sourcePositions;f._sourcePositions=new Float32Array(Q),this.isVertexBufferUpdatable(g.e.PositionKind)||this.Ga(g.e.PositionKind,Q,!0)}return f._sourcePositions}setNormalsForCPUSkinning(){const f=this._internalMeshDataInfo;if(!f._sourceNormals){const Q=this.getVerticesData(g.e.NormalKind);if(!Q)return f._sourceNormals;f._sourceNormals=new Float32Array(Q),this.isVertexBufferUpdatable(g.e.NormalKind)||this.Ga(g.e.NormalKind,Q,!0)}return f._sourceNormals}applySkeleton(f){if(!this.ze)return this;if(this.ze._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.ze._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(g.e.PositionKind))return this;if(!this.isVerticesDataPresent(g.e.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(g.e.MatricesWeightsKind))return this;const Q=this.isVerticesDataPresent(g.e.NormalKind),H=this._internalMeshDataInfo;if(!H._sourcePositions){const f=this.ge.slice();this.setPositionsForCPUSkinning(),this.ge=f}Q&&!H._sourceNormals&&this.setNormalsForCPUSkinning();let X=this.getVerticesData(g.e.PositionKind);if(!X)return this;X instanceof Float32Array||(X=new Float32Array(X));let i=this.getVerticesData(g.e.NormalKind);if(Q){if(!i)return this;i instanceof Float32Array||(i=new Float32Array(i))}const S=this.getVerticesData(g.e.MatricesIndicesKind),x=this.getVerticesData(g.e.MatricesWeightsKind);if(!x||!S)return this;const K=this.numBoneInfluencers>4,Z=K?this.getVerticesData(g.e.MatricesIndicesExtraKind):null,N=K?this.getVerticesData(g.e.MatricesWeightsExtraKind):null,J=f.getTransformMatrices(this),z=B.p.Zero(),v=new B.e,Y=new B.e;let O,n=0;for(let g=0;g<X.length;g+=3,n+=4){let f;for(O=0;O<4;O++)f=x[n+O],f>0&&(B.e.FromFloat32ArrayToRefScaled(J,Math.floor(16*S[n+O]),f,Y),v.addToSelf(Y));if(K)for(O=0;O<4;O++)f=N[n+O],f>0&&(B.e.FromFloat32ArrayToRefScaled(J,Math.floor(16*Z[n+O]),f,Y),v.addToSelf(Y));B.p.TransformCoordinatesFromFloatsToRef(H._sourcePositions[g],H._sourcePositions[g+1],H._sourcePositions[g+2],v,z),z.toArray(X,g),Q&&(B.p.TransformNormalFromFloatsToRef(H._sourceNormals[g],H._sourceNormals[g+1],H._sourceNormals[g+2],v,z),z.toArray(i,g)),v.reset()}return this.updateVerticesData(g.e.PositionKind,X),Q&&this.updateVerticesData(g.e.NormalKind,i),this}static MinMax(f){let Q=null,H=null;return f.forEach((function(f){const X=f.getBoundingInfo().boundingBox;Q&&H?(Q.minimizeInPlace(X.minimumWorld),H.maximizeInPlace(X.maximumWorld)):(Q=X.minimumWorld,H=X.maximumWorld)})),Q&&H?{min:Q,max:H}:{min:B.p.Zero(),max:B.p.Zero()}}static Center(f){const Q=f instanceof Array?R.MinMax(f):f;return B.p.Center(Q.min,Q.max)}static MergeMeshes(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],H=arguments.length>2?arguments[2]:void 0,X=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,S=arguments.length>5?arguments[5]:void 0;return(0,K.m)(R._MergeMeshesCoroutine(f,Q,H,X,i,S,!1))}static MergeMeshesAsync(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],H=arguments.length>2?arguments[2]:void 0,X=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,S=arguments.length>5?arguments[5]:void 0;return(0,K.j)(R._MergeMeshesCoroutine(f,Q,H,X,i,S,!0),(0,K.e)())}static*_MergeMeshesCoroutine(f){let Q,H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],X=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,S=arguments.length>4?arguments[4]:void 0,x=arguments.length>5?arguments[5]:void 0,K=arguments.length>6?arguments[6]:void 0;if(0===(f=f.filter(Boolean)).length)return null;if(!X){let H=0;for(Q=0;Q<f.length;Q++)if(H+=f[Q].getTotalVertices(),H>=65536)return l.b.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}x&&(S=!1);const Z=new Array,B=new Array,N=new Array,J=f[0].sideOrientation;for(Q=0;Q<f.length;Q++){const H=f[Q];if(H.isAnInstance)return l.b.Warn("Cannot merge instance meshes."),null;if(J!==H.sideOrientation)return l.b.Warn("Cannot merge meshes with different sideOrientation values."),null;if(S&&N.push(H.getTotalIndices()),x)if(H.material){const f=H.material;if(f instanceof e.b){for(let Q=0;Q<f.Cg.length;Q++)Z.indexOf(f.Cg[Q])<0&&Z.push(f.Cg[Q]);for(let Q=0;Q<H.ge.length;Q++)B.push(Z.indexOf(f.Cg[H.ge[Q].materialIndex])),N.push(H.ge[Q].indexCount)}else{Z.indexOf(f)<0&&Z.push(f);for(let Q=0;Q<H.ge.length;Q++)B.push(Z.indexOf(f)),N.push(H.ge[Q].indexCount)}}else for(let f=0;f<H.ge.length;f++)B.push(0),N.push(H.ge[f].indexCount)}const g=f[0],v=f=>{const Q=f.re(!0);return{vertexData:z.b.ExtractFromMesh(f,!1,!1),transform:Q}},{vertexData:Y,transform:n}=v(g);K&&(yield);const G=new Array(f.length-1);for(let z=1;z<f.length;z++)G[z-1]=v(f[z]),K&&(yield);const I=Y._mergeCoroutine(n,G,X,K,!H);let q=I.next();for(;!q.done;)K&&(yield),q=I.next();const D=q.value;i||(i=new R(g.name+"_merged",g.va()));const d=D._applyToCoroutine(i,void 0,K);let s=d.next();for(;!s.done;)K&&(yield),s=d.next();if(i.checkCollisions=g.checkCollisions,i.sideOrientation=g.sideOrientation,H)for(Q=0;Q<f.length;Q++)f[Q].dispose();if(S||x){i.releaseSubMeshes(),Q=0;let f=0;for(;Q<N.length;)O.c.CreateFromIndices(0,f,N[Q],i,void 0,!1),f+=N[Q],Q++;for(const Q of i.ge)Q.refreshBoundingInfo();i.re(!0)}if(x){const f=new e.b(g.name+"_merged",g.va());f.Cg=Z;for(let Q=0;Q<i.ge.length;Q++)i.ge[Q].materialIndex=B[Q];i.material=f}else i.material=g.material;return i}Qj(f){f._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(f)}Pj(f){const Q=f._indexInSourceMeshInstanceArray;if(-1!=Q){if(Q!==this.instances.length-1){const f=this.instances[this.instances.length-1];this.instances[Q]=f,f._indexInSourceMeshInstanceArray=Q}f._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===n.e.CounterClockWiseSideOrientation}_getRenderingFillMode(f){const Q=this.va();return Q.forcePointsCloud?n.e.PointFillMode:Q.forceWireframe?n.e.WireFrameFillMode:this.overrideRenderingFillMode??f}setMaterialByID(f){return this.setMaterialById(f)}static CreateRibbon(f,Q,H,X,i,S,x,K,Z){throw new Error("Import MeshBuilder to populate this function")}static nb(f,Q,H,X,i,S){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(f,Q,H,X,i){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(f,Q,H,X,i,S){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(f,Q,H,X){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(f,Q,H,X,i,S,x,K,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(f,Q,H,X,i,S,x){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(f,Q,H,X,i,S,x,K,Z,B){throw new Error("Import MeshBuilder to populate this function")}static ob(f,Q,H,X,i){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(f,Q,H,X,i,S,x,K){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(f,Q,H,X,i,S,x){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(f,Q,H,X,i,S,x,K){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(f,Q,H,X,i,S,x,K,Z,B){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(f,Q,H,X,i,S,x,K,Z,B,N,J){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(f,Q,H,X,i,S,x){throw new Error("Import MeshBuilder to populate this function")}static Eg(f,Q,H,X,i){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(f,Q,H,X,i,S){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(f,Q,H,X,i,S,x,K,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(f,Q,H,X,i,S,x,K,Z,B,N){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(f,Q,H,X,i,S,x,K,Z,B){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(f,Q,H){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(f,Q,H){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(f,Q,H,X,i,S){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(f,Q,H){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(f){throw new Error("Import MeshBuilder to populate this function")}}R.FRONTSIDE=z.b.FRONTSIDE,R.BACKSIDE=z.b.BACKSIDE,R.DOUBLESIDE=z.b.DOUBLESIDE,R.DEFAULTSIDE=z.b.DEFAULTSIDE,R.NO_CAP=0,R.CAP_START=1,R.CAP_END=2,R.CAP_ALL=3,R.NO_FLIP=0,R.FLIP_TILE=1,R.ROTATE_TILE=2,R.FLIP_ROW=3,R.ROTATE_ROW=4,R.FLIP_N_ROTATE_TILE=5,R.FLIP_N_ROTATE_ROW=6,R.CENTER=0,R.LEFT=1,R.RIGHT=2,R.TOP=3,R.BOTTOM=4,R.INSTANCEDMESH_SORT_TRANSPARENT=!1,R._GroundMeshParser=(f,Q)=>{throw(0,D.c)("GroundMesh")},R._GoldbergMeshParser=(f,Q)=>{throw(0,D.c)("GoldbergMesh")},R._LinesMeshParser=(f,Q)=>{throw(0,D.c)("LinesMesh")},R._GreasedLineMeshParser=(f,Q)=>{throw(0,D.c)("GreasedLineMesh")},R._GreasedLineRibbonMeshParser=(f,Q)=>{throw(0,D.c)("GreasedLineRibbonMesh")},R._TrailMeshParser=(f,Q)=>{throw(0,D.c)("TrailMesh")},(0,q.h)("BABYLON.Mesh",R)},11322:(f,Q,H)=>{"use strict";H.d(Q,{b:()=>v});var X=H(978),i=H(1003),S=H(1253),x=H(1082),K=H(1161),Z=H(1092),B=H(982),N=H(11308),J=H(1067),g=H(1355);class z{}class v{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,N.g)(this._applyToCoroutine.bind(this)),this.uniqueId=v._UniqueIDGenerator,v._UniqueIDGenerator++}set(f,Q){switch(f.length||Z.b.Warn(`Setting vertex data kind '${Q}' with an empty array`),Q){case S.e.PositionKind:this.xa=f;break;case S.e.NormalKind:this.ya=f;break;case S.e.TangentKind:this.tangents=f;break;case S.e.UVKind:this.Aa=f;break;case S.e.UV2Kind:this.uvs2=f;break;case S.e.UV3Kind:this.uvs3=f;break;case S.e.UV4Kind:this.uvs4=f;break;case S.e.UV5Kind:this.uvs5=f;break;case S.e.UV6Kind:this.uvs6=f;break;case S.e.ColorKind:this.za=f;break;case S.e.MatricesIndicesKind:this.matricesIndices=f;break;case S.e.MatricesWeightsKind:this.matricesWeights=f;break;case S.e.MatricesIndicesExtraKind:this.matricesIndicesExtra=f;break;case S.e.MatricesWeightsExtraKind:this.matricesWeightsExtra=f}}Ca(f,Q){return this._applyTo(f,Q,!1),this}applyToGeometry(f,Q){return this._applyTo(f,Q,!1),this}updateMesh(f){return this._update(f),this}updateGeometry(f){return this._update(f),this}*_applyToCoroutine(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2?arguments[2]:void 0;if(this.xa&&(f.Ga(S.e.PositionKind,this.xa,Q),H&&(yield)),this.ya&&(f.Ga(S.e.NormalKind,this.ya,Q),H&&(yield)),this.tangents&&(f.Ga(S.e.TangentKind,this.tangents,Q),H&&(yield)),this.Aa&&(f.Ga(S.e.UVKind,this.Aa,Q),H&&(yield)),this.uvs2&&(f.Ga(S.e.UV2Kind,this.uvs2,Q),H&&(yield)),this.uvs3&&(f.Ga(S.e.UV3Kind,this.uvs3,Q),H&&(yield)),this.uvs4&&(f.Ga(S.e.UV4Kind,this.uvs4,Q),H&&(yield)),this.uvs5&&(f.Ga(S.e.UV5Kind,this.uvs5,Q),H&&(yield)),this.uvs6&&(f.Ga(S.e.UV6Kind,this.uvs6,Q),H&&(yield)),this.za&&(f.Ga(S.e.ColorKind,this.za,Q),this.hasVertexAlpha&&void 0!==f.hasVertexAlpha&&(f.hasVertexAlpha=!0),H&&(yield)),this.matricesIndices&&(f.Ga(S.e.MatricesIndicesKind,this.matricesIndices,Q),H&&(yield)),this.matricesWeights&&(f.Ga(S.e.MatricesWeightsKind,this.matricesWeights,Q),H&&(yield)),this.matricesIndicesExtra&&(f.Ga(S.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,Q),H&&(yield)),this.matricesWeightsExtra&&(f.Ga(S.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,Q),H&&(yield)),this.indices?(f.setIndices(this.indices,null,Q),H&&(yield)):f.setIndices([],null),f.ge&&this.materialInfos&&this.materialInfos.length>1){const Q=f;Q.ge=[];for(const f of this.materialInfos)new g.c(f.materialIndex,f.verticesStart,f.verticesCount,f.indexStart,f.indexCount,Q)}return this}_update(f,Q,H){return this.xa&&f.updateVerticesData(S.e.PositionKind,this.xa,Q,H),this.ya&&f.updateVerticesData(S.e.NormalKind,this.ya,Q,H),this.tangents&&f.updateVerticesData(S.e.TangentKind,this.tangents,Q,H),this.Aa&&f.updateVerticesData(S.e.UVKind,this.Aa,Q,H),this.uvs2&&f.updateVerticesData(S.e.UV2Kind,this.uvs2,Q,H),this.uvs3&&f.updateVerticesData(S.e.UV3Kind,this.uvs3,Q,H),this.uvs4&&f.updateVerticesData(S.e.UV4Kind,this.uvs4,Q,H),this.uvs5&&f.updateVerticesData(S.e.UV5Kind,this.uvs5,Q,H),this.uvs6&&f.updateVerticesData(S.e.UV6Kind,this.uvs6,Q,H),this.za&&f.updateVerticesData(S.e.ColorKind,this.za,Q,H),this.matricesIndices&&f.updateVerticesData(S.e.MatricesIndicesKind,this.matricesIndices,Q,H),this.matricesWeights&&f.updateVerticesData(S.e.MatricesWeightsKind,this.matricesWeights,Q,H),this.matricesIndicesExtra&&f.updateVerticesData(S.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,Q,H),this.matricesWeightsExtra&&f.updateVerticesData(S.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,Q,H),this.indices&&f.setIndices(this.indices,null),this}static _TransformVector3Coordinates(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:f.length;const S=i.l.Wd[0],x=i.l.Wd[1];for(let K=H;K<H+X;K+=3)i.p.FromArrayToRef(f,K,S),i.p.TransformCoordinatesToRef(S,Q,x),f[K]=x.x,f[K+1]=x.y,f[K+2]=x.z}static _TransformVector3Normals(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:f.length;const S=i.l.Wd[0],x=i.l.Wd[1];for(let K=H;K<H+X;K+=3)i.p.FromArrayToRef(f,K,S),i.p.TransformNormalToRef(S,Q,x),f[K]=x.x,f[K+1]=x.y,f[K+2]=x.z}static _TransformVector4Normals(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:f.length;const S=i.l.Vector4[0],x=i.l.Vector4[1];for(let K=H;K<H+X;K+=4)i.s.FromArrayToRef(f,K,S),i.s.TransformNormalToRef(S,Q,x),f[K]=x.x,f[K+1]=x.y,f[K+2]=x.z,f[K+3]=x.w}static _FlipFaces(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.length;for(let X=Q;X<Q+H;X+=3){const Q=f[X+1];f[X+1]=f[X+2],f[X+2]=Q}}transform(f){const Q=f.determinant()<0;return this.xa&&v._TransformVector3Coordinates(this.xa,f),this.ya&&v._TransformVector3Normals(this.ya,f),this.tangents&&v._TransformVector4Normals(this.tangents,f),Q&&this.indices&&v._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const f=[];for(const Q of this.materialInfos){const H=new v;if(this.xa&&(H.xa=this.xa.slice(3*Q.verticesStart,3*(Q.verticesCount+Q.verticesStart))),this.ya&&(H.ya=this.ya.slice(3*Q.verticesStart,3*(Q.verticesCount+Q.verticesStart))),this.tangents&&(H.tangents=this.tangents.slice(4*Q.verticesStart,4*(Q.verticesCount+Q.verticesStart))),this.za&&(H.za=this.za.slice(4*Q.verticesStart,4*(Q.verticesCount+Q.verticesStart))),this.Aa&&(H.Aa=this.Aa.slice(2*Q.verticesStart,2*(Q.verticesCount+Q.verticesStart))),this.uvs2&&(H.uvs2=this.uvs2.slice(2*Q.verticesStart,2*(Q.verticesCount+Q.verticesStart))),this.uvs3&&(H.uvs3=this.uvs3.slice(2*Q.verticesStart,2*(Q.verticesCount+Q.verticesStart))),this.uvs4&&(H.uvs4=this.uvs4.slice(2*Q.verticesStart,2*(Q.verticesCount+Q.verticesStart))),this.uvs5&&(H.uvs5=this.uvs5.slice(2*Q.verticesStart,2*(Q.verticesCount+Q.verticesStart))),this.uvs6&&(H.uvs6=this.uvs6.slice(2*Q.verticesStart,2*(Q.verticesCount+Q.verticesStart))),this.matricesIndices&&(H.matricesIndices=this.matricesIndices.slice(4*Q.verticesStart,4*(Q.verticesCount+Q.verticesStart))),this.matricesIndicesExtra&&(H.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*Q.verticesStart,4*(Q.verticesCount+Q.verticesStart))),this.matricesWeights&&(H.matricesWeights=this.matricesWeights.slice(4*Q.verticesStart,4*(Q.verticesCount+Q.verticesStart))),this.matricesWeightsExtra&&(H.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*Q.verticesStart,4*(Q.verticesCount+Q.verticesStart))),this.indices){H.indices=[];for(let f=Q.indexStart;f<Q.indexStart+Q.indexCount;f++)H.indices.push(this.indices[f]-Q.verticesStart)}const X=new z;X.indexStart=0,X.indexCount=H.indices?H.indices.length:0,X.materialIndex=Q.materialIndex,X.verticesStart=0,X.verticesCount=(H.xa?H.xa.length:0)/3,H.materialInfos=[X],f.push(H)}return f}merge(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const S=Array.isArray(f)?f.map((f=>({vertexData:f}))):[{vertexData:f}];return(0,N.m)(this._mergeCoroutine(void 0,S,Q,!1,H,X,i))}*_mergeCoroutine(f,Q){var H,X;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3?arguments[3]:void 0,K=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let N=Q.map((f=>f.vertexData)),J=this;if(B)for(const S of N)S&&(S._validate(),!this.ya&&S.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&S.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&S.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&S.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&S.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&S.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&S.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&S.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&S.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&S.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&S.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&S.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&S.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const S of N)if(S)if(B)this.ya&&!S.ya&&(S.ya=new Float32Array(S.xa.length)),this.tangents&&!S.tangents&&(S.tangents=new Float32Array(S.xa.length/3*4)),this.Aa&&!S.Aa&&(S.Aa=new Float32Array(S.xa.length/3*2)),this.uvs2&&!S.uvs2&&(S.uvs2=new Float32Array(S.xa.length/3*2)),this.uvs3&&!S.uvs3&&(S.uvs3=new Float32Array(S.xa.length/3*2)),this.uvs4&&!S.uvs4&&(S.uvs4=new Float32Array(S.xa.length/3*2)),this.uvs5&&!S.uvs5&&(S.uvs5=new Float32Array(S.xa.length/3*2)),this.uvs6&&!S.uvs6&&(S.uvs6=new Float32Array(S.xa.length/3*2)),this.za&&!S.za&&(S.za=new Float32Array(S.xa.length/3*4),S.za.fill(1)),this.matricesIndices&&!S.matricesIndices&&(S.matricesIndices=new Float32Array(S.xa.length/3*4)),this.matricesWeights&&!S.matricesWeights&&(S.matricesWeights=new Float32Array(S.xa.length/3*4)),this.matricesIndicesExtra&&!S.matricesIndicesExtra&&(S.matricesIndicesExtra=new Float32Array(S.xa.length/3*4)),this.matricesWeightsExtra&&!S.matricesWeightsExtra&&(S.matricesWeightsExtra=new Float32Array(S.xa.length/3*4));else if(S._validate(),!this.ya!==!S.ya||!this.tangents!==!S.tangents||!this.Aa!==!S.Aa||!this.uvs2!==!S.uvs2||!this.uvs3!==!S.uvs3||!this.uvs4!==!S.uvs4||!this.uvs5!==!S.uvs5||!this.uvs6!==!S.uvs6||!this.za!==!S.za||!this.matricesIndices!==!S.matricesIndices||!this.matricesWeights!==!S.matricesWeights||!this.matricesIndicesExtra!==!S.matricesIndicesExtra||!this.matricesWeightsExtra!==!S.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(Z){let H=0,X=0,i=0;const S=[];let x=null;const K=[];for(const Q of this.splitBasedOnMaterialID())K.push({vertexData:Q,transform:f});for(const f of Q)if(f.vertexData)for(const Q of f.vertexData.splitBasedOnMaterialID())K.push({vertexData:Q,transform:f.transform});K.sort(((f,Q)=>{const H=f.vertexData.materialInfos?f.vertexData.materialInfos[0].materialIndex:0,X=Q.vertexData.materialInfos?Q.vertexData.materialInfos[0].materialIndex:0;return H>X?1:H===X?0:-1}));for(const f of K){const Q=f.vertexData;if(H=Q.materialInfos?Q.materialInfos[0].materialIndex:0,x&&x.materialIndex===H)x.indexCount+=Q.indices.length,x.verticesCount+=Q.xa.length/3;else{const f=new z;f.materialIndex=H,f.indexStart=X,f.indexCount=Q.indices.length,f.verticesStart=i,f.verticesCount=Q.xa.length/3,S.push(f),x=f}X+=Q.indices.length,i+=Q.xa.length/3}const Z=K.splice(0,1)[0];J=Z.vertexData,f=Z.transform,N=K.map((f=>f.vertexData)),Q=K,this.materialInfos=S}const g=N.reduce(((f,Q)=>{var H;return f+((null===(H=Q.indices)||void 0===H?void 0:H.length)??0)}),(null===(H=J.indices)||void 0===H?void 0:H.length)??0);let Y=K||N.some((f=>f.indices===J.indices))?null===(X=J.indices)||void 0===X?void 0:X.slice():J.indices;if(g>0){var O;let H=(null===(O=Y)||void 0===O?void 0:O.length)??0;if(Y||(Y=new Array(g)),Y.length!==g){if(Array.isArray(Y))Y.length=g;else{const f=i||Y instanceof Uint32Array?new Uint32Array(g):new Uint16Array(g);f.set(Y),Y=f}f&&f.determinant()<0&&v._FlipFaces(Y,0,H)}let X=J.xa?J.xa.length/3:0;for(const{vertexData:f,transform:i}of Q)if(f.indices){for(let Q=0;Q<f.indices.length;Q++)Y[H+Q]=f.indices[Q]+X;i&&i.determinant()<0&&v._FlipFaces(Y,H,f.indices.length),X+=f.xa.length/3,H+=f.indices.length,x&&(yield)}}return this.indices=Y,this.xa=v._MergeElement(S.e.PositionKind,J.xa,f,Q.map((f=>[f.vertexData.xa,f.transform]))),x&&(yield),J.ya&&(this.ya=v._MergeElement(S.e.NormalKind,J.ya,f,Q.map((f=>[f.vertexData.ya,f.transform]))),x&&(yield)),J.tangents&&(this.tangents=v._MergeElement(S.e.TangentKind,J.tangents,f,Q.map((f=>[f.vertexData.tangents,f.transform]))),x&&(yield)),J.Aa&&(this.Aa=v._MergeElement(S.e.UVKind,J.Aa,f,Q.map((f=>[f.vertexData.Aa,f.transform]))),x&&(yield)),J.uvs2&&(this.uvs2=v._MergeElement(S.e.UV2Kind,J.uvs2,f,Q.map((f=>[f.vertexData.uvs2,f.transform]))),x&&(yield)),J.uvs3&&(this.uvs3=v._MergeElement(S.e.UV3Kind,J.uvs3,f,Q.map((f=>[f.vertexData.uvs3,f.transform]))),x&&(yield)),J.uvs4&&(this.uvs4=v._MergeElement(S.e.UV4Kind,J.uvs4,f,Q.map((f=>[f.vertexData.uvs4,f.transform]))),x&&(yield)),J.uvs5&&(this.uvs5=v._MergeElement(S.e.UV5Kind,J.uvs5,f,Q.map((f=>[f.vertexData.uvs5,f.transform]))),x&&(yield)),J.uvs6&&(this.uvs6=v._MergeElement(S.e.UV6Kind,J.uvs6,f,Q.map((f=>[f.vertexData.uvs6,f.transform]))),x&&(yield)),J.za&&(this.za=v._MergeElement(S.e.ColorKind,J.za,f,Q.map((f=>[f.vertexData.za,f.transform]))),(void 0!==J.hasVertexAlpha||Q.some((f=>void 0!==f.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=J.hasVertexAlpha||Q.some((f=>f.vertexData.hasVertexAlpha))),x&&(yield)),J.matricesIndices&&(this.matricesIndices=v._MergeElement(S.e.MatricesIndicesKind,J.matricesIndices,f,Q.map((f=>[f.vertexData.matricesIndices,f.transform]))),x&&(yield)),J.matricesWeights&&(this.matricesWeights=v._MergeElement(S.e.MatricesWeightsKind,J.matricesWeights,f,Q.map((f=>[f.vertexData.matricesWeights,f.transform]))),x&&(yield)),J.matricesIndicesExtra&&(this.matricesIndicesExtra=v._MergeElement(S.e.MatricesIndicesExtraKind,J.matricesIndicesExtra,f,Q.map((f=>[f.vertexData.matricesIndicesExtra,f.transform]))),x&&(yield)),J.matricesWeightsExtra&&(this.matricesWeightsExtra=v._MergeElement(S.e.MatricesWeightsExtraKind,J.matricesWeightsExtra,f,Q.map((f=>[f.vertexData.matricesWeightsExtra,f.transform])))),this}static _MergeElement(f,Q,H,X){const i=X.filter((f=>null!==f[0]&&void 0!==f[0]));if(!Q&&0==i.length)return Q;if(!Q)return this._MergeElement(f,i[0][0],i[0][1],i.slice(1));const x=i.reduce(((f,Q)=>f+Q[0].length),Q.length),K=f===S.e.PositionKind?v._TransformVector3Coordinates:f===S.e.NormalKind?v._TransformVector3Normals:f===S.e.TangentKind?v._TransformVector4Normals:()=>{};if(Q instanceof Float32Array){const f=new Float32Array(x);f.set(Q),H&&K(f,H,0,Q.length);let X=Q.length;for(const[Q,H]of i)f.set(Q,X),H&&K(f,H,X,Q.length),X+=Q.length;return f}{const f=new Array(x);for(let H=0;H<Q.length;H++)f[H]=Q[H];H&&K(f,H,0,Q.length);let X=Q.length;for(const[Q,H]of i){for(let H=0;H<Q.length;H++)f[X+H]=Q[H];H&&K(f,H,X,Q.length),X+=Q.length}return f}}_validate(){if(!this.xa)throw new J.f("Positions are required",J.e.MeshInvalidPositionsError);const f=(f,Q)=>{const H=S.e.DeduceStride(f);if(Q.length%H!==0)throw new Error("The "+f+"s array count must be a multiple of "+H);return Q.length/H},Q=f(S.e.PositionKind,this.xa),H=(H,X)=>{const i=f(H,X);if(i!==Q)throw new Error("The "+H+"s element count ("+i+") does not match the positions count ("+Q+")")};this.ya&&H(S.e.NormalKind,this.ya),this.tangents&&H(S.e.TangentKind,this.tangents),this.Aa&&H(S.e.UVKind,this.Aa),this.uvs2&&H(S.e.UV2Kind,this.uvs2),this.uvs3&&H(S.e.UV3Kind,this.uvs3),this.uvs4&&H(S.e.UV4Kind,this.uvs4),this.uvs5&&H(S.e.UV5Kind,this.uvs5),this.uvs6&&H(S.e.UV6Kind,this.uvs6),this.za&&H(S.e.ColorKind,this.za),this.matricesIndices&&H(S.e.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&H(S.e.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&H(S.e.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&H(S.e.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const f=this.serialize();return v.Parse(f)}serialize(){const f={};if(this.xa&&(f.xa=Array.from(this.xa)),this.ya&&(f.ya=Array.from(this.ya)),this.tangents&&(f.tangents=Array.from(this.tangents)),this.Aa&&(f.Aa=Array.from(this.Aa)),this.uvs2&&(f.uvs2=Array.from(this.uvs2)),this.uvs3&&(f.uvs3=Array.from(this.uvs3)),this.uvs4&&(f.uvs4=Array.from(this.uvs4)),this.uvs5&&(f.uvs5=Array.from(this.uvs5)),this.uvs6&&(f.uvs6=Array.from(this.uvs6)),this.za&&(f.za=Array.from(this.za),f.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(f.matricesIndices=Array.from(this.matricesIndices),f.matricesIndices._isExpanded=!0),this.matricesWeights&&(f.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(f.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),f.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(f.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),f.indices=Array.from(this.indices),this.materialInfos){f.materialInfos=[];for(const Q of this.materialInfos){const H={indexStart:Q.indexStart,indexCount:Q.indexCount,materialIndex:Q.materialIndex,verticesStart:Q.verticesStart,verticesCount:Q.verticesCount};f.materialInfos.push(H)}}return f}static ExtractFromMesh(f,Q,H){return v._ExtractFrom(f,Q,H)}static ExtractFromGeometry(f,Q,H){return v._ExtractFrom(f,Q,H)}static _ExtractFrom(f,Q,H){const X=new v;if(f.isVerticesDataPresent(S.e.PositionKind)&&(X.xa=f.getVerticesData(S.e.PositionKind,Q,H)),f.isVerticesDataPresent(S.e.NormalKind)&&(X.ya=f.getVerticesData(S.e.NormalKind,Q,H)),f.isVerticesDataPresent(S.e.TangentKind)&&(X.tangents=f.getVerticesData(S.e.TangentKind,Q,H)),f.isVerticesDataPresent(S.e.UVKind)&&(X.Aa=f.getVerticesData(S.e.UVKind,Q,H)),f.isVerticesDataPresent(S.e.UV2Kind)&&(X.uvs2=f.getVerticesData(S.e.UV2Kind,Q,H)),f.isVerticesDataPresent(S.e.UV3Kind)&&(X.uvs3=f.getVerticesData(S.e.UV3Kind,Q,H)),f.isVerticesDataPresent(S.e.UV4Kind)&&(X.uvs4=f.getVerticesData(S.e.UV4Kind,Q,H)),f.isVerticesDataPresent(S.e.UV5Kind)&&(X.uvs5=f.getVerticesData(S.e.UV5Kind,Q,H)),f.isVerticesDataPresent(S.e.UV6Kind)&&(X.uvs6=f.getVerticesData(S.e.UV6Kind,Q,H)),f.isVerticesDataPresent(S.e.ColorKind)){const i=f.ze||f,x=i.getVertexBuffer(S.e.ColorKind),K=i.getVerticesData(S.e.ColorKind,Q,H);if(3===x.getSize()){const f=new Float32Array(4*K.length/3);for(let Q=0,H=0;Q<K.length;Q+=3,H+=4)f[H]=K[Q],f[H+1]=K[Q+1],f[H+2]=K[Q+2],f[H+3]=1;X.za=f}else{if(4!==x.getSize())throw new Error(`Unexpected number of color components: ${x.getSize()}`);X.za=K}}return f.isVerticesDataPresent(S.e.MatricesIndicesKind)&&(X.matricesIndices=f.getVerticesData(S.e.MatricesIndicesKind,Q,H)),f.isVerticesDataPresent(S.e.MatricesWeightsKind)&&(X.matricesWeights=f.getVerticesData(S.e.MatricesWeightsKind,Q,H)),f.isVerticesDataPresent(S.e.MatricesIndicesExtraKind)&&(X.matricesIndicesExtra=f.getVerticesData(S.e.MatricesIndicesExtraKind,Q,H)),f.isVerticesDataPresent(S.e.MatricesWeightsExtraKind)&&(X.matricesWeightsExtra=f.getVerticesData(S.e.MatricesWeightsExtraKind,Q,H)),X.indices=f.Ud(Q,H),X}static CreateRibbon(f){throw(0,x.c)("ribbonBuilder")}static CreateBox(f){throw(0,x.c)("boxBuilder")}static CreateTiledBox(f){throw(0,x.c)("tiledBoxBuilder")}static CreateTiledPlane(f){throw(0,x.c)("tiledPlaneBuilder")}static CreateSphere(f){throw(0,x.c)("sphereBuilder")}static CreateCylinder(f){throw(0,x.c)("cylinderBuilder")}static CreateTorus(f){throw(0,x.c)("torusBuilder")}static CreateLineSystem(f){throw(0,x.c)("linesBuilder")}static CreateDashedLines(f){throw(0,x.c)("linesBuilder")}static CreateGround(f){throw(0,x.c)("groundBuilder")}static CreateTiledGround(f){throw(0,x.c)("groundBuilder")}static CreateGroundFromHeightMap(f){throw(0,x.c)("groundBuilder")}static Eg(f){throw(0,x.c)("planeBuilder")}static nb(f){throw(0,x.c)("discBuilder")}static CreatePolygon(f,Q,H,X,i,S,K){throw(0,x.c)("polygonBuilder")}static CreateIcoSphere(f){throw(0,x.c)("icoSphereBuilder")}static CreatePolyhedron(f){throw(0,x.c)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||i.p.Up();throw(0,x.c)("capsuleBuilder")}static CreateTorusKnot(f){throw(0,x.c)("torusKnotBuilder")}static ComputeNormals(f,Q,H,X){let S=0,x=0,K=0,Z=0,B=0,N=0,J=0,g=0,z=0,v=0,Y=0,O=0,n=0,e=0,G=0,I=0,l=0,q=0,D=0,d=0,s=!1,F=!1,P=!1,m=!1,c=1,W=0,R=null;X&&(s=!!X.facetNormals,F=!!X.facetPositions,P=!!X.facetPartitioning,c=!0===X.useRightHandedSystem?-1:1,W=X.ratio||0,m=!!X.depthSort,R=X.distanceTo,m&&void 0===R&&(R=i.p.Zero()));let U=0,E=0,t=0,u=0;for(P&&X&&X.bbSize&&(U=X.subDiv.X*W/X.bbSize.x,E=X.subDiv.Y*W/X.bbSize.y,t=X.subDiv.Z*W/X.bbSize.z,u=X.subDiv.max*X.subDiv.max,X.facetPartitioning.length=0),S=0;S<f.length;S++)H[S]=0;const L=Q.length/3|0;for(S=0;S<L;S++){if(O=3*Q[3*S],n=O+1,e=O+2,G=3*Q[3*S+1],I=G+1,l=G+2,q=3*Q[3*S+2],D=q+1,d=q+2,x=f[O]-f[G],K=f[n]-f[I],Z=f[e]-f[l],B=f[q]-f[G],N=f[D]-f[I],J=f[d]-f[l],g=c*(K*J-Z*N),z=c*(Z*B-x*J),v=c*(x*N-K*B),Y=Math.sqrt(g*g+z*z+v*v),Y=0===Y?1:Y,g/=Y,z/=Y,v/=Y,s&&X&&(X.facetNormals[S].x=g,X.facetNormals[S].y=z,X.facetNormals[S].z=v),F&&X&&(X.facetPositions[S].x=(f[O]+f[G]+f[q])/3,X.facetPositions[S].y=(f[n]+f[I]+f[D])/3,X.facetPositions[S].z=(f[e]+f[l]+f[d])/3),P&&X){const Q=Math.floor((X.facetPositions[S].x-X.bInfo.minimum.x*W)*U),H=Math.floor((X.facetPositions[S].y-X.bInfo.minimum.y*W)*E),i=Math.floor((X.facetPositions[S].z-X.bInfo.minimum.z*W)*t),x=Math.floor((f[O]-X.bInfo.minimum.x*W)*U),K=Math.floor((f[n]-X.bInfo.minimum.y*W)*E),Z=Math.floor((f[e]-X.bInfo.minimum.z*W)*t),B=Math.floor((f[G]-X.bInfo.minimum.x*W)*U),N=Math.floor((f[I]-X.bInfo.minimum.y*W)*E),J=Math.floor((f[l]-X.bInfo.minimum.z*W)*t),g=Math.floor((f[q]-X.bInfo.minimum.x*W)*U),z=Math.floor((f[D]-X.bInfo.minimum.y*W)*E),v=Math.floor((f[d]-X.bInfo.minimum.z*W)*t),Y=x+X.subDiv.max*K+u*Z,s=B+X.subDiv.max*N+u*J,F=g+X.subDiv.max*z+u*v,P=Q+X.subDiv.max*H+u*i;X.facetPartitioning[P]=X.facetPartitioning[P]?X.facetPartitioning[P]:new Array,X.facetPartitioning[Y]=X.facetPartitioning[Y]?X.facetPartitioning[Y]:new Array,X.facetPartitioning[s]=X.facetPartitioning[s]?X.facetPartitioning[s]:new Array,X.facetPartitioning[F]=X.facetPartitioning[F]?X.facetPartitioning[F]:new Array,X.facetPartitioning[Y].push(S),s!=Y&&X.facetPartitioning[s].push(S),F!=s&&F!=Y&&X.facetPartitioning[F].push(S),P!=Y&&P!=s&&P!=F&&X.facetPartitioning[P].push(S)}if(m&&X&&X.facetPositions){const f=X.depthSortedFacets[S];f.ind=3*S,f.sqDistance=i.p.DistanceSquared(X.facetPositions[S],R)}H[O]+=g,H[n]+=z,H[e]+=v,H[G]+=g,H[I]+=z,H[l]+=v,H[q]+=g,H[D]+=z,H[d]+=v}for(S=0;S<H.length/3;S++)g=H[3*S],z=H[3*S+1],v=H[3*S+2],Y=Math.sqrt(g*g+z*z+v*v),Y=0===Y?1:Y,g/=Y,z/=Y,v/=Y,H[3*S]=g,H[3*S+1]=z,H[3*S+2]=v}static _ComputeSides(f,Q,H,X,S,x,K){const Z=H.length,B=X.length;let N,J;switch(f=f||v.DEFAULTSIDE){case v.FRONTSIDE:break;case v.BACKSIDE:for(N=0;N<Z;N+=3){const f=H[N];H[N]=H[N+2],H[N+2]=f}for(J=0;J<B;J++)X[J]=-X[J];break;case v.DOUBLESIDE:{const f=Q.length,g=f/3;for(let H=0;H<f;H++)Q[f+H]=Q[H];for(N=0;N<Z;N+=3)H[N+Z]=H[N+2]+g,H[N+1+Z]=H[N+1]+g,H[N+2+Z]=H[N]+g;for(J=0;J<B;J++)X[B+J]=-X[J];const z=S.length;let v=0;for(v=0;v<z;v++)S[v+z]=S[v];for(x=x||new i.s(0,0,1,1),K=K||new i.s(0,0,1,1),v=0,N=0;N<z/2;N++)S[v]=x.x+(x.z-x.x)*S[v],S[v+1]=x.y+(x.w-x.y)*S[v+1],S[v+z]=K.x+(K.z-K.x)*S[v+z],S[v+z+1]=K.y+(K.w-K.y)*S[v+z+1],v+=2;break}}}static Parse(f){const Q=new v,H=f.xa;H&&Q.set(H,S.e.PositionKind);const X=f.ya;X&&Q.set(X,S.e.NormalKind);const i=f.tangents;i&&Q.set(i,S.e.TangentKind);const x=f.Aa;x&&Q.set(x,S.e.UVKind);const Z=f.uvs2;Z&&Q.set(Z,S.e.UV2Kind);const B=f.uvs3;B&&Q.set(B,S.e.UV3Kind);const N=f.uvs4;N&&Q.set(N,S.e.UV4Kind);const J=f.uvs5;J&&Q.set(J,S.e.UV5Kind);const g=f.uvs6;g&&Q.set(g,S.e.UV6Kind);const Y=f.za;Y&&(Q.set(K.h.CheckColors4(Y,H.length/3),S.e.ColorKind),void 0!==f.hasVertexAlpha&&(Q.hasVertexAlpha=f.hasVertexAlpha));const O=f.matricesIndices;O&&Q.set(O,S.e.MatricesIndicesKind);const n=f.matricesWeights;n&&Q.set(n,S.e.MatricesWeightsKind);const e=f.indices;e&&(Q.indices=e);const G=f.materialInfos;if(G){Q.materialInfos=[];for(const f of G){const H=new z;H.indexCount=f.indexCount,H.indexStart=f.indexStart,H.verticesCount=f.verticesCount,H.verticesStart=f.verticesStart,H.materialIndex=f.materialIndex,Q.materialInfos.push(H)}}return Q}static ImportVertexData(f,Q){const H=v.Parse(f);Q.setAllVerticesData(H,f.updatable)}}v.FRONTSIDE=0,v.BACKSIDE=1,v.DOUBLESIDE=2,v.DEFAULTSIDE=0,v._UniqueIDGenerator=0,(0,X.d)([B.e.filter((function(){for(var f=arguments.length,Q=new Array(f),H=0;H<f;H++)Q[H]=arguments[H];let[X]=Q;return!Array.isArray(X)}))],v,"_TransformVector3Coordinates",null),(0,X.d)([B.e.filter((function(){for(var f=arguments.length,Q=new Array(f),H=0;H<f;H++)Q[H]=arguments[H];let[X]=Q;return!Array.isArray(X)}))],v,"_TransformVector3Normals",null),(0,X.d)([B.e.filter((function(){for(var f=arguments.length,Q=new Array(f),H=0;H<f;H++)Q[H]=arguments[H];let[X]=Q;return!Array.isArray(X)}))],v,"_TransformVector4Normals",null),(0,X.d)([B.e.filter((function(){for(var f=arguments.length,Q=new Array(f),H=0;H<f;H++)Q[H]=arguments[H];let[X]=Q;return!Array.isArray(X)}))],v,"_FlipFaces",null)},12248:(f,Q,H)=>{"use strict";H.d(Q,{d:()=>Of});var X=H(1003),i=H(11301),S=H(1253),x=H(11322),K=H(1183);function Z(f){let Q=f.pathArray;const H=f.closeArray||!1,X=f.closePath||!1,i=f.invertUV||!1,Z=Math.floor(Q[0].length/2);let B=f.offset||Z;B=B>Z?Z:Math.floor(B);const N=0===f.sideOrientation?0:f.sideOrientation||x.b.DEFAULTSIDE,J=f.Aa,g=f.za,z=[],v=[],Y=[],O=[],n=[],e=[],G=[],I=[];let l;const q=[],D=[];let d,s,F;if(Q.length<2){const f=[],H=[];for(s=0;s<Q[0].length-B;s++)f.push(Q[0][s]),H.push(Q[0][s+B]);Q=[f,H]}let P=0;const m=X?1:0,c=H?1:0;let W,R,U,E,t,u;for(l=Q[0].length,d=0;d<Q.length+c;d++){for(G[d]=0,n[d]=[0],W=d===Q.length?Q[0]:Q[d],R=W.length,l=l<R?l:R,F=0;F<R;)z.push(W[F].x,W[F].y,W[F].z),F>0&&(U=W[F].hd(W[F-1]).length(),E=U+G[d],n[d].push(E),G[d]=E),F++;X&&(F--,z.push(W[0].x,W[0].y,W[0].z),U=W[F].hd(W[0]).length(),E=U+G[d],n[d].push(E),G[d]=E),q[d]=R+m,D[d]=P,P+=R+m}let L,A,a=null,V=null;for(s=0;s<l+m;s++)for(I[s]=0,e[s]=[0],d=0;d<Q.length-1+c;d++)t=Q[d],u=d===Q.length-1?Q[0]:Q[d+1],s===l?(a=t[0],V=u[0]):(a=t[s],V=u[s]),U=V.hd(a).length(),E=U+I[s],e[s].push(E),I[s]=E;if(J)for(d=0;d<J.length;d++)O.push(J[d].x,K.e?1-J[d].y:J[d].y);else for(d=0;d<Q.length+c;d++)for(s=0;s<l+m;s++)L=0!=G[d]?n[d][s]/G[d]:0,A=0!=I[s]?e[s][d]/I[s]:0,i?O.push(A,L):O.push(L,K.e?1-A:A);d=0;let M=0,r=q[d]-1,j=q[d+1]-1,T=r<j?r:j,k=D[1]-D[0];const y=q.length-1;for(;M<=T&&d<y;)v.push(M,M+k,M+1),v.push(M+k+1,M+1,M+k),M+=1,M===T&&(d++,k=D[d+1]-D[d],r=q[d]-1,j=q[d+1]-1,M=D[d],T=r<j?r+M:j+M);if(x.b.ComputeNormals(z,v,Y),X){let f=0,H=0;for(d=0;d<Q.length;d++){f=3*D[d],H=d+1<Q.length?3*(D[d+1]-1):Y.length-3,Y[f]=.5*(Y[f]+Y[H]),Y[f+1]=.5*(Y[f+1]+Y[H+1]),Y[f+2]=.5*(Y[f+2]+Y[H+2]);const X=Math.sqrt(Y[f]*Y[f]+Y[f+1]*Y[f+1]+Y[f+2]*Y[f+2]);Y[f]/=X,Y[f+1]/=X,Y[f+2]/=X,Y[H]=Y[f],Y[H+1]=Y[f+1],Y[H+2]=Y[f+2]}}if(H){let f=3*D[0],H=3*D[Q.length];for(s=0;s<l+m;s++){Y[f]=.5*(Y[f]+Y[H]),Y[f+1]=.5*(Y[f+1]+Y[H+1]),Y[f+2]=.5*(Y[f+2]+Y[H+2]);const Q=Math.sqrt(Y[f]*Y[f]+Y[f+1]*Y[f+1]+Y[f+2]*Y[f+2]);Y[f]/=Q,Y[f+1]/=Q,Y[f+2]/=Q,Y[H]=Y[f],Y[H+1]=Y[f+1],Y[H+2]=Y[f+2],f+=3,H+=3}}x.b._ComputeSides(N,z,v,Y,O,f.frontUVs,f.backUVs);let h=null;if(g){h=new Float32Array(4*g.length);for(let f=0;f<g.length;f++)h[4*f]=g[f].r,h[4*f+1]=g[f].g,h[4*f+2]=g[f].b,h[4*f+3]=g[f].a}const w=new x.b,b=new Float32Array(z),o=new Float32Array(Y),p=new Float32Array(O);return w.indices=v,w.xa=b,w.ya=o,w.Aa=p,h&&w.set(h,S.e.ColorKind),X&&(w._idx=D),w}function B(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const B=Q.pathArray,N=Q.closeArray,J=Q.closePath,g=i.b._GetDefaultSideOrientation(Q.sideOrientation),z=Q.instance,v=Q.updatable;if(z){const f=X.l.Wd[0]._d(Number.MAX_VALUE),H=X.l.Wd[1]._d(-Number.MAX_VALUE),Z=Q=>{let X=B[0].length;const S=z;let x=0;const K=S._originalBuilderSideOrientation===i.b.DOUBLESIDE?2:1;for(let i=1;i<=K;++i)for(let K=0;K<B.length;++K){const i=B[K],Z=i.length;X=X<Z?X:Z;for(let S=0;S<X;++S){const X=i[S];Q[x]=X.x,Q[x+1]=X.y,Q[x+2]=X.z,f.minimizeInPlaceFromFloats(X.x,X.y,X.z),H.maximizeInPlaceFromFloats(X.x,X.y,X.z),x+=3}if(S._creationDataStorage&&S._creationDataStorage.closePath){const f=i[0];Q[x]=f.x,Q[x+1]=f.y,Q[x+2]=f.z,x+=3}}},N=z.getVerticesData(S.e.PositionKind);if(Z(N),z.hasBoundingInfo?z.getBoundingInfo().reConstruct(f,H,z._worldMatrix):z.buildBoundingInfo(f,H,z._worldMatrix),z.updateVerticesData(S.e.PositionKind,N,!1,!1),Q.za){const f=z.getVerticesData(S.e.ColorKind);for(let H=0,X=0;H<Q.za.length;H++,X+=4){const i=Q.za[H];f[X]=i.r,f[X+1]=i.g,f[X+2]=i.b,f[X+3]=i.a}z.updateVerticesData(S.e.ColorKind,f,!1,!1)}if(Q.Aa){const f=z.getVerticesData(S.e.UVKind);for(let H=0;H<Q.Aa.length;H++)f[2*H]=Q.Aa[H].x,f[2*H+1]=K.e?1-Q.Aa[H].y:Q.Aa[H].y;z.updateVerticesData(S.e.UVKind,f,!1,!1)}if(!z.areNormalsFrozen||z.isFacetDataEnabled){const f=z.Ud(),Q=z.getVerticesData(S.e.NormalKind),H=z.isFacetDataEnabled?z.getFacetDataParameters():null;if(x.b.ComputeNormals(N,f,Q,H),z._creationDataStorage&&z._creationDataStorage.closePath){let f=0,H=0;for(let X=0;X<B.length;X++)f=3*z._creationDataStorage.idx[X],H=X+1<B.length?3*(z._creationDataStorage.idx[X+1]-1):Q.length-3,Q[f]=.5*(Q[f]+Q[H]),Q[f+1]=.5*(Q[f+1]+Q[H+1]),Q[f+2]=.5*(Q[f+2]+Q[H+2]),Q[H]=Q[f],Q[H+1]=Q[f+1],Q[H+2]=Q[f+2]}z.areNormalsFrozen||z.updateVerticesData(S.e.NormalKind,Q,!1,!1)}return z}{const X=new i.b(f,H);X._originalBuilderSideOrientation=g,X._creationDataStorage=new i.d;const S=Z(Q);return J&&(X._creationDataStorage.idx=S._idx),X._creationDataStorage.closePath=J,X._creationDataStorage.closeArray=N,S.Ca(X,v),X}}x.b.CreateRibbon=Z,i.b.CreateRibbon=function(f,Q){return B(f,{pathArray:Q,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var N=H(11459),J=H(11356),g=H(1161);function z(f){const Q=f.pattern||i.b.NO_FLIP,H=f.tileWidth||f.tileSize||1,X=f.tileHeight||f.tileSize||1,S=f.alignHorizontal||0,K=f.alignVertical||0,Z=f.width||f.size||1,B=Math.floor(Z/H);let N=Z-B*H;const J=f.height||f.size||1,g=Math.floor(J/X);let z=J-g*X;const v=H*B/2,Y=X*g/2;let O=0,n=0,e=0,G=0,I=0,l=0;if(N>0||z>0){switch(e=-v,G=-Y,I=v,l=Y,S){case i.b.CENTER:N/=2,e-=N,I+=N;break;case i.b.LEFT:I+=N,O=-N/2;break;case i.b.RIGHT:e-=N,O=N/2}switch(K){case i.b.CENTER:z/=2,G-=z,l+=z;break;case i.b.BOTTOM:l+=z,n=-z/2;break;case i.b.TOP:G-=z,n=z/2}}const q=[],D=[],d=[];d[0]=[0,0,1,0,1,1,0,1],d[1]=[0,0,1,0,1,1,0,1],Q!==i.b.ROTATE_TILE&&Q!==i.b.ROTATE_ROW||(d[1]=[1,1,0,1,0,0,1,0]),Q!==i.b.FLIP_TILE&&Q!==i.b.FLIP_ROW||(d[1]=[1,0,0,0,0,1,1,1]),Q!==i.b.FLIP_N_ROTATE_TILE&&Q!==i.b.FLIP_N_ROTATE_ROW||(d[1]=[0,1,1,1,1,0,0,0]);let s=[];const F=[],P=[];let m=0;for(let x=0;x<g;x++)for(let f=0;f<B;f++)q.push(f*H-v+O,x*X-Y+n,0),q.push((f+1)*H-v+O,x*X-Y+n,0),q.push((f+1)*H-v+O,(x+1)*X-Y+n,0),q.push(f*H-v+O,(x+1)*X-Y+n,0),P.push(m,m+1,m+3,m+1,m+2,m+3),s=Q===i.b.FLIP_TILE||Q===i.b.ROTATE_TILE||Q===i.b.FLIP_N_ROTATE_TILE?s.concat(d[(f%2+x%2)%2]):Q===i.b.FLIP_ROW||Q===i.b.ROTATE_ROW||Q===i.b.FLIP_N_ROTATE_ROW?s.concat(d[x%2]):s.concat(d[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),m+=4;if(N>0||z>0){const f=z>0&&(K===i.b.CENTER||K===i.b.TOP),x=z>0&&(K===i.b.CENTER||K===i.b.BOTTOM),Z=N>0&&(S===i.b.CENTER||S===i.b.RIGHT),J=N>0&&(S===i.b.CENTER||S===i.b.LEFT);let d,c,W,R,U=[];if(f&&Z&&(q.push(e+O,G+n,0),q.push(-v+O,G+n,0),q.push(-v+O,G+z+n,0),q.push(e+O,G+z+n,0),P.push(m,m+1,m+3,m+1,m+2,m+3),m+=4,d=1-N/H,c=1-z/X,W=1,R=1,U=[d,c,W,c,W,R,d,R],Q===i.b.ROTATE_ROW&&(U=[1-d,1-c,1-W,1-c,1-W,1-R,1-d,1-R]),Q===i.b.FLIP_ROW&&(U=[1-d,c,1-W,c,1-W,R,1-d,R]),Q===i.b.FLIP_N_ROTATE_ROW&&(U=[d,1-c,W,1-c,W,1-R,d,1-R]),s=s.concat(U),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),f&&J&&(q.push(v+O,G+n,0),q.push(I+O,G+n,0),q.push(I+O,G+z+n,0),q.push(v+O,G+z+n,0),P.push(m,m+1,m+3,m+1,m+2,m+3),m+=4,d=0,c=1-z/X,W=N/H,R=1,U=[d,c,W,c,W,R,d,R],(Q===i.b.ROTATE_ROW||Q===i.b.ROTATE_TILE&&B%2===0)&&(U=[1-d,1-c,1-W,1-c,1-W,1-R,1-d,1-R]),(Q===i.b.FLIP_ROW||Q===i.b.FLIP_TILE&&B%2===0)&&(U=[1-d,c,1-W,c,1-W,R,1-d,R]),(Q===i.b.FLIP_N_ROTATE_ROW||Q===i.b.FLIP_N_ROTATE_TILE&&B%2===0)&&(U=[d,1-c,W,1-c,W,1-R,d,1-R]),s=s.concat(U),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),x&&Z&&(q.push(e+O,Y+n,0),q.push(-v+O,Y+n,0),q.push(-v+O,l+n,0),q.push(e+O,l+n,0),P.push(m,m+1,m+3,m+1,m+2,m+3),m+=4,d=1-N/H,c=0,W=1,R=z/X,U=[d,c,W,c,W,R,d,R],(Q===i.b.ROTATE_ROW&&g%2===1||Q===i.b.ROTATE_TILE&&g%1===0)&&(U=[1-d,1-c,1-W,1-c,1-W,1-R,1-d,1-R]),(Q===i.b.FLIP_ROW&&g%2===1||Q===i.b.FLIP_TILE&&g%2===0)&&(U=[1-d,c,1-W,c,1-W,R,1-d,R]),(Q===i.b.FLIP_N_ROTATE_ROW&&g%2===1||Q===i.b.FLIP_N_ROTATE_TILE&&g%2===0)&&(U=[d,1-c,W,1-c,W,1-R,d,1-R]),s=s.concat(U),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),x&&J&&(q.push(v+O,Y+n,0),q.push(I+O,Y+n,0),q.push(I+O,l+n,0),q.push(v+O,l+n,0),P.push(m,m+1,m+3,m+1,m+2,m+3),m+=4,d=0,c=0,W=N/H,R=z/X,U=[d,c,W,c,W,R,d,R],(Q===i.b.ROTATE_ROW&&g%2===1||Q===i.b.ROTATE_TILE&&(g+B)%2===1)&&(U=[1-d,1-c,1-W,1-c,1-W,1-R,1-d,1-R]),(Q===i.b.FLIP_ROW&&g%2===1||Q===i.b.FLIP_TILE&&(g+B)%2===1)&&(U=[1-d,c,1-W,c,1-W,R,1-d,R]),(Q===i.b.FLIP_N_ROTATE_ROW&&g%2===1||Q===i.b.FLIP_N_ROTATE_TILE&&(g+B)%2===1)&&(U=[d,1-c,W,1-c,W,1-R,d,1-R]),s=s.concat(U),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),f){const f=[];d=0,c=1-z/X,W=1,R=1,f[0]=[d,c,W,c,W,R,d,R],f[1]=[d,c,W,c,W,R,d,R],Q!==i.b.ROTATE_TILE&&Q!==i.b.ROTATE_ROW||(f[1]=[1-d,1-c,1-W,1-c,1-W,1-R,1-d,1-R]),Q!==i.b.FLIP_TILE&&Q!==i.b.FLIP_ROW||(f[1]=[1-d,c,1-W,c,1-W,R,1-d,R]),Q!==i.b.FLIP_N_ROTATE_TILE&&Q!==i.b.FLIP_N_ROTATE_ROW||(f[1]=[d,1-c,W,1-c,W,1-R,d,1-R]);for(let X=0;X<B;X++)q.push(X*H-v+O,G+n,0),q.push((X+1)*H-v+O,G+n,0),q.push((X+1)*H-v+O,G+z+n,0),q.push(X*H-v+O,G+z+n,0),P.push(m,m+1,m+3,m+1,m+2,m+3),m+=4,s=Q===i.b.FLIP_TILE||Q===i.b.ROTATE_TILE||Q===i.b.FLIP_N_ROTATE_TILE?s.concat(f[(X+1)%2]):Q===i.b.FLIP_ROW||Q===i.b.ROTATE_ROW||Q===i.b.FLIP_N_ROTATE_ROW?s.concat(f[1]):s.concat(f[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(x){const f=[];d=0,c=0,W=1,R=z/X,f[0]=[d,c,W,c,W,R,d,R],f[1]=[d,c,W,c,W,R,d,R],Q!==i.b.ROTATE_TILE&&Q!==i.b.ROTATE_ROW||(f[1]=[1-d,1-c,1-W,1-c,1-W,1-R,1-d,1-R]),Q!==i.b.FLIP_TILE&&Q!==i.b.FLIP_ROW||(f[1]=[1-d,c,1-W,c,1-W,R,1-d,R]),Q!==i.b.FLIP_N_ROTATE_TILE&&Q!==i.b.FLIP_N_ROTATE_ROW||(f[1]=[d,1-c,W,1-c,W,1-R,d,1-R]);for(let X=0;X<B;X++)q.push(X*H-v+O,l-z+n,0),q.push((X+1)*H-v+O,l-z+n,0),q.push((X+1)*H-v+O,l+n,0),q.push(X*H-v+O,l+n,0),P.push(m,m+1,m+3,m+1,m+2,m+3),m+=4,s=Q===i.b.FLIP_TILE||Q===i.b.ROTATE_TILE||Q===i.b.FLIP_N_ROTATE_TILE?s.concat(f[(X+g)%2]):Q===i.b.FLIP_ROW||Q===i.b.ROTATE_ROW||Q===i.b.FLIP_N_ROTATE_ROW?s.concat(f[g%2]):s.concat(f[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Z){const f=[];d=1-N/H,c=0,W=1,R=1,f[0]=[d,c,W,c,W,R,d,R],f[1]=[d,c,W,c,W,R,d,R],Q!==i.b.ROTATE_TILE&&Q!==i.b.ROTATE_ROW||(f[1]=[1-d,1-c,1-W,1-c,1-W,1-R,1-d,1-R]),Q!==i.b.FLIP_TILE&&Q!==i.b.FLIP_ROW||(f[1]=[1-d,c,1-W,c,1-W,R,1-d,R]),Q!==i.b.FLIP_N_ROTATE_TILE&&Q!==i.b.FLIP_N_ROTATE_ROW||(f[1]=[d,1-c,W,1-c,W,1-R,d,1-R]);for(let H=0;H<g;H++)q.push(e+O,H*X-Y+n,0),q.push(e+N+O,H*X-Y+n,0),q.push(e+N+O,(H+1)*X-Y+n,0),q.push(e+O,(H+1)*X-Y+n,0),P.push(m,m+1,m+3,m+1,m+2,m+3),m+=4,s=Q===i.b.FLIP_TILE||Q===i.b.ROTATE_TILE||Q===i.b.FLIP_N_ROTATE_TILE?s.concat(f[(H+1)%2]):Q===i.b.FLIP_ROW||Q===i.b.ROTATE_ROW||Q===i.b.FLIP_N_ROTATE_ROW?s.concat(f[H%2]):s.concat(f[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(J){const f=[];d=0,c=0,W=N/X,R=1,f[0]=[d,c,W,c,W,R,d,R],f[1]=[d,c,W,c,W,R,d,R],Q!==i.b.ROTATE_TILE&&Q!==i.b.ROTATE_ROW||(f[1]=[1-d,1-c,1-W,1-c,1-W,1-R,1-d,1-R]),Q!==i.b.FLIP_TILE&&Q!==i.b.FLIP_ROW||(f[1]=[1-d,c,1-W,c,1-W,R,1-d,R]),Q!==i.b.FLIP_N_ROTATE_TILE&&Q!==i.b.FLIP_N_ROTATE_ROW||(f[1]=[d,1-c,W,1-c,W,1-R,d,1-R]);for(let H=0;H<g;H++)q.push(I-N+O,H*X-Y+n,0),q.push(I+O,H*X-Y+n,0),q.push(I+O,(H+1)*X-Y+n,0),q.push(I-N+O,(H+1)*X-Y+n,0),P.push(m,m+1,m+3,m+1,m+2,m+3),m+=4,s=Q===i.b.FLIP_TILE||Q===i.b.ROTATE_TILE||Q===i.b.FLIP_N_ROTATE_TILE?s.concat(f[(H+B)%2]):Q===i.b.FLIP_ROW||Q===i.b.ROTATE_ROW||Q===i.b.FLIP_N_ROTATE_ROW?s.concat(f[H%2]):s.concat(f[0]),F.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const c=0===f.sideOrientation?0:f.sideOrientation||x.b.DEFAULTSIDE;x.b._ComputeSides(c,q,P,D,s,f.frontUVs,f.backUVs);const W=new x.b;W.indices=P,W.xa=q,W.ya=D,W.Aa=s;const R=c===x.b.DOUBLESIDE?F.concat(F):F;return W.za=R,W}function v(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new i.b(f,H);Q.sideOrientation=i.b._GetDefaultSideOrientation(Q.sideOrientation),X._originalBuilderSideOrientation=Q.sideOrientation;return z(Q).Ca(X,Q.updatable),X}function Y(f){const Q=f.faceUV||new Array(6),H=f.faceColors,S=f.pattern||i.b.NO_FLIP,Z=f.width||f.size||1,B=f.height||f.size||1,N=f.depth||f.size||1,J=f.tileWidth||f.tileSize||1,v=f.tileHeight||f.tileSize||1,Y=f.alignHorizontal||0,O=f.alignVertical||0,n=0===f.sideOrientation?0:f.sideOrientation||x.b.DEFAULTSIDE;for(let i=0;i<6;i++)void 0===Q[i]&&(Q[i]=new X.s(0,0,1,1)),H&&void 0===H[i]&&(H[i]=new g.h(1,1,1,1));const e=Z/2,G=B/2,I=N/2,l=[];for(let X=0;X<2;X++)l[X]=z({pattern:S,tileWidth:J,tileHeight:v,width:Z,height:B,alignVertical:O,alignHorizontal:Y,sideOrientation:n});for(let X=2;X<4;X++)l[X]=z({pattern:S,tileWidth:J,tileHeight:v,width:N,height:B,alignVertical:O,alignHorizontal:Y,sideOrientation:n});let q=O;O===i.b.BOTTOM?q=i.b.TOP:O===i.b.TOP&&(q=i.b.BOTTOM);for(let X=4;X<6;X++)l[X]=z({pattern:S,tileWidth:J,tileHeight:v,width:Z,height:N,alignVertical:q,alignHorizontal:Y,sideOrientation:n});let D=[],d=[],s=[],F=[];const P=[],m=[],c=[],W=[];let R=0,U=0;for(let i=0;i<6;i++){const f=l[i].xa.length;m[i]=[],c[i]=[];for(let Q=0;Q<f/3;Q++)m[i].push(new X.p(l[i].xa[3*Q],l[i].xa[3*Q+1],l[i].xa[3*Q+2])),c[i].push(new X.p(l[i].ya[3*Q],l[i].ya[3*Q+1],l[i].ya[3*Q+2]));R=l[i].Aa.length,W[i]=[];for(let H=0;H<R;H+=2)W[i][H]=Q[i].x+(Q[i].z-Q[i].x)*l[i].Aa[H],W[i][H+1]=Q[i].y+(Q[i].w-Q[i].y)*l[i].Aa[H+1],K.e&&(W[i][H+1]=1-W[i][H+1]);if(s=s.concat(W[i]),F=F.concat(l[i].indices.map((f=>f+U))),U+=m[i].length,H)for(let Q=0;Q<4;Q++)P.push(H[i].r,H[i].g,H[i].b,H[i].a)}const E=new X.p(0,0,I),t=X.e.RotationY(Math.PI);D=m[0].map((f=>X.p.TransformNormal(f,t).add(E))).map((f=>[f.x,f.y,f.z])).reduce(((f,Q)=>f.concat(Q)),[]),d=c[0].map((f=>X.p.TransformNormal(f,t))).map((f=>[f.x,f.y,f.z])).reduce(((f,Q)=>f.concat(Q)),[]),D=D.concat(m[1].map((f=>f.hd(E))).map((f=>[f.x,f.y,f.z])).reduce(((f,Q)=>f.concat(Q)),[])),d=d.concat(c[1].map((f=>[f.x,f.y,f.z])).reduce(((f,Q)=>f.concat(Q)),[]));const u=new X.p(e,0,0),L=X.e.RotationY(-Math.PI/2);D=D.concat(m[2].map((f=>X.p.TransformNormal(f,L).add(u))).map((f=>[f.x,f.y,f.z])).reduce(((f,Q)=>f.concat(Q)),[])),d=d.concat(c[2].map((f=>X.p.TransformNormal(f,L))).map((f=>[f.x,f.y,f.z])).reduce(((f,Q)=>f.concat(Q)),[]));const A=X.e.RotationY(Math.PI/2);D=D.concat(m[3].map((f=>X.p.TransformNormal(f,A).hd(u))).map((f=>[f.x,f.y,f.z])).reduce(((f,Q)=>f.concat(Q)),[])),d=d.concat(c[3].map((f=>X.p.TransformNormal(f,A))).map((f=>[f.x,f.y,f.z])).reduce(((f,Q)=>f.concat(Q)),[]));const a=new X.p(0,G,0),V=X.e.RotationX(Math.PI/2);D=D.concat(m[4].map((f=>X.p.TransformNormal(f,V).add(a))).map((f=>[f.x,f.y,f.z])).reduce(((f,Q)=>f.concat(Q)),[])),d=d.concat(c[4].map((f=>X.p.TransformNormal(f,V))).map((f=>[f.x,f.y,f.z])).reduce(((f,Q)=>f.concat(Q)),[]));const M=X.e.RotationX(-Math.PI/2);D=D.concat(m[5].map((f=>X.p.TransformNormal(f,M).hd(a))).map((f=>[f.x,f.y,f.z])).reduce(((f,Q)=>f.concat(Q)),[])),d=d.concat(c[5].map((f=>X.p.TransformNormal(f,M))).map((f=>[f.x,f.y,f.z])).reduce(((f,Q)=>f.concat(Q)),[])),x.b._ComputeSides(n,D,F,d,s);const r=new x.b;if(r.indices=F,r.xa=D,r.ya=d,r.Aa=s,H){const f=n===x.b.DOUBLESIDE?P.concat(P):P;r.za=f}return r}function O(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new i.b(f,H);Q.sideOrientation=i.b._GetDefaultSideOrientation(Q.sideOrientation),X._originalBuilderSideOrientation=Q.sideOrientation;return Y(Q).Ca(X,Q.updatable),X}x.b.CreateTiledPlane=z;x.b.CreateTiledBox=Y;var n=H(11445),e=H(1196),G=H(1495);function I(f){const Q=f.height||2;let H=0===f.diameterTop?0:f.diameterTop||f.diameter||1,S=0===f.diameterBottom?0:f.diameterBottom||f.diameter||1;H=H||1e-5,S=S||1e-5;const Z=0|(f.al||24),B=0|(f.subdivisions||1),N=!!f.hasRings,J=!!f.enclose,z=0===f.cap?0:f.cap||i.b.CAP_ALL,v=f.arc&&(f.arc<=0||f.arc>1)?1:f.arc||1,Y=0===f.sideOrientation?0:f.sideOrientation||x.b.DEFAULTSIDE,O=f.faceUV||new Array(3),n=f.faceColors,e=2+(1+(1!==v&&J?2:0))*(N?B:1);let I;for(I=0;I<e;I++)n&&void 0===n[I]&&(n[I]=new g.h(1,1,1,1));for(I=0;I<e;I++)O&&void 0===O[I]&&(O[I]=new X.s(0,0,1,1));const l=[],q=[],D=[],d=[],s=[],F=2*Math.PI*v/Z;let P,m,c;const W=(S-H)/2/Q,R=X.p.Zero(),U=X.p.Zero(),E=X.p.Zero(),t=X.p.Zero(),u=X.p.Zero(),L=G.b.Y;let A,a,V,M=1,r=1,j=0,T=0;for(A=0;A<=B;A++)for(m=A/B,c=(m*(H-S)+S)/2,M=N&&0!==A&&A!==B?2:1,V=0;V<M;V++){for(N&&(r+=V),J&&(r+=2*V),a=0;a<=Z;a++)P=a*F,R.x=Math.cos(-P)*c,R.y=-Q/2+m*Q,R.z=Math.sin(-P)*c,0===H&&A===B?(U.x=D[D.length-3*(Z+1)],U.y=D[D.length-3*(Z+1)+1],U.z=D[D.length-3*(Z+1)+2]):(U.x=R.x,U.z=R.z,U.y=Math.sqrt(U.x*U.x+U.z*U.z)*W,U.normalize()),0===a&&(E.p(R),t.p(U)),q.push(R.x,R.y,R.z),D.push(U.x,U.y,U.z),T=N?j!==r?O[r].y:O[r].w:O[r].y+(O[r].w-O[r].y)*m,d.push(O[r].x+(O[r].z-O[r].x)*a/Z,K.e?1-T:T),n&&s.push(n[r].r,n[r].g,n[r].b,n[r].a);1!==v&&J&&(q.push(R.x,R.y,R.z),q.push(0,R.y,0),q.push(0,R.y,0),q.push(E.x,E.y,E.z),X.p.CrossToRef(L,U,u),u.normalize(),D.push(u.x,u.y,u.z,u.x,u.y,u.z),X.p.CrossToRef(t,L,u),u.normalize(),D.push(u.x,u.y,u.z,u.x,u.y,u.z),T=N?j!==r?O[r+1].y:O[r+1].w:O[r+1].y+(O[r+1].w-O[r+1].y)*m,d.push(O[r+1].x,K.e?1-T:T),d.push(O[r+1].z,K.e?1-T:T),T=N?j!==r?O[r+2].y:O[r+2].w:O[r+2].y+(O[r+2].w-O[r+2].y)*m,d.push(O[r+2].x,K.e?1-T:T),d.push(O[r+2].z,K.e?1-T:T),n&&(s.push(n[r+1].r,n[r+1].g,n[r+1].b,n[r+1].a),s.push(n[r+1].r,n[r+1].g,n[r+1].b,n[r+1].a),s.push(n[r+2].r,n[r+2].g,n[r+2].b,n[r+2].a),s.push(n[r+2].r,n[r+2].g,n[r+2].b,n[r+2].a))),j!==r&&(j=r)}const k=1!==v&&J?Z+4:Z;for(A=0,r=0;r<B;r++){let f=0,Q=0,H=0,X=0;for(a=0;a<Z;a++)f=A*(k+1)+a,Q=(A+1)*(k+1)+a,H=A*(k+1)+(a+1),X=(A+1)*(k+1)+(a+1),l.push(f,Q,H),l.push(X,H,Q);1!==v&&J&&(l.push(f+2,Q+2,H+2),l.push(X+2,H+2,Q+2),l.push(f+4,Q+4,H+4),l.push(X+4,H+4,Q+4)),A=N?A+2:A+1}const y=f=>{const i=f?H/2:S/2;if(0===i)return;let x,B,N;const J=f?O[e-1]:O[0];let g=null;n&&(g=f?n[e-1]:n[0]);const z=q.length/3,Y=f?Q/2:-Q/2,G=new X.p(0,Y,0);q.push(G.x,G.y,G.z),D.push(0,f?1:-1,0);const I=J.y+.5*(J.w-J.y);d.push(J.x+.5*(J.z-J.x),K.e?1-I:I),g&&s.push(g.r,g.g,g.b,g.a);const F=new X.m(.5,.5);for(N=0;N<=Z;N++){x=2*Math.PI*N*v/Z;const Q=Math.cos(-x),H=Math.sin(-x);B=new X.p(Q*i,Y,H*i);const S=new X.m(Q*F.x+.5,H*F.y+.5);q.push(B.x,B.y,B.z),D.push(0,f?1:-1,0);const z=J.y+(J.w-J.y)*S.y;d.push(J.x+(J.z-J.x)*S.x,K.e?1-z:z),g&&s.push(g.r,g.g,g.b,g.a)}for(N=0;N<Z;N++)f?(l.push(z),l.push(z+(N+2)),l.push(z+(N+1))):(l.push(z),l.push(z+(N+1)),l.push(z+(N+2)))};z!==i.b.CAP_START&&z!==i.b.CAP_ALL||y(!1),z!==i.b.CAP_END&&z!==i.b.CAP_ALL||y(!0),x.b._ComputeSides(Y,q,l,D,d,f.frontUVs,f.backUVs);const h=new x.b;return h.indices=l,h.xa=q,h.ya=D,h.Aa=d,n&&(h.za=s),h}function l(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;const X=new i.b(f,H);Q.sideOrientation=i.b._GetDefaultSideOrientation(Q.sideOrientation),X._originalBuilderSideOrientation=Q.sideOrientation;return I(Q).Ca(X,Q.updatable),X}function q(f){const Q=[],H=[],i=[],S=[],Z=f.diameter||1,B=f.thickness||.5,N=0|(f.al||16),J=0===f.sideOrientation?0:f.sideOrientation||x.b.DEFAULTSIDE,g=N+1;for(let x=0;x<=N;x++){const f=x/N,J=x*Math.PI*2/N-Math.PI/2,z=X.e.Translation(Z/2,0,0).multiply(X.e.RotationY(J));for(let Z=0;Z<=N;Z++){const J=1-Z/N,v=Z*Math.PI*2/N+Math.PI,Y=Math.cos(v),O=Math.sin(v);let n=new X.p(Y,O,0),e=n.scale(B/2);const G=new X.m(f,J);e=X.p.TransformCoordinates(e,z),n=X.p.TransformNormal(n,z),H.push(e.x,e.y,e.z),i.push(n.x,n.y,n.z),S.push(G.x,K.e?1-G.y:G.y);const I=(x+1)%g,l=(Z+1)%g;Q.push(x*g+Z),Q.push(x*g+l),Q.push(I*g+Z),Q.push(x*g+l),Q.push(I*g+l),Q.push(I*g+Z)}}x.b._ComputeSides(J,H,Q,i,S,f.frontUVs,f.backUVs);const z=new x.b;return z.indices=Q,z.xa=H,z.ya=i,z.Aa=S,z}function D(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;const X=new i.b(f,H);Q.sideOrientation=i.b._GetDefaultSideOrientation(Q.sideOrientation),X._originalBuilderSideOrientation=Q.sideOrientation;return q(Q).Ca(X,Q.updatable),X}x.b.CreateCylinder=I,i.b.CreateCylinder=(f,Q,H,X,S,x,K,Z,B)=>{void 0!==K&&K instanceof e.e||(void 0!==K&&(B=Z||i.b.DEFAULTSIDE,Z=K),K=x,x=1);return l(f,{height:Q,diameterTop:H,diameterBottom:X,al:S,subdivisions:x,sideOrientation:B,updatable:Z},K)};function d(f){const Q=[],H=[],i=[],S=[],Z=f.i||2,B=f.tube||.5,N=f.radialSegments||32,J=f.tubularSegments||32,g=f.p||2,z=f.q||3,v=0===f.sideOrientation?0:f.sideOrientation||x.b.DEFAULTSIDE,Y=f=>{const Q=Math.cos(f),H=Math.sin(f),i=z/g*f,S=Math.cos(i),x=Z*(2+S)*.5*Q,K=Z*(2+S)*H*.5,B=Z*Math.sin(i)*.5;return new X.p(x,K,B)};let O,n;for(O=0;O<=N;O++){const f=O%N/N*2*g*Math.PI,Q=Y(f),i=Y(f+.01),x=i.hd(Q);let Z=i.add(Q);const z=X.p.Cross(x,Z);for(Z=X.p.Cross(z,x),z.normalize(),Z.normalize(),n=0;n<J;n++){const f=n%J/J*2*Math.PI,X=-B*Math.cos(f),i=B*Math.sin(f);H.push(Q.x+X*Z.x+i*z.x),H.push(Q.y+X*Z.y+i*z.y),H.push(Q.z+X*Z.z+i*z.z),S.push(O/N),S.push(K.e?1-n/J:n/J)}}for(O=0;O<N;O++)for(n=0;n<J;n++){const f=(n+1)%J,H=O*J+n,X=(O+1)*J+n,i=(O+1)*J+f,S=O*J+f;Q.push(S),Q.push(X),Q.push(H),Q.push(S),Q.push(i),Q.push(X)}x.b.ComputeNormals(H,Q,i),x.b._ComputeSides(v,H,Q,i,S,f.frontUVs,f.backUVs);const e=new x.b;return e.indices=Q,e.xa=H,e.ya=i,e.Aa=S,e}function s(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;const X=new i.b(f,H);Q.sideOrientation=i.b._GetDefaultSideOrientation(Q.sideOrientation),X._originalBuilderSideOrientation=Q.sideOrientation;return d(Q).Ca(X,Q.updatable),X}x.b.CreateTorus=q,i.b.CreateTorus=(f,Q,H,X,i,S,x)=>D(f,{diameter:Q,thickness:H,al:X,sideOrientation:x,updatable:S},i);x.b.CreateTorusKnot=d,i.b.CreateTorusKnot=(f,Q,H,X,i,S,x,K,Z,B)=>s(f,{i:Q,tube:H,radialSegments:X,tubularSegments:i,p:S,q:x,sideOrientation:B,updatable:Z},K);var F=H(12256),P=H(1092),m=H(1498),c=H(1011),W=H(1027);class R extends X.m{constructor(f,Q){super(f.x,f.y),this.index=Q}}class U{constructor(){this.elements=[]}add(f){const Q=[];return f.forEach((f=>{const H=new R(f,this.elements.length);Q.push(H),this.elements.push(H)})),Q}computeBounds(){const f=new X.m(this.elements[0].x,this.elements[0].y),Q=new X.m(this.elements[0].x,this.elements[0].y);return this.elements.forEach((H=>{H.x<f.x?f.x=H.x:H.x>Q.x&&(Q.x=H.x),H.y<f.y?f.y=H.y:H.y>Q.y&&(Q.y=H.y)})),{min:f,max:Q,width:Q.x-f.x,height:Q.y-f.y}}}class E{_addToepoint(f){for(const Q of f)this._epoints.push(Q.x,Q.y)}constructor(f,Q,H){let X,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new U,this._outlinepoints=new U,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=i,this._name=f,this._scene=H||W.e.LastCreatedScene,X=Q instanceof m.g?Q.getPoints():Q,this._addToepoint(X),this._points.add(X),this._outlinepoints.add(X),"undefined"===typeof this.bjsEarcut&&P.b.Warn("Earcut was not found, the polygon will not be built.")}addHole(f){this._points.add(f);const Q=new U;return Q.add(f),this._holes.push(Q),this._eholes.push(this._epoints.length/2),this._addToepoint(f),this}build(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const X=new i.b(this._name,this._scene),x=this.buildVertexData(Q,H);return X.Ga(S.e.PositionKind,x.xa,f),X.Ga(S.e.NormalKind,x.ya,f),X.Ga(S.e.UVKind,x.Aa,f),X.setIndices(x.indices),X}buildVertexData(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const H=new x.b,X=[],i=[],S=[],K=this._points.computeBounds();this._points.elements.forEach((f=>{X.push(0,1,0),i.push(f.x,0,f.y),S.push((f.x-K.min.x)/K.width,(f.y-K.min.y)/K.height)}));const Z=[],B=this.bjsEarcut(this._epoints,this._eholes,2);for(let x=0;x<B.length;x++)Z.push(B[x]);if(f>0){const H=i.length/3;this._points.elements.forEach((Q=>{X.push(0,-1,0),i.push(Q.x,-f,Q.y),S.push(1-(Q.x-K.min.x)/K.width,1-(Q.y-K.min.y)/K.height)}));const x=Z.length;for(let f=0;f<x;f+=3){const Q=Z[f+0],X=Z[f+1],i=Z[f+2];Z.push(i+H),Z.push(X+H),Z.push(Q+H)}this._addSide(i,X,S,Z,K,this._outlinepoints,f,!1,Q),this._holes.forEach((H=>{this._addSide(i,X,S,Z,K,H,f,!0,Q)}))}return H.indices=Z,H.xa=i,H.ya=X,H.Aa=S,H}_addSide(f,Q,H,i,S,x,K,Z,B){let N=f.length/3,J=0;for(let g=0;g<x.elements.length;g++){const z=x.elements[g],v=x.elements[(g+1)%x.elements.length];f.push(z.x,0,z.y),f.push(z.x,-K,z.y),f.push(v.x,0,v.y),f.push(v.x,-K,v.y);const Y=x.elements[(g+x.elements.length-1)%x.elements.length],O=x.elements[(g+2)%x.elements.length];let n=new X.p(-(v.y-z.y),0,v.x-z.x),e=new X.p(-(z.y-Y.y),0,z.x-Y.x),G=new X.p(-(O.y-v.y),0,O.x-v.x);Z||(n=n.scale(-1),e=e.scale(-1),G=G.scale(-1));const I=n.normalizeToNew();let l=e.normalizeToNew(),q=G.normalizeToNew();const D=X.p.Dot(l,I);l=D>B?D<c.c-1?new X.p(z.x,0,z.y).hd(new X.p(v.x,0,v.y)).normalize():e.add(n).normalize():I;const d=X.p.Dot(G,n);q=d>B?d<c.c-1?new X.p(v.x,0,v.y).hd(new X.p(z.x,0,z.y)).normalize():G.add(n).normalize():I,H.push(J/S.width,0),H.push(J/S.width,1),J+=n.length(),H.push(J/S.width,0),H.push(J/S.width,1),Q.push(l.x,l.y,l.z),Q.push(l.x,l.y,l.z),Q.push(q.x,q.y,q.z),Q.push(q.x,q.y,q.z),Z?(i.push(N),i.push(N+2),i.push(N+1),i.push(N+1),i.push(N+2),i.push(N+3)):(i.push(N),i.push(N+1),i.push(N+2),i.push(N+1),i.push(N+3),i.push(N+2)),N+=4}}}function t(f,Q,H,i,Z,B,N){const J=H||new Array(3),z=i,v=[],Y=N||!1;for(let S=0;S<3;S++)void 0===J[S]&&(J[S]=new X.s(0,0,1,1)),z&&void 0===z[S]&&(z[S]=new g.h(1,1,1,1));const O=f.getVerticesData(S.e.PositionKind),n=f.getVerticesData(S.e.NormalKind),e=f.getVerticesData(S.e.UVKind),G=f.Ud(),I=O.length/9;let l=0,q=0,D=0,d=0,s=0;const F=[0];if(Y)for(let X=I;X<O.length/3;X+=4)q=O[3*(X+2)]-O[3*X],D=O[3*(X+2)+2]-O[3*X+2],d=Math.sqrt(q*q+D*D),s+=d,F.push(s);let P=0,m=0;for(let X=0;X<n.length;X+=3)Math.abs(n[X+1])<.001&&(m=1),Math.abs(n[X+1]-1)<.001&&(m=0),Math.abs(n[X+1]+1)<.001&&(m=2),P=X/3,1===m?(l=P-I,e[2*P]=l%4<1.5?Y?J[m].x+(J[m].z-J[m].x)*F[Math.floor(l/4)]/s:J[m].x:Y?J[m].x+(J[m].z-J[m].x)*F[Math.floor(l/4)+1]/s:J[m].z,e[2*P+1]=l%2===0?K.e?1-J[m].w:J[m].w:K.e?1-J[m].y:J[m].y):(e[2*P]=(1-e[2*P])*J[m].x+e[2*P]*J[m].z,e[2*P+1]=(1-e[2*P+1])*J[m].y+e[2*P+1]*J[m].w,K.e&&(e[2*P+1]=1-e[2*P+1])),z&&v.push(z[m].r,z[m].g,z[m].b,z[m].a);x.b._ComputeSides(Q,O,G,n,e,Z,B);const c=new x.b;if(c.indices=G,c.xa=O,c.ya=n,c.Aa=e,z){const f=Q===x.b.DOUBLESIDE?v.concat(v):v;c.za=f}return c}function u(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;Q.sideOrientation=i.b._GetDefaultSideOrientation(Q.sideOrientation);const x=Q.shape,K=Q.holes||[],Z=Q.depth||0,B=Q.smoothingThreshold||2,N=[];let J=[];for(let i=0;i<x.length;i++)N[i]=new X.m(x[i].x,x[i].z);N[0].equalsWithEpsilon(N[N.length-1],1e-8)&&N.pop();const g=new E(f,N,H||W.e.LastCreatedScene,S);for(let i=0;i<K.length;i++){J=[];for(let f=0;f<K[i].length;f++)J.push(new X.m(K[i][f].x,K[i][f].z));g.addHole(J)}const z=g.build(!1,Z,B);z._originalBuilderSideOrientation=Q.sideOrientation;return t(z,Q.sideOrientation,Q.faceUV,Q.faceColors,Q.frontUVs,Q.backUVs,Q.wrap).Ca(z,Q.updatable),z}function L(f,Q){return u(f,Q,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function A(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=Q.path,S=Q.shape,x=Q.scale||1,K=Q.rotation||0,Z=0===Q.cap?0:Q.cap||i.b.NO_CAP,B=Q.updatable,N=i.b._GetDefaultSideOrientation(Q.sideOrientation),J=Q.instance||null,g=Q.invertUV||!1,z=Q.closeShape||!1;return V(f,S,X,x,K,null,null,Q.closePath||!1,z,Z,!1,H,!!B,N,J,g,Q.frontUVs||null,Q.backUVs||null,Q.firstNormal||null,!!Q.adjustFrame)}function a(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=Q.path,S=Q.shape,x=Q.scaleFunction||(()=>1),K=Q.rotationFunction||(()=>0),Z=Q.closePath||Q.ribbonCloseArray||!1,B=Q.closeShape||Q.ribbonClosePath||!1,N=0===Q.cap?0:Q.cap||i.b.NO_CAP,J=Q.updatable,g=Q.firstNormal||null,z=Q.adjustFrame||!1;return V(f,S,X,null,null,x,K,Z,B,N,!0,H,!!J,i.b._GetDefaultSideOrientation(Q.sideOrientation),Q.instance||null,Q.invertUV||!1,Q.frontUVs||null,Q.backUVs||null,g,z)}function V(f,Q,H,S,x,K,Z,N,J,g,z,v,Y,O,n,e,G,I,l,q){const D=(f,Q,H,S,x,K,Z,B,N,J,g)=>{const z=H.getTangents(),v=H.getNormals(),Y=H.getBinormals(),O=H.getDistances();if(g)for(let i=0;i<z.length;i++)if(0==z[i].x&&0==z[i].y&&0==z[i].z&&z[i].p(z[i-1]),0==v[i].x&&0==v[i].y&&0==v[i].z&&v[i].p(v[i-1]),0==Y[i].x&&0==Y[i].y&&0==Y[i].z&&Y[i].p(Y[i-1]),i>0){let f=z[i-1];X.p.Dot(f,z[i])<0&&z[i].scaleInPlace(-1),f=v[i-1],X.p.Dot(f,v[i])<0&&v[i].scaleInPlace(-1),f=Y[i-1],X.p.Dot(f,Y[i])<0&&Y[i].scaleInPlace(-1)}let n=0;const e=J&&B?B:()=>null!==K?K:0,G=J&&Z?Z:()=>null!==x?x:1;let I=N===i.b.NO_CAP||N===i.b.CAP_END?0:2;const l=X.l.Matrix[0];for(let i=0;i<Q.length;i++){const H=[],x=e(i,O[i]),K=G(i,O[i]);X.e.RotationAxisToRef(z[i],n,l);for(let S=0;S<f.length;S++){const x=z[i].scale(f[S].z).add(v[i].scale(f[S].x)).add(Y[i].scale(f[S].y)),Z=X.p.Zero();X.p.TransformCoordinatesToRef(x,l,Z),Z.scaleInPlace(K).addInPlace(Q[i]),H[S]=Z}S[I]=H,n+=x,I++}const q=f=>{const Q=Array(),H=X.p.Zero();let i;for(i=0;i<f.length;i++)H.addInPlace(f[i]);for(H.scaleInPlace(1/f.length),i=0;i<f.length;i++)Q.push(H);return Q};switch(N){case i.b.NO_CAP:break;case i.b.CAP_START:S[0]=q(S[2]),S[1]=S[2];break;case i.b.CAP_END:S[I]=S[I-1],S[I+1]=q(S[I-1]);break;case i.b.CAP_ALL:S[0]=q(S[2]),S[1]=S[2],S[I]=S[I-1],S[I+1]=q(S[I-1])}return S};let d,s;if(n){const f=n._creationDataStorage;return d=l?f.path3D.update(H,l):f.path3D.update(H),s=D(Q,H,f.path3D,f.pathArray,S,x,K,Z,f.cap,z,q),n=B("",{pathArray:s,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:n},v||void 0)}d=l?new m.h(H,l):new m.h(H);s=D(Q,H,d,new Array,S,x,K,Z,g=g<0||g>3?0:g,z,q);const F=B(f,{pathArray:s,closeArray:N,closePath:J,updatable:Y,sideOrientation:O,invertUV:e,frontUVs:G||void 0,backUVs:I||void 0},v);return F._creationDataStorage.pathArray=s,F._creationDataStorage.path3D=d,F._creationDataStorage.cap=g,F}x.b.CreatePolygon=t,i.b.CreatePolygon=function(f,Q,H,X,i,S){return u(f,{shape:Q,holes:X,updatable:i,sideOrientation:S},H,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},i.b.ExtrudePolygon=function(f,Q,H,X,i,S,x){return L(f,{shape:Q,holes:i,depth:H,updatable:S,sideOrientation:x},X,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function M(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=Q.arc?Q.arc<=0||Q.arc>1?1:Q.arc:1,x=void 0===Q.closed||Q.closed,K=Q.shape,Z=Q.i||1,N=Q.al||64,J=Q.clip||0,g=Q.updatable,z=i.b._GetDefaultSideOrientation(Q.sideOrientation),v=Q.cap||i.b.NO_CAP,Y=2*Math.PI,O=[],n=Q.invertUV||!1;let e=0,G=0;const I=Y/N*S;let l,q;for(e=0;e<=N-J;e++){for(q=[],v!=i.b.CAP_START&&v!=i.b.CAP_ALL||(q.push(new X.p(0,K[0].y,0)),q.push(new X.p(Math.cos(e*I)*K[0].x*Z,K[0].y,Math.sin(e*I)*K[0].x*Z))),G=0;G<K.length;G++)l=new X.p(Math.cos(e*I)*K[G].x*Z,K[G].y,Math.sin(e*I)*K[G].x*Z),q.push(l);v!=i.b.CAP_END&&v!=i.b.CAP_ALL||(q.push(new X.p(Math.cos(e*I)*K[K.length-1].x*Z,K[K.length-1].y,Math.sin(e*I)*K[K.length-1].x*Z)),q.push(new X.p(0,K[K.length-1].y,0))),O.push(q)}return B(f,{pathArray:O,closeArray:x,sideOrientation:z,updatable:g,invertUV:n,frontUVs:Q.frontUVs,backUVs:Q.backUVs},H)}i.b.ExtrudeShape=function(f,Q,H,X,S,x){let K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7?arguments[7]:void 0,B=arguments.length>8?arguments[8]:void 0,N=arguments.length>9?arguments[9]:void 0;return A(f,{shape:Q,path:H,scale:X,rotation:S,cap:0===x?0:x||i.b.NO_CAP,sideOrientation:B,instance:N,updatable:Z},K)},i.b.ExtrudeShapeCustom=(f,Q,H,X,S,x,K,Z,B,N,J,g)=>a(f,{shape:Q,path:H,scaleFunction:X,rotationFunction:S,ribbonCloseArray:x,ribbonClosePath:K,cap:0===Z?0:Z||i.b.NO_CAP,sideOrientation:J,instance:g,updatable:N},B);i.b.CreateLathe=(f,Q,H,X,i,S,x)=>M(f,{shape:Q,i:H,al:X,sideOrientation:x,updatable:S},i);var r=H(11402),j=H(11363);function T(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=Q.path;let x=Q.instance,K=1;void 0!==Q.i?K=Q.i:x&&(K=x._creationDataStorage.i);const Z=Q.al||64,N=Q.radiusFunction||null;let J=Q.cap||i.b.NO_CAP;const g=Q.invertUV||!1,z=Q.updatable,v=i.b._GetDefaultSideOrientation(Q.sideOrientation);Q.arc=Q.arc&&(Q.arc<=0||Q.arc>1)?1:Q.arc||1;const Y=(f,Q,H,S,x,K,Z,B)=>{const N=Q.getTangents(),J=Q.getNormals(),g=Q.getDistances(),z=2*Math.PI/x*B,v=K||(()=>S);let Y,O,n,e;const G=X.l.Matrix[0];let I=Z===i.b.NO_CAP||Z===i.b.CAP_END?0:2;for(let i=0;i<f.length;i++){O=v(i,g[i]),Y=Array(),n=J[i];for(let Q=0;Q<x;Q++)X.e.RotationAxisToRef(N[i],z*Q,G),e=Y[Q]?Y[Q]:X.p.Zero(),X.p.TransformCoordinatesToRef(n,G,e),e.scaleInPlace(O).addInPlace(f[i]),Y[Q]=e;H[I]=Y,I++}const l=(Q,H)=>{const X=Array();for(let i=0;i<Q;i++)X.push(f[H]);return X};switch(Z){case i.b.NO_CAP:break;case i.b.CAP_START:H[0]=l(x,0),H[1]=H[2].slice(0);break;case i.b.CAP_END:H[I]=H[I-1].slice(0),H[I+1]=l(x,f.length-1);break;case i.b.CAP_ALL:H[0]=l(x,0),H[1]=H[2].slice(0),H[I]=H[I-1].slice(0),H[I+1]=l(x,f.length-1)}return H};let O,n;if(x){const f=x._creationDataStorage,H=Q.arc||f.arc;return O=f.path3D.update(S),n=Y(S,O,f.pathArray,K,f.al,N,f.cap,H),x=B("",{pathArray:n,instance:x}),f.path3D=O,f.pathArray=n,f.arc=H,f.i=K,x}O=new m.h(S);J=J<0||J>3?0:J,n=Y(S,O,new Array,K,Z,N,J,Q.arc);const e=B(f,{pathArray:n,closePath:!0,closeArray:!1,updatable:z,sideOrientation:v,invertUV:g,frontUVs:Q.frontUVs,backUVs:Q.backUVs},H);return e._creationDataStorage.pathArray=n,e._creationDataStorage.path3D=O,e._creationDataStorage.al=Z,e._creationDataStorage.cap=J,e._creationDataStorage.arc=Q.arc,e._creationDataStorage.i=K,e}function k(f){const Q=[];Q[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},Q[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},Q[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},Q[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},Q[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},Q[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},Q[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},Q[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},Q[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},Q[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},Q[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},Q[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},Q[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},Q[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},Q[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const H=f.type&&(f.type<0||f.type>=Q.length)?0:f.type||0,i=f.size,S=f.sizeX||i||1,Z=f.sizeY||i||1,B=f.sizeZ||i||1,N=f.custom||Q[H],J=N.face.length,z=f.faceUV||new Array(J),v=f.faceColors,Y=void 0===f.flat||f.flat,O=0===f.sideOrientation?0:f.sideOrientation||x.b.DEFAULTSIDE,n=[],e=[],G=[],I=[],l=[];let q=0,D=0;const d=[];let s,F,P,m,c,W,R=0,U=0;if(Y)for(U=0;U<J;U++)v&&void 0===v[U]&&(v[U]=new g.h(1,1,1,1)),z&&void 0===z[U]&&(z[U]=new X.s(0,0,1,1));if(Y)for(U=0;U<J;U++){const f=N.face[U].length;for(P=2*Math.PI/f,m=.5*Math.tan(P/2),c=.5,R=0;R<f;R++)n.push(N.vertex[N.face[U][R]][0]*S,N.vertex[N.face[U][R]][1]*Z,N.vertex[N.face[U][R]][2]*B),d.push(q),q++,s=z[U].x+(z[U].z-z[U].x)*(.5+m),F=z[U].y+(z[U].w-z[U].y)*(c-.5),I.push(s,K.e?1-F:F),W=m*Math.cos(P)-c*Math.sin(P),c=m*Math.sin(P)+c*Math.cos(P),m=W,v&&l.push(v[U].r,v[U].g,v[U].b,v[U].a);for(R=0;R<f-2;R++)e.push(d[0+D],d[R+2+D],d[R+1+D]);D+=f}else{for(R=0;R<N.vertex.length;R++)n.push(N.vertex[R][0]*S,N.vertex[R][1]*Z,N.vertex[R][2]*B),I.push(0,K.e?1:0);for(U=0;U<J;U++)for(R=0;R<N.face[U].length-2;R++)e.push(N.face[U][0],N.face[U][R+2],N.face[U][R+1])}x.b.ComputeNormals(n,e,G),x.b._ComputeSides(O,n,e,G,I,f.frontUVs,f.backUVs);const E=new x.b;return E.xa=n,E.indices=e,E.ya=G,E.Aa=I,v&&Y&&(E.za=l),E}function y(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new i.b(f,H);Q.sideOrientation=i.b._GetDefaultSideOrientation(Q.sideOrientation),X._originalBuilderSideOrientation=Q.sideOrientation;return k(Q).Ca(X,Q.updatable),X}i.b.CreateTube=(f,Q,H,X,i,S,x,K,Z,B)=>T(f,{path:Q,i:H,al:X,radiusFunction:i,arc:1,cap:S,updatable:K,sideOrientation:Z,instance:B},x);function h(f){const Q=f.sideOrientation||x.b.DEFAULTSIDE,H=f.i||1,i=void 0===f.flat||f.flat,S=0|(f.subdivisions||4),Z=f.radiusX||H,B=f.radiusY||H,N=f.radiusZ||H,J=(1+Math.sqrt(5))/2,g=[-1,J,-0,1,J,0,-1,-J,0,1,-J,0,0,-1,-J,0,1,-J,0,-1,J,0,1,J,J,0,1,J,0,-1,-J,0,1,-J,0,-1],z=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],v=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],Y=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],O=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],n=[],e=[],G=[],I=[];let l=0;const q=new Array(3),D=new Array(3);let d;for(d=0;d<3;d++)q[d]=X.p.Zero(),D[d]=X.m.Zero();for(let x=0;x<20;x++){for(d=0;d<3;d++){const f=z[3*x+d];q[d].Xd(g[3*v[f]],g[3*v[f]+1],g[3*v[f]+2]),q[d].normalize(),D[d].Xd(.134765625*Y[2*f]+.05859375+-.0390625*O[x],.2333984375*Y[2*f+1]+.025390625+.01953125*O[x])}const f=(f,Q,H,x)=>{const J=X.p.Lerp(q[0],q[2],Q/S),g=X.p.Lerp(q[1],q[2],Q/S),z=S===Q?q[2]:X.p.Lerp(J,g,f/(S-Q));let v;if(z.normalize(),i){const f=X.p.Lerp(q[0],q[2],x/S),Q=X.p.Lerp(q[1],q[2],x/S);v=X.p.Lerp(f,Q,H/(S-x))}else v=new X.p(z.x,z.y,z.z);v.x/=Z,v.y/=B,v.z/=N,v.normalize();const Y=X.m.Lerp(D[0],D[2],Q/S),O=X.m.Lerp(D[1],D[2],Q/S),d=S===Q?D[2]:X.m.Lerp(Y,O,f/(S-Q));e.push(z.x*Z,z.y*B,z.z*N),G.push(v.x,v.y,v.z),I.push(d.x,K.e?1-d.y:d.y),n.push(l),l++};for(let Q=0;Q<S;Q++)for(let H=0;H+Q<S;H++)f(H,Q,H+1/3,Q+1/3),f(H+1,Q,H+1/3,Q+1/3),f(H,Q+1,H+1/3,Q+1/3),H+Q+1<S&&(f(H+1,Q,H+2/3,Q+2/3),f(H+1,Q+1,H+2/3,Q+2/3),f(H,Q+1,H+2/3,Q+2/3))}x.b._ComputeSides(Q,e,n,G,I,f.frontUVs,f.backUVs);const s=new x.b;return s.indices=n,s.xa=e,s.ya=G,s.Aa=I,s}function w(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const X=new i.b(f,H);Q.sideOrientation=i.b._GetDefaultSideOrientation(Q.sideOrientation),X._originalBuilderSideOrientation=Q.sideOrientation;return h(Q).Ca(X,Q.updatable),X}x.b.CreatePolyhedron=k,i.b.CreatePolyhedron=(f,Q,H)=>y(f,Q,H);x.b.CreateIcoSphere=h,i.b.CreateIcoSphere=(f,Q,H)=>w(f,Q,H);var b=H(1034);const o=new X.p(1,0,0),p=new X.p(-1,0,0),C=new X.p(0,1,0),ff=new X.p(0,-1,0),Qf=new X.p(0,0,1),Hf=new X.p(0,0,-1);class Xf{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X.p.Zero(),Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X.p.Up(),H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.m.Zero(),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,x=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=f,this.se=Q,this.uv=H,this.vertexIdx=i,this.vertexIdxForBones=S,this.localPositionOverride=x,this.localNormalOverride=K,this.matrixIndicesOverride=Z,this.matrixWeightsOverride=B}clone(){var f,Q,H,X;return new Xf(this.position.clone(),this.se.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(f=this.localPositionOverride)||void 0===f?void 0:f.slice(),null===(Q=this.localNormalOverride)||void 0===Q?void 0:Q.slice(),null===(H=this.matrixIndicesOverride)||void 0===H?void 0:H.slice(),null===(X=this.matrixWeightsOverride)||void 0===X?void 0:X.slice())}}function Sf(f,Q,H){var Z,B,N,J;const g=!!Q.skeleton,z=H.localMode||g,v=Q.Ud(),Y=g?Q.Kf(!0,!0):Q.getVerticesData(S.e.PositionKind),O=g?Q.getNormalsData(!0,!0):Q.getVerticesData(S.e.NormalKind),n=z?g?Q.getVerticesData(S.e.PositionKind):Y:null,e=z?g?Q.getVerticesData(S.e.NormalKind):O:null,G=Q.getVerticesData(S.e.UVKind),I=g?Q.getVerticesData(S.e.MatricesIndicesKind):null,l=g?Q.getVerticesData(S.e.MatricesWeightsKind):null,q=g?Q.getVerticesData(S.e.MatricesIndicesExtraKind):null,D=g?Q.getVerticesData(S.e.MatricesWeightsExtraKind):null,d=H.position||X.p.Zero();let s=H.se||X.p.Up();const F=H.size||X.p.One(),P=H.angle||0;if(!s){const f=new X.p(0,0,1),H=Q.va().activeCamera,i=X.p.TransformCoordinates(f,H.getWorldMatrix());s=H.globalPosition.hd(i)}const m=-Math.atan2(s.z,s.x)-Math.PI/2,c=Math.sqrt(s.x*s.x+s.z*s.z),W=Math.atan2(s.y,c),R=new x.b;R.indices=[],R.xa=[],R.ya=[],R.Aa=[],R.matricesIndices=g?[]:null,R.matricesWeights=g?[]:null,R.matricesIndicesExtra=q?[]:null,R.matricesWeightsExtra=D?[]:null;let U=0;const E=(f,Q)=>{const i=new Xf;if(!v||!Y||!O)return i;const S=v[f];if(i.vertexIdx=3*S,i.vertexIdxForBones=4*S,i.position=new X.p(Y[3*S],Y[3*S+1],Y[3*S+2]),X.p.TransformCoordinatesToRef(i.position,Q,i.position),i.se=new X.p(O[3*S],O[3*S+1],O[3*S+2]),X.p.TransformNormalToRef(i.se,Q,i.se),H.captureUVS&&G){const f=G[2*S+1];i.uv=new X.m(G[2*S],K.e?1-f:f)}return i},t=[0,0,0,0],u=(f,Q)=>{if(0===f.length)return f;const H=.5*Math.abs(X.p.Dot(F,Q)),i=(f,Q,H,X)=>{for(let i=0;i<X;++i)if(f[H+i]===Q)return H+i;return-1},S=(f,S)=>{const x=X.p.GetClipFactor(f.position,S.position,Q,H);let K=t,Z=t;if(I&&l){const Q=f.matrixIndicesOverride?0:f.vertexIdxForBones,H=f.matrixIndicesOverride??I,X=f.matrixWeightsOverride??l,B=S.matrixIndicesOverride?0:S.vertexIdxForBones,N=S.matrixIndicesOverride??I,J=S.matrixWeightsOverride??l;K=[0,0,0,0],Z=[0,0,0,0];let g=0;for(let f=0;f<4;++f)if(X[Q+f]>0){const S=i(N,H[Q+f],B,4);K[g]=H[Q+f],Z[g]=(0,b.n)(X[Q+f],S>=0?J[S]:0,x),g++}for(let f=0;f<4&&g<4;++f){const X=N[B+f];-1===i(H,X,Q,4)&&(K[g]=X,Z[g]=(0,b.n)(0,J[B+f],x),g++)}const z=Z[0]+Z[1]+Z[2]+Z[3];Z[0]/=z,Z[1]/=z,Z[2]/=z,Z[3]/=z}const B=f.localPositionOverride?f.localPositionOverride[0]:(null===n||void 0===n?void 0:n[f.vertexIdx])??0,N=f.localPositionOverride?f.localPositionOverride[1]:(null===n||void 0===n?void 0:n[f.vertexIdx+1])??0,J=f.localPositionOverride?f.localPositionOverride[2]:(null===n||void 0===n?void 0:n[f.vertexIdx+2])??0,g=S.localPositionOverride?S.localPositionOverride[0]:(null===n||void 0===n?void 0:n[S.vertexIdx])??0,z=S.localPositionOverride?S.localPositionOverride[1]:(null===n||void 0===n?void 0:n[S.vertexIdx+1])??0,v=S.localPositionOverride?S.localPositionOverride[2]:(null===n||void 0===n?void 0:n[S.vertexIdx+2])??0,Y=f.localNormalOverride?f.localNormalOverride[0]:(null===e||void 0===e?void 0:e[f.vertexIdx])??0,O=f.localNormalOverride?f.localNormalOverride[1]:(null===e||void 0===e?void 0:e[f.vertexIdx+1])??0,G=f.localNormalOverride?f.localNormalOverride[2]:(null===e||void 0===e?void 0:e[f.vertexIdx+2])??0,q=Y+((S.localNormalOverride?S.localNormalOverride[0]:(null===e||void 0===e?void 0:e[S.vertexIdx])??0)-Y)*x,D=O+((S.localNormalOverride?S.localNormalOverride[1]:(null===e||void 0===e?void 0:e[S.vertexIdx+1])??0)-O)*x,d=G+((S.localNormalOverride?S.localNormalOverride[2]:(null===e||void 0===e?void 0:e[S.vertexIdx+2])??0)-G)*x,s=Math.sqrt(q*q+D*D+d*d);return new Xf(X.p.Lerp(f.position,S.position,x),X.p.Lerp(f.se,S.se,x).normalize(),X.m.Lerp(f.uv,S.uv,x),-1,-1,n?[B+(g-B)*x,N+(z-N)*x,J+(v-J)*x]:null,e?[q/s,D/s,d/s]:null,K,Z)};let x=null;f.length>3&&(x=[]);for(let K=0;K<f.length;K+=3){let i=0,Z=null,B=null,N=null,J=null;const g=X.p.Dot(f[K].position,Q)-H>0,z=X.p.Dot(f[K+1].position,Q)-H>0,v=X.p.Dot(f[K+2].position,Q)-H>0;switch(i=(g?1:0)+(z?1:0)+(v?1:0),i){case 0:f.length>3?(x.push(f[K]),x.push(f[K+1]),x.push(f[K+2])):x=f;break;case 1:if(x=x??new Array,g&&(Z=f[K+1],B=f[K+2],N=S(f[K],Z),J=S(f[K],B)),z){Z=f[K],B=f[K+2],N=S(f[K+1],Z),J=S(f[K+1],B),x.push(N),x.push(B.clone()),x.push(Z.clone()),x.push(B.clone()),x.push(N.clone()),x.push(J);break}v&&(Z=f[K],B=f[K+1],N=S(f[K+2],Z),J=S(f[K+2],B)),Z&&B&&N&&J&&(x.push(Z.clone()),x.push(B.clone()),x.push(N),x.push(J),x.push(N.clone()),x.push(B.clone()));break;case 2:x=x??new Array,g||(Z=f[K].clone(),B=S(Z,f[K+1]),N=S(Z,f[K+2]),x.push(Z),x.push(B),x.push(N)),z||(Z=f[K+1].clone(),B=S(Z,f[K+2]),N=S(Z,f[K]),x.push(Z),x.push(B),x.push(N)),v||(Z=f[K+2].clone(),B=S(Z,f[K]),N=S(Z,f[K+1]),x.push(Z),x.push(B),x.push(N))}}return x},L=Q instanceof i.b?Q:null,A=null===L||void 0===L?void 0:L._thinInstanceDataStorage.matrixData,a=(null===L||void 0===L?void 0:L.Wj)||1,V=X.l.Matrix[0];V.p(X.e.IdentityReadOnly);for(let i=0;i<a;++i){if(null!==L&&void 0!==L&&L.hasThinInstances&&A){const f=16*i;V.setRowFromFloats(0,A[f+0],A[f+1],A[f+2],A[f+3]),V.setRowFromFloats(1,A[f+4],A[f+5],A[f+6],A[f+7]),V.setRowFromFloats(2,A[f+8],A[f+9],A[f+10],A[f+11]),V.setRowFromFloats(3,A[f+12],A[f+13],A[f+14],A[f+15])}const f=X.e.RotationYawPitchRoll(m,W,P).multiply(X.e.Translation(d.x,d.y,d.z)),S=X.e.Invert(f),x=Q.getWorldMatrix(),Z=V.multiply(x).multiply(S),B=new Array(3);for(let Q=0;Q<v.length;Q+=3){let f=B;if(f[0]=E(Q,Z),f[1]=E(Q+1,Z),f[2]=E(Q+2,Z),!(H.cullBackFaces&&-f[0].se.z<=0&&-f[1].se.z<=0&&-f[2].se.z<=0)&&(f=u(f,o),f&&(f=u(f,p),f&&(f=u(f,C),f&&(f=u(f,ff),f&&(f=u(f,Qf),f&&(f=u(f,Hf),f)))))))for(let Q=0;Q<f.length;Q++){const X=f[Q];if(R.indices.push(U),z?(X.localPositionOverride?(R.xa[3*U]=X.localPositionOverride[0],R.xa[3*U+1]=X.localPositionOverride[1],R.xa[3*U+2]=X.localPositionOverride[2]):n&&(R.xa[3*U]=n[X.vertexIdx],R.xa[3*U+1]=n[X.vertexIdx+1],R.xa[3*U+2]=n[X.vertexIdx+2]),X.localNormalOverride?(R.ya[3*U]=X.localNormalOverride[0],R.ya[3*U+1]=X.localNormalOverride[1],R.ya[3*U+2]=X.localNormalOverride[2]):e&&(R.ya[3*U]=e[X.vertexIdx],R.ya[3*U+1]=e[X.vertexIdx+1],R.ya[3*U+2]=e[X.vertexIdx+2])):(X.position.toArray(R.xa,3*U),X.se.toArray(R.ya,3*U)),R.matricesIndices&&R.matricesWeights&&(X.matrixIndicesOverride?(R.matricesIndices[4*U]=X.matrixIndicesOverride[0],R.matricesIndices[4*U+1]=X.matrixIndicesOverride[1],R.matricesIndices[4*U+2]=X.matrixIndicesOverride[2],R.matricesIndices[4*U+3]=X.matrixIndicesOverride[3]):(I&&(R.matricesIndices[4*U]=I[X.vertexIdxForBones],R.matricesIndices[4*U+1]=I[X.vertexIdxForBones+1],R.matricesIndices[4*U+2]=I[X.vertexIdxForBones+2],R.matricesIndices[4*U+3]=I[X.vertexIdxForBones+3]),q&&R.matricesIndicesExtra&&(R.matricesIndicesExtra[4*U]=q[X.vertexIdxForBones],R.matricesIndicesExtra[4*U+1]=q[X.vertexIdxForBones+1],R.matricesIndicesExtra[4*U+2]=q[X.vertexIdxForBones+2],R.matricesIndicesExtra[4*U+3]=q[X.vertexIdxForBones+3])),X.matrixWeightsOverride?(R.matricesWeights[4*U]=X.matrixWeightsOverride[0],R.matricesWeights[4*U+1]=X.matrixWeightsOverride[1],R.matricesWeights[4*U+2]=X.matrixWeightsOverride[2],R.matricesWeights[4*U+3]=X.matrixWeightsOverride[3]):(l&&(R.matricesWeights[4*U]=l[X.vertexIdxForBones],R.matricesWeights[4*U+1]=l[X.vertexIdxForBones+1],R.matricesWeights[4*U+2]=l[X.vertexIdxForBones+2],R.matricesWeights[4*U+3]=l[X.vertexIdxForBones+3]),D&&R.matricesWeightsExtra&&(R.matricesWeightsExtra[4*U]=D[X.vertexIdxForBones],R.matricesWeightsExtra[4*U+1]=D[X.vertexIdxForBones+1],R.matricesWeightsExtra[4*U+2]=D[X.vertexIdxForBones+2],R.matricesWeightsExtra[4*U+3]=D[X.vertexIdxForBones+3]))),H.captureUVS)X.uv.toArray(R.Aa,2*U);else{R.Aa.push(.5+X.position.x/F.x);const f=.5+X.position.y/F.y;R.Aa.push(K.e?1-f:f)}U++}}}0===R.indices.length&&(R.indices=null),0===R.xa.length&&(R.xa=null),0===R.ya.length&&(R.ya=null),0===R.Aa.length&&(R.Aa=null),0===(null===(Z=R.matricesIndices)||void 0===Z?void 0:Z.length)&&(R.matricesIndices=null),0===(null===(B=R.matricesWeights)||void 0===B?void 0:B.length)&&(R.matricesWeights=null),0===(null===(N=R.matricesIndicesExtra)||void 0===N?void 0:N.length)&&(R.matricesIndicesExtra=null),0===(null===(J=R.matricesWeightsExtra)||void 0===J?void 0:J.length)&&(R.matricesWeightsExtra=null);const M=new i.b(f,Q.va());return R.Ca(M),z?(M.skeleton=Q.skeleton,M.parent=Q):(M.position=d.clone(),M.rotation=new X.p(W,m,P)),M.re(!0),M.refreshBoundingInfo(!0,!0),M}function xf(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,al:16,height:1,i:.25,capSubdivisions:6};const Q=0|Math.max(f.subdivisions?f.subdivisions:2,1),H=0|Math.max(f.al?f.al:16,3),i=Math.max(f.height?f.height:1,0),S=Math.max(f.i?f.i:.25,0),Z=0|Math.max(f.capSubdivisions?f.capSubdivisions:6,1),B=H,N=Q,J=Math.max(f.radiusTop?f.radiusTop:S,0),g=Math.max(f.radiusBottom?f.radiusBottom:S,0),z=i-(J+g),v=2*Math.PI,Y=Math.max(f.topCapSubdivisions?f.topCapSubdivisions:Z,1),O=Math.max(f.bottomCapSubdivisions?f.bottomCapSubdivisions:Z,1),n=Math.acos((g-J)/i);let e=[];const G=[],I=[],l=[];let q=0;const D=[],d=.5*z,s=.5*Math.PI;let F,P;const m=X.p.Zero(),c=X.p.Zero(),W=Math.cos(n),R=Math.sin(n),U=new X.m(J*R,d+J*W).hd(new X.m(g*R,g*W-d)).length(),E=J*n+U+g*(s-n);let t=0;for(P=0;P<=Y;P++){const f=[],Q=s-n*(P/Y);t+=J*n/Y;const H=Math.cos(Q),X=Math.sin(Q),i=H*J;for(F=0;F<=B;F++){const Q=F/B,S=Q*v+0,x=Math.sin(S),Z=Math.cos(S);c.x=i*x,c.y=d+X*J,c.z=i*Z,G.push(c.x,c.y,c.z),m.set(H*x,X,H*Z),I.push(m.x,m.y,m.z),l.push(Q,K.e?t/E:1-t/E),f.push(q),q++}D.push(f)}const u=i-J-g+W*J-W*g,L=R*(g-J)/u;for(P=1;P<=N;P++){const f=[];t+=U/N;const Q=R*(P*(g-J)/N+J);for(F=0;F<=B;F++){const H=F/B,X=H*v+0,i=Math.sin(X),S=Math.cos(X);c.x=Q*i,c.y=d+W*J-P*u/N,c.z=Q*S,G.push(c.x,c.y,c.z),m.set(i,L,S).normalize(),I.push(m.x,m.y,m.z),l.push(H,K.e?t/E:1-t/E),f.push(q),q++}D.push(f)}for(P=1;P<=O;P++){const f=[],Q=s-n-(Math.PI-n)*(P/O);t+=g*n/O;const H=Math.cos(Q),X=Math.sin(Q),i=H*g;for(F=0;F<=B;F++){const Q=F/B,S=Q*v+0,x=Math.sin(S),Z=Math.cos(S);c.x=i*x,c.y=X*g-d,c.z=i*Z,G.push(c.x,c.y,c.z),m.set(H*x,X,H*Z),I.push(m.x,m.y,m.z),l.push(Q,K.e?t/E:1-t/E),f.push(q),q++}D.push(f)}for(F=0;F<B;F++)for(P=0;P<Y+N+O;P++){const f=D[P][F],Q=D[P+1][F],H=D[P+1][F+1],X=D[P][F+1];e.push(f),e.push(Q),e.push(X),e.push(Q),e.push(H),e.push(X)}if(e=e.reverse(),f.orientation&&!f.orientation.equals(X.p.Up())){const Q=new X.e;f.orientation.clone().scale(.5*Math.PI).cross(X.p.Up()).toQuaternion().toRotationMatrix(Q);const H=X.p.Zero();for(let f=0;f<G.length;f+=3)H.set(G[f],G[f+1],G[f+2]),X.p.TransformCoordinatesToRef(H.clone(),Q,H),G[f]=H.x,G[f+1]=H.y,G[f+2]=H.z}const A=new x.b;return A.xa=G,A.ya=I,A.Aa=l,A.indices=e,A}function Kf(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:X.p.Up(),subdivisions:2,al:16,height:1,i:.25,capSubdivisions:6,updatable:!1},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=new i.b(f,H);return xf(Q).Ca(S,Q.updatable),S}i.b.CreateDecal=(f,Q,H,X,i,S)=>Sf(f,Q,{position:H,se:X,size:i,angle:S});i.b.CreateCapsule=(f,Q,H)=>Kf(f,Q,H),x.b.CreateCapsule=xf;class Zf{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=f,this.y=Q,f!==Math.floor(f)&&(f=Math.floor(f),P.b.Warn("x is not an integer, floor(x) used")),Q!==Math.floor(Q)&&(Q=Math.floor(Q),P.b.Warn("y is not an integer, floor(y) used"))}clone(){return new Zf(this.x,this.y)}rotate60About(f){const Q=this.x;return this.x=f.x+f.y-this.y,this.y=Q+this.y-f.x,this}rotateNeg60About(f){const Q=this.x;return this.x=Q+this.y-f.y,this.y=f.x+f.y-Q,this}rotate120(f,Q){f!==Math.floor(f)&&(f=Math.floor(f),P.b.Warn("m not an integer only floor(m) used")),Q!==Math.floor(Q)&&(Q=Math.floor(Q),P.b.Warn("n not an integer only floor(n) used"));const H=this.x;return this.x=f-H-this.y,this.y=Q+H,this}rotateNeg120(f,Q){f!==Math.floor(f)&&(f=Math.floor(f),P.b.Warn("m is not an integer, floor(m) used")),Q!==Math.floor(Q)&&(Q=Math.floor(Q),P.b.Warn("n is not an integer,   floor(n) used"));const H=this.x;return this.x=this.y-Q,this.y=f+Q-H-this.y,this}toCartesianOrigin(f,Q){const H=X.p.Zero();return H.x=f.x+2*this.x*Q+this.y*Q,H.y=f.y+Math.sqrt(3)*this.y*Q,H}static Zero(){return new Zf(0,0)}}class Bf{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Nf("icosahedron","Regular",[[0,c.g,-1],[-c.g,1,0],[-1,0,-c.g],[1,0,-c.g],[c.g,1,0],[0,c.g,1],[-1,0,c.g],[-c.g,-1,0],[0,-c.g,-1],[c.g,-1,0],[1,0,c.g],[0,-c.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let f=12;const Q={},H=this.m,X=this.n;let i,S,x,K,Z,B=H,N=1,J=0;0!==X&&(B=(0,b.h)(H,X)),N=H/B,J=X/B;const g=Zf.Zero(),z=new Zf(H,X),v=new Zf(-X,H+X),Y=Zf.Zero(),O=Zf.Zero(),n=Zf.Zero();let e,G,I,l,q=[];const D=[],d=this.vertByDist,s=(H,X,i,S)=>{e=H+"|"+i,G=X+"|"+S,e in Q||G in Q?e in Q&&!(G in Q)?Q[G]=Q[e]:G in Q&&!(e in Q)&&(Q[e]=Q[G]):(Q[e]=f,Q[G]=f,f++),d[i][0]>2?D[Q[e]]=[-d[i][0],d[i][1],Q[e]]:D[Q[e]]=[q[d[i][0]],d[i][1],Q[e]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let F=0;F<20;F++){if(q=this.IDATA.face[F],x=q[2],K=q[1],Z=q[0],I=g.x+"|"+g.y,e=F+"|"+I,e in Q||(Q[e]=x,D[x]=[q[d[I][0]],d[I][1]]),I=z.x+"|"+z.y,e=F+"|"+I,e in Q||(Q[e]=K,D[K]=[q[d[I][0]],d[I][1]]),I=v.x+"|"+v.y,e=F+"|"+I,e in Q||(Q[e]=Z,D[Z]=[q[d[I][0]],d[I][1]]),i=this.IDATA.edgematch[F][0],S=this.IDATA.edgematch[F][1],"B"===S)for(let f=1;f<B;f++)O.x=H-f*(N+J),O.y=X+f*N,n.x=-f*J,n.y=f*(N+J),I=O.x+"|"+O.y,l=n.x+"|"+n.y,s(F,i,I,l);if("O"===S)for(let f=1;f<B;f++)n.x=-f*J,n.y=f*(N+J),Y.x=f*N,Y.y=f*J,I=n.x+"|"+n.y,l=Y.x+"|"+Y.y,s(F,i,I,l);if(i=this.IDATA.edgematch[F][2],S=this.IDATA.edgematch[F][3],S&&"A"===S)for(let f=1;f<B;f++)Y.x=f*N,Y.y=f*J,O.x=H-(B-f)*(N+J),O.y=X+(B-f)*N,I=Y.x+"|"+Y.y,l=O.x+"|"+O.y,s(F,i,I,l);for(let H=0;H<this.vertices.length;H++)I=this.vertices[H].x+"|"+this.vertices[H].y,e=F+"|"+I,e in Q||(Q[e]=f++,d[I][0]>2?D[Q[e]]=[-d[I][0],d[I][1],Q[e]]:D[Q[e]]=[q[d[I][0]],d[I][1],Q[e]])}this.closestTo=D,this.vecToidx=Q}calcCoeffs(){const f=this.m,Q=this.n,H=Math.sqrt(3)/3,X=f*f+Q*Q+f*Q;this.coau=(f+Q)/X,this.cobu=-Q/X,this.coav=-H*(f-Q)/X,this.cobv=H*(2*f+Q)/X}createInnerFacets(){const f=this.m,Q=this.n;for(let H=0;H<Q+f+1;H++)for(let f=this.min[H];f<this.max[H]+1;f++)f<this.max[H]&&f<this.max[H+1]+1&&this.innerFacets.push(["|"+f+"|"+H,"|"+f+"|"+(H+1),"|"+(f+1)+"|"+H]),H>0&&f<this.max[H-1]&&f+1<this.max[H]+1&&this.innerFacets.push(["|"+f+"|"+H,"|"+(f+1)+"|"+H,"|"+(f+1)+"|"+(H-1)])}edgeVecsABOB(){const f=this.m,Q=this.n,H=new Zf(-Q,f+Q);for(let X=1;X<f+Q;X++){const f=new Zf(this.min[X],X),Q=new Zf(this.min[X-1],X-1),i=new Zf(this.min[X+1],X+1),S=f.clone(),x=Q.clone(),K=i.clone();S.rotate60About(H),x.rotate60About(H),K.rotate60About(H);const Z=new Zf(this.max[S.y],S.y),B=new Zf(this.max[S.y-1],S.y-1),N=new Zf(this.max[S.y-1]-1,S.y-1);S.x===Z.x&&S.y===Z.y||(S.x!==B.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([f,B,N]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([f,N,Z])):S.y===K.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([f,Q,B]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([f,B,i])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([f,Q,B]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([f,B,Z])))}}mapABOBtoOBOA(){const f=new Zf(0,0);for(let Q=0;Q<this.isoVecsABOB.length;Q++){const H=[];for(let X=0;X<3;X++)f.x=this.isoVecsABOB[Q][X].x,f.y=this.isoVecsABOB[Q][X].y,0===this.vertexTypes[Q][X]&&f.rotateNeg120(this.m,this.n),H.push(f.clone());this.isoVecsOBOA.push(H)}}mapABOBtoBAOA(){const f=new Zf(0,0);for(let Q=0;Q<this.isoVecsABOB.length;Q++){const H=[];for(let X=0;X<3;X++)f.x=this.isoVecsABOB[Q][X].x,f.y=this.isoVecsABOB[Q][X].y,1===this.vertexTypes[Q][X]&&f.rotate120(this.m,this.n),H.push(f.clone());this.isoVecsBAOA.push(H)}}MapToFace(f,Q){const H=this.IDATA.face[f],i=H[2],S=H[1],x=H[0],K=X.p.Zd(this.IDATA.vertex[i]),Z=X.p.Zd(this.IDATA.vertex[S]),B=X.p.Zd(this.IDATA.vertex[x]),N=Z.hd(K),J=B.hd(K),g=N.scale(this.coau).add(J.scale(this.cobu)),z=N.scale(this.coav).add(J.scale(this.cobv)),v=[];let Y,O=X.l.Wd[0];for(let X=0;X<this.cartesian.length;X++)O=g.scale(this.cartesian[X].x).add(z.scale(this.cartesian[X].y)).add(K),v[X]=[O.x,O.y,O.z],Y=f+"|"+this.vertices[X].x+"|"+this.vertices[X].y,Q.vertex[this.vecToidx[Y]]=[O.x,O.y,O.z]}build(f,Q){const H=[],X=Zf.Zero(),i=new Zf(f,Q),S=new Zf(-Q,f+Q);H.push(X,i,S);for(let I=Q;I<f+1;I++)for(let Q=0;Q<f+1-I;Q++)H.push(new Zf(Q,I));if(Q>0){const X=(0,b.h)(f,Q),i=f/X,S=Q/X;for(let K=1;K<X;K++)H.push(new Zf(K*i,K*S)),H.push(new Zf(-K*S,K*(i+S))),H.push(new Zf(f-K*(i+S),Q+K*i));const x=f/Q;for(let K=1;K<Q;K++)for(let X=0;X<K*x;X++)H.push(new Zf(X,K)),H.push(new Zf(X,K).rotate120(f,Q)),H.push(new Zf(X,K).rotateNeg120(f,Q))}H.sort(((f,Q)=>f.x-Q.x)),H.sort(((f,Q)=>f.y-Q.y));const x=new Array(f+Q+1),K=new Array(f+Q+1);for(let I=0;I<x.length;I++)x[I]=1/0,K[I]=-1/0;let Z=0,B=0;const N=H.length;for(let I=0;I<N;I++)B=H[I].x,Z=H[I].y,x[Z]=Math.min(B,x[Z]),K[Z]=Math.max(B,K[Z]);const J=(H,X)=>{const i=H.clone();return"A"===X&&i.rotateNeg120(f,Q),"B"===X&&i.rotate120(f,Q),i.x<0?i.y:i.x+i.y},g=[],z=[],v=[],Y=[],O={},n=[];let e=-1,G=-1;for(let I=0;I<N;I++)g[I]=H[I].toCartesianOrigin(new Zf(0,0),.5),z[I]=J(H[I],"O"),v[I]=J(H[I],"A"),Y[I]=J(H[I],"B"),z[I]===v[I]&&v[I]===Y[I]?(e=3,G=z[I]):z[I]===v[I]?(e=4,G=z[I]):v[I]===Y[I]?(e=5,G=v[I]):Y[I]===z[I]&&(e=6,G=z[I]),z[I]<v[I]&&z[I]<Y[I]&&(e=2,G=z[I]),v[I]<z[I]&&v[I]<Y[I]&&(e=1,G=v[I]),Y[I]<v[I]&&Y[I]<z[I]&&(e=0,G=Y[I]),n.push([e,G,H[I].x,H[I].y]);n.sort(((f,Q)=>f[2]-Q[2])),n.sort(((f,Q)=>f[3]-Q[3])),n.sort(((f,Q)=>f[1]-Q[1])),n.sort(((f,Q)=>f[0]-Q[0]));for(let I=0;I<n.length;I++)O[n[I][2]+"|"+n[I][3]]=[n[I][0],n[I][1],I];return this.m=f,this.n=Q,this.vertices=H,this.vertByDist=O,this.cartesian=g,this.min=x,this.max=K,this}}class Nf{constructor(f,Q,H,X){this.name=f,this.category=Q,this.vertex=H,this.face=X}}class Jf extends Nf{innerToData(f,Q){for(let H=0;H<Q.innerFacets.length;H++)this.face.push(Q.innerFacets[H].map((H=>Q.vecToidx[f+H])))}mapABOBtoDATA(f,Q){const H=Q.IDATA.edgematch[f][0];for(let X=0;X<Q.isoVecsABOB.length;X++){const i=[];for(let S=0;S<3;S++)0===Q.vertexTypes[X][S]?i.push(f+"|"+Q.isoVecsABOB[X][S].x+"|"+Q.isoVecsABOB[X][S].y):i.push(H+"|"+Q.isoVecsABOB[X][S].x+"|"+Q.isoVecsABOB[X][S].y);this.face.push([Q.vecToidx[i[0]],Q.vecToidx[i[1]],Q.vecToidx[i[2]]])}}mapOBOAtoDATA(f,Q){const H=Q.IDATA.edgematch[f][0];for(let X=0;X<Q.isoVecsOBOA.length;X++){const i=[];for(let S=0;S<3;S++)1===Q.vertexTypes[X][S]?i.push(f+"|"+Q.isoVecsOBOA[X][S].x+"|"+Q.isoVecsOBOA[X][S].y):i.push(H+"|"+Q.isoVecsOBOA[X][S].x+"|"+Q.isoVecsOBOA[X][S].y);this.face.push([Q.vecToidx[i[0]],Q.vecToidx[i[1]],Q.vecToidx[i[2]]])}}mapBAOAtoDATA(f,Q){const H=Q.IDATA.edgematch[f][2];for(let X=0;X<Q.isoVecsBAOA.length;X++){const i=[];for(let S=0;S<3;S++)1===Q.vertexTypes[X][S]?i.push(f+"|"+Q.isoVecsBAOA[X][S].x+"|"+Q.isoVecsBAOA[X][S].y):i.push(H+"|"+Q.isoVecsBAOA[X][S].x+"|"+Q.isoVecsBAOA[X][S].y);this.face.push([Q.vecToidx[i[0]],Q.vecToidx[i[1]],Q.vecToidx[i[2]]])}}orderData(f){const Q=[];for(let S=0;S<13;S++)Q[S]=[];const H=f.closestTo;for(let S=0;S<H.length;S++)H[S][0]>-1?H[S][1]>0&&Q[H[S][0]].push([S,H[S][1]]):Q[12].push([S,H[S][0]]);const X=[];for(let S=0;S<12;S++)X[S]=S;let i=12;for(let S=0;S<12;S++){Q[S].sort(((f,Q)=>f[1]-Q[1]));for(let f=0;f<Q[S].length;f++)X[Q[S][f][0]]=i++}for(let S=0;S<Q[12].length;S++)X[Q[12][S][0]]=i++;for(let S=0;S<this.vertex.length;S++)this.vertex[S].push(X[S]);this.vertex.sort(((f,Q)=>f[3]-Q[3]));for(let S=0;S<this.vertex.length;S++)this.vertex[S].pop();for(let S=0;S<this.face.length;S++)for(let f=0;f<this.face[S].length;f++)this.face[S][f]=X[this.face[S][f]];this.sharedNodes=Q[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(f,Q){const H=[],X=[];let i=Q.pop();X.push(i);let S=this.face[i].indexOf(f);S=(S+2)%3;let x=this.face[i][S];H.push(x);let K=0;for(;Q.length>0;)i=Q[K],this.face[i].indexOf(x)>-1?(S=(this.face[i].indexOf(x)+1)%3,x=this.face[i][S],H.push(x),X.push(i),Q.splice(K,1),K=0):K++;return this.adjacentFaces.push(H),X}toGoldbergPolyhedronData(){const f=new Nf("GeoDual","Goldberg",[],[]);f.name="GD dual";const Q=this.vertex.length,H=new Array(Q);for(let Z=0;Z<Q;Z++)H[Z]=[];for(let Z=0;Z<this.face.length;Z++)for(let f=0;f<3;f++)H[this.face[Z][f]].push(Z);let X=0,i=0,S=0,x=[],K=[];this.adjacentFaces=[];for(let Z=0;Z<H.length;Z++)f.face[Z]=this.setOrder(Z,H[Z].concat([])),H[Z].forEach((Q=>{X=0,i=0,S=0,x=this.face[Q];for(let f=0;f<3;f++)K=this.vertex[x[f]],X+=K[0],i+=K[1],S+=K[2];f.vertex[Q]=[X/3,i/3,S/3]}));return f}static BuildGeodesicData(f){const Q=new Jf("Geodesic-m-n","Geodesic",[[0,c.g,-1],[-c.g,1,0],[-1,0,-c.g],[1,0,-c.g],[c.g,1,0],[0,c.g,1],[-1,0,c.g],[-c.g,-1,0],[0,-c.g,-1],[c.g,-1,0],[1,0,c.g],[0,-c.g,1]],[]);f.setIndices(),f.calcCoeffs(),f.createInnerFacets(),f.edgeVecsABOB(),f.mapABOBtoOBOA(),f.mapABOBtoBAOA();for(let H=0;H<f.IDATA.face.length;H++)f.MapToFace(H,Q),Q.innerToData(H,f),"B"===f.IDATA.edgematch[H][1]&&Q.mapABOBtoDATA(H,f),"O"===f.IDATA.edgematch[H][1]&&Q.mapOBOAtoDATA(H,f),"A"===f.IDATA.edgematch[H][3]&&Q.mapBAOAtoDATA(H,f);Q.orderData(f);return Q.vertex=Q.vertex.map((function(f){const Q=f[0],H=f[1],X=f[2],i=Math.sqrt(Q*Q+H*H+X*X);return f[0]*=1/i,f[1]*=1/i,f[2]*=1/i,f})),Q}}i.b._GoldbergMeshParser=(f,Q)=>gf.Parse(f,Q);class gf extends i.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(f,Q){return void 0===Q?(f>this.goldbergData.nbUnsharedFaces-1&&(P.b.Warn("Maximum number of unshared faces used"),f=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+f):(f>11&&(P.b.Warn("Last pole used"),f=11),Q>this.goldbergData.nbFacesAtPole-1&&(P.b.Warn("Maximum number of faces at a pole used"),Q=this.goldbergData.nbFacesAtPole-1),12+f*this.goldbergData.nbFacesAtPole+Q)}_changeGoldbergFaceColors(f){for(let H=0;H<f.length;H++){const Q=f[H][0],X=f[H][1],i=f[H][2];for(let f=Q;f<X+1;f++)this.goldbergData.faceColors[f]=i}const Q=[];for(let H=0;H<12;H++)for(let f=0;f<5;f++)Q.push(this.goldbergData.faceColors[H].r,this.goldbergData.faceColors[H].g,this.goldbergData.faceColors[H].b,this.goldbergData.faceColors[H].a);for(let H=12;H<this.goldbergData.faceColors.length;H++)for(let f=0;f<6;f++)Q.push(this.goldbergData.faceColors[H].r,this.goldbergData.faceColors[H].g,this.goldbergData.faceColors[H].b,this.goldbergData.faceColors[H].a);return Q}setGoldbergFaceColors(f){const Q=this._changeGoldbergFaceColors(f);this.Ga(S.e.ColorKind,Q)}updateGoldbergFaceColors(f){const Q=this._changeGoldbergFaceColors(f);this.updateVerticesData(S.e.ColorKind,Q)}_changeGoldbergFaceUVs(f){const Q=this.getVerticesData(S.e.UVKind);for(let H=0;H<f.length;H++){const X=f[H][0],i=f[H][1],S=f[H][2],x=f[H][3],K=f[H][4],Z=[],B=[];let N,J;for(let f=0;f<5;f++)N=S.x+x*Math.cos(K+f*Math.PI/2.5),J=S.y+x*Math.sin(K+f*Math.PI/2.5),N<0&&(N=0),N>1&&(N=1),Z.push(N,J);for(let f=0;f<6;f++)N=S.x+x*Math.cos(K+f*Math.PI/3),J=S.y+x*Math.sin(K+f*Math.PI/3),N<0&&(N=0),N>1&&(N=1),B.push(N,J);for(let f=X;f<Math.min(12,i+1);f++)for(let H=0;H<5;H++)Q[10*f+2*H]=Z[2*H],Q[10*f+2*H+1]=Z[2*H+1];for(let f=Math.max(12,X);f<i+1;f++)for(let H=0;H<6;H++)Q[12*f-24+2*H]=B[2*H],Q[12*f-23+2*H]=B[2*H+1]}return Q}setGoldbergFaceUVs(f){const Q=this._changeGoldbergFaceUVs(f);this.Ga(S.e.UVKind,Q)}updateGoldbergFaceUVs(f){const Q=this._changeGoldbergFaceUVs(f);this.updateVerticesData(S.e.UVKind,Q)}placeOnGoldbergFaceAt(f,Q,H){const i=X.p.RotationFromAxis(this.goldbergData.faceXaxis[Q],this.goldbergData.faceYaxis[Q],this.goldbergData.faceZaxis[Q]);f.rotation=i,f.position=this.goldbergData.faceCenters[Q].add(this.goldbergData.faceXaxis[Q].scale(H.x)).add(this.goldbergData.faceYaxis[Q].scale(H.y)).add(this.goldbergData.faceZaxis[Q].scale(H.z))}serialize(f){super.serialize(f),f.type="GoldbergMesh";const Q={};if(Q.adjacentFaces=this.goldbergData.adjacentFaces,Q.nbSharedFaces=this.goldbergData.nbSharedFaces,Q.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,Q.nbFaces=this.goldbergData.nbFaces,Q.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){Q.faceColors=[];for(const f of this.goldbergData.faceColors)Q.faceColors.push(f.ke())}if(this.goldbergData.faceCenters){Q.faceCenters=[];for(const f of this.goldbergData.faceCenters)Q.faceCenters.push(f.ke())}if(this.goldbergData.faceZaxis){Q.faceZaxis=[];for(const f of this.goldbergData.faceZaxis)Q.faceZaxis.push(f.ke())}if(this.goldbergData.faceYaxis){Q.faceYaxis=[];for(const f of this.goldbergData.faceYaxis)Q.faceYaxis.push(f.ke())}if(this.goldbergData.faceXaxis){Q.faceXaxis=[];for(const f of this.goldbergData.faceXaxis)Q.faceXaxis.push(f.ke())}f.goldbergData=Q}static Parse(f,Q){const H=f.goldbergData;H.faceColors=H.faceColors.map((f=>g.h.Zd(f))),H.faceCenters=H.faceCenters.map((f=>X.p.Zd(f))),H.faceZaxis=H.faceZaxis.map((f=>X.p.Zd(f))),H.faceXaxis=H.faceXaxis.map((f=>X.p.Zd(f))),H.faceYaxis=H.faceYaxis.map((f=>X.p.Zd(f)));const i=new gf(f.name,Q);return i.goldbergData=H,i}}var zf=H(11345);class vf{constructor(f){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=f}moveTo(f,Q){this._currentPath=new m.g(f,Q),this._tempPaths.push(this._currentPath)}lineTo(f,Q){this._currentPath.addLineTo(f,Q)}quadraticCurveTo(f,Q,H,X){this._currentPath.addQuadraticCurveTo(f,Q,H,X,this._resolution)}bezierCurveTo(f,Q,H,X,i,S){this._currentPath.addBezierCurveTo(f,Q,H,X,i,S,this._resolution)}extractHoles(){for(const f of this._tempPaths)f.area()>0?this._holes.push(f):this._paths.push(f);if(!this._paths.length&&this._holes.length){const f=this._holes;this._holes=this._paths,this._paths=f}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function Yf(f,Q,H,X,i,S){const x=S.glyphs[f]||S.glyphs["?"];if(!x)return null;const K=new vf(i);if(x.o){const f=x.o.split(" ");for(let i=0,S=f.length;i<S;){switch(f[i++]){case"m":{const S=parseInt(f[i++])*Q+H,x=parseInt(f[i++])*Q+X;K.moveTo(S,x);break}case"l":{const S=parseInt(f[i++])*Q+H,x=parseInt(f[i++])*Q+X;K.lineTo(S,x);break}case"q":{const S=parseInt(f[i++])*Q+H,x=parseInt(f[i++])*Q+X,Z=parseInt(f[i++])*Q+H,B=parseInt(f[i++])*Q+X;K.quadraticCurveTo(Z,B,S,x);break}case"b":{const S=parseInt(f[i++])*Q+H,x=parseInt(f[i++])*Q+X,Z=parseInt(f[i++])*Q+H,B=parseInt(f[i++])*Q+X,N=parseInt(f[i++])*Q+H,J=parseInt(f[i++])*Q+X;K.bezierCurveTo(Z,B,N,J,S,x);break}}}}return K.extractHoles(),{offsetX:x.ha*Q,shapePath:K}}const Of={CreateBox:J.f,CreateTiledBox:O,CreateSphere:n.d,nb:N.d,CreateIcoSphere:w,CreateRibbon:B,CreateCylinder:l,CreateTorus:D,CreateTorusKnot:s,CreateLineSystem:F.f,ob:F.h,CreateDashedLines:F.e,ExtrudeShape:A,ExtrudeShapeCustom:a,CreateLathe:M,CreateTiledPlane:v,Eg:r.c,CreateGround:j.f,CreateTiledGround:j.i,CreateGroundFromHeightMap:j.e,CreatePolygon:u,ExtrudePolygon:L,CreateTube:T,CreatePolyhedron:y,CreateGeodesic:function(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=Q.m||1;X!==Math.floor(X)&&(X=Math.floor(X),P.b.Warn("m not an integer only floor(m) used"));let i=Q.n||0;if(i!==Math.floor(i)&&(i=Math.floor(i),P.b.Warn("n not an integer only floor(n) used")),i>X){const f=i;i=X,X=f,P.b.Warn("n > m therefore m and n swapped")}const S=new Bf;return S.build(X,i),y(f,{custom:Jf.BuildGeodesicData(S),size:Q.size,sizeX:Q.sizeX,sizeY:Q.sizeY,sizeZ:Q.sizeZ,faceUV:Q.faceUV,faceColors:Q.faceColors,flat:Q.flat,updatable:Q.updatable,sideOrientation:Q.sideOrientation,frontUVs:Q.frontUVs,backUVs:Q.backUVs},H)},CreateGoldberg:function(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=Q.size,Z=Q.sizeX||S||1,B=Q.sizeY||S||1,N=Q.sizeZ||S||1;let J=Q.m||1;J!==Math.floor(J)&&(J=Math.floor(J),P.b.Warn("m not an integer only floor(m) used"));let z=Q.n||0;if(z!==Math.floor(z)&&(z=Math.floor(z),P.b.Warn("n not an integer only floor(n) used")),z>J){const f=z;z=J,J=f,P.b.Warn("n > m therefore m and n swapped")}const v=new Bf;v.build(J,z);const Y=Jf.BuildGeodesicData(v),O=Y.toGoldbergPolyhedronData(),n=new gf(f,H);Q.sideOrientation=i.b._GetDefaultSideOrientation(Q.sideOrientation),n._originalBuilderSideOrientation=Q.sideOrientation;(function(f,Q){const H=f.size,i=f.sizeX||H||1,S=f.sizeY||H||1,Z=f.sizeZ||H||1,B=0===f.sideOrientation?0:f.sideOrientation||x.b.DEFAULTSIDE,N=[],J=[],g=[],z=[];let v=1/0,Y=-1/0,O=1/0,n=-1/0;for(let X=0;X<Q.vertex.length;X++)v=Math.min(v,Q.vertex[X][0]*i),Y=Math.max(Y,Q.vertex[X][0]*i),O=Math.min(O,Q.vertex[X][1]*S),n=Math.max(n,Q.vertex[X][1]*S);let e=0;for(let x=0;x<Q.face.length;x++){const f=Q.face[x],H=X.p.Zd(Q.vertex[f[0]]),B=X.p.Zd(Q.vertex[f[2]]),G=X.p.Zd(Q.vertex[f[1]]),I=B.hd(H),l=G.hd(H),q=X.p.Cross(l,I).normalize();for(let X=0;X<f.length;X++){g.push(q.x,q.y,q.z);const H=Q.vertex[f[X]];N.push(H[0]*i,H[1]*S,H[2]*Z);const x=(H[1]*S-O)/(n-O);z.push((H[0]*i-v)/(Y-v),K.e?1-x:x)}for(let Q=0;Q<f.length-2;Q++)J.push(e,e+Q+2,e+Q+1);e+=f.length}x.b._ComputeSides(B,N,J,g,z);const G=new x.b;return G.xa=N,G.indices=J,G.ya=g,G.Aa=z,G})(Q,O).Ca(n,Q.updatable),n.goldbergData.nbSharedFaces=Y.sharedNodes,n.goldbergData.nbUnsharedFaces=Y.poleNodes,n.goldbergData.adjacentFaces=Y.adjacentFaces,n.goldbergData.nbFaces=n.goldbergData.nbSharedFaces+n.goldbergData.nbUnsharedFaces,n.goldbergData.nbFacesAtPole=(n.goldbergData.nbUnsharedFaces-12)/12;for(let i=0;i<Y.vertex.length;i++)n.goldbergData.faceCenters.push(X.p.Zd(Y.vertex[i])),n.goldbergData.faceCenters[i].x*=Z,n.goldbergData.faceCenters[i].y*=B,n.goldbergData.faceCenters[i].z*=N,n.goldbergData.faceColors.push(new g.h(1,1,1,1));for(let i=0;i<O.face.length;i++){const f=O.face[i],Q=X.p.Zd(O.vertex[f[0]]),H=X.p.Zd(O.vertex[f[2]]),S=X.p.Zd(O.vertex[f[1]]),x=H.hd(Q),K=S.hd(Q),Z=X.p.Cross(K,x).normalize(),B=X.p.Cross(K,Z).normalize();n.goldbergData.faceXaxis.push(K.normalize()),n.goldbergData.faceYaxis.push(Z),n.goldbergData.faceZaxis.push(B)}return n},CreateDecal:Sf,CreateCapsule:Kf,CreateText:function(f,Q,H){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const Z=function(f,Q,H,X){const i=Array.from(f),S=Q/X.resolution,x=(X.boundingBox.yMax-X.boundingBox.yMin+X.underlineThickness)*S,K=[];let Z=0,B=0;for(let N=0;N<i.length;N++){const f=i[N];if("\n"===f)Z=0,B-=x;else{const Q=Yf(f,S,Z,B,H,X);Q&&(Z+=Q.offsetX,K.push(Q.shapePath))}}return K}(Q,S.size||50,S.resolution||8,H),B=[];let N=0;for(const v of Z){if(!v.paths.length)continue;const Q=v.holes.slice();for(const H of v.paths){var J,g;const Z=[],z=[],v=H.getPoints();for(const f of v)z.push(new X.p(f.x,0,f.y));const Y=Q.slice();for(const f of Y){const i=f.getPoints();let S=!1;for(const f of i)if(H.isPointInside(f)){S=!0;break}if(!S)continue;const x=[];for(const f of i)x.push(new X.p(f.x,0,f.y));Z.push(x),Q.splice(Q.indexOf(f),1)}if(!Z.length&&Q.length)for(const f of Q){const Q=f.getPoints(),H=[];for(const f of Q)H.push(new X.p(f.x,0,f.y));Z.push(H)}const O=L(f,{shape:z,holes:Z.length?Z:void 0,depth:S.depth||1,faceUV:S.faceUV||(null===(J=S.perLetterFaceUV)||void 0===J?void 0:J.call(S,N)),faceColors:S.faceColors||(null===(g=S.perLetterFaceColors)||void 0===g?void 0:g.call(S,N)),sideOrientation:i.b._GetDefaultSideOrientation(S.sideOrientation||i.b.DOUBLESIDE)},x,K);B.push(O),N++}}const z=i.b.MergeMeshes(B,!0,!0);if(z){const Q=z.getBoundingInfo().boundingBox;z.position.x+=-(Q.minimumWorld.x+Q.maximumWorld.x)/2,z.position.y+=-(Q.minimumWorld.y+Q.maximumWorld.y)/2,z.position.z+=-(Q.minimumWorld.z+Q.maximumWorld.z)/2+Q.extendSize.z,z.name=f;const H=new zf.d("pivot",x);H.rotation.x=-Math.PI/2,z.parent=H,z.bakeCurrentTransformIntoVertices(),z.parent=null,H.dispose()}return z}}},11950:(f,Q,H)=>{"use strict";var X=H(11301),i=H(1253),S=H(1003),x=H(1092),K=H(1362);X.b.prototype.thinInstanceAdd=function(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return x.b.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(f)?f.length:1);const H=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(f))for(let X=0;X<f.length;++X)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,f[X],X===f.length-1&&Q);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,f,Q);return H},X.b.prototype.thinInstanceAddSelf=function(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(S.e.IdentityReadOnly,f)},X.b.prototype.thinInstanceRegisterAttribute=function(f,Q){f===i.e.ColorKind&&(f=i.e.ColorInstanceKind),this.removeVerticesData(f),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[f]=Q,this._userThinInstanceBuffersStorage.sizes[f]=Q*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[f]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[f]),this._userThinInstanceBuffersStorage.vertexBuffers[f]=new i.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[f],f,!0,!1,Q,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[f])},X.b.prototype.thinInstanceSetMatrixAt=function(f,Q){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||f>=this._thinInstanceDataStorage.instancesCount)return!1;const X=this._thinInstanceDataStorage.matrixData;return Q.copyToArray(X,16*f),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[f]=Q),H&&(this.Zj("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},X.b.prototype.thinInstanceSetAttributeAt=function(f,Q,H){let X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return f===i.e.ColorKind&&(f=i.e.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[f]||Q>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(f,0),this._userThinInstanceBuffersStorage.data[f].set(H,Q*this._userThinInstanceBuffersStorage.strides[f]),X&&this.Zj(f),!0)},Object.defineProperty(X.b.prototype,"Wj",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(f){var Q;const H=this._thinInstanceDataStorage.matrixData??(null===(Q=this.source)||void 0===Q?void 0:Q._thinInstanceDataStorage.matrixData);f<=(H?H.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=f)},enumerable:!0,configurable:!0}),X.b.prototype._thinInstanceCreateMatrixBuffer=function(f,Q){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const X=new i.d(this.getEngine(),Q,!H,16,!1,!0);for(let i=0;i<4;i++)this.setVerticesBuffer(X.createVertexBuffer(f+i,4*i,4));return X},X.b.prototype.$j=function(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var S;if(H=H||16,"matrix"===f)null===(S=this._thinInstanceDataStorage.matrixBuffer)||void 0===S||S.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=Q?Q.length:32*H,this._thinInstanceDataStorage.matrixData=Q,this._thinInstanceDataStorage.worldMatrices=null,null!==Q?(this._thinInstanceDataStorage.instancesCount=Q.length/H,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",Q,X),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===f){var x;null===(x=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===x||x.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=Q,null!==Q&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",Q,X))}else{var K;if(f===i.e.ColorKind&&(f=i.e.ColorInstanceKind),null===Q)null!==(K=this._userThinInstanceBuffersStorage)&&void 0!==K&&K.data[f]&&(this.removeVerticesData(f),delete this._userThinInstanceBuffersStorage.data[f],delete this._userThinInstanceBuffersStorage.strides[f],delete this._userThinInstanceBuffersStorage.sizes[f],delete this._userThinInstanceBuffersStorage.vertexBuffers[f]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[f]=Q,this._userThinInstanceBuffersStorage.strides[f]=H,this._userThinInstanceBuffersStorage.sizes[f]=Q.length,this._userThinInstanceBuffersStorage.vertexBuffers[f]=new i.e(this.getEngine(),Q,f,!X,!1,H,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[f])}},X.b.prototype.Zj=function(f){var Q;if("matrix"===f)this.Vj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(f),null===(Q=this._thinInstanceDataStorage.matrixBuffer)||void 0===Q||Q.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===f){var H;this.Vj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(f),null===(H=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===H||H.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var X;f===i.e.ColorKind&&(f=i.e.ColorInstanceKind),null!==(X=this._userThinInstanceBuffersStorage)&&void 0!==X&&X.vertexBuffers[f]&&(this.Vj&&!this._userThinInstanceBuffersStorage.vertexBuffers[f].isUpdatable()&&this._thinInstanceRecreateBuffer(f),this._userThinInstanceBuffersStorage.vertexBuffers[f].updateDirectly(this._userThinInstanceBuffersStorage.data[f],0))}},X.b.prototype.thinInstancePartialBufferUpdate=function(f,Q,H){var X;"matrix"===f?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(Q,H):(f===i.e.ColorKind&&(f=i.e.ColorInstanceKind),null!==(X=this._userThinInstanceBuffersStorage)&&void 0!==X&&X.vertexBuffers[f]&&this._userThinInstanceBuffersStorage.vertexBuffers[f].updateDirectly(Q,H))},X.b.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const f=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let Q=0;Q<this._thinInstanceDataStorage.instancesCount;++Q)this._thinInstanceDataStorage.worldMatrices[Q]=S.e.Zd(f,16*Q)}return this._thinInstanceDataStorage.worldMatrices},X.b.prototype.thinInstanceRefreshBoundingInfo=function(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const X=this._thinInstanceDataStorage.boundingVectors;if(f||!this.rawBoundingInfo){X.length=0,this.refreshBoundingInfo(Q,H);const f=this.getBoundingInfo();this.rawBoundingInfo=new K.d(f.minimum,f.maximum)}const i=this.getBoundingInfo(),x=this._thinInstanceDataStorage.matrixData;if(0===X.length)for(let S=0;S<i.boundingBox.vectors.length;++S)X.push(i.boundingBox.vectors[S].clone());S.l.Wd[0]._d(Number.POSITIVE_INFINITY),S.l.Wd[1]._d(Number.NEGATIVE_INFINITY);for(let K=0;K<this._thinInstanceDataStorage.instancesCount;++K){S.e.FromArrayToRef(x,16*K,S.l.Matrix[0]);for(let f=0;f<X.length;++f)S.p.TransformCoordinatesToRef(X[f],S.l.Matrix[0],S.l.Wd[2]),S.l.Wd[0].minimizeInPlace(S.l.Wd[2]),S.l.Wd[1].maximizeInPlace(S.l.Wd[2])}i.reConstruct(S.l.Wd[0],S.l.Wd[1]),this.Ea()},X.b.prototype._thinInstanceRecreateBuffer=function(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var H;if("matrix"===f)null===(H=this._thinInstanceDataStorage.matrixBuffer)||void 0===H||H.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,Q);else if("previousMatrix"===f){var X;if(this._scene.needsPreviousWorldMatrices)null===(X=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===X||X.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,Q)}else{var S;f===i.e.ColorKind&&(f=i.e.ColorInstanceKind),null===(S=this._userThinInstanceBuffersStorage.vertexBuffers[f])||void 0===S||S.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[f]=new i.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[f],f,!Q,!1,this._userThinInstanceBuffersStorage.strides[f],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[f])}},X.b.prototype._thinInstanceUpdateBufferSize=function(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;f===i.e.ColorKind&&(f=i.e.ColorInstanceKind);const H="matrix"===f;if(!H&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[f]))return;const X=H?16:this._userThinInstanceBuffersStorage.strides[f],S=H?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[f];let x=H?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[f];const K=(this._thinInstanceDataStorage.instancesCount+Q)*X;let Z=S;for(;Z<K;)Z*=2;if(!x||S!=Z){if(x){const f=new Float32Array(Z);f.set(x,0),x=f}else x=new Float32Array(Z);var B,N,J;if(H){if(null===(B=this._thinInstanceDataStorage.matrixBuffer)||void 0===B||B.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",x,!1),this._thinInstanceDataStorage.matrixData=x,this._thinInstanceDataStorage.matrixBufferSize=Z,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(N=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===N||N.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",x,!1)}else null===(J=this._userThinInstanceBuffersStorage.vertexBuffers[f])||void 0===J||J.dispose(),this._userThinInstanceBuffersStorage.data[f]=x,this._userThinInstanceBuffersStorage.sizes[f]=Z,this._userThinInstanceBuffersStorage.vertexBuffers[f]=new i.e(this.getEngine(),x,f,!0,!1,X,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[f])}},X.b.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},X.b.prototype._disposeThinInstanceSpecificData=function(){var f;null!==(f=this._thinInstanceDataStorage)&&void 0!==f&&f.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11345:(f,Q,H)=>{"use strict";H.d(Q,{d:()=>J});var X=H(978),i=H(982),S=H(1151),x=H(994),K=H(1003),Z=H(11314),B=H(1022);const N=K.e.Compose(K.p.One(),K.i.FromEulerAngles(0,Math.PI,0),K.p.Zero());class J extends Z.e{get billboardMode(){return this._billboardMode}set billboardMode(f){this._billboardMode!==f&&(this._billboardMode=f,this._cache.useBillboardPosition=0!==(this._billboardMode&J.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(f){f!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=f,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==J.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(f){this._infiniteDistance!==f&&(this._infiniteDistance=f)}constructor(f){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(f,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new K.p(0,0,1),this._up=new K.p(0,1,0),this._right=new K.p(1,0,0),this._position=K.p.Zero(),this._rotation=K.p.Zero(),this._rotationQuaternion=null,this._scaling=K.p.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=J.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Yj=K.e.Zero(),this._usePivotMatrix=!1,this._absolutePosition=K.p.Zero(),this._absoluteScaling=K.p.Zero(),this._absoluteRotationQuaternion=K.i.Identity(),this._pivotMatrix=K.e.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new x.e,this._nonUniformScaling=!1,Q&&this.va().addTransformNode(this)}getClassName(){return"pb"}get position(){return this._position}set position(f){this._position=f,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(f){this._rotation=f,this._rotationQuaternion=null,this._markAsDirtyInternal()}get He(){return this._scaling}set He(f){this._scaling=f,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(f){this._rotationQuaternion=f,f&&this._rotation._d(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return K.p.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return K.p.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return K.p.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(f){return this._poseMatrix?(this._poseMatrix.p(f),this):(this._poseMatrix=f.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=K.e.Identity()),this._poseMatrix}_isSynchronized(){const f=this._cache;return this._billboardMode===f.billboardMode&&this._billboardMode===J.BILLBOARDMODE_NONE&&(!f.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const f=this._cache;f.localMatrixUpdated=!1,f.billboardMode=-1,f.infiniteDistance=!1,f.useBillboardPosition=!1,f.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(f){return this.setPivotMatrix(f,!1)}setPivotMatrix(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(f),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=Q,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=K.e.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Q=arguments.length>1?arguments[1]:void 0,H=arguments.length>2?arguments[2]:void 0;const X=this.clone("Clone of "+(this.name||this.id),f||this.parent,!0);X&&H&&H(this,X);for(const i of this.getChildTransformNodes(!0))i.instantiateHierarchy(X,Q,H);return X}hi(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return f?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation._d(0),this._rotationQuaternion=this._rotationQuaternion||K.i.Identity(),f.decompose(this._scaling,this._rotationQuaternion,this._position),this.re(!0)):(this._worldMatrix=f,this._absolutePosition.Xd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.re(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.re(!0),this}get Bj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.re(),this._absolutePosition}setAbsolutePosition(f){if(!f)return this;let Q,H,X;if(void 0===f.x){if(arguments.length<3)return this;Q=arguments[0],H=arguments[1],X=arguments[2]}else Q=f.x,H=f.y,X=f.z;if(this.parent){const f=K.l.Matrix[0];this.parent.getWorldMatrix().invertToRef(f),K.p.TransformCoordinatesFromFloatsToRef(Q,H,X,f,this.position)}else this.position.x=Q,this.position.y=H,this.position.z=X;return this._absolutePosition.p(f),this}setPositionWithLocalVector(f){return this.re(),this.position=K.p.TransformNormal(f,this.Yj),this}getPositionExpressedInLocalSpace(){this.re();const f=K.l.Matrix[0];return this.Yj.invertToRef(f),K.p.TransformNormal(this.position,f)}locallyTranslate(f){return this.re(!0),this.position=K.p.TransformCoordinates(f,this.Yj),this}lookAt(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const S=J._LookAtVectorCache,x=0===i?this.position:this.getAbsolutePosition();if(f.subtractToRef(x,S),this.setDirection(S,Q,H,X),1===i&&this.parent)if(this.rotationQuaternion){const f=K.l.Matrix[0];this.rotationQuaternion.toRotationMatrix(f);const Q=K.l.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(Q),Q.invert(),f.multiplyToRef(Q,f),this.rotationQuaternion.fromRotationMatrix(f)}else{const f=K.l.Quaternion[0];K.i.FromEulerVectorToRef(this.rotation,f);const Q=K.l.Matrix[0];f.toRotationMatrix(Q);const H=K.l.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(H),H.invert(),Q.multiplyToRef(H,Q),f.fromRotationMatrix(Q),f.toEulerAnglesToRef(this.rotation)}return this}mf(f){const Q=K.p.Zero();return this.getDirectionToRef(f,Q),Q}getDirectionToRef(f,Q){return K.p.TransformNormalToRef(f,this.getWorldMatrix(),Q),this}setDirection(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const i=-Math.atan2(f.z,f.x)+Math.PI/2,S=Math.sqrt(f.x*f.x+f.z*f.z),x=-Math.atan2(f.y,S);return this.rotationQuaternion?K.i.RotationYawPitchRollToRef(i+Q,x+H,X,this.rotationQuaternion):(this.rotation.x=x+H,this.rotation.y=i+Q,this.rotation.z=X),this}setPivotPoint(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.re(!0);const H=this.getWorldMatrix();if(1==Q){const Q=K.l.Matrix[0];H.invertToRef(Q),f=K.p.TransformCoordinates(f,Q)}return this.setPivotMatrix(K.e.Translation(-f.x,-f.y,-f.z),!0)}getPivotPoint(){const f=K.p.Zero();return this.getPivotPointToRef(f),f}getPivotPointToRef(f){return f.x=-this._pivotMatrix.m[12],f.y=-this._pivotMatrix.m[13],f.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const f=K.p.Zero();return this.getAbsolutePivotPointToRef(f),f}getAbsolutePivotPointToRef(f){return this.getPivotPointToRef(f),K.p.TransformCoordinatesToRef(f,this.getWorldMatrix(),f),this}ve(f){if(this._isDirty)return this;if(this._children)for(const Q of this._children)Q.ve(f);return super.ve(f)}setParent(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!f&&!this.parent)return this;const X=K.l.Quaternion[0],i=K.l.Wd[0],S=K.l.Wd[1],x=K.l.Matrix[1];K.e.IdentityToRef(x);const Z=K.l.Matrix[0];this.re(!0);let B=this.rotationQuaternion;return B||(B=J._TmpRotation,K.i.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,B)),K.e.ComposeToRef(this.He,B,this.position,Z),this.parent&&Z.multiplyToRef(this.parent.re(!0),Z),f&&(f.re(!0).invertToRef(x),Z.multiplyToRef(x,Z)),Z.decompose(S,X,i,Q?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(X):X.toEulerAnglesToRef(this.rotation),this.He.p(S),this.position.p(i),this.parent=f,H&&this.setPivotMatrix(K.e.Identity()),this}addChild(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return f.setParent(this,Q),this}removeChild(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return f.setParent(null,Q),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(f){return this._nonUniformScaling!==f&&(this._nonUniformScaling=f,!0)}attachToBone(f,Q){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=Q,this.parent=f,f.getSkeleton().prepare(!0),f.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=f?this._currentParentWhenAttachingToBone:null,this):(f&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(f,Q,H){let X;if(f.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation._d(0)),H&&0!==H){if(this.parent){const H=this.parent.getWorldMatrix(),X=K.l.Matrix[0];H.invertToRef(X),f=K.p.TransformNormal(f,X),H.determinant()<0&&(Q*=-1)}X=K.i.RotationAxisToRef(f,Q,J._RotationAxisCache),X.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else X=K.i.RotationAxisToRef(f,Q,J._RotationAxisCache),this.rotationQuaternion.multiplyToRef(X,this.rotationQuaternion);return this}rotateAround(f,Q,H){Q.normalize(),this.rotationQuaternion||(this.rotationQuaternion=K.i.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation._d(0));const X=K.l.Wd[0],i=K.l.Wd[1],S=K.l.Wd[2],x=K.l.Quaternion[0],Z=K.l.Matrix[0],B=K.l.Matrix[1],N=K.l.Matrix[2],J=K.l.Matrix[3];return f.subtractToRef(this.position,X),K.e.TranslationToRef(X.x,X.y,X.z,Z),K.e.TranslationToRef(-X.x,-X.y,-X.z,B),K.e.RotationAxisToRef(Q,H,N),B.multiplyToRef(N,J),J.multiplyToRef(Z,J),J.decompose(i,x,S),this.position.addInPlace(S),x.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(f,Q,H){const X=f.scale(Q);if(H&&0!==H)this.setAbsolutePosition(this.getAbsolutePosition().add(X));else{const f=this.getPositionExpressedInLocalSpace().add(X);this.setPositionWithLocalVector(f)}return this}addRotation(f,Q,H){let X;this.rotationQuaternion?X=this.rotationQuaternion:(X=K.l.Quaternion[1],K.i.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,X));const i=K.l.Quaternion[0];return K.i.RotationYawPitchRollToRef(Q,f,H,i),X.multiplyInPlace(i),this.rotationQuaternion||X.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==J.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}re(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const H=this.va().getRenderId();if(!this._isDirty&&!f&&(this._currentRenderId===H||this.isSynchronized()))return this._currentRenderId=H,this._worldMatrix;Q=Q||this.va().activeCamera,this._updateCache();const X=this._cache;X.pivotMatrixUpdated=!1,X.billboardMode=this.billboardMode,X.infiniteDistance=this.infiniteDistance,X.parent=this._parentNode,this._currentRenderId=H,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const i=this._getEffectiveParent(),S=J._TmpScaling;let x,Z=this._position;if(this._infiniteDistance&&!this.parent&&Q){const f=Q.getWorldMatrix(),H=new K.p(f.m[12],f.m[13],f.m[14]);Z=J._TmpTranslation,Z.Xd(this._position.x+H.x,this._position.y+H.y,this._position.z+H.z)}if(S.Xd(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,x=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(K.i.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Xd(0,0,0))}}else x=J._TmpRotation,K.i.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,x);if(this._usePivotMatrix){const f=K.l.Matrix[1];K.e.ScalingToRef(S.x,S.y,S.z,f);const Q=K.l.Matrix[0];x.toRotationMatrix(Q),this._pivotMatrix.multiplyToRef(f,K.l.Matrix[4]),K.l.Matrix[4].multiplyToRef(Q,this.Yj),this._postMultiplyPivotMatrix&&this.Yj.multiplyToRef(this._pivotMatrixInverse,this.Yj),this.Yj.addTranslationFromFloats(Z.x,Z.y,Z.z)}else K.e.ComposeToRef(S,x,Z,this.Yj);if(i&&i.getWorldMatrix){if(f&&i.re(f),X.useBillboardPath){if(this._transformToBoneReferal){const f=this.parent;f.getSkeleton().prepare(),f.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),K.l.Matrix[7])}else K.l.Matrix[7].p(i.getWorldMatrix());const f=K.l.Wd[5],Q=K.l.Wd[6],H=K.l.Quaternion[0];K.l.Matrix[7].decompose(Q,H,f),K.e.ScalingToRef(Q.x,Q.y,Q.z,K.l.Matrix[7]),K.l.Matrix[7].setTranslation(f),J.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(H,f),this.Yj.setTranslation(f)),this.Yj.multiplyToRef(K.l.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const f=this.parent;f.getSkeleton().prepare(),this.Yj.multiplyToRef(f.getFinalMatrix(),K.l.Matrix[6]),K.l.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Yj.multiplyToRef(i.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Yj);if(X.useBillboardPath&&Q&&this.billboardMode&&!X.useBillboardPosition){const f=K.l.Wd[0];if(this._worldMatrix.getTranslationToRef(f),K.l.Matrix[1].p(Q.getViewMatrix()),this._scene.useRightHandedSystem&&K.l.Matrix[1].multiplyToRef(N,K.l.Matrix[1]),K.l.Matrix[1].setTranslationFromFloats(0,0,0),K.l.Matrix[1].invertToRef(K.l.Matrix[0]),(this.billboardMode&J.BILLBOARDMODE_ALL)!==J.BILLBOARDMODE_ALL){K.l.Matrix[0].decompose(void 0,K.l.Quaternion[0],void 0);const f=K.l.Wd[1];K.l.Quaternion[0].toEulerAnglesToRef(f),(this.billboardMode&J.BILLBOARDMODE_X)!==J.BILLBOARDMODE_X&&(f.x=0),(this.billboardMode&J.BILLBOARDMODE_Y)!==J.BILLBOARDMODE_Y&&(f.y=0),(this.billboardMode&J.BILLBOARDMODE_Z)!==J.BILLBOARDMODE_Z&&(f.z=0),K.e.RotationYawPitchRollToRef(f.y,f.x,f.z,K.l.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(K.l.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(K.l.Wd[0])}else if(X.useBillboardPath&&Q&&X.useBillboardPosition){const f=K.l.Wd[0];this._worldMatrix.getTranslationToRef(f);const H=Q.globalPosition;this._worldMatrix.invertToRef(K.l.Matrix[1]);const X=K.l.Wd[1];K.p.TransformCoordinatesToRef(H,K.l.Matrix[1],X),X.normalize();const i=-Math.atan2(X.z,X.x)+Math.PI/2,S=Math.sqrt(X.x*X.x+X.z*X.z),x=-Math.atan2(X.y,S);if(K.i.RotationYawPitchRollToRef(i,x,0,K.l.Quaternion[0]),(this.billboardMode&J.BILLBOARDMODE_ALL)!==J.BILLBOARDMODE_ALL){const f=K.l.Wd[1];K.l.Quaternion[0].toEulerAnglesToRef(f),(this.billboardMode&J.BILLBOARDMODE_X)!==J.BILLBOARDMODE_X&&(f.x=0),(this.billboardMode&J.BILLBOARDMODE_Y)!==J.BILLBOARDMODE_Y&&(f.y=0),(this.billboardMode&J.BILLBOARDMODE_Z)!==J.BILLBOARDMODE_Z&&(f.z=0),K.e.RotationYawPitchRollToRef(f.y,f.x,f.z,K.l.Matrix[0])}else K.e.FromQuaternionToRef(K.l.Quaternion[0],K.l.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(K.l.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(K.l.Wd[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):i&&i._nonUniformScaling?this._updateNonUniformScalingState(i._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Xd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=K.e.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.re(),f){const f=this.getChildren();for(let Q=0;Q<f.length;++Q){const H=f[Q];if(H){H.re();const f=K.l.Matrix[0];H.Yj.multiplyToRef(this.Yj,f);const Q=K.l.Quaternion[0];f.decompose(H.He,Q,H.position),H.rotationQuaternion?H.rotationQuaternion.p(Q):Q.toEulerAnglesToRef(H.rotation)}}}this.He.Xd(1,1,1),this.position.Xd(0,0,0),this.rotation.Xd(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=K.i.Identity()),this._worldMatrix=K.e.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(f){return this.onAfterWorldMatrixUpdateObservable.add(f),this}unregisterAfterWorldMatrixUpdate(f){return this.onAfterWorldMatrixUpdateObservable.removeCallback(f),this}getPositionInCameraSpace(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return f||(f=this.va().activeCamera),K.p.TransformCoordinates(this.getAbsolutePosition(),f.getViewMatrix())}getDistanceToCamera(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return f||(f=this.va().activeCamera),this.getAbsolutePosition().hd(f.globalPosition).length()}clone(f,Q,H){const X=S.b.Clone((()=>new J(f,this.va())),this);if(X.name=f,X.id=f,Q&&(X.parent=Q),!H){const Q=this.getDescendants(!0);for(let H=0;H<Q.length;H++){const i=Q[H];i.clone&&i.clone(f+"."+i.name,X)}}return X}serialize(f){const Q=S.b.Serialize(this,f);return Q.type=this.getClassName(),Q.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(Q),Q.localMatrix=this.getPivotMatrix().ke(),Q.isEnabled=this.isEnabled(),S.b.AppendSerializedAnimations(this,Q),Q.ranges=this.serializeAnimationRanges(),Q}static Parse(f,Q,H){const X=S.b.Parse((()=>new J(f.name,Q)),f,Q,H);if(f.localMatrix?X.setPreTransformMatrix(K.e.Zd(f.localMatrix)):f.pivotMatrix&&X.setPivotMatrix(K.e.Zd(f.pivotMatrix)),X.Dg(f.isEnabled),X._waitingParsedUniqueId=f.uniqueId,void 0!==f.parentId&&(X._waitingParentId=f.parentId),void 0!==f.parentInstanceIndex&&(X._waitingParentInstanceIndex=f.parentInstanceIndex),f.animations){for(let Q=0;Q<f.animations.length;Q++){const H=f.animations[Q],i=(0,B.e)("BABYLON.Animation");i&&X.animations.push(i.Parse(H))}Z.e.ParseAnimationRanges(X,f,Q)}return f.autoAnimate&&Q.beginAnimation(X,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1),X}getChildTransformNodes(f,Q){const H=[];return this._getDescendants(H,f,(f=>(!Q||Q(f))&&f instanceof J)),H}dispose(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const f=this._parentContainer.transformNodes.indexOf(this);f>-1&&this._parentContainer.transformNodes.splice(f,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),f){const f=this.getChildTransformNodes(!0);for(const Q of f)Q.parent=null,Q.re(!0)}super.dispose(f,Q)}normalizeToUnitCube(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2?arguments[2]:void 0,X=null,i=null;Q&&(this.rotationQuaternion?(i=this.rotationQuaternion.clone(),this.rotationQuaternion.Xd(0,0,0,1)):this.rotation&&(X=this.rotation.clone(),this.rotation.Xd(0,0,0)));const S=this.getHierarchyBoundingVectors(f,H),x=S.max.hd(S.min),K=Math.max(x.x,x.y,x.z);if(0===K)return this;const Z=1/K;return this.He.scaleInPlace(Z),Q&&(this.rotationQuaternion&&i?this.rotationQuaternion.p(i):this.rotation&&X&&this.rotation.p(X)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}J.BILLBOARDMODE_NONE=0,J.BILLBOARDMODE_X=1,J.BILLBOARDMODE_Y=2,J.BILLBOARDMODE_Z=4,J.BILLBOARDMODE_ALL=7,J.BILLBOARDMODE_USE_POSITION=128,J.BillboardUseParentOrientation=!1,J._TmpRotation=K.i.Zero(),J._TmpScaling=K.p.Zero(),J._TmpTranslation=K.p.Zero(),J._LookAtVectorCache=new K.p(0,0,0),J._RotationAxisCache=new K.i,(0,X.d)([(0,i.F)("position")],J.prototype,"_position",void 0),(0,X.d)([(0,i.F)("rotation")],J.prototype,"_rotation",void 0),(0,X.d)([(0,i.x)("rotationQuaternion")],J.prototype,"_rotationQuaternion",void 0),(0,X.d)([(0,i.F)("He")],J.prototype,"_scaling",void 0),(0,X.d)([(0,i.G)("billboardMode")],J.prototype,"_billboardMode",void 0),(0,X.d)([(0,i.G)()],J.prototype,"scalingDeterminant",void 0),(0,X.d)([(0,i.G)("infiniteDistance")],J.prototype,"_infiniteDistance",void 0),(0,X.d)([(0,i.G)()],J.prototype,"ignoreNonUniformScaling",void 0),(0,X.d)([(0,i.G)()],J.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11916:(f,Q,H)=>{"use strict";H.d(Q,{e:()=>x});var X=H(974),i=H(10257);let S=0;const x=f=>{if(!f.environmentBRDFTexture){const Q=f.useDelayedTextureLoading;f.useDelayedTextureLoading=!1;const H=f._blockEntityCollection;f._blockEntityCollection=!1;const x=X.b.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+S++,f,!0,!1,X.b.BILINEAR_SAMPLINGMODE);f._blockEntityCollection=H;const K=f.getEngine().getLoadedTexturesCache(),Z=K.indexOf(x.getInternalTexture());-1!==Z&&K.splice(Z,1),x.isRGBD=!0,x.wrapU=X.b.CLAMP_ADDRESSMODE,x.wrapV=X.b.CLAMP_ADDRESSMODE,f.environmentBRDFTexture=x,f.useDelayedTextureLoading=Q,i.b.ExpandRGBDTexture(x);const B=f.getEngine().onContextRestoredObservable.add((()=>{x.isRGBD=!0;const Q=f.onBeforeRenderObservable.add((()=>{x.isReady()&&(f.onBeforeRenderObservable.remove(Q),i.b.ExpandRGBDTexture(x))}))}));f.fe.add((()=>{f.getEngine().onContextRestoredObservable.remove(B)}))}return f.environmentBRDFTexture}},11308:(f,Q,H)=>{"use strict";function X(f,Q,H){try{const X=f.next();X.done?Q(X):X.value?X.value.then((()=>{X.value=void 0,Q(X)}),H):Q(X)}catch(X){H(X)}}function i(){let f,Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(H,i,S)=>{const x=performance.now();void 0===f||x-f>Q?(f=x,setTimeout((()=>{X(H,i,S)}),0)):X(H,i,S)}}function S(f,Q,H,X,i){const S=()=>{let x;const K=f=>{f.done?H(f.value):void 0===x?x=!0:S()};do{x=void 0,i&&i.aborted?X(new Error("Aborted")):Q(f,K,X),void 0===x&&(x=!1)}while(x)};S()}function x(f,Q){let H;return S(f,X,(f=>H=f),(f=>{throw f}),Q),H}function K(f,Q,H){return new Promise(((X,i)=>{S(f,Q,X,i,H)}))}function Z(f,Q){return function(){return x(f(...arguments),Q)}}H.d(Q,{e:()=>i,g:()=>Z,j:()=>K,m:()=>x})},10279:(f,Q,H)=>{"use strict";H.d(Q,{e:()=>i});class X{constructor(f){this._pendingActions=new Array,this._workerInfos=f.map((f=>({workerPromise:Promise.resolve(f),idle:!0})))}dispose(){for(const f of this._workerInfos)f.workerPromise.then((f=>{f.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(f){this._executeOnIdleWorker(f)||this._pendingActions.push(f)}_executeOnIdleWorker(f){for(const Q of this._workerInfos)if(Q.idle)return this._execute(Q,f),!0;return!1}_execute(f,Q){f.idle=!1,f.workerPromise.then((H=>{Q(H,(()=>{const Q=this._pendingActions.shift();Q?this._execute(f,Q):f.idle=!0}))}))}}class i extends X{constructor(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.DefaultOptions;super([]),this._maxWorkers=f,this._createWorkerAsync=Q,this._options=H}push(f){if(!this._executeOnIdleWorker(f))if(this._workerInfos.length<this._maxWorkers){const Q={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(Q),this._execute(Q,f)}else this._pendingActions.push(f)}_execute(f,Q){f.timeoutId&&(clearTimeout(f.timeoutId),delete f.timeoutId),super._execute(f,((H,X)=>{Q(H,(()=>{X(),f.idle&&(f.timeoutId=setTimeout((()=>{f.workerPromise.then((f=>{f.terminate()}));const Q=this._workerInfos.indexOf(f);-1!==Q&&this._workerInfos.splice(Q,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}i.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11439:(f,Q,H)=>{"use strict";H.d(Q,{e:()=>ef});var X=H(1003),i=H(1401);class S extends i.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var x=H(1161),K=(H(1466),H(1022));class Z{get noiseTexture(){return this._noiseTexture}set noiseTexture(f){this._noiseTexture!==f&&(this._noiseTexture=f,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(f){this._isAnimationSheetEnabled!=f&&(this._isAnimationSheetEnabled=f,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(f){this._useLogarithmicDepth=f&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:X.p.Zero()}set direction1(f){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=f)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:X.p.Zero()}set direction2(f){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=f)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:X.p.Zero()}set minEmitBox(f){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=f)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:X.p.Zero()}set maxEmitBox(f){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=f)}get billboardMode(){return this._billboardMode}set billboardMode(f){this._billboardMode!==f&&(this._billboardMode=f,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(f){this._isBillboardBased!==f&&(this._isBillboardBased=f,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(f){this._attachImageProcessingConfiguration(f)}_attachImageProcessingConfiguration(f){f!==this._imageProcessingConfiguration&&(!f&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=f)}_reset(){}_removeGradientAndTexture(f,Q,H){if(!Q)return this;let X=0;for(const i of Q){if(i.gradient===f){Q.splice(X,1);break}X++}return H&&H.dispose(),this}constructor(f){this.animations=[],this.renderingGroupId=0,this.k=X.p.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new X.p(10,10,10),this.onAnimationEnd=null,this.blendMode=Z.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new X.m(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.tg=new X.p(0,0,0),this._useLogarithmicDepth=!1,this.gravity=X.p.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new x.h(1,1,1,1),this.color2=new x.h(1,1,1,1),this.colorDead=new x.h(0,0,0,1),this.textureMask=new x.h(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new S,this.id=f,this.name=f}createPointEmitter(f,Q){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new X.p(0,1,0),arguments.length>2&&void 0!==arguments[2]||new X.p(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new X.p(0,1,0),arguments.length>4&&void 0!==arguments[4]||new X.p(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new X.p(0,1,0),arguments.length>3&&void 0!==arguments[3]||new X.p(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(f,Q,H,X){throw new Error("Method not implemented.")}}Z.BLENDMODE_ONEONE=0,Z.BLENDMODE_STANDARD=1,Z.BLENDMODE_ADD=2,Z.BLENDMODE_MULTIPLY=3,Z.BLENDMODE_MULTIPLYADD=4,(0,K.h)("BABYLON.BaseParticleSystem",Z);var B=H(1034),N=H(1207);class J{constructor(){this.direction1=new X.p(0,1,0),this.direction2=new X.p(0,1,0),this.minEmitBox=new X.p(-.5,-.5,-.5),this.maxEmitBox=new X.p(.5,.5,.5)}startDirectionFunction(f,Q,H,i){const S=(0,B.q)(this.direction1.x,this.direction2.x),x=(0,B.q)(this.direction1.y,this.direction2.y),K=(0,B.q)(this.direction1.z,this.direction2.z);if(i)return Q.x=S,Q.y=x,void(Q.z=K);X.p.TransformNormalFromFloatsToRef(S,x,K,f,Q)}startPositionFunction(f,Q,H,i){const S=(0,B.q)(this.minEmitBox.x,this.maxEmitBox.x),x=(0,B.q)(this.minEmitBox.y,this.maxEmitBox.y),K=(0,B.q)(this.minEmitBox.z,this.maxEmitBox.z);if(i)return Q.x=S,Q.y=x,void(Q.z=K);X.p.TransformCoordinatesFromFloatsToRef(S,x,K,f,Q)}clone(){const f=new J;return N.b.DeepCopy(this,f),f}applyToShader(f){f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2),f.setVector3("minEmitBox",this.minEmitBox),f.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(f){f.addUniform("direction1",3),f.addUniform("direction2",3),f.addUniform("minEmitBox",3),f.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.direction1=this.direction1.ke(),f.direction2=this.direction2.ke(),f.minEmitBox=this.minEmitBox.ke(),f.maxEmitBox=this.maxEmitBox.ke(),f}parse(f){X.p.FromArrayToRef(f.direction1,0,this.direction1),X.p.FromArrayToRef(f.direction2,0,this.direction2),X.p.FromArrayToRef(f.minEmitBox,0,this.minEmitBox),X.p.FromArrayToRef(f.maxEmitBox,0,this.maxEmitBox)}}class g{get i(){return this._radius}set i(f){this._radius=f,this._buildHeight()}get angle(){return this._angle}set angle(f){this._angle=f,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=H,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=Q,this.i=f}startDirectionFunction(f,Q,H,i){i?X.l.Wd[0].p(H.xg).normalize():H.position.subtractToRef(f.getTranslation(),X.l.Wd[0]).normalize();const S=(0,B.q)(0,this.directionRandomizer),x=(0,B.q)(0,this.directionRandomizer),K=(0,B.q)(0,this.directionRandomizer);Q.x=X.l.Wd[0].x+S,Q.y=X.l.Wd[0].y+x,Q.z=X.l.Wd[0].z+K,Q.normalize()}startPositionFunction(f,Q,H,i){const S=(0,B.q)(0,2*Math.PI);let x;this.emitFromSpawnPointOnly?x=1e-4:(x=(0,B.q)(0,this.heightRange),x=1-x*x);let K=this._radius-(0,B.q)(0,this._radius*this.radiusRange);K*=x;const Z=K*Math.sin(S),N=K*Math.cos(S),J=x*this._height;if(i)return Q.x=Z,Q.y=J,void(Q.z=N);X.p.TransformCoordinatesFromFloatsToRef(Z,J,N,f,Q)}clone(){const f=new g(this._radius,this._angle,this.directionRandomizer);return N.b.DeepCopy(this,f),f}applyToShader(f){f.setFloat2("i",this._radius,this.radiusRange),f.setFloat("coneAngle",this._angle),f.setFloat2("height",this._height,this.heightRange),f.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(f){f.addUniform("i",2),f.addUniform("coneAngle",1),f.addUniform("height",2),f.addUniform("directionRandomizer",1)}getEffectDefines(){let f="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(f+="\n#define CONEEMITTERSPAWNPOINT"),f}getClassName(){return"ConeParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.i=this._radius,f.angle=this._angle,f.directionRandomizer=this.directionRandomizer,f.radiusRange=this.radiusRange,f.heightRange=this.heightRange,f.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,f}parse(f){this.i=f.i,this.angle=f.angle,this.directionRandomizer=f.directionRandomizer,this.radiusRange=void 0!==f.radiusRange?f.radiusRange:1,this.heightRange=void 0!==f.radiusRange?f.heightRange:1,this.emitFromSpawnPointOnly=void 0!==f.emitFromSpawnPointOnly&&f.emitFromSpawnPointOnly}}class z extends g{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.p(0,1,0),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.p(0,1,0);super(f,Q),this.direction1=H,this.direction2=i}startDirectionFunction(f,Q){const H=(0,B.q)(this.direction1.x,this.direction2.x),i=(0,B.q)(this.direction1.y,this.direction2.y),S=(0,B.q)(this.direction1.z,this.direction2.z);X.p.TransformNormalFromFloatsToRef(H,i,S,f,Q)}clone(){const f=new z(this.i,this.angle,this.direction1,this.direction2);return N.b.DeepCopy(this,f),f}applyToShader(f){f.setFloat("i",this.i),f.setFloat("radiusRange",this.radiusRange),f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2)}buildUniformLayout(f){f.addUniform("i",1),f.addUniform("radiusRange",1),f.addUniform("direction1",3),f.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const f=super.serialize();return f.direction1=this.direction1.ke(),f.direction2=this.direction2.ke(),f}parse(f){super.parse(f),this.direction1.p(f.direction1),this.direction2.p(f.direction2)}}class v{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.i=f,this.height=Q,this.radiusRange=H,this.directionRandomizer=i,this._tempVector=X.p.Zero()}startDirectionFunction(f,Q,H,i,S){H.position.subtractToRef(f.getTranslation(),this._tempVector),this._tempVector.normalize(),X.p.TransformNormalToRef(this._tempVector,S,this._tempVector);const x=(0,B.q)(-this.directionRandomizer/2,this.directionRandomizer/2);let K=Math.atan2(this._tempVector.x,this._tempVector.z);K+=(0,B.q)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=x,this._tempVector.x=Math.sin(K),this._tempVector.z=Math.cos(K),this._tempVector.normalize(),i?Q.p(this._tempVector):X.p.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,f,Q)}startPositionFunction(f,Q,H,i){const S=(0,B.q)(-this.height/2,this.height/2),x=(0,B.q)(0,2*Math.PI),K=(0,B.q)((1-this.radiusRange)*(1-this.radiusRange),1),Z=Math.sqrt(K)*this.i,N=Z*Math.cos(x),J=Z*Math.sin(x);i?Q.Xd(N,S,J):X.p.TransformCoordinatesFromFloatsToRef(N,S,J,f,Q)}clone(){const f=new v(this.i,this.directionRandomizer);return N.b.DeepCopy(this,f),f}applyToShader(f){f.setFloat("i",this.i),f.setFloat("height",this.height),f.setFloat("radiusRange",this.radiusRange),f.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(f){f.addUniform("i",1),f.addUniform("height",1),f.addUniform("radiusRange",1),f.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.i=this.i,f.height=this.height,f.radiusRange=this.radiusRange,f.directionRandomizer=this.directionRandomizer,f}parse(f){this.i=f.i,this.height=f.height,this.radiusRange=f.radiusRange,this.directionRandomizer=f.directionRandomizer}}class Y extends v{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.p(0,1,0),S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new X.p(0,1,0);super(f,Q,H),this.direction1=i,this.direction2=S}startDirectionFunction(f,Q,H,i){const S=(0,B.q)(this.direction1.x,this.direction2.x),x=(0,B.q)(this.direction1.y,this.direction2.y),K=(0,B.q)(this.direction1.z,this.direction2.z);i?Q.Xd(S,x,K):X.p.TransformNormalFromFloatsToRef(S,x,K,f,Q)}clone(){const f=new Y(this.i,this.height,this.radiusRange,this.direction1,this.direction2);return N.b.DeepCopy(this,f),f}applyToShader(f){f.setFloat("i",this.i),f.setFloat("height",this.height),f.setFloat("radiusRange",this.radiusRange),f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2)}buildUniformLayout(f){f.addUniform("i",1),f.addUniform("height",1),f.addUniform("radiusRange",1),f.addUniform("direction1",3),f.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const f=super.serialize();return f.direction1=this.direction1.ke(),f.direction2=this.direction2.ke(),f}parse(f){super.parse(f),X.p.FromArrayToRef(f.direction1,0,this.direction1),X.p.FromArrayToRef(f.direction2,0,this.direction2)}}class O{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=f,this.radiusRange=Q,this.directionRandomizer=H}startDirectionFunction(f,Q,H,i){const S=H.position.hd(f.getTranslation()).normalize(),x=(0,B.q)(0,this.directionRandomizer),K=(0,B.q)(0,this.directionRandomizer),Z=(0,B.q)(0,this.directionRandomizer);S.x+=x,S.y+=K,S.z+=Z,S.normalize(),i?Q.p(S):X.p.TransformNormalFromFloatsToRef(S.x,S.y,S.z,f,Q)}startPositionFunction(f,Q,H,i){const S=this.i-(0,B.q)(0,this.i*this.radiusRange),x=(0,B.q)(0,1),K=(0,B.q)(0,2*Math.PI),Z=Math.acos(2*x-1),N=S*Math.cos(K)*Math.sin(Z),J=S*Math.cos(Z),g=S*Math.sin(K)*Math.sin(Z);i?Q.Xd(N,Math.abs(J),g):X.p.TransformCoordinatesFromFloatsToRef(N,Math.abs(J),g,f,Q)}clone(){const f=new O(this.i,this.directionRandomizer);return N.b.DeepCopy(this,f),f}applyToShader(f){f.setFloat("i",this.i),f.setFloat("radiusRange",this.radiusRange),f.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(f){f.addUniform("i",1),f.addUniform("radiusRange",1),f.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.i=this.i,f.radiusRange=this.radiusRange,f.directionRandomizer=this.directionRandomizer,f}parse(f){this.i=f.i,this.radiusRange=f.radiusRange,this.directionRandomizer=f.directionRandomizer}}class n{constructor(){this.direction1=new X.p(0,1,0),this.direction2=new X.p(0,1,0)}startDirectionFunction(f,Q,H,i){const S=(0,B.q)(this.direction1.x,this.direction2.x),x=(0,B.q)(this.direction1.y,this.direction2.y),K=(0,B.q)(this.direction1.z,this.direction2.z);i?Q.Xd(S,x,K):X.p.TransformNormalFromFloatsToRef(S,x,K,f,Q)}startPositionFunction(f,Q,H,i){i?Q.Xd(0,0,0):X.p.TransformCoordinatesFromFloatsToRef(0,0,0,f,Q)}clone(){const f=new n;return N.b.DeepCopy(this,f),f}applyToShader(f){f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2)}buildUniformLayout(f){f.addUniform("direction1",3),f.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.direction1=this.direction1.ke(),f.direction2=this.direction2.ke(),f}parse(f){X.p.FromArrayToRef(f.direction1,0,this.direction1),X.p.FromArrayToRef(f.direction2,0,this.direction2)}}class e{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=f,this.radiusRange=Q,this.directionRandomizer=H}startDirectionFunction(f,Q,H,i){const S=H.position.hd(f.getTranslation()).normalize(),x=(0,B.q)(0,this.directionRandomizer),K=(0,B.q)(0,this.directionRandomizer),Z=(0,B.q)(0,this.directionRandomizer);S.x+=x,S.y+=K,S.z+=Z,S.normalize(),i?Q.p(S):X.p.TransformNormalFromFloatsToRef(S.x,S.y,S.z,f,Q)}startPositionFunction(f,Q,H,i){const S=this.i-(0,B.q)(0,this.i*this.radiusRange),x=(0,B.q)(0,1),K=(0,B.q)(0,2*Math.PI),Z=Math.acos(2*x-1),N=S*Math.cos(K)*Math.sin(Z),J=S*Math.cos(Z),g=S*Math.sin(K)*Math.sin(Z);i?Q.Xd(N,J,g):X.p.TransformCoordinatesFromFloatsToRef(N,J,g,f,Q)}clone(){const f=new e(this.i,this.directionRandomizer);return N.b.DeepCopy(this,f),f}applyToShader(f){f.setFloat("i",this.i),f.setFloat("radiusRange",this.radiusRange),f.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(f){f.addUniform("i",1),f.addUniform("radiusRange",1),f.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.i=this.i,f.radiusRange=this.radiusRange,f.directionRandomizer=this.directionRandomizer,f}parse(f){this.i=f.i,this.radiusRange=f.radiusRange,this.directionRandomizer=f.directionRandomizer}}class G extends e{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new X.p(0,1,0),H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.p(0,1,0);super(f),this.direction1=Q,this.direction2=H}startDirectionFunction(f,Q){const H=(0,B.q)(this.direction1.x,this.direction2.x),i=(0,B.q)(this.direction1.y,this.direction2.y),S=(0,B.q)(this.direction1.z,this.direction2.z);X.p.TransformNormalFromFloatsToRef(H,i,S,f,Q)}clone(){const f=new G(this.i,this.direction1,this.direction2);return N.b.DeepCopy(this,f),f}applyToShader(f){f.setFloat("i",this.i),f.setFloat("radiusRange",this.radiusRange),f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2)}buildUniformLayout(f){f.addUniform("i",1),f.addUniform("radiusRange",1),f.addUniform("direction1",3),f.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const f=super.serialize();return f.direction1=this.direction1.ke(),f.direction2=this.direction2.ke(),f}parse(f){super.parse(f),this.direction1.p(f.direction1),this.direction2.p(f.direction2)}}class I{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(f,Q,H,i){const S=X.l.Wd[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,H,S);const f=X.l.Wd[1];S.subtractToRef(H.position,f),f.scaleToRef(1/H.lifeTime,S)}else S.set(0,0,0);i?Q.p(S):X.p.TransformNormalToRef(S,f,Q)}startPositionFunction(f,Q,H,i){const S=X.l.Wd[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,H,S):S.set(0,0,0),i?Q.p(S):X.p.TransformCoordinatesToRef(S,f,Q)}clone(){const f=new I;return N.b.DeepCopy(this,f),f}applyToShader(f){}buildUniformLayout(f){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const f={};return f.type=this.getClassName(),f.particlePositionGenerator=this.particlePositionGenerator,f.particleDestinationGenerator=this.particleDestinationGenerator,f}parse(f){f.particlePositionGenerator&&(this.particlePositionGenerator=f.particlePositionGenerator),f.particleDestinationGenerator&&(this.particleDestinationGenerator=f.particleDestinationGenerator)}}var l=H(1253);class q{get mesh(){return this.ue}set mesh(f){this.ue!==f&&(this.ue=f,f?(this._indices=f.Ud(),this._positions=f.getVerticesData(l.e.PositionKind),this._normals=f.getVerticesData(l.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=X.p.Zero(),this.ue=null,this.direction1=new X.p(0,1,0),this.direction2=new X.p(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=f}startDirectionFunction(f,Q,H,i){if(this.useMeshNormalsForDirection&&this._normals)return void X.p.TransformNormalToRef(this._storedNormal,f,Q);const S=(0,B.q)(this.direction1.x,this.direction2.x),x=(0,B.q)(this.direction1.y,this.direction2.y),K=(0,B.q)(this.direction1.z,this.direction2.z);i?Q.Xd(S,x,K):X.p.TransformNormalFromFloatsToRef(S,x,K,f,Q)}startPositionFunction(f,Q,H,i){if(!this._indices||!this._positions)return;const S=3*Math.random()*(this._indices.length/3)|0,x=Math.random(),K=Math.random()*(1-x),Z=1-x-K,B=this._indices[S],N=this._indices[S+1],J=this._indices[S+2],g=X.l.Wd[0],z=X.l.Wd[1],v=X.l.Wd[2],Y=X.l.Wd[3];X.p.FromArrayToRef(this._positions,3*B,g),X.p.FromArrayToRef(this._positions,3*N,z),X.p.FromArrayToRef(this._positions,3*J,v),Y.x=x*g.x+K*z.x+Z*v.x,Y.y=x*g.y+K*z.y+Z*v.y,Y.z=x*g.z+K*z.z+Z*v.z,i?Q.Xd(Y.x,Y.y,Y.z):X.p.TransformCoordinatesFromFloatsToRef(Y.x,Y.y,Y.z,f,Q),this.useMeshNormalsForDirection&&this._normals&&(X.p.FromArrayToRef(this._normals,3*B,g),X.p.FromArrayToRef(this._normals,3*N,z),X.p.FromArrayToRef(this._normals,3*J,v),this._storedNormal.x=x*g.x+K*z.x+Z*v.x,this._storedNormal.y=x*g.y+K*z.y+Z*v.y,this._storedNormal.z=x*g.z+K*z.z+Z*v.z)}clone(){const f=new q(this.mesh);return N.b.DeepCopy(this,f),f}applyToShader(f){f.setVector3("direction1",this.direction1),f.setVector3("direction2",this.direction2)}buildUniformLayout(f){f.addUniform("direction1",3),f.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var f;const Q={};return Q.type=this.getClassName(),Q.direction1=this.direction1.ke(),Q.direction2=this.direction2.ke(),Q.meshId=null===(f=this.mesh)||void 0===f?void 0:f.id,Q.useMeshNormalsForDirection=this.useMeshNormalsForDirection,Q}parse(f,Q){X.p.FromArrayToRef(f.direction1,0,this.direction1),X.p.FromArrayToRef(f.direction2,0,this.direction2),f.meshId&&Q&&(this.mesh=Q.getLastMeshById(f.meshId)),this.useMeshNormalsForDirection=f.useMeshNormalsForDirection}}var D=H(1111);class d{_isUbo(f){return void 0!==f.addUniform}constructor(f){this._isUbo(f)?(this.setMatrix3x3=f.updateMatrix3x3.bind(f),this.setMatrix2x2=f.updateMatrix2x2.bind(f),this.setFloat=f.updateFloat.bind(f),this.setFloat2=f.updateFloat2.bind(f),this.setFloat3=f.updateFloat3.bind(f),this.setFloat4=f.updateFloat4.bind(f),this.setFloatArray=f.updateFloatArray.bind(f),this.setArray=f.updateArray.bind(f),this.setIntArray=f.updateIntArray.bind(f),this.setMatrix=f.Be.bind(f),this.setMatrices=f.updateMatrices.bind(f),this.setVector3=f.updateVector3.bind(f),this.setVector4=f.updateVector4.bind(f),this.setColor3=f.updateColor3.bind(f),this.setColor4=f.updateColor4.bind(f),this.setDirectColor4=f.updateDirectColor4.bind(f),this.setInt=f.updateInt.bind(f),this.setInt2=f.updateInt2.bind(f),this.setInt3=f.updateInt3.bind(f),this.setInt4=f.updateInt4.bind(f)):(this.setMatrix3x3=f.setMatrix3x3.bind(f),this.setMatrix2x2=f.setMatrix2x2.bind(f),this.setFloat=f.setFloat.bind(f),this.setFloat2=f.setFloat2.bind(f),this.setFloat3=f.setFloat3.bind(f),this.setFloat4=f.setFloat4.bind(f),this.setFloatArray=f.setFloatArray.bind(f),this.setArray=f.setArray.bind(f),this.setIntArray=f.setIntArray.bind(f),this.setMatrix=f.setMatrix.bind(f),this.setMatrices=f.setMatrices.bind(f),this.setVector3=f.setVector3.bind(f),this.setVector4=f.setVector4.bind(f),this.setColor3=f.setColor3.bind(f),this.setColor4=f.setColor4.bind(f),this.setDirectColor4=f.setDirectColor4.bind(f),this.setInt=f.setInt.bind(f),this.setInt2=f.setInt2.bind(f),this.setInt3=f.setInt3.bind(f),this.setInt4=f.setInt4.bind(f))}}var s=H(1115);const F="gpuUpdateParticlesPixelShader",P="#version 300 es\nvoid main() {discard;}\n";s.d.ShadersStore[F]=P;const m="gpuUpdateParticlesVertexShader",c="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";s.d.ShadersStore[m]=c;(0,K.h)("BABYLON.WebGL2ParticleSystem",class{constructor(f,Q){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=f,this._engine=Q,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","i","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var f;return(null===(f=this._updateEffect)||void 0===f?void 0:f.isReady())??!1}createUpdateBuffer(f){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof I&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=f,this._updateEffect=new D.c("gpuUpdateParticles",this._updateEffectOptions,this._engine),new d(this._updateEffect)}createVertexBuffers(f,Q){this._updateVAO.push(this._createUpdateVAO(f)),this._renderVAO.push(this._engine.recordVertexArrayObject(Q,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=Q}createParticleBuffer(f){return f}bindDrawBuffers(f,Q,H){H?this._engine.bindBuffers(this._renderVertexBuffers,H,Q):this._engine.bindVertexArrayObject(this._renderVAO[f],null)}preUpdateParticleBuffer(){const f=this._engine;if(this._engine.enableEffect(this._updateEffect),!f.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(f,Q,H){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[f],null);const X=this._engine;X.bindTransformFeedbackBuffer(Q.getBuffer()),X.setRasterizerState(!1),X.beginTransformFeedback(!0),X.drawArraysType(3,0,H),X.endTransformFeedback(),X.setRasterizerState(!0),X.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let f=0;f<this._updateVAO.length;f++)this._engine.releaseVertexArrayObject(this._updateVAO[f]);this._updateVAO.length=0;for(let f=0;f<this._renderVAO.length;f++)this._engine.releaseVertexArrayObject(this._renderVAO[f]);this._renderVAO.length=0}_createUpdateVAO(f){const Q={};Q.position=f.createVertexBuffer("position",0,3);let H=3;Q.age=f.createVertexBuffer("age",H,1),H+=1,Q.size=f.createVertexBuffer("size",H,3),H+=3,Q.life=f.createVertexBuffer("life",H,1),H+=1,Q.seed=f.createVertexBuffer("seed",H,4),H+=4,Q.direction=f.createVertexBuffer("direction",H,3),H+=3,this._parent.particleEmitterType instanceof I&&(Q.initialPosition=f.createVertexBuffer("initialPosition",H,3),H+=3),this._parent._colorGradientsTexture||(Q.color=f.createVertexBuffer("color",H,4),H+=4),this._parent._isBillboardBased||(Q.initialDirection=f.createVertexBuffer("initialDirection",H,3),H+=3),this._parent.noiseTexture&&(Q.noiseCoordinates1=f.createVertexBuffer("noiseCoordinates1",H,3),H+=3,Q.noiseCoordinates2=f.createVertexBuffer("noiseCoordinates2",H,3),H+=3),this._parent._angularSpeedGradientsTexture?(Q.angle=f.createVertexBuffer("angle",H,1),H+=1):(Q.angle=f.createVertexBuffer("angle",H,2),H+=2),this._parent._isAnimationSheetEnabled&&(Q.cellIndex=f.createVertexBuffer("cellIndex",H,1),H+=1,this._parent.spriteRandomStartCell&&(Q.cellStartOffset=f.createVertexBuffer("cellStartOffset",H,1),H+=1));const X=this._engine.recordVertexArrayObject(Q,null,this._updateEffect);return this._engine.bindArrayBuffer(null),X}});class W{constructor(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,X=arguments.length>3?arguments[3]:void 0;this._engine=f,this._label=X,this._engine._storageBuffers.push(this),this._create(Q,H)}_create(f,Q){this._bufferSize=f,this._creationFlags=Q,this._buffer=this._engine.createStorageBuffer(f,Q,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(f,Q,H){this._buffer&&this._engine.updateStorageBuffer(this._buffer,f,Q,H)}read(f,Q,H,X){return this._engine.readFromStorageBuffer(this._buffer,f,Q,H,X)}dispose(){const f=this._engine._storageBuffers,Q=f.indexOf(this);-1!==Q&&(f[Q]=f[f.length-1],f.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var R=H(978),U=H(982),E=H(1151),t=H(974),u=H(1332),L=H(1092),A=H(1135),a=H(1319);class V{constructor(){this._gpuTimeInFrameId=-1,this.counter=new a.d}_addDuration(f,Q){f<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==f?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(Q,!1),this._gpuTimeInFrameId=f):this.counter.addCount(Q,!1))}}class M{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(f,Q,H){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=f,this._engine=Q,this.uniqueId=u.e.UniqueId,Q.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new V),this._engine.getCaps().supportComputeShaders?X.bindingsMapping?(this._context=Q.createComputeContext(),this._shaderPath=H,this._options={bindingsMapping:{},defines:[],...X}):L.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):L.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(f,Q){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const X=this._bindings[f];this._bindings[f]={type:H?0:4,object:Q,indexInGroupEntries:null===X||void 0===X?void 0:X.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!X||X.object!==Q||X.type!==this._bindings[f].type)}setStorageTexture(f,Q){const H=this._bindings[f];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==Q),this._bindings[f]={type:1,object:Q,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setExternalTexture(f,Q){const H=this._bindings[f];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==Q),this._bindings[f]={type:6,object:Q,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setVideoTexture(f,Q){return!!Q.externalTexture&&(this.setExternalTexture(f,Q.externalTexture),!0)}setUniformBuffer(f,Q){const H=this._bindings[f];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==Q),this._bindings[f]={type:M._BufferIsDataBuffer(Q)?7:2,object:Q,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setStorageBuffer(f,Q){const H=this._bindings[f];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==Q),this._bindings[f]={type:M._BufferIsDataBuffer(Q)?7:3,object:Q,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setTextureSampler(f,Q){const H=this._bindings[f];this._contextIsDirty||(this._contextIsDirty=!H||!Q.compareSampler(H.object)),this._bindings[f]={type:5,object:Q,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}isReady(){let f=this._effect;for(const i in this._bindings){const f=this._bindings[i],Q=f.type,H=f.object;switch(Q){case 0:case 4:case 1:if(!H.isReady())return!1;break;case 6:if(!H.isReady())return!1;break}}const Q=[],H=this._shaderPath;if(this._options.defines)for(let i=0;i<this._options.defines.length;i++)Q.push(this._options.defines[i]);const X=Q.join("\n");return this._cachedDefines!==X&&(this._cachedDefines=X,f=this._engine.createComputeEffect(H,{defines:X,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=f),!!f.isReady()}dispatch(f,Q,H){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,f,Q,H,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const H=M._BufferIsDataBuffer(f)?f:f.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,H,Q,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const Q in this._bindings){const H=this._bindings[Q];if(!this._options.bindingsMapping[Q])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+Q+"'");switch(H.type){case 0:{const X=this._samplers[Q],i=H.object;var f;if(!X||!i._texture||!X.compareSampler(i._texture))this._samplers[Q]=(new A.b).setParameters(i.wrapU,i.wrapV,i.wrapR,i.anisotropicFilteringLevel,i._texture.samplingMode,null===(f=i._texture)||void 0===f?void 0:f._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const f=H.object;f.getBuffer()!==H.buffer&&(H.buffer=f.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(f,Q,H){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((i=>{const S=()=>{this.dispatch(f,Q,H)?i():setTimeout(S,X)};S()}))}serialize(){const f=E.b.Serialize(this);f.options=this._options,f.shaderPath=this._shaderPath,f.Ij={},f.textures={};for(const Q in this._bindings){const H=this._bindings[Q],X=H.object;switch(H.type){case 0:case 4:case 1:{const i=X.serialize();i&&(f.textures[Q]=i,f.Ij[Q]={type:H.type});break}}}return f}static Parse(f,Q,H){const X=E.b.Parse((()=>new M(f.name,Q.getEngine(),f.shaderPath,f.options)),f,Q,H);for(const i in f.textures){const S=f.Ij[i],x=t.b.Parse(f.textures[i],Q,H);0===S.type?X.setTexture(i,x):4===S.type?X.setTexture(i,x,!1):X.setStorageTexture(i,x)}return X}static _BufferIsDataBuffer(f){return void 0!==f.underlyingResource}}(0,R.d)([(0,U.G)()],M.prototype,"name",void 0),(0,R.d)([(0,U.G)()],M.prototype,"fastMode",void 0),(0,K.h)("BABYLON.ComputeShader",M);var r=H(1238);const j="gpuUpdateParticlesComputeShader",T="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";s.d.ShadersStoreWGSL[j]=T;(0,K.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(f,Q){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=f,this._engine=Q}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var f;return(null===(f=this._updateComputeShader)||void 0===f?void 0:f.isReady())??!1}createUpdateBuffer(f){var Q;const H={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(H.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(H.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(H.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(H.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(H.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(H.noiseTexture={group:1,binding:11}),this._updateComputeShader=new M("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:H,defines:f.split("\n")}),null===(Q=this._simParamsComputeShader)||void 0===Q||Q.dispose(),this._simParamsComputeShader=new r.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new d(this._simParamsComputeShader)}createVertexBuffers(f,Q){this._renderVertexBuffers.push(Q)}createParticleBuffer(f){const Q=new W(this._engine,4*f.length,11,"ComputeShaderParticleSystemBuffer");return Q.update(f),this._bufferComputeShader.push(Q),Q.getBuffer()}bindDrawBuffers(f,Q,H){this._engine.bindBuffers(this._renderVertexBuffers[f],H,Q)}preUpdateParticleBuffer(){}updateParticleBuffer(f,Q,H){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[f]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^f]),this._updateComputeShader.dispatch(Math.ceil(H/64))}releaseBuffers(){var f;for(let Q=0;Q<this._bufferComputeShader.length;++Q)this._bufferComputeShader[Q].dispose();this._bufferComputeShader.length=0,null===(f=this._simParamsComputeShader)||void 0===f||f.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class k{constructor(f,Q,H){this.gradient=f,this.color1=Q,this.color2=H}getColorToRef(f){this.color2?x.h.LerpToRef(this.color1,this.color2,Math.random(),f):f.p(this.color1)}}class y{constructor(f,Q){this.gradient=f,this.color=Q}}class h{constructor(f,Q,H){this.gradient=f,this.factor1=Q,this.factor2=H}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class w{static GetCurrentGradient(f,Q,H){if(Q[0].gradient>f)return void H(Q[0],Q[0],1);for(let i=0;i<Q.length-1;i++){const X=Q[i],S=Q[i+1];if(f>=X.gradient&&f<=S.gradient){return void H(X,S,(f-X.gradient)/(S.gradient-X.gradient))}}const X=Q.length-1;H(Q[X],Q[X],1)}}var b=H(994),o=H(11443),p=H(1027);class C{constructor(f){this.particleSystem=f,this.position=X.p.Zero(),this.direction=X.p.Zero(),this.color=new x.h(0,0,0,0),this.colorStep=new x.h(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new X.m(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new x.h(0,0,0,0),this._currentColor2=new x.h(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=C._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let f=this.age,Q=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===Q?(Q=1,f=this._randomCellOffset):f+=this._randomCellOffset);const H=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let X;X=this._initialSpriteCellLoop?(0,B.c)(f*Q%this.lifeTime/this.lifeTime):(0,B.c)(f*Q/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+X*H|0}_inheritParticleInfoToSubEmitter(f){if(f.particleSystem.k.position){const Q=f.particleSystem.k;if(Q.position.p(this.position),f.inheritDirection){const f=X.l.Wd[0];this.direction.normalizeToRef(f),Q.setDirection(f,0,Math.PI/2)}}else{f.particleSystem.k.p(this.position)}this.direction.scaleToRef(f.inheritedVelocityAmount/2,X.l.Wd[0]),f.particleSystem._inheritedVelocityOffset.p(X.l.Wd[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((f=>{this._inheritParticleInfoToSubEmitter(f)}))}_reset(){this.age=0,this.id=C._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(f){f.position.p(this.position),this._initialDirection?f._initialDirection?f._initialDirection.p(this._initialDirection):f._initialDirection=this._initialDirection.clone():f._initialDirection=null,f.direction.p(this.direction),this.xg&&(f.xg?f.xg.p(this.xg):f.xg=this.xg.clone()),f.color.p(this.color),f.colorStep.p(this.colorStep),f.lifeTime=this.lifeTime,f.age=this.age,f._randomCellOffset=this._randomCellOffset,f.size=this.size,f.scale.p(this.scale),f.angle=this.angle,f.angularSpeed=this.angularSpeed,f.particleSystem=this.particleSystem,f.cellIndex=this.cellIndex,f.id=this.id,f._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(f._currentColorGradient=this._currentColorGradient,f._currentColor1.p(this._currentColor1),f._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(f._currentSizeGradient=this._currentSizeGradient,f._currentSize1=this._currentSize1,f._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(f._currentAngularSpeedGradient=this._currentAngularSpeedGradient,f._currentAngularSpeed1=this._currentAngularSpeed1,f._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(f._currentVelocityGradient=this._currentVelocityGradient,f._currentVelocity1=this._currentVelocity1,f._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(f._currentLimitVelocityGradient=this._currentLimitVelocityGradient,f._currentLimitVelocity1=this._currentLimitVelocity1,f._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(f._currentDragGradient=this._currentDragGradient,f._currentDrag1=this._currentDrag1,f._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(f._initialStartSpriteCellID=this._initialStartSpriteCellID,f._initialEndSpriteCellID=this._initialEndSpriteCellID,f._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(f.remapData&&this.remapData?f.remapData.p(this.remapData):f.remapData=new X.s(0,0,0,0)),this._randomNoiseCoordinates1&&(f._randomNoiseCoordinates1?(f._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),f._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(f._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),f._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}C._Count=0;var ff=H(1385),Qf=(H(1462),H(1395)),Hf=H(1389),Xf=H(1229);class Sf extends Z{set onDispose(f){this._onDisposeObserver&&this.fe.remove(this._onDisposeObserver),this._onDisposeObserver=this.fe.add(f)}get useRampGradients(){return this._useRampGradients}set useRampGradients(f){this._useRampGradients!==f&&(this._useRampGradients=f,this._resetEffect())}get particles(){return this.Dj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.Dj.length}getClassName(){return"ff"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var f;let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(f=this._customWrappers[Q])||void 0===f?void 0:f.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[f]??this._customWrappers[0]}setCustomEffect(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[Q]=new ff.b(this._engine),this._customWrappers[Q].effect=f,this._customWrappers[Q].drawContext&&(this._customWrappers[Q].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new b.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(f,Q,H){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]&&arguments[4],K=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(f),this._emitterInverseWorldMatrix=X.e.Identity(),this._inheritedVelocityOffset=new X.p,this.fe=new b.e,this.onStoppedObservable=new b.e,this.Dj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new x.h(0,0,0,0),this._colorDiff=new x.h(0,0,0,0),this._scaledDirection=X.p.Zero(),this._scaledGravity=X.p.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=f=>{},this.recycleParticle=f=>{const Q=this.Dj.pop();Q!==f&&Q.copyTo(f),this._stockParticles.push(Q)},this._createParticle=()=>{let f;return 0!==this._stockParticles.length?(f=this._stockParticles.pop(),f._reset()):f=new C(this),this._prepareParticle(f),f},this._shadersLoaded=!1,this._capacity=Q,this._epsilon=K,this._isAnimationSheetEnabled=S,H&&"Scene"!==H.getClassName()?(this._engine=H,this.defaultProjectionMatrix=X.e.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=H||p.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.pe.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ff.b(this._engine)},this._customWrappers[0].effect=i,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new J;let Z=null;this.updateFunction=f=>{let Q=null;var H;this.noiseTexture&&(Q=this.noiseTexture.getSize(),null===(H=this.noiseTexture.getContent())||void 0===H||H.then((f=>{Z=f})));const i=f===this.Dj;for(let S=0;S<f.length;S++){const H=f[S];let K=this._scaledUpdateSpeed;const N=H.age;if(H.age+=K,H.age>H.lifeTime){const f=H.age-N;K=(H.lifeTime-N)*K/f,H.age=H.lifeTime}const J=H.age/H.lifeTime;this._colorGradients&&this._colorGradients.length>0?w.GetCurrentGradient(J,this._colorGradients,((f,Q,X)=>{f!==H._currentColorGradient&&(H._currentColor1.p(H._currentColor2),Q.getColorToRef(H._currentColor2),H._currentColorGradient=f),x.h.LerpToRef(H._currentColor1,H._currentColor2,X,H.color)})):(H.colorStep.scaleToRef(K,this._scaledColorStep),H.color.addInPlace(this._scaledColorStep),H.color.a<0&&(H.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&w.GetCurrentGradient(J,this._angularSpeedGradients,((f,Q,X)=>{f!==H._currentAngularSpeedGradient&&(H._currentAngularSpeed1=H._currentAngularSpeed2,H._currentAngularSpeed2=Q.getFactor(),H._currentAngularSpeedGradient=f),H.angularSpeed=(0,B.n)(H._currentAngularSpeed1,H._currentAngularSpeed2,X)})),H.angle+=H.angularSpeed*K;let g=K;if(this._velocityGradients&&this._velocityGradients.length>0&&w.GetCurrentGradient(J,this._velocityGradients,((f,Q,X)=>{f!==H._currentVelocityGradient&&(H._currentVelocity1=H._currentVelocity2,H._currentVelocity2=Q.getFactor(),H._currentVelocityGradient=f),g*=(0,B.n)(H._currentVelocity1,H._currentVelocity2,X)})),H.direction.scaleToRef(g,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&w.GetCurrentGradient(J,this._limitVelocityGradients,((f,Q,X)=>{f!==H._currentLimitVelocityGradient&&(H._currentLimitVelocity1=H._currentLimitVelocity2,H._currentLimitVelocity2=Q.getFactor(),H._currentLimitVelocityGradient=f);const i=(0,B.n)(H._currentLimitVelocity1,H._currentLimitVelocity2,X);H.direction.length()>i&&H.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&w.GetCurrentGradient(J,this._dragGradients,((f,Q,X)=>{f!==H._currentDragGradient&&(H._currentDrag1=H._currentDrag2,H._currentDrag2=Q.getFactor(),H._currentDragGradient=f);const i=(0,B.n)(H._currentDrag1,H._currentDrag2,X);this._scaledDirection.scaleInPlace(1-i)})),this.isLocal&&H.xg?(H.xg.addInPlace(this._scaledDirection),X.p.TransformCoordinatesToRef(H.xg,this._emitterWorldMatrix,H.position)):H.position.addInPlace(this._scaledDirection),Z&&Q&&H._randomNoiseCoordinates1){const f=this._fetchR(H._randomNoiseCoordinates1.x,H._randomNoiseCoordinates1.y,Q.width,Q.height,Z),i=this._fetchR(H._randomNoiseCoordinates1.z,H._randomNoiseCoordinates2.x,Q.width,Q.height,Z),S=this._fetchR(H._randomNoiseCoordinates2.y,H._randomNoiseCoordinates2.z,Q.width,Q.height,Z),x=X.l.Wd[0],B=X.l.Wd[1];x.Xd((2*f-1)*this.noiseStrength.x,(2*i-1)*this.noiseStrength.y,(2*S-1)*this.noiseStrength.z),x.scaleToRef(K,B),H.direction.addInPlace(B)}this.gravity.scaleToRef(K,this._scaledGravity),H.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&w.GetCurrentGradient(J,this._sizeGradients,((f,Q,X)=>{f!==H._currentSizeGradient&&(H._currentSize1=H._currentSize2,H._currentSize2=Q.getFactor(),H._currentSizeGradient=f),H.size=(0,B.n)(H._currentSize1,H._currentSize2,X)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&w.GetCurrentGradient(J,this._colorRemapGradients,((f,Q,X)=>{const i=(0,B.n)(f.factor1,Q.factor1,X),S=(0,B.n)(f.factor2,Q.factor2,X);H.remapData.x=i,H.remapData.y=S-i})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&w.GetCurrentGradient(J,this._alphaRemapGradients,((f,Q,X)=>{const i=(0,B.n)(f.factor1,Q.factor1,X),S=(0,B.n)(f.factor2,Q.factor2,X);H.remapData.z=i,H.remapData.w=S-i}))),this._isAnimationSheetEnabled&&H.updateCellIndex(),H._inheritParticleInfoToSubEmitters(),H.age>=H.lifeTime&&(this._emitFromParticle(H),H._attachedSubEmitters&&(H._attachedSubEmitters.forEach((f=>{f.particleSystem.disposeOnStop=!0,f.particleSystem.stop()})),H._attachedSubEmitters=null),this.recycleParticle(H),i&&S--)}}}serialize(f){throw new Error("Method not implemented.")}clone(f,Q){throw new Error("Method not implemented.")}_addFactorGradient(f,Q,H,X){const i=new h(Q,H,X);f.push(i),f.sort(((f,Q)=>f.gradient<Q.gradient?-1:f.gradient>Q.gradient?1:0))}_removeFactorGradient(f,Q){if(!f)return;let H=0;for(const X of f){if(X.gradient===Q){f.splice(H,1);break}H++}}addLifeTimeGradient(f,Q,H){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,f,Q,H),this}removeLifeTimeGradient(f){return this._removeFactorGradient(this._lifeTimeGradients,f),this}addSizeGradient(f,Q,H){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,f,Q,H),this}removeSizeGradient(f){return this._removeFactorGradient(this._sizeGradients,f),this}addColorRemapGradient(f,Q,H){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,f,Q,H),this}removeColorRemapGradient(f){return this._removeFactorGradient(this._colorRemapGradients,f),this}addAlphaRemapGradient(f,Q,H){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,f,Q,H),this}removeAlphaRemapGradient(f){return this._removeFactorGradient(this._alphaRemapGradients,f),this}addAngularSpeedGradient(f,Q,H){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,f,Q,H),this}removeAngularSpeedGradient(f){return this._removeFactorGradient(this._angularSpeedGradients,f),this}addVelocityGradient(f,Q,H){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,f,Q,H),this}removeVelocityGradient(f){return this._removeFactorGradient(this._velocityGradients,f),this}addLimitVelocityGradient(f,Q,H){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,f,Q,H),this}removeLimitVelocityGradient(f){return this._removeFactorGradient(this._limitVelocityGradients,f),this}addDragGradient(f,Q,H){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,f,Q,H),this}removeDragGradient(f){return this._removeFactorGradient(this._dragGradients,f),this}addEmitRateGradient(f,Q,H){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,f,Q,H),this}removeEmitRateGradient(f){return this._removeFactorGradient(this._emitRateGradients,f),this}addStartSizeGradient(f,Q,H){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,f,Q,H),this}removeStartSizeGradient(f){return this._removeFactorGradient(this._startSizeGradients,f),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const f=new Uint8Array(4*this._rawTextureWidth),Q=x.k.Fe[0];for(let H=0;H<this._rawTextureWidth;H++){const X=H/this._rawTextureWidth;w.GetCurrentGradient(X,this._rampGradients,((X,i,S)=>{x.e.LerpToRef(X.color,i.color,S,Q),f[4*H]=255*Q.r,f[4*H+1]=255*Q.g,f[4*H+2]=255*Q.b,f[4*H+3]=255}))}this._rampGradientsTexture=o.b.CreateRGBATexture(f,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((f,Q)=>f.gradient<Q.gradient?-1:f.gradient>Q.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(f,Q){this._rampGradients||(this._rampGradients=[]);const H=new y(f,Q);return this._rampGradients.push(H),this._syncRampGradientTexture(),this}removeRampGradient(f){return this._removeGradientAndTexture(f,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(f,Q,H){this._colorGradients||(this._colorGradients=[]);const X=new k(f,Q,H);return this._colorGradients.push(X),this._colorGradients.sort(((f,Q)=>f.gradient<Q.gradient?-1:f.gradient>Q.gradient?1:0)),this}removeColorGradient(f){if(!this._colorGradients)return this;let Q=0;for(const H of this._colorGradients){if(H.gradient===f){this._colorGradients.splice(Q,1);break}Q++}return this}resetDrawCache(){for(const f of this._drawWrappers)if(f)for(const Q of f)null===Q||void 0===Q||Q.dispose();this._drawWrappers=[]}_fetchR(f,Q,H,X,i){return i[4*(((f=.5*Math.abs(f)+.5)*H%H|0)+((Q=.5*Math.abs(Q)+.5)*X%X|0)*H)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const f=this._engine,Q=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*Q),this._vertexBuffer=new l.d(f,this._vertexData,!0,Q);let H=0;const X=this._vertexBuffer.createVertexBuffer(l.e.PositionKind,H,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[l.e.PositionKind]=X,H+=3;const i=this._vertexBuffer.createVertexBuffer(l.e.ColorKind,H,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[l.e.ColorKind]=i,H+=4;const S=this._vertexBuffer.createVertexBuffer("angle",H,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=S,H+=1;const x=this._vertexBuffer.createVertexBuffer("size",H,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=x,H+=2,this._isAnimationSheetEnabled){const f=this._vertexBuffer.createVertexBuffer("cellIndex",H,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=f,H+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const f=this._vertexBuffer.createVertexBuffer("direction",H,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=f,H+=3}if(this._useRampGradients){const f=this._vertexBuffer.createVertexBuffer("remapData",H,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=f,H+=4}let K;if(this._useInstancing){const Q=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new l.d(f,Q,!1,2),K=this._spriteBuffer.createVertexBuffer("offset",0,2)}else K=this._vertexBuffer.createVertexBuffer("offset",H,2,this._vertexBufferSize,this._useInstancing),H+=2;this._vertexBuffers.offset=K,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const f=[],Q=[];let H=0;for(let X=0;X<this._capacity;X++)f.push(H),f.push(H+1),f.push(H+2),f.push(H),f.push(H+2),f.push(H+3),Q.push(H,H+1,H+1,H+2,H+2,H+3,H+3,H,H,H+3),H+=4;this._indexBuffer=this._engine.createIndexBuffer(f),this._linesIndexBuffer=this._engine.createIndexBuffer(Q)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(f)setTimeout((()=>{this.start(0)}),f);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var Q;-1!==(null===(Q=this.k)||void 0===Q?void 0:Q.getClassName().indexOf("Mesh"))&&this.k.re(!0);const f=this.noiseTexture;if(f&&f.onGeneratedObservable)f.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let Q=0;Q<this.preWarmCycles;Q++)this.animate(!0),f.render()}))}));else for(let Q=0;Q<this.preWarmCycles;Q++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(f))}_postStop(f){}reset(){this._stockParticles.length=0,this.Dj.length=0}_appendParticleVertex(f,Q,H,i){let S=f*this._vertexBufferSize;if(this._vertexData[S++]=Q.position.x+this.tg.x,this._vertexData[S++]=Q.position.y+this.tg.y,this._vertexData[S++]=Q.position.z+this.tg.z,this._vertexData[S++]=Q.color.r,this._vertexData[S++]=Q.color.g,this._vertexData[S++]=Q.color.b,this._vertexData[S++]=Q.color.a,this._vertexData[S++]=Q.angle,this._vertexData[S++]=Q.scale.x*Q.size,this._vertexData[S++]=Q.scale.y*Q.size,this._isAnimationSheetEnabled&&(this._vertexData[S++]=Q.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[S++]=Q.direction.x,this._vertexData[S++]=Q.direction.y,this._vertexData[S++]=Q.direction.z);else if(Q._initialDirection){let f=Q._initialDirection;this.isLocal&&(X.p.TransformNormalToRef(f,this._emitterWorldMatrix,X.l.Wd[0]),f=X.l.Wd[0]),0===f.x&&0===f.z&&(f.x=.001),this._vertexData[S++]=f.x,this._vertexData[S++]=f.y,this._vertexData[S++]=f.z}else{let f=Q.direction;this.isLocal&&(X.p.TransformNormalToRef(f,this._emitterWorldMatrix,X.l.Wd[0]),f=X.l.Wd[0]),0===f.x&&0===f.z&&(f.x=.001),this._vertexData[S++]=f.x,this._vertexData[S++]=f.y,this._vertexData[S++]=f.z}this._useRampGradients&&Q.remapData&&(this._vertexData[S++]=Q.remapData.x,this._vertexData[S++]=Q.remapData.y,this._vertexData[S++]=Q.remapData.z,this._vertexData[S++]=Q.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===H?H=this._epsilon:1===H&&(H=1-this._epsilon),0===i?i=this._epsilon:1===i&&(i=1-this._epsilon)),this._vertexData[S++]=H,this._vertexData[S++]=i)}_prepareParticle(f){}_update(f){if(this._alive=this.Dj.length>0,this.k.position){const f=this.k;this._emitterWorldMatrix=f.getWorldMatrix()}else{const f=this.k;this._emitterWorldMatrix=X.e.Translation(f.x,f.y,f.z)}let Q;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Dj);for(let H=0;H<f&&this.Dj.length!==this._capacity;H++){if(Q=this._createParticle(),this.Dj.push(Q),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const f=(0,B.c)(this._actualFrame/this.targetStopDuration);w.GetCurrentGradient(f,this._lifeTimeGradients,((H,X)=>{const i=H,S=X,x=i.getFactor(),K=S.getFactor(),Z=(f-i.gradient)/(S.gradient-i.gradient);Q.lifeTime=(0,B.n)(x,K,Z)}))}else Q.lifeTime=(0,B.q)(this.minLifeTime,this.maxLifeTime);const f=(0,B.q)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,Q.position,Q,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,Q.position,Q,this.isLocal),this.isLocal&&(Q.xg?Q.xg.p(Q.position):Q.xg=Q.position.clone(),X.p.TransformCoordinatesToRef(Q.xg,this._emitterWorldMatrix,Q.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,Q.direction,Q,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,Q.direction,Q,this.isLocal,this._emitterInverseWorldMatrix),0===f?Q._initialDirection?Q._initialDirection.p(Q.direction):Q._initialDirection=Q.direction.clone():Q._initialDirection=null,Q.direction.scaleInPlace(f),this._sizeGradients&&0!==this._sizeGradients.length?(Q._currentSizeGradient=this._sizeGradients[0],Q._currentSize1=Q._currentSizeGradient.getFactor(),Q.size=Q._currentSize1,this._sizeGradients.length>1?Q._currentSize2=this._sizeGradients[1].getFactor():Q._currentSize2=Q._currentSize1):Q.size=(0,B.q)(this.minSize,this.maxSize),Q.scale.Xd((0,B.q)(this.minScaleX,this.maxScaleX),(0,B.q)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const f=this._actualFrame/this.targetStopDuration;w.GetCurrentGradient(f,this._startSizeGradients,((f,H,X)=>{f!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=H.getFactor(),this._currentStartSizeGradient=f);const i=(0,B.n)(this._currentStartSize1,this._currentStartSize2,X);Q.scale.scaleInPlace(i)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(Q._currentAngularSpeedGradient=this._angularSpeedGradients[0],Q.angularSpeed=Q._currentAngularSpeedGradient.getFactor(),Q._currentAngularSpeed1=Q.angularSpeed,this._angularSpeedGradients.length>1?Q._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():Q._currentAngularSpeed2=Q._currentAngularSpeed1):Q.angularSpeed=(0,B.q)(this.minAngularSpeed,this.maxAngularSpeed),Q.angle=(0,B.q)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(Q._currentVelocityGradient=this._velocityGradients[0],Q._currentVelocity1=Q._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?Q._currentVelocity2=this._velocityGradients[1].getFactor():Q._currentVelocity2=Q._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(Q._currentLimitVelocityGradient=this._limitVelocityGradients[0],Q._currentLimitVelocity1=Q._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?Q._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():Q._currentLimitVelocity2=Q._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(Q._currentDragGradient=this._dragGradients[0],Q._currentDrag1=Q._currentDragGradient.getFactor(),this._dragGradients.length>1?Q._currentDrag2=this._dragGradients[1].getFactor():Q._currentDrag2=Q._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)Q._currentColorGradient=this._colorGradients[0],Q._currentColorGradient.getColorToRef(Q.color),Q._currentColor1.p(Q.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(Q._currentColor2):Q._currentColor2.p(Q.color);else{const f=(0,B.q)(0,1);x.h.LerpToRef(this.color1,this.color2,f,Q.color),this.colorDead.subtractToRef(Q.color,this._colorDiff),this._colorDiff.scaleToRef(1/Q.lifeTime,Q.colorStep)}this._isAnimationSheetEnabled&&(Q._initialStartSpriteCellID=this.startSpriteCellID,Q._initialEndSpriteCellID=this.endSpriteCellID,Q._initialSpriteCellLoop=this.spriteCellLoop),Q.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(Q.remapData=new X.s(0,1,0,1)),this.noiseTexture&&(Q._randomNoiseCoordinates1?(Q._randomNoiseCoordinates1.Xd(Math.random(),Math.random(),Math.random()),Q._randomNoiseCoordinates2.Xd(Math.random(),Math.random(),Math.random())):(Q._randomNoiseCoordinates1=new X.p(Math.random(),Math.random(),Math.random()),Q._randomNoiseCoordinates2=new X.p(Math.random(),Math.random(),Math.random()))),Q._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X=[l.e.PositionKind,l.e.ColorKind,"angle","offset","size"];return f&&X.push("cellIndex"),Q||X.push("direction"),H&&X.push("remapData"),X}static _GetEffectCreationOptions(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Qf.b)(X),f&&X.push("particlesInfos"),Q&&X.push("logarithmicDepthConstant"),H&&(X.push("vFogInfos"),X.push("vFogColor")),X}fillDefines(f,Q){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Qf.n)(this,this._scene,f),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&f.push("#define FOG")),this._isAnimationSheetEnabled&&f.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&f.push("#define LOGARITHMICDEPTH"),Q===Z.BLENDMODE_MULTIPLY&&f.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&f.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(f.push("#define BILLBOARD"),this.billboardMode){case 2:f.push("#define BILLBOARDY");break;case 8:case 9:f.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&f.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:f.push("#define BILLBOARDMODE_ALL")}H&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),f.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(f,Q,H){Q.push(...Sf._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),f.push(...Sf._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),H.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Xf.f)(f,this._imageProcessingConfigurationDefines),(0,Xf.b)(H,this._imageProcessingConfigurationDefines))}_getWrapper(f){const Q=this._getCustomDrawWrapper(f);if(null!==Q&&void 0!==Q&&Q.effect)return Q;const H=[];this.fillDefines(H,f);const X=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let i=this._drawWrappers[X];i||(i=this._drawWrappers[X]=[]);let S=i[f];S||(S=new ff.b(this._engine),S.drawContext&&(S.drawContext.useInstancing=this._useInstancing),i[f]=S);const x=H.join("\n");if(S.defines!==x){const f=[],Q=[],H=[];this.fillUniformsAttributesAndSamplerNames(Q,f,H),S.setEffect(this._engine.createEffect("particles",f,Q,H,x,void 0,void 0,void 0,void 0,this._shaderLanguage),x)}return S}animate(){var f;let Q,H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!H&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(H?this.preWarmStepOffset:(null===(f=this._scene)||void 0===f?void 0:f.getAnimationRatio())||1),this.manualEmitCount>-1)Q=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let f=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const Q=this._actualFrame/this.targetStopDuration;w.GetCurrentGradient(Q,this._emitRateGradients,((Q,H,X)=>{Q!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=H.getFactor(),this._currentEmitRateGradient=Q),f=(0,B.n)(this._currentEmitRate1,this._currentEmitRate2,X)}))}Q=f*this._scaledUpdateSpeed|0,this._newPartsExcess+=f*this._scaledUpdateSpeed-Q}if(this._newPartsExcess>1&&(Q+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?Q=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(Q),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!H){let f=0;for(let Q=0;Q<this.Dj.length;Q++){const H=this.Dj[Q];this._appendParticleVertices(f,H),f+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Dj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(f,Q){this._appendParticleVertex(f++,Q,0,0),this._useInstancing||(this._appendParticleVertex(f++,Q,1,0),this._appendParticleVertex(f++,Q,1,1),this._appendParticleVertex(f++,Q,0,1))}rebuild(){var f;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(f=this._spriteBuffer)||void 0===f||f._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Sf.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(H.bind(H,11481)),Promise.resolve().then(H.bind(H,11477))])):await Promise.all([Promise.resolve().then(H.bind(H,11472)),Promise.resolve().then(H.bind(H,11467))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==Z.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Z.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Z.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(f){const Q=this._getWrapper(f),H=Q.effect,i=this._engine;i.enableEffect(Q);const S=this.defaultViewMatrix??this._scene.getViewMatrix();if(H.setTexture("diffuseSampler",this.particleTexture),H.setMatrix("view",S),H.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const f=this.particleTexture.getBaseSize();H.setFloat3("particlesInfos",this.spriteCellWidth/f.width,this.spriteCellHeight/f.height,this.spriteCellWidth/f.width)}if(H.setVector2("translationPivot",this.translationPivot),H.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const f=this._scene.activeCamera;H.setVector3("eyePosition",f.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),H.setTexture("rampSampler",this._rampGradientsTexture));const x=H.defines;var K,B,N,J,g,z;(this._scene&&((0,Qf.f)(H,this,this._scene),this.applyFog&&(0,Hf.h)(this._scene,void 0,H)),x.indexOf("#define BILLBOARDMODE_ALL")>=0&&(S.invertToRef(X.l.Matrix[0]),H.setMatrix("invView",X.l.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?i.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,H):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,H)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?i.bindBuffers(this._vertexBuffers,null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?this._linesIndexBuffer:this._indexBuffer,H):i.bindBuffers(this._vertexBuffers,null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?this._linesIndexBufferUseInstancing:null,H);switch(this.useLogarithmicDepth&&this._scene&&(0,Hf.m)(x,H,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(H),f){case Z.BLENDMODE_ADD:i.setAlphaMode(1);break;case Z.BLENDMODE_ONEONE:i.setAlphaMode(6);break;case Z.BLENDMODE_STANDARD:i.setAlphaMode(2);break;case Z.BLENDMODE_MULTIPLY:i.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(H),this._useInstancing)?null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?i.drawElementsType(6,0,10,this.Dj.length):i.drawArraysType(7,0,4,this.Dj.length):null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?i.drawElementsType(1,0,10*this.Dj.length):i.drawElementsType(0,0,6*this.Dj.length);return this.Dj.length}render(){if(!this.isReady()||!this.Dj.length)return 0;const f=this._engine;f.setState&&(f.setState(!1),this.forceDepthWrite&&f.setDepthWrite(!0));let Q=0;return Q=this.blendMode===Z.BLENDMODE_MULTIPLYADD?this._render(Z.BLENDMODE_MULTIPLY)+this._render(Z.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),Q}_onDispose(){}dispose(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),f&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),f&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(Q,H),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const f=this._scene.pe.indexOf(this);f>-1&&this._scene.pe.splice(f,1),this._scene._activeParticleSystems.dispose()}this.fe.notifyObservers(this),this.fe.clear(),this.onStoppedObservable.clear(),this.reset()}}Sf.ForceGLSL=!1;var xf,Kf=H(1082);!function(f){f[f.ATTACHED=0]="ATTACHED",f[f.END=1]="END"}(xf||(xf={}));class Zf{constructor(f){if(this.particleSystem=f,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!f.k||!f.k.dispose){const Q=(0,K.e)("BABYLON.AbstractMesh");f.k=new Q("SubemitterSystemEmitter",f.va()),f._disposeEmitterOnDispose=!0}}clone(){let f=this.particleSystem.k;if(f){if(f instanceof X.p)f=f.clone();else if(-1!==f.getClassName().indexOf("Mesh")){f=new((0,K.e)("BABYLON.Mesh"))("",f.va()),f.isVisible=!1}}else f=new X.p;const Q=new Zf(this.particleSystem.clone(this.particleSystem.name,f));return Q.particleSystem.name+="Clone",Q.type=this.type,Q.inheritDirection=this.inheritDirection,Q.inheritedVelocityAmount=this.inheritedVelocityAmount,Q.particleSystem._disposeEmitterOnDispose=!0,Q.particleSystem.disposeOnStop=!0,Q}serialize(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Q={};return Q.type=this.type,Q.inheritDirection=this.inheritDirection,Q.inheritedVelocityAmount=this.inheritedVelocityAmount,Q.particleSystem=this.particleSystem.serialize(f),Q}static _ParseParticleSystem(f,Q,H){throw(0,Kf.c)("ParseParticle")}static Parse(f,Q,H){const X=f.particleSystem,i=new Zf(Zf._ParseParticleSystem(X,Q,H,!0));return i.type=f.type,i.inheritDirection=f.inheritDirection,i.inheritedVelocityAmount=f.inheritedVelocityAmount,i.particleSystem._isSubEmitter=!0,i}dispose(){this.particleSystem.dispose()}}var Bf=H(1102);function Nf(f,Q){const H=new n;return H.direction1=f,H.direction2=Q,H}function Jf(){return new O(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function gf(){return new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function zf(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new X.p(0,1,0),H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.p(0,1,0);return new G(f,Q,H)}function vf(){return new v(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Yf(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.p(0,1,0),S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new X.p(0,1,0);return new Y(f,Q,H,i,S)}function Of(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new g(f,Q)}function nf(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.p(0,1,0),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.p(0,1,0);return new z(f,Q,H,i)}class ef extends Sf{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=f=>{if(!this._subEmitters||0===this._subEmitters.length)return;const Q=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[Q].forEach((Q=>{if(1===Q.type){const H=Q.clone();f._inheritParticleInfoToSubEmitter(H),H.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(H.particleSystem),H.particleSystem.start()}}))}}createPointEmitter(f,Q){const H=Nf(f,Q);return this.particleEmitterType=H,H}createHemisphericEmitter(){const f=Jf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=f,f}createSphereEmitter(){const f=gf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=f,f}createDirectedSphereEmitter(){const f=zf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new X.p(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.p(0,1,0));return this.particleEmitterType=f,f}createCylinderEmitter(){const f=vf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=f,f}createDirectedCylinderEmitter(){const f=Yf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.p(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new X.p(0,1,0));return this.particleEmitterType=f,f}createConeEmitter(){const f=Of(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=f,f}createDirectedConeEmitter(){const f=nf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.p(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.p(0,1,0));return this.particleEmitterType=f,f}createBoxEmitter(f,Q,H,X){const i=new J;return this.particleEmitterType=i,this.direction1=f,this.direction2=Q,this.minEmitBox=H,this.maxEmitBox=X,i}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((f=>{f instanceof ef?this._subEmitters.push([new Zf(f)]):f instanceof Zf?this._subEmitters.push([f]):f instanceof Array&&this._subEmitters.push(f)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((f=>{f.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const f=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==f&&this._rootParticleSystem.activeSubSystems.splice(f,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(f){f&&this._stopSubEmitters()}_prepareParticle(f){if(this._subEmitters&&this._subEmitters.length>0){const Q=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];f._attachedSubEmitters=[],Q.forEach((Q=>{if(0===Q.type){const H=Q.clone();f._attachedSubEmitters.push(H),H.particleSystem.start()}}))}}_onDispose(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var H;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),f)&&(null===(H=this.particles)||void 0===H||H.forEach((f=>{if(f._attachedSubEmitters)for(let Q=f._attachedSubEmitters.length-1;Q>=0;Q-=1)f._attachedSubEmitters[Q].dispose()})));if(Q&&this.activeSubSystems)for(let X=this.activeSubSystems.length-1;X>=0;X-=1)this.activeSubSystems[X].dispose();if(this._subEmitters&&this._subEmitters.length){for(let f=0;f<this._subEmitters.length;f++)for(const Q of this._subEmitters[f])Q.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(f,Q,H,i){let S;S=H instanceof Bf.b?null:H;const Z=(0,K.e)("BABYLON.Texture");if(Z&&S&&(f.texture?Q.particleTexture=Z.Parse(f.texture,S,i):f.textureName&&(Q.particleTexture=new Z(i+f.textureName,S,!1,void 0===f.invertY||f.invertY),Q.particleTexture.name=f.textureName)),f.emitterId||0===f.emitterId||void 0!==f.k?f.emitterId&&S?Q.k=S.getLastMeshById(f.emitterId):Q.k=X.p.Zd(f.k):Q.k=X.p.Zero(),Q.isLocal=!!f.isLocal,void 0!==f.renderingGroupId&&(Q.renderingGroupId=f.renderingGroupId),void 0!==f.isBillboardBased&&(Q.isBillboardBased=f.isBillboardBased),void 0!==f.billboardMode&&(Q.billboardMode=f.billboardMode),void 0!==f.useLogarithmicDepth&&(Q.useLogarithmicDepth=f.useLogarithmicDepth),f.animations){for(let H=0;H<f.animations.length;H++){const X=f.animations[H],i=(0,K.e)("BABYLON.Animation");i&&Q.animations.push(i.Parse(X))}Q.beginAnimationOnStart=f.beginAnimationOnStart,Q.beginAnimationFrom=f.beginAnimationFrom,Q.beginAnimationTo=f.beginAnimationTo,Q.beginAnimationLoop=f.beginAnimationLoop}if(f.autoAnimate&&S&&S.beginAnimation(Q,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1),Q.startDelay=0|f.startDelay,Q.minAngularSpeed=f.minAngularSpeed,Q.maxAngularSpeed=f.maxAngularSpeed,Q.minSize=f.minSize,Q.maxSize=f.maxSize,f.minScaleX&&(Q.minScaleX=f.minScaleX,Q.maxScaleX=f.maxScaleX,Q.minScaleY=f.minScaleY,Q.maxScaleY=f.maxScaleY),void 0!==f.preWarmCycles&&(Q.preWarmCycles=f.preWarmCycles,Q.preWarmStepOffset=f.preWarmStepOffset),void 0!==f.minInitialRotation&&(Q.minInitialRotation=f.minInitialRotation,Q.maxInitialRotation=f.maxInitialRotation),Q.minLifeTime=f.minLifeTime,Q.maxLifeTime=f.maxLifeTime,Q.minEmitPower=f.minEmitPower,Q.maxEmitPower=f.maxEmitPower,Q.emitRate=f.emitRate,Q.gravity=X.p.Zd(f.gravity),f.noiseStrength&&(Q.noiseStrength=X.p.Zd(f.noiseStrength)),Q.color1=x.h.Zd(f.color1),Q.color2=x.h.Zd(f.color2),Q.colorDead=x.h.Zd(f.colorDead),Q.updateSpeed=f.updateSpeed,Q.targetStopDuration=f.targetStopDuration,Q.blendMode=f.blendMode,f.colorGradients)for(const X of f.colorGradients)Q.addColorGradient(X.gradient,x.h.Zd(X.color1),X.color2?x.h.Zd(X.color2):void 0);if(f.rampGradients){for(const H of f.rampGradients)Q.addRampGradient(H.gradient,x.e.Zd(H.color));Q.useRampGradients=f.useRampGradients}if(f.colorRemapGradients)for(const X of f.colorRemapGradients)Q.addColorRemapGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(f.alphaRemapGradients)for(const X of f.alphaRemapGradients)Q.addAlphaRemapGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(f.sizeGradients)for(const X of f.sizeGradients)Q.addSizeGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(f.angularSpeedGradients)for(const X of f.angularSpeedGradients)Q.addAngularSpeedGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(f.velocityGradients)for(const X of f.velocityGradients)Q.addVelocityGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(f.dragGradients)for(const X of f.dragGradients)Q.addDragGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(f.emitRateGradients)for(const X of f.emitRateGradients)Q.addEmitRateGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(f.startSizeGradients)for(const X of f.startSizeGradients)Q.addStartSizeGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(f.lifeTimeGradients)for(const X of f.lifeTimeGradients)Q.addLifeTimeGradient(X.gradient,void 0!==X.factor1?X.factor1:X.factor,X.factor2);if(f.limitVelocityGradients){for(const H of f.limitVelocityGradients)Q.addLimitVelocityGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);Q.limitVelocityDamping=f.limitVelocityDamping}if(f.noiseTexture&&S){const H=(0,K.e)("BABYLON.ProceduralTexture");Q.noiseTexture=H.Parse(f.noiseTexture,S,i)}let B;if(f.particleEmitterType){switch(f.particleEmitterType.type){case"SphereParticleEmitter":B=new e;break;case"SphereDirectedParticleEmitter":B=new G;break;case"ConeEmitter":case"ConeParticleEmitter":B=new g;break;case"ConeDirectedParticleEmitter":B=new z;break;case"CylinderParticleEmitter":B=new v;break;case"CylinderDirectedParticleEmitter":B=new Y;break;case"HemisphericParticleEmitter":B=new O;break;case"PointParticleEmitter":B=new n;break;case"MeshParticleEmitter":B=new q;break;case"CustomParticleEmitter":B=new I;break;default:B=new J}B.parse(f.particleEmitterType,S)}else B=new J,B.parse(f,S);Q.particleEmitterType=B,Q.startSpriteCellID=f.startSpriteCellID,Q.endSpriteCellID=f.endSpriteCellID,Q.spriteCellLoop=f.spriteCellLoop??!0,Q.spriteCellWidth=f.spriteCellWidth,Q.spriteCellHeight=f.spriteCellHeight,Q.spriteCellChangeSpeed=f.spriteCellChangeSpeed,Q.spriteRandomStartCell=f.spriteRandomStartCell,Q.disposeOnStop=f.disposeOnStop??!1,Q.manualEmitCount=f.manualEmitCount??-1}static Parse(f,Q,H){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],S=arguments.length>4?arguments[4]:void 0;const K=f.name;let Z,B,N=null,J=null;if(Q instanceof Bf.b?Z=Q:(B=Q,Z=B.getEngine()),f.customShader&&Z.createEffectForParticles){J=f.customShader;const Q=J.shaderOptions.defines.length>0?J.shaderOptions.defines.join("\n"):"";N=Z.createEffectForParticles(J.shaderPath.fragmentElement,J.shaderOptions.uniforms,J.shaderOptions.samplers,Q)}const g=new ef(K,S||f.Td,Q,N,f.isAnimationSheetEnabled);if(g.customShader=J,g._rootUrl=H,f.id&&(g.id=f.id),f.subEmitters){g.subEmitters=[];for(const X of f.subEmitters){const f=[];for(const i of X)f.push(Zf.Parse(i,Q,H));g.subEmitters.push(f)}}return ef._Parse(f,g,Q,H),f.textureMask&&(g.textureMask=x.h.Zd(f.textureMask)),f.tg&&(g.tg=X.p.Zd(f.tg)),f.preventAutoStart&&(g.preventAutoStart=f.preventAutoStart),i||g.preventAutoStart||g.start(),g}serialize(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Q={};if(ef._Serialize(Q,this,f),Q.textureMask=this.textureMask.ke(),Q.customShader=this.customShader,Q.preventAutoStart=this.preventAutoStart,Q.tg=this.tg.ke(),this.subEmitters){Q.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const H of this._subEmitters){const X=[];for(const Q of H)X.push(Q.serialize(f));Q.subEmitters.push(X)}}return Q}static _Serialize(f,Q,H){if(f.name=Q.name,f.id=Q.id,f.Td=Q.getCapacity(),f.disposeOnStop=Q.disposeOnStop,f.manualEmitCount=Q.manualEmitCount,Q.k.position){const H=Q.k;f.emitterId=H.id}else{const H=Q.k;f.k=H.ke()}Q.particleEmitterType&&(f.particleEmitterType=Q.particleEmitterType.serialize()),Q.particleTexture&&(H?f.texture=Q.particleTexture.serialize():(f.textureName=Q.particleTexture.name,f.invertY=!!Q.particleTexture._invertY)),f.isLocal=Q.isLocal,E.b.AppendSerializedAnimations(Q,f),f.beginAnimationOnStart=Q.beginAnimationOnStart,f.beginAnimationFrom=Q.beginAnimationFrom,f.beginAnimationTo=Q.beginAnimationTo,f.beginAnimationLoop=Q.beginAnimationLoop,f.startDelay=Q.startDelay,f.renderingGroupId=Q.renderingGroupId,f.isBillboardBased=Q.isBillboardBased,f.billboardMode=Q.billboardMode,f.minAngularSpeed=Q.minAngularSpeed,f.maxAngularSpeed=Q.maxAngularSpeed,f.minSize=Q.minSize,f.maxSize=Q.maxSize,f.minScaleX=Q.minScaleX,f.maxScaleX=Q.maxScaleX,f.minScaleY=Q.minScaleY,f.maxScaleY=Q.maxScaleY,f.minEmitPower=Q.minEmitPower,f.maxEmitPower=Q.maxEmitPower,f.minLifeTime=Q.minLifeTime,f.maxLifeTime=Q.maxLifeTime,f.emitRate=Q.emitRate,f.gravity=Q.gravity.ke(),f.noiseStrength=Q.noiseStrength.ke(),f.color1=Q.color1.ke(),f.color2=Q.color2.ke(),f.colorDead=Q.colorDead.ke(),f.updateSpeed=Q.updateSpeed,f.targetStopDuration=Q.targetStopDuration,f.blendMode=Q.blendMode,f.preWarmCycles=Q.preWarmCycles,f.preWarmStepOffset=Q.preWarmStepOffset,f.minInitialRotation=Q.minInitialRotation,f.maxInitialRotation=Q.maxInitialRotation,f.startSpriteCellID=Q.startSpriteCellID,f.spriteCellLoop=Q.spriteCellLoop,f.endSpriteCellID=Q.endSpriteCellID,f.spriteCellChangeSpeed=Q.spriteCellChangeSpeed,f.spriteCellWidth=Q.spriteCellWidth,f.spriteCellHeight=Q.spriteCellHeight,f.spriteRandomStartCell=Q.spriteRandomStartCell,f.isAnimationSheetEnabled=Q.isAnimationSheetEnabled,f.useLogarithmicDepth=Q.useLogarithmicDepth;const X=Q.getColorGradients();if(X){f.colorGradients=[];for(const Q of X){const H={gradient:Q.gradient,color1:Q.color1.ke()};Q.color2?H.color2=Q.color2.ke():H.color2=Q.color1.ke(),f.colorGradients.push(H)}}const i=Q.getRampGradients();if(i){f.rampGradients=[];for(const Q of i){const H={gradient:Q.gradient,color:Q.color.ke()};f.rampGradients.push(H)}f.useRampGradients=Q.useRampGradients}const S=Q.getColorRemapGradients();if(S){f.colorRemapGradients=[];for(const Q of S){const H={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?H.factor2=Q.factor2:H.factor2=Q.factor1,f.colorRemapGradients.push(H)}}const x=Q.getAlphaRemapGradients();if(x){f.alphaRemapGradients=[];for(const Q of x){const H={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?H.factor2=Q.factor2:H.factor2=Q.factor1,f.alphaRemapGradients.push(H)}}const K=Q.getSizeGradients();if(K){f.sizeGradients=[];for(const Q of K){const H={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?H.factor2=Q.factor2:H.factor2=Q.factor1,f.sizeGradients.push(H)}}const Z=Q.getAngularSpeedGradients();if(Z){f.angularSpeedGradients=[];for(const Q of Z){const H={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?H.factor2=Q.factor2:H.factor2=Q.factor1,f.angularSpeedGradients.push(H)}}const B=Q.getVelocityGradients();if(B){f.velocityGradients=[];for(const Q of B){const H={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?H.factor2=Q.factor2:H.factor2=Q.factor1,f.velocityGradients.push(H)}}const N=Q.getDragGradients();if(N){f.dragGradients=[];for(const Q of N){const H={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?H.factor2=Q.factor2:H.factor2=Q.factor1,f.dragGradients.push(H)}}const J=Q.getEmitRateGradients();if(J){f.emitRateGradients=[];for(const Q of J){const H={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?H.factor2=Q.factor2:H.factor2=Q.factor1,f.emitRateGradients.push(H)}}const g=Q.getStartSizeGradients();if(g){f.startSizeGradients=[];for(const Q of g){const H={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?H.factor2=Q.factor2:H.factor2=Q.factor1,f.startSizeGradients.push(H)}}const z=Q.getLifeTimeGradients();if(z){f.lifeTimeGradients=[];for(const Q of z){const H={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?H.factor2=Q.factor2:H.factor2=Q.factor1,f.lifeTimeGradients.push(H)}}const v=Q.getLimitVelocityGradients();if(v){f.limitVelocityGradients=[];for(const Q of v){const H={gradient:Q.gradient,factor1:Q.factor1};void 0!==Q.factor2?H.factor2=Q.factor2:H.factor2=Q.factor1,f.limitVelocityGradients.push(H)}f.limitVelocityDamping=Q.limitVelocityDamping}Q.noiseTexture&&(f.noiseTexture=Q.noiseTexture.serialize())}clone(f,Q){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X={...this._customWrappers};let i=null;const S=this._engine;if(S.createEffectForParticles&&null!=this.customShader){i=this.customShader;const f=i.shaderOptions.defines.length>0?i.shaderOptions.defines.join("\n"):"",Q=S.createEffectForParticles(i.shaderPath.fragmentElement,i.shaderOptions.uniforms,i.shaderOptions.samplers,f);X[0]?X[0].effect=Q:this.setCustomEffect(Q,0)}const x=this.serialize(H),K=ef.Parse(x,this._scene||this._engine,this._rootUrl);return K.name=f,K.customShader=i,K._customWrappers=X,void 0===Q&&(Q=this.k),this.noiseTexture&&(K.noiseTexture=this.noiseTexture.clone()),K.k=Q,this.preventAutoStart||K.start(),K}}ef.BILLBOARDMODE_Y=2,ef.BILLBOARDMODE_ALL=7,ef.BILLBOARDMODE_STRETCHED=8,ef.BILLBOARDMODE_STRETCHED_LOCAL=9,Zf._ParseParticleSystem=ef.Parse;var Gf=H(1223),If=H(1196),lf=H(1439);lf.d.prototype.createTransformFeedback=function(){const f=this._gl.createTransformFeedback();if(!f)throw new Error("Unable to create Transform Feedback");return f},lf.d.prototype.deleteTransformFeedback=function(f){this._gl.deleteTransformFeedback(f)},lf.d.prototype.bindTransformFeedback=function(f){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,f)},lf.d.prototype.beginTransformFeedback=function(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(f?this._gl.POINTS:this._gl.TRIANGLES)},lf.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},lf.d.prototype.setTranformFeedbackVaryings=function(f,Q){this._gl.transformFeedbackVaryings(f,Q,this._gl.INTERLEAVED_ATTRIBS)},lf.d.prototype.bindTransformFeedbackBuffer=function(f){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,f?f.underlyingResource:null)},lf.d.prototype.readTransformFeedbackBuffer=function(f){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,f)};const qf="clipPlaneFragmentDeclaration2",Df="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";s.d.IncludesShadersStore[qf]=Df;H(10824),H(10691),H(10611),H(10831),H(10847),H(10855),H(10888),H(10896);const df="gpuRenderParticlesPixelShader",sf="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";s.d.ShadersStore[df]=sf;const Ff="clipPlaneVertexDeclaration2",Pf="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";s.d.IncludesShadersStore[Ff]=Pf;H(10660),H(10747),H(10753),H(10777);const mf="gpuRenderParticlesVertexShader",cf="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";s.d.ShadersStore[mf]=cf;class Wf extends Z{static get IsSupported(){if(!p.e.LastCreatedEngine)return!1;const f=p.e.LastCreatedEngine.getCaps();return f.supportTransformFeedbacks||f.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(f){this._maxActiveParticleCount=Math.min(f,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(f){this.maxActiveParticleCount=f}createPointEmitter(f,Q){const H=Nf(f,Q);return this.particleEmitterType=H,H}createHemisphericEmitter(){const f=Jf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=f,f}createSphereEmitter(){const f=gf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=f,f}createDirectedSphereEmitter(){const f=zf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new X.p(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.p(0,1,0));return this.particleEmitterType=f,f}createCylinderEmitter(){const f=vf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=f,f}createDirectedCylinderEmitter(){const f=Yf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.p(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new X.p(0,1,0));return this.particleEmitterType=f,f}createConeEmitter(){const f=Of(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=f,f}createDirectedConeEmitter(){const f=nf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new X.p(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new X.p(0,1,0));return this.particleEmitterType=f,f}createBoxEmitter(f,Q,H,X){const i=new J;return this.particleEmitterType=i,this.direction1=f,this.direction2=Q,this.minEmitBox=H,this.maxEmitBox=X,i}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==ef.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(ef.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(ef.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";f?setTimeout((()=>{this.start(0)}),f):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var f;let Q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(f=this._customWrappers[Q])||void 0===f?void 0:f.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[f]??this._customWrappers[0]}setCustomEffect(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[Q]=new ff.b(this._engine),this._customWrappers[Q].effect=f}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new b.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(f,Q,H){return super._removeGradientAndTexture(f,Q,H),this._releaseBuffers(),this}addColorGradient(f,Q){this._colorGradients||(this._colorGradients=[]);const H=new k(f,Q);return this._colorGradients.push(H),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(f&&this._colorGradients.sort(((f,Q)=>f.gradient<Q.gradient?-1:f.gradient>Q.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(f){return this._removeGradientAndTexture(f,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const Q in this._drawWrappers){var f;null===(f=this._drawWrappers[Q].drawContext)||void 0===f||f.reset()}}_addFactorGradient(f,Q,H){const X=new h(Q,H);f.push(X),this._releaseBuffers()}addSizeGradient(f,Q){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,f,Q),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(f){return this._removeGradientAndTexture(f,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(f,Q){if(!f)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&f.sort(((f,Q)=>f.gradient<Q.gradient?-1:f.gradient>Q.gradient?1:0));const H=this;H[Q]&&(H[Q].dispose(),H[Q]=null)}addAngularSpeedGradient(f,Q){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,f,Q),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(f){return this._removeGradientAndTexture(f,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(f,Q){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,f,Q),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(f){return this._removeGradientAndTexture(f,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(f,Q){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,f,Q),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(f){return this._removeGradientAndTexture(f,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(f,Q){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,f,Q),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(f){return this._removeGradientAndTexture(f,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(f){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(f,Q,H){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,S=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(f),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.fe=new b.e,this.onStoppedObservable=new b.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,H&&"Scene"!==H.getClassName()?(this._engine=H,this.defaultProjectionMatrix=X.e.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=H||p.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.pe.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,K.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,K.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,K.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,K.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ff.b(this._engine)},this._customWrappers[0].effect=i,this._drawWrappers={0:new ff.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(Q=Q??{}).randomTextureSize||delete Q.randomTextureSize;const x={Td:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...Q},Z=Q;isFinite(Z)&&(x.Td=Z),this._capacity=x.Td,this._maxActiveParticleCount=x.Td,this._currentActiveCount=0,this._isAnimationSheetEnabled=S,this.particleEmitterType=new J;const B=Math.min(this._engine.getCaps().maxTextureSize,x.randomTextureSize);let N=[];for(let X=0;X<B;++X)N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),N.push(Math.random());this._randomTexture=new o.b(new Float32Array(N),B,1,5,H,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,N=[];for(let X=0;X<B;++X)N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),N.push(Math.random());this._randomTexture2=new o.b(new Float32Array(N),B,1,5,H,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=B}_reset(){this._releaseBuffers()}_createVertexBuffers(f,Q,H){const X={};X.position=Q.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let i=3;X.age=Q.createVertexBuffer("age",i,1,this._attributesStrideSize,!0),i+=1,X.size=Q.createVertexBuffer("size",i,3,this._attributesStrideSize,!0),i+=3,X.life=Q.createVertexBuffer("life",i,1,this._attributesStrideSize,!0),i+=1,i+=4,this.billboardMode===ef.BILLBOARDMODE_STRETCHED&&(X.direction=Q.createVertexBuffer("direction",i,3,this._attributesStrideSize,!0)),i+=3,this._platform.alignDataInBuffer&&(i+=1),this.particleEmitterType instanceof I&&(i+=3,this._platform.alignDataInBuffer&&(i+=1)),this._colorGradientsTexture||(X.color=Q.createVertexBuffer("color",i,4,this._attributesStrideSize,!0),i+=4),this._isBillboardBased||(X.initialDirection=Q.createVertexBuffer("initialDirection",i,3,this._attributesStrideSize,!0),i+=3,this._platform.alignDataInBuffer&&(i+=1)),this.noiseTexture&&(X.noiseCoordinates1=Q.createVertexBuffer("noiseCoordinates1",i,3,this._attributesStrideSize,!0),i+=3,this._platform.alignDataInBuffer&&(i+=1),X.noiseCoordinates2=Q.createVertexBuffer("noiseCoordinates2",i,3,this._attributesStrideSize,!0),i+=3,this._platform.alignDataInBuffer&&(i+=1)),X.angle=Q.createVertexBuffer("angle",i,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?i++:i+=2,this._isAnimationSheetEnabled&&(X.cellIndex=Q.createVertexBuffer("cellIndex",i,1,this._attributesStrideSize,!0),i+=1,this.spriteRandomStartCell&&(X.cellStartOffset=Q.createVertexBuffer("cellStartOffset",i,1,this._attributesStrideSize,!0),i+=1)),X.offset=H.createVertexBuffer("offset",0,2),X.uv=H.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(X),this._platform.createVertexBuffers(f,X),this.resetDrawCache()}_initialize(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!f)return;const Q=this._engine,H=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof I&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const i=this.particleEmitterType instanceof I,S=X.l.Wd[0];let x=0;for(let X=0;X<this._capacity;X++)if(H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),i?(this.particleEmitterType.particleDestinationGenerator(X,null,S),H.push(S.x),H.push(S.y),H.push(S.z)):(H.push(0),H.push(0),H.push(0)),this._platform.alignDataInBuffer&&H.push(0),x+=16,i&&(this.particleEmitterType.particlePositionGenerator(X,null,S),H.push(S.x),H.push(S.y),H.push(S.z),this._platform.alignDataInBuffer&&H.push(0),x+=4),this._colorGradientsTexture||(H.push(0),H.push(0),H.push(0),H.push(0),x+=4),this.isBillboardBased||(H.push(0),H.push(0),H.push(0),this._platform.alignDataInBuffer&&H.push(0),x+=4),this.noiseTexture&&(H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),this._platform.alignDataInBuffer&&H.push(0),H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),this._platform.alignDataInBuffer&&H.push(0),x+=8),H.push(0),x+=1,this._angularSpeedGradientsTexture||(H.push(0),x+=1),this._isAnimationSheetEnabled&&(H.push(0),x+=1,this.spriteRandomStartCell&&(H.push(0),x+=1)),this._platform.alignDataInBuffer){let f=3-(x+3&3);for(x+=f;f-- >0;)H.push(0)}const K=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),Z=this._platform.createParticleBuffer(H),B=this._platform.createParticleBuffer(H);this._buffer0=new l.d(Q,Z,!1,this._attributesStrideSize),this._buffer1=new l.d(Q,B,!1,this._attributesStrideSize),this._spriteBuffer=new l.d(Q,K,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let f=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(f+="\n#define BILLBOARD"),this._colorGradientsTexture&&(f+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(f+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(f+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(f+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(f+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(f+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(f+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(f+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(f+="\n#define NOISE"),this.isLocal&&(f+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===f||(this._cachedUpdateDefines=f,this._updateBuffer=this._platform.createUpdateBuffer(f)),this._platform.isUpdateBufferReady()}_getWrapper(f){const Q=this._getCustomDrawWrapper(f);if(null!==Q&&void 0!==Q&&Q.effect)return Q;const H=[];this.fillDefines(H,f);let X=this._drawWrappers[f];X||(X=new ff.b(this._engine),X.drawContext&&(X.drawContext.useInstancing=!0),this._drawWrappers[f]=X);const i=H.join("\n");if(X.defines!==i){const f=[],Q=[],H=[];this.fillUniformsAttributesAndSamplerNames(Q,f,H),X.setEffect(this._engine.createEffect("gpuRenderParticles",f,Q,H,i),i)}return X}static _GetAttributeNamesOrOptions(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=[l.e.PositionKind,"age","life","size","angle"];return f||i.push(l.e.ColorKind),Q&&i.push("cellIndex"),H||i.push("initialDirection"),X&&i.push("direction"),i.push("offset",l.e.UVKind),i}static _GetEffectCreationOptions(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X=["emitterWM","tg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Qf.b)(X),f&&X.push("sheetInfos"),Q&&X.push("logarithmicDepthConstant"),H&&(X.push("vFogInfos"),X.push("vFogColor")),X}fillDefines(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Qf.n)(this,this._scene,f),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==If.e.FOGMODE_NONE&&f.push("#define FOG")),Q===ef.BLENDMODE_MULTIPLY&&f.push("#define BLENDMULTIPLYMODE"),this.isLocal&&f.push("#define LOCAL"),this.useLogarithmicDepth&&f.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(f.push("#define BILLBOARD"),this.billboardMode){case ef.BILLBOARDMODE_Y:f.push("#define BILLBOARDY");break;case ef.BILLBOARDMODE_STRETCHED:f.push("#define BILLBOARDSTRETCHED");break;case ef.BILLBOARDMODE_ALL:f.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&f.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&f.push("#define ANIMATESHEET"),H&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),f.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(f,Q,H){Q.push(...Wf._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===ef.BILLBOARDMODE_STRETCHED)),f.push(...Wf._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),H.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Gf.e.PrepareUniforms(f,this._imageProcessingConfigurationDefines),Gf.e.PrepareSamplers(H,this._imageProcessingConfigurationDefines))}animate(){var f;let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(Q?this.preWarmStepOffset:(null===(f=this._scene)||void 0===f?void 0:f.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(f,Q){const H=this[Q];if(!f||!f.length||H)return;const X=new Float32Array(this._rawTextureWidth);for(let i=0;i<this._rawTextureWidth;i++){const Q=i/this._rawTextureWidth;w.GetCurrentGradient(Q,f,((f,Q,H)=>{X[i]=(0,B.n)(f.factor1,Q.factor1,H)}))}this[Q]=o.b.CreateRTexture(X,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[Q].name=Q.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const f=new Uint8Array(4*this._rawTextureWidth),Q=x.k.Ge[0];for(let H=0;H<this._rawTextureWidth;H++){const X=H/this._rawTextureWidth;w.GetCurrentGradient(X,this._colorGradients,((X,i,S)=>{x.h.LerpToRef(X.color1,i.color1,S,Q),f[4*H]=255*Q.r,f[4*H+1]=255*Q.g,f[4*H+2]=255*Q.b,f[4*H+3]=255*Q.a}))}this._colorGradientsTexture=o.b.CreateRGBATexture(f,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(f,Q){var H,i,S,x;const K=this._getWrapper(f),Z=K.effect;this._engine.enableEffect(K);const B=(null===(H=this._scene)||void 0===H?void 0:H.getViewMatrix())||X.e.IdentityReadOnly;if(Z.setMatrix("view",B),Z.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),Z.setTexture("diffuseSampler",this.particleTexture),Z.setVector2("translationPivot",this.translationPivot),Z.setVector3("tg",this.tg),this.isLocal&&Z.setMatrix("emitterWM",Q),this._colorGradientsTexture?Z.setTexture("colorGradientSampler",this._colorGradientsTexture):Z.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const f=this.particleTexture.getBaseSize();Z.setFloat3("sheetInfos",this.spriteCellWidth/f.width,this.spriteCellHeight/f.height,f.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const f=this._scene.activeCamera;Z.setVector3("eyePosition",f.globalPosition)}const N=Z.defines;if(this._scene&&((0,Qf.f)(Z,this,this._scene),this.applyFog&&(0,Hf.h)(this._scene,void 0,Z)),N.indexOf("#define BILLBOARDMODE_ALL")>=0){const f=B.clone();f.invert(),Z.setMatrix("invView",f)}switch(this.useLogarithmicDepth&&this._scene&&(0,Hf.m)(N,Z,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(Z),f){case ef.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case ef.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case ef.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case ef.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,Z,null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(Z),null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(x=this._scene)&&void 0!==x&&x.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(f){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!f)if(this.k.position){f=this.k.getWorldMatrix()}else{const Q=this.k;f=X.l.Matrix[0],X.e.TranslationToRef(Q.x,Q.y,Q.z,f)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",f),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const Q=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=Q}render(){let f,Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!Q&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let f=0;f<this.preWarmCycles;f++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const f=0|this._accumulatedCount;this._accumulatedCount-=f,this._currentActiveCount+=f}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){f=this.k.getWorldMatrix()}else{const Q=this.k;f=X.l.Matrix[0],X.e.TranslationToRef(Q.x,Q.y,Q.z,f)}const i=this._engine;this.updateInAnimate||this._update(f);let S=0;return Q||H||(i.setState(!1),this.forceDepthWrite&&i.setDepthWrite(!0),S=this.blendMode===ef.BLENDMODE_MULTIPLYADD?this._render(ef.BLENDMODE_MULTIPLY,f)+this._render(ef.BLENDMODE_ADD,f):this._render(this.blendMode,f),this._engine.setAlphaMode(0)),S}rebuild(){const f=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(f,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,f()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const Q in this._drawWrappers){this._drawWrappers[Q].dispose()}if(this._drawWrappers={},this._scene){const f=this._scene.pe.indexOf(this);f>-1&&this._scene.pe.splice(f,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let Q=0;Q<this._renderVertexBuffers.length;++Q){const f=this._renderVertexBuffers[Q];for(const Q in f)f[Q].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),f&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),f&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.fe.notifyObservers(this),this.fe.clear()}clone(f,Q){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const X={...this._customWrappers};let i=null;const S=this._engine;if(S.createEffectForParticles&&null!=this.customShader){i=this.customShader;const f=i.shaderOptions.defines.length>0?i.shaderOptions.defines.join("\n"):"";X[0]=S.createEffectForParticles(i.shaderPath.fragmentElement,i.shaderOptions.uniforms,i.shaderOptions.samplers,f,void 0,void 0,void 0,this)}const x=this.serialize(H),K=Wf.Parse(x,this._scene||this._engine,this._rootUrl);return K.name=f,K.customShader=i,K._customWrappers=X,void 0===Q&&(Q=this.k),this.noiseTexture&&(K.noiseTexture=this.noiseTexture.clone()),K.k=Q,K}serialize(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Q={};return ef._Serialize(Q,this,f),Q.activeParticleCount=this.activeParticleCount,Q.randomTextureSize=this._randomTextureSize,Q.customShader=this.customShader,Q}static Parse(f,Q,H){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0;const S=f.name;let x,K;Q instanceof Bf.b?x=Q:(K=Q,x=K.getEngine());const Z=new Wf(S,{Td:i||f.Td,randomTextureSize:f.randomTextureSize},Q,null,f.isAnimationSheetEnabled);if(Z._rootUrl=H,f.customShader&&x.createEffectForParticles){const Q=f.customShader,H=Q.shaderOptions.defines.length>0?Q.shaderOptions.defines.join("\n"):"",X=x.createEffectForParticles(Q.shaderPath.fragmentElement,Q.shaderOptions.uniforms,Q.shaderOptions.samplers,H,void 0,void 0,void 0,Z);Z.setCustomEffect(X,0),Z.customShader=Q}return f.id&&(Z.id=f.id),f.activeParticleCount&&(Z.activeParticleCount=f.activeParticleCount),ef._Parse(f,Z,Q,H),f.preventAutoStart&&(Z.preventAutoStart=f.preventAutoStart),X||Z.preventAutoStart||Z.start(),Z}}var Rf=H(1203),Uf=H(11445),Ef=H(1187);class tf{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(f){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const Q of this.systems)Q.k=f;this._emitterNode=f}setEmitterAsSphere(f,Q,H){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:f,renderingGroupId:Q};const X=(0,Uf.d)("emitterSphere",{diameter:f.diameter,segments:f.segments},H);X.renderingGroupId=Q;const i=new Ef.d("emitterSphereMaterial",H);i.emissiveColor=f.color,X.material=i;for(const S of this.systems)S.k=X;this._emitterNode=X}start(f){for(const Q of this.systems)f&&(Q.k=f),Q.start()}dispose(){for(const f of this.systems)f.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const Q={systems:[]};for(const H of this.systems)Q.systems.push(H.serialize(f));return this._emitterNode&&(Q.k=this._emitterCreationOptions),Q}static Parse(f,Q){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3?arguments[3]:void 0;const i=new tf,S=this.BaseAssetsUrl+"/textures/";Q=Q||p.e.LastCreatedScene;for(const x of f.systems)i.systems.push(H?Wf.Parse(x,Q,S,!0,X):ef.Parse(x,Q,S,!0,X));if(f.k){const H=f.k.options;if("Sphere"===f.k.kind)i.setEmitterAsSphere({diameter:H.diameter,segments:H.segments,color:x.e.Zd(H.color)},f.k.renderingGroupId,Q)}return i}}tf.BaseAssetsUrl="https://assets.babylonjs.com/particles";var uf=H(1055);class Lf{static CreateDefault(f){let Q,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,X=arguments.length>2?arguments[2]:void 0;return Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Wf("default system",{Td:H},X):new ef("default system",H,X),Q.k=f,Q.particleTexture=new t.b("https://assets.babylonjs.com/textures/flare.png",Q.va()),Q.createConeEmitter(.1,Math.PI/4),Q.color1=new x.h(1,1,1,1),Q.color2=new x.h(1,1,1,1),Q.colorDead=new x.h(1,1,1,0),Q.minSize=.1,Q.maxSize=.1,Q.minEmitPower=2,Q.maxEmitPower=2,Q.updateSpeed=1/60,Q.emitRate=30,Q}static CreateAsync(f,Q){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3?arguments[3]:void 0;Q||(Q=p.e.LastCreatedScene);const i={};return Q.addPendingData(i),new Promise(((S,x)=>{if(H&&!Wf.IsSupported)return Q.removePendingData(i),x("Particle system with GPU is not supported.");Rf.g.LoadFile(`${Lf.BaseAssetsUrl}/systems/${f}.json`,(f=>{Q.removePendingData(i);const x=JSON.parse(f.toString());return S(tf.Parse(x,Q,H,X))}),void 0,void 0,void 0,(()=>(Q.removePendingData(i),x(`An error occurred with the creation of your particle system. Check if your type '${f}' exists.`))))}))}static ExportSet(f){const Q=new tf;for(const H of f)Q.systems.push(H);return Q}static ParseFromFileAsync(f,Q,H){let X=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",S=arguments.length>5?arguments[5]:void 0;return new Promise(((x,K)=>{const Z=new uf.d;Z.addEventListener("readystatechange",(()=>{if(4==Z.readyState)if(200==Z.status){const Q=JSON.parse(Z.responseText);let K;K=X?Wf.Parse(Q,H,i,!1,S):ef.Parse(Q,H,i,!1,S),f&&(K.name=f),x(K)}else K("Unable to load the particle system")})),Z.open("GET",Q),Z.send()}))}static ParseFromSnippetAsync(f,Q){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0;if("_BLANK"===f){const f=this.CreateDefault(null);return f.start(),Promise.resolve(f)}return new Promise(((S,x)=>{const K=new uf.d;K.addEventListener("readystatechange",(()=>{if(4==K.readyState)if(200==K.status){const x=JSON.parse(JSON.parse(K.responseText).jsonPayload),Z=JSON.parse(x.particleSystem);let B;B=H?Wf.Parse(Z,Q,X,!1,i):ef.Parse(Z,Q,X,!1,i),B.snippetId=f,S(B)}else x("Unable to load the snippet "+f)})),K.open("GET",this.SnippetUrl+"/"+f.replace(/#/g,"/")),K.send()}))}}Lf.BaseAssetsUrl=tf.BaseAssetsUrl,Lf.SnippetUrl="https://snippet.babylonjs.com",Lf.CreateFromSnippetAsync=Lf.ParseFromSnippetAsync;var Af=H(11301),af=H(1281),Vf=H(11450);(0,Vf.d)(af.e.NAME_PARTICLESYSTEM,((f,Q,H,X)=>{const i=(0,Vf.h)(af.e.NAME_PARTICLESYSTEM);if(i&&void 0!==f.pe&&null!==f.pe)for(let S=0,x=f.pe.length;S<x;S++){const x=f.pe[S];H.pe.push(i(x,Q,X))}})),(0,Vf.b)(af.e.NAME_PARTICLESYSTEM,((f,Q,H)=>{if(f.activeParticleCount){return Wf.Parse(f,Q,H)}return ef.Parse(f,Q,H)})),Bf.b.prototype.createEffectForParticles=function(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],X=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",S=arguments.length>4?arguments[4]:void 0,x=arguments.length>5?arguments[5]:void 0,K=arguments.length>6?arguments[6]:void 0,Z=arguments.length>7?arguments[7]:void 0,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,N=[],J=[];const g=[];return Z?Z.fillUniformsAttributesAndSamplerNames(J,N,g):(N=ef._GetAttributeNamesOrOptions(),J=ef._GetEffectCreationOptions()),-1===i.indexOf(" BILLBOARD")&&(i+="\n#define BILLBOARD\n"),null!==Z&&void 0!==Z&&Z.isAnimationSheetEnabled&&-1===i.indexOf(" ANIMATESHEET")&&(i+="\n#define ANIMATESHEET\n"),-1===X.indexOf("diffuseSampler")&&X.push("diffuseSampler"),this.createEffect({vertex:(null===Z||void 0===Z?void 0:Z.vertexShaderName)??"particles",fragmentElement:f},N,J.concat(Q),g.concat(X),i,S,x,K,void 0,B,(async()=>{0===B?await Promise.resolve().then(H.bind(H,11472)):await Promise.resolve().then(H.bind(H,11481))}))},Af.b.prototype.getEmittedParticleSystems=function(){const f=[];for(let Q=0;Q<this.va().pe.length;Q++){const H=this.va().pe[Q];H.k===this&&f.push(H)}return f},Af.b.prototype.getHierarchyEmittedParticleSystems=function(){const f=[],Q=this.getDescendants();Q.push(this);for(let H=0;H<this.va().pe.length;H++){const X=this.va().pe[H],i=X.k;i.position&&-1!==Q.indexOf(i)&&f.push(X)}return f};H(1362),H(1373),H(11337);H(11322),H(11459),H(1495),H(1355),H(11349);H(1492);var Mf;H(11462),H(1036);!function(f){f[f.Color=2]="Color",f[f.UV=1]="UV",f[f.Random=0]="Random",f[f.Stated=3]="Stated"}(Mf||(Mf={}));H(11467),H(11472),H(11477),H(11481)},10550:(f,Q,H)=>{"use strict";const X="clipPlaneFragment",i="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";H(1115).d.IncludesShadersStoreWGSL[X]=i},10539:(f,Q,H)=>{"use strict";const X="clipPlaneFragmentDeclaration",i="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";H(1115).d.IncludesShadersStoreWGSL[X]=i},10453:(f,Q,H)=>{"use strict";const X="clipPlaneVertex",i="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";H(1115).d.IncludesShadersStoreWGSL[X]=i},10366:(f,Q,H)=>{"use strict";const X="clipPlaneVertexDeclaration",i="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";H(1115).d.IncludesShadersStoreWGSL[X]=i},10571:(f,Q,H)=>{"use strict";const X="fogFragment",i="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";H(1115).d.IncludesShadersStoreWGSL[X]=i},10543:(f,Q,H)=>{"use strict";const X="fogFragmentDeclaration",i="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";H(1115).d.IncludesShadersStoreWGSL[X]=i},10458:(f,Q,H)=>{"use strict";const X="fogVertex",i="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";H(1115).d.IncludesShadersStoreWGSL[X]=i},10369:(f,Q,H)=>{"use strict";const X="fogVertexDeclaration",i="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";H(1115).d.IncludesShadersStoreWGSL[X]=i},10326:(f,Q,H)=>{"use strict";const X="helperFunctions",i="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";H(1115).d.IncludesShadersStoreWGSL[X]=i},10521:(f,Q,H)=>{"use strict";const X="imageProcessingDeclaration",i="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";H(1115).d.IncludesShadersStoreWGSL[X]=i},10524:(f,Q,H)=>{"use strict";const X="imageProcessingFunctions",i="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";H(1115).d.IncludesShadersStoreWGSL[X]=i},10396:(f,Q,H)=>{"use strict";const X="logDepthDeclaration",i="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";H(1115).d.IncludesShadersStoreWGSL[X]=i},10567:(f,Q,H)=>{"use strict";const X="logDepthFragment",i="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";H(1115).d.IncludesShadersStoreWGSL[X]=i},10479:(f,Q,H)=>{"use strict";const X="logDepthVertex",i="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";H(1115).d.IncludesShadersStoreWGSL[X]=i},11477:(f,Q,H)=>{"use strict";H.r(Q),H.d(Q,{particlesPixelShaderWGSL:()=>x});var X=H(1115);H(10539),H(10521),H(10396),H(10326),H(10524),H(10543),H(10550),H(10567),H(10571);const i="particlesPixelShader",S="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";X.d.ShadersStoreWGSL[i]=S;const x={name:i,shader:S}},11481:(f,Q,H)=>{"use strict";H.r(Q),H.d(Q,{particlesVertexShaderWGSL:()=>x});var X=H(1115);H(10366),H(10369),H(10396),H(10453),H(10458),H(10479);const i="particlesVertexShader",S="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";X.d.ShadersStoreWGSL[i]=S;const x={name:i,shader:S}},10855:(f,Q,H)=>{"use strict";const X="clipPlaneFragment",i="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";H(1115).d.IncludesShadersStore[X]=i},10842:(f,Q,H)=>{"use strict";const X="clipPlaneFragmentDeclaration",i="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";H(1115).d.IncludesShadersStore[X]=i},10747:(f,Q,H)=>{"use strict";const X="clipPlaneVertex",i="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";H(1115).d.IncludesShadersStore[X]=i},10655:(f,Q,H)=>{"use strict";const X="clipPlaneVertexDeclaration",i="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";H(1115).d.IncludesShadersStore[X]=i},10896:(f,Q,H)=>{"use strict";const X="fogFragment",i="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";H(1115).d.IncludesShadersStore[X]=i},10847:(f,Q,H)=>{"use strict";const X="fogFragmentDeclaration",i="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";H(1115).d.IncludesShadersStore[X]=i},10753:(f,Q,H)=>{"use strict";const X="fogVertex",i="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";H(1115).d.IncludesShadersStore[X]=i},10660:(f,Q,H)=>{"use strict";const X="fogVertexDeclaration",i="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";H(1115).d.IncludesShadersStore[X]=i},10611:(f,Q,H)=>{"use strict";const X="helperFunctions",i="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";H(1115).d.IncludesShadersStore[X]=i},10824:(f,Q,H)=>{"use strict";const X="imageProcessingDeclaration",i="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";H(1115).d.IncludesShadersStore[X]=i},10831:(f,Q,H)=>{"use strict";const X="imageProcessingFunctions",i="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";H(1115).d.IncludesShadersStore[X]=i},10691:(f,Q,H)=>{"use strict";const X="logDepthDeclaration",i="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";H(1115).d.IncludesShadersStore[X]=i},10888:(f,Q,H)=>{"use strict";const X="logDepthFragment",i="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";H(1115).d.IncludesShadersStore[X]=i},10777:(f,Q,H)=>{"use strict";const X="logDepthVertex",i="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";H(1115).d.IncludesShadersStore[X]=i},11467:(f,Q,H)=>{"use strict";H.r(Q),H.d(Q,{particlesPixelShader:()=>x});var X=H(1115);H(10842),H(10824),H(10691),H(10611),H(10831),H(10847),H(10855),H(10888),H(10896);const i="particlesPixelShader",S="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";X.d.ShadersStore[i]=S;const x={name:i,shader:S}},11472:(f,Q,H)=>{"use strict";H.r(Q),H.d(Q,{particlesVertexShader:()=>x});var X=H(1115);H(10655),H(10660),H(10691),H(10747),H(10753),H(10777);const i="particlesVertexShader",S="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";X.d.ShadersStore[i]=S;const x={name:i,shader:S}},11314:(f,Q,H)=>{"use strict";H.d(Q,{e:()=>J});var X=H(978),i=H(1003),S=H(982),x=H(994),K=H(1027),Z=H(1082),B=H(1151);class N{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new x.e,this._onClonedObservable=new x.e}}class J{static AddNodeConstructor(f,Q){this._NodeConstructors[f]=Q}static Construct(f,Q,H,X){const i=this._NodeConstructors[f];return i?i(Q,H,X):null}set accessibilityTag(f){this._accessibilityTag=f,this.onAccessibilityTagChangedObservable.notifyObservers(f)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(f){this._nodeDataStorage._doNotSerialize=f}u(){return this._nodeDataStorage._isDisposed}set parent(f){if(this._parentNode===f)return;const Q=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const Q=this._parentNode._children.indexOf(this);-1!==Q&&this._parentNode._children.splice(Q,1),f||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=f,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),Q||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(f){f.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const f=this._scene.rootNodes,Q=f.length-1;f[this._nodeDataStorage._sceneRootNodesIndex]=f[Q],f[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(f){this._animationPropertiesOverride=f}getClassName(){return"Node"}set onDispose(f){this._onDisposeObserver&&this.fe.remove(this._onDisposeObserver),this._onDisposeObserver=this.fe.add(f)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new N,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new x.e,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=i.e.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.fe=new x.e,this._onDisposeObserver=null,this._behaviors=new Array,this.name=f,this.id=f,this._scene=Q||K.e.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),H&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(f)||(f.init(),this._scene.isLoading&&!Q?this._scene.onDataLoadedObservable.addOnce((()=>{f.attach(this)})):f.attach(this),this._behaviors.push(f)),this}removeBehavior(f){const Q=this._behaviors.indexOf(f);return-1===Q||(this._behaviors[Q].detach(),this._behaviors.splice(Q,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(f){for(const Q of this._behaviors)if(Q.name===f)return Q;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.re(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(f){!f&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(f){return this.parent?this.parent._getActionManagerForTrigger(f,!1):null}_updateCache(f){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}ve(f){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((f=>{f._syncParentEnabledState()}))}Dg(f){this._nodeDataStorage._isEnabled!==f&&(this._nodeDataStorage._isEnabled=f,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(f))}isDescendantOf(f){return!!this.parent&&(this.parent===f||this.parent.isDescendantOf(f))}_getDescendants(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2?arguments[2]:void 0;if(this._children)for(let X=0;X<this._children.length;X++){const i=this._children[X];H&&!H(i)||f.push(i),Q||i._getDescendants(f,!1,H)}}getDescendants(f,Q){const H=[];return this._getDescendants(H,f,Q),H}getChildMeshes(f,Q){const H=[];return this._getDescendants(H,f,(f=>(!Q||Q(f))&&void 0!==f.Ke)),H}getChildren(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(Q,f)}_setReady(f){f!==this._nodeDataStorage._isReady&&(f?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(f){for(let Q=0;Q<this.animations.length;Q++){const H=this.animations[Q];if(H.name===f)return H}return null}createAnimationRange(f,Q,H){if(!this._ranges[f]){this._ranges[f]=J._AnimationRangeFactory(f,Q,H);for(let X=0,i=this.animations.length;X<i;X++)this.animations[X]&&this.animations[X].createRange(f,Q,H)}}deleteAnimationRange(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let H=0,X=this.animations.length;H<X;H++)this.animations[H]&&this.animations[H].deleteRange(f,Q);this._ranges[f]=null}getAnimationRange(f){return this._ranges[f]||null}clone(f,Q,H){const X=B.b.Clone((()=>new J(f,this.va())),this);if(Q&&(X.parent=Q),!H){const Q=this.getDescendants(!0);for(let H=0;H<Q.length;H++){const i=Q[H];i.clone(f+"."+i.name,X)}}return X}getAnimationRanges(){const f=[];let Q;for(Q in this._ranges)f.push(this._ranges[Q]);return f}beginAnimation(f,Q,H,X){const i=this.getAnimationRange(f);return i?this._scene.beginAnimation(this,i.from,i.to,Q,H,X):null}serializeAnimationRanges(){const f=[];for(const Q in this._ranges){const H=this._ranges[Q];if(!H)continue;const X={};X.name=Q,X.from=H.from,X.to=H.to,f.push(X)}return f}re(f){return this._worldMatrix||(this._worldMatrix=i.e.Identity()),this._worldMatrix}dispose(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!f){const H=this.getDescendants(!0);for(const X of H)X.dispose(f,Q)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.fe.notifyObservers(this),this.fe.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const H of this._behaviors)H.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(f,Q,H){if(Q.ranges)for(let X=0;X<Q.ranges.length;X++){const H=Q.ranges[X];f.createAnimationRange(H.name,H.from,H.to)}}getHierarchyBoundingVectors(){let f,Q,H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.re(!0);const S=this;if(S.getBoundingInfo&&S.ge){const H=S.getBoundingInfo();f=H.boundingBox.minimumWorld.clone(),Q=H.boundingBox.maximumWorld.clone()}else f=new i.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Q=new i.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(H){const H=this.getDescendants(!1);for(const S of H){const H=S;if(H.re(!0),X&&!X(H))continue;if(!H.getBoundingInfo||0===H.getTotalVertices())continue;const x=H.getBoundingInfo().boundingBox,K=x.minimumWorld,Z=x.maximumWorld;i.p.CheckExtends(K,f,Q),i.p.CheckExtends(Z,f,Q)}}return{min:f,max:Q}}}J._AnimationRangeFactory=(f,Q,H)=>{throw(0,Z.c)("AnimationRange")},J._NodeConstructors={},(0,X.d)([(0,S.G)()],J.prototype,"name",void 0),(0,X.d)([(0,S.G)()],J.prototype,"id",void 0),(0,X.d)([(0,S.G)()],J.prototype,"uniqueId",void 0),(0,X.d)([(0,S.G)()],J.prototype,"state",void 0),(0,X.d)([(0,S.G)()],J.prototype,"metadata",void 0)},11874:(f,Q,H)=>{"use strict";class X{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((f,Q)=>{this._resolve=f,this._reject=Q}))}}var i=H(1003),S=H(1161),x=H(1203),K=H(11311),Z=H(11882),B=H(11901),N=H(994),J=H(11443),g=H(11903),z=H(11911),v=H(1027),Y=H(1092),O=H(1207);class n{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(f){this._useTextureToStoreBoneMatrices=f,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(f){this._animationPropertiesOverride=f}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(f,Q,H){this.name=f,this.id=Q,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=i.e.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new N.e,this.bones=[],this._scene=H||v.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const X=this._scene.getEngine().getCaps();this._canUseTextureForBones=X.textureFloat&&X.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((f=>!f.getParent()))}getTransformMatrices(f){if(this.needInitialSkinMatrix){if(!f)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return f._bonesTransformMatrices||this.prepare(!0),f._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(f){return this.needInitialSkinMatrix&&f._transformMatrixTexture?f._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(f){let Q=`Name: ${this.name}, nBones: ${this.bones.length}`;if(Q+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,f){Q+=", Ranges: {";let f=!0;for(const H in this._ranges)f&&(Q+=", ",f=!1),Q+=H;Q+="}"}return Q}getBoneIndexByName(f){for(let Q=0,H=this.bones.length;Q<H;Q++)if(this.bones[Q].name===f)return Q;return-1}createAnimationRange(f,Q,H){if(!this._ranges[f]){this._ranges[f]=new z.c(f,Q,H);for(let X=0,i=this.bones.length;X<i;X++)this.bones[X].animations[0]&&this.bones[X].animations[0].createRange(f,Q,H)}}deleteAnimationRange(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let H=0,X=this.bones.length;H<X;H++)this.bones[H].animations[0]&&this.bones[H].animations[0].deleteRange(f,Q);this._ranges[f]=null}getAnimationRange(f){return this._ranges[f]||null}getAnimationRanges(){const f=[];let Q;for(Q in this._ranges)f.push(this._ranges[Q]);return f}copyAnimationRange(f,Q){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[Q]||!f.getAnimationRange(Q))return!1;let X=!0;const i=this._getHighestAnimationFrame()+1,S={},x=f.bones;let K,Z;for(Z=0,K=x.length;Z<K;Z++)S[x[Z].name]=x[Z];this.bones.length!==x.length&&(Y.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${x.length}`),X=!1);const B=H&&this.dimensionsAtRest&&f.dimensionsAtRest?this.dimensionsAtRest.divide(f.dimensionsAtRest):null;for(Z=0,K=this.bones.length;Z<K;Z++){const f=this.bones[Z].name,x=S[f];x?X=X&&this.bones[Z].copyAnimationRange(x,Q,i,H,B):(Y.b.Warn("copyAnimationRange: not same rig, missing source bone "+f),X=!1)}const N=f.getAnimationRange(Q);return N&&(this._ranges[Q]=new z.c(Q,N.from+i,N.to+i)),X}returnToRest(){for(const f of this.bones)-1!==f._index&&f.returnToRest()}_getHighestAnimationFrame(){let f=0;for(let Q=0,H=this.bones.length;Q<H;Q++)if(this.bones[Q].animations[0]){const H=this.bones[Q].animations[0].getHighestFrame();f<H&&(f=H)}return f}beginAnimation(f,Q,H,X){const i=this.getAnimationRange(f);return i?this._scene.beginAnimation(this,i.from,i.to,Q,H,X):null}static MakeAnimationAdditive(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;const X=f.getAnimationRange(H);if(!X)return null;const i=f._scene.getAllAnimatablesByTarget(f);let S=null;for(let K=0;K<i.length;K++){const f=i[K];if(f.fromFrame===(null===X||void 0===X?void 0:X.from)&&f.toFrame===(null===X||void 0===X?void 0:X.to)){S=f;break}}const x=f.getAnimatables();for(let K=0;K<x.length;K++){const f=x[K].animations;if(f)for(let X=0;X<f.length;X++)g.d.MakeAnimationAdditive(f[X],Q,H)}return S&&(S.isAdditive=!0),f}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(f){this._meshesWithPoseMatrix.push(f)}_unregisterMeshWithPoseMatrix(f){const Q=this._meshesWithPoseMatrix.indexOf(f);Q>-1&&this._meshesWithPoseMatrix.splice(Q,1)}_computeTransformMatrices(f,Q){this.onBeforeComputeObservable.notifyObservers(this);for(let H=0;H<this.bones.length;H++){const X=this.bones[H];X._childUpdateId++;const i=X.getParent();if(i?X.getLocalMatrix().multiplyToRef(i.getFinalMatrix(),X.getFinalMatrix()):Q?X.getLocalMatrix().multiplyToRef(Q,X.getFinalMatrix()):X.getFinalMatrix().p(X.getLocalMatrix()),-1!==X._index){const Q=null===X._index?H:X._index;X.getAbsoluteInverseBindMatrix().multiplyToArray(X.getFinalMatrix(),f,16*Q)}}this._identity.copyToArray(f,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const f=this.va().getRenderId();if(this._currentRenderId===f)return;this._currentRenderId=f}if(this._numBonesWithLinkedTransformNode>0)for(const f of this.bones)if(f._linkedTransformNode){const Q=f._linkedTransformNode;f.position=Q.position,Q.rotationQuaternion?f.rotationQuaternion=Q.rotationQuaternion:f.rotation=Q.rotation,f.He=Q.He}if(this.needInitialSkinMatrix)for(const f of this._meshesWithPoseMatrix){const Q=f.getPoseMatrix();let H=this._isDirty;if(f._bonesTransformMatrices&&f._bonesTransformMatrices.length===16*(this.bones.length+1)||(f._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),H=!0),H){if(this._synchronizedWithMesh!==f){this._synchronizedWithMesh=f;for(const f of this.bones)if(!f.getParent()){f.getBindMatrix().multiplyToRef(Q,i.l.Matrix[1]),f._updateAbsoluteBindMatrices(i.l.Matrix[1])}if(this.isUsingTextureForMatrices){const Q=4*(this.bones.length+1);f._transformMatrixTexture&&f._transformMatrixTexture.getSize().width===Q||(f._transformMatrixTexture&&f._transformMatrixTexture.dispose(),f._transformMatrixTexture=J.b.CreateRGBATexture(f._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(f._bonesTransformMatrices,Q),this.isUsingTextureForMatrices&&f._transformMatrixTexture&&f._transformMatrixTexture.update(f._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=J.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let f=0;f<this.bones.length;f++)this._animatables.push(this.bones[f])}return this._animatables}clone(f,Q){const H=new n(f,Q||f,this._scene);H.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let X=0;X<this.bones.length;X++){const f=this.bones[X];let Q=null;const i=f.getParent();if(i){const f=this.bones.indexOf(i);Q=H.bones[f]}const S=new B.e(f.name,H,Q,f.getBindMatrix().clone(),f.getRestMatrix().clone());S._index=f._index,f._linkedTransformNode&&S.linkTransformNode(f._linkedTransformNode),O.b.DeepCopy(f.animations,S.animations)}if(this._ranges){H._ranges={};for(const f in this._ranges){const Q=this._ranges[f];Q&&(H._ranges[f]=Q.clone())}}return this._isDirty=!0,H.prepare(!0),H}enableBlending(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((Q=>{Q.animations.forEach((Q=>{Q.enableBlending=!0,Q.blendingSpeed=f}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const f=this._parentContainer.skeletons.indexOf(this);f>-1&&this._parentContainer.skeletons.splice(f,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const f={};f.name=this.name,f.id=this.id,this.dimensionsAtRest&&(f.dimensionsAtRest=this.dimensionsAtRest.ke()),f.bones=[],f.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let H=0;H<this.bones.length;H++){var Q;const X=this.bones[H],i=X.getParent(),S={parentBoneIndex:i?this.bones.indexOf(i):-1,index:X.getIndex(),name:X.name,id:X.id,matrix:X.getBindMatrix().ke(),rest:X.getRestMatrix().ke(),linkedTransformNodeId:null===(Q=X.getTransformNode())||void 0===Q?void 0:Q.id};f.bones.push(S),X.length&&(S.length=X.length),X.metadata&&(S.metadata=X.metadata),X.animations&&X.animations.length>0&&(S.animation=X.animations[0].serialize()),f.ranges=[];for(const Q in this._ranges){const H=this._ranges[Q];if(!H)continue;const X={};X.name=Q,X.from=H.from,X.to=H.to,f.ranges.push(X)}}return f}static Parse(f,Q){const H=new n(f.name,f.id,Q);let X;for(f.dimensionsAtRest&&(H.dimensionsAtRest=i.p.Zd(f.dimensionsAtRest)),H.needInitialSkinMatrix=f.needInitialSkinMatrix,X=0;X<f.bones.length;X++){const Q=f.bones[X],S=f.bones[X].index;let x=null;Q.parentBoneIndex>-1&&(x=H.bones[Q.parentBoneIndex]);const K=Q.rest?i.e.Zd(Q.rest):null,Z=new B.e(Q.name,H,x,i.e.Zd(Q.matrix),K,null,S);void 0!==Q.id&&null!==Q.id&&(Z.id=Q.id),Q.length&&(Z.length=Q.length),Q.metadata&&(Z.metadata=Q.metadata),Q.animation&&Z.animations.push(g.d.Parse(Q.animation)),void 0!==Q.linkedTransformNodeId&&null!==Q.linkedTransformNodeId&&(H._hasWaitingData=!0,Z._waitingTransformNodeId=Q.linkedTransformNodeId)}if(f.ranges)for(X=0;X<f.ranges.length;X++){const Q=f.ranges[X];H.createAnimationRange(Q.name,Q.from,Q.to)}return H}computeAbsoluteMatrices(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||f)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(f)}getPoseMatrix(){let f=null;return this._meshesWithPoseMatrix.length>0&&(f=this._meshesWithPoseMatrix[0].getPoseMatrix()),f}sortBones(){const f=[],Q=new Array(this.bones.length);for(let H=0;H<this.bones.length;H++)this._sortBones(H,f,Q);this.bones=f}_sortBones(f,Q,H){if(H[f])return;H[f]=!0;const X=this.bones[f];if(!X)return;void 0===X._index&&(X._index=f);const i=X.getParent();i&&this._sortBones(this.bones.indexOf(i),Q,H),Q.push(X)}setCurrentPoseAsRest(){this.bones.forEach((f=>{f.setCurrentPoseAsRest()}))}}var e=H(1352),G=H(978),I=H(982),l=H(11916),q=H(11922),D=H(1022),d=H(1151);class s extends q.c{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(f){this.subSurface.refractionTexture=f,f?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(f){this.subSurface.indexOfRefraction=f}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(f){this.subSurface.invertRefractionY=f}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(f){this.subSurface.linkRefractionWithTransparency=f,f&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===q.c.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(f){f!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=f?q.c.LIGHTFALLOFF_PHYSICAL:q.c.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===q.c.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(f){f!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=f?q.c.LIGHTFALLOFF_GLTF:q.c.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(f){this._attachImageProcessingConfiguration(f),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(f){this.imageProcessingConfiguration.colorCurvesEnabled=f}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(f){this.imageProcessingConfiguration.colorGradingEnabled=f}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(f){this._imageProcessingConfiguration.toneMappingEnabled=f}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(f){this._imageProcessingConfiguration.exposure=f}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(f){this._imageProcessingConfiguration.contrast=f}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(f){this._imageProcessingConfiguration.colorGradingTexture=f}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(f){this._imageProcessingConfiguration.colorCurves=f}constructor(f,Q){super(f,Q,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=s.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=S.e.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new S.e(0,0,0),this.albedoColor=new S.e(1,1,1),this.reflectivityColor=new S.e(1,1,1),this.reflectionColor=new S.e(1,1,1),this.emissiveColor=new S.e(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,l.e)(this.va())}getClassName(){return"PBRMaterial"}clone(f){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const X=d.b.Clone((()=>new s(f,this.va())),this,{cloneTexturesOnlyOnce:Q});return X.id=f,X.name=f,this.stencil.copyTo(X.stencil),this._clonePlugins(X,H),X}serialize(){const f=super.serialize();return f.customType="BABYLON.PBRMaterial",f}static Parse(f,Q,H){const X=d.b.Parse((()=>new s(f.name,Q)),f,Q,H);return f.stencil&&X.stencil.parse(f.stencil,Q,H),e.e._ParsePlugins(f,X,Q,H),f.clearCoat&&X.clearCoat.parse(f.clearCoat,Q,H),f.anisotropy&&X.anisotropy.parse(f.anisotropy,Q,H),f.brdf&&X.brdf.parse(f.brdf,Q,H),f.sheen&&X.sheen.parse(f.sheen,Q,H),f.subSurface&&X.subSurface.parse(f.subSurface,Q,H),f.iridescence&&X.iridescence.parse(f.iridescence,Q,H),X}}s.PBRMATERIAL_OPAQUE=q.c.PBRMATERIAL_OPAQUE,s.PBRMATERIAL_ALPHATEST=q.c.PBRMATERIAL_ALPHATEST,s.PBRMATERIAL_ALPHABLEND=q.c.PBRMATERIAL_ALPHABLEND,s.PBRMATERIAL_ALPHATESTANDBLEND=q.c.PBRMATERIAL_ALPHATESTANDBLEND,s.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=q.c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"directIntensity",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"emissiveIntensity",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"environmentIntensity",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"specularIntensity",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"disableBumpMap",void 0),(0,G.d)([(0,I.A)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"albedoTexture",void 0),(0,G.d)([(0,I.A)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"ambientTexture",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"ambientTextureStrength",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,G.d)([(0,I.A)(),(0,I.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],s.prototype,"opacityTexture",void 0),(0,G.d)([(0,I.A)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"reflectionTexture",void 0),(0,G.d)([(0,I.A)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"emissiveTexture",void 0),(0,G.d)([(0,I.A)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"reflectivityTexture",void 0),(0,G.d)([(0,I.A)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"metallicTexture",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"metallic",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"roughness",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"metallicF0Factor",void 0),(0,G.d)([(0,I.k)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"metallicReflectanceColor",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,G.d)([(0,I.A)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"metallicReflectanceTexture",void 0),(0,G.d)([(0,I.A)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"reflectanceTexture",void 0),(0,G.d)([(0,I.A)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"microSurfaceTexture",void 0),(0,G.d)([(0,I.A)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"bumpTexture",void 0),(0,G.d)([(0,I.A)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty",null)],s.prototype,"lightmapTexture",void 0),(0,G.d)([(0,I.k)("ambient"),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"ambientColor",void 0),(0,G.d)([(0,I.k)("albedo"),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"albedoColor",void 0),(0,G.d)([(0,I.k)("reflectivity"),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"reflectivityColor",void 0),(0,G.d)([(0,I.k)("reflection"),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"reflectionColor",void 0),(0,G.d)([(0,I.k)("emissive"),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"emissiveColor",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"microSurface",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useLightmapAsShadowmap",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],s.prototype,"useAlphaFromAlbedoTexture",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],s.prototype,"forceAlphaTest",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],s.prototype,"alphaCutOff",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useSpecularOverAlpha",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useAmbientInGrayScale",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,G.d)([(0,I.G)()],s.prototype,"usePhysicalLightFalloff",null),(0,G.d)([(0,I.G)()],s.prototype,"useGLTFLightFalloff",null),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useRadianceOverAlpha",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useObjectSpaceNormalMap",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useParallax",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useParallaxOcclusion",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"parallaxScaleBias",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsLightsDirty")],s.prototype,"disableLighting",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"forceIrradianceInFragment",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsLightsDirty")],s.prototype,"maxSimultaneousLights",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"invertNormalMapX",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"invertNormalMapY",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"twoSidedLighting",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useAlphaFresnel",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useLinearAlphaFresnel",void 0),(0,G.d)([(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"environmentBRDFTexture",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"forceNormalForward",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"enableSpecularAntiAliasing",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useHorizonOcclusion",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"useRadianceOcclusion",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsMiscDirty")],s.prototype,"unlit",void 0),(0,G.d)([(0,I.G)(),(0,I.c)("_markAllSubMeshesAsMiscDirty")],s.prototype,"applyDecalMapAfterDetailMap",void 0),(0,D.h)("BABYLON.PBRMaterial",s);var F=H(974),P=H(11345),m=H(1253),c=H(11327),W=H(11337),R=H(11301);class U{get influence(){return this._influence}set influence(f){if(this._influence===f)return;const Q=this._influence;this._influence=f,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===Q||0===f)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(f){this._animationPropertiesOverride=f}constructor(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=f,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new N.e,this._onDataLayoutChanged=new N.e,this._animationPropertiesOverride=null,this.id=f,this._scene=H||v.e.LastCreatedScene,this.influence=Q,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(f){const Q=this.hasPositions;this._positions=f,Q!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(f){const Q=this.hasNormals;this._normals=f,Q!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(f){const Q=this.hasTangents;this._tangents=f,Q!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(f){const Q=this.hasUVs;this._uvs=f,Q!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const f=d.b.Clone((()=>new U(this.name,this.influence,this._scene)),this);return f._positions=this._positions,f._normals=this._normals,f._tangents=this._tangents,f._uvs=this._uvs,f}serialize(){const f={};return f.name=this.name,f.influence=this.influence,f.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(f.id=this.id),this.hasNormals&&(f.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(f.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(f.Aa=Array.prototype.slice.call(this.getUVs())),d.b.AppendSerializedAnimations(this,f),f}getClassName(){return"MorphTarget"}static Parse(f,Q){const H=new U(f.name,f.influence);if(H.setPositions(f.xa),null!=f.id&&(H.id=f.id),f.ya&&H.setNormals(f.ya),f.tangents&&H.setTangents(f.tangents),f.Aa&&H.setUVs(f.Aa),f.animations){for(let Q=0;Q<f.animations.length;Q++){const X=f.animations[Q],i=(0,D.e)("BABYLON.Animation");i&&H.animations.push(i.Parse(X))}f.autoAnimate&&Q&&Q.beginAnimation(H,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1)}return H}static FromMesh(f,Q,H){Q||(Q=f.name);const X=new U(Q,H,f.va());return X.setPositions(f.getVerticesData(m.e.PositionKind)),f.isVerticesDataPresent(m.e.NormalKind)&&X.setNormals(f.getVerticesData(m.e.NormalKind)),f.isVerticesDataPresent(m.e.TangentKind)&&X.setTangents(f.getVerticesData(m.e.TangentKind)),f.isVerticesDataPresent(m.e.UVKind)&&X.setUVs(f.getVerticesData(m.e.UVKind)),X}}(0,G.d)([(0,I.G)()],U.prototype,"id",void 0);var E=H(1190),t=H(1570);class u{set areUpdatesFrozen(f){f?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new E.g(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,f||(f=v.e.LastCreatedScene),this._scene=f,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const f=this._scene.getEngine().getCaps();this._canUseTextureForTargets=f.canUseGLVertexID&&f.textureFloat&&f.maxVertexTextureImageUnits>0&&f.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(f){this._numMaxInfluencers!==f&&(this._numMaxInfluencers=f,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(f){this._useTextureToStoreTargets=f}get isUsingTextureForTargets(){var f;return u.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(f=this._scene)&&void 0!==f&&f.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(f){return this._activeTargets.data[f]}getTarget(f){return this._targets[f]}getTargetByName(f){for(const Q of this._targets)if(Q.name===f)return Q;return null}addTarget(f){this._targets.push(f),this._targetInfluenceChangedObservers.push(f.onInfluenceChanged.add((f=>{this._syncActiveTargets(f)}))),this._targetDataLayoutChangedObservers.push(f._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(f){const Q=this._targets.indexOf(f);Q>=0&&(this._targets.splice(Q,1),f.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(Q,1)[0]),f._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(Q,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(f)}_bind(f){f.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),f.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),f.setTexture("morphTargets",this._targetStoreTexture),f.setInt("morphTargetCount",this.numInfluencers)}clone(){const f=new u(this._scene);for(const Q of this._targets)f.addTarget(Q.clone());return f.enableNormalMorphing=this.enableNormalMorphing,f.enableTangentMorphing=this.enableTangentMorphing,f.enableUVMorphing=this.enableUVMorphing,f}serialize(){const f={};f.id=this.uniqueId,f.targets=[];for(const Q of this._targets)f.targets.push(Q.serialize());return f}_syncActiveTargets(f){if(this.areUpdatesFrozen)return;let Q=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let H=-1;for(const X of this._targets){if(H++,0===X.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=u.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(X),this._morphTargetTextureIndices[Q]=H,this._tempInfluences[Q++]=X.influence,this._supportsNormals=this._supportsNormals&&X.hasNormals,this._supportsTangents=this._supportsTangents&&X.hasTangents,this._supportsUVs=this._supportsUVs&&X.hasUVs;const f=X.getPositions();if(f){const Q=f.length/3;if(0===this._vertexCount)this._vertexCount=Q;else if(this._vertexCount!==Q)return void Y.b.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==Q&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,Q)),this._influences&&this._influences.length===Q||(this._influences=new Float32Array(Q));for(let X=0;X<Q;X++)this._influences[X]=this._tempInfluences[X];f&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const f=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>f&&(this._textureHeight=Math.ceil(this._textureWidth/f),this._textureWidth=f);let Q=!0;if(this._targetStoreTexture){const f=this._targetStoreTexture.getSize();f.width===this._textureWidth&&f.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(Q=!1)}if(Q){this._targetStoreTexture&&this._targetStoreTexture.dispose();const f=this._targets.length,Q=new Float32Array(f*this._textureWidth*this._textureHeight*4);let H=0;for(let X=0;X<f;X++){const f=this._targets[X],i=f.getPositions(),S=f.getNormals(),x=f.getUVs(),K=f.getTangents();if(!i)return void(0===X&&Y.b.Error("Invalid morph target. Target must have positions."));H=X*this._textureWidth*this._textureHeight*4;for(let X=0;X<this._vertexCount;X++)Q[H]=i[3*X],Q[H+1]=i[3*X+1],Q[H+2]=i[3*X+2],H+=4,this._supportsNormals&&S&&(Q[H]=S[3*X],Q[H+1]=S[3*X+1],Q[H+2]=S[3*X+2],H+=4),this._supportsUVs&&x&&(Q[H]=x[2*X],Q[H+1]=x[2*X+1],H+=4),this._supportsTangents&&K&&(Q[H]=K[3*X],Q[H+1]=K[3*X+1],Q[H+2]=K[3*X+2],H+=4)}this._targetStoreTexture=t.d.CreateRGBATexture(Q,this._textureWidth,this._textureHeight,f,this._scene,!1,!1,1,1)}}for(const f of this._scene.meshes)f.morphTargetManager===this&&f._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const f=this._parentContainer.morphTargetManagers.indexOf(this);f>-1&&this._parentContainer.morphTargetManagers.splice(f,1),this._parentContainer=null}for(const f of this._targets)this._scene.stopAnimation(f)}}static Parse(f,Q){const H=new u(Q);for(const X of f.targets)H.addTarget(U.Parse(X,Q));return H}}u.EnableTextureStorage=!0,u.MaxActiveMorphTargetsInVertexAttributeMode=8;var L=H(11924),A=H(1051),a=H(1362);function V(f,Q,H,X){return i.p.Zd(Q,H).scaleInPlace(X)}class M{constructor(f,Q,H,X){this.type=f,this.name=Q,this.getValue=H,this.getStride=X}_buildAnimation(f,Q,H){const X=new g.d(f,this.name,Q,this.type);return X.setKeys(H),X}}class r extends M{buildAnimations(f,Q,H,X,i){i(f._babylonTransformNode,this._buildAnimation(Q,H,X))}}const j={translation:[new r(g.d.ANIMATIONTYPE_VECTOR3,"position",V,(()=>3))],rotation:[new r(g.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(f,Q,H,X){return i.i.Zd(Q,H).scaleInPlace(X)}),(()=>4))],scale:[new r(g.d.ANIMATIONTYPE_VECTOR3,"He",V,(()=>3))],weights:[new class extends M{buildAnimations(f,Q,H,X,i){if(f._numMorphTargets)for(let S=0;S<f._numMorphTargets;S++){const x=new g.d(`${Q}_${S}`,this.name,H,this.type);if(x.setKeys(X.map((f=>({frame:f.frame,inTangent:f.inTangent?f.inTangent[S]:void 0,value:f.value[S],outTangent:f.outTangent?f.outTangent[S]:void 0,interpolation:f.interpolation})))),f._primitiveBabylonMeshes)for(const Q of f._primitiveBabylonMeshes)if(Q.morphTargetManager){const f=Q.morphTargetManager.getTarget(S),H=x.clone();f.animations.push(H),i(f,H)}}}}(g.d.ANIMATIONTYPE_FLOAT,"influence",(function(f,Q,H,X){const i=new Array(f._numMorphTargets);for(let S=0;S<i.length;S++)i[S]=Q[H++]*X;return i}),(f=>f._numMorphTargets))]},T=new Map,k=T;function y(f,Q,H){h(f)&&Y.b.Warn(`Extension with the name '${f}' already exists`),T.set(f,{isGLTFExtension:Q,factory:H})}function h(f){return T.delete(f)}function w(){const f=f=>f&&"object"===typeof f;for(var Q=arguments.length,H=new Array(Q),X=0;X<Q;X++)H[X]=arguments[X];return H.reduce(((Q,H)=>(Object.keys(H).forEach((X=>{const i=Q[X],S=H[X];Array.isArray(i)&&Array.isArray(S)?Q[X]=i.concat(...S):f(i)&&f(S)?Q[X]=w(i,S):Q[X]=S})),Q)),{})}class b{static Get(f,Q,H){if(!Q||void 0==H||!Q[H])throw new Error(`${f}: Failed to find index (${H})`);return Q[H]}static TryGet(f,Q){return f&&void 0!=Q&&f[Q]?f[Q]:null}static Assign(f){if(f)for(let Q=0;Q<f.length;Q++)f[Q].index=Q}}class o{static RegisterExtension(f,Q){y(f,!1,Q)}static UnregisterExtension(f){return h(f)}get ij(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(f){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=f}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((f=>f.dispose&&f.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(f,Q,H,X,i,S){let x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=Q,this._assetContainer=H,this._loadData(X);let S=null;if(f){const Q={};if(this._gltf.nodes)for(const f of this._gltf.nodes)f.name&&(Q[f.name]=f.index);S=(f instanceof Array?f:[f]).map((f=>{const H=Q[f];if(void 0===H)throw new Error(`Failed to find node '${f}'`);return H}))}return this._loadAsync(i,x,S,(()=>({meshes:this._getMeshes(),pe:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(f,Q,H,X){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=f,this._loadData(Q),this._loadAsync(H,i,null,(()=>{})))))}_loadAsync(f,Q,H,X){return Promise.resolve().then((async()=>{this._rootUrl=f,this._uniqueRootUrl=!f.startsWith("file:")&&Q?f:`${f}${Date.now()}/`,this._fileName=Q,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const i=`${L.k[L.k.LOADING]} => ${L.k[L.k.READY]}`,S=`${L.k[L.k.LOADING]} => ${L.k[L.k.COMPLETE]}`;this._parent._startPerformanceCounter(i),this._parent._startPerformanceCounter(S),this._parent._setState(L.k.LOADING),this._extensionsOnLoading();const K=new Array;if(!this.parent.loadOnlyMaterials)if(H)K.push(this.loadSceneAsync("/nodes",{nodes:H,index:-1}));else if(void 0!=this._gltf.Re||this._gltf.scenes&&this._gltf.scenes[0]){const f=b.Get("/scene",this._gltf.scenes,this._gltf.Re||0);K.push(this.loadSceneAsync(`/scenes/${f.index}`,f))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let f=0;f<this._gltf.materials.length;++f){const Q=this._gltf.materials[f],H="/materials/"+f,X=e.e.TriangleFillMode;K.push(this._loadMaterialAsync(H,Q,null,X,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&K.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&K.push(this._compileShadowGeneratorsAsync());return Promise.all(K).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Dg(!0),this._extensionsOnReady(),this._parent._setState(L.k.READY),this._startAnimations(),X()))).then((f=>(this._parent._endPerformanceCounter(i),x.g.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(S),this._parent._setState(L.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(f=>{this._parent.onErrorObservable.notifyObservers(f),this._parent.onErrorObservable.clear(),this.dispose()}))})),f)))})).catch((f=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(f),this._parent.onErrorObservable.clear(),this.dispose()),f}))}_loadData(f){if(this._gltf=f.json,this._setupData(),f.bin){const Q=this._gltf.buffers;if(Q&&Q[0]&&!Q[0].uri){const H=Q[0];(H.byteLength<f.bin.byteLength-3||H.byteLength>f.bin.byteLength)&&Y.b.Warn(`Binary buffer length (${H.byteLength}) from JSON does not match chunk length (${f.bin.byteLength})`),this._bin=f.bin}else Y.b.Warn("Unexpected BIN chunk")}}_setupData(){if(b.Assign(this._gltf.accessors),b.Assign(this._gltf.animations),b.Assign(this._gltf.buffers),b.Assign(this._gltf.bufferViews),b.Assign(this._gltf.cameras),b.Assign(this._gltf.images),b.Assign(this._gltf.materials),b.Assign(this._gltf.meshes),b.Assign(this._gltf.nodes),b.Assign(this._gltf.samplers),b.Assign(this._gltf.scenes),b.Assign(this._gltf.skins),b.Assign(this._gltf.textures),this._gltf.nodes){const f={};for(const H of this._gltf.nodes)if(H.children)for(const Q of H.children)f[Q]=H.index;const Q=this._createRootNode();for(const H of this._gltf.nodes){const X=f[H.index];H.parent=void 0===X?Q:this._gltf.nodes[X]}}}async _loadExtensionsAsync(){const f=[];if(k.forEach(((Q,H)=>{var X;!1===(null===(X=this.parent.extensionOptions[H])||void 0===X?void 0:X.enabled)?Q.isGLTFExtension&&this.isExtensionUsed(H)&&Y.b.Warn(`Extension ${H} is used but has been explicitly disabled.`):Q.isGLTFExtension&&!this.isExtensionUsed(H)||f.push((async()=>{const f=await Q.factory(this);return f.name!==H&&Y.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${f.name} !== ${H}`),this._parent.onExtensionLoadedObservable.notifyObservers(f),f})())})),this._extensions.push(...await Promise.all(f)),this._extensions.sort(((f,Q)=>(f.order||Number.MAX_VALUE)-(Q.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const H of this._gltf.extensionsRequired){if(!this._extensions.some((f=>f.name===H&&f.enabled))){var Q;if(!1===(null===(Q=this.parent.extensionOptions[H])||void 0===Q?void 0:Q.enabled))throw new Error(`Required extension ${H} is disabled`);throw new Error(`Required extension ${H} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new R.b("__root__",this._babylonScene);this._rootBabylonMesh=f,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Dg(!1);const Q={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case L.g.AUTO:this._babylonScene.useRightHandedSystem||(Q.rotation=[0,1,0,0],Q.scale=[1,1,-1],o._LoadTransform(Q,this._rootBabylonMesh));break;case L.g.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(f),Q}loadSceneAsync(f,Q){const H=this._extensionsLoadSceneAsync(f,Q);if(H)return H;const X=new Array;if(this.logOpen(`${f} ${Q.name||""}`),Q.nodes)for(const i of Q.nodes){const Q=b.Get(`${f}/nodes/${i}`,this._gltf.nodes,i);X.push(this.loadNodeAsync(`/nodes/${Q.index}`,Q,(f=>{f.parent=this._rootBabylonMesh})))}for(const i of this._postSceneLoadActions)i();return X.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(X).then((()=>{}))}_forEachPrimitive(f,Q){if(f._primitiveBabylonMeshes)for(const H of f._primitiveBabylonMeshes)Q(H)}_getGeometries(){const f=[],Q=this._gltf.nodes;if(Q)for(const H of Q)this._forEachPrimitive(H,(Q=>{const H=Q.ze;H&&-1===f.indexOf(H)&&f.push(H)}));return f}_getMeshes(){const f=[];this._rootBabylonMesh instanceof W.c&&f.push(this._rootBabylonMesh);const Q=this._gltf.nodes;if(Q)for(const H of Q)this._forEachPrimitive(H,(Q=>{f.push(Q)}));return f}_getTransformNodes(){const f=[],Q=this._gltf.nodes;if(Q)for(const H of Q)H._babylonTransformNode&&"pb"===H._babylonTransformNode.getClassName()&&f.push(H._babylonTransformNode),H._babylonTransformNodeForSkin&&f.push(H._babylonTransformNodeForSkin);return f}_getSkeletons(){const f=[],Q=this._gltf.skins;if(Q)for(const H of Q)H._data&&f.push(H._data.babylonSkeleton);return f}_getAnimationGroups(){const f=[],Q=this._gltf.animations;if(Q)for(const H of Q)H._babylonAnimationGroup&&f.push(H._babylonAnimationGroup);return f}_startAnimations(){switch(this._parent.animationStartMode){case L.e.NONE:break;case L.e.FIRST:{const f=this._getAnimationGroups();0!==f.length&&f[0].start(!0);break}case L.e.ALL:{const f=this._getAnimationGroups();for(const Q of f)Q.start(!0);break}default:return void Y.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const X=this._extensionsLoadNodeAsync(f,Q,H);if(X)return X;if(Q._babylonTransformNode)throw new Error(`${f}: Invalid recursive node hierarchy`);const i=new Array;this.logOpen(`${f} ${Q.name||""}`);const S=X=>{if(o.AddPointerMetadata(X,f),o._LoadTransform(Q,X),void 0!=Q.camera){const H=b.Get(`${f}/camera`,this._gltf.cameras,Q.camera);i.push(this.loadCameraAsync(`/cameras/${H.index}`,H,(f=>{f.parent=X})))}if(Q.children)for(const H of Q.children){const Q=b.Get(`${f}/children/${H}`,this._gltf.nodes,H);i.push(this.loadNodeAsync(`/nodes/${Q.index}`,Q,(f=>{f.parent=X})))}H(X)},x=void 0!=Q.mesh,K=this._parent.loadSkins&&void 0!=Q.skin;if(!x||K){const f=Q.name||`node${Q.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new P.d(f,this._babylonScene);H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==Q.mesh?Q._babylonTransformNode=H:Q._babylonTransformNodeForSkin=H,S(H)}if(x)if(K){const H=b.Get(`${f}/mesh`,this._gltf.meshes,Q.mesh);i.push(this._loadMeshAsync(`/meshes/${H.index}`,Q,H,(H=>{const X=Q._babylonTransformNodeForSkin;H.metadata=w(X.metadata,H.metadata||{});const S=b.Get(`${f}/skin`,this._gltf.skins,Q.skin);i.push(this._loadSkinAsync(`/skins/${S.index}`,Q,S,(f=>{this._forEachPrimitive(Q,(Q=>{Q.skeleton=f})),this._postSceneLoadActions.push((()=>{if(void 0!=S.skeleton){const f=b.Get(`/skins/${S.index}/skeleton`,this._gltf.nodes,S.skeleton).parent;Q.index===f.index?H.parent=X.parent:H.parent=f._babylonTransformNode}else H.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:X,skinnedNode:H})}))})))})))}else{const H=b.Get(`${f}/mesh`,this._gltf.meshes,Q.mesh);i.push(this._loadMeshAsync(`/meshes/${H.index}`,Q,H,S))}return this.logClose(),Promise.all(i).then((()=>(this._forEachPrimitive(Q,(f=>{f.ze&&f.ze.useBoundingInfoFromGeometry?f.Ea():f.refreshBoundingInfo(!0,!0)})),Q._babylonTransformNode)))}_loadMeshAsync(f,Q,H,X){const i=H.primitives;if(!i||!i.length)throw new Error(`${f}: Primitives are missing`);void 0==i[0].index&&b.Assign(i);const S=new Array;this.logOpen(`${f} ${H.name||""}`);const x=Q.name||`node${Q.index}`;if(1===i.length){const X=H.primitives[0];S.push(this._loadMeshPrimitiveAsync(`${f}/primitives/${X.index}`,x,Q,H,X,(f=>{Q._babylonTransformNode=f,Q._primitiveBabylonMeshes=[f]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,Q._babylonTransformNode=new P.d(x,this._babylonScene),Q._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q._primitiveBabylonMeshes=[];for(const X of i)S.push(this._loadMeshPrimitiveAsync(`${f}/primitives/${X.index}`,`${x}_primitive${X.index}`,Q,H,X,(f=>{f.parent=Q._babylonTransformNode,Q._primitiveBabylonMeshes.push(f)})))}return X(Q._babylonTransformNode),this.logClose(),Promise.all(S).then((()=>Q._babylonTransformNode))}_loadMeshPrimitiveAsync(f,Q,H,X,i,S){const x=this._extensionsLoadMeshPrimitiveAsync(f,Q,H,X,i,S);if(x)return x;this.logOpen(`${f}`);const K=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==H.skin&&!X.primitives[0].targets;let Z,B;if(K&&i._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,Z=i._instanceData.babylonSourceMesh.yd(Q),Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B=i._instanceData.promise;else{const S=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const x=new R.b(Q,this._babylonScene);x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x.sideOrientation=this._babylonScene.useRightHandedSystem?e.e.CounterClockWiseSideOrientation:e.e.ClockWiseSideOrientation,this._createMorphTargets(f,H,X,i,x),S.push(this._loadVertexDataAsync(f,i,x).then((Q=>this._loadMorphTargetsAsync(f,i,x,Q).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,Q.Ca(x),Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const N=o._GetDrawMode(f,i.mode);if(void 0==i.material){let f=this._defaultBabylonMaterialData[N];f||(f=this._createDefaultMaterial("__GLTFLoader._default",N),this._parent.onMaterialLoadedObservable.notifyObservers(f),this._defaultBabylonMaterialData[N]=f),x.material=f}else if(!this.parent.skipMaterials){const Q=b.Get(`${f}/material`,this._gltf.materials,i.material);S.push(this._loadMaterialAsync(`/materials/${Q.index}`,Q,x,N,(f=>{x.material=f})))}B=Promise.all(S),K&&(i._instanceData={babylonSourceMesh:x,promise:B}),Z=x}return o.AddPointerMetadata(Z,f),this._parent.onMeshLoadedObservable.notifyObservers(Z),S(Z),this.logClose(),B.then((()=>Z))}_loadVertexDataAsync(f,Q,H){const X=this._extensionsLoadVertexDataAsync(f,Q,H);if(X)return X;const S=Q.attributes;if(!S)throw new Error(`${f}: Attributes are missing`);const x=new Array,K=new c.b(H.name,this._babylonScene);if(void 0==Q.indices)H.isUnIndexed=!0;else{const H=b.Get(`${f}/indices`,this._gltf.accessors,Q.indices);x.push(this._loadIndicesAccessorAsync(`/accessors/${H.index}`,H).then((f=>{K.setIndices(f)})))}const Z=(Q,X,Z)=>{if(void 0==S[Q])return;H._delayInfo=H._delayInfo||[],-1===H._delayInfo.indexOf(X)&&H._delayInfo.push(X);const B=b.Get(`${f}/attributes/${Q}`,this._gltf.accessors,S[Q]);x.push(this._loadVertexAccessorAsync(`/accessors/${B.index}`,B,X).then((f=>{if(f.getKind()===m.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!H.skeleton&&B.min&&B.max){const f=i.l.Wd[0].Xd(...B.min),Q=i.l.Wd[1].Xd(...B.max);if(B.normalized&&5126!==B.componentType){let H=1;switch(B.componentType){case 5120:H=127;break;case 5121:H=255;break;case 5122:H=32767;break;case 5123:H=65535}const X=1/H;f.scaleInPlace(X),Q.scaleInPlace(X)}K._boundingInfo=new a.d(f,Q),K.useBoundingInfoFromGeometry=!0}K.setVerticesBuffer(f,B.count)}))),X==m.e.MatricesIndicesExtraKind&&(H.numBoneInfluencers=8),Z&&Z(B)};return Z("POSITION",m.e.PositionKind),Z("NORMAL",m.e.NormalKind),Z("TANGENT",m.e.TangentKind),Z("TEXCOORD_0",m.e.UVKind),Z("TEXCOORD_1",m.e.UV2Kind),Z("TEXCOORD_2",m.e.UV3Kind),Z("TEXCOORD_3",m.e.UV4Kind),Z("TEXCOORD_4",m.e.UV5Kind),Z("TEXCOORD_5",m.e.UV6Kind),Z("JOINTS_0",m.e.MatricesIndicesKind),Z("WEIGHTS_0",m.e.MatricesWeightsKind),Z("JOINTS_1",m.e.MatricesIndicesExtraKind),Z("WEIGHTS_1",m.e.MatricesWeightsExtraKind),Z("COLOR_0",m.e.ColorKind,(f=>{"VEC4"===f.type&&(H.hasVertexAlpha=!0)})),Promise.all(x).then((()=>K))}_createMorphTargets(f,Q,H,X,i){if(!X.targets||!this._parent.loadMorphTargets)return;if(void 0==Q._numMorphTargets)Q._numMorphTargets=X.targets.length;else if(X.targets.length!==Q._numMorphTargets)throw new Error(`${f}: Primitives do not have the same number of targets`);const S=H.extras?H.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,i.morphTargetManager=new u(this._babylonScene),i.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,i.morphTargetManager.areUpdatesFrozen=!0;for(let x=0;x<X.targets.length;x++){const f=Q.weights?Q.weights[x]:H.weights?H.weights[x]:0,X=S?S[x]:`morphTarget${x}`;i.morphTargetManager.addTarget(new U(X,f,i.va()))}}_loadMorphTargetsAsync(f,Q,H,X){if(!Q.targets||!this._parent.loadMorphTargets)return Promise.resolve();const i=new Array,S=H.morphTargetManager;for(let x=0;x<S.numTargets;x++){const H=S.getTarget(x);i.push(this._loadMorphTargetVertexDataAsync(`${f}/targets/${x}`,X,Q.targets[x],H))}return Promise.all(i).then((()=>{S.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(f,Q,H,X){const i=new Array,S=(X,S,x)=>{if(void 0==H[X])return;const K=Q.getVertexBuffer(S);if(!K)return;const Z=b.Get(`${f}/${X}`,this._gltf.accessors,H[X]);i.push(this._loadFloatAccessorAsync(`/accessors/${Z.index}`,Z).then((f=>{x(K,f)})))};return S("POSITION",m.e.PositionKind,((f,Q)=>{const H=new Float32Array(Q.length);f.forEach(Q.length,((f,X)=>{H[X]=Q[X]+f})),X.setPositions(H)})),S("NORMAL",m.e.NormalKind,((f,Q)=>{const H=new Float32Array(Q.length);f.forEach(H.length,((f,X)=>{H[X]=Q[X]+f})),X.setNormals(H)})),S("TANGENT",m.e.TangentKind,((f,Q)=>{const H=new Float32Array(Q.length/3*4);let i=0;f.forEach(Q.length/3*4,((f,X)=>{(X+1)%4!==0&&(H[i]=Q[i]+f,i++)})),X.setTangents(H)})),Promise.all(i).then((()=>{}))}static _LoadTransform(f,Q){if(void 0!=f.skin)return;let H=i.p.Zero(),X=i.i.Identity(),S=i.p.One();if(f.matrix){i.e.Zd(f.matrix).decompose(S,X,H)}else f.translation&&(H=i.p.Zd(f.translation)),f.rotation&&(X=i.i.Zd(f.rotation)),f.scale&&(S=i.p.Zd(f.scale));Q.position=H,Q.rotationQuaternion=X,Q.He=S}_loadSkinAsync(f,Q,H,X){if(!this._parent.loadSkins)return Promise.resolve();const i=this._extensionsLoadSkinAsync(f,Q,H);if(i)return i;if(H._data)return X(H._data.babylonSkeleton),H._data.promise;const S=`skeleton${H.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const x=new n(H.name||S,S,this._babylonScene);x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(f,H,x);const K=this._loadSkinInverseBindMatricesDataAsync(f,H).then((f=>{this._updateBoneMatrices(x,f)}));return H._data={babylonSkeleton:x,promise:K},X(x),K}_loadBones(f,Q,H){if(void 0==Q.skeleton||this._parent.alwaysComputeSkeletonRootNode){const H=this._findSkeletonRootNode(`${f}/joints`,Q.joints);if(H)if(void 0===Q.skeleton)Q.skeleton=H.index;else{const X=(f,Q)=>{for(;Q.parent;Q=Q.parent)if(Q.parent===f)return!0;return!1},i=b.Get(`${f}/skeleton`,this._gltf.nodes,Q.skeleton);i===H||X(i,H)||(Y.b.Warn(`${f}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),Q.skeleton=H.index)}else Y.b.Warn(`${f}: Failed to find common root`)}const X={};for(const i of Q.joints){const S=b.Get(`${f}/joints/${i}`,this._gltf.nodes,i);this._loadBone(S,Q,H,X)}}_findSkeletonRootNode(f,Q){if(0===Q.length)return null;const H={};for(const i of Q){const Q=[];let X=b.Get(`${f}/${i}`,this._gltf.nodes,i);for(;-1!==X.index;)Q.unshift(X),X=X.parent;H[i]=Q}let X=null;for(let i=0;;++i){let f=H[Q[0]];if(i>=f.length)return X;const S=f[i];for(let x=1;x<Q.length;++x)if(f=H[Q[x]],i>=f.length||S!==f[i])return X;X=S}}_loadBone(f,Q,H,X){f._isJoint=!0;let i=X[f.index];if(i)return i;let S=null;f.index!==Q.skeleton&&(f.parent&&-1!==f.parent.index?S=this._loadBone(f.parent,Q,H,X):void 0!==Q.skeleton&&Y.b.Warn(`/skins/${Q.index}/skeleton: Skeleton node is not a common root`));const x=Q.joints.indexOf(f.index);return i=new B.e(f.name||`joint${f.index}`,H,S,this._getNodeMatrix(f),null,null,x),X[f.index]=i,this._postSceneLoadActions.push((()=>{i.linkTransformNode(f._babylonTransformNode)})),i}_loadSkinInverseBindMatricesDataAsync(f,Q){if(void 0==Q.inverseBindMatrices)return Promise.resolve(null);const H=b.Get(`${f}/inverseBindMatrices`,this._gltf.accessors,Q.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${H.index}`,H)}_updateBoneMatrices(f,Q){for(const H of f.bones){const f=i.e.Identity(),X=H._index;Q&&-1!==X&&(i.e.FromArrayToRef(Q,16*X,f),f.invertToRef(f));const S=H.getParent();S&&f.multiplyToRef(S.getAbsoluteInverseBindMatrix(),f),H.Be(f,!1,!1),H._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(f){return f.matrix?i.e.Zd(f.matrix):i.e.Compose(f.scale?i.p.Zd(f.scale):i.p.One(),f.rotation?i.i.Zd(f.rotation):i.i.Identity(),f.translation?i.p.Zd(f.translation):i.p.Zero())}loadCameraAsync(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const X=this._extensionsLoadCameraAsync(f,Q,H);if(X)return X;const S=new Array;this.logOpen(`${f} ${Q.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const x=new Z.b(Q.name||`camera${Q.index}`,i.p.Zero(),this._babylonScene,!1);switch(x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x.ignoreParentScaling=!0,Q._babylonCamera=x,x.rotation.set(0,Math.PI,0),Q.type){case"perspective":{const H=Q.perspective;if(!H)throw new Error(`${f}: Camera perspective properties are missing`);x.fov=H.yfov,x.nj=H.znear,x.maxZ=H.zfar||0;break}case"orthographic":if(!Q.orthographic)throw new Error(`${f}: Camera orthographic properties are missing`);x.mode=K.c.ORTHOGRAPHIC_CAMERA,x.orthoLeft=-Q.orthographic.xmag,x.orthoRight=Q.orthographic.xmag,x.orthoBottom=-Q.orthographic.ymag,x.orthoTop=Q.orthographic.ymag,x.nj=Q.orthographic.znear,x.maxZ=Q.orthographic.zfar;break;default:throw new Error(`${f}: Invalid camera type (${Q.type})`)}return o.AddPointerMetadata(x,f),this._parent.onCameraLoadedObservable.notifyObservers(x),H(x),this.logClose(),Promise.all(S).then((()=>x))}_loadAnimationsAsync(){const f=this._gltf.animations;if(!f)return Promise.resolve();const Q=new Array;for(let H=0;H<f.length;H++){const X=f[H];Q.push(this.loadAnimationAsync(`/animations/${X.index}`,X).then((f=>{0===f.targetedAnimations.length&&f.dispose()})))}return Promise.all(Q).then((()=>{}))}loadAnimationAsync(f,Q){const X=this._extensionsLoadAnimationAsync(f,Q);return X||H.e(43).then(H.bind(H,12546)).then((H=>{let{AnimationGroup:X}=H;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new X(Q.name||`animation${Q.index}`,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q._babylonAnimationGroup=i;const S=new Array;b.Assign(Q.channels),b.Assign(Q.samplers);for(const x of Q.channels)S.push(this._loadAnimationChannelAsync(`${f}/channels/${x.index}`,f,Q,x,((f,Q)=>{f.animations=f.animations||[],f.animations.push(Q),i.addTargetedAnimation(Q,f)})));return Promise.all(S).then((()=>(i.normalize(0),i)))}))}_loadAnimationChannelAsync(f,Q,H,X,i){const S=this._extensionsLoadAnimationChannelAsync(f,Q,H,X,i);if(S)return S;if(void 0==X.target.node)return Promise.resolve();const x=b.Get(`${f}/target/node`,this._gltf.nodes,X.target.node),K=X.target.path,Z="weights"===K;if(Z&&!x._numMorphTargets||!Z&&!x._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!Z&&!x._isJoint)return Promise.resolve();let B;switch(K){case"translation":B=j.translation;break;case"rotation":B=j.rotation;break;case"scale":B=j.scale;break;case"weights":B=j.weights;break;default:throw new Error(`${f}/target/path: Invalid value (${X.target.path})`)}const N={object:x,info:B};return this._loadAnimationChannelFromTargetInfoAsync(f,Q,H,X,N,i)}_loadAnimationChannelFromTargetInfoAsync(f,Q,H,X,i,S){const x=this.parent.targetFps,K=1/x,Z=b.Get(`${f}/sampler`,H.samplers,X.sampler);return this._loadAnimationSamplerAsync(`${Q}/samplers/${X.sampler}`,Z).then((f=>{let Q=0;const Z=i.object,B=i.info;for(const i of B){const B=i.getStride(Z),N=f.input,J=f.output,g=new Array(N.length);let z=0;switch(f.interpolation){case"STEP":for(let f=0;f<N.length;f++){const Q=i.getValue(Z,J,z,1);z+=B,g[f]={frame:N[f]*x,value:Q,interpolation:1}}break;case"CUBICSPLINE":for(let f=0;f<N.length;f++){const Q=i.getValue(Z,J,z,K);z+=B;const H=i.getValue(Z,J,z,1);z+=B;const X=i.getValue(Z,J,z,K);z+=B,g[f]={frame:N[f]*x,inTangent:Q,value:H,outTangent:X}}break;case"LINEAR":for(let f=0;f<N.length;f++){const Q=i.getValue(Z,J,z,1);z+=B,g[f]={frame:N[f]*x,value:Q}}}if(z>0){const f=`${H.name||`animation${H.index}`}_channel${X.index}_${Q}`;i.buildAnimations(Z,f,x,g,((f,H)=>{++Q,S(f,H)}))}}}))}_loadAnimationSamplerAsync(f,Q){if(Q._data)return Q._data;const H=Q.interpolation||"LINEAR";switch(H){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${f}/interpolation: Invalid value (${Q.interpolation})`)}const X=b.Get(`${f}/input`,this._gltf.accessors,Q.input),i=b.Get(`${f}/output`,this._gltf.accessors,Q.output);return Q._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${X.index}`,X),this._loadFloatAccessorAsync(`/accessors/${i.index}`,i)]).then((f=>{let[Q,X]=f;return{input:Q,interpolation:H,output:X}})),Q._data}loadBufferAsync(f,Q,H,X){const i=this._extensionsLoadBufferAsync(f,Q,H,X);if(i)return i;if(!Q._data)if(Q.uri)Q._data=this.loadUriAsync(`${f}/uri`,Q,Q.uri);else{if(!this._bin)throw new Error(`${f}: Uri is missing or the binary glTF is missing its binary chunk`);Q._data=this._bin.readAsync(0,Q.byteLength)}return Q._data.then((Q=>{try{return new Uint8Array(Q.buffer,Q.byteOffset+H,X)}catch(i){throw new Error(`${f}: ${i.message}`)}}))}loadBufferViewAsync(f,Q){const H=this._extensionsLoadBufferViewAsync(f,Q);if(H)return H;if(Q._data)return Q._data;const X=b.Get(`${f}/buffer`,this._gltf.buffers,Q.buffer);return Q._data=this.loadBufferAsync(`/buffers/${X.index}`,X,Q.byteOffset||0,Q.byteLength),Q._data}_loadAccessorAsync(f,Q,H){if(Q._data)return Q._data;const X=o._GetNumComponents(f,Q.type),i=X*m.e.GetTypeByteLength(Q.componentType),S=X*Q.count;if(void 0==Q.bufferView)Q._data=Promise.resolve(new H(S));else{const x=b.Get(`${f}/bufferView`,this._gltf.bufferViews,Q.bufferView);Q._data=this.loadBufferViewAsync(`/bufferViews/${x.index}`,x).then((K=>{if(5126!==Q.componentType||Q.normalized||x.byteStride&&x.byteStride!==i){const f=new H(S);return m.e.ForEach(K,Q.byteOffset||0,x.byteStride||i,X,Q.componentType,f.length,Q.normalized||!1,((Q,H)=>{f[H]=Q})),f}return o._GetTypedArray(f,Q.componentType,K,Q.byteOffset,S)}))}if(Q.sparse){const S=Q.sparse;Q._data=Q._data.then((x=>{const K=x,Z=b.Get(`${f}/sparse/indices/bufferView`,this._gltf.bufferViews,S.indices.bufferView),B=b.Get(`${f}/sparse/values/bufferView`,this._gltf.bufferViews,S.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z),this.loadBufferViewAsync(`/bufferViews/${B.index}`,B)]).then((x=>{let[Z,B]=x;const N=o._GetTypedArray(`${f}/sparse/indices`,S.indices.componentType,Z,S.indices.byteOffset,S.count),J=X*S.count;let g;if(5126!==Q.componentType||Q.normalized){const x=o._GetTypedArray(`${f}/sparse/values`,Q.componentType,B,S.values.byteOffset,J);g=new H(J),m.e.ForEach(x,0,i,X,Q.componentType,g.length,Q.normalized||!1,((f,Q)=>{g[Q]=f}))}else g=o._GetTypedArray(`${f}/sparse/values`,Q.componentType,B,S.values.byteOffset,J);let z=0;for(let f=0;f<N.length;f++){let Q=N[f]*X;for(let f=0;f<X;f++)K[Q++]=g[z++]}return K}))}))}return Q._data}_loadFloatAccessorAsync(f,Q){return this._loadAccessorAsync(f,Q,Float32Array)}_loadIndicesAccessorAsync(f,Q){if("SCALAR"!==Q.type)throw new Error(`${f}/type: Invalid value ${Q.type}`);if(5121!==Q.componentType&&5123!==Q.componentType&&5125!==Q.componentType)throw new Error(`${f}/componentType: Invalid value ${Q.componentType}`);if(Q._data)return Q._data;if(Q.sparse){const H=o._GetTypedArrayConstructor(`${f}/componentType`,Q.componentType);Q._data=this._loadAccessorAsync(f,Q,H)}else{const H=b.Get(`${f}/bufferView`,this._gltf.bufferViews,Q.bufferView);Q._data=this.loadBufferViewAsync(`/bufferViews/${H.index}`,H).then((H=>o._GetTypedArray(f,Q.componentType,H,Q.byteOffset,Q.count)))}return Q._data}_loadVertexBufferViewAsync(f){if(f._babylonBuffer)return f._babylonBuffer;const Q=this._babylonScene.getEngine();return f._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${f.index}`,f).then((f=>new m.d(Q,f,!1))),f._babylonBuffer}_loadVertexAccessorAsync(f,Q,H){var X;if(null!==(X=Q._babylonVertexBuffer)&&void 0!==X&&X[H])return Q._babylonVertexBuffer[H];Q._babylonVertexBuffer||(Q._babylonVertexBuffer={});const i=this._babylonScene.getEngine();if(Q.sparse||void 0==Q.bufferView)Q._babylonVertexBuffer[H]=this._loadFloatAccessorAsync(f,Q).then((f=>new m.e(i,f,H,!1)));else{const X=b.Get(`${f}/bufferView`,this._gltf.bufferViews,Q.bufferView);Q._babylonVertexBuffer[H]=this._loadVertexBufferViewAsync(X).then((S=>{const x=o._GetNumComponents(f,Q.type);return new m.e(i,S,H,!1,void 0,X.byteStride,void 0,Q.byteOffset,x,Q.componentType,Q.normalized,!0,void 0,!0)}))}return Q._babylonVertexBuffer[H]}_loadMaterialMetallicRoughnessPropertiesAsync(f,Q,H){if(!(H instanceof s))throw new Error(`${f}: Material type not supported`);const X=new Array;return Q&&(Q.baseColorFactor?(H.albedoColor=S.e.Zd(Q.baseColorFactor),H.alpha=Q.baseColorFactor[3]):H.albedoColor=S.e.White(),H.metallic=void 0==Q.metallicFactor?1:Q.metallicFactor,H.roughness=void 0==Q.roughnessFactor?1:Q.roughnessFactor,Q.baseColorTexture&&X.push(this.loadTextureInfoAsync(`${f}/baseColorTexture`,Q.baseColorTexture,(f=>{f.name=`${H.name} (Base Color)`,H.albedoTexture=f}))),Q.metallicRoughnessTexture&&(Q.metallicRoughnessTexture.nonColorData=!0,X.push(this.loadTextureInfoAsync(`${f}/metallicRoughnessTexture`,Q.metallicRoughnessTexture,(f=>{f.name=`${H.name} (Metallic Roughness)`,H.metallicTexture=f}))),H.useMetallnessFromMetallicTextureBlue=!0,H.useRoughnessFromMetallicTextureGreen=!0,H.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(X).then((()=>{}))}_loadMaterialAsync(f,Q,H,X){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const S=this._extensionsLoadMaterialAsync(f,Q,H,X,i);if(S)return S;Q._data=Q._data||{};let x=Q._data[X];if(!x){this.logOpen(`${f} ${Q.name||""}`);const H=this.createMaterial(f,Q,X);x={babylonMaterial:H,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(f,Q,H)},Q._data[X]=x,o.AddPointerMetadata(H,f),this._parent.onMaterialLoadedObservable.notifyObservers(H),this.logClose()}return H&&(x.babylonMeshes.push(H),H.fe.addOnce((()=>{const f=x.babylonMeshes.indexOf(H);-1!==f&&x.babylonMeshes.splice(f,1)}))),i(x.babylonMaterial),x.promise.then((()=>x.babylonMaterial))}_createDefaultMaterial(f,Q){this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new s(f,this._babylonScene);return H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H.fillMode=Q,H.enableSpecularAntiAliasing=!0,H.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,H.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,H.transparencyMode=s.PBRMATERIAL_OPAQUE,H.metallic=1,H.roughness=1,H}createMaterial(f,Q,H){const X=this._extensionsCreateMaterial(f,Q,H);if(X)return X;const i=Q.name||`material${Q.index}`;return this._createDefaultMaterial(i,H)}loadMaterialPropertiesAsync(f,Q,H){const X=this._extensionsLoadMaterialPropertiesAsync(f,Q,H);if(X)return X;const i=new Array;return i.push(this.loadMaterialBasePropertiesAsync(f,Q,H)),Q.pbrMetallicRoughness&&i.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${f}/pbrMetallicRoughness`,Q.pbrMetallicRoughness,H)),this.loadMaterialAlphaProperties(f,Q,H),Promise.all(i).then((()=>{}))}loadMaterialBasePropertiesAsync(f,Q,H){if(!(H instanceof s))throw new Error(`${f}: Material type not supported`);const X=new Array;return H.emissiveColor=Q.emissiveFactor?S.e.Zd(Q.emissiveFactor):new S.e(0,0,0),Q.doubleSided&&(H.we=!1,H.twoSidedLighting=!0),Q.normalTexture&&(Q.normalTexture.nonColorData=!0,X.push(this.loadTextureInfoAsync(`${f}/normalTexture`,Q.normalTexture,(f=>{f.name=`${H.name} (Normal)`,H.bumpTexture=f}))),H.invertNormalMapX=!this._babylonScene.useRightHandedSystem,H.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=Q.normalTexture.scale&&H.bumpTexture&&(H.bumpTexture.level=Q.normalTexture.scale),H.forceIrradianceInFragment=!0),Q.occlusionTexture&&(Q.occlusionTexture.nonColorData=!0,X.push(this.loadTextureInfoAsync(`${f}/occlusionTexture`,Q.occlusionTexture,(f=>{f.name=`${H.name} (Occlusion)`,H.ambientTexture=f}))),H.useAmbientInGrayScale=!0,void 0!=Q.occlusionTexture.strength&&(H.ambientTextureStrength=Q.occlusionTexture.strength)),Q.emissiveTexture&&X.push(this.loadTextureInfoAsync(`${f}/emissiveTexture`,Q.emissiveTexture,(f=>{f.name=`${H.name} (Emissive)`,H.emissiveTexture=f}))),Promise.all(X).then((()=>{}))}loadMaterialAlphaProperties(f,Q,H){if(!(H instanceof s))throw new Error(`${f}: Material type not supported`);switch(Q.alphaMode||"OPAQUE"){case"OPAQUE":H.transparencyMode=s.PBRMATERIAL_OPAQUE,H.alpha=1;break;case"MASK":H.transparencyMode=s.PBRMATERIAL_ALPHATEST,H.alphaCutOff=void 0==Q.alphaCutoff?.5:Q.alphaCutoff,H.albedoTexture&&(H.albedoTexture.qc=!0);break;case"BLEND":H.transparencyMode=s.PBRMATERIAL_ALPHABLEND,H.albedoTexture&&(H.albedoTexture.qc=!0,H.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${f}/alphaMode: Invalid value (${Q.alphaMode})`)}}loadTextureInfoAsync(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const X=this._extensionsLoadTextureInfoAsync(f,Q,H);if(X)return X;if(this.logOpen(`${f}`),Q.texCoord>=6)throw new Error(`${f}/texCoord: Invalid value (${Q.texCoord})`);const i=b.Get(`${f}/index`,this._gltf.textures,Q.index);i._textureInfo=Q;const S=this._loadTextureAsync(`/textures/${Q.index}`,i,(X=>{X.coordinatesIndex=Q.texCoord||0,o.AddPointerMetadata(X,f),this._parent.onTextureLoadedObservable.notifyObservers(X),H(X)}));return this.logClose(),S}_loadTextureAsync(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const X=this._extensionsLoadTextureAsync(f,Q,H);if(X)return X;this.logOpen(`${f} ${Q.name||""}`);const i=void 0==Q.sampler?o.DefaultSampler:b.Get(`${f}/sampler`,this._gltf.samplers,Q.sampler),S=b.Get(`${f}/source`,this._gltf.images,Q.source),x=this._createTextureAsync(f,i,S,H,void 0,!Q._textureInfo.nonColorData);return this.logClose(),x}_createTextureAsync(f,Q,H){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},S=arguments.length>4?arguments[4]:void 0,x=arguments.length>5?arguments[5]:void 0;const K=this._loadSampler(`/samplers/${Q.index}`,Q),Z=new Array,B=new X;this._babylonScene._blockEntityCollection=!!this._assetContainer;const N={noMipmap:K.noMipMaps,invertY:!1,samplingMode:K.samplingMode,X:()=>{this._disposed||B.resolve()},onError:(Q,H)=>{this._disposed||B.reject(new Error(`${f}: ${H&&H.message?H.message:Q||"Failed to load texture"}`))},mimeType:H.mimeType,loaderOptions:S,useSRGBBuffer:!!x&&this._parent.useSRGBBuffers},J=new F.b(null,this._babylonScene,N);return J._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z.push(B.promise),Z.push(this.loadImageAsync(`/images/${H.index}`,H).then((f=>{const Q=H.uri||`${this._fileName}#image${H.index}`,X=`data:${this._uniqueRootUrl}${Q}`;J.updateURL(X,f);const i=J.getInternalTexture();i&&(i.label=H.name)}))),J.wrapU=K.wrapU,J.wrapV=K.wrapV,i(J),this._parent.useGltfTextureNames&&(J.name=H.name||H.uri||`image${H.index}`),Promise.all(Z).then((()=>J))}_loadSampler(f,Q){return Q._data||(Q._data={noMipMaps:9728===Q.minFilter||9729===Q.minFilter,samplingMode:o._GetTextureSamplingMode(f,Q),wrapU:o._GetTextureWrapMode(`${f}/wrapS`,Q.wrapS),wrapV:o._GetTextureWrapMode(`${f}/wrapT`,Q.wrapT)}),Q._data}loadImageAsync(f,Q){if(!Q._data){if(this.logOpen(`${f} ${Q.name||""}`),Q.uri)Q._data=this.loadUriAsync(`${f}/uri`,Q,Q.uri);else{const H=b.Get(`${f}/bufferView`,this._gltf.bufferViews,Q.bufferView);Q._data=this.loadBufferViewAsync(`/bufferViews/${H.index}`,H)}this.logClose()}return Q._data}loadUriAsync(f,Q,H){const X=this._extensionsLoadUriAsync(f,Q,H);if(X)return X;if(!o._ValidateUri(H))throw new Error(`${f}: '${H}' is invalid`);if((0,A.i)(H)){const Q=new Uint8Array((0,A.b)(H));return this.log(`${f}: Decoded ${H.substring(0,64)}... (${Q.length} bytes)`),Promise.resolve(Q)}return this.log(`${f}: Loading ${H}`),this._parent.preprocessUrlAsync(this._rootUrl+H).then((Q=>new Promise(((X,i)=>{this._parent._loadFile(this._babylonScene,Q,(Q=>{this._disposed||(this.log(`${f}: Loaded ${H} (${Q.byteLength} bytes)`),X(new Uint8Array(Q)))}),!0,(Q=>{i(new A.j(`${f}: Failed to load '${H}'${Q?": "+Q.status+" "+Q.statusText:""}`,Q))}))}))))}static AddPointerMetadata(f,Q){f.metadata=f.metadata||{};const H=f._internalMetadata=f._internalMetadata||{},X=H.ij=H.ij||{};(X.pointers=X.pointers||[]).push(Q)}static _GetTextureWrapMode(f,Q){switch(Q=void 0==Q?10497:Q){case 33071:return F.b.CLAMP_ADDRESSMODE;case 33648:return F.b.MIRROR_ADDRESSMODE;case 10497:return F.b.WRAP_ADDRESSMODE;default:return Y.b.Warn(`${f}: Invalid value (${Q})`),F.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(f,Q){const H=void 0==Q.magFilter?9729:Q.magFilter,X=void 0==Q.minFilter?9987:Q.minFilter;if(9729===H)switch(X){case 9728:return F.b.LINEAR_NEAREST;case 9729:return F.b.LINEAR_LINEAR;case 9984:return F.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return F.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return F.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return F.b.LINEAR_LINEAR_MIPLINEAR;default:return Y.b.Warn(`${f}/minFilter: Invalid value (${X})`),F.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==H&&Y.b.Warn(`${f}/magFilter: Invalid value (${H})`),X){case 9728:return F.b.NEAREST_NEAREST;case 9729:return F.b.NEAREST_LINEAR;case 9984:return F.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return F.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return F.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return F.b.NEAREST_LINEAR_MIPLINEAR;default:return Y.b.Warn(`${f}/minFilter: Invalid value (${X})`),F.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(f,Q){switch(Q){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${f}: Invalid component type ${Q}`)}}static _GetTypedArray(f,Q,H,X,i){const S=H.buffer;X=H.byteOffset+(X||0);const x=o._GetTypedArrayConstructor(`${f}/componentType`,Q),K=m.e.GetTypeByteLength(Q);return X%K!==0?(Y.b.Warn(`${f}: Copying buffer as byte offset (${X}) is not a multiple of component type byte length (${K})`),new x(S.slice(X,X+i*K),0)):new x(S,X,i)}static _GetNumComponents(f,Q){switch(Q){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${f}: Invalid type (${Q})`)}static _ValidateUri(f){return x.g.IsBase64(f)||-1===f.indexOf("..")}static _GetDrawMode(f,Q){switch(void 0==Q&&(Q=4),Q){case 0:return e.e.PointListDrawMode;case 1:return e.e.LineListDrawMode;case 2:return e.e.LineLoopDrawMode;case 3:return e.e.LineStripDrawMode;case 4:return e.e.TriangleFillMode;case 5:return e.e.TriangleStripDrawMode;case 6:return e.e.TriangleFanDrawMode}throw new Error(`${f}: Invalid mesh primitive mode (${Q})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const f=new Array;if(this._gltf.materials)for(const Q of this._gltf.materials)if(Q._data)for(const H in Q._data){const X=Q._data[H];for(const Q of X.babylonMeshes){Q.re(!0);const H=X.babylonMaterial;f.push(H.forceCompilationAsync(Q)),f.push(H.forceCompilationAsync(Q,{useInstances:!0})),this._parent.useClipPlane&&(f.push(H.forceCompilationAsync(Q,{clipPlane:!0})),f.push(H.forceCompilationAsync(Q,{clipPlane:!0,useInstances:!0})))}}return Promise.all(f).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const f=new Array,Q=this._babylonScene.lights;for(const H of Q){const Q=H.getShadowGenerator();Q&&f.push(Q.forceCompilationAsync())}return Promise.all(f).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(f){for(const Q of this._extensions)Q.enabled&&f(Q)}_applyExtensions(f,Q,H){for(const X of this._extensions)if(X.enabled){const i=`${X.name}.${Q}`,S=f;S._activeLoaderExtensionFunctions=S._activeLoaderExtensionFunctions||{};const x=S._activeLoaderExtensionFunctions;if(!x[i]){x[i]=!0;try{const f=H(X);if(f)return f}finally{delete x[i]}}}return null}_extensionsOnLoading(){this._forEachExtensions((f=>f.onLoading&&f.onLoading()))}_extensionsOnReady(){this._forEachExtensions((f=>f.onReady&&f.onReady()))}_extensionsLoadSceneAsync(f,Q){return this._applyExtensions(Q,"loadScene",(H=>H.loadSceneAsync&&H.loadSceneAsync(f,Q)))}_extensionsLoadNodeAsync(f,Q,H){return this._applyExtensions(Q,"loadNode",(X=>X.loadNodeAsync&&X.loadNodeAsync(f,Q,H)))}_extensionsLoadCameraAsync(f,Q,H){return this._applyExtensions(Q,"loadCamera",(X=>X.loadCameraAsync&&X.loadCameraAsync(f,Q,H)))}_extensionsLoadVertexDataAsync(f,Q,H){return this._applyExtensions(Q,"loadVertexData",(X=>X._loadVertexDataAsync&&X._loadVertexDataAsync(f,Q,H)))}_extensionsLoadMeshPrimitiveAsync(f,Q,H,X,i,S){return this._applyExtensions(i,"loadMeshPrimitive",(x=>x._loadMeshPrimitiveAsync&&x._loadMeshPrimitiveAsync(f,Q,H,X,i,S)))}_extensionsLoadMaterialAsync(f,Q,H,X,i){return this._applyExtensions(Q,"loadMaterial",(S=>S._loadMaterialAsync&&S._loadMaterialAsync(f,Q,H,X,i)))}_extensionsCreateMaterial(f,Q,H){return this._applyExtensions(Q,"createMaterial",(X=>X.createMaterial&&X.createMaterial(f,Q,H)))}_extensionsLoadMaterialPropertiesAsync(f,Q,H){return this._applyExtensions(Q,"loadMaterialProperties",(X=>X.loadMaterialPropertiesAsync&&X.loadMaterialPropertiesAsync(f,Q,H)))}_extensionsLoadTextureInfoAsync(f,Q,H){return this._applyExtensions(Q,"loadTextureInfo",(X=>X.loadTextureInfoAsync&&X.loadTextureInfoAsync(f,Q,H)))}_extensionsLoadTextureAsync(f,Q,H){return this._applyExtensions(Q,"loadTexture",(X=>X._loadTextureAsync&&X._loadTextureAsync(f,Q,H)))}_extensionsLoadAnimationAsync(f,Q){return this._applyExtensions(Q,"loadAnimation",(H=>H.loadAnimationAsync&&H.loadAnimationAsync(f,Q)))}_extensionsLoadAnimationChannelAsync(f,Q,H,X,i){return this._applyExtensions(H,"loadAnimationChannel",(S=>S._loadAnimationChannelAsync&&S._loadAnimationChannelAsync(f,Q,H,X,i)))}_extensionsLoadSkinAsync(f,Q,H){return this._applyExtensions(H,"loadSkin",(X=>X._loadSkinAsync&&X._loadSkinAsync(f,Q,H)))}_extensionsLoadUriAsync(f,Q,H){return this._applyExtensions(Q,"loadUri",(X=>X._loadUriAsync&&X._loadUriAsync(f,Q,H)))}_extensionsLoadBufferViewAsync(f,Q){return this._applyExtensions(Q,"loadBufferView",(H=>H.loadBufferViewAsync&&H.loadBufferViewAsync(f,Q)))}_extensionsLoadBufferAsync(f,Q,H,X){return this._applyExtensions(Q,"loadBuffer",(i=>i.loadBufferAsync&&i.loadBufferAsync(f,Q,H,X)))}static LoadExtensionAsync(f,Q,H,X){if(!Q.extensions)return null;const i=Q.extensions[H];return i?X(`${f}/extensions/${H}`,i):null}static LoadExtraAsync(f,Q,H,X){if(!Q.extras)return null;const i=Q.extras[H];return i?X(`${f}/extras/${H}`,i):null}isExtensionUsed(f){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(f)}logOpen(f){this._parent._logOpen(f)}logClose(){this._parent._logClose()}log(f){this._parent._log(f)}startPerformanceCounter(f){this._parent._startPerformanceCounter(f)}endPerformanceCounter(f){this._parent._endPerformanceCounter(f)}}o.DefaultSampler={index:-1},L.d._CreateGLTF2Loader=f=>new o(f);var p=H(1483),C=H(10252),ff=H(11946);class Qf extends ff.e{constructor(f,Q,H){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],x=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",f),this._texture=f.getEngine().createRawCubeTexture(Q,H,X,i,S,x,K,Z)}update(f,Q,H,X){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,f,Q,H,X,i)}updateRGBDAsync(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,C.j)(this._texture,f,Q,H,X).then((()=>{}))}clone(){return d.b.Clone((()=>{const f=this.va(),Q=this._texture,H=new Qf(f,Q._bufferViewArray,Q.width,Q.format,Q.type,Q.generateMipMaps,Q.invertY,Q.samplingMode,Q._compression);return 13===Q.source&&H.updateRGBDAsync(Q._bufferViewArrayArray,Q._sphericalPolynomial,Q._lodGenerationScale,Q._lodGenerationOffset),H}),this)}}const Hf="EXT_lights_image_based";class Xf{constructor(f){this.name=Hf,this._loader=f,this.enabled=this._loader.isExtensionUsed(Hf)}dispose(){this._loader=null,delete this._lights}onLoading(){const f=this._loader.ij.extensions;if(f&&f[this.name]){const Q=f[this.name];this._lights=Q.lights}}loadSceneAsync(f,Q){return o.LoadExtensionAsync(f,Q,this.name,((H,X)=>{this._loader._allMaterialsDirtyRequired=!0;const i=new Array;i.push(this._loader.loadSceneAsync(f,Q)),this._loader.logOpen(`${H}`);const S=b.Get(`${H}/light`,this._lights,X.eb);return i.push(this._loadLightAsync(`/extensions/${this.name}/lights/${X.eb}`,S).then((f=>{this._loader.babylonScene.environmentTexture=f}))),this._loader.logClose(),Promise.all(i).then((()=>{}))}))}_loadLightAsync(f,Q){if(!Q._loaded){const H=new Array;this._loader.logOpen(`${f}`);const X=new Array(Q.specularImages.length);for(let i=0;i<Q.specularImages.length;i++){const S=Q.specularImages[i];X[i]=new Array(S.length);for(let Q=0;Q<S.length;Q++){const x=`${f}/specularImages/${i}/${Q}`;this._loader.logOpen(`${x}`);const K=S[Q],Z=b.Get(x,this._loader.ij.images,K);H.push(this._loader.loadImageAsync(`/images/${K}`,Z).then((f=>{X[i][Q]=f}))),this._loader.logClose()}}this._loader.logClose(),Q._loaded=Promise.all(H).then((()=>{const H=new Qf(this._loader.babylonScene,null,Q.specularImageSize);if(H.name=Q.name||"environment",Q._babylonTexture=H,void 0!=Q.rj&&(H.level=Q.rj),Q.rotation){let f=i.i.Zd(Q.rotation);this._loader.babylonScene.useRightHandedSystem||(f=i.i.Inverse(f)),i.e.FromQuaternionToRef(f,H.getReflectionTextureMatrix())}if(!Q.irradianceCoefficients)throw new Error(`${f}: Irradiance coefficients are missing`);const S=p.b.Zd(Q.irradianceCoefficients);S.scaleInPlace(Q.rj),S.convertIrradianceToLambertianRadiance();const x=p.d.FromHarmonics(S),K=(X.length-1)/Math.log2(Q.specularImageSize);return H.updateRGBDAsync(X,x,K)}))}return Q._loaded.then((()=>Q._babylonTexture))}}h(Hf),y(Hf,!0,(f=>new Xf(f)));H(11950);const Sf="EXT_mesh_gpu_instancing";class xf{constructor(f){this.name=Sf,this._loader=f,this.enabled=this._loader.isExtensionUsed(Sf)}dispose(){this._loader=null}loadNodeAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((f,X)=>{this._loader._disableInstancedMesh++;const S=this._loader.loadNodeAsync(`/nodes/${Q.index}`,Q,H);if(this._loader._disableInstancedMesh--,!Q._primitiveBabylonMeshes)return S;const x=new Array;let K=0;const Z=Q=>{if(void 0==X.attributes[Q])return void x.push(Promise.resolve(null));const H=b.Get(`${f}/attributes/${Q}`,this._loader.ij.accessors,X.attributes[Q]);if(x.push(this._loader._loadFloatAccessorAsync(`/accessors/${H.bufferView}`,H)),0===K)K=H.count;else if(K!==H.count)throw new Error(`${f}/attributes: Instance buffer accessors do not have the same count.`)};return Z("TRANSLATION"),Z("ROTATION"),Z("SCALE"),S.then((f=>Promise.all(x).then((H=>{let[X,S,x]=H;const Z=new Float32Array(16*K);i.l.Wd[0].Xd(0,0,0),i.l.Quaternion[0].Xd(0,0,0,1),i.l.Wd[1].Xd(1,1,1);for(let f=0;f<K;++f)X&&i.p.FromArrayToRef(X,3*f,i.l.Wd[0]),S&&i.i.FromArrayToRef(S,4*f,i.l.Quaternion[0]),x&&i.p.FromArrayToRef(x,3*f,i.l.Wd[1]),i.e.ComposeToRef(i.l.Wd[1],i.l.Quaternion[0],i.l.Wd[0],i.l.Matrix[0]),i.l.Matrix[0].copyToArray(Z,16*f);for(const f of Q._primitiveBabylonMeshes)f.$j("matrix",Z,16,!0);return f}))))}))}}h(Sf),y(Sf,!0,(f=>new xf(f)));class Kf{static get Default(){return Kf._Default||(Kf._Default=new Kf),Kf._Default}constructor(){const f=Kf.Configuration.decoder;this._decoderModulePromise=x.g.LoadBabylonScriptAsync(f.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(f,Q,H,X,i){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const S=await MeshoptDecoder.decodeGltfBufferAsync(Q,H,f,X,i);return MeshoptDecoder.useWorkers(0),S}))}}Kf.Configuration={decoder:{url:`${x.g._DefaultCdnUrl}/meshopt_decoder.js`}},Kf._Default=null;const Zf="EXT_meshopt_compression";class Bf{constructor(f){this.name=Zf,this.enabled=f.isExtensionUsed(Zf),this._loader=f}dispose(){this._loader=null}loadBufferViewAsync(f,Q){return o.LoadExtensionAsync(f,Q,this.name,((H,X)=>{const i=Q;if(i._meshOptData)return i._meshOptData;const S=b.Get(`${f}/buffer`,this._loader.ij.buffers,X.buffer);return i._meshOptData=this._loader.loadBufferAsync(`/buffers/${S.index}`,S,X.byteOffset||0,X.byteLength).then((f=>Kf.Default.decodeGltfBufferAsync(f,X.count,X.byteStride,X.mode,X.filter))),i._meshOptData}))}}h(Zf),y(Zf,!0,(f=>new Bf(f)));const Nf="EXT_texture_webp";class Jf{constructor(f){this.name=Nf,this._loader=f,this.enabled=f.isExtensionUsed(Nf)}dispose(){this._loader=null}_loadTextureAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>{const S=void 0==Q.sampler?o.DefaultSampler:b.Get(`${f}/sampler`,this._loader.ij.samplers,Q.sampler),x=b.Get(`${X}/source`,this._loader.ij.images,i.source);return this._loader._createTextureAsync(f,S,x,(f=>{H(f)}),void 0,!Q._textureInfo.nonColorData)}))}}h(Nf),y(Nf,!0,(f=>new Jf(f)));const gf="EXT_texture_avif";class zf{constructor(f){this.name=gf,this._loader=f,this.enabled=f.isExtensionUsed(gf)}dispose(){this._loader=null}_loadTextureAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>{const S=void 0==Q.sampler?o.DefaultSampler:b.Get(`${f}/sampler`,this._loader.ij.samplers,Q.sampler),x=b.Get(`${X}/source`,this._loader.ij.images,i.source);return this._loader._createTextureAsync(f,S,x,(f=>{H(f)}),void 0,!Q._textureInfo.nonColorData)}))}}h(gf),y(gf,!0,(f=>new zf(f)));var vf=H(11953);const Yf="KHR_draco_mesh_compression";class Of{constructor(f){this.name=Yf,this.useNormalizedFlagFromAccessor=!0,this._loader=f,this.enabled=vf.d.DecoderAvailable&&this._loader.isExtensionUsed(Yf)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>{if(void 0!=Q.mode&&4!==Q.mode&&5!==Q.mode)throw new Error(`${f}: Unsupported mode ${Q.mode}`);const S={},x={},K=(f,X)=>{const K=i.attributes[f];if(void 0!=K&&(H._delayInfo=H._delayInfo||[],-1===H._delayInfo.indexOf(X)&&H._delayInfo.push(X),S[X]=K,this.useNormalizedFlagFromAccessor)){const H=b.TryGet(this._loader.ij.accessors,Q.attributes[f]);H&&(x[X]=H.normalized||!1)}};K("POSITION",m.e.PositionKind),K("NORMAL",m.e.NormalKind),K("TANGENT",m.e.TangentKind),K("TEXCOORD_0",m.e.UVKind),K("TEXCOORD_1",m.e.UV2Kind),K("TEXCOORD_2",m.e.UV3Kind),K("TEXCOORD_3",m.e.UV4Kind),K("TEXCOORD_4",m.e.UV5Kind),K("TEXCOORD_5",m.e.UV6Kind),K("JOINTS_0",m.e.MatricesIndicesKind),K("WEIGHTS_0",m.e.MatricesWeightsKind),K("COLOR_0",m.e.ColorKind);const Z=b.Get(X,this._loader.ij.bufferViews,i.bufferView);return Z._dracoBabylonGeometry||(Z._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z).then((Q=>(this.dracoCompression||vf.d.Default)._decodeMeshToGeometryForGltfAsync(H.name,this._loader.babylonScene,Q,S,x).catch((Q=>{throw new Error(`${f}: ${Q.message}`)}))))),Z._dracoBabylonGeometry}))}}h(Yf),y(Yf,!0,(f=>new Of(f)));var nf=H(11956),ef=H(11314),Gf=H(11932),If=H(11965);ef.e.AddNodeConstructor("Light_Type_0",((f,Q)=>()=>new lf(f,i.p.Zero(),Q)));class lf extends If.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(f){this._shadowAngle=f,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(f){const Q=this.needCube();if(this._direction=f,this.needCube()!==Q&&this._shadowGenerators){const f=this._shadowGenerators.values();for(let Q=f.next();!0!==Q.done;Q=f.next()){Q.value.recreateShadowMap()}}}constructor(f,Q,H){super(f,H),this._shadowAngle=Math.PI/2,this.position=Q}getClassName(){return"PointLight"}getTypeID(){return Gf.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(f){if(this.direction)return super.getShadowDirection(f);switch(f){case 0:return new i.p(1,0,0);case 1:return new i.p(-1,0,0);case 2:return new i.p(0,-1,0);case 3:return new i.p(0,1,0);case 4:return new i.p(0,0,1);case 5:return new i.p(0,0,-1)}return i.p.Zero()}_setDefaultShadowProjectionMatrix(f,Q,H){const X=this.va().activeCamera;if(!X)return;const S=void 0!==this.shadowMinZ?this.shadowMinZ:X.nj,x=void 0!==this.shadowMaxZ?this.shadowMaxZ:X.maxZ,K=this.va().getEngine().useReverseDepthBuffer;i.e.PerspectiveFovLHToRef(this.shadowAngle,1,K?x:S,K?S:x,f,!0,this._scene.getEngine().isNDCHalfZRange,void 0,K)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(f,Q){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,Q):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,Q),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,Q),this}transferToNodeMaterialEffect(f,Q){return this.computeTransformedInformation()?f.setFloat3(Q,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):f.setFloat3(Q,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(f,Q){f["POINTLIGHT"+Q]=!0}}(0,G.d)([(0,I.G)()],lf.prototype,"shadowAngle",null),(0,D.h)("BABYLON.PointLight",lf),ef.e.AddNodeConstructor("Light_Type_2",((f,Q)=>()=>new qf(f,i.p.Zero(),i.p.Zero(),0,0,Q)));class qf extends If.d{get angle(){return this._angle}set angle(f){this._angle=f,this._cosHalfAngle=Math.cos(.5*f),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(f){this._innerAngle=f,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(f){this._shadowAngleScale=f,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(f){this._projectionTextureLightNear=f,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(f){this._projectionTextureLightFar=f,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(f){this._projectionTextureUpDirection=f,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(f){this._projectionTexture!==f&&(this._projectionTexture=f,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(qf._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):qf._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(f){return void 0!==f.onGeneratedObservable}static _IsTexture(f){return void 0!==f.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(f){this._projectionTextureProjectionLightMatrix=f,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(f,Q,H,X,S,x){super(f,x),this._innerAngle=0,this._projectionTextureMatrix=i.e.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=i.p.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=i.p.Zero(),this._projectionTextureViewLightMatrix=i.e.Zero(),this._projectionTextureProjectionLightMatrix=i.e.Zero(),this._projectionTextureScalingMatrix=i.e.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=Q,this.direction=H,this.angle=X,this.exponent=S}getClassName(){return"SpotLight"}getTypeID(){return Gf.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(f){super._setDirection(f),this._projectionTextureViewLightDirty=!0}_setPosition(f){super._setPosition(f),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(f,Q,H){const X=this.va().activeCamera;if(!X)return;this._shadowAngleScale=this._shadowAngleScale||1;const S=this._shadowAngleScale*this._angle,x=void 0!==this.shadowMinZ?this.shadowMinZ:X.nj,K=void 0!==this.shadowMaxZ?this.shadowMaxZ:X.maxZ,Z=this.va().getEngine().useReverseDepthBuffer;i.e.PerspectiveFovLHToRef(S,1,Z?K:x,Z?x:K,f,!0,this._scene.getEngine().isNDCHalfZRange,void 0,Z)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),i.e.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const f=this.projectionTextureLightFar,Q=this.projectionTextureLightNear,H=f/(f-Q),X=-H*Q,S=1/Math.tan(this._angle/2);i.e.FromValuesToRef(S/1,0,0,0,0,S,0,0,0,0,H,1,0,0,X,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof F.b){const f=this._projectionTexture.uScale/2,Q=this._projectionTexture.vScale/2;i.e.FromValuesToRef(f,0,0,0,0,Q,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(f,Q){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),f.setMatrix("textureProjectionMatrix"+Q,this._projectionTextureMatrix),f.setTexture("projectionLightTexture"+Q,this.projectionTexture)),this}transferToEffect(f,Q){let H;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,Q),H=i.p.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,Q),H=i.p.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",H.x,H.y,H.z,this._cosHalfAngle,Q),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,Q),this}transferToNodeMaterialEffect(f,Q){let H;return H=this.computeTransformedInformation()?i.p.Normalize(this.transformedDirection):i.p.Normalize(this.direction),this.va().useRightHandedSystem?f.setFloat3(Q,-H.x,-H.y,-H.z):f.setFloat3(Q,H.x,H.y,H.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(f){const Q=this._scene.getEngine(),H=void 0!==this.shadowMinZ?this.shadowMinZ:f.nj;return Q.useReverseDepthBuffer&&Q.isNDCHalfZRange?H:this._scene.getEngine().isNDCHalfZRange?0:H}getDepthMaxZ(f){const Q=this._scene.getEngine(),H=void 0!==this.shadowMaxZ?this.shadowMaxZ:f.maxZ;return Q.useReverseDepthBuffer&&Q.isNDCHalfZRange?0:H}prepareLightSpecificDefines(f,Q){f["SPOTLIGHT"+Q]=!0,f["PROJECTEDLIGHTTEXTURE"+Q]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,G.d)([(0,I.G)()],qf.prototype,"angle",null),(0,G.d)([(0,I.G)()],qf.prototype,"innerAngle",null),(0,G.d)([(0,I.G)()],qf.prototype,"shadowAngleScale",null),(0,G.d)([(0,I.G)()],qf.prototype,"exponent",void 0),(0,G.d)([(0,I.G)()],qf.prototype,"projectionTextureLightNear",null),(0,G.d)([(0,I.G)()],qf.prototype,"projectionTextureLightFar",null),(0,G.d)([(0,I.G)()],qf.prototype,"projectionTextureUpDirection",null),(0,G.d)([(0,I.A)("projectedLightTexture")],qf.prototype,"_projectionTexture",void 0),(0,D.h)("BABYLON.SpotLight",qf);const Df="KHR_lights_punctual";class df{constructor(f){this.name=Df,this._loader=f,this.enabled=this._loader.isExtensionUsed(Df)}dispose(){this._loader=null,delete this._lights}onLoading(){const f=this._loader.ij.extensions;if(f&&f[this.name]){const Q=f[this.name];this._lights=Q.lights,b.Assign(this._lights)}}loadNodeAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,x)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(f,Q,(f=>{let Q;const K=b.Get(X,this._lights,x.eb),Z=K.name||f.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,K.type){case"directional":{const f=new nf.b(Z,i.p.Backward(),this._loader.babylonScene);f.position._d(0),Q=f;break}case"point":Q=new lf(Z,i.p.Zero(),this._loader.babylonScene);break;case"spot":{const f=new qf(Z,i.p.Zero(),i.p.Backward(),0,1,this._loader.babylonScene);f.angle=2*(K.spot&&K.spot.outerConeAngle||Math.PI/4),f.innerAngle=2*(K.spot&&K.spot.innerConeAngle||0),Q=f;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${X}: Invalid light type (${K.type})`)}Q._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,K._babylonLight=Q,Q.falloffType=Gf.b.FALLOFF_GLTF,Q.Ph=K.color?S.e.Zd(K.color):S.e.White(),Q.rj=void 0==K.rj?1:K.rj,Q.range=void 0==K.range?Number.MAX_VALUE:K.range,Q.parent=f,this._loader._babylonLights.push(Q),o.AddPointerMetadata(Q,X),H(f)})))))}}h(Df),y(Df,!0,(f=>new df(f)));const sf="KHR_materials_pbrSpecularGlossiness";class Ff{constructor(f){this.name=sf,this.order=200,this._loader=f,this.enabled=this._loader.isExtensionUsed(sf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>{const S=new Array;return S.push(this._loader.loadMaterialBasePropertiesAsync(f,Q,H)),S.push(this._loadSpecularGlossinessPropertiesAsync(X,i,H)),this._loader.loadMaterialAlphaProperties(f,Q,H),Promise.all(S).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(f,Q,H){if(!(H instanceof s))throw new Error(`${f}: Material type not supported`);const X=new Array;return H.metallic=null,H.roughness=null,Q.diffuseFactor?(H.albedoColor=S.e.Zd(Q.diffuseFactor),H.alpha=Q.diffuseFactor[3]):H.albedoColor=S.e.White(),H.reflectivityColor=Q.specularFactor?S.e.Zd(Q.specularFactor):S.e.White(),H.microSurface=void 0==Q.glossinessFactor?1:Q.glossinessFactor,Q.diffuseTexture&&X.push(this._loader.loadTextureInfoAsync(`${f}/diffuseTexture`,Q.diffuseTexture,(f=>{f.name=`${H.name} (Diffuse)`,H.albedoTexture=f}))),Q.specularGlossinessTexture&&(X.push(this._loader.loadTextureInfoAsync(`${f}/specularGlossinessTexture`,Q.specularGlossinessTexture,(f=>{f.name=`${H.name} (Specular Glossiness)`,H.reflectivityTexture=f,H.reflectivityTexture.qc=!0}))),H.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(X).then((()=>{}))}}h(sf),y(sf,!0,(f=>new Ff(f)));const Pf="KHR_materials_unlit";class mf{constructor(f){this.name=Pf,this.order=210,this._loader=f,this.enabled=this._loader.isExtensionUsed(Pf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,(()=>this._loadUnlitPropertiesAsync(f,Q,H)))}_loadUnlitPropertiesAsync(f,Q,H){if(!(H instanceof s))throw new Error(`${f}: Material type not supported`);const X=new Array;H.unlit=!0;const i=Q.pbrMetallicRoughness;return i&&(i.baseColorFactor?(H.albedoColor=S.e.Zd(i.baseColorFactor),H.alpha=i.baseColorFactor[3]):H.albedoColor=S.e.White(),i.baseColorTexture&&X.push(this._loader.loadTextureInfoAsync(`${f}/baseColorTexture`,i.baseColorTexture,(f=>{f.name=`${H.name} (Base Color)`,H.albedoTexture=f})))),Q.doubleSided&&(H.we=!1,H.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(f,Q,H),Promise.all(X).then((()=>{}))}}h(Pf),y(Pf,!0,(f=>new mf(f)));const cf="KHR_materials_clearcoat";class Wf{constructor(f){this.name=cf,this.order=190,this._loader=f,this.enabled=this._loader.isExtensionUsed(cf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(f,Q,H)),S.push(this._loadClearCoatPropertiesAsync(X,i,H)),Promise.all(S).then((()=>{}))}))}_loadClearCoatPropertiesAsync(f,Q,H){if(!(H instanceof s))throw new Error(`${f}: Material type not supported`);const X=new Array;return H.clearCoat.isEnabled=!0,H.clearCoat.useRoughnessFromMainTexture=!1,H.clearCoat.remapF0OnInterfaceChange=!1,void 0!=Q.clearcoatFactor?H.clearCoat.rj=Q.clearcoatFactor:H.clearCoat.rj=0,Q.clearcoatTexture&&X.push(this._loader.loadTextureInfoAsync(`${f}/clearcoatTexture`,Q.clearcoatTexture,(f=>{f.name=`${H.name} (ClearCoat)`,H.clearCoat.texture=f}))),void 0!=Q.clearcoatRoughnessFactor?H.clearCoat.roughness=Q.clearcoatRoughnessFactor:H.clearCoat.roughness=0,Q.clearcoatRoughnessTexture&&(Q.clearcoatRoughnessTexture.nonColorData=!0,X.push(this._loader.loadTextureInfoAsync(`${f}/clearcoatRoughnessTexture`,Q.clearcoatRoughnessTexture,(f=>{f.name=`${H.name} (ClearCoat Roughness)`,H.clearCoat.textureRoughness=f})))),Q.clearcoatNormalTexture&&(Q.clearcoatNormalTexture.nonColorData=!0,X.push(this._loader.loadTextureInfoAsync(`${f}/clearcoatNormalTexture`,Q.clearcoatNormalTexture,(f=>{f.name=`${H.name} (ClearCoat Normal)`,H.clearCoat.bumpTexture=f}))),H.invertNormalMapX=!H.va().useRightHandedSystem,H.invertNormalMapY=H.va().useRightHandedSystem,void 0!=Q.clearcoatNormalTexture.scale&&(H.clearCoat.bumpTexture.level=Q.clearcoatNormalTexture.scale)),Promise.all(X).then((()=>{}))}}h(cf),y(cf,!0,(f=>new Wf(f)));const Rf="KHR_materials_iridescence";class Uf{constructor(f){this.name=Rf,this.order=195,this._loader=f,this.enabled=this._loader.isExtensionUsed(Rf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(f,Q,H)),S.push(this._loadIridescencePropertiesAsync(X,i,H)),Promise.all(S).then((()=>{}))}))}_loadIridescencePropertiesAsync(f,Q,H){if(!(H instanceof s))throw new Error(`${f}: Material type not supported`);const X=new Array;return H.iridescence.isEnabled=!0,H.iridescence.rj=Q.iridescenceFactor??0,H.iridescence.indexOfRefraction=Q.iridescenceIor??Q.iridescenceIOR??1.3,H.iridescence.minimumThickness=Q.iridescenceThicknessMinimum??100,H.iridescence.maximumThickness=Q.iridescenceThicknessMaximum??400,Q.iridescenceTexture&&X.push(this._loader.loadTextureInfoAsync(`${f}/iridescenceTexture`,Q.iridescenceTexture,(f=>{f.name=`${H.name} (Iridescence)`,H.iridescence.texture=f}))),Q.iridescenceThicknessTexture&&X.push(this._loader.loadTextureInfoAsync(`${f}/iridescenceThicknessTexture`,Q.iridescenceThicknessTexture,(f=>{f.name=`${H.name} (Iridescence Thickness)`,H.iridescence.thicknessTexture=f}))),Promise.all(X).then((()=>{}))}}h(Rf),y(Rf,!0,(f=>new Uf(f)));const Ef="KHR_materials_anisotropy";class tf{constructor(f){this.name=Ef,this.order=195,this._loader=f,this.enabled=this._loader.isExtensionUsed(Ef)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(f,Q,H)),S.push(this._loadIridescencePropertiesAsync(X,i,H)),Promise.all(S).then((()=>{}))}))}_loadIridescencePropertiesAsync(f,Q,H){if(!(H instanceof s))throw new Error(`${f}: Material type not supported`);const X=new Array;return H.anisotropy.isEnabled=!0,H.anisotropy.rj=Q.anisotropyStrength??0,H.anisotropy.angle=Q.anisotropyRotation??0,Q.anisotropyTexture&&(Q.anisotropyTexture.nonColorData=!0,X.push(this._loader.loadTextureInfoAsync(`${f}/anisotropyTexture`,Q.anisotropyTexture,(f=>{f.name=`${H.name} (Anisotropy Intensity)`,H.anisotropy.texture=f})))),Promise.all(X).then((()=>{}))}}h(Ef),y(Ef,!0,(f=>new tf(f)));const uf="KHR_materials_emissive_strength";class Lf{constructor(f){this.name=uf,this.order=170,this._loader=f,this.enabled=this._loader.isExtensionUsed(uf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>this._loader.loadMaterialPropertiesAsync(f,Q,H).then((()=>{this._loadEmissiveProperties(X,i,H)}))))}_loadEmissiveProperties(f,Q,H){if(!(H instanceof s))throw new Error(`${f}: Material type not supported`);void 0!==Q.emissiveStrength&&(H.emissiveIntensity=Q.emissiveStrength)}}h(uf),y(uf,!0,(f=>new Lf(f)));const Af="KHR_materials_sheen";class af{constructor(f){this.name=Af,this.order=190,this._loader=f,this.enabled=this._loader.isExtensionUsed(Af)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(f,Q,H)),S.push(this._loadSheenPropertiesAsync(X,i,H)),Promise.all(S).then((()=>{}))}))}_loadSheenPropertiesAsync(f,Q,H){if(!(H instanceof s))throw new Error(`${f}: Material type not supported`);const X=new Array;return H.sheen.isEnabled=!0,H.sheen.rj=1,void 0!=Q.sheenColorFactor?H.sheen.color=S.e.Zd(Q.sheenColorFactor):H.sheen.color=S.e.Black(),Q.sheenColorTexture&&X.push(this._loader.loadTextureInfoAsync(`${f}/sheenColorTexture`,Q.sheenColorTexture,(f=>{f.name=`${H.name} (Sheen Color)`,H.sheen.texture=f}))),void 0!==Q.sheenRoughnessFactor?H.sheen.roughness=Q.sheenRoughnessFactor:H.sheen.roughness=0,Q.sheenRoughnessTexture&&(Q.sheenRoughnessTexture.nonColorData=!0,X.push(this._loader.loadTextureInfoAsync(`${f}/sheenRoughnessTexture`,Q.sheenRoughnessTexture,(f=>{f.name=`${H.name} (Sheen Roughness)`,H.sheen.textureRoughness=f})))),H.sheen.albedoScaling=!0,H.sheen.useRoughnessFromMainTexture=!1,Promise.all(X).then((()=>{}))}}h(Af),y(Af,!0,(f=>new af(f)));const Vf="KHR_materials_specular";class Mf{constructor(f){this.name=Vf,this.order=190,this._loader=f,this.enabled=this._loader.isExtensionUsed(Vf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(f,Q,H)),S.push(this._loadSpecularPropertiesAsync(X,i,H)),Promise.all(S).then((()=>{}))}))}_loadSpecularPropertiesAsync(f,Q,H){if(!(H instanceof s))throw new Error(`${f}: Material type not supported`);const X=new Array;return void 0!==Q.specularFactor&&(H.metallicF0Factor=Q.specularFactor),void 0!==Q.specularColorFactor&&(H.metallicReflectanceColor=S.e.Zd(Q.specularColorFactor)),Q.specularTexture&&(Q.specularTexture.nonColorData=!0,X.push(this._loader.loadTextureInfoAsync(`${f}/specularTexture`,Q.specularTexture,(f=>{f.name=`${H.name} (Specular)`,H.metallicReflectanceTexture=f,H.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),Q.specularColorTexture&&X.push(this._loader.loadTextureInfoAsync(`${f}/specularColorTexture`,Q.specularColorTexture,(f=>{f.name=`${H.name} (Specular Color)`,H.reflectanceTexture=f}))),Promise.all(X).then((()=>{}))}}h(Vf),y(Vf,!0,(f=>new Mf(f)));const rf="KHR_materials_ior";class jf{constructor(f){this.name=rf,this.order=180,this._loader=f,this.enabled=this._loader.isExtensionUsed(rf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(f,Q,H)),S.push(this._loadIorPropertiesAsync(X,i,H)),Promise.all(S).then((()=>{}))}))}_loadIorPropertiesAsync(f,Q,H){if(!(H instanceof s))throw new Error(`${f}: Material type not supported`);return void 0!==Q.ior?H.indexOfRefraction=Q.ior:H.indexOfRefraction=jf._DEFAULT_IOR,Promise.resolve()}}jf._DEFAULT_IOR=1.5,h(rf),y(rf,!0,(f=>new jf(f)));const Tf="KHR_materials_variants";class kf{constructor(f){this.name=Tf,this._loader=f,this.enabled=this._loader.isExtensionUsed(Tf)}dispose(){this._loader=null}static GetAvailableVariants(f){const Q=this._GetExtensionMetadata(f);return Q?Object.keys(Q.variants):[]}getAvailableVariants(f){return kf.GetAvailableVariants(f)}static SelectVariant(f,Q){const H=this._GetExtensionMetadata(f);if(!H)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${Tf} extension`);const X=f=>{const Q=H.variants[f];if(Q)for(const H of Q)H.mesh.material=H.material};if(Q instanceof Array)for(const i of Q)X(i);else X(Q);H.lastSelected=Q}selectVariant(f,Q){kf.SelectVariant(f,Q)}static Reset(f){const Q=this._GetExtensionMetadata(f);if(!Q)throw new Error(`Cannot reset on a glTF mesh that does not have the ${Tf} extension`);for(const H of Q.original)H.mesh.material=H.material;Q.lastSelected=null}reset(f){kf.Reset(f)}static GetLastSelectedVariant(f){const Q=this._GetExtensionMetadata(f);if(!Q)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${Tf} extension`);return Q.lastSelected}getLastSelectedVariant(f){return kf.GetLastSelectedVariant(f)}static _GetExtensionMetadata(f){var Q,H;return(null===f||void 0===f||null===(Q=f._internalMetadata)||void 0===Q||null===(H=Q.ij)||void 0===H?void 0:H[Tf])||null}onLoading(){const f=this._loader.ij.extensions;if(f&&f[this.name]){const Q=f[this.name];this._variants=Q.variants}}_loadMeshPrimitiveAsync(f,Q,H,X,i,S){return o.LoadExtensionAsync(f,i,this.name,((x,K)=>{const Z=new Array;return Z.push(this._loader._loadMeshPrimitiveAsync(f,Q,H,X,i,(Q=>{if(S(Q),Q instanceof R.b){const H=o._GetDrawMode(f,i.mode),X=this._loader.rootBabylonMesh,S=X?X._internalMetadata=X._internalMetadata||{}:{},B=S.ij=S.ij||{},N=B[Tf]=B[Tf]||{lastSelected:null,original:[],variants:{}};N.original.push({mesh:Q,material:Q.material});for(let f=0;f<K.mappings.length;++f){const i=K.mappings[f],S=b.Get(`${x}/mappings/${f}/material`,this._loader.ij.materials,i.material);Z.push(this._loader._loadMaterialAsync(`#/materials/${i.material}`,S,Q,H,(f=>{for(let H=0;H<i.variants.length;++H){const S=i.variants[H],x=b.Get(`/extensions/${Tf}/variants/${S}`,this._variants,S);N.variants[x.name]=N.variants[x.name]||[],N.variants[x.name].push({mesh:Q,material:f}),Q.onClonedObservable.add((f=>{const H=f;let i=null,S=H;do{if(S=S.parent,!S)return;i=kf._GetExtensionMetadata(S)}while(null===i);if(X&&i===kf._GetExtensionMetadata(X)){S._internalMetadata={};for(const f in X._internalMetadata)S._internalMetadata[f]=X._internalMetadata[f];S._internalMetadata.ij=[];for(const f in X._internalMetadata.ij)S._internalMetadata.ij[f]=X._internalMetadata.ij[f];S._internalMetadata.ij[Tf]={lastSelected:null,original:[],variants:{}};for(const f of i.original)S._internalMetadata.ij[Tf].original.push({mesh:f.mesh,material:f.material});for(const f in i.variants)if(Object.prototype.hasOwnProperty.call(i.variants,f)){S._internalMetadata.ij[Tf].variants[f]=[];for(const Q of i.variants[f])S._internalMetadata.ij[Tf].variants[f].push({mesh:Q.mesh,material:Q.material})}i=S._internalMetadata.ij[Tf]}for(const X of i.original)X.mesh===Q&&(X.mesh=H);for(const X of i.variants[x.name])X.mesh===Q&&(X.mesh=H)}))}})))}}}))),Promise.all(Z).then((f=>{let[Q]=f;return Q}))}))}}h(Tf),y(Tf,!0,(f=>new kf(f)));var yf=H(1533);class hf{}hf.AUTOSAMPLERSUFFIX="Sampler",hf.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",hf.ALPHA_DISABLE=0,hf.ALPHA_ADD=1,hf.ALPHA_COMBINE=2,hf.ALPHA_SUBTRACT=3,hf.ALPHA_MULTIPLY=4,hf.ALPHA_MAXIMIZED=5,hf.ALPHA_ONEONE=6,hf.ALPHA_PREMULTIPLIED=7,hf.ALPHA_PREMULTIPLIED_PORTERDUFF=8,hf.ALPHA_INTERPOLATE=9,hf.ALPHA_SCREENMODE=10,hf.ALPHA_ONEONE_ONEONE=11,hf.ALPHA_ALPHATOCOLOR=12,hf.ALPHA_REVERSEONEMINUS=13,hf.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,hf.ALPHA_ONEONE_ONEZERO=15,hf.ALPHA_EXCLUSION=16,hf.ALPHA_LAYER_ACCUMULATE=17,hf.ALPHA_EQUATION_ADD=0,hf.ALPHA_EQUATION_SUBSTRACT=1,hf.ALPHA_EQUATION_REVERSE_SUBTRACT=2,hf.ALPHA_EQUATION_MAX=3,hf.ALPHA_EQUATION_MIN=4,hf.ALPHA_EQUATION_DARKEN=5,hf.DELAYLOADSTATE_NONE=0,hf.DELAYLOADSTATE_LOADED=1,hf.DELAYLOADSTATE_LOADING=2,hf.DELAYLOADSTATE_NOTLOADED=4,hf.NEVER=512,hf.ALWAYS=519,hf.LESS=513,hf.EQUAL=514,hf.LEQUAL=515,hf.GREATER=516,hf.GEQUAL=518,hf.NOTEQUAL=517,hf.KEEP=7680,hf.ZERO=0,hf.REPLACE=7681,hf.INCR=7682,hf.DECR=7683,hf.INVERT=5386,hf.INCR_WRAP=34055,hf.DECR_WRAP=34056,hf.TEXTURE_CLAMP_ADDRESSMODE=0,hf.TEXTURE_WRAP_ADDRESSMODE=1,hf.TEXTURE_MIRROR_ADDRESSMODE=2,hf.TEXTURE_CREATIONFLAG_STORAGE=1,hf.TEXTUREFORMAT_ALPHA=0,hf.TEXTUREFORMAT_LUMINANCE=1,hf.TEXTUREFORMAT_LUMINANCE_ALPHA=2,hf.TEXTUREFORMAT_RGB=4,hf.TEXTUREFORMAT_RGBA=5,hf.TEXTUREFORMAT_RED=6,hf.TEXTUREFORMAT_R=6,hf.TEXTUREFORMAT_RG=7,hf.TEXTUREFORMAT_RED_INTEGER=8,hf.TEXTUREFORMAT_R_INTEGER=8,hf.TEXTUREFORMAT_RG_INTEGER=9,hf.TEXTUREFORMAT_RGB_INTEGER=10,hf.TEXTUREFORMAT_RGBA_INTEGER=11,hf.TEXTUREFORMAT_BGRA=12,hf.TEXTUREFORMAT_DEPTH24_STENCIL8=13,hf.TEXTUREFORMAT_DEPTH32_FLOAT=14,hf.TEXTUREFORMAT_DEPTH16=15,hf.TEXTUREFORMAT_DEPTH24=16,hf.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,hf.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,hf.TEXTUREFORMAT_STENCIL8=19,hf.TEXTUREFORMAT_UNDEFINED=4294967295,hf.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,hf.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,hf.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,hf.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,hf.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,hf.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,hf.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,hf.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,hf.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,hf.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,hf.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,hf.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,hf.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,hf.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,hf.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,hf.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,hf.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,hf.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,hf.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,hf.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,hf.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,hf.TEXTURETYPE_UNSIGNED_BYTE=0,hf.TEXTURETYPE_UNSIGNED_INT=0,hf.TEXTURETYPE_FLOAT=1,hf.TEXTURETYPE_HALF_FLOAT=2,hf.TEXTURETYPE_BYTE=3,hf.TEXTURETYPE_SHORT=4,hf.TEXTURETYPE_UNSIGNED_SHORT=5,hf.TEXTURETYPE_INT=6,hf.TEXTURETYPE_UNSIGNED_INTEGER=7,hf.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,hf.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,hf.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,hf.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,hf.TEXTURETYPE_UNSIGNED_INT_24_8=12,hf.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,hf.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,hf.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,hf.TEXTURETYPE_UNDEFINED=16,hf.TEXTURE_2D=3553,hf.TEXTURE_2D_ARRAY=35866,hf.TEXTURE_CUBE_MAP=34067,hf.TEXTURE_CUBE_MAP_ARRAY=3735928559,hf.TEXTURE_3D=32879,hf.TEXTURE_NEAREST_SAMPLINGMODE=1,hf.TEXTURE_NEAREST_NEAREST=1,hf.TEXTURE_BILINEAR_SAMPLINGMODE=2,hf.TEXTURE_LINEAR_LINEAR=2,hf.TEXTURE_TRILINEAR_SAMPLINGMODE=3,hf.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,hf.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,hf.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,hf.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,hf.TEXTURE_NEAREST_LINEAR=7,hf.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,hf.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,hf.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,hf.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,hf.TEXTURE_LINEAR_NEAREST=12,hf.TEXTURE_EXPLICIT_MODE=0,hf.TEXTURE_SPHERICAL_MODE=1,hf.TEXTURE_PLANAR_MODE=2,hf.TEXTURE_CUBIC_MODE=3,hf.TEXTURE_PROJECTION_MODE=4,hf.TEXTURE_SKYBOX_MODE=5,hf.TEXTURE_INVCUBIC_MODE=6,hf.TEXTURE_EQUIRECTANGULAR_MODE=7,hf.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,hf.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,hf.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,hf.TEXTURE_FILTERING_QUALITY_HIGH=64,hf.TEXTURE_FILTERING_QUALITY_MEDIUM=16,hf.TEXTURE_FILTERING_QUALITY_LOW=8,hf.SCALEMODE_FLOOR=1,hf.SCALEMODE_NEAREST=2,hf.SCALEMODE_CEILING=3,hf.MATERIAL_TextureDirtyFlag=1,hf.MATERIAL_LightDirtyFlag=2,hf.MATERIAL_FresnelDirtyFlag=4,hf.MATERIAL_AttributesDirtyFlag=8,hf.MATERIAL_MiscDirtyFlag=16,hf.MATERIAL_PrePassDirtyFlag=32,hf.MATERIAL_AllDirtyFlag=63,hf.MATERIAL_TriangleFillMode=0,hf.MATERIAL_WireFrameFillMode=1,hf.MATERIAL_PointFillMode=2,hf.MATERIAL_PointListDrawMode=3,hf.MATERIAL_LineListDrawMode=4,hf.MATERIAL_LineLoopDrawMode=5,hf.MATERIAL_LineStripDrawMode=6,hf.MATERIAL_TriangleStripDrawMode=7,hf.MATERIAL_TriangleFanDrawMode=8,hf.MATERIAL_ClockWiseSideOrientation=0,hf.MATERIAL_CounterClockWiseSideOrientation=1,hf.ACTION_NothingTrigger=0,hf.ACTION_OnPickTrigger=1,hf.ACTION_OnLeftPickTrigger=2,hf.ACTION_OnRightPickTrigger=3,hf.ACTION_OnCenterPickTrigger=4,hf.ACTION_OnPickDownTrigger=5,hf.ACTION_OnDoublePickTrigger=6,hf.ACTION_OnPickUpTrigger=7,hf.ACTION_OnPickOutTrigger=16,hf.ACTION_OnLongPressTrigger=8,hf.ACTION_OnPointerOverTrigger=9,hf.ACTION_OnPointerOutTrigger=10,hf.ACTION_OnEveryFrameTrigger=11,hf.ACTION_OnIntersectionEnterTrigger=12,hf.ACTION_OnIntersectionExitTrigger=13,hf.ACTION_OnKeyDownTrigger=14,hf.ACTION_OnKeyUpTrigger=15,hf.PARTICLES_BILLBOARDMODE_Y=2,hf.PARTICLES_BILLBOARDMODE_ALL=7,hf.PARTICLES_BILLBOARDMODE_STRETCHED=8,hf.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,hf.MESHES_CULLINGSTRATEGY_STANDARD=0,hf.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,hf.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,hf.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,hf.SCENELOADER_NO_LOGGING=0,hf.SCENELOADER_MINIMAL_LOGGING=1,hf.SCENELOADER_SUMMARY_LOGGING=2,hf.SCENELOADER_DETAILED_LOGGING=3,hf.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,hf.PREPASS_POSITION_TEXTURE_TYPE=1,hf.PREPASS_VELOCITY_TEXTURE_TYPE=2,hf.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,hf.PREPASS_COLOR_TEXTURE_TYPE=4,hf.PREPASS_DEPTH_TEXTURE_TYPE=5,hf.PREPASS_NORMAL_TEXTURE_TYPE=6,hf.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,hf.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,hf.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,hf.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,hf.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,hf.PREPASS_ALBEDO_TEXTURE_TYPE=12,hf.BUFFER_CREATIONFLAG_READ=1,hf.BUFFER_CREATIONFLAG_WRITE=2,hf.BUFFER_CREATIONFLAG_READWRITE=3,hf.BUFFER_CREATIONFLAG_UNIFORM=4,hf.BUFFER_CREATIONFLAG_VERTEX=8,hf.BUFFER_CREATIONFLAG_INDEX=16,hf.BUFFER_CREATIONFLAG_STORAGE=32,hf.BUFFER_CREATIONFLAG_INDIRECT=64,hf.RENDERPASS_MAIN=0,hf.INPUT_ALT_KEY=18,hf.INPUT_CTRL_KEY=17,hf.INPUT_META_KEY1=91,hf.INPUT_META_KEY2=92,hf.INPUT_META_KEY3=93,hf.INPUT_SHIFT_KEY=16,hf.SNAPSHOTRENDERING_STANDARD=0,hf.SNAPSHOTRENDERING_FAST=1,hf.PERSPECTIVE_CAMERA=0,hf.ORTHOGRAPHIC_CAMERA=1,hf.FOVMODE_VERTICAL_FIXED=0,hf.FOVMODE_HORIZONTAL_FIXED=1,hf.RIG_MODE_NONE=0,hf.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,hf.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,hf.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,hf.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,hf.RIG_MODE_STEREOSCOPIC_INTERLACED=14,hf.RIG_MODE_VR=20,hf.RIG_MODE_CUSTOM=22,hf.MAX_SUPPORTED_UV_SETS=6,hf.GL_ALPHA_EQUATION_ADD=32774,hf.GL_ALPHA_EQUATION_MIN=32775,hf.GL_ALPHA_EQUATION_MAX=32776,hf.GL_ALPHA_EQUATION_SUBTRACT=32778,hf.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,hf.GL_ALPHA_FUNCTION_SRC=768,hf.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,hf.GL_ALPHA_FUNCTION_SRC_ALPHA=770,hf.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,hf.GL_ALPHA_FUNCTION_DST_ALPHA=772,hf.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,hf.GL_ALPHA_FUNCTION_DST_COLOR=774,hf.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,hf.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,hf.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,hf.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,hf.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,hf.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,hf.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,hf.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,hf.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,hf.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,hf.SnippetUrl="https://snippet.babylonjs.com",hf.FOGMODE_NONE=0,hf.FOGMODE_EXP=1,hf.FOGMODE_EXP2=2,hf.FOGMODE_LINEAR=3,hf.BYTE=5120,hf.UNSIGNED_BYTE=5121,hf.SHORT=5122,hf.UNSIGNED_SHORT=5123,hf.INT=5124,hf.UNSIGNED_INT=5125,hf.FLOAT=5126,hf.PositionKind="position",hf.NormalKind="se",hf.TangentKind="tangent",hf.UVKind="uv",hf.UV2Kind="uv2",hf.UV3Kind="uv3",hf.UV4Kind="uv4",hf.UV5Kind="uv5",hf.UV6Kind="uv6",hf.ColorKind="color",hf.ColorInstanceKind="instanceColor",hf.MatricesIndicesKind="matricesIndices",hf.MatricesWeightsKind="matricesWeights",hf.MatricesIndicesExtraKind="matricesIndicesExtra",hf.MatricesWeightsExtraKind="matricesWeightsExtra";class wf{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:hf.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(f,Q){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...wf._GetDefaultOptions(),...f},this._scene=Q,this._scene._transmissionHelper=this,this.onErrorObservable=new N.e,this._scene.fe.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(f){if(!Object.keys(f).filter((Q=>this._options[Q]!==f[Q])).length)return;const Q={...this._options,...f},H=this._options;this._options=Q,Q.renderSize===H.renderSize&&Q.renderTargetTextureType===H.renderTargetTextureType&&Q.generateMipmaps===H.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=Q.samples,this._opaqueRenderTarget.lodGenerationScale=Q.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=Q.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(f){return!!f&&!!(f instanceof s&&f.subSurface.isRefractionEnabled)}_addMesh(f){this._materialObservers[f.uniqueId]=f.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),x.g.SetImmediate((()=>{this._shouldRenderAsTransmission(f.material)?(f.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(f)&&this._transparentMeshesCache.push(f)):-1===this._opaqueMeshesCache.indexOf(f)&&this._opaqueMeshesCache.push(f)}))}_removeMesh(f){f.onMaterialChangedObservable.remove(this._materialObservers[f.uniqueId]),delete this._materialObservers[f.uniqueId];let Q=this._transparentMeshesCache.indexOf(f);-1!==Q&&this._transparentMeshesCache.splice(Q,1),Q=this._opaqueMeshesCache.indexOf(f),-1!==Q&&this._opaqueMeshesCache.splice(Q,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(f){const Q=this._transparentMeshesCache.indexOf(f),H=this._opaqueMeshesCache.indexOf(f);this._shouldRenderAsTransmission(f.material)?(f.material instanceof s&&(f.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==H?(this._opaqueMeshesCache.splice(H,1),this._transparentMeshesCache.push(f)):-1===Q&&this._transparentMeshesCache.push(f)):-1!==Q?(this._transparentMeshesCache.splice(Q,1),this._opaqueMeshesCache.push(f)):-1===H&&this._opaqueMeshesCache.push(f)}_isRenderTargetValid(){var f;return null!==(null===(f=this._opaqueRenderTarget)||void 0===f?void 0:f.getInternalTexture())}_setupRenderTargets(){var f;let Q,H;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new yf.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(f=this._options.clearColor)||void 0===f?void 0:f.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((f=>{H=this._scene.environmentIntensity,this._scene.environmentIntensity=1,Q=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?f.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(f.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=H,this._scene.imageProcessingConfiguration._applyByPostProcess=Q})),this._transparentMeshesCache.forEach((f=>{this._shouldRenderAsTransmission(f.material)&&(f.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const bf="KHR_materials_transmission";class of{constructor(f){this.name=bf,this.order=175,this._loader=f,this.enabled=this._loader.isExtensionUsed(bf),this.enabled&&(f.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(f,Q,H)),S.push(this._loadTransparentPropertiesAsync(X,Q,H,i)),Promise.all(S).then((()=>{}))}))}_loadTransparentPropertiesAsync(f,Q,H,X){if(!(H instanceof s))throw new Error(`${f}: Material type not supported`);const i=H;if(i.subSurface.isRefractionEnabled=!0,i.subSurface.volumeIndexOfRefraction=1,i.subSurface.useAlbedoToTintRefraction=!0,void 0===X.transmissionFactor)return i.subSurface.refractionIntensity=0,i.subSurface.isRefractionEnabled=!1,Promise.resolve();{var S;i.subSurface.refractionIntensity=X.transmissionFactor;const f=i.va();if(i.subSurface.refractionIntensity&&!f._transmissionHelper)new wf({},i.va());else if(i.subSurface.refractionIntensity&&(null===(S=f._transmissionHelper)||void 0===S||!S._isRenderTargetValid())){var x;null===(x=f._transmissionHelper)||void 0===x||x._setupRenderTargets()}}return i.subSurface.minimumThickness=0,i.subSurface.maximumThickness=0,X.transmissionTexture?(X.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${f}/transmissionTexture`,X.transmissionTexture,void 0).then((f=>{f.name=`${H.name} (Transmission)`,i.subSurface.refractionIntensityTexture=f,i.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}h(bf),y(bf,!0,(f=>new of(f)));const pf="KHR_materials_diffuse_transmission";class Cf{constructor(f){this.name=pf,this.order=174,this._loader=f,this.enabled=this._loader.isExtensionUsed(pf),this.enabled&&(f.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(f,Q,H)),S.push(this._loadTranslucentPropertiesAsync(X,Q,H,i)),Promise.all(S).then((()=>{}))}))}_loadTranslucentPropertiesAsync(f,Q,H,X){if(!(H instanceof s))throw new Error(`${f}: Material type not supported`);const i=H;if(i.subSurface.isTranslucencyEnabled=!0,i.subSurface.volumeIndexOfRefraction=1,i.subSurface.minimumThickness=0,i.subSurface.maximumThickness=0,i.subSurface.useAlbedoToTintTranslucency=!1,void 0===X.diffuseTransmissionFactor)return i.subSurface.translucencyIntensity=0,i.subSurface.isTranslucencyEnabled=!1,Promise.resolve();i.subSurface.translucencyIntensity=X.diffuseTransmissionFactor;const x=new Array;return i.subSurface.useGltfStyleTextures=!0,X.diffuseTransmissionTexture&&(X.diffuseTransmissionTexture.nonColorData=!0,x.push(this._loader.loadTextureInfoAsync(`${f}/diffuseTransmissionTexture`,X.diffuseTransmissionTexture).then((f=>{f.name=`${H.name} (Diffuse Transmission)`,i.subSurface.translucencyIntensityTexture=f})))),void 0!==X.diffuseTransmissionColorFactor?i.subSurface.translucencyColor=S.e.Zd(X.diffuseTransmissionColorFactor):i.subSurface.translucencyColor=S.e.White(),X.diffuseTransmissionColorTexture&&x.push(this._loader.loadTextureInfoAsync(`${f}/diffuseTransmissionColorTexture`,X.diffuseTransmissionColorTexture).then((f=>{f.name=`${H.name} (Diffuse Transmission Color)`,i.subSurface.translucencyColorTexture=f}))),Promise.all(x).then((()=>{}))}}h(pf),y(pf,!0,(f=>new Cf(f)));const fQ="KHR_materials_volume";class QQ{constructor(f){this.name=fQ,this.order=173,this._loader=f,this.enabled=this._loader.isExtensionUsed(fQ),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(f,Q,H)),S.push(this._loadVolumePropertiesAsync(X,Q,H,i)),Promise.all(S).then((()=>{}))}))}_loadVolumePropertiesAsync(f,Q,H,X){if(!(H instanceof s))throw new Error(`${f}: Material type not supported`);if(!H.subSurface.isRefractionEnabled&&!H.subSurface.isTranslucencyEnabled||!X.thicknessFactor)return Promise.resolve();H.subSurface.volumeIndexOfRefraction=H.indexOfRefraction;const i=void 0!==X.attenuationDistance?X.attenuationDistance:Number.MAX_VALUE;return H.subSurface.tintColorAtDistance=i,void 0!==X.attenuationColor&&3==X.attenuationColor.length&&H.subSurface.tintColor.Xd(X.attenuationColor[0],X.attenuationColor[1],X.attenuationColor[2]),H.subSurface.minimumThickness=0,H.subSurface.maximumThickness=X.thicknessFactor,H.subSurface.useThicknessAsDepth=!0,X.thicknessTexture?(X.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${f}/thicknessTexture`,X.thicknessTexture).then((f=>{f.name=`${H.name} (Thickness)`,H.subSurface.thicknessTexture=f,H.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}h(fQ),y(fQ,!0,(f=>new QQ(f)));const HQ="KHR_materials_dispersion";class XQ{constructor(f){this.name=HQ,this.order=174,this._loader=f,this.enabled=this._loader.isExtensionUsed(HQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>{const S=new Array;return S.push(this._loader.loadMaterialPropertiesAsync(f,Q,H)),S.push(this._loadDispersionPropertiesAsync(X,Q,H,i)),Promise.all(S).then((()=>{}))}))}_loadDispersionPropertiesAsync(f,Q,H,X){if(!(H instanceof s))throw new Error(`${f}: Material type not supported`);return H.subSurface.isRefractionEnabled&&X.dispersion?(H.subSurface.isDispersionEnabled=!0,H.subSurface.dispersion=X.dispersion,Promise.resolve()):Promise.resolve()}}h(HQ),y(HQ,!0,(f=>new XQ(f)));const iQ="KHR_mesh_quantization";class SQ{constructor(f){this.name=iQ,this.enabled=f.isExtensionUsed(iQ)}dispose(){}}h(iQ),y(iQ,!0,(f=>new SQ(f)));const xQ="KHR_texture_basisu";class KQ{constructor(f){this.name=xQ,this._loader=f,this.enabled=f.isExtensionUsed(xQ)}dispose(){this._loader=null}_loadTextureAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>{const S=void 0==Q.sampler?o.DefaultSampler:b.Get(`${f}/sampler`,this._loader.ij.samplers,Q.sampler),x=b.Get(`${X}/source`,this._loader.ij.images,i.source);return this._loader._createTextureAsync(f,S,x,(f=>{H(f)}),Q._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!Q._textureInfo.nonColorData)}))}}h(xQ),y(xQ,!0,(f=>new KQ(f)));const ZQ="KHR_texture_transform";class BQ{constructor(f){this.name=ZQ,this._loader=f,this.enabled=this._loader.isExtensionUsed(ZQ)}dispose(){this._loader=null}loadTextureInfoAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((X,i)=>this._loader.loadTextureInfoAsync(f,Q,(f=>{if(!(f instanceof F.b))throw new Error(`${X}: Texture type not supported`);i.offset&&(f.uOffset=i.offset[0],f.vOffset=i.offset[1]),f.uRotationCenter=0,f.vRotationCenter=0,i.rotation&&(f.wAng=-i.rotation),i.scale&&(f.uScale=i.scale[0],f.vScale=i.scale[1]),void 0!=i.texCoord&&(f.coordinatesIndex=i.texCoord),H(f)}))))}}h(ZQ),y(ZQ,!0,(f=>new BQ(f)));const NQ="KHR_xmp_json_ld";class JQ{constructor(f){this.name=NQ,this.order=100,this._loader=f,this.enabled=this._loader.isExtensionUsed(NQ)}dispose(){this._loader=null}onLoading(){var f,Q,H;if(null===this._loader.rootBabylonMesh)return;const X=null===(f=this._loader.ij.extensions)||void 0===f?void 0:f.KHR_xmp_json_ld,i=null===(Q=this._loader.ij.asset)||void 0===Q||null===(H=Q.extensions)||void 0===H?void 0:H.KHR_xmp_json_ld;if(X&&i){const f=+i.packet;X.packets&&f<X.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=X.packets[f])}}}function gQ(f,Q,H,X){return S.e.Zd(Q,H).scale(X)}function zQ(f,Q,H,X){return Q[H]*X}function vQ(f,Q,H,X){return-Q[H]*X}function YQ(f,Q,H,X){return Q[H+1]*X}function OQ(f,Q,H,X){return Q[H]*X*2}function nQ(f){return{scale:[new GQ(g.d.ANIMATIONTYPE_FLOAT,`${f}.uScale`,zQ,(()=>2)),new GQ(g.d.ANIMATIONTYPE_FLOAT,`${f}.vScale`,YQ,(()=>2))],offset:[new GQ(g.d.ANIMATIONTYPE_FLOAT,`${f}.uOffset`,zQ,(()=>2)),new GQ(g.d.ANIMATIONTYPE_FLOAT,`${f}.vOffset`,YQ,(()=>2))],rotation:[new GQ(g.d.ANIMATIONTYPE_FLOAT,`${f}.wAng`,vQ,(()=>1))]}}h(NQ),y(NQ,!0,(f=>new JQ(f)));class eQ extends M{buildAnimations(f,Q,H,X,i){i(f._babylonCamera,this._buildAnimation(Q,H,X))}}class GQ extends M{buildAnimations(f,Q,H,X,i){for(const S in f._data)i(f._data[S].babylonMaterial,this._buildAnimation(Q,H,X))}}class IQ extends M{buildAnimations(f,Q,H,X,i){i(f._babylonLight,this._buildAnimation(Q,H,X))}}const lQ={__array__:{__target__:!0,...j}},qQ={__array__:{__target__:!0,orthographic:{xmag:[new eQ(g.d.ANIMATIONTYPE_FLOAT,"orthoLeft",vQ,(()=>1)),new eQ(g.d.ANIMATIONTYPE_FLOAT,"orthoRight",YQ,(()=>1))],ymag:[new eQ(g.d.ANIMATIONTYPE_FLOAT,"orthoBottom",vQ,(()=>1)),new eQ(g.d.ANIMATIONTYPE_FLOAT,"orthoTop",YQ,(()=>1))],zfar:[new eQ(g.d.ANIMATIONTYPE_FLOAT,"maxZ",zQ,(()=>1))],znear:[new eQ(g.d.ANIMATIONTYPE_FLOAT,"nj",zQ,(()=>1))]},perspective:{yfov:[new eQ(g.d.ANIMATIONTYPE_FLOAT,"fov",zQ,(()=>1))],zfar:[new eQ(g.d.ANIMATIONTYPE_FLOAT,"maxZ",zQ,(()=>1))],znear:[new eQ(g.d.ANIMATIONTYPE_FLOAT,"nj",zQ,(()=>1))]}}},DQ={nodes:lQ,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new GQ(g.d.ANIMATIONTYPE_COLOR3,"albedoColor",gQ,(()=>4)),new GQ(g.d.ANIMATIONTYPE_FLOAT,"alpha",(function(f,Q,H,X){return Q[H+3]*X}),(()=>4))],metallicFactor:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"metallic",zQ,(()=>1))],roughnessFactor:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"roughness",zQ,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:nQ("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:nQ("metallicTexture")}}},emissiveFactor:[new GQ(g.d.ANIMATIONTYPE_COLOR3,"emissiveColor",gQ,(()=>3))],normalTexture:{scale:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",zQ,(()=>1))],extensions:{KHR_texture_transform:nQ("bumpTexture")}},occlusionTexture:{strength:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",zQ,(()=>1))],extensions:{KHR_texture_transform:nQ("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:nQ("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",zQ,(()=>1))],anisotropyRotation:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",zQ,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:nQ("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",zQ,(()=>1))],clearcoatRoughnessFactor:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",zQ,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:nQ("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",zQ,(()=>1))],extensions:{KHR_texture_transform:nQ("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:nQ("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",zQ,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",zQ,(()=>1))]},KHR_materials_ior:{ior:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",zQ,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",zQ,(()=>1))],iridescenceIor:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",zQ,(()=>1))],iridescenceThicknessMinimum:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",zQ,(()=>1))],iridescenceThicknessMaximum:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",zQ,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:nQ("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:nQ("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new GQ(g.d.ANIMATIONTYPE_COLOR3,"sheen.color",gQ,(()=>3))],sheenRoughnessFactor:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",zQ,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:nQ("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:nQ("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",zQ,(()=>1))],specularColorFactor:[new GQ(g.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",gQ,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:nQ("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:nQ("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",zQ,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:nQ("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new GQ(g.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",gQ,(()=>3))],attenuationDistance:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",zQ,(()=>1))],thicknessFactor:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",zQ,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:nQ("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new GQ(g.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",zQ,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:nQ("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new GQ(g.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",gQ,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:nQ("subSurface.translucencyColorTexture")}}}}}},cameras:qQ,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new IQ(g.d.ANIMATIONTYPE_COLOR3,"diffuse",gQ,(()=>3))],rj:[new IQ(g.d.ANIMATIONTYPE_FLOAT,"intensity",zQ,(()=>1))],range:[new IQ(g.d.ANIMATIONTYPE_FLOAT,"range",zQ,(()=>1))],spot:{innerConeAngle:[new IQ(g.d.ANIMATIONTYPE_FLOAT,"innerAngle",OQ,(()=>1))],outerConeAngle:[new IQ(g.d.ANIMATIONTYPE_FLOAT,"angle",OQ,(()=>1))]}}}}}};class dQ{constructor(f,Q){this._gltf=f,this._infoTree=Q}convert(f){let Q,H=this._gltf,X=this._infoTree;if(!f.startsWith("/"))throw new Error("Path must start with a /");const i=f.split("/");i.shift();for(const S of i){if(X.__array__)X=X.__array__;else if(X=X[S],!X)throw new Error(`Path ${f} is invalid`);if(void 0===H)throw new Error(`Path ${f} is invalid`);H=H[S],X.__target__&&(Q=H)}return{object:Q,info:X}}}const sQ="KHR_animation_pointer";class FQ extends dQ{constructor(f){super(f,DQ)}}class PQ{constructor(f){this.name=sQ,this._loader=f,this._pathToObjectConverter=new FQ(this._loader.ij)}get enabled(){return this._loader.isExtensionUsed(sQ)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(f,Q,H,X,i){var S;const x=null===(S=X.target.extensions)||void 0===S?void 0:S.KHR_animation_pointer;if(!x||!this._pathToObjectConverter)return null;"pointer"!==X.target.path&&Y.b.Warn(`${f}/target/path: Value (${X.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=X.target.node&&Y.b.Warn(`${f}/target/node: Value (${X.target.node}) must not be present when using the ${this.name} extension`);const K=`${f}/extensions/${this.name}`,Z=x.pointer;if(!Z)throw new Error(`${K}: Pointer is missing`);try{const S=this._pathToObjectConverter.convert(Z);return this._loader._loadAnimationChannelFromTargetInfoAsync(f,Q,H,X,S,i)}catch(B){return Y.b.Warn(`${K}/pointer: Invalid pointer (${Z}) skipped`),null}}}h(sQ),y(sQ,!0,(f=>new PQ(f)));class mQ{constructor(f,Q,H){this.frame=f,this.action=Q,this.onlyOnce=H,this.isDone=!1}_clone(){return new mQ(this.frame,this.action,this.onlyOnce)}}var cQ=H(1082),WQ=H(1102);class RQ{get loop(){return this._loop}set loop(f){f!==this._loop&&(this._loop=f,this.updateOptions({loop:f}))}get currentTime(){var f;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(f=WQ.b.audioEngine)&&void 0!==f&&f.audioContext&&(this.isPlaying||this.isPaused)){const f=this.isPaused?0:WQ.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+f}return 0}get spatialSound(){return this._spatialSound}set spatialSound(f){if(f==this._spatialSound)return;const Q=this.isPlaying;this.pause(),f?(this._spatialSound=f,this._updateSpatialParameters()):this._disableSpatialSound(),Q&&this.play()}constructor(f,Q,H){var X;let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new N.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=i.p.Zero(),this._localDirection=new i.p(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=f,H=H||v.e.LastCreatedScene)if(this._scene=H,RQ._SceneComponentInitialization(H),this._readyToPlayCallback=S,this._customAttenuationFunction=(f,Q,H,X,i)=>Q<H?f*(1-Q/H):0,K&&(this.autoplay=K.autoplay||!1,this._loop=K.loop||!1,void 0!==K.volume&&(this._volume=K.volume),this._spatialSound=K.spatialSound??!1,this.maxDistance=K.maxDistance??100,this.useCustomAttenuation=K.useCustomAttenuation??!1,this.rolloffFactor=K.rolloffFactor||1,this.refDistance=K.refDistance||1,this.distanceModel=K.distanceModel||"linear",this._playbackRate=K.playbackRate||1,this._streaming=K.streaming??!1,this._length=K.length,this._offset=K.offset),null!==(X=WQ.b.audioEngine)&&void 0!==X&&X.canUseWebAudio&&WQ.b.audioEngine.audioContext){this._soundGain=WQ.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let f=!0;if(Q)try{"string"===typeof Q?(this._urlType="String",this._url=Q):Q instanceof ArrayBuffer?this._urlType="ArrayBuffer":Q instanceof HTMLMediaElement?this._urlType="MediaElement":Q instanceof MediaStream?this._urlType="MediaStream":Q instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(Q)&&(this._urlType="Array");let H=[],X=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=WQ.b.audioEngine.audioContext.createMediaElementSource(Q),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=WQ.b.audioEngine.audioContext.createMediaStreamSource(Q),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":Q.byteLength>0&&(X=!0,this._soundLoaded(Q));break;case"AudioBuffer":this._audioBufferLoaded(Q);break;case"String":H.push(Q);case"Array":0===H.length&&(H=Q);for(let f=0;f<H.length;f++){const Q=H[f];if(X=K&&K.skipCodecCheck||-1!==Q.indexOf(".mp3",Q.length-4)&&WQ.b.audioEngine.isMP3supported||-1!==Q.indexOf(".ogg",Q.length-4)&&WQ.b.audioEngine.isOGGsupported||-1!==Q.indexOf(".wav",Q.length-4)||-1!==Q.indexOf(".m4a",Q.length-4)||-1!==Q.indexOf(".mp4",Q.length-4)||-1!==Q.indexOf("blob:"),X){this._streaming?(this._htmlAudioElement=new Audio(Q),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,x.g.SetCorsBehavior(Q,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(Q,(f=>{this._soundLoaded(f)}),void 0,!0,!0,(f=>{f&&Y.b.Error("XHR "+f.status+" error on: "+Q+"."),Y.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:f=!1}f?X||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):Y.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(Z){Y.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),WQ.b.audioEngine&&!WQ.b.audioEngine.WarnedWebAudioUnsupported&&(Y.b.Error("Web Audio is not supported by your browser."),WQ.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var f;null!==(f=WQ.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(f){var Q;null!==(Q=WQ.b.audioEngine)&&void 0!==Q&&Q.audioContext&&(this._audioBuffer=f,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(f){var Q;null!==(Q=WQ.b.audioEngine)&&void 0!==Q&&Q.audioContext&&WQ.b.audioEngine.audioContext.decodeAudioData(f,(f=>{this._audioBufferLoaded(f)}),(f=>{Y.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+f)}))}setAudioBuffer(f){var Q;null!==(Q=WQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&(this._audioBuffer=f,this._isReadyToPlay=!0)}updateOptions(f){f&&(this.loop=f.loop??this.loop,this.maxDistance=f.maxDistance??this.maxDistance,this.useCustomAttenuation=f.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=f.rolloffFactor??this.rolloffFactor,this.refDistance=f.refDistance??this.refDistance,this.distanceModel=f.distanceModel??this.distanceModel,this._playbackRate=f.playbackRate??this._playbackRate,this._length=f.length??void 0,this.spatialSound=f.spatialSound??this._spatialSound,this._setOffset(f.offset??void 0),this.setVolume(f.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var f;null!==(f=WQ.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&WQ.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??WQ.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var f;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(f=this._soundPanner)||void 0===f||f.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var f;null!==(f=WQ.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(f){var Q;null!==(Q=WQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(f),this._isOutputConnected=!0)}setDirectionalCone(f,Q,H){Q<f?Y.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=f,this._coneOuterAngle=Q,this._coneOuterGain=H,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(f){if(f!=this._coneInnerAngle){var Q;if(this._coneOuterAngle<f)return void Y.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=f,null!==(Q=WQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(f){if(f!=this._coneOuterAngle){var Q;if(f<this._coneInnerAngle)return void Y.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=f,null!==(Q=WQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(f){var Q;f.equals(this._position)||(this._position.p(f),null!==(Q=WQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(f){var Q;this._localDirection=f,null!==(Q=WQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const f=this._connectedTransformNode.getWorldMatrix(),Q=i.p.TransformNormal(this._localDirection,f);Q.normalize(),this._soundPanner.orientationX.value=Q.x,this._soundPanner.orientationY.value=Q.y,this._soundPanner.orientationZ.value=Q.z}updateDistanceFromListener(){var f;if(null!==(f=WQ.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const f=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.hd(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,f,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(f){this._customAttenuationFunction=f}play(f,Q,H){var X;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(X=WQ.b.audioEngine)&&void 0!==X&&X.audioContext)try{var i,S;this._clearTimeoutsAndObservers();let X=f?(null===(i=WQ.b.audioEngine)||void 0===i?void 0:i.audioContext.currentTime)+f:null===(S=WQ.b.audioEngine)||void 0===S?void 0:S.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=WQ.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const f=()=>{var H;if(null!==(H=WQ.b.audioEngine)&&void 0!==H&&H.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=Q??0;const H=this._htmlAudioElement.play();void 0!==H&&H.catch((()=>{var Q,H;(null===(Q=WQ.b.audioEngine)||void 0===Q||Q.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(H=WQ.b.audioEngine)||void 0===H?void 0:H.onAudioUnlockedObservable.addOnce((()=>{f()})))}))}else{var X;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(X=WQ.b.audioEngine)||void 0===X?void 0:X.onAudioUnlockedObservable.addOnce((()=>{f()}))}};f()}}else{var x;const i=()=>{var i;if(null!==(i=WQ.b.audioEngine)&&void 0!==i&&i.audioContext){var S;if(H=H||this._length,void 0!==Q&&this._setOffset(Q),this._soundSource){const f=this._soundSource;f.onended=()=>{f.disconnect()}}if(this._soundSource=null===(S=WQ.b.audioEngine)||void 0===S?void 0:S.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var x;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==Q&&(this._soundSource.loopStart=Q),void 0!==H&&(this._soundSource.loopEnd=(0|Q)+H),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},X=f?(null===(x=WQ.b.audioEngine)||void 0===x?void 0:x.audioContext.currentTime)+f:WQ.b.audioEngine.audioContext.currentTime;const i=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(X,i,this.loop?void 0:H)}}};"suspended"===(null===(x=WQ.b.audioEngine)||void 0===x?void 0:x.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var f;"suspended"===(null===(f=WQ.b.audioEngine)||void 0===f?void 0:f.audioContext.state)?(WQ.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=WQ.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{i()})))):i()}),500):i()}this._startTime=X,this.isPlaying=!0,this.isPaused=!1}catch(K){Y.b.Error("Error while trying to play audio: "+this.name+", "+K.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(f){var Q;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var H;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(H=this._streamingSource)||void 0===H||H.disconnect();this.isPlaying=!1}else if(null!==(Q=WQ.b.audioEngine)&&void 0!==Q&&Q.audioContext&&this._soundSource){const Q=f?WQ.b.audioEngine.audioContext.currentTime+f:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(Q)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var f;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var Q;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(Q=this._streamingSource)||void 0===Q||Q.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(f=WQ.b.audioEngine)&&void 0!==f&&f.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=WQ.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(f,Q){var H;null!==(H=WQ.b.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._soundGain&&(Q&&WQ.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(WQ.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,WQ.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(f,WQ.b.audioEngine.audioContext.currentTime+Q)):this._soundGain.gain.value=f),this._volume=f}setPlaybackRate(f){this._playbackRate=f,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(f){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=f,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=f=>this._onRegisterAfterWorldMatrixUpdate(f),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(f){var Q;if(f.getBoundingInfo){const Q=f.getBoundingInfo();this.setPosition(Q.boundingSphere.centerWorld)}else this.setPosition(f.absolutePosition);null!==(Q=WQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const f=()=>{this._isReadyToPlay?(H._audioBuffer=this.getAudioBuffer(),H._isReadyToPlay=!0,H.autoplay&&H.play(0,this._offset,this._length)):setTimeout(f,300)},Q={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},H=new RQ(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,Q);return this.useCustomAttenuation&&H.setAttenuationFunction(this._customAttenuationFunction),H.setPosition(this._position),H.setPlaybackRate(this._playbackRate),f(),H}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const f={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(f.connectedMeshId=this._connectedTransformNode.id),f.position=this._position.ke(),f.refDistance=this.refDistance,f.distanceModel=this.distanceModel,f.isDirectional=this._isDirectional,f.localDirectionToMesh=this._localDirection.ke(),f.coneInnerAngle=this._coneInnerAngle,f.coneOuterAngle=this._coneOuterAngle,f.coneOuterGain=this._coneOuterGain),f}static Parse(f,Q,H,X){const S=f.name;let x;x=f.url?H+f.url:H+S;const K={autoplay:f.autoplay,loop:f.loop,volume:f.volume,spatialSound:f.spatialSound,maxDistance:f.maxDistance,rolloffFactor:f.rolloffFactor,refDistance:f.refDistance,distanceModel:f.distanceModel,playbackRate:f.playbackRate};let Z;if(X){const f=()=>{X._isReadyToPlay?(Z._audioBuffer=X.getAudioBuffer(),Z._isReadyToPlay=!0,Z.autoplay&&Z.play(0,Z._offset,Z._length)):setTimeout(f,300)};Z=new RQ(S,new ArrayBuffer(0),Q,null,K),f()}else Z=new RQ(S,x,Q,(()=>{Q.removePendingData(Z)}),K),Q.addPendingData(Z);if(f.position){const Q=i.p.Zd(f.position);Z.setPosition(Q)}if(f.isDirectional&&(Z.setDirectionalCone(f.coneInnerAngle||360,f.coneOuterAngle||360,f.coneOuterGain||0),f.localDirectionToMesh)){const Q=i.p.Zd(f.localDirectionToMesh);Z.setLocalDirectionToMesh(Q)}if(f.connectedMeshId){const H=Q.getMeshById(f.connectedMeshId);H&&Z.attachToMesh(H)}return f.metadata&&(Z.metadata=f.metadata),Z}_setOffset(f){this._offset!==f&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=f)}_clearTimeoutsAndObservers(){var f;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(f=WQ.b.audioEngine)||void 0===f||f.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}RQ._SceneComponentInitialization=f=>{throw(0,cQ.c)("AudioSceneComponent")},(0,D.h)("BABYLON.Sound",RQ);class UQ{constructor(f,Q,H){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],Q.length!==H.length)throw new Error("Sounds length does not equal weights length");this.loop=f,this._weights=H;let X=0;for(const S of H)X+=S;const i=X>0?1/X:0;for(let S=0;S<this._weights.length;S++)this._weights[S]*=i;this._sounds=Q;for(const S of this._sounds)S.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(f){if(f!==this._coneInnerAngle){if(this._coneOuterAngle<f)return void Y.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=f;for(const Q of this._sounds)Q.directionalConeInnerAngle=f}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(f){if(f!==this._coneOuterAngle){if(f<this._coneInnerAngle)return void Y.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=f;for(const Q of this._sounds)Q.directionalConeOuterAngle=f}}get volume(){return this._volume}set volume(f){if(f!==this._volume)for(const Q of this._sounds)Q.setVolume(f)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(f){if(!this.isPaused){this.stop();const f=Math.random();let Q=0;for(let H=0;H<this._weights.length;H++)if(Q+=this._weights[H],f<=Q){this._currentIndex=H;break}}const Q=this._sounds[this._currentIndex??0];Q.isReady()?Q.play(0,this.isPaused?void 0:f):Q.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class EQ{constructor(f){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(f=f||v.e.LastCreatedScene)&&(this._scene=f,this.soundCollection=[],this._options=Q,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var f;null!==(f=WQ.b.audioEngine)&&void 0!==f&&f.canUseWebAudio&&WQ.b.audioEngine.audioContext&&(this._outputAudioNode=WQ.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(WQ.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(WQ.b.audioEngine&&WQ.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(f){var Q;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(Q=WQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._outputAudioNode&&f.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==f.soundTrackId&&(-1===f.soundTrackId?this._scene.mainSoundTrack.removeSound(f):this._scene.soundTracks&&this._scene.soundTracks[f.soundTrackId].removeSound(f)),this.soundCollection.push(f),f.soundTrackId=this.id}removeSound(f){const Q=this.soundCollection.indexOf(f);-1!==Q&&this.soundCollection.splice(Q,1)}setVolume(f){var Q;null!==(Q=WQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=f)}switchPanningModelToHRTF(){var f;if(null!==(f=WQ.b.audioEngine)&&void 0!==f&&f.canUseWebAudio)for(let Q=0;Q<this.soundCollection.length;Q++)this.soundCollection[Q].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var f;if(null!==(f=WQ.b.audioEngine)&&void 0!==f&&f.canUseWebAudio)for(let Q=0;Q<this.soundCollection.length;Q++)this.soundCollection[Q].switchPanningModelToEqualPower()}connectToAnalyser(f){var Q;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=f,null!==(Q=WQ.b.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,WQ.b.audioEngine.masterGain))}}var tQ=H(1281),uQ=H(1196),LQ=(H(1566),H(1126));(0,H(11450).d)(tQ.e.NAME_AUDIO,((f,Q,H,X)=>{let i,S=[];if(H.af=H.af||[],void 0!==f.af&&null!==f.af)for(let K=0,Z=f.af.length;K<Z;K++){var x;const Z=f.af[K];null!==(x=WQ.b.audioEngine)&&void 0!==x&&x.canUseWebAudio?(Z.url||(Z.url=Z.name),S[Z.url]?H.af.push(RQ.Parse(Z,Q,X,S[Z.url])):(i=RQ.Parse(Z,Q,X),S[Z.url]=i,H.af.push(i))):H.af.push(new RQ(Z.name,null,Q))}S=[]})),Object.defineProperty(uQ.e.prototype,"mainSoundTrack",{get:function(){let f=this._getComponent(tQ.e.NAME_AUDIO);return f||(f=new AQ(this),this._e(f)),this._mainSoundTrack||(this._mainSoundTrack=new EQ(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),uQ.e.prototype.getSoundByName=function(f){let Q;for(Q=0;Q<this.mainSoundTrack.soundCollection.length;Q++)if(this.mainSoundTrack.soundCollection[Q].name===f)return this.mainSoundTrack.soundCollection[Q];if(this.soundTracks)for(let H=0;H<this.soundTracks.length;H++)for(Q=0;Q<this.soundTracks[H].soundCollection.length;Q++)if(this.soundTracks[H].soundCollection[Q].name===f)return this.soundTracks[H].soundCollection[Q];return null},Object.defineProperty(uQ.e.prototype,"audioEnabled",{get:function(){let f=this._getComponent(tQ.e.NAME_AUDIO);return f||(f=new AQ(this),this._e(f)),f.audioEnabled},set:function(f){let Q=this._getComponent(tQ.e.NAME_AUDIO);Q||(Q=new AQ(this),this._e(Q)),f?Q.enableAudio():Q.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(uQ.e.prototype,"headphone",{get:function(){let f=this._getComponent(tQ.e.NAME_AUDIO);return f||(f=new AQ(this),this._e(f)),f.headphone},set:function(f){let Q=this._getComponent(tQ.e.NAME_AUDIO);Q||(Q=new AQ(this),this._e(Q)),f?Q.switchAudioModeForHeadphones():Q.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(uQ.e.prototype,"audioListenerPositionProvider",{get:function(){let f=this._getComponent(tQ.e.NAME_AUDIO);return f||(f=new AQ(this),this._e(f)),f.audioListenerPositionProvider},set:function(f){let Q=this._getComponent(tQ.e.NAME_AUDIO);if(Q||(Q=new AQ(this),this._e(Q)),f&&"function"!==typeof f)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");Q.audioListenerPositionProvider=f},enumerable:!0,configurable:!0}),Object.defineProperty(uQ.e.prototype,"audioListenerRotationProvider",{get:function(){let f=this._getComponent(tQ.e.NAME_AUDIO);return f||(f=new AQ(this),this._e(f)),f.audioListenerRotationProvider},set:function(f){let Q=this._getComponent(tQ.e.NAME_AUDIO);if(Q||(Q=new AQ(this),this._e(Q)),f&&"function"!==typeof f)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");Q.audioListenerRotationProvider=f},enumerable:!0,configurable:!0}),Object.defineProperty(uQ.e.prototype,"audioPositioningRefreshRate",{get:function(){let f=this._getComponent(tQ.e.NAME_AUDIO);return f||(f=new AQ(this),this._e(f)),f.audioPositioningRefreshRate},set:function(f){let Q=this._getComponent(tQ.e.NAME_AUDIO);Q||(Q=new AQ(this),this._e(Q)),Q.audioPositioningRefreshRate=f},enumerable:!0,configurable:!0});class AQ{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(f){this.name=tQ.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new i.p,this._cachedCameraPosition=new i.p,this._lastCheck=0,this._invertMatrixTemp=new i.e,this._cameraDirectionTemp=new i.p,(f=f||v.e.LastCreatedScene)&&(this.Re=f,f.soundTracks=[],f.af=[])}register(){this.Re._afterRenderStage.registerStep(tQ.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(f){if(f.af=[],this.Re.soundTracks)for(let Q=0;Q<this.Re.soundTracks.length;Q++){const H=this.Re.soundTracks[Q];for(let Q=0;Q<H.soundCollection.length;Q++)f.af.push(H.soundCollection[Q].serialize())}}addFromContainer(f){f.af&&f.af.forEach((f=>{f.play(),f.autoplay=!0,this.Re.mainSoundTrack.addSound(f)}))}removeFromContainer(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f.af&&f.af.forEach((f=>{f.stop(),f.autoplay=!1,this.Re.mainSoundTrack.removeSound(f),Q&&f.dispose()}))}dispose(){const f=this.Re;if(f._mainSoundTrack&&f.mainSoundTrack.dispose(),f.soundTracks)for(let Q=0;Q<f.soundTracks.length;Q++)f.soundTracks[Q].dispose()}disableAudio(){const f=this.Re;let Q;for(this._audioEnabled=!1,WQ.b.audioEngine&&WQ.b.audioEngine.audioContext&&WQ.b.audioEngine.audioContext.suspend(),Q=0;Q<f.mainSoundTrack.soundCollection.length;Q++)f.mainSoundTrack.soundCollection[Q].pause();if(f.soundTracks)for(Q=0;Q<f.soundTracks.length;Q++)for(let H=0;H<f.soundTracks[Q].soundCollection.length;H++)f.soundTracks[Q].soundCollection[H].pause()}enableAudio(){const f=this.Re;let Q;for(this._audioEnabled=!0,WQ.b.audioEngine&&WQ.b.audioEngine.audioContext&&WQ.b.audioEngine.audioContext.resume(),Q=0;Q<f.mainSoundTrack.soundCollection.length;Q++)f.mainSoundTrack.soundCollection[Q].isPaused&&f.mainSoundTrack.soundCollection[Q].play();if(f.soundTracks)for(Q=0;Q<f.soundTracks.length;Q++)for(let H=0;H<f.soundTracks[Q].soundCollection.length;H++)f.soundTracks[Q].soundCollection[H].isPaused&&f.soundTracks[Q].soundCollection[H].play()}switchAudioModeForHeadphones(){const f=this.Re;if(this._headphone=!0,f.mainSoundTrack.switchPanningModelToHRTF(),f.soundTracks)for(let Q=0;Q<f.soundTracks.length;Q++)f.soundTracks[Q].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const f=this.Re;if(this._headphone=!1,f.mainSoundTrack.switchPanningModelToEqualPower(),f.soundTracks)for(let Q=0;Q<f.soundTracks.length;Q++)f.soundTracks[Q].switchPanningModelToEqualPower()}_afterRender(){const f=LQ.c.Now;if(this._lastCheck&&f-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=f;const Q=this.Re;if(!this._audioEnabled||!Q._mainSoundTrack||!Q.soundTracks||0===Q._mainSoundTrack.soundCollection.length&&1===Q.soundTracks.length)return;const H=WQ.b.audioEngine;if(H&&H.audioContext){let f,X=Q.activeCamera;if(Q.activeCameras&&Q.activeCameras.length>0&&(X=Q.activeCameras[0]),this.audioListenerPositionProvider){const f=this.audioListenerPositionProvider();H.audioContext.listener.setPosition(f.x||0,f.y||0,f.z||0)}else X?this._cachedCameraPosition.equals(X.globalPosition)||(this._cachedCameraPosition.p(X.globalPosition),H.audioContext.listener.setPosition(X.globalPosition.x,X.globalPosition.y,X.globalPosition.z)):H.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const f=this.audioListenerRotationProvider();H.audioContext.listener.setOrientation(f.x||0,f.y||0,f.z||0,0,1,0)}else X?(X.rigCameras&&X.rigCameras.length>0&&(X=X.rigCameras[0]),X.getViewMatrix().invertToRef(this._invertMatrixTemp),i.p.TransformNormalToRef(AQ._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),H.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):H.audioContext.listener.setOrientation(0,0,0,0,1,0);for(f=0;f<Q.mainSoundTrack.soundCollection.length;f++){const H=Q.mainSoundTrack.soundCollection[f];H.useCustomAttenuation&&H.updateDistanceFromListener()}if(Q.soundTracks)for(f=0;f<Q.soundTracks.length;f++)for(let H=0;H<Q.soundTracks[f].soundCollection.length;H++){const X=Q.soundTracks[f].soundCollection[H];X.useCustomAttenuation&&X.updateDistanceFromListener()}}}}AQ._CameraDirection=new i.p(0,0,-1),RQ._SceneComponentInitialization=f=>{let Q=f._getComponent(tQ.e.NAME_AUDIO);Q||(Q=new AQ(f),f._e(Q))};const aQ="MSFT_audio_emitter";class VQ{constructor(f){this.name=aQ,this._loader=f,this.enabled=this._loader.isExtensionUsed(aQ)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const f=this._loader.ij.extensions;if(f&&f[this.name]){const Q=f[this.name];this._clips=Q.clips,this._emitters=Q.emitters,b.Assign(this._clips),b.Assign(this._emitters)}}loadSceneAsync(f,Q){return o.LoadExtensionAsync(f,Q,this.name,((H,X)=>{const i=new Array;i.push(this._loader.loadSceneAsync(f,Q));for(const f of X.emitters){const Q=b.Get(`${H}/emitters`,this._emitters,f);if(void 0!=Q.refDistance||void 0!=Q.maxDistance||void 0!=Q.rolloffFactor||void 0!=Q.distanceModel||void 0!=Q.innerAngle||void 0!=Q.outerAngle)throw new Error(`${H}: Direction or Distance properties are not allowed on emitters attached to a scene`);i.push(this._loadEmitterAsync(`${H}/emitters/${Q.index}`,Q))}return Promise.all(i).then((()=>{}))}))}loadNodeAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((f,X)=>{const S=new Array;return this._loader.loadNodeAsync(f,Q,(Q=>{for(const H of X.emitters){const X=b.Get(`${f}/emitters`,this._emitters,H);S.push(this._loadEmitterAsync(`${f}/emitters/${X.index}`,X).then((()=>{for(const f of X._babylonSounds)f.attachToMesh(Q),void 0==X.innerAngle&&void 0==X.outerAngle||(f.setLocalDirectionToMesh(i.p.Forward()),f.setDirectionalCone(2*x.g.ToDegrees(void 0==X.innerAngle?Math.PI:X.innerAngle),2*x.g.ToDegrees(void 0==X.outerAngle?Math.PI:X.outerAngle),0))})))}H(Q)})).then((f=>Promise.all(S).then((()=>f))))}))}loadAnimationAsync(f,Q){return o.LoadExtensionAsync(f,Q,this.name,((H,X)=>this._loader.loadAnimationAsync(f,Q).then((i=>{const S=new Array;b.Assign(X.events);for(const x of X.events)S.push(this._loadAnimationEventAsync(`${H}/events/${x.index}`,f,Q,x,i));return Promise.all(S).then((()=>i))}))))}_loadClipAsync(f,Q){if(Q._objectURL)return Q._objectURL;let H;if(Q.uri)H=this._loader.loadUriAsync(f,Q,Q.uri);else{const X=b.Get(`${f}/bufferView`,this._loader.ij.bufferViews,Q.bufferView);H=this._loader.loadBufferViewAsync(`/bufferViews/${X.index}`,X)}return Q._objectURL=H.then((f=>URL.createObjectURL(new Blob([f],{type:Q.mimeType})))),Q._objectURL}_loadEmitterAsync(f,Q){if(Q._babylonSounds=Q._babylonSounds||[],!Q._babylonData){const f=new Array,H=Q.name||`emitter${Q.index}`,X={loop:!1,autoplay:!1,volume:void 0==Q.volume?1:Q.volume};for(let S=0;S<Q.clips.length;S++){const i=`/extensions/${this.name}/clips`,x=b.Get(i,this._clips,Q.clips[S].clip);f.push(this._loadClipAsync(`${i}/${Q.clips[S].clip}`,x).then((f=>{const i=Q._babylonSounds[S]=new RQ(H,f,this._loader.babylonScene,null,X);i.refDistance=Q.refDistance||1,i.maxDistance=Q.maxDistance||256,i.rolloffFactor=Q.rolloffFactor||1,i.distanceModel=Q.distanceModel||"exponential"})))}const i=Promise.all(f).then((()=>{const f=Q.clips.map((f=>f.weight||1)),H=new UQ(Q.loop||!1,Q._babylonSounds,f);Q.innerAngle&&(H.directionalConeInnerAngle=2*x.g.ToDegrees(Q.innerAngle)),Q.outerAngle&&(H.directionalConeOuterAngle=2*x.g.ToDegrees(Q.outerAngle)),Q.volume&&(H.volume=Q.volume),Q._babylonData.sound=H}));Q._babylonData={loaded:i}}return Q._babylonData.loaded}_getEventAction(f,Q,H,X,i){switch(H){case"play":return f=>{const H=(i||0)+(f-X);Q.play(H)};case"stop":return()=>{Q.stop()};case"pause":return()=>{Q.pause()};default:throw new Error(`${f}: Unsupported action ${H}`)}}_loadAnimationEventAsync(f,Q,H,X,i){if(0==i.targetedAnimations.length)return Promise.resolve();const S=i.targetedAnimations[0],x=X.k,K=b.Get(`/extensions/${this.name}/emitters`,this._emitters,x);return this._loadEmitterAsync(f,K).then((()=>{const Q=K._babylonData.sound;if(Q){const H=new mQ(X.time,this._getEventAction(f,Q,X.action,X.time,X.startOffset));S.animation.addEvent(H),i.onAnimationGroupEndObservable.add((()=>{Q.stop()})),i.onAnimationGroupPauseObservable.add((()=>{Q.pause()}))}}))}}h(aQ),y(aQ,!0,(f=>new VQ(f)));const MQ="MSFT_lod";class rQ{constructor(f){var Q;this.name=MQ,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new N.e,this.onMaterialLODsLoadedObservable=new N.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=f,this.maxLODsToLoad=(null===(Q=this._loader.parent.extensionOptions[MQ])||void 0===Q?void 0:Q.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(MQ)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let f=0;f<this._nodePromiseLODs.length;f++){const Q=Promise.all(this._nodePromiseLODs[f]).then((()=>{0!==f&&(this._loader.endPerformanceCounter(`Node LOD ${f}`),this._loader.log(`Loaded node LOD ${f}`)),this.onNodeLODsLoadedObservable.notifyObservers(f),f!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${f+1}`),this._loadBufferLOD(this._nodeBufferLODs,f+1),this._nodeSignalLODs[f]&&this._nodeSignalLODs[f].resolve())}));this._loader._completePromises.push(Q)}for(let f=0;f<this._materialPromiseLODs.length;f++){const Q=Promise.all(this._materialPromiseLODs[f]).then((()=>{0!==f&&(this._loader.endPerformanceCounter(`Material LOD ${f}`),this._loader.log(`Loaded material LOD ${f}`)),this.onMaterialLODsLoadedObservable.notifyObservers(f),f!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${f+1}`),this._loadBufferLOD(this._materialBufferLODs,f+1),this._materialSignalLODs[f]&&this._materialSignalLODs[f].resolve())}));this._loader._completePromises.push(Q)}}loadSceneAsync(f,Q){const H=this._loader.loadSceneAsync(f,Q);return this._loadBufferLOD(this._bufferLODs,0),H}loadNodeAsync(f,Q,H){return o.LoadExtensionAsync(f,Q,this.name,((f,i)=>{let S;const x=this._getLODs(f,Q,this._loader.ij.nodes,i.ids);this._loader.logOpen(`${f}`);for(let Q=0;Q<x.length;Q++){const f=x[Q];0!==Q&&(this._nodeIndexLOD=Q,this._nodeSignalLODs[Q]=this._nodeSignalLODs[Q]||new X);const i=f=>{H(f),f.Dg(!1)},K=this._loader.loadNodeAsync(`/nodes/${f.index}`,f,i).then((f=>{if(0!==Q){const f=x[Q-1];f._babylonTransformNode&&(this._disposeTransformNode(f._babylonTransformNode),delete f._babylonTransformNode)}return f.Dg(!0),f}));this._nodePromiseLODs[Q]=this._nodePromiseLODs[Q]||[],0===Q?S=K:(this._nodeIndexLOD=null,this._nodePromiseLODs[Q].push(K))}return this._loader.logClose(),S}))}_loadMaterialAsync(f,Q,H,X,i){return this._nodeIndexLOD?null:o.LoadExtensionAsync(f,Q,this.name,((f,S)=>{let x;const K=this._getLODs(f,Q,this._loader.ij.materials,S.ids);this._loader.logOpen(`${f}`);for(let Q=0;Q<K.length;Q++){const f=K[Q];0!==Q&&(this._materialIndexLOD=Q);const S=this._loader._loadMaterialAsync(`/materials/${f.index}`,f,H,X,(f=>{0===Q&&i(f)})).then((f=>{if(0!==Q){i(f);const H=K[Q-1]._data;H[X]&&(this._disposeMaterials([H[X].babylonMaterial]),delete H[X])}return f}));this._materialPromiseLODs[Q]=this._materialPromiseLODs[Q]||[],0===Q?x=S:(this._materialIndexLOD=null,this._materialPromiseLODs[Q].push(S))}return this._loader.logClose(),x}))}_loadUriAsync(f,Q,H){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const i=this._nodeIndexLOD-1;return this._nodeSignalLODs[i]=this._nodeSignalLODs[i]||new X,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(f,Q,H)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const i=this._materialIndexLOD-1;return this._materialSignalLODs[i]=this._materialSignalLODs[i]||new X,this._materialSignalLODs[i].promise.then((()=>this._loader.loadUriAsync(f,Q,H)))}return null}loadBufferAsync(f,Q,H,i){if(this._loader.parent.useRangeRequests&&!Q.uri){if(!this._loader.bin)throw new Error(`${f}: Uri is missing or the binary glTF is missing its binary chunk`);const Q=(f,Q)=>{const S=H,x=S+i-1;let K=f[Q];return K?(K.start=Math.min(K.start,S),K.end=Math.max(K.end,x)):(K={start:S,end:x,loaded:new X},f[Q]=K),K.loaded.promise.then((f=>new Uint8Array(f.buffer,f.byteOffset+H-K.start,i)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?Q(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?Q(this._materialBufferLODs,this._materialIndexLOD):Q(this._bufferLODs,0)}return null}_loadBufferLOD(f,Q){const H=f[Q];H&&(this._loader.log(`Loading buffer range [${H.start}-${H.end}]`),this._loader.bin.readAsync(H.start,H.end-H.start+1).then((f=>{H.loaded.resolve(f)}),(f=>{H.loaded.reject(f)})))}_getLODs(f,Q,H,X){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const i=[];for(let S=X.length-1;S>=0;S--)if(i.push(b.Get(`${f}/ids/${X[S]}`,H,X[S])),i.length===this.maxLODsToLoad)return i;return i.push(Q),i}_disposeTransformNode(f){const Q=[],H=f.material;H&&Q.push(H);for(const i of f.getChildMeshes())i.material&&Q.push(i.material);f.dispose();const X=Q.filter((f=>this._loader.babylonScene.meshes.every((Q=>Q.material!=f))));this._disposeMaterials(X)}_disposeMaterials(f){const Q={};for(const H of f){for(const f of H.getActiveTextures())Q[f.uniqueId]=f;H.dispose()}for(const H in Q)for(const f of this._loader.babylonScene.materials)f.hasTexture(Q[H])&&delete Q[H];for(const H in Q)Q[H].dispose()}}h(MQ),y(MQ,!0,(f=>new rQ(f)));const jQ="MSFT_minecraftMesh";class TQ{constructor(f){this.name=jQ,this._loader=f,this.enabled=this._loader.isExtensionUsed(jQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,Q,H){return o.LoadExtraAsync(f,Q,this.name,((X,i)=>{if(i){if(!(H instanceof s))throw new Error(`${X}: Material type not supported`);const i=this._loader.loadMaterialPropertiesAsync(f,Q,H);return H.needAlphaBlending()&&(H.forceDepthWrite=!0,H.separateCullingPass=!0),H.we=H.forceDepthWrite,H.twoSidedLighting=!0,i}return null}))}}h(jQ),y(jQ,!0,(f=>new TQ(f)));const kQ="MSFT_sRGBFactors";class yQ{constructor(f){this.name=kQ,this._loader=f,this.enabled=this._loader.isExtensionUsed(kQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(f,Q,H){return o.LoadExtraAsync(f,Q,this.name,((X,i)=>{if(i){if(!(H instanceof s))throw new Error(`${X}: Material type not supported`);const i=this._loader.loadMaterialPropertiesAsync(f,Q,H),S=H.va().getEngine().useExactSrgbConversions;return H.albedoTexture||H.albedoColor.toLinearSpaceToRef(H.albedoColor,S),H.reflectivityTexture||H.reflectivityColor.toLinearSpaceToRef(H.reflectivityColor,S),i}return null}))}}h(kQ),y(kQ,!0,(f=>new yQ(f)));var hQ,wQ=H(1045);!function(f){f[f.Input=0]="Input",f[f.Output=1]="Output"}(hQ||(hQ={}));class bQ{constructor(f,Q,H){this._ownerBlock=H,this._connectedPoint=[],this.uniqueId=(0,wQ.c)(),this.connectedPointIds=[],this.name=f,this._connectionType=Q}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(f){if(this._connectionType===f._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||f._isSingularConnection()&&f._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(f),f._connectedPoint.push(this)}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f.uniqueId=this.uniqueId,f.name=this.name,f._connectionType=this._connectionType,f.connectedPointIds=[],f.className=this.getClassName();for(const Q of this._connectedPoint)f.connectedPointIds.push(Q.uniqueId)}getClassName(){return"FGConnection"}deserialize(f){this.uniqueId=f.uniqueId,this.name=f.name,this._connectionType=f._connectionType,this.connectedPointIds=f.connectedPointIds}static Parse(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Q=arguments.length>1?arguments[1]:void 0;const H=new(x.g.Instantiate(f.className))(f.name,f._connectionType,Q);return H.deserialize(f),H}}class oQ{constructor(f){this.value=this._toInt(f)}_toInt(f){return 0|f}add(f){return new oQ(this.value+f.value)}hd(f){return new oQ(this.value-f.value)}multiply(f){return new oQ(Math.imul(this.value,f.value))}divide(f){return new oQ(this.value/f.value)}getClassName(){return oQ.ClassName}equals(f){return this.value===f.value}static Parse(f){return new oQ(f.value)}}oQ.ClassName="FlowGraphInteger",(0,D.h)("FlowGraphInteger",oQ);class pQ{constructor(f,Q){this.typeName=f,this.defaultValue=Q}serialize(f){f.typeName=this.typeName,f.defaultValue=this.defaultValue}static Parse(f){return new pQ(f.typeName,f.defaultValue)}}const CQ=new pQ("any",void 0),fH=(new pQ("string",""),new pQ("number",0)),QH=new pQ("boolean",!1),HH=new pQ("Vector2",i.m.Zero()),XH=new pQ("Wd",i.p.Zero()),iH=(new pQ("Vector4",i.s.Zero()),new pQ("Matrix",i.e.Identity())),SH=(new pQ("Fe",S.e.Black()),new pQ("Ge",new S.h(0,0,0,0)),new pQ("Quaternion",i.i.Identity()),new pQ("FlowGraphInteger",new oQ(0)));class xH extends bQ{constructor(f,Q,H,X){super(f,Q,H),this.richType=X}_isSingularConnection(){return 0===this.connectionType}setValue(f,Q){Q._setConnectionValue(this,f)}connectTo(f){super.connectTo(f)}_getValueOrDefault(f){return f._hasConnectionValue(this)?f._getConnectionValue(this):this.richType.defaultValue}getValue(f){return 1===this.connectionType?(f._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(f),this._getValueOrDefault(f)):this.isConnected()?this._connectedPoint[0].getValue(f):this._getValueOrDefault(f)}getClassName(){return"FGDataConnection"}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(f),f.richType={},this.richType.serialize(f.richType)}static Parse(f,Q){const H=bQ.Parse(f,Q);return H.richType=pQ.Parse(f.richType),H}}function KH(f){return"Mesh"===f||"AbstractMesh"===f||"GroundMesh"===f||"InstanceMesh"===f||"LinesMesh"===f||"GoldbergMesh"===f||"GreasedLineMesh"===f||"TrailMesh"===f}function ZH(f){return"Vector2"===f||"Wd"===f||"Vector4"===f||"Quaternion"===f||"Fe"===f||"Ge"===f}function BH(f,Q,H){var X;const i=(null===Q||void 0===Q||null===(X=Q.getClassName)||void 0===X?void 0:X.call(Q))??"";KH(i)?H[f]={name:Q.name,className:i}:ZH(i)?H[f]={value:Q.ke(),className:i}:H[f]=Q}function NH(f,Q,H){const X=Q[f];let x;const K=null===X||void 0===X?void 0:X.className;return x=KH(K)?H.getMeshByName(X.name):ZH(K)?function(f,Q){if("Vector2"===f)return i.m.Zd(Q);if("Wd"===f)return i.p.Zd(Q);if("Vector4"===f)return i.s.Zd(Q);if("Quaternion"===f)return i.i.Zd(Q);if("Fe"===f)return new S.e(Q[0],Q[1],Q[2]);if("Ge"===f)return new S.h(Q[0],Q[1],Q[2],Q[3]);throw new Error(`Unknown vector class name ${f}`)}(K,X.value):"Matrix"===K?i.e.Zd(X.value):K===oQ.ClassName?oQ.Parse(X):X&&void 0!==X.value?X.value:X,x}(0,D.h)("FGDataConnection",xH);class JH{constructor(f){var Q;this.config=f,this.uniqueId=(0,wQ.c)(),this.name=(null===(Q=this.config)||void 0===Q?void 0:Q.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(f){}registerDataInput(f,Q){const H=new xH(f,0,this,Q);return this.dataInputs.push(H),H}registerDataOutput(f,Q){const H=new xH(f,1,this,Q);return this.dataOutputs.push(H),H}getDataInput(f){return this.dataInputs.find((Q=>Q.name===f))}getDataOutput(f){return this.dataOutputs.find((Q=>Q.name===f))}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f.uniqueId=this.uniqueId,f.config={},this.config&&(f.config.name=this.config.name),f.dataInputs=[],f.dataOutputs=[],f.className=this.getClassName();for(const Q of this.dataInputs){const H={};Q.serialize(H),f.dataInputs.push(H)}for(const Q of this.dataOutputs){const H={};Q.serialize(H),f.dataOutputs.push(H)}}getClassName(){return"FGBlock"}static Parse(f,Q){const H=x.g.Instantiate(f.className),X={},i=Q.valueParseFunction??NH;if(f.config)for(const x in f.config)X[x]=i(x,f.config,Q.Re);var S;("FGSetPropertyBlock"===(S=f.className)||"FGGetPropertyBlock"===S||"FGPlayAnimationBlock"===S||"FGMeshPickEventBlock"===S)&&(X.pathConverter=Q.pathConverter);const K=new H(X);K.uniqueId=f.uniqueId;for(let x=0;x<f.dataInputs.length;x++){const Q=K.getDataInput(f.dataInputs[x].name);if(!Q)throw new Error("Could not find data input with name "+f.dataInputs[x].name+" in block "+f.className);Q.deserialize(f.dataInputs[x])}for(let x=0;x<f.dataOutputs.length;x++){const Q=K.getDataOutput(f.dataOutputs[x].name);if(!Q)throw new Error("Could not find data output with name "+f.dataOutputs[x].name+" in block "+f.className);Q.deserialize(f.dataOutputs[x])}return K.metadata=f.metadata,K.deserialize&&K.deserialize(f),K}}class gH extends bQ{_isSingularConnection(){return 1===this.connectionType}_activateSignal(f){var Q;0===this.connectionType?(f._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(f,this),f._increaseExecutionId()):null===(Q=this._connectedPoint[0])||void 0===Q||Q._activateSignal(f)}}(0,D.h)("FlowGraphSignalConnection",gH);class zH extends JH{constructor(f){super(f),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(f){const Q=new gH(f,0,this);return this.signalInputs.push(Q),Q}_registerSignalOutput(f){const Q=new gH(f,1,this);return this.signalOutputs.push(Q),Q}getSignalInput(f){return this.signalInputs.find((Q=>Q.name===f))}getSignalOutput(f){return this.signalOutputs.find((Q=>Q.name===f))}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(f),f.signalInputs=[],f.signalOutputs=[];for(const Q of this.signalInputs){const H={};Q.serialize(H),f.signalInputs.push(H)}for(const Q of this.signalOutputs){const H={};Q.serialize(H),f.signalOutputs.push(H)}}deserialize(f){for(let Q=0;Q<f.signalInputs.length;Q++){const H=this.getSignalInput(f.signalInputs[Q].name);if(!H)throw new Error("Could not find signal input with name "+f.signalInputs[Q].name+" in block "+f.className);H.deserialize(f.signalInputs[Q])}for(let Q=0;Q<f.signalOutputs.length;Q++){const H=this.getSignalOutput(f.signalOutputs[Q].name);if(!H)throw new Error("Could not find signal output with name "+f.signalOutputs[Q].name+" in block "+f.className);H.deserialize(f.signalOutputs[Q])}}getClassName(){return"FGExecutionBlock"}}class vH extends zH{constructor(f){super(f),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(f){this._preparePendingTasks(f),f._addPendingBlock(this)}}class YH extends vH{_execute(f){f._notifyExecuteNode(this),this.out._activateSignal(f)}}class OH{constructor(f){this.uniqueId=(0,wQ.c)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new N.e,this._configuration=f}hasVariable(f){return f in this._userVariables}setVariable(f,Q){this._userVariables[f]=Q}getVariable(f){return this._userVariables[f]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(f,Q){return`${f.uniqueId}_${Q}`}_setExecutionVariable(f,Q,H){this._executionVariables[this._getUniqueIdPrefixedName(f,Q)]=H}_getExecutionVariable(f,Q,H){return this._hasExecutionVariable(f,Q)?this._executionVariables[this._getUniqueIdPrefixedName(f,Q)]:H}_deleteExecutionVariable(f,Q){delete this._executionVariables[this._getUniqueIdPrefixedName(f,Q)]}_hasExecutionVariable(f,Q){return this._getUniqueIdPrefixedName(f,Q)in this._executionVariables}_hasConnectionValue(f){return f.uniqueId in this._connectionValues}_setConnectionValue(f,Q){this._connectionValues[f.uniqueId]=Q}_getConnectionValue(f){return this._connectionValues[f.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(f){this._pendingBlocks.push(f)}_removePendingBlock(f){const Q=this._pendingBlocks.indexOf(f);-1!==Q&&this._pendingBlocks.splice(Q,1)}_clearPendingBlocks(){for(const f of this._pendingBlocks)f._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(f){this.onNodeExecutedObservable.notifyObservers(f)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:BH;f.uniqueId=this.uniqueId,f._userVariables={};for(const H in this._userVariables)Q(H,this._userVariables[H],f._userVariables);f._connectionValues={};for(const H in this._connectionValues)Q(H,this._connectionValues[H],f._connectionValues)}getClassName(){return"FGContext"}static Parse(f,Q){const H=Q.graph.createContext(),X=Q.valueParseFunction??NH;H.uniqueId=f.uniqueId;for(const i in f._userVariables){const Q=X(i,f._userVariables,H._configuration.Re);H._userVariables[i]=Q}for(const i in f._connectionValues){const Q=X(i,f._connectionValues,H._configuration.Re);H._connectionValues[i]=Q}return H}}(0,G.d)([(0,I.G)()],OH.prototype,"uniqueId",void 0);var nH,eH,GH=H(1290);function IH(f,Q){return!(!f.parent||f.parent!==Q&&!IH(f.parent,Q))}class lH extends YH{constructor(f){super(f),this.config=f}_getReferencedMesh(){const f=this.config.pathConverter.convert(this.config.path),Q=f.info.getObject(f.object);if(!Q||!(Q instanceof W.c))throw new Error("Mesh pick event block requires a valid mesh");return Q}_preparePendingTasks(f){let Q=f._getExecutionVariable(this,"meshPickObserver");if(!Q){const H=this._getReferencedMesh();f._setExecutionVariable(this,"mesh",H),Q=H.va().onPointerObservable.add((Q=>{var X,i,S;Q.type===GH.c.POINTERPICK&&null!==(X=Q.pickInfo)&&void 0!==X&&X.pickedMesh&&((null===(i=Q.pickInfo)||void 0===i?void 0:i.pickedMesh)===H||IH(null===(S=Q.pickInfo)||void 0===S?void 0:S.pickedMesh,H))&&this._execute(f)}));const X=H.fe.add((()=>this._onDispose));f._setExecutionVariable(this,"meshPickObserver",Q),f._setExecutionVariable(this,"meshDisposeObserver",X)}}_onDispose(f){this._cancelPendingTasks(f),f._removePendingBlock(this)}_cancelPendingTasks(f){const Q=f._getExecutionVariable(this,"mesh"),H=f._getExecutionVariable(this,"meshPickObserver"),X=f._getExecutionVariable(this,"meshDisposeObserver");Q.va().onPointerObservable.remove(H),Q.fe.remove(X),f._deleteExecutionVariable(this,"mesh"),f._deleteExecutionVariable(this,"meshPickObserver"),f._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return lH.ClassName}serialize(f){super.serialize(f),f.config.path=this.config.path}}lH.ClassName="FGMeshPickEventBlock",(0,D.h)(lH.ClassName,lH),function(f){f[f.Stopped=0]="Stopped",f[f.Started=1]="Started"}(nH||(nH={}));class qH{constructor(f){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=f.Re,this._coordinator=f.coordinator,this._sceneDisposeObserver=this._scene.fe.add((()=>this.dispose()))}createContext(){const f=new OH({Re:this._scene,coordinator:this._coordinator});return this._executionContexts.push(f),f}getContext(f){return this._executionContexts[f]}addEventBlock(f){this._eventBlocks.push(f)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const f of this._executionContexts){const Q=this._getContextualOrder();for(const H of Q)H._startPendingTasks(f)}}}_getContextualOrder(){const f=[];for(const Q of this._eventBlocks)if(Q.getClassName()===lH.ClassName){const H=Q._getReferencedMesh();let X=0;for(;X<f.length;X++){const Q=f[X]._getReferencedMesh();if(H&&Q&&IH(H,Q))break}f.splice(X,0,Q)}else f.push(Q);return f}dispose(){if(0!==this.state){this.state=0;for(const f of this._executionContexts)f._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.fe.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(f){const Q=[],H=new Set;for(const X of this._eventBlocks)Q.push(X),H.add(X.uniqueId);for(;Q.length>0;){const X=Q.pop();f(X);for(const f of X.dataInputs)for(const X of f._connectedPoint)H.has(X._ownerBlock.uniqueId)||(Q.push(X._ownerBlock),H.add(X._ownerBlock.uniqueId));if(X instanceof zH)for(const f of X.signalOutputs)for(const X of f._connectedPoint)H.has(X._ownerBlock.uniqueId)||(Q.push(X._ownerBlock),H.add(X._ownerBlock.uniqueId))}}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Q=arguments.length>1?arguments[1]:void 0;f.allBlocks=[],this.visitAllBlocks((Q=>{const H={};Q.serialize(H),f.allBlocks.push(H)})),f.executionContexts=[];for(const H of this._executionContexts){const X={};H.serialize(X,Q),f.executionContexts.push(X)}}static GetDataOutConnectionByUniqueId(f,Q){for(const H of f)for(const f of H.dataOutputs)if(f.uniqueId===Q)return f;throw new Error("Could not find data out connection with unique id "+Q)}static GetSignalInConnectionByUniqueId(f,Q){for(const H of f)if(H instanceof zH)for(const f of H.signalInputs)if(f.uniqueId===Q)return f;throw new Error("Could not find signal in connection with unique id "+Q)}static Parse(f,Q){const H=Q.coordinator.createGraph(),X=[],i=Q.valueParseFunction??NH;for(const S of f.allBlocks){const f=JH.Parse(S,{Re:Q.coordinator.config.Re,pathConverter:Q.pathConverter,valueParseFunction:i});X.push(f),f instanceof YH&&H.addEventBlock(f)}for(const S of X){for(const f of S.dataInputs)for(const Q of f.connectedPointIds){const H=qH.GetDataOutConnectionByUniqueId(X,Q);f.connectTo(H)}if(S instanceof zH)for(const f of S.signalOutputs)for(const Q of f.connectedPointIds){const H=qH.GetSignalInConnectionByUniqueId(X,Q);f.connectTo(H)}}for(const S of f.executionContexts)OH.Parse(S,{graph:H,valueParseFunction:i});return H}}class DH{constructor(f){this.config=f,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Re.fe.add((()=>{this.dispose()}));(DH.SceneCoordinators.get(this.config.Re)??[]).push(this)}createGraph(){const f=new qH({Re:this.config.Re,coordinator:this});return this._flowGraphs.push(f),f}removeGraph(f){const Q=this._flowGraphs.indexOf(f);-1!==Q&&(f.dispose(),this._flowGraphs.splice(Q,1))}start(){this._flowGraphs.forEach((f=>f.start()))}dispose(){this._flowGraphs.forEach((f=>f.dispose())),this._flowGraphs.length=0;const f=DH.SceneCoordinators.get(this.config.Re)??[],Q=f.indexOf(this);-1!==Q&&f.splice(Q,1)}serialize(f,Q){f._flowGraphs=[],this._flowGraphs.forEach((H=>{const X={};H.serialize(X,Q),f._flowGraphs.push(X)}))}static Parse(f,Q){var H;const X=Q.valueParseFunction??NH,i=new DH({Re:Q.Re});return null===(H=f._flowGraphs)||void 0===H||H.forEach((f=>{qH.Parse(f,{coordinator:i,valueParseFunction:X,pathConverter:Q.pathConverter})})),i}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(f){let Q=this._customEventsMap.get(f);return Q||(Q=new N.e,this._customEventsMap.set(f,Q)),Q}notifyCustomEvent(f,Q){const H=this._customEventsMap.get(f);H&&H.notifyObservers(Q)}}DH.SceneCoordinators=new Map;class dH extends YH{_preparePendingTasks(f){if(!f._getExecutionVariable(this,"sceneReadyObserver")){const Q=f.configuration.Re.onReadyObservable.add((()=>{this._execute(f)}));f._setExecutionVariable(this,"sceneReadyObserver",Q)}}_cancelPendingTasks(f){const Q=f._getExecutionVariable(this,"sceneReadyObserver");f.configuration.Re.onReadyObservable.remove(Q),f._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return dH.ClassName}}dH.ClassName="FGSceneReadyEventBlock",(0,D.h)("FGSceneReadyEventBlock",dH);class sH extends YH{_preparePendingTasks(f){if(!f._getExecutionVariable(this,"sceneBeforeRender")){const Q=f.configuration.Re.onBeforeRenderObservable.add((()=>{this._execute(f)}));f._setExecutionVariable(this,"sceneBeforeRender",Q)}}_cancelPendingTasks(f){const Q=f._getExecutionVariable(this,"sceneBeforeRender");f.configuration.Re.onBeforeRenderObservable.remove(Q),f._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return sH.ClassName}}sH.ClassName="FGSceneTickEventBlock",(0,D.h)(sH.ClassName,sH);class FH extends zH{constructor(f){super(f),this.out=this._registerSignalOutput("out")}}class PH extends FH{constructor(f){super(f),this.message=this.registerDataInput("message",CQ)}_execute(f){const Q=this.message.getValue(f);Y.b.Log(Q),this.out._activateSignal(f)}getClassName(){return PH.ClassName}}PH.ClassName="FGConsoleLogBlock",(0,D.h)(PH.ClassName,PH),function(f){f[f.INIT=0]="INIT",f[f.STARTED=1]="STARTED",f[f.ENDED=2]="ENDED"}(eH||(eH={}));class mH{constructor(f){this.onEachCountObservable=new N.e,this.onTimerAbortedObservable=new N.e,this.onTimerEndedObservable=new N.e,this.onStateChangedObservable=new N.e,this._observer=null,this._breakOnNextTick=!1,this._tick=f=>{const Q=Date.now();this._timer=Q-this._startTime;const H={startTime:this._startTime,currentTime:Q,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:f},X=this._breakOnNextTick||this._breakCondition(H);X||this._timer>=this._timeToEnd?this._stop(H,X):this.onEachCountObservable.notifyObservers(H)},this._setState(0),this._contextObservable=f.contextObservable,this._observableParameters=f.observableParameters??{},this._breakCondition=f.breakCondition??(()=>!1),this._timeToEnd=f.timeout,f.onEnded&&this.onTimerEndedObservable.add(f.onEnded),f.Ci&&this.onEachCountObservable.add(f.Ci),f.onAborted&&this.onTimerAbortedObservable.add(f.onAborted)}set breakCondition(f){this._breakCondition=f}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=f,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(f){this._state=f,this.onStateChangedObservable.notifyObservers(this._state)}_stop(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),Q?this.onTimerAbortedObservable.notifyObservers(f):this.onTimerEndedObservable.notifyObservers(f)}}class cH extends vH{constructor(f){super(f),this.timeout=this.registerDataInput("timeout",fH)}_preparePendingTasks(f){const Q=this.timeout.getValue(f);if(void 0!==Q&&Q>=0){const H=f._getExecutionVariable(this,"runningTimers")||[],X=f.configuration.Re,i=new mH({timeout:Q,contextObservable:X.onBeforeRenderObservable,onEnded:()=>this._onEnded(i,f)});i.start(),H.push(i),f._setExecutionVariable(this,"runningTimers",H)}}_execute(f){this._startPendingTasks(f),this.out._activateSignal(f)}_onEnded(f,Q){const H=Q._getExecutionVariable(this,"runningTimers")||[],X=H.indexOf(f);-1!==X?H.splice(X,1):x.g.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),Q._removePendingBlock(this),this.done._activateSignal(Q)}_cancelPendingTasks(f){const Q=f._getExecutionVariable(this,"runningTimers")||[];for(const H of Q)H.dispose();f._deleteExecutionVariable(this,"runningTimers")}getClassName(){return cH.ClassName}}cH.ClassName="FGTimerBlock",(0,D.h)("FGTimerBlock",cH);class WH extends FH{constructor(f){super(f),this.config=f;for(let Q=0;Q<this.config.eventData.length;Q++){const f=this.config.eventData[Q];this.registerDataInput(f,CQ)}}_execute(f){const Q=this.config.eventId,H=this.dataInputs.map((Q=>Q.getValue(f)));f.configuration.coordinator.notifyCustomEvent(Q,H),this.out._activateSignal(f)}getClassName(){return WH.ClassName}}WH.ClassName="FGSendCustomEventBlock",(0,D.h)("FGSendCustomEventBlock",WH);class RH extends YH{constructor(f){super(f),this.config=f;for(let Q=0;Q<this.config.eventData.length;Q++){const f=this.config.eventData[Q];this.registerDataOutput(f,CQ)}}_preparePendingTasks(f){const Q=f.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=Q.add((Q=>{for(let H=0;H<Q.length;H++)this.dataOutputs[H].setValue(Q[H],f);this._execute(f)}))}_cancelPendingTasks(f){const Q=f.configuration.coordinator.getCustomEventObservable(this.config.eventId);Q?Q.remove(this._eventObserver):x.g.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return RH.ClassName}serialize(f){super.serialize(f),f.eventId=this.config.eventId,f.eventData=this.config.eventData}}RH.ClassName="FGReceiveCustomEventBlock",(0,D.h)(RH.ClassName,RH);class UH extends zH{constructor(f){super(f),this.config=f,this.outFlows=[];for(let Q=0;Q<this.config.numberOutputFlows;Q++)this.outFlows.push(this._registerSignalOutput(`${Q}`))}_execute(f){for(let Q=0;Q<this.config.numberOutputFlows;Q++)this.outFlows[Q]._activateSignal(f)}getClassName(){return UH.ClassName}}UH.ClassName="FGSequenceBlock",(0,D.h)(UH.ClassName,UH);const EH=new RegExp(/\{(\w+)\}/g);class tH{constructor(f,Q){this.path=f,this.ownerBlock=Q,this.templatedInputs=[];let H=EH.exec(f);for(;H;){const[,X]=H;this.templatedInputs.push(Q.registerDataInput(X,SH)),H=EH.exec(f)}}getAccessor(f,Q){let H=this.path;for(const X of this.templatedInputs){const f=X.getValue(Q).value;H=H.replace(`{${X.name}}`,f.toString())}return f.convert(H)}}class uH extends JH{constructor(f){super(f),this.config=f,this.value=this.registerDataOutput("value",CQ),this.templateComponent=new tH(f.path,this)}_updateOutputs(f){const Q=this.templateComponent.getAccessor(this.config.pathConverter,f),H=Q.info.get(Q.object);this.value.setValue(H,f)}getClassName(){return uH.ClassName}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(f),f.config.path=this.config.path}}uH.ClassName="FGGetPropertyBlock",(0,D.h)(uH.ClassName,uH);class LH extends FH{constructor(f){super(f),this.config=f,this.a=this.registerDataInput("a",CQ),this.templateComponent=new tH(f.path,this)}_execute(f){const Q=this.a.getValue(f),H=this.templateComponent.getAccessor(this.config.pathConverter,f);H.info.set(Q,H.object),this.out._activateSignal(f)}serialize(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(f),f.config.path=this.config.path}getClassName(){return LH.ClassName}}LH.ClassName="FGSetPropertyBlock",(0,D.h)("FGSetPropertyBlock",LH);const AH="cachedOperationValue",aH="cachedExecutionId";class VH extends JH{constructor(f,Q){super(Q),this.value=this.registerDataOutput("value",f)}_updateOutputs(f){const Q=f._getExecutionVariable(this,aH),H=f._getExecutionVariable(this,AH);if(void 0!==H&&Q===f.executionId)this.value.setValue(H,f);else{const Q=this._doOperation(f);f._setExecutionVariable(this,AH,Q),f._setExecutionVariable(this,aH,f.executionId),this.value.setValue(Q,f)}}}class MH extends VH{constructor(f,Q,H,X,i,S){super(H,S),this._operation=X,this._className=i,this.a=this.registerDataInput("a",f),this.b=this.registerDataInput("b",Q)}_doOperation(f){return this._operation(this.a.getValue(f),this.b.getValue(f))}getClassName(){return this._className}}class rH extends VH{constructor(f,Q,H,X){super(f,X),this._operation=Q,this._className=H}_doOperation(f){return this._operation()}getClassName(){return this._className}}class jH extends VH{constructor(f,Q,H,X,i){super(Q,i),this._operation=H,this._className=X,this.a=this.registerDataInput("a",f)}_doOperation(f){return this._operation(this.a.getValue(f))}getClassName(){return this._className}}class TH extends VH{constructor(f,Q,H,X,i,S,x){super(X,x),this._operation=i,this._className=S,this.a=this.registerDataInput("a",f),this.b=this.registerDataInput("b",Q),this.c=this.registerDataInput("c",H)}_doOperation(f){return this._operation(this.a.getValue(f),this.b.getValue(f),this.c.getValue(f))}getClassName(){return this._className}}function kH(f){return f.getClassName?f.getClassName():""}function yH(f,Q){return"Vector2"===f&&"Vector2"===Q||"Wd"===f&&"Wd"===Q||"Vector4"===f&&"Vector4"===Q}function hH(f,Q){return"Matrix"===f&&"Matrix"===Q}function wH(f,Q){return"FlowGraphInteger"===f&&"FlowGraphInteger"===Q}class bH extends MH{constructor(f){super(CQ,CQ,CQ,((f,Q)=>this._polymorphicAdd(f,Q)),bH.ClassName,f)}_polymorphicAdd(f,Q){const H=kH(f),X=kH(Q);return yH(H,X)||hH(H,X)||wH(H,X)?f.add(Q):f+Q}}bH.ClassName="FGAddBlock",(0,D.h)(bH.ClassName,bH);class oH extends MH{constructor(f){super(CQ,CQ,CQ,((f,Q)=>this._polymorphicAdd(f,Q)),oH.ClassName,f)}_polymorphicAdd(f,Q){const H=kH(f),X=kH(Q);return yH(H,X)||wH(H,X)?f.hd(Q):hH(H,X)?f.add(Q.scale(-1)):f-Q}}oH.ClassName="FGSubBlock",(0,D.h)(oH.ClassName,oH);class pH extends MH{constructor(f){super(CQ,CQ,CQ,((f,Q)=>this._polymorphicMultiply(f,Q)),pH.ClassName,f)}_polymorphicMultiply(f,Q){const H=kH(f),X=kH(Q);return yH(H,X)||wH(H,X)?f.multiply(Q):hH(H,X)?i.e.FromValues(f.m[0]*Q.m[0],f.m[4]*Q.m[4],f.m[8]*Q.m[8],f.m[12]*Q.m[12],f.m[1]*Q.m[1],f.m[5]*Q.m[5],f.m[9]*Q.m[9],f.m[13]*Q.m[13],f.m[2]*Q.m[2],f.m[6]*Q.m[6],f.m[10]*Q.m[10],f.m[14]*Q.m[14],f.m[3]*Q.m[3],f.m[7]*Q.m[7],f.m[11]*Q.m[11],f.m[15]*Q.m[15]):f*Q}}pH.ClassName="FGMultiplyBlock",(0,D.h)(pH.ClassName,pH);class CH extends MH{constructor(f){super(CQ,CQ,CQ,((f,Q)=>this._polymorphicDivide(f,Q)),CH.ClassName,f)}_polymorphicDivide(f,Q){const H=kH(f),X=kH(Q);return yH(H,X)||wH(H,X)?f.divide(Q):hH(H,X)?i.e.FromValues(f.m[0]/Q.m[0],f.m[4]/Q.m[4],f.m[8]/Q.m[8],f.m[12]/Q.m[12],f.m[1]/Q.m[1],f.m[5]/Q.m[5],f.m[9]/Q.m[9],f.m[13]/Q.m[13],f.m[2]/Q.m[2],f.m[6]/Q.m[6],f.m[10]/Q.m[10],f.m[14]/Q.m[14],f.m[3]/Q.m[3],f.m[7]/Q.m[7],f.m[11]/Q.m[11],f.m[15]/Q.m[15]):f/Q}}CH.ClassName="FGDivideBlock",(0,D.h)(CH.ClassName,CH);class fX extends rH{constructor(f){super(fH,(()=>Math.random()),fX.ClassName,f)}}fX.ClassName="FGRandomBlock",(0,D.h)(fX.ClassName,fX);class QX extends MH{constructor(f){super(CQ,CQ,fH,((f,Q)=>this._polymorphicDot(f,Q)),QX.ClassName,f)}_polymorphicDot(f,Q){switch(kH(f)){case"Vector2":return i.m.Dot(f,Q);case"Wd":return i.p.Dot(f,Q);case"Vector4":return i.s.Dot(f,Q);default:throw new Error(`Cannot get dot product of ${f} and ${Q}`)}}}QX.ClassName="FGDotBlock",(0,D.h)(QX.ClassName,QX);class HX extends rH{constructor(f){super(fH,(()=>Math.E),HX.ClassName,f)}}HX.ClassName="FGEBlock",(0,D.h)(HX.ClassName,HX);class XX extends rH{constructor(f){super(fH,(()=>Math.PI),XX.ClassName,f)}}XX.ClassName="FGPIBlock",(0,D.h)(XX.ClassName,XX);class iX extends rH{constructor(f){super(fH,(()=>Number.POSITIVE_INFINITY),iX.ClassName,f)}}iX.ClassName="FGInfBlock",(0,D.h)(iX.ClassName,iX);class SX extends rH{constructor(f){super(fH,(()=>Number.NaN),SX.ClassName,f)}}function xX(f,Q){switch(kH(f)){case"FlowGraphInteger":return new oQ(Q(f.value));case"Vector2":return new i.m(Q(f.x),Q(f.y));case"Wd":return new i.p(Q(f.x),Q(f.y),Q(f.z));case"Vector4":return new i.s(Q(f.x),Q(f.y),Q(f.z),Q(f.w));case"Matrix":return i.e.FromValues(Q(f.m[0]),Q(f.m[4]),Q(f.m[8]),Q(f.m[12]),Q(f.m[1]),Q(f.m[5]),Q(f.m[9]),Q(f.m[13]),Q(f.m[2]),Q(f.m[6]),Q(f.m[10]),Q(f.m[14]),Q(f.m[3]),Q(f.m[7]),Q(f.m[11]),Q(f.m[15]));default:return Q(f)}}SX.ClassName="FGNaNBlock",(0,D.h)(SX.ClassName,SX);class KX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicAbs(f)),KX.ClassName,f)}_polymorphicAbs(f){return xX(f,Math.abs)}}KX.ClassName="FGAbsBlock",(0,D.h)(KX.ClassName,KX);class ZX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicSign(f)),ZX.ClassName,f)}_polymorphicSign(f){return xX(f,Math.sign)}}ZX.ClassName="FGSignBlock",(0,D.h)(ZX.ClassName,ZX);class BX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicTrunc(f)),BX.ClassName,f)}_polymorphicTrunc(f){return xX(f,Math.trunc)}}BX.ClassName="FGTruncBlock",(0,D.h)(BX.ClassName,BX);class NX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicFloor(f)),NX.ClassName,f)}_polymorphicFloor(f){return xX(f,Math.floor)}}NX.ClassName="FGFloorBlock",(0,D.h)(NX.ClassName,NX);class JX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicCeiling(f)),JX.ClassName,f)}_polymorphicCeiling(f){return xX(f,Math.ceil)}}JX.ClassName="FGCeilBlock",(0,D.h)(JX.ClassName,JX);class gX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicFract(f)),gX.ClassName,f)}_polymorphicFract(f){return xX(f,(f=>f-Math.floor(f)))}}gX.ClassName="FGFractBlock",(0,D.h)(gX.ClassName,gX);class zX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicNeg(f)),zX.ClassName,f)}_polymorphicNeg(f){return xX(f,(f=>-f))}}function vX(f,Q,H){switch(kH(f)){case"FlowGraphInteger":return new oQ(H(f.value,Q.value));case"Vector2":return new i.m(H(f.x,Q.x),H(f.y,Q.y));case"Wd":return new i.p(H(f.x,Q.x),H(f.y,Q.y),H(f.z,Q.z));case"Vector4":return new i.s(H(f.x,Q.x),H(f.y,Q.y),H(f.z,Q.z),H(f.w,Q.w));case"Matrix":return i.e.FromValues(H(f.m[0],Q.m[0]),H(f.m[4],Q.m[4]),H(f.m[8],Q.m[8]),H(f.m[12],Q.m[12]),H(f.m[1],Q.m[1]),H(f.m[5],Q.m[5]),H(f.m[9],Q.m[9]),H(f.m[13],Q.m[13]),H(f.m[2],Q.m[2]),H(f.m[6],Q.m[6]),H(f.m[10],Q.m[10]),H(f.m[14],Q.m[14]),H(f.m[3],Q.m[3]),H(f.m[7],Q.m[7]),H(f.m[11],Q.m[11]),H(f.m[15],Q.m[15]));default:return H(f,Q)}}zX.ClassName="FGNegBlock",(0,D.h)(zX.ClassName,zX);class YX extends MH{constructor(f){super(CQ,CQ,CQ,((f,Q)=>this._polymorphicRemainder(f,Q)),YX.ClassName,f)}_polymorphicRemainder(f,Q){return vX(f,Q,((f,Q)=>f%Q))}}YX.ClassName="FGRemainderBlock",(0,D.h)(YX.ClassName,YX);class OX extends MH{constructor(f){super(CQ,CQ,CQ,((f,Q)=>this._polymorphicMin(f,Q)),OX.ClassName,f)}_polymorphicMin(f,Q){return vX(f,Q,Math.min)}}OX.ClassName="FGMinBlock",(0,D.h)(OX.ClassName,OX);class nX extends MH{constructor(f){super(CQ,CQ,CQ,((f,Q)=>this._polymorphicMax(f,Q)),nX.ClassName,f)}_polymorphicMax(f,Q){return vX(f,Q,Math.max)}}function eX(f,Q,H){return Math.min(Math.max(f,Math.min(Q,H)),Math.max(Q,H))}function GX(f,Q,H,X){switch(kH(f)){case"FlowGraphInteger":return new oQ(X(f.value,Q.value,H.value));case"Vector2":return new i.m(X(f.x,Q.x,H.x),X(f.y,Q.y,H.y));case"Wd":return new i.p(X(f.x,Q.x,H.x),X(f.y,Q.y,H.y),X(f.z,Q.z,H.z));case"Vector4":return new i.s(X(f.x,Q.x,H.x),X(f.y,Q.y,H.y),X(f.z,Q.z,H.z),X(f.w,Q.w,H.w));case"Matrix":return i.e.FromValues(X(f.m[0],Q.m[0],H.m[0]),X(f.m[4],Q.m[4],H.m[4]),X(f.m[8],Q.m[8],H.m[8]),X(f.m[12],Q.m[12],H.m[12]),X(f.m[1],Q.m[1],H.m[1]),X(f.m[5],Q.m[5],H.m[5]),X(f.m[9],Q.m[9],H.m[9]),X(f.m[13],Q.m[13],H.m[13]),X(f.m[2],Q.m[2],H.m[2]),X(f.m[6],Q.m[6],H.m[6]),X(f.m[10],Q.m[10],H.m[10]),X(f.m[14],Q.m[14],H.m[14]),X(f.m[3],Q.m[3],H.m[3]),X(f.m[7],Q.m[7],H.m[7]),X(f.m[11],Q.m[11],H.m[11]),X(f.m[15],Q.m[15],H.m[15]));default:return X(f,Q,H)}}nX.ClassName="FGMaxBlock",(0,D.h)(nX.ClassName,nX);class IX extends TH{constructor(f){super(CQ,CQ,CQ,CQ,((f,Q,H)=>this._polymorphicClamp(f,Q,H)),IX.ClassName,f)}_polymorphicClamp(f,Q,H){return GX(f,Q,H,eX)}}function lX(f){return Math.min(Math.max(f,0),1)}IX.ClassName="FGClampBlock",(0,D.h)(IX.ClassName,IX);class qX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicSaturate(f)),qX.ClassName,f)}_polymorphicSaturate(f){return xX(f,lX)}}qX.ClassName="FGSaturateBlock",(0,D.h)(qX.ClassName,qX);class DX extends TH{constructor(f){super(CQ,CQ,CQ,CQ,((f,Q,H)=>this._polymorphicInterpolate(f,Q,H)),DX.ClassName,f)}_interpolate(f,Q,H){return(1-H)*f+H*Q}_polymorphicInterpolate(f,Q,H){return GX(f,Q,H,this._interpolate)}}DX.ClassName="FGInterpolateBlock",(0,D.h)(DX.ClassName,DX);class dX extends MH{constructor(f){super(CQ,CQ,QH,((f,Q)=>this._polymorphicEq(f,Q)),dX.ClassName,f)}_polymorphicEq(f,Q){const H=kH(f),X=kH(Q);return yH(H,X)||hH(H,X)||wH(H,X)?f.equals(Q):f===Q}}function sX(f,Q,H){const X=kH(f);if(X===kH(Q)){if(""===X)return H(f,Q);if("FlowGraphInteger"===X)return H(f.value,Q.value);throw new Error(`Cannot compare ${f} and ${Q}`)}throw new Error(`${f} and ${Q} are of different types.`)}dX.ClassName="FGEqBlock",(0,D.h)(dX.ClassName,dX);class FX extends MH{constructor(f){super(CQ,CQ,QH,((f,Q)=>this._polymorphicLessThan(f,Q)),FX.ClassName,f)}_polymorphicLessThan(f,Q){return sX(f,Q,((f,Q)=>f<Q))}}FX.ClassName="FGLessThanBlock",(0,D.h)(FX.ClassName,FX);class PX extends MH{constructor(f){super(CQ,CQ,QH,((f,Q)=>this._polymorphicLessThanOrEqual(f,Q)),PX.ClassName,f)}_polymorphicLessThanOrEqual(f,Q){return sX(f,Q,((f,Q)=>f<=Q))}}PX.ClassName="FGLessThanOrEqualBlock";class mX extends MH{constructor(f){super(CQ,CQ,QH,((f,Q)=>this._polymorphicGreaterThan(f,Q)),mX.ClassName,f)}_polymorphicGreaterThan(f,Q){return sX(f,Q,((f,Q)=>f>Q))}}mX.ClassName="FGGreaterThanBlock",(0,D.h)(mX.ClassName,mX);class cX extends MH{constructor(f){super(CQ,CQ,QH,((f,Q)=>this._polymorphicGreaterThanOrEqual(f,Q)),cX.ClassName,f)}_polymorphicGreaterThanOrEqual(f,Q){return sX(f,Q,((f,Q)=>f>=Q))}}cX.ClassName="FGGreaterThanOrEqualBlock",(0,D.h)(cX.ClassName,cX);class WX extends jH{constructor(f){super(CQ,QH,(f=>this._polymorphicIsNan(f)),WX.ClassName,f)}_polymorphicIsNan(f){const Q=kH(f);if(""===Q)return isNaN(f);if("FlowGraphInteger"===Q)return isNaN(f.value);throw new Error(`Cannot get NaN of ${f}`)}}WX.ClassName="FGIsNanBlock",(0,D.h)(WX.ClassName,WX);class RX extends jH{constructor(f){super(CQ,QH,(f=>this._polymorphicIsInf(f)),RX.ClassName,f)}_polymorphicIsInf(f){const Q=kH(f);if(""===Q)return!isFinite(f);if("FlowGraphInteger"===Q)return!isFinite(f.value);throw new Error(`Cannot get isInf of ${f}`)}}RX.ClassName="FGIsInfBlock";class UX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicDegToRad(f)),UX.ClassName,f)}_degToRad(f){return f*Math.PI/180}_polymorphicDegToRad(f){return xX(f,this._degToRad)}}UX.ClassName="FGDegToRadBlock",(0,D.h)(UX.ClassName,UX);class EX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicRadToDeg(f)),EX.ClassName,f)}_radToDeg(f){return 180*f/Math.PI}_polymorphicRadToDeg(f){return xX(f,this._radToDeg)}}EX.ClassName="FGRadToDegBlock",(0,D.h)(EX.ClassName,EX);class tX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicSin(f)),tX.ClassName,f)}_polymorphicSin(f){return xX(f,Math.sin)}}tX.ClassName="FGSinBlock",(0,D.h)(tX.ClassName,tX);class uX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicCos(f)),uX.ClassName,f)}_polymorphicCos(f){return xX(f,Math.cos)}}uX.ClassName="FGCosBlock",(0,D.h)(uX.ClassName,uX);class LX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicTan(f)),LX.ClassName,f)}_polymorphicTan(f){return xX(f,Math.tan)}}LX.ClassName="FGTanBlock",(0,D.h)(LX.ClassName,LX);class AX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicAsin(f)),AX.ClassName,f)}_polymorphicAsin(f){return xX(f,Math.asin)}}AX.ClassName="FGAsinBlock",(0,D.h)(AX.ClassName,AX);class aX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicAcos(f)),aX.ClassName,f)}_polymorphicAcos(f){return xX(f,Math.acos)}}aX.ClassName="FGAcosBlock",(0,D.h)(aX.ClassName,aX);class VX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicAtan(f)),VX.ClassName,f)}_polymorphicAtan(f){return xX(f,Math.atan)}}VX.ClassName="FGAtanBlock",(0,D.h)(VX.ClassName,VX);class MX extends MH{constructor(f){super(CQ,CQ,CQ,((f,Q)=>this._polymorphicAtan2(f,Q)),MX.ClassName,f)}_polymorphicAtan2(f,Q){return vX(f,Q,Math.atan2)}}MX.ClassName="FGAtan2Block",(0,D.h)(MX.ClassName,MX);class rX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicSinh(f)),rX.ClassName,f)}_polymorphicSinh(f){return xX(f,Math.sinh)}}rX.ClassName="FGSinhBlock",(0,D.h)(rX.ClassName,rX);class jX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicCosh(f)),jX.ClassName,f)}_polymorphicCosh(f){return xX(f,Math.cosh)}}jX.ClassName="FGCoshBlock",(0,D.h)(jX.ClassName,jX);class TX extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicTanh(f)),TX.ClassName,f)}_polymorphicTanh(f){return xX(f,Math.tanh)}}TX.ClassName="FGTanhBlock",(0,D.h)(TX.ClassName,TX);class kX extends jH{constructor(f){super(CQ,fH,(f=>this._polymorphicAsinh(f)),kX.ClassName,f)}_polymorphicAsinh(f){return xX(f,Math.asinh)}}kX.ClassName="FGAsinhBlock",(0,D.h)(kX.ClassName,kX);class yX extends jH{constructor(f){super(CQ,fH,(f=>this._polymorphicAcosh(f)),yX.ClassName,f)}_polymorphicAcosh(f){return xX(f,Math.acosh)}}yX.ClassName="FGAcoshBlock",(0,D.h)(yX.ClassName,yX);class hX extends jH{constructor(f){super(CQ,fH,(f=>this._polymorphicAtanh(f)),hX.ClassName,f)}_polymorphicAtanh(f){return xX(f,Math.atanh)}}hX.ClassName="FGAtanhBlock",(0,D.h)(hX.ClassName,hX);class wX extends jH{constructor(f){super(CQ,fH,(f=>this._polymorphicExp(f)),wX.ClassName,f)}_polymorphicExp(f){return xX(f,Math.exp)}}wX.ClassName="FGExpBlock",(0,D.h)(wX.ClassName,wX);class bX extends jH{constructor(f){super(CQ,fH,(f=>this._polymorphicLog(f)),bX.ClassName,f)}_polymorphicLog(f){return xX(f,Math.log)}}bX.ClassName="FGLogBlock",(0,D.h)(bX.ClassName,bX);class oX extends jH{constructor(f){super(CQ,fH,(f=>this._polymorphicLog2(f)),oX.ClassName,f)}_polymorphicLog2(f){return xX(f,Math.log2)}}oX.ClassName="FGLog2Block",(0,D.h)(oX.ClassName,oX);class pX extends jH{constructor(f){super(CQ,fH,(f=>this._polymorphicLog10(f)),pX.ClassName,f)}_polymorphicLog10(f){return xX(f,Math.log10)}}pX.ClassName="FGLog10Block",(0,D.h)(pX.ClassName,pX);class CX extends jH{constructor(f){super(CQ,fH,(f=>this._polymorphicSqrt(f)),CX.ClassName,f)}_polymorphicSqrt(f){return xX(f,Math.sqrt)}}CX.ClassName="FGSqrtBlock",(0,D.h)(CX.ClassName,CX);class fi extends jH{constructor(f){super(CQ,fH,(f=>this._polymorphicCubeRoot(f)),fi.ClassName,f)}_polymorphicCubeRoot(f){return xX(f,Math.cbrt)}}fi.ClassName="FGCubeRootBlock",(0,D.h)(fi.ClassName,fi);class Qi extends MH{constructor(f){super(CQ,fH,fH,((f,Q)=>this._polymorphicPow(f,Q)),Qi.ClassName,f)}_polymorphicPow(f,Q){return vX(f,Q,Math.pow)}}Qi.ClassName="FGPowBlock",(0,D.h)(Qi.ClassName,Qi);class Hi extends jH{constructor(f){super(CQ,fH,(f=>this._polymorphicLength(f)),Hi.ClassName,f)}_polymorphicLength(f){switch(kH(f)){case"Vector2":case"Wd":case"Vector4":return f.length();default:throw new Error(`Cannot compute length of value ${f}`)}}}Hi.ClassName="FGLengthBlock",(0,D.h)(Hi.ClassName,Hi);class Xi extends jH{constructor(f){super(CQ,CQ,(f=>this._polymorphicNormalize(f)),Xi.ClassName,f)}_polymorphicNormalize(f){switch(kH(f)){case"Vector2":case"Wd":case"Vector4":return f.normalize();default:throw new Error(`Cannot normalize value ${f}`)}}}Xi.ClassName="FGNormalizeBlock",(0,D.h)(Xi.ClassName,Xi);class ii extends MH{constructor(f){super(XH,XH,XH,((f,Q)=>i.p.Cross(f,Q)),ii.ClassName,f)}}ii.ClassName="FGCrossBlock",(0,D.h)(ii.ClassName,ii);class Si extends MH{constructor(f){super(HH,fH,HH,((f,Q)=>i.m.Transform(f,i.e.RotationZ(Q))),Si.ClassName,f)}}Si.ClassName="FGRotate2DBlock",(0,D.h)(Si.ClassName,Si);class xi extends TH{constructor(f){super(XH,XH,fH,XH,((f,Q,H)=>i.p.TransformCoordinates(f,i.e.RotationAxis(Q,H))),xi.ClassName,f)}}xi.ClassName="FGRotate3DBlock",(0,D.h)(xi.ClassName,xi);class Ki extends jH{constructor(f){super(iH,iH,(f=>i.e.Transpose(f)),Ki.ClassName,f)}}Ki.ClassName="FGTransposeBlock",(0,D.h)(Ki.ClassName,Ki);class Zi extends jH{constructor(f){super(iH,fH,(f=>f.determinant()),Zi.ClassName,f)}}Zi.ClassName="FGDeterminantBlock",(0,D.h)(Zi.ClassName,Zi);class Bi extends jH{constructor(f){super(iH,iH,(f=>i.e.Invert(f)),Bi.ClassName,f)}}Bi.ClassName="FGInvertMatrixBlock",(0,D.h)(Bi.ClassName,Bi);class Ni extends MH{constructor(f){super(iH,iH,iH,((f,Q)=>Q.multiply(f)),Ni.ClassName,f)}}Ni.ClassName="FGMatMulBlock",(0,D.h)(Ni.ClassName,Ni);class Ji extends jH{constructor(f){super(SH,SH,(f=>new oQ(~f.value)),Ji.ClassName,f)}}Ji.ClassName="FGBitwiseNotBlock",(0,D.h)(Ji.ClassName,Ji);class gi extends MH{constructor(f){super(SH,SH,SH,((f,Q)=>new oQ(f.value&Q.value)),gi.ClassName,f)}}gi.ClassName="FGBitwiseAndBlock",(0,D.h)(gi.ClassName,gi);class zi extends MH{constructor(f){super(SH,SH,SH,((f,Q)=>new oQ(f.value|Q.value)),zi.ClassName,f)}}zi.ClassName="FGBitwiseOrBlock",(0,D.h)(zi.ClassName,zi);class vi extends MH{constructor(f){super(SH,SH,SH,((f,Q)=>new oQ(f.value^Q.value)),vi.ClassName,f)}}vi.ClassName="FGBitwiseXorBlock",(0,D.h)(vi.ClassName,vi);class Yi extends MH{constructor(f){super(SH,SH,SH,((f,Q)=>new oQ(f.value<<Q.value)),Yi.ClassName,f)}}Yi.ClassName="FGBitwiseLeftShiftBlock",(0,D.h)(Yi.ClassName,Yi);class Oi extends MH{constructor(f){super(SH,SH,SH,((f,Q)=>new oQ(f.value>>Q.value)),Oi.ClassName,f)}}Oi.ClassName="FGBitwiseRightShiftBlock",(0,D.h)(Oi.ClassName,Oi);class ni extends jH{constructor(f){super(SH,SH,(f=>new oQ(Math.clz32(f.value))),ni.ClassName,f)}}ni.ClassName="FGCountLeadingZerosBlock",(0,D.h)(ni.ClassName,ni);class ei extends jH{constructor(f){super(SH,SH,(f=>new oQ(f.value?31-Math.clz32(f.value&-f.value):32)),ei.ClassName,f)}}ei.ClassName="FGCountTrailingZerosBlock",(0,D.h)(ei.ClassName,ei);class Gi extends jH{constructor(f){super(SH,SH,(f=>new oQ(function(f){let Q=0;for(;f;)Q+=1&f,f>>=1;return Q}(f.value))),Gi.ClassName,f)}}Gi.ClassName="FGCountOneBitsBlock",(0,D.h)(Gi.ClassName,Gi);class Ii extends FH{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new oQ(0)};super(f),this.config=f,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",SH),this.value=this.registerDataOutput("value",SH)}_execute(f,Q){if(Q===this.reset)this.value.setValue(this.config.startIndex,f);else{const Q=this.value.getValue(f);Q.value<this.n.getValue(f).value&&(this.value.setValue(new oQ(Q.value+1),f),this.out._activateSignal(f))}}getClassName(){return Ii.ClassName}}Ii.ClassName="FGDoNBlock",(0,D.h)(Ii.ClassName,Ii);class li extends JH{constructor(f){super(f),this.config=f,this.output=this.registerDataOutput(f.variableName,CQ)}_updateOutputs(f){const Q=this.config.variableName;f.hasVariable(Q)&&this.output.setValue(f.getVariable(Q),f)}getClassName(){return li.ClassName}serialize(f){super.serialize(f),f.config.variableName=this.config.variableName}}li.ClassName="FGGetVariableBlock",(0,D.h)(li.ClassName,li);class qi extends FH{constructor(f){super(f),this.config=f,this.input=this.registerDataInput(f.variableName,CQ)}_execute(f){const Q=this.config.variableName,H=this.input.getValue(f);f.setVariable(Q,H),this.out._activateSignal(f)}getClassName(){return qi.ClassName}}qi.ClassName="FGSetVariableBlock",(0,D.h)(qi.ClassName,qi);class Di extends FH{constructor(f){super(f),this.config=f,this.condition=this.registerDataInput("condition",QH),this.loopBody=this._registerSignalOutput("loopBody")}_execute(f,Q){var H;let X=this.condition.getValue(f);for(null!==(H=this.config)&&void 0!==H&&H.isDo&&!X&&this.loopBody._activateSignal(f);X;)this.loopBody._activateSignal(f),X=this.condition.getValue(f);this.out._activateSignal(f)}getClassName(){return Di.ClassName}serialize(f){var Q;super.serialize(f),f.isDo=null===(Q=this.config)||void 0===Q?void 0:Q.isDo}}Di.ClassName="FGWhileLoopBlock",(0,D.h)(Di.ClassName,Di);const di={"lifecycle/onStart":dH.ClassName,"lifecycle/onTick":sH.ClassName,log:PH.ClassName,"flow/delay":cH.ClassName,"customEvent/send":WH.ClassName,"customEvent/receive":RH.ClassName,"flow/sequence":UH.ClassName,"world/get":uH.ClassName,"world/set":LH.ClassName,"flow/doN":Ii.ClassName,"variable/get":li.ClassName,"variable/set":qi.ClassName,"flow/whileLoop":Di.ClassName,"math/random":fX.ClassName,"math/e":HX.ClassName,"math/pi":XX.ClassName,"math/inf":iX.ClassName,"math/nan":SX.ClassName,"math/abs":KX.ClassName,"math/sign":ZX.ClassName,"math/trunc":BX.ClassName,"math/floor":NX.ClassName,"math/ceil":JX.ClassName,"math/fract":gX.ClassName,"math/neg":zX.ClassName,"math/add":bH.ClassName,"math/sub":oH.ClassName,"math/mul":pH.ClassName,"math/div":CH.ClassName,"math/rem":YX.ClassName,"math/min":OX.ClassName,"math/max":nX.ClassName,"math/clamp":IX.ClassName,"math/saturate":qX.ClassName,"math/mix":DX.ClassName,"math/eq":dX.ClassName,"math/lt":FX.ClassName,"math/le":PX.ClassName,"math/gt":mX.ClassName,"math/ge":cX.ClassName,"math/isnan":WX.ClassName,"math/isinf":RX.ClassName,"math/rad":UX.ClassName,"math/deg":EX.ClassName,"math/sin":tX.ClassName,"math/cos":uX.ClassName,"math/tan":LX.ClassName,"math/asin":AX.ClassName,"math/acos":aX.ClassName,"math/atan":VX.ClassName,"math/atan2":MX.ClassName,"math/sinh":rX.ClassName,"math/cosh":jX.ClassName,"math/tanh":TX.ClassName,"math/asinh":kX.ClassName,"math/acosh":yX.ClassName,"math/atanh":hX.ClassName,"math/exp":wX.ClassName,"math/log":bX.ClassName,"math/log2":oX.ClassName,"math/log10":pX.ClassName,"math/sqrt":CX.ClassName,"math/cbrt":fi.ClassName,"math/pow":Qi.ClassName,"math/length":Hi.ClassName,"math/normalize":Xi.ClassName,"math/dot":QX.ClassName,"math/cross":ii.ClassName,"math/rotate2d":Si.ClassName,"math/rotate3d":xi.ClassName,"math/transpose":Ki.ClassName,"math/determinant":Zi.ClassName,"math/inverse":Bi.ClassName,"math/matmul":Ni.ClassName,"math/not":Ji.ClassName,"math/and":gi.ClassName,"math/or":zi.ClassName,"math/xor":vi.ClassName,"math/asr":Oi.ClassName,"math/lsl":Yi.ClassName,"math/clz":ni.ClassName,"math/ctz":ei.ClassName,"math/popcnt":Gi.ClassName},si={float2:"Vector2",float3:"Wd",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function Fi(f,Q,H){if(void 0!==f.type){const X=Q.types&&Q.types[f.type];if(!X)throw new Error(`${H}: Unknown type: ${f.type}`);const i=X.signature;if(!i)throw new Error(`${H}: Type ${f.type} has no signature`);const S=si[i];return{value:f.value,className:S}}return f.value}function Pi(f,Q,H){const X=di[Q.type];if(!X)throw new Error(`/extensions/KHR_interactivity/nodes/${f}: Unknown block type: ${Q.type}`);const i=f.toString(),S=function(f,Q,H){const X={},i=f.configuration??[];for(const S of i)if("customEvent"===S.id){const f=Q.customEvents&&Q.customEvents[S.value];if(!f)throw new Error(`/extensions/KHR_interactivity/nodes/${H}: Unknown custom event: ${S.value}`);X.eventId=f.id,X.eventData=f.values.map((f=>f.id))}else if("variable"===S.id){const f=Q.variables&&Q.variables[S.value];if(!f)throw new Error(`/extensions/KHR_interactivity/nodes/${H}: Unknown variable: ${S.value}`);X.variableName=f.id}else if("path"===S.id){const f=S.value;X.path=f}else X[S.id]=Fi(S,Q,`/extensions/KHR_interactivity/nodes/${H}`);return X}(Q,H,i);return{className:X,config:S,uniqueId:i,metadata:Q.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class mi extends dQ{constructor(f){super(f,Wi)}}const ci={__array__:{__target__:!0,translation:{type:"Wd",get:f=>f._babylonTransformNode.position,set:(f,Q)=>{Q._babylonTransformNode.position=f},getObject:f=>f._babylonTransformNode}}},Wi={nodes:ci},Ri="KHR_interactivity";class Ui{constructor(f){this._loader=f,this.name=Ri,this.enabled=this._loader.isExtensionUsed(Ri),this._pathConverter=new mi(this._loader.ij)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var f;if(!this._loader.babylonScene||!this._pathConverter)return;const Q=this._loader.babylonScene,H=function(f){const Q={uniqueId:(0,wQ.c)(),_userVariables:{},_connectionValues:{}},H=[Q],X=[];for(let S=0;S<f.nodes.length;S++){const Q=Pi(S,f.nodes[S],f);X.push(Q)}for(let S=0;S<f.nodes.length;S++){const H=f.nodes[S],i=X[S],x=H.flows??[];for(const f of x){const Q=f.id,H={uniqueId:(0,wQ.c)(),name:Q,_connectionType:1,connectedPointIds:[]};i.signalOutputs.push(H);const x=f.node,K=f.socket,Z=X[x];if(!Z)throw new Error(`/extensions/KHR_interactivity/nodes/${S}: Could not find node with id ${x} that connects its input with with node ${S}'s output ${Q}`);let B=Z.signalInputs.find((f=>f.name===K));B||(B={uniqueId:(0,wQ.c)(),name:K,_connectionType:0,connectedPointIds:[]},Z.signalInputs.push(B)),B.connectedPointIds.push(H.uniqueId),H.connectedPointIds.push(B.uniqueId)}const K=H.values??[];for(const Z of K){const H=Z.id,x={uniqueId:(0,wQ.c)(),name:H,_connectionType:0,connectedPointIds:[]};if(i.dataInputs.push(x),void 0!==Z.value){const H=Fi(Z,f,`/extensions/KHR_interactivity/nodes/${S}`);Q._connectionValues[x.uniqueId]=H}else{if(void 0===Z.node||void 0===Z.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${S}: Invalid socket ${H} in node ${S}`);{const f=Z.node,Q=Z.socket,i=X[f];if(!i)throw new Error(`/extensions/KHR_interactivity/nodes/${S}: Could not find node with id ${f} that connects its output with node${S}'s input ${H}`);let K=i.dataOutputs.find((f=>f.name===Q));K||(K={uniqueId:(0,wQ.c)(),name:Q,_connectionType:1,connectedPointIds:[]},i.dataOutputs.push(K)),x.connectedPointIds.push(K.uniqueId),K.connectedPointIds.push(x.uniqueId)}}}}const i=f.variables??[];for(let S=0;S<i.length;S++){const H=i[S],X=H.id;Q._userVariables[X]=Fi(H,f,`/extensions/KHR_interactivity/variables/${S}`)}return{allBlocks:X,executionContexts:H}}(null===(f=this._loader.ij.extensions)||void 0===f?void 0:f.KHR_interactivity),X=new DH({Re:Q});qH.Parse(H,{coordinator:X,pathConverter:this._pathConverter}),X.start()}}h(Ri),y(Ri,!0,(f=>new Ui(f)));const Ei="KHR_node_visibility";class ti{constructor(f){this.name=Ei,this._loader=f,this.enabled=f.isExtensionUsed(Ei)}async onReady(){var f;null===(f=this._loader.ij.nodes)||void 0===f||f.forEach((f=>{var Q,H,X,i;(null===(Q=f._primitiveBabylonMeshes)||void 0===Q||Q.forEach((f=>{f.inheritVisibility=!0})),null!==(H=f.extensions)&&void 0!==H&&H.KHR_node_visibility)&&(!1===(null===(X=f.extensions)||void 0===X?void 0:X.KHR_node_visibility.visible)&&(f._babylonTransformNode&&(f._babylonTransformNode.isVisible=!1),null===(i=f._primitiveBabylonMeshes)||void 0===i||i.forEach((f=>{f.isVisible=!1}))))}))}dispose(){this._loader=null}}h(Ei),y(Ei,!0,(f=>new ti(f)));const ui="ExtrasAsMetadata";class Li{_assignExtras(f,Q){if(Q.extras&&Object.keys(Q.extras).length>0){const H=f.metadata=f.metadata||{};(H.ij=H.ij||{}).extras=Q.extras}}constructor(f){this.name=ui,this.enabled=!0,this._loader=f}dispose(){this._loader=null}loadNodeAsync(f,Q,H){return this._loader.loadNodeAsync(f,Q,(f=>{this._assignExtras(f,Q),H(f)}))}loadCameraAsync(f,Q,H){return this._loader.loadCameraAsync(f,Q,(f=>{this._assignExtras(f,Q),H(f)}))}createMaterial(f,Q,H){const X=this._loader.createMaterial(f,Q,H);return this._assignExtras(X,Q),X}}h(ui),y(ui,!1,(f=>new Li(f)))},11924:(f,Q,H)=>{"use strict";H.d(Q,{d:()=>W,e:()=>d,g:()=>D,k:()=>s});var X=H(994),i=H(1203),S=H(11399),x=H(11301),K=H(11345),Z=H(11337),B=H(1092),N=H(1027),J=H(11929),g=H(11932),z=H(11311);class v{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.pe=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.af=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(f){this._environmentTexture=f}getNodes(){let f=[];return f=f.concat(this.meshes),f=f.concat(this.lights),f=f.concat(this.cameras),f=f.concat(this.transformNodes),this.skeletons.forEach((Q=>f=f.concat(Q.bones))),f}}class Y extends v{}class O{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((f=>{f.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((f=>{f.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((f=>{f.dispose()})),this.animationGroups.length=0}}class n extends v{constructor(f){super(),this._wasAddedToScene=!1,(f=f||N.e.LastCreatedScene)&&(this.Re=f,this.proceduralTextures=[],f.fe.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=f.getEngine().onContextRestoredObservable.add((()=>{for(const f of this.geometries)f._rebuild();for(const f of this.meshes)f._rebuild();for(const f of this.pe)f.rebuild();for(const f of this.textures)f._rebuild()})))}_topologicalSort(f){const Q=new Map;for(const x of f)Q.set(x.uniqueId,x);const H={dependsOn:new Map,dependedBy:new Map};for(const x of f){const f=x.uniqueId;H.dependsOn.set(f,new Set),H.dependedBy.set(f,new Set)}for(const x of f){const f=x.uniqueId,X=H.dependsOn.get(f);if(x instanceof J.e){const i=x.sourceMesh;Q.has(i.uniqueId)&&(X.add(i.uniqueId),H.dependedBy.get(i.uniqueId).add(f))}const i=H.dependedBy.get(f);for(const S of x.getDescendants()){const X=S.uniqueId;if(Q.has(X)){i.add(X);H.dependsOn.get(X).add(f)}}}const X=[],i=[];for(const x of f){const f=x.uniqueId;0===H.dependsOn.get(f).size&&(i.push(x),Q.delete(f))}const S=i;for(;S.length>0;){const f=S.shift();X.push(f);const i=H.dependedBy.get(f.uniqueId);for(const X of Array.from(i.values())){const i=H.dependsOn.get(X);i.delete(f.uniqueId),0===i.size&&Q.get(X)&&(S.push(Q.get(X)),Q.delete(X))}}return Q.size>0&&(B.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),Q.forEach((f=>B.b.Error(f.name)))),X}_addNodeAndDescendantsToList(f,Q,H,X){if(H&&(!X||X(H))&&!Q.has(H.uniqueId)){f.push(H),Q.add(H.uniqueId);for(const i of H.getDescendants(!0))this._addNodeAndDescendantsToList(f,Q,i,X)}}_isNodeInContainer(f){return f instanceof Z.c&&-1!==this.meshes.indexOf(f)||(f instanceof K.d&&-1!==this.transformNodes.indexOf(f)||(f instanceof g.b&&-1!==this.lights.indexOf(f)||f instanceof z.c&&-1!==this.cameras.indexOf(f)))}_isValidHierarchy(){for(const f of this.meshes)if(f.parent&&!this._isNodeInContainer(f.parent))return B.b.Warn(`Node ${f.name} has a parent that is not in the container.`),!1;for(const f of this.transformNodes)if(f.parent&&!this._isNodeInContainer(f.parent))return B.b.Warn(`Node ${f.name} has a parent that is not in the container.`),!1;for(const f of this.lights)if(f.parent&&!this._isNodeInContainer(f.parent))return B.b.Warn(`Node ${f.name} has a parent that is not in the container.`),!1;for(const f of this.cameras)if(f.parent&&!this._isNodeInContainer(f.parent))return B.b.Warn(`Node ${f.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(f){let Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||i.g.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const X={},S={},K=new O,Z=[],B=[],N={doNotInstantiate:!0,...H},J=[],g=new Set;for(const i of this.transformNodes)null===i.parent&&this._addNodeAndDescendantsToList(J,g,i,N.predicate);for(const i of this.meshes)null===i.parent&&this._addNodeAndDescendantsToList(J,g,i,N.predicate);const z=this._topologicalSort(J),v=(H,i)=>{if(((Q,H)=>{if(X[Q.uniqueId]=H.uniqueId,S[H.uniqueId]=H,f&&(H.name=f(Q.name)),H instanceof x.b){const f=H;if(f.morphTargetManager){const H=Q.morphTargetManager;f.morphTargetManager=H.clone();for(let Q=0;Q<H.numTargets;Q++){const i=H.getTarget(Q),x=f.morphTargetManager.getTarget(Q);X[i.uniqueId]=x.uniqueId,S[x.uniqueId]=x}}}})(H,i),H.parent){const f=X[H.parent.uniqueId],Q=S[f];i.parent=Q||H.parent}if(i.position&&H.position&&i.position.p(H.position),i.rotationQuaternion&&H.rotationQuaternion&&i.rotationQuaternion.p(H.rotationQuaternion),i.rotation&&H.rotation&&i.rotation.p(H.rotation),i.He&&H.He&&i.He.p(H.He),i.material){const x=i;if(x.material)if(Q){const Q=H.material;if(-1===B.indexOf(Q)){let H=Q.clone(f?f(Q.name):"Clone of "+Q.name);if(B.push(Q),X[Q.uniqueId]=H.uniqueId,S[H.uniqueId]=H,"MultiMaterial"===Q.getClassName()){const i=Q;for(const Q of i.Cg)Q&&(H=Q.clone(f?f(Q.name):"Clone of "+Q.name),B.push(Q),X[Q.uniqueId]=H.uniqueId,S[H.uniqueId]=H);i.Cg=i.Cg.map((f=>f&&S[X[f.uniqueId]]))}}"InstancedMesh"!==x.getClassName()&&(x.material=S[X[Q.uniqueId]])}else"MultiMaterial"===x.material.getClassName()?-1===this.Re.multiMaterials.indexOf(x.material)&&this.Re.addMultiMaterial(x.material):-1===this.Re.materials.indexOf(x.material)&&this.Re.addMaterial(x.material)}null===i.parent&&K.rootNodes.push(i)};return z.forEach((f=>{if("InstancedMesh"===f.getClassName()){const Q=f,H=Q.sourceMesh,i=X[H.uniqueId],x=("number"===typeof i?S[i]:H).yd(Q.name);v(Q,x)}else{let Q=!0;"pb"===f.getClassName()||"Node"===f.getClassName()||f.skeleton||!f.getTotalVertices||0===f.getTotalVertices()?Q=!1:N.doNotInstantiate&&(Q="function"===typeof N.doNotInstantiate?!N.doNotInstantiate(f):!N.doNotInstantiate);const H=Q?f.yd(`instance of ${f.name}`):f.clone(`Clone of ${f.name}`,null,!0);if(!H)throw new Error(`Could not clone or instantiate node on Asset Container ${f.name}`);v(f,H)}})),this.skeletons.forEach((Q=>{if(N.predicate&&!N.predicate(Q))return;const H=Q.clone(f?f(Q.name):"Clone of "+Q.name);for(const f of this.meshes)if(f.skeleton===Q&&!f.isAnInstance){const Q=S[X[f.uniqueId]];if(!Q||Q.isAnInstance)continue;if(Q.skeleton=H,-1!==Z.indexOf(H))continue;Z.push(H);for(const f of H.bones)f._linkedTransformNode&&(f._linkedTransformNode=S[X[f._linkedTransformNode.uniqueId]])}K.skeletons.push(H)})),this.animationGroups.forEach((Q=>{if(N.predicate&&!N.predicate(Q))return;const H=Q.clone(f?f(Q.name):"Clone of "+Q.name,(f=>S[X[f.uniqueId]]||f));K.animationGroups.push(H)})),K}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||i.g.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Re.environmentTexture=this.environmentTexture);for(const f of this.Re._serializableComponents)f.addFromContainer(this);this.Re.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const Q=[];this.cameras.forEach((H=>{f&&!f(H)||(this.Re.addCamera(H),Q.push(H))})),this.lights.forEach((H=>{f&&!f(H)||(this.Re.addLight(H),Q.push(H))})),this.meshes.forEach((H=>{f&&!f(H)||(this.Re.bf(H),Q.push(H))})),this.skeletons.forEach((Q=>{f&&!f(Q)||this.Re.addSkeleton(Q)})),this.animations.forEach((Q=>{f&&!f(Q)||this.Re.addAnimation(Q)})),this.animationGroups.forEach((Q=>{f&&!f(Q)||this.Re.addAnimationGroup(Q)})),this.multiMaterials.forEach((Q=>{f&&!f(Q)||this.Re.addMultiMaterial(Q)})),this.materials.forEach((Q=>{f&&!f(Q)||this.Re.addMaterial(Q)})),this.morphTargetManagers.forEach((Q=>{f&&!f(Q)||this.Re.addMorphTargetManager(Q)})),this.geometries.forEach((Q=>{f&&!f(Q)||this.Re.addGeometry(Q)})),this.transformNodes.forEach((H=>{f&&!f(H)||(this.Re.addTransformNode(H),Q.push(H))})),this.actionManagers.forEach((Q=>{f&&!f(Q)||this.Re.addActionManager(Q)})),this.textures.forEach((Q=>{f&&!f(Q)||this.Re.addTexture(Q)})),this.reflectionProbes.forEach((Q=>{f&&!f(Q)||this.Re.addReflectionProbe(Q)}));for(const H of Q)H.parent&&-1===this.Re.getNodes().indexOf(H.parent)&&(H.setParent?H.setParent(null):H.parent=null)}removeAllFromScene(){this._isValidHierarchy()||i.g.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Re.environmentTexture&&(this.Re.environmentTexture=null);for(const f of this.Re._serializableComponents)f.removeFromContainer(this)}removeFromScene(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((Q=>{f&&!f(Q)||this.Re.removeCamera(Q)})),this.lights.forEach((Q=>{f&&!f(Q)||this.Re.removeLight(Q)})),this.meshes.forEach((Q=>{f&&!f(Q)||this.Re.cf(Q,!0)})),this.skeletons.forEach((Q=>{f&&!f(Q)||this.Re.removeSkeleton(Q)})),this.animations.forEach((Q=>{f&&!f(Q)||this.Re.removeAnimation(Q)})),this.animationGroups.forEach((Q=>{f&&!f(Q)||this.Re.removeAnimationGroup(Q)})),this.multiMaterials.forEach((Q=>{f&&!f(Q)||this.Re.removeMultiMaterial(Q)})),this.materials.forEach((Q=>{f&&!f(Q)||this.Re.removeMaterial(Q)})),this.morphTargetManagers.forEach((Q=>{f&&!f(Q)||this.Re.removeMorphTargetManager(Q)})),this.geometries.forEach((Q=>{f&&!f(Q)||this.Re.removeGeometry(Q)})),this.transformNodes.forEach((Q=>{f&&!f(Q)||this.Re.removeTransformNode(Q)})),this.actionManagers.forEach((Q=>{f&&!f(Q)||this.Re.removeActionManager(Q)})),this.textures.forEach((Q=>{f&&!f(Q)||this.Re.removeTexture(Q)})),this.reflectionProbes.forEach((Q=>{f&&!f(Q)||this.Re.removeReflectionProbe(Q)}))}dispose(){this.cameras.slice(0).forEach((f=>{f.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((f=>{f.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((f=>{f.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((f=>{f.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((f=>{f.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((f=>{f.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((f=>{f.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((f=>{f.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((f=>{f.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((f=>{f.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((f=>{f.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((f=>{f.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((f=>{f.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const f of this.Re._serializableComponents)f.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Re.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(f,Q,H){if(f&&Q)for(const X of f){let f=!0;if(H)for(const Q of H)if(X===Q){f=!1;break}f&&(Q.push(X),X._parentContainer=this)}}moveAllFromScene(f){this._wasAddedToScene=!1,void 0===f&&(f=new Y);for(const Q in this)Object.prototype.hasOwnProperty.call(this,Q)&&(this[Q]=this[Q]||("_environmentTexture"===Q?null:[]),this._moveAssets(this.Re[Q],this[Q],f[Q]));this.environmentTexture=this.Re.environmentTexture,this.removeAllFromScene()}createRootMesh(){const f=new x.b("assetContainerRootMesh",this.Re);return this.meshes.forEach((Q=>{Q.parent||f.addChild(Q)})),this.meshes.unshift(f),f}mergeAnimationsTo(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N.e.LastCreatedScene,Q=arguments.length>1?arguments[1]:void 0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!f)return B.b.Error("No scene available to merge animations to"),[];const X=H||(Q=>{let H=null;const X=Q.animations.length?Q.animations[0].targetProperty:"",i=Q.name.split(".").join("").split("_primitive")[0];switch(X){case"position":case"rotationQuaternion":H=f.getTransformNodeByName(Q.name)||f.getTransformNodeByName(i);break;case"influence":H=f.getMorphTargetByName(Q.name)||f.getMorphTargetByName(i);break;default:H=f.getNodeByName(Q.name)||f.getNodeByName(i)}return H});this.getNodes().forEach((f=>{const Q=X(f);if(null!==Q){for(const H of f.animations){const f=Q.animations.filter((f=>f.targetProperty===H.targetProperty));for(const H of f){const f=Q.animations.indexOf(H,0);f>-1&&Q.animations.splice(f,1)}}Q.animations=Q.animations.concat(f.animations)}}));const i=[];return this.animationGroups.slice().forEach((f=>{i.push(f.clone(f.name,X)),f.animatables.forEach((f=>{f.stop()}))})),Q.forEach((Q=>{const H=X(Q.target);H&&(f.beginAnimation(H,Q.fromFrame,Q.toFrame,Q.loopAnimation,Q.speedRatio,Q.onAnimationEnd?Q.onAnimationEnd:void 0,void 0,!0,void 0,Q.onAnimationLoop?Q.onAnimationLoop:void 0),f.stopAnimation(Q.target))})),i}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((f=>{f.parent||-1!==this.rootNodes.indexOf(f)||this.rootNodes.push(f)})),this.transformNodes.forEach((f=>{f.parent||-1!==this.rootNodes.indexOf(f)||this.rootNodes.push(f)})),this.lights.forEach((f=>{f.parent||-1!==this.rootNodes.indexOf(f)||this.rootNodes.push(f)})),this.cameras.forEach((f=>{f.parent||-1!==this.rootNodes.indexOf(f)||this.rootNodes.push(f)}))}addAllAssetsToContainer(f){if(!f)return;const Q=[],H=new Set;for(Q.push(f);Q.length>0;){const f=Q.pop();if(f instanceof x.b?(f.ze&&-1===this.geometries.indexOf(f.ze)&&this.geometries.push(f.ze),this.meshes.push(f)):f instanceof K.d?this.transformNodes.push(f):f instanceof g.b?this.lights.push(f):f instanceof z.c&&this.cameras.push(f),f instanceof Z.c){if(f.material&&-1===this.materials.indexOf(f.material)){this.materials.push(f.material);for(const Q of f.material.getActiveTextures())-1===this.textures.indexOf(Q)&&this.textures.push(Q)}f.skeleton&&-1===this.skeletons.indexOf(f.skeleton)&&this.skeletons.push(f.skeleton),f.morphTargetManager&&-1===this.morphTargetManagers.indexOf(f.morphTargetManager)&&this.morphTargetManagers.push(f.morphTargetManager)}for(const X of f.getChildren())H.has(X)||Q.push(X);H.add(f)}this.populateRootNodes()}}var e=H(1071);class G{constructor(f){this.byteOffset=0,this.buffer=f}loadAsync(f){return this.buffer.readAsync(this.byteOffset,f).then((f=>{this._dataView=new DataView(f.buffer,f.byteOffset,f.byteLength),this._dataByteOffset=0}))}readUint32(){const f=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,f}readUint8Array(f){const Q=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,f);return this._dataByteOffset+=f,this.byteOffset+=f,Q}readString(f){return(0,e.h)(this.readUint8Array(f))}skipBytes(f){this._dataByteOffset+=f,this.byteOffset+=f}}var I=H(11938);const l="Z2xURg",q={name:"ij",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:f=>-1!==f.indexOf("asset")&&-1!==f.indexOf("version")||f.startsWith("data:base64,"+l)||f.startsWith("data:;base64,"+l)||f.startsWith("data:application/octet-stream;base64,"+l)||f.startsWith("data:model/gltf-binary;base64,"+l)};var D,d,s,F=H(1051),P=H(1067);function m(f,Q,H){try{return Promise.resolve(new Uint8Array(f,Q,H))}catch(X){return Promise.reject(X)}}!function(f){f[f.AUTO=0]="AUTO",f[f.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(D||(D={})),function(f){f[f.NONE=0]="NONE",f[f.FIRST=1]="FIRST",f[f.ALL=2]="ALL"}(d||(d={})),function(f){f[f.LOADING=0]="LOADING",f[f.READY=1]="READY",f[f.COMPLETE=2]="COMPLETE"}(s||(s={}));class c{constructor(){this.coordinateSystemMode=D.AUTO,this.animationStartMode=d.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=f=>Promise.resolve(f),this.extensionOptions={}}p(f){f&&(this.onParsed=f.onParsed,this.coordinateSystemMode=f.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=f.animationStartMode??this.animationStartMode,this.loadNodeAnimations=f.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=f.loadSkins??this.loadSkins,this.loadMorphTargets=f.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=f.compileMaterials??this.compileMaterials,this.useClipPlane=f.useClipPlane??this.useClipPlane,this.compileShadowGenerators=f.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=f.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=f.useRangeRequests??this.useRangeRequests,this.createInstances=f.createInstances??this.createInstances,this.alwaysComputeBoundingBox=f.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=f.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=f.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=f.skipMaterials??this.skipMaterials,this.useSRGBBuffers=f.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=f.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=f.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=f.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=f.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=f.customRootNode,this.onMeshLoaded=f.onMeshLoaded,this.onSkinLoaded=f.onSkinLoaded,this.onTextureLoaded=f.onTextureLoaded,this.onMaterialLoaded=f.onMaterialLoaded,this.onCameraLoaded=f.onCameraLoaded,this.extensionOptions=f.extensionOptions??this.extensionOptions)}}class W extends c{constructor(f){super(),this.onParsedObservable=new X.e,this.onMeshLoadedObservable=new X.e,this.onSkinLoadedObservable=new X.e,this.onTextureLoadedObservable=new X.e,this.onMaterialLoadedObservable=new X.e,this.onCameraLoadedObservable=new X.e,this.onCompleteObservable=new X.e,this.onErrorObservable=new X.e,this.fe=new X.e,this.onExtensionLoadedObservable=new X.e,this.validate=!1,this.onValidatedObservable=new X.e,this._loader=null,this._state=null,this._requests=new Array,this.name=q.name,this.extensions=q.extensions,this.onLoaderStateChangedObservable=new X.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(f)}set onParsed(f){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),f&&(this._onParsedObserver=this.onParsedObservable.add(f))}set onMeshLoaded(f){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),f&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(f))}set onSkinLoaded(f){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),f&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((Q=>f(Q.node,Q.skinnedNode))))}set onTextureLoaded(f){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),f&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(f))}set onMaterialLoaded(f){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),f&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(f))}set onCameraLoaded(f){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),f&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(f))}set onComplete(f){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(f)}set onError(f){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(f)}set onDispose(f){this._onDisposeObserver&&this.fe.remove(this._onDisposeObserver),this._onDisposeObserver=this.fe.add(f)}set onExtensionLoaded(f){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(f)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(f){this._loggingEnabled!==f&&(this._loggingEnabled=f,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(f){this._capturePerformanceCounters!==f&&(this._capturePerformanceCounters=f,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(f){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(f)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const f of this._requests)f.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=f=>Promise.resolve(f),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.fe.notifyObservers(void 0),this.fe.clear()}loadFile(f,Q,H,S,x,K,Z,N){if(ArrayBuffer.isView(Q))return this._loadBinary(f,Q,H,S,Z,N),null;this._progressCallback=x;const J=Q.name||i.g.GetFilename(Q);if(K){if(this.useRangeRequests){this.validate&&B.b.Warn("glTF validation is not supported when range requests are enabled");const H={abort:()=>{},onCompleteObservable:new X.e},i={readAsync:(H,X)=>new Promise(((i,S)=>{this._loadFile(f,Q,(f=>{i(new Uint8Array(f))}),!0,(f=>{S(f)}),(f=>{f.setRequestHeader("Range",`bytes=${H}-${H+X-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new G(i)).then((f=>{H.onCompleteObservable.notifyObservers(H),S(f)}),Z?f=>Z(void 0,f):void 0),H}return this._loadFile(f,Q,(Q=>{this._validate(f,new Uint8Array(Q,0,Q.byteLength),H,J),this._unpackBinaryAsync(new G({readAsync:(f,H)=>m(Q,f,H),byteLength:Q.byteLength})).then((f=>{S(f)}),Z?f=>Z(void 0,f):void 0)}),!0,Z)}return this._loadFile(f,Q,(Q=>{try{this._validate(f,Q,H,J),S({json:this._parseJson(Q)})}catch{Z&&Z()}}),!1,Z)}_loadBinary(f,Q,H,X,i,S){this._validate(f,new Uint8Array(Q.buffer,Q.byteOffset,Q.byteLength),H,S),this._unpackBinaryAsync(new G({readAsync:(f,H)=>function(f,Q,H){try{if(Q<0||Q>=f.byteLength)throw new RangeError("Offset is out of range.");if(Q+H>f.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(f.buffer,f.byteOffset+Q,H))}catch(X){return Promise.reject(X)}}(Q,f,H),byteLength:Q.byteLength})).then((f=>{X(f)}),i?f=>i(void 0,f):void 0)}importMeshAsync(f,Q,H,X,i,S){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(H),this.onParsedObservable.clear(),this._log(`Loading ${S||""}`),this._loader=this._getLoader(H),this._loader.importMeshAsync(f,Q,null,H,X,i,S))))}loadAsync(f,Q,H,X,i){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(Q),this.onParsedObservable.clear(),this._log(`Loading ${i||""}`),this._loader=this._getLoader(Q),this._loader.loadAsync(f,Q,H,X,i))))}loadAssetContainerAsync(f,Q,H,X,i){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(Q),this.onParsedObservable.clear(),this._log(`Loading ${i||""}`),this._loader=this._getLoader(Q);const S=new n(f),x=[];this.onMaterialLoadedObservable.add((f=>{x.push(f)}));const K=[];this.onTextureLoadedObservable.add((f=>{K.push(f)}));const Z=[];this.onCameraLoadedObservable.add((f=>{Z.push(f)}));const B=[];return this.onMeshLoadedObservable.add((f=>{f.morphTargetManager&&B.push(f.morphTargetManager)})),this._loader.importMeshAsync(null,f,S,Q,H,X,i).then((f=>(Array.prototype.push.apply(S.geometries,f.geometries),Array.prototype.push.apply(S.meshes,f.meshes),Array.prototype.push.apply(S.pe,f.pe),Array.prototype.push.apply(S.skeletons,f.skeletons),Array.prototype.push.apply(S.animationGroups,f.animationGroups),Array.prototype.push.apply(S.materials,x),Array.prototype.push.apply(S.textures,K),Array.prototype.push.apply(S.lights,f.lights),Array.prototype.push.apply(S.transformNodes,f.transformNodes),Array.prototype.push.apply(S.cameras,Z),Array.prototype.push.apply(S.morphTargetManagers,B),S)))}))}canDirectLoad(f){return q.canDirectLoad(f)}directLoad(f,Q){if(Q.startsWith("base64,"+l)||Q.startsWith(";base64,"+l)||Q.startsWith("application/octet-stream;base64,"+l)||Q.startsWith("model/gltf-binary;base64,"+l)){const H=(0,F.b)(Q);return this._validate(f,new Uint8Array(H,0,H.byteLength)),this._unpackBinaryAsync(new G({readAsync:(f,Q)=>m(H,f,Q),byteLength:H.byteLength}))}return this._validate(f,Q),Promise.resolve({json:this._parseJson(Q)})}createPlugin(f){return new W(f[q.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((f,Q)=>{this.onCompleteObservable.addOnce((()=>{f()})),this.onErrorObservable.addOnce((f=>{Q(f)}))}))}_setState(f){this._state!==f&&(this._state=f,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(s[this._state]))}_loadFile(f,Q,H,X,i,S){const x=f._loadFile(Q,H,(f=>{this._onProgress(f,x)}),!0,X,i,S);return x.onCompleteObservable.add((()=>{x._lengthComputable=!0,x._total=x._loaded})),this._requests.push(x),x}_onProgress(f,Q){if(!this._progressCallback)return;Q._lengthComputable=f.lengthComputable,Q._loaded=f.loaded,Q._total=f.total;let H=!0,X=0,i=0;for(const S of this._requests){if(void 0===S._lengthComputable||void 0===S._loaded||void 0===S._total)return;H=H&&S._lengthComputable,X+=S._loaded,i+=S._total}this._progressCallback({lengthComputable:H,loaded:X,total:H?i:0})}_validate(f,Q){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),I.c.ValidateAsync(Q,H,X,(Q=>this.preprocessUrlAsync(H+Q).then((Q=>f._loadFileAsync(Q,void 0,!0,!0).then((f=>new Uint8Array(f,0,f.byteLength))))))).then((f=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(f),this.onValidatedObservable.clear()}),(f=>{this._endPerformanceCounter("Validate JSON"),i.g.Warn(`Failed to validate: ${f.message}`),this.onValidatedObservable.clear()})))}_getLoader(f){const Q=f.json.asset||{};this._log(`Asset version: ${Q.version}`),Q.minVersion&&this._log(`Asset minimum version: ${Q.minVersion}`),Q.generator&&this._log(`Asset generator: ${Q.generator}`);const H=W._parseVersion(Q.version);if(!H)throw new Error("Invalid version: "+Q.version);if(void 0!==Q.minVersion){const f=W._parseVersion(Q.minVersion);if(!f)throw new Error("Invalid minimum version: "+Q.minVersion);if(W._compareVersion(f,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+Q.minVersion)}const X={1:W._CreateGLTF1Loader,2:W._CreateGLTF2Loader}[H.major];if(!X)throw new Error("Unsupported version: "+Q.version);return X(this)}_parseJson(f){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${f.length}`);const Q=JSON.parse(f);return this._endPerformanceCounter("Parse JSON"),Q}_unpackBinaryAsync(f){return this._startPerformanceCounter("Unpack Binary"),f.loadAsync(20).then((()=>{const Q=f.readUint32();if(1179937895!==Q)throw new P.f("Unexpected magic: "+Q,P.e.GLTFLoaderUnexpectedMagicError);const H=f.readUint32();this.loggingEnabled&&this._log(`Binary version: ${H}`);const X=f.readUint32();let i;switch(this.useRangeRequests||X===f.buffer.byteLength||B.b.Warn(`Length in header does not match actual data length: ${X} != ${f.buffer.byteLength}`),H){case 1:i=this._unpackBinaryV1Async(f,X);break;case 2:i=this._unpackBinaryV2Async(f,X);break;default:throw new Error("Unsupported version: "+H)}return this._endPerformanceCounter("Unpack Binary"),i}))}_unpackBinaryV1Async(f,Q){const H=f.readUint32(),X=f.readUint32();if(0!==X)throw new Error(`Unexpected content format: ${X}`);const i=Q-f.byteOffset,S={json:this._parseJson(f.readString(H)),bin:null};if(0!==i){const Q=f.byteOffset;S.bin={readAsync:(H,X)=>f.buffer.readAsync(Q+H,X),byteLength:i}}return Promise.resolve(S)}_unpackBinaryV2Async(f,Q){const H=1313821514,X=5130562,i=f.readUint32();if(f.readUint32()!==H)throw new Error("First chunk format is not JSON");return f.byteOffset+i===Q?f.loadAsync(i).then((()=>({json:this._parseJson(f.readString(i)),bin:null}))):f.loadAsync(i+8).then((()=>{const S={json:this._parseJson(f.readString(i)),bin:null},x=()=>{const i=f.readUint32();switch(f.readUint32()){case H:throw new Error("Unexpected JSON chunk");case X:{const Q=f.byteOffset;S.bin={readAsync:(H,X)=>f.buffer.readAsync(Q+H,X),byteLength:i},f.skipBytes(i);break}default:f.skipBytes(i)}return f.byteOffset!==Q?f.loadAsync(8).then(x):Promise.resolve(S)};return x()}))}static _parseVersion(f){if("1.0"===f||"1.0.1"===f)return{major:1,minor:0};const Q=(f+"").match(/^(\d+)\.(\d+)/);return Q?{major:parseInt(Q[1]),minor:parseInt(Q[2])}:null}static _compareVersion(f,Q){return f.major>Q.major?1:f.major<Q.major?-1:f.minor>Q.minor?1:f.minor<Q.minor?-1:0}_logOpen(f){this._log(f),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(f){const Q=W._logSpaces.substring(0,2*this._logIndentLevel);B.b.Log(`${Q}${f}`)}_logDisabled(f){}_startPerformanceCounterEnabled(f){i.g.StartPerformanceCounter(f)}_startPerformanceCounterDisabled(f){}_endPerformanceCounterEnabled(f){i.g.EndPerformanceCounter(f)}_endPerformanceCounterDisabled(f){}}W.IncrementalLoading=!0,W.HomogeneousCoordinates=!1,W._logSpaces="                                ",(0,S.f)(new W)},11938:(f,Q,H)=>{"use strict";H.d(Q,{c:()=>x});var X=H(1203);function i(f,Q,H,X){const i={externalResourceFunction:X};return H&&(i.uri="file:"===Q?H:Q+H),ArrayBuffer.isView(f)?GLTFValidator.validateBytes(f,i):GLTFValidator.validateString(f,i)}function S(){const f=[];onmessage=Q=>{const H=Q.data;switch(H.id){case"init":importScripts(H.url);break;case"validate":i(H.data,H.rootUrl,H.fileName,(Q=>new Promise(((H,X)=>{const i=f.length;f.push({resolve:H,reject:X}),postMessage({id:"getExternalResource",index:i,uri:Q})})))).then((f=>{postMessage({id:"validate.resolve",value:f})}),(f=>{postMessage({id:"validate.reject",reason:f})}));break;case"getExternalResource.resolve":f[H.index].resolve(H.value);break;case"getExternalResource.reject":f[H.index].reject(H.reason)}}}class x{static ValidateAsync(f,Q,H,x){return"function"===typeof Worker?new Promise(((K,Z)=>{const B=`${i}(${S})()`,N=URL.createObjectURL(new Blob([B],{type:"application/javascript"})),J=new Worker(N),g=f=>{J.removeEventListener("error",g),J.removeEventListener("message",z),Z(f)},z=f=>{const Q=f.data;switch(Q.id){case"getExternalResource":x(Q.uri).then((f=>{J.postMessage({id:"getExternalResource.resolve",index:Q.index,value:f},[f.buffer])}),(f=>{J.postMessage({id:"getExternalResource.reject",index:Q.index,reason:f})}));break;case"validate.resolve":J.removeEventListener("error",g),J.removeEventListener("message",z),K(Q.value),J.terminate();break;case"validate.reject":J.removeEventListener("error",g),J.removeEventListener("message",z),Z(Q.reason),J.terminate()}};if(J.addEventListener("error",g),J.addEventListener("message",z),J.postMessage({id:"init",url:X.g.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(f)){const X=f.slice();J.postMessage({id:"validate",data:X,rootUrl:Q,fileName:H},[X.buffer])}else J.postMessage({id:"validate",data:f,rootUrl:Q,fileName:H})})):(this._LoadScriptPromise||(this._LoadScriptPromise=X.g.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>i(f,Q,H,x))))}}x.Configuration={url:`${X.g._DefaultCdnUrl}/gltf_validator.js`}},12266:(f,Q,H)=>{"use strict";H.d(Q,{e:()=>D});var X=H(978),i=H(982),S=H(1151),x=H(1003),K=H(1401),Z=H(1404),B=H(1253),N=H(1196),J=H(1022),g=H(1115);H(10842),H(10691),H(10847),H(10611),H(10855),H(10888),H(10896);const z="imageProcessingCompatibility",v="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";g.d.IncludesShadersStore[z]=v;const Y="skyPixelShader",O="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";g.d.ShadersStore[Y]=O;H(10655),H(10660),H(10747),H(10777),H(10753);const n="skyVertexShader",e="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";g.d.ShadersStore[n]=e;var G=H(1416),I=H(1395),l=H(1389);class q extends K.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class D extends Z.c{constructor(f,Q){super(f,Q),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new x.p(0,100,0),this.useSunPosition=!1,this.cameraOffset=x.p.Zero(),this.up=x.p.Up(),this.dithering=!1,this._cameraPosition=x.p.Zero(),this._skyOrientation=new x.i}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(f,Q){const H=Q._drawWrapper;if(this.isFrozen&&H.effect&&H._wasPreviouslyReady)return!0;Q.materialDefines||(Q.materialDefines=new q);const X=Q.materialDefines,i=this.va();if(this._isReadyForSubMesh(Q))return!0;if((0,l.Y)(f,i,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,X),(0,l.O)(f,X,!0,!1),X.IMAGEPROCESSINGPOSTPROCESS!==i.imageProcessingConfiguration.applyByPostProcess&&X.markAsMiscDirty(),X.DITHER!==this.dithering&&X.markAsMiscDirty(),X.isDirty){X.markAsProcessed(),i.resetCachedMaterial();const f=new G.c;X.FOG&&f.addFallback(1,"FOG"),X.IMAGEPROCESSINGPOSTPROCESS=i.imageProcessingConfiguration.applyByPostProcess,X.DITHER=this.dithering;const H=[B.e.PositionKind];X.VERTEXCOLOR&&H.push(B.e.ColorKind);const S="sky",x=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,I.b)(x);const K=X.toString();Q.setEffect(i.getEngine().createEffect(S,H,x,[],K,f,this.onCompiled,this.onError),X,this._materialContext)}return!(!Q.effect||!Q.effect.isReady())&&(X._renderId=i.getRenderId(),H._wasPreviouslyReady=!0,!0)}bindForSubMesh(f,Q,H){const X=this.va(),i=H.materialDefines;if(!i)return;const S=H.effect;if(!S)return;this._activeEffect=S,this.bindOnlyWorldMatrix(f),this._activeEffect.setMatrix("viewProjection",X.getTransformMatrix()),this._mustRebind(X,S,H)&&((0,I.f)(S,this,X),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,l.m)(i,S,X)),X.fogEnabled&&Q.applyFog&&X.fogMode!==N.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",X.getViewMatrix()),(0,l.h)(X,Q,this._activeEffect);const K=X.activeCamera;if(K){const f=K.getWorldMatrix();this._cameraPosition.x=f.m[12],this._cameraPosition.y=f.m[13],this._cameraPosition.z=f.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const f=Math.PI*(this.inclination-.5),Q=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(Q)*Math.cos(f),this.sunPosition.y=this.distance*Math.sin(-f),this.sunPosition.z=this.distance*Math.sin(Q)*Math.cos(f),x.i.FromUnitVectorsToRef(x.p.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(Q,this._activeEffect,H)}getAnimatables(){return[]}dispose(f){super.dispose(f)}clone(f){return S.b.Clone((()=>new D(f,this.va())),this)}serialize(){const f=super.serialize();return f.customType="BABYLON.SkyMaterial",f}getClassName(){return"SkyMaterial"}static Parse(f,Q,H){return S.b.Parse((()=>new D(f.name,Q)),f,Q,H)}}(0,X.d)([(0,i.G)()],D.prototype,"luminance",void 0),(0,X.d)([(0,i.G)()],D.prototype,"turbidity",void 0),(0,X.d)([(0,i.G)()],D.prototype,"rayleigh",void 0),(0,X.d)([(0,i.G)()],D.prototype,"mieCoefficient",void 0),(0,X.d)([(0,i.G)()],D.prototype,"mieDirectionalG",void 0),(0,X.d)([(0,i.G)()],D.prototype,"distance",void 0),(0,X.d)([(0,i.G)()],D.prototype,"inclination",void 0),(0,X.d)([(0,i.G)()],D.prototype,"azimuth",void 0),(0,X.d)([(0,i.F)()],D.prototype,"sunPosition",void 0),(0,X.d)([(0,i.G)()],D.prototype,"useSunPosition",void 0),(0,X.d)([(0,i.F)()],D.prototype,"cameraOffset",void 0),(0,X.d)([(0,i.F)()],D.prototype,"up",void 0),(0,X.d)([(0,i.G)()],D.prototype,"dithering",void 0),(0,J.h)("BABYLON.SkyMaterial",D)},11028:(f,Q,H)=>{"use strict";function X(f,Q){Q.headers=f.headers||{},Q.statusMessage=f.statusText,Q.statusCode=f.status,Q.data=f.response}function i(f,Q,H){return new Promise((function(i,S){H=H||{};var x,K,Z,B=new XMLHttpRequest,N=H.body,J=H.headers||{};for(x in H.timeout&&(B.timeout=H.timeout),B.ontimeout=B.onerror=function(f){f.timeout="timeout"==f.type,S(f)},B.open(f,Q.href||Q),B.onload=function(){for(Z=B.getAllResponseHeaders().trim().split(/[\r\n]+/),X(B,B);K=Z.shift();)K=K.split(": "),B.headers[K.shift().toLowerCase()]=K.join(": ");if((K=B.headers["content-type"])&&~K.indexOf("application/json"))try{B.data=JSON.parse(B.data,H.reviver)}catch(f){return X(B,f),S(f)}(B.status>=400?S:i)(B)},typeof FormData<"u"&&N instanceof FormData||N&&"object"==typeof N&&(J["content-type"]="application/json",N=JSON.stringify(N)),B.withCredentials=!!H.withCredentials,J)B.setRequestHeader(x,J[x]);B.send(N)}))}H.r(Q),H.d(Q,{del:()=>Z,get:()=>S,patch:()=>K,post:()=>x,put:()=>B,send:()=>i});var S=i.bind(i,"GET"),x=i.bind(i,"POST"),K=i.bind(i,"PATCH"),Z=i.bind(i,"DELETE"),B=i.bind(i,"PUT")},12362:(f,Q,H)=>{"use strict";H.d(Q,{b:()=>J});const X=.5*(Math.sqrt(3)-1),i=(3-Math.sqrt(3))/6,S=1/3,x=1/6,K=(Math.sqrt(5)-1)/4,Z=(5-Math.sqrt(5))/20,B=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),N=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const J=class{constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const Q="function"==typeof f?f:function(f){let Q=0,H=0,X=0,i=1;const S=function(){let f=4022871197;return function(Q){Q=Q.toString();for(let H=0;H<Q.length;H++){f+=Q.charCodeAt(H);let X=.02519603282416938*f;f=X>>>0,X-=f,X*=f,f=X>>>0,X-=f,f+=4294967296*X}return 2.3283064365386963e-10*(f>>>0)}}();Q=S(" "),H=S(" "),X=S(" "),Q-=S(f),Q<0&&(Q+=1);H-=S(f),H<0&&(H+=1);X-=S(f),X<0&&(X+=1);return function(){const f=2091639*Q+2.3283064365386963e-10*i;return Q=H,H=X,X=f-(i=0|f)}}(f);this.p=function(f){const Q=new Uint8Array(256);for(let H=0;H<256;H++)Q[H]=H;for(let H=0;H<255;H++){const X=H+~~(f()*(256-H)),i=Q[H];Q[H]=Q[X],Q[X]=i}return Q}(Q),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let H=0;H<512;H++)this.perm[H]=this.p[255&H],this.permMod12[H]=this.perm[H]%12}noise2D(f,Q){const H=this.permMod12,S=this.perm;let x=0,K=0,Z=0;const N=(f+Q)*X,J=Math.floor(f+N),g=Math.floor(Q+N),z=(J+g)*i,v=f-(J-z),Y=Q-(g-z);let O,n;v>Y?(O=1,n=0):(O=0,n=1);const e=v-O+i,G=Y-n+i,I=v-1+2*i,l=Y-1+2*i,q=255&J,D=255&g;let d=.5-v*v-Y*Y;if(d>=0){const f=3*H[q+S[D]];d*=d,x=d*d*(B[f]*v+B[f+1]*Y)}let s=.5-e*e-G*G;if(s>=0){const f=3*H[q+O+S[D+n]];s*=s,K=s*s*(B[f]*e+B[f+1]*G)}let F=.5-I*I-l*l;if(F>=0){const f=3*H[q+1+S[D+1]];F*=F,Z=F*F*(B[f]*I+B[f+1]*l)}return 70*(x+K+Z)}noise3D(f,Q,H){const X=this.permMod12,i=this.perm;let K,Z,N,J;const g=(f+Q+H)*S,z=Math.floor(f+g),v=Math.floor(Q+g),Y=Math.floor(H+g),O=(z+v+Y)*x,n=f-(z-O),e=Q-(v-O),G=H-(Y-O);let I,l,q,D,d,s;n>=e?e>=G?(I=1,l=0,q=0,D=1,d=1,s=0):n>=G?(I=1,l=0,q=0,D=1,d=0,s=1):(I=0,l=0,q=1,D=1,d=0,s=1):e<G?(I=0,l=0,q=1,D=0,d=1,s=1):n<G?(I=0,l=1,q=0,D=0,d=1,s=1):(I=0,l=1,q=0,D=1,d=1,s=0);const F=n-I+x,P=e-l+x,m=G-q+x,c=n-D+2*x,W=e-d+2*x,R=G-s+2*x,U=n-1+.5,E=e-1+.5,t=G-1+.5,u=255&z,L=255&v,A=255&Y;let a=.6-n*n-e*e-G*G;if(a<0)K=0;else{const f=3*X[u+i[L+i[A]]];a*=a,K=a*a*(B[f]*n+B[f+1]*e+B[f+2]*G)}let V=.6-F*F-P*P-m*m;if(V<0)Z=0;else{const f=3*X[u+I+i[L+l+i[A+q]]];V*=V,Z=V*V*(B[f]*F+B[f+1]*P+B[f+2]*m)}let M=.6-c*c-W*W-R*R;if(M<0)N=0;else{const f=3*X[u+D+i[L+d+i[A+s]]];M*=M,N=M*M*(B[f]*c+B[f+1]*W+B[f+2]*R)}let r=.6-U*U-E*E-t*t;if(r<0)J=0;else{const f=3*X[u+1+i[L+1+i[A+1]]];r*=r,J=r*r*(B[f]*U+B[f+1]*E+B[f+2]*t)}return 32*(K+Z+N+J)}noise4D(f,Q,H,X){const i=this.perm;let S,x,B,J,g;const z=(f+Q+H+X)*K,v=Math.floor(f+z),Y=Math.floor(Q+z),O=Math.floor(H+z),n=Math.floor(X+z),e=(v+Y+O+n)*Z,G=f-(v-e),I=Q-(Y-e),l=H-(O-e),q=X-(n-e);let D=0,d=0,s=0,F=0;G>I?D++:d++,G>l?D++:s++,G>q?D++:F++,I>l?d++:s++,I>q?d++:F++,l>q?s++:F++;const P=D>=3?1:0,m=d>=3?1:0,c=s>=3?1:0,W=F>=3?1:0,R=D>=2?1:0,U=d>=2?1:0,E=s>=2?1:0,t=F>=2?1:0,u=D>=1?1:0,L=d>=1?1:0,A=s>=1?1:0,a=F>=1?1:0,V=G-P+Z,M=I-m+Z,r=l-c+Z,j=q-W+Z,T=G-R+2*Z,k=I-U+2*Z,y=l-E+2*Z,h=q-t+2*Z,w=G-u+3*Z,b=I-L+3*Z,o=l-A+3*Z,p=q-a+3*Z,C=G-1+4*Z,ff=I-1+4*Z,Qf=l-1+4*Z,Hf=q-1+4*Z,Xf=255&v,Sf=255&Y,xf=255&O,Kf=255&n;let Zf=.6-G*G-I*I-l*l-q*q;if(Zf<0)S=0;else{const f=i[Xf+i[Sf+i[xf+i[Kf]]]]%32*4;Zf*=Zf,S=Zf*Zf*(N[f]*G+N[f+1]*I+N[f+2]*l+N[f+3]*q)}let Bf=.6-V*V-M*M-r*r-j*j;if(Bf<0)x=0;else{const f=i[Xf+P+i[Sf+m+i[xf+c+i[Kf+W]]]]%32*4;Bf*=Bf,x=Bf*Bf*(N[f]*V+N[f+1]*M+N[f+2]*r+N[f+3]*j)}let Nf=.6-T*T-k*k-y*y-h*h;if(Nf<0)B=0;else{const f=i[Xf+R+i[Sf+U+i[xf+E+i[Kf+t]]]]%32*4;Nf*=Nf,B=Nf*Nf*(N[f]*T+N[f+1]*k+N[f+2]*y+N[f+3]*h)}let Jf=.6-w*w-b*b-o*o-p*p;if(Jf<0)J=0;else{const f=i[Xf+u+i[Sf+L+i[xf+A+i[Kf+a]]]]%32*4;Jf*=Jf,J=Jf*Jf*(N[f]*w+N[f+1]*b+N[f+2]*o+N[f+3]*p)}let gf=.6-C*C-ff*ff-Qf*Qf-Hf*Hf;if(gf<0)g=0;else{const f=i[Xf+1+i[Sf+1+i[xf+1+i[Kf+1]]]]%32*4;gf*=gf,g=gf*gf*(N[f]*C+N[f+1]*ff+N[f+2]*Qf+N[f+3]*Hf)}return 27*(S+x+B+J+g)}}}}]);