/*! For license information please see seq7h8.10.190a1ffa.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[10],{11169:function(G,D){!function(G){"use strict";var D=function(G,N){return D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(G,D){G.__proto__=D}||function(G,D){for(var N in D)Object.prototype.hasOwnProperty.call(D,N)&&(G[N]=D[N])},D(G,N)};function N(G,N){if("function"!==typeof N&&null!==N)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");function T(){this.constructor=G}D(G,N),G.prototype=null===N?Object.create(N):(T.prototype=N.prototype,new T)}function T(G,D,N,T){var o,Z=arguments.length,n=Z<3?D:null===T?T=Object.getOwnPropertyDescriptor(D,N):T;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)n=Reflect.decorate(G,D,N,T);else for(var C=G.length-1;C>=0;C--)(o=G[C])&&(n=(Z<3?o(n):Z>3?o(D,N,n):o(D,N))||n);return Z>3&&n&&Object.defineProperty(D,N,n),n}function o(G,D,N){if(N||2===arguments.length)for(var T,o=0,Z=D.length;o<Z;o++)!T&&o in D||(T||(T=Array.prototype.slice.call(D,0,o)),T[o]=D[o]);return G.concat(T||Array.prototype.slice.call(D))}var Z,n=255,C=213;G.OPERATION=void 0,(Z=G.OPERATION||(G.OPERATION={}))[Z.ADD=128]="ADD",Z[Z.REPLACE=0]="REPLACE",Z[Z.DELETE=64]="DELETE",Z[Z.DELETE_AND_ADD=192]="DELETE_AND_ADD",Z[Z.TOUCH=1]="TOUCH",Z[Z.CLEAR=10]="CLEAR";var P=function(){function D(G,D,N){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=G,this.setParent(D,N)}return D.prototype.setParent=function(G,D,N){var T=this;if(this.indexes||(this.indexes=this.ref instanceof pG?this.ref._definition.indexes:{}),this.parent=G,this.parentIndex=N,D)if(this.root=D,this.ref instanceof pG){var o=this.ref._definition;for(var Z in o.schema){var n=this.ref[Z];if(n&&n.$changes){var C=o.indexes[Z];n.$changes.setParent(this.ref,D,C)}}}else"object"===typeof this.ref&&this.ref.forEach((function(G,D){if(G instanceof pG){var N=G.$changes,o=T.ref.$changes.indexes[D];N.setParent(T.ref,T.root,o)}}))},D.prototype.operation=function(G){this.changes.set(--this.currentCustomOperation,G)},D.prototype.change=function(D,N){void 0===N&&(N=G.OPERATION.ADD);var T="number"===typeof D?D:this.indexes[D];this.assertValidIndex(T,D);var o=this.changes.get(T);o&&o.op!==G.OPERATION.DELETE&&o.op!==G.OPERATION.TOUCH||this.changes.set(T,{op:o&&o.op===G.OPERATION.DELETE?G.OPERATION.DELETE_AND_ADD:N,index:T}),this.allChanges.add(T),this.changed=!0,this.touchParents()},D.prototype.touch=function(D){var N="number"===typeof D?D:this.indexes[D];this.assertValidIndex(N,D),this.changes.has(N)||this.changes.set(N,{op:G.OPERATION.TOUCH,index:N}),this.allChanges.add(N),this.touchParents()},D.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},D.prototype.getType=function(G){if(this.ref._definition)return(D=this.ref._definition).schema[D.fieldsByIndex[G]];var D,N=(D=this.parent._definition).schema[D.fieldsByIndex[this.parentIndex]];return Object.values(N)[0]},D.prototype.getChildrenFilter=function(){var G=this.parent._definition.childFilters;return G&&G[this.parentIndex]},D.prototype.getValue=function(G){return this.ref.getByIndex(G)},D.prototype.delete=function(D){var N="number"===typeof D?D:this.indexes[D];if(void 0!==N){var T=this.getValue(N);this.changes.set(N,{op:G.OPERATION.DELETE,index:N}),this.allChanges.delete(N),delete this.caches[N],T&&T.$changes&&(T.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(D," (").concat(N,")"))},D.prototype.discard=function(D,N){var T=this;void 0===D&&(D=!1),void 0===N&&(N=!1),this.ref instanceof pG||this.changes.forEach((function(D){if(D.op===G.OPERATION.DELETE){var N=T.ref.getIndex(D.index);delete T.indexes[N]}})),this.changes.clear(),this.changed=D,N&&this.allChanges.clear(),this.currentCustomOperation=0},D.prototype.discardAll=function(){var G=this;this.changes.forEach((function(D){var N=G.getValue(D.index);N&&N.$changes&&N.$changes.discardAll()})),this.discard()},D.prototype.cache=function(G,D){this.caches[G]=D},D.prototype.clone=function(){return new D(this.ref,this.parent,this.root)},D.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},D.prototype.assertValidIndex=function(G,D){if(void 0===G)throw new Error('ChangeTree: missing index for field "'.concat(D,'"'))},D}();function r(G,D,N,T){return G[D]||(G[D]=[]),G[D].push(N),null===T||void 0===T||T.forEach((function(G,D){return N(G,D)})),function(){return q(G[D],G[D].indexOf(N))}}function v(D){var N=this,T="string"!==typeof this.$changes.getType();this.$items.forEach((function(o,Z){D.push({refId:N.$changes.refId,op:G.OPERATION.DELETE,field:Z,value:void 0,previousValue:o}),T&&N.$changes.root.removeRef(o.$changes.refId)}))}function q(G,D){if(-1===D||D>=G.length)return!1;for(var N=G.length-1,T=D;T<N;T++)G[T]=G[T+1];return G.length=N,!0}var g=function(G,D){var N=G.toString(),T=D.toString();return N<T?-1:N>T?1:0};function X(G){return G.$proxy=!0,G=new Proxy(G,{get:function(G,D){return"symbol"===typeof D||isNaN(D)?G[D]:G.at(D)},set:function(G,D,N){if("symbol"===typeof D||isNaN(D))G[D]=N;else{var T=Array.from(G.$items.keys()),o=parseInt(T[D]||D);void 0===N||null===N?G.deleteAt(o):G.setAt(o,N)}return!0},deleteProperty:function(G,D){return"number"===typeof D?G.deleteAt(D):delete G[D],!0}})}var W=function(){function D(){for(var G=[],D=0;D<arguments.length;D++)G[D]=arguments[D];this.$changes=new P(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,G)}return D.prototype.Of=function(D,N){return void 0===N&&(N=!0),r(this.$callbacks||(this.$callbacks=[]),G.OPERATION.ADD,D,N?this.$items:void 0)},D.prototype.ab=function(D){return r(this.$callbacks||(this.$callbacks=[]),G.OPERATION.DELETE,D)},D.prototype.onChange=function(D){return r(this.$callbacks||(this.$callbacks=[]),G.OPERATION.REPLACE,D)},D.is=function(G){return Array.isArray(G)||void 0!==G.array},Object.defineProperty(D.prototype,"length",{get:function(){return this.$items.size},set:function(G){0===G?this.clear():this.splice(G,this.length-G)},enumerable:!1,configurable:!0}),D.prototype.push=function(){for(var G,D=this,N=[],T=0;T<arguments.length;T++)N[T]=arguments[T];return N.forEach((function(N){G=D.$refId++,D.setAt(G,N)})),G},D.prototype.pop=function(){var G=Array.from(this.$indexes.values()).pop();if(void 0!==G){this.$changes.delete(G),this.$indexes.delete(G);var D=this.$items.get(G);return this.$items.delete(G),D}},D.prototype.at=function(G){var D=Array.from(this.$items.keys())[G];return this.$items.get(D)},D.prototype.setAt=function(D,N){var T,o;if(void 0!==N&&null!==N){if(this.$items.get(D)!==N){void 0!==N.$changes&&N.$changes.setParent(this,this.$changes.root,D);var Z=null!==(o=null===(T=this.$changes.indexes[D])||void 0===T?void 0:T.op)&&void 0!==o?o:G.OPERATION.ADD;this.$changes.indexes[D]=D,this.$indexes.set(D,D),this.$items.set(D,N),this.$changes.change(D,Z)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},D.prototype.deleteAt=function(G){var D=Array.from(this.$items.keys())[G];return void 0!==D&&this.$deleteAt(D)},D.prototype.$deleteAt=function(G){return this.$changes.delete(G),this.$indexes.delete(G),this.$items.delete(G)},D.prototype.clear=function(D){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),D&&v.call(this,D),this.$items.clear(),this.$changes.operation({index:0,op:G.OPERATION.CLEAR}),this.$changes.touchParents()},D.prototype.concat=function(){for(var G,N=[],T=0;T<arguments.length;T++)N[T]=arguments[T];return new(D.bind.apply(D,o([void 0],(G=Array.from(this.$items.values())).concat.apply(G,N),!1)))},D.prototype.join=function(G){return Array.from(this.$items.values()).join(G)},D.prototype.reverse=function(){var G=this,D=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(N,T){G.setAt(D[T],N)})),this},D.prototype.shift=function(){var G=Array.from(this.$items.keys()).shift();if(void 0!==G){var D=this.$items.get(G);return this.$deleteAt(G),D}},D.prototype.slice=function(G,N){var T=new D;return T.push.apply(T,Array.from(this.$items.values()).slice(G,N)),T},D.prototype.sort=function(G){var D=this;void 0===G&&(G=g);var N=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(G).forEach((function(G,T){D.setAt(N[T],G)})),this},D.prototype.splice=function(G,D){void 0===D&&(D=this.length-G);for(var N=Array.from(this.$items.keys()),T=[],o=G;o<G+D;o++)T.push(this.$items.get(N[o])),this.$deleteAt(N[o]);return T},D.prototype.unshift=function(){for(var G=this,D=[],N=0;N<arguments.length;N++)D[N]=arguments[N];var T=this.length,o=D.length,Z=Array.from(this.$items.values());return D.forEach((function(D,N){G.setAt(N,D)})),Z.forEach((function(D,N){G.setAt(o+N,D)})),T+o},D.prototype.indexOf=function(G,D){return Array.from(this.$items.values()).indexOf(G,D)},D.prototype.lastIndexOf=function(G,D){return void 0===D&&(D=this.length-1),Array.from(this.$items.values()).lastIndexOf(G,D)},D.prototype.every=function(G,D){return Array.from(this.$items.values()).every(G,D)},D.prototype.some=function(G,D){return Array.from(this.$items.values()).some(G,D)},D.prototype.forEach=function(G,D){Array.from(this.$items.values()).forEach(G,D)},D.prototype.map=function(G,D){return Array.from(this.$items.values()).map(G,D)},D.prototype.filter=function(G,D){return Array.from(this.$items.values()).filter(G,D)},D.prototype.reduce=function(G,D){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},D.prototype.reduceRight=function(G,D){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},D.prototype.find=function(G,D){return Array.from(this.$items.values()).find(G,D)},D.prototype.findIndex=function(G,D){return Array.from(this.$items.values()).findIndex(G,D)},D.prototype.fill=function(G,D,N){throw new Error("ArraySchema#fill() not implemented")},D.prototype.copyWithin=function(G,D,N){throw new Error("ArraySchema#copyWithin() not implemented")},D.prototype.toString=function(){return this.$items.toString()},D.prototype.toLocaleString=function(){return this.$items.toLocaleString()},D.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(D,Symbol.species,{get:function(){return D},enumerable:!1,configurable:!0}),D.prototype.entries=function(){return this.$items.entries()},D.prototype.keys=function(){return this.$items.keys()},D.prototype.values=function(){return this.$items.values()},D.prototype.includes=function(G,D){return Array.from(this.$items.values()).includes(G,D)},D.prototype.flatMap=function(G,D){throw new Error("ArraySchema#flatMap() is not supported.")},D.prototype.flat=function(G){throw new Error("ArraySchema#flat() is not supported.")},D.prototype.findLast=function(){var G=Array.from(this.$items.values());return G.findLast.apply(G,arguments)},D.prototype.findLastIndex=function(){var G=Array.from(this.$items.values());return G.findLastIndex.apply(G,arguments)},D.prototype.setIndex=function(G,D){this.$indexes.set(G,D)},D.prototype.getIndex=function(G){return this.$indexes.get(G)},D.prototype.getByIndex=function(G){return this.$items.get(this.$indexes.get(G))},D.prototype.deleteByIndex=function(G){var D=this.$indexes.get(G);this.$items.delete(D),this.$indexes.delete(G)},D.prototype.toArray=function(){return Array.from(this.$items.values())},D.prototype.toJSON=function(){return this.toArray().map((function(G){return"function"===typeof G.toJSON?G.toJSON():G}))},D.prototype.clone=function(G){return G?new(D.bind.apply(D,o([void 0],Array.from(this.$items.values()),!1))):new(D.bind.apply(D,o([void 0],this.map((function(G){return G.$changes?G.clone():G})),!1)))},D}();function j(G){return G.$proxy=!0,G=new Proxy(G,{get:function(G,D){return"symbol"!==typeof D&&"undefined"===typeof G[D]?G.get(D):G[D]},set:function(G,D,N){return"symbol"!==typeof D&&-1===D.indexOf("$")&&"Of"!==D&&"ab"!==D&&"onChange"!==D?G.set(D,N):G[D]=N,!0},deleteProperty:function(G,D){return G.delete(D),!0}})}var Y=function(){function D(G){var N=this;if(this.$changes=new P(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,G)if(G instanceof Map||G instanceof D)G.forEach((function(G,D){return N.set(D,G)}));else for(var T in G)this.set(T,G[T])}return D.prototype.Of=function(D,N){return void 0===N&&(N=!0),r(this.$callbacks||(this.$callbacks=[]),G.OPERATION.ADD,D,N?this.$items:void 0)},D.prototype.ab=function(D){return r(this.$callbacks||(this.$callbacks=[]),G.OPERATION.DELETE,D)},D.prototype.onChange=function(D){return r(this.$callbacks||(this.$callbacks=[]),G.OPERATION.REPLACE,D)},D.is=function(G){return void 0!==G.map},D.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(D.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(D,Symbol.species,{get:function(){return D},enumerable:!1,configurable:!0}),D.prototype.set=function(D,N){if(void 0===N||null===N)throw new Error("MapSchema#set('".concat(D,"', ").concat(N,"): trying to set ").concat(N," value on '").concat(D,"'."));D=D.toString();var T="undefined"!==typeof this.$changes.indexes[D],o=T?this.$changes.indexes[D]:this.$refId++,Z=T?G.OPERATION.REPLACE:G.OPERATION.ADD,n=void 0!==N.$changes;if(n&&N.$changes.setParent(this,this.$changes.root,o),T){if(!n&&this.$items.get(D)===N)return;n&&this.$items.get(D)!==N&&(Z=G.OPERATION.ADD)}else this.$changes.indexes[D]=o,this.$indexes.set(o,D);return this.$items.set(D,N),this.$changes.change(D,Z),this},D.prototype.get=function(G){return this.$items.get(G)},D.prototype.delete=function(G){return this.$changes.delete(G),this.$items.delete(G)},D.prototype.clear=function(D){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),D&&v.call(this,D),this.$items.clear(),this.$changes.operation({index:0,op:G.OPERATION.CLEAR}),this.$changes.touchParents()},D.prototype.has=function(G){return this.$items.has(G)},D.prototype.forEach=function(G){this.$items.forEach(G)},D.prototype.entries=function(){return this.$items.entries()},D.prototype.keys=function(){return this.$items.keys()},D.prototype.values=function(){return this.$items.values()},Object.defineProperty(D.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),D.prototype.setIndex=function(G,D){this.$indexes.set(G,D)},D.prototype.getIndex=function(G){return this.$indexes.get(G)},D.prototype.getByIndex=function(G){return this.$items.get(this.$indexes.get(G))},D.prototype.deleteByIndex=function(G){var D=this.$indexes.get(G);this.$items.delete(D),this.$indexes.delete(G)},D.prototype.toJSON=function(){var G={};return this.forEach((function(D,N){G[N]="function"===typeof D.toJSON?D.toJSON():D})),G},D.prototype.clone=function(G){var N;return G?N=Object.assign(new D,this):(N=new D,this.forEach((function(G,D){G.$changes?N.set(D,G.clone()):N.set(D,G)}))),N},D}(),y={};function h(G,D){y[G]=D}function m(G){return y[G]}var R=function(){function G(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return G.create=function(D){var N=new G;return N.schema=Object.assign({},D&&D.schema||{}),N.indexes=Object.assign({},D&&D.indexes||{}),N.fieldsByIndex=Object.assign({},D&&D.fieldsByIndex||{}),N.descriptors=Object.assign({},D&&D.descriptors||{}),N.deprecated=Object.assign({},D&&D.deprecated||{}),N},G.prototype.addField=function(G,D){var N=this.getNextFieldIndex();this.fieldsByIndex[N]=G,this.indexes[G]=N,this.schema[G]=Array.isArray(D)?{array:D[0]}:D},G.prototype.hasField=function(G){return void 0!==this.indexes[G]},G.prototype.addFilter=function(G,D){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[G]]=D,this.indexesWithFilters.push(this.indexes[G]),!0},G.prototype.addChildrenFilter=function(G,D){var N=this.indexes[G],T=this.schema[G];if(m(Object.keys(T)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[N]=D,!0;console.warn("@filterChildren: field '".concat(G,"' can't have children. Ignoring filter."))},G.prototype.getChildrenFilter=function(G){return this.childFilters&&this.childFilters[this.indexes[G]]},G.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},G}();function L(G){return G._context&&G._context.useFilters}var w=function(){function G(){this.types={},this.schemas=new Map,this.useFilters=!1}return G.prototype.has=function(G){return this.schemas.has(G)},G.prototype.get=function(G){return this.types[G]},G.prototype.add=function(G,D){void 0===D&&(D=this.schemas.size),G._definition=R.create(G._definition),G._typeid=D,this.types[D]=G,this.schemas.set(G,D)},G.create=function(D){return void 0===D&&(D={}),function(N){return D.context||(D.context=new G),F(N,D)}},G}(),B=new w;function F(G,D){return void 0===D&&(D={}),function(N,T){var Z=D.context||B,n=N.constructor;if(n._context=Z,!G)throw new Error("".concat(n.name,': @type() reference provided for "').concat(T,"\" is undefined. Make sure you don't have any circular dependencies."));Z.has(n)||Z.add(n);var C=n._definition;if(C.addField(T,G),C.descriptors[T]){if(C.deprecated[T])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(T,"' definition on '").concat(n.name,"'.\nCheck @type() annotation"))}catch(y){var P=y.stack.split("\n")[4].trim();throw new Error("".concat(y.message," ").concat(P))}}var r=W.is(G),v=!r&&Y.is(G);if("string"!==typeof G&&!pG.is(G)){var q=Object.values(G)[0];"string"===typeof q||Z.has(q)||Z.add(q)}if(D.manual)C.descriptors[T]={enumerable:!0,configurable:!0,writable:!0};else{var g="_".concat(T);C.descriptors[g]={enumerable:!1,configurable:!1,writable:!0},C.descriptors[T]={get:function(){return this[g]},set:function(G){G!==this[g]&&(void 0!==G&&null!==G?(!r||G instanceof W||(G=new(W.bind.apply(W,o([void 0],G,!1)))),!v||G instanceof Y||(G=new Y(G)),void 0===G.$proxy&&(v?G=j(G):r&&(G=X(G))),this.$changes.change(T),G.$changes&&G.$changes.setParent(this,this.$changes.root,this._definition.indexes[T])):this[g]&&this.$changes.delete(T),this[g]=G)},enumerable:!0,configurable:!0}}}}function S(G){return function(D,N){var T=D.constructor;T._definition.addFilter(N,G)&&(T._context.useFilters=!0)}}function V(G){return function(D,N){var T=D.constructor;T._definition.addChildrenFilter(N,G)&&(T._context.useFilters=!0)}}function U(G){return void 0===G&&(G=!0),function(D,N){var T=D.constructor._definition;T.deprecated[N]=!0,G&&(T.descriptors[N]={get:function(){throw new Error("".concat(N," is deprecated."))},set:function(G){},enumerable:!1,configurable:!0})}}function z(G,D,N){for(var T in void 0===N&&(N={}),N.context||(N.context=G._context||N.context||B),D)F(D[T],N)(G.prototype,T);return G}function i(G){for(var D=0,N=0,T=0,o=G.length;T<o;T++)(D=G.charCodeAt(T))<128?N+=1:D<2048?N+=2:D<55296||D>=57344?N+=3:(T++,N+=4);return N}function J(G,D,N){for(var T=0,o=0,Z=N.length;o<Z;o++)(T=N.charCodeAt(o))<128?G[D++]=T:T<2048?(G[D++]=192|T>>6,G[D++]=128|63&T):T<55296||T>=57344?(G[D++]=224|T>>12,G[D++]=128|T>>6&63,G[D++]=128|63&T):(o++,T=65536+((1023&T)<<10|1023&N.charCodeAt(o)),G[D++]=240|T>>18,G[D++]=128|T>>12&63,G[D++]=128|T>>6&63,G[D++]=128|63&T)}function p(G,D){G.push(255&D)}function t(G,D){G.push(255&D)}function H(G,D){G.push(255&D),G.push(D>>8&255)}function s(G,D){G.push(255&D),G.push(D>>8&255)}function c(G,D){G.push(255&D),G.push(D>>8&255),G.push(D>>16&255),G.push(D>>24&255)}function K(G,D){var N=D>>24,T=D>>16,o=D>>8,Z=D;G.push(255&Z),G.push(255&o),G.push(255&T),G.push(255&N)}function b(G,D){var N=Math.floor(D/Math.pow(2,32));K(G,D>>>0),K(G,N)}function O(G,D){var N=D/Math.pow(2,32)|0;K(G,D>>>0),K(G,N)}function Q(G,D){l(G,D)}function A(G,D){x(G,D)}var I=new Int32Array(2),d=new Float32Array(I.buffer),u=new Float64Array(I.buffer);function l(G,D){d[0]=D,c(G,I[0])}function x(G,D){u[0]=D,c(G,I[0]),c(G,I[1])}function k(G,D){return t(G,D?1:0)}function a(G,D){D||(D="");var N=i(D),T=0;if(N<32)G.push(160|N),T=1;else if(N<256)G.push(217),t(G,N),T=2;else if(N<65536)G.push(218),s(G,N),T=3;else{if(!(N<4294967296))throw new Error("String too long");G.push(219),K(G,N),T=5}return J(G,G.length,D),T+N}function E(G,D){return isNaN(D)?E(G,0):isFinite(D)?D!==(0|D)?(G.push(203),x(G,D),9):D>=0?D<128?(t(G,D),1):D<256?(G.push(204),t(G,D),2):D<65536?(G.push(205),s(G,D),3):D<4294967296?(G.push(206),K(G,D),5):(G.push(207),O(G,D),9):D>=-32?(G.push(224|D+32),1):D>=-128?(G.push(208),p(G,D),2):D>=-32768?(G.push(209),H(G,D),3):D>=-2147483648?(G.push(210),c(G,D),5):(G.push(211),b(G,D),9):E(G,D>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var M=Object.freeze({__proto__:null,utf8Write:J,int8:p,uint8:t,int16:H,uint16:s,int32:c,uint32:K,int64:b,uint64:O,float32:Q,float64:A,writeFloat32:l,writeFloat64:x,boolean:k,string:a,number:E});function e(G,D,N){for(var T="",o=0,Z=D,n=D+N;Z<n;Z++){var C=G[Z];0!==(128&C)?192!==(224&C)?224!==(240&C)?240!==(248&C)?console.error("Invalid byte "+C.toString(16)):(o=(7&C)<<18|(63&G[++Z])<<12|(63&G[++Z])<<6|63&G[++Z])>=65536?(o-=65536,T+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):T+=String.fromCharCode(o):T+=String.fromCharCode((15&C)<<12|(63&G[++Z])<<6|63&G[++Z]):T+=String.fromCharCode((31&C)<<6|63&G[++Z]):T+=String.fromCharCode(C)}return T}function f(G,D){return GG(G,D)<<24>>24}function GG(G,D){return G[D.offset++]}function DG(G,D){return NG(G,D)<<16>>16}function NG(G,D){return G[D.offset++]|G[D.offset++]<<8}function TG(G,D){return G[D.offset++]|G[D.offset++]<<8|G[D.offset++]<<16|G[D.offset++]<<24}function oG(G,D){return TG(G,D)>>>0}function ZG(G,D){return gG(G,D)}function nG(G,D){return XG(G,D)}function CG(G,D){var N=oG(G,D);return TG(G,D)*Math.pow(2,32)+N}function PG(G,D){var N=oG(G,D);return oG(G,D)*Math.pow(2,32)+N}var rG=new Int32Array(2),vG=new Float32Array(rG.buffer),qG=new Float64Array(rG.buffer);function gG(G,D){return rG[0]=TG(G,D),vG[0]}function XG(G,D){return rG[0]=TG(G,D),rG[1]=TG(G,D),qG[0]}function WG(G,D){return GG(G,D)>0}function jG(G,D){var N,T=G[D.offset++];T<192?N=31&T:217===T?N=GG(G,D):218===T?N=NG(G,D):219===T&&(N=oG(G,D));var o=e(G,D.offset,N);return D.offset+=N,o}function YG(G,D){var N=G[D.offset];return N<192&&N>160||217===N||218===N||219===N}function yG(G,D){var N=G[D.offset++];return N<128?N:202===N?gG(G,D):203===N?XG(G,D):204===N?GG(G,D):205===N?NG(G,D):206===N?oG(G,D):207===N?PG(G,D):208===N?f(G,D):209===N?DG(G,D):210===N?TG(G,D):211===N?CG(G,D):N>223?-1*(255-N+1):void 0}function hG(G,D){var N=G[D.offset];return N<128||N>=202&&N<=211}function mG(G,D){return G[D.offset]<160}function RG(G,D){return G[D.offset-1]===n&&(G[D.offset]<128||G[D.offset]>=202&&G[D.offset]<=211)}var LG=Object.freeze({__proto__:null,int8:f,uint8:GG,int16:DG,uint16:NG,int32:TG,uint32:oG,float32:ZG,float64:nG,int64:CG,uint64:PG,readFloat32:gG,readFloat64:XG,boolean:WG,string:jG,stringCheck:YG,number:yG,numberCheck:hG,arrayCheck:mG,switchStructureCheck:RG}),wG=function(){function D(G){var D=this;this.$changes=new P(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,G&&G.forEach((function(G){return D.add(G)}))}return D.prototype.Of=function(D,N){return void 0===N&&(N=!0),r(this.$callbacks||(this.$callbacks=[]),G.OPERATION.ADD,D,N?this.$items:void 0)},D.prototype.ab=function(D){return r(this.$callbacks||(this.$callbacks=[]),G.OPERATION.DELETE,D)},D.prototype.onChange=function(D){return r(this.$callbacks||(this.$callbacks=[]),G.OPERATION.REPLACE,D)},D.is=function(G){return void 0!==G.collection},D.prototype.add=function(G){var D=this.$refId++;return void 0!==G.$changes&&G.$changes.setParent(this,this.$changes.root,D),this.$changes.indexes[D]=D,this.$indexes.set(D,D),this.$items.set(D,G),this.$changes.change(D),D},D.prototype.at=function(G){var D=Array.from(this.$items.keys())[G];return this.$items.get(D)},D.prototype.entries=function(){return this.$items.entries()},D.prototype.delete=function(G){for(var D,N,T=this.$items.entries();(N=T.next())&&!N.done;)if(G===N.value[1]){D=N.value[0];break}return void 0!==D&&(this.$changes.delete(D),this.$indexes.delete(D),this.$items.delete(D))},D.prototype.clear=function(D){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),D&&v.call(this,D),this.$items.clear(),this.$changes.operation({index:0,op:G.OPERATION.CLEAR}),this.$changes.touchParents()},D.prototype.has=function(G){return Array.from(this.$items.values()).some((function(D){return D===G}))},D.prototype.forEach=function(G){var D=this;this.$items.forEach((function(N,T,o){return G(N,T,D)}))},D.prototype.values=function(){return this.$items.values()},Object.defineProperty(D.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),D.prototype.setIndex=function(G,D){this.$indexes.set(G,D)},D.prototype.getIndex=function(G){return this.$indexes.get(G)},D.prototype.getByIndex=function(G){return this.$items.get(this.$indexes.get(G))},D.prototype.deleteByIndex=function(G){var D=this.$indexes.get(G);this.$items.delete(D),this.$indexes.delete(G)},D.prototype.toArray=function(){return Array.from(this.$items.values())},D.prototype.toJSON=function(){var G=[];return this.forEach((function(D,N){G.push("function"===typeof D.toJSON?D.toJSON():D)})),G},D.prototype.clone=function(G){var N;return G?N=Object.assign(new D,this):(N=new D,this.forEach((function(G){G.$changes?N.add(G.clone()):N.add(G)}))),N},D}(),BG=function(){function D(G){var D=this;this.$changes=new P(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,G&&G.forEach((function(G){return D.add(G)}))}return D.prototype.Of=function(D,N){return void 0===N&&(N=!0),r(this.$callbacks||(this.$callbacks=[]),G.OPERATION.ADD,D,N?this.$items:void 0)},D.prototype.ab=function(D){return r(this.$callbacks||(this.$callbacks=[]),G.OPERATION.DELETE,D)},D.prototype.onChange=function(D){return r(this.$callbacks||(this.$callbacks=[]),G.OPERATION.REPLACE,D)},D.is=function(G){return void 0!==G.set},D.prototype.add=function(D){var N,T;if(this.has(D))return!1;var o=this.$refId++;void 0!==D.$changes&&D.$changes.setParent(this,this.$changes.root,o);var Z=null!==(T=null===(N=this.$changes.indexes[o])||void 0===N?void 0:N.op)&&void 0!==T?T:G.OPERATION.ADD;return this.$changes.indexes[o]=o,this.$indexes.set(o,o),this.$items.set(o,D),this.$changes.change(o,Z),o},D.prototype.entries=function(){return this.$items.entries()},D.prototype.delete=function(G){for(var D,N,T=this.$items.entries();(N=T.next())&&!N.done;)if(G===N.value[1]){D=N.value[0];break}return void 0!==D&&(this.$changes.delete(D),this.$indexes.delete(D),this.$items.delete(D))},D.prototype.clear=function(D){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),D&&v.call(this,D),this.$items.clear(),this.$changes.operation({index:0,op:G.OPERATION.CLEAR}),this.$changes.touchParents()},D.prototype.has=function(G){for(var D,N=this.$items.values(),T=!1;(D=N.next())&&!D.done;)if(G===D.value){T=!0;break}return T},D.prototype.forEach=function(G){var D=this;this.$items.forEach((function(N,T,o){return G(N,T,D)}))},D.prototype.values=function(){return this.$items.values()},Object.defineProperty(D.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),D.prototype.setIndex=function(G,D){this.$indexes.set(G,D)},D.prototype.getIndex=function(G){return this.$indexes.get(G)},D.prototype.getByIndex=function(G){return this.$items.get(this.$indexes.get(G))},D.prototype.deleteByIndex=function(G){var D=this.$indexes.get(G);this.$items.delete(D),this.$indexes.delete(G)},D.prototype.toArray=function(){return Array.from(this.$items.values())},D.prototype.toJSON=function(){var G=[];return this.forEach((function(D,N){G.push("function"===typeof D.toJSON?D.toJSON():D)})),G},D.prototype.clone=function(G){var N;return G?N=Object.assign(new D,this):(N=new D,this.forEach((function(G){G.$changes?N.add(G.clone()):N.add(G)}))),N},D}(),FG=function(){function G(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return G.prototype.addRefId=function(G){this.refIds.has(G)||(this.refIds.add(G),this.containerIndexes.set(G,new Set))},G.get=function(D){return void 0===D.$filterState&&(D.$filterState=new G),D.$filterState},G}(),SG=function(){function G(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return G.prototype.getNextUniqueId=function(){return this.nextUniqueId++},G.prototype.addRef=function(G,D,N){void 0===N&&(N=!0),this.refs.set(G,D),N&&(this.refCounts[G]=(this.refCounts[G]||0)+1)},G.prototype.removeRef=function(G){this.refCounts[G]=this.refCounts[G]-1,this.deletedRefs.add(G)},G.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},G.prototype.garbageCollectDeletedRefs=function(){var G=this;this.deletedRefs.forEach((function(D){if(!(G.refCounts[D]>0)){var N=G.refs.get(D);if(N instanceof pG)for(var T in N._definition.schema)"string"!==typeof N._definition.schema[T]&&N[T]&&N[T].$changes&&G.removeRef(N[T].$changes.refId);else{var o=N.$changes.parent._definition,Z=o.schema[o.fieldsByIndex[N.$changes.parentIndex]];"function"===typeof Object.values(Z)[0]&&Array.from(N.values()).forEach((function(D){return G.removeRef(D.$changes.refId)}))}G.refs.delete(D),delete G.refCounts[D]}})),this.deletedRefs.clear()},G}(),VG=function(G){function D(){return null!==G&&G.apply(this,arguments)||this}return N(D,G),D}(Error);function UG(G,D,N,T){var o,Z=!1;switch(D){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":o="number",isNaN(G)&&console.log('trying to encode "NaN" in '.concat(N.constructor.name,"#").concat(T));break;case"string":o="string",Z=!0;break;case"boolean":return}if(typeof G!==o&&(!Z||Z&&null!==G)){var n="'".concat(JSON.stringify(G),"'").concat(G&&G.constructor&&" (".concat(G.constructor.name,")")||"");throw new VG("a '".concat(o,"' was expected, but ").concat(n," was provided in ").concat(N.constructor.name,"#").concat(T))}}function zG(G,D,N,T){if(!(G instanceof D))throw new VG("a '".concat(D.name,"' was expected, but '").concat(G.constructor.name,"' was provided in ").concat(N.constructor.name,"#").concat(T))}function iG(G,D,N,T,o){UG(N,G,T,o);var Z=M[G];if(!Z)throw new VG("a '".concat(G,"' was expected, but ").concat(N," was provided in ").concat(T.constructor.name,"#").concat(o));Z(D,N)}function JG(G,D,N){return LG[G](D,N)}var pG=function(){function D(){for(var G=[],D=0;D<arguments.length;D++)G[D]=arguments[D];Object.defineProperties(this,{$changes:{value:new P(this,void 0,new SG),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var N=this._definition.descriptors;N&&Object.defineProperties(this,N),G[0]&&this.assign(G[0])}return D.onError=function(G){console.error(G)},D.is=function(G){return G._definition&&void 0!==G._definition.schema},D.prototype.onChange=function(D){return r(this.$callbacks||(this.$callbacks=[]),G.OPERATION.REPLACE,D)},D.prototype.ab=function(D){return r(this.$callbacks||(this.$callbacks=[]),G.OPERATION.DELETE,D)},D.prototype.assign=function(G){return Object.assign(this,G),this},Object.defineProperty(D.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),D.prototype.setDirty=function(G,D){this.$changes.change(G,D)},D.prototype.listen=function(G,D,N){var T=this;return void 0===N&&(N=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[G]||(this.$callbacks[G]=[]),this.$callbacks[G].push(D),N&&void 0!==this[G]&&D(this[G],void 0),function(){return q(T.$callbacks[G],T.$callbacks[G].indexOf(D))}},D.prototype.decode=function(N,T,o){var Z;void 0===T&&(T={offset:0}),void 0===o&&(o=this);var C=[],P=this.$changes.root,r=N.length,v=0;for(P.refs.set(v,this);T.offset<r;){var q=N[T.offset++];if(q!=n){var g=o.$changes,X=void 0!==o._definition,j=X?q>>6<<6:q;if(j!==G.OPERATION.CLEAR){var y=X?q%(j||255):yG(N,T),h=X?o._definition.fieldsByIndex[y]:"",R=g.getType(y),L=void 0,w=void 0,B=void 0;if(X?w=o["_".concat(h)]:(w=o.getByIndex(y),(j&G.OPERATION.ADD)===G.OPERATION.ADD?(B=o instanceof Y?jG(N,T):y,o.setIndex(y,B)):B=o.getIndex(y)),(j&G.OPERATION.DELETE)===G.OPERATION.DELETE&&(j!==G.OPERATION.DELETE_AND_ADD&&o.deleteByIndex(y),w&&w.$changes&&P.removeRef(w.$changes.refId),L=null),void 0!==h){if(j===G.OPERATION.DELETE);else if(D.is(R)){var F=yG(N,T);if(L=P.refs.get(F),j!==G.OPERATION.REPLACE){var S=this.getSchemaType(N,T,R);L||((L=this.createTypeInstance(S)).$changes.refId=F,w&&(L.$callbacks=w.$callbacks,w.$changes.refId&&F!==w.$changes.refId&&P.removeRef(w.$changes.refId))),P.addRef(F,L,L!==w)}}else if("string"===typeof R)L=JG(R,N,T);else{var V=m(Object.keys(R)[0]),U=yG(N,T),z=P.refs.has(U)?w||P.refs.get(U):new V.constructor;if((L=z.clone(!0)).$changes.refId=U,w&&(L.$callbacks=w.$callbacks,w.$changes.refId&&U!==w.$changes.refId)){P.removeRef(w.$changes.refId);for(var i=w.entries(),J=void 0;(J=i.next())&&!J.done;){var p=(Z=J.value)[0],t=Z[1];C.push({refId:U,op:G.OPERATION.DELETE,field:p,value:void 0,previousValue:t})}}P.addRef(U,L,z!==w)}if(null!==L&&void 0!==L)if(L.$changes&&L.$changes.setParent(g.ref,g.root,y),o instanceof D)o[h]=L;else if(o instanceof Y)p=B,o.$items.set(p,L),o.$changes.allChanges.add(y);else if(o instanceof W)o.setAt(y,L);else if(o instanceof wG){var H=o.add(L);o.setIndex(y,H)}else o instanceof BG&&!1!==(H=o.add(L))&&o.setIndex(y,H);w!==L&&C.push({refId:v,op:j,field:h,dynamicIndex:B,value:L,previousValue:w})}else{console.warn("@colyseus/schema: definition mismatch");for(var s={offset:T.offset};T.offset<r&&(!RG(N,T)||(s.offset=T.offset+1,!P.refs.has(yG(N,s))));)T.offset++}}else o.clear(C)}else{v=yG(N,T);var c=P.refs.get(v);if(!c)throw new Error('"refId" not found: '.concat(v));o=c}}return this._triggerChanges(C),P.garbageCollectDeletedRefs(),C},D.prototype.encode=function(N,T,o){void 0===N&&(N=!1),void 0===T&&(T=[]),void 0===o&&(o=!1);for(var Z=this.$changes,C=new WeakSet,P=[Z],r=1,v=0;v<r;v++){var q=P[v],g=q.ref,X=g instanceof D;q.ensureRefId(),C.add(q),q!==Z&&(q.changed||N)&&(t(T,n),E(T,q.refId));for(var W=N?Array.from(q.allChanges):Array.from(q.changes.values()),j=0,y=W.length;j<y;j++){var h=N?{op:G.OPERATION.ADD,index:W[j]}:W[j],R=h.index,L=X?g._definition.fieldsByIndex&&g._definition.fieldsByIndex[R]:R,w=T.length;if(h.op!==G.OPERATION.TOUCH)if(X)t(T,R|h.op);else{if(t(T,h.op),h.op===G.OPERATION.CLEAR)continue;E(T,R)}if(X||(h.op&G.OPERATION.ADD)!=G.OPERATION.ADD||g instanceof Y&&a(T,q.ref.$indexes.get(R)),h.op!==G.OPERATION.DELETE){var B=q.getType(R),F=q.getValue(R);if(F&&F.$changes&&!C.has(F.$changes)&&(P.push(F.$changes),F.$changes.ensureRefId(),r++),h.op!==G.OPERATION.TOUCH){if(D.is(B))zG(F,B,g,L),E(T,F.$changes.refId),(h.op&G.OPERATION.ADD)===G.OPERATION.ADD&&this.tryEncodeTypeId(T,B,F.constructor);else if("string"===typeof B)iG(B,T,F,g,L);else{var S=m(Object.keys(B)[0]);zG(g["_".concat(L)],S.constructor,g,L),E(T,F.$changes.refId)}o&&q.cache(R,T.slice(w))}}}N||o||q.discard()}return T},D.prototype.encodeAll=function(G){return this.encode(!0,[],G)},D.prototype.applyFilters=function(N,T){var o,Z;void 0===T&&(T=!1);for(var C=this,P=new Set,r=FG.get(N),v=[this.$changes],q=1,g=[],X=function(X){var W=v[X];if(P.has(W.refId))return"continue";var j=W.ref,y=j instanceof D;t(g,n),E(g,W.refId);var h=r.refIds.has(W),m=T||!h;r.addRefId(W);var R=r.containerIndexes.get(W),L=m?Array.from(W.allChanges):Array.from(W.changes.values());!T&&y&&j._definition.indexesWithFilters&&j._definition.indexesWithFilters.forEach((function(D){!R.has(D)&&W.allChanges.has(D)&&(m?L.push(D):L.push({op:G.OPERATION.ADD,index:D}))}));for(var w=0,B=L.length;w<B;w++){var F=m?{op:G.OPERATION.ADD,index:L[w]}:L[w];if(F.op!==G.OPERATION.CLEAR){var S=F.index;if(F.op!==G.OPERATION.DELETE){var V=W.getValue(S),U=W.getType(S);if(y){if((z=j._definition.filters&&j._definition.filters[S])&&!z.call(j,N,V,C)){V&&V.$changes&&P.add(V.$changes.refId);continue}}else{var z,i=W.parent;if((z=W.getChildrenFilter())&&!z.call(i,N,j.$indexes.get(S),V,C)){V&&V.$changes&&P.add(V.$changes.refId);continue}}if(V.$changes&&(v.push(V.$changes),q++),F.op!==G.OPERATION.TOUCH)if(F.op===G.OPERATION.ADD||y)g.push.apply(g,null!==(o=W.caches[S])&&void 0!==o?o:[]),R.add(S);else if(R.has(S))g.push.apply(g,null!==(Z=W.caches[S])&&void 0!==Z?Z:[]);else{if(R.add(S),t(g,G.OPERATION.ADD),E(g,S),j instanceof Y){var J=W.ref.$indexes.get(S);a(g,J)}V.$changes?E(g,V.$changes.refId):M[U](g,V)}else V.$changes&&!y&&(t(g,G.OPERATION.ADD),E(g,S),j instanceof Y&&(J=W.ref.$indexes.get(S),a(g,J)),E(g,V.$changes.refId))}else y?t(g,F.op|S):(t(g,F.op),E(g,S))}else t(g,F.op)}},W=0;W<q;W++)X(W);return g},D.prototype.clone=function(){var G,D=new this.constructor,N=this._definition.schema;for(var T in N)"object"===typeof this[T]&&"function"===typeof(null===(G=this[T])||void 0===G?void 0:G.clone)?D[T]=this[T].clone():D[T]=this[T];return D},D.prototype.toJSON=function(){var G=this._definition.schema,D=this._definition.deprecated,N={};for(var T in G)D[T]||null===this[T]||"undefined"===typeof this[T]||(N[T]="function"===typeof this[T].toJSON?this[T].toJSON():this["_".concat(T)]);return N},D.prototype.discardAllChanges=function(){this.$changes.discardAll()},D.prototype.getByIndex=function(G){return this[this._definition.fieldsByIndex[G]]},D.prototype.deleteByIndex=function(G){this[this._definition.fieldsByIndex[G]]=void 0},D.prototype.tryEncodeTypeId=function(G,D,N){D._typeid!==N._typeid&&(t(G,C),E(G,N._typeid))},D.prototype.getSchemaType=function(G,D,N){var T;return G[D.offset]===C&&(D.offset++,T=this.constructor._context.get(yG(G,D))),T||N},D.prototype.createTypeInstance=function(G){var D=new G;return D.$changes.root=this.$changes.root,D},D.prototype._triggerChanges=function(N){for(var T,o,Z,n,C,P,r,v,q,g=new Set,X=this.$changes.root.refs,W=function(W){var j=N[W],Y=j.refId,y=X.get(Y),h=y.$callbacks;if((j.op&G.OPERATION.DELETE)===G.OPERATION.DELETE&&j.previousValue instanceof D&&(null===(o=null===(T=j.previousValue.$callbacks)||void 0===T?void 0:T[G.OPERATION.DELETE])||void 0===o||o.forEach((function(G){return G()}))),!h)return"continue";if(y instanceof D){if(!g.has(Y))try{null===(Z=null===h||void 0===h?void 0:h[G.OPERATION.REPLACE])||void 0===Z||Z.forEach((function(G){return G()}))}catch(m){D.onError(m)}try{h.hasOwnProperty(j.field)&&(null===(n=h[j.field])||void 0===n||n.forEach((function(G){return G(j.value,j.previousValue)})))}catch(m){D.onError(m)}}else j.op===G.OPERATION.ADD&&void 0===j.previousValue?null===(C=h[G.OPERATION.ADD])||void 0===C||C.forEach((function(G){var D;return G(j.value,null!==(D=j.dynamicIndex)&&void 0!==D?D:j.field)})):j.op===G.OPERATION.DELETE?void 0!==j.previousValue&&(null===(P=h[G.OPERATION.DELETE])||void 0===P||P.forEach((function(G){var D;return G(j.previousValue,null!==(D=j.dynamicIndex)&&void 0!==D?D:j.field)}))):j.op===G.OPERATION.DELETE_AND_ADD&&(void 0!==j.previousValue&&(null===(r=h[G.OPERATION.DELETE])||void 0===r||r.forEach((function(G){var D;return G(j.previousValue,null!==(D=j.dynamicIndex)&&void 0!==D?D:j.field)}))),null===(v=h[G.OPERATION.ADD])||void 0===v||v.forEach((function(G){var D;return G(j.value,null!==(D=j.dynamicIndex)&&void 0!==D?D:j.field)}))),j.value!==j.previousValue&&(null===(q=h[G.OPERATION.REPLACE])||void 0===q||q.forEach((function(G){var D;return G(j.value,null!==(D=j.dynamicIndex)&&void 0!==D?D:j.field)})));g.add(Y)},j=0;j<N.length;j++)W(j)},D._definition=R.create(),D}();function tG(G){for(var D=[G.$changes],N=1,T={},o=T,Z=function(G){var N=D[G];N.changes.forEach((function(G){var D=N.ref,T=G.index,Z=D._definition?D._definition.fieldsByIndex[T]:D.$indexes.get(T);o[Z]=N.getValue(T)}))},n=0;n<N;n++)Z(n);return T}var HG={context:new w},sG=function(G){function D(){return null!==G&&G.apply(this,arguments)||this}return N(D,G),T([F("string",HG)],D.prototype,"name",void 0),T([F("string",HG)],D.prototype,"type",void 0),T([F("number",HG)],D.prototype,"referencedType",void 0),D}(pG),cG=function(G){function D(){var D=null!==G&&G.apply(this,arguments)||this;return D.fields=new W,D}return N(D,G),T([F("number",HG)],D.prototype,"id",void 0),T([F([sG],HG)],D.prototype,"fields",void 0),D}(pG),KG=function(G){function D(){var D=null!==G&&G.apply(this,arguments)||this;return D.types=new W,D}return N(D,G),D.encode=function(G){var N=G.constructor,T=new D;T.rootType=N._typeid;var o=function(G,D){for(var N in D){var o=new sG;o.name=N;var Z=void 0;if("string"===typeof D[N])Z=D[N];else{var n=D[N],C=void 0;pG.is(n)?(Z="ref",C=D[N]):"string"===typeof n[Z=Object.keys(n)[0]]?Z+=":"+n[Z]:C=n[Z],o.referencedType=C?C._typeid:-1}o.type=Z,G.fields.push(o)}T.types.push(G)},Z=N._context.types;for(var n in Z){var C=new cG;C.id=Number(n),o(C,Z[n]._definition.schema)}return T.encodeAll()},D.decode=function(G,T){var o=new w,Z=new D;Z.decode(G,T);var n=Z.types.reduce((function(G,D){var T=function(G){function D(){return null!==G&&G.apply(this,arguments)||this}return N(D,G),D}(pG),Z=D.id;return G[Z]=T,o.add(T,Z),G}),{});Z.types.forEach((function(G){var D=n[G.id];G.fields.forEach((function(G){var N;if(void 0!==G.referencedType){var T=G.type,Z=n[G.referencedType];if(!Z){var C=G.type.split(":");T=C[0],Z=C[1]}"ref"===T?F(Z,{context:o})(D.prototype,G.name):F(((N={})[T]=Z,N),{context:o})(D.prototype,G.name)}else F(G.type,{context:o})(D.prototype,G.name)}))}));var C=n[Z.rootType],P=new C;for(var r in C._definition.schema){var v=C._definition.schema[r];"string"!==typeof v&&(P[r]="function"===typeof v?new v:new(m(Object.keys(v)[0]).constructor))}return P},T([F([cG],HG)],D.prototype,"types",void 0),T([F("number",HG)],D.prototype,"rootType",void 0),D}(pG);h("map",{constructor:Y}),h("array",{constructor:W}),h("set",{constructor:BG}),h("collection",{constructor:wG}),G.ArraySchema=W,G.CollectionSchema=wG,G.Context=w,G.MapSchema=Y,G.Reflection=KG,G.ReflectionField=sG,G.ReflectionType=cG,G.Schema=pG,G.SchemaDefinition=R,G.SetSchema=BG,G.decode=LG,G.defineTypes=z,G.deprecated=U,G.dumpChanges=tG,G.encode=M,G.filter=S,G.filterChildren=V,G.hasFilter=L,G.registerType=h,G.type=F,Object.defineProperty(G,"__esModule",{value:!0})}(D)},11890:G=>{G.exports=function(G){return null!=G&&null!=G.constructor&&"function"===typeof G.constructor.isBuffer&&G.constructor.isBuffer(G)}},11871:(G,D,N)=>{"use strict";var T=N(11879),o=N(11882),Z=N(11890);N.g.__TYPEDARRAY_POOL||(N.g.__TYPEDARRAY_POOL={UINT8:o([32,0]),UINT16:o([32,0]),UINT32:o([32,0]),INT8:o([32,0]),INT16:o([32,0]),INT32:o([32,0]),FLOAT:o([32,0]),DOUBLE:o([32,0]),DATA:o([32,0]),UINT8C:o([32,0]),BUFFER:o([32,0])});var n="undefined"!==typeof Uint8ClampedArray,C=N.g.__TYPEDARRAY_POOL;C.UINT8C||(C.UINT8C=o([32,0])),C.BUFFER||(C.BUFFER=o([32,0]));var P=C.DATA,r=C.BUFFER;function v(G){if(G){var D=G.length||G.byteLength,N=T.log2(D);P[N].push(G)}}function q(G){G=T.nextPow2(G);var D=T.log2(G),N=P[D];return N.length>0?N.pop():new ArrayBuffer(G)}function g(G){return new Uint8Array(q(G),0,G)}function X(G){return new Uint16Array(q(2*G),0,G)}function W(G){return new Uint32Array(q(4*G),0,G)}function j(G){return new Int8Array(q(G),0,G)}function Y(G){return new Int16Array(q(2*G),0,G)}function y(G){return new Int32Array(q(4*G),0,G)}function h(G){return new Float32Array(q(4*G),0,G)}function m(G){return new Float64Array(q(8*G),0,G)}function R(G){return n?new Uint8ClampedArray(q(G),0,G):g(G)}function L(G){return new DataView(q(G),0,G)}D.free=function(G){if(Z(G))r[T.log2(G.length)].push(G);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(G)&&(G=G.buffer),!G)return;var D=G.length||G.byteLength,N=0|T.log2(D);P[N].push(G)}},D.freeUint8=D.freeUint16=D.freeUint32=D.freeInt8=D.freeInt16=D.freeInt32=D.freeFloat32=D.freeFloat=D.freeFloat64=D.freeDouble=D.freeUint8Clamped=D.freeDataView=function(G){v(G.buffer)},D.freeArrayBuffer=v,D.freeBuffer=function(G){r[T.log2(G.length)].push(G)},D.malloc=function(G,D){if(void 0===D||"arraybuffer"===D)return q(G);switch(D){case"uint8":return g(G);case"uint16":return X(G);case"uint32":return W(G);case"int8":return j(G);case"int16":return Y(G);case"int32":return y(G);case"float":case"float32":return h(G);case"double":case"float64":return m(G);case"uint8_clamped":return R(G);case"buffer":throw"Buffer not supported";case"data":case"dataview":return L(G);default:return null}return null},D.mallocArrayBuffer=q,D.mallocUint8=g,D.mallocUint16=X,D.mallocUint32=W,D.mallocInt8=j,D.mallocInt16=Y,D.mallocInt32=y,D.mallocFloat32=D.mallocFloat=h,D.mallocFloat64=D.mallocDouble=m,D.mallocUint8Clamped=R,D.mallocDataView=L,D.clearCache=function(){for(var G=0;G<32;++G)C.UINT8[G].length=0,C.UINT16[G].length=0,C.UINT32[G].length=0,C.INT8[G].length=0,C.INT16[G].length=0,C.INT32[G].length=0,C.FLOAT[G].length=0,C.DOUBLE[G].length=0,C.UINT8C[G].length=0,P[G].length=0,r[G].length=0}},11963:(G,D,N)=>{G.exports=o;var T=N(125);function o(G,D){if(!(this instanceof o))return new o(G,D);var N=T.create();T.add(N,G,D),this.Yc=T.min(T.create(),G,N),this.Hh=T.clone(D),this.max=T.max(T.create(),G,N),this.mag=T.length(this.Hh)}var Z=o.prototype;Z.width=function(){return this.Hh[0]},Z.height=function(){return this.Hh[1]},Z.depth=function(){return this.Hh[2]},Z.x0=function(){return this.Yc[0]},Z.y0=function(){return this.Yc[1]},Z.z0=function(){return this.Yc[2]},Z.x1=function(){return this.max[0]},Z.y1=function(){return this.max[1]},Z.z1=function(){return this.max[2]},Z.translate=function(G){return T.add(this.max,this.max,G),T.add(this.Yc,this.Yc,G),this},Z.setPosition=function(G){return T.add(this.max,G,this.Hh),T.j(this.Yc,G),this},Z.expand=function(G){var D=T.create(),N=T.create();return T.max(D,G.max,this.max),T.min(N,G.Yc,this.Yc),T.Jc(D,D,N),new o(N,D)},Z.intersects=function(G){return!(G.Yc[0]>this.max[0])&&(!(G.Yc[1]>this.max[1])&&(!(G.Yc[2]>this.max[2])&&(!(G.max[0]<this.Yc[0])&&(!(G.max[1]<this.Yc[1])&&!(G.max[2]<this.Yc[2])))))},Z.touches=function(G){var D=this.union(G);return null!==D&&(0==D.width()||0==D.height()||0==D.depth())},Z.union=function(G){if(!this.intersects(G))return null;var D=Math.max(G.Yc[0],this.Yc[0]),N=Math.max(G.Yc[1],this.Yc[1]),T=Math.max(G.Yc[2],this.Yc[2]);return new o([D,N,T],[Math.min(G.max[0],this.max[0])-D,Math.min(G.max[1],this.max[1])-N,Math.min(G.max[2],this.max[2])-T])}},11879:(G,D)=>{"use strict";function N(G){var D=32;return(G&=-G)&&D--,65535&G&&(D-=16),16711935&G&&(D-=8),252645135&G&&(D-=4),858993459&G&&(D-=2),1431655765&G&&(D-=1),D}D.INT_BITS=32,D.INT_MAX=2147483647,D.INT_MIN=-1<<31,D.sign=function(G){return(G>0)-(G<0)},D.abs=function(G){var D=G>>31;return(G^D)-D},D.min=function(G,D){return D^(G^D)&-(G<D)},D.max=function(G,D){return G^(G^D)&-(G<D)},D.isPow2=function(G){return!(G&G-1)&&!!G},D.log2=function(G){var D,N;return D=(G>65535)<<4,D|=N=((G>>>=D)>255)<<3,D|=N=((G>>>=N)>15)<<2,(D|=N=((G>>>=N)>3)<<1)|(G>>>=N)>>1},D.log10=function(G){return G>=1e9?9:G>=1e8?8:G>=1e7?7:G>=1e6?6:G>=1e5?5:G>=1e4?4:G>=1e3?3:G>=100?2:G>=10?1:0},D.popCount=function(G){return 16843009*((G=(858993459&(G-=G>>>1&1431655765))+(G>>>2&858993459))+(G>>>4)&252645135)>>>24},D.countTrailingZeros=N,D.nextPow2=function(G){return G+=0===G,--G,G|=G>>>1,G|=G>>>2,G|=G>>>4,G|=G>>>8,(G|=G>>>16)+1},D.prevPow2=function(G){return G|=G>>>1,G|=G>>>2,G|=G>>>4,G|=G>>>8,(G|=G>>>16)-(G>>>1)},D.parity=function(G){return G^=G>>>16,G^=G>>>8,G^=G>>>4,27030>>>(G&=15)&1};var T=new Array(256);!function(G){for(var D=0;D<256;++D){var N=D,T=D,o=7;for(N>>>=1;N;N>>>=1)T<<=1,T|=1&N,--o;G[D]=T<<o&255}}(T),D.reverse=function(G){return T[255&G]<<24|T[G>>>8&255]<<16|T[G>>>16&255]<<8|T[G>>>24&255]},D.interleave2=function(G,D){return(G=1431655765&((G=858993459&((G=252645135&((G=16711935&((G&=65535)|G<<8))|G<<4))|G<<2))|G<<1))|(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D&=65535)|D<<8))|D<<4))|D<<2))|D<<1))<<1},D.deinterleave2=function(G,D){return(G=65535&((G=16711935&((G=252645135&((G=858993459&((G=G>>>D&1431655765)|G>>>1))|G>>>2))|G>>>4))|G>>>16))<<16>>16},D.interleave3=function(G,D,N){return G=1227133513&((G=3272356035&((G=251719695&((G=4278190335&((G&=1023)|G<<16))|G<<8))|G<<4))|G<<2),(G|=(D=1227133513&((D=3272356035&((D=251719695&((D=4278190335&((D&=1023)|D<<16))|D<<8))|D<<4))|D<<2))<<1)|(N=1227133513&((N=3272356035&((N=251719695&((N=4278190335&((N&=1023)|N<<16))|N<<8))|N<<4))|N<<2))<<2},D.deinterleave3=function(G,D){return(G=1023&((G=4278190335&((G=251719695&((G=3272356035&((G=G>>>D&1227133513)|G>>>2))|G>>>4))|G>>>8))|G>>>16))<<22>>22},D.nextCombination=function(G){var D=G|G-1;return D+1|(~D&-~D)-1>>>N(G)+1}},11864:(G,D,N)=>{"use strict";G.exports=function(G,D,N){switch(arguments.length){case 1:return T=[],r(o=G,o,v,!0),T;case 2:return"function"===typeof D?r(G,G,D,!0):function(G,D){return T=[],r(G,D,v,!1),T}(G,D);case 3:return r(G,D,N,!1);default:throw new Error("box-intersect: Invalid arguments")}var o};var T,o=N(11871),Z=N(11896),n=N(11906);function C(G,D){for(var N=0;N<G;++N)if(!(D[N]<=D[N+G]))return!0;return!1}function P(G,D,N,T){for(var o=0,Z=0,n=0,P=G.length;n<P;++n){var r=G[n];if(!C(D,r)){for(var v=0;v<2*D;++v)N[o++]=r[v];T[Z++]=n}}return Z}function r(G,D,N,T){var C=G.length,r=D.length;if(!(C<=0||r<=0)){var v=G[0].length>>>1;if(!(v<=0)){var q,g=o.mallocDouble(2*v*C),X=o.mallocInt32(C);if((C=P(G,v,g,X))>0){if(1===v&&T)Z.init(C),q=Z.sweepComplete(v,N,0,C,g,X,0,C,g,X);else{var W=o.mallocDouble(2*v*r),j=o.mallocInt32(r);(r=P(D,v,W,j))>0&&(Z.init(C+r),q=1===v?Z.sweepBipartite(v,N,0,C,g,X,0,r,W,j):n(v,N,T,C,g,X,r,W,j),o.free(W),o.free(j))}o.free(g),o.free(X)}return q}}}function v(G,D){T.push([G,D])}},11911:(G,D)=>{"use strict";var N="d",T="ax",o="fp",Z="es",n="rs",C="re",P="rb",r="bs",v="be",q="bb",g=[N,T,"vv",n,C,P,"ri",r,v,q,"bi"];function X(G){var D="bruteForce"+(G?"Full":"Partial"),T=[],n=g.slice();G||n.splice(3,0,o);var C=["function "+D+"("+n.join()+"){"];function P(D,o){var n=function(G,D,T){var o="bruteForce"+(G?"Red":"Blue")+(D?"Flip":"")+(T?"Full":""),n=["function ",o,"(",g.join(),"){","var ",Z,"=2*",N,";"],C="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",P="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(T?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return G?n.push(C,"Q",":",P):n.push(P,"Q",":",C),T?n.push("if(y1<x0||x1<y0)continue;"):D?n.push("if(y0<=x0||x1<y0)continue;"):n.push("if(y0<x0||x1<y0)continue;"),n.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),D?n.push("yi,xi"):n.push("xi,yi"),n.push(");if(rv!==void 0)return rv;}}}"),{name:o,code:n.join("")}}(D,o,G);T.push(n.code),C.push("return "+n.name+"("+g.join()+");")}C.push("if(re-rs>be-bs){"),G?(P(!0,!1),C.push("}else{"),P(!1,!1)):(C.push("if(fp){"),P(!0,!0),C.push("}else{"),P(!0,!1),C.push("}}else{if(fp){"),P(!1,!0),C.push("}else{"),P(!1,!1),C.push("}")),C.push("}}return "+D);var r=T.join("")+C.join("");return new Function(r)()}D.partial=X(!1),D.full=X(!0)},11906:(G,D,N)=>{"use strict";G.exports=function(G,D,N,Z,v,U,z,i,J){!function(G,D){var N=8*o.log2(D+1)*(G+1)|0,Z=o.nextPow2(R*N);w.length<Z&&(T.free(w),w=T.mallocInt32(Z));var n=o.nextPow2(L*N);B.length<n&&(T.free(B),B=T.mallocDouble(n))}(G,Z+z);var p,t=0,H=2*G;F(t++,0,0,Z,0,z,N?16:0,-1/0,1/0),N||F(t++,0,0,z,0,Z,1,-1/0,1/0);for(;t>0;){var s=(t-=1)*R,c=w[s],K=w[s+1],b=w[s+2],O=w[s+3],Q=w[s+4],A=w[s+5],I=t*L,d=B[I],u=B[I+1],l=1&A,x=!!(16&A),k=v,a=U,E=i,M=J;if(l&&(k=i,a=J,E=v,M=U),!(2&A&&K>=(b=Y(G,c,K,b,k,a,u)))&&!(4&A&&(K=y(G,c,K,b,k,a,d))>=b)){var e=b-K,f=Q-O;if(x){if(G*e*(e+f)<X){if(void 0!==(p=P.scanComplete(G,c,D,K,b,k,a,O,Q,E,M)))return p;continue}}else{if(G*Math.min(e,f)<q){if(void 0!==(p=n(G,c,D,l,K,b,k,a,O,Q,E,M)))return p;continue}if(G*e*f<g){if(void 0!==(p=P.scanBipartite(G,c,D,l,K,b,k,a,O,Q,E,M)))return p;continue}}var GG=W(G,c,K,b,k,a,d,u);if(K<GG)if(G*(GG-K)<q){if(void 0!==(p=C(G,c+1,D,K,GG,k,a,O,Q,E,M)))return p}else if(c===G-2){if(void 0!==(p=l?P.sweepBipartite(G,D,O,Q,E,M,K,GG,k,a):P.sweepBipartite(G,D,K,GG,k,a,O,Q,E,M)))return p}else F(t++,c+1,K,GG,O,Q,l,-1/0,1/0),F(t++,c+1,O,Q,K,GG,1^l,-1/0,1/0);if(GG<b){var DG=r(G,c,O,Q,E,M),NG=E[H*DG+c],TG=j(G,c,DG,Q,E,M,NG);if(TG<Q&&F(t++,c,GG,b,TG,Q,(4|l)+(x?16:0),NG,u),O<DG&&F(t++,c,GG,b,O,DG,(2|l)+(x?16:0),d,NG),DG+1===TG){if(void 0!==(p=x?V(G,c,D,GG,b,k,a,DG,E,M[DG]):S(G,c,D,l,GG,b,k,a,DG,E,M[DG])))return p}else if(DG<TG){var oG;if(x){if(GG<(oG=h(G,c,GG,b,k,a,NG))){var ZG=j(G,c,GG,oG,k,a,NG);if(c===G-2){if(GG<ZG&&void 0!==(p=P.sweepComplete(G,D,GG,ZG,k,a,DG,TG,E,M)))return p;if(ZG<oG&&void 0!==(p=P.sweepBipartite(G,D,ZG,oG,k,a,DG,TG,E,M)))return p}else GG<ZG&&F(t++,c+1,GG,ZG,DG,TG,16,-1/0,1/0),ZG<oG&&(F(t++,c+1,ZG,oG,DG,TG,0,-1/0,1/0),F(t++,c+1,DG,TG,ZG,oG,1,-1/0,1/0))}}else GG<(oG=l?m(G,c,GG,b,k,a,NG):h(G,c,GG,b,k,a,NG))&&(c===G-2?p=l?P.sweepBipartite(G,D,DG,TG,E,M,GG,oG,k,a):P.sweepBipartite(G,D,GG,oG,k,a,DG,TG,E,M):(F(t++,c+1,GG,oG,DG,TG,l,-1/0,1/0),F(t++,c+1,DG,TG,GG,oG,1^l,-1/0,1/0)))}}}}};var T=N(11871),o=N(11879),Z=N(11911),n=Z.partial,C=Z.full,P=N(11896),r=N(11914),v=N(11923),q=128,g=1<<22,X=1<<22,W=v("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),j=v("lo===p0",["p0"]),Y=v("lo<p0",["p0"]),y=v("hi<=p0",["p0"]),h=v("lo<=p0&&p0<=hi",["p0"]),m=v("lo<p0&&p0<=hi",["p0"]),R=6,L=2,w=T.mallocInt32(1024),B=T.mallocDouble(1024);function F(G,D,N,T,o,Z,n,C,P){var r=R*G;w[r]=D,w[r+1]=N,w[r+2]=T,w[r+3]=o,w[r+4]=Z,w[r+5]=n;var v=L*G;B[v]=C,B[v+1]=P}function S(G,D,N,T,o,Z,n,C,P,r,v){var q=2*G,g=P*q,X=r[g+D];G:for(var W=o,j=o*q;W<Z;++W,j+=q){var Y=n[j+D],y=n[j+D+G];if(!(X<Y||y<X)&&(!T||X!==Y)){for(var h,m=C[W],R=D+1;R<G;++R){Y=n[j+R],y=n[j+R+G];var L=r[g+R],w=r[g+R+G];if(y<L||w<Y)continue G}if(void 0!==(h=T?N(v,m):N(m,v)))return h}}}function V(G,D,N,T,o,Z,n,C,P,r){var v=2*G,q=C*v,g=P[q+D];G:for(var X=T,W=T*v;X<o;++X,W+=v){var j=n[X];if(j!==r){var Y=Z[W+D],y=Z[W+D+G];if(!(g<Y||y<g)){for(var h=D+1;h<G;++h){Y=Z[W+h],y=Z[W+h+G];var m=P[q+h],R=P[q+h+G];if(y<m||R<Y)continue G}var L=N(j,r);if(void 0!==L)return L}}}}},11914:(G,D,N)=>{"use strict";G.exports=function(G,D,N,n,C,P){if(n<=N+1)return N;var r=N,v=n,q=n+N>>>1,g=2*G,X=q,W=C[g*q+D];for(;r<v;){if(v-r<o){Z(G,D,r,v,C,P),W=C[g*q+D];break}var j=v-r,Y=Math.random()*j+r|0,y=C[g*Y+D],h=Math.random()*j+r|0,m=C[g*h+D],R=Math.random()*j+r|0,L=C[g*R+D];y<=m?L>=m?(X=h,W=m):y>=L?(X=Y,W=y):(X=R,W=L):m>=L?(X=h,W=m):L>=y?(X=Y,W=y):(X=R,W=L);for(var w=g*(v-1),B=g*X,F=0;F<g;++F,++w,++B){var S=C[w];C[w]=C[B],C[B]=S}var V=P[v-1];P[v-1]=P[X],P[X]=V;for(w=g*(v-1),B=g*(X=T(G,D,r,v-1,C,P,W)),F=0;F<g;++F,++w,++B){S=C[w];C[w]=C[B],C[B]=S}V=P[v-1];if(P[v-1]=P[X],P[X]=V,q<X){for(v=X-1;r<v&&C[g*(v-1)+D]===W;)v-=1;v+=1}else{if(!(X<q))break;for(r=X+1;r<v&&C[g*r+D]===W;)r+=1}}return T(G,D,N,q,C,P,C[g*q+D])};var T=N(11923)("lo<p0",["p0"]),o=8;function Z(G,D,N,T,o,Z){for(var n=2*G,C=n*(N+1)+D,P=N+1;P<T;++P,C+=n)for(var r=o[C],v=P,q=n*(P-1);v>N&&o[q+D]>r;--v,q-=n){for(var g=q,X=q+n,W=0;W<n;++W,++g,++X){var j=o[g];o[g]=o[X],o[X]=j}var Y=Z[v];Z[v]=Z[v-1],Z[v-1]=Y}}},11923:G=>{"use strict";G.exports=function(G,N){var T="abcdef".split("").concat(N),o=[];G.indexOf("lo")>=0&&o.push("lo=e[k+n]");G.indexOf("hi")>=0&&o.push("hi=e[k+o]");return T.push(D.replace("_",o.join()).replace("$",G)),Function.apply(void 0,T)};var D="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},11901:G=>{"use strict";G.exports=function(G,T){T<=4*D?N(0,T-1,G):r(0,T-1,G)};var D=32;function N(G,D,N){for(var T=2*(G+1),o=G+1;o<=D;++o){for(var Z=N[T++],n=N[T++],C=o,P=T-2;C-- >G;){var r=N[P-2],v=N[P-1];if(r<Z)break;if(r===Z&&v<n)break;N[P]=r,N[P+1]=v,P-=2}N[P]=Z,N[P+1]=n}}function T(G,D,N){D*=2;var T=N[G*=2],o=N[G+1];N[G]=N[D],N[G+1]=N[D+1],N[D]=T,N[D+1]=o}function o(G,D,N){D*=2,N[G*=2]=N[D],N[G+1]=N[D+1]}function Z(G,D,N,T){D*=2,N*=2;var o=T[G*=2],Z=T[G+1];T[G]=T[D],T[G+1]=T[D+1],T[D]=T[N],T[D+1]=T[N+1],T[N]=o,T[N+1]=Z}function n(G,D,N,T,o){D*=2,o[G*=2]=o[D],o[D]=N,o[G+1]=o[D+1],o[D+1]=T}function C(G,D,N){D*=2;var T=N[G*=2],o=N[D];return!(T<o)&&(T!==o||N[G+1]>N[D+1])}function P(G,D,N,T){var o=T[G*=2];return o<D||o===D&&T[G+1]<N}function r(G,v,q){var g=(v-G+1)/6|0,X=G+g,W=v-g,j=G+v>>1,Y=j-g,y=j+g,h=X,m=Y,R=j,L=y,w=W,B=G+1,F=v-1,S=0;C(h,m,q)&&(S=h,h=m,m=S),C(L,w,q)&&(S=L,L=w,w=S),C(h,R,q)&&(S=h,h=R,R=S),C(m,R,q)&&(S=m,m=R,R=S),C(h,L,q)&&(S=h,h=L,L=S),C(R,L,q)&&(S=R,R=L,L=S),C(m,w,q)&&(S=m,m=w,w=S),C(m,R,q)&&(S=m,m=R,R=S),C(L,w,q)&&(S=L,L=w,w=S);for(var V=q[2*m],U=q[2*m+1],z=q[2*L],i=q[2*L+1],J=2*h,p=2*R,t=2*w,H=2*X,s=2*j,c=2*W,K=0;K<2;++K){var b=q[J+K],O=q[p+K],Q=q[t+K];q[H+K]=b,q[s+K]=O,q[c+K]=Q}o(Y,G,q),o(y,v,q);for(var A=B;A<=F;++A)if(P(A,V,U,q))A!==B&&T(A,B,q),++B;else if(!P(A,z,i,q))for(;;){if(P(F,z,i,q)){P(F,V,U,q)?(Z(A,B,F,q),++B,--F):(T(A,F,q),--F);break}if(--F<A)break}n(G,B-1,V,U,q),n(v,F+1,z,i,q),B-2-G<=D?N(G,B-2,q):r(G,B-2,q),v-(F+2)<=D?N(F+2,v,q):r(F+2,v,q),F-B<=D?N(B,F,q):r(B,F,q)}},11896:(G,D,N)=>{"use strict";G.exports={init:function(G){var D=o.nextPow2(G);P.length<D&&(T.free(P),P=T.mallocInt32(D));r.length<D&&(T.free(r),r=T.mallocInt32(D));v.length<D&&(T.free(v),v=T.mallocInt32(D));q.length<D&&(T.free(q),q=T.mallocInt32(D));g.length<D&&(T.free(g),g=T.mallocInt32(D));X.length<D&&(T.free(X),X=T.mallocInt32(D));var N=8*D;W.length<N&&(T.free(W),W=T.mallocDouble(N))},sweepBipartite:function(G,D,N,T,o,C,g,X,y,h){for(var m=0,R=2*G,L=G-1,w=R-1,B=N;B<T;++B){var F=C[B],S=R*B;W[m++]=o[S+L],W[m++]=-(F+1),W[m++]=o[S+w],W[m++]=F}for(B=g;B<X;++B){F=h[B]+n;var V=R*B;W[m++]=y[V+L],W[m++]=-F,W[m++]=y[V+w],W[m++]=F}var U=m>>>1;Z(W,U);var z=0,i=0;for(B=0;B<U;++B){var J=0|W[2*B+1];if(J>=n)j(v,q,i--,J=J-n|0);else if(J>=0)j(P,r,z--,J);else if(J<=-n){J=-J-n|0;for(var p=0;p<z;++p){if(void 0!==(t=D(P[p],J)))return t}Y(v,q,i++,J)}else{J=-J-1|0;for(p=0;p<i;++p){var t;if(void 0!==(t=D(J,v[p])))return t}Y(P,r,z++,J)}}},sweepComplete:function(G,D,N,T,o,n,C,y,h,m){for(var R=0,L=2*G,w=G-1,B=L-1,F=N;F<T;++F){var S=n[F]+1<<1,V=L*F;W[R++]=o[V+w],W[R++]=-S,W[R++]=o[V+B],W[R++]=S}for(F=C;F<y;++F){S=m[F]+1<<1;var U=L*F;W[R++]=h[U+w],W[R++]=1|-S,W[R++]=h[U+B],W[R++]=1|S}var z=R>>>1;Z(W,z);var i=0,J=0,p=0;for(F=0;F<z;++F){var t=0|W[2*F+1],H=1&t;if(F<z-1&&t>>1===W[2*F+3]>>1&&(H=2,F+=1),t<0){for(var s=-(t>>1)-1,c=0;c<p;++c){if(void 0!==(K=D(g[c],s)))return K}if(0!==H)for(c=0;c<i;++c){if(void 0!==(K=D(P[c],s)))return K}if(1!==H)for(c=0;c<J;++c){var K;if(void 0!==(K=D(v[c],s)))return K}0===H?Y(P,r,i++,s):1===H?Y(v,q,J++,s):2===H&&Y(g,X,p++,s)}else{s=(t>>1)-1;0===H?j(P,r,i--,s):1===H?j(v,q,J--,s):2===H&&j(g,X,p--,s)}}},scanBipartite:function(G,D,N,T,o,C,v,q,g,X,y,h){var m=0,R=2*G,L=D,w=D+G,B=1,F=1;T?F=n:B=n;for(var S=o;S<C;++S){var V=S+B,U=R*S;W[m++]=v[U+L],W[m++]=-V,W[m++]=v[U+w],W[m++]=V}for(S=g;S<X;++S){V=S+F;var z=R*S;W[m++]=y[z+L],W[m++]=-V}var i=m>>>1;Z(W,i);var J=0;for(S=0;S<i;++S){var p=0|W[2*S+1];if(p<0){var t=!1;if((V=-p)>=n?(t=!T,V-=n):(t=!!T,V-=1),t)Y(P,r,J++,V);else{var H=h[V],s=R*V,c=y[s+D+1],K=y[s+D+1+G];G:for(var b=0;b<J;++b){var O=P[b],Q=R*O;if(!(K<v[Q+D+1]||v[Q+D+1+G]<c)){for(var A=D+2;A<G;++A)if(y[s+A+G]<v[Q+A]||v[Q+A+G]<y[s+A])continue G;var I,d=q[O];if(void 0!==(I=T?N(H,d):N(d,H)))return I}}}}else j(P,r,J--,p-B)}},scanComplete:function(G,D,N,T,o,C,r,v,q,g,X){for(var j=0,Y=2*G,y=D,h=D+G,m=T;m<o;++m){var R=m+n,L=Y*m;W[j++]=C[L+y],W[j++]=-R,W[j++]=C[L+h],W[j++]=R}for(m=v;m<q;++m){R=m+1;var w=Y*m;W[j++]=g[w+y],W[j++]=-R}var B=j>>>1;Z(W,B);var F=0;for(m=0;m<B;++m){var S=0|W[2*m+1];if(S<0){if((R=-S)>=n)P[F++]=R-n;else{var V=X[R-=1],U=Y*R,z=g[U+D+1],i=g[U+D+1+G];G:for(var J=0;J<F;++J){var p=P[J],t=r[p];if(t===V)break;var H=Y*p;if(!(i<C[H+D+1]||C[H+D+1+G]<z)){for(var s=D+2;s<G;++s)if(g[U+s+G]<C[H+s]||C[H+s+G]<g[U+s])continue G;var c=N(t,V);if(void 0!==c)return c}}}}else{for(R=S-n,J=F-1;J>=0;--J)if(P[J]===R){for(s=J+1;s<F;++s)P[s-1]=P[s];break}--F}}}};var T=N(11871),o=N(11879),Z=N(11901),n=1<<28,C=1024,P=T.mallocInt32(C),r=T.mallocInt32(C),v=T.mallocInt32(C),q=T.mallocInt32(C),g=T.mallocInt32(C),X=T.mallocInt32(C),W=T.mallocDouble(8192);function j(G,D,N,T){var o=D[T],Z=G[N-1];G[o]=Z,D[Z]=o}function Y(G,D,N,T){G[N]=T,D[T]=N}},12008:G=>{"use strict";G.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12e3:(G,D,N)=>{var T=N(12008),o=N(12011),Z=Object.hasOwnProperty,n=Object.create(null);for(var C in T)Z.call(T,C)&&(n[T[C]]=C);var P=G.exports={to:{},get:{}};function r(G,D,N){return Math.min(Math.max(D,G),N)}function v(G){var D=Math.round(G).toString(16).toUpperCase();return D.length<2?"0"+D:D}P.get=function(G){var D,N;switch(G.substring(0,3).toLowerCase()){case"hsl":D=P.get.hsl(G),N="hsl";break;case"hwb":D=P.get.hwb(G),N="hwb";break;default:D=P.get.rgb(G),N="rgb"}return D?{model:N,value:D}:null},P.get.rgb=function(G){if(!G)return null;var D,N,o,n=[0,0,0,1];if(D=G.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(o=D[2],D=D[1],N=0;N<3;N++){var C=2*N;n[N]=parseInt(D.slice(C,C+2),16)}o&&(n[3]=parseInt(o,16)/255)}else if(D=G.match(/^#([a-f0-9]{3,4})$/i)){for(o=(D=D[1])[3],N=0;N<3;N++)n[N]=parseInt(D[N]+D[N],16);o&&(n[3]=parseInt(o+o,16)/255)}else if(D=G.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(N=0;N<3;N++)n[N]=parseInt(D[N+1],0);D[4]&&(D[5]?n[3]=.01*parseFloat(D[4]):n[3]=parseFloat(D[4]))}else{if(!(D=G.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(D=G.match(/^(\w+)$/))?"transparent"===D[1]?[0,0,0,0]:Z.call(T,D[1])?((n=T[D[1]])[3]=1,n):null:null;for(N=0;N<3;N++)n[N]=Math.round(2.55*parseFloat(D[N+1]));D[4]&&(D[5]?n[3]=.01*parseFloat(D[4]):n[3]=parseFloat(D[4]))}for(N=0;N<3;N++)n[N]=r(n[N],0,255);return n[3]=r(n[3],0,1),n},P.get.hsl=function(G){if(!G)return null;var D=G.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(D){var N=parseFloat(D[4]);return[(parseFloat(D[1])%360+360)%360,r(parseFloat(D[2]),0,100),r(parseFloat(D[3]),0,100),r(isNaN(N)?1:N,0,1)]}return null},P.get.hwb=function(G){if(!G)return null;var D=G.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(D){var N=parseFloat(D[4]);return[(parseFloat(D[1])%360+360)%360,r(parseFloat(D[2]),0,100),r(parseFloat(D[3]),0,100),r(isNaN(N)?1:N,0,1)]}return null},P.to.hex=function(){var G=o(arguments);return"#"+v(G[0])+v(G[1])+v(G[2])+(G[3]<1?v(Math.round(255*G[3])):"")},P.to.rgb=function(){var G=o(arguments);return G.length<4||1===G[3]?"rgb("+Math.round(G[0])+", "+Math.round(G[1])+", "+Math.round(G[2])+")":"rgba("+Math.round(G[0])+", "+Math.round(G[1])+", "+Math.round(G[2])+", "+G[3]+")"},P.to.rgb.percent=function(){var G=o(arguments),D=Math.round(G[0]/255*100),N=Math.round(G[1]/255*100),T=Math.round(G[2]/255*100);return G.length<4||1===G[3]?"rgb("+D+"%, "+N+"%, "+T+"%)":"rgba("+D+"%, "+N+"%, "+T+"%, "+G[3]+")"},P.to.hsl=function(){var G=o(arguments);return G.length<4||1===G[3]?"hsl("+G[0]+", "+G[1]+"%, "+G[2]+"%)":"hsla("+G[0]+", "+G[1]+"%, "+G[2]+"%, "+G[3]+")"},P.to.hwb=function(){var G=o(arguments),D="";return G.length>=4&&1!==G[3]&&(D=", "+G[3]),"hwb("+G[0]+", "+G[1]+"%, "+G[2]+"%"+D+")"},P.to.keyword=function(G){return n[G.slice(0,3)]}},11997:(G,D,N)=>{const T=N(12e3),o=N(12017),Z=["keyword","gray","hex"],n={};for(const X of Object.keys(o))n[[...o[X].labels].sort().join("")]=X;const C={};function P(G,D){if(!(this instanceof P))return new P(G,D);if(D&&D in Z&&(D=null),D&&!(D in o))throw new Error("Unknown model: "+D);let N,r;if(null==G)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(G instanceof P)this.model=G.model,this.color=[...G.color],this.valpha=G.valpha;else if("string"===typeof G){const D=T.get(G);if(null===D)throw new Error("Unable to parse color from string: "+G);this.model=D.model,r=o[this.model].channels,this.color=D.value.slice(0,r),this.valpha="number"===typeof D.value[r]?D.value[r]:1}else if(G.length>0){this.model=D||"rgb",r=o[this.model].channels;const N=Array.prototype.slice.call(G,0,r);this.color=g(N,r),this.valpha="number"===typeof G[r]?G[r]:1}else if("number"===typeof G)this.model="rgb",this.color=[G>>16&255,G>>8&255,255&G],this.valpha=1;else{this.valpha=1;const D=Object.keys(G);"alpha"in G&&(D.splice(D.indexOf("alpha"),1),this.valpha="number"===typeof G.alpha?G.alpha:0);const T=D.sort().join("");if(!(T in n))throw new Error("Unable to parse color from object: "+JSON.stringify(G));this.model=n[T];const{labels:Z}=o[this.model],C=[];for(N=0;N<Z.length;N++)C.push(G[Z[N]]);this.color=g(C)}if(C[this.model])for(r=o[this.model].channels,N=0;N<r;N++){const G=C[this.model][N];G&&(this.color[N]=G(this.color[N]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}P.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(G){let D=this.model in T.to?this:this.rgb();D=D.round("number"===typeof G?G:1);const N=1===D.valpha?D.color:[...D.color,this.valpha];return T.to[D.model](N)},percentString(G){const D=this.rgb().round("number"===typeof G?G:1),N=1===D.valpha?D.color:[...D.color,this.valpha];return T.to.rgb.percent(N)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const G={},{channels:D}=o[this.model],{labels:N}=o[this.model];for(let T=0;T<D;T++)G[N[T]]=this.color[T];return 1!==this.valpha&&(G.alpha=this.valpha),G},unitArray(){const G=this.rgb().color;return G[0]/=255,G[1]/=255,G[2]/=255,1!==this.valpha&&G.push(this.valpha),G},unitObject(){const G=this.rgb().object();return G.r/=255,G.g/=255,G.b/=255,1!==this.valpha&&(G.alpha=this.valpha),G},round(G){return G=Math.max(G||0,0),new P([...this.color.map(r(G)),this.valpha],this.model)},alpha(G){return void 0!==G?new P([...this.color,Math.max(0,Math.min(1,G))],this.model):this.valpha},red:v("rgb",0,q(255)),green:v("rgb",1,q(255)),blue:v("rgb",2,q(255)),hue:v(["hsl","hsv","hsl","hwb","hcg"],0,(G=>(G%360+360)%360)),saturationl:v("hsl",1,q(100)),lightness:v("hsl",2,q(100)),saturationv:v("hsv",1,q(100)),value:v("hsv",2,q(100)),chroma:v("hcg",1,q(100)),gray:v("hcg",2,q(100)),white:v("hwb",1,q(100)),wblack:v("hwb",2,q(100)),cyan:v("cmyk",0,q(100)),magenta:v("cmyk",1,q(100)),yellow:v("cmyk",2,q(100)),black:v("cmyk",3,q(100)),x:v("xyz",0,q(95.047)),y:v("xyz",1,q(100)),z:v("xyz",2,q(108.833)),l:v("lab",0,q(100)),a:v("lab",1),b:v("lab",2),keyword(G){return void 0!==G?new P(G):o[this.model].keyword(this.color)},hex(G){return void 0!==G?new P(G):T.to.hex(this.rgb().round().color)},hexa(G){if(void 0!==G)return new P(G);const D=this.rgb().round().color;let N=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===N.length&&(N="0"+N),T.to.hex(D)+N},rgbNumber(){const G=this.rgb().color;return(255&G[0])<<16|(255&G[1])<<8|255&G[2]},luminosity(){const G=this.rgb().color,D=[];for(const[N,T]of G.entries()){const G=T/255;D[N]=G<=.04045?G/12.92:((G+.055)/1.055)**2.4}return.2126*D[0]+.7152*D[1]+.0722*D[2]},contrast(G){const D=this.luminosity(),N=G.luminosity();return D>N?(D+.05)/(N+.05):(N+.05)/(D+.05)},level(G){const D=this.contrast(G);return D>=7?"AAA":D>=4.5?"AA":""},isDark(){const G=this.rgb().color;return(2126*G[0]+7152*G[1]+722*G[2])/1e4<128},isLight(){return!this.isDark()},negate(){const G=this.rgb();for(let D=0;D<3;D++)G.color[D]=255-G.color[D];return G},lighten(G){const D=this.hsl();return D.color[2]+=D.color[2]*G,D},darken(G){const D=this.hsl();return D.color[2]-=D.color[2]*G,D},saturate(G){const D=this.hsl();return D.color[1]+=D.color[1]*G,D},desaturate(G){const D=this.hsl();return D.color[1]-=D.color[1]*G,D},whiten(G){const D=this.hwb();return D.color[1]+=D.color[1]*G,D},blacken(G){const D=this.hwb();return D.color[2]+=D.color[2]*G,D},grayscale(){const G=this.rgb().color,D=.3*G[0]+.59*G[1]+.11*G[2];return P.rgb(D,D,D)},fade(G){return this.alpha(this.valpha-this.valpha*G)},opaquer(G){return this.alpha(this.valpha+this.valpha*G)},rotate(G){const D=this.hsl();let N=D.color[0];return N=(N+G)%360,N=N<0?360+N:N,D.color[0]=N,D},mix(G,D){if(!G||!G.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof G);const N=G.rgb(),T=this.rgb(),o=void 0===D?.5:D,Z=2*o-1,n=N.alpha()-T.alpha(),C=((Z*n===-1?Z:(Z+n)/(1+Z*n))+1)/2,r=1-C;return P.rgb(C*N.red()+r*T.red(),C*N.green()+r*T.green(),C*N.blue()+r*T.blue(),N.alpha()*o+T.alpha()*(1-o))}};for(const X of Object.keys(o)){if(Z.includes(X))continue;const{channels:G}=o[X];P.prototype[X]=function(){if(this.model===X)return new P(this);for(var G=arguments.length,D=new Array(G),N=0;N<G;N++)D[N]=arguments[N];return D.length>0?new P(D,X):new P([...(T=o[this.model][X].raw(this.color),Array.isArray(T)?T:[T]),this.valpha],X);var T},P[X]=function(){for(var D=arguments.length,N=new Array(D),T=0;T<D;T++)N[T]=arguments[T];let o=N[0];return"number"===typeof o&&(o=g(N,G)),new P(o,X)}}function r(G){return function(D){return function(G,D){return Number(G.toFixed(D))}(D,G)}}function v(G,D,N){G=Array.isArray(G)?G:[G];for(const T of G)(C[T]||(C[T]=[]))[D]=N;return G=G[0],function(T){let o;return void 0!==T?(N&&(T=N(T)),o=this[G](),o.color[D]=T,o):(o=this[G]().color[D],N&&(o=N(o)),o)}}function q(G){return function(D){return Math.max(0,Math.min(G,D))}}function g(G,D){for(let N=0;N<D;N++)"number"!==typeof G[N]&&(G[N]=0);return G}G.exports=P},12022:(G,D,N)=>{const T=N(12027),o={};for(const n of Object.keys(T))o[T[n]]=n;const Z={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};G.exports=Z;for(const n of Object.keys(Z)){if(!("channels"in Z[n]))throw new Error("missing channels property: "+n);if(!("labels"in Z[n]))throw new Error("missing channel labels property: "+n);if(Z[n].labels.length!==Z[n].channels)throw new Error("channel and label counts mismatch: "+n);const{channels:G,labels:D}=Z[n];delete Z[n].channels,delete Z[n].labels,Object.defineProperty(Z[n],"channels",{value:G}),Object.defineProperty(Z[n],"labels",{value:D})}Z.rgb.hsl=function(G){const D=G[0]/255,N=G[1]/255,T=G[2]/255,o=Math.min(D,N,T),Z=Math.max(D,N,T),n=Z-o;let C,P;Z===o?C=0:D===Z?C=(N-T)/n:N===Z?C=2+(T-D)/n:T===Z&&(C=4+(D-N)/n),C=Math.min(60*C,360),C<0&&(C+=360);const r=(o+Z)/2;return P=Z===o?0:r<=.5?n/(Z+o):n/(2-Z-o),[C,100*P,100*r]},Z.rgb.hsv=function(G){let D,N,T,o,Z;const n=G[0]/255,C=G[1]/255,P=G[2]/255,r=Math.max(n,C,P),v=r-Math.min(n,C,P),q=function(G){return(r-G)/6/v+.5};return 0===v?(o=0,Z=0):(Z=v/r,D=q(n),N=q(C),T=q(P),n===r?o=T-N:C===r?o=1/3+D-T:P===r&&(o=2/3+N-D),o<0?o+=1:o>1&&(o-=1)),[360*o,100*Z,100*r]},Z.rgb.hwb=function(G){const D=G[0],N=G[1];let T=G[2];const o=Z.rgb.hsl(G)[0],n=1/255*Math.min(D,Math.min(N,T));return T=1-1/255*Math.max(D,Math.max(N,T)),[o,100*n,100*T]},Z.rgb.cmyk=function(G){const D=G[0]/255,N=G[1]/255,T=G[2]/255,o=Math.min(1-D,1-N,1-T);return[100*((1-D-o)/(1-o)||0),100*((1-N-o)/(1-o)||0),100*((1-T-o)/(1-o)||0),100*o]},Z.rgb.keyword=function(G){const D=o[G];if(D)return D;let N,Z=1/0;for(const o of Object.keys(T)){const D=T[o],P=(C=D,((n=G)[0]-C[0])**2+(n[1]-C[1])**2+(n[2]-C[2])**2);P<Z&&(Z=P,N=o)}var n,C;return N},Z.keyword.rgb=function(G){return T[G]},Z.rgb.xyz=function(G){let D=G[0]/255,N=G[1]/255,T=G[2]/255;D=D>.04045?((D+.055)/1.055)**2.4:D/12.92,N=N>.04045?((N+.055)/1.055)**2.4:N/12.92,T=T>.04045?((T+.055)/1.055)**2.4:T/12.92;return[100*(.4124*D+.3576*N+.1805*T),100*(.2126*D+.7152*N+.0722*T),100*(.0193*D+.1192*N+.9505*T)]},Z.rgb.lab=function(G){const D=Z.rgb.xyz(G);let N=D[0],T=D[1],o=D[2];N/=95.047,T/=100,o/=108.883,N=N>.008856?N**(1/3):7.787*N+16/116,T=T>.008856?T**(1/3):7.787*T+16/116,o=o>.008856?o**(1/3):7.787*o+16/116;return[116*T-16,500*(N-T),200*(T-o)]},Z.hsl.rgb=function(G){const D=G[0]/360,N=G[1]/100,T=G[2]/100;let o,Z,n;if(0===N)return n=255*T,[n,n,n];o=T<.5?T*(1+N):T+N-T*N;const C=2*T-o,P=[0,0,0];for(let r=0;r<3;r++)Z=D+1/3*-(r-1),Z<0&&Z++,Z>1&&Z--,n=6*Z<1?C+6*(o-C)*Z:2*Z<1?o:3*Z<2?C+(o-C)*(2/3-Z)*6:C,P[r]=255*n;return P},Z.hsl.hsv=function(G){const D=G[0];let N=G[1]/100,T=G[2]/100,o=N;const Z=Math.max(T,.01);T*=2,N*=T<=1?T:2-T,o*=Z<=1?Z:2-Z;return[D,100*(0===T?2*o/(Z+o):2*N/(T+N)),100*((T+N)/2)]},Z.hsv.rgb=function(G){const D=G[0]/60,N=G[1]/100;let T=G[2]/100;const o=Math.floor(D)%6,Z=D-Math.floor(D),n=255*T*(1-N),C=255*T*(1-N*Z),P=255*T*(1-N*(1-Z));switch(T*=255,o){case 0:return[T,P,n];case 1:return[C,T,n];case 2:return[n,T,P];case 3:return[n,C,T];case 4:return[P,n,T];case 5:return[T,n,C]}},Z.hsv.hsl=function(G){const D=G[0],N=G[1]/100,T=G[2]/100,o=Math.max(T,.01);let Z,n;n=(2-N)*T;const C=(2-N)*o;return Z=N*o,Z/=C<=1?C:2-C,Z=Z||0,n/=2,[D,100*Z,100*n]},Z.hwb.rgb=function(G){const D=G[0]/360;let N=G[1]/100,T=G[2]/100;const o=N+T;let Z;o>1&&(N/=o,T/=o);const n=Math.floor(6*D),C=1-T;Z=6*D-n,0!==(1&n)&&(Z=1-Z);const P=N+Z*(C-N);let r,v,q;switch(n){default:case 6:case 0:r=C,v=P,q=N;break;case 1:r=P,v=C,q=N;break;case 2:r=N,v=C,q=P;break;case 3:r=N,v=P,q=C;break;case 4:r=P,v=N,q=C;break;case 5:r=C,v=N,q=P}return[255*r,255*v,255*q]},Z.cmyk.rgb=function(G){const D=G[0]/100,N=G[1]/100,T=G[2]/100,o=G[3]/100;return[255*(1-Math.min(1,D*(1-o)+o)),255*(1-Math.min(1,N*(1-o)+o)),255*(1-Math.min(1,T*(1-o)+o))]},Z.xyz.rgb=function(G){const D=G[0]/100,N=G[1]/100,T=G[2]/100;let o,Z,n;return o=3.2406*D+-1.5372*N+-.4986*T,Z=-.9689*D+1.8758*N+.0415*T,n=.0557*D+-.204*N+1.057*T,o=o>.0031308?1.055*o**(1/2.4)-.055:12.92*o,Z=Z>.0031308?1.055*Z**(1/2.4)-.055:12.92*Z,n=n>.0031308?1.055*n**(1/2.4)-.055:12.92*n,o=Math.min(Math.max(0,o),1),Z=Math.min(Math.max(0,Z),1),n=Math.min(Math.max(0,n),1),[255*o,255*Z,255*n]},Z.xyz.lab=function(G){let D=G[0],N=G[1],T=G[2];D/=95.047,N/=100,T/=108.883,D=D>.008856?D**(1/3):7.787*D+16/116,N=N>.008856?N**(1/3):7.787*N+16/116,T=T>.008856?T**(1/3):7.787*T+16/116;return[116*N-16,500*(D-N),200*(N-T)]},Z.lab.xyz=function(G){let D,N,T;N=(G[0]+16)/116,D=G[1]/500+N,T=N-G[2]/200;const o=N**3,Z=D**3,n=T**3;return N=o>.008856?o:(N-16/116)/7.787,D=Z>.008856?Z:(D-16/116)/7.787,T=n>.008856?n:(T-16/116)/7.787,D*=95.047,N*=100,T*=108.883,[D,N,T]},Z.lab.lch=function(G){const D=G[0],N=G[1],T=G[2];let o;o=360*Math.atan2(T,N)/2/Math.PI,o<0&&(o+=360);return[D,Math.sqrt(N*N+T*T),o]},Z.lch.lab=function(G){const D=G[0],N=G[1],T=G[2]/360*2*Math.PI;return[D,N*Math.cos(T),N*Math.sin(T)]},Z.rgb.ansi16=function(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[N,T,o]=G;let n=null===D?Z.rgb.hsv(G)[2]:D;if(n=Math.round(n/50),0===n)return 30;let C=30+(Math.round(o/255)<<2|Math.round(T/255)<<1|Math.round(N/255));return 2===n&&(C+=60),C},Z.hsv.ansi16=function(G){return Z.rgb.ansi16(Z.hsv.rgb(G),G[2])},Z.rgb.ansi256=function(G){const D=G[0],N=G[1],T=G[2];if(D===N&&N===T)return D<8?16:D>248?231:Math.round((D-8)/247*24)+232;return 16+36*Math.round(D/255*5)+6*Math.round(N/255*5)+Math.round(T/255*5)},Z.ansi16.rgb=function(G){let D=G%10;if(0===D||7===D)return G>50&&(D+=3.5),D=D/10.5*255,[D,D,D];const N=.5*(1+~~(G>50));return[(1&D)*N*255,(D>>1&1)*N*255,(D>>2&1)*N*255]},Z.ansi256.rgb=function(G){if(G>=232){const D=10*(G-232)+8;return[D,D,D]}let D;G-=16;return[Math.floor(G/36)/5*255,Math.floor((D=G%36)/6)/5*255,D%6/5*255]},Z.rgb.hex=function(G){const D=(((255&Math.round(G[0]))<<16)+((255&Math.round(G[1]))<<8)+(255&Math.round(G[2]))).toString(16).toUpperCase();return"000000".substring(D.length)+D},Z.hex.rgb=function(G){const D=G.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!D)return[0,0,0];let N=D[0];3===D[0].length&&(N=N.split("").map((G=>G+G)).join(""));const T=parseInt(N,16);return[T>>16&255,T>>8&255,255&T]},Z.rgb.hcg=function(G){const D=G[0]/255,N=G[1]/255,T=G[2]/255,o=Math.max(Math.max(D,N),T),Z=Math.min(Math.min(D,N),T),n=o-Z;let C,P;return C=n<1?Z/(1-n):0,P=n<=0?0:o===D?(N-T)/n%6:o===N?2+(T-D)/n:4+(D-N)/n,P/=6,P%=1,[360*P,100*n,100*C]},Z.hsl.hcg=function(G){const D=G[1]/100,N=G[2]/100,T=N<.5?2*D*N:2*D*(1-N);let o=0;return T<1&&(o=(N-.5*T)/(1-T)),[G[0],100*T,100*o]},Z.hsv.hcg=function(G){const D=G[1]/100,N=G[2]/100,T=D*N;let o=0;return T<1&&(o=(N-T)/(1-T)),[G[0],100*T,100*o]},Z.hcg.rgb=function(G){const D=G[0]/360,N=G[1]/100,T=G[2]/100;if(0===N)return[255*T,255*T,255*T];const o=[0,0,0],Z=D%1*6,n=Z%1,C=1-n;let P=0;switch(Math.floor(Z)){case 0:o[0]=1,o[1]=n,o[2]=0;break;case 1:o[0]=C,o[1]=1,o[2]=0;break;case 2:o[0]=0,o[1]=1,o[2]=n;break;case 3:o[0]=0,o[1]=C,o[2]=1;break;case 4:o[0]=n,o[1]=0,o[2]=1;break;default:o[0]=1,o[1]=0,o[2]=C}return P=(1-N)*T,[255*(N*o[0]+P),255*(N*o[1]+P),255*(N*o[2]+P)]},Z.hcg.hsv=function(G){const D=G[1]/100,N=D+G[2]/100*(1-D);let T=0;return N>0&&(T=D/N),[G[0],100*T,100*N]},Z.hcg.hsl=function(G){const D=G[1]/100,N=G[2]/100*(1-D)+.5*D;let T=0;return N>0&&N<.5?T=D/(2*N):N>=.5&&N<1&&(T=D/(2*(1-N))),[G[0],100*T,100*N]},Z.hcg.hwb=function(G){const D=G[1]/100,N=D+G[2]/100*(1-D);return[G[0],100*(N-D),100*(1-N)]},Z.hwb.hcg=function(G){const D=G[1]/100,N=1-G[2]/100,T=N-D;let o=0;return T<1&&(o=(N-T)/(1-T)),[G[0],100*T,100*o]},Z.apple.rgb=function(G){return[G[0]/65535*255,G[1]/65535*255,G[2]/65535*255]},Z.rgb.apple=function(G){return[G[0]/255*65535,G[1]/255*65535,G[2]/255*65535]},Z.gray.rgb=function(G){return[G[0]/100*255,G[0]/100*255,G[0]/100*255]},Z.gray.hsl=function(G){return[0,0,G[0]]},Z.gray.hsv=Z.gray.hsl,Z.gray.hwb=function(G){return[0,100,G[0]]},Z.gray.cmyk=function(G){return[0,0,0,G[0]]},Z.gray.lab=function(G){return[G[0],0,0]},Z.gray.hex=function(G){const D=255&Math.round(G[0]/100*255),N=((D<<16)+(D<<8)+D).toString(16).toUpperCase();return"000000".substring(N.length)+N},Z.rgb.gray=function(G){return[(G[0]+G[1]+G[2])/3/255*100]}},12017:(G,D,N)=>{const T=N(12022),o=N(12034),Z={};Object.keys(T).forEach((G=>{Z[G]={},Object.defineProperty(Z[G],"channels",{value:T[G].channels}),Object.defineProperty(Z[G],"labels",{value:T[G].labels});const D=o(G);Object.keys(D).forEach((N=>{const T=D[N];Z[G][N]=function(G){const D=function(){for(var D=arguments.length,N=new Array(D),T=0;T<D;T++)N[T]=arguments[T];const o=N[0];if(void 0===o||null===o)return o;o.length>1&&(N=o);const Z=G(N);if("object"===typeof Z)for(let G=Z.length,n=0;n<G;n++)Z[n]=Math.round(Z[n]);return Z};return"conversion"in G&&(D.conversion=G.conversion),D}(T),Z[G][N].raw=function(G){const D=function(){for(var D=arguments.length,N=new Array(D),T=0;T<D;T++)N[T]=arguments[T];const o=N[0];return void 0===o||null===o?o:(o.length>1&&(N=o),G(N))};return"conversion"in G&&(D.conversion=G.conversion),D}(T)}))})),G.exports=Z},12034:(G,D,N)=>{const T=N(12022);function o(G){const D=function(){const G={},D=Object.keys(T);for(let N=D.length,T=0;T<N;T++)G[D[T]]={distance:-1,parent:null};return G}(),N=[G];for(D[G].distance=0;N.length;){const G=N.pop(),o=Object.keys(T[G]);for(let T=o.length,Z=0;Z<T;Z++){const T=o[Z],n=D[T];-1===n.distance&&(n.distance=D[G].distance+1,n.parent=G,N.unshift(T))}}return D}function Z(G,D){return function(N){return D(G(N))}}function n(G,D){const N=[D[G].parent,G];let o=T[D[G].parent][G],n=D[G].parent;for(;D[n].parent;)N.unshift(D[n].parent),o=Z(T[D[n].parent][n],o),n=D[n].parent;return o.conversion=N,o}G.exports=function(G){const D=o(G),N={},T=Object.keys(D);for(let o=T.length,Z=0;Z<o;Z++){const G=T[Z];null!==D[G].parent&&(N[G]=n(G,D))}return N}},12027:G=>{"use strict";G.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11173:function(G,D,N){"use strict";var T=this&&this.__createBinding||(Object.create?function(G,D,N,T){void 0===T&&(T=N);var o=Object.getOwnPropertyDescriptor(D,N);o&&!("get"in o?!D.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return D[N]}}),Object.defineProperty(G,T,o)}:function(G,D,N,T){void 0===T&&(T=N),G[T]=D[N]}),o=this&&this.__setModuleDefault||(Object.create?function(G,D){Object.defineProperty(G,"default",{enumerable:!0,value:D})}:function(G,D){G.default=D}),Z=this&&this.__importStar||function(G){if(G&&G.__esModule)return G;var D={};if(null!=G)for(var N in G)"default"!==N&&Object.prototype.hasOwnProperty.call(G,N)&&T(D,G,N);return o(D,G),D},n=this&&this.__awaiter||function(G,D,N,T){return new(N||(N=Promise))((function(o,Z){function n(G){try{P(T.next(G))}catch(D){Z(D)}}function C(G){try{P(T.throw(G))}catch(D){Z(D)}}function P(G){var D;G.done?o(G.value):(D=G.value,D instanceof N?D:new N((function(G){G(D)}))).then(n,C)}P((T=T.apply(G,D||[])).next())}))};Object.defineProperty(D,"__esModule",{value:!0}),D.Auth=D.Platform=void 0;const C=Z(N(11090)),P=N(11181),r="colyseus-auth-token";!function(G){G.ios="ios",G.android="android"}(D.Platform||(D.Platform={}));D.Auth=class{constructor(G){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=G.replace("ws","http"),(0,P.getItem)(r,(G=>this.token=G))}get hasToken(){return!!this.token}login(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n(this,void 0,void 0,(function*(){const D=Object.assign({},G);this.hasToken&&(D.token=this.token);const N=yield this.request("post","/auth",D);this.token=N.token,(0,P.setItem)(r,this.token);for(let G in N)this.hasOwnProperty(G)&&(this[G]=N[G]);return this.registerPingService(),this}))}save(){return n(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return n(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return n(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return n(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(G){return n(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:G})}))}acceptFriendRequest(G){return n(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:G})}))}declineFriendRequest(G){return n(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:G})}))}blockUser(G){return n(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:G})}))}unblockUser(G){return n(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:G})}))}request(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},T=arguments.length>3?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return n(this,void 0,void 0,(function*(){o.Accept="application/json",this.hasToken&&(o.Authorization="Bearer "+this.token);const Z=[];for(const G in N)Z.push(`${G}=${N[G]}`);const n=Z.length>0?`?${Z.join("&")}`:"",P={headers:o};return T&&(P.body=T),(yield C[G](`${this.endpoint}${D}${n}`,P)).data}))}logout(){this.token=void 0,(0,P.removeItem)(r),this.unregisterPingService()}registerPingService(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),G)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11085:function(G,D,N){"use strict";var T,o=this&&this.__awaiter||function(G,D,N,T){return new(N||(N=Promise))((function(o,Z){function n(G){try{P(T.next(G))}catch(D){Z(D)}}function C(G){try{P(T.throw(G))}catch(D){Z(D)}}function P(G){var D;G.done?o(G.value):(D=G.value,D instanceof N?D:new N((function(G){G(D)}))).then(n,C)}P((T=T.apply(G,D||[])).next())}))};Object.defineProperty(D,"__esModule",{value:!0}),D.Client=D.MatchMakeError=void 0;const Z=N(11090),n=N(11098),C=N(11107);class P extends Error{constructor(G,D){super(G),this.code=D,Object.setPrototypeOf(this,P.prototype)}}D.MatchMakeError=P;const r="undefined"!==typeof window&&"undefined"!==typeof(null===(T=null===window||void 0===window?void 0:window.location)||void 0===T?void 0:T.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";D.Client=class{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;if("string"===typeof G){const D=new URL(G),N="https:"===D.protocol||"wss:"===D.protocol,T=Number(D.port||(N?443:80));this.settings={hostname:D.hostname,pathname:"/"!==D.pathname?D.pathname:"",port:T,secure:N}}else void 0===G.port&&(G.port=G.secure?443:80),void 0===G.pathname&&(G.pathname=""),this.settings=G}joinOrCreate(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2?arguments[2]:void 0;return o(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",G,D,N)}))}create(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2?arguments[2]:void 0;return o(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",G,D,N)}))}join(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2?arguments[2]:void 0;return o(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",G,D,N)}))}joinById(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2?arguments[2]:void 0;return o(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",G,D,N)}))}reconnect(G,D){return o(this,void 0,void 0,(function*(){if("string"===typeof G&&"string"===typeof D)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[N,T]=G.split(":");return yield this.createMatchMakeRequest("reconnect",N,{reconnectionToken:T},D)}))}getAvailableRooms(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return o(this,void 0,void 0,(function*(){return(yield(0,Z.get)(this.getHttpEndpoint(`${G}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(G,D,N){return o(this,void 0,void 0,(function*(){const T=this.createRoom(G.room.name,D);T.roomId=G.room.roomId,T.sessionId=G.sessionId;const Z={sessionId:T.sessionId};G.reconnectionToken&&(Z.reconnectionToken=G.reconnectionToken);const C=N||T;return T.connect(this.buildEndpoint(G.room,Z),G.devMode&&(()=>o(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${T.roomId}'...`);let N=0;const Z=()=>o(this,void 0,void 0,(function*(){N++;try{yield this.consumeSeatReservation(G,D,C),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${T.roomId}'`)}catch(o){N<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${N} out of 8)`),setTimeout(Z,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(Z,2e3)}))),C),new Promise(((G,D)=>{const N=(G,N)=>D(new n.ServerError(G,N));C.onError.once(N),C.onJoin.once((()=>{C.onError.remove(N),G(C)}))}))}))}createMatchMakeRequest(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},T=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;return o(this,void 0,void 0,(function*(){const o=(yield(0,Z.post)(this.getHttpEndpoint(`${G}/${D}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(N)})).data;if(o.error)throw new P(o.error,o.code);return"reconnect"===G&&(o.reconnectionToken=N.reconnectionToken),yield this.consumeSeatReservation(o,T,n)}))}createRoom(G,D){return new C.Room(G,D)}buildEndpoint(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const N=[];for(const o in D)D.hasOwnProperty(o)&&N.push(`${o}=${D[o]}`);let T=this.settings.secure?"wss://":"ws://";return G.publicAddress?T+=`${G.publicAddress}`:T+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${T}/${G.processId}/${G.roomId}?${N.join("&")}`}getHttpEndpoint(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${G}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11117:(G,D,N)=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.Connection=void 0;const T=N(11126);D.Connection=class{constructor(){this.events={},this.transport=new T.WebSocketTransport(this.events)}send(G){this.transport.send(G)}connect(G){this.transport.connect(G)}close(G,D){this.transport.close(G,D)}get isOpen(){return this.transport.isOpen}}},11141:(G,D)=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.utf8Length=D.utf8Read=D.ErrorCode=D.Protocol=void 0,function(G){G[G.HANDSHAKE=9]="HANDSHAKE",G[G.JOIN_ROOM=10]="JOIN_ROOM",G[G.ERROR=11]="ERROR",G[G.LEAVE_ROOM=12]="LEAVE_ROOM",G[G.ROOM_DATA=13]="ROOM_DATA",G[G.ROOM_STATE=14]="ROOM_STATE",G[G.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",G[G.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",G[G.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(D.Protocol||(D.Protocol={})),function(G){G[G.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",G[G.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",G[G.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",G[G.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",G[G.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",G[G.AUTH_FAILED=4215]="AUTH_FAILED",G[G.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(D.ErrorCode||(D.ErrorCode={})),D.utf8Read=function(G,D){const N=G[D++];for(var T="",o=0,Z=D,n=D+N;Z<n;Z++){var C=G[Z];if(0!==(128&C))if(192!==(224&C))if(224!==(240&C)){if(240!==(248&C))throw new Error("Invalid byte "+C.toString(16));(o=(7&C)<<18|(63&G[++Z])<<12|(63&G[++Z])<<6|63&G[++Z])>=65536?(o-=65536,T+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):T+=String.fromCharCode(o)}else T+=String.fromCharCode((15&C)<<12|(63&G[++Z])<<6|63&G[++Z]);else T+=String.fromCharCode((31&C)<<6|63&G[++Z]);else T+=String.fromCharCode(C)}return T},D.utf8Length=function(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",D=0,N=0;for(let T=0,o=G.length;T<o;T++)D=G.charCodeAt(T),D<128?N+=1:D<2048?N+=2:D<55296||D>=57344?N+=3:(T++,N+=4);return N+1}},11107:function(G,D,N){"use strict";var T=this&&this.__createBinding||(Object.create?function(G,D,N,T){void 0===T&&(T=N);var o=Object.getOwnPropertyDescriptor(D,N);o&&!("get"in o?!D.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return D[N]}}),Object.defineProperty(G,T,o)}:function(G,D,N,T){void 0===T&&(T=N),G[T]=D[N]}),o=this&&this.__setModuleDefault||(Object.create?function(G,D){Object.defineProperty(G,"default",{enumerable:!0,value:D})}:function(G,D){G.default=D}),Z=this&&this.__importStar||function(G){if(G&&G.__esModule)return G;var D={};if(null!=G)for(var N in G)"default"!==N&&Object.prototype.hasOwnProperty.call(G,N)&&T(D,G,N);return o(D,G),D};Object.defineProperty(D,"__esModule",{value:!0}),D.Room=void 0;const n=Z(N(11112)),C=N(11117),P=N(11141),r=N(11149),v=N(11153),q=N(11162),g=N(11169),X=N(11098);class W{constructor(G,D){this.onStateChange=(0,q.createSignal)(),this.onError=(0,q.createSignal)(),this.onLeave=(0,q.createSignal)(),this.onJoin=(0,q.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,v.createNanoEvents)(),this.roomId=null,this.name=G,D&&(this.serializer=new((0,r.getSerializer)("schema")),this.rootSchema=D,this.serializer.state=new D),this.onError(((G,D)=>{var N;return null===(N=console.warn)||void 0===N?void 0:N.call(console,`colyseus.js - onError => (${G}) ${D}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const T=new C.Connection;N.connection=T,T.events.onmessage=W.prototype.onMessageCallback.bind(N),T.events.onclose=function(G){var T;if(!N.hasJoined)return null===(T=console.warn)||void 0===T||T.call(console,`Room connection was closed unexpectedly (${G.code}): ${G.reason}`),void N.onError.invoke(G.code,G.reason);G.code===X.CloseCode.DEVMODE_RESTART&&D?D():(N.onLeave.invoke(G.code),N.destroy())},T.events.onerror=function(G){var D;null===(D=console.warn)||void 0===D||D.call(console,`Room, onError (${G.code}): ${G.reason}`),N.onError.invoke(G.code,G.reason)},T.connect(G)}leave(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((D=>{this.onLeave((G=>D(G))),this.connection?G?this.connection.send([P.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(X.CloseCode.CONSENTED)}))}onMessage(G,D){return this.onMessageHandlers.on(this.getMessageHandlerKey(G),D)}send(G,D){const N=[P.Protocol.ROOM_DATA];let T;if("string"===typeof G?g.encode.string(N,G):g.encode.number(N,G),void 0!==D){const G=n.encode(D);T=new Uint8Array(N.length+G.byteLength),T.set(new Uint8Array(N),0),T.set(new Uint8Array(G),N.length)}else T=new Uint8Array(N);this.connection.send(T.buffer)}sendBytes(G,D){const N=[P.Protocol.ROOM_DATA_BYTES];let T;"string"===typeof G?g.encode.string(N,G):g.encode.number(N,G),T=new Uint8Array(N.length+(D.byteLength||D.length)),T.set(new Uint8Array(N),0),T.set(new Uint8Array(D),N.length),this.connection.send(T.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(G){const D=Array.from(new Uint8Array(G.data)),N=D[0];if(N===P.Protocol.JOIN_ROOM){let G=1;const N=(0,P.utf8Read)(D,G);if(G+=(0,P.utf8Length)(N),this.serializerId=(0,P.utf8Read)(D,G),G+=(0,P.utf8Length)(this.serializerId),!this.serializer){const G=(0,r.getSerializer)(this.serializerId);this.serializer=new G}D.length>G&&this.serializer.handshake&&this.serializer.handshake(D,{offset:G}),this.reconnectionToken=`${this.roomId}:${N}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([P.Protocol.JOIN_ROOM])}else if(N===P.Protocol.ERROR){const G={offset:1},N=g.decode.number(D,G),T=g.decode.string(D,G);this.onError.invoke(N,T)}else if(N===P.Protocol.LEAVE_ROOM)this.leave();else if(N===P.Protocol.ROOM_DATA_SCHEMA){const G={offset:1},N=this.serializer.getState().constructor._context.get(g.decode.number(D,G)),T=new N;T.decode(D,G),this.dispatchMessage(N,T)}else if(N===P.Protocol.ROOM_STATE)D.shift(),this.setState(D);else if(N===P.Protocol.ROOM_STATE_PATCH)D.shift(),this.patch(D);else if(N===P.Protocol.ROOM_DATA){const N={offset:1},T=g.decode.stringCheck(D,N)?g.decode.string(D,N):g.decode.number(D,N),o=D.length>N.offset?n.decode(G.data,N.offset):void 0;this.dispatchMessage(T,o)}else if(N===P.Protocol.ROOM_DATA_BYTES){const G={offset:1},N=g.decode.stringCheck(D,G)?g.decode.string(D,G):g.decode.number(D,G);this.dispatchMessage(N,new Uint8Array(D.slice(G.offset)))}}setState(G){this.serializer.setState(G),this.onStateChange.invoke(this.serializer.getState())}patch(G){this.serializer.patch(G),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(G,D){var N;const T=this.getMessageHandlerKey(G);this.onMessageHandlers.events[T]?this.onMessageHandlers.emit(T,D):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",G,D):null===(N=console.warn)||void 0===N||N.call(console,`colyseus.js: onMessage() not registered for type '${G}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(G){switch(typeof G){case"function":return`$${G._typeid}`;case"string":return G;case"number":return`i${G}`;default:throw new Error("invalid message type.")}}}D.Room=W},11181:(G,D)=>{"use strict";let N;function T(){return N||(N="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(G,D){this.cache[G]=D},getItem:function(G){this.cache[G]},removeItem:function(G){delete this.cache[G]}}),N}Object.defineProperty(D,"__esModule",{value:!0}),D.getItem=D.removeItem=D.setItem=void 0,D.setItem=function(G,D){T().setItem(G,D)},D.removeItem=function(G){T().removeItem(G)},D.getItem=function(G,D){const N=T().getItem(G);"undefined"!==typeof Promise&&N instanceof Promise?N.then((G=>D(G))):D(N)}},11153:(G,D)=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.createNanoEvents=void 0;D.createNanoEvents=()=>({emit(G){let D=this.events[G]||[];for(var N=arguments.length,T=new Array(N>1?N-1:0),o=1;o<N;o++)T[o-1]=arguments[o];for(let Z=0,n=D.length;Z<n;Z++)D[Z](...T)},events:{},on(G,D){var N;return(null===(N=this.events[G])||void 0===N?void 0:N.push(D))||(this.events[G]=[D]),()=>{var N;this.events[G]=null===(N=this.events[G])||void 0===N?void 0:N.filter((G=>D!==G))}}})},11162:(G,D)=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.createSignal=D.EventEmitter=void 0;class N{constructor(){this.handlers=[]}register(G){return this.handlers.push(G),this}invoke(){for(var G=arguments.length,D=new Array(G),N=0;N<G;N++)D[N]=arguments[N];this.handlers.forEach((G=>G.apply(this,D)))}invokeAsync(){for(var G=arguments.length,D=new Array(G),N=0;N<G;N++)D[N]=arguments[N];return Promise.all(this.handlers.map((G=>G.apply(this,D))))}remove(G){const D=this.handlers.indexOf(G);this.handlers[D]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}D.EventEmitter=N,D.createSignal=function(){const G=new N;function D(D){return G.register(D,null===this)}return D.once=D=>{const N=function(){for(var T=arguments.length,o=new Array(T),Z=0;Z<T;Z++)o[Z]=arguments[Z];D.apply(this,o),G.remove(N)};G.register(N)},D.remove=D=>G.remove(D),D.invoke=function(){return G.invoke(...arguments)},D.invokeAsync=function(){return G.invokeAsync(...arguments)},D.clear=()=>G.clear(),D}},11098:(G,D)=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.ServerError=D.CloseCode=void 0,function(G){G[G.CONSENTED=4e3]="CONSENTED",G[G.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(D.CloseCode||(D.CloseCode={}));class N extends Error{constructor(G,D){super(D),this.name="ServerError",this.code=G}}D.ServerError=N},11069:(G,D,N)=>{"use strict";D.e=void 0,N(11076);var T=N(11085);Object.defineProperty(D,"e",{enumerable:!0,get:function(){return T.Client}});var o=N(11141);var Z=N(11107);var n=N(11173);const C=N(11188);const P=N(11197),r=N(11149);(0,r.registerSerializer)("schema",C.SchemaSerializer),(0,r.registerSerializer)("none",P.NoneSerializer)},11076:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=G=>null!==G&&"object"===typeof G&&G.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11112:(G,D)=>{"use strict";function N(G,D){if(this._offset=D,G instanceof ArrayBuffer)this._buffer=G,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(G))throw new Error("Invalid argument");this._buffer=G.buffer,this._view=new DataView(this._buffer,G.byteOffset,G.byteLength)}}Object.defineProperty(D,"__esModule",{value:!0}),D.decode=D.encode=void 0,N.prototype._array=function(G){for(var D=new Array(G),N=0;N<G;N++)D[N]=this._parse();return D},N.prototype._map=function(G){for(var D={},N=0;N<G;N++)D[this._parse()]=this._parse();return D},N.prototype._str=function(G){var D=function(G,D,N){for(var T="",o=0,Z=D,n=D+N;Z<n;Z++){var C=G.getUint8(Z);if(0!==(128&C))if(192!==(224&C))if(224!==(240&C)){if(240!==(248&C))throw new Error("Invalid byte "+C.toString(16));(o=(7&C)<<18|(63&G.getUint8(++Z))<<12|(63&G.getUint8(++Z))<<6|63&G.getUint8(++Z))>=65536?(o-=65536,T+=String.fromCharCode(55296+(o>>>10),56320+(1023&o))):T+=String.fromCharCode(o)}else T+=String.fromCharCode((15&C)<<12|(63&G.getUint8(++Z))<<6|63&G.getUint8(++Z));else T+=String.fromCharCode((31&C)<<6|63&G.getUint8(++Z));else T+=String.fromCharCode(C)}return T}(this._view,this._offset,G);return this._offset+=G,D},N.prototype._bin=function(G){var D=this._buffer.slice(this._offset,this._offset+G);return this._offset+=G,D},N.prototype._parse=function(){var G,D=this._view.getUint8(this._offset++),N=0,T=0,o=0,Z=0;if(D<192)return D<128?D:D<144?this._map(15&D):D<160?this._array(15&D):this._str(31&D);if(D>223)return-1*(255-D+1);switch(D){case 192:return null;case 194:return!1;case 195:return!0;case 196:return N=this._view.getUint8(this._offset),this._offset+=1,this._bin(N);case 197:return N=this._view.getUint16(this._offset),this._offset+=2,this._bin(N);case 198:return N=this._view.getUint32(this._offset),this._offset+=4,this._bin(N);case 199:if(N=this._view.getUint8(this._offset),T=this._view.getInt8(this._offset+1),this._offset+=2,-1===T){var n=this._view.getUint32(this._offset);return o=this._view.getInt32(this._offset+4),Z=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*o+Z)+n/1e6)}return[T,this._bin(N)];case 200:return N=this._view.getUint16(this._offset),T=this._view.getInt8(this._offset+2),this._offset+=3,[T,this._bin(N)];case 201:return N=this._view.getUint32(this._offset),T=this._view.getInt8(this._offset+4),this._offset+=5,[T,this._bin(N)];case 202:return G=this._view.getFloat32(this._offset),this._offset+=4,G;case 203:return G=this._view.getFloat64(this._offset),this._offset+=8,G;case 204:return G=this._view.getUint8(this._offset),this._offset+=1,G;case 205:return G=this._view.getUint16(this._offset),this._offset+=2,G;case 206:return G=this._view.getUint32(this._offset),this._offset+=4,G;case 207:return o=this._view.getUint32(this._offset)*Math.pow(2,32),Z=this._view.getUint32(this._offset+4),this._offset+=8,o+Z;case 208:return G=this._view.getInt8(this._offset),this._offset+=1,G;case 209:return G=this._view.getInt16(this._offset),this._offset+=2,G;case 210:return G=this._view.getInt32(this._offset),this._offset+=4,G;case 211:return o=this._view.getInt32(this._offset)*Math.pow(2,32),Z=this._view.getUint32(this._offset+4),this._offset+=8,o+Z;case 212:return T=this._view.getInt8(this._offset),this._offset+=1,0===T?void(this._offset+=1):[T,this._bin(1)];case 213:return T=this._view.getInt8(this._offset),this._offset+=1,[T,this._bin(2)];case 214:return T=this._view.getInt8(this._offset),this._offset+=1,-1===T?(G=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*G)):[T,this._bin(4)];case 215:return T=this._view.getInt8(this._offset),this._offset+=1,0===T?(o=this._view.getInt32(this._offset)*Math.pow(2,32),Z=this._view.getUint32(this._offset+4),this._offset+=8,new Date(o+Z)):-1===T?(o=this._view.getUint32(this._offset),Z=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&o)+Z)+(o>>>2)/1e6)):[T,this._bin(8)];case 216:return T=this._view.getInt8(this._offset),this._offset+=1,[T,this._bin(16)];case 217:return N=this._view.getUint8(this._offset),this._offset+=1,this._str(N);case 218:return N=this._view.getUint16(this._offset),this._offset+=2,this._str(N);case 219:return N=this._view.getUint32(this._offset),this._offset+=4,this._str(N);case 220:return N=this._view.getUint16(this._offset),this._offset+=2,this._array(N);case 221:return N=this._view.getUint32(this._offset),this._offset+=4,this._array(N);case 222:return N=this._view.getUint16(this._offset),this._offset+=2,this._map(N);case 223:return N=this._view.getUint32(this._offset),this._offset+=4,this._map(N)}throw new Error("Could not parse")},D.decode=function(G){var D=new N(G,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),T=D._parse();if(D._offset!==G.byteLength)throw new Error(G.byteLength-D._offset+" trailing bytes");return T};function T(G,D,N){for(var T=0,o=0,Z=N.length;o<Z;o++)(T=N.charCodeAt(o))<128?G.setUint8(D++,T):T<2048?(G.setUint8(D++,192|T>>6),G.setUint8(D++,128|63&T)):T<55296||T>=57344?(G.setUint8(D++,224|T>>12),G.setUint8(D++,128|T>>6&63),G.setUint8(D++,128|63&T)):(o++,T=65536+((1023&T)<<10|1023&N.charCodeAt(o)),G.setUint8(D++,240|T>>18),G.setUint8(D++,128|T>>12&63),G.setUint8(D++,128|T>>6&63),G.setUint8(D++,128|63&T))}function o(G,D,N){var T=typeof N,Z=0,n=0,C=0,P=0,r=0,v=0;if("string"===T){if(r=function(G){for(var D=0,N=0,T=0,o=G.length;T<o;T++)(D=G.charCodeAt(T))<128?N+=1:D<2048?N+=2:D<55296||D>=57344?N+=3:(T++,N+=4);return N}(N),r<32)G.push(160|r),v=1;else if(r<256)G.push(217,r),v=2;else if(r<65536)G.push(218,r>>8,r),v=3;else{if(!(r<4294967296))throw new Error("String too long");G.push(219,r>>24,r>>16,r>>8,r),v=5}return D.push({_str:N,_length:r,_offset:G.length}),v+r}if("number"===T)return Math.floor(N)===N&&isFinite(N)?N>=0?N<128?(G.push(N),1):N<256?(G.push(204,N),2):N<65536?(G.push(205,N>>8,N),3):N<4294967296?(G.push(206,N>>24,N>>16,N>>8,N),5):(C=N/Math.pow(2,32)|0,P=N>>>0,G.push(207,C>>24,C>>16,C>>8,C,P>>24,P>>16,P>>8,P),9):N>=-32?(G.push(N),1):N>=-128?(G.push(208,N),2):N>=-32768?(G.push(209,N>>8,N),3):N>=-2147483648?(G.push(210,N>>24,N>>16,N>>8,N),5):(C=Math.floor(N/Math.pow(2,32)),P=N>>>0,G.push(211,C>>24,C>>16,C>>8,C,P>>24,P>>16,P>>8,P),9):(G.push(203),D.push({_float:N,_length:8,_offset:G.length}),9);if("object"===T){if(null===N)return G.push(192),1;if(Array.isArray(N)){if((r=N.length)<16)G.push(144|r),v=1;else if(r<65536)G.push(220,r>>8,r),v=3;else{if(!(r<4294967296))throw new Error("Array too large");G.push(221,r>>24,r>>16,r>>8,r),v=5}for(Z=0;Z<r;Z++)v+=o(G,D,N[Z]);return v}if(N instanceof Date){var q=N.getTime(),g=Math.floor(q/1e3),X=1e6*(q-1e3*g);return g>=0&&X>=0&&g<=17179869183?0===X&&g<=4294967295?(G.push(214,255,g>>24,g>>16,g>>8,g),6):(C=g/4294967296,P=4294967295&g,G.push(215,255,X>>22,X>>14,X>>6,C,P>>24,P>>16,P>>8,P),10):(C=Math.floor(g/4294967296),P=g>>>0,G.push(199,12,255,X>>24,X>>16,X>>8,X,C>>24,C>>16,C>>8,C,P>>24,P>>16,P>>8,P),15)}if(N instanceof ArrayBuffer){if((r=N.byteLength)<256)G.push(196,r),v=2;else if(r<65536)G.push(197,r>>8,r),v=3;else{if(!(r<4294967296))throw new Error("Buffer too large");G.push(198,r>>24,r>>16,r>>8,r),v=5}return D.push({_bin:N,_length:r,_offset:G.length}),v+r}if("function"===typeof N.toJSON)return o(G,D,N.toJSON());var W=[],j="",Y=Object.keys(N);for(Z=0,n=Y.length;Z<n;Z++)void 0!==N[j=Y[Z]]&&"function"!==typeof N[j]&&W.push(j);if((r=W.length)<16)G.push(128|r),v=1;else if(r<65536)G.push(222,r>>8,r),v=3;else{if(!(r<4294967296))throw new Error("Object too large");G.push(223,r>>24,r>>16,r>>8,r),v=5}for(Z=0;Z<r;Z++)v+=o(G,D,j=W[Z]),v+=o(G,D,N[j]);return v}if("boolean"===T)return G.push(N?195:194),1;if("undefined"===T)return G.push(192),1;if("function"===typeof N.toJSON)return o(G,D,N.toJSON());throw new Error("Could not encode")}D.encode=function(G){var D=[],N=[],Z=o(D,N,G),n=new ArrayBuffer(Z),C=new DataView(n),P=0,r=0,v=-1;N.length>0&&(v=N[0]._offset);for(var q,g=0,X=0,W=0,j=D.length;W<j;W++)if(C.setUint8(r+W,D[W]),W+1===v){if(g=(q=N[P])._length,X=r+v,q._bin)for(var Y=new Uint8Array(q._bin),y=0;y<g;y++)C.setUint8(X+y,Y[y]);else q._str?T(C,X,q._str):void 0!==q._float&&C.setFloat64(X,q._float);r+=g,N[++P]&&(v=N[P]._offset)}return n}},11197:(G,D)=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.NoneSerializer=void 0;D.NoneSerializer=class{setState(G){}getState(){return null}patch(G){}teardown(){}handshake(G){}}},11188:(G,D,N)=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.SchemaSerializer=void 0;const T=N(11169);D.SchemaSerializer=class{setState(G){return this.state.decode(G)}getState(){return this.state}patch(G){return this.state.decode(G)}teardown(){var G,D;null===(D=null===(G=this.state)||void 0===G?void 0:G.$changes)||void 0===D||D.root.clearRefs()}handshake(G,D){if(this.state){(new T.Reflection).decode(G,D)}else this.state=T.Reflection.decode(G,D)}}},11149:(G,D)=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.getSerializer=D.registerSerializer=void 0;const N={};D.registerSerializer=function(G,D){N[G]=D},D.getSerializer=function(G){const D=N[G];if(!D)throw new Error("missing serializer: "+G);return D}},11126:function(G,D,N){"use strict";var T=this&&this.__importDefault||function(G){return G&&G.__esModule?G:{default:G}};Object.defineProperty(D,"__esModule",{value:!0}),D.WebSocketTransport=void 0;const o=T(N(11133)),Z=globalThis.WebSocket||o.default;D.WebSocketTransport=class{constructor(G){this.events=G}send(G){G instanceof ArrayBuffer?this.ws.send(G):Array.isArray(G)&&this.ws.send(new Uint8Array(G).buffer)}connect(G){this.ws=new Z(G,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(G,D){this.ws.close(G,D)}get isOpen(){return this.ws.readyState===Z.OPEN}}},11133:G=>{"use strict";G.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},11882:G=>{"use strict";function D(G,N,T){var o=0|G[T];if(o<=0)return[];var Z,n=new Array(o);if(T===G.length-1)for(Z=0;Z<o;++Z)n[Z]=N;else for(Z=0;Z<o;++Z)n[Z]=D(G,N,T+1);return n}G.exports=function(G,N){switch("undefined"===typeof N&&(N=0),typeof G){case"number":if(G>0)return function(G,D){var N,T;for(N=new Array(G),T=0;T<G;++T)N[T]=D;return N}(0|G,N);break;case"object":if("number"===typeof G.length)return D(G,N,0)}return[]}},11837:(G,D,N)=>{G.exports=function(){var G=this;this.components={},this.comps=this.components;var D=this.components,N=1,o={},Z=[],n=[],C={timeout:!1,removals:[],multiComps:[]};function P(G,N){var T=D[N],Z=o[N],n=Z.hash[G];n&&(Z.remove(G),T.ab&&(T.multi?(n.forEach((D=>{D&&T.ab(G,D)})),n.length=0):T.ab(G,n)),C.removals.push(Z),r())}function r(){C.timeout||(C.timeout=!0,setTimeout(v,1))}function v(){C.timeout=!1,q()}function q(){C.multiComps.length&&function(G){for(var D=0;D<G.length;D++){var{entID:N,data:T}=G[D],o=T.hash[N];if(o){for(var Z=0;Z<o.length;Z++)o[Z]||(o.splice(Z,1),Z--);0===o.length&&(T.remove(N),C.removals.push(T))}}G.length=0}(C.multiComps),C.removals.length&&function(G){for(var D=0;D<G.length;D++){G[D].flush()}G.length=0}(C.removals)}this.Ri=o,this._systems=Z,this._renderSystems=n,this.Kh=function(D){var T=N++;return Array.isArray(D)&&D.forEach((D=>G.Cf(T,D))),T},this.deleteEntity=function(D){return Object.keys(o).forEach((G=>{o[G].hash[D]&&P(D,G)})),G},this.Xh=function(G){if(!G)throw new Error("Missing component definition");var N=G.name;if(!N)throw new Error("Component definition must have a name property.");if("string"!==typeof N)throw new Error("Component name must be a string.");if(""===N)throw new Error("Component name must be a non-empty string.");if(o[N])throw new Error(`Component ${N} already exists.`);var C={};return C.name=N,C.multi=!!G.multi,C.order=isNaN(G.order)?99:G.order,C.stateConstructor=G.stateConstructor||null,C.state=G.state||{},C.Of=G.Of||null,C.ab=G.ab||null,C.system=G.system||null,C.mh=G.mh||null,D[N]=C,o[N]=new T,o[N]._pendingMultiCleanup=!1,o[N]._multiCleanupIDs=C.multi?[]:null,C.system&&(Z.push(N),Z.sort(((G,N)=>D[G].order-D[N].order))),C.mh&&(n.push(N),n.sort(((G,N)=>D[G].order-D[N].order))),N},this.overwriteComponent=function(G,N){var T=D[G];if(!T)throw new Error(`Unknown component: ${G}`);if(!N)throw new Error("Missing component definition");if(T.name!==N.name)throw new Error("Overwriting component must use the same name property.");var C={};C.name=G,C.multi=!!N.multi,C.order=isNaN(N.order)?99:N.order,C.state=N.state||{},C.Of=N.Of||null,C.ab=N.ab||null,C.system=N.system||null,C.mh=N.mh||null,D[G]=C,o[G]._pendingMultiCleanup=!1,o[G]._multiCleanupIDs=C.multi?[]:null;var P=Z.indexOf(G);C.system&&P<0&&Z.push(G),!C.system&&P>=0&&Z.splice(P,1),Z.sort(((G,N)=>D[G].order-D[N].order));var r=n.indexOf(G);C.mh&&r<0&&n.push(G),!C.mh&&r>=0&&n.splice(r,1),n.sort(((G,N)=>D[G].order-D[N].order));var v=C.state;return this.qh(G).forEach((G=>{for(var D in v)D in G||(G[D]=v[D]);C.Of&&C.Of(G.gh,G)})),G},this.deleteComponent=function(N){var T=o[N];if(!T)throw new Error(`Unknown component: ${N}`);T.flush(),T.list.forEach((G=>{G&&P(G.gh||G[0].gh,N)}));var C=Z.indexOf(N),r=n.indexOf(N);return C>-1&&Z.splice(C,1),r>-1&&n.splice(r,1),o[N].dispose(),delete o[N],delete D[N],G},this.Cf=function(G,N,T){var Z,n=D[N],C=o[N];if(!C)throw new Error(`Unknown component: ${N}.`);if(C.hash[G]&&!n.multi)throw new Error(`Entity ${G} already has component: ${N}.`);if(n.stateConstructor){if(!(Z=new n.stateConstructor).hasOwnProperty("gh"))throw new Error(`Component ${n.name} stateConstructor type does not have property __id`)}else Z=Object.assign({},{gh:G},n.state,T);if(Z.gh=G,n.multi){var P=C.hash[G];P||(P=[],C.add(G,P)),P.push(Z)}else C.add(G,Z);return n.Of&&n.Of(G,Z),this},this.Uf=function(G,D){var N=o[D];if(!N)throw new Error(`Unknown component: ${D}.`);return!!N.hash[G]},this.Hf=function(D,N){if(!o[N])throw new Error(`Unknown component: ${N}.`);return P(D,N),G},this.getState=function(G,D){var N=o[D];if(!N)throw new Error(`Unknown component: ${D}.`);return N.hash[G]},this.qh=function(G){var D=o[G];if(!D)throw new Error(`Unknown component: ${G}.`);return q(),D.list},this.yk=function(G){if(!o[G])throw new Error(`Unknown component: ${G}.`);var D=o[G].hash;return G=>D[G]},this.Bk=function(G){if(!o[G])throw new Error(`Unknown component: ${G}.`);var D=o[G].hash;return G=>!!D[G]},this.vf=function(N){q();for(var T=0;T<Z.length;T++){var n=Z[T],C=D[n],P=o[n];C.system(N,P.list),q()}return G},this.render=function(N){q();for(var T=0;T<n.length;T++){var Z=n[T],C=D[Z],P=o[Z];C.mh(N,P.list),q()}return G},this.removeMultiComponent=function(N,T,Z){var n=D[T],P=o[T];if(!P)throw new Error(`Unknown component: ${T}.`);if(!n.multi)throw new Error("removeMultiComponent called on non-multi component");return function(G,D,N,T){var o=N.hash[G];if(o){var Z=o[T];Z&&(o[T]=null,D.ab&&D.ab(G,Z),C.multiComps.push({entID:G,data:N}),r())}}(N,n,P,Z),G}};var T=N(11839)},11839:G=>{function D(G,D){var N=G._map[D];if(delete G.hash[D],delete G._map[D],N===G.list.length-1)G.list.pop();else{var T=G.list.pop();if(G.list[N]=T,null===T||null===T[0]){var o=G.list.length;for(var Z in G._map)if(G._map[Z]===o)return void(G._map[Z]=N)}else{var n=T.gh||T[0].gh;G._map[n]=N}}}G.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(G,D){if("number"===typeof this._map[G]){var N=this._map[G];this.hash[G]=D,this.list[N]=D}else this._map[G]=this.list.length,this.hash[G]=D,this.list.push(D)}remove(G){var D=this._map[G];this.hash[G]=null,this.list[D]=null,this._pendingRemovals.push(G)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var G=0;G<this._pendingRemovals.length;G++){var N=this._pendingRemovals[G];null===this.hash[N]&&D(this,N)}this._pendingRemovals.length=0}}},12091:G=>{"use strict";G.exports=function(G,D,N,T,o,Z){var n=+D[0],C=+D[1],P=+D[2],r=+N[0],v=+N[1],q=+N[2],g=Math.sqrt(r*r+v*v+q*q);if(0===g)throw new Error("Can't raycast along a zero vector");return function(G,D,N,T,o,Z,n,C,P,r){for(var v=0,q=Math.floor,g=0|q(D),X=0|q(N),W=0|q(T),j=o>0?1:-1,Y=Z>0?1:-1,y=n>0?1:-1,h=Math.abs(1/o),m=Math.abs(1/Z),R=Math.abs(1/n),L=h<1/0?h*(j>0?g+1-D:D-g):1/0,w=m<1/0?m*(Y>0?X+1-N:N-X):1/0,B=R<1/0?R*(y>0?W+1-T:T-W):1/0,F=-1;v<=C;){var S=G(g,X,W);if(S)return P&&(P[0]=D+v*o,P[1]=N+v*Z,P[2]=T+v*n),r&&(r[0]=r[1]=r[2]=0,0===F&&(r[0]=-j),1===F&&(r[1]=-Y),2===F&&(r[2]=-y)),S;L<w?L<B?(g+=j,v=L,L+=h,F=0):(W+=y,v=B,B+=R,F=2):w<B?(X+=Y,v=w,w+=m,F=1):(W+=y,v=B,B+=R,F=2)}return P&&(P[0]=D+v*o,P[1]=N+v*Z,P[2]=T+v*n),r&&(r[0]=r[1]=r[2]=0),0}(G,n,C,P,r/=g,v/=g,q/=g,T="undefined"===typeof T?64:+T,o,Z)}},12118:(G,D,N)=>{"use strict";N.d(D,{d:()=>Z});var T=N(702);function o(){this.yj=!1,this.stopPropagation=!1,this.zj=!1,this.disabled=!1}class Z{constructor(G,D){this.version="0.7.0";var N=Object.assign({},new o,D||{});this.element=G||document,this.yj=!!N.yj,this.stopPropagation=!!N.stopPropagation,this.zj=!!N.zj,this.disabled=!!N.disabled,this.filterEvents=(G,D)=>!0,this.down=new T.EventEmitter,this.up=new T.EventEmitter,this.state={},this.Zg={dx:0,dy:0,pk:0,Vg:0,qk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?C(this):document.addEventListener("DOMContentLoaded",(G=>{C(this)}),{once:!0})}bind(G){for(var D=arguments.length,N=new Array(D>1?D-1:0),T=1;T<D;T++)N[T-1]=arguments[T];N.forEach((D=>{var N=this._keyBindmap[D]||[];N.includes(G)||(N.push(G),this._keyBindmap[D]=N)})),this.state[G]=!!this.state[G],this.pressCount[G]=this.pressCount[G]||0,this.releaseCount[G]=this.releaseCount[G]||0}unbind(G){for(var D in this._keyBindmap){var N=this._keyBindmap[D],T=N.indexOf(G);T>-1&&N.splice(T,1)}}getBindings(){var G={};for(var D in this._keyBindmap){this._keyBindmap[D].forEach((N=>{G[N]=G[N]||[],G[N].push(D)}))}return G}vf(){n(this.Zg),n(this.pressCount),n(this.releaseCount)}}function n(G){for(var D in G)G[D]=0}function C(G){window.addEventListener("keydown",W.bind(null,G,!0),!1),window.addEventListener("keyup",W.bind(null,G,!1),!1);var D={passive:!0};G.element.addEventListener("touchstart",q.bind(void 0,G),{passive:!1}),G.element.addEventListener("touchend",X.bind(void 0,G),D),G.element.addEventListener("mousedown",j.bind(null,G,!0),D),window.document.addEventListener("mouseup",j.bind(null,G,!1),D),G.element.addEventListener("touchmove",Y.bind(null,G),D),G.element.addEventListener("mousemove",Y.bind(null,G),D),window.PointerEvent,G.element.addEventListener("wheel",y.bind(null,G),D),G.element.addEventListener("contextmenu",h.bind(null,G),!1),window.addEventListener("blur",m.bind(null,G),!1)}var P=0,r=0,v=null;function q(G,D){D.preventDefault(),g(D)}function g(G){let D=!1;for(let N=0;N<G.touches.length;++N)if(G.touches[N].identifier===v){D=!0;break}if(!D){const D=G.changedTouches[0];P=D.clientX,r=D.clientY,v=D.identifier}}function X(G,D){for(var N=D.changedTouches,T=0;T<N.length;++T)N[T].identifier===v&&(v=null)}function W(G,D,N){R(N.code,D,G,N)}function j(G,D,N){if("pointerId"in N)if(D){if(null!==G._touches.currID)return;G._touches.currID=N.pointerId}else{if(G._touches.currID!==N.pointerId)return;G._touches.currID=null}return R("Mouse"+("button"in N?N.button+1:1),D,G,N),!1}function Y(G,D){var N=D.movementX||D.mozMovementX||0,T=D.movementY||D.mozMovementY||0;if(D.touches&&0===(N|T)){var o=function(G){g(G);for(let D=0;D<G.changedTouches.length;++D)if(G.changedTouches[D].identifier==v){const N=G.changedTouches[D],T=[N.clientX-P,N.clientY-r];return P=N.clientX,r=N.clientY,T}return console.error(`Did not find touch id ${v}`),[0,0]}(D);N=o[0],T=o[1]}G.Zg.dx+=N,G.Zg.dy+=T}function y(G,D){var N=1;switch(D.deltaMode){case 0:N=1;break;case 1:N=12;break;case 2:N=G.element.clientHeight||window.innerHeight}G.Zg.pk+=(D.deltaX||0)*N,G.Zg.Vg+=(D.deltaY||0)*N,G.Zg.qk+=(D.deltaZ||0)*N}function h(G,D){if(!G.zj)return D.preventDefault(),!1}function m(G){for(var D in G._keyStates)G._keyStates[D]&&(/^Mouse\d/.test(D)||R(D,!1,G,{code:D,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function R(G,D,N,T){var o=N._keyBindmap[G];o&&(L(N._keyStates[G],D)&&(N._keyStates[G]=D,o.forEach((G=>{(!N.filterEvents||N.filterEvents(T,G))&&function(G,D,N,T){var o=D?N.pressCount:N.releaseCount;o[G]=(o[G]||0)+1;var Z=N._bindPressCount[G]||0;(Z+=D?1:-1)<0&&(Z=0);N._bindPressCount[G]=Z;var n=N.state[G];if(L(n,Z)){N.state[G]=Z>0;var C=D?N.down:N.up;N.disabled||C.emit(G,T)}}(G,D,N,T)}))),"button"in T||(N.yj&&!T.defaultPrevented&&T.preventDefault(),N.stopPropagation&&T.stopPropagation()))}function L(G,D){return G?!D:D}},11244:G=>{"use strict";G.exports=function(G){for(var D=new Array(G),N=0;N<G;++N)D[N]=N;return D}},11246:G=>{function D(G){return!!G.constructor&&"function"===typeof G.constructor.isBuffer&&G.constructor.isBuffer(G)}G.exports=function(G){return null!=G&&(D(G)||function(G){return"function"===typeof G.readFloatLE&&"function"===typeof G.slice&&D(G.slice(0,0))}(G)||!!G._isBuffer)}},12095:(G,D,N)=>{"use strict";N.d(D,{e:()=>T});class T{constructor(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.qi=!1,this.ri=!1,this.oi=30,this.pi=0,this.Ai=!1,this.fullscreen=!1,this.ti=function(G){},this.ui=function(){},this.yi=function(){},this.bb=function(){},this.wi=function(G){},this.onFullscreenChanged=function(G){},r((()=>{!function(G,D){G._nowObject=performance||Date,G._lastTick=0,G._renderAccum=0,G._rt=0,G._frameCB=C.bind(null,G),requestAnimationFrame(G._frameCB),D>0&&(G._intervalCB=n.bind(null,G),G._interval=setInterval(G._intervalCB,Math.max(D,1e3/G.oi/2)))}(this,D),function(G,D){if(!D)return;var N=!1,T=!1;document.addEventListener("pointerlockchange",(T=>{N=document.pointerLockElement===D,G.wi(N)})),document.addEventListener("fullscreenchange",(N=>{T=document.fullscreenElement===D,G.onFullscreenChanged(T)})),Object.defineProperty(G,"Ai",{get:()=>N,set:G=>{G&&!N?P(D):N&&!G&&function(G){G.exitPointerLock&&G.exitPointerLock()}(document)}}),Object.defineProperty(G,"fullscreen",{get:()=>T,set:G=>{G&&!T?D.requestFullscreen():T&&!G&&document.exitFullscreen()}}),D.addEventListener("click",(o=>{G.qi&&!N&&P(D),G.ri&&!T&&D.requestFullscreen()}));var o=()=>G.bb();if(window.ResizeObserver){new ResizeObserver(o).observe(D)}else window.addEventListener("resize",o)}(this,G),this.yi()}))}}var o=3,Z=20;function n(G){for(var D=1e3/G.oi,N=G._nowObject.now()+Z,T=0;G._nowObject.now()>=G._lastTick+D&&G._nowObject.now()<N&&++T<=o;)G.ti(D),G._lastTick+=D;var n=5*(D+5),C=G._nowObject.now();if(C-G._lastTick>n)for(;C>=G._lastTick+D;)G._lastTick+=D}function C(G){requestAnimationFrame(G._frameCB),n(G);var D=G._nowObject.now(),N=D-G._rt;if(G._rt=D,G.pi>0){G._renderAccum+=N;var T=1e3/G.pi;if(G._renderAccum<T)return;G._renderAccum=Math.min(G._renderAccum-T,T)}var o=1e3/G.oi,Z=(D-G._lastTick)/o;G.ui(N,Z,o)}function P(G){G.requestPointerLock&&G.requestPointerLock()}var r=G=>{if("loading"===document.readyState){var D=()=>{document.removeEventListener("readystatechange",D),G()};document.addEventListener("readystatechange",D)}else setTimeout(G,1)}},11241:(G,D,N)=>{var T=N(11244),o=N(11246),Z="undefined"!==typeof Float64Array;function n(G,D){return G[0]-D[0]}function C(){var G,D=this.stride,N=new Array(D.length);for(G=0;G<N.length;++G)N[G]=[Math.abs(D[G]),G];N.sort(n);var T=new Array(N.length);for(G=0;G<T.length;++G)T[G]=N[G][1];return T}function P(G,D){var N=["View",D,"d",G].join("");D<0&&(N="View_Nil"+G);var o="generic"===G;if(-1===D){var Z="function "+N+"(a){this.data=a;};var proto="+N+".prototype;proto.dtype='"+G+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+N+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+N+"(a){return new "+N+"(a);}";return new Function(Z)()}if(0===D){Z="function "+N+"(a,d) {this.data = a;this.offset = d};var proto="+N+".prototype;proto.dtype='"+G+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+N+"_copy() {return new "+N+"(this.data,this.offset)};proto.pick=function "+N+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+N+"_get(){return "+(o?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+N+"_set(v){return "+(o?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+N+"(a,b,c,d){return new "+N+"(a,d)}";return new Function("TrivialArray",Z)(r[G][0])}Z=["'use strict'"];var n=T(D),P=n.map((function(G){return"i"+G})),v="this.offset+"+n.map((function(G){return"this.stride["+G+"]*i"+G})).join("+"),q=n.map((function(G){return"b"+G})).join(","),g=n.map((function(G){return"c"+G})).join(",");Z.push("function "+N+"(a,"+q+","+g+",d){this.data=a","this.shape=["+q+"]","this.stride=["+g+"]","this.offset=d|0}","var proto="+N+".prototype","proto.dtype='"+G+"'","proto.dimension="+D),Z.push("Object.defineProperty(proto,'size',{get:function "+N+"_size(){return "+n.map((function(G){return"this.shape["+G+"]"})).join("*"),"}})"),1===D?Z.push("proto.order=[0]"):(Z.push("Object.defineProperty(proto,'order',{get:"),D<4?(Z.push("function "+N+"_order(){"),2===D?Z.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===D&&Z.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):Z.push("ORDER})")),Z.push("proto.set=function "+N+"_set("+P.join(",")+",v){"),o?Z.push("return this.data.set("+v+",v)}"):Z.push("return this.data["+v+"]=v}"),Z.push("proto.get=function "+N+"_get("+P.join(",")+"){"),o?Z.push("return this.data.get("+v+")}"):Z.push("return this.data["+v+"]}"),Z.push("proto.index=function "+N+"_index(",P.join(),"){return "+v+"}"),Z.push("proto.hi=function "+N+"_hi("+P.join(",")+"){return new "+N+"(this.data,"+n.map((function(G){return["(typeof i",G,"!=='number'||i",G,"<0)?this.shape[",G,"]:i",G,"|0"].join("")})).join(",")+","+n.map((function(G){return"this.stride["+G+"]"})).join(",")+",this.offset)}");var X=n.map((function(G){return"a"+G+"=this.shape["+G+"]"})),W=n.map((function(G){return"c"+G+"=this.stride["+G+"]"}));Z.push("proto.lo=function "+N+"_lo("+P.join(",")+"){var b=this.offset,d=0,"+X.join(",")+","+W.join(","));for(var j=0;j<D;++j)Z.push("if(typeof i"+j+"==='number'&&i"+j+">=0){d=i"+j+"|0;b+=c"+j+"*d;a"+j+"-=d}");Z.push("return new "+N+"(this.data,"+n.map((function(G){return"a"+G})).join(",")+","+n.map((function(G){return"c"+G})).join(",")+",b)}"),Z.push("proto.step=function "+N+"_step("+P.join(",")+"){var "+n.map((function(G){return"a"+G+"=this.shape["+G+"]"})).join(",")+","+n.map((function(G){return"b"+G+"=this.stride["+G+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(j=0;j<D;++j)Z.push("if(typeof i"+j+"==='number'){d=i"+j+"|0;if(d<0){c+=b"+j+"*(a"+j+"-1);a"+j+"=ceil(-a"+j+"/d)}else{a"+j+"=ceil(a"+j+"/d)}b"+j+"*=d}");Z.push("return new "+N+"(this.data,"+n.map((function(G){return"a"+G})).join(",")+","+n.map((function(G){return"b"+G})).join(",")+",c)}");var Y=new Array(D),y=new Array(D);for(j=0;j<D;++j)Y[j]="a[i"+j+"]",y[j]="b[i"+j+"]";Z.push("proto.transpose=function "+N+"_transpose("+P+"){"+P.map((function(G,D){return G+"=("+G+"===undefined?"+D+":"+G+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+N+"(this.data,"+Y.join(",")+","+y.join(",")+",this.offset)}"),Z.push("proto.pick=function "+N+"_pick("+P+"){var a=[],b=[],c=this.offset");for(j=0;j<D;++j)Z.push("if(typeof i"+j+"==='number'&&i"+j+">=0){c=(c+this.stride["+j+"]*i"+j+")|0}else{a.push(this.shape["+j+"]);b.push(this.stride["+j+"])}");return Z.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),Z.push("return function construct_"+N+"(data,shape,stride,offset){return new "+N+"(data,"+n.map((function(G){return"shape["+G+"]"})).join(",")+","+n.map((function(G){return"stride["+G+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",Z.join("\n"))(r[G],C)}var r={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};G.exports=function(G,D,N,T){if(void 0===G)return(0,r.array[0])([]);"number"===typeof G&&(G=[G]),void 0===D&&(D=[G.length]);var n=D.length;if(void 0===N){N=new Array(n);for(var C=n-1,v=1;C>=0;--C)N[C]=v,v*=D[C]}if(void 0===T){T=0;for(C=0;C<n;++C)N[C]<0&&(T-=(D[C]-1)*N[C])}for(var q=function(G){if(o(G))return"buffer";if(Z)switch(Object.prototype.toString.call(G)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(G)?"array":"generic"}(G),g=r[q];g.length<=n+1;)g.push(P(q,g.length-1));return(0,g[n+1])(G,D,N,T)}},11216:G=>{var D;self,D=()=>(()=>{"use strict";var G={d:(D,N)=>{for(var T in N)G.o(N,T)&&!G.o(D,T)&&Object.defineProperty(D,T,{enumerable:!0,get:N[T]})},o:(G,D)=>Object.prototype.hasOwnProperty.call(G,D)},D={};G.d(D,{default:()=>t});var N,T=function(G,D){var N=D.x-G.x,T=D.y-G.y;return Math.sqrt(N*N+T*T)},o=function(G){return G*(Math.PI/180)},Z=new Map,n=function(G){Z.has(G)&&clearTimeout(Z.get(G)),Z.set(G,setTimeout(G,100))},C=function(G,D,N){for(var T,o=D.split(/[ ,]+/g),Z=0;Z<o.length;Z+=1)T=o[Z],G.addEventListener?G.addEventListener(T,N,!1):G.attachEvent&&G.attachEvent(T,N)},P=function(G,D,N){for(var T,o=D.split(/[ ,]+/g),Z=0;Z<o.length;Z+=1)T=o[Z],G.removeEventListener?G.removeEventListener(T,N):G.detachEvent&&G.detachEvent(T,N)},r=function(G){return G.preventDefault(),G.type.match(/^touch/)?G.changedTouches:G},v=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},q=function(G,D){D.top||D.right||D.bottom||D.left?(G.style.top=D.top,G.style.right=D.right,G.style.bottom=D.bottom,G.style.left=D.left):(G.style.left=D.x+"px",G.style.top=D.y+"px")},g=function(G,D,N){var T=X(G);for(var o in T)if(T.hasOwnProperty(o))if("string"==typeof D)T[o]=D+" "+N;else{for(var Z="",n=0,C=D.length;n<C;n+=1)Z+=D[n]+" "+N+", ";T[o]=Z.slice(0,-2)}return T},X=function(G){var D={};return D[G]="",["webkit","Moz","o"].forEach((function(N){D[N+G.charAt(0).toUpperCase()+G.slice(1)]=""})),D},W=function(G,D){for(var N in D)D.hasOwnProperty(N)&&(G[N]=D[N]);return G},j=function(G,D){if(G.length)for(var N=0,T=G.length;N<T;N+=1)D(G[N]);else D(G)},Y="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,y=window.matchMedia("(any-hover: none)").matches,h=!!("ontouchstart"in window),m=!!window.PointerEvent,R=!!window.MSPointerEvent,L={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},w={start:"mousedown",move:"mousemove",end:"mouseup"},B={};function F(){}Y&&!y?N=L:m?N={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:R?N={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:h?(N=L,B=w):N=w,F.prototype.on=function(G,D){var N,T=this,o=G.split(/[ ,]+/g);T._handlers_=T._handlers_||{};for(var Z=0;Z<o.length;Z+=1)N=o[Z],T._handlers_[N]=T._handlers_[N]||[],T._handlers_[N].push(D);return T},F.prototype.off=function(G,D){var N=this;return N._handlers_=N._handlers_||{},void 0===G?N._handlers_={}:void 0===D?N._handlers_[G]=null:N._handlers_[G]&&N._handlers_[G].indexOf(D)>=0&&N._handlers_[G].splice(N._handlers_[G].indexOf(D),1),N},F.prototype.trigger=function(G,D){var N,T=this,o=G.split(/[ ,]+/g);T._handlers_=T._handlers_||{};for(var Z=0;Z<o.length;Z+=1)N=o[Z],T._handlers_[N]&&T._handlers_[N].length&&T._handlers_[N].forEach((function(G){G.call(T,{type:N,target:T},D)}))},F.prototype.config=function(G){var D=this;D.options=D.defaults||{},G&&(D.options=function(G,D){var N={};for(var T in G)G.hasOwnProperty(T)&&D.hasOwnProperty(T)?N[T]=D[T]:G.hasOwnProperty(T)&&(N[T]=G[T]);return N}(D.options,G))},F.prototype.bindEvt=function(G,D){var T=this;return T._domHandlers_=T._domHandlers_||{},T._domHandlers_[D]=function(){"function"==typeof T["on"+D]?T["on"+D].apply(T,arguments):console.warn('[WARNING] : Missing "on'+D+'" handler.')},C(G,N[D],T._domHandlers_[D]),B[D]&&C(G,B[D],T._domHandlers_[D]),T},F.prototype.unbindEvt=function(G,D){var T=this;return T._domHandlers_=T._domHandlers_||{},P(G,N[D],T._domHandlers_[D]),B[D]&&P(G,B[D],T._domHandlers_[D]),delete T._domHandlers_[D],this};const S=F;function V(G,D){return this.identifier=D.identifier,this.position=D.position,this.frontPosition=D.frontPosition,this.collection=G,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(D),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=V.id,V.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}V.prototype=new S,V.constructor=V,V.id=0,V.prototype.buildEl=function(G){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},V.prototype.stylize=function(){if(this.options.dataOnly)return this;var G=this.options.fadeTime+"ms",D=function(){var G=X("borderRadius");for(var D in G)G.hasOwnProperty(D)&&(G[D]="50%");return G}(),N=g("transition","opacity",G),T={};return T.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},T.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},T.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},W(T.el,N),"circle"===this.options.shape&&W(T.back,D),W(T.front,D),this.applyStyles(T),this},V.prototype.applyStyles=function(G){for(var D in this.ui)if(this.ui.hasOwnProperty(D))for(var N in G[D])this.ui[D].style[N]=G[D][N];return this},V.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},V.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},V.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},V.prototype.show=function(G){var D=this;return D.options.dataOnly||(clearTimeout(D.removeTimeout),clearTimeout(D.showTimeout),clearTimeout(D.restTimeout),D.addToDom(),D.restCallback(),setTimeout((function(){D.ui.el.style.opacity=1}),0),D.showTimeout=setTimeout((function(){D.trigger("shown",D.instance),"function"==typeof G&&G.call(this)}),D.options.fadeTime)),D},V.prototype.hide=function(G){var D=this;if(D.options.dataOnly)return D;if(D.ui.el.style.opacity=D.options.restOpacity,clearTimeout(D.removeTimeout),clearTimeout(D.showTimeout),clearTimeout(D.restTimeout),D.removeTimeout=setTimeout((function(){var N="dynamic"===D.options.mode?"none":"block";D.ui.el.style.display=N,"function"==typeof G&&G.call(D),D.trigger("hidden",D.instance)}),D.options.fadeTime),D.options.restJoystick){var N=D.options.restJoystick,T={};T.x=!0===N||!1!==N.x?0:D.instance.frontPosition.x,T.y=!0===N||!1!==N.y?0:D.instance.frontPosition.y,D.setPosition(G,T)}return D},V.prototype.setPosition=function(G,D){var N=this;N.frontPosition={x:D.x,y:D.y};var T=N.options.fadeTime+"ms",o={};o.front=g("transition",["transform"],T);var Z={front:{}};Z.front={transform:"translate("+N.frontPosition.x+"px,"+N.frontPosition.y+"px)"},N.applyStyles(o),N.applyStyles(Z),N.restTimeout=setTimeout((function(){"function"==typeof G&&G.call(N),N.restCallback()}),N.options.fadeTime)},V.prototype.restCallback=function(){var G=this,D={};D.front=g("transition","none",""),G.applyStyles(D),G.trigger("rested",G.instance)},V.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},V.prototype.computeDirection=function(G){var D,N,T,o=G.angle.radian,Z=Math.PI/4,n=Math.PI/2;if(o>Z&&o<3*Z&&!G.lockX?D="up":o>-Z&&o<=Z&&!G.lockY?D="left":o>3*-Z&&o<=-Z&&!G.lockX?D="down":G.lockY||(D="right"),G.lockY||(N=o>-n&&o<n?"left":"right"),G.lockX||(T=o>0?"up":"down"),G.force>this.options.threshold){var C,P={};for(C in this.direction)this.direction.hasOwnProperty(C)&&(P[C]=this.direction[C]);var r={};for(C in this.direction={x:N,y:T,angle:D},G.direction=this.direction,P)P[C]===this.direction[C]&&(r[C]=!0);if(r.x&&r.y&&r.angle)return G;r.x&&r.y||this.trigger("plain",G),r.x||this.trigger("plain:"+N,G),r.y||this.trigger("plain:"+T,G),r.angle||this.trigger("dir dir:"+D,G)}else this.resetDirection();return G};const U=V;function z(G,D){var N=this;N.nipples=[],N.idles=[],N.actives=[],N.ids=[],N.pressureIntervals={},N.manager=G,N.id=z.id,z.id+=1,N.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},N.config(D),"static"!==N.options.mode&&"semi"!==N.options.mode||(N.options.multitouch=!1),N.options.multitouch||(N.options.maxNumberOfNipples=1);var T=getComputedStyle(N.options.zone.parentElement);return T&&"flex"===T.display&&(N.parentIsFlex=!0),N.updateBox(),N.prepareNipples(),N.Aj(),N.begin(),N.nipples}z.prototype=new S,z.constructor=z,z.id=0,z.prototype.prepareNipples=function(){var G=this,D=G.nipples;D.on=G.on.bind(G),D.off=G.off.bind(G),D.options=G.options,D.destroy=G.destroy.bind(G),D.ids=G.ids,D.id=G.id,D.processOnMove=G.processOnMove.bind(G),D.processOnEnd=G.processOnEnd.bind(G),D.get=function(G){if(void 0===G)return D[0];for(var N=0,T=D.length;N<T;N+=1)if(D[N].identifier===G)return D[N];return!1}},z.prototype.Aj=function(){var G=this;G.bindEvt(G.options.zone,"start"),G.options.zone.style.touchAction="none",G.options.zone.style.msTouchAction="none"},z.prototype.begin=function(){var G=this,D=G.options;if("static"===D.mode){var N=G.createNipple(D.position,G.manager.getIdentifier());N.add(),G.idles.push(N)}},z.prototype.createNipple=function(G,D){var N=this,T=N.manager.scroll,o={},Z=N.options,n=N.parentIsFlex?T.x:T.x+N.box.left,C=N.parentIsFlex?T.y:T.y+N.box.top;if(G.x&&G.y)o={x:G.x-n,y:G.y-C};else if(G.top||G.right||G.bottom||G.left){var P=document.createElement("DIV");P.style.display="hidden",P.style.top=G.top,P.style.right=G.right,P.style.bottom=G.bottom,P.style.left=G.left,P.style.position="absolute",Z.zone.appendChild(P);var r=P.getBoundingClientRect();Z.zone.removeChild(P),o=G,G={x:r.left+T.x,y:r.top+T.y}}var v=new U(N,{color:Z.color,size:Z.size,threshold:Z.threshold,fadeTime:Z.fadeTime,dataOnly:Z.dataOnly,restJoystick:Z.restJoystick,restOpacity:Z.restOpacity,mode:Z.mode,identifier:D,position:G,zone:Z.zone,frontPosition:{x:0,y:0},shape:Z.shape});return Z.dataOnly||(q(v.ui.el,o),q(v.ui.front,v.frontPosition)),N.nipples.push(v),N.trigger("added "+v.identifier+":added",v),N.manager.trigger("added "+v.identifier+":added",v),N.bindNipple(v),v},z.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},z.prototype.bindNipple=function(G){var D,N=this,T=function(G,T){D=G.type+" "+T.id+":"+G.type,N.trigger(D,T)};G.on("destroyed",N.onDestroyed.bind(N)),G.on("shown hidden rested dir plain",T),G.on("dir:up dir:right dir:down dir:left",T),G.on("plain:up plain:right plain:down plain:left",T)},z.prototype.pressureFn=function(G,D,N){var T=this,o=0;clearInterval(T.pressureIntervals[N]),T.pressureIntervals[N]=setInterval(function(){var N=G.force||G.pressure||G.webkitForce||0;N!==o&&(D.trigger("pressure",N),T.trigger("pressure "+D.identifier+":pressure",N),o=N)}.bind(T),100)},z.prototype.onstart=function(G){var D=this,N=D.options,T=G;return G=r(G),D.updateBox(),j(G,(function(o){D.actives.length<N.maxNumberOfNipples?D.processOnStart(o):T.type.match(/^touch/)&&(Object.keys(D.manager.ids).forEach((function(N){if(Object.values(T.touches).findIndex((function(G){return G.identifier===N}))<0){var o=[G[0]];o.identifier=N,D.processOnEnd(o)}})),D.actives.length<N.maxNumberOfNipples&&D.processOnStart(o))})),D.manager.bindDocument(),!1},z.prototype.processOnStart=function(G){var D,N=this,o=N.options,Z=N.manager.getIdentifier(G),n=G.force||G.pressure||G.webkitForce||0,C={x:G.pageX,y:G.pageY},P=N.getOrCreate(Z,C);P.identifier!==Z&&N.manager.removeIdentifier(P.identifier),P.identifier=Z;var r=function(D){D.trigger("start",D),N.trigger("start "+D.id+":start",D),D.show(),n>0&&N.pressureFn(G,D,D.identifier),N.processOnMove(G)};if((D=N.idles.indexOf(P))>=0&&N.idles.splice(D,1),N.actives.push(P),N.ids.push(P.identifier),"semi"!==o.mode)r(P);else{if(!(T(C,P.position)<=o.catchDistance))return P.destroy(),void N.processOnStart(G);r(P)}return P},z.prototype.getOrCreate=function(G,D){var N,T=this,o=T.options;return/(semi|static)/.test(o.mode)?(N=T.idles[0])?(T.idles.splice(0,1),N):"semi"===o.mode?T.createNipple(D,G):(console.warn("Coudln't find the needed nipple."),!1):N=T.createNipple(D,G)},z.prototype.processOnMove=function(G){var D=this,N=D.options,Z=D.manager.getIdentifier(G),n=D.nipples.get(Z),C=D.manager.scroll;if(function(G){return isNaN(G.buttons)?0!==G.pressure:0!==G.buttons}(G)){if(!n)return console.error("Found zombie joystick with ID "+Z),void D.manager.removeIdentifier(Z);if(N.dynamicPage){var P=n.el.getBoundingClientRect();n.position={x:C.x+P.left,y:C.y+P.top}}n.identifier=Z;var r=n.options.size/2,v={x:G.pageX,y:G.pageY};N.lockX&&(v.y=n.position.y),N.lockY&&(v.x=n.position.x);var q,g,X,W,j,Y,y,h,m,R,L=T(v,n.position),w=(q=v,X=(g=n.position).x-q.x,W=g.y-q.y,function(G){return G*(180/Math.PI)}(Math.atan2(W,X))),B=o(w),F=L/r,S={distance:L,position:v};if("circle"===n.options.shape?(j=Math.min(L,r),y=n.position,h=j,R={x:0,y:0},m=o(m=w),R.x=y.x-h*Math.cos(m),R.y=y.y-h*Math.sin(m),Y=R):(Y=function(G,D,N){return{x:Math.min(Math.max(G.x,D.x-N),D.x+N),y:Math.min(Math.max(G.y,D.y-N),D.y+N)}}(v,n.position,r),j=T(Y,n.position)),N.follow){if(L>r){var V=v.x-Y.x,U=v.y-Y.y;n.position.x+=V,n.position.y+=U,n.el.style.top=n.position.y-(D.box.top+C.y)+"px",n.el.style.left=n.position.x-(D.box.left+C.x)+"px",L=T(v,n.position)}}else v=Y,L=j;var z=v.x-n.position.x,i=v.y-n.position.y;n.frontPosition={x:z,y:i},N.dataOnly||(n.ui.front.style.transform="translate("+z+"px,"+i+"px)");var J={identifier:n.identifier,position:v,force:F,pressure:G.force||G.pressure||G.webkitForce||0,distance:L,angle:{radian:B,degree:w},vector:{x:z/r,y:-i/r},raw:S,instance:n,lockX:N.lockX,lockY:N.lockY};(J=n.computeDirection(J)).angle={radian:o(180-w),degree:180-w},n.trigger("move",J),D.trigger("move "+n.id+":move",J)}else this.processOnEnd(G)},z.prototype.processOnEnd=function(G){var D=this,N=D.options,T=D.manager.getIdentifier(G),o=D.nipples.get(T),Z=D.manager.removeIdentifier(o.identifier);o&&(N.dataOnly||o.hide((function(){"dynamic"===N.mode&&(o.trigger("removed",o),D.trigger("removed "+o.id+":removed",o),D.manager.trigger("removed "+o.id+":removed",o),o.destroy())})),clearInterval(D.pressureIntervals[o.identifier]),o.resetDirection(),o.trigger("end",o),D.trigger("end "+o.id+":end",o),D.ids.indexOf(o.identifier)>=0&&D.ids.splice(D.ids.indexOf(o.identifier),1),D.actives.indexOf(o)>=0&&D.actives.splice(D.actives.indexOf(o),1),/(semi|static)/.test(N.mode)?D.idles.push(o):D.nipples.indexOf(o)>=0&&D.nipples.splice(D.nipples.indexOf(o),1),D.manager.unbindDocument(),/(semi|static)/.test(N.mode)&&(D.manager.ids[Z.id]=Z.identifier))},z.prototype.onDestroyed=function(G,D){var N=this;N.nipples.indexOf(D)>=0&&N.nipples.splice(N.nipples.indexOf(D),1),N.actives.indexOf(D)>=0&&N.actives.splice(N.actives.indexOf(D),1),N.idles.indexOf(D)>=0&&N.idles.splice(N.idles.indexOf(D),1),N.ids.indexOf(D.identifier)>=0&&N.ids.splice(N.ids.indexOf(D.identifier),1),N.manager.removeIdentifier(D.identifier),N.manager.unbindDocument()},z.prototype.destroy=function(){var G=this;for(var D in G.unbindEvt(G.options.zone,"start"),G.nipples.forEach((function(G){G.destroy()})),G.pressureIntervals)G.pressureIntervals.hasOwnProperty(D)&&clearInterval(G.pressureIntervals[D]);G.trigger("destroyed",G.nipples),G.manager.unbindDocument(),G.off()};const i=z;function J(G){var D=this;D.ids={},D.index=0,D.collections=[],D.scroll=v(),D.config(G),D.prepareCollections();var N=function(){var G;D.collections.forEach((function(N){N.forEach((function(N){G=N.el.getBoundingClientRect(),N.position={x:D.scroll.x+G.left,y:D.scroll.y+G.top}}))}))};C(window,"resize",(function(){n(N)}));var T=function(){D.scroll=v()};return C(window,"scroll",(function(){n(T)})),D.collections}J.prototype=new S,J.constructor=J,J.prototype.prepareCollections=function(){var G=this;G.collections.create=G.create.bind(G),G.collections.on=G.on.bind(G),G.collections.off=G.off.bind(G),G.collections.destroy=G.destroy.bind(G),G.collections.get=function(D){var N;return G.collections.every((function(G){return!(N=G.get(D))})),N}},J.prototype.create=function(G){return this.createCollection(G)},J.prototype.createCollection=function(G){var D=this,N=new i(D,G);return D.bindCollection(N),D.collections.push(N),N},J.prototype.bindCollection=function(G){var D,N=this,T=function(G,T){D=G.type+" "+T.id+":"+G.type,N.trigger(D,T)};G.on("destroyed",N.onDestroyed.bind(N)),G.on("shown hidden rested dir plain",T),G.on("dir:up dir:right dir:down dir:left",T),G.on("plain:up plain:right plain:down plain:left",T)},J.prototype.bindDocument=function(){var G=this;G.binded||(G.bindEvt(document,"move").bindEvt(document,"end"),G.binded=!0)},J.prototype.unbindDocument=function(G){var D=this;Object.keys(D.ids).length&&!0!==G||(D.unbindEvt(document,"move").unbindEvt(document,"end"),D.binded=!1)},J.prototype.getIdentifier=function(G){var D;return G?void 0===(D=void 0===G.identifier?G.pointerId:G.identifier)&&(D=this.latest||0):D=this.index,void 0===this.ids[D]&&(this.ids[D]=this.index,this.index+=1),this.latest=D,this.ids[D]},J.prototype.removeIdentifier=function(G){var D={};for(var N in this.ids)if(this.ids[N]===G){D.id=N,D.identifier=this.ids[N],delete this.ids[N];break}return D},J.prototype.onmove=function(G){return this.onAny("move",G),!1},J.prototype.onend=function(G){return this.onAny("end",G),!1},J.prototype.oncancel=function(G){return this.onAny("end",G),!1},J.prototype.onAny=function(G,D){var N,T=this,o="processOn"+G.charAt(0).toUpperCase()+G.slice(1);D=r(D);var Z=function(G,D,N){N.ids.indexOf(D)>=0&&(N[o](G),G._found_=!0)};return j(D,(function(G){N=T.getIdentifier(G),j(T.collections,Z.bind(null,G,N)),G._found_||T.removeIdentifier(N)})),!1},J.prototype.destroy=function(){var G=this;G.unbindDocument(!0),G.ids={},G.index=0,G.collections.forEach((function(G){G.destroy()})),G.off()},J.prototype.onDestroyed=function(G,D){var N=this;if(N.collections.indexOf(D)<0)return!1;N.collections.splice(N.collections.indexOf(D),1)};var p=new J;const t={create:function(G){return p.create(G)},factory:p};return D.default})(),G.exports=D()},11265:(G,D,N)=>{"use strict";const{Deflate:T,deflate:o,deflateRaw:Z,gzip:n}=N(11268),{Inflate:C,inflate:P,inflateRaw:r,ungzip:v}=N(11324),q=N(11301);G.exports.Deflate=T,G.exports.deflate=o,G.exports.deflateRaw=Z,G.exports.gzip=n,G.exports.Inflate=C,G.exports.inflate=P,G.exports.inflateRaw=r,G.exports.ungzip=v,G.exports.constants=q},11268:(G,D,N)=>{"use strict";const T=N(11272),o=N(11306),Z=N(11312),n=N(11295),C=N(11315),P=Object.prototype.toString,{Z_NO_FLUSH:r,Z_SYNC_FLUSH:v,Z_FULL_FLUSH:q,Z_FINISH:g,Z_OK:X,Z_STREAM_END:W,Z_DEFAULT_COMPRESSION:j,Z_DEFAULT_STRATEGY:Y,Z_DEFLATED:y}=N(11301);function h(G){this.options=o.assign({level:j,method:y,Ja:16384,windowBits:15,memLevel:8,strategy:Y},G||{});let D=this.options;D.raw&&D.windowBits>0?D.windowBits=-D.windowBits:D.gzip&&D.windowBits>0&&D.windowBits<16&&(D.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new C,this.strm.avail_out=0;let N=T.deflateInit2(this.strm,D.level,D.method,D.windowBits,D.memLevel,D.strategy);if(N!==X)throw new Error(n[N]);if(D.header&&T.deflateSetHeader(this.strm,D.header),D.dictionary){let G;if(G="string"===typeof D.dictionary?Z.string2buf(D.dictionary):"[object ArrayBuffer]"===P.call(D.dictionary)?new Uint8Array(D.dictionary):D.dictionary,N=T.deflateSetDictionary(this.strm,G),N!==X)throw new Error(n[N]);this._dict_set=!0}}function m(G,D){const N=new h(D);if(N.push(G,!0),N.err)throw N.msg||n[N.err];return N.result}h.prototype.push=function(G,D){const N=this.strm,o=this.options.Ja;let n,C;if(this.ended)return!1;for(C=D===~~D?D:!0===D?g:r,"string"===typeof G?N.input=Z.string2buf(G):"[object ArrayBuffer]"===P.call(G)?N.input=new Uint8Array(G):N.input=G,N.next_in=0,N.avail_in=N.input.length;;)if(0===N.avail_out&&(N.output=new Uint8Array(o),N.next_out=0,N.avail_out=o),(C===v||C===q)&&N.avail_out<=6)this.onData(N.output.subarray(0,N.next_out)),N.avail_out=0;else{if(n=T.deflate(N,C),n===W)return N.next_out>0&&this.onData(N.output.subarray(0,N.next_out)),n=T.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===X;if(0!==N.avail_out){if(C>0&&N.next_out>0)this.onData(N.output.subarray(0,N.next_out)),N.avail_out=0;else if(0===N.avail_in)break}else this.onData(N.output)}return!0},h.prototype.onData=function(G){this.chunks.push(G)},h.prototype.onEnd=function(G){G===X&&(this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=G,this.msg=this.strm.msg},G.exports.Deflate=h,G.exports.deflate=m,G.exports.deflateRaw=function(G,D){return(D=D||{}).raw=!0,m(G,D)},G.exports.gzip=function(G,D){return(D=D||{}).gzip=!0,m(G,D)},G.exports.constants=N(11301)},11324:(G,D,N)=>{"use strict";const T=N(11333),o=N(11306),Z=N(11312),n=N(11295),C=N(11315),P=N(11351),r=Object.prototype.toString,{Z_NO_FLUSH:v,Z_FINISH:q,Z_OK:g,Z_STREAM_END:X,Z_NEED_DICT:W,Z_STREAM_ERROR:j,Z_DATA_ERROR:Y,Z_MEM_ERROR:y}=N(11301);function h(G){this.options=o.assign({Ja:65536,windowBits:15,to:""},G||{});const D=this.options;D.raw&&D.windowBits>=0&&D.windowBits<16&&(D.windowBits=-D.windowBits,0===D.windowBits&&(D.windowBits=-15)),!(D.windowBits>=0&&D.windowBits<16)||G&&G.windowBits||(D.windowBits+=32),D.windowBits>15&&D.windowBits<48&&0===(15&D.windowBits)&&(D.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new C,this.strm.avail_out=0;let N=T.inflateInit2(this.strm,D.windowBits);if(N!==g)throw new Error(n[N]);if(this.header=new P,T.inflateGetHeader(this.strm,this.header),D.dictionary&&("string"===typeof D.dictionary?D.dictionary=Z.string2buf(D.dictionary):"[object ArrayBuffer]"===r.call(D.dictionary)&&(D.dictionary=new Uint8Array(D.dictionary)),D.raw&&(N=T.inflateSetDictionary(this.strm,D.dictionary),N!==g)))throw new Error(n[N])}function m(G,D){const N=new h(D);if(N.push(G),N.err)throw N.msg||n[N.err];return N.result}h.prototype.push=function(G,D){const N=this.strm,o=this.options.Ja,n=this.options.dictionary;let C,P,h;if(this.ended)return!1;for(P=D===~~D?D:!0===D?q:v,"[object ArrayBuffer]"===r.call(G)?N.input=new Uint8Array(G):N.input=G,N.next_in=0,N.avail_in=N.input.length;;){for(0===N.avail_out&&(N.output=new Uint8Array(o),N.next_out=0,N.avail_out=o),C=T.inflate(N,P),C===W&&n&&(C=T.inflateSetDictionary(N,n),C===g?C=T.inflate(N,P):C===Y&&(C=W));N.avail_in>0&&C===X&&N.state.wrap>0&&0!==G[N.next_in];)T.inflateReset(N),C=T.inflate(N,P);switch(C){case j:case Y:case W:case y:return this.onEnd(C),this.ended=!0,!1}if(h=N.avail_out,N.next_out&&(0===N.avail_out||C===X))if("string"===this.options.to){let G=Z.utf8border(N.output,N.next_out),D=N.next_out-G,T=Z.buf2string(N.output,G);N.next_out=D,N.avail_out=o-D,D&&N.output.set(N.output.subarray(G,G+D),0),this.onData(T)}else this.onData(N.output.length===N.next_out?N.output:N.output.subarray(0,N.next_out));if(C!==g||0!==h){if(C===X)return C=T.inflateEnd(this.strm),this.onEnd(C),this.ended=!0,!0;if(0===N.avail_in)break}}return!0},h.prototype.onData=function(G){this.chunks.push(G)},h.prototype.onEnd=function(G){G===g&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=G,this.msg=this.strm.msg},G.exports.Inflate=h,G.exports.inflate=m,G.exports.inflateRaw=function(G,D){return(D=D||{}).raw=!0,m(G,D)},G.exports.ungzip=m,G.exports.constants=N(11301)},11306:G=>{"use strict";const D=(G,D)=>Object.prototype.hasOwnProperty.call(G,D);G.exports.assign=function(G){const N=Array.prototype.slice.call(arguments,1);for(;N.length;){const T=N.shift();if(T){if("object"!==typeof T)throw new TypeError(T+"must be non-object");for(const N in T)D(T,N)&&(G[N]=T[N])}}return G},G.exports.flattenChunks=G=>{let D=0;for(let T=0,o=G.length;T<o;T++)D+=G[T].length;const N=new Uint8Array(D);for(let T=0,o=0,Z=G.length;T<Z;T++){let D=G[T];N.set(D,o),o+=D.length}return N}},11312:G=>{"use strict";let D=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(T){D=!1}const N=new Uint8Array(256);for(let o=0;o<256;o++)N[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;N[254]=N[254]=1,G.exports.string2buf=G=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(G);let D,N,T,o,Z,n=G.length,C=0;for(o=0;o<n;o++)N=G.charCodeAt(o),55296===(64512&N)&&o+1<n&&(T=G.charCodeAt(o+1),56320===(64512&T)&&(N=65536+(N-55296<<10)+(T-56320),o++)),C+=N<128?1:N<2048?2:N<65536?3:4;for(D=new Uint8Array(C),Z=0,o=0;Z<C;o++)N=G.charCodeAt(o),55296===(64512&N)&&o+1<n&&(T=G.charCodeAt(o+1),56320===(64512&T)&&(N=65536+(N-55296<<10)+(T-56320),o++)),N<128?D[Z++]=N:N<2048?(D[Z++]=192|N>>>6,D[Z++]=128|63&N):N<65536?(D[Z++]=224|N>>>12,D[Z++]=128|N>>>6&63,D[Z++]=128|63&N):(D[Z++]=240|N>>>18,D[Z++]=128|N>>>12&63,D[Z++]=128|N>>>6&63,D[Z++]=128|63&N);return D};G.exports.buf2string=(G,T)=>{const o=T||G.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(G.subarray(0,T));let Z,n;const C=new Array(2*o);for(n=0,Z=0;Z<o;){let D=G[Z++];if(D<128){C[n++]=D;continue}let T=N[D];if(T>4)C[n++]=65533,Z+=T-1;else{for(D&=2===T?31:3===T?15:7;T>1&&Z<o;)D=D<<6|63&G[Z++],T--;T>1?C[n++]=65533:D<65536?C[n++]=D:(D-=65536,C[n++]=55296|D>>10&1023,C[n++]=56320|1023&D)}}return((G,N)=>{if(N<65534&&G.subarray&&D)return String.fromCharCode.apply(null,G.length===N?G:G.subarray(0,N));let T="";for(let D=0;D<N;D++)T+=String.fromCharCode(G[D]);return T})(C,n)},G.exports.utf8border=(G,D)=>{(D=D||G.length)>G.length&&(D=G.length);let T=D-1;for(;T>=0&&128===(192&G[T]);)T--;return T<0||0===T?D:T+N[G[T]]>D?T:D}},11281:G=>{"use strict";G.exports=(G,D,N,T)=>{let o=65535&G,Z=G>>>16&65535,n=0;for(;0!==N;){n=N>2e3?2e3:N,N-=n;do{o=o+D[T++]|0,Z=Z+o|0}while(--n);o%=65521,Z%=65521}return o|Z<<16}},11301:G=>{"use strict";G.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11288:G=>{"use strict";const D=new Uint32Array((()=>{let G,D=[];for(var N=0;N<256;N++){G=N;for(var T=0;T<8;T++)G=1&G?3988292384^G>>>1:G>>>1;D[N]=G}return D})());G.exports=(G,N,T,o)=>{const Z=D,n=o+T;G^=-1;for(let D=o;D<n;D++)G=G>>>8^Z[255&(G^N[D])];return~G}},11272:(G,D,N)=>{"use strict";const{_tr_init:T,_tr_stored_block:o,_tr_flush_block:Z,_tr_tally:n,_tr_align:C}=N(11278),P=N(11281),r=N(11288),v=N(11295),{Z_NO_FLUSH:q,Z_PARTIAL_FLUSH:g,Z_FULL_FLUSH:X,Z_FINISH:W,Z_BLOCK:j,Z_OK:Y,Z_STREAM_END:y,Z_STREAM_ERROR:h,Z_DATA_ERROR:m,Z_BUF_ERROR:R,Z_DEFAULT_COMPRESSION:L,Z_FILTERED:w,Z_HUFFMAN_ONLY:B,Z_RLE:F,Z_FIXED:S,Z_DEFAULT_STRATEGY:V,Z_UNKNOWN:U,Z_DEFLATED:z}=N(11301),i=258,J=262,p=103,t=113,H=666,s=(G,D)=>(G.msg=v[D],D),c=G=>(G<<1)-(G>4?9:0),K=G=>{let D=G.length;for(;--D>=0;)G[D]=0};let b=(G,D,N)=>(D<<G.hash_shift^N)&G.hash_mask;const O=G=>{const D=G.state;let N=D.pending;N>G.avail_out&&(N=G.avail_out),0!==N&&(G.output.set(D.pending_buf.subarray(D.pending_out,D.pending_out+N),G.next_out),G.next_out+=N,D.pending_out+=N,G.total_out+=N,G.avail_out-=N,D.pending-=N,0===D.pending&&(D.pending_out=0))},Q=(G,D)=>{Z(G,G.block_start>=0?G.block_start:-1,G.strstart-G.block_start,D),G.block_start=G.strstart,O(G.strm)},A=(G,D)=>{G.pending_buf[G.pending++]=D},I=(G,D)=>{G.pending_buf[G.pending++]=D>>>8&255,G.pending_buf[G.pending++]=255&D},d=(G,D,N,T)=>{let o=G.avail_in;return o>T&&(o=T),0===o?0:(G.avail_in-=o,D.set(G.input.subarray(G.next_in,G.next_in+o),N),1===G.state.wrap?G.adler=P(G.adler,D,o,N):2===G.state.wrap&&(G.adler=r(G.adler,D,o,N)),G.next_in+=o,G.total_in+=o,o)},u=(G,D)=>{let N,T,o=G.max_chain_length,Z=G.strstart,n=G.prev_length,C=G.nice_match;const P=G.strstart>G.w_size-J?G.strstart-(G.w_size-J):0,r=G.window,v=G.w_mask,q=G.prev,g=G.strstart+i;let X=r[Z+n-1],W=r[Z+n];G.prev_length>=G.good_match&&(o>>=2),C>G.lookahead&&(C=G.lookahead);do{if(N=D,r[N+n]===W&&r[N+n-1]===X&&r[N]===r[Z]&&r[++N]===r[Z+1]){Z+=2,N++;do{}while(r[++Z]===r[++N]&&r[++Z]===r[++N]&&r[++Z]===r[++N]&&r[++Z]===r[++N]&&r[++Z]===r[++N]&&r[++Z]===r[++N]&&r[++Z]===r[++N]&&r[++Z]===r[++N]&&Z<g);if(T=i-(g-Z),Z=g-i,T>n){if(G.match_start=D,n=T,T>=C)break;X=r[Z+n-1],W=r[Z+n]}}}while((D=q[D&v])>P&&0!==--o);return n<=G.lookahead?n:G.lookahead},l=G=>{const D=G.w_size;let N,T,o,Z,n;do{if(Z=G.window_size-G.lookahead-G.strstart,G.strstart>=D+(D-J)){G.window.set(G.window.subarray(D,D+D),0),G.match_start-=D,G.strstart-=D,G.block_start-=D,T=G.hash_size,N=T;do{o=G.head[--N],G.head[N]=o>=D?o-D:0}while(--T);T=D,N=T;do{o=G.prev[--N],G.prev[N]=o>=D?o-D:0}while(--T);Z+=D}if(0===G.strm.avail_in)break;if(T=d(G.strm,G.window,G.strstart+G.lookahead,Z),G.lookahead+=T,G.lookahead+G.insert>=3)for(n=G.strstart-G.insert,G.ins_h=G.window[n],G.ins_h=b(G,G.ins_h,G.window[n+1]);G.insert&&(G.ins_h=b(G,G.ins_h,G.window[n+3-1]),G.prev[n&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=n,n++,G.insert--,!(G.lookahead+G.insert<3)););}while(G.lookahead<J&&0!==G.strm.avail_in)},x=(G,D)=>{let N,T;for(;;){if(G.lookahead<J){if(l(G),G.lookahead<J&&D===q)return 1;if(0===G.lookahead)break}if(N=0,G.lookahead>=3&&(G.ins_h=b(G,G.ins_h,G.window[G.strstart+3-1]),N=G.prev[G.strstart&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=G.strstart),0!==N&&G.strstart-N<=G.w_size-J&&(G.match_length=u(G,N)),G.match_length>=3)if(T=n(G,G.strstart-G.match_start,G.match_length-3),G.lookahead-=G.match_length,G.match_length<=G.max_lazy_match&&G.lookahead>=3){G.match_length--;do{G.strstart++,G.ins_h=b(G,G.ins_h,G.window[G.strstart+3-1]),N=G.prev[G.strstart&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=G.strstart}while(0!==--G.match_length);G.strstart++}else G.strstart+=G.match_length,G.match_length=0,G.ins_h=G.window[G.strstart],G.ins_h=b(G,G.ins_h,G.window[G.strstart+1]);else T=n(G,0,G.window[G.strstart]),G.lookahead--,G.strstart++;if(T&&(Q(G,!1),0===G.strm.avail_out))return 1}return G.insert=G.strstart<2?G.strstart:2,D===W?(Q(G,!0),0===G.strm.avail_out?3:4):G.last_lit&&(Q(G,!1),0===G.strm.avail_out)?1:2},k=(G,D)=>{let N,T,o;for(;;){if(G.lookahead<J){if(l(G),G.lookahead<J&&D===q)return 1;if(0===G.lookahead)break}if(N=0,G.lookahead>=3&&(G.ins_h=b(G,G.ins_h,G.window[G.strstart+3-1]),N=G.prev[G.strstart&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=G.strstart),G.prev_length=G.match_length,G.prev_match=G.match_start,G.match_length=2,0!==N&&G.prev_length<G.max_lazy_match&&G.strstart-N<=G.w_size-J&&(G.match_length=u(G,N),G.match_length<=5&&(G.strategy===w||3===G.match_length&&G.strstart-G.match_start>4096)&&(G.match_length=2)),G.prev_length>=3&&G.match_length<=G.prev_length){o=G.strstart+G.lookahead-3,T=n(G,G.strstart-1-G.prev_match,G.prev_length-3),G.lookahead-=G.prev_length-1,G.prev_length-=2;do{++G.strstart<=o&&(G.ins_h=b(G,G.ins_h,G.window[G.strstart+3-1]),N=G.prev[G.strstart&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=G.strstart)}while(0!==--G.prev_length);if(G.match_available=0,G.match_length=2,G.strstart++,T&&(Q(G,!1),0===G.strm.avail_out))return 1}else if(G.match_available){if(T=n(G,0,G.window[G.strstart-1]),T&&Q(G,!1),G.strstart++,G.lookahead--,0===G.strm.avail_out)return 1}else G.match_available=1,G.strstart++,G.lookahead--}return G.match_available&&(T=n(G,0,G.window[G.strstart-1]),G.match_available=0),G.insert=G.strstart<2?G.strstart:2,D===W?(Q(G,!0),0===G.strm.avail_out?3:4):G.last_lit&&(Q(G,!1),0===G.strm.avail_out)?1:2};function a(G,D,N,T,o){this.good_length=G,this.max_lazy=D,this.nice_length=N,this.max_chain=T,this.func=o}const E=[new a(0,0,0,0,((G,D)=>{let N=65535;for(N>G.pending_buf_size-5&&(N=G.pending_buf_size-5);;){if(G.lookahead<=1){if(l(G),0===G.lookahead&&D===q)return 1;if(0===G.lookahead)break}G.strstart+=G.lookahead,G.lookahead=0;const T=G.block_start+N;if((0===G.strstart||G.strstart>=T)&&(G.lookahead=G.strstart-T,G.strstart=T,Q(G,!1),0===G.strm.avail_out))return 1;if(G.strstart-G.block_start>=G.w_size-J&&(Q(G,!1),0===G.strm.avail_out))return 1}return G.insert=0,D===W?(Q(G,!0),0===G.strm.avail_out?3:4):(G.strstart>G.block_start&&(Q(G,!1),G.strm.avail_out),1)})),new a(4,4,8,4,x),new a(4,5,16,8,x),new a(4,6,32,32,x),new a(4,4,16,16,k),new a(8,16,32,32,k),new a(8,16,128,128,k),new a(8,32,128,256,k),new a(32,128,258,1024,k),new a(32,258,258,4096,k)];function M(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),K(this.dyn_ltree),K(this.dyn_dtree),K(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),K(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),K(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const e=G=>{if(!G||!G.state)return s(G,h);G.total_in=G.total_out=0,G.data_type=U;const D=G.state;return D.pending=0,D.pending_out=0,D.wrap<0&&(D.wrap=-D.wrap),D.status=D.wrap?42:t,G.adler=2===D.wrap?0:1,D.last_flush=q,T(D),Y},f=G=>{const D=e(G);var N;return D===Y&&((N=G.state).window_size=2*N.w_size,K(N.head),N.max_lazy_match=E[N.level].max_lazy,N.good_match=E[N.level].good_length,N.nice_match=E[N.level].nice_length,N.max_chain_length=E[N.level].max_chain,N.strstart=0,N.block_start=0,N.lookahead=0,N.insert=0,N.match_length=N.prev_length=2,N.match_available=0,N.ins_h=0),D},GG=(G,D,N,T,o,Z)=>{if(!G)return h;let n=1;if(D===L&&(D=6),T<0?(n=0,T=-T):T>15&&(n=2,T-=16),o<1||o>9||N!==z||T<8||T>15||D<0||D>9||Z<0||Z>S)return s(G,h);8===T&&(T=9);const C=new M;return G.state=C,C.strm=G,C.wrap=n,C.gzhead=null,C.w_bits=T,C.w_size=1<<C.w_bits,C.w_mask=C.w_size-1,C.hash_bits=o+7,C.hash_size=1<<C.hash_bits,C.hash_mask=C.hash_size-1,C.hash_shift=~~((C.hash_bits+3-1)/3),C.window=new Uint8Array(2*C.w_size),C.head=new Uint16Array(C.hash_size),C.prev=new Uint16Array(C.w_size),C.lit_bufsize=1<<o+6,C.pending_buf_size=4*C.lit_bufsize,C.pending_buf=new Uint8Array(C.pending_buf_size),C.d_buf=1*C.lit_bufsize,C.l_buf=3*C.lit_bufsize,C.level=D,C.strategy=Z,C.method=N,f(G)};G.exports.deflateInit=(G,D)=>GG(G,D,z,15,8,V),G.exports.deflateInit2=GG,G.exports.deflateReset=f,G.exports.deflateResetKeep=e,G.exports.deflateSetHeader=(G,D)=>G&&G.state?2!==G.state.wrap?h:(G.state.gzhead=D,Y):h,G.exports.deflate=(G,D)=>{let N,T;if(!G||!G.state||D>j||D<0)return G?s(G,h):h;const Z=G.state;if(!G.output||!G.input&&0!==G.avail_in||Z.status===H&&D!==W)return s(G,0===G.avail_out?R:h);Z.strm=G;const P=Z.last_flush;if(Z.last_flush=D,42===Z.status)if(2===Z.wrap)G.adler=0,A(Z,31),A(Z,139),A(Z,8),Z.gzhead?(A(Z,(Z.gzhead.text?1:0)+(Z.gzhead.hcrc?2:0)+(Z.gzhead.extra?4:0)+(Z.gzhead.name?8:0)+(Z.gzhead.comment?16:0)),A(Z,255&Z.gzhead.time),A(Z,Z.gzhead.time>>8&255),A(Z,Z.gzhead.time>>16&255),A(Z,Z.gzhead.time>>24&255),A(Z,9===Z.level?2:Z.strategy>=B||Z.level<2?4:0),A(Z,255&Z.gzhead.os),Z.gzhead.extra&&Z.gzhead.extra.length&&(A(Z,255&Z.gzhead.extra.length),A(Z,Z.gzhead.extra.length>>8&255)),Z.gzhead.hcrc&&(G.adler=r(G.adler,Z.pending_buf,Z.pending,0)),Z.gzindex=0,Z.status=69):(A(Z,0),A(Z,0),A(Z,0),A(Z,0),A(Z,0),A(Z,9===Z.level?2:Z.strategy>=B||Z.level<2?4:0),A(Z,3),Z.status=t);else{let D=z+(Z.w_bits-8<<4)<<8,N=-1;N=Z.strategy>=B||Z.level<2?0:Z.level<6?1:6===Z.level?2:3,D|=N<<6,0!==Z.strstart&&(D|=32),D+=31-D%31,Z.status=t,I(Z,D),0!==Z.strstart&&(I(Z,G.adler>>>16),I(Z,65535&G.adler)),G.adler=1}if(69===Z.status)if(Z.gzhead.extra){for(N=Z.pending;Z.gzindex<(65535&Z.gzhead.extra.length)&&(Z.pending!==Z.pending_buf_size||(Z.gzhead.hcrc&&Z.pending>N&&(G.adler=r(G.adler,Z.pending_buf,Z.pending-N,N)),O(G),N=Z.pending,Z.pending!==Z.pending_buf_size));)A(Z,255&Z.gzhead.extra[Z.gzindex]),Z.gzindex++;Z.gzhead.hcrc&&Z.pending>N&&(G.adler=r(G.adler,Z.pending_buf,Z.pending-N,N)),Z.gzindex===Z.gzhead.extra.length&&(Z.gzindex=0,Z.status=73)}else Z.status=73;if(73===Z.status)if(Z.gzhead.name){N=Z.pending;do{if(Z.pending===Z.pending_buf_size&&(Z.gzhead.hcrc&&Z.pending>N&&(G.adler=r(G.adler,Z.pending_buf,Z.pending-N,N)),O(G),N=Z.pending,Z.pending===Z.pending_buf_size)){T=1;break}T=Z.gzindex<Z.gzhead.name.length?255&Z.gzhead.name.charCodeAt(Z.gzindex++):0,A(Z,T)}while(0!==T);Z.gzhead.hcrc&&Z.pending>N&&(G.adler=r(G.adler,Z.pending_buf,Z.pending-N,N)),0===T&&(Z.gzindex=0,Z.status=91)}else Z.status=91;if(91===Z.status)if(Z.gzhead.comment){N=Z.pending;do{if(Z.pending===Z.pending_buf_size&&(Z.gzhead.hcrc&&Z.pending>N&&(G.adler=r(G.adler,Z.pending_buf,Z.pending-N,N)),O(G),N=Z.pending,Z.pending===Z.pending_buf_size)){T=1;break}T=Z.gzindex<Z.gzhead.comment.length?255&Z.gzhead.comment.charCodeAt(Z.gzindex++):0,A(Z,T)}while(0!==T);Z.gzhead.hcrc&&Z.pending>N&&(G.adler=r(G.adler,Z.pending_buf,Z.pending-N,N)),0===T&&(Z.status=p)}else Z.status=p;if(Z.status===p&&(Z.gzhead.hcrc?(Z.pending+2>Z.pending_buf_size&&O(G),Z.pending+2<=Z.pending_buf_size&&(A(Z,255&G.adler),A(Z,G.adler>>8&255),G.adler=0,Z.status=t)):Z.status=t),0!==Z.pending){if(O(G),0===G.avail_out)return Z.last_flush=-1,Y}else if(0===G.avail_in&&c(D)<=c(P)&&D!==W)return s(G,R);if(Z.status===H&&0!==G.avail_in)return s(G,R);if(0!==G.avail_in||0!==Z.lookahead||D!==q&&Z.status!==H){let N=Z.strategy===B?((G,D)=>{let N;for(;;){if(0===G.lookahead&&(l(G),0===G.lookahead)){if(D===q)return 1;break}if(G.match_length=0,N=n(G,0,G.window[G.strstart]),G.lookahead--,G.strstart++,N&&(Q(G,!1),0===G.strm.avail_out))return 1}return G.insert=0,D===W?(Q(G,!0),0===G.strm.avail_out?3:4):G.last_lit&&(Q(G,!1),0===G.strm.avail_out)?1:2})(Z,D):Z.strategy===F?((G,D)=>{let N,T,o,Z;const C=G.window;for(;;){if(G.lookahead<=i){if(l(G),G.lookahead<=i&&D===q)return 1;if(0===G.lookahead)break}if(G.match_length=0,G.lookahead>=3&&G.strstart>0&&(o=G.strstart-1,T=C[o],T===C[++o]&&T===C[++o]&&T===C[++o])){Z=G.strstart+i;do{}while(T===C[++o]&&T===C[++o]&&T===C[++o]&&T===C[++o]&&T===C[++o]&&T===C[++o]&&T===C[++o]&&T===C[++o]&&o<Z);G.match_length=i-(Z-o),G.match_length>G.lookahead&&(G.match_length=G.lookahead)}if(G.match_length>=3?(N=n(G,1,G.match_length-3),G.lookahead-=G.match_length,G.strstart+=G.match_length,G.match_length=0):(N=n(G,0,G.window[G.strstart]),G.lookahead--,G.strstart++),N&&(Q(G,!1),0===G.strm.avail_out))return 1}return G.insert=0,D===W?(Q(G,!0),0===G.strm.avail_out?3:4):G.last_lit&&(Q(G,!1),0===G.strm.avail_out)?1:2})(Z,D):E[Z.level].func(Z,D);if(3!==N&&4!==N||(Z.status=H),1===N||3===N)return 0===G.avail_out&&(Z.last_flush=-1),Y;if(2===N&&(D===g?C(Z):D!==j&&(o(Z,0,0,!1),D===X&&(K(Z.head),0===Z.lookahead&&(Z.strstart=0,Z.block_start=0,Z.insert=0))),O(G),0===G.avail_out))return Z.last_flush=-1,Y}return D!==W?Y:Z.wrap<=0?y:(2===Z.wrap?(A(Z,255&G.adler),A(Z,G.adler>>8&255),A(Z,G.adler>>16&255),A(Z,G.adler>>24&255),A(Z,255&G.total_in),A(Z,G.total_in>>8&255),A(Z,G.total_in>>16&255),A(Z,G.total_in>>24&255)):(I(Z,G.adler>>>16),I(Z,65535&G.adler)),O(G),Z.wrap>0&&(Z.wrap=-Z.wrap),0!==Z.pending?Y:y)},G.exports.deflateEnd=G=>{if(!G||!G.state)return h;const D=G.state.status;return 42!==D&&69!==D&&73!==D&&91!==D&&D!==p&&D!==t&&D!==H?s(G,h):(G.state=null,D===t?s(G,m):Y)},G.exports.deflateSetDictionary=(G,D)=>{let N=D.length;if(!G||!G.state)return h;const T=G.state,o=T.wrap;if(2===o||1===o&&42!==T.status||T.lookahead)return h;if(1===o&&(G.adler=P(G.adler,D,N,0)),T.wrap=0,N>=T.w_size){0===o&&(K(T.head),T.strstart=0,T.block_start=0,T.insert=0);let G=new Uint8Array(T.w_size);G.set(D.subarray(N-T.w_size,N),0),D=G,N=T.w_size}const Z=G.avail_in,n=G.next_in,C=G.input;for(G.avail_in=N,G.next_in=0,G.input=D,l(T);T.lookahead>=3;){let G=T.strstart,D=T.lookahead-2;do{T.ins_h=b(T,T.ins_h,T.window[G+3-1]),T.prev[G&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=G,G++}while(--D);T.strstart=G,T.lookahead=2,l(T)}return T.strstart+=T.lookahead,T.block_start=T.strstart,T.insert=T.lookahead,T.lookahead=0,T.match_length=T.prev_length=2,T.match_available=0,G.next_in=n,G.input=C,G.avail_in=Z,T.wrap=o,Y},G.exports.deflateInfo="pako deflate (from Nodeca project)"},11351:G=>{"use strict";G.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11335:G=>{"use strict";G.exports=function(G,D){let N,T,o,Z,n,C,P,r,v,q,g,X,W,j,Y,y,h,m,R,L,w,B,F,S;const V=G.state;N=G.next_in,F=G.input,T=N+(G.avail_in-5),o=G.next_out,S=G.output,Z=o-(D-G.avail_out),n=o+(G.avail_out-257),C=V.dmax,P=V.wsize,r=V.whave,v=V.wnext,q=V.window,g=V.hold,X=V.bits,W=V.lencode,j=V.distcode,Y=(1<<V.lenbits)-1,y=(1<<V.distbits)-1;G:do{X<15&&(g+=F[N++]<<X,X+=8,g+=F[N++]<<X,X+=8),h=W[g&Y];D:for(;;){if(m=h>>>24,g>>>=m,X-=m,m=h>>>16&255,0===m)S[o++]=65535&h;else{if(!(16&m)){if(0===(64&m)){h=W[(65535&h)+(g&(1<<m)-1)];continue D}if(32&m){V.mode=12;break G}G.msg="invalid literal/length code",V.mode=30;break G}R=65535&h,m&=15,m&&(X<m&&(g+=F[N++]<<X,X+=8),R+=g&(1<<m)-1,g>>>=m,X-=m),X<15&&(g+=F[N++]<<X,X+=8,g+=F[N++]<<X,X+=8),h=j[g&y];N:for(;;){if(m=h>>>24,g>>>=m,X-=m,m=h>>>16&255,!(16&m)){if(0===(64&m)){h=j[(65535&h)+(g&(1<<m)-1)];continue N}G.msg="invalid distance code",V.mode=30;break G}if(L=65535&h,m&=15,X<m&&(g+=F[N++]<<X,X+=8,X<m&&(g+=F[N++]<<X,X+=8)),L+=g&(1<<m)-1,L>C){G.msg="invalid distance too far back",V.mode=30;break G}if(g>>>=m,X-=m,m=o-Z,L>m){if(m=L-m,m>r&&V.sane){G.msg="invalid distance too far back",V.mode=30;break G}if(w=0,B=q,0===v){if(w+=P-m,m<R){R-=m;do{S[o++]=q[w++]}while(--m);w=o-L,B=S}}else if(v<m){if(w+=P+v-m,m-=v,m<R){R-=m;do{S[o++]=q[w++]}while(--m);if(w=0,v<R){m=v,R-=m;do{S[o++]=q[w++]}while(--m);w=o-L,B=S}}}else if(w+=v-m,m<R){R-=m;do{S[o++]=q[w++]}while(--m);w=o-L,B=S}for(;R>2;)S[o++]=B[w++],S[o++]=B[w++],S[o++]=B[w++],R-=3;R&&(S[o++]=B[w++],R>1&&(S[o++]=B[w++]))}else{w=o-L;do{S[o++]=S[w++],S[o++]=S[w++],S[o++]=S[w++],R-=3}while(R>2);R&&(S[o++]=S[w++],R>1&&(S[o++]=S[w++]))}break}}break}}while(N<T&&o<n);R=X>>3,N-=R,X-=R<<3,g&=(1<<X)-1,G.next_in=N,G.next_out=o,G.avail_in=N<T?T-N+5:5-(N-T),G.avail_out=o<n?n-o+257:257-(o-n),V.hold=g,V.bits=X}},11333:(G,D,N)=>{"use strict";const T=N(11281),o=N(11288),Z=N(11335),n=N(11342),{Z_FINISH:C,Z_BLOCK:P,Z_TREES:r,Z_OK:v,Z_STREAM_END:q,Z_NEED_DICT:g,Z_STREAM_ERROR:X,Z_DATA_ERROR:W,Z_MEM_ERROR:j,Z_BUF_ERROR:Y,Z_DEFLATED:y}=N(11301),h=12,m=30,R=G=>(G>>>24&255)+(G>>>8&65280)+((65280&G)<<8)+((255&G)<<24);function L(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const w=G=>{if(!G||!G.state)return X;const D=G.state;return G.total_in=G.total_out=D.total=0,G.msg="",D.wrap&&(G.adler=1&D.wrap),D.mode=1,D.last=0,D.havedict=0,D.dmax=32768,D.head=null,D.hold=0,D.bits=0,D.lencode=D.lendyn=new Int32Array(852),D.distcode=D.distdyn=new Int32Array(592),D.sane=1,D.back=-1,v},B=G=>{if(!G||!G.state)return X;const D=G.state;return D.wsize=0,D.whave=0,D.wnext=0,w(G)},F=(G,D)=>{let N;if(!G||!G.state)return X;const T=G.state;return D<0?(N=0,D=-D):(N=1+(D>>4),D<48&&(D&=15)),D&&(D<8||D>15)?X:(null!==T.window&&T.wbits!==D&&(T.window=null),T.wrap=N,T.wbits=D,B(G))},S=(G,D)=>{if(!G)return X;const N=new L;G.state=N,N.window=null;const T=F(G,D);return T!==v&&(G.state=null),T};let V,U,z=!0;const i=G=>{if(z){V=new Int32Array(512),U=new Int32Array(32);let D=0;for(;D<144;)G.lens[D++]=8;for(;D<256;)G.lens[D++]=9;for(;D<280;)G.lens[D++]=7;for(;D<288;)G.lens[D++]=8;for(n(1,G.lens,0,288,V,0,G.work,{bits:9}),D=0;D<32;)G.lens[D++]=5;n(2,G.lens,0,32,U,0,G.work,{bits:5}),z=!1}G.lencode=V,G.lenbits=9,G.distcode=U,G.distbits=5},J=(G,D,N,T)=>{let o;const Z=G.state;return null===Z.window&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new Uint8Array(Z.wsize)),T>=Z.wsize?(Z.window.set(D.subarray(N-Z.wsize,N),0),Z.wnext=0,Z.whave=Z.wsize):(o=Z.wsize-Z.wnext,o>T&&(o=T),Z.window.set(D.subarray(N-T,N-T+o),Z.wnext),(T-=o)?(Z.window.set(D.subarray(N-T,N),0),Z.wnext=T,Z.whave=Z.wsize):(Z.wnext+=o,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=o))),0};G.exports.inflateReset=B,G.exports.inflateReset2=F,G.exports.inflateResetKeep=w,G.exports.inflateInit=G=>S(G,15),G.exports.inflateInit2=S,G.exports.inflate=(G,D)=>{let N,L,w,B,F,S,V,U,z,p,t,H,s,c,K,b,O,Q,A,I,d,u,l=0;const x=new Uint8Array(4);let k,a;const E=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!G||!G.state||!G.output||!G.input&&0!==G.avail_in)return X;N=G.state,N.mode===h&&(N.mode=13),F=G.next_out,w=G.output,V=G.avail_out,B=G.next_in,L=G.input,S=G.avail_in,U=N.hold,z=N.bits,p=S,t=V,u=v;G:for(;;)switch(N.mode){case 1:if(0===N.wrap){N.mode=13;break}for(;z<16;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}if(2&N.wrap&&35615===U){N.check=0,x[0]=255&U,x[1]=U>>>8&255,N.check=o(N.check,x,2,0),U=0,z=0,N.mode=2;break}if(N.flags=0,N.head&&(N.head.done=!1),!(1&N.wrap)||(((255&U)<<8)+(U>>8))%31){G.msg="incorrect header check",N.mode=m;break}if((15&U)!==y){G.msg="unknown compression method",N.mode=m;break}if(U>>>=4,z-=4,d=8+(15&U),0===N.wbits)N.wbits=d;else if(d>N.wbits){G.msg="invalid window size",N.mode=m;break}N.dmax=1<<N.wbits,G.adler=N.check=1,N.mode=512&U?10:h,U=0,z=0;break;case 2:for(;z<16;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}if(N.flags=U,(255&N.flags)!==y){G.msg="unknown compression method",N.mode=m;break}if(57344&N.flags){G.msg="unknown header flags set",N.mode=m;break}N.head&&(N.head.text=U>>8&1),512&N.flags&&(x[0]=255&U,x[1]=U>>>8&255,N.check=o(N.check,x,2,0)),U=0,z=0,N.mode=3;case 3:for(;z<32;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}N.head&&(N.head.time=U),512&N.flags&&(x[0]=255&U,x[1]=U>>>8&255,x[2]=U>>>16&255,x[3]=U>>>24&255,N.check=o(N.check,x,4,0)),U=0,z=0,N.mode=4;case 4:for(;z<16;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}N.head&&(N.head.xflags=255&U,N.head.os=U>>8),512&N.flags&&(x[0]=255&U,x[1]=U>>>8&255,N.check=o(N.check,x,2,0)),U=0,z=0,N.mode=5;case 5:if(1024&N.flags){for(;z<16;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}N.length=U,N.head&&(N.head.extra_len=U),512&N.flags&&(x[0]=255&U,x[1]=U>>>8&255,N.check=o(N.check,x,2,0)),U=0,z=0}else N.head&&(N.head.extra=null);N.mode=6;case 6:if(1024&N.flags&&(H=N.length,H>S&&(H=S),H&&(N.head&&(d=N.head.extra_len-N.length,N.head.extra||(N.head.extra=new Uint8Array(N.head.extra_len)),N.head.extra.set(L.subarray(B,B+H),d)),512&N.flags&&(N.check=o(N.check,L,H,B)),S-=H,B+=H,N.length-=H),N.length))break G;N.length=0,N.mode=7;case 7:if(2048&N.flags){if(0===S)break G;H=0;do{d=L[B+H++],N.head&&d&&N.length<65536&&(N.head.name+=String.fromCharCode(d))}while(d&&H<S);if(512&N.flags&&(N.check=o(N.check,L,H,B)),S-=H,B+=H,d)break G}else N.head&&(N.head.name=null);N.length=0,N.mode=8;case 8:if(4096&N.flags){if(0===S)break G;H=0;do{d=L[B+H++],N.head&&d&&N.length<65536&&(N.head.comment+=String.fromCharCode(d))}while(d&&H<S);if(512&N.flags&&(N.check=o(N.check,L,H,B)),S-=H,B+=H,d)break G}else N.head&&(N.head.comment=null);N.mode=9;case 9:if(512&N.flags){for(;z<16;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}if(U!==(65535&N.check)){G.msg="header crc mismatch",N.mode=m;break}U=0,z=0}N.head&&(N.head.hcrc=N.flags>>9&1,N.head.done=!0),G.adler=N.check=0,N.mode=h;break;case 10:for(;z<32;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}G.adler=N.check=R(U),U=0,z=0,N.mode=11;case 11:if(0===N.havedict)return G.next_out=F,G.avail_out=V,G.next_in=B,G.avail_in=S,N.hold=U,N.bits=z,g;G.adler=N.check=1,N.mode=h;case h:if(D===P||D===r)break G;case 13:if(N.last){U>>>=7&z,z-=7&z,N.mode=27;break}for(;z<3;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}switch(N.last=1&U,U>>>=1,z-=1,3&U){case 0:N.mode=14;break;case 1:if(i(N),N.mode=20,D===r){U>>>=2,z-=2;break G}break;case 2:N.mode=17;break;case 3:G.msg="invalid block type",N.mode=m}U>>>=2,z-=2;break;case 14:for(U>>>=7&z,z-=7&z;z<32;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}if((65535&U)!==(U>>>16^65535)){G.msg="invalid stored block lengths",N.mode=m;break}if(N.length=65535&U,U=0,z=0,N.mode=15,D===r)break G;case 15:N.mode=16;case 16:if(H=N.length,H){if(H>S&&(H=S),H>V&&(H=V),0===H)break G;w.set(L.subarray(B,B+H),F),S-=H,B+=H,V-=H,F+=H,N.length-=H;break}N.mode=h;break;case 17:for(;z<14;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}if(N.nlen=257+(31&U),U>>>=5,z-=5,N.ndist=1+(31&U),U>>>=5,z-=5,N.ncode=4+(15&U),U>>>=4,z-=4,N.nlen>286||N.ndist>30){G.msg="too many length or distance symbols",N.mode=m;break}N.have=0,N.mode=18;case 18:for(;N.have<N.ncode;){for(;z<3;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}N.lens[E[N.have++]]=7&U,U>>>=3,z-=3}for(;N.have<19;)N.lens[E[N.have++]]=0;if(N.lencode=N.lendyn,N.lenbits=7,k={bits:N.lenbits},u=n(0,N.lens,0,19,N.lencode,0,N.work,k),N.lenbits=k.bits,u){G.msg="invalid code lengths set",N.mode=m;break}N.have=0,N.mode=19;case 19:for(;N.have<N.nlen+N.ndist;){for(;l=N.lencode[U&(1<<N.lenbits)-1],K=l>>>24,b=l>>>16&255,O=65535&l,!(K<=z);){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}if(O<16)U>>>=K,z-=K,N.lens[N.have++]=O;else{if(16===O){for(a=K+2;z<a;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}if(U>>>=K,z-=K,0===N.have){G.msg="invalid bit length repeat",N.mode=m;break}d=N.lens[N.have-1],H=3+(3&U),U>>>=2,z-=2}else if(17===O){for(a=K+3;z<a;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}U>>>=K,z-=K,d=0,H=3+(7&U),U>>>=3,z-=3}else{for(a=K+7;z<a;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}U>>>=K,z-=K,d=0,H=11+(127&U),U>>>=7,z-=7}if(N.have+H>N.nlen+N.ndist){G.msg="invalid bit length repeat",N.mode=m;break}for(;H--;)N.lens[N.have++]=d}}if(N.mode===m)break;if(0===N.lens[256]){G.msg="invalid code -- missing end-of-block",N.mode=m;break}if(N.lenbits=9,k={bits:N.lenbits},u=n(1,N.lens,0,N.nlen,N.lencode,0,N.work,k),N.lenbits=k.bits,u){G.msg="invalid literal/lengths set",N.mode=m;break}if(N.distbits=6,N.distcode=N.distdyn,k={bits:N.distbits},u=n(2,N.lens,N.nlen,N.ndist,N.distcode,0,N.work,k),N.distbits=k.bits,u){G.msg="invalid distances set",N.mode=m;break}if(N.mode=20,D===r)break G;case 20:N.mode=21;case 21:if(S>=6&&V>=258){G.next_out=F,G.avail_out=V,G.next_in=B,G.avail_in=S,N.hold=U,N.bits=z,Z(G,t),F=G.next_out,w=G.output,V=G.avail_out,B=G.next_in,L=G.input,S=G.avail_in,U=N.hold,z=N.bits,N.mode===h&&(N.back=-1);break}for(N.back=0;l=N.lencode[U&(1<<N.lenbits)-1],K=l>>>24,b=l>>>16&255,O=65535&l,!(K<=z);){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}if(b&&0===(240&b)){for(Q=K,A=b,I=O;l=N.lencode[I+((U&(1<<Q+A)-1)>>Q)],K=l>>>24,b=l>>>16&255,O=65535&l,!(Q+K<=z);){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}U>>>=Q,z-=Q,N.back+=Q}if(U>>>=K,z-=K,N.back+=K,N.length=O,0===b){N.mode=26;break}if(32&b){N.back=-1,N.mode=h;break}if(64&b){G.msg="invalid literal/length code",N.mode=m;break}N.extra=15&b,N.mode=22;case 22:if(N.extra){for(a=N.extra;z<a;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}N.length+=U&(1<<N.extra)-1,U>>>=N.extra,z-=N.extra,N.back+=N.extra}N.was=N.length,N.mode=23;case 23:for(;l=N.distcode[U&(1<<N.distbits)-1],K=l>>>24,b=l>>>16&255,O=65535&l,!(K<=z);){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}if(0===(240&b)){for(Q=K,A=b,I=O;l=N.distcode[I+((U&(1<<Q+A)-1)>>Q)],K=l>>>24,b=l>>>16&255,O=65535&l,!(Q+K<=z);){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}U>>>=Q,z-=Q,N.back+=Q}if(U>>>=K,z-=K,N.back+=K,64&b){G.msg="invalid distance code",N.mode=m;break}N.offset=O,N.extra=15&b,N.mode=24;case 24:if(N.extra){for(a=N.extra;z<a;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}N.offset+=U&(1<<N.extra)-1,U>>>=N.extra,z-=N.extra,N.back+=N.extra}if(N.offset>N.dmax){G.msg="invalid distance too far back",N.mode=m;break}N.mode=25;case 25:if(0===V)break G;if(H=t-V,N.offset>H){if(H=N.offset-H,H>N.whave&&N.sane){G.msg="invalid distance too far back",N.mode=m;break}H>N.wnext?(H-=N.wnext,s=N.wsize-H):s=N.wnext-H,H>N.length&&(H=N.length),c=N.window}else c=w,s=F-N.offset,H=N.length;H>V&&(H=V),V-=H,N.length-=H;do{w[F++]=c[s++]}while(--H);0===N.length&&(N.mode=21);break;case 26:if(0===V)break G;w[F++]=N.length,V--,N.mode=21;break;case 27:if(N.wrap){for(;z<32;){if(0===S)break G;S--,U|=L[B++]<<z,z+=8}if(t-=V,G.total_out+=t,N.total+=t,t&&(G.adler=N.check=N.flags?o(N.check,w,t,F-t):T(N.check,w,t,F-t)),t=V,(N.flags?U:R(U))!==N.check){G.msg="incorrect data check",N.mode=m;break}U=0,z=0}N.mode=28;case 28:if(N.wrap&&N.flags){for(;z<32;){if(0===S)break G;S--,U+=L[B++]<<z,z+=8}if(U!==(4294967295&N.total)){G.msg="incorrect length check",N.mode=m;break}U=0,z=0}N.mode=29;case 29:u=q;break G;case m:u=W;break G;case 31:return j;default:return X}return G.next_out=F,G.avail_out=V,G.next_in=B,G.avail_in=S,N.hold=U,N.bits=z,(N.wsize||t!==G.avail_out&&N.mode<m&&(N.mode<27||D!==C))&&J(G,G.output,G.next_out,t-G.avail_out)?(N.mode=31,j):(p-=G.avail_in,t-=G.avail_out,G.total_in+=p,G.total_out+=t,N.total+=t,N.wrap&&t&&(G.adler=N.check=N.flags?o(N.check,w,t,G.next_out-t):T(N.check,w,t,G.next_out-t)),G.data_type=N.bits+(N.last?64:0)+(N.mode===h?128:0)+(20===N.mode||15===N.mode?256:0),(0===p&&0===t||D===C)&&u===v&&(u=Y),u)},G.exports.inflateEnd=G=>{if(!G||!G.state)return X;let D=G.state;return D.window&&(D.window=null),G.state=null,v},G.exports.inflateGetHeader=(G,D)=>{if(!G||!G.state)return X;const N=G.state;return 0===(2&N.wrap)?X:(N.head=D,D.done=!1,v)},G.exports.inflateSetDictionary=(G,D)=>{const N=D.length;let o,Z,n;return G&&G.state?(o=G.state,0!==o.wrap&&11!==o.mode?X:11===o.mode&&(Z=1,Z=T(Z,D,N,0),Z!==o.check)?W:(n=J(G,D,N,N),n?(o.mode=31,j):(o.havedict=1,v))):X},G.exports.inflateInfo="pako inflate (from Nodeca project)"},11342:G=>{"use strict";const D=15,N=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),T=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),o=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Z=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);G.exports=(G,n,C,P,r,v,q,g)=>{const X=g.bits;let W,j,Y,y,h,m,R=0,L=0,w=0,B=0,F=0,S=0,V=0,U=0,z=0,i=0,J=null,p=0;const t=new Uint16Array(16),H=new Uint16Array(16);let s,c,K,b=null,O=0;for(R=0;R<=D;R++)t[R]=0;for(L=0;L<P;L++)t[n[C+L]]++;for(F=X,B=D;B>=1&&0===t[B];B--);if(F>B&&(F=B),0===B)return r[v++]=20971520,r[v++]=20971520,g.bits=1,0;for(w=1;w<B&&0===t[w];w++);for(F<w&&(F=w),U=1,R=1;R<=D;R++)if(U<<=1,U-=t[R],U<0)return-1;if(U>0&&(0===G||1!==B))return-1;for(H[1]=0,R=1;R<D;R++)H[R+1]=H[R]+t[R];for(L=0;L<P;L++)0!==n[C+L]&&(q[H[n[C+L]]++]=L);if(0===G?(J=b=q,m=19):1===G?(J=N,p-=257,b=T,O-=257,m=256):(J=o,b=Z,m=-1),i=0,L=0,R=w,h=v,S=F,V=0,Y=-1,z=1<<F,y=z-1,1===G&&z>852||2===G&&z>592)return 1;for(;;){s=R-V,q[L]<m?(c=0,K=q[L]):q[L]>m?(c=b[O+q[L]],K=J[p+q[L]]):(c=96,K=0),W=1<<R-V,j=1<<S,w=j;do{j-=W,r[h+(i>>V)+j]=s<<24|c<<16|K}while(0!==j);for(W=1<<R-1;i&W;)W>>=1;if(0!==W?(i&=W-1,i+=W):i=0,L++,0===--t[R]){if(R===B)break;R=n[C+q[L]]}if(R>F&&(i&y)!==Y){for(0===V&&(V=F),h+=w,S=R-V,U=1<<S;S+V<B&&(U-=t[S+V],!(U<=0));)S++,U<<=1;if(z+=1<<S,1===G&&z>852||2===G&&z>592)return 1;Y=i&y,r[Y]=F<<24|S<<16|h-v}}return 0!==i&&(r[h+i]=R-V<<24|64<<16),g.bits=F,0}},11295:G=>{"use strict";G.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11278:G=>{"use strict";function D(G){let D=G.length;for(;--D>=0;)G[D]=0}const N=256,T=286,o=30,Z=15,n=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),C=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),P=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),r=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),v=new Array(576);D(v);const q=new Array(60);D(q);const g=new Array(512);D(g);const X=new Array(256);D(X);const W=new Array(29);D(W);const j=new Array(o);function Y(G,D,N,T,o){this.static_tree=G,this.extra_bits=D,this.extra_base=N,this.elems=T,this.max_length=o,this.has_stree=G&&G.length}let y,h,m;function R(G,D){this.dyn_tree=G,this.max_code=0,this.stat_desc=D}D(j);const L=G=>G<256?g[G]:g[256+(G>>>7)],w=(G,D)=>{G.pending_buf[G.pending++]=255&D,G.pending_buf[G.pending++]=D>>>8&255},B=(G,D,N)=>{G.bi_valid>16-N?(G.bi_buf|=D<<G.bi_valid&65535,w(G,G.bi_buf),G.bi_buf=D>>16-G.bi_valid,G.bi_valid+=N-16):(G.bi_buf|=D<<G.bi_valid&65535,G.bi_valid+=N)},F=(G,D,N)=>{B(G,N[2*D],N[2*D+1])},S=(G,D)=>{let N=0;do{N|=1&G,G>>>=1,N<<=1}while(--D>0);return N>>>1},V=(G,D,N)=>{const T=new Array(16);let o,n,C=0;for(o=1;o<=Z;o++)T[o]=C=C+N[o-1]<<1;for(n=0;n<=D;n++){let D=G[2*n+1];0!==D&&(G[2*n]=S(T[D]++,D))}},U=G=>{let D;for(D=0;D<T;D++)G.dyn_ltree[2*D]=0;for(D=0;D<o;D++)G.dyn_dtree[2*D]=0;for(D=0;D<19;D++)G.bl_tree[2*D]=0;G.dyn_ltree[512]=1,G.opt_len=G.static_len=0,G.last_lit=G.matches=0},z=G=>{G.bi_valid>8?w(G,G.bi_buf):G.bi_valid>0&&(G.pending_buf[G.pending++]=G.bi_buf),G.bi_buf=0,G.bi_valid=0},i=(G,D,N,T)=>{const o=2*D,Z=2*N;return G[o]<G[Z]||G[o]===G[Z]&&T[D]<=T[N]},J=(G,D,N)=>{const T=G.heap[N];let o=N<<1;for(;o<=G.heap_len&&(o<G.heap_len&&i(D,G.heap[o+1],G.heap[o],G.depth)&&o++,!i(D,T,G.heap[o],G.depth));)G.heap[N]=G.heap[o],N=o,o<<=1;G.heap[N]=T},p=(G,D,T)=>{let o,Z,P,r,v=0;if(0!==G.last_lit)do{o=G.pending_buf[G.d_buf+2*v]<<8|G.pending_buf[G.d_buf+2*v+1],Z=G.pending_buf[G.l_buf+v],v++,0===o?F(G,Z,D):(P=X[Z],F(G,P+N+1,D),r=n[P],0!==r&&(Z-=W[P],B(G,Z,r)),o--,P=L(o),F(G,P,T),r=C[P],0!==r&&(o-=j[P],B(G,o,r)))}while(v<G.last_lit);F(G,256,D)},t=(G,D)=>{const N=D.dyn_tree,T=D.stat_desc.static_tree,o=D.stat_desc.has_stree,n=D.stat_desc.elems;let C,P,r,v=-1;for(G.heap_len=0,G.heap_max=573,C=0;C<n;C++)0!==N[2*C]?(G.heap[++G.heap_len]=v=C,G.depth[C]=0):N[2*C+1]=0;for(;G.heap_len<2;)r=G.heap[++G.heap_len]=v<2?++v:0,N[2*r]=1,G.depth[r]=0,G.opt_len--,o&&(G.static_len-=T[2*r+1]);for(D.max_code=v,C=G.heap_len>>1;C>=1;C--)J(G,N,C);r=n;do{C=G.heap[1],G.heap[1]=G.heap[G.heap_len--],J(G,N,1),P=G.heap[1],G.heap[--G.heap_max]=C,G.heap[--G.heap_max]=P,N[2*r]=N[2*C]+N[2*P],G.depth[r]=(G.depth[C]>=G.depth[P]?G.depth[C]:G.depth[P])+1,N[2*C+1]=N[2*P+1]=r,G.heap[1]=r++,J(G,N,1)}while(G.heap_len>=2);G.heap[--G.heap_max]=G.heap[1],((G,D)=>{const N=D.dyn_tree,T=D.max_code,o=D.stat_desc.static_tree,n=D.stat_desc.has_stree,C=D.stat_desc.extra_bits,P=D.stat_desc.extra_base,r=D.stat_desc.max_length;let v,q,g,X,W,j,Y=0;for(X=0;X<=Z;X++)G.bl_count[X]=0;for(N[2*G.heap[G.heap_max]+1]=0,v=G.heap_max+1;v<573;v++)q=G.heap[v],X=N[2*N[2*q+1]+1]+1,X>r&&(X=r,Y++),N[2*q+1]=X,q>T||(G.bl_count[X]++,W=0,q>=P&&(W=C[q-P]),j=N[2*q],G.opt_len+=j*(X+W),n&&(G.static_len+=j*(o[2*q+1]+W)));if(0!==Y){do{for(X=r-1;0===G.bl_count[X];)X--;G.bl_count[X]--,G.bl_count[X+1]+=2,G.bl_count[r]--,Y-=2}while(Y>0);for(X=r;0!==X;X--)for(q=G.bl_count[X];0!==q;)g=G.heap[--v],g>T||(N[2*g+1]!==X&&(G.opt_len+=(X-N[2*g+1])*N[2*g],N[2*g+1]=X),q--)}})(G,D),V(N,v,G.bl_count)},H=(G,D,N)=>{let T,o,Z=-1,n=D[1],C=0,P=7,r=4;for(0===n&&(P=138,r=3),D[2*(N+1)+1]=65535,T=0;T<=N;T++)o=n,n=D[2*(T+1)+1],++C<P&&o===n||(C<r?G.bl_tree[2*o]+=C:0!==o?(o!==Z&&G.bl_tree[2*o]++,G.bl_tree[32]++):C<=10?G.bl_tree[34]++:G.bl_tree[36]++,C=0,Z=o,0===n?(P=138,r=3):o===n?(P=6,r=3):(P=7,r=4))},s=(G,D,N)=>{let T,o,Z=-1,n=D[1],C=0,P=7,r=4;for(0===n&&(P=138,r=3),T=0;T<=N;T++)if(o=n,n=D[2*(T+1)+1],!(++C<P&&o===n)){if(C<r)do{F(G,o,G.bl_tree)}while(0!==--C);else 0!==o?(o!==Z&&(F(G,o,G.bl_tree),C--),F(G,16,G.bl_tree),B(G,C-3,2)):C<=10?(F(G,17,G.bl_tree),B(G,C-3,3)):(F(G,18,G.bl_tree),B(G,C-11,7));C=0,Z=o,0===n?(P=138,r=3):o===n?(P=6,r=3):(P=7,r=4)}};let c=!1;const K=(G,D,N,T)=>{B(G,0+(T?1:0),3),((G,D,N,T)=>{z(G),T&&(w(G,N),w(G,~N)),G.pending_buf.set(G.window.subarray(D,D+N),G.pending),G.pending+=N})(G,D,N,!0)};G.exports._tr_init=G=>{c||((()=>{let G,D,N,r,R;const L=new Array(16);for(N=0,r=0;r<28;r++)for(W[r]=N,G=0;G<1<<n[r];G++)X[N++]=r;for(X[N-1]=r,R=0,r=0;r<16;r++)for(j[r]=R,G=0;G<1<<C[r];G++)g[R++]=r;for(R>>=7;r<o;r++)for(j[r]=R<<7,G=0;G<1<<C[r]-7;G++)g[256+R++]=r;for(D=0;D<=Z;D++)L[D]=0;for(G=0;G<=143;)v[2*G+1]=8,G++,L[8]++;for(;G<=255;)v[2*G+1]=9,G++,L[9]++;for(;G<=279;)v[2*G+1]=7,G++,L[7]++;for(;G<=287;)v[2*G+1]=8,G++,L[8]++;for(V(v,287,L),G=0;G<o;G++)q[2*G+1]=5,q[2*G]=S(G,5);y=new Y(v,n,257,T,Z),h=new Y(q,C,0,o,Z),m=new Y(new Array(0),P,0,19,7)})(),c=!0),G.l_desc=new R(G.dyn_ltree,y),G.d_desc=new R(G.dyn_dtree,h),G.bl_desc=new R(G.bl_tree,m),G.bi_buf=0,G.bi_valid=0,U(G)},G.exports._tr_stored_block=K,G.exports._tr_flush_block=(G,D,T,o)=>{let Z,n,C=0;G.level>0?(2===G.strm.data_type&&(G.strm.data_type=(G=>{let D,T=4093624447;for(D=0;D<=31;D++,T>>>=1)if(1&T&&0!==G.dyn_ltree[2*D])return 0;if(0!==G.dyn_ltree[18]||0!==G.dyn_ltree[20]||0!==G.dyn_ltree[26])return 1;for(D=32;D<N;D++)if(0!==G.dyn_ltree[2*D])return 1;return 0})(G)),t(G,G.l_desc),t(G,G.d_desc),C=(G=>{let D;for(H(G,G.dyn_ltree,G.l_desc.max_code),H(G,G.dyn_dtree,G.d_desc.max_code),t(G,G.bl_desc),D=18;D>=3&&0===G.bl_tree[2*r[D]+1];D--);return G.opt_len+=3*(D+1)+5+5+4,D})(G),Z=G.opt_len+3+7>>>3,n=G.static_len+3+7>>>3,n<=Z&&(Z=n)):Z=n=T+5,T+4<=Z&&-1!==D?K(G,D,T,o):4===G.strategy||n===Z?(B(G,2+(o?1:0),3),p(G,v,q)):(B(G,4+(o?1:0),3),((G,D,N,T)=>{let o;for(B(G,D-257,5),B(G,N-1,5),B(G,T-4,4),o=0;o<T;o++)B(G,G.bl_tree[2*r[o]+1],3);s(G,G.dyn_ltree,D-1),s(G,G.dyn_dtree,N-1)})(G,G.l_desc.max_code+1,G.d_desc.max_code+1,C+1),p(G,G.dyn_ltree,G.dyn_dtree)),U(G),o&&z(G)},G.exports._tr_tally=(G,D,T)=>(G.pending_buf[G.d_buf+2*G.last_lit]=D>>>8&255,G.pending_buf[G.d_buf+2*G.last_lit+1]=255&D,G.pending_buf[G.l_buf+G.last_lit]=255&T,G.last_lit++,0===D?G.dyn_ltree[2*T]++:(G.matches++,D--,G.dyn_ltree[2*(X[T]+N+1)]++,G.dyn_dtree[2*L(D)]++),G.last_lit===G.lit_bufsize-1),G.exports._tr_align=G=>{B(G,2,3),F(G,256,v),(G=>{16===G.bi_valid?(w(G,G.bi_buf),G.bi_buf=0,G.bi_valid=0):G.bi_valid>=8&&(G.pending_buf[G.pending++]=255&G.bi_buf,G.bi_buf>>=8,G.bi_valid-=8)})(G)}},11315:G=>{"use strict";G.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11689:G=>{function D(G,D,N){for(var T=G.length,o=-1/0,Z=1/0,n=0;n<T;n++){var C=(N[0][n]-G[n])/D[n],P=(N[1][n]-G[n])/D[n];if(C>P){var r=C;C=P,P=r}if(P<o||C>Z)return 1/0;C>o&&(o=C),P<Z&&(Z=P)}return o>Z?1/0:o}G.exports=function(G,N,T,o){var Z=D(N,T,o);if(Z===1/0)G=null;else{G=G||[];for(var n=0;n<N.length;n++)G[n]=N[n]+T[n]*Z}return G},G.exports.distance=D},12056:(G,D,N)=>{"use strict";N.d(D,{e:()=>n});var T=N(38);const o=T.useLayoutEffect;const Z=function(G){var D=(0,T.useRef)(G);return o((function(){D.current=G})),D};var n=function(G){var D=Z(G);(0,T.useEffect)((function(){var G=function(G){var N;if(null!=D.current&&(N=D.current(G)),G.defaultPrevented&&(G.returnValue=""),"string"===typeof N)return G.returnValue=N,N};return window.addEventListener("beforeunload",G),function(){window.removeEventListener("beforeunload",G)}}),[])}},12011:(G,D,N)=>{"use strict";var T=N(12014),o=Array.prototype.concat,Z=Array.prototype.slice,n=G.exports=function(G){for(var D=[],N=0,n=G.length;N<n;N++){var C=G[N];T(C)?D=o.call(D,Z.call(C)):D.push(C)}return D};n.wrap=function(G){return function(){return G(n(arguments))}}},12014:G=>{G.exports=function(G){return!(!G||"string"===typeof G)&&(G instanceof Array||Array.isArray(G)||G.length>=0&&(G.splice instanceof Function||Object.getOwnPropertyDescriptor(G,G.length-1)&&"String"!==G.constructor.name))}},11966:G=>{"use strict";var D=[],N=[],T=[],o=[],Z=[],n=[],C=[],P=[],r=[],v=[],q=[],g=[];G.exports=function(G,X,W,j,Y,y){for(var h=C,m=r,R=v,L=g,w=0;w<3;w++)h[w]=+W[w],R[w]=+X.max[w],m[w]=+X.Yc[w];y||(y=1e-10);var B=function(G,C,r,v,g,X){var W=D,j=N,Y=T,y=o,h=Z,m=n,R=P,L=Math.floor,w=0,B=0,F=0,S=0,V=0;if(U(),0===F)return 0;for(S=J();B<=F;){if(z(S)&&i())return w;S=J()}for(w+=F,V=0;V<3;V++)v[V]+=r[V],g[V]+=r[V];return w;function U(){if(B=0,0!==(F=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2])))for(var G=0;G<3;G++){var D=r[G]>=0;y[G]=D?1:-1;var N=D?g[G]:v[G];W[G]=D?v[G]:g[G],j[G]=p(N,y[G]),Y[G]=t(W[G],y[G]),R[G]=r[G]/F,h[G]=Math.abs(1/R[G]);var T=D?j[G]+1-N:N-j[G];m[G]=h[G]<1/0?h[G]*T:1/0}}function z(D){for(var N=y[0],T=0===D?j[0]:Y[0],o=j[0]+N,Z=y[1],n=1===D?j[1]:Y[1],C=j[1]+Z,P=y[2],r=2===D?j[2]:Y[2],v=j[2]+P,q=T;q!=o;q+=N)for(var g=n;g!=C;g+=Z)for(var X=r;X!=v;X+=P)if(G(q,g,X))return!0;return!1}function i(){w+=B;var G=y[S],D=B/F,N=q;for(V=0;V<3;V++){var T=r[V]*D;v[V]+=T,g[V]+=T,N[V]=r[V]-T}if(G>0?g[S]=Math.round(g[S]):v[S]=Math.round(v[S]),C(w,S,G,N))return!0;for(V=0;V<3;V++)r[V]=N[V];return U(),0===F}function J(){var G=m[0]<m[1]?m[0]<m[2]?0:2:m[1]<m[2]?1:2,D=m[G]-B;for(B=m[G],j[G]+=y[G],m[G]+=h[G],V=0;V<3;V++)W[V]+=D*R[V],Y[V]=t(W[V],y[V]);return G}function p(G,D){return L(G-D*X)}function t(G,D){return L(G+D*X)}}(G,j,h,m,R,y);if(!Y){for(w=0;w<3;w++)L[w]=W[w]>0?R[w]-X.max[w]:m[w]-X.Yc[w];X.translate(L)}return B}},11236:(G,D,N)=>{var T=N(11239);function o(G){for(var D,N,o=0,Z=G.length,n=0;n<G.length;){for(D=G[n],N=0;n<Z&&G[n]===D;)++n,++N;o+=T.log2(N)/7|0,o+=T.log2(D>>>0)/7|0,o+=2}return o}D.size=o,D.encode=function(G,D){D||(D=new Uint8Array(o(G)));for(var N,T,Z=0,n=D.length,C=0;C<G.length;){for(N=G[C],T=0;C<G.length&&G[C]===N;)++C,++T;for(;Z<n&&T>=128;)D[Z++]=128+(127&T),T>>>=7;if(Z>=n)throw new Error("RLE buffer overflow");for(D[Z++]=T,N>>>=0;Z<n&&N>=128;)D[Z++]=128+(127&N),N>>>=7;if(Z>=n)throw new Error("RLE buffer overflow");D[Z++]=N}return D},D.decode=function(G,D){for(var N,T,o,Z,n=D.length,C=G.length,P=0,r=0;r<C;){for(N=0,T=0;r<C&&G[r]>=128;)N+=(127&G[r++])<<T,T+=7;if(N+=G[r++]<<T,r>=C)throw new Error("RLE buffer underrun");if(P+N>n)throw new Error("Chunk buffer overflow");for(o=0,T=0;r<C&&G[r]>=128;)o+=(127&G[r++])<<T,T+=7;if(r>=C)throw new Error("RLE buffer underrun");for(o+=G[r++]<<T,Z=0;Z<N;++Z)D[P++]=o}return D}},11239:(G,D)=>{"use strict";function N(G){var D=32;return(G&=-G)&&D--,65535&G&&(D-=16),16711935&G&&(D-=8),252645135&G&&(D-=4),858993459&G&&(D-=2),1431655765&G&&(D-=1),D}D.INT_BITS=32,D.INT_MAX=2147483647,D.INT_MIN=-1<<31,D.sign=function(G){return(G>0)-(G<0)},D.abs=function(G){var D=G>>31;return(G^D)-D},D.min=function(G,D){return D^(G^D)&-(G<D)},D.max=function(G,D){return G^(G^D)&-(G<D)},D.isPow2=function(G){return!(G&G-1)&&!!G},D.log2=function(G){var D,N;return D=(G>65535)<<4,D|=N=((G>>>=D)>255)<<3,D|=N=((G>>>=N)>15)<<2,(D|=N=((G>>>=N)>3)<<1)|(G>>>=N)>>1},D.log10=function(G){return G>=1e9?9:G>=1e8?8:G>=1e7?7:G>=1e6?6:G>=1e5?5:G>=1e4?4:G>=1e3?3:G>=100?2:G>=10?1:0},D.popCount=function(G){return 16843009*((G=(858993459&(G-=G>>>1&1431655765))+(G>>>2&858993459))+(G>>>4)&252645135)>>>24},D.countTrailingZeros=N,D.nextPow2=function(G){return G+=0===G,--G,G|=G>>>1,G|=G>>>2,G|=G>>>4,G|=G>>>8,(G|=G>>>16)+1},D.prevPow2=function(G){return G|=G>>>1,G|=G>>>2,G|=G>>>4,G|=G>>>8,(G|=G>>>16)-(G>>>1)},D.parity=function(G){return G^=G>>>16,G^=G>>>8,G^=G>>>4,27030>>>(G&=15)&1};var T=new Array(256);!function(G){for(var D=0;D<256;++D){var N=D,T=D,o=7;for(N>>>=1;N;N>>>=1)T<<=1,T|=1&N,--o;G[D]=T<<o&255}}(T),D.reverse=function(G){return T[255&G]<<24|T[G>>>8&255]<<16|T[G>>>16&255]<<8|T[G>>>24&255]},D.interleave2=function(G,D){return(G=1431655765&((G=858993459&((G=252645135&((G=16711935&((G&=65535)|G<<8))|G<<4))|G<<2))|G<<1))|(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D&=65535)|D<<8))|D<<4))|D<<2))|D<<1))<<1},D.deinterleave2=function(G,D){return(G=65535&((G=16711935&((G=252645135&((G=858993459&((G=G>>>D&1431655765)|G>>>1))|G>>>2))|G>>>4))|G>>>16))<<16>>16},D.interleave3=function(G,D,N){return G=1227133513&((G=3272356035&((G=251719695&((G=4278190335&((G&=1023)|G<<16))|G<<8))|G<<4))|G<<2),(G|=(D=1227133513&((D=3272356035&((D=251719695&((D=4278190335&((D&=1023)|D<<16))|D<<8))|D<<4))|D<<2))<<1)|(N=1227133513&((N=3272356035&((N=251719695&((N=4278190335&((N&=1023)|N<<16))|N<<8))|N<<4))|N<<2))<<2},D.deinterleave3=function(G,D){return(G=1023&((G=4278190335&((G=251719695&((G=3272356035&((G=G>>>D&1227133513)|G>>>2))|G>>>4))|G>>>8))|G>>>16))<<22>>22},D.nextCombination=function(G){var D=G|G-1;return D+1|(~D&-~D)-1>>>N(G)+1}},12127:(G,D,N)=>{"use strict";N.d(D,{d:()=>q});var T=N(11963),o=N(125);class Z{constructor(G,D,N,Z,n,C,P){this.ph=new T(G.Yc,G.Hh),this.mass=D,this.friction=N,this.restitution=Z,this.zb=n,this.Jk=C,this.Ib=!!P,this.Gh=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.wl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.rg=o.create(),this.fh=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=o.create(),this._impulses=o.create(),this._sleepFrameCount=10}loadFromCopy(G){o.j(this.ph.Yc,G.ph.Yc),o.j(this.ph.Hh,G.ph.Hh),o.j(this.ph.max,G.ph.max),this.ph.mag=G.ph.mag,this.mass=G.mass,this.friction=G.friction,this.restitution=G.restitution,this.zb=G.zb,this.Jk=G.Jk,this.Ib=G.Ib,this.Gh=G.Gh,this.fluidDrag=G.fluidDrag,this.wl=G.wl,this.preventFallOffEdge=G.preventFallOffEdge,this.rolledBackLastTick=G.rolledBackLastTick,o.j(this.rg,G.rg),o.j(this.fh,G.fh),this.inFluid=G.inFluid,this._ratioInFluid=G._ratioInFluid,o.j(this._forces,G._forces),o.j(this._impulses,G._impulses),this._sleepFrameCount=G._sleepFrameCount}setPosition(G){n(G),o.Jc(G,G,this.ph.Yc),this.ph.translate(G),this.xg()}cb(){return o.clone(this.ph.Yc)}applyForce(G){n(G),o.add(this._forces,this._forces,G),this.xg()}applyImpulse(G){n(G),o.add(this._impulses,this._impulses,G),this.xg()}xg(){this._sleepFrameCount=10}atRestX(){return this.fh[0]}atRestY(){return this.fh[1]}atRestZ(){return this.fh[2]}}var n=G=>{};var C=N(11963),P=N(125),r=N(11966);function v(){this.Gh=.1,this.fluidDrag=.4,this.Gc=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function q(G,D,N){G=Object.assign(new v,G),this.gravity=G.gravity||[0,-10,0],this.Gh=G.Gh||.1,this.Gc=G.Gc||2,this.fluidDrag=G.fluidDrag||.4,this.minBounceImpulse=G.minBounceImpulse,this.bodies=[],this.ek=G.ek,this.testSolid=D,this.testFluid=N}q.prototype.Qk=function(G,D,N,T,o,n){G=G||new C([0,0,0],[1,1,1]),"undefined"==typeof D&&(D=1),"undefined"==typeof N&&(N=1),"undefined"==typeof T&&(T=0),"undefined"==typeof o&&(o=1);var P=new Z(G,D,N,T,o,n);return this.bodies.push(P),P},q.prototype.Rk=function(G){var D=this.bodies.indexOf(G);D<0||(this.bodies.splice(D,1),G.ph=G.Jk=null)};var g=P.create(),X=P.create(),W=P.create(),j=P.create(),Y=P.create(),y=P.create(),h=P.create(),m=new C([0,0,0],[1,1,1]),R=new Z(m,1,1,0,1,(()=>{}),!1);function L(G,D,N){return D=N,D*=1-(1-G.ratioInFluid)**2}q.prototype.vf=function(G){G/=1e3;var D=b(0,P.squaredLength(this.gravity));this.bodies.forEach((N=>function(G,D,N,T){P.j(Y,D.fh),G.ek&&R.loadFromCopy(D);if(D.mass<=0)return P.set(D.rg,0,0,0),P.set(D._forces,0,0,0),void P.set(D._impulses,0,0,0);var o=T||0===D.zb;if(function(G,D,N,T){if(D._sleepFrameCount>0)return!1;if(T)return!0;var o=!1,Z=.5*N*N*D.zb;return P.scale(K,G.gravity,Z),r(G.testSolid,D.ph,K,(function(){return o=!0,!0}),!0),o}(G,D,N,o))return;D._sleepFrameCount--,function(G,D){var N=D.ph,T=Math.floor(N.Yc[0]),o=Math.floor(N.Yc[2]),Z=Math.floor(N.Yc[1]),n=Math.floor(N.max[1]);if(!G.testFluid(T,Z,o))return D.inFluid=!1,void(D.ratioInFluid=0);var C=1,r=Z+1;for(;r<=n&&G.testFluid(T,r,o);)C++,r++;var v=(Z+C-N.Yc[1])/N.Hh[1];v>1&&(v=1);var q=N.Hh[0]*N.Hh[1]*N.Hh[2]*v,g=B;P.scale(g,G.gravity,-G.Gc*q*D.zb),D.applyForce(g),D.inFluid=!0,D.ratioInFluid=v}(G,D),Q(D._forces),Q(D._impulses),Q(D.rg),Q(D.fh),P.scale(g,D._forces,1/D.mass),P.Lc(g,g,G.gravity,D.zb),P.scale(X,D._impulses,1/D.mass),P.Lc(X,X,g,N),P.add(D.rg,D.rg,X),D.friction&&(F(G,0,D,X,N),F(G,1,D,X,N),F(G,2,D,X,N));var Z=D.fluidDrag>=0?D.fluidDrag:G.fluidDrag,n=D.Gh>=0?D.Gh:G.Gh,C=n,v=n;D.inFluid&&(C=L(D,C,D.fluidDragHoriz>=0?D.fluidDragHoriz:Z),v=L(D,v,D.fluidDragVert>=0?D.fluidDragVert:Z));C=Math.max(1-C*N/D.mass,0),v=Math.max(1-v*N/D.mass,0),P.set(w,C,v,C),P.multiply(D.rg,D.rg,w),P.scale(W,D.rg,N),P.set(D._forces,0,0,0),P.set(D._impulses,0,0,0),D.Ib&&O(U,D.ph);P.j(y,W),P.set(h,0,0,0),D.preventFallOffEdge&&function(G,D,N,T){if(!D.fh[1]||N[1]>0)return;var o=H;O(o,D.ph);for(var Z=0;Z<3;Z+=2){P.set(t,0,0,0),t[Z]=N[Z];var n=!0;(n=(n=(n=(n=n&&!c(G,o.Yc[0]+t[0]+1e-5,o.Yc[1],o.Yc[2]+t[2]+1e-5))&&!c(G,o.max[0]+t[0]-1e-5,o.Yc[1],o.Yc[2]+t[2]+1e-5))&&!c(G,o.Yc[0]+t[0]+1e-5,o.Yc[1],o.max[2]+t[2]-1e-5))&&!c(G,o.max[0]+t[0]-1e-5,o.Yc[1],o.max[2]+t[2]-1e-5))?(T[Z]=N[Z]>0?1:-1,N[Z]=0):0===Z&&(P.set(s,N[0],0,0),V(G,o,s,T,D.slideOnCollision))}}(G,D,W,h);V(G,D.ph,W,D.fh,D.slideOnCollision),D.Ib&&function(G,D,N,T){if(D.fh[1]>=0&&!D.inFluid)return;var o=0!==D.fh[0],Z=0!==D.fh[2];if(!o&&!Z)return;var n=Math.abs(T[0]/T[2]),C=4;if(!o&&n>C)return;if(!Z&&n<1/C)return;P.add(i,N.Yc,T);var v=G.testSolid;r(v,N,T,(function(G,D,N,T){if(1!==D)return!0;T[D]=0}));var q=N.Yc[1],g=D.inFluid?1.951:1.001,X=Math.floor(q+g)-q;P.set(J,0,X,0);var W=!1;if(r(v,N,J,(function(G,D,N,T){return W=!0,!0})),W)return;P.Jc(p,i,N.Yc),p[1]=0,V(G,N,p,z,!0);var j=b(N.Yc[0],i[0]),Y=b(N.Yc[2],i[2]);if(o&&!j&&(!Y||!Z))return;if(Z&&(!j||!o)&&!Y)return;var y=!0;if(y=y&&!c(G,N.Yc[0]+1e-5,N.Yc[1],N.Yc[2]+1e-5),y=y&&!c(G,N.max[0]-1e-5,N.Yc[1],N.Yc[2]+1e-5),y=y&&!c(G,N.Yc[0]+1e-5,N.Yc[1],N.max[2]-1e-5),y=y&&!c(G,N.max[0]-1e-5,N.Yc[1],N.max[2]-1e-5),y)return;O(D.ph,N),D.fh[0]=z[0],D.fh[2]=z[2],D.wl&&D.wl()}(G,D,U,y);for(var q=0;q<3;++q)D.fh[q]=D.fh[q]||h[q],j[q]=0,D.fh[q]&&(Y[q]||(j[q]=-D.rg[q]),D.rg[q]=0);var m=P.length(j);m>.001&&(P.scale(j,j,D.mass),D.Jk&&D.Jk(j),D.restitution>0&&m>G.minBounceImpulse&&(P.scale(j,j,D.restitution),D.applyImpulse(j)));var S=P.squaredLength(D.rg);S>1e-5&&D.xg();G.ek&&G.ek(D)?(D.loadFromCopy(R),D.rolledBackLastTick=!0):D.rolledBackLastTick=!1}(this,N,G,D)))};var w=P.create([0,0,0]);var B=P.create();function F(G,D,N,T,o){var Z=N.fh[D],n=T[D];if(!N.alwaysApplyHorizFriction||1!==D){if(0===Z)return;if(Z*n<=0)return}P.j(S,N.rg),S[D]=0;var C=P.length(S);if(!b(C,0)){var r=Math.abs(N.friction*G.gravity[D]*o),v=C>r?(C-r)/C:0;N.rg[(D+1)%3]*=v,N.rg[(D+2)%3]*=v}}var S=P.create();function V(G,D,N,T,o){return P.set(T,0,0,0),r(G.testSolid,D,N,(function(G,D,N,Z){T[D]=N,Z[D]=0,o||(Z[0]=0,Z[1]=0,Z[2]=0)}))}var U=new C([],[]),z=P.create(),i=P.create(),J=P.create(),p=P.create();var t=P.create(),H=new C([],[]),s=P.create();function c(G,D,N,T){return G.testSolid(Math.floor(D),Math.floor(N-1),Math.floor(T))}var K=P.create();function b(G,D){return Math.abs(G-D)<1e-5}function O(G,D){for(var N=0;N<3;N++)G.Yc[N]=D.Yc[N],G.max[N]=D.max[N],G.Hh[N]=D.Hh[N]}var Q=function(G){}},11258:G=>{"use strict";G.exports=function(G,D,N,T){var o=self||window;try{try{var Z;try{Z=new o.Blob([G])}catch(r){(Z=new(o.BlobBuilder||o.WebKitBlobBuilder||o.MozBlobBuilder||o.MSBlobBuilder)).append(G),Z=Z.getBlob()}var n=o.URL||o.webkitURL,C=n.createObjectURL(Z),P=new o[D](C,N);return n.revokeObjectURL(C),P}catch(r){return new o[D]("data:application/javascript,".concat(encodeURIComponent(G)),N)}}catch(r){if(!T)throw Error("Inline worker is not supported");return new o[D](T,N)}}},11669:(G,D,N)=>{"use strict";function T(G,D,N,T,o){var Z={};return Object.keys(T).forEach((function(G){Z[G]=T[G]})),Z.enumerable=!!Z.enumerable,Z.configurable=!!Z.configurable,("value"in Z||Z.initializer)&&(Z.writable=!0),Z=N.slice().reverse().reduce((function(N,T){return T(G,D,N)||N}),Z),o&&void 0!==Z.initializer&&(Z.value=Z.initializer?Z.initializer.call(o):void 0,Z.initializer=void 0),void 0===Z.initializer&&(Object.defineProperty(G,D,Z),Z=null),Z}N.d(D,{b:()=>T})},11667:(G,D,N)=>{"use strict";function T(G,D,N,T){N&&Object.defineProperty(G,D,{enumerable:N.enumerable,configurable:N.configurable,writable:N.writable,value:N.initializer?N.initializer.call(T):void 0})}N.d(D,{e:()=>T})},11733:(G,D,N)=>{"use strict";N.d(D,{b:()=>m,f:()=>Y,j:()=>y,l:()=>g,n:()=>j,o:()=>W,p:()=>X});var T=N(1009),o=N(1185),Z=N(1038),n=N(1018),C=N(11736),P=N(11399),r=N(1175),v=N(1064),q=N(1181);const g=Object.freeze(new T.g(0,0,0,0)),X=Object.freeze(T.s.Zero()),W=Object.freeze(T.o.Zero()),j=Object.freeze(r.d.Zero()),Y=Object.freeze(o.d.Black()),y=Object.freeze(new o.g(0,0,0,0)),h={key:0,repeatCount:0,loopMode:2};class m{static _PrepareAnimation(G,D,N,Z,n,C,P,v){let q;if(!isNaN(parseFloat(n))&&isFinite(n)?q=m.ANIMATIONTYPE_FLOAT:n instanceof T.g?q=m.ANIMATIONTYPE_QUATERNION:n instanceof T.s?q=m.ANIMATIONTYPE_VECTOR3:n instanceof T.o?q=m.ANIMATIONTYPE_VECTOR2:n instanceof o.d?q=m.ANIMATIONTYPE_COLOR3:n instanceof o.g?q=m.ANIMATIONTYPE_COLOR4:n instanceof r.d&&(q=m.ANIMATIONTYPE_SIZE),void 0==q)return null;const g=new m(G,D,N,q,P),X=[{frame:0,value:n},{frame:Z,value:C}];return g.setKeys(X),void 0!==v&&g.setEasingFunction(v),g}static CreateAnimation(G,D,N,T){const o=new m(G+"Animation",G,N,D,m.ANIMATIONLOOPMODE_CONSTANT);return o.setEasingFunction(T),o}static CreateAndStartAnimation(G,D,N,T,o,Z,n,C,P,r,v){const q=m._PrepareAnimation(G,N,T,o,Z,n,C,P);return q?(D.va&&(v=D.va()),v?v.beginDirectAnimation(D,[q],0,o,1===q.loopMode,1,r):null):null}static CreateAndStartHierarchyAnimation(G,D,N,T,o,Z,n,C,P,r,v){const q=m._PrepareAnimation(G,T,o,Z,n,C,P,r);if(!q)return null;return D.va().beginDirectHierarchyAnimation(D,N,[q],0,Z,1===q.loopMode,1,v)}static CreateMergeAndStartAnimation(G,D,N,T,o,Z,n,C,P,r){const v=m._PrepareAnimation(G,N,T,o,Z,n,C,P);return v?(D.animations.push(v),D.va().beginAnimation(D,0,o,1===v.loopMode,1,r)):null}static MakeAnimationAdditive(G,D,N){let o;o="object"===typeof D?D:{referenceFrame:D??0,range:N,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let Z=G;if(o.cloneOriginalAnimation&&(Z=G.clone(),Z.name=o.clonedAnimationName||Z.name),!Z._keys.length)return Z;const n=o.referenceFrame&&o.referenceFrame>=0?o.referenceFrame:0;let C=0;const P=Z._keys[0];let r=Z._keys.length-1;const v=Z._keys[r],q={referenceValue:P.value,referencePosition:T.k.Ad[0],referenceQuaternion:T.k.Quaternion[0],referenceScaling:T.k.Ad[1],keyPosition:T.k.Ad[2],keyQuaternion:T.k.Quaternion[1],keyScaling:T.k.Ad[3]};let g=P.frame,X=v.frame;if(o.range){const G=Z.getRange(o.range);G&&(g=G.from,X=G.to)}else g=o.fromFrame??g,X=o.toFrame??X;if(g!==P.frame&&(C=Z.createKeyForFrame(g)),X!==v.frame&&(r=Z.createKeyForFrame(X)),1===Z._keys.length){const G=Z._getKeyValue(Z._keys[0]);q.referenceValue=G.clone?G.clone():G}else if(n<=P.frame){const G=Z._getKeyValue(P.value);q.referenceValue=G.clone?G.clone():G}else if(n>=v.frame){const G=Z._getKeyValue(v.value);q.referenceValue=G.clone?G.clone():G}else{h.key=0;const G=Z._interpolate(n,h);q.referenceValue=G.clone?G.clone():G}Z.dataType===m.ANIMATIONTYPE_QUATERNION?q.referenceValue.normalize().conjugateInPlace():Z.dataType===m.ANIMATIONTYPE_MATRIX&&(q.referenceValue.decompose(q.referenceScaling,q.referenceQuaternion,q.referencePosition),q.referenceQuaternion.normalize().conjugateInPlace());let W=Number.MAX_VALUE;const j=o.clipKeys?[]:null;for(let Y=C;Y<=r;Y++){let G=Z._keys[Y];if((j||o.cloneOriginalAnimation)&&(G={frame:G.frame,value:G.value.clone?G.value.clone():G.value,inTangent:G.inTangent,outTangent:G.outTangent,interpolation:G.interpolation,lockedTangent:G.lockedTangent},j&&(W===Number.MAX_VALUE&&(W=G.frame),G.frame-=W,j.push(G))),!Y||Z.dataType===m.ANIMATIONTYPE_FLOAT||G.value!==P.value)switch(Z.dataType){case m.ANIMATIONTYPE_MATRIX:G.value.decompose(q.keyScaling,q.keyQuaternion,q.keyPosition),q.keyPosition.nd(q.referencePosition),q.keyScaling.divideInPlace(q.referenceScaling),q.referenceQuaternion.multiplyToRef(q.keyQuaternion,q.keyQuaternion),T.c.ComposeToRef(q.keyScaling,q.keyQuaternion,q.keyPosition,G.value);break;case m.ANIMATIONTYPE_QUATERNION:q.referenceValue.multiplyToRef(G.value,G.value);break;case m.ANIMATIONTYPE_VECTOR2:case m.ANIMATIONTYPE_VECTOR3:case m.ANIMATIONTYPE_COLOR3:case m.ANIMATIONTYPE_COLOR4:G.value.subtractToRef(q.referenceValue,G.value);break;case m.ANIMATIONTYPE_SIZE:G.value.width-=q.referenceValue.width,G.value.height-=q.referenceValue.height;break;default:G.value-=q.referenceValue}}return j&&Z.setKeys(j,!0),Z}static TransitionTo(G,D,N,T,o,Z,n){let C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(n<=0)return N[G]=D,C&&C(),null;const P=o*(n/1e3);Z.setKeys([{frame:0,value:N[G].clone?N[G].clone():N[G]},{frame:P,value:D}]),N.animations||(N.animations=[]),N.animations.push(Z);const r=T.beginAnimation(N,0,P,!1);return r.onAnimationEnd=C,r}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const G of this._runtimeAnimations)if(!G.isStopped())return!0;return!1}constructor(G,D,N,T,o,Z){this.name=G,this.targetProperty=D,this.framePerSecond=N,this.dataType=T,this.loopMode=o,this.enableBlending=Z,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=D.split("."),this.dataType=T,this.loopMode=void 0===o?m.ANIMATIONLOOPMODE_CYCLE:o,this.uniqueId=m._UniqueIdGenerator++}toString(G){let D="Name: "+this.name+", property: "+this.targetProperty;if(D+=", datatype: "+["Float","Ad","Quaternion","Matrix","Md","Vector2"][this.dataType],D+=", nKeys: "+(this._keys?this._keys.length:"none"),D+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),G){D+=", Ranges: {";let G=!0;for(const N in this._ranges)G&&(D+=", ",G=!1),D+=N;D+="}"}return D}addEvent(G){this._events.push(G),this._events.sort(((G,D)=>G.frame-D.frame))}removeEvents(G){for(let D=0;D<this._events.length;D++)this._events[D].frame===G&&(this._events.splice(D,1),D--)}getEvents(){return this._events}createRange(G,D,N){this._ranges[G]||(this._ranges[G]=new C.d(G,D,N))}deleteRange(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const N=this._ranges[G];if(N){if(D){const G=N.from,D=N.to;for(let N=this._keys.length-1;N>=0;N--)this._keys[N].frame>=G&&this._keys[N].frame<=D&&this._keys.splice(N,1)}this._ranges[G]=null}}getRange(G){return this._ranges[G]}getKeys(){return this._keys}getHighestFrame(){let G=0;for(let D=0,N=this._keys.length;D<N;D++)G<this._keys[D].frame&&(G=this._keys[D].frame);return G}getEasingFunction(){return this._easingFunction}setEasingFunction(G){this._easingFunction=G}floatInterpolateFunction(G,D,N){return(0,Z.o)(G,D,N)}floatInterpolateFunctionWithTangents(G,D,N,T,o){return(0,Z.h)(G,D,N,T,o)}quaternionInterpolateFunction(G,D,N){return T.g.Slerp(G,D,N)}quaternionInterpolateFunctionWithTangents(G,D,N,o,Z){return T.g.Hermite(G,D,N,o,Z).normalize()}vector3InterpolateFunction(G,D,N){return T.s.Lerp(G,D,N)}vector3InterpolateFunctionWithTangents(G,D,N,o,Z){return T.s.Hermite(G,D,N,o,Z)}vector2InterpolateFunction(G,D,N){return T.o.Lerp(G,D,N)}vector2InterpolateFunctionWithTangents(G,D,N,o,Z){return T.o.Hermite(G,D,N,o,Z)}sizeInterpolateFunction(G,D,N){return r.d.Lerp(G,D,N)}color3InterpolateFunction(G,D,N){return o.d.Lerp(G,D,N)}color3InterpolateFunctionWithTangents(G,D,N,T,Z){return o.d.Hermite(G,D,N,T,Z)}color4InterpolateFunction(G,D,N){return o.g.Lerp(G,D,N)}color4InterpolateFunctionWithTangents(G,D,N,T,Z){return o.g.Hermite(G,D,N,T,Z)}_getKeyValue(G){return"function"===typeof G?G():G}evaluate(G){return h.key=0,this._interpolate(G,h)}_interpolate(G,D){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(D.loopMode===m.ANIMATIONLOOPMODE_CONSTANT&&D.repeatCount>0)return D.highLimitValue.clone?D.highLimitValue.clone():D.highLimitValue;const T=this._keys,o=T.length;let Z=D.key;for(;Z>=0&&G<T[Z].frame;)--Z;for(;Z+1<=o-1&&G>=T[Z+1].frame;)++Z;if(D.key=Z,Z<0)return N?void 0:this._getKeyValue(T[0].value);if(Z+1>o-1)return N?void 0:this._getKeyValue(T[o-1].value);const n=T[Z],C=T[Z+1];if(N&&(G===n.frame||G===C.frame))return;const P=this._getKeyValue(n.value),r=this._getKeyValue(C.value);if(1===n.interpolation)return C.frame>G?P:r;const v=void 0!==n.outTangent&&void 0!==C.inTangent,q=C.frame-n.frame;let h=(G-n.frame)/q;const R=n.easingFunction||this.getEasingFunction();switch(null!==R&&(h=R.ease(h)),this.dataType){case m.ANIMATIONTYPE_FLOAT:{const G=v?this.floatInterpolateFunctionWithTangents(P,n.outTangent*q,r,C.inTangent*q,h):this.floatInterpolateFunction(P,r,h);switch(D.loopMode){case m.ANIMATIONLOOPMODE_CYCLE:case m.ANIMATIONLOOPMODE_CONSTANT:case m.ANIMATIONLOOPMODE_YOYO:return G;case m.ANIMATIONLOOPMODE_RELATIVE:case m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(D.offsetValue??0)*D.repeatCount+G}break}case m.ANIMATIONTYPE_QUATERNION:{const G=v?this.quaternionInterpolateFunctionWithTangents(P,n.outTangent.scale(q),r,C.inTangent.scale(q),h):this.quaternionInterpolateFunction(P,r,h);switch(D.loopMode){case m.ANIMATIONLOOPMODE_CYCLE:case m.ANIMATIONLOOPMODE_CONSTANT:case m.ANIMATIONLOOPMODE_YOYO:return G;case m.ANIMATIONLOOPMODE_RELATIVE:case m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return G.addInPlace((D.offsetValue||g).scale(D.repeatCount))}return G}case m.ANIMATIONTYPE_VECTOR3:{const G=v?this.vector3InterpolateFunctionWithTangents(P,n.outTangent.scale(q),r,C.inTangent.scale(q),h):this.vector3InterpolateFunction(P,r,h);switch(D.loopMode){case m.ANIMATIONLOOPMODE_CYCLE:case m.ANIMATIONLOOPMODE_CONSTANT:case m.ANIMATIONLOOPMODE_YOYO:return G;case m.ANIMATIONLOOPMODE_RELATIVE:case m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return G.add((D.offsetValue||X).scale(D.repeatCount))}break}case m.ANIMATIONTYPE_VECTOR2:{const G=v?this.vector2InterpolateFunctionWithTangents(P,n.outTangent.scale(q),r,C.inTangent.scale(q),h):this.vector2InterpolateFunction(P,r,h);switch(D.loopMode){case m.ANIMATIONLOOPMODE_CYCLE:case m.ANIMATIONLOOPMODE_CONSTANT:case m.ANIMATIONLOOPMODE_YOYO:return G;case m.ANIMATIONLOOPMODE_RELATIVE:case m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return G.add((D.offsetValue||W).scale(D.repeatCount))}break}case m.ANIMATIONTYPE_SIZE:switch(D.loopMode){case m.ANIMATIONLOOPMODE_CYCLE:case m.ANIMATIONLOOPMODE_CONSTANT:case m.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(P,r,h);case m.ANIMATIONLOOPMODE_RELATIVE:case m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(P,r,h).add((D.offsetValue||j).scale(D.repeatCount))}break;case m.ANIMATIONTYPE_COLOR3:{const G=v?this.color3InterpolateFunctionWithTangents(P,n.outTangent.scale(q),r,C.inTangent.scale(q),h):this.color3InterpolateFunction(P,r,h);switch(D.loopMode){case m.ANIMATIONLOOPMODE_CYCLE:case m.ANIMATIONLOOPMODE_CONSTANT:case m.ANIMATIONLOOPMODE_YOYO:return G;case m.ANIMATIONLOOPMODE_RELATIVE:case m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return G.add((D.offsetValue||Y).scale(D.repeatCount))}break}case m.ANIMATIONTYPE_COLOR4:{const G=v?this.color4InterpolateFunctionWithTangents(P,n.outTangent.scale(q),r,C.inTangent.scale(q),h):this.color4InterpolateFunction(P,r,h);switch(D.loopMode){case m.ANIMATIONLOOPMODE_CYCLE:case m.ANIMATIONLOOPMODE_CONSTANT:case m.ANIMATIONLOOPMODE_YOYO:return G;case m.ANIMATIONLOOPMODE_RELATIVE:case m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return G.add((D.offsetValue||y).scale(D.repeatCount))}break}case m.ANIMATIONTYPE_MATRIX:switch(D.loopMode){case m.ANIMATIONLOOPMODE_CYCLE:case m.ANIMATIONLOOPMODE_CONSTANT:case m.ANIMATIONLOOPMODE_YOYO:return m.AllowMatricesInterpolation?this.matrixInterpolateFunction(P,r,h,D.workValue):P;case m.ANIMATIONLOOPMODE_RELATIVE:case m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return P}}return 0}matrixInterpolateFunction(G,D,N,o){return m.AllowMatrixDecomposeForInterpolation?o?(T.c.DecomposeLerpToRef(G,D,N,o),o):T.c.DecomposeLerp(G,D,N):o?(T.c.LerpToRef(G,D,N,o),o):T.c.Lerp(G,D,N)}clone(){const G=new m(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(G.enableBlending=this.enableBlending,G.blendingSpeed=this.blendingSpeed,this._keys&&G.setKeys(this._keys),this._ranges){G._ranges={};for(const D in this._ranges){const N=this._ranges[D];N&&(G._ranges[D]=N.clone())}}return G}setKeys(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=D?G:G.slice(0)}createKeyForFrame(G){h.key=0;const D=this._interpolate(G,h,!0);if(!D)return this._keys[h.key].frame===G?h.key:h.key+1;const N={frame:G,value:D.clone?D.clone():D};return this._keys.splice(h.key+1,0,N),h.key+1}serialize(){const G={};G.name=this.name,G.property=this.targetProperty,G.framePerSecond=this.framePerSecond,G.dataType=this.dataType,G.loopBehavior=this.loopMode,G.enableBlending=this.enableBlending,G.blendingSpeed=this.blendingSpeed;const D=this.dataType;G.keys=[];const N=this.getKeys();for(let T=0;T<N.length;T++){const o=N[T],Z={};switch(Z.frame=o.frame,D){case m.ANIMATIONTYPE_FLOAT:Z.values=[o.value],void 0!==o.inTangent&&Z.values.push(o.inTangent),void 0!==o.outTangent&&(void 0===o.inTangent&&Z.values.push(void 0),Z.values.push(o.outTangent)),void 0!==o.interpolation&&(void 0===o.inTangent&&Z.values.push(void 0),void 0===o.outTangent&&Z.values.push(void 0),Z.values.push(o.interpolation));break;case m.ANIMATIONTYPE_QUATERNION:case m.ANIMATIONTYPE_MATRIX:case m.ANIMATIONTYPE_VECTOR3:case m.ANIMATIONTYPE_COLOR3:case m.ANIMATIONTYPE_COLOR4:Z.values=o.value.vd(),void 0!=o.inTangent&&Z.values.push(o.inTangent.vd()),void 0!=o.outTangent&&(void 0===o.inTangent&&Z.values.push(void 0),Z.values.push(o.outTangent.vd())),void 0!==o.interpolation&&(void 0===o.inTangent&&Z.values.push(void 0),void 0===o.outTangent&&Z.values.push(void 0),Z.values.push(o.interpolation))}G.keys.push(Z)}G.ranges=[];for(const T in this._ranges){const D=this._ranges[T];if(!D)continue;const N={};N.name=T,N.from=D.from,N.to=D.to,G.ranges.push(N)}return G}static _UniversalLerp(G,D,N){const T=G.constructor;return T.Lerp?T.Lerp(G,D,N):T.Slerp?T.Slerp(G,D,N):G.toFixed?G*(1-N)+N*D:D}static Parse(G){const D=new m(G.name,G.property,G.framePerSecond,G.dataType,G.loopBehavior),N=G.dataType,Z=[];let n,C;for(G.enableBlending&&(D.enableBlending=G.enableBlending),G.blendingSpeed&&(D.blendingSpeed=G.blendingSpeed),C=0;C<G.keys.length;C++){const D=G.keys[C];let P,r,v;switch(N){case m.ANIMATIONTYPE_FLOAT:n=D.values[0],D.values.length>=2&&(P=D.values[1]),D.values.length>=3&&(r=D.values[2]),D.values.length>=4&&(v=D.values[3]);break;case m.ANIMATIONTYPE_QUATERNION:if(n=T.g.od(D.values),D.values.length>=8){const G=T.g.od(D.values.slice(4,8));G.equals(T.g.Zero())||(P=G)}if(D.values.length>=12){const G=T.g.od(D.values.slice(8,12));G.equals(T.g.Zero())||(r=G)}D.values.length>=13&&(v=D.values[12]);break;case m.ANIMATIONTYPE_MATRIX:n=T.c.od(D.values),D.values.length>=17&&(v=D.values[16]);break;case m.ANIMATIONTYPE_COLOR3:n=o.d.od(D.values),D.values[3]&&(P=o.d.od(D.values[3])),D.values[4]&&(r=o.d.od(D.values[4])),D.values[5]&&(v=D.values[5]);break;case m.ANIMATIONTYPE_COLOR4:n=o.g.od(D.values),D.values[4]&&(P=o.g.od(D.values[4])),D.values[5]&&(r=o.g.od(D.values[5])),D.values[6]&&(v=o.g.od(D.values[6]));break;case m.ANIMATIONTYPE_VECTOR3:default:n=T.s.od(D.values),D.values[3]&&(P=T.s.od(D.values[3])),D.values[4]&&(r=T.s.od(D.values[4])),D.values[5]&&(v=D.values[5])}const q={};q.frame=D.frame,q.value=n,void 0!=P&&(q.inTangent=P),void 0!=r&&(q.outTangent=r),void 0!=v&&(q.interpolation=v),Z.push(q)}if(D.setKeys(Z),G.ranges)for(C=0;C<G.ranges.length;C++)n=G.ranges[C],D.createRange(n.name,n.from,n.to);return D}static AppendSerializedAnimations(G,D){q.e.AppendSerializedAnimations(G,D)}static ParseFromFileAsync(G,D){return new Promise(((N,T)=>{const o=new v.e;o.addEventListener("readystatechange",(()=>{if(4==o.readyState)if(200==o.status){let D=JSON.parse(o.responseText);if(D.animations&&(D=D.animations),D.length){const G=[];for(const N of D)G.push(this.Parse(N));N(G)}else{const T=this.Parse(D);G&&(T.name=G),N(T)}}else T("Unable to load the animation")})),o.open("GET",D),o.send()}))}static ParseFromSnippetAsync(G){return new Promise(((D,N)=>{const T=new v.e;T.addEventListener("readystatechange",(()=>{if(4==T.readyState)if(200==T.status){const N=JSON.parse(JSON.parse(T.responseText).jsonPayload);if(N.animations){const T=JSON.parse(N.animations),o=[];for(const D of T.animations){const N=this.Parse(D);N.snippetId=G,o.push(N)}D(o)}else{const T=JSON.parse(N.animation),o=this.Parse(T);o.snippetId=G,D(o)}}else N("Unable to load the snippet "+G)})),T.open("GET",this.SnippetUrl+"/"+G.replace(/#/g,"/")),T.send()}))}}m._UniqueIdGenerator=0,m.AllowMatricesInterpolation=!1,m.AllowMatrixDecomposeForInterpolation=!0,m.SnippetUrl="https://snippet.babylonjs.com",m.ANIMATIONTYPE_FLOAT=0,m.ANIMATIONTYPE_VECTOR3=1,m.ANIMATIONTYPE_QUATERNION=2,m.ANIMATIONTYPE_MATRIX=3,m.ANIMATIONTYPE_COLOR3=4,m.ANIMATIONTYPE_COLOR4=7,m.ANIMATIONTYPE_VECTOR2=5,m.ANIMATIONTYPE_SIZE=6,m.ANIMATIONLOOPMODE_RELATIVE=0,m.ANIMATIONLOOPMODE_CYCLE=1,m.ANIMATIONLOOPMODE_CONSTANT=2,m.ANIMATIONLOOPMODE_YOYO=4,m.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,m.CreateFromSnippetAsync=m.ParseFromSnippetAsync,(0,n.h)("BABYLON.Animation",m),P.b._AnimationRangeFactory=(G,D,N)=>new C.d(G,D,N)},11736:(G,D,N)=>{"use strict";N.d(D,{d:()=>T});class T{constructor(G,D,N){this.name=G,this.from=D,this.to=N}clone(){return new T(this.name,this.from,this.to)}}},11724:(G,D,N)=>{"use strict";N.d(D,{e:()=>n});var T=N(1009),o=N(1015),Z=N(11399);class n extends Z.b{get _matrix(){return this._compose(),this.Qj}set _matrix(G){(G.updateFlag!==this.Qj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Qj.p(G),this._markAsDirtyAndDecompose())}constructor(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(G,D.va(),!1),this.name=G,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=D,this.Qj=(null===o||void 0===o?void 0:o.clone())??T.c.Identity(),this._restMatrix=Z??this.Qj.clone(),this._bindMatrix=n??this.Qj.clone(),this._index=C,this._absoluteMatrix=new T.c,this._absoluteBindMatrix=new T.c,this._absoluteInverseBindMatrix=new T.c,this._finalMatrix=new T.c,D.bones.push(this),this.setParent(N,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(G){this.setParent(G)}setParent(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==G){if(this.parent){const G=this.parent.children.indexOf(this);-1!==G&&this.parent.children.splice(G,1)}this._parentNode=G,this.parent&&this.parent.children.push(this),D&&this._updateAbsoluteBindMatrices(),this.we()}}getLocalMatrix(){return this._compose(),this.Qj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(G){this._restMatrix.p(G)}setRestPose(G){this.setRestMatrix(G)}getBindPose(){return this.getBindMatrix()}setBindMatrix(G){this.Rd(G)}setBindPose(G){this.setBindMatrix(G)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const G=T.k.Ad[0],D=T.k.Quaternion[0],N=T.k.Ad[1];this.getRestMatrix().decompose(G,D,N),this._linkedTransformNode.position.p(N),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??T.g.Identity(),this._linkedTransformNode.rotationQuaternion.p(D),this._linkedTransformNode.Ed.p(G)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(G){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=G,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Gg}set position(G){this._decompose(),this.Gg.p(G),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(G){this.setRotation(G)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(G){this.setRotationQuaternion(G)}get Ed(){return this.getScale()}set Ed(G){this.setScale(G)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=T.s.Zero(),this._localRotation=T.g.Zero(),this.Gg=T.s.Zero()),this.Qj.decompose(this._localScaling,this._localRotation,this.Gg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,T.c.ComposeToRef(this._localScaling,this._localRotation,this.Gg,this.Qj)):this._needToCompose=!1)}Rd(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(G),D&&this._updateAbsoluteBindMatrices(),N?this._matrix=G:this.we()}_updateAbsoluteBindMatrices(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(G||(G=this._bindMatrix),this.parent?G.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(G),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),D)for(let N=0;N<this.children.length;N++)this.children[N]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}we(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.we(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.we(),this._needToDecompose=!0}_updatePosition(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2?arguments[2]:void 0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Z=this.getLocalMatrix();if(0==D)o?(Z.addAtIndex(12,G.x),Z.addAtIndex(13,G.y),Z.addAtIndex(14,G.z)):Z.setTranslationFromFloats(G.x,G.y,G.z);else{let D=null;N&&(D=N.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const C=n._TmpMats[0],P=n._TmpVecs[0];this.parent?N&&D?(C.p(this.parent.getAbsoluteMatrix()),C.multiplyToRef(D,C)):C.p(this.parent.getAbsoluteMatrix()):T.c.IdentityToRef(C),o&&C.setTranslationFromFloats(0,0,0),C.invert(),T.s.TransformCoordinatesToRef(G,C,P),o?(Z.addAtIndex(12,P.x),Z.addAtIndex(13,P.y),Z.addAtIndex(14,P.z)):Z.setTranslationFromFloats(P.x,P.y,P.z)}this._markAsDirtyAndDecompose()}translate(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2?arguments[2]:void 0;this._updatePosition(G,D,N,!0)}setPosition(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2?arguments[2]:void 0;this._updatePosition(G,D,N,!1)}setAbsolutePosition(G,D){this.setPosition(G,1,D)}scale(G,D,N){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Z=this.getLocalMatrix(),C=n._TmpMats[0];T.c.ScalingToRef(G,D,N,C),C.multiplyToRef(Z,Z),C.invert();for(const T of this.children){const o=T.getLocalMatrix();o.multiplyToRef(C,o),o.multiplyAtIndex(12,G),o.multiplyAtIndex(13,D),o.multiplyAtIndex(14,N),T._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),o)for(const T of this.children)T.scale(G,D,N,o)}setScale(G){this._decompose(),this._localScaling.p(G),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(G){this._decompose(),G.p(this._localScaling)}setYawPitchRoll(G,D,N){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Z=arguments.length>4?arguments[4]:void 0;if(0===o){const C=n._TmpQuat;return T.g.RotationYawPitchRollToRef(G,D,N,C),void this.setRotationQuaternion(C,o,Z)}const C=n._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(C,Z))return;const P=n._TmpMats[1];T.c.RotationYawPitchRollToRef(G,D,N,P),C.multiplyToRef(P,P),this._rotateWithMatrix(P,o,Z)}rotate(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;const Z=n._TmpMats[0];Z.setTranslationFromFloats(0,0,0),T.c.RotationAxisToRef(G,D,Z),this._rotateWithMatrix(Z,N,o)}setAxisAngle(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;if(0===N){const Z=n._TmpQuat;return T.g.RotationAxisToRef(G,D,Z),void this.setRotationQuaternion(Z,N,o)}const Z=n._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Z,o))return;const C=n._TmpMats[1];T.c.RotationAxisToRef(G,D,C),Z.multiplyToRef(C,C),this._rotateWithMatrix(C,N,o)}setRotation(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(G.y,G.x,G.z,D,N)}setRotationQuaternion(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2?arguments[2]:void 0;if(0===D)return this._decompose(),this._localRotation.p(G),void this._markAsDirtyAndCompose();const o=n._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(o,N))return;const Z=n._TmpMats[1];T.c.FromQuaternionToRef(G,Z),o.multiplyToRef(Z,Z),this._rotateWithMatrix(Z,D,N)}setRotationMatrix(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2?arguments[2]:void 0;if(0===D){const o=n._TmpQuat;return T.g.FromRotationMatrixToRef(G,o),void this.setRotationQuaternion(o,D,N)}const o=n._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(o,N))return;const Z=n._TmpMats[1];Z.p(G),o.multiplyToRef(G,Z),this._rotateWithMatrix(Z,D,N)}_rotateWithMatrix(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2?arguments[2]:void 0;const T=this.getLocalMatrix(),o=T.m[12],Z=T.m[13],C=T.m[14],P=this.getParent(),r=n._TmpMats[3],v=n._TmpMats[4];P&&1==D?(N?(r.p(N.getWorldMatrix()),P.getAbsoluteMatrix().multiplyToRef(r,r)):r.p(P.getAbsoluteMatrix()),v.p(r),v.invert(),T.multiplyToRef(r,T),T.multiplyToRef(G,T),T.multiplyToRef(v,T)):1==D&&N?(r.p(N.getWorldMatrix()),v.p(r),v.invert(),T.multiplyToRef(r,T),T.multiplyToRef(G,T),T.multiplyToRef(v,T)):T.multiplyToRef(G,T),T.setTranslationFromFloats(o,Z,C),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(G,D){const N=n._TmpMats[2];return G.p(this.getAbsoluteMatrix()),D?(G.multiplyToRef(D.getWorldMatrix(),G),T.c.ScalingToRef(D.Ed.x,D.Ed.y,D.Ed.z,N)):T.c.IdentityToRef(N),G.invert(),!isNaN(G.m[0])&&(N.multiplyAtIndex(0,this._scalingDeterminant),G.multiplyToRef(N,G),!0)}cb(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=T.s.Zero();return this.getPositionToRef(G,D,N),N}getPositionToRef(){let G=arguments.length>1?arguments[1]:void 0,D=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const G=this.getLocalMatrix();D.x=G.m[12],D.y=G.m[13],D.z=G.m[14]}else{let N=null;G&&(N=G.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let T=n._TmpMats[0];G&&N?(T.p(this.getAbsoluteMatrix()),T.multiplyToRef(N,T)):T=this.getAbsoluteMatrix(),D.x=T.m[12],D.y=T.m[13],D.z=T.m[14]}}getAbsolutePosition(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const D=T.s.Zero();return this.getPositionToRef(1,G,D),D}getAbsolutePositionToRef(G,D){this.getPositionToRef(1,G,D)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Qj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Qj);const G=this._skeleton.getPoseMatrix();G&&this._absoluteMatrix.multiplyToRef(G,this._absoluteMatrix)}const G=this.children,D=G.length;for(let N=0;N<D;N++)G[N].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}te(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=T.s.Zero();return this.getDirectionToRef(G,D,N),N}getDirectionToRef(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0,o=null;D&&(o=D.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Z=n._TmpMats[0];Z.p(this.getAbsoluteMatrix()),D&&o&&Z.multiplyToRef(o,Z),T.s.TransformNormalToRef(G,Z,N),N.normalize()}getRotation(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=T.s.Zero();return this.getRotationToRef(G,D,N),N}getRotationToRef(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0;const T=n._TmpQuat;this.getRotationQuaternionToRef(G,D,T),T.toEulerAnglesToRef(N)}getRotationQuaternion(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=T.g.Identity();return this.getRotationQuaternionToRef(G,D,N),N}getRotationQuaternionToRef(){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),D.p(this._localRotation);else{const N=n._TmpMats[0],T=this.getAbsoluteMatrix();G?T.multiplyToRef(G.getWorldMatrix(),N):N.p(T),N.multiplyAtIndex(0,this._scalingDeterminant),N.multiplyAtIndex(1,this._scalingDeterminant),N.multiplyAtIndex(2,this._scalingDeterminant),N.decompose(void 0,D,void 0)}}getRotationMatrix(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,D=arguments.length>1?arguments[1]:void 0;const N=T.c.Identity();return this.getRotationMatrixToRef(G,D,N),N}getRotationMatrixToRef(){let G=arguments.length>1?arguments[1]:void 0,D=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(D);else{const N=n._TmpMats[0],T=this.getAbsoluteMatrix();G?T.multiplyToRef(G.getWorldMatrix(),N):N.p(T),N.multiplyAtIndex(0,this._scalingDeterminant),N.multiplyAtIndex(1,this._scalingDeterminant),N.multiplyAtIndex(2,this._scalingDeterminant),N.getRotationMatrixToRef(D)}}getAbsolutePositionFromLocal(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=T.s.Zero();return this.getAbsolutePositionFromLocalToRef(G,D,N),N}getAbsolutePositionFromLocalToRef(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0,o=null;D&&(o=D.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Z=n._TmpMats[0];Z.p(this.getAbsoluteMatrix()),D&&o&&Z.multiplyToRef(o,Z),T.s.TransformCoordinatesToRef(G,Z,N)}getLocalPositionFromAbsolute(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=T.s.Zero();return this.getLocalPositionFromAbsoluteToRef(G,D,N),N}getLocalPositionFromAbsoluteToRef(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0,o=null;D&&(o=D.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Z=n._TmpMats[0];Z.p(this.getAbsoluteMatrix()),D&&o&&Z.multiplyToRef(o,Z),Z.invert(),T.s.TransformCoordinatesToRef(G,Z,N)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}n._TmpVecs=(0,o.d)(2,T.s.Zero),n._TmpQuat=T.g.Identity(),n._TmpMats=(0,o.d)(5,T.c.Identity)},12043:(G,D,N)=>{"use strict";N.d(D,{b:()=>p});var T=N(980),o=N(985),Z=N(1003),n=N(1009),C=N(11399),P=N(11378),r=N(1285),v=N(1153),q=N(1012);class g{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(G){this._zoomStopsAnimation=G}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(G){this._idleRotationSpeed=G}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(G){this._idleRotationWaitTime=G}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(G){this._idleRotationSpinupTime=G}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(G){this._attachedCamera=G;const D=this._attachedCamera.va();this._onPrePointerObservableObserver=D.onPrePointerObservable.add((G=>{G.type!==r.b.POINTERDOWN?G.type===r.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=G.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const G=v.e.Now;let D=0;null!=this._lastFrameTime&&(D=G-this._lastFrameTime),this._lastFrameTime=G,this._applyUserInteraction();const N=G-this._lastInteractionTime-this._idleRotationWaitTime,T=Math.max(Math.min(N/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*T,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(D/1e3))}))}detach(){if(!this._attachedCamera)return;const G=this._attachedCamera.va();this._onPrePointerObservableObserver&&G.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(G){this._lastInteractionTime=G??v.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<q.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let G=!1;return this._lastFrameRadius===this._attachedCamera.i&&0!==this._attachedCamera.inertialRadiusOffset&&(G=!0),this._lastFrameRadius=this._attachedCamera.i,this._zoomStopsAnimation?G:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=v.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}N(1486);class X{constructor(){this._easingMode=X.EASINGMODE_EASEIN}setEasingMode(G){const D=Math.min(Math.max(G,0),2);this._easingMode=D}getEasingMode(){return this._easingMode}easeInCore(G){throw new Error("You must implement this method")}ease(G){switch(this._easingMode){case X.EASINGMODE_EASEIN:return this.easeInCore(G);case X.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-G)}return G>=.5?.5*(1-this.easeInCore(2*(1-G)))+.5:.5*this.easeInCore(2*G)}}X.EASINGMODE_EASEIN=0,X.EASINGMODE_EASEOUT=1,X.EASINGMODE_EASEINOUT=2;var W=N(11733);class j{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(G){if(this._autoTransitionRange===G)return;this._autoTransitionRange=G;const D=this._attachedCamera;D&&(G?this._onMeshTargetChangedObserver=D.onMeshTargetChangedObservable.add((G=>{if(G&&(G.se(!0),G.getBoundingInfo)){const D=G.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*D,this.upperRadiusTransitionRange=.05*D}})):this._onMeshTargetChangedObserver&&D.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(G){this._attachedCamera=G,this._onAfterCheckInputsObserver=G.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(G){return!!this._attachedCamera&&(this._attachedCamera.i===G&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(G){if(!this._attachedCamera)return;this._radiusBounceTransition||(j.EasingFunction.setEasingMode(j.EasingMode),this._radiusBounceTransition=W.b.CreateAnimation("i",W.b.ANIMATIONTYPE_FLOAT,60,j.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const D=W.b.TransitionTo("i",this._attachedCamera.i+G,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));D&&this._animatables.push(D)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}j.EasingFunction=new class extends X{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=G}easeInCore(G){const D=Math.max(0,this.amplitude);return Math.pow(G,3)-G*D*Math.sin(3.141592653589793*G)}}(.3),j.EasingMode=X.EASINGMODE_EASEOUT;class Y{constructor(){this.onTargetFramingAnimationEndObservable=new Z.b,this._mode=Y.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(G){this._mode=G}get mode(){return this._mode}set radiusScale(G){this._radiusScale=G}get radiusScale(){return this._radiusScale}set positionScale(G){this._positionScale=G}get positionScale(){return this._positionScale}set defaultElevation(G){this._defaultElevation=G}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(G){this._elevationReturnTime=G}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(G){this._elevationReturnWaitTime=G}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(G){this._zoomStopsAnimation=G}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(G){this._framingTime=G}get framingTime(){return this._framingTime}init(){}attach(G){this._attachedCamera=G;const D=this._attachedCamera.va();Y.EasingFunction.setEasingMode(Y.EasingMode),this._onPrePointerObservableObserver=D.onPrePointerObservable.add((G=>{G.type!==r.b.POINTERDOWN?G.type===r.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=G.onMeshTargetChangedObservable.add((G=>{G&&G.getBoundingInfo&&this.zoomOnMesh(G,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=G.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const G=this._attachedCamera.va();this._onPrePointerObservableObserver&&G.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;G.se(!0);const T=G.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(T.minimumWorld,T.maximumWorld,D,N)}zoomOnMeshHierarchy(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;G.se(!0);const T=G.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(T.min,T.max,D,N)}zoomOnMeshesHierarchy(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new n.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new n.s(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let Z=0;Z<G.length;Z++){const D=G[Z].getHierarchyBoundingVectors(!0);n.s.CheckExtends(D.min,T,o),n.s.CheckExtends(D.max,T,o)}this.zoomOnBoundingInfo(T,o,D,N)}zoomOnBoundingInfo(G,D){let N,T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const Z=G.y,C=Z+(D.y-Z)*this._positionScale,P=D.Jc(G).scale(.5);if(T)N=new n.s(0,C,0);else{const D=G.add(P);N=new n.s(D.x,C,D.z)}this._vectorTransition||(this._vectorTransition=W.b.CreateAnimation("target",W.b.ANIMATIONTYPE_VECTOR3,60,Y.EasingFunction)),this._betaIsAnimating=!0;let r=W.b.TransitionTo("target",N,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);r&&this._animatables.push(r);let v=0;if(this._mode===Y.FitFrustumSidesMode){const N=this._calculateLowerRadiusFromModelBoundingSphere(G,D);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=P.length()+this._attachedCamera.fj),v=N}else this._mode===Y.IgnoreBoundsSizeMode&&(v=this._calculateLowerRadiusFromModelBoundingSphere(G,D),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.fj));if(this.autoCorrectCameraLimitsAndSensibility){const N=D.Jc(G).length();this._attachedCamera.panningSensibility=5e3/N,this._attachedCamera.wheelPrecision=100/v}return this._radiusTransition||(this._radiusTransition=W.b.CreateAnimation("i",W.b.ANIMATIONTYPE_FLOAT,60,Y.EasingFunction)),r=W.b.TransitionTo("i",v,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),o&&o(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),r&&this._animatables.push(r),!0}_calculateLowerRadiusFromModelBoundingSphere(G,D){const N=this._attachedCamera;if(!N)return 0;let T=N._calculateLowerRadiusFromModelBoundingSphere(G,D,this._radiusScale);return N.lowerRadiusLimit&&this._mode===Y.IgnoreBoundsSizeMode&&(T=T<N.lowerRadiusLimit?N.lowerRadiusLimit:T),N.upperRadiusLimit&&(T=T>N.upperRadiusLimit?N.upperRadiusLimit:T),T}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const G=v.e.Now-this._lastInteractionTime,D=.5*Math.PI-this._defaultElevation,N=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>N&&G>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=W.b.CreateAnimation("beta",W.b.ANIMATIONTYPE_FLOAT,60,Y.EasingFunction));const G=W.b.TransitionTo("beta",D,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));G&&this._animatables.push(G)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=v.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}Y.EasingFunction=new class extends X{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=G}easeInCore(G){return this.exponent<=0?G:(Math.exp(this.exponent*G)-1)/(Math.exp(this.exponent)-1)}},Y.EasingMode=X.EASINGMODE_EASEINOUT,Y.IgnoreBoundsSizeMode=0,Y.FitFrustumSidesMode=1;var y=N(11393),h=N(11706),m=N(11715),R=N(1223);class L{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(G){G=R.f.BackCompatCameraNoPreventDefault(arguments);const D=this.camera.getEngine(),N=D.getInputElement();let T=0,o=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=Z=>{var n,C;const P=Z.event,v="touch"===P.pointerType;if(Z.type!==r.b.POINTERMOVE&&-1===this.buttons.indexOf(P.button))return;const q=P.target;if(this._altKey=P.altKey,this._ctrlKey=P.ctrlKey,this._metaKey=P.metaKey,this._shiftKey=P.shiftKey,this._buttonsPressed=P.buttons,D.isPointerLock){const G=P.movementX,D=P.movementY;this.onTouch(null,G,D),this._pointA=null,this._pointB=null}else{if(Z.type!==r.b.POINTERDOWN&&Z.type!==r.b.POINTERDOUBLETAP&&v&&(null===(n=this._pointA)||void 0===n?void 0:n.pointerId)!==P.pointerId&&(null===(C=this._pointB)||void 0===C?void 0:C.pointerId)!==P.pointerId)return;if(Z.type!==r.b.POINTERDOWN||-1!==this._currentActiveButton&&!v)if(Z.type===r.b.POINTERDOUBLETAP)this.onDoubleTap(P.pointerType);else if(Z.type!==r.b.POINTERUP||this._currentActiveButton!==P.button&&!v){if(Z.type===r.b.POINTERMOVE)if(G||P.preventDefault(),this._pointA&&null===this._pointB){const G=P.clientX-this._pointA.x,D=P.clientY-this._pointA.y;this._pointA.x=P.clientX,this._pointA.y=P.clientY,this.onTouch(this._pointA,G,D)}else if(this._pointA&&this._pointB){const G=this._pointA.pointerId===P.pointerId?this._pointA:this._pointB;G.x=P.clientX,G.y=P.clientY;const D=this._pointA.x-this._pointB.x,N=this._pointA.y-this._pointB.y,n=D*D+N*N,C={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:P.pointerId,type:Z.type};this.onMultiTouch(this._pointA,this._pointB,T,n,o,C),o=C,T=n}}else{try{null===q||void 0===q||q.releasePointerCapture(P.pointerId)}catch(g){}v||(this._pointB=null),D._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==P.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==P.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==T||o)&&(this.onMultiTouch(this._pointA,this._pointB,T,0,o,null),T=0,o=null),this._currentActiveButton=-1,this.onButtonUp(P),G||P.preventDefault()}else{try{null===q||void 0===q||q.setPointerCapture(P.pointerId)}catch(g){}if(null===this._pointA)this._pointA={x:P.clientX,y:P.clientY,pointerId:P.pointerId,type:P.pointerType};else{if(null!==this._pointB)return;this._pointB={x:P.clientX,y:P.clientY,pointerId:P.pointerId,type:P.pointerType}}-1!==this._currentActiveButton||v||(this._currentActiveButton=P.button),this.onButtonDown(P),G||(P.preventDefault(),N&&N.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,r.b.POINTERDOWN|r.b.POINTERUP|r.b.POINTERMOVE|r.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,T=0,o=null,this.onLostFocus()},this._contextMenuBind=G=>this.onContextMenu(G),N&&N.addEventListener("contextmenu",this._contextMenuBind,!1);const Z=this.camera.va().getEngine().getHostWindow();Z&&R.f.RegisterTopRootEvents(Z,[{name:"blur",handler:this._onLostFocus}])}Wd(){if(this._onLostFocus){const G=this.camera.va().getEngine().getHostWindow();G&&R.f.UnregisterTopRootEvents(G,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const G=this.camera.va().getEngine().getInputElement();G&&G.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(G){}onTouch(G,D,N){}onMultiTouch(G,D,N,T,o,Z){}onContextMenu(G){G.preventDefault()}onButtonDown(G){}onButtonUp(G){}onLostFocus(){}}(0,T.c)([(0,o.S)()],L.prototype,"buttons",void 0);class w extends L{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(G,D){if(0!==this.panningSensibility&&G&&D){const N=D.x-G.x,T=D.y-G.y;this.camera.inertialPanningX+=-N/this.panningSensibility,this.camera.inertialPanningY+=T/this.panningSensibility}}_computePinchZoom(G,D){const N=this.camera.i||w.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.i=N*Math.sqrt(G)/Math.sqrt(D):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(D-G)*N*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(D-G)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(G,D,N){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-D/this.panningSensibility,this.camera.inertialPanningY+=N/this.panningSensibility):(this.camera.inertialAlphaOffset-=D/this.angularSensibilityX,this.camera.inertialBetaOffset-=N/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(G,D,N,T,o,Z){0===N&&null===o||0===T&&null===Z||(this.multiTouchPanAndZoom?(this._computePinchZoom(N,T),this._computeMultiTouchPanning(o,Z)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(T)-Math.sqrt(N))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(N,T),this._isPinching=!0):this._computeMultiTouchPanning(o,Z)):this.multiTouchPanning?this._computeMultiTouchPanning(o,Z):this.pinchZoom&&this._computePinchZoom(N,T))}onButtonDown(G){this._isPanClick=G.button===this.camera._panningMouseButton}onButtonUp(G){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}w.MinimumRadiusForPinch=.001,(0,T.c)([(0,o.S)()],w.prototype,"buttons",void 0),(0,T.c)([(0,o.S)()],w.prototype,"angularSensibilityX",void 0),(0,T.c)([(0,o.S)()],w.prototype,"angularSensibilityY",void 0),(0,T.c)([(0,o.S)()],w.prototype,"pinchPrecision",void 0),(0,T.c)([(0,o.S)()],w.prototype,"pinchDeltaPercentage",void 0),(0,T.c)([(0,o.S)()],w.prototype,"useNaturalPinchZoom",void 0),(0,T.c)([(0,o.S)()],w.prototype,"pinchZoom",void 0),(0,T.c)([(0,o.S)()],w.prototype,"panningSensibility",void 0),(0,T.c)([(0,o.S)()],w.prototype,"multiTouchPanning",void 0),(0,T.c)([(0,o.S)()],w.prototype,"multiTouchPanAndZoom",void 0),m.d.ArcRotateCameraPointersInput=w;var B=N(1291);class F{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(G){G=R.f.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((D=>{const N=D.event;if(!N.metaKey)if(D.type===B.b.KEYDOWN){if(this._ctrlPressed=N.ctrlKey,this._altPressed=N.altKey,-1!==this.keysUp.indexOf(N.keyCode)||-1!==this.keysDown.indexOf(N.keyCode)||-1!==this.keysLeft.indexOf(N.keyCode)||-1!==this.keysRight.indexOf(N.keyCode)||-1!==this.keysReset.indexOf(N.keyCode)){-1===this._keys.indexOf(N.keyCode)&&this._keys.push(N.keyCode),N.preventDefault&&(G||N.preventDefault())}}else if(-1!==this.keysUp.indexOf(N.keyCode)||-1!==this.keysDown.indexOf(N.keyCode)||-1!==this.keysLeft.indexOf(N.keyCode)||-1!==this.keysRight.indexOf(N.keyCode)||-1!==this.keysReset.indexOf(N.keyCode)){const D=this._keys.indexOf(N.keyCode);D>=0&&this._keys.splice(D,1),N.preventDefault&&(G||N.preventDefault())}})))}Wd(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const G=this.camera;for(let D=0;D<this._keys.length;D++){const N=this._keys[D];-1!==this.keysLeft.indexOf(N)?this._ctrlPressed&&this.camera._useCtrlForPanning?G.inertialPanningX-=1/this.panningSensibility:G.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(N)?this._ctrlPressed&&this.camera._useCtrlForPanning?G.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?G.inertialRadiusOffset+=1/this.zoomingSensibility:G.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(N)?this._ctrlPressed&&this.camera._useCtrlForPanning?G.inertialPanningX+=1/this.panningSensibility:G.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(N)?this._ctrlPressed&&this.camera._useCtrlForPanning?G.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?G.inertialRadiusOffset-=1/this.zoomingSensibility:G.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(N)&&G.useInputToRestoreState&&G.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,T.c)([(0,o.S)()],F.prototype,"keysUp",void 0),(0,T.c)([(0,o.S)()],F.prototype,"keysDown",void 0),(0,T.c)([(0,o.S)()],F.prototype,"keysLeft",void 0),(0,T.c)([(0,o.S)()],F.prototype,"keysRight",void 0),(0,T.c)([(0,o.S)()],F.prototype,"keysReset",void 0),(0,T.c)([(0,o.S)()],F.prototype,"panningSensibility",void 0),(0,T.c)([(0,o.S)()],F.prototype,"zoomingSensibility",void 0),(0,T.c)([(0,o.S)()],F.prototype,"useAltToZoom",void 0),(0,T.c)([(0,o.S)()],F.prototype,"angularSpeed",void 0),m.d.ArcRotateCameraKeyboardMoveInput=F;var S=N(1197),V=N(1293),U=N(1038);class z{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new n.s(0,0,0),this._globalOffset=new n.s(0,0,0),this._inertialPanning=n.s.Zero()}_computeDeltaFromMouseWheelLegacyEvent(G,D){let N=0;const T=.01*G*this.wheelDeltaPercentage*D;return N=G>0?T/(1+this.wheelDeltaPercentage):T*(1+this.wheelDeltaPercentage),N}attachControl(G){G=R.f.BackCompatCameraNoPreventDefault(arguments),this._wheel=D=>{if(D.type!==r.b.POINTERWHEEL)return;const N=D.event;let T=0;const o=N.deltaMode===V.d.DOM_DELTA_LINE?40:1,Z=-N.deltaY*o;if(this.customComputeDeltaFromMouseWheel)T=this.customComputeDeltaFromMouseWheel(Z,this,N);else if(this.wheelDeltaPercentage){if(T=this._computeDeltaFromMouseWheelLegacyEvent(Z,this.camera.i),T>0){let G=this.camera.i,D=this.camera.inertialRadiusOffset+T;for(let N=0;N<20&&Math.abs(D)>.001;N++)G-=D,D*=this.camera.inertia;G=(0,U.e)(G,0,Number.MAX_VALUE),T=this._computeDeltaFromMouseWheelLegacyEvent(Z,G)}}else T=Z/(40*this.wheelPrecision);T&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(T)):this.camera.inertialRadiusOffset+=T),N.preventDefault&&(G||N.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,r.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.zd(0)}Wd(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const G=this.camera;0+G.inertialAlphaOffset+G.inertialBetaOffset+G.inertialRadiusOffset&&(this._updateHitPlane(),G.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(G.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const G=this.camera,D=G.target.Jc(G.position);this._hitPlane=S.c.FromPositionAndNormal(G.target,D)}_getPosition(){const G=this.camera,D=G.va(),N=D.createPickingRay(D.pointerX,D.pointerY,n.c.Identity(),G,!1);0===G.targetScreenOffset.x&&0===G.targetScreenOffset.y||(this._viewOffset.set(G.targetScreenOffset.x,G.targetScreenOffset.y,0),G.getViewMatrix().invertToRef(G._cameraTransformMatrix),this._globalOffset=n.s.TransformNormal(this._viewOffset,G._cameraTransformMatrix),N.origin.addInPlace(this._globalOffset));let T=0;return this._hitPlane&&(T=N.intersectsPlane(this._hitPlane)??0),N.origin.addInPlace(N.direction.scaleInPlace(T))}_zoomToMouse(G){const D=this.camera,N=1-D.inertia;if(D.lowerRadiusLimit){const T=D.lowerRadiusLimit??0;D.i-(D.inertialRadiusOffset+G)/N<T&&(G=(D.i-T)*N-D.inertialRadiusOffset)}if(D.upperRadiusLimit){const T=D.upperRadiusLimit??0;D.i-(D.inertialRadiusOffset+G)/N>T&&(G=(D.i-T)*N-D.inertialRadiusOffset)}const T=G/N/D.i,o=this._getPosition(),Z=n.k.Ad[6];o.subtractToRef(D.target,Z),Z.scaleInPlace(T),Z.scaleInPlace(N),this._inertialPanning.addInPlace(Z),D.inertialRadiusOffset+=G}_zeroIfClose(G){Math.abs(G.x)<q.d&&(G.x=0),Math.abs(G.y)<q.d&&(G.y=0),Math.abs(G.z)<q.d&&(G.z=0)}}(0,T.c)([(0,o.S)()],z.prototype,"wheelPrecision",void 0),(0,T.c)([(0,o.S)()],z.prototype,"zoomToMouseLocation",void 0),(0,T.c)([(0,o.S)()],z.prototype,"wheelDeltaPercentage",void 0),m.d.ArcRotateCameraMouseWheelInput=z;class i extends m.g{constructor(G){super(G)}addMouseWheel(){return this.add(new z),this}addPointers(){return this.add(new w),this}addKeyboard(){return this.add(new F),this}}var J=N(1018);C.b.AddNodeConstructor("ArcRotateCamera",((G,D)=>()=>new p(G,0,0,1,n.s.Zero(),D)));class p extends h.e{get target(){return this._target}set target(G){this.setTarget(G)}get targetHost(){return this._targetHost}set targetHost(G){G&&this.setTarget(G)}getTarget(){return this.target}get position(){return this._position}set position(G){this.setPosition(G)}set upVector(G){this._upToYMatrix||(this._yToUpMatrix=new n.c,this._upToYMatrix=new n.c,this._upVector=n.s.Zero()),G.normalize(),this._upVector.p(G),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){n.c.RotationAlignToRef(n.s.UpReadOnly,this._upVector,this._yToUpMatrix),n.c.RotationAlignToRef(this._upVector,n.s.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const G=this.inputs.attached.pointers;return G?G.angularSensibilityX:0}set angularSensibilityX(G){const D=this.inputs.attached.pointers;D&&(D.angularSensibilityX=G)}get angularSensibilityY(){const G=this.inputs.attached.pointers;return G?G.angularSensibilityY:0}set angularSensibilityY(G){const D=this.inputs.attached.pointers;D&&(D.angularSensibilityY=G)}get pinchPrecision(){const G=this.inputs.attached.pointers;return G?G.pinchPrecision:0}set pinchPrecision(G){const D=this.inputs.attached.pointers;D&&(D.pinchPrecision=G)}get pinchDeltaPercentage(){const G=this.inputs.attached.pointers;return G?G.pinchDeltaPercentage:0}set pinchDeltaPercentage(G){const D=this.inputs.attached.pointers;D&&(D.pinchDeltaPercentage=G)}get useNaturalPinchZoom(){const G=this.inputs.attached.pointers;return!!G&&G.useNaturalPinchZoom}set useNaturalPinchZoom(G){const D=this.inputs.attached.pointers;D&&(D.useNaturalPinchZoom=G)}get panningSensibility(){const G=this.inputs.attached.pointers;return G?G.panningSensibility:0}set panningSensibility(G){const D=this.inputs.attached.pointers;D&&(D.panningSensibility=G)}get keysUp(){const G=this.inputs.attached.keyboard;return G?G.keysUp:[]}set keysUp(G){const D=this.inputs.attached.keyboard;D&&(D.keysUp=G)}get keysDown(){const G=this.inputs.attached.keyboard;return G?G.keysDown:[]}set keysDown(G){const D=this.inputs.attached.keyboard;D&&(D.keysDown=G)}get keysLeft(){const G=this.inputs.attached.keyboard;return G?G.keysLeft:[]}set keysLeft(G){const D=this.inputs.attached.keyboard;D&&(D.keysLeft=G)}get keysRight(){const G=this.inputs.attached.keyboard;return G?G.keysRight:[]}set keysRight(G){const D=this.inputs.attached.keyboard;D&&(D.keysRight=G)}get wheelPrecision(){const G=this.inputs.attached.mousewheel;return G?G.wheelPrecision:0}set wheelPrecision(G){const D=this.inputs.attached.mousewheel;D&&(D.wheelPrecision=G)}get zoomToMouseLocation(){const G=this.inputs.attached.mousewheel;return!!G&&G.zoomToMouseLocation}set zoomToMouseLocation(G){const D=this.inputs.attached.mousewheel;D&&(D.zoomToMouseLocation=G)}get wheelDeltaPercentage(){const G=this.inputs.attached.mousewheel;return G?G.wheelDeltaPercentage:0}set wheelDeltaPercentage(G){const D=this.inputs.attached.mousewheel;D&&(D.wheelDeltaPercentage=G)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(G){G!==this.useBouncingBehavior&&(G?(this._bouncingBehavior=new j,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(G){G!==this.useFramingBehavior&&(G?(this._framingBehavior=new Y,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(G){G!==this.useAutoRotationBehavior&&(G?(this._autoRotationBehavior=new g,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(G,D,N,T,o,C){var P;let r=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(G,n.s.Zero(),C,r),P=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=n.s.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=n.o.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new n.c,this.panningAxis=new n.s(1,1,0),this._transformedDirection=new n.s,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new Z.b,this.checkCollisions=!1,this.collisionRadius=new n.s(.5,.5,.5),this._previousPosition=n.s.Zero(),this._collisionVelocity=n.s.Zero(),this._newPosition=n.s.Zero(),this._computationVector=n.s.Zero(),this._onCollisionPositionChange=function(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N?(P.setPosition(D),P.Jk&&P.Jk(N)):P._previousPosition.p(P._position);const T=Math.cos(P.alpha),o=Math.sin(P.alpha),Z=Math.cos(P.beta);let n=Math.sin(P.beta);0===n&&(n=1e-4);const C=P._getTargetPosition();P._computationVector.xd(P.i*T*n,P.i*Z,P.i*o*n),C.addToRef(P._computationVector,P._newPosition),P._position.p(P._newPosition);let r=P.upVector;P.allowUpsideDown&&P.beta<0&&(r=r.clone(),r=r.negate()),P._computeViewMatrix(P._position,C,r),P._viewMatrix.addAtIndex(12,P.targetScreenOffset.x),P._viewMatrix.addAtIndex(13,P.targetScreenOffset.y),P._collisionTriggered=!1},this._target=n.s.Zero(),o&&this.setTarget(o),this.alpha=D,this.beta=N,this.i=T,this.getViewMatrix(),this.inputs=new i(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new n.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.i=void 0,this._cache.targetScreenOffset=n.o.Zero()}_updateCache(G){G||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.i=this.i,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const G=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?G.addToRef(this._targetBoundingCenter,this._target):this._target.p(G)}const G=this._getLockedTargetPosition();return G||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.i,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>q.d&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.i=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.i===this.i&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(G,D){let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const o=arguments;D=R.f.BackCompatCameraNoPreventDefault(o),this._useCtrlForPanning=N,this._panningMouseButton=T,"boolean"===typeof o[0]&&(o.length>1&&(this._useCtrlForPanning=o[1]),o.length>2&&(this._panningMouseButton=o[2])),this.inputs.attachElement(D),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Wd(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const G=this._scene.getEngine().getDeltaTime()/1e3,D=1-Math.pow(2,-G/this.restoreStateInterpolationFactor);this.setTarget(n.s.Lerp(this.getTarget(),this._storedTarget,D)),n.g.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,n.k.Quaternion[0]),n.g.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,n.k.Quaternion[1]),n.g.SlerpToRef(n.k.Quaternion[1],n.k.Quaternion[0],D,n.k.Quaternion[2]),n.k.Quaternion[2].normalize(),n.k.Quaternion[2].toAlphaBetaGammaToRef(n.k.Ad[0]),this.alpha=n.k.Ad[0].x,this.beta=n.k.Ad[0].y,this.i+=(this._storedRadius-this.i)*D,n.o.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,D,this.targetScreenOffset),(n.s.DistanceSquared(this.getTarget(),this._storedTarget)<q.d&&n.k.Quaternion[2].equalsWithEpsilon(n.k.Quaternion[0])&&Math.pow(this._storedRadius-this.i,2)<q.d&&n.o.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<q.d||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const G=this.invertRotation?-1:1,D=this._calculateHandednessMultiplier();let N=this.inertialAlphaOffset*D;this.beta<0&&(N*=-1),this.alpha+=N*G,this.beta+=this.inertialBetaOffset*G,this.i-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<q.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<q.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*q.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const G=new n.s(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),G.multiplyInPlace(this.panningAxis),n.s.TransformNormalToRef(G,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const G=this.upVector,D=n.s.CrossToRef(this._transformedDirection,G,this._transformedDirection);n.s.CrossToRef(G,D,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);n.s.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const G=n.k.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(G),G.transposeToRef(G),n.s.TransformCoordinatesToRef(this._transformedDirection,G,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*q.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*q.d&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.i<this.lowerRadiusLimit&&(this.i=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.i>this.upperRadiusLimit&&(this.i=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||n.s.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.i=this._computationVector.length(),0===this.i&&(this.i=1e-4);const G=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const D=Math.round((G-this.alpha)/(2*Math.PI));this.alpha+=2*D*Math.PI,this.beta=Math.acos(this._computationVector.y/this.i),this._checkLimits()}setPosition(G){this._position.equals(G)||(this._position.p(G),this.rebuildAnglesAndRadius())}setTarget(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(T=this.overrideCloneAlphaBetaRadius??T,G.se)D&&G.getBoundingInfo?this._targetBoundingCenter=G.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,G.se(),this._targetHost=G,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const D=G,T=this._getTargetPosition();if(T&&!N&&T.equals(D))return;this._targetHost=null,this._target=D,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}T||this.rebuildAnglesAndRadius()}_getViewMatrix(){const G=Math.cos(this.alpha),D=Math.sin(this.alpha),N=Math.cos(this.beta);let T=Math.sin(this.beta);0===T&&(T=1e-4),0===this.i&&(this.i=1e-4);const o=this._getTargetPosition();if(this._computationVector.xd(this.i*G*T,this.i*N,this.i*D*T),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||n.s.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),o.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const G=this.va().collisionCoordinator;this._collider||(this._collider=G.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,G.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let G=this.upVector;this.allowUpsideDown&&T<0&&(G=G.negate()),this._computeViewMatrix(this._position,o,G),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=o,this._viewMatrix}zoomOn(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];G=G||this.va().meshes;const N=P.d.MinMax(G);let T=this._calculateLowerRadiusFromModelBoundingSphere(N.min,N.max);T=Math.max(Math.min(T,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.i=T*this.zoomOnFactor,this.focusOn({min:N.min,max:N.max,distance:T},D)}focusOn(G){let D,N,T=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===G.min){const T=G||this.va().meshes;D=P.d.MinMax(T),N=n.s.Distance(D.min,D.max)}else{D=G,N=G.distance}this._target=P.d.Center(D),T||(this.maxZ=2*N)}createRigCamera(G,D){let N=0;switch(this.cameraRigMode){case y.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case y.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case y.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case y.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case y.d.RIG_MODE_VR:N=this._cameraRigParams.stereoHalfAngle*(0===D?1:-1);break;case y.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:N=this._cameraRigParams.stereoHalfAngle*(0===D?-1:1)}const T=new p(G,this.alpha+N,this.beta,this.i,this._target,this.va());return T._cameraRigParams={},T.isRigCamera=!0,T.rigParent=this,T.upVector=this.upVector,T.mode=this.mode,T.orthoLeft=this.orthoLeft,T.orthoRight=this.orthoRight,T.orthoBottom=this.orthoBottom,T.orthoTop=this.orthoTop,T}_updateRigCameras(){const G=this._rigCameras[0],D=this._rigCameras[1];switch(G.beta=D.beta=this.beta,this.cameraRigMode){case y.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case y.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case y.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case y.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case y.d.RIG_MODE_VR:G.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,D.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case y.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:G.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,D.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const T=n.s.Distance(G,D),o=this.va().getEngine().getAspectRatio(this),Z=Math.tan(this.fov/2),C=Z*o,P=.5*T*N,r=P*Math.sqrt(1+1/(C*C)),v=P*Math.sqrt(1+1/(Z*Z));return Math.max(r,v)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,T.c)([(0,o.S)()],p.prototype,"alpha",void 0),(0,T.c)([(0,o.S)()],p.prototype,"beta",void 0),(0,T.c)([(0,o.S)()],p.prototype,"i",void 0),(0,T.c)([(0,o.S)()],p.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,T.c)([(0,o.O)("target")],p.prototype,"_target",void 0),(0,T.c)([(0,o.B)("targetHost")],p.prototype,"_targetHost",void 0),(0,T.c)([(0,o.S)()],p.prototype,"inertialAlphaOffset",void 0),(0,T.c)([(0,o.S)()],p.prototype,"inertialBetaOffset",void 0),(0,T.c)([(0,o.S)()],p.prototype,"inertialRadiusOffset",void 0),(0,T.c)([(0,o.S)()],p.prototype,"lowerAlphaLimit",void 0),(0,T.c)([(0,o.S)()],p.prototype,"upperAlphaLimit",void 0),(0,T.c)([(0,o.S)()],p.prototype,"lowerBetaLimit",void 0),(0,T.c)([(0,o.S)()],p.prototype,"upperBetaLimit",void 0),(0,T.c)([(0,o.S)()],p.prototype,"lowerRadiusLimit",void 0),(0,T.c)([(0,o.S)()],p.prototype,"upperRadiusLimit",void 0),(0,T.c)([(0,o.S)()],p.prototype,"inertialPanningX",void 0),(0,T.c)([(0,o.S)()],p.prototype,"inertialPanningY",void 0),(0,T.c)([(0,o.S)()],p.prototype,"pinchToPanMaxDistance",void 0),(0,T.c)([(0,o.S)()],p.prototype,"panningDistanceLimit",void 0),(0,T.c)([(0,o.O)()],p.prototype,"panningOriginTarget",void 0),(0,T.c)([(0,o.S)()],p.prototype,"panningInertia",void 0),(0,T.c)([(0,o.S)()],p.prototype,"zoomToMouseLocation",null),(0,T.c)([(0,o.S)()],p.prototype,"zoomOnFactor",void 0),(0,T.c)([(0,o.K)()],p.prototype,"targetScreenOffset",void 0),(0,T.c)([(0,o.S)()],p.prototype,"allowUpsideDown",void 0),(0,T.c)([(0,o.S)()],p.prototype,"useInputToRestoreState",void 0),(0,T.c)([(0,o.S)()],p.prototype,"restoreStateInterpolationFactor",void 0),(0,J.h)("BABYLON.ArcRotateCamera",p)},11393:(G,D,N)=>{"use strict";N.d(D,{d:()=>Y});var T=N(980),o=N(985),Z=N(1210),n=N(1223),C=N(1003),P=N(1009),r=N(11399),v=N(1105),q=N(1018),g=N(1094),X=N(1488),W=N(1308),j=N(1181);class Y extends r.b{get position(){return this._position}set position(G){this._position=G}set upVector(G){this._upVector=G}get upVector(){return this._upVector}get screenArea(){let G=0,D=0;if(this.mode===Y.PERSPECTIVE_CAMERA)this.fovMode===Y.FOVMODE_VERTICAL_FIXED?(D=2*this.fj*Math.tan(this.fov/2),G=this.getEngine().getAspectRatio(this)*D):(G=2*this.fj*Math.tan(this.fov/2),D=G/this.getEngine().getAspectRatio(this));else{const N=this.getEngine().getRenderWidth()/2,T=this.getEngine().getRenderHeight()/2;G=(this.orthoRight??N)-(this.orthoLeft??-N),D=(this.orthoTop??T)-(this.orthoBottom??-T)}return G*D}set orthoLeft(G){this._orthoLeft=G;for(const D of this._rigCameras)D.orthoLeft=G}get orthoLeft(){return this._orthoLeft}set orthoRight(G){this._orthoRight=G;for(const D of this._rigCameras)D.orthoRight=G}get orthoRight(){return this._orthoRight}set orthoBottom(G){this._orthoBottom=G;for(const D of this._rigCameras)D.orthoBottom=G}get orthoBottom(){return this._orthoBottom}set orthoTop(G){this._orthoTop=G;for(const D of this._rigCameras)D.orthoTop=G}get orthoTop(){return this._orthoTop}set mode(G){this._mode=G;for(const D of this._rigCameras)D.mode=G}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(G,D,N){let T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(G,N,!1),this._position=P.s.Zero(),this._upVector=P.s.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.fj=1,this.maxZ=1e4,this.inertia=.9,this._mode=Y.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new X.c(0,0,1,1),this.layerMask=268435455,this.fovMode=Y.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=Y.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new C.b,this.onProjectionMatrixChangedObservable=new C.b,this.onAfterCheckInputsObservable=new C.b,this.onRestoreStateObservable=new C.b,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new P.c,this._postProcesses=new Array,this._activeMeshes=new Z.e(256),this._globalPosition=P.s.Zero(),this._computedViewMatrix=P.c.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=P.c.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=P.g.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),T&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=D,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${G}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Sh"}toString(G){let D="Name: "+this.name;if(D+=", type: "+this.getClassName(),this.animations)for(let N=0;N<this.animations.length;N++)D+=", animation[0]: "+this.animations[N].toString(G);return D}applyVerticalCorrection(){const G=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-G.x:G.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(G){return-1!==this._activeMeshes.indexOf(G)}isReady(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(G)for(const D of this._postProcesses)if(D&&!D.isReady())return!1;return super.isReady(G)}_initCache(){super._initCache(),this._cache.position=new P.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new P.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.fj=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(G){G||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let G=this._cache.mode===this.mode&&this._cache.fj===this.fj&&this._cache.maxZ===this.maxZ;if(!G)return!1;const D=this.getEngine();return this.mode===Y.PERSPECTIVE_CAMERA?G=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===D.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(G=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===D.getRenderWidth()&&this._cache.renderHeight===D.getRenderHeight(),this.oblique&&(G=G&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),G}attachControl(G,D){}Wd(G){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==Y.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let G=0;G<this._postProcesses.length;G++)if(null!==this._postProcesses[G])return this._postProcesses[G];return null}_cascadePostProcessesToRigCams(){const G=this._getFirstPostProcess();G&&G.markTextureDirty();for(let D=0,N=this._rigCameras.length;D<N;D++){const G=this._rigCameras[D],N=G._rigPostProcess;if(N){"pass"===N.getEffectName()&&(G.isIntermediate=0===this._postProcesses.length),G._postProcesses=this._postProcesses.slice(0).concat(N),N.markTextureDirty()}else G._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!G.isReusable()&&this._postProcesses.indexOf(G)>-1?(v.d.Error("You're trying to reuse a post process not defined as reusable."),0):(null==D||D<0?this._postProcesses.push(G):null===this._postProcesses[D]?this._postProcesses[D]=G:this._postProcesses.splice(D,0,G),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.we(),this._postProcesses.indexOf(G))}detachPostProcess(G){const D=this._postProcesses.indexOf(G);-1!==D&&(this._postProcesses[D]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.we(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return P.c.Identity()}getViewMatrix(G){return!G&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(G){this._doNotComputeProjectionMatrix=!0,void 0!==G&&(this._projectionMatrix=G)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(G){if(this._doNotComputeProjectionMatrix||!G&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.fj=this.fj,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const D=this.getEngine(),N=this.va(),T=D.useReverseDepthBuffer;if(this.mode===Y.PERSPECTIVE_CAMERA){let G;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=D.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.fj<=0&&(this.fj=.1),G=N.useRightHandedSystem?P.c.PerspectiveFovRHToRef:P.c.PerspectiveFovLHToRef,G(this.fov,D.getAspectRatio(this),T?this.maxZ:this.fj,T?this.fj:this.maxZ,this._projectionMatrix,this.fovMode===Y.FOVMODE_VERTICAL_FIXED,D.isNDCHalfZRange,this.projectionPlaneTilt,T)}else{var o,Z,n;const G=D.getRenderWidth()/2,C=D.getRenderHeight()/2;N.useRightHandedSystem?this.oblique?P.c.ObliqueOffCenterRHToRef(this.orthoLeft??-G,this.orthoRight??G,this.orthoBottom??-C,this.orthoTop??C,T?this.maxZ:this.fj,T?this.fj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,D.isNDCHalfZRange):P.c.OrthoOffCenterRHToRef(this.orthoLeft??-G,this.orthoRight??G,this.orthoBottom??-C,this.orthoTop??C,T?this.maxZ:this.fj,T?this.fj:this.maxZ,this._projectionMatrix,D.isNDCHalfZRange):this.oblique?P.c.ObliqueOffCenterLHToRef(this.orthoLeft??-G,this.orthoRight??G,this.orthoBottom??-C,this.orthoTop??C,T?this.maxZ:this.fj,T?this.fj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,D.isNDCHalfZRange):P.c.OrthoOffCenterLHToRef(this.orthoLeft??-G,this.orthoRight??G,this.orthoBottom??-C,this.orthoTop??C,T?this.maxZ:this.fj,T?this.fj:this.maxZ,this._projectionMatrix,D.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(o=this.oblique)||void 0===o?void 0:o.angle,this._cache.obliqueLength=null===(Z=this.oblique)||void 0===Z?void 0:Z.length,this._cache.obliqueOffset=null===(n=this.oblique)||void 0===n?void 0:n.offset,this._cache.renderWidth=D.getRenderWidth(),this._cache.renderHeight=D.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(G){return(this.i||(this.target?P.s.Distance(this.position,this.target):this.position.length()))+G}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?W.b.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=W.b.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),D&&this.rigCameras.length>0){let D=!1;return this.rigCameras.forEach((N=>{N._updateFrustumPlanes(),D=D||G.isInFrustum(N._frustumPlanes)})),D}return G.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(G){return this._updateFrustumPlanes(),G.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,g.d)("Ray")}getForwardRayToRef(G){throw(0,g.d)("Ray")}dispose(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const G=this._rigCameras.pop();G&&G.dispose()}if(this._parentContainer){const G=this._parentContainer.cameras.indexOf(this);G>-1&&this._parentContainer.cameras.splice(G,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==Y.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let G=this._postProcesses.length;for(;--G>=0;){const D=this._postProcesses[G];D&&D.dispose(this)}}let N=this.customRenderTargets.length;for(;--N>=0;)this.customRenderTargets[N].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(G,D)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(G,D){if(this.cameraRigMode!==G){for(;this._rigCameras.length>0;){const G=this._rigCameras.pop();G&&G.dispose()}if(this.cameraRigMode=G,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=D.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=n.f.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==Y.RIG_MODE_NONE){const G=this.createRigCamera(this.name+"_L",0);G&&(G._isLeftCamera=!0);const D=this.createRigCamera(this.name+"_R",1);D&&(D._isRightCamera=!0),G&&D&&(this._rigCameras.push(G),this._rigCameras.push(D))}this._setRigMode(D),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(G){}_getVRProjectionMatrix(){return P.c.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.fj,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(G,D){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[G]=D,"interaxialDistance"===G&&(this._cameraRigParams.stereoHalfAngle=n.f.ToRadians(D/.0637))}createRigCamera(G,D){return null}_updateRigCameras(){for(let G=0;G<this._rigCameras.length;G++)this._rigCameras[G].fj=this.fj,this._rigCameras[G].maxZ=this.maxZ,this._rigCameras[G].fov=this.fov,this._rigCameras[G].upVector.p(this.upVector);this.cameraRigMode===Y.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const G=j.e.Serialize(this);return G.uniqueId=this.uniqueId,G.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(G),this.inputs&&this.inputs.serialize(G),j.e.AppendSerializedAnimations(this,G),G.ranges=this.serializeAnimationRanges(),G.isEnabled=this.isEnabled(),G}clone(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=j.e.Clone(Y.GetConstructorFromName(this.getClassName(),G,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return N.name=G,N.parent=D,this.onClonedObservable.notifyObservers(N),N}te(G){const D=P.s.Zero();return this.getDirectionToRef(G,D),D}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(G,D){P.s.TransformNormalToRef(G,this.getWorldMatrix(),D)}static GetConstructorFromName(G,D,N){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const Z=r.b.Construct(G,D,N,{interaxial_distance:T,isStereoscopicSideBySide:o});return Z||(()=>Y._CreateDefaultParsedCamera(D,N))}se(){return this.getWorldMatrix()}static Parse(G,D){const N=G.type,T=Y.GetConstructorFromName(N,G.name,D,G.interaxial_distance,G.isStereoscopicSideBySide),o=j.e.Parse(T,G,D);if(void 0!==G.parentId&&(o._waitingParentId=G.parentId),void 0!==G.parentInstanceIndex&&(o._waitingParentInstanceIndex=G.parentInstanceIndex),o.inputs&&(o.inputs.parse(G),o._setupInputs()),G.upVector&&(o.upVector=P.s.od(G.upVector)),o.setPosition&&(o.position.xd(0,0,0),o.setPosition(P.s.od(G.position))),G.target&&o.setTarget&&o.setTarget(P.s.od(G.target)),G.cameraRigMode){const D=G.interaxial_distance?{interaxialDistance:G.interaxial_distance}:{};o.setCameraRigMode(G.cameraRigMode,D)}if(G.animations){for(let D=0;D<G.animations.length;D++){const N=G.animations[D],T=(0,q.e)("BABYLON.Animation");T&&o.animations.push(T.Parse(N))}r.b.ParseAnimationRanges(o,G,D)}return G.autoAnimate&&D.beginAnimation(o,G.autoAnimateFrom,G.autoAnimateTo,G.autoAnimateLoop,G.autoAnimateSpeed||1),void 0!==G.isEnabled&&o.Lg(G.isEnabled),o}_calculateHandednessMultiplier(){let G=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(G*=-1),G}}Y._CreateDefaultParsedCamera=(G,D)=>{throw(0,g.d)("UniversalCamera")},Y.PERSPECTIVE_CAMERA=0,Y.ORTHOGRAPHIC_CAMERA=1,Y.FOVMODE_VERTICAL_FIXED=0,Y.FOVMODE_HORIZONTAL_FIXED=1,Y.RIG_MODE_NONE=0,Y.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,Y.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,Y.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,Y.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,Y.RIG_MODE_STEREOSCOPIC_INTERLACED=14,Y.RIG_MODE_VR=20,Y.RIG_MODE_CUSTOM=22,Y.ForceAttachControlToAlwaysPreventDefault=!1,(0,T.c)([(0,o.O)("position")],Y.prototype,"_position",void 0),(0,T.c)([(0,o.O)("upVector")],Y.prototype,"_upVector",void 0),(0,T.c)([(0,o.S)()],Y.prototype,"orthoLeft",null),(0,T.c)([(0,o.S)()],Y.prototype,"orthoRight",null),(0,T.c)([(0,o.S)()],Y.prototype,"orthoBottom",null),(0,T.c)([(0,o.S)()],Y.prototype,"orthoTop",null),(0,T.c)([(0,o.S)()],Y.prototype,"fov",void 0),(0,T.c)([(0,o.S)()],Y.prototype,"projectionPlaneTilt",void 0),(0,T.c)([(0,o.S)()],Y.prototype,"fj",void 0),(0,T.c)([(0,o.S)()],Y.prototype,"maxZ",void 0),(0,T.c)([(0,o.S)()],Y.prototype,"inertia",void 0),(0,T.c)([(0,o.S)()],Y.prototype,"mode",null),(0,T.c)([(0,o.S)()],Y.prototype,"layerMask",void 0),(0,T.c)([(0,o.S)()],Y.prototype,"fovMode",void 0),(0,T.c)([(0,o.S)()],Y.prototype,"cameraRigMode",void 0),(0,T.c)([(0,o.S)()],Y.prototype,"interaxialDistance",void 0),(0,T.c)([(0,o.S)()],Y.prototype,"isStereoscopicSideBySide",void 0)},11715:(G,D,N)=>{"use strict";N.d(D,{d:()=>n,g:()=>C});var T=N(1105),o=N(1181),Z=N(11393),n={};class C{constructor(G){this.attachedToElement=!1,this.attached={},this.camera=G,this.checkInputs=()=>{}}add(G){const D=G.getSimpleName();this.attached[D]?T.d.Warn("camera input of type "+D+" already exists on camera"):(this.attached[D]=G,G.camera=this.camera,G.checkInputs&&(this.checkInputs=this._addCheckInputs(G.checkInputs.bind(G))),this.attachedToElement&&G.attachControl(this.noPreventDefault))}remove(G){for(const D in this.attached){const N=this.attached[D];if(N===G)return N.Wd(),N.camera=null,delete this.attached[D],void this.rebuildInputCheck()}}removeByType(G){for(const D in this.attached){const N=this.attached[D];N.getClassName()===G&&(N.Wd(),N.camera=null,delete this.attached[D],this.rebuildInputCheck())}}_addCheckInputs(G){const D=this.checkInputs;return()=>{D(),G()}}attachInput(G){this.attachedToElement&&G.attachControl(this.noPreventDefault)}attachElement(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){G=!Z.d.ForceAttachControlToAlwaysPreventDefault&&G,this.attachedToElement=!0,this.noPreventDefault=G;for(const D in this.attached)this.attached[D].attachControl(G)}}detachElement(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const D in this.attached)this.attached[D].Wd(),G&&(this.attached[D].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const G in this.attached){const D=this.attached[G];D.checkInputs&&(this.checkInputs=this._addCheckInputs(D.checkInputs.bind(D)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(G){const D={};for(const N in this.attached){const G=this.attached[N],T=o.e.Serialize(G);D[G.getClassName()]=T}G.inputsmgr=D}parse(G){const D=G.inputsmgr;if(D){this.clear();for(const G in D){const N=n[G];if(N){const T=D[G],Z=o.e.Parse((()=>new N),T,null);this.add(Z)}}}else for(const N in this.attached){const D=n[this.attached[N].getClassName()];if(D){const T=o.e.Parse((()=>new D),G,null);this.remove(this.attached[N]),this.add(T)}}}}},11703:(G,D,N)=>{"use strict";N.d(D,{d:()=>w});var T=N(980),o=N(985),Z=N(1009),n=N(11706),C=N(11715),P=N(1291),r=N(1223);class v{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(G){G=r.f.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((D=>{const N=D.event;if(!N.metaKey)if(D.type===P.b.KEYDOWN){if(-1!==this.keysUp.indexOf(N.keyCode)||-1!==this.keysDown.indexOf(N.keyCode)||-1!==this.keysLeft.indexOf(N.keyCode)||-1!==this.keysRight.indexOf(N.keyCode)||-1!==this.keysUpward.indexOf(N.keyCode)||-1!==this.keysDownward.indexOf(N.keyCode)||-1!==this.keysRotateLeft.indexOf(N.keyCode)||-1!==this.keysRotateRight.indexOf(N.keyCode)||-1!==this.keysRotateUp.indexOf(N.keyCode)||-1!==this.keysRotateDown.indexOf(N.keyCode)){-1===this._keys.indexOf(N.keyCode)&&this._keys.push(N.keyCode),G||N.preventDefault()}}else if(-1!==this.keysUp.indexOf(N.keyCode)||-1!==this.keysDown.indexOf(N.keyCode)||-1!==this.keysLeft.indexOf(N.keyCode)||-1!==this.keysRight.indexOf(N.keyCode)||-1!==this.keysUpward.indexOf(N.keyCode)||-1!==this.keysDownward.indexOf(N.keyCode)||-1!==this.keysRotateLeft.indexOf(N.keyCode)||-1!==this.keysRotateRight.indexOf(N.keyCode)||-1!==this.keysRotateUp.indexOf(N.keyCode)||-1!==this.keysRotateDown.indexOf(N.keyCode)){const D=this._keys.indexOf(N.keyCode);D>=0&&this._keys.splice(D,1),G||N.preventDefault()}})))}Wd(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const G=this.camera;for(let D=0;D<this._keys.length;D++){const N=this._keys[D],T=G._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(N)?G._localDirection.xd(-T,0,0):-1!==this.keysUp.indexOf(N)?G._localDirection.xd(0,0,T):-1!==this.keysRight.indexOf(N)?G._localDirection.xd(T,0,0):-1!==this.keysDown.indexOf(N)?G._localDirection.xd(0,0,-T):-1!==this.keysUpward.indexOf(N)?G._localDirection.xd(0,T,0):-1!==this.keysDownward.indexOf(N)?G._localDirection.xd(0,-T,0):-1!==this.keysRotateLeft.indexOf(N)?(G._localDirection.xd(0,0,0),G.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(N)?(G._localDirection.xd(0,0,0),G.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(N)?(G._localDirection.xd(0,0,0),G.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(N)&&(G._localDirection.xd(0,0,0),G.cameraRotation.x+=this._getLocalRotation()),G.va().useRightHandedSystem&&(G._localDirection.z*=-1),G.getViewMatrix().invertToRef(G._cameraTransformMatrix),Z.s.TransformNormalToRef(G._localDirection,G._cameraTransformMatrix,G._transformedDirection),G.cameraDirection.addInPlace(G._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const G=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*G}}(0,T.c)([(0,o.S)()],v.prototype,"keysUp",void 0),(0,T.c)([(0,o.S)()],v.prototype,"keysUpward",void 0),(0,T.c)([(0,o.S)()],v.prototype,"keysDown",void 0),(0,T.c)([(0,o.S)()],v.prototype,"keysDownward",void 0),(0,T.c)([(0,o.S)()],v.prototype,"keysLeft",void 0),(0,T.c)([(0,o.S)()],v.prototype,"keysRight",void 0),(0,T.c)([(0,o.S)()],v.prototype,"rotationSpeed",void 0),(0,T.c)([(0,o.S)()],v.prototype,"keysRotateLeft",void 0),(0,T.c)([(0,o.S)()],v.prototype,"keysRotateRight",void 0),(0,T.c)([(0,o.S)()],v.prototype,"keysRotateUp",void 0),(0,T.c)([(0,o.S)()],v.prototype,"keysRotateDown",void 0),C.d.FreeCameraKeyboardMoveInput=v;var q=N(1003),g=N(1285);class X{constructor(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=G,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new q.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(G){G=r.f.BackCompatCameraNoPreventDefault(arguments);const D=this.camera.getEngine(),N=D.getInputElement();this._pointerInput||(this._pointerInput=T=>{const o=T.event,Z="touch"===o.pointerType;if(!this.touchEnabled&&Z)return;if(T.type!==g.b.POINTERMOVE&&-1===this.buttons.indexOf(o.button))return;const n=o.target;if(T.type===g.b.POINTERDOWN){if(Z&&-1!==this._activePointerId||!Z&&-1!==this._currentActiveButton)return;this._activePointerId=o.pointerId;try{null===n||void 0===n||n.setPointerCapture(o.pointerId)}catch(C){}-1===this._currentActiveButton&&(this._currentActiveButton=o.button),this._previousPosition={x:o.clientX,y:o.clientY},G||(o.preventDefault(),N&&N.focus()),D.isPointerLock&&this._onMouseMove&&this._onMouseMove(T.event)}else if(T.type===g.b.POINTERUP){if(Z&&this._activePointerId!==o.pointerId||!Z&&this._currentActiveButton!==o.button)return;try{null===n||void 0===n||n.releasePointerCapture(o.pointerId)}catch(C){}this._currentActiveButton=-1,this._previousPosition=null,G||o.preventDefault(),this._activePointerId=-1}else if(T.type===g.b.POINTERMOVE&&(this._activePointerId===o.pointerId||!Z))if(D.isPointerLock&&this._onMouseMove)this._onMouseMove(T.event);else if(this._previousPosition){const D=this.camera._calculateHandednessMultiplier(),N=(o.clientX-this._previousPosition.x)*D,T=o.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=N/this.angularSensibility,this.camera.cameraRotation.x+=T/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:N,offsetY:T}),this._previousPosition={x:o.clientX,y:o.clientY},G||o.preventDefault()}}),this._onMouseMove=N=>{if(!D.isPointerLock)return;const T=this.camera._calculateHandednessMultiplier(),o=N.movementX*T;this.camera.cameraRotation.y+=o/this.angularSensibility;const Z=N.movementY;this.camera.cameraRotation.x+=Z/this.angularSensibility,this._previousPosition=null,G||N.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,g.b.POINTERDOWN|g.b.POINTERUP|g.b.POINTERMOVE),N&&(this._contextMenuBind=G=>this.onContextMenu(G),N.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(G){G.preventDefault()}Wd(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const G=this.camera.getEngine().getInputElement();G&&G.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,T.c)([(0,o.S)()],X.prototype,"buttons",void 0),(0,T.c)([(0,o.S)()],X.prototype,"angularSensibility",void 0),C.d.FreeCameraMouseInput=X;var W,j=N(1293);class Y{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new q.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(G){G=r.f.BackCompatCameraNoPreventDefault(arguments),this._wheel=D=>{if(D.type!==g.b.POINTERWHEEL)return;const N=D.event,T=N.deltaMode===j.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*T*N.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*T*N.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*T*N.deltaZ/this._normalize,N.preventDefault&&(G||N.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,g.b.POINTERWHEEL)}Wd(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,T.c)([(0,o.S)()],Y.prototype,"wheelPrecisionX",void 0),(0,T.c)([(0,o.S)()],Y.prototype,"wheelPrecisionY",void 0),(0,T.c)([(0,o.S)()],Y.prototype,"wheelPrecisionZ",void 0),function(G){G[G.MoveRelative=0]="MoveRelative",G[G.RotateRelative=1]="RotateRelative",G[G.MoveScene=2]="MoveScene"}(W||(W={}));class y extends Y{constructor(){super(...arguments),this._moveRelative=Z.s.Zero(),this._rotateRelative=Z.s.Zero(),this._moveScene=Z.s.Zero(),this._wheelXAction=W.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=W.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(G){null===G&&this._wheelXAction!==W.MoveRelative||(this._wheelXAction=W.MoveRelative,this._wheelXActionCoordinate=G)}get wheelXMoveRelative(){return this._wheelXAction!==W.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(G){null===G&&this._wheelYAction!==W.MoveRelative||(this._wheelYAction=W.MoveRelative,this._wheelYActionCoordinate=G)}get wheelYMoveRelative(){return this._wheelYAction!==W.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(G){null===G&&this._wheelZAction!==W.MoveRelative||(this._wheelZAction=W.MoveRelative,this._wheelZActionCoordinate=G)}get wheelZMoveRelative(){return this._wheelZAction!==W.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(G){null===G&&this._wheelXAction!==W.RotateRelative||(this._wheelXAction=W.RotateRelative,this._wheelXActionCoordinate=G)}get wheelXRotateRelative(){return this._wheelXAction!==W.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(G){null===G&&this._wheelYAction!==W.RotateRelative||(this._wheelYAction=W.RotateRelative,this._wheelYActionCoordinate=G)}get wheelYRotateRelative(){return this._wheelYAction!==W.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(G){null===G&&this._wheelZAction!==W.RotateRelative||(this._wheelZAction=W.RotateRelative,this._wheelZActionCoordinate=G)}get wheelZRotateRelative(){return this._wheelZAction!==W.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(G){null===G&&this._wheelXAction!==W.MoveScene||(this._wheelXAction=W.MoveScene,this._wheelXActionCoordinate=G)}get wheelXMoveScene(){return this._wheelXAction!==W.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(G){null===G&&this._wheelYAction!==W.MoveScene||(this._wheelYAction=W.MoveScene,this._wheelYActionCoordinate=G)}get wheelYMoveScene(){return this._wheelYAction!==W.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(G){null===G&&this._wheelZAction!==W.MoveScene||(this._wheelZAction=W.MoveScene,this._wheelZActionCoordinate=G)}get wheelZMoveScene(){return this._wheelZAction!==W.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.zd(0),this._rotateRelative.zd(0),this._moveScene.zd(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const G=Z.c.Zero();this.camera.getViewMatrix().invertToRef(G);const D=Z.s.Zero();Z.s.TransformNormalToRef(this._moveRelative,G,D),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(D),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(G,D,N){if(0===G)return;if(null===D||null===N)return;let T=null;switch(D){case W.MoveRelative:T=this._moveRelative;break;case W.RotateRelative:T=this._rotateRelative;break;case W.MoveScene:T=this._moveScene}switch(N){case 0:T.set(G,0,0);break;case 1:T.set(0,G,0);break;case 2:T.set(0,0,G)}}}(0,T.c)([(0,o.S)()],y.prototype,"wheelXMoveRelative",null),(0,T.c)([(0,o.S)()],y.prototype,"wheelYMoveRelative",null),(0,T.c)([(0,o.S)()],y.prototype,"wheelZMoveRelative",null),(0,T.c)([(0,o.S)()],y.prototype,"wheelXRotateRelative",null),(0,T.c)([(0,o.S)()],y.prototype,"wheelYRotateRelative",null),(0,T.c)([(0,o.S)()],y.prototype,"wheelZRotateRelative",null),(0,T.c)([(0,o.S)()],y.prototype,"wheelXMoveScene",null),(0,T.c)([(0,o.S)()],y.prototype,"wheelYMoveScene",null),(0,T.c)([(0,o.S)()],y.prototype,"wheelZMoveScene",null),C.d.FreeCameraMouseWheelInput=y;class h{constructor(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=G,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=r.f.IsSafari()}attachControl(G){G=r.f.BackCompatCameraNoPreventDefault(arguments);let D=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=N=>{const T=N.event,o="mouse"===T.pointerType||this._isSafari&&"undefined"===typeof T.pointerType;if(this.allowMouse||!o)if(N.type===g.b.POINTERDOWN){if(G||T.preventDefault(),this._pointerPressed.push(T.pointerId),1!==this._pointerPressed.length)return;D={x:T.clientX,y:T.clientY}}else if(N.type===g.b.POINTERUP){G||T.preventDefault();const N=this._pointerPressed.indexOf(T.pointerId);if(-1===N)return;if(this._pointerPressed.splice(N,1),0!=N)return;D=null,this._offsetX=null,this._offsetY=null}else if(N.type===g.b.POINTERMOVE){if(G||T.preventDefault(),!D)return;if(0!=this._pointerPressed.indexOf(T.pointerId))return;this._offsetX=T.clientX-D.x,this._offsetY=-(T.clientY-D.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,g.b.POINTERDOWN|g.b.POINTERUP|g.b.POINTERMOVE),this._onLostFocus){const G=this.camera.getEngine().getInputElement();G&&G.addEventListener("blur",this._onLostFocus)}}Wd(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const G=this.camera.getEngine().getInputElement();G&&G.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const G=this.camera,D=G._calculateHandednessMultiplier();G.cameraRotation.y=D*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)G.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const D=G._computeLocalCameraSpeed(),N=new Z.s(0,0,0!==this.touchMoveSensibility?D*this._offsetY/this.touchMoveSensibility:0);Z.c.RotationYawPitchRollToRef(G.rotation.y,G.rotation.x,0,G._cameraRotationMatrix),G.cameraDirection.addInPlace(Z.s.TransformCoordinates(N,G._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,T.c)([(0,o.S)()],h.prototype,"touchAngularSensibility",void 0),(0,T.c)([(0,o.S)()],h.prototype,"touchMoveSensibility",void 0),C.d.FreeCameraTouchInput=h;class m extends C.g{constructor(G){super(G),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new v),this}addMouse(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new X(G),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new y,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new h),this}clear(){super.clear(),this._mouseInput=null}}var R=N(1018),L=N(1122);class w extends n.e{get angularSensibility(){const G=this.inputs.attached.mouse;return G?G.angularSensibility:0}set angularSensibility(G){const D=this.inputs.attached.mouse;D&&(D.angularSensibility=G)}get keysUp(){const G=this.inputs.attached.keyboard;return G?G.keysUp:[]}set keysUp(G){const D=this.inputs.attached.keyboard;D&&(D.keysUp=G)}get keysUpward(){const G=this.inputs.attached.keyboard;return G?G.keysUpward:[]}set keysUpward(G){const D=this.inputs.attached.keyboard;D&&(D.keysUpward=G)}get keysDown(){const G=this.inputs.attached.keyboard;return G?G.keysDown:[]}set keysDown(G){const D=this.inputs.attached.keyboard;D&&(D.keysDown=G)}get keysDownward(){const G=this.inputs.attached.keyboard;return G?G.keysDownward:[]}set keysDownward(G){const D=this.inputs.attached.keyboard;D&&(D.keysDownward=G)}get keysLeft(){const G=this.inputs.attached.keyboard;return G?G.keysLeft:[]}set keysLeft(G){const D=this.inputs.attached.keyboard;D&&(D.keysLeft=G)}get keysRight(){const G=this.inputs.attached.keyboard;return G?G.keysRight:[]}set keysRight(G){const D=this.inputs.attached.keyboard;D&&(D.keysRight=G)}get keysRotateLeft(){const G=this.inputs.attached.keyboard;return G?G.keysRotateLeft:[]}set keysRotateLeft(G){const D=this.inputs.attached.keyboard;D&&(D.keysRotateLeft=G)}get keysRotateRight(){const G=this.inputs.attached.keyboard;return G?G.keysRotateRight:[]}set keysRotateRight(G){const D=this.inputs.attached.keyboard;D&&(D.keysRotateRight=G)}get keysRotateUp(){const G=this.inputs.attached.keyboard;return G?G.keysRotateUp:[]}set keysRotateUp(G){const D=this.inputs.attached.keyboard;D&&(D.keysRotateUp=G)}get keysRotateDown(){const G=this.inputs.attached.keyboard;return G?G.keysRotateDown:[]}set keysRotateDown(G){const D=this.inputs.attached.keyboard;D&&(D.keysRotateDown=G)}constructor(G,D,N){var T;super(G,D,N,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),T=this,this.ellipsoid=new Z.s(.5,1,.5),this.ellipsoidOffset=new Z.s(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=Z.s.Zero(),this._diffPosition=Z.s.Zero(),this._newPosition=Z.s.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;T._newPosition.p(D),T._newPosition.subtractToRef(T._oldPosition,T._diffPosition),T._diffPosition.length()>L.b.CollisionsEpsilon&&(T.position.addToRef(T._diffPosition,T._deferredPositionUpdate),T._deferOnly?T._deferredUpdated=!0:T.position.p(T._deferredPositionUpdate),T.Jk&&N&&T.Jk(N))},this.inputs=new m(this),this.inputs.addKeyboard().addMouse()}attachControl(G,D){D=r.f.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(D)}Wd(){this.inputs.detachElement(),this.cameraDirection=new Z.s(0,0,0),this.cameraRotation=new Z.o(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(G){this._collisionMask=isNaN(G)?-1:G}_collideWithWorld(G){let D;D=this.parent?Z.s.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,D.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const N=this.va().collisionCoordinator;this._collider||(this._collider=N.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let T=G;this.applyGravity&&(T=G.add(this.va().gravity)),N.getNewPosition(this._oldPosition,T,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=Z.s.Zero(),this._transformedDirection=Z.s.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(G){this._needMoveForGravity=G}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fb"}}(0,T.c)([(0,o.O)()],w.prototype,"ellipsoid",void 0),(0,T.c)([(0,o.O)()],w.prototype,"ellipsoidOffset",void 0),(0,T.c)([(0,o.S)()],w.prototype,"checkCollisions",void 0),(0,T.c)([(0,o.S)()],w.prototype,"applyGravity",void 0),(0,R.h)("BABYLON.FreeCamera",w)},11706:(G,D,N)=>{"use strict";N.d(D,{e:()=>r});var T=N(980),o=N(985),Z=N(11393),n=N(1009),C=N(1012),P=N(1477);N(11399).b.AddNodeConstructor("TargetCamera",((G,D)=>()=>new r(G,n.s.Zero(),D)));class r extends Z.d{constructor(G,D,N){super(G,D,N,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=n.s.Zero(),this._tmpTargetVector=n.s.Zero(),this.cameraDirection=new n.s(0,0,0),this.cameraRotation=new n.o(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new n.g,this.rotation=new n.s(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=n.s.Zero(),this._initialFocalDistance=1,this._viewMatrix=n.c.Zero(),this._camMatrix=n.c.Zero(),this._cameraTransformMatrix=n.c.Zero(),this._cameraRotationMatrix=n.c.Zero(),this._referencePoint=new n.s(0,0,1),this._transformedReferencePoint=n.s.Zero(),this._deferredPositionUpdate=new n.s,this._deferredRotationQuaternionUpdate=new n.g,this._deferredRotationUpdate=new n.s,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=n.s.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(G){this.getWorldMatrix();const D=this.getTarget().Jc(this.position);return D.normalize(),D.scaleInPlace(G),this.globalPosition.add(D)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const G=this.lockedTarget;G.se().getTranslationToRef(G.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.xd(0,0,0),this.cameraRotation.xd(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new n.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new n.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new n.g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(G){G||super._updateCache();const D=this._getLockedTargetPosition();D?this._cache.lockedTarget?this._cache.lockedTarget.p(D):this._cache.lockedTarget=D.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const G=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(G):!G)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const G=this.getEngine();return this.speed*Math.sqrt(G.getDeltaTime()/(100*G.getFps()))}setTarget(G){this.upVector.normalize(),this._initialFocalDistance=G.Jc(this.position).length(),this.position.z===G.z&&(this.position.z+=C.d),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),n.c.LookAtLHToRef(this.position,G,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const D=G.Jc(this.position);D.x>=0?this.rotation.y=-Math.atan(D.z/D.x)+Math.PI/2:this.rotation.y=-Math.atan(D.z/D.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&n.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(G){this.setTarget(G)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(n.k.Matrix[0]),n.s.TransformNormalToRef(this.cameraDirection,n.k.Matrix[0],n.k.Ad[0]),this._deferredPositionUpdate.addInPlace(n.k.Ad[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const G=this.invertRotation?-this.inverseRotationSpeed:1,D=this._decideIfNeedsToMove(),N=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),D&&this._updatePosition(),N){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*G,this._deferredRotationUpdate.y+=this.cameraRotation.y*G,!this.noRotationConstraint){const G=1.570796;this._deferredRotationUpdate.x>G&&(this._deferredRotationUpdate.x=G),this._deferredRotationUpdate.x<-G&&(this._deferredRotationUpdate.x=-G)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(n.g.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}D&&(Math.abs(this.cameraDirection.x)<this.speed*C.d&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*C.d&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*C.d&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),N&&(Math.abs(this.cameraRotation.x)<this.speed*C.d&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*C.d&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):n.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return n.s.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),n.s.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?P.d.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(n.g.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),P.d.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(G,D,N){if(this.ignoreParentScaling){if(this.parent){const T=this.parent.getWorldMatrix();n.s.TransformCoordinatesToRef(G,T,this._globalPosition),n.s.TransformCoordinatesToRef(D,T,this._tmpTargetVector),n.s.TransformNormalToRef(N,T,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(G),this._tmpTargetVector.p(D),this._tmpUpVector.p(N);this.va().useRightHandedSystem?n.c.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):n.c.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?n.c.LookAtRHToRef(G,D,N,this._viewMatrix):n.c.LookAtLHToRef(G,D,N,this._viewMatrix),this.parent){const G=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(G,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(G)}createRigCamera(G,D){if(this.cameraRigMode!==Z.d.RIG_MODE_NONE){const D=new r(G,this.position.clone(),this.va());return D.isRigCamera=!0,D.rigParent=this,this.cameraRigMode===Z.d.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new n.g),D._cameraRigParams={},D.rotationQuaternion=new n.g),D.mode=this.mode,D.orthoLeft=this.orthoLeft,D.orthoRight=this.orthoRight,D.orthoTop=this.orthoTop,D.orthoBottom=this.orthoBottom,D}return null}_updateRigCameras(){const G=this._rigCameras[0],D=this._rigCameras[1];switch(this.se(),this.cameraRigMode){case Z.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Z.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Z.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case Z.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Z.d.RIG_MODE_STEREOSCOPIC_INTERLACED:{const N=this.cameraRigMode===Z.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,T=this.cameraRigMode===Z.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*N,G),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*T,D);break}case Z.d.RIG_MODE_VR:G.rotationQuaternion?(G.rotationQuaternion.p(this.rotationQuaternion),D.rotationQuaternion.p(this.rotationQuaternion)):(G.rotation.p(this.rotation),D.rotation.p(this.rotation)),G.position.p(this.position),D.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(G,D){this.getTarget().subtractToRef(this.position,r._TargetFocalPoint),r._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const N=r._TargetFocalPoint.addInPlace(this.position);n.c.TranslationToRef(-N.x,-N.y,-N.z,r._TargetTransformMatrix),r._TargetTransformMatrix.multiplyToRef(n.c.RotationAxis(D.upVector,G),r._RigCamTransformMatrix),n.c.TranslationToRef(N.x,N.y,N.z,r._TargetTransformMatrix),r._RigCamTransformMatrix.multiplyToRef(r._TargetTransformMatrix,r._RigCamTransformMatrix),n.s.TransformCoordinatesToRef(this.position,r._RigCamTransformMatrix,D.position),D.setTarget(N)}getClassName(){return"TargetCamera"}}r._RigCamTransformMatrix=new n.c,r._TargetTransformMatrix=new n.c,r._TargetFocalPoint=new n.s,(0,T.c)([(0,o.O)()],r.prototype,"rotation",void 0),(0,T.c)([(0,o.S)()],r.prototype,"speed",void 0),(0,T.c)([(0,o.B)("lockedTargetId")],r.prototype,"lockedTarget",void 0)},12097:(G,D,N)=>{"use strict";N.d(D,{e:()=>Z});var T=N(1210),o=N(12103);class Z{constructor(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=N,this.Di=[],this._maxBlockCapacity=D||64,this._selectionContent=new T.b(1024),this._creationFunc=G}update(G,D,N){o.d._CreateBlocks(G,D,N,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}qe(G){for(let D=0;D<this.Wh.length;D++){this.Wh[D].addEntry(G)}}re(G){for(let D=0;D<this.Wh.length;D++){this.Wh[D].removeEntry(G)}}select(G,D){this._selectionContent.reset();for(let N=0;N<this.Wh.length;N++){this.Wh[N].select(G,this._selectionContent,D)}return D?this._selectionContent.concat(this.Di):this._selectionContent.concatWithNoDuplicate(this.Di),this._selectionContent}intersects(G,D,N){this._selectionContent.reset();for(let T=0;T<this.Wh.length;T++){this.Wh[T].intersects(G,D,this._selectionContent,N)}return N?this._selectionContent.concat(this.Di):this._selectionContent.concatWithNoDuplicate(this.Di),this._selectionContent}intersectsRay(G){this._selectionContent.reset();for(let D=0;D<this.Wh.length;D++){this.Wh[D].intersectsRay(G,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Di),this._selectionContent}}Z.CreationFuncForMeshes=(G,D)=>{const N=G.getBoundingInfo();!G.isBlocked&&N.boundingBox.intersectsMinMax(D.Hi,D.Ii)&&D.entries.push(G)},Z.CreationFuncForSubMeshes=(G,D)=>{G.getBoundingInfo().boundingBox.intersectsMinMax(D.Hi,D.Ii)&&D.entries.push(G)}},12103:(G,D,N)=>{"use strict";N.d(D,{d:()=>Z});var T=N(1009),o=N(1350);class Z{constructor(G,D,N,T,o,Z){this.entries=[],this.Ji=new Array,this._capacity=N,this._depth=T,this._maxDepth=o,this._creationFunc=Z,this._minPoint=G,this._maxPoint=D,this.Ji.push(G.clone()),this.Ji.push(D.clone()),this.Ji.push(G.clone()),this.Ji[2].x=D.x,this.Ji.push(G.clone()),this.Ji[3].y=D.y,this.Ji.push(G.clone()),this.Ji[4].z=D.z,this.Ji.push(D.clone()),this.Ji[5].z=G.z,this.Ji.push(D.clone()),this.Ji[6].x=G.x,this.Ji.push(D.clone()),this.Ji[7].y=G.y}get ze(){return this._capacity}get Hi(){return this._minPoint}get Ii(){return this._maxPoint}addEntry(G){if(this.Wh)for(let D=0;D<this.Wh.length;D++){this.Wh[D].addEntry(G)}else this._creationFunc(G,this),this.entries.length>this.ze&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(G){if(this.Wh){for(let D=0;D<this.Wh.length;D++){this.Wh[D].removeEntry(G)}return}const D=this.entries.indexOf(G);D>-1&&this.entries.splice(D,1)}addEntries(G){for(let D=0;D<G.length;D++){const N=G[D];this.addEntry(N)}}select(G,D,N){if(o.d.IsInFrustum(this.Ji,G)){if(this.Wh){for(let T=0;T<this.Wh.length;T++){this.Wh[T].select(G,D,N)}return}N?D.concat(this.entries):D.concatWithNoDuplicate(this.entries)}}intersects(G,D,N,T){if(o.d.IntersectsSphere(this._minPoint,this._maxPoint,G,D)){if(this.Wh){for(let o=0;o<this.Wh.length;o++){this.Wh[o].intersects(G,D,N,T)}return}T?N.concat(this.entries):N.concatWithNoDuplicate(this.entries)}}intersectsRay(G,D){if(G.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Wh){for(let N=0;N<this.Wh.length;N++){this.Wh[N].intersectsRay(G,D)}return}D.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){Z._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(G,D,N,o,n,C,P,r){P.Wh=new Array;const v=new T.s((D.x-G.x)/2,(D.y-G.y)/2,(D.z-G.z)/2);for(let T=0;T<2;T++)for(let D=0;D<2;D++)for(let q=0;q<2;q++){const g=G.add(v.multiplyByFloats(T,D,q)),X=G.add(v.multiplyByFloats(T+1,D+1,q+1)),W=new Z(g,X,o,n+1,C,r);W.addEntries(N),P.Wh.push(W)}}}},12111:(G,D,N)=>{"use strict";N.d(D,{d:()=>v});var T=N(1218),o=N(1009),Z=N(11428),n=N(11552),C=N(1276),P=N(12097),r=N(1030);T.e.prototype.createOrUpdateSelectionOctree=function(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,N=this._getComponent(C.c.NAME_OCTREE);N||(N=new v(this),this.ee(N)),this.Bi||(this.Bi=new P.e(P.e.CreationFuncForMeshes,G,D));const T=this.getWorldExtends();return this.Bi.update(T.min,T.max,this.meshes),this.Bi},Object.defineProperty(T.e.prototype,"selectionOctree",{get:function(){return this.Bi},enumerable:!0,configurable:!0}),Z.d.prototype.createOrUpdateSubmeshesOctree=function(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const N=this.va();let T=N._getComponent(C.c.NAME_OCTREE);T||(T=new v(N),N.ee(T)),this._submeshesOctree||(this._submeshesOctree=new P.e(P.e.CreationFuncForSubMeshes,G,D)),this.se(!0);const o=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(o.minimumWorld,o.maximumWorld,this.le),this._submeshesOctree};class v{constructor(G){this.name=C.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new n.e(o.s.Zero(),new o.s(1,1,1)),(G=G||r.e.LastCreatedScene)&&(this.oe=G,this.oe.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.oe.getActiveSubMeshCandidates=G=>this.getActiveSubMeshCandidates(G),this.oe.getCollidingSubMeshCandidates=(G,D)=>this.getCollidingSubMeshCandidates(G,D),this.oe.getIntersectingSubMeshCandidates=(G,D)=>this.getIntersectingSubMeshCandidates(G,D))}register(){this.oe.onMeshRemovedObservable.add((G=>{const D=this.oe.selectionOctree;if(void 0!==D&&null!==D){const N=D.Di.indexOf(G);-1!==N&&D.Di.splice(N,1)}})),this.oe.onMeshImportedObservable.add((G=>{const D=this.oe.selectionOctree;void 0!==D&&null!==D&&D.qe(G)}))}getActiveMeshCandidates(){var G;return(null===(G=this.oe.Bi)||void 0===G?void 0:G.select(this.oe.frustumPlanes))||this.oe._getDefaultMeshCandidates()}getActiveSubMeshCandidates(G){if(G._submeshesOctree&&G.useOctreeForRenderingSelection){return G._submeshesOctree.select(this.oe.frustumPlanes)}return this.oe._getDefaultSubMeshCandidates(G)}getIntersectingSubMeshCandidates(G,D){if(G._submeshesOctree&&G.useOctreeForPicking){n.e.TransformToRef(D,G.getWorldMatrix(),this._tempRay);return G._submeshesOctree.intersectsRay(this._tempRay)}return this.oe._getDefaultSubMeshCandidates(G)}getCollidingSubMeshCandidates(G,D){if(G._submeshesOctree&&G.useOctreeForCollisions){const N=D._velocityWorldLength+Math.max(D._radius.x,D._radius.y,D._radius.z);return G._submeshesOctree.intersects(D._basePointWorld,N)}return this.oe._getDefaultSubMeshCandidates(G)}rebuild(){}dispose(){}}},11552:(G,D,N)=>{"use strict";N.d(D,{e:()=>X});var T=N(1218),o=N(11393),Z=N(1012),n=N(1009),C=N(1015),P=N(1345),r=N(1252),v=N(1030),q=N(1296);const g={internalPickerForMesh:void 0};class X{constructor(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Z.d;this.origin=G,this.direction=D,this.length=N,this.epsilon=T}clone(){return new X(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const T=X._TmpVector3[0].xd(G.x-N,G.y-N,G.z-N),o=X._TmpVector3[1].xd(D.x+N,D.y+N,D.z+N);let Z,n,C,P,r=0,v=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<T.x||this.origin.x>o.x)return!1}else if(Z=1/this.direction.x,n=(T.x-this.origin.x)*Z,C=(o.x-this.origin.x)*Z,C===-1/0&&(C=1/0),n>C&&(P=n,n=C,C=P),r=Math.max(n,r),v=Math.min(C,v),r>v)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<T.y||this.origin.y>o.y)return!1}else if(Z=1/this.direction.y,n=(T.y-this.origin.y)*Z,C=(o.y-this.origin.y)*Z,C===-1/0&&(C=1/0),n>C&&(P=n,n=C,C=P),r=Math.max(n,r),v=Math.min(C,v),r>v)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<T.z||this.origin.z>o.z)return!1}else if(Z=1/this.direction.z,n=(T.z-this.origin.z)*Z,C=(o.z-this.origin.z)*Z,C===-1/0&&(C=1/0),n>C&&(P=n,n=C,C=P),r=Math.max(n,r),v=Math.min(C,v),r>v)return!1;return!0}intersectsBox(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(G.minimum,G.maximum,D)}intersectsSphere(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const N=G.center.x-this.origin.x,T=G.center.y-this.origin.y,o=G.center.z-this.origin.z,Z=N*N+T*T+o*o,n=G.i+D,C=n*n;if(Z<=C)return!0;const P=N*this.direction.x+T*this.direction.y+o*this.direction.z;if(P<0)return!1;return Z-P*P<=C}intersectsTriangle(G,D,N){const T=X._TmpVector3[0],o=X._TmpVector3[1],Z=X._TmpVector3[2],C=X._TmpVector3[3],r=X._TmpVector3[4];D.subtractToRef(G,T),N.subtractToRef(G,o),n.s.CrossToRef(this.direction,o,Z);const v=n.s.Dot(T,Z);if(0===v)return null;const q=1/v;this.origin.subtractToRef(G,C);const g=n.s.Dot(C,Z)*q;if(g<-this.epsilon||g>1+this.epsilon)return null;n.s.CrossToRef(C,T,r);const W=n.s.Dot(this.direction,r)*q;if(W<-this.epsilon||g+W>1+this.epsilon)return null;const j=n.s.Dot(o,r)*q;return j>this.length?null:new P.e(1-g-W,g,j)}intersectsPlane(G){let D;const N=n.s.Dot(G.Bd,this.direction);if(Math.abs(N)<9.99999997475243e-7)return null;{const T=n.s.Dot(G.Bd,this.origin);return D=(-G.d-T)/N,D<0?D<-9.99999997475243e-7?null:0:D}}intersectsAxis(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(G){case"y":{const G=(this.origin.y-D)/this.direction.y;return G>0?null:new n.s(this.origin.x+this.direction.x*-G,D,this.origin.z+this.direction.z*-G)}case"x":{const G=(this.origin.x-D)/this.direction.x;return G>0?null:new n.s(D,this.origin.y+this.direction.y*-G,this.origin.z+this.direction.z*-G)}case"z":{const G=(this.origin.z-D)/this.direction.z;return G>0?null:new n.s(this.origin.x+this.direction.x*-G,this.origin.y+this.direction.y*-G,D)}default:return null}}intersectsMesh(G,D,N){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const C=n.k.Matrix[0];return G.getWorldMatrix().invertToRef(C),this._tmpRay?X.TransformToRef(this,C,this._tmpRay):this._tmpRay=X.Transform(this,C),G.intersects(this._tmpRay,D,N,T,o,Z)}intersectsMeshes(G,D,N){N?N.length=0:N=[];for(let T=0;T<G.length;T++){const o=this.intersectsMesh(G[T],D);o.hit&&N.push(o)}return N.sort(this._comparePickingInfo),N}_comparePickingInfo(G,D){return G.distance<D.distance?-1:G.distance>D.distance?1:0}intersectionSegment(G,D,N){const T=this.origin,o=n.k.Ad[0],Z=n.k.Ad[1],C=n.k.Ad[2],P=n.k.Ad[3];D.subtractToRef(G,o),this.direction.scaleToRef(X._Rayl,C),T.addToRef(C,Z),G.subtractToRef(T,P);const r=n.s.Dot(o,o),v=n.s.Dot(o,C),q=n.s.Dot(C,C),g=n.s.Dot(o,P),W=n.s.Dot(C,P),j=r*q-v*v;let Y,y,h=j,m=j;j<X._Smallnum?(Y=0,h=1,y=W,m=q):(Y=v*W-q*g,y=r*W-v*g,Y<0?(Y=0,y=W,m=q):Y>h&&(Y=h,y=W+v,m=q)),y<0?(y=0,-g<0?Y=0:-g>r?Y=h:(Y=-g,h=r)):y>m&&(y=m,-g+v<0?Y=0:-g+v>r?Y=h:(Y=-g+v,h=r));const R=Math.abs(Y)<X._Smallnum?0:Y/h,L=Math.abs(y)<X._Smallnum?0:y/m,w=n.k.Ad[4];C.scaleToRef(L,w);const B=n.k.Ad[5];o.scaleToRef(R,B),B.addInPlace(P);const F=n.k.Ad[6];B.subtractToRef(w,F);return L>0&&L<=this.length&&F.lengthSquared()<N*N?B.length():-1}update(G,D,N,T,o,Z,C){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){X._RayDistant||(X._RayDistant=X.Zero()),X._RayDistant.unprojectRayToRef(G,D,N,T,n.c.IdentityReadOnly,Z,C);const P=n.k.Matrix[0];o.invertToRef(P),X.TransformToRef(X._RayDistant,P,this)}else this.unprojectRayToRef(G,D,N,T,o,Z,C);return this}static Zero(){return new X(n.s.Zero(),n.s.Zero())}static CreateNew(G,D,N,T,o,Z,n){return X.Zero().update(G,D,N,T,o,Z,n)}static CreateNewFromTo(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.c.IdentityReadOnly;const T=new X(new n.s(0,0,0),new n.s(0,0,0));return X.CreateFromToToRef(G,D,T,N)}static CreateFromToToRef(G,D,N){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.c.IdentityReadOnly;N.origin.p(G);const o=D.subtractToRef(G,N.direction),Z=Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z);return N.length=Z,N.direction.normalize(),X.TransformToRef(N,T,N)}static Transform(G,D){const N=new X(new n.s(0,0,0),new n.s(0,0,0));return X.TransformToRef(G,D,N),N}static TransformToRef(G,D,N){n.s.TransformCoordinatesToRef(G.origin,D,N.origin),n.s.TransformNormalToRef(G.direction,D,N.direction),N.length=G.length,N.epsilon=G.epsilon;const T=N.direction,o=T.length();if(0!==o&&1!==o){const G=1/o;T.x*=G,T.y*=G,T.z*=G,N.length*=o}return N}unprojectRayToRef(G,D,N,T,o,Z,C){const P=n.k.Matrix[0];o.multiplyToRef(Z,P),P.multiplyToRef(C,P),P.invert();const r=v.e.LastCreatedEngine,q=n.k.Ad[0];q.x=G/N*2-1,q.y=-(D/T*2-1),q.z=null!==r&&void 0!==r&&r.useReverseDepthBuffer?1:null!==r&&void 0!==r&&r.isNDCHalfZRange?0:-1;const g=n.k.Ad[1].xd(q.x,q.y,1-1e-8),X=n.k.Ad[2],W=n.k.Ad[3];n.s._UnprojectFromInvertedMatrixToRef(q,P,X),n.s._UnprojectFromInvertedMatrixToRef(g,P,W),this.origin.p(X),W.subtractToRef(X,this.direction),this.direction.normalize()}}function W(G,D,N,T,o){let Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const n=X.Zero();return j(G,D,N,T,n,o,Z),n}function j(G,D,N,T,o,Z){let C=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const r=G.getEngine();if(!Z&&!(Z=G.activeCamera))return G;const v=Z.viewport,q=r.getRenderHeight(),{x:g,y:X,width:W,height:j}=v.toGlobal(r.getRenderWidth(),q),Y=1/r.getHardwareScalingLevel();return D=D*Y-g,N=N*Y-(q-X-j),o.update(D,N,W,j,T||n.c.IdentityReadOnly,C?n.c.IdentityReadOnly:Z.getViewMatrix(),Z.getProjectionMatrix(),P),G}function Y(G,D,N,T,o){if(!r.b)return G;const Z=G.getEngine();if(!o&&!(o=G.activeCamera))throw new Error("Active camera not set");const C=o.viewport,P=Z.getRenderHeight(),{x:v,y:q,width:g,height:X}=C.toGlobal(Z.getRenderWidth(),P),W=n.c.Identity(),j=1/Z.getHardwareScalingLevel();return D=D*j-v,N=N*j-(P-q-X),T.update(D,N,g,X,W,W,o.getProjectionMatrix()),G}function y(G,D,N,T,o,Z,n,C){const P=D(T,N.enableDistantPicking),r=N.intersects(P,o,n,Z,T,C);return r&&r.hit?!o&&null!=G&&r.distance>=G.distance?null:r:null}function h(G,D,N,T,o,Z){let C=null;const P=!!(G.activeCameras&&G.activeCameras.length>1&&G.cameraToUseForPointers!==G.activeCamera),v=G.cameraToUseForPointers||G.activeCamera,q=g.internalPickerForMesh||y;for(let r=0;r<G.meshes.length;r++){const g=G.meshes[r];if(N){if(!N(g,-1))continue}else if(!g.isEnabled()||!g.isVisible||!g.Ud)continue;const X=P&&g.isWorldMatrixCameraDependent(),W=g.se(X,v);if(g.hasThinInstances&&g.thinInstanceEnablePicking){const G=q(C,D,g,W,!0,!0,Z);if(G){if(o)return G;const P=n.k.Matrix[1],r=g.thinInstanceGetWorldMatrices();for(let G=0;G<r.length;G++){if(N&&!N(g,G))continue;r[G].multiplyToRef(W,P);const n=q(C,D,g,P,T,o,Z,!0);if(n&&(C=n,C.thinInstanceIndex=G,T))return C}}}else{const G=q(C,D,g,W,T,o,Z);if(G&&(C=G,T))return C}}return C||new r.b}function m(G,D,N,T){if(!r.b)return null;const o=[],Z=!!(G.activeCameras&&G.activeCameras.length>1&&G.cameraToUseForPointers!==G.activeCamera),C=G.cameraToUseForPointers||G.activeCamera,P=g.internalPickerForMesh||y;for(let r=0;r<G.meshes.length;r++){const v=G.meshes[r];if(N){if(!N(v,-1))continue}else if(!v.isEnabled()||!v.isVisible||!v.Ud)continue;const q=Z&&v.isWorldMatrixCameraDependent(),g=v.se(q,C);if(v.hasThinInstances&&v.thinInstanceEnablePicking){if(P(null,D,v,g,!0,!0,T)){const G=n.k.Matrix[1],Z=v.thinInstanceGetWorldMatrices();for(let n=0;n<Z.length;n++){if(N&&!N(v,n))continue;Z[n].multiplyToRef(g,G);const C=P(null,D,v,G,!1,!1,T,!0);C&&(C.thinInstanceIndex=n,o.push(C))}}}else{const G=P(null,D,v,g,!1,!1,T);G&&o.push(G)}}return o}function R(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,T=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;T||(T=G.getWorldMatrix()),D.length=N,o?D.origin.p(o):D.origin.p(G.position);const Z=n.k.Ad[2];Z.set(0,0,G._scene.useRightHandedSystem?-1:1);const C=n.k.Ad[3];return n.s.TransformNormalToRef(Z,T,C),n.s.NormalizeToRef(C,D.direction),D}var L,w;X._TmpVector3=(0,C.d)(6,n.s.Zero),X._RayDistant=X.Zero(),X._Smallnum=1e-8,X._Rayl=1e9,L=T.e,(w=o.d)&&(w.prototype.getForwardRay=function(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,D=arguments.length>1?arguments[1]:void 0,N=arguments.length>2?arguments[2]:void 0;return R(this,new X(n.s.Zero(),n.s.Zero(),G),G,D,N)},w.prototype.getForwardRayToRef=function(G){return R(this,G,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),L&&(q.b._IsPickingAvailable=!0,L.prototype.createPickingRay=function(G,D,N,T){return W(this,G,D,N,T,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),T.e.prototype.createPickingRayToRef=function(G,D,N,T,o){return j(this,G,D,N,T,o,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},T.e.prototype.createPickingRayInCameraSpace=function(G,D,N){return function(G,D,N,T){const o=X.Zero();return Y(G,D,N,o,T),o}(this,G,D,N)},T.e.prototype.createPickingRayInCameraSpaceToRef=function(G,D,N,T){return Y(this,G,D,N,T)},T.e.prototype.pickWithBoundingInfo=function(G,D,N,T,o){return function(G,D,N,T,o,Z){if(!r.b)return null;const C=h(G,(T=>(G._tempPickingRay||(G._tempPickingRay=X.Zero()),j(G,D,N,T,G._tempPickingRay,Z||null),G._tempPickingRay)),T,o,!0);return C&&(C.ray=W(G,D,N,n.c.Identity(),Z||null)),C}(this,G,D,N,T,o)},T.e.prototype.Td=function(G,D,N,T,o,Z){return function(G,D,N,T,o,Z,C){const P=h(G,((T,o)=>(G._tempPickingRay||(G._tempPickingRay=X.Zero()),j(G,D,N,T,G._tempPickingRay,Z||null,!1,o),G._tempPickingRay)),T,o,!1,C);return P&&(P.ray=W(G,D,N,n.c.Identity(),Z||null)),P}(this,G,D,N,T,o,Z)},T.e.prototype.pickWithRay=function(G,D,N,T){return function(G,D,N,T,o){const Z=h(G,(N=>(G._pickWithRayInverseMatrix||(G._pickWithRayInverseMatrix=n.c.Identity()),N.invertToRef(G._pickWithRayInverseMatrix),G._cachedRayForTransform||(G._cachedRayForTransform=X.Zero()),X.TransformToRef(D,G._pickWithRayInverseMatrix,G._cachedRayForTransform),G._cachedRayForTransform)),N,T,!1,o);return Z&&(Z.ray=D),Z}(this,G,D,N,T)},T.e.prototype.multiPick=function(G,D,N,T,o){return function(G,D,N,T,o,Z){return m(G,(T=>W(G,D,N,T,o||null)),T,Z)}(this,G,D,N,T,o)},T.e.prototype.multiPickWithRay=function(G,D,N){return function(G,D,N,T){return m(G,(N=>(G._pickWithRayInverseMatrix||(G._pickWithRayInverseMatrix=n.c.Identity()),N.invertToRef(G._pickWithRayInverseMatrix),G._cachedRayForTransform||(G._cachedRayForTransform=X.Zero()),X.TransformToRef(D,G._pickWithRayInverseMatrix,G._cachedRayForTransform),G._cachedRayForTransform)),N,T)}(this,G,D,N)}},12115:(G,D,N)=>{"use strict";N(1105);var T=N(1424);N(1157),N(1258),N(1026),N(1463),N(1432);T.d},11251:(G,D,N)=>{"use strict";N.r(D),N.d(D,{SceneInstrumentation:()=>Z});var T=N(1223),o=N(1304);class Z{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(G){G!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=G,G?(this._onBeforeActiveMeshesEvaluationObserver=this.oe.onBeforeActiveMeshesEvaluationObservable.add((()=>{T.f.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.oe.onAfterActiveMeshesEvaluationObservable.add((()=>{T.f.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.oe.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.oe.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(G){G!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=G,G?(this._onBeforeRenderTargetsRenderObserver=this.oe.onBeforeRenderTargetsRenderObservable.add((()=>{T.f.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.oe.onAfterRenderTargetsRenderObservable.add((()=>{T.f.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.oe.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.oe.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(G){G!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=G,G?(this._onBeforeParticlesRenderingObserver=this.oe.onBeforeParticlesRenderingObservable.add((()=>{T.f.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.oe.onAfterParticlesRenderingObservable.add((()=>{T.f.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.oe.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.oe.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(G){G!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=G,this.oe.spriteManagers&&(G?(this._onBeforeSpritesRenderingObserver=this.oe.onBeforeSpritesRenderingObservable.add((()=>{T.f.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.oe.onAfterSpritesRenderingObservable.add((()=>{T.f.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.oe.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.oe.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(G){G!==this._capturePhysicsTime&&this.oe.onBeforePhysicsObservable&&(this._capturePhysicsTime=G,G?(this._onBeforePhysicsObserver=this.oe.onBeforePhysicsObservable.add((()=>{T.f.StartPerformanceCounter("gb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.oe.onAfterPhysicsObservable.add((()=>{T.f.EndPerformanceCounter("gb"),this._physicsTime.endMonitoring()}))):(this.oe.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.oe.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(G){G!==this._captureAnimationsTime&&(this._captureAnimationsTime=G,G?this._onAfterAnimationsObserver=this.oe.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.oe.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(G){this._captureFrameTime=G}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(G){this._captureInterFrameTime=G}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(G){G!==this._captureRenderTime&&(this._captureRenderTime=G,G?(this._onBeforeDrawPhaseObserver=this.oe.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),T.f.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.oe.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),T.f.EndPerformanceCounter("Main render")}))):(this.oe.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.oe.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(G){G!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=G,G?(this._onBeforeCameraRenderObserver=this.oe.onBeforeCameraRenderObservable.add((G=>{this._cameraRenderTime.beginMonitoring(),T.f.StartPerformanceCounter(`Rendering camera ${G.name}`)})),this._onAfterCameraRenderObserver=this.oe.onAfterCameraRenderObservable.add((G=>{this._cameraRenderTime.endMonitoring(!1),T.f.EndPerformanceCounter(`Rendering camera ${G.name}`)}))):(this.oe.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.oe.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.oe.getEngine()._drawCalls}constructor(G){this.oe=G,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new o.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new o.c,this._captureFrameTime=!1,this._frameTime=new o.c,this._captureRenderTime=!1,this._renderTime=new o.c,this._captureInterFrameTime=!1,this._interFrameTime=new o.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new o.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new o.c,this._capturePhysicsTime=!1,this._physicsTime=new o.c,this._captureAnimationsTime=!1,this._animationsTime=new o.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new o.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=G.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(T.f.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.oe.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=G.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(T.f.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Ld(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Ld(),this._captureParticlesRenderTime&&this._particlesRenderTime.Ld(),this._captureSpritesRenderTime&&this._spritesRenderTime.Ld(),this._captureRenderTime&&this._renderTime.Ld(),this._captureCameraRenderTime&&this._cameraRenderTime.Ld()}))}dispose(){this.oe.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.oe.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.oe.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.oe.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.oe.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.oe.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.oe.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.oe.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.oe.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.oe.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.oe.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.oe.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.oe.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.oe.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.oe.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.oe.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.oe.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.oe=null}}},11780:(G,D,N)=>{"use strict";N.d(D,{d:()=>v});var T=N(980),o=N(985),Z=N(1009),n=N(11399),C=N(11753),P=N(11784),r=N(1018);n.b.AddNodeConstructor("Light_Type_1",((G,D)=>()=>new v(G,Z.s.Zero(),D)));class v extends P.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(G){this._shadowFrustumSize=G,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(G){this._shadowOrthoScale=G,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(G){this._orthoLeft=G}get orthoRight(){return this._orthoRight}set orthoRight(G){this._orthoRight=G}get orthoTop(){return this._orthoTop}set orthoTop(G){this._orthoTop=G}get orthoBottom(){return this._orthoBottom}set orthoBottom(G){this._orthoBottom=G}constructor(G,D,N){super(G,N),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=D.scale(-1),this.direction=D}getClassName(){return"hb"}getTypeID(){return C.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(G,D,N){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(G):this._setDefaultAutoExtendShadowProjectionMatrix(G,D,N)}_setDefaultFixedFrustumShadowProjectionMatrix(G){const D=this.va().activeCamera;D&&Z.c.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:D.fj,void 0!==this.shadowMaxZ?this.shadowMaxZ:D.maxZ,G,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(G,D,N){const T=this.va().activeCamera;if(!T)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const G=Z.s.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let T=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let n=0;n<N.length;n++){const C=N[n];if(!C)continue;const P=C.getBoundingInfo().boundingBox;for(let N=0;N<P.vectorsWorld.length;N++)Z.s.TransformCoordinatesToRef(P.vectorsWorld[N],D,G),G.x<this._orthoLeft&&(this._orthoLeft=G.x),G.y<this._orthoBottom&&(this._orthoBottom=G.y),G.x>this._orthoRight&&(this._orthoRight=G.x),G.y>this._orthoTop&&(this._orthoTop=G.y),this.autoCalcShadowZBounds&&(G.z<T&&(T=G.z),G.z>o&&(o=G.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=T,this._shadowMaxZ=o)}const o=this._orthoRight-this._orthoLeft,n=this._orthoTop-this._orthoBottom,C=void 0!==this.shadowMinZ?this.shadowMinZ:T.fj,P=void 0!==this.shadowMaxZ?this.shadowMaxZ:T.maxZ,r=this.va().getEngine().useReverseDepthBuffer;Z.c.OrthoOffCenterLHToRef(this._orthoLeft-o*this.shadowOrthoScale,this._orthoRight+o*this.shadowOrthoScale,this._orthoBottom-n*this.shadowOrthoScale,this._orthoTop+n*this.shadowOrthoScale,r?P:C,r?C:P,G,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(G,D){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,D),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,D),this)}transferToNodeMaterialEffect(G,D){return this.computeTransformedInformation()?(G.setFloat3(D,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(G.setFloat3(D,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(G){const D=this._scene.getEngine();return!D.useReverseDepthBuffer&&D.isNDCHalfZRange?0:1}getDepthMaxZ(G){const D=this._scene.getEngine();return D.useReverseDepthBuffer&&D.isNDCHalfZRange?0:1}prepareLightSpecificDefines(G,D){G["DIRLIGHT"+D]=!0}}(0,T.c)([(0,o.S)()],v.prototype,"shadowFrustumSize",null),(0,T.c)([(0,o.S)()],v.prototype,"shadowOrthoScale",null),(0,T.c)([(0,o.S)()],v.prototype,"autoUpdateExtends",void 0),(0,T.c)([(0,o.S)()],v.prototype,"autoCalcShadowZBounds",void 0),(0,T.c)([(0,o.S)("orthoLeft")],v.prototype,"_orthoLeft",void 0),(0,T.c)([(0,o.S)("orthoRight")],v.prototype,"_orthoRight",void 0),(0,T.c)([(0,o.S)("orthoTop")],v.prototype,"_orthoTop",void 0),(0,T.c)([(0,o.S)("orthoBottom")],v.prototype,"_orthoBottom",void 0),(0,r.h)("BABYLON.DirectionalLight",v)},12049:(G,D,N)=>{"use strict";N.d(D,{b:()=>v});var T=N(980),o=N(985),Z=N(1009),n=N(1185),C=N(11399),P=N(11753),r=N(1018);C.b.AddNodeConstructor("Light_Type_3",((G,D)=>()=>new v(G,Z.s.Zero(),D)));class v extends P.e{constructor(G,D,N){super(G,N),this.groundColor=new n.d(0,0,0),this.direction=D||Z.s.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ib"}setDirectionToTarget(G){return this.direction=Z.s.Normalize(G.Jc(Z.s.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(G,D){const N=Z.s.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",N.x,N.y,N.z,0,D),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.jj),D),this}transferToNodeMaterialEffect(G,D){const N=Z.s.Normalize(this.direction);return G.setFloat3(D,N.x,N.y,N.z),this}se(){return this._worldMatrix||(this._worldMatrix=Z.c.Identity()),this._worldMatrix}getTypeID(){return P.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(G,D){G["HEMILIGHT"+D]=!0}}(0,T.c)([(0,o.m)()],v.prototype,"groundColor",void 0),(0,T.c)([(0,o.O)()],v.prototype,"direction",void 0),(0,r.h)("BABYLON.HemisphericLight",v)},11753:(G,D,N)=>{"use strict";N.d(D,{e:()=>g});var T=N(980),o=N(985),Z=N(1009),n=N(1185),C=N(11399),P=N(1246),r=N(1018),v=N(1319),q=N(1181);class g extends C.b{get range(){return this._range}set range(G){this._range=G,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(G){this._intensityMode=G,this._computePhotometricScale()}get i(){return this._radius}set i(G){this._radius=G,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(G){this._shadowEnabled!==G&&(this._shadowEnabled=G,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(G){this._includedOnlyMeshes=G,this._hookArrayForIncludedOnly(G)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(G){this._excludedMeshes=G,this._hookArrayForExcluded(G)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(G){this._excludeWithLayerMask=G,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(G){this._includeOnlyWithLayerMask=G,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(G){this._lightmapMode!==G&&(this._lightmapMode=G,this._markMeshesAsLightDirty())}getViewMatrix(G){return null}getProjectionMatrix(G,D){return null}constructor(G,D){super(G,D,!1),this.Th=new n.d(1,1,1),this.Me=new n.d(1,1,1),this.falloffType=g.FALLOFF_DEFAULT,this.jj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=g.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new P.b(this.va().getEngine(),void 0,void 0,G),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(G,D){return this}_bindLight(G,D,N,T){let o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const Z=G.toString();let C=!1;if(this._uniformBuffer.bindToEffect(N,"Light"+Z),this._renderId!==D.getRenderId()||this._lastUseSpecular!==T||!this._uniformBuffer.useUbo){this._renderId=D.getRenderId(),this._lastUseSpecular=T;const G=this.getScaledIntensity();this.transferToEffect(N,Z),this.Th.scaleToRef(G,n.k.Md[0]),this._uniformBuffer.updateColor4("vLightDiffuse",n.k.Md[0],this.range,Z),T&&(this.Me.scaleToRef(G,n.k.Md[1]),this._uniformBuffer.updateColor4("vLightSpecular",n.k.Md[1],this.i,Z)),C=!0}if(this.transferTexturesToEffect(N,Z),D.shadowsEnabled&&this.shadowEnabled&&o){const G=this.getShadowGenerator(D.activeCamera)??this.getShadowGenerator();G&&(G.bindShadowLight(Z,N),C=!0)}C?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(G){let D="Name: "+this.name;if(D+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let N=0;N<this.animations.length;N++)D+=", animation[0]: "+this.animations[N].toString(G);return D}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Lg(G){super.Lg(G),this._resyncMeshes()}getShadowGenerator(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(G)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return Z.s.Zero()}canAffectMesh(G){return!G||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(G))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(G))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&G.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&G.layerMask)))}dispose(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const G=this._shadowGenerators.values();for(let D=G.next();!0!==D.done;D=G.next()){D.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const G=this._parentContainer.lights.indexOf(this);G>-1&&this._parentContainer.lights.splice(G,1),this._parentContainer=null}for(const N of this.va().meshes)N._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(G,D)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.jj}clone(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=g.GetConstructorFromName(this.getTypeID(),G,this.va());if(!N)return null;const T=q.e.Clone(N,this);return G&&(T.name=G),D&&(T.parent=D),T.Lg(this.isEnabled()),this.onClonedObservable.notifyObservers(T),T}serialize(){const G=q.e.Serialize(this);return G.uniqueId=this.uniqueId,G.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(G),this.excludedMeshes.length>0&&(G.excludedMeshesIds=[],this.excludedMeshes.forEach((D=>{G.excludedMeshesIds.push(D.id)}))),this.includedOnlyMeshes.length>0&&(G.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((D=>{G.includedOnlyMeshesIds.push(D.id)}))),q.e.AppendSerializedAnimations(this,G),G.ranges=this.serializeAnimationRanges(),G.isEnabled=this.isEnabled(),G}static GetConstructorFromName(G,D,N){const T=C.b.Construct("Light_Type_"+G,D,N);return T||null}static Parse(G,D){const N=g.GetConstructorFromName(G.type,G.name,D);if(!N)return null;const T=q.e.Parse(N,G,D);if(G.excludedMeshesIds&&(T._excludedMeshesIds=G.excludedMeshesIds),G.includedOnlyMeshesIds&&(T._includedOnlyMeshesIds=G.includedOnlyMeshesIds),void 0!==G.parentId&&(T._waitingParentId=G.parentId),void 0!==G.parentInstanceIndex&&(T._waitingParentInstanceIndex=G.parentInstanceIndex),void 0!==G.falloffType&&(T.falloffType=G.falloffType),void 0!==G.lightmapMode&&(T.lightmapMode=G.lightmapMode),G.animations){for(let D=0;D<G.animations.length;D++){const N=G.animations[D],o=(0,r.e)("BABYLON.Animation");o&&T.animations.push(o.Parse(N))}C.b.ParseAnimationRanges(T,G,D)}return G.autoAnimate&&D.beginAnimation(T,G.autoAnimateFrom,G.autoAnimateTo,G.autoAnimateLoop,G.autoAnimateSpeed||1),void 0!==G.isEnabled&&T.Lg(G.isEnabled),T}_hookArrayForExcluded(G){var D=this;const N=G.push;G.push=function(){for(var T=arguments.length,o=new Array(T),Z=0;Z<T;Z++)o[Z]=arguments[Z];const n=N.apply(G,o);for(const G of o)G._resyncLightSource(D);return n};const T=G.splice;G.splice=(D,N)=>{const o=T.apply(G,[D,N]);for(const G of o)G._resyncLightSource(this);return o};for(const o of G)o._resyncLightSource(this)}_hookArrayForIncludedOnly(G){var D=this;const N=G.push;G.push=function(){for(var T=arguments.length,o=new Array(T),Z=0;Z<T;Z++)o[Z]=arguments[Z];const n=N.apply(G,o);return D._resyncMeshes(),n};const T=G.splice;G.splice=(D,N)=>{const o=T.apply(G,[D,N]);return this._resyncMeshes(),o},this._resyncMeshes()}_resyncMeshes(){for(const G of this.va().meshes)G._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const G of this.va().meshes)-1!==G.lightSources.indexOf(this)&&G._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let G=0;const D=this.getTypeID();let N=this.intensityMode;switch(N===g.INTENSITYMODE_AUTOMATIC&&(N=D===g.LIGHTTYPEID_DIRECTIONALLIGHT?g.INTENSITYMODE_ILLUMINANCE:g.INTENSITYMODE_LUMINOUSINTENSITY),D){case g.LIGHTTYPEID_POINTLIGHT:case g.LIGHTTYPEID_SPOTLIGHT:switch(N){case g.INTENSITYMODE_LUMINOUSPOWER:G=1/(4*Math.PI);break;case g.INTENSITYMODE_LUMINOUSINTENSITY:G=1;break;case g.INTENSITYMODE_LUMINANCE:G=this.i*this.i}break;case g.LIGHTTYPEID_DIRECTIONALLIGHT:switch(N){case g.INTENSITYMODE_ILLUMINANCE:G=1;break;case g.INTENSITYMODE_LUMINANCE:{let D=this.i;D=Math.max(D,.001);G=2*Math.PI*(1-Math.cos(D));break}}break;case g.LIGHTTYPEID_HEMISPHERICLIGHT:G=1}return G}_reorderLightsInScene(){const G=this.va();0!=this._renderPriority&&(G.requireLightSorting=!0),this.va().sortLightsByPriority()}}g.FALLOFF_DEFAULT=v.e.FALLOFF_DEFAULT,g.FALLOFF_PHYSICAL=v.e.FALLOFF_PHYSICAL,g.FALLOFF_GLTF=v.e.FALLOFF_GLTF,g.FALLOFF_STANDARD=v.e.FALLOFF_STANDARD,g.LIGHTMAP_DEFAULT=v.e.LIGHTMAP_DEFAULT,g.LIGHTMAP_SPECULAR=v.e.LIGHTMAP_SPECULAR,g.LIGHTMAP_SHADOWSONLY=v.e.LIGHTMAP_SHADOWSONLY,g.INTENSITYMODE_AUTOMATIC=v.e.INTENSITYMODE_AUTOMATIC,g.INTENSITYMODE_LUMINOUSPOWER=v.e.INTENSITYMODE_LUMINOUSPOWER,g.INTENSITYMODE_LUMINOUSINTENSITY=v.e.INTENSITYMODE_LUMINOUSINTENSITY,g.INTENSITYMODE_ILLUMINANCE=v.e.INTENSITYMODE_ILLUMINANCE,g.INTENSITYMODE_LUMINANCE=v.e.INTENSITYMODE_LUMINANCE,g.LIGHTTYPEID_POINTLIGHT=v.e.LIGHTTYPEID_POINTLIGHT,g.LIGHTTYPEID_DIRECTIONALLIGHT=v.e.LIGHTTYPEID_DIRECTIONALLIGHT,g.LIGHTTYPEID_SPOTLIGHT=v.e.LIGHTTYPEID_SPOTLIGHT,g.LIGHTTYPEID_HEMISPHERICLIGHT=v.e.LIGHTTYPEID_HEMISPHERICLIGHT,(0,T.c)([(0,o.m)()],g.prototype,"diffuse",void 0),(0,T.c)([(0,o.m)()],g.prototype,"specular",void 0),(0,T.c)([(0,o.S)()],g.prototype,"falloffType",void 0),(0,T.c)([(0,o.S)()],g.prototype,"intensity",void 0),(0,T.c)([(0,o.S)()],g.prototype,"range",null),(0,T.c)([(0,o.S)()],g.prototype,"intensityMode",null),(0,T.c)([(0,o.S)()],g.prototype,"i",null),(0,T.c)([(0,o.S)()],g.prototype,"_renderPriority",void 0),(0,T.c)([(0,o.e)("_reorderLightsInScene")],g.prototype,"renderPriority",void 0),(0,T.c)([(0,o.S)("shadowEnabled")],g.prototype,"_shadowEnabled",void 0),(0,T.c)([(0,o.S)("excludeWithLayerMask")],g.prototype,"_excludeWithLayerMask",void 0),(0,T.c)([(0,o.S)("includeOnlyWithLayerMask")],g.prototype,"_includeOnlyWithLayerMask",void 0),(0,T.c)([(0,o.S)("lightmapMode")],g.prototype,"_lightmapMode",void 0)},11784:(G,D,N)=>{"use strict";N.d(D,{c:()=>P});var T=N(980),o=N(985),Z=N(1009),n=N(11753),C=N(1477);class P extends n.e{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=Z.c.Identity(),this._projectionMatrix=Z.c.Identity()}_setPosition(G){this._position=G}get position(){return this._position}set position(G){this._setPosition(G)}_setDirection(G){this._direction=G}get direction(){return this._direction}set direction(G){this._setDirection(G)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(G){this._shadowMinZ=G,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(G){this._shadowMaxZ=G,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=Z.s.Zero()),Z.s.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=Z.s.Zero()),Z.s.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(G){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(G){return this.direction=Z.s.Normalize(G.Jc(this.position)),this.direction}getRotation(){this.direction.normalize();const G=Z.s.Cross(this.direction,C.d.Y),D=Z.s.Cross(G,this.direction);return Z.s.RotationFromAxis(G,D,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=Z.s.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}se(G){return!G&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=Z.c.Identity()),Z.c.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(G){return void 0!==this.shadowMinZ?this.shadowMinZ:G.fj}getDepthMaxZ(G){return void 0!==this.shadowMaxZ?this.shadowMaxZ:G.maxZ}setShadowProjectionMatrix(G,D,N){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(D,N,G):this._setDefaultShadowProjectionMatrix(G,D,N),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(G){const D=Z.k.Ad[0];let N=this.position;this.computeTransformedInformation()&&(N=this.transformedPosition),Z.s.NormalizeToRef(this.getShadowDirection(G),D),1===Math.abs(Z.s.Dot(D,Z.s.Up()))&&(D.z=1e-13);const T=Z.k.Ad[1];return N.addToRef(D,T),Z.c.LookAtLHToRef(N,T,Z.s.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(G,D){return this.setShadowProjectionMatrix(this._projectionMatrix,G??this._viewMatrix,D??[]),this._projectionMatrix}}(0,T.c)([(0,o.O)()],P.prototype,"position",null),(0,T.c)([(0,o.O)()],P.prototype,"direction",null),(0,T.c)([(0,o.S)()],P.prototype,"shadowMinZ",null),(0,T.c)([(0,o.S)()],P.prototype,"shadowMaxZ",null)},11539:(G,D,N)=>{"use strict";N.d(D,{e:()=>n,g:()=>Z,j:()=>C});const T={},o={};function Z(G,D){T[G]=D}function n(G,D){o[G]=D}function C(G){return o[G]?o[G]:null}},11488:(G,D,N)=>{"use strict";N.d(D,{e:()=>t,h:()=>w});var T,o=N(1223),Z=N(1003),n=N(1218),C=N(1030),P=N(1105),r=N(11420),v=N(1055),q=N(1072),g=N(1051),X=N(1122);!function(G){G[G.Clean=0]="Clean",G[G.Stop=1]="Stop",G[G.Sync=2]="Sync",G[G.NoSync=3]="NoSync"}(T||(T={}));const W=new Z.b,j={};let Y=!1;function y(){return j[".babylon"]}function h(G){const D=j[G];return D||(P.d.Warn("Unable to find a plugin to load "+G+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),y())}function m(G,D,N){let T="Unable to load from "+(G.rawData?"binary data":G.url);return D?T+=`: ${D}`:N&&(T+=`: ${N}`),T}function R(G,D,N,T,o,Z,n,C,P){var r;const q="data:"===(g=G.url).substring(0,5)?g.substring(5):null;var g;if(G.rawData&&!n)throw"When using ArrayBufferView to load data the file extension must be provided.";const Y=n?h(n):q?function(G){for(const D in j){const N=j[D].plugin;if(N.canDirectLoad&&N.canDirectLoad(G))return j[D]}return y()}(G.url):function(G){const D=G.indexOf("?");-1!==D&&(G=G.substring(0,D));const N=G.lastIndexOf(".");return h(G.substring(N,G.length).toLowerCase())}(G.url);if(!Y)throw new Error(`No plugin or fallback for ${n??G.url}`);if(!1===(null===P||void 0===P||null===(r=P[Y.plugin.name])||void 0===r?void 0:r.enabled))throw new Error(`The '${Y.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(G.rawData&&!Y.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(G=>{if(Y.plugin.createPlugin){const D=Y.plugin.createPlugin(P??{});return D instanceof Promise?(D.then(G).catch((G=>{o("Error instantiating plugin.",G)})),null):(G(D),D)}return G(Y.plugin),Y.plugin})((P=>{var r;if(!P)throw`The loader plugin corresponding to the '${n}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(W.notifyObservers(P),q&&(P.canDirectLoad&&P.canDirectLoad(G.url)||!(0,v.g)(G.url))){if(P.directLoad){const G=P.directLoad(D,q);G instanceof Promise?G.then((G=>{N(P,G)})).catch((G=>{o("Error in directLoad of _loadData: "+G,G)})):N(P,G)}else N(P,q);return}const g=Y.isBinary,j=(G,T)=>{D.u?o("Scene has been disposed"):N(P,G,T)};let y=null,h=!1;null===(r=P.Fd)||void 0===r||r.add((()=>{h=!0,y&&(y.abort(),y=null),Z()}));const m=()=>{if(h)return;const N=(G,D)=>{o(null===G||void 0===G?void 0:G.statusText,D)};if(!P.loadFile&&G.rawData)throw"Plugin does not support loading ArrayBufferView.";y=P.loadFile?P.loadFile(D,G.rawData||G.file||G.url,G.rootUrl,j,T,g,N,C):D._loadFile(G.file||G.url,j,T,!0,g,N)},R=D.getEngine();let L=R.enableOfflineSupport;if(L){let N=!1;for(const T of D.disableOfflineSupportExceptionRules)if(T.test(G.url)){N=!0;break}L=!N}L&&X.b.OfflineProviderFactory?D.offlineProvider=X.b.OfflineProviderFactory(G.url,m,R.disableManifestCheck):m()}))}function L(G,D){let N,T,Z=null,n=null;if(D)if(D.name)N=`file:${D.name}`,T=D.name,Z=D;else if(ArrayBuffer.isView(D))N="",T=(0,g.c)(),n=D;else if(D.startsWith("data:"))N=D,T="";else if(G){const Z=D;if("/"===Z.substring(0,1))return o.f.Error("Wrong sceneFilename parameter"),null;N=G+Z,T=Z}else N=D,T=o.f.GetFilename(D),G=o.f.GetFolderPath(D);else N=G,T=o.f.GetFilename(G),G=o.f.GetFolderPath(G);return{url:N,rootUrl:G,name:T,file:Z,rawData:n}}function w(G){if("string"===typeof G.extensions){const D=G.extensions;j[D.toLowerCase()]={plugin:G,isBinary:!1}}else{const D=G.extensions;Object.keys(D).forEach((N=>{j[N.toLowerCase()]={plugin:G,isBinary:D[N].isBinary}}))}}function B(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C.e.LastCreatedScene,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!T)return P.d.Error("No scene available to import mesh to"),null;const X=L(D,N);if(!X)return null;const W={};T.addPendingData(W);const j=()=>{T.removePendingData(W)},Y=(G,D)=>{const N=m(X,G,D);n?n(T,N,new q.j(N,q.g.SceneLoaderError,D)):P.d.Error(N),j()},y=Z?G=>{try{Z(G)}catch(D){Y("Error in onProgress callback: "+D,D)}}:void 0,h=(G,D,N,Z,n,C,P,r)=>{if(T.importedMeshesFiles.push(X.url),o)try{o(G,D,N,Z,n,C,P,r)}catch(v){Y("Error in onSuccess callback: "+v,v)}T.removePendingData(W)};return R(X,T,((D,N,o)=>{if(D.rewriteRootURL&&(X.rootUrl=D.rewriteRootURL(X.rootUrl,o)),D.importMesh){const o=[],Z=[],n=[];if(!D.importMesh(G,T,N,X.rootUrl,o,Z,n,Y))return;T.loadingPluginName=D.name,h(o,Z,n,[],[],[],[],[])}else{D.importMeshAsync(G,T,N,X.rootUrl,y,X.name).then((G=>{T.loadingPluginName=D.name,h(G.meshes,G.fe,G.skeletons,G.animationGroups,G.transformNodes,G.geometries,G.lights,G.spriteManagers)})).catch((G=>{Y(G.message,G)}))}}),y,Y,j,r,v,g)}function F(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.e.LastCreatedEngine,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,P=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return N?V(G,D,new n.e(N),T,Z,P,r,v,q):(o.f.Error("No engine available"),null)}function S(G,D,N,T,o,Z,n){return new Promise(((C,P)=>{F(G,D,N,(G=>{C(G)}),T,((G,D,N)=>{P(N||new Error(D))}),o,Z,n)}))}function V(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.e.LastCreatedScene,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!N)return P.d.Error("No scene available to append to"),null;const X=L(G,D);if(!X)return null;const W={};N.addPendingData(W);const j=()=>{N.removePendingData(W)};r.d.ShowLoadingScreen&&!Y&&(Y=!0,N.getEngine().displayLoadingUI(),N.executeWhenReady((()=>{N.getEngine().hideLoadingUI(),Y=!1})));const y=(G,D)=>{const T=m(X,G,D);Z?Z(N,T,new q.j(T,q.g.SceneLoaderError,D)):P.d.Error(T),j()},h=o?G=>{try{o(G)}catch(D){y("Error in onProgress callback",D)}}:void 0,w=()=>{if(T)try{T(N)}catch(G){y("Error in onSuccess callback",G)}N.removePendingData(W)};return R(X,N,((G,D)=>{if(G.load){if(!G.load(N,D,X.rootUrl,y))return;N.loadingPluginName=G.name,w()}else{G.loadAsync(N,D,X.rootUrl,h,X.name).then((()=>{N.loadingPluginName=G.name,w()})).catch((G=>{y(G.message,G)}))}}),h,y,j,n,v,g)}function U(G,D,N,T,o,Z,n){return new Promise(((C,P)=>{V(G,D,N,(G=>{C(G)}),T,((G,D,N)=>{P(N||new Error(D))}),o,Z,n)}))}function z(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.e.LastCreatedScene,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!N)return P.d.Error("No scene available to load asset container to"),null;const g=L(G,D);if(!g)return null;const X={};N.addPendingData(X);const W=()=>{N.removePendingData(X)},j=(G,D)=>{const T=m(g,G,D);Z?Z(N,T,new q.j(T,q.g.SceneLoaderError,D)):P.d.Error(T),W()},Y=o?G=>{try{o(G)}catch(D){j("Error in onProgress callback",D)}}:void 0,y=G=>{if(T)try{T(G)}catch(D){j("Error in onSuccess callback",D)}N.removePendingData(X)};return R(g,N,((G,D)=>{if(G.loadAssetContainer){const T=G.loadAssetContainer(N,D,g.rootUrl,j);if(!T)return;T.populateRootNodes(),N.loadingPluginName=G.name,y(T)}else if(G.loadAssetContainerAsync){G.loadAssetContainerAsync(N,D,g.rootUrl,Y,g.name).then((D=>{D.populateRootNodes(),N.loadingPluginName=G.name,y(D)})).catch((G=>{j(G.message,G)}))}else j("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),Y,j,W,n,r,v)}function i(G,D,N,T,o,Z,n){return new Promise(((C,P)=>{z(G,D,N,(G=>{C(G)}),T,((G,D,N)=>{P(N||new Error(D))}),o,Z,n)}))}function J(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.e.LastCreatedScene,T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",X=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!N)return void P.d.Error("No scene available to load animations to");if(T){for(const G of N.animatables)G.reset();N.stopAllAnimations(),N.animationGroups.slice().forEach((G=>{G.dispose()}));N.getNodes().forEach((G=>{G.animations&&(G.animations=[])}))}else switch(o){case 0:N.animationGroups.slice().forEach((G=>{G.dispose()}));break;case 1:N.animationGroups.forEach((G=>{G.stop()}));break;case 2:N.animationGroups.forEach((G=>{G.reset(),G.restart()}));break;case 3:break;default:return void P.d.Error("Unknown animation group loading mode value '"+o+"'")}const W=N.animatables.length;z(G,D,N,(G=>{G.mergeAnimationsTo(N,N.animatables.slice(W),Z),G.dispose(),N.onAnimationFileImportedObservable.notifyObservers(N),n&&n(N)}),r,v,q,g,X)}function p(G,D,N,T,o,Z,n,C,P,r){return new Promise(((v,q)=>{J(G,D,N,T,o,Z,(G=>{v(G)}),n,((G,D,N)=>{q(N||new Error(D))}),C,P,r)}))}class t{static get ForceFullSceneLoadingForIncremental(){return r.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(G){r.d.ForceFullSceneLoadingForIncremental=G}static get ShowLoadingScreen(){return r.d.ShowLoadingScreen}static set ShowLoadingScreen(G){r.d.ShowLoadingScreen=G}static get loggingLevel(){return r.d.loggingLevel}static set loggingLevel(G){r.d.loggingLevel=G}static get CleanBoneMatrixWeights(){return r.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(G){r.d.CleanBoneMatrixWeights=G}static GetDefaultPlugin(){return y()}static GetPluginForExtension(G){var D;return null===(D=h(G))||void 0===D?void 0:D.plugin}static IsPluginForExtensionAvailable(G){return function(G){return!!j[G]}(G)}static RegisterPlugin(G){w(G)}static ImportMesh(G,D,N,T,o,Z,n,C,P){return B(G,D,N,T,o,Z,n,C,P)}static ImportMeshAsync(G,D,N,T,o,Z,n){return function(G,D,N,T,o,Z,n,C){return new Promise(((P,r)=>{B(G,D,N,T,((G,D,N,T,o,Z,n,C)=>{P({meshes:G,fe:D,skeletons:N,animationGroups:T,transformNodes:o,geometries:Z,lights:n,spriteManagers:C})}),o,((G,D,N)=>{r(N||new Error(D))}),Z,n,C)}))}(G,D,N,T,o,Z,n)}static Load(G,D,N,T,o,Z,n,C){return F(G,D,N,T,o,Z,n,C)}static LoadAsync(G,D,N,T,o,Z){return S(G,D,N,T,o,Z)}static Append(G,D,N,T,o,Z,n,C){return V(G,D,N,T,o,Z,n,C)}static AppendAsync(G,D,N,T,o,Z){return U(G,D,N,T,o,Z)}static LoadAssetContainer(G,D,N,T,o,Z,n,C){return z(G,D,N,T,o,Z,n,C)}static LoadAssetContainerAsync(G,D,N,T,o,Z){return i(G,D,N,T,o,Z)}static ImportAnimations(G,D,N,T,o,Z,n,C,P,r,v){J(G,D,N,T,o,Z,n,C,P,r,v)}static ImportAnimationsAsync(G,D,N,T,o,Z,n,C,P,r,v){return p(G,D,N,T,o,Z,C,r,v)}}t.NO_LOGGING=0,t.MINIMAL_LOGGING=1,t.SUMMARY_LOGGING=2,t.DETAILED_LOGGING=3,t.OnPluginActivatedObservable=W},11420:(G,D,N)=>{"use strict";N.d(D,{d:()=>T});class T{static get ForceFullSceneLoadingForIncremental(){return T._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(G){T._ForceFullSceneLoadingForIncremental=G}static get ShowLoadingScreen(){return T._ShowLoadingScreen}static set ShowLoadingScreen(G){T._ShowLoadingScreen=G}static get loggingLevel(){return T._LoggingLevel}static set loggingLevel(G){T._LoggingLevel=G}static get CleanBoneMatrixWeights(){return T._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(G){T._CleanBoneMatrixWeights=G}}T._ForceFullSceneLoadingForIncremental=!1,T._ShowLoadingScreen=!0,T._CleanBoneMatrixWeights=!1,T._LoggingLevel=0},11744:(G,D,N)=>{"use strict";N.d(D,{c:()=>Q});var T=N(980),o=N(985),Z=N(1105),n=N(1210),C=N(11740),P=N(1218),r=N(1009),v=N(1255),q=N(1385),g=N(1407);class X extends q.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class W extends g.d{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(G,"PBRBRDF",90,new X,D),this._useEnergyConservation=W.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=W.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=W.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=W.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=W.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=W.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=W.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=W.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=G._dirtyCallbacks[16],this._enable(!0)}prepareDefines(G){G.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,G.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,G.SPHERICAL_HARMONICS=this._useSphericalHarmonics,G.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}W.DEFAULT_USE_ENERGY_CONSERVATION=!0,W.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,W.DEFAULT_USE_SPHERICAL_HARMONICS=!0,W.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsMiscDirty")],W.prototype,"useEnergyConservation",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsMiscDirty")],W.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsMiscDirty")],W.prototype,"useSphericalHarmonics",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsMiscDirty")],W.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var j=N(1324),Y=N(1185),y=N(1233),h=N(1329),m=N(1387),R=N(978),L=N(1390),w=(N(10329),N(1395)),B=N(1374);class F extends q.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class S extends g.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(G,"PBRClearCoat",100,new F,D),this._isEnabled=!1,this.isEnabled=!1,this.jj=1,this.roughness=0,this._indexOfRefraction=S._DefaultIndexOfRefraction,this.indexOfRefraction=S._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=Y.d.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=G._dirtyCallbacks[1]}isReadyForSubMesh(G,D,N){if(!this._isEnabled)return!0;const T=this._material._disableBumpMap;if(G._areTexturesDirty&&D.texturesEnabled){if(this._texture&&L.d.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&L.d.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(N.getCaps().standardDerivatives&&this._bumpTexture&&L.d.ClearCoatBumpTextureEnabled&&!T&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&L.d.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(G,D){this._isEnabled?(G.CLEARCOAT=!0,G.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,G.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,G._areTexturesDirty&&D.texturesEnabled&&(this._texture&&L.d.ClearCoatTextureEnabled?(0,B.R)(this._texture,G,"CLEARCOAT_TEXTURE"):G.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&L.d.ClearCoatTextureEnabled?(0,B.R)(this._textureRoughness,G,"CLEARCOAT_TEXTURE_ROUGHNESS"):G.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&L.d.ClearCoatBumpTextureEnabled?(0,B.R)(this._bumpTexture,G,"CLEARCOAT_BUMP"):G.CLEARCOAT_BUMP=!1,G.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===S._DefaultIndexOfRefraction,this._isTintEnabled?(G.CLEARCOAT_TINT=!0,this._tintTexture&&L.d.ClearCoatTintTextureEnabled?((0,B.R)(this._tintTexture,G,"CLEARCOAT_TINT_TEXTURE"),G.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):G.CLEARCOAT_TINT_TEXTURE=!1):(G.CLEARCOAT_TINT=!1,G.CLEARCOAT_TINT_TEXTURE=!1))):(G.CLEARCOAT=!1,G.CLEARCOAT_TEXTURE=!1,G.CLEARCOAT_TEXTURE_ROUGHNESS=!1,G.CLEARCOAT_BUMP=!1,G.CLEARCOAT_TINT=!1,G.CLEARCOAT_TINT_TEXTURE=!1,G.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,G.CLEARCOAT_DEFAULTIOR=!1,G.CLEARCOAT_TEXTUREDIRECTUV=0,G.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,G.CLEARCOAT_BUMPDIRECTUV=0,G.CLEARCOAT_REMAP_F0=!1,G.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,G.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(G,D,N,T){if(!this._isEnabled)return;const o=T.materialDefines,Z=this._material.isFrozen,n=this._material._disableBumpMap,C=this._material._invertNormalMapX,P=this._material._invertNormalMapY;if(!G.useUbo||!Z||!G.isSync){var r,v,q,g;if((this._texture||this._textureRoughness)&&L.d.ClearCoatTextureEnabled)G.updateFloat4("vClearCoatInfos",(null===(r=this._texture)||void 0===r?void 0:r.coordinatesIndex)??0,(null===(v=this._texture)||void 0===v?void 0:v.level)??0,(null===(q=this._textureRoughness)||void 0===q?void 0:q.coordinatesIndex)??0,(null===(g=this._textureRoughness)||void 0===g?void 0:g.level)??0),this._texture&&(0,B.p)(this._texture,G,"clearCoat"),this._textureRoughness&&!o.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,B.p)(this._textureRoughness,G,"clearCoatRoughness");this._bumpTexture&&N.getCaps().standardDerivatives&&L.d.ClearCoatTextureEnabled&&!n&&(G.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,B.p)(this._bumpTexture,G,"clearCoatBump"),D._mirroredCameraPosition?G.updateFloat2("vClearCoatTangentSpaceParams",C?1:-1,P?1:-1):G.updateFloat2("vClearCoatTangentSpaceParams",C?-1:1,P?-1:1)),this._tintTexture&&L.d.ClearCoatTintTextureEnabled&&(G.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,B.p)(this._tintTexture,G,"clearCoatTint")),G.updateFloat2("vClearCoatParams",this.jj,this.roughness);const T=1-this._indexOfRefraction,Z=1+this._indexOfRefraction,X=Math.pow(-T/Z,2),W=1/this._indexOfRefraction;G.updateFloat4("vClearCoatRefractionParams",X,W,T,Z),this._isTintEnabled&&(G.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),G.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}D.texturesEnabled&&(this._texture&&L.d.ClearCoatTextureEnabled&&G.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!o.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&L.d.ClearCoatTextureEnabled&&G.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&N.getCaps().standardDerivatives&&L.d.ClearCoatBumpTextureEnabled&&!n&&G.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&L.d.ClearCoatTintTextureEnabled&&G.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(G){return this._texture===G||(this._textureRoughness===G||(this._bumpTexture===G||this._tintTexture===G))}getActiveTextures(G){this._texture&&G.push(this._texture),this._textureRoughness&&G.push(this._textureRoughness),this._bumpTexture&&G.push(this._bumpTexture),this._tintTexture&&G.push(this._tintTexture)}getAnimatables(G){this._texture&&this._texture.animations&&this._texture.animations.length>0&&G.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&G.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&G.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&G.push(this._tintTexture)}dispose(G){var D,N,T,o;G&&(null===(D=this._texture)||void 0===D||D.dispose(),null===(N=this._textureRoughness)||void 0===N||N.dispose(),null===(T=this._bumpTexture)||void 0===T||T.dispose(),null===(o=this._tintTexture)||void 0===o||o.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(G,D,N){return G.CLEARCOAT_BUMP&&D.addFallback(N++,"CLEARCOAT_BUMP"),G.CLEARCOAT_TINT&&D.addFallback(N++,"CLEARCOAT_TINT"),G.CLEARCOAT&&D.addFallback(N++,"CLEARCOAT"),N}getSamplers(G){G.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}S._DefaultIndexOfRefraction=1.5,(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"isEnabled",void 0),(0,T.c)([(0,o.S)()],S.prototype,"intensity",void 0),(0,T.c)([(0,o.S)()],S.prototype,"roughness",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"indexOfRefraction",void 0),(0,T.c)([(0,o.G)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"texture",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRoughnessFromMainTexture",void 0),(0,T.c)([(0,o.G)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"textureRoughness",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"remapF0OnInterfaceChange",void 0),(0,T.c)([(0,o.G)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"bumpTexture",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"isTintEnabled",void 0),(0,T.c)([(0,o.m)()],S.prototype,"tintColor",void 0),(0,T.c)([(0,o.S)()],S.prototype,"tintColorAtDistance",void 0),(0,T.c)([(0,o.S)()],S.prototype,"tintThickness",void 0),(0,T.c)([(0,o.G)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"tintTexture",void 0);class V extends q.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class U extends g.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(G,"PBRIridescence",110,new V,D),this._isEnabled=!1,this.isEnabled=!1,this.jj=1,this.minimumThickness=U._DefaultMinimumThickness,this.maximumThickness=U._DefaultMaximumThickness,this.indexOfRefraction=U._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=G._dirtyCallbacks[1]}isReadyForSubMesh(G,D){if(!this._isEnabled)return!0;if(G._areTexturesDirty&&D.texturesEnabled){if(this._texture&&L.d.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&L.d.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(G,D){this._isEnabled?(G.IRIDESCENCE=!0,G._areTexturesDirty&&D.texturesEnabled&&(this._texture&&L.d.IridescenceTextureEnabled?(0,B.R)(this._texture,G,"IRIDESCENCE_TEXTURE"):G.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&L.d.IridescenceTextureEnabled?(0,B.R)(this._thicknessTexture,G,"IRIDESCENCE_THICKNESS_TEXTURE"):G.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(G.IRIDESCENCE=!1,G.IRIDESCENCE_TEXTURE=!1,G.IRIDESCENCE_THICKNESS_TEXTURE=!1,G.IRIDESCENCE_TEXTUREDIRECTUV=0,G.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(G,D){if(!this._isEnabled)return;const N=this._material.isFrozen;if(!G.useUbo||!N||!G.isSync){var T,o,Z,n;if((this._texture||this._thicknessTexture)&&L.d.IridescenceTextureEnabled)G.updateFloat4("vIridescenceInfos",(null===(T=this._texture)||void 0===T?void 0:T.coordinatesIndex)??0,(null===(o=this._texture)||void 0===o?void 0:o.level)??0,(null===(Z=this._thicknessTexture)||void 0===Z?void 0:Z.coordinatesIndex)??0,(null===(n=this._thicknessTexture)||void 0===n?void 0:n.level)??0),this._texture&&(0,B.p)(this._texture,G,"iridescence"),this._thicknessTexture&&(0,B.p)(this._thicknessTexture,G,"iridescenceThickness");G.updateFloat4("vIridescenceParams",this.jj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}D.texturesEnabled&&(this._texture&&L.d.IridescenceTextureEnabled&&G.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&L.d.IridescenceTextureEnabled&&G.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(G){return this._texture===G||this._thicknessTexture===G}getActiveTextures(G){this._texture&&G.push(this._texture),this._thicknessTexture&&G.push(this._thicknessTexture)}getAnimatables(G){this._texture&&this._texture.animations&&this._texture.animations.length>0&&G.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&G.push(this._thicknessTexture)}dispose(G){var D,N;G&&(null===(D=this._texture)||void 0===D||D.dispose(),null===(N=this._thicknessTexture)||void 0===N||N.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(G,D,N){return G.IRIDESCENCE&&D.addFallback(N++,"IRIDESCENCE"),N}getSamplers(G){G.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}U._DefaultMinimumThickness=100,U._DefaultMaximumThickness=400,U._DefaultIndexOfRefraction=1.3,(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"isEnabled",void 0),(0,T.c)([(0,o.S)()],U.prototype,"intensity",void 0),(0,T.c)([(0,o.S)()],U.prototype,"minimumThickness",void 0),(0,T.c)([(0,o.S)()],U.prototype,"maximumThickness",void 0),(0,T.c)([(0,o.S)()],U.prototype,"indexOfRefraction",void 0),(0,T.c)([(0,o.G)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"texture",void 0),(0,T.c)([(0,o.G)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],U.prototype,"thicknessTexture",void 0);class z extends q.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class i extends g.d{set angle(G){this.direction.x=Math.cos(G),this.direction.y=Math.sin(G)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(G,"PBRAnisotropic",110,new z,D),this._isEnabled=!1,this.isEnabled=!1,this.jj=1,this.direction=new r.o(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=G._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=G._dirtyCallbacks[16]}isReadyForSubMesh(G,D){return!this._isEnabled||!(G._areTexturesDirty&&D.texturesEnabled&&this._texture&&L.d.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(G,D,N){this._isEnabled?(G.ANISOTROPIC=this._isEnabled,this._isEnabled&&!N.isVerticesDataPresent(v.f.TangentKind)&&(G._needUVs=!0,G.MAINUV1=!0),G._areTexturesDirty&&D.texturesEnabled&&(this._texture&&L.d.AnisotropicTextureEnabled?(0,B.R)(this._texture,G,"ANISOTROPIC_TEXTURE"):G.ANISOTROPIC_TEXTURE=!1),G._areMiscDirty&&(G.ANISOTROPIC_LEGACY=this._legacy)):(G.ANISOTROPIC=!1,G.ANISOTROPIC_TEXTURE=!1,G.ANISOTROPIC_TEXTUREDIRECTUV=0,G.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(G,D){if(!this._isEnabled)return;const N=this._material.isFrozen;G.useUbo&&N&&G.isSync||(this._texture&&L.d.AnisotropicTextureEnabled&&(G.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,B.p)(this._texture,G,"anisotropy")),G.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.jj)),D.texturesEnabled&&this._texture&&L.d.AnisotropicTextureEnabled&&G.setTexture("anisotropySampler",this._texture)}hasTexture(G){return this._texture===G}getActiveTextures(G){this._texture&&G.push(this._texture)}getAnimatables(G){this._texture&&this._texture.animations&&this._texture.animations.length>0&&G.push(this._texture)}dispose(G){G&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(G,D,N){return G.ANISOTROPIC&&D.addFallback(N++,"ANISOTROPIC"),N}getSamplers(G){G.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(G,D,N){super.parse(G,D,N),void 0===G.legacy&&(this.legacy=!0)}}(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),(0,T.c)([(0,o.S)()],i.prototype,"intensity",void 0),(0,T.c)([(0,o.K)()],i.prototype,"direction",void 0),(0,T.c)([(0,o.G)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsMiscDirty")],i.prototype,"legacy",void 0);class J extends q.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class p extends g.d{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(G,"Sheen",120,new J,D),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.jj=1,this.color=Y.d.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=G._dirtyCallbacks[1]}isReadyForSubMesh(G,D){if(!this._isEnabled)return!0;if(G._areTexturesDirty&&D.texturesEnabled){if(this._texture&&L.d.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&L.d.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(G,D){this._isEnabled?(G.SHEEN=!0,G.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,G.SHEEN_ROUGHNESS=null!==this._roughness,G.SHEEN_ALBEDOSCALING=this._albedoScaling,G.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,G._areTexturesDirty&&D.texturesEnabled&&(this._texture&&L.d.SheenTextureEnabled?((0,B.R)(this._texture,G,"SHEEN_TEXTURE"),G.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):G.SHEEN_TEXTURE=!1,this._textureRoughness&&L.d.SheenTextureEnabled?(0,B.R)(this._textureRoughness,G,"SHEEN_TEXTURE_ROUGHNESS"):G.SHEEN_TEXTURE_ROUGHNESS=!1)):(G.SHEEN=!1,G.SHEEN_TEXTURE=!1,G.SHEEN_TEXTURE_ROUGHNESS=!1,G.SHEEN_LINKWITHALBEDO=!1,G.SHEEN_ROUGHNESS=!1,G.SHEEN_ALBEDOSCALING=!1,G.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,G.SHEEN_GAMMATEXTURE=!1,G.SHEEN_TEXTUREDIRECTUV=0,G.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(G,D,N,T){if(!this._isEnabled)return;const o=T.materialDefines,Z=this._material.isFrozen;if(!G.useUbo||!Z||!G.isSync){var n,C,P,r;if((this._texture||this._textureRoughness)&&L.d.SheenTextureEnabled)G.updateFloat4("vSheenInfos",(null===(n=this._texture)||void 0===n?void 0:n.coordinatesIndex)??0,(null===(C=this._texture)||void 0===C?void 0:C.level)??0,(null===(P=this._textureRoughness)||void 0===P?void 0:P.coordinatesIndex)??0,(null===(r=this._textureRoughness)||void 0===r?void 0:r.level)??0),this._texture&&(0,B.p)(this._texture,G,"sheen"),this._textureRoughness&&!o.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,B.p)(this._textureRoughness,G,"sheenRoughness");G.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.jj),null!==this._roughness&&G.updateFloat("vSheenRoughness",this._roughness)}D.texturesEnabled&&(this._texture&&L.d.SheenTextureEnabled&&G.setTexture("sheenSampler",this._texture),this._textureRoughness&&!o.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&L.d.SheenTextureEnabled&&G.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(G){return this._texture===G||this._textureRoughness===G}getActiveTextures(G){this._texture&&G.push(this._texture),this._textureRoughness&&G.push(this._textureRoughness)}getAnimatables(G){this._texture&&this._texture.animations&&this._texture.animations.length>0&&G.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&G.push(this._textureRoughness)}dispose(G){var D,N;G&&(null===(D=this._texture)||void 0===D||D.dispose(),null===(N=this._textureRoughness)||void 0===N||N.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(G,D,N){return G.SHEEN&&D.addFallback(N++,"SHEEN"),N}getSamplers(G){G.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],p.prototype,"isEnabled",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],p.prototype,"linkSheenWithAlbedo",void 0),(0,T.c)([(0,o.S)()],p.prototype,"intensity",void 0),(0,T.c)([(0,o.m)()],p.prototype,"color",void 0),(0,T.c)([(0,o.G)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],p.prototype,"texture",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],p.prototype,"useRoughnessFromMainTexture",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],p.prototype,"roughness",void 0),(0,T.c)([(0,o.G)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],p.prototype,"textureRoughness",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],p.prototype,"albedoScaling",void 0);class t extends q.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class H extends g.d{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(G){this._scene.enableSubSurfaceForPrePass()&&G&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(G))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(G){this._volumeIndexOfRefraction=G>=1?G:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(G,"PBRSubSurface",130,new t,D),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=Y.d.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=Y.d.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=G.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=G._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=G._dirtyCallbacks[32]}isReadyForSubMesh(G,D){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(G._areTexturesDirty&&D.texturesEnabled){if(this._thicknessTexture&&L.d.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&L.d.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&L.d.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const G=this._getRefractionTexture(D);if(G&&L.d.RefractionTextureEnabled&&!G.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(G,D){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return G.SUBSURFACE=!1,G.SS_DISPERSION=!1,G.SS_TRANSLUCENCY=!1,G.SS_SCATTERING=!1,G.SS_REFRACTION=!1,G.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,G.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,G.SS_THICKNESSANDMASK_TEXTURE=!1,G.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,G.SS_HAS_THICKNESS=!1,G.SS_REFRACTIONINTENSITY_TEXTURE=!1,G.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,G.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,G.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,G.SS_REFRACTIONMAP_3D=!1,G.SS_REFRACTIONMAP_OPPOSITEZ=!1,G.SS_LODINREFRACTIONALPHA=!1,G.SS_GAMMAREFRACTION=!1,G.SS_RGBDREFRACTION=!1,G.SS_LINEARSPECULARREFRACTION=!1,G.SS_LINKREFRACTIONTOTRANSPARENCY=!1,G.SS_ALBEDOFORREFRACTIONTINT=!1,G.SS_ALBEDOFORTRANSLUCENCYTINT=!1,G.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,G.SS_USE_THICKNESS_AS_DEPTH=!1,G.SS_USE_GLTF_TEXTURES=!1,G.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(G.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(G._areTexturesDirty){if(G.SUBSURFACE=!0,G.SS_DISPERSION=this._isDispersionEnabled,G.SS_TRANSLUCENCY=this._isTranslucencyEnabled,G.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,G.SS_SCATTERING=this._isScatteringEnabled,G.SS_THICKNESSANDMASK_TEXTURE=!1,G.SS_REFRACTIONINTENSITY_TEXTURE=!1,G.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,G.SS_HAS_THICKNESS=!1,G.SS_USE_GLTF_TEXTURES=!1,G.SS_REFRACTION=!1,G.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,G.SS_REFRACTIONMAP_3D=!1,G.SS_GAMMAREFRACTION=!1,G.SS_RGBDREFRACTION=!1,G.SS_LINEARSPECULARREFRACTION=!1,G.SS_REFRACTIONMAP_OPPOSITEZ=!1,G.SS_LODINREFRACTIONALPHA=!1,G.SS_LINKREFRACTIONTOTRANSPARENCY=!1,G.SS_ALBEDOFORREFRACTIONTINT=!1,G.SS_ALBEDOFORTRANSLUCENCYTINT=!1,G.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,G.SS_USE_THICKNESS_AS_DEPTH=!1,G.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,G._areTexturesDirty&&D.texturesEnabled&&(this._thicknessTexture&&L.d.ThicknessTextureEnabled&&(0,B.R)(this._thicknessTexture,G,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&L.d.RefractionIntensityTextureEnabled&&(0,B.R)(this._refractionIntensityTexture,G,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&L.d.TranslucencyIntensityTextureEnabled&&(0,B.R)(this._translucencyIntensityTexture,G,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&L.d.TranslucencyColorTextureEnabled&&(0,B.R)(this._translucencyColorTexture,G,"SS_TRANSLUCENCYCOLOR_TEXTURE")),G.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,G.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,G.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,G.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&D.texturesEnabled){const N=this._getRefractionTexture(D);N&&L.d.RefractionTextureEnabled&&(G.SS_REFRACTION=!0,G.SS_REFRACTIONMAP_3D=N.isCube,G.SS_GAMMAREFRACTION=N.gammaSpace,G.SS_RGBDREFRACTION=N.isRGBD,G.SS_LINEARSPECULARREFRACTION=N.linearSpecularLOD,G.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&N.isCube?!N.invertZ:N.invertZ,G.SS_LODINREFRACTIONALPHA=N.lodLevelInAlpha,G.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,G.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,G.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=N.isCube&&N.boundingBoxSize,G.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(G.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(G,D,N,T){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)G.updateFloat2("vThicknessParam",0,0);else{T.getRenderingMesh().getWorldMatrix().decompose(r.k.Ad[0]);const D=Math.max(Math.abs(r.k.Ad[0].x),Math.abs(r.k.Ad[0].y),Math.abs(r.k.Ad[0].z));G.updateFloat2("vThicknessParam",this.minimumThickness*D,(this.maximumThickness-this.minimumThickness)*D)}}bindForSubMesh(G,D,N,T){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const o=T.materialDefines,Z=this._material.isFrozen,n=this._material.realTimeFiltering,C=o.LODBASEDMICROSFURACE,P=this._getRefractionTexture(D);if(!G.useUbo||!Z||!G.isSync){if(this._thicknessTexture&&L.d.ThicknessTextureEnabled&&(G.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,B.p)(this._thicknessTexture,G,"thickness")),this._refractionIntensityTexture&&L.d.RefractionIntensityTextureEnabled&&o.SS_REFRACTIONINTENSITY_TEXTURE&&(G.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,B.p)(this._refractionIntensityTexture,G,"refractionIntensity")),this._translucencyColorTexture&&L.d.TranslucencyColorTextureEnabled&&o.SS_TRANSLUCENCYCOLOR_TEXTURE&&(G.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,B.p)(this._translucencyColorTexture,G,"translucencyColor")),this._translucencyIntensityTexture&&L.d.TranslucencyIntensityTextureEnabled&&o.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(G.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,B.p)(this._translucencyIntensityTexture,G,"translucencyIntensity")),P&&L.d.RefractionTextureEnabled){G.Rd("refractionMatrix",P.getRefractionTextureMatrix());let D=1;P.isCube||P.depth&&(D=P.depth);const N=P.getSize().width,T=this.volumeIndexOfRefraction;if(G.updateFloat4("vRefractionInfos",P.level,1/T,D,this._invertRefractionY?-1:1),G.updateFloat4("vRefractionMicrosurfaceInfos",N,P.lodGenerationScale,P.lodGenerationOffset,1/this.indexOfRefraction),n&&G.updateFloat2("vRefractionFilteringInfo",N,Math.log2(N)),P.boundingBoxSize){const D=P;G.updateVector3("vRefractionPosition",D.boundingBoxPosition),G.updateVector3("vRefractionSize",D.boundingBoxSize)}}this._isScatteringEnabled&&G.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),G.updateColor3("vDiffusionDistance",this.diffusionDistance),G.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),G.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),G.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),G.updateFloat("dispersion",this.dispersion)}D.texturesEnabled&&(this._thicknessTexture&&L.d.ThicknessTextureEnabled&&G.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&L.d.RefractionIntensityTextureEnabled&&o.SS_REFRACTIONINTENSITY_TEXTURE&&G.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&L.d.TranslucencyIntensityTextureEnabled&&o.SS_TRANSLUCENCYINTENSITY_TEXTURE&&G.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&L.d.TranslucencyColorTextureEnabled&&o.SS_TRANSLUCENCYCOLOR_TEXTURE&&G.setTexture("translucencyColorSampler",this._translucencyColorTexture),P&&L.d.RefractionTextureEnabled&&(C?G.setTexture("refractionSampler",P):(G.setTexture("refractionSampler",P._lodTextureMid||P),G.setTexture("refractionSamplerLow",P._lodTextureLow||P),G.setTexture("refractionSamplerHigh",P._lodTextureHigh||P))))}_getRefractionTexture(G){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?G.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(G){L.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&G.push(this._refractionTexture)}hasTexture(G){return this._thicknessTexture===G||(this._refractionTexture===G||(this._refractionIntensityTexture===G||(this._translucencyIntensityTexture===G||this._translucencyColorTexture===G)))}hasRenderTargetTextures(){return!!(L.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(G){this._thicknessTexture&&G.push(this._thicknessTexture),this._refractionTexture&&G.push(this._refractionTexture),this._translucencyColorTexture&&G.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&G.push(this._translucencyIntensityTexture)}getAnimatables(G){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&G.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&G.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&G.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&G.push(this._translucencyIntensityTexture)}dispose(G){G&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(G,D,N){return G.SS_SCATTERING&&D.addFallback(N++,"SS_SCATTERING"),G.SS_TRANSLUCENCY&&D.addFallback(N++,"SS_TRANSLUCENCY"),N}getSamplers(G){G.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"isRefractionEnabled",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"isTranslucencyEnabled",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"isDispersionEnabled",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markScenePrePassDirty")],H.prototype,"isScatteringEnabled",void 0),(0,T.c)([(0,o.S)()],H.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,T.c)([(0,o.S)()],H.prototype,"refractionIntensity",void 0),(0,T.c)([(0,o.S)()],H.prototype,"translucencyIntensity",void 0),(0,T.c)([(0,o.S)()],H.prototype,"useAlbedoToTintRefraction",void 0),(0,T.c)([(0,o.S)()],H.prototype,"useAlbedoToTintTranslucency",void 0),(0,T.c)([(0,o.G)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"thicknessTexture",void 0),(0,T.c)([(0,o.G)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"refractionTexture",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"indexOfRefraction",void 0),(0,T.c)([(0,o.S)()],H.prototype,"_volumeIndexOfRefraction",void 0),(0,T.c)([(0,o.e)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"volumeIndexOfRefraction",null),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"invertRefractionY",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"linkRefractionWithTransparency",void 0),(0,T.c)([(0,o.S)()],H.prototype,"minimumThickness",void 0),(0,T.c)([(0,o.S)()],H.prototype,"maximumThickness",void 0),(0,T.c)([(0,o.S)()],H.prototype,"useThicknessAsDepth",void 0),(0,T.c)([(0,o.m)()],H.prototype,"tintColor",void 0),(0,T.c)([(0,o.S)()],H.prototype,"tintColorAtDistance",void 0),(0,T.c)([(0,o.S)()],H.prototype,"dispersion",void 0),(0,T.c)([(0,o.m)()],H.prototype,"diffusionDistance",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"useMaskFromThicknessTexture",void 0),(0,T.c)([(0,o.G)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"refractionIntensityTexture",void 0),(0,T.c)([(0,o.G)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"translucencyIntensityTexture",void 0),(0,T.c)([(0,o.m)()],H.prototype,"translucencyColor",void 0),(0,T.c)([(0,o.G)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"translucencyColorTexture",void 0),(0,T.c)([(0,o.S)(),(0,o.e)("_markAllSubMeshesAsTexturesDirty")],H.prototype,"useGltfStyleTextures",void 0);var s=N(1403),c=N(1380),K=N(1416);const b={effect:null,subMesh:null};class O extends q.d{constructor(G){super(G),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class Q extends m.d{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(G){this._realTimeFiltering=G,this.we(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(G){this._realTimeFilteringQuality=G,this.we(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(G){G!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=G||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(G,D){super(G,D,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||Q.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new r.v(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=Q.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=Y.d.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new Y.d(0,0,0),this._albedoColor=new Y.d(1,1,1),this._reflectivityColor=new Y.d(1,1,1),this._reflectionColor=new Y.d(1,1,1),this._emissiveColor=new Y.d(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=Q.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new n.e(16),this._globalAmbientColor=new Y.d(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new W(this),this.clearCoat=new S(this),this.iridescence=new U(this),this.anisotropy=new i(this),this.sheen=new p(this),this.subSurface=new H(this),this.detailMap=new s.c(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),L.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,C.b)(this.va()),this.prePassConfiguration=new j.e}get hasRenderTargetTextures(){return!!(L.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var G;return this._transparencyMode===Q.PBRMATERIAL_OPAQUE||this._transparencyMode===Q.PBRMATERIAL_ALPHATEST||(null===(G=this.subSurface)||void 0===G?void 0:G.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var G;return!!this._forceAlphaTest||(null===(G=this.subSurface)||void 0===G||!G.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===Q.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.jd&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==Q.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.jd||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(G,D,N){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const T=D._drawWrapper;if(T.effect&&this.isFrozen&&T._wasPreviouslyReady&&T._wasPreviouslyUsingInstances===N)return!0;D.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),D.materialDefines=new O(this._eventInfo.defineNames));const o=D.materialDefines;if(this._isReadyForSubMesh(D))return!0;const n=this.va(),C=n.getEngine();if(o._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,n.texturesEnabled)){if(this._albedoTexture&&L.d.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&L.d.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&L.d.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const G=this._getReflectionTexture();if(G&&L.d.ReflectionTextureEnabled){if(!G.isReadyOrNotBlocking())return!1;var P;if(G.irradianceTexture){if(!G.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!G.sphericalPolynomial&&null!==(P=G.getInternalTexture())&&void 0!==P&&P._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&L.d.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&L.d.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(L.d.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(C.getCaps().standardDerivatives&&this._bumpTexture&&L.d.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&L.d.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=o,this._eventInfo.subMesh=D,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(o._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;C.getCaps().standardDerivatives||G.isVerticesDataPresent(v.f.NormalKind)||(G.createNormals(!0),Z.d.Warn("PBRMaterial: Normals have been created for the mesh: "+G.name));const r=D.effect,q=o._areLightsDisposed;let g=this._prepareEffect(G,o,this.onCompiled,this.onError,N,null,D.getRenderingMesh().hasThinInstances),X=!1;if(g)if(this._onEffectCreatedObservable&&(b.effect=g,b.subMesh=D,this._onEffectCreatedObservable.notifyObservers(b)),this.allowShaderHotSwapping&&r&&!g.isReady()){if(g=r,o.markAsUnprocessed(),X=this.isFrozen,q)return o._areLightsDisposed=!0,!1}else n.resetCachedMaterial(),D.setEffect(g,o,this._materialContext);return!(!D.effect||!D.effect.isReady())&&(o._renderId=n.getRenderId(),T._wasPreviouslyReady=!X,T._wasPreviouslyUsingInstances=!!N,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(G,D){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(G,D,Z,n,C),!D.isDirty)return null;D.markAsProcessed();const P=this.va().getEngine(),r=new w.e;let q=0;D.USESPHERICALINVERTEX&&r.addFallback(q++,"USESPHERICALINVERTEX"),D.FOG&&r.addFallback(q,"FOG"),D.SPECULARAA&&r.addFallback(q,"SPECULARAA"),D.POINTSIZE&&r.addFallback(q,"POINTSIZE"),D.LOGARITHMICDEPTH&&r.addFallback(q,"LOGARITHMICDEPTH"),D.PARALLAX&&r.addFallback(q,"PARALLAX"),D.PARALLAX_RHS&&r.addFallback(q,"PARALLAX_RHS"),D.PARALLAXOCCLUSION&&r.addFallback(q++,"PARALLAXOCCLUSION"),D.ENVIRONMENTBRDF&&r.addFallback(q++,"ENVIRONMENTBRDF"),D.TANGENT&&r.addFallback(q++,"TANGENT"),D.BUMP&&r.addFallback(q++,"BUMP"),q=(0,B.t)(D,r,this._maxSimultaneousLights,q++),D.SPECULARTERM&&r.addFallback(q++,"SPECULARTERM"),D.USESPHERICALFROMREFLECTIONMAP&&r.addFallback(q++,"USESPHERICALFROMREFLECTIONMAP"),D.USEIRRADIANCEMAP&&r.addFallback(q++,"USEIRRADIANCEMAP"),D.LIGHTMAP&&r.addFallback(q++,"LIGHTMAP"),D.NORMAL&&r.addFallback(q++,"NORMAL"),D.AMBIENT&&r.addFallback(q++,"AMBIENT"),D.EMISSIVE&&r.addFallback(q++,"EMISSIVE"),D.VERTEXCOLOR&&r.addFallback(q++,"VERTEXCOLOR"),D.MORPHTARGETS&&r.addFallback(q++,"MORPHTARGETS"),D.MULTIVIEW&&r.addFallback(0,"MULTIVIEW");const g=[v.f.PositionKind];D.NORMAL&&g.push(v.f.NormalKind),D.TANGENT&&g.push(v.f.TangentKind);for(let N=1;N<=6;++N)D["UV"+N]&&g.push(`uv${1===N?"":N}`);D.VERTEXCOLOR&&g.push(v.f.ColorKind),(0,B.B)(g,G,D,r),(0,B.F)(g,D),(0,B.I)(g,G,D),(0,B.x)(g,G,D);let X="pbr";const W=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],Y=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],h=["Material","Scene","Mesh"],m={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:D.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=r,this._eventInfo.fallbackRank=q,this._eventInfo.defines=D,this._eventInfo.uniforms=W,this._eventInfo.attributes=g,this._eventInfo.samplers=Y,this._eventInfo.uniformBuffersNames=h,this._eventInfo.customCode=void 0,this._eventInfo.mesh=G,this._eventInfo.indexParameters=m,this._callbackPluginEventGeneric(128,this._eventInfo),K.c.AddUniformsAndSamplers(W,Y),j.e.AddUniforms(W),j.e.AddSamplers(Y),(0,c.e)(W),y.b&&(y.b.PrepareUniforms(W,D),y.b.PrepareSamplers(Y,D)),(0,B.$)({uniformsNames:W,uniformBuffersNames:h,samplers:Y,defines:D,maxSimultaneousLights:this._maxSimultaneousLights});const R={};this.customShaderNameResolve&&(X=this.customShaderNameResolve(X,W,h,Y,D,g,R));const L=D.toString(),F=P.createEffect(X,{attributes:g,uniformsNames:W,uniformBuffersNames:h,samplers:Y,defines:L,fallbacks:r,onCompiled:T,onError:o,indexParameters:m,processFinalCode:R.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:D.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([N.e(15),N.e(44)]).then(N.bind(N,12343)),Promise.all([N.e(16),N.e(45)]).then(N.bind(N,12359))]):await Promise.all([Promise.all([N.e(21),N.e(46)]).then(N.bind(N,12367)),Promise.all([N.e(23),N.e(47)]).then(N.bind(N,12393))]),this._shadersLoaded=!0}},P);return this._eventInfo.customCode=void 0,F}_prepareDefines(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const Z=this.va(),n=Z.getEngine();(0,B.P)(Z,G,D,!0,this._maxSimultaneousLights,this._disableLighting),D._needNormals=!0,(0,B.W)(Z,D);const C=this.needAlphaBlendingForMesh(G)&&this.va().useOrderIndependentTransparency;if((0,B._)(Z,D,this.canRenderToMRT&&!C),(0,B.X)(Z,D,C),K.c.PrepareDefines(n.currentRenderPassId,G,D),D.METALLICWORKFLOW=this.isMetallicWorkflow(),D._areTexturesDirty){D._needUVs=!1;for(let G=1;G<=6;++G)D["MAINUV"+G]=!1;if(Z.texturesEnabled){D.ALBEDODIRECTUV=0,D.AMBIENTDIRECTUV=0,D.OPACITYDIRECTUV=0,D.EMISSIVEDIRECTUV=0,D.REFLECTIVITYDIRECTUV=0,D.MICROSURFACEMAPDIRECTUV=0,D.METALLIC_REFLECTANCEDIRECTUV=0,D.REFLECTANCEDIRECTUV=0,D.BUMPDIRECTUV=0,D.LIGHTMAPDIRECTUV=0,n.getCaps().textureLOD&&(D.LODBASEDMICROSFURACE=!0),this._albedoTexture&&L.d.DiffuseTextureEnabled?((0,B.R)(this._albedoTexture,D,"ALBEDO"),D.GAMMAALBEDO=this._albedoTexture.gammaSpace):D.ALBEDO=!1,this._ambientTexture&&L.d.AmbientTextureEnabled?((0,B.R)(this._ambientTexture,D,"AMBIENT"),D.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):D.AMBIENT=!1,this._opacityTexture&&L.d.OpacityTextureEnabled?((0,B.R)(this._opacityTexture,D,"OPACITY"),D.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):D.OPACITY=!1;const G=this._getReflectionTexture();if(G&&L.d.ReflectionTextureEnabled){switch(D.REFLECTION=!0,D.GAMMAREFLECTION=G.gammaSpace,D.RGBDREFLECTION=G.isRGBD,D.LODINREFLECTIONALPHA=G.lodLevelInAlpha,D.LINEARSPECULARREFLECTION=G.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(D.NUM_SAMPLES=""+this.realTimeFilteringQuality,n._features.needTypeSuffixInShaderConstants&&(D.NUM_SAMPLES=D.NUM_SAMPLES+"u"),D.REALTIME_FILTERING=!0):D.REALTIME_FILTERING=!1,D.INVERTCUBICMAP=G.coordinatesMode===R.e.INVCUBIC_MODE,D.REFLECTIONMAP_3D=G.isCube,D.REFLECTIONMAP_OPPOSITEZ=D.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!G.invertZ:G.invertZ,D.REFLECTIONMAP_CUBIC=!1,D.REFLECTIONMAP_EXPLICIT=!1,D.REFLECTIONMAP_PLANAR=!1,D.REFLECTIONMAP_PROJECTION=!1,D.REFLECTIONMAP_SKYBOX=!1,D.REFLECTIONMAP_SPHERICAL=!1,D.REFLECTIONMAP_EQUIRECTANGULAR=!1,D.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,D.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,G.coordinatesMode){case R.e.EXPLICIT_MODE:D.REFLECTIONMAP_EXPLICIT=!0;break;case R.e.PLANAR_MODE:D.REFLECTIONMAP_PLANAR=!0;break;case R.e.PROJECTION_MODE:D.REFLECTIONMAP_PROJECTION=!0;break;case R.e.SKYBOX_MODE:D.REFLECTIONMAP_SKYBOX=!0;break;case R.e.SPHERICAL_MODE:D.REFLECTIONMAP_SPHERICAL=!0;break;case R.e.EQUIRECTANGULAR_MODE:D.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case R.e.FIXED_EQUIRECTANGULAR_MODE:D.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case R.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:D.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case R.e.CUBIC_MODE:case R.e.INVCUBIC_MODE:default:D.REFLECTIONMAP_CUBIC=!0,D.USE_LOCAL_REFLECTIONMAP_CUBIC=!!G.boundingBoxSize}G.coordinatesMode!==R.e.SKYBOX_MODE&&(G.irradianceTexture?(D.USEIRRADIANCEMAP=!0,D.USESPHERICALFROMREFLECTIONMAP=!1):G.isCube&&(D.USESPHERICALFROMREFLECTIONMAP=!0,D.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||n.getCaps().maxVaryingVectors<=8?D.USESPHERICALINVERTEX=!1:D.USESPHERICALINVERTEX=!0))}else D.REFLECTION=!1,D.REFLECTIONMAP_3D=!1,D.REFLECTIONMAP_SPHERICAL=!1,D.REFLECTIONMAP_PLANAR=!1,D.REFLECTIONMAP_CUBIC=!1,D.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,D.REFLECTIONMAP_PROJECTION=!1,D.REFLECTIONMAP_SKYBOX=!1,D.REFLECTIONMAP_EXPLICIT=!1,D.REFLECTIONMAP_EQUIRECTANGULAR=!1,D.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,D.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,D.INVERTCUBICMAP=!1,D.USESPHERICALFROMREFLECTIONMAP=!1,D.USEIRRADIANCEMAP=!1,D.USESPHERICALINVERTEX=!1,D.REFLECTIONMAP_OPPOSITEZ=!1,D.LODINREFLECTIONALPHA=!1,D.GAMMAREFLECTION=!1,D.RGBDREFLECTION=!1,D.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&L.d.LightmapTextureEnabled?((0,B.R)(this._lightmapTexture,D,"LIGHTMAP"),D.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,D.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,D.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):D.LIGHTMAP=!1,this._emissiveTexture&&L.d.EmissiveTextureEnabled?((0,B.R)(this._emissiveTexture,D,"EMISSIVE"),D.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):D.EMISSIVE=!1,L.d.SpecularTextureEnabled?(this._metallicTexture?((0,B.R)(this._metallicTexture,D,"REFLECTIVITY"),D.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,D.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,D.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,D.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,D.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,B.R)(this._reflectivityTexture,D,"REFLECTIVITY"),D.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,D.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,D.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):D.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(D.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,B.R)(this._metallicReflectanceTexture,D,"METALLIC_REFLECTANCE"),D.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):D.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,B.R)(this._reflectanceTexture,D,"REFLECTANCE"),D.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):D.REFLECTANCE=!1):(D.METALLIC_REFLECTANCE=!1,D.REFLECTANCE=!1),this._microSurfaceTexture?(0,B.R)(this._microSurfaceTexture,D,"MICROSURFACEMAP"):D.MICROSURFACEMAP=!1):(D.REFLECTIVITY=!1,D.MICROSURFACEMAP=!1),n.getCaps().standardDerivatives&&this._bumpTexture&&L.d.BumpTextureEnabled&&!this._disableBumpMap?((0,B.R)(this._bumpTexture,D,"BUMP"),this._useParallax&&this._albedoTexture&&L.d.DiffuseTextureEnabled?(D.PARALLAX=!0,D.PARALLAX_RHS=Z.useRightHandedSystem,D.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):D.PARALLAX=!1,D.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(D.BUMP=!1,D.PARALLAX=!1,D.PARALLAX_RHS=!1,D.PARALLAXOCCLUSION=!1,D.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&L.d.ReflectionTextureEnabled?(D.ENVIRONMENTBRDF=!0,D.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(D.ENVIRONMENTBRDF=!1,D.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?D.ALPHAFROMALBEDO=!0:D.ALPHAFROMALBEDO=!1}D.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===Q.LIGHTFALLOFF_STANDARD?(D.USEPHYSICALLIGHTFALLOFF=!1,D.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===Q.LIGHTFALLOFF_GLTF?(D.USEPHYSICALLIGHTFALLOFF=!1,D.USEGLTFLIGHTFALLOFF=!0):(D.USEPHYSICALLIGHTFALLOFF=!0,D.USEGLTFLIGHTFALLOFF=!1),D.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Ge&&this._twoSidedLighting?D.TWOSIDEDLIGHTING=!0:D.TWOSIDEDLIGHTING=!1,D.SPECULARAA=n.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(D._areTexturesDirty||D._areMiscDirty)&&(D.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,D.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,D.ALPHABLEND=this.needAlphaBlendingForMesh(G),D.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,D.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),D._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(D),D.FORCENORMALFORWARD=this._forceNormalForward,D.RADIANCEOCCLUSION=this._useRadianceOcclusion,D.HORIZONOCCLUSION=this._useHorizonOcclusion,D._areMiscDirty&&((0,B.T)(G,Z,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(G)||this._forceAlphaTest,D,this._applyDecalMapAfterDetailMap),D.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!G.isVerticesDataPresent(v.f.NormalKind),D.DEBUGMODE=this._debugMode),(0,B.O)(Z,n,this,D,!!N,T,o),this._eventInfo.defines=D,this._eventInfo.mesh=G,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,B.K)(G,D,!0,!0,!0,this._transparencyMode!==Q.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(G,D,N){const T={clipPlane:!1,useInstances:!1,...N};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const N=new O(this._eventInfo.defineNames),o=this._prepareEffect(G,N,void 0,void 0,T.useInstances,T.clipPlane,G.hasThinInstances);this._onEffectCreatedObservable&&(b.effect=o,b.subMesh=null,this._onEffectCreatedObservable.notifyObservers(b)),o.isReady()?D&&D(this):o.onCompileObservable.add((()=>{D&&D(this)}))})()}buildUniformLayout(){const G=this._uniformBuffer;G.addUniform("vAlbedoInfos",2),G.addUniform("vAmbientInfos",4),G.addUniform("vOpacityInfos",2),G.addUniform("vEmissiveInfos",2),G.addUniform("vLightmapInfos",2),G.addUniform("vReflectivityInfos",3),G.addUniform("vMicroSurfaceSamplerInfos",2),G.addUniform("vReflectionInfos",2),G.addUniform("vReflectionFilteringInfo",2),G.addUniform("vReflectionPosition",3),G.addUniform("vReflectionSize",3),G.addUniform("vBumpInfos",3),G.addUniform("albedoMatrix",16),G.addUniform("ambientMatrix",16),G.addUniform("opacityMatrix",16),G.addUniform("emissiveMatrix",16),G.addUniform("lightmapMatrix",16),G.addUniform("reflectivityMatrix",16),G.addUniform("microSurfaceSamplerMatrix",16),G.addUniform("bumpMatrix",16),G.addUniform("vTangentSpaceParams",2),G.addUniform("reflectionMatrix",16),G.addUniform("vReflectionColor",3),G.addUniform("vAlbedoColor",4),G.addUniform("vLightingIntensity",4),G.addUniform("vReflectionMicrosurfaceInfos",3),G.addUniform("pointSize",1),G.addUniform("vReflectivityColor",4),G.addUniform("vEmissiveColor",3),G.addUniform("vAmbientColor",3),G.addUniform("vDebugMode",2),G.addUniform("vMetallicReflectanceFactors",4),G.addUniform("vMetallicReflectanceInfos",2),G.addUniform("metallicReflectanceMatrix",16),G.addUniform("vReflectanceInfos",2),G.addUniform("reflectanceMatrix",16),G.addUniform("vSphericalL00",3),G.addUniform("vSphericalL1_1",3),G.addUniform("vSphericalL10",3),G.addUniform("vSphericalL11",3),G.addUniform("vSphericalL2_2",3),G.addUniform("vSphericalL2_1",3),G.addUniform("vSphericalL20",3),G.addUniform("vSphericalL21",3),G.addUniform("vSphericalL22",3),G.addUniform("vSphericalX",3),G.addUniform("vSphericalY",3),G.addUniform("vSphericalZ",3),G.addUniform("vSphericalXX_ZZ",3),G.addUniform("vSphericalYY_ZZ",3),G.addUniform("vSphericalZZ",3),G.addUniform("vSphericalXY",3),G.addUniform("vSphericalYZ",3),G.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(G,D,N){const T=this.va(),o=N.materialDefines;if(!o)return;const Z=N.effect;if(!Z)return;this._activeEffect=Z,D.getMeshUniformBuffer().bindToEffect(Z,"Mesh"),D.transferToEffect(G);const n=T.getEngine();this._uniformBuffer.bindToEffect(Z,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,T,D,G,this.isFrozen),K.c.Bind(n.currentRenderPassId,this._activeEffect,D,G),this._eventInfo.subMesh=N,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),o.OBJECTSPACE_NORMALMAP&&(G.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const C=this._mustRebind(T,Z,N,D.visibility);(0,B.e)(D,this._activeEffect,this.prePassConfiguration);let r=null;const v=this._uniformBuffer;if(C){if(this.bindViewProjection(Z),r=this._getReflectionTexture(),!v.useUbo||!this.isFrozen||!v.isSync||N._drawWrapper._forceRebindOnNextCall){var q;if(T.texturesEnabled){if(this._albedoTexture&&L.d.DiffuseTextureEnabled&&(v.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,B.p)(this._albedoTexture,v,"albedo")),this._ambientTexture&&L.d.AmbientTextureEnabled&&(v.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,B.p)(this._ambientTexture,v,"ambient")),this._opacityTexture&&L.d.OpacityTextureEnabled&&(v.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,B.p)(this._opacityTexture,v,"opacity")),r&&L.d.ReflectionTextureEnabled){if(v.Rd("reflectionMatrix",r.getReflectionTextureMatrix()),v.updateFloat2("vReflectionInfos",r.level,0),r.boundingBoxSize){const G=r;v.updateVector3("vReflectionPosition",G.boundingBoxPosition),v.updateVector3("vReflectionSize",G.boundingBoxSize)}if(this.realTimeFiltering){const G=r.getSize().width;v.updateFloat2("vReflectionFilteringInfo",G,Math.log2(G))}if(!o.USEIRRADIANCEMAP){const G=r.sphericalPolynomial;if(o.USESPHERICALFROMREFLECTIONMAP&&G)if(o.SPHERICAL_HARMONICS){const D=G.preScaledHarmonics;v.updateVector3("vSphericalL00",D.l00),v.updateVector3("vSphericalL1_1",D.l1_1),v.updateVector3("vSphericalL10",D.l10),v.updateVector3("vSphericalL11",D.l11),v.updateVector3("vSphericalL2_2",D.l2_2),v.updateVector3("vSphericalL2_1",D.l2_1),v.updateVector3("vSphericalL20",D.l20),v.updateVector3("vSphericalL21",D.l21),v.updateVector3("vSphericalL22",D.l22)}else v.updateFloat3("vSphericalX",G.x.x,G.x.y,G.x.z),v.updateFloat3("vSphericalY",G.y.x,G.y.y,G.y.z),v.updateFloat3("vSphericalZ",G.z.x,G.z.y,G.z.z),v.updateFloat3("vSphericalXX_ZZ",G.xx.x-G.zz.x,G.xx.y-G.zz.y,G.xx.z-G.zz.z),v.updateFloat3("vSphericalYY_ZZ",G.yy.x-G.zz.x,G.yy.y-G.zz.y,G.yy.z-G.zz.z),v.updateFloat3("vSphericalZZ",G.zz.x,G.zz.y,G.zz.z),v.updateFloat3("vSphericalXY",G.xy.x,G.xy.y,G.xy.z),v.updateFloat3("vSphericalYZ",G.yz.x,G.yz.y,G.yz.z),v.updateFloat3("vSphericalZX",G.zx.x,G.zx.y,G.zx.z)}v.updateFloat3("vReflectionMicrosurfaceInfos",r.getSize().width,r.lodGenerationScale,r.lodGenerationOffset)}this._emissiveTexture&&L.d.EmissiveTextureEnabled&&(v.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,B.p)(this._emissiveTexture,v,"emissive")),this._lightmapTexture&&L.d.LightmapTextureEnabled&&(v.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,B.p)(this._lightmapTexture,v,"lightmap")),L.d.SpecularTextureEnabled&&(this._metallicTexture?(v.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,B.p)(this._metallicTexture,v,"reflectivity")):this._reflectivityTexture&&(v.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,B.p)(this._reflectivityTexture,v,"reflectivity")),this._metallicReflectanceTexture&&(v.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,B.p)(this._metallicReflectanceTexture,v,"metallicReflectance")),this._reflectanceTexture&&o.REFLECTANCE&&(v.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,B.p)(this._reflectanceTexture,v,"reflectance")),this._microSurfaceTexture&&(v.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,B.p)(this._microSurfaceTexture,v,"microSurfaceSampler"))),this._bumpTexture&&n.getCaps().standardDerivatives&&L.d.BumpTextureEnabled&&!this._disableBumpMap&&(v.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,B.p)(this._bumpTexture,v,"bump"),T._mirroredCameraPosition?v.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):v.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&v.updateFloat("pointSize",this.pointSize),o.METALLICWORKFLOW){var g;Y.k.Md[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,Y.k.Md[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,v.updateColor4("vReflectivityColor",Y.k.Md[0],1);const G=(null===(g=this.subSurface)||void 0===g?void 0:g._indexOfRefraction)??1.5,D=1,N=Math.pow((G-D)/(G+D),2);this._metallicReflectanceColor.scaleToRef(N*this._metallicF0Factor,Y.k.Md[0]);const T=this._metallicF0Factor;v.updateColor4("vMetallicReflectanceFactors",Y.k.Md[0],T)}else v.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);v.updateColor3("vEmissiveColor",L.d.EmissiveTextureEnabled?this._emissiveColor:Y.d.BlackReadOnly),v.updateColor3("vReflectionColor",this._reflectionColor),!o.SS_REFRACTION&&null!==(q=this.subSurface)&&void 0!==q&&q._linkRefractionWithTransparency?v.updateColor4("vAlbedoColor",this._albedoColor,1):v.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*T.environmentIntensity,this._lightingInfos.w=this._specularIntensity,v.updateVector4("vLightingIntensity",this._lightingInfos),T.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),v.updateColor3("vAmbientColor",this._globalAmbientColor),v.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}T.texturesEnabled&&(this._albedoTexture&&L.d.DiffuseTextureEnabled&&v.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&L.d.AmbientTextureEnabled&&v.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&L.d.OpacityTextureEnabled&&v.setTexture("opacitySampler",this._opacityTexture),r&&L.d.ReflectionTextureEnabled&&(o.LODBASEDMICROSFURACE?v.setTexture("reflectionSampler",r):(v.setTexture("reflectionSampler",r._lodTextureMid||r),v.setTexture("reflectionSamplerLow",r._lodTextureLow||r),v.setTexture("reflectionSamplerHigh",r._lodTextureHigh||r)),o.USEIRRADIANCEMAP&&v.setTexture("irradianceSampler",r.irradianceTexture)),o.ENVIRONMENTBRDF&&v.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&L.d.EmissiveTextureEnabled&&v.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&L.d.LightmapTextureEnabled&&v.setTexture("lightmapSampler",this._lightmapTexture),L.d.SpecularTextureEnabled&&(this._metallicTexture?v.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&v.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&v.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&o.REFLECTANCE&&v.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&v.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&n.getCaps().standardDerivatives&&L.d.BumpTextureEnabled&&!this._disableBumpMap&&v.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(D)&&this.va().depthPeelingRenderer.bind(Z),this._eventInfo.subMesh=N,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,c.g)(this._activeEffect,this,T),this.bindEyePosition(Z)}else T.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(C||!this.isFrozen){var X;if(T.lightsEnabled&&!this._disableLighting&&(0,B.i)(T,D,this._activeEffect,o,this._maxSimultaneousLights),(T.fogEnabled&&D.applyFog&&T.fogMode!==P.e.FOGMODE_NONE||r||this.subSurface.refractionTexture||D.receiveShadows||o.PREPASS)&&this.bindView(Z),(0,B.f)(T,D,this._activeEffect,!0),o.NUM_MORPH_INFLUENCERS&&(0,B.l)(D,this._activeEffect),o.BAKED_VERTEX_ANIMATION_TEXTURE)null===(X=D.bakedVertexAnimationManager)||void 0===X||X.bind(Z,o.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,B.k)(o,this._activeEffect,T)}this._afterBind(D,this._activeEffect,N),v.update()}getAnimatables(){const G=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&G.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&G.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&G.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&G.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&G.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?G.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&G.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&G.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&G.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&G.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&G.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&G.push(this._microSurfaceTexture),G}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const G=super.getActiveTextures();return this._albedoTexture&&G.push(this._albedoTexture),this._ambientTexture&&G.push(this._ambientTexture),this._opacityTexture&&G.push(this._opacityTexture),this._reflectionTexture&&G.push(this._reflectionTexture),this._emissiveTexture&&G.push(this._emissiveTexture),this._reflectivityTexture&&G.push(this._reflectivityTexture),this._metallicTexture&&G.push(this._metallicTexture),this._metallicReflectanceTexture&&G.push(this._metallicReflectanceTexture),this._reflectanceTexture&&G.push(this._reflectanceTexture),this._microSurfaceTexture&&G.push(this._microSurfaceTexture),this._bumpTexture&&G.push(this._bumpTexture),this._lightmapTexture&&G.push(this._lightmapTexture),G}hasTexture(G){return!!super.hasTexture(G)||(this._albedoTexture===G||(this._ambientTexture===G||(this._opacityTexture===G||(this._reflectionTexture===G||(this._emissiveTexture===G||(this._reflectivityTexture===G||(this._metallicTexture===G||(this._metallicReflectanceTexture===G||(this._reflectanceTexture===G||(this._microSurfaceTexture===G||(this._bumpTexture===G||this._lightmapTexture===G)))))))))))}setPrePassRenderer(){var G;if(null===(G=this.subSurface)||void 0===G||!G.isScatteringEnabled)return!1;const D=this.va().enableSubSurfaceForPrePass();return D&&(D.enabled=!0),!0}dispose(G,D){var N,T,o,Z,n,C,P,r,v,q,g,X;(this._breakShaderLoadedCheck=!0,D)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(N=this._albedoTexture)||void 0===N||N.dispose(),null===(T=this._ambientTexture)||void 0===T||T.dispose(),null===(o=this._opacityTexture)||void 0===o||o.dispose(),null===(Z=this._reflectionTexture)||void 0===Z||Z.dispose(),null===(n=this._emissiveTexture)||void 0===n||n.dispose(),null===(C=this._metallicTexture)||void 0===C||C.dispose(),null===(P=this._reflectivityTexture)||void 0===P||P.dispose(),null===(r=this._bumpTexture)||void 0===r||r.dispose(),null===(v=this._lightmapTexture)||void 0===v||v.dispose(),null===(q=this._metallicReflectanceTexture)||void 0===q||q.dispose(),null===(g=this._reflectanceTexture)||void 0===g||g.dispose(),null===(X=this._microSurfaceTexture)||void 0===X||X.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(G,D)}}Q.PBRMATERIAL_OPAQUE=h.d.MATERIAL_OPAQUE,Q.PBRMATERIAL_ALPHATEST=h.d.MATERIAL_ALPHATEST,Q.PBRMATERIAL_ALPHABLEND=h.d.MATERIAL_ALPHABLEND,Q.PBRMATERIAL_ALPHATESTANDBLEND=h.d.MATERIAL_ALPHATESTANDBLEND,Q.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,Q.LIGHTFALLOFF_PHYSICAL=0,Q.LIGHTFALLOFF_GLTF=1,Q.LIGHTFALLOFF_STANDARD=2,Q.ForceGLSL=!1,(0,T.c)([(0,o.v)()],Q.prototype,"_imageProcessingConfiguration",void 0),(0,T.c)([(0,o.e)("_markAllSubMeshesAsMiscDirty")],Q.prototype,"debugMode",void 0)},11764:(G,D,N)=>{"use strict";N.d(D,{e:()=>g});var T=N(980),o=N(985),Z=N(1223),n=N(1009),C=N(1047),P=N(978),r=N(1018),v=N(1003),q=N(1181);N(1540);class g extends C.b{set boundingBoxSize(G){if(this._boundingBoxSize&&this._boundingBoxSize.equals(G))return;this._boundingBoxSize=G;const D=this.va();D&&D.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(G){this._rotationY=G,this.setReflectionTextureMatrix(n.c.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(G,D,N){let T="";return G.forEach((G=>T+=G)),new g(T,D,null,N,G)}static CreateFromPrefilteredData(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=D.useDelayedTextureLoading;D.useDelayedTextureLoading=!1;const Z=new g(G,D,null,!1,null,null,null,void 0,!0,N,T);return D.useDelayedTextureLoading=o,Z}constructor(G,D){var N;let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,g=arguments.length>8&&void 0!==arguments[8]&&arguments[8],X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,W=arguments.length>10&&void 0!==arguments[10]&&arguments[10],j=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,Y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,y=arguments.length>13?arguments[13]:void 0,h=arguments.length>14?arguments[14]:void 0;super(D),this.onLoadObservable=new v.b,this.boundingBoxPosition=n.s.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new n.c,this._buffer=null,this.name=G,this.url=G,this._noMipmap=o,this.jd=!1,this.isCube=!0,this._textureMatrix=n.c.Identity(),this.coordinatesMode=P.e.CUBIC_MODE;let m=null,R=null;null===T||Array.isArray(T)?(this._noMipmap=o,this._format=q,this._createPolynomials=W,m=T,this._loaderOptions=y,this._useSRGBBuffer=h,this._lodScale=j,this._lodOffset=Y):(m=T.extensions??null,this._noMipmap=T.noMipmap??!1,Z=T.files??null,R=T.buffer??null,this._format=T.format??5,g=T.prefiltered??!1,X=T.forcedExtension??null,this._createPolynomials=T.createPolynomials??!1,this._lodScale=T.lodScale??.8,this._lodOffset=T.lodOffset??0,this._loaderOptions=T.loaderOptions,this._useSRGBBuffer=T.useSRGBBuffer,C=T.X??null,r=T.onError??null),(G||Z)&&this.updateURL(G,X,C,g,r,m,null===(N=this.va())||void 0===N?void 0:N.useDelayedTextureLoading,Z,R)}getClassName(){return"CubeTexture"}updateURL(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=G),this.url=G,D&&(this._forcedExtension=D);const r=G.lastIndexOf("."),v=D||(r>-1?G.substring(r).toLowerCase():""),q=0===v.indexOf(".dds"),g=0===v.indexOf(".env"),X=0===v.indexOf(".basis");if(g?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=T,T&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),C)this._files=C;else if(X||g||q||Z||(Z=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,Z){for(let D=0;D<Z.length;D++)this._files.push(G+Z[D]);this._extensions=Z}this._buffer=P,n?(this.delayLoadState=4,this._delayedOnLoad=N,this._delayedOnError=o):this._loadTexture(N,o)}delayLoad(G){4===this.delayLoadState&&(G&&(this._forcedExtension=G),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(G){var D,N;if(G.updateFlag===this._textureMatrix.updateFlag)return;G.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(N=this.va())||void 0===N||N.markAllMaterialsAsDirty(1,(G=>-1!==G.getActiveTextures().indexOf(this))));if(this._textureMatrix=G,null===(D=this.va())||void 0===D||!D.useRightHandedSystem)return;const T=n.k.Ad[0],o=n.k.Quaternion[0],Z=n.k.Ad[1];this._textureMatrix.decompose(T,o,Z),o.z*=-1,o.w*=-1,n.c.ComposeToRef(T,o,Z,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var G;return null!==(G=this.va())&&void 0!==G&&G.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=this.va(),T=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const o=()=>{var D;(this.onLoadObservable.notifyObservers(this),T)&&(T.dispose(),null===(D=this.va())||void 0===D||D.markAllMaterialsAsDirty(1));G&&G()},n=(G,N)=>{this._loadingError=!0,this._errorObject={message:G,exception:N},D&&D(G,N),P.e.OnTextureLoadErrorObservable.notifyObservers(this)};var C;this._texture?this._texture.isReady?Z.f.SetImmediate((()=>o())):this._texture.onLoadedObservable.add((()=>o())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,N,this._lodScale,this._lodOffset,G,n,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,N,this._files,this._noMipmap,G,n,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(C=this._texture)||void 0===C||C.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(G,D,N){const T=q.e.Parse((()=>{let T=!1;return G.prefiltered&&(T=G.prefiltered),new g(N+(G.url??G.name),D,G.extensions,!1,G.files||null,null,null,void 0,T,G.forcedExtension)}),G,D);if(G.boundingBoxPosition&&(T.boundingBoxPosition=n.s.od(G.boundingBoxPosition)),G.boundingBoxSize&&(T.boundingBoxSize=n.s.od(G.boundingBoxSize)),G.animations)for(let o=0;o<G.animations.length;o++){const D=G.animations[o],N=(0,r.e)("BABYLON.Animation");N&&T.animations.push(N.Parse(D))}return T}clone(){let G=0;const D=q.e.Clone((()=>{const D=new g(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return G=D.uniqueId,D}),this);return D.uniqueId=G,D}}(0,T.c)([(0,o.S)()],g.prototype,"url",void 0),(0,T.c)([(0,o.O)()],g.prototype,"boundingBoxPosition",void 0),(0,T.c)([(0,o.O)()],g.prototype,"boundingBoxSize",null),(0,T.c)([(0,o.S)("rotationY")],g.prototype,"rotationY",null),(0,T.c)([(0,o.S)("files")],g.prototype,"_files",void 0),(0,T.c)([(0,o.S)("forcedExtension")],g.prototype,"_forcedExtension",void 0),(0,T.c)([(0,o.S)("extensions")],g.prototype,"_extensions",void 0),(0,T.c)([(0,o.z)("textureMatrix")],g.prototype,"_textureMatrix",void 0),(0,T.c)([(0,o.z)("textureMatrixRefraction")],g.prototype,"_textureMatrixRefraction",void 0),P.e._CubeTextureParser=g.Parse,(0,r.h)("BABYLON.CubeTexture",g)},12071:(G,D,N)=>{"use strict";N.d(D,{e:()=>P});var T=N(1105),o=N(978),Z=N(1231),n=N(1427),C=N(1157);n.ThinEngine.prototype.createDynamicTexture=function(G,D,N,T){const o=new C.d(this,4);return o.baseWidth=G,o.baseHeight=D,N&&(G=this.needPOTTextures?(0,Z.f)(G,this._caps.maxTextureSize):G,D=this.needPOTTextures?(0,Z.f)(D,this._caps.maxTextureSize):D),o.width=G,o.height=D,o.isReady=!1,o.generateMipMaps=N,o.samplingMode=T,this.updateTextureSamplingMode(T,o),this._internalTexturesCache.push(o),o},n.ThinEngine.prototype.updateDynamicTexture=function(G,D,N){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!G)return;const n=this._gl,C=n.TEXTURE_2D,P=this._bindTextureDirectly(C,G,!0,Z);this._unpackFlipY(void 0===N?G.invertY:N),T&&n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const r=this._getWebGLTextureType(G.type),v=this._getInternalFormat(o||G.format),q=this._getRGBABufferInternalSizedFormat(G.type,v);n.texImage2D(C,0,q,v,r,D),G.generateMipMaps&&n.generateMipmap(C),P||this._bindTextureDirectly(C,null),T&&n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),o&&(G.format=o),G._dynamicTextureSource=D,G._premulAlpha=T,G.invertY=N||!1,G.isReady=!0};class P extends o.e{constructor(G,D,N){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,C=arguments.length>6?arguments[6]:void 0;const P=!N||N._isScene;super(null,P?N:null===N||void 0===N?void 0:N.oe,P?!T:N,C,Z,void 0,void 0,void 0,void 0,n),this.name=G,this.wrapU=o.e.CLAMP_ADDRESSMODE,this.wrapV=o.e.CLAMP_ADDRESSMODE,this._generateMipMaps=T;const r=this._getEngine();if(!r)return;if(D.getContext)this._canvas=D,this._ownCanvas=!1,this._texture=r.createDynamicTexture(this._canvas.width,this._canvas.height,T,Z);else{this._canvas=r.createCanvas(1,1),this._ownCanvas=!0;const G=D;G.width||0===G.width?this._texture=r.createDynamicTexture(G.width,G.height,T,Z):this._texture=r.createDynamicTexture(D,D,T,Z)}const v=this.getSize();this._canvas.width!==v.width&&(this._canvas.width=v.width),this._canvas.height!==v.height&&(this._canvas.height=v.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(G){this._canvas.width=G.width,this._canvas.height=G.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(G.width,G.height,this._generateMipMaps,this.samplingMode)}scale(G){const D=this.getSize();D.width*=G,D.height*=G,this._recreate(D)}scaleTo(G,D){const N=this.getSize();N.width=G,N.height=D,this._recreate(N)}getContext(){return this._context}clear(G){const D=this.getSize();G&&(this._context.fillStyle=G),this._context.clearRect(0,0,D.width,D.height)}update(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===G||G,D,this._format||void 0,void 0,N)}drawText(G,D,N,T,o,Z,n){let C=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const P=this.getSize();if(Z&&(this._context.fillStyle=Z,this._context.fillRect(0,0,P.width,P.height)),this._context.font=T,null===D||void 0===D){const N=this._context.measureText(G);D=(P.width-N.width)/2}if(null===N||void 0===N){const G=parseInt(T.replace(/\D/g,""));N=P.height/2+G/3.65}this._context.fillStyle=o||"",this._context.fillText(G,D,N),C&&this.update(n)}dispose(){var G,D;(super.dispose(),this._ownCanvas)&&(null===(G=this._canvas)||void 0===G||null===(D=G.remove)||void 0===D||D.call(G));this._canvas=null,this._context=null}clone(){const G=this.va();if(!G)return this;const D=this.getSize(),N=new P(this.name,D,G,this._generateMipMaps);return N.jd=this.jd,N.level=this.level,N.wrapU=this.wrapU,N.wrapV=this.wrapV,N}serialize(){const G=this.va();G&&!G.isReady()&&T.d.Warn("The scene must be ready before serializing the dynamic texture");const D=super.serialize();return P._IsCanvasElement(this._canvas)&&(D.base64String=this._canvas.toDataURL()),D.invertY=this._invertY,D.samplingMode=this.samplingMode,D}static _IsCanvasElement(G){return void 0!==G.toDataURL}_rebuild(){this.update()}}},11529:(G,D,N)=>{"use strict";N.d(D,{c:()=>o});var T=N(978);class o extends T.e{constructor(G,D,N,o,Z){let n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],C=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,v=arguments.length>9?arguments[9]:void 0,q=arguments.length>10?arguments[10]:void 0;super(null,Z,!n,C,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,v),this.format=o,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==r||(P=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==r||(P=1),this._texture=this._engine.createRawTexture(G,D,N,o,n,C,P,null,r,v??0,q??!1),this.wrapU=T.e.CLAMP_ADDRESSMODE,this.wrapV=T.e.CLAMP_ADDRESSMODE)}update(G){this._getEngine().updateRawTexture(this._texture,G,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const G=new o(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return G._texture=this._texture,this._texture.incrementReferences(),G}static CreateLuminanceTexture(G,D,N,T){return new o(G,D,N,1,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(G,D,N,T){return new o(G,D,N,2,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(G,D,N,T){return new o(G,D,N,0,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(G,D,N,T){return new o(G,D,N,4,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(G,D,N,T){return new o(G,D,N,5,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(G,D,N,T){return new o(G,D,N,5,T,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(G,D,N,Z){let n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:T.e.TRILINEAR_SAMPLINGMODE;return new o(G,D,N,6,Z,n,C,P,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(G,D,N,Z){let n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:T.e.TRILINEAR_SAMPLINGMODE;return new o(G,D,N,6,Z,n,C,P,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11441:(G,D,N)=>{"use strict";N.d(D,{c:()=>n});var T=N(1329),o=N(1183),Z=N(1018);class n extends T.d{get Jg(){return this._subMaterials}set Jg(G){this._subMaterials=G,this._hookArray(G)}getChildren(){return this.Jg}constructor(G,D){super(G,D,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.Jg=[],this._storeEffectOnSubMeshes=!0}_hookArray(G){var D=this;const N=G.push;G.push=function(){for(var T=arguments.length,o=new Array(T),Z=0;Z<T;Z++)o[Z]=arguments[Z];const n=N.apply(G,o);return D._markAllSubMeshesAsTexturesDirty(),n};const T=G.splice;G.splice=(D,N)=>{const o=T.apply(G,[D,N]);return this._markAllSubMeshesAsTexturesDirty(),o}}getSubMaterial(G){return G<0||G>=this.Jg.length?this.va().defaultMaterial:this.Jg[G]}getActiveTextures(){return super.getActiveTextures().concat(...this.Jg.map((G=>G?G.getActiveTextures():[])))}hasTexture(G){if(super.hasTexture(G))return!0;for(let N=0;N<this.Jg.length;N++){var D;if(null!==(D=this.Jg[N])&&void 0!==D&&D.hasTexture(G))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(G,D,N){for(let T=0;T<this.Jg.length;T++){const o=this.Jg[T];if(o){if(o._storeEffectOnSubMeshes){if(!o.isReadyForSubMesh(G,D,N))return!1;continue}if(!o.isReady(G))return!1}}return!0}clone(G,D){const N=new n(G,this.va());for(let T=0;T<this.Jg.length;T++){let o=null;const Z=this.Jg[T];o=D&&Z?Z.clone(G+"-"+Z.name):this.Jg[T],N.Jg.push(o)}return N}serialize(){const G={};G.name=this.name,G.id=this.id,G.uniqueId=this.uniqueId,o.b&&(G.tags=o.b.GetTags(this)),G.materialsUniqueIds=[],G.materials=[];for(let D=0;D<this.Jg.length;D++){const N=this.Jg[D];N?(G.materialsUniqueIds.push(N.uniqueId),G.materials.push(N.id)):(G.materialsUniqueIds.push(null),G.materials.push(null))}return G}dispose(G,D,N){const T=this.va();if(!T)return;if(N)for(let Z=0;Z<this.Jg.length;Z++){const N=this.Jg[Z];N&&N.dispose(G,D)}const o=T.multiMaterials.indexOf(this);o>=0&&T.multiMaterials.splice(o,1),super.dispose(G,D)}static ParseMultiMaterial(G,D){const N=new n(G.name,D);return N.id=G.id,N._loadedUniqueId=G.uniqueId,o.b&&o.b.AddTagsTo(N,G.tags),G.materialsUniqueIds?N._waitingSubMaterialsUniqueIds=G.materialsUniqueIds:G.materials.forEach((G=>N.Jg.push(D.getLastMaterialById(G)))),N}}(0,Z.h)("BABYLON.MultiMaterial",n)},11447:(G,D,N)=>{"use strict";N.d(D,{e:()=>v,g:()=>r});var T=N(1009),o=N(1185),Z=N(11378),n=N(11407),C=N(1199);N(11452);function P(G){let D=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const N=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],Z=[];let P=[];const r=G.width||G.size||1,v=G.height||G.size||1,q=G.depth||G.size||1,g=G.wrap||!1;let X=void 0===G.topBaseAt?1:G.topBaseAt,W=void 0===G.bottomBaseAt?0:G.bottomBaseAt;X=(X+4)%4,W=(W+4)%4;let j=[2,0,3,1][X],Y=[2,0,1,3][W],y=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(g){D=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],y=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let G=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],N=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const T=[17,18,19,16],o=[22,23,20,21];for(;j>0;)G.unshift(G.pop()),T.unshift(T.pop()),j--;for(;Y>0;)N.unshift(N.pop()),o.unshift(o.pop()),Y--;G=G.flat(),N=N.flat(),y=y.concat(G).concat(N),D.push(T[0],T[2],T[3],T[0],T[1],T[2]),D.push(o[0],o[2],o[3],o[0],o[1],o[2])}const h=[r/2,v/2,q/2];P=y.reduce(((G,D,N)=>G.concat(D*h[N%3])),[]);const m=0===G.sideOrientation?0:G.sideOrientation||n.c.DEFAULTSIDE,R=G.faceUV||new Array(6),L=G.faceColors,w=[];for(let n=0;n<6;n++)void 0===R[n]&&(R[n]=new T.v(0,0,1,1)),L&&void 0===L[n]&&(L[n]=new o.g(1,1,1,1));for(let T=0;T<6;T++)if(Z.push(R[T].z,C.c?1-R[T].w:R[T].w),Z.push(R[T].x,C.c?1-R[T].w:R[T].w),Z.push(R[T].x,C.c?1-R[T].y:R[T].y),Z.push(R[T].z,C.c?1-R[T].y:R[T].y),L)for(let G=0;G<4;G++)w.push(L[T].r,L[T].g,L[T].b,L[T].a);n.c._ComputeSides(m,P,D,N,Z,G.frontUVs,G.backUVs);const B=new n.c;if(B.indices=D,B.xa=P,B.ya=N,B.Aa=Z,L){const G=m===n.c.DOUBLESIDE?w.concat(w):w;B.za=G}return B}function r(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new Z.d(G,N);D.sideOrientation=Z.d._GetDefaultSideOrientation(D.sideOrientation),T._originalBuilderSideOrientation=D.sideOrientation;return P(D).Ca(T,D.updatable),T}const v={CreateBox:r};n.c.CreateBox=P,Z.d.CreateBox=function(G,D){return r(G,{size:D,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11547:(G,D,N)=>{"use strict";N.d(D,{e:()=>C});var T=N(11378),o=N(11407),Z=N(1199);function n(G){const D=[],N=[],T=[],n=[],C=G.i||.5,P=G.Uk||64,r=G.arc&&(G.arc<=0||G.arc>1)?1:G.arc||1,v=0===G.sideOrientation?0:G.sideOrientation||o.c.DEFAULTSIDE;D.push(0,0,0),n.push(.5,.5);const q=2*Math.PI*r,g=1===r?q/P:q/(P-1);let X=0;for(let o=0;o<P;o++){const G=Math.cos(X),N=Math.sin(X),T=(G+1)/2,o=(1-N)/2;D.push(C*G,C*N,0),n.push(T,Z.c?1-o:o),X+=g}1===r&&(D.push(D[3],D[4],D[5]),n.push(n[2],Z.c?1-n[3]:n[3]));const W=D.length/3;for(let o=1;o<W-1;o++)N.push(o+1,0,o);o.c.ComputeNormals(D,N,T),o.c._ComputeSides(v,D,N,T,n,G.frontUVs,G.backUVs);const j=new o.c;return j.indices=N,j.xa=D,j.ya=T,j.Aa=n,j}function C(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new T.d(G,N);D.sideOrientation=T.d._GetDefaultSideOrientation(D.sideOrientation),o._originalBuilderSideOrientation=D.sideOrientation;return n(D).Ca(o,D.updatable),o}o.c.kb=n,T.d.kb=function(G,D,N){return C(G,{i:D,Uk:N,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11452:(G,D,N)=>{"use strict";N.d(D,{g:()=>Y,d:()=>h,k:()=>y});var T=N(1009),o=N(1185),Z=N(11378),n=N(11407),C=N(1255);Z.d._GroundMeshParser=(G,D)=>P.Parse(G,D);class P extends Z.d{constructor(G,D){super(G,D),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=G,this._subdivisionsY=G,this.subdivide(G);const N=this;N.createOrUpdateSubmeshesOctree&&N.createOrUpdateSubmeshesOctree(D)}getHeightAtCoordinates(G,D){const N=this.getWorldMatrix(),o=T.k.Matrix[5];N.invertToRef(o);const Z=T.k.Ad[8];if(T.s.TransformCoordinatesFromFloatsToRef(G,0,D,o,Z),G=Z.x,D=Z.z,G<this._minX||G>=this._maxX||D<=this._minZ||D>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const n=this._getFacetAt(G,D),C=-(n.x*G+n.z*D+n.w)/n.y;return T.s.TransformCoordinatesFromFloatsToRef(0,C,0,N,Z),Z.y}getNormalAtCoordinates(G,D){const N=new T.s(0,1,0);return this.getNormalAtCoordinatesToRef(G,D,N),N}getNormalAtCoordinatesToRef(G,D,N){const o=this.getWorldMatrix(),Z=T.k.Matrix[5];o.invertToRef(Z);const n=T.k.Ad[8];if(T.s.TransformCoordinatesFromFloatsToRef(G,0,D,Z,n),G=n.x,D=n.z,G<this._minX||G>this._maxX||D<this._minZ||D>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const C=this._getFacetAt(G,D);return T.s.TransformNormalFromFloatsToRef(C.x,C.y,C.z,o,N),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(G,D){const N=Math.floor((G+this._maxX)*this._subdivisionsX/this._width),T=Math.floor(-(D+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),o=this._heightQuads[T*this._subdivisionsX+N];let Z;return Z=D<o.slope.x*G+o.slope.y?o.facet1:o.facet2,Z}_initHeightQuads(){const G=this._subdivisionsX,D=this._subdivisionsY;this._heightQuads=new Array;for(let N=0;N<D;N++)for(let D=0;D<G;D++){const o={slope:T.o.Zero(),facet1:new T.v(0,0,0,0),facet2:new T.v(0,0,0,0)};this._heightQuads[N*G+D]=o}return this}_computeHeightQuads(){const G=this.getVerticesData(C.f.PositionKind);if(!G)return this;const D=T.k.Ad[3],N=T.k.Ad[2],o=T.k.Ad[1],Z=T.k.Ad[0],n=T.k.Ad[4],P=T.k.Ad[5],r=T.k.Ad[6],v=T.k.Ad[7],q=T.k.Ad[8];let g=0,X=0,W=0,j=0,Y=0,y=0,h=0;const m=this._subdivisionsX,R=this._subdivisionsY;for(let C=0;C<R;C++)for(let R=0;R<m;R++){g=3*R,X=C*(m+1)*3,W=(C+1)*(m+1)*3,D.x=G[X+g],D.y=G[X+g+1],D.z=G[X+g+2],N.x=G[X+g+3],N.y=G[X+g+4],N.z=G[X+g+5],o.x=G[W+g],o.y=G[W+g+1],o.z=G[W+g+2],Z.x=G[W+g+3],Z.y=G[W+g+4],Z.z=G[W+g+5],j=(Z.z-D.z)/(Z.x-D.x),Y=D.z-j*D.x,N.subtractToRef(D,n),o.subtractToRef(D,P),Z.subtractToRef(D,r),T.s.CrossToRef(r,P,v),T.s.CrossToRef(n,r,q),v.normalize(),q.normalize(),y=-(v.x*D.x+v.y*D.y+v.z*D.z),h=-(q.x*N.x+q.y*N.y+q.z*N.z);const L=this._heightQuads[C*m+R];L.slope.xd(j,Y),L.facet1.xd(v.x,v.y,v.z,y),L.facet2.xd(q.x,q.y,q.z,h)}return this}serialize(G){super.serialize(G),G.subdivisionsX=this._subdivisionsX,G.subdivisionsY=this._subdivisionsY,G.minX=this._minX,G.maxX=this._maxX,G.fj=this._minZ,G.maxZ=this._maxZ,G.width=this._width,G.height=this._height}static Parse(G,D){const N=new P(G.name,D);return N._subdivisionsX=G.subdivisionsX||1,N._subdivisionsY=G.subdivisionsY||1,N._minX=G.minX,N._maxX=G.maxX,N._minZ=G.fj,N._maxZ=G.maxZ,N._width=G.width,N._height=G.height,N}}var r=N(1223),v=N(1030),q=N(1012),g=N(1199);function X(G){const D=[],N=[],o=[],Z=[];let C,P;const r=G.width||G.size||1,v=G.height||G.size||1,q=0|(G.subdivisionsX||G.subdivisions||1),X=0|(G.subdivisionsY||G.subdivisions||1);for(C=0;C<=X;C++)for(P=0;P<=q;P++){const G=new T.s(P*r/q-r/2,0,(X-C)*v/X-v/2),D=new T.s(0,1,0);N.push(G.x,G.y,G.z),o.push(D.x,D.y,D.z),Z.push(P/q,g.c?C/X:1-C/X)}for(C=0;C<X;C++)for(P=0;P<q;P++)D.push(P+1+(C+1)*(q+1)),D.push(P+1+C*(q+1)),D.push(P+C*(q+1)),D.push(P+(C+1)*(q+1)),D.push(P+1+(C+1)*(q+1)),D.push(P+C*(q+1));const W=new n.c;return W.indices=D,W.xa=N,W.ya=o,W.Aa=Z,W}function W(G){const D=void 0!==G.xmin&&null!==G.xmin?G.xmin:-1,N=void 0!==G.zmin&&null!==G.zmin?G.zmin:-1,o=void 0!==G.xmax&&null!==G.xmax?G.xmax:1,Z=void 0!==G.zmax&&null!==G.zmax?G.zmax:1,C=G.subdivisions||{w:1,h:1},P=G.precision||{w:1,h:1},r=[],v=[],q=[],g=[];let X,W,j,Y;C.h=C.h<1?1:C.h,C.w=C.w<1?1:C.w,P.w=P.w<1?1:P.w,P.h=P.h<1?1:P.h;const y=(o-D)/C.w,h=(Z-N)/C.h;function m(G,D,N,o){const Z=v.length/3,n=P.w+1;for(X=0;X<P.h;X++)for(W=0;W<P.w;W++){const G=[Z+W+X*n,Z+(W+1)+X*n,Z+(W+1)+(X+1)*n,Z+W+(X+1)*n];r.push(G[1]),r.push(G[2]),r.push(G[3]),r.push(G[0]),r.push(G[1]),r.push(G[3])}const C=T.s.Zero(),j=new T.s(0,1,0);for(X=0;X<=P.h;X++)for(C.z=X*(o-D)/P.h+D,W=0;W<=P.w;W++)C.x=W*(N-G)/P.w+G,C.y=0,v.push(C.x,C.y,C.z),q.push(j.x,j.y,j.z),g.push(W/P.w,X/P.h)}for(j=0;j<C.h;j++)for(Y=0;Y<C.w;Y++)m(D+Y*y,N+j*h,D+(Y+1)*y,N+(j+1)*h);const R=new n.c;return R.indices=r,R.xa=v,R.ya=q,R.Aa=g,R}function j(G){const D=[],N=[],Z=[],C=[];let P,r;const v=G.colorFilter||new o.d(.3,.59,.11),g=G.alphaFilter||0;let X=!1;if(G.minHeight>G.maxHeight){X=!0;const D=G.maxHeight;G.maxHeight=G.minHeight,G.minHeight=D}for(P=0;P<=G.subdivisions;P++)for(r=0;r<=G.subdivisions;r++){const D=new T.s(r*G.width/G.subdivisions-G.width/2,0,(G.subdivisions-P)*G.height/G.subdivisions-G.height/2),o=4*(((D.x+G.width/2)/G.width*(G.bufferWidth-1)|0)+((1-(D.z+G.height/2)/G.height)*(G.bufferHeight-1)|0)*G.bufferWidth);let n=G.buffer[o]/255,W=G.buffer[o+1]/255,j=G.buffer[o+2]/255;const Y=G.buffer[o+3]/255;X&&(n=1-n,W=1-W,j=1-j);const y=n*v.r+W*v.g+j*v.b;D.y=Y>=g?G.minHeight+(G.maxHeight-G.minHeight)*y:G.minHeight-q.d,G.heightBuffer&&(G.heightBuffer[P*(G.subdivisions+1)+r]=D.y),N.push(D.x,D.y,D.z),Z.push(0,0,0),C.push(r/G.subdivisions,1-P/G.subdivisions)}for(P=0;P<G.subdivisions;P++)for(r=0;r<G.subdivisions;r++){const T=r+1+(P+1)*(G.subdivisions+1),o=r+1+P*(G.subdivisions+1),Z=r+P*(G.subdivisions+1),n=r+(P+1)*(G.subdivisions+1),C=N[3*T+1]>=G.minHeight,v=N[3*o+1]>=G.minHeight,q=N[3*Z+1]>=G.minHeight;C&&v&&q&&(D.push(T),D.push(o),D.push(Z));N[3*n+1]>=G.minHeight&&C&&q&&(D.push(n),D.push(T),D.push(Z))}n.c.ComputeNormals(N,D,Z);const W=new n.c;return W.indices=D,W.xa=N,W.ya=Z,W.Aa=C,W}function Y(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const N=new P(G,arguments.length>2?arguments[2]:void 0);N._setReady(!1),N._subdivisionsX=D.subdivisionsX||D.subdivisions||1,N._subdivisionsY=D.subdivisionsY||D.subdivisions||1,N._width=D.width||1,N._height=D.height||1,N._maxX=N._width/2,N._maxZ=N._height/2,N._minX=-N._maxX,N._minZ=-N._maxZ;return X(D).Ca(N,D.updatable),N._setReady(!0),N}function y(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new Z.d(G,N);return W(D).Ca(T,D.updatable),T}function h(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Z=N.width||10,n=N.height||10,C=N.subdivisions||1,q=N.minHeight||0,g=N.maxHeight||1,X=N.colorFilter||new o.d(.3,.59,.11),W=N.alphaFilter||0,Y=N.updatable,y=N.onReady;T=T||v.e.LastCreatedScene;const h=new P(G,T);let m;h._subdivisionsX=C,h._subdivisionsY=C,h._width=Z,h._height=n,h._maxX=h._width/2,h._maxZ=h._height/2,h._minX=-h._maxX,h._minZ=-h._maxZ,h._setReady(!1),N.passHeightBufferInCallback&&(m=new Float32Array((C+1)*(C+1)));const R=(G,D,N)=>{j({width:Z,height:n,subdivisions:C,minHeight:q,maxHeight:g,colorFilter:X,buffer:G,bufferWidth:D,bufferHeight:N,alphaFilter:W,heightBuffer:m}).Ca(h,Y),y&&y(h,m),h._setReady(!0)};if("string"===typeof D){const G=G=>{var D;const N=G.width,o=G.height;if(T.u)return;const Z=null===(D=T)||void 0===D?void 0:D.getEngine().resizeImageBitmap(G,N,o);R(Z,N,o)};r.f.LoadImage(D,G,N.onError?N.onError:()=>{},T.offlineProvider)}else R(D.data,D.width,D.height);return h}n.c.CreateGround=X,n.c.CreateTiledGround=W,n.c.CreateGroundFromHeightMap=j,Z.d.CreateGround=(G,D,N,T,o,Z)=>Y(G,{width:D,height:N,subdivisions:T,updatable:Z},o),Z.d.CreateTiledGround=(G,D,N,T,o,Z,n,C,P)=>y(G,{xmin:D,zmin:N,xmax:T,zmax:o,subdivisions:Z,precision:n,updatable:P},C),Z.d.CreateGroundFromHeightMap=(G,D,N,T,o,Z,n,C,P,r,v)=>h(G,D,{width:N,height:T,subdivisions:o,minHeight:Z,maxHeight:n,updatable:P,onReady:r,alphaFilter:v},C)},12064:(G,D,N)=>{"use strict";N.d(D,{c:()=>i,f:()=>U,g:()=>z});var T=N(1009),o=N(11378),Z=N(11407),n=N(1185),C=N(1255),P=N(11750),r=N(1329),v=N(1181),q=N(1218),g=N(978),X=N(1018),W=N(1395),j=N(1064),Y=N(1387),y=N(1030),h=N(1380),m=N(1374);const R={effect:null,subMesh:null};class L extends Y.d{constructor(G,D,N){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(G,D,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new T.c,this._cachedWorldViewProjectionMatrix=new T.c,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=N,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","Bd","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...o}}get shaderPath(){return this._shaderPath}set shaderPath(G){this._shaderPath=G}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(G){-1===this._options.uniforms.indexOf(G)&&this._options.uniforms.push(G)}setTexture(G,D){return-1===this._options.samplers.indexOf(G)&&this._options.samplers.push(G),this._textures[G]=D,this}removeTexture(G){delete this._textures[G]}setTextureArray(G,D){return-1===this._options.samplers.indexOf(G)&&this._options.samplers.push(G),this._checkUniform(G),this._textureArrays[G]=D,this}setExternalTexture(G,D){return-1===this._options.externalTextures.indexOf(G)&&this._options.externalTextures.push(G),this._externalTextures[G]=D,this}setFloat(G,D){return this._checkUniform(G),this._floats[G]=D,this}setInt(G,D){return this._checkUniform(G),this._ints[G]=D,this}setUInt(G,D){return this._checkUniform(G),this._uints[G]=D,this}setFloats(G,D){return this._checkUniform(G),this._floatsArrays[G]=D,this}setColor3(G,D){return this._checkUniform(G),this._colors3[G]=D,this}setColor3Array(G,D){return this._checkUniform(G),this._colors3Arrays[G]=D.reduce(((G,D)=>(D.toArray(G,G.length),G)),[]),this}setColor4(G,D){return this._checkUniform(G),this._colors4[G]=D,this}setColor4Array(G,D){return this._checkUniform(G),this._colors4Arrays[G]=D.reduce(((G,D)=>(D.toArray(G,G.length),G)),[]),this}setVector2(G,D){return this._checkUniform(G),this._vectors2[G]=D,this}setVector3(G,D){return this._checkUniform(G),this._vectors3[G]=D,this}setVector4(G,D){return this._checkUniform(G),this._vectors4[G]=D,this}setQuaternion(G,D){return this._checkUniform(G),this._quaternions[G]=D,this}setQuaternionArray(G,D){return this._checkUniform(G),this._quaternionsArrays[G]=D.reduce(((G,D)=>(D.toArray(G,G.length),G)),[]),this}setMatrix(G,D){return this._checkUniform(G),this._matrices[G]=D,this}setMatrices(G,D){this._checkUniform(G);const N=new Float32Array(16*D.length);for(let T=0;T<D.length;T++){D[T].copyToArray(N,16*T)}return this._matrixArrays[G]=N,this}setMatrix3x3(G,D){return this._checkUniform(G),this._matrices3x3[G]=D,this}setMatrix2x2(G,D){return this._checkUniform(G),this._matrices2x2[G]=D,this}setArray2(G,D){return this._checkUniform(G),this._vectors2Arrays[G]=D,this}setArray3(G,D){return this._checkUniform(G),this._vectors3Arrays[G]=D,this}setArray4(G,D){return this._checkUniform(G),this._vectors4Arrays[G]=D,this}setUniformBuffer(G,D){return-1===this._options.uniformBuffers.indexOf(G)&&this._options.uniformBuffers.push(G),this._uniformBuffers[G]=D,this}setTextureSampler(G,D){return-1===this._options.samplerObjects.indexOf(G)&&this._options.samplerObjects.push(G),this._textureSamplers[G]=D,this}setStorageBuffer(G,D){return-1===this._options.storageBuffers.indexOf(G)&&this._options.storageBuffers.push(G),this._storageBuffers[G]=D,this}setDefine(G,D){const N=G.trimEnd()+" ",T=this.options.defines.findIndex((D=>D===G||D.startsWith(N)));return T>=0&&this.options.defines.splice(T,1),("boolean"!==typeof D||D)&&this.options.defines.push(N+D),this}isReadyForSubMesh(G,D,N){return this.isReady(G,N,D)}isReady(G,D,N){var T;const o=N&&this._storeEffectOnSubMeshes;if(this.isFrozen){const G=o?N._drawWrapper:this._drawWrapper;if(G.effect&&G._wasPreviouslyReady&&G._wasPreviouslyUsingInstances===D)return!0}const Z=this.va(),n=Z.getEngine(),P=[],r=[],v=new W.e;let g=this._shaderPath,X=this._options.uniforms,j=this._options.uniformBuffers,Y=this._options.samplers;n.getCaps().multiview&&Z.activeCamera&&Z.activeCamera.outputRenderTarget&&Z.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,P.push("#define MULTIVIEW"),-1!==X.indexOf("viewProjection")&&-1===X.indexOf("viewProjectionR")&&X.push("viewProjectionR"));for(let C=0;C<this._options.defines.length;C++){const G=0===this._options.defines[C].indexOf("#define")?this._options.defines[C]:`#define ${this._options.defines[C]}`;P.push(G)}for(let C=0;C<this._options.attributes.length;C++)r.push(this._options.attributes[C]);if(G&&G.isVerticesDataPresent(C.f.ColorKind)&&(-1===r.indexOf(C.f.ColorKind)&&r.push(C.f.ColorKind),P.push("#define VERTEXCOLOR")),D&&(P.push("#define INSTANCES"),(0,m.bb)(r,this._materialHelperNeedsPreviousMatrices),null!==G&&void 0!==G&&G.hasThinInstances&&(P.push("#define THIN_INSTANCES"),G&&G.isVerticesDataPresent(C.f.ColorInstanceKind)&&(r.push(C.f.ColorInstanceKind),P.push("#define INSTANCESCOLOR")))),G&&G.useBones&&G.computeBonesUsingShaders&&G.skeleton){r.push(C.f.MatricesIndicesKind),r.push(C.f.MatricesWeightsKind),G.numBoneInfluencers>4&&(r.push(C.f.MatricesIndicesExtraKind),r.push(C.f.MatricesWeightsExtraKind));const D=G.skeleton;P.push("#define NUM_BONE_INFLUENCERS "+G.numBoneInfluencers),v.addCPUSkinningFallback(0,G),D.isUsingTextureForMatrices?(P.push("#define BONETEXTURE"),-1===X.indexOf("boneTextureWidth")&&X.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(P.push("#define BonesPerMesh "+(D.bones.length+1)),-1===X.indexOf("mBones")&&X.push("mBones"))}else P.push("#define NUM_BONE_INFLUENCERS 0");let y=0;const L=G?G.morphTargetManager:null;if(L){const G=L.supportsUVs&&-1!==P.indexOf("#define UV1"),D=L.supportsTangents&&-1!==P.indexOf("#define TANGENT"),N=L.supportsNormals&&-1!==P.indexOf("#define NORMAL");y=L.numMaxInfluencers||L.numInfluencers,G&&P.push("#define MORPHTARGETS_UV"),D&&P.push("#define MORPHTARGETS_TANGENT"),N&&P.push("#define MORPHTARGETS_NORMAL"),y>0&&P.push("#define MORPHTARGETS"),L.isUsingTextureForTargets&&(P.push("#define MORPHTARGETS_TEXTURE"),-1===X.indexOf("morphTargetTextureIndices")&&X.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),P.push("#define NUM_MORPH_INFLUENCERS "+y);for(let T=0;T<y;T++)r.push(C.f.PositionKind+T),N&&r.push(C.f.NormalKind+T),D&&r.push(C.f.TangentKind+T),G&&r.push(C.f.UVKind+"_"+T);y>0&&(X=X.slice(),X.push("morphTargetInfluences"),X.push("morphTargetCount"),X.push("morphTargetTextureInfo"),X.push("morphTargetTextureIndices"))}else P.push("#define NUM_MORPH_INFLUENCERS 0");if(G){const D=G.bakedVertexAnimationManager;D&&D.isEnabled&&(P.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===X.indexOf("bakedVertexAnimationSettings")&&X.push("bakedVertexAnimationSettings"),-1===X.indexOf("bakedVertexAnimationTextureSizeInverted")&&X.push("bakedVertexAnimationTextureSizeInverted"),-1===X.indexOf("bakedVertexAnimationTime")&&X.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,m.x)(r,G,P)}for(const C in this._textures)if(!this._textures[C].isReady())return!1;G&&this._shouldTurnAlphaTestOn(G)&&P.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,h.e)(X),(0,h.k)(this,Z,P)),Z.fogEnabled&&null!==G&&void 0!==G&&G.applyFog&&Z.fogMode!==q.e.FOGMODE_NONE&&(P.push("#define FOG"),-1===X.indexOf("view")&&X.push("view"),-1===X.indexOf("vFogInfos")&&X.push("vFogInfos"),-1===X.indexOf("vFogColor")&&X.push("vFogColor")),this._useLogarithmicDepth&&(P.push("#define LOGARITHMICDEPTH"),-1===X.indexOf("logarithmicDepthConstant")&&X.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(X=X.slice(),j=j.slice(),Y=Y.slice(),g=this.customShaderNameResolve(this.name,X,j,Y,P,r));const w=o?N._getDrawWrapper(void 0,!0):this._drawWrapper,B=(null===w||void 0===w?void 0:w.effect)??null,F=(null===w||void 0===w?void 0:w.defines)??null,S=P.join("\n");let V=B;return F!==S&&(V=n.createEffect(g,{attributes:r,uniformsNames:X,uniformBuffersNames:j,samplers:Y,defines:S,fallbacks:v,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:y},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},n),o?N.setEffect(V,S,this._materialContext):w&&w.setEffect(V,S),this._onEffectCreatedObservable&&(R.effect=V,R.subMesh=N??(null===G||void 0===G?void 0:G.le[0])??null,this._onEffectCreatedObservable.notifyObservers(R))),w._wasPreviouslyUsingInstances=!!D,!((null===(T=V)||void 0===T||!T.isReady())??1)&&(B!==V&&Z.resetCachedMaterial(),w._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(G,D){const N=this.va(),T=D??this.getEffect();T&&(-1!==this._options.uniforms.indexOf("world")&&T.setMatrix("world",G),-1!==this._options.uniforms.indexOf("worldView")&&(G.multiplyToRef(N.getViewMatrix(),this._cachedWorldViewMatrix),T.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(G.multiplyToRef(N.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),T.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&T.setMatrix("view",N.getViewMatrix()))}bindForSubMesh(G,D,N){var T;this.bind(G,D,null===(T=N._drawWrapperOverride)||void 0===T?void 0:T.effect,N)}bind(G,D,N,T){const o=T&&this._storeEffectOnSubMeshes,Z=N??(o?T.effect:this.getEffect());if(!Z)return;const n=this.va();this._activeEffect=Z,this.bindOnlyWorldMatrix(G,N);const C=this._options.uniformBuffers;let P=!1;if(Z&&C&&C.length>0&&n.getEngine().supportsUniformBuffers)for(let q=0;q<C.length;++q){switch(C[q]){case"Mesh":D&&(D.getMeshUniformBuffer().bindToEffect(Z,"Mesh"),D.transferToEffect(G));break;case"Scene":(0,m.o)(Z,n.getSceneUniformBuffer()),n.finalizeSceneUbo(),P=!0}}const r=D&&o?this._mustRebind(n,Z,T,D.visibility):n.getCachedMaterial()!==this;if(Z&&r){let G;for(G in P||-1===this._options.uniforms.indexOf("view")||Z.setMatrix("view",n.getViewMatrix()),P||-1===this._options.uniforms.indexOf("projection")||Z.setMatrix("projection",n.getProjectionMatrix()),P||-1===this._options.uniforms.indexOf("viewProjection")||(Z.setMatrix("viewProjection",n.getTransformMatrix()),this._multiview&&Z.setMatrix("viewProjectionR",n._transformMatrixR)),n.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&Z.setVector3("cameraPosition",n.activeCamera.globalPosition),(0,m.e)(D,Z),(0,h.g)(Z,this,n),this._useLogarithmicDepth&&(0,m.k)(o?T.materialDefines:Z.defines,Z,n),D&&(0,m.f)(n,D,Z),this._textures)Z.setTexture(G,this._textures[G]);for(G in this._textureArrays)Z.setTextureArray(G,this._textureArrays[G]);for(G in this._ints)Z.setInt(G,this._ints[G]);for(G in this._uints)Z.setUInt(G,this._uints[G]);for(G in this._floats)Z.setFloat(G,this._floats[G]);for(G in this._floatsArrays)Z.setArray(G,this._floatsArrays[G]);for(G in this._colors3)Z.setColor3(G,this._colors3[G]);for(G in this._colors3Arrays)Z.setArray3(G,this._colors3Arrays[G]);for(G in this._colors4){const D=this._colors4[G];Z.setFloat4(G,D.r,D.g,D.b,D.a)}for(G in this._colors4Arrays)Z.setArray4(G,this._colors4Arrays[G]);for(G in this._vectors2)Z.setVector2(G,this._vectors2[G]);for(G in this._vectors3)Z.setVector3(G,this._vectors3[G]);for(G in this._vectors4)Z.setVector4(G,this._vectors4[G]);for(G in this._quaternions)Z.setQuaternion(G,this._quaternions[G]);for(G in this._matrices)Z.setMatrix(G,this._matrices[G]);for(G in this._matrixArrays)Z.setMatrices(G,this._matrixArrays[G]);for(G in this._matrices3x3)Z.setMatrix3x3(G,this._matrices3x3[G]);for(G in this._matrices2x2)Z.setMatrix2x2(G,this._matrices2x2[G]);for(G in this._vectors2Arrays)Z.setArray2(G,this._vectors2Arrays[G]);for(G in this._vectors3Arrays)Z.setArray3(G,this._vectors3Arrays[G]);for(G in this._vectors4Arrays)Z.setArray4(G,this._vectors4Arrays[G]);for(G in this._quaternionsArrays)Z.setArray4(G,this._quaternionsArrays[G]);for(G in this._uniformBuffers){const D=this._uniformBuffers[G].getBuffer();D&&Z.bindUniformBuffer(D,G)}const N=n.getEngine(),C=N.setExternalTexture;if(C)for(G in this._externalTextures)C.call(N,G,this._externalTextures[G]);const r=N.setTextureSampler;if(r)for(G in this._textureSamplers)r.call(N,G,this._textureSamplers[G]);const v=N.setStorageBuffer;if(v)for(G in this._storageBuffers)v.call(N,G,this._storageBuffers[G])}if(Z&&D&&(r||!this.isFrozen)){const G=D.morphTargetManager;G&&G.numInfluencers>0&&(0,m.l)(D,Z);const N=D.bakedVertexAnimationManager;if(N&&N.isEnabled){var v;const G=o?T._drawWrapper:this._drawWrapper;null===(v=D.bakedVertexAnimationManager)||void 0===v||v.bind(Z,!!G._wasPreviouslyUsingInstances)}}this._afterBind(D,Z,T)}getActiveTextures(){const G=super.getActiveTextures();for(const D in this._textures)G.push(this._textures[D]);for(const D in this._textureArrays){const N=this._textureArrays[D];for(let D=0;D<N.length;D++)G.push(N[D])}return G}hasTexture(G){if(super.hasTexture(G))return!0;for(const D in this._textures)if(this._textures[D]===G)return!0;for(const D in this._textureArrays){const N=this._textureArrays[D];for(let D=0;D<N.length;D++)if(N[D]===G)return!0}return!1}clone(G){const D=v.e.Clone((()=>new L(G,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);D.name=G,D.id=G,"object"===typeof D._shaderPath&&(D._shaderPath={...D._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((G=>{const D=this._options[G];Array.isArray(D)&&(this._options[G]=D.slice(0))})),this.stencil.copyTo(D.stencil);for(const N in this._textures)D.setTexture(N,this._textures[N]);for(const N in this._textureArrays)D.setTextureArray(N,this._textureArrays[N]);for(const N in this._externalTextures)D.setExternalTexture(N,this._externalTextures[N]);for(const N in this._ints)D.setInt(N,this._ints[N]);for(const N in this._uints)D.setUInt(N,this._uints[N]);for(const N in this._floats)D.setFloat(N,this._floats[N]);for(const N in this._floatsArrays)D.setFloats(N,this._floatsArrays[N]);for(const N in this._colors3)D.setColor3(N,this._colors3[N]);for(const N in this._colors3Arrays)D._colors3Arrays[N]=this._colors3Arrays[N];for(const N in this._colors4)D.setColor4(N,this._colors4[N]);for(const N in this._colors4Arrays)D._colors4Arrays[N]=this._colors4Arrays[N];for(const N in this._vectors2)D.setVector2(N,this._vectors2[N]);for(const N in this._vectors3)D.setVector3(N,this._vectors3[N]);for(const N in this._vectors4)D.setVector4(N,this._vectors4[N]);for(const N in this._quaternions)D.setQuaternion(N,this._quaternions[N]);for(const N in this._quaternionsArrays)D._quaternionsArrays[N]=this._quaternionsArrays[N];for(const N in this._matrices)D.setMatrix(N,this._matrices[N]);for(const N in this._matrixArrays)D._matrixArrays[N]=this._matrixArrays[N].slice();for(const N in this._matrices3x3)D.setMatrix3x3(N,this._matrices3x3[N]);for(const N in this._matrices2x2)D.setMatrix2x2(N,this._matrices2x2[N]);for(const N in this._vectors2Arrays)D.setArray2(N,this._vectors2Arrays[N]);for(const N in this._vectors3Arrays)D.setArray3(N,this._vectors3Arrays[N]);for(const N in this._vectors4Arrays)D.setArray4(N,this._vectors4Arrays[N]);for(const N in this._uniformBuffers)D.setUniformBuffer(N,this._uniformBuffers[N]);for(const N in this._textureSamplers)D.setTextureSampler(N,this._textureSamplers[N]);for(const N in this._storageBuffers)D.setStorageBuffer(N,this._storageBuffers[N]);return D}dispose(G,D,N){if(D){let G;for(G in this._textures)this._textures[G].dispose();for(G in this._textureArrays){const D=this._textureArrays[G];for(let G=0;G<D.length;G++)D[G].dispose()}}this._textures={},super.dispose(G,D,N)}serialize(){const G=v.e.Serialize(this);let D;for(D in G.customType="BABYLON.ShaderMaterial",G.uniqueId=this.uniqueId,G.options=this._options,G.shaderPath=this._shaderPath,G.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,G.stencil=this.stencil.serialize(),G.textures={},this._textures)G.textures[D]=this._textures[D].serialize();for(D in G.textureArrays={},this._textureArrays){G.textureArrays[D]=[];const N=this._textureArrays[D];for(let T=0;T<N.length;T++)G.textureArrays[D].push(N[T].serialize())}for(D in G.ints={},this._ints)G.ints[D]=this._ints[D];for(D in G.uints={},this._uints)G.uints[D]=this._uints[D];for(D in G.floats={},this._floats)G.floats[D]=this._floats[D];for(D in G.floatsArrays={},this._floatsArrays)G.floatsArrays[D]=this._floatsArrays[D];for(D in G.colors3={},this._colors3)G.colors3[D]=this._colors3[D].vd();for(D in G.colors3Arrays={},this._colors3Arrays)G.colors3Arrays[D]=this._colors3Arrays[D];for(D in G.colors4={},this._colors4)G.colors4[D]=this._colors4[D].vd();for(D in G.colors4Arrays={},this._colors4Arrays)G.colors4Arrays[D]=this._colors4Arrays[D];for(D in G.vectors2={},this._vectors2)G.vectors2[D]=this._vectors2[D].vd();for(D in G.vectors3={},this._vectors3)G.vectors3[D]=this._vectors3[D].vd();for(D in G.vectors4={},this._vectors4)G.vectors4[D]=this._vectors4[D].vd();for(D in G.quaternions={},this._quaternions)G.quaternions[D]=this._quaternions[D].vd();for(D in G.matrices={},this._matrices)G.matrices[D]=this._matrices[D].vd();for(D in G.matrixArray={},this._matrixArrays)G.matrixArray[D]=this._matrixArrays[D];for(D in G.matrices3x3={},this._matrices3x3)G.matrices3x3[D]=this._matrices3x3[D];for(D in G.matrices2x2={},this._matrices2x2)G.matrices2x2[D]=this._matrices2x2[D];for(D in G.vectors2Arrays={},this._vectors2Arrays)G.vectors2Arrays[D]=this._vectors2Arrays[D];for(D in G.vectors3Arrays={},this._vectors3Arrays)G.vectors3Arrays[D]=this._vectors3Arrays[D];for(D in G.vectors4Arrays={},this._vectors4Arrays)G.vectors4Arrays[D]=this._vectors4Arrays[D];for(D in G.quaternionsArrays={},this._quaternionsArrays)G.quaternionsArrays[D]=this._quaternionsArrays[D];return G}static Parse(G,D,N){const o=v.e.Parse((()=>new L(G.name,D,G.shaderPath,G.options,G.storeEffectOnSubMeshes)),G,D,N);let Z;for(Z in G.stencil&&o.stencil.parse(G.stencil,D,N),G.textures)o.setTexture(Z,g.e.Parse(G.textures[Z],D,N));for(Z in G.textureArrays){const T=G.textureArrays[Z],n=[];for(let G=0;G<T.length;G++)n.push(g.e.Parse(T[G],D,N));o.setTextureArray(Z,n)}for(Z in G.ints)o.setInt(Z,G.ints[Z]);for(Z in G.uints)o.setUInt(Z,G.uints[Z]);for(Z in G.floats)o.setFloat(Z,G.floats[Z]);for(Z in G.floatsArrays)o.setFloats(Z,G.floatsArrays[Z]);for(Z in G.colors3)o.setColor3(Z,n.d.od(G.colors3[Z]));for(Z in G.colors3Arrays){const D=G.colors3Arrays[Z].reduce(((G,D,N)=>(N%3===0?G.push([D]):G[G.length-1].push(D),G)),[]).map((G=>n.d.od(G)));o.setColor3Array(Z,D)}for(Z in G.colors4)o.setColor4(Z,n.g.od(G.colors4[Z]));for(Z in G.colors4Arrays){const D=G.colors4Arrays[Z].reduce(((G,D,N)=>(N%4===0?G.push([D]):G[G.length-1].push(D),G)),[]).map((G=>n.g.od(G)));o.setColor4Array(Z,D)}for(Z in G.vectors2)o.setVector2(Z,T.o.od(G.vectors2[Z]));for(Z in G.vectors3)o.setVector3(Z,T.s.od(G.vectors3[Z]));for(Z in G.vectors4)o.setVector4(Z,T.v.od(G.vectors4[Z]));for(Z in G.quaternions)o.setQuaternion(Z,T.g.od(G.quaternions[Z]));for(Z in G.matrices)o.setMatrix(Z,T.c.od(G.matrices[Z]));for(Z in G.matrixArray)o._matrixArrays[Z]=new Float32Array(G.matrixArray[Z]);for(Z in G.matrices3x3)o.setMatrix3x3(Z,G.matrices3x3[Z]);for(Z in G.matrices2x2)o.setMatrix2x2(Z,G.matrices2x2[Z]);for(Z in G.vectors2Arrays)o.setArray2(Z,G.vectors2Arrays[Z]);for(Z in G.vectors3Arrays)o.setArray3(Z,G.vectors3Arrays[Z]);for(Z in G.vectors4Arrays)o.setArray4(Z,G.vectors4Arrays[Z]);for(Z in G.quaternionsArrays)o.setArray4(Z,G.quaternionsArrays[Z]);return o}static ParseFromFileAsync(G,D,N){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((o,Z)=>{const n=new j.e;n.addEventListener("readystatechange",(()=>{if(4==n.readyState)if(200==n.status){const D=JSON.parse(n.responseText),Z=this.Parse(D,N||y.e.LastCreatedScene,T);G&&(Z.name=G),o(Z)}else Z("Unable to load the ShaderMaterial")})),n.open("GET",D),n.send()}))}static ParseFromSnippetAsync(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((T,o)=>{const Z=new j.e;Z.addEventListener("readystatechange",(()=>{if(4==Z.readyState)if(200==Z.status){const o=JSON.parse(JSON.parse(Z.responseText).jsonPayload),n=JSON.parse(o.shaderMaterial),C=this.Parse(n,D||y.e.LastCreatedScene,N);C.snippetId=G,T(C)}else o("Unable to load the snippet "+G)})),Z.open("GET",this.SnippetUrl+"/"+G.replace(/#/g,"/")),Z.send()}))}}L.SnippetUrl="https://snippet.babylonjs.com",L.CreateFromSnippetAsync=L.ParseFromSnippetAsync,(0,X.h)("BABYLON.ShaderMaterial",L),o.d._LinesMeshParser=(G,D)=>w.Parse(G,D);class w extends o.d{_isShaderMaterial(G){return"ShaderMaterial"===G.getClassName()}constructor(G){let D=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,T=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,Z=arguments.length>7?arguments[7]:void 0;super(G,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,D,arguments.length>4?arguments[4]:void 0),this.useVertexColor=T,this.useVertexAlpha=o,this.color=new n.d(1,1,1),this.alpha=1,this._shaderLanguage=0,D&&(this.color=D.color.clone(),this.alpha=D.alpha,this.useVertexColor=D.useVertexColor,this.useVertexAlpha=D.useVertexAlpha),this.intersectionThreshold=.1;const P={attributes:[C.f.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===o?P.needAlphaBlending=!1:P.defines.push("#define VERTEXALPHA"),T?(P.defines.push("#define VERTEXCOLOR"),P.attributes.push(C.f.ColorKind)):(P.uniforms.push("color"),this._color4=new n.g),Z)this.material=Z;else{this.va().getEngine().isWebGPU&&!w.ForceGLSL&&(this._shaderLanguage=1),P.shaderLanguage=this._shaderLanguage,P.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([N.e(19).then(N.bind(N,12402)),N.e(48).then(N.bind(N,12411))]):await Promise.all([N.e(26).then(N.bind(N,12419)),N.e(49).then(N.bind(N,12428))])},this.material=new L("colorShader",this.va(),"color",P,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(G){this._lineMaterial=G,this._lineMaterial.fillMode=r.d.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(G){}_bind(G,D){if(!this._geometry)return this;const N=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(D,N):this._geometry._bind(D,N,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:G,g:D,b:N}=this.color;this._color4.set(G,D,N,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(G,D,N){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const T=this.va().getEngine();return this._unIndexed?T.drawArraysType(r.d.LineListDrawMode,G.verticesStart,G.verticesCount,N):T.drawElementsType(r.d.LineListDrawMode,G.indexStart,G.indexCount,N),this}dispose(G){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(G)}clone(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0;return new w(G,this.va(),D,this,N)}nb(G){const D=new B(G,this);if(this.instancedBuffers){D.instancedBuffers={};for(const G in this.instancedBuffers)D.instancedBuffers[G]=this.instancedBuffers[G]}return D}serialize(G){super.serialize(G),G.color=this.color.vd(),G.alpha=this.alpha}static Parse(G,D){const N=new w(G.name,D);return N.color=n.d.od(G.color),N.alpha=G.alpha,N}}w.ForceGLSL=!1;class B extends P.d{constructor(G,D){super(G,D),this.intersectionThreshold=D.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var F=N(1105);function S(G){const D=[],N=[],T=G.lines,o=G.za,n=[];let C=0;for(let Z=0;Z<T.length;Z++){const G=T[Z];for(let T=0;T<G.length;T++){const{x:P,y:r,z:v}=G[T];if(N.push(P,r,v),o){const G=o[Z],{r:D,g:N,b:C,a:P}=G[T];n.push(D,N,C,P)}T>0&&(D.push(C-1),D.push(C)),C++}}const P=new Z.c;return P.indices=D,P.xa=N,o&&(P.za=n),P}function V(G){const D=G.dashSize||3,N=G.gapSize||1,o=G.dashNb||200,n=G.points,C=[],P=[],r=T.s.Zero();let v=0,q=0,g=0,X=0,W=0,j=0,Y=0;for(Y=0;Y<n.length-1;Y++)n[Y+1].subtractToRef(n[Y],r),v+=r.length();for(g=v/o,X=D*g/(D+N),Y=0;Y<n.length-1;Y++){n[Y+1].subtractToRef(n[Y],r),q=Math.floor(r.length()/g),r.normalize();for(let G=0;G<q;G++)W=g*G,C.push(n[Y].x+W*r.x,n[Y].y+W*r.y,n[Y].z+W*r.z),C.push(n[Y].x+(W+X)*r.x,n[Y].y+(W+X)*r.y,n[Y].z+(W+X)*r.z),P.push(j,j+1),j+=2}const y=new Z.c;return y.xa=C,y.indices=P,y}function U(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=D.instance,o=D.lines,Z=D.za;if(T){const G=T.getVerticesData(C.f.PositionKind);let D,N;Z&&(D=T.getVerticesData(C.f.ColorKind));let n=0,P=0;for(let T=0;T<o.length;T++){const C=o[T];for(let o=0;o<C.length;o++)G[n]=C[o].x,G[n+1]=C[o].y,G[n+2]=C[o].z,Z&&D&&(N=Z[T],D[P]=N[o].r,D[P+1]=N[o].g,D[P+2]=N[o].b,D[P+3]=N[o].a,P+=4),n+=3}return T.updateVerticesData(C.f.PositionKind,G,!1,!1),Z&&D&&T.updateVerticesData(C.f.ColorKind,D,!1,!1),T.refreshBoundingInfo(),T}const n=new w(G,N,null,void 0,void 0,!!Z,D.useVertexAlpha,D.material);return S(D).Ca(n,D.updatable),n}function z(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=D.za?[D.za]:null;return U(G,{lines:[D.points],updatable:D.updatable,instance:D.instance,za:T,useVertexAlpha:D.useVertexAlpha,material:D.material},N)}function i(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=D.points,n=D.instance,C=D.gapSize||1,P=D.dashSize||3;if(n){const G=G=>{const D=T.s.Zero(),N=G.length/6;let o=0,C=0,P=0,r=0,v=0,q=0,g=0,X=0;for(g=0;g<Z.length-1;g++)Z[g+1].subtractToRef(Z[g],D),o+=D.length();P=o/N;const W=n._creationDataStorage.dashSize;for(r=W*P/(W+n._creationDataStorage.gapSize),g=0;g<Z.length-1;g++)for(Z[g+1].subtractToRef(Z[g],D),C=Math.floor(D.length()/P),D.normalize(),X=0;X<C&&q<G.length;)v=P*X,G[q]=Z[g].x+v*D.x,G[q+1]=Z[g].y+v*D.y,G[q+2]=Z[g].z+v*D.z,G[q+3]=Z[g].x+(v+r)*D.x,G[q+4]=Z[g].y+(v+r)*D.y,G[q+5]=Z[g].z+(v+r)*D.z,q+=6,X++;for(;q<G.length;)G[q]=Z[g].x,G[q+1]=Z[g].y,G[q+2]=Z[g].z,q+=3};return(D.dashNb||D.dashSize||D.gapSize||D.useVertexAlpha||D.material)&&F.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),n.updateMeshPositions(G,!1),n}const r=new w(G,N,null,void 0,void 0,void 0,D.useVertexAlpha,D.material);return V(D).Ca(r,D.updatable),r._creationDataStorage=new o.g,r._creationDataStorage.dashSize=P,r._creationDataStorage.gapSize=C,r}Z.c.CreateLineSystem=S,Z.c.CreateDashedLines=V,o.d.lb=function(G,D){return z(G,{points:D,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},o.d.CreateDashedLines=function(G,D,N,T,o){return i(G,{points:D,dashSize:N,gapSize:T,dashNb:o,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11496:(G,D,N)=>{"use strict";N.d(D,{c:()=>C,f:()=>P});var T=N(11378),o=N(11407),Z=N(1199);function n(G){const D=[],N=[],T=[],n=[],C=G.width||G.size||1,P=G.height||G.size||1,r=0===G.sideOrientation?0:G.sideOrientation||o.c.DEFAULTSIDE,v=C/2,q=P/2;N.push(-v,-q,0),T.push(0,0,-1),n.push(0,Z.c?1:0),N.push(v,-q,0),T.push(0,0,-1),n.push(1,Z.c?1:0),N.push(v,q,0),T.push(0,0,-1),n.push(1,Z.c?0:1),N.push(-v,q,0),T.push(0,0,-1),n.push(0,Z.c?0:1),D.push(0),D.push(1),D.push(2),D.push(0),D.push(2),D.push(3),o.c._ComputeSides(r,N,D,T,n,G.frontUVs,G.backUVs);const g=new o.c;return g.indices=D,g.xa=N,g.ya=T,g.Aa=n,g}function C(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new T.d(G,N);D.sideOrientation=T.d._GetDefaultSideOrientation(D.sideOrientation),o._originalBuilderSideOrientation=D.sideOrientation;return n(D).Ca(o,D.updatable),D.sourcePlane&&(o.translate(D.sourcePlane.Bd,-D.sourcePlane.d),o.setDirection(D.sourcePlane.Bd.scale(-1))),o}const P={Mg:C};o.c.Mg=n,T.d.Mg=(G,D,N,T,o)=>C(G,{size:D,width:D,height:D,sideOrientation:o,updatable:T},N)},11536:(G,D,N)=>{"use strict";N.d(D,{d:()=>P});var T=N(1009),o=N(11378),Z=N(11407),n=N(1199);function C(G){const D=0|(G.segments||32),N=G.diameterX||G.diameter||1,o=G.diameterY||G.diameter||1,C=G.diameterZ||G.diameter||1,P=G.arc&&(G.arc<=0||G.arc>1)?1:G.arc||1,r=G.slice&&G.slice<=0?1:G.slice||1,v=0===G.sideOrientation?0:G.sideOrientation||Z.c.DEFAULTSIDE,q=!!G.dedupTopBottomIndices,g=new T.s(N/2,o/2,C/2),X=2+D,W=2*X,j=[],Y=[],y=[],h=[];for(let Z=0;Z<=X;Z++){const G=Z/X,D=G*Math.PI*r;for(let N=0;N<=W;N++){const o=N/W,Z=o*Math.PI*2*P,C=T.c.RotationZ(-D),r=T.c.RotationY(Z),v=T.s.TransformCoordinates(T.s.Up(),C),q=T.s.TransformCoordinates(v,r),X=q.multiply(g),j=q.divide(g).normalize();Y.push(X.x,X.y,X.z),y.push(j.x,j.y,j.z),h.push(o,n.c?1-G:G)}if(Z>0){const G=Y.length/3;for(let D=G-2*(W+1);D+W+2<G;D++)q?(Z>1&&(j.push(D),j.push(D+1),j.push(D+W+1)),(Z<X||r<1)&&(j.push(D+W+1),j.push(D+1),j.push(D+W+2))):(j.push(D),j.push(D+1),j.push(D+W+1),j.push(D+W+1),j.push(D+1),j.push(D+W+2))}}Z.c._ComputeSides(v,Y,j,y,h,G.frontUVs,G.backUVs);const m=new Z.c;return m.indices=j,m.xa=Y,m.ya=y,m.Aa=h,m}function P(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new o.d(G,N);D.sideOrientation=o.d._GetDefaultSideOrientation(D.sideOrientation),T._originalBuilderSideOrientation=D.sideOrientation;return C(D).Ca(T,D.updatable),T}Z.c.CreateSphere=C,o.d.CreateSphere=(G,D,N,T,o,Z)=>P(G,{segments:D,diameterX:N,diameterY:N,diameterZ:N,sideOrientation:Z,updatable:o},T)},11774:(G,D,N)=>{"use strict";N.d(D,{c:()=>q});var T=N(1223),o=N(10351),Z=N(11412),n=N(1255),C=N(11407),P=N(1105);function r(G,D,N,T,o){let Z=null,n=null,C=null;try{let P;Z=new G.Decoder,n=new G.DecoderBuffer,n.Init(D,D.byteLength);const r=Z.GetEncodedGeometryType(n);switch(r){case G.TRIANGULAR_MESH:{const D=new G.Mesh;if(P=Z.DecodeBufferToMesh(n,D),!P.ok()||0===D.ptr)throw new Error(P.error_msg());const N=3*D.num_faces(),o=4*N,r=G._malloc(o);try{Z.GetTrianglesUInt32Array(D,o,r);const n=new Uint32Array(N);n.set(new Uint32Array(G.HEAPF32.buffer,r,N)),T(n)}finally{G._free(r)}C=D;break}case G.POINT_CLOUD:{const D=new G.PointCloud;if(P=Z.DecodeBufferToPointCloud(n,D),!P.ok()||!D.ptr)throw new Error(P.error_msg());C=D;break}default:throw new Error(`Invalid geometry type ${r}`)}const v=C.num_points(),q=(D,N,T,Z)=>{const n=Z.data_type(),C=Z.num_components(),P=Z.normalized(),r=Z.byte_stride(),q=Z.byte_offset(),g={[G.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:G.HEAPF32},[G.DT_INT8]:{typedArrayConstructor:Int8Array,heap:G.HEAP8},[G.DT_INT16]:{typedArrayConstructor:Int16Array,heap:G.HEAP16},[G.DT_INT32]:{typedArrayConstructor:Int32Array,heap:G.HEAP32},[G.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:G.HEAPU8},[G.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:G.HEAPU16},[G.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:G.HEAPU32}}[n];if(!g)throw new Error(`Invalid data type ${n}`);const X=v*C,W=X*g.typedArrayConstructor.BYTES_PER_ELEMENT,j=G._malloc(W);try{D.GetAttributeDataArrayForAllPoints(N,Z,n,W,j);const G=new g.typedArrayConstructor(g.heap.buffer,j,X);o(T,G.slice(),C,q,r,P)}finally{G._free(j)}};if(N)for(const G in N){const D=N[G],T=Z.GetAttributeByUniqueId(C,D);q(Z,C,G,T)}else{const D={position:G.POSITION,Bd:G.NORMAL,color:G.COLOR,uv:G.TEX_COORD};for(const G in D){const N=Z.GetAttributeId(C,D[G]);if(-1!==N){const D=Z.GetAttribute(C,N);q(Z,C,G,D)}}}return v}finally{C&&G.destroy(C),n&&G.destroy(n),Z&&G.destroy(Z)}}function v(){let G;onmessage=D=>{const N=D.data;switch(N.id){case"init":{const D=N.decoder;D.url&&importScripts(D.url);const T=D.wasmBinary?{wasmBinary:D.wasmBinary}:{};G=DracoDecoderModule(T),postMessage({id:"initDone"});break}case"decodeMesh":if(!G)throw new Error("Draco decoder module is not available");G.then((G=>{const D=r(G,N.dataView,N.attributes,(G=>{postMessage({id:"indices",data:G},[G.buffer])}),((G,D,N,T,o,Z)=>{postMessage({id:"attribute",kind:G,data:D,size:N,byteOffset:T,byteStride:o,normalized:Z},[D.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:D})}))}}}class q{static get DecoderAvailable(){const G=q.Configuration.decoder;return!!(G.wasmUrl&&G.wasmBinaryUrl&&"object"===typeof WebAssembly||G.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return q._Default||(q._Default=new q),q._Default}static ResetDefault(G){q._Default&&(G||q._Default.dispose(),q._Default=null)}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.DefaultNumWorkers;const D=q.Configuration.decoder;if(D.workerPool||"object"===typeof G&&G.workerPool)this._workerPoolPromise=Promise.resolve(D.workerPool||G.workerPool);else{const N=D.wasmBinary||"object"===typeof G&&G.wasmBinary,Z="number"===typeof G?G:G.numWorkers,n=Z&&"function"===typeof Worker&&"function"===typeof URL,C=n||!n&&!D.jsModule,P=D.wasmUrl&&D.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:C?T.f.GetBabylonScriptURL(D.wasmUrl,!0):"",wasmBinaryPromise:N?Promise.resolve(N):T.f.LoadFileAsync(T.f.GetBabylonScriptURL(D.wasmBinaryUrl,!0))}:{url:C?T.f.GetBabylonScriptURL(D.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};n?this._workerPoolPromise=P.wasmBinaryPromise.then((G=>{const D=`${r}(${v})()`,N=URL.createObjectURL(new Blob([D],{type:"application/javascript"}));return new o.e(Z,(()=>function(G,D,N){return new Promise(((T,o)=>{const Z=D=>{G.removeEventListener("error",Z),G.removeEventListener("message",n),o(D)},n=D=>{"initDone"===D.data.id&&(G.removeEventListener("error",Z),G.removeEventListener("message",n),T(G))};if(G.addEventListener("error",Z),G.addEventListener("message",n),D){const T=D.slice(0);G.postMessage({id:"init",decoder:{url:N,wasmBinary:T}},[T])}else G.postMessage({id:"init",decoder:{url:N}})}))}(new Worker(N),G,P.url)))})):this._decoderModulePromise=P.wasmBinaryPromise.then((async G=>{if("undefined"===typeof DracoDecoderModule&&!D.jsModule){if(!P.url)throw new Error("Draco decoder module is not available");await T.f.LoadBabylonScriptAsync(P.url)}return await(N=G,o=D.jsModule,new Promise((G=>{(o||DracoDecoderModule)({wasmBinary:N}).then((D=>{G({module:D})}))})));var N,o}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((G=>{G.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(G,D,N){const T=G instanceof ArrayBuffer?new Int8Array(G):new Int8Array(G.buffer,G.byteOffset,G.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((G=>new Promise(((o,Z)=>{G.push(((G,n)=>{let C=null;const r=[],v=D=>{G.removeEventListener("error",v),G.removeEventListener("message",q),Z(D),n()},q=D=>{const T=D.data;switch(T.id){case"decodeMeshDone":G.removeEventListener("error",v),G.removeEventListener("message",q),o({indices:C,attributes:r,totalVertices:T.totalVertices}),n();break;case"indices":C=T.data;break;case"attribute":r.push({kind:T.kind,data:T.data,size:T.size,byteOffset:T.byteOffset,byteStride:T.byteStride,normalized:(Z=T.kind,g=T.normalized,N&&void 0!==N[Z]?(g!==N[Z]&&P.d.Warn(`Normalized flag from Draco data (${g}) does not match normalized flag from glTF accessor (${N[Z]}). Using flag from glTF accessor.`),N[Z]):g)})}var Z,g};G.addEventListener("error",v),G.addEventListener("message",q);const g=T.slice();G.postMessage({id:"decodeMesh",dataView:g,attributes:D},[g.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((G=>{let N=null;const o=[],Z=r(G.module,T,D,(G=>{N=G}),((G,D,N,T,Z,n)=>{o.push({kind:G,data:D,size:N,byteOffset:T,byteStride:Z,normalized:n})}));return{indices:N,attributes:o,totalVertices:Z}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(G,D,N,T){const o=await this.decodeMeshToMeshDataAsync(N,T),C=new Z.d(G,D);o.indices&&C.setIndices(o.indices);for(const Z of o.attributes)C.setVerticesBuffer(new n.f(D.getEngine(),Z.data,Z.kind,!1,void 0,Z.byteStride,void 0,Z.byteOffset,Z.size,void 0,Z.normalized,!0),o.totalVertices);return C}async _decodeMeshToGeometryForGltfAsync(G,D,N,T,o){const C=await this.decodeMeshToMeshDataAsync(N,T,o),P=new Z.d(G,D);C.indices&&P.setIndices(C.indices);for(const Z of C.attributes)P.setVerticesBuffer(new n.f(D.getEngine(),Z.data,Z.kind,!1,void 0,Z.byteStride,void 0,Z.byteOffset,Z.size,void 0,Z.normalized,!0),C.totalVertices);return P}async decodeMeshAsync(G,D){const N=await this.decodeMeshToMeshDataAsync(G,D),T=new C.c;N.indices&&(T.indices=N.indices);for(const o of N.attributes){const G=n.f.GetFloatData(o.data,o.size,n.f.GetDataType(o.data),o.byteOffset,o.byteStride,o.normalized,N.totalVertices);T.set(G,o.kind)}return T}}q.Configuration={decoder:{wasmUrl:`${T.f._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${T.f._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${T.f._DefaultCdnUrl}/draco_decoder_gltf.js`}},q.DefaultNumWorkers=q.GetDefaultNumWorkers(),q._Default=null},11428:(G,D,N)=>{"use strict";N.d(D,{d:()=>B});var T=N(980),o=N(1003),Z=N(1009),n=N(1255),C=N(11407),P=N(11437),r=N(1252),v=N(1347),q=N(1246);class g{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new Z.s(0,0,0),this._diffPositionForCollisions=new Z.s(0,0,0),this._collisionResponse=!0}}var X=N(1094),W=N(1365),j=N(1185),Y=N(1012),y=N(1477),h=N(1018),m=N(985),R=N(1122);class L{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=Z.s.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class w{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new L,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new g,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class B extends P.e{static get BILLBOARDMODE_NONE(){return P.e.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return P.e.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return P.e.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return P.e.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return P.e.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return P.e.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(G){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=G}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(G){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=G}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(G){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=G}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(G){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=G}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(G){this._internalAbstractMeshDataInfo._collisionRetryCount=G}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(G){this._internalAbstractMeshDataInfo._morphTargetManager!==G&&(this._internalAbstractMeshDataInfo._morphTargetManager=G,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(G){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==G&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=G,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(G){return!!super._updateNonUniformScalingState(G)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(G){this._internalAbstractMeshDataInfo._rawBoundingInfo=G}set Jk(G){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(G)}set onCollisionPositionChange(G){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(G)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(G){if(this._internalAbstractMeshDataInfo._visibility===G)return;const D=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=G,(1===D&&1!==G||1!==D&&1===G)&&this._markSubMeshesAsDirty((G=>{G.markAsMiscDirty(),G.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(G){this._internalAbstractMeshDataInfo._inheritVisibility=G}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let G=this._parentNode;for(;G;){const D=G.isVisible;if("undefined"!==typeof D)return D;G=G.parent}}return this._isVisible}set isVisible(G){this._isVisible=G}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(G){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=G}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(G){this._internalAbstractMeshDataInfo._renderingGroupId=G}get material(){return this._internalAbstractMeshDataInfo._material}set material(G){this._setMaterial(G)}_setMaterial(G){this._internalAbstractMeshDataInfo._material!==G&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=G,G&&G.meshMap&&(G.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.le&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(G){var D;return null===(D=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===D?void 0:D[G]}setMaterialForRenderPass(G,D){this.resetDrawCache(G),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[G]=D}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(G){this._internalAbstractMeshDataInfo._receiveShadows!==G&&(this._internalAbstractMeshDataInfo._receiveShadows=G,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(G){this._internalAbstractMeshDataInfo._hasVertexAlpha!==G&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=G,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(G){this._internalAbstractMeshDataInfo._useVertexColors!==G&&(this._internalAbstractMeshDataInfo._useVertexColors=G,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(G){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==G&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=G,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(G){this._internalAbstractMeshDataInfo._numBoneInfluencers!==G&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=G,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(G){this._internalAbstractMeshDataInfo._applyFog!==G&&(this._internalAbstractMeshDataInfo._applyFog=G,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(G){this._internalAbstractMeshDataInfo._enableDistantPicking=G}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(G){G!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=G,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(G){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(G)?-1:G}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(G){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=G}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(G){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(G)?-1:G}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(G){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=G}get lightSources(){return this._lightSources}set skeleton(G){const D=this._internalAbstractMeshDataInfo._skeleton;D&&D.needInitialSkinMatrix&&D._unregisterMeshWithPoseMatrix(this),G&&G.needInitialSkinMatrix&&G._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=G,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(G){var D;let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(G,N,!1),D=this,this._internalAbstractMeshDataInfo=new w,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Le=B.Si,this.onCollideObservable=new o.b,this.onCollisionPositionChangeObservable=new o.b,this.onMaterialChangedObservable=new o.b,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Ud=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=j.d.Red(),this.outlineWidth=.02,this.overlayColor=j.d.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.ue=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new Z.s(.5,1,.5),this.ellipsoidOffset=new Z.s(0,0,0),this.edgesWidth=1,this.edgesColor=new j.g(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,ei:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new o.b,this._onCollisionPositionChange=function(G,N){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;N.subtractToRef(D._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,D._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),D._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>R.b.CollisionsEpsilon&&D.position.addInPlace(D._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),T&&D.onCollideObservable.notifyObservers(T),D.onCollisionPositionChangeObservable.notifyObservers(D.position)},N=this.va(),N.qe(this),this._resyncLightSources(),this._uniformBuffer=new q.b(this.va().getEngine(),void 0,void 0,G,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),N.performancePriority){case 2:this.Da=!0;case 1:this.ue=!0,this.Ud=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(G){const D=this._uniformBuffer;D.Rd("world",G),D.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),D.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(G){let D="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");D+=", # of submeshes: "+(this.le?this.le.length:0);const N=this._internalAbstractMeshDataInfo._skeleton;return N&&(D+=", skeleton: "+N.name),G&&(D+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],D+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.ei?"YES":"NO")),D}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==P.e.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(D||this.actionManager.isRecursive)){if(!G)return this.actionManager;if(this.actionManager.hasSpecificTrigger(G))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(G,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.le){for(const G of this.le)G._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const G of this.va().lights)G.isEnabled()&&G.canAffectMesh(this)&&this._lightSources.push(G);this._markSubMeshesAsLightDirty()}_resyncLightSource(G){const D=G.isEnabled()&&G.canAffectMesh(this),N=this._lightSources.indexOf(G);let T=!1;if(-1===N){if(!D)return;this._lightSources.push(G)}else{if(D)return;T=!0,this._lightSources.splice(N,1)}this._markSubMeshesAsLightDirty(T)}_unBindEffect(){for(const G of this.le)G.setEffect(null)}_removeLightSource(G,D){const N=this._lightSources.indexOf(G);-1!==N&&(this._lightSources.splice(N,1),this._markSubMeshesAsLightDirty(D))}_markSubMeshesAsDirty(G){if(this.le)for(const D of this.le)for(let N=0;N<D._drawWrappers.length;++N){const T=D._drawWrappers[N];T&&T.defines&&T.defines.markAllAsDirty&&G(T.defines)}}_markSubMeshesAsLightDirty(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((D=>D.markAsLightDirty(G)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((G=>G.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((G=>G.markAsMiscDirty()))}we(G){return this._currentRenderId=Number.MAX_VALUE,super.we(G),this._isDirty=!0,this}resetDrawCache(G){if(this.le)for(const D of this.le)D.resetDrawCache(G)}get isBlocked(){return!1}getLOD(G){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}ye(){return null}getVerticesData(G){return null}Ga(G,D,N,T){return this}updateVerticesData(G,D,N,T){return this}setIndices(G,D){return this}isVerticesDataPresent(G){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(G){return this._boundingInfo=G,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(G,D,N){return this._boundingInfo=new v.e(G,D,N),this._boundingInfo}normalizeToUnitCube(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(G,D,N)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(n.f.MatricesIndicesKind)&&this.isVerticesDataPresent(n.f.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(G){}_activate(G,D){return this._renderId=G,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===P.e.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(G,D,N){return this.position.addInPlace(this.calcMovePOV(G,D,N)),this}calcMovePOV(G,D,N){const T=new Z.c;(this.rotationQuaternion?this.rotationQuaternion:Z.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(T);const o=Z.s.Zero(),n=this.definedFacingForward?-1:1;return Z.s.TransformCoordinatesFromFloatsToRef(G*n,D,N*n,T,o),o}rotatePOV(G,D,N){return this.rotation.addInPlace(this.calcRotatePOV(G,D,N)),this}calcRotatePOV(G,D,N){const T=this.definedFacingForward?1:-1;return new Z.s(G*T,D,N*T)}Fa(G,D){if(G){const N=(0,W.e)(G,0,this.getTotalVertices(),D);this._boundingInfo?this._boundingInfo.reConstruct(N.minimum,N.maximum):this._boundingInfo=new v.e(N.minimum,N.maximum)}if(this.le)for(let N=0;N<this.le.length;N++)this.le[N].refreshBoundingInfo(G);this.Ea()}_refreshBoundingInfoDirect(G){if(this._boundingInfo?this._boundingInfo.reConstruct(G.minimum,G.maximum):this._boundingInfo=new v.e(G.minimum,G.maximum),this.le)for(let D=0;D<this.le.length;D++)this.le[D].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(G,D,N,T,o,C,P){!function(G,D,N,T,o,C,P){const r=Z.k.Ad[0],v=Z.k.Matrix[0],q=Z.k.Matrix[1],g=D===n.f.NormalKind?Z.s.TransformNormalFromFloatsToRef:Z.s.TransformCoordinatesFromFloatsToRef;for(let n=0,X=0;n<G.length;n+=3,X+=4){let D,W;for(v.reset(),D=0;D<4;D++)W=o[X+D],W>0&&(Z.c.FromFloat32ArrayToRefScaled(N,Math.floor(16*T[X+D]),W,q),v.addToSelf(q));if(C&&P)for(D=0;D<4;D++)W=P[X+D],W>0&&(Z.c.FromFloat32ArrayToRefScaled(N,Math.floor(16*C[X+D]),W,q),v.addToSelf(q));g(G[n],G[n+1],G[n+2],v,r),r.toArray(G,n)}}(G,D,N,T,o,C,P)}_getData(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.f.PositionKind;const T=G.cache,o=G=>{if(T){const D=T._vertexData||(T._vertexData={});return D[G]||this.copyVerticesData(G,D),D[G]}return this.getVerticesData(G)};if(D||(D=o(N)),!D)return null;if(T?(T._outputData?T._outputData.set(D):T._outputData=new Float32Array(D),D=T._outputData):(G.applyMorph&&this.morphTargetManager||G.applySkeleton&&this.skeleton)&&(D=D.slice()),G.applyMorph&&this.morphTargetManager&&function(G,D,N){let T=null;switch(D){case n.f.PositionKind:T=G=>G.getPositions();break;case n.f.NormalKind:T=G=>G.getNormals();break;case n.f.TangentKind:T=G=>G.getTangents();break;case n.f.UVKind:T=G=>G.getUVs();break;default:return}for(let o=0;o<G.length;o++){let D=G[o];for(let Z=0;Z<N.numTargets;Z++){const n=N.getTarget(Z),C=n.influence;if(0!==C){const N=T(n);N&&(D+=(N[o]-G[o])*C)}}G[o]=D}}(D,N,this.morphTargetManager),G.applySkeleton&&this.skeleton){const G=o(n.f.MatricesIndicesKind),T=o(n.f.MatricesWeightsKind);if(T&&G){const Z=this.numBoneInfluencers>4,C=Z?o(n.f.MatricesIndicesExtraKind):null,P=Z?o(n.f.MatricesWeightsExtraKind):null,r=this.skeleton.getTransformMatrices(this);B._ApplySkeleton(D,N,r,G,T,C,P)}}if(!1!==G.updatePositionsArray&&N===n.f.PositionKind){const G=this._internalAbstractMeshDataInfo._positions||[],N=G.length;if(G.length=D.length/3,N<G.length)for(let D=N;D<G.length;D++)G[D]=new Z.s;for(let T=0,o=0;T<G.length;T++,o+=3)G[T].xd(D[o],D[o+1],D[o+2]);this._internalAbstractMeshDataInfo._positions=G}return D}getNormalsData(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:G,applyMorph:D,updatePositionsArray:!1},null,n.f.NormalKind)}Tf(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:G,applyMorph:D,updatePositionsArray:!1},N,n.f.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new v.e(Z.s.Zero(),Z.s.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(G){if(!this.le)return this;const D=this.le.length;for(let N=0;N<D;N++){const T=this.le[N];(D>1||!T.IsGlobal)&&T.updateBoundingInfo(G)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(G){return this.getBoundingInfo().isInFrustum(G,this.Le)}isCompletelyInFrustum(G){return this.getBoundingInfo().isCompletelyInFrustum(G)}intersectsMesh(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2?arguments[2]:void 0;const T=this.getBoundingInfo(),o=G.getBoundingInfo();if(T.intersects(o,D))return!0;if(N)for(const Z of this.getChildMeshes())if(Z.intersectsMesh(G,D,!0))return!0;return!1}intersectsPoint(G){return this.getBoundingInfo().intersectsPoint(G)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(G){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=G}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(G){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const D=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=D.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,D.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,G,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(G,D,N){var T;if(this._generatePointsArray(),!this._positions)return this;if(!G._lastColliderWorldVertices||!G._lastColliderTransformMatrix.equals(D)){G._lastColliderTransformMatrix=D.clone(),G._lastColliderWorldVertices=[],G._trianglePlanes=[];const N=G.verticesStart,T=G.verticesStart+G.verticesCount;for(let o=N;o<T;o++)G._lastColliderWorldVertices.push(Z.s.TransformCoordinates(this._positions[o],D))}return N._collide(G._trianglePlanes,G._lastColliderWorldVertices,this.ye(),G.indexStart,G.indexStart+G.indexCount,G.verticesStart,!!G.Ha(),this,this._shouldConvertRHS(),7===(null===(T=G.Ha())||void 0===T?void 0:T.fillMode)),this}_processCollisionsForSubMeshes(G,D){const N=this._scene.getCollidingSubMeshCandidates(this,G),T=N.length;for(let o=0;o<T;o++){const Z=N.data[o];T>1&&!Z._checkCollision(G)||this._collideForSubMesh(Z,D,G)}return this}_shouldConvertRHS(){return!1}_checkCollision(G){if(!this.getBoundingInfo()._checkCollision(G))return this;const D=Z.k.Matrix[0],N=Z.k.Matrix[1];return Z.c.ScalingToRef(1/G._radius.x,1/G._radius.y,1/G._radius.z,D),this.worldMatrixFromCache.multiplyToRef(D,N),this._processCollisionsForSubMeshes(G,N),this}_generatePointsArray(){return!1}intersects(G,D,N){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const C=new r.b,P=this.getClassName(),v="InstancedLinesMesh"===P||"LinesMesh"===P||"GreasedLineMesh"===P?this.intersectionThreshold:0,q=this.getBoundingInfo();if(!this.le)return C;if(!n&&(!G.intersectsSphere(q.boundingSphere,v)||!G.intersectsBox(q.boundingBox,v)))return C;if(T)return C.hit=!n,C.pickedMesh=n?null:this,C.distance=n?0:Z.s.Distance(G.origin,q.boundingSphere.center),C.subMeshId=0,C;if(!this._generatePointsArray())return C;let g=null;const X=this._scene.getIntersectingSubMeshCandidates(this,G),W=X.length;let j=!1;for(let Z=0;Z<W;Z++){const G=X.data[Z].Ha();if(G&&(7==G.fillMode||0==G.fillMode||1==G.fillMode||2==G.fillMode||4==G.fillMode)){j=!0;break}}if(!j)return C.hit=!0,C.pickedMesh=this,C.distance=Z.s.Distance(G.origin,q.boundingSphere.center),C.subMeshId=-1,C;for(let Z=0;Z<W;Z++){const T=X.data[Z];if(W>1&&!n&&!T.canIntersects(G))continue;const o=T.intersects(G,this._positions,this.ye(),D,N);if(o&&(D||!g||o.distance<g.distance)&&(g=o,g.subMeshId=Z,D))break}if(g){const D=o??this.getWorldMatrix(),N=Z.k.Ad[0],T=Z.k.Ad[1];Z.s.TransformCoordinatesToRef(G.origin,D,N),G.direction.scaleToRef(g.distance,T);const n=Z.s.TransformNormal(T,D).addInPlace(N);return C.hit=!0,C.distance=Z.s.Distance(N,n),C.pickedPoint=n,C.pickedMesh=this,C.bu=g.bu||0,C.bv=g.bv||0,C.subMeshFaceId=g.faceId,C.faceId=g.faceId+X.data[g.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),C.subMeshId=g.subMeshId,C}return C}clone(G,D,N){return null}releaseSubMeshes(){if(this.le)for(;this.le.length;)this.le[0].dispose();else this.le=[];return this}dispose(G){let D,N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const T=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),T.freeActiveMeshes(),T.freeRenderingGroups(),T.renderingManager.maintainStateBetweenFrames&&T.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((G=>G!==this&&G.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),D=0;D<this._intersectionsInProgress.length;D++){const G=this._intersectionsInProgress[D],N=G._intersectionsInProgress.indexOf(this);G._intersectionsInProgress.splice(N,1)}this._intersectionsInProgress.length=0;T.lights.forEach((G=>{let D=G.includedOnlyMeshes.indexOf(this);-1!==D&&G.includedOnlyMeshes.splice(D,1),D=G.excludedMeshes.indexOf(this),-1!==D&&G.excludedMeshes.splice(D,1);const N=G.getShadowGenerators();if(N){const G=N.values();for(let N=G.next();!0!==N.done;N=G.next()){const G=N.value.getShadowMap();G&&G.renderList&&(D=G.renderList.indexOf(this),-1!==D&&G.renderList.splice(D,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const o=T.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,o.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),o.wipeCaches(),T.re(this),this._parentContainer){const G=this._parentContainer.meshes.indexOf(this);G>-1&&this._parentContainer.meshes.splice(G,1),this._parentContainer=null}if(N&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!G)for(D=0;D<T.fe.length;D++)T.fe[D].k===this&&(T.fe[D].dispose(),D--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(G,N)}_initFacetData(){const G=this._internalAbstractMeshDataInfo._facetData;G.facetNormals||(G.facetNormals=[]),G.facetPositions||(G.facetPositions=[]),G.facetPartitioning||(G.facetPartitioning=new Array),G.facetNb=this.ye().length/3|0,G.partitioningSubdivisions=G.partitioningSubdivisions?G.partitioningSubdivisions:10,G.partitioningBBoxRatio=G.partitioningBBoxRatio?G.partitioningBBoxRatio:1.01;for(let D=0;D<G.facetNb;D++)G.facetNormals[D]=Z.s.Zero(),G.facetPositions[D]=Z.s.Zero();return G.facetDataEnabled=!0,this}updateFacetData(){const G=this._internalAbstractMeshDataInfo._facetData;G.facetDataEnabled||this._initFacetData();const D=this.getVerticesData(n.f.PositionKind),N=this.ye(),T=this.getVerticesData(n.f.NormalKind),o=this.getBoundingInfo();if(G.facetDepthSort&&!G.facetDepthSortEnabled){if(G.facetDepthSortEnabled=!0,N instanceof Uint16Array)G.depthSortedIndices=new Uint16Array(N);else if(N instanceof Uint32Array)G.depthSortedIndices=new Uint32Array(N);else{let D=!1;for(let G=0;G<N.length;G++)if(N[G]>65535){D=!0;break}G.depthSortedIndices=D?new Uint32Array(N):new Uint16Array(N)}if(G.facetDepthSortFunction=function(G,D){return D.sqDistance-G.sqDistance},!G.facetDepthSortFrom){const D=this.va().activeCamera;G.facetDepthSortFrom=D?D.position:Z.s.Zero()}G.depthSortedFacets=[];for(let D=0;D<G.facetNb;D++){const N={ind:3*D,sqDistance:0};G.depthSortedFacets.push(N)}G.invertedMatrix=Z.c.Identity(),G.facetDepthSortOrigin=Z.s.Zero()}G.bbSize.x=o.maximum.x-o.minimum.x>Y.d?o.maximum.x-o.minimum.x:Y.d,G.bbSize.y=o.maximum.y-o.minimum.y>Y.d?o.maximum.y-o.minimum.y:Y.d,G.bbSize.z=o.maximum.z-o.minimum.z>Y.d?o.maximum.z-o.minimum.z:Y.d;let P=G.bbSize.x>G.bbSize.y?G.bbSize.x:G.bbSize.y;if(P=P>G.bbSize.z?P:G.bbSize.z,G.subDiv.max=G.partitioningSubdivisions,G.subDiv.X=Math.floor(G.subDiv.max*G.bbSize.x/P),G.subDiv.Y=Math.floor(G.subDiv.max*G.bbSize.y/P),G.subDiv.Z=Math.floor(G.subDiv.max*G.bbSize.z/P),G.subDiv.X=G.subDiv.X<1?1:G.subDiv.X,G.subDiv.Y=G.subDiv.Y<1?1:G.subDiv.Y,G.subDiv.Z=G.subDiv.Z<1?1:G.subDiv.Z,G.facetParameters.facetNormals=this.getFacetLocalNormals(),G.facetParameters.facetPositions=this.getFacetLocalPositions(),G.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),G.facetParameters.bInfo=o,G.facetParameters.bbSize=G.bbSize,G.facetParameters.subDiv=G.subDiv,G.facetParameters.ratio=this.partitioningBBoxRatio,G.facetParameters.depthSort=G.facetDepthSort,G.facetDepthSort&&G.facetDepthSortEnabled&&(this.se(!0),this._worldMatrix.invertToRef(G.invertedMatrix),Z.s.TransformCoordinatesToRef(G.facetDepthSortFrom,G.invertedMatrix,G.facetDepthSortOrigin),G.facetParameters.distanceTo=G.facetDepthSortOrigin),G.facetParameters.depthSortedFacets=G.depthSortedFacets,T&&C.c.ComputeNormals(D,N,T,G.facetParameters),G.facetDepthSort&&G.facetDepthSortEnabled){G.depthSortedFacets.sort(G.facetDepthSortFunction);const D=G.depthSortedIndices.length/3|0;for(let T=0;T<D;T++){const D=G.depthSortedFacets[T].ind;G.depthSortedIndices[3*T]=N[D],G.depthSortedIndices[3*T+1]=N[D+1],G.depthSortedIndices[3*T+2]=N[D+2]}this.updateIndices(G.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const G=this._internalAbstractMeshDataInfo._facetData;return G.facetNormals||this.updateFacetData(),G.facetNormals}getFacetLocalPositions(){const G=this._internalAbstractMeshDataInfo._facetData;return G.facetPositions||this.updateFacetData(),G.facetPositions}getFacetLocalPartitioning(){const G=this._internalAbstractMeshDataInfo._facetData;return G.facetPartitioning||this.updateFacetData(),G.facetPartitioning}getFacetPosition(G){const D=Z.s.Zero();return this.getFacetPositionToRef(G,D),D}getFacetPositionToRef(G,D){const N=this.getFacetLocalPositions()[G],T=this.getWorldMatrix();return Z.s.TransformCoordinatesToRef(N,T,D),this}getFacetNormal(G){const D=Z.s.Zero();return this.getFacetNormalToRef(G,D),D}getFacetNormalToRef(G,D){const N=this.getFacetLocalNormals()[G];return Z.s.TransformNormalToRef(N,this.getWorldMatrix(),D),this}getFacetsAtLocalCoordinates(G,D,N){const T=this.getBoundingInfo(),o=this._internalAbstractMeshDataInfo._facetData,Z=Math.floor((G-T.minimum.x*o.partitioningBBoxRatio)*o.subDiv.X*o.partitioningBBoxRatio/o.bbSize.x),n=Math.floor((D-T.minimum.y*o.partitioningBBoxRatio)*o.subDiv.Y*o.partitioningBBoxRatio/o.bbSize.y),C=Math.floor((N-T.minimum.z*o.partitioningBBoxRatio)*o.subDiv.Z*o.partitioningBBoxRatio/o.bbSize.z);return Z<0||Z>o.subDiv.max||n<0||n>o.subDiv.max||C<0||C>o.subDiv.max?null:o.facetPartitioning[Z+o.subDiv.max*n+o.subDiv.max*o.subDiv.max*C]}getClosestFacetAtCoordinates(G,D,N,T){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const C=this.getWorldMatrix(),P=Z.k.Matrix[5];C.invertToRef(P);const r=Z.k.Ad[8];Z.s.TransformCoordinatesFromFloatsToRef(G,D,N,P,r);const v=this.getClosestFacetAtLocalCoordinates(r.x,r.y,r.z,T,o,n);return T&&Z.s.TransformCoordinatesFromFloatsToRef(T.x,T.y,T.z,C,T),v}getClosestFacetAtLocalCoordinates(G,D,N,T){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Z=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],n=null,C=0,P=0,r=0,v=0,q=0,g=0,X=0,W=0;const j=this.getFacetLocalPositions(),Y=this.getFacetLocalNormals(),y=this.getFacetsAtLocalCoordinates(G,D,N);if(!y)return null;let h,m,R,L=Number.MAX_VALUE,w=L;for(let B=0;B<y.length;B++)h=y[B],m=Y[h],R=j[h],v=(G-R.x)*m.x+(D-R.y)*m.y+(N-R.z)*m.z,(!o||o&&Z&&v>=0||o&&!Z&&v<=0)&&(v=m.x*R.x+m.y*R.y+m.z*R.z,q=-(m.x*G+m.y*D+m.z*N-v)/(m.x*m.x+m.y*m.y+m.z*m.z),g=G+m.x*q,X=D+m.y*q,W=N+m.z*q,C=g-G,P=X-D,r=W-N,w=C*C+P*P+r*r,w<L&&(L=w,n=h,T&&(T.x=g,T.y=X,T.z=W)));return n}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const G=this._internalAbstractMeshDataInfo._facetData;return G.facetDataEnabled&&(G.facetDataEnabled=!1,G.facetPositions=[],G.facetNormals=[],G.facetPartitioning=new Array,G.facetParameters=null,G.depthSortedIndices=new Uint32Array(0)),this}updateIndices(G,D){return this}createNormals(G){const D=this.getVerticesData(n.f.PositionKind),N=this.ye();let T;return T=this.isVerticesDataPresent(n.f.NormalKind)?this.getVerticesData(n.f.NormalKind):[],C.c.ComputeNormals(D,N,T,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(n.f.NormalKind,T,G),this}alignWithNormal(G,D){D||(D=y.d.Y);const N=Z.k.Ad[0],T=Z.k.Ad[1];return Z.s.CrossToRef(D,G,T),Z.s.CrossToRef(G,T,N),this.rotationQuaternion?Z.g.RotationQuaternionFromAxisToRef(N,G,T,this.rotationQuaternion):Z.s.RotationFromAxisToRef(N,G,T,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,X.d)("EdgesRenderer")}enableEdgesRendering(G,D,N){throw(0,X.d)("EdgesRenderer")}uj(){return this._scene.fe.filter((G=>G.k===this))}}B.OCCLUSION_TYPE_NONE=0,B.OCCLUSION_TYPE_OPTIMISTIC=1,B.OCCLUSION_TYPE_STRICT=2,B.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,B.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,B.CULLINGSTRATEGY_STANDARD=0,B.Si=1,B.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,B.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,T.c)([m.h.filter((function(){for(var G=arguments.length,D=new Array(G),N=0;N<G;N++)D[N]=arguments[N];let[T,o,Z,n,C]=D;return!Array.isArray(T)&&!Array.isArray(o)&&!Array.isArray(Z)&&!Array.isArray(n)&&!Array.isArray(C)}))],B,"_ApplySkeleton",null),(0,h.h)("BABYLON.AbstractMesh",B)},11412:(G,D,N)=>{"use strict";N.d(D,{d:()=>Y});var T=N(1009),o=N(1185),Z=N(11407),n=N(1255),C=N(1337),P=N(11420),r=N(1347),v=N(1223),q=N(1183),g=N(1365),X=N(1030),W=N(1199),j=N(1105);class Y{get boundingBias(){return this._boundingBias}set boundingBias(G){this._boundingBias?this._boundingBias.p(G):this._boundingBias=G.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(G){const D=new Y(Y.RandomId(),G.va());return D.Ca(G),D}get meshes(){return this._meshes}constructor(G,D,N){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=D||X.e.LastCreatedScene,this._scene&&(this.id=G,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=T,N?this.setAllVerticesData(N,T):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),o&&(this.Ca(o),o.se(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let G=0;G<this._meshes.length;G++)if(!this._meshes[G].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const G=new Set;for(const D in this._vertexBuffers)G.add(this._vertexBuffers[D].getWrapperBuffer());G.forEach((G=>{G._rebuild()}))}setAllVerticesData(G,D){G.applyToGeometry(this,D),this._notifyUpdate()}Ga(G,D){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3?arguments[3]:void 0;N&&Array.isArray(D)&&(D=new Float32Array(D));const o=new n.f(this._engine,D,G,{updatable:N,postponeInternalCreation:0===this._meshes.length,stride:T,label:"Geometry_"+this.id+"_"+G});this.setVerticesBuffer(o)}removeVerticesData(G){this._vertexBuffers[G]&&(this._vertexBuffers[G].dispose(),delete this._vertexBuffers[G]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const o=G.getKind();this._vertexBuffers[o]&&N&&this._vertexBuffers[o].dispose(),G._buffer&&G._buffer._increaseReferences(),this._vertexBuffers[o]=G;const Z=this._meshes,C=Z.length;if(o===n.f.PositionKind){this._totalVertices=D??G._maxVerticesCount,this._updateExtend(G.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const N=this._extend&&this._extend.minimum||new T.s(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),o=this._extend&&this._extend.maximum||new T.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let G=0;G<C;G++){const D=Z[G];D.buildBoundingInfo(N,o),D._createGlobalSubMesh(D.isUnIndexed),D.se(!0),D.synchronizeInstances()}}this._notifyUpdate(o)}updateVerticesDataDirectly(G,D,N){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=this.getVertexBuffer(G);o&&(o.updateDirectly(D,N,T),this._notifyUpdate(G))}updateVerticesData(G,D){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T=this.getVertexBuffer(G);T&&(T.update(D),G===n.f.PositionKind&&this.Ea(N,D),this._notifyUpdate(G))}Ea(G,D){if(G&&this._updateExtend(D),this._resetPointsArrayCache(),G){const G=this._meshes;for(const D of G){D.hasBoundingInfo?D.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):D.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const G=D.le;for(const D of G)D.refreshBoundingInfo()}}}_bind(G,D,N,T){if(!G)return;void 0===D&&(D=this._indexBuffer);const o=this.getVertexBuffers();if(!o)return;if(D!=this._indexBuffer||!this._vertexArrayObjects&&!T)return void this._engine.bindBuffers(o,D,G,N);const Z=T||this._vertexArrayObjects,n=this._engine;Z[G.key]||(Z[G.key]=n.recordVertexArrayObject(o,D,G,N)),n.bindVertexArrayObject(Z[G.key],D)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(G,D,N){const T=this.getVertexBuffer(G);return T?T.getFloatData(this._totalVertices,N||D&&1!==this._meshes.length):null}copyVerticesData(G,D){const N=this.getVertexBuffer(G);if(!N)return;D[G]||(D[G]=new Float32Array(this._totalVertices*N.getSize()));const T=N.getData();T&&function(G,D,N,T,o,Z,C,P){const r=D*n.f.GetTypeByteLength(N),v=C*D;if(P.length!==v)throw new Error("Output length is not valid");if(N===n.f.FLOAT&&o===r)if(G instanceof Array){const D=T/4;P.set(G,D)}else if(G instanceof ArrayBuffer){const D=new Float32Array(G,T,v);P.set(D)}else{const D=G.byteOffset+T;if(D%4)return j.d.Warn("CopyFloatData: copied misaligned data."),void P.set(new Float32Array(G.buffer.slice(D,D+4*v)));const N=new Float32Array(G.buffer,D,v);P.set(N)}else n.f.ForEach(G,T,o,D,N,v,Z,((G,D)=>P[D]=G))}(T,N.getSize(),N.type,N.byteOffset,N.byteStride,N.normalized,this._totalVertices,D[G])}isVertexBufferUpdatable(G){const D=this._vertexBuffers[G];return!!D&&D.isUpdatable()}getVertexBuffer(G){return this.isReady()?this._vertexBuffers[G]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(G){return this._vertexBuffers?void 0!==this._vertexBuffers[G]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(G)}getVerticesDataKinds(){const G=[];let D;if(!this._vertexBuffers&&this._delayInfo)for(D in this._delayInfo)G.push(D);else for(D in this._vertexBuffers)G.push(D);return G}updateIndices(G,D){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const T=G.length!==this._indices.length;if(N||(this._indices=G.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,G,D),T)for(const G of this._meshes)G._createGlobalSubMesh(!0)}else this.setIndices(G,null,!0)}setIndexBuffer(G,D,N){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=G,this._totalVertices=D,this._totalIndices=N,G.is32Bits||(G.is32Bits=this._totalIndices>65535);for(const T of this._meshes)T._createGlobalSubMesh(!0),T.synchronizeInstances();this._notifyUpdate()}setIndices(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=G,this._indexBufferIsUpdatable=N,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,N,"Geometry_"+this.id+"_IndexBuffer")),void 0!=D&&(this._totalVertices=D);for(const o of this._meshes)o._createGlobalSubMesh(!T),o.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}ye(G,D){if(!this.isReady())return null;const N=this._indices;return D||G&&1!==this._meshes.length?N.slice():N}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;G&&this._vertexArrayObjects&&this._vertexArrayObjects[G.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[G.key]),delete this._vertexArrayObjects[G.key])}releaseForMesh(G,D){const N=this._meshes,T=N.indexOf(G);-1!==T&&(N.splice(T,1),this._vertexArrayObjects&&G._invalidateInstanceVertexArrayObject(),G._geometry=null,0===N.length&&D&&this.dispose())}Ca(G){if(G._geometry===this)return;const D=G._geometry;D&&D.releaseForMesh(G),this._vertexArrayObjects&&G._invalidateInstanceVertexArrayObject();const N=this._meshes;G._geometry=this,G._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),N.push(G),this.isReady()?this._applyToMesh(G):this._boundingInfo&&G.setBoundingInfo(this._boundingInfo)}_updateExtend(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!G&&(G=this.getVerticesData(n.f.PositionKind),!G))return;this._extend=(0,g.e)(G,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(G){const D=this._meshes.length;for(const N in this._vertexBuffers)1===D&&this._vertexBuffers[N].create(),N===n.f.PositionKind&&(this._extend||this._updateExtend(),G.buildBoundingInfo(this._extend.minimum,this._extend.maximum),G._createGlobalSubMesh(G.isUnIndexed),G.Ea());1===D&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),G._syncGeometryWithMorphTargetManager(),G.synchronizeInstances()}_notifyUpdate(G){this.onGeometryUpdated&&this.onGeometryUpdated(this,G),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const D of this._meshes)D._markSubMeshesAsAttributesDirty()}load(G,D){2!==this.delayLoadState&&(this.isReady()?D&&D():(this.delayLoadState=2,this._queueLoad(G,D)))}_queueLoad(G,D){this.delayLoadingFile&&(G.addPendingData(this),G._loadFile(this.delayLoadingFile,(N=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(N),this),this.delayLoadState=1,this._delayInfo=[],G.removePendingData(this);const T=this._meshes,o=T.length;for(let G=0;G<o;G++)this._applyToMesh(T[G]);D&&D()}),void 0,!0))}toLeftHanded(){const G=this.ye(!1);if(null!=G&&G.length>0){for(let D=0;D<G.length;D+=3){const N=G[D+0];G[D+0]=G[D+2],G[D+2]=N}this.setIndices(G)}const D=this.getVerticesData(n.f.PositionKind,!1);if(null!=D&&D.length>0){for(let G=0;G<D.length;G+=3)D[G+2]=-D[G+2];this.Ga(n.f.PositionKind,D,!1)}const N=this.getVerticesData(n.f.NormalKind,!1);if(null!=N&&N.length>0){for(let G=0;G<N.length;G+=3)N[G+2]=-N[G+2];this.Ga(n.f.NormalKind,N,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const G=this.getVerticesData(n.f.PositionKind);if(!G||0===G.length)return!1;for(let D=3*this._positionsCache.length,N=this._positionsCache.length;D<G.length;D+=3,++N)this._positionsCache[N]=T.s.od(G,D);for(let D=0,N=0;D<G.length;D+=3,++N)this._positionsCache[N].set(G[0+D],G[1+D],G[2+D]);return this._positionsCache.length=G.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const N in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[N]);this._vertexArrayObjects={};const G=this._meshes,D=G.length;for(let N=0;N<D;N++)G[N]._invalidateInstanceVertexArrayObject()}}dispose(){const G=this._meshes,D=G.length;let N;for(N=0;N<D;N++)this.releaseForMesh(G[N]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const T in this._vertexBuffers)this._vertexBuffers[T].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const G=this._parentContainer.geometries.indexOf(this);G>-1&&this._parentContainer.geometries.splice(G,1),this._parentContainer=null}this._isDisposed=!0}j(G){const D=new Z.c;D.indices=[];const N=this.ye();if(N)for(let Z=0;Z<N.length;Z++)D.indices.push(N[Z]);let T,o=!1,n=!1;for(T in this._vertexBuffers){const G=this.getVerticesData(T);if(G&&(G instanceof Float32Array?D.set(new Float32Array(G),T):D.set(G.slice(0),T),!n)){const G=this.getVertexBuffer(T);G&&(o=G.isUpdatable(),n=!o)}}const C=new Y(G,this._scene,D,o);for(T in C.delayLoadState=this.delayLoadState,C.delayLoadingFile=this.delayLoadingFile,C._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)C._delayInfo=C._delayInfo||[],C._delayInfo.push(T);return C._boundingInfo=new r.e(this._extend.minimum,this._extend.maximum),C}serialize(){const G={};return G.id=this.id,G.uniqueId=this.uniqueId,G.updatable=this._updatable,q.b&&q.b.HasTags(this)&&(G.tags=q.b.GetTags(this)),G}_toNumberArray(G){return Array.isArray(G)?G:Array.prototype.slice.call(G)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const G in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,G)&&(this._vertexBuffers[G]._buffer._data=null)}serializeVerticeData(){const G=this.serialize();return this.isVerticesDataPresent(n.f.PositionKind)&&(G.xa=this._toNumberArray(this.getVerticesData(n.f.PositionKind)),this.isVertexBufferUpdatable(n.f.PositionKind)&&(G.xa._updatable=!0)),this.isVerticesDataPresent(n.f.NormalKind)&&(G.ya=this._toNumberArray(this.getVerticesData(n.f.NormalKind)),this.isVertexBufferUpdatable(n.f.NormalKind)&&(G.ya._updatable=!0)),this.isVerticesDataPresent(n.f.TangentKind)&&(G.tangents=this._toNumberArray(this.getVerticesData(n.f.TangentKind)),this.isVertexBufferUpdatable(n.f.TangentKind)&&(G.tangents._updatable=!0)),this.isVerticesDataPresent(n.f.UVKind)&&(G.Aa=this._toNumberArray(this.getVerticesData(n.f.UVKind)),this.isVertexBufferUpdatable(n.f.UVKind)&&(G.Aa._updatable=!0)),this.isVerticesDataPresent(n.f.UV2Kind)&&(G.uvs2=this._toNumberArray(this.getVerticesData(n.f.UV2Kind)),this.isVertexBufferUpdatable(n.f.UV2Kind)&&(G.uvs2._updatable=!0)),this.isVerticesDataPresent(n.f.UV3Kind)&&(G.uvs3=this._toNumberArray(this.getVerticesData(n.f.UV3Kind)),this.isVertexBufferUpdatable(n.f.UV3Kind)&&(G.uvs3._updatable=!0)),this.isVerticesDataPresent(n.f.UV4Kind)&&(G.uvs4=this._toNumberArray(this.getVerticesData(n.f.UV4Kind)),this.isVertexBufferUpdatable(n.f.UV4Kind)&&(G.uvs4._updatable=!0)),this.isVerticesDataPresent(n.f.UV5Kind)&&(G.uvs5=this._toNumberArray(this.getVerticesData(n.f.UV5Kind)),this.isVertexBufferUpdatable(n.f.UV5Kind)&&(G.uvs5._updatable=!0)),this.isVerticesDataPresent(n.f.UV6Kind)&&(G.uvs6=this._toNumberArray(this.getVerticesData(n.f.UV6Kind)),this.isVertexBufferUpdatable(n.f.UV6Kind)&&(G.uvs6._updatable=!0)),this.isVerticesDataPresent(n.f.ColorKind)&&(G.za=this._toNumberArray(this.getVerticesData(n.f.ColorKind)),this.isVertexBufferUpdatable(n.f.ColorKind)&&(G.za._updatable=!0)),this.isVerticesDataPresent(n.f.MatricesIndicesKind)&&(G.matricesIndices=this._toNumberArray(this.getVerticesData(n.f.MatricesIndicesKind)),G.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(n.f.MatricesIndicesKind)&&(G.matricesIndices._updatable=!0)),this.isVerticesDataPresent(n.f.MatricesWeightsKind)&&(G.matricesWeights=this._toNumberArray(this.getVerticesData(n.f.MatricesWeightsKind)),this.isVertexBufferUpdatable(n.f.MatricesWeightsKind)&&(G.matricesWeights._updatable=!0)),G.indices=this._toNumberArray(this.ye()),G}static ExtractFromMesh(G,D){const N=G._geometry;return N?N.j(D):null}static RandomId(){return v.f.RandomId()}static _GetGeometryByLoadedUniqueId(G,D){for(let N=0;N<D.geometries.length;N++)if(D.geometries[N]._loadedUniqueId===G)return D.geometries[N];return null}static _ImportGeometry(G,D){const N=D.va(),T=G.geometryUniqueId,Z=G.geometryId;if(T||Z){const G=T?this._GetGeometryByLoadedUniqueId(T,N):N.getGeometryById(Z);G&&G.Ca(D)}else if(G instanceof ArrayBuffer){const N=D._binaryInfo;if(N.positionsAttrDesc&&N.positionsAttrDesc.count>0){const T=new Float32Array(G,N.positionsAttrDesc.offset,N.positionsAttrDesc.count);D.Ga(n.f.PositionKind,T,!1)}if(N.normalsAttrDesc&&N.normalsAttrDesc.count>0){const T=new Float32Array(G,N.normalsAttrDesc.offset,N.normalsAttrDesc.count);D.Ga(n.f.NormalKind,T,!1)}if(N.tangetsAttrDesc&&N.tangetsAttrDesc.count>0){const T=new Float32Array(G,N.tangetsAttrDesc.offset,N.tangetsAttrDesc.count);D.Ga(n.f.TangentKind,T,!1)}if(N.uvsAttrDesc&&N.uvsAttrDesc.count>0){const T=new Float32Array(G,N.uvsAttrDesc.offset,N.uvsAttrDesc.count);if(W.c)for(let G=1;G<T.length;G+=2)T[G]=1-T[G];D.Ga(n.f.UVKind,T,!1)}if(N.uvs2AttrDesc&&N.uvs2AttrDesc.count>0){const T=new Float32Array(G,N.uvs2AttrDesc.offset,N.uvs2AttrDesc.count);if(W.c)for(let G=1;G<T.length;G+=2)T[G]=1-T[G];D.Ga(n.f.UV2Kind,T,!1)}if(N.uvs3AttrDesc&&N.uvs3AttrDesc.count>0){const T=new Float32Array(G,N.uvs3AttrDesc.offset,N.uvs3AttrDesc.count);if(W.c)for(let G=1;G<T.length;G+=2)T[G]=1-T[G];D.Ga(n.f.UV3Kind,T,!1)}if(N.uvs4AttrDesc&&N.uvs4AttrDesc.count>0){const T=new Float32Array(G,N.uvs4AttrDesc.offset,N.uvs4AttrDesc.count);if(W.c)for(let G=1;G<T.length;G+=2)T[G]=1-T[G];D.Ga(n.f.UV4Kind,T,!1)}if(N.uvs5AttrDesc&&N.uvs5AttrDesc.count>0){const T=new Float32Array(G,N.uvs5AttrDesc.offset,N.uvs5AttrDesc.count);if(W.c)for(let G=1;G<T.length;G+=2)T[G]=1-T[G];D.Ga(n.f.UV5Kind,T,!1)}if(N.uvs6AttrDesc&&N.uvs6AttrDesc.count>0){const T=new Float32Array(G,N.uvs6AttrDesc.offset,N.uvs6AttrDesc.count);if(W.c)for(let G=1;G<T.length;G+=2)T[G]=1-T[G];D.Ga(n.f.UV6Kind,T,!1)}if(N.colorsAttrDesc&&N.colorsAttrDesc.count>0){const T=new Float32Array(G,N.colorsAttrDesc.offset,N.colorsAttrDesc.count);D.Ga(n.f.ColorKind,T,!1,N.colorsAttrDesc.stride)}if(N.matricesIndicesAttrDesc&&N.matricesIndicesAttrDesc.count>0){const T=new Int32Array(G,N.matricesIndicesAttrDesc.offset,N.matricesIndicesAttrDesc.count),o=[];for(let G=0;G<T.length;G++){const D=T[G];o.push(255&D),o.push((65280&D)>>8),o.push((16711680&D)>>16),o.push(D>>24&255)}D.Ga(n.f.MatricesIndicesKind,o,!1)}if(N.matricesIndicesExtraAttrDesc&&N.matricesIndicesExtraAttrDesc.count>0){const T=new Int32Array(G,N.matricesIndicesExtraAttrDesc.offset,N.matricesIndicesExtraAttrDesc.count),o=[];for(let G=0;G<T.length;G++){const D=T[G];o.push(255&D),o.push((65280&D)>>8),o.push((16711680&D)>>16),o.push(D>>24&255)}D.Ga(n.f.MatricesIndicesExtraKind,o,!1)}if(N.matricesWeightsAttrDesc&&N.matricesWeightsAttrDesc.count>0){const T=new Float32Array(G,N.matricesWeightsAttrDesc.offset,N.matricesWeightsAttrDesc.count);D.Ga(n.f.MatricesWeightsKind,T,!1)}if(N.indicesAttrDesc&&N.indicesAttrDesc.count>0){const T=new Int32Array(G,N.indicesAttrDesc.offset,N.indicesAttrDesc.count);D.setIndices(T,null)}if(N.subMeshesAttrDesc&&N.subMeshesAttrDesc.count>0){const T=new Int32Array(G,N.subMeshesAttrDesc.offset,5*N.subMeshesAttrDesc.count);D.le=[];for(let G=0;G<N.subMeshesAttrDesc.count;G++){const N=T[5*G+0],o=T[5*G+1],Z=T[5*G+2],n=T[5*G+3],P=T[5*G+4];C.c.AddToMesh(N,o,Z,n,P,D)}}}else if(G.xa&&G.ya&&G.indices){if(D.Ga(n.f.PositionKind,G.xa,G.xa._updatable),D.Ga(n.f.NormalKind,G.ya,G.ya._updatable),G.tangents&&D.Ga(n.f.TangentKind,G.tangents,G.tangents._updatable),G.Aa&&D.Ga(n.f.UVKind,G.Aa,G.Aa._updatable),G.uvs2&&D.Ga(n.f.UV2Kind,G.uvs2,G.uvs2._updatable),G.uvs3&&D.Ga(n.f.UV3Kind,G.uvs3,G.uvs3._updatable),G.uvs4&&D.Ga(n.f.UV4Kind,G.uvs4,G.uvs4._updatable),G.uvs5&&D.Ga(n.f.UV5Kind,G.uvs5,G.uvs5._updatable),G.uvs6&&D.Ga(n.f.UV6Kind,G.uvs6,G.uvs6._updatable),G.za&&D.Ga(n.f.ColorKind,o.g.CheckColors4(G.za,G.xa.length/3),G.za._updatable),G.matricesIndices)if(G.matricesIndices._isExpanded)delete G.matricesIndices._isExpanded,D.Ga(n.f.MatricesIndicesKind,G.matricesIndices,G.matricesIndices._updatable);else{const N=[];for(let D=0;D<G.matricesIndices.length;D++){const T=G.matricesIndices[D];N.push(255&T),N.push((65280&T)>>8),N.push((16711680&T)>>16),N.push(T>>24&255)}D.Ga(n.f.MatricesIndicesKind,N,G.matricesIndices._updatable)}if(G.matricesIndicesExtra)if(G.matricesIndicesExtra._isExpanded)delete G.matricesIndices._isExpanded,D.Ga(n.f.MatricesIndicesExtraKind,G.matricesIndicesExtra,G.matricesIndicesExtra._updatable);else{const N=[];for(let D=0;D<G.matricesIndicesExtra.length;D++){const T=G.matricesIndicesExtra[D];N.push(255&T),N.push((65280&T)>>8),N.push((16711680&T)>>16),N.push(T>>24&255)}D.Ga(n.f.MatricesIndicesExtraKind,N,G.matricesIndicesExtra._updatable)}G.matricesWeights&&(Y._CleanMatricesWeights(G,D),D.Ga(n.f.MatricesWeightsKind,G.matricesWeights,G.matricesWeights._updatable)),G.matricesWeightsExtra&&D.Ga(n.f.MatricesWeightsExtraKind,G.matricesWeightsExtra,G.matricesWeights._updatable),D.setIndices(G.indices,null)}if(G.le){D.le=[];for(let N=0;N<G.le.length;N++){const T=G.le[N];C.c.AddToMesh(T.materialIndex,T.verticesStart,T.verticesCount,T.indexStart,T.indexCount,D)}}D._shouldGenerateFlatShading&&(D.convertToFlatShadedMesh(),D._shouldGenerateFlatShading=!1),D.se(!0),N.onMeshImportedObservable.notifyObservers(D)}static _CleanMatricesWeights(G,D){const N=.001;if(!P.d.CleanBoneMatrixWeights)return;let T=0;if(!(G.skeletonId>-1))return;{const N=D.va().getLastSkeletonById(G.skeletonId);if(!N)return;T=N.bones.length}const o=D.getVerticesData(n.f.MatricesIndicesKind),Z=D.getVerticesData(n.f.MatricesIndicesExtraKind),C=G.matricesWeights,r=G.matricesWeightsExtra,v=G.numBoneInfluencer,q=C.length;for(let n=0;n<q;n+=4){let G=0,D=-1;for(let T=0;T<4;T++){const o=C[n+T];G+=o,o<N&&D<0&&(D=T)}if(r)for(let T=0;T<4;T++){const o=r[n+T];G+=o,o<N&&D<0&&(D=T+4)}if((D<0||D>v-1)&&(D=v-1),G>N){const D=1/G;for(let G=0;G<4;G++)C[n+G]*=D;if(r)for(let G=0;G<4;G++)r[n+G]*=D}else D>=4?(r[n+D-4]=1-G,Z[n+D-4]=T):(C[n+D]=1-G,o[n+D]=T)}D.Ga(n.f.MatricesIndicesKind,o),G.matricesWeightsExtra&&D.Ga(n.f.MatricesIndicesExtraKind,Z)}static Parse(G,D,N){const o=new Y(G.id,D,void 0,G.updatable);return o._loadedUniqueId=G.uniqueId,q.b&&q.b.AddTagsTo(o,G.tags),G.delayLoadingFile?(o.delayLoadState=4,o.delayLoadingFile=N+G.delayLoadingFile,o._boundingInfo=new r.e(T.s.od(G.boundingBoxMinimum),T.s.od(G.boundingBoxMaximum)),o._delayInfo=[],G.hasUVs&&o._delayInfo.push(n.f.UVKind),G.hasUVs2&&o._delayInfo.push(n.f.UV2Kind),G.hasUVs3&&o._delayInfo.push(n.f.UV3Kind),G.hasUVs4&&o._delayInfo.push(n.f.UV4Kind),G.hasUVs5&&o._delayInfo.push(n.f.UV5Kind),G.hasUVs6&&o._delayInfo.push(n.f.UV6Kind),G.hasColors&&o._delayInfo.push(n.f.ColorKind),G.hasMatricesIndices&&o._delayInfo.push(n.f.MatricesIndicesKind),G.hasMatricesWeights&&o._delayInfo.push(n.f.MatricesWeightsKind),o._delayLoadingFunction=Z.c.ImportVertexData):Z.c.ImportVertexData(G,o),D.pushGeometry(o,!0),o}}},11750:(G,D,N)=>{"use strict";N.d(D,{d:()=>g});var T=N(1009),o=N(1105),Z=N(11428),n=N(11378),C=N(1225),P=N(11437),r=N(1255),v=N(1223),q=N(1018);n.d._instancedMeshFactory=(G,D)=>{const N=new g(G,D);if(D.instancedBuffers){N.instancedBuffers={};for(const G in D.instancedBuffers)N.instancedBuffers[G]=D.instancedBuffers[G]}return N};class g extends Z.d{constructor(G,D){super(G,D.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,D.Ij(this),this._sourceMesh=D,this._unIndexed=D._unIndexed,this.position.p(D.position),this.rotation.p(D.rotation),this.Ed.p(D.Ed),D.rotationQuaternion&&(this.rotationQuaternion=D.rotationQuaternion.clone()),this.animations=D.animations.slice();for(const N of D.getAnimationRanges())null!=N&&this.createAnimationRange(N.name,N.from,N.to);this.infiniteDistance=D.infiniteDistance,this.setPivotMatrix(D.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(G){var D;(null===(D=this._sourceMesh)||void 0===D?void 0:D.receiveShadows)!==G&&v.f.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(G){var D;(null===(D=this._sourceMesh)||void 0===D?void 0:D.material)!==G&&v.f.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(G){var D;(null===(D=this._sourceMesh)||void 0===D?void 0:D.visibility)!==G&&v.f.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(G){var D;(null===(D=this._sourceMesh)||void 0===D?void 0:D.skeleton)!==G&&v.f.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(G){this._sourceMesh&&G!==this._sourceMesh.renderingGroupId&&o.d.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}nb(G){return this._sourceMesh.nb(G)}isReady(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(G,!0)}getVerticesData(G,D,N){return this._sourceMesh.getVerticesData(G,D,N)}copyVerticesData(G,D){this._sourceMesh.copyVerticesData(G,D)}Ga(G,D,N,T){return this.sourceMesh&&this.sourceMesh.Ga(G,D,N,T),this.sourceMesh}updateVerticesData(G,D,N,T){return this.sourceMesh&&this.sourceMesh.updateVerticesData(G,D,N,T),this.sourceMesh}setIndices(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(G,D),this.sourceMesh}isVerticesDataPresent(G){return this._sourceMesh.isVerticesDataPresent(G)}ye(){return this._sourceMesh.ye()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let G,D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;G="object"===typeof D?D:{applySkeleton:D,applyMorph:N};const T=this._sourceMesh.ve?this._sourceMesh.ve.boundingBias:null;return this.Fa(this._sourceMesh._getData(G,null,r.f.PositionKind),T),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(G,D){if(super._activate(G,D),this._sourceMesh.le||o.d.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,G),D){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==P.e.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new T.c);const G=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,T.k.Ad[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.se(!0)),this._currentLOD.position.p(T.k.Ad[7]),this._currentLOD._masterMesh=G,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(G){if(!G)return this;const D=this.sourceMesh.getLODLevels();if(D&&0!==D.length){const D=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(G,D.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(G){return this.sourceMesh._preActivateForIntermediateRendering(G)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.le)for(let G=0;G<this._sourceMesh.le.length;G++)this._sourceMesh.le[G].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0;const T=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).nb(G);if(C.e.DeepCopy(this,T,["name","le","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","tj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),D&&(T.parent=D),!N)for(let o=0;o<this.va().meshes.length;o++){const G=this.va().meshes[o];G.parent===this&&G.clone(G.name,T)}return T.se(!0),this.onClonedObservable.notifyObservers(T),T}dispose(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Hj(this),super.dispose(G,D)}_serializeAsParent(G){super._serializeAsParent(G),G.parentId=this._sourceMesh.uniqueId,G.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,D=arguments.length>1?arguments[1]:void 0,N=arguments.length>2?arguments[2]:void 0;const T=this.clone("Clone of "+(this.name||this.id),G||this.parent,!0,D&&D.newSourcedMesh);T&&N&&N(this,T);for(const o of this.getChildTransformNodes(!0))o.instantiateHierarchy(T,D,N);return T}}n.d.prototype.registerInstancedBuffer=function(G,D){var N,T;if(null===(N=this._userInstancedBuffersStorage)||void 0===N||null===(T=N.vertexBuffers[G])||void 0===T||T.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const G of this.instances)G.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[G]=null,this._userInstancedBuffersStorage.strides[G]=D,this._userInstancedBuffersStorage.sizes[G]=32*D,this._userInstancedBuffersStorage.data[G]=new Float32Array(this._userInstancedBuffersStorage.sizes[G]),this._userInstancedBuffersStorage.vertexBuffers[G]=new r.f(this.getEngine(),this._userInstancedBuffersStorage.data[G],G,!0,!1,D,!0);for(const o of this.instances)o.instancedBuffers[G]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},n.d.prototype._processInstancedBuffers=function(G,D){const N=G?G.length:0;for(const T in this.instancedBuffers){let o=this._userInstancedBuffersStorage.sizes[T];const Z=this._userInstancedBuffersStorage.strides[T],n=(N+1)*Z;for(;o<n;)o*=2;this._userInstancedBuffersStorage.data[T].length!=o&&(this._userInstancedBuffersStorage.data[T]=new Float32Array(o),this._userInstancedBuffersStorage.sizes[T]=o,this._userInstancedBuffersStorage.vertexBuffers[T]&&(this._userInstancedBuffersStorage.vertexBuffers[T].dispose(),this._userInstancedBuffersStorage.vertexBuffers[T]=null));const C=this._userInstancedBuffersStorage.data[T];let P=0;if(D){const G=this.instancedBuffers[T];G.toArray?G.toArray(C,P):G.copyToArray?G.copyToArray(C,P):C[P]=G,P+=Z}for(let D=0;D<N;D++){const N=G[D].instancedBuffers[T];N.toArray?N.toArray(C,P):N.copyToArray?N.copyToArray(C,P):C[P]=N,P+=Z}this._userInstancedBuffersStorage.vertexBuffers[T]?this._userInstancedBuffersStorage.vertexBuffers[T].updateDirectly(C,0):(this._userInstancedBuffersStorage.vertexBuffers[T]=new r.f(this.getEngine(),this._userInstancedBuffersStorage.data[T],T,!0,!1,Z,!0),this._invalidateInstanceVertexArrayObject())}},n.d.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const G in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[G]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},n.d.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const G in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[G]&&this._userInstancedBuffersStorage.vertexBuffers[G].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,q.h)("BABYLON.InstancedMesh",g)},11378:(G,D,N)=>{"use strict";N.d(D,{d:()=>p,g:()=>V});var T=N(1003),o=N(1223),Z=N(1225),n=N(1183),C=N(11385),P=N(11393),r=N(1009),v=N(1185),q=N(11399),g=N(1255),X=N(11407),W=N(11412),j=N(11428),Y=N(1337),y=N(1329),h=N(11441),m=N(11420),R=N(1181),L=N(1105),w=N(1018),B=N(1094),F=N(1276);class S{constructor(G,D){this.distanceOrScreenCoverage=G,this.mesh=D}}class V{}class U{constructor(){this.visibleInstances={},this.batchCache=new z,this.batchCacheReplacementModeInFrozenMode=new z,this.instancesBufferSize=2048}}class z{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class i{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class J{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class p extends j.d{static _GetDefaultSideOrientation(G){return G||p.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(G){this._internalMeshDataInfo._useLODScreenCoverage=G,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(G){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==G&&(G&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(g.f.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(g.f.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=G,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new T.b),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new T.b),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new T.b),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new T.b),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new T.b),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(G){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(G)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(G){this._internalMeshDataInfo._forcedInstanceCount=G}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(G){this._internalMeshDataInfo._sideOrientation=G,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===G||!this._scene.useRightHandedSystem&&0===G}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(G){this.sideOrientation=G,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(G){this._internalMeshDataInfo._overrideRenderingFillMode=G}get material(){return this._internalAbstractMeshDataInfo._material}set material(G){G&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(G.sideOrientation=null),this._setMaterial(G)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(G){this._unIndexed!==G&&(this._unIndexed=G,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(G){this._instanceDataStorage.manualUpdate=G}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(G){this._instanceDataStorage.previousManualUpdate=G}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(G){this._instanceDataStorage.forceMatrixUpdates=G}_copySource(G,D){let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const T=this.va();if(G._geometry&&G._geometry.Ca(this),Z.e.DeepCopy(G,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","ve","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","tj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=G,T.useClonedMeshMap&&(G._internalMeshDataInfo.meshMap||(G._internalMeshDataInfo.meshMap={}),G._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=G._originalBuilderSideOrientation,this._creationDataStorage=G._creationDataStorage,G._ranges){const D=G._ranges;for(const G in D)Object.prototype.hasOwnProperty.call(D,G)&&D[G]&&this.createAnimationRange(G,D[G].from,D[G].to)}if(G.metadata&&G.metadata.clone?this.metadata=G.metadata.clone():this.metadata=G.metadata,this._internalMetadata=G._internalMetadata,n.b&&n.b.HasTags(G)&&n.b.AddTagsTo(this,n.b.GetTags(G,!0)),this.Lg(G.isEnabled(!1)),this.parent=G.parent,this.setPivotMatrix(G.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+G.id,this.material=G.material,!D){const D=G.getDescendants(!0);for(let G=0;G<D.length;G++){const N=D[G];N.clone&&N.clone(this.name+"."+N.name,this)}}if(G.morphTargetManager&&(this.morphTargetManager=G.morphTargetManager),T.getPhysicsEngine){const D=T.getPhysicsEngine();if(N&&D)if(1===D.getPluginVersion()){const N=D.getImpostorForPhysicsObject(G);N&&(this.physicsImpostor=N.clone(this))}else 2===D.getPluginVersion()&&G.physicsBody&&G.physicsBody.clone(this)}for(let o=0;o<T.fe.length;o++){const D=T.fe[o];D.k===G&&D.clone(D.name,this)}this.skeleton=G.skeleton,this.refreshBoundingInfo(!0,!0),this.se(!0)}constructor(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4?arguments[4]:void 0,n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(G,D),this._internalMeshDataInfo=new J,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new U,this._thinInstanceDataStorage=new i,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=p.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,D=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(G,D,N)=>{G&&N&&(this._uniformBuffer?this.transferToEffect(D):N.bindOnlyWorldMatrix(D))},o&&this._copySource(o,Z,n),null!==N&&(this.parent=N),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=G=>{G.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new T.b(this._internalMeshDataInfo._onMeshReadyObserverAdded),o&&o.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,D=arguments.length>1?arguments[1]:void 0,N=arguments.length>2?arguments[2]:void 0;const T=0===this.getTotalVertices()||D&&D.doNotInstantiate&&(!0===D.doNotInstantiate||D.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),G||this.parent,!0):this.nb("instance of "+(this.name||this.id));T.parent=G||this.parent,T.position=this.position.clone(),T.Ed=this.Ed.clone(),this.rotationQuaternion?T.rotationQuaternion=this.rotationQuaternion.clone():T.rotation=this.rotation.clone(),N&&N(this,T);for(const o of this.getChildTransformNodes(!0))"InstancedMesh"===o.getClassName()&&"Mesh"===T.getClassName()&&o.sourceMesh===this?o.instantiateHierarchy(T,{doNotInstantiate:D&&D.doNotInstantiate||!1,newSourcedMesh:T},N):o.instantiateHierarchy(T,D,N);return T}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(G){let D=super.toString(G);if(D+=", n vertices: "+this.getTotalVertices(),D+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let N=0;N<this.animations.length;N++)D+=", animation[0]: "+this.animations[N].toString(G);if(G)if(this._geometry){const G=this.ye(),N=this.getVerticesData(g.f.PositionKind);N&&G&&(D+=", flat shading: "+(N.length/3===G.length?"YES":"NO"))}else D+=", flat shading: UNKNOWN";return D}_unBindEffect(){super._unBindEffect();for(const G of this.instances)G._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const G=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((D,N)=>D.distanceOrScreenCoverage<N.distanceOrScreenCoverage?G:D.distanceOrScreenCoverage>N.distanceOrScreenCoverage?-G:0))}addLODLevel(G,D){if(D&&D._masterMesh)return L.d.Warn("You cannot use a mesh as LOD level twice"),this;const N=new S(G,D);return this._internalMeshDataInfo._LODLevels.push(N),D&&(D._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(G){const D=this._internalMeshDataInfo;for(let N=0;N<D._LODLevels.length;N++){const T=D._LODLevels[N];if(T.distanceOrScreenCoverage===G)return T.mesh}return null}removeLODLevel(G){const D=this._internalMeshDataInfo;for(let N=0;N<D._LODLevels.length;N++)D._LODLevels[N].mesh===G&&(D._LODLevels.splice(N,1),G&&(G._masterMesh=null));return this._sortLODLevels(),this}getLOD(G,D){const N=this._internalMeshDataInfo;if(!N._LODLevels||0===N._LODLevels.length)return this;const T=D||this.getBoundingInfo().boundingSphere,o=G.mode===P.d.ORTHOGRAPHIC_CAMERA?G.fj:T.centerWorld.Jc(G.globalPosition).length();let Z=o,n=1;if(N._useLODScreenCoverage){const D=G.screenArea;let N=T.radiusWorld*G.fj/o;N=N*N*Math.PI,Z=N/D,n=-1}if(n*N._LODLevels[N._LODLevels.length-1].distanceOrScreenCoverage>n*Z)return this.onLODLevelSelection&&this.onLODLevelSelection(Z,this,this),this;for(let C=0;C<N._LODLevels.length;C++){const G=N._LODLevels[C];if(n*G.distanceOrScreenCoverage<n*Z){if(G.mesh){if(4===G.mesh.delayLoadState)return G.mesh._checkDelayState(),this;if(2===G.mesh.delayLoadState)return this;G.mesh._preActivate(),G.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(Z,this,G.mesh),G.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(Z,this,this),this}get ve(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(G,D,N,T){var o,Z;if(!this._geometry)return null;let n=T||null===(o=this._userInstancedBuffersStorage)||void 0===o||null===(Z=o.vertexBuffers[G])||void 0===Z?void 0:Z.getFloatData(this.instances.length+1,N||D&&1!==this._geometry.meshes.length);return n||(n=this._geometry.getVerticesData(G,D,N)),n}copyVerticesData(G,D){this._geometry&&this._geometry.copyVerticesData(G,D)}getVertexBuffer(G,D){var N;return this._geometry?(D||null===(N=this._userInstancedBuffersStorage)||void 0===N?void 0:N.vertexBuffers[G])??this._geometry.getVertexBuffer(G):null}isVerticesDataPresent(G,D){var N;return this._geometry?!D&&void 0!==(null===(N=this._userInstancedBuffersStorage)||void 0===N?void 0:N.vertexBuffers[G])||this._geometry.isVerticesDataPresent(G):!!this._delayInfo&&-1!==this._delayInfo.indexOf(G)}isVertexBufferUpdatable(G,D){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(G);if(!D){var N;const D=null===(N=this._userInstancedBuffersStorage)||void 0===N?void 0:N.vertexBuffers[G];if(D)return D.isUpdatable()}return this._geometry.isVertexBufferUpdatable(G)}getVerticesDataKinds(G){if(!this._geometry){const G=[];return this._delayInfo&&this._delayInfo.forEach((function(D){G.push(D)})),G}const D=this._geometry.getVerticesDataKinds();if(!G&&this._userInstancedBuffersStorage)for(const N in this._userInstancedBuffersStorage.vertexBuffers)-1===D.indexOf(N)&&D.push(N);return D}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}ye(G,D){return this._geometry?this._geometry.ye(G,D):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(G))return!1;if(!this.le||0===this.le.length)return!0;if(!G)return!0;const N=this.getEngine(),T=this.va(),o=D||N.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.se();const Z=this.material||T.defaultMaterial;if(Z)if(Z._storeEffectOnSubMeshes)for(const g of this.le){const G=g.Ha();if(G)if(G._storeEffectOnSubMeshes){if(!G.isReadyForSubMesh(this,g,o))return!1}else if(!G.isReady(this,o))return!1}else if(!Z.isReady(this,o))return!1;const n=N.currentRenderPassId;for(const g of this.lightSources){const G=g.getShadowGenerators();if(!G)continue;const D=G.values();for(let T=D.next();!0!==T.done;T=D.next()){var C,P,r,v;const G=T.value;if(G&&(null===(C=G.getShadowMap())||void 0===C||!C.renderList||null!==(P=G.getShadowMap())&&void 0!==P&&P.renderList&&-1!==(null===(r=G.getShadowMap())||void 0===r||null===(v=r.renderList)||void 0===v?void 0:v.indexOf(this)))){const D=G.getShadowMap().renderPassIds??[N.currentRenderPassId];for(let T=0;T<D.length;++T){N.currentRenderPassId=D[T];for(const D of this.le){var q;if(!G.isReady(D,o,(null===(q=D.Ha())||void 0===q?void 0:q.needAlphaBlendingForMesh(this))??!1))return N.currentRenderPassId=n,!1}}N.currentRenderPassId=n}}}for(const g of this._internalMeshDataInfo._LODLevels)if(g.mesh&&!g.mesh.isReady(o))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}ci(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(G){this._instanceDataStorage.overridenInstanceCount=G}_preActivate(){const G=this._internalMeshDataInfo,D=this.va().getRenderId();return G._preActivateId===D||(G._preActivateId=D,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(G){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=G),this}_registerInstanceForRenderId(G,D){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:D,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[D]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=D,this._instanceDataStorage.visibleInstances[D]=new Array),this._instanceDataStorage.visibleInstances[D].push(G),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let G,D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;G="object"===typeof D?D:{applySkeleton:D,applyMorph:N};const T=this.ve?this.ve.boundingBias:null;return this.Fa(this._getData(G,null,g.f.PositionKind),T),this}_createGlobalSubMesh(G){const D=this.getTotalVertices();if(!D||!this.ye())return null;if(this.le&&this.le.length>0){const N=this.ye();if(!N)return null;const T=N.length;let o=!1;if(G)o=!0;else for(const G of this.le){if(G.indexStart+G.indexCount>T){o=!0;break}if(G.verticesStart+G.verticesCount>D){o=!0;break}}if(!o)return this.le[0]}return this.releaseSubMeshes(),new Y.c(0,0,D,0,this.getTotalIndices(),this)}subdivide(G){if(G<1)return;const D=this.getTotalIndices();let N=D/G|0,T=0;for(;N%3!==0;)N++;this.releaseSubMeshes();for(let o=0;o<G&&!(T>=D);o++)Y.c.CreateFromIndices(0,T,o===G-1?D-T:N,this,void 0,!1),T+=N;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(G,D){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(G,D,N,T);else{const T=new X.c;T.set(D,G);const o=this.va();new W.d(W.d.RandomId(),o,T,N,this)}return this}removeVerticesData(G){this._geometry&&this._geometry.removeVerticesData(G)}markVerticesDataAsUpdatable(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const N=this.getVertexBuffer(G);N&&N.isUpdatable()!==D&&this.Ga(G,this.getVerticesData(G),D)}setVerticesBuffer(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=W.d.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(G,null,D),this}updateVerticesData(G,D,N,T){return this._geometry?(T?(this.makeGeometryUnique(),this.updateVerticesData(G,D,N,!1)):this._geometry.updateVerticesData(G,D,N),this):this}updateMeshPositions(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const N=this.getVerticesData(g.f.PositionKind);if(!N)return this;if(G(N),this.updateVerticesData(g.f.PositionKind,N,!1,!1),D){const G=this.ye(),D=this.getVerticesData(g.f.NormalKind);if(!D)return this;X.c.ComputeNormals(N,G,D),this.updateVerticesData(g.f.NormalKind,D,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const G=this._geometry,D=this._geometry.j(W.d.RandomId());return G.releaseForMesh(this,!0),D.Ca(this),this}setIndexBuffer(G,D,N){let T=this._geometry;T||(T=new W.d(W.d.RandomId(),this.va(),void 0,void 0,this)),T.setIndexBuffer(G,D,N)}setIndices(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(G,D,N,T);else{const D=new X.c;D.indices=G;const T=this.va();new W.d(W.d.RandomId(),T,D,N,this)}return this}updateIndices(G,D){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(G,D,N),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(G,D,N){let T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const o=this.va().getEngine();let Z;if(this._unIndexed)if(this._getRenderingFillMode(N)===y.d.WireFrameFillMode)Z=G._getLinesIndexBuffer(this.ye(),o);else Z=null;else switch(this._getRenderingFillMode(N)){case y.d.PointFillMode:Z=null;break;case y.d.WireFrameFillMode:Z=G._getLinesIndexBuffer(this.ye(),o);break;default:case y.d.TriangleFillMode:Z=this._geometry.getIndexBuffer()}return this._bindDirect(D,Z,T)}_bindDirect(G,D){let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(G),N&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(G,D,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(G,D),this):this}_draw(G,D,N){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const T=this.va().getEngine();return this._unIndexed&&D!==y.d.WireFrameFillMode||D==y.d.PointFillMode?T.drawArraysType(D,G.verticesStart,G.verticesCount,this.forcedInstanceCount||N):D==y.d.WireFrameFillMode?T.drawElementsType(D,0,G._linesIndexCount,this.forcedInstanceCount||N):T.drawElementsType(D,G.indexStart,G.indexCount,this.forcedInstanceCount||N),this}registerBeforeRender(G){return this.onBeforeRenderObservable.add(G),this}unregisterBeforeRender(G){return this.onBeforeRenderObservable.removeCallback(G),this}registerAfterRender(G){return this.onAfterRenderObservable.add(G),this}unregisterAfterRender(G){return this.onAfterRenderObservable.removeCallback(G),this}_getInstancesRenderList(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(D)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[G]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[G]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const N=this.va(),T=N._isInIntermediateRendering(),o=T?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,Z=this._instanceDataStorage.batchCache;if(Z.mustReturn=!1,Z.renderSelf[G]=D||!o&&this.isEnabled()&&this.isVisible,Z.visibleInstances[G]=null,this._instanceDataStorage.visibleInstances&&!D){const D=this._instanceDataStorage.visibleInstances,o=N.getRenderId(),n=T?D.intermediateDefaultRenderId:D.defaultRenderId;Z.visibleInstances[G]=D[o],!Z.visibleInstances[G]&&n&&(Z.visibleInstances[G]=D[n])}return Z.hardwareInstancedRendering[G]=!D&&this._instanceDataStorage.hardwareInstancedRendering&&null!==Z.visibleInstances[G]&&void 0!==Z.visibleInstances[G],this._instanceDataStorage.previousBatch=Z,Z}_renderWithInstances(G,D,N,T,o){const Z=N.visibleInstances[G._id],n=Z?Z.length:0,C=this._instanceDataStorage,P=C.instancesBufferSize;let v=C.instancesBuffer,q=C.instancesPreviousBuffer;const X=16*(n+1)*4;for(;C.instancesBufferSize<X;)C.instancesBufferSize*=2;C.instancesData&&P==C.instancesBufferSize||(C.instancesData=new Float32Array(C.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!C.instancesPreviousData||P!=C.instancesBufferSize)&&(C.instancesPreviousData=new Float32Array(C.instancesBufferSize/4));let W=0,j=0;const Y=N.renderSelf[G._id],y=!v||P!==C.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!C.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||C.isFrozen&&!y)j=(Y?1:0)+n;else{const D=this.getWorldMatrix();if(Y&&(this._scene.needsPreviousWorldMatrices&&(C.masterMeshPreviousWorldMatrix?(C.masterMeshPreviousWorldMatrix.copyToArray(C.instancesPreviousData,W),C.masterMeshPreviousWorldMatrix.p(D)):(C.masterMeshPreviousWorldMatrix=D.clone(),C.masterMeshPreviousWorldMatrix.copyToArray(C.instancesPreviousData,W))),D.copyToArray(C.instancesData,W),W+=16,j++),Z){var h;if(p.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(h=G.Ha())&&void 0!==h&&h.needAlphaBlendingForMesh(G.getRenderingMesh())){const G=this._scene.activeCamera.globalPosition;for(let D=0;D<Z.length;D++){const N=Z[D];N._distanceToCamera=r.s.Distance(N.getBoundingInfo().boundingSphere.centerWorld,G)}Z.sort(((G,D)=>G._distanceToCamera>D._distanceToCamera?-1:G._distanceToCamera<D._distanceToCamera?1:0))}for(let G=0;G<Z.length;G++){const D=Z[G],N=D.getWorldMatrix();N.copyToArray(C.instancesData,W),this._scene.needsPreviousWorldMatrices&&(D._previousWorldMatrix?(D._previousWorldMatrix.copyToArray(C.instancesPreviousData,W),D._previousWorldMatrix.p(N)):(D._previousWorldMatrix=N.clone(),D._previousWorldMatrix.copyToArray(C.instancesPreviousData,W))),W+=16,j++}}}return y?(v&&v.dispose(),q&&q.dispose(),v=new g.c(o,C.instancesData,!0,16,!1,!0),C.instancesBuffer=v,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=v.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=v.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=v.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=v.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(q=new g.c(o,C.instancesPreviousData,!0,16,!1,!0),C.instancesPreviousBuffer=q,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=q.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=q.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=q.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=q.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(v.updateDirectly(C.instancesData,0,j),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||q.updateDirectly(C.instancesPreviousData,0,j)),this._processInstancedBuffers(Z,Y),this.va()._activeIndices.addCount(G.indexCount*j,!1),o._currentDrawContext&&(o._currentDrawContext.useInstancing=!0),this._bind(G,T,D),this._draw(G,D,j),!this._scene.needsPreviousWorldMatrices||y||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||q.updateDirectly(C.instancesData,0,j),o.unbindInstanceAttributes(),this}_renderWithThinInstances(G,D,N,T){var o;const Z=(null===(o=this._thinInstanceDataStorage)||void 0===o?void 0:o.instancesCount)??0;this.va()._activeIndices.addCount(G.indexCount*Z,!1),T._currentDrawContext&&(T._currentDrawContext.useInstancing=!0),this._bind(G,N,D),this._draw(G,D,Z),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,Z):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),T.unbindInstanceAttributes()}_processInstancedBuffers(G,D){}_processRendering(G,D,N,T,o,Z,n,C){const P=this.va(),r=P.getEngine();if(T=this._getRenderingFillMode(T),Z&&D.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(D,T,N,r),this;if(Z)this._renderWithInstances(D,T,o,N,r);else{r._currentDrawContext&&(r._currentDrawContext.useInstancing=!1);let N=0;o.renderSelf[D._id]&&(n&&n(!1,G.getWorldMatrix(),C),N++,this._draw(D,T,this._instanceDataStorage.overridenInstanceCount));const Z=o.visibleInstances[D._id];if(Z){const G=Z.length;N+=G;for(let N=0;N<G;N++){const G=Z[N].getWorldMatrix();n&&n(!0,G,C),this._draw(D,T)}}P._activeIndices.addCount(D.indexCount*N,!1)}return this}_rebuild(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(G&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const D in this._userInstancedBuffersStorage.vertexBuffers){const N=this._userInstancedBuffersStorage.vertexBuffers[D];N&&(G&&N.dispose(),this._userInstancedBuffersStorage.vertexBuffers[D]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(G)}_freeze(){if(this.le){for(let G=0;G<this.le.length;G++)this._getInstancesRenderList(G);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(G,D,N,T){let o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const Z=this._scene.getEngine(),n=Z.currentRenderPassId;if(void 0!==G&&(Z.currentRenderPassId=G),T)(!o||o&&T.isInFrustum(this._scene._frustumPlanes))&&this.render(T,!!D,N);else for(let C=0;C<this.le.length;C++){const G=this.le[C];(!o||o&&G.isInFrustum(this._scene._frustumPlanes))&&this.render(G,!!D,N)}return void 0!==G&&(Z.currentRenderPassId=n),this}directRender(){if(!this.le)return this;for(const G of this.le)this.render(G,!1);return this}render(G,D,N){var T,o,Z;const n=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const C=(null===(T=n.activeCameras)||void 0===T?void 0:T.length)??0;if((C>1&&n.activeCamera===n.activeCameras[0]||C<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const P=this._getInstancesRenderList(G._id,!!N);if(P.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const r=n.getEngine();let v=0,q=null;this.ignoreCameraMaxZ&&n.activeCamera&&!n._isInIntermediateRendering()&&(v=n.activeCamera.maxZ,q=n.activeCamera,n.activeCamera.maxZ=0,n.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const g=G.getRenderingMesh(),X=P.hardwareInstancedRendering[G._id]||g.hasThinInstances||!!this._userInstancedBuffersStorage&&!G.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,W=this._instanceDataStorage,j=G.Ha();if(!j)return q&&(q.maxZ=v,n.updateTransformMatrix(!0)),this;if(W.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===j){if(j._storeEffectOnSubMeshes&&(null===(o=G._drawWrapper)||void 0===o||!o._wasPreviouslyReady)||!j._storeEffectOnSubMeshes&&!j._getDrawWrapper()._wasPreviouslyReady)return q&&(q.maxZ=v,n.updateTransformMatrix(!0)),this}else{if(j._storeEffectOnSubMeshes){if(!j.isReadyForSubMesh(this,G,X))return q&&(q.maxZ=v,n.updateTransformMatrix(!0)),this}else if(!j.isReady(this,X))return q&&(q.maxZ=v,n.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=j}let Y;D&&r.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),Y=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?G._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const h=(null===(Z=Y)||void 0===Z?void 0:Z.effect)??null;for(const y of n._beforeRenderingMeshStage)y.action(this,G,P,h);if(!Y||!h)return q&&(q.maxZ=v,n.updateTransformMatrix(!0)),this;const m=N||this;let R;if(W.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Ge&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)R=W.sideOrientation;else{const G=m._getWorldMatrixDeterminant();R=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),G<0&&(R=R===y.d.ClockWiseSideOrientation?y.d.CounterClockWiseSideOrientation:y.d.ClockWiseSideOrientation),W.sideOrientation=R}const L=this._internalMeshDataInfo._effectiveMaterial._preBind(Y,R);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&r.setDepthWrite(!0);const w=this._internalMeshDataInfo._effectiveMaterial,B=w.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),X||this._bind(G,h,B,!1);const F=m.getWorldMatrix();w._storeEffectOnSubMeshes?w.bindForSubMesh(F,this,G):w.bind(F,this),!w.Ge&&w.separateCullingPass&&(r.setState(!0,w.zOffset,!1,!L,w.cullBackFaces,w.stencil,w.zOffsetUnits),this._processRendering(this,G,h,B,P,X,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),r.setState(!0,w.zOffset,!1,L,w.cullBackFaces,w.stencil,w.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(G)),this._processRendering(this,G,h,B,P,X,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const y of n._afterRenderingMeshStage)y.action(this,G,P,h);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),q&&(q.maxZ=v,n.updateTransformMatrix(!0)),2!==n.performancePriority||W.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(g.f.MatricesWeightsKind)&&(this.isVerticesDataPresent(g.f.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const G=this.getVerticesData(g.f.MatricesWeightsKind),D=G.length;for(let N=0;N<D;N+=4){const D=G[N]+G[N+1]+G[N+2]+G[N+3];if(0===D)G[N]=1;else{const T=1/D;G[N]*=T,G[N+1]*=T,G[N+2]*=T,G[N+3]*=T}}this.Ga(g.f.MatricesWeightsKind,G)}_normalizeSkinWeightsAndExtra(){const G=this.getVerticesData(g.f.MatricesWeightsExtraKind),D=this.getVerticesData(g.f.MatricesWeightsKind),N=D.length;for(let T=0;T<N;T+=4){let N=D[T]+D[T+1]+D[T+2]+D[T+3];if(N+=G[T]+G[T+1]+G[T+2]+G[T+3],0===N)D[T]=1;else{const o=1/N;D[T]*=o,D[T+1]*=o,D[T+2]*=o,D[T+3]*=o,G[T]*=o,G[T+1]*=o,G[T+2]*=o,G[T+3]*=o}}this.Ga(g.f.MatricesWeightsKind,D),this.Ga(g.f.MatricesWeightsKind,G)}validateSkinning(){const G=this.getVerticesData(g.f.MatricesWeightsExtraKind),D=this.getVerticesData(g.f.MatricesWeightsKind);if(null===D||null==this.skeleton)return{skinned:!1,valid:!0,Hd:"not skinned"};const N=D.length;let T=0,o=0,Z=0,n=0;const C=null===G?4:8,P=[];for(let g=0;g<=C;g++)P[g]=0;for(let g=0;g<N;g+=4){let N=D[g],r=N,v=0===r?0:1;for(let o=1;o<C;o++){const Z=o<4?D[g+o]:G[g+o-4];Z>N&&T++,0!==Z&&v++,r+=Z,N=Z}if(P[v]++,v>Z&&(Z=v),0===r)o++;else{const N=1/r;let T=0;for(let o=0;o<C;o++)T+=o<4?Math.abs(D[g+o]-D[g+o]*N):Math.abs(G[g+o-4]-G[g+o-4]*N);T>.001&&n++}}const r=this.skeleton.bones.length,v=this.getVerticesData(g.f.MatricesIndicesKind),q=this.getVerticesData(g.f.MatricesIndicesExtraKind);let X=0;for(let g=0;g<N;g+=4)for(let G=0;G<C;G++){const D=G<4?v[g+G]:q[g+G-4];(D>=r||D<0)&&X++}return{skinned:!0,valid:0===o&&0===n&&0===X,Hd:"Number of Weights = "+N/4+"\nMaximum influences = "+Z+"\nMissing Weights = "+o+"\nNot Sorted = "+T+"\nNot Normalized = "+n+"\nWeightCounts = ["+P+"]\nNumber of bones = "+r+"\nBad Bone Indices = "+X}}_checkDelayState(){const G=this.va();return this._geometry?this._geometry.load(G):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(G)),this}_queueLoad(G){G.addPendingData(this);const D=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return o.f.LoadFile(this.delayLoadingFile,(D=>{D instanceof ArrayBuffer?this._delayLoadingFunction(D,this):this._delayLoadingFunction(JSON.parse(D),this),this.instances.forEach((G=>{G.refreshBoundingInfo(),G._syncSubMeshes()})),this.delayLoadState=1,G.removePendingData(this)}),(()=>{}),G.offlineProvider,D),this}isInFrustum(G){return 2!==this.delayLoadState&&(!!super.isInFrustum(G)&&(this._checkDelayState(),!0))}setMaterialById(G){const D=this.va().materials;let N;for(N=D.length-1;N>-1;N--)if(D[N].id===G)return this.material=D[N],this;const T=this.va().multiMaterials;for(N=T.length-1;N>-1;N--)if(T[N].id===G)return this.material=T[N],this;return this}getAnimatables(){const G=[];return this.material&&G.push(this.material),this.skeleton&&G.push(this.skeleton),G}bakeTransformIntoVertices(G){if(!this.isVerticesDataPresent(g.f.PositionKind))return this;const D=this.le.splice(0);this._resetPointsArrayCache();let N=this.getVerticesData(g.f.PositionKind);const T=r.s.Zero();let o;for(o=0;o<N.length;o+=3)r.s.TransformCoordinatesFromFloatsToRef(N[o],N[o+1],N[o+2],G,T).toArray(N,o);if(this.Ga(g.f.PositionKind,N,this.getVertexBuffer(g.f.PositionKind).isUpdatable()),this.isVerticesDataPresent(g.f.NormalKind)){for(N=this.getVerticesData(g.f.NormalKind),o=0;o<N.length;o+=3)r.s.TransformNormalFromFloatsToRef(N[o],N[o+1],N[o+2],G,T).normalize().toArray(N,o);this.Ga(g.f.NormalKind,N,this.getVertexBuffer(g.f.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(g.f.TangentKind)){for(N=this.getVerticesData(g.f.TangentKind),o=0;o<N.length;o+=4)r.s.TransformNormalFromFloatsToRef(N[o],N[o+1],N[o+2],G,T).normalize().toArray(N,o);this.Ga(g.f.TangentKind,N,this.getVertexBuffer(g.f.TangentKind).isUpdatable())}return G.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.le=D,this}bakeCurrentTransformIntoVertices(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.se(!0)),this.resetLocalMatrix(G),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2?arguments[2]:void 0,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new p(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),G,this,D,N)}dispose(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const N=this._internalMeshDataInfo;if(N._onBeforeDrawObservable&&N._onBeforeDrawObservable.clear(),N._onBeforeBindObservable&&N._onBeforeBindObservable.clear(),N._onBeforeRenderObservable&&N._onBeforeRenderObservable.clear(),N._onAfterRenderObservable&&N._onAfterRenderObservable.clear(),N._onBetweenPassObservable&&N._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(N.meshMap)for(const G in N.meshMap){const D=N.meshMap[G];D&&(D._internalMeshDataInfo._source=null,N.meshMap[G]=void 0)}N._source&&N._source._internalMeshDataInfo.meshMap&&(N._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const G=this.va().meshes;for(const D of G){const G=D;G._internalMeshDataInfo&&G._internalMeshDataInfo._source&&G._internalMeshDataInfo._source===this&&(G._internalMeshDataInfo._source=null)}}N._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(G,D)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(G,D,N,T,Z,n){let C=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7?arguments[7]:void 0;const r=this.va();return o.f.LoadImage(G,(G=>{const o=G.width,P=G.height,r=this.getEngine().createCanvas(o,P).getContext("2d");r.drawImage(G,0,0);const v=r.getImageData(0,0,o,P).data;this.applyDisplacementMapFromBuffer(v,o,P,D,N,Z,n,C),T&&T(this)}),P||(()=>{}),r.offlineProvider),this}applyDisplacementMapFromBuffer(G,D,N,T,o,Z,n){let C=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(g.f.PositionKind)||!this.isVerticesDataPresent(g.f.NormalKind)||!this.isVerticesDataPresent(g.f.UVKind))return L.d.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const P=this.getVerticesData(g.f.PositionKind,!0,!0),v=this.getVerticesData(g.f.NormalKind),q=this.getVerticesData(g.f.UVKind);let W=r.s.Zero();const j=r.s.Zero(),Y=r.o.Zero();Z=Z||r.o.Zero(),n=n||new r.o(1,1);for(let g=0;g<P.length;g+=3){r.s.FromArrayToRef(P,g,W),r.s.FromArrayToRef(v,g,j),r.o.FromArrayToRef(q,g/3*2,Y);const C=4*((Math.abs(Y.x*n.x+Z.x%1)*(D-1)%D|0)+(Math.abs(Y.y*n.y+Z.y%1)*(N-1)%N|0)*D),X=.3*(G[C]/255)+.59*(G[C+1]/255)+.11*(G[C+2]/255);j.normalize(),j.scaleInPlace(T+(o-T)*X),W=W.add(j),W.toArray(P,g)}return X.c.ComputeNormals(P,this.ye(),v),C?(this.Ga(g.f.PositionKind,P),this.Ga(g.f.NormalKind,v),this.Ga(g.f.UVKind,q)):(this.updateVerticesData(g.f.PositionKind,P),this.updateVerticesData(g.f.NormalKind,v)),this}_getFlattenedNormals(G,D){const N=new Float32Array(3*G.length);let T=0;const o=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let Z=0;Z<G.length;Z+=3){const n=r.s.od(D,3*G[Z]),C=r.s.od(D,3*G[Z+1]),P=r.s.od(D,3*G[Z+2]),v=n.Jc(C),q=P.Jc(C),g=r.s.Normalize(r.s.Cross(v,q));o&&g.scaleInPlace(-1);for(let G=0;G<3;G++)N[T++]=g.x,N[T++]=g.y,N[T++]=g.z}return N}_convertToUnIndexedMesh(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const D=this.getVerticesDataKinds().filter((G=>{var D;return!(null!==(D=this.getVertexBuffer(G))&&void 0!==D&&D.getIsInstanced())})),N=this.ye(),T={},o=(G,D)=>{const T=new Float32Array(N.length*D);let o=0;for(let Z=0;Z<N.length;Z++)for(let n=0;n<D;n++)T[o++]=G[N[Z]*D+n];return T},Z=this.getBoundingInfo(),n=this.ve?this.le.slice(0):[];for(const C of D)T[C]=this.getVerticesData(C);for(const C of D){const D=this.getVertexBuffer(C),Z=D.getSize();if(G&&C===g.f.NormalKind){const G=this._getFlattenedNormals(N,T[g.f.PositionKind]);this.Ga(g.f.NormalKind,G,D.isUpdatable(),Z)}else this.Ga(C,o(T[C],Z),D.isUpdatable(),Z)}if(this.morphTargetManager){for(let D=0;D<this.morphTargetManager.numTargets;D++){const T=this.morphTargetManager.getTarget(D),Z=T.getPositions();T.setPositions(o(Z,3));const n=T.getNormals();n&&T.setNormals(G?this._getFlattenedNormals(N,Z):o(n,3));const C=T.getTangents();C&&T.setTangents(o(C,3));const P=T.getUVs();P&&T.setUVs(o(P,2))}this.morphTargetManager.synchronize()}for(let C=0;C<N.length;C++)N[C]=C;this.setIndices(N),this._unIndexed=!0,this.releaseSubMeshes();for(const C of n){const G=C.getBoundingInfo();Y.c.AddToMesh(C.materialIndex,C.indexStart,C.indexCount,C.indexStart,C.indexCount,this).setBoundingInfo(G)}return this.setBoundingInfo(Z),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const D=X.c.ExtractFromMesh(this);let N;if(G&&this.isVerticesDataPresent(g.f.NormalKind)&&D.ya){for(N=0;N<D.ya.length;N++)D.ya[N]*=-1;this.Ga(g.f.NormalKind,D.ya,this.isVertexBufferUpdatable(g.f.NormalKind))}if(D.indices){let G;for(N=0;N<D.indices.length;N+=3)G=D.indices[N+1],D.indices[N+1]=D.indices[N+2],D.indices[N+2]=G;this.setIndices(D.indices,null,this.isVertexBufferUpdatable(g.f.PositionKind),!0)}return this}increaseVertices(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const D=X.c.ExtractFromMesh(this),N=D.indices&&!Array.isArray(D.indices)&&Array.from?Array.from(D.indices):D.indices,T=D.xa&&!Array.isArray(D.xa)&&Array.from?Array.from(D.xa):D.xa,o=D.Aa&&!Array.isArray(D.Aa)&&Array.from?Array.from(D.Aa):D.Aa,Z=D.ya&&!Array.isArray(D.ya)&&Array.from?Array.from(D.ya):D.ya;if(N&&T){D.indices=N,D.xa=T,o&&(D.Aa=o),Z&&(D.ya=Z);const n=G+1,C=new Array;for(let G=0;G<n+1;G++)C[G]=new Array;let P,v;const q=new r.s(0,0,0),X=new r.s(0,0,0),W=new r.o(0,0),j=new Array,Y=new Array,y=new Array;let h,m,R,L=T.length;o&&(m=o.length),Z&&(R=Z.length);for(let G=0;G<N.length;G+=3){Y[0]=N[G],Y[1]=N[G+1],Y[2]=N[G+2];for(let G=0;G<3;G++)if(P=Y[G],v=Y[(G+1)%3],void 0===y[P]&&void 0===y[v]?(y[P]=new Array,y[v]=new Array):(void 0===y[P]&&(y[P]=new Array),void 0===y[v]&&(y[v]=new Array)),void 0===y[P][v]&&void 0===y[v][P]){y[P][v]=[],q.x=(T[3*v]-T[3*P])/n,q.y=(T[3*v+1]-T[3*P+1])/n,q.z=(T[3*v+2]-T[3*P+2])/n,Z&&(X.x=(Z[3*v]-Z[3*P])/n,X.y=(Z[3*v+1]-Z[3*P+1])/n,X.z=(Z[3*v+2]-Z[3*P+2])/n),o&&(W.x=(o[2*v]-o[2*P])/n,W.y=(o[2*v+1]-o[2*P+1])/n),y[P][v].push(P);for(let G=1;G<n;G++)y[P][v].push(T.length/3),T[L++]=T[3*P]+G*q.x,T[L++]=T[3*P+1]+G*q.y,T[L++]=T[3*P+2]+G*q.z,Z&&(Z[R++]=Z[3*P]+G*X.x,Z[R++]=Z[3*P+1]+G*X.y,Z[R++]=Z[3*P+2]+G*X.z),o&&(o[m++]=o[2*P]+G*W.x,o[m++]=o[2*P+1]+G*W.y);y[P][v].push(v),y[v][P]=new Array,h=y[P][v].length;for(let G=0;G<h;G++)y[v][P][G]=y[P][v][h-1-G]}C[0][0]=N[G],C[1][0]=y[N[G]][N[G+1]][1],C[1][1]=y[N[G]][N[G+2]][1];for(let D=2;D<n;D++){C[D][0]=y[N[G]][N[G+1]][D],C[D][D]=y[N[G]][N[G+2]][D],q.x=(T[3*C[D][D]]-T[3*C[D][0]])/D,q.y=(T[3*C[D][D]+1]-T[3*C[D][0]+1])/D,q.z=(T[3*C[D][D]+2]-T[3*C[D][0]+2])/D,Z&&(X.x=(Z[3*C[D][D]]-Z[3*C[D][0]])/D,X.y=(Z[3*C[D][D]+1]-Z[3*C[D][0]+1])/D,X.z=(Z[3*C[D][D]+2]-Z[3*C[D][0]+2])/D),o&&(W.x=(o[2*C[D][D]]-o[2*C[D][0]])/D,W.y=(o[2*C[D][D]+1]-o[2*C[D][0]+1])/D);for(let G=1;G<D;G++)C[D][G]=T.length/3,T[L++]=T[3*C[D][0]]+G*q.x,T[L++]=T[3*C[D][0]+1]+G*q.y,T[L++]=T[3*C[D][0]+2]+G*q.z,Z&&(Z[R++]=Z[3*C[D][0]]+G*X.x,Z[R++]=Z[3*C[D][0]+1]+G*X.y,Z[R++]=Z[3*C[D][0]+2]+G*X.z),o&&(o[m++]=o[2*C[D][0]]+G*W.x,o[m++]=o[2*C[D][0]+1]+G*W.y)}C[n]=y[N[G+1]][N[G+2]],j.push(C[0][0],C[1][0],C[1][1]);for(let G=1;G<n;G++){let D;for(D=0;D<G;D++)j.push(C[G][D],C[G+1][D],C[G+1][D+1]),j.push(C[G][D],C[G+1][D+1],C[G][D+1]);j.push(C[G][D],C[G+1][D],C[G+1][D+1])}}D.indices=j,D.Ca(this,this.isVertexBufferUpdatable(g.f.PositionKind))}else L.d.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const G=X.c.ExtractFromMesh(this),D=G.Aa,N=G.indices,T=G.xa,o=G.za,Z=G.matricesIndices,n=G.matricesWeights,C=G.matricesIndicesExtra,P=G.matricesWeightsExtra;if(void 0===N||void 0===T||null===N||null===T)L.d.Warn("VertexData contains empty entries");else{const r=new Array,v=new Array,q=new Array,W=new Array,j=new Array,Y=new Array,y=new Array,h=new Array;let m=new Array,R=0;const L={};let w,B;for(let G=0;G<N.length;G+=3){B=[N[G],N[G+1],N[G+2]],m=[];for(let G=0;G<3;G++){m[G]="";for(let D=0;D<3;D++)Math.abs(T[3*B[G]+D])<1e-8&&(T[3*B[G]+D]=0),m[G]+=T[3*B[G]+D]+"|"}if(m[0]!=m[1]&&m[0]!=m[2]&&m[1]!=m[2])for(let G=0;G<3;G++){if(w=L[m[G]],void 0===w){L[m[G]]=R,w=R++;for(let D=0;D<3;D++)r.push(T[3*B[G]+D]);if(null!==o&&void 0!==o)for(let D=0;D<4;D++)W.push(o[4*B[G]+D]);if(null!==D&&void 0!==D)for(let N=0;N<2;N++)q.push(D[2*B[G]+N]);if(null!==Z&&void 0!==Z)for(let D=0;D<4;D++)j.push(Z[4*B[G]+D]);if(null!==n&&void 0!==n)for(let D=0;D<4;D++)Y.push(n[4*B[G]+D]);if(null!==C&&void 0!==C)for(let D=0;D<4;D++)y.push(C[4*B[G]+D]);if(null!==P&&void 0!==P)for(let D=0;D<4;D++)h.push(P[4*B[G]+D])}v.push(w)}}const F=new Array;X.c.ComputeNormals(r,v,F),G.xa=r,G.indices=v,G.ya=F,null!==D&&void 0!==D&&(G.Aa=q),null!==o&&void 0!==o&&(G.za=W),null!==Z&&void 0!==Z&&(G.matricesIndices=j),null!==n&&void 0!==n&&(G.matricesWeights=Y),null!==C&&void 0!==C&&(G.matricesIndicesExtra=y),null!==n&&void 0!==n&&(G.matricesWeightsExtra=h),G.Ca(this,this.isVertexBufferUpdatable(g.f.PositionKind))}}static _instancedMeshFactory(G,D){throw(0,B.d)("InstancedMesh")}static _PhysicsImpostorParser(G,D,N){throw(0,B.d)("PhysicsImpostor")}nb(G){const D=p._instancedMeshFactory(G,this);return D.parent=this.parent,D}synchronizeInstances(){for(let G=0;G<this.instances.length;G++){this.instances[G]._syncSubMeshes()}return this}optimizeIndices(G){const D=this.ye(),N=this.getVerticesData(g.f.PositionKind);if(!N||!D)return this;const T=[];for(let o=0;o<N.length;o+=3)T.push(r.s.od(N,o));const Z=[];return o.b.SyncAsyncForLoop(T.length,40,(G=>{const D=T.length-1-G,N=T[D];for(let o=0;o<D;++o){const G=T[o];if(N.equals(G)){Z[D]=o;break}}}),(()=>{for(let G=0;G<D.length;++G)D[G]=Z[D[G]]||D[G];const N=this.le.slice(0);this.setIndices(D),this.le=N,G&&G(this)})),this}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};G.name=this.name,G.id=this.id,G.uniqueId=this.uniqueId,G.type=this.getClassName(),n.b&&n.b.HasTags(this)&&(G.tags=n.b.GetTags(this)),G.position=this.position.vd(),this.rotationQuaternion?G.rotationQuaternion=this.rotationQuaternion.vd():this.rotation&&(G.rotation=this.rotation.vd()),G.Ed=this.Ed.vd(),this._postMultiplyPivotMatrix?G.pivotMatrix=this.getPivotMatrix().vd():G.localMatrix=this.getPivotMatrix().vd(),G.isEnabled=this.isEnabled(!1),G.isVisible=this.isVisible,G.infiniteDistance=this.infiniteDistance,G.pickable=this.Ud,G.receiveShadows=this.receiveShadows,G.billboardMode=this.billboardMode,G.visibility=this.visibility,G.ue=this.ue,G.checkCollisions=this.checkCollisions,G.ellipsoid=this.ellipsoid.vd(),G.ellipsoidOffset=this.ellipsoidOffset.vd(),G.Da=this.Da,G.isBlocker=this.isBlocker,G.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(G),G.isUnIndexed=this.isUnIndexed;const D=this._geometry;if(D&&this.le){G.geometryUniqueId=D.uniqueId,G.geometryId=D.id,G.le=[];for(let D=0;D<this.le.length;D++){const N=this.le[D];G.le.push({materialIndex:N.materialIndex,verticesStart:N.verticesStart,verticesCount:N.verticesCount,indexStart:N.indexStart,indexCount:N.indexCount})}}if(this.material?this.material.doNotSerialize||(G.materialUniqueId=this.material.uniqueId,G.materialId=this.material.id):(this.material=null,G.materialUniqueId=this._scene.defaultMaterial.uniqueId,G.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(G.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(G.skeletonId=this.skeleton.id,G.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(F.c.NAME_PHYSICSENGINE)){const D=this.getPhysicsImpostor();D&&(G.physicsMass=D.getParam("mass"),G.physicsFriction=D.getParam("friction"),G.physicsRestitution=D.getParam("mass"),G.physicsImpostor=D.type)}this.metadata&&(G.metadata=this.metadata),G.instances=[];for(let N=0;N<this.instances.length;N++){const D=this.instances[N];if(D.doNotSerialize)continue;const T={name:D.name,id:D.id,isEnabled:D.isEnabled(!1),isVisible:D.isVisible,Ud:D.Ud,checkCollisions:D.checkCollisions,position:D.position.vd(),Ed:D.Ed.vd()};if(D.parent&&D.parent._serializeAsParent(T),D.rotationQuaternion?T.rotationQuaternion=D.rotationQuaternion.vd():D.rotation&&(T.rotation=D.rotation.vd()),this.va()._getComponent(F.c.NAME_PHYSICSENGINE)){const G=D.getPhysicsImpostor();G&&(T.physicsMass=G.getParam("mass"),T.physicsFriction=G.getParam("friction"),T.physicsRestitution=G.getParam("mass"),T.physicsImpostor=G.type)}D.metadata&&(T.metadata=D.metadata),D.actionManager&&(T.actions=D.actionManager.serialize(D.name)),G.instances.push(T),R.e.AppendSerializedAnimations(D,T),T.ranges=D.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(G.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const D={data:{},sizes:{},strides:{}};for(const G in this._userThinInstanceBuffersStorage.data)D.data[G]=Array.from(this._userThinInstanceBuffersStorage.data[G]),D.sizes[G]=this._userThinInstanceBuffersStorage.sizes[G],D.strides[G]=this._userThinInstanceBuffersStorage.strides[G];G.thinInstances.userThinInstance=D}return R.e.AppendSerializedAnimations(this,G),G.ranges=this.serializeAnimationRanges(),G.layerMask=this.layerMask,G.alphaIndex=this.alphaIndex,G.hasVertexAlpha=this.hasVertexAlpha,G.overlayAlpha=this.overlayAlpha,G.overlayColor=this.overlayColor.vd(),G.renderOverlay=this.renderOverlay,G.applyFog=this.applyFog,this.actionManager&&(G.actions=this.actionManager.serialize(this.name)),G}_syncGeometryWithMorphTargetManager(){if(!this.ve)return;this._markSubMeshesAsAttributesDirty();const G=this._internalAbstractMeshDataInfo._morphTargetManager;if(G&&G.vertexCount){if(G.vertexCount!==this.getTotalVertices())return L.d.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(G.isUsingTextureForTargets)return;for(let D=0;D<G.numInfluencers;D++){const N=G.getActiveTarget(D),T=N.getPositions();if(!T)return void L.d.Error("Invalid morph target. Target must have positions.");this.ve.Ga(g.f.PositionKind+D,T,!1,3);const o=N.getNormals();o&&this.ve.Ga(g.f.NormalKind+D,o,!1,3);const Z=N.getTangents();Z&&this.ve.Ga(g.f.TangentKind+D,Z,!1,3);const n=N.getUVs();n&&this.ve.Ga(g.f.UVKind+"_"+D,n,!1,2)}}else{let G=0;for(;this.ve.isVerticesDataPresent(g.f.PositionKind+G);)this.ve.removeVerticesData(g.f.PositionKind+G),this.ve.isVerticesDataPresent(g.f.NormalKind+G)&&this.ve.removeVerticesData(g.f.NormalKind+G),this.ve.isVerticesDataPresent(g.f.TangentKind+G)&&this.ve.removeVerticesData(g.f.TangentKind+G),this.ve.isVerticesDataPresent(g.f.UVKind+G)&&this.ve.removeVerticesData(g.f.UVKind+"_"+G),G++}}static Parse(G,D,N){let T;if(T=G.type&&"LinesMesh"===G.type?p._LinesMeshParser(G,D):G.type&&"GroundMesh"===G.type?p._GroundMeshParser(G,D):G.type&&"GoldbergMesh"===G.type?p._GoldbergMeshParser(G,D):G.type&&"GreasedLineMesh"===G.type?p._GreasedLineMeshParser(G,D):G.type&&"TrailMesh"===G.type?p._TrailMeshParser(G,D):new p(G.name,D),T.id=G.id,T._waitingParsedUniqueId=G.uniqueId,n.b&&n.b.AddTagsTo(T,G.tags),T.position=r.s.od(G.position),void 0!==G.metadata&&(T.metadata=G.metadata),G.rotationQuaternion?T.rotationQuaternion=r.g.od(G.rotationQuaternion):G.rotation&&(T.rotation=r.s.od(G.rotation)),T.Ed=r.s.od(G.Ed),G.localMatrix?T.setPreTransformMatrix(r.c.od(G.localMatrix)):G.pivotMatrix&&T.setPivotMatrix(r.c.od(G.pivotMatrix)),T.Lg(G.isEnabled),T.isVisible=G.isVisible,T.infiniteDistance=G.infiniteDistance,T.ue=!!G.ue,T.showBoundingBox=G.showBoundingBox,T.showSubMeshesBoundingBox=G.showSubMeshesBoundingBox,void 0!==G.applyFog&&(T.applyFog=G.applyFog),void 0!==G.pickable&&(T.Ud=G.pickable),void 0!==G.alphaIndex&&(T.alphaIndex=G.alphaIndex),T.receiveShadows=G.receiveShadows,void 0!==G.billboardMode&&(T.billboardMode=G.billboardMode),void 0!==G.visibility&&(T.visibility=G.visibility),T.checkCollisions=G.checkCollisions,T.Da=!!G.Da,G.ellipsoid&&(T.ellipsoid=r.s.od(G.ellipsoid)),G.ellipsoidOffset&&(T.ellipsoidOffset=r.s.od(G.ellipsoidOffset)),null!=G.overrideMaterialSideOrientation&&(T.sideOrientation=G.overrideMaterialSideOrientation),void 0!==G.sideOrientation&&(T.sideOrientation=G.sideOrientation),void 0!==G.isBlocker&&(T.isBlocker=G.isBlocker),T._shouldGenerateFlatShading=G.useFlatShading,G.ei&&(T._waitingData.ei=G.ei),void 0!==G.parentId&&(T._waitingParentId=G.parentId),void 0!==G.parentInstanceIndex&&(T._waitingParentInstanceIndex=G.parentInstanceIndex),void 0!==G.actions&&(T._waitingData.actions=G.actions),void 0!==G.overlayAlpha&&(T.overlayAlpha=G.overlayAlpha),void 0!==G.overlayColor&&(T.overlayColor=v.d.od(G.overlayColor)),void 0!==G.renderOverlay&&(T.renderOverlay=G.renderOverlay),T.isUnIndexed=!!G.isUnIndexed,T.hasVertexAlpha=G.hasVertexAlpha,G.delayLoadingFile?(T.delayLoadState=4,T.delayLoadingFile=N+G.delayLoadingFile,T.buildBoundingInfo(r.s.od(G.boundingBoxMinimum),r.s.od(G.boundingBoxMaximum)),G._binaryInfo&&(T._binaryInfo=G._binaryInfo),T._delayInfo=[],G.hasUVs&&T._delayInfo.push(g.f.UVKind),G.hasUVs2&&T._delayInfo.push(g.f.UV2Kind),G.hasUVs3&&T._delayInfo.push(g.f.UV3Kind),G.hasUVs4&&T._delayInfo.push(g.f.UV4Kind),G.hasUVs5&&T._delayInfo.push(g.f.UV5Kind),G.hasUVs6&&T._delayInfo.push(g.f.UV6Kind),G.hasColors&&T._delayInfo.push(g.f.ColorKind),G.hasMatricesIndices&&T._delayInfo.push(g.f.MatricesIndicesKind),G.hasMatricesWeights&&T._delayInfo.push(g.f.MatricesWeightsKind),T._delayLoadingFunction=W.d._ImportGeometry,m.d.ForceFullSceneLoadingForIncremental&&T._checkDelayState()):W.d._ImportGeometry(G,T),G.materialUniqueId?T._waitingMaterialId=G.materialUniqueId:G.materialId&&(T._waitingMaterialId=G.materialId),G.morphTargetManagerId>-1&&(T._waitingMorphTargetManagerId=G.morphTargetManagerId),void 0!==G.skeletonId&&null!==G.skeletonId&&(T.skeleton=D.getLastSkeletonById(G.skeletonId),G.numBoneInfluencers&&(T.numBoneInfluencers=G.numBoneInfluencers)),G.animations){for(let D=0;D<G.animations.length;D++){const N=G.animations[D],o=(0,w.e)("BABYLON.Animation");o&&T.animations.push(o.Parse(N))}q.b.ParseAnimationRanges(T,G,D)}if(G.autoAnimate&&D.beginAnimation(T,G.autoAnimateFrom,G.autoAnimateTo,G.autoAnimateLoop,G.autoAnimateSpeed||1),G.layerMask&&!isNaN(G.layerMask)?T.layerMask=Math.abs(parseInt(G.layerMask)):T.layerMask=268435455,G.physicsImpostor&&(T.physicsImpostor=p._PhysicsImpostorParser(D,T,G)),G.lodMeshIds&&(T._waitingData.lods={ids:G.lodMeshIds,distances:G.lodDistances?G.lodDistances:null,coverages:G.lodCoverages?G.lodCoverages:null}),G.instances)for(let o=0;o<G.instances.length;o++){const N=G.instances[o],Z=T.nb(N.name);if(N.id&&(Z.id=N.id),n.b&&(N.tags?n.b.AddTagsTo(Z,N.tags):n.b.AddTagsTo(Z,G.tags)),Z.position=r.s.od(N.position),void 0!==N.metadata&&(Z.metadata=N.metadata),void 0!==N.parentId&&(Z._waitingParentId=N.parentId),void 0!==N.parentInstanceIndex&&(Z._waitingParentInstanceIndex=N.parentInstanceIndex),void 0!==N.isEnabled&&null!==N.isEnabled&&Z.Lg(N.isEnabled),void 0!==N.isVisible&&null!==N.isVisible&&(Z.isVisible=N.isVisible),void 0!==N.Ud&&null!==N.Ud&&(Z.Ud=N.Ud),N.rotationQuaternion?Z.rotationQuaternion=r.g.od(N.rotationQuaternion):N.rotation&&(Z.rotation=r.s.od(N.rotation)),Z.Ed=r.s.od(N.Ed),void 0!=N.checkCollisions&&null!=N.checkCollisions&&(Z.checkCollisions=N.checkCollisions),void 0!=N.pickable&&null!=N.pickable&&(Z.Ud=N.pickable),void 0!=N.showBoundingBox&&null!=N.showBoundingBox&&(Z.showBoundingBox=N.showBoundingBox),void 0!=N.showSubMeshesBoundingBox&&null!=N.showSubMeshesBoundingBox&&(Z.showSubMeshesBoundingBox=N.showSubMeshesBoundingBox),void 0!=N.alphaIndex&&null!=N.showSubMeshesBoundingBox&&(Z.alphaIndex=N.alphaIndex),N.physicsImpostor&&(Z.physicsImpostor=p._PhysicsImpostorParser(D,Z,N)),void 0!==N.actions&&(Z._waitingData.actions=N.actions),N.animations){for(let G=0;G<N.animations.length;G++){const D=N.animations[G],T=(0,w.e)("BABYLON.Animation");T&&Z.animations.push(T.Parse(D))}q.b.ParseAnimationRanges(Z,N,D),N.autoAnimate&&D.beginAnimation(Z,N.autoAnimateFrom,N.autoAnimateTo,N.autoAnimateLoop,N.autoAnimateSpeed||1)}}if(G.thinInstances){const D=G.thinInstances;if(T.thinInstanceEnablePicking=!!D.enablePicking,D.matrixData?(T.Sj("matrix",new Float32Array(D.matrixData),16,!1),T._thinInstanceDataStorage.matrixBufferSize=D.matrixBufferSize,T._thinInstanceDataStorage.instancesCount=D.instancesCount):T._thinInstanceDataStorage.matrixBufferSize=D.matrixBufferSize,G.thinInstances.userThinInstance){const D=G.thinInstances.userThinInstance;for(const G in D.data)T.Sj(G,new Float32Array(D.data[G]),D.strides[G],!1),T._userThinInstanceBuffersStorage.sizes[G]=D.sizes[G]}}return T}setPositionsForCPUSkinning(){const G=this._internalMeshDataInfo;if(!G._sourcePositions){const D=this.getVerticesData(g.f.PositionKind);if(!D)return G._sourcePositions;G._sourcePositions=new Float32Array(D),this.isVertexBufferUpdatable(g.f.PositionKind)||this.Ga(g.f.PositionKind,D,!0)}return G._sourcePositions}setNormalsForCPUSkinning(){const G=this._internalMeshDataInfo;if(!G._sourceNormals){const D=this.getVerticesData(g.f.NormalKind);if(!D)return G._sourceNormals;G._sourceNormals=new Float32Array(D),this.isVertexBufferUpdatable(g.f.NormalKind)||this.Ga(g.f.NormalKind,D,!0)}return G._sourceNormals}applySkeleton(G){if(!this.ve)return this;if(this.ve._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.ve._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(g.f.PositionKind))return this;if(!this.isVerticesDataPresent(g.f.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(g.f.MatricesWeightsKind))return this;const D=this.isVerticesDataPresent(g.f.NormalKind),N=this._internalMeshDataInfo;if(!N._sourcePositions){const G=this.le.slice();this.setPositionsForCPUSkinning(),this.le=G}D&&!N._sourceNormals&&this.setNormalsForCPUSkinning();let T=this.getVerticesData(g.f.PositionKind);if(!T)return this;T instanceof Float32Array||(T=new Float32Array(T));let o=this.getVerticesData(g.f.NormalKind);if(D){if(!o)return this;o instanceof Float32Array||(o=new Float32Array(o))}const Z=this.getVerticesData(g.f.MatricesIndicesKind),n=this.getVerticesData(g.f.MatricesWeightsKind);if(!n||!Z)return this;const C=this.numBoneInfluencers>4,P=C?this.getVerticesData(g.f.MatricesIndicesExtraKind):null,v=C?this.getVerticesData(g.f.MatricesWeightsExtraKind):null,q=G.getTransformMatrices(this),X=r.s.Zero(),W=new r.c,j=new r.c;let Y,y=0;for(let g=0;g<T.length;g+=3,y+=4){let G;for(Y=0;Y<4;Y++)G=n[y+Y],G>0&&(r.c.FromFloat32ArrayToRefScaled(q,Math.floor(16*Z[y+Y]),G,j),W.addToSelf(j));if(C)for(Y=0;Y<4;Y++)G=v[y+Y],G>0&&(r.c.FromFloat32ArrayToRefScaled(q,Math.floor(16*P[y+Y]),G,j),W.addToSelf(j));r.s.TransformCoordinatesFromFloatsToRef(N._sourcePositions[g],N._sourcePositions[g+1],N._sourcePositions[g+2],W,X),X.toArray(T,g),D&&(r.s.TransformNormalFromFloatsToRef(N._sourceNormals[g],N._sourceNormals[g+1],N._sourceNormals[g+2],W,X),X.toArray(o,g)),W.reset()}return this.updateVerticesData(g.f.PositionKind,T),D&&this.updateVerticesData(g.f.NormalKind,o),this}static MinMax(G){let D=null,N=null;return G.forEach((function(G){const T=G.getBoundingInfo().boundingBox;D&&N?(D.minimizeInPlace(T.minimumWorld),N.maximizeInPlace(T.maximumWorld)):(D=T.minimumWorld,N=T.maximumWorld)})),D&&N?{min:D,max:N}:{min:r.s.Zero(),max:r.s.Zero()}}static Center(G){const D=G instanceof Array?p.MinMax(G):G;return r.s.Center(D.min,D.max)}static MergeMeshes(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],N=arguments.length>2?arguments[2]:void 0,T=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5?arguments[5]:void 0;return(0,C.n)(p._MergeMeshesCoroutine(G,D,N,T,o,Z,!1))}static MergeMeshesAsync(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],N=arguments.length>2?arguments[2]:void 0,T=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5?arguments[5]:void 0;return(0,C.k)(p._MergeMeshesCoroutine(G,D,N,T,o,Z,!0),(0,C.e)())}static*_MergeMeshesCoroutine(G){let D,N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],T=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,Z=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0,C=arguments.length>6?arguments[6]:void 0;if(0===(G=G.filter(Boolean)).length)return null;if(!T){let N=0;for(D=0;D<G.length;D++)if(N+=G[D].getTotalVertices(),N>=65536)return L.d.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}n&&(Z=!1);const P=new Array,r=new Array,v=new Array,q=G[0].sideOrientation;for(D=0;D<G.length;D++){const N=G[D];if(N.isAnInstance)return L.d.Warn("Cannot merge instance meshes."),null;if(q!==N.sideOrientation)return L.d.Warn("Cannot merge meshes with different sideOrientation values."),null;if(Z&&v.push(N.getTotalIndices()),n)if(N.material){const G=N.material;if(G instanceof h.c){for(let D=0;D<G.Jg.length;D++)P.indexOf(G.Jg[D])<0&&P.push(G.Jg[D]);for(let D=0;D<N.le.length;D++)r.push(P.indexOf(G.Jg[N.le[D].materialIndex])),v.push(N.le[D].indexCount)}else{P.indexOf(G)<0&&P.push(G);for(let D=0;D<N.le.length;D++)r.push(P.indexOf(G)),v.push(N.le[D].indexCount)}}else for(let G=0;G<N.le.length;G++)r.push(0),v.push(N.le[G].indexCount)}const g=G[0],W=G=>{const D=G.se(!0);return{vertexData:X.c.ExtractFromMesh(G,!1,!1),transform:D}},{vertexData:j,transform:y}=W(g);C&&(yield);const m=new Array(G.length-1);for(let X=1;X<G.length;X++)m[X-1]=W(G[X]),C&&(yield);const R=j._mergeCoroutine(y,m,T,C,!N);let w=R.next();for(;!w.done;)C&&(yield),w=R.next();const B=w.value;o||(o=new p(g.name+"_merged",g.va()));const F=B._applyToCoroutine(o,void 0,C);let S=F.next();for(;!S.done;)C&&(yield),S=F.next();if(o.checkCollisions=g.checkCollisions,o.sideOrientation=g.sideOrientation,N)for(D=0;D<G.length;D++)G[D].dispose();if(Z||n){o.releaseSubMeshes(),D=0;let G=0;for(;D<v.length;)Y.c.CreateFromIndices(0,G,v[D],o,void 0,!1),G+=v[D],D++;for(const D of o.le)D.refreshBoundingInfo();o.se(!0)}if(n){const G=new h.c(g.name+"_merged",g.va());G.Jg=P;for(let D=0;D<o.le.length;D++)o.le[D].materialIndex=r[D];o.material=G}else o.material=g.material;return o}Ij(G){G._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(G)}Hj(G){const D=G._indexInSourceMeshInstanceArray;if(-1!=D){if(D!==this.instances.length-1){const G=this.instances[this.instances.length-1];this.instances[D]=G,G._indexInSourceMeshInstanceArray=D}G._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===y.d.CounterClockWiseSideOrientation}_getRenderingFillMode(G){const D=this.va();return D.forcePointsCloud?y.d.PointFillMode:D.forceWireframe?y.d.WireFrameFillMode:this.overrideRenderingFillMode??G}setMaterialByID(G){return this.setMaterialById(G)}static CreateRibbon(G,D,N,T,o,Z,n,C,P){throw new Error("Import MeshBuilder to populate this function")}static kb(G,D,N,T,o,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(G,D,N,T,o){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(G,D,N,T,o,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(G,D,N,T){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(G,D,N,T,o,Z,n,C,P){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(G,D,N,T,o,Z,n){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(G,D,N,T,o,Z,n,C,P,r){throw new Error("Import MeshBuilder to populate this function")}static lb(G,D,N,T,o){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(G,D,N,T,o,Z,n,C){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(G,D,N,T,o,Z,n){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(G,D,N,T,o,Z,n,C){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(G,D,N,T,o,Z,n,C,P,r){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(G,D,N,T,o,Z,n,C,P,r,v,q){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(G,D,N,T,o,Z,n){throw new Error("Import MeshBuilder to populate this function")}static Mg(G,D,N,T,o){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(G,D,N,T,o,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(G,D,N,T,o,Z,n,C,P){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(G,D,N,T,o,Z,n,C,P,r,v){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(G,D,N,T,o,Z,n,C,P,r){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(G,D,N){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(G,D,N){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(G,D,N,T,o,Z){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(G,D,N){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(G){throw new Error("Import MeshBuilder to populate this function")}}p.FRONTSIDE=X.c.FRONTSIDE,p.BACKSIDE=X.c.BACKSIDE,p.DOUBLESIDE=X.c.DOUBLESIDE,p.DEFAULTSIDE=X.c.DEFAULTSIDE,p.NO_CAP=0,p.CAP_START=1,p.CAP_END=2,p.CAP_ALL=3,p.NO_FLIP=0,p.FLIP_TILE=1,p.ROTATE_TILE=2,p.FLIP_ROW=3,p.ROTATE_ROW=4,p.FLIP_N_ROTATE_TILE=5,p.FLIP_N_ROTATE_ROW=6,p.CENTER=0,p.LEFT=1,p.RIGHT=2,p.TOP=3,p.BOTTOM=4,p.INSTANCEDMESH_SORT_TRANSPARENT=!1,p._GroundMeshParser=(G,D)=>{throw(0,B.d)("GroundMesh")},p._GoldbergMeshParser=(G,D)=>{throw(0,B.d)("GoldbergMesh")},p._LinesMeshParser=(G,D)=>{throw(0,B.d)("LinesMesh")},p._GreasedLineMeshParser=(G,D)=>{throw(0,B.d)("GreasedLineMesh")},p._GreasedLineRibbonMeshParser=(G,D)=>{throw(0,B.d)("GreasedLineRibbonMesh")},p._TrailMeshParser=(G,D)=>{throw(0,B.d)("TrailMesh")},(0,w.h)("BABYLON.Mesh",p)},11407:(G,D,N)=>{"use strict";N.d(D,{c:()=>W});var T=N(980),o=N(1009),Z=N(1255),n=N(1094),C=N(1185),P=N(1105),r=N(985),v=N(11385),q=N(1072),g=N(1337);class X{}class W{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,v.h)(this._applyToCoroutine.bind(this)),this.uniqueId=W._UniqueIDGenerator,W._UniqueIDGenerator++}set(G,D){switch(G.length||P.d.Warn(`Setting vertex data kind '${D}' with an empty array`),D){case Z.f.PositionKind:this.xa=G;break;case Z.f.NormalKind:this.ya=G;break;case Z.f.TangentKind:this.tangents=G;break;case Z.f.UVKind:this.Aa=G;break;case Z.f.UV2Kind:this.uvs2=G;break;case Z.f.UV3Kind:this.uvs3=G;break;case Z.f.UV4Kind:this.uvs4=G;break;case Z.f.UV5Kind:this.uvs5=G;break;case Z.f.UV6Kind:this.uvs6=G;break;case Z.f.ColorKind:this.za=G;break;case Z.f.MatricesIndicesKind:this.matricesIndices=G;break;case Z.f.MatricesWeightsKind:this.matricesWeights=G;break;case Z.f.MatricesIndicesExtraKind:this.matricesIndicesExtra=G;break;case Z.f.MatricesWeightsExtraKind:this.matricesWeightsExtra=G}}Ca(G,D){return this._applyTo(G,D,!1),this}applyToGeometry(G,D){return this._applyTo(G,D,!1),this}updateMesh(G){return this._update(G),this}updateGeometry(G){return this._update(G),this}*_applyToCoroutine(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2?arguments[2]:void 0;if(this.xa&&(G.Ga(Z.f.PositionKind,this.xa,D),N&&(yield)),this.ya&&(G.Ga(Z.f.NormalKind,this.ya,D),N&&(yield)),this.tangents&&(G.Ga(Z.f.TangentKind,this.tangents,D),N&&(yield)),this.Aa&&(G.Ga(Z.f.UVKind,this.Aa,D),N&&(yield)),this.uvs2&&(G.Ga(Z.f.UV2Kind,this.uvs2,D),N&&(yield)),this.uvs3&&(G.Ga(Z.f.UV3Kind,this.uvs3,D),N&&(yield)),this.uvs4&&(G.Ga(Z.f.UV4Kind,this.uvs4,D),N&&(yield)),this.uvs5&&(G.Ga(Z.f.UV5Kind,this.uvs5,D),N&&(yield)),this.uvs6&&(G.Ga(Z.f.UV6Kind,this.uvs6,D),N&&(yield)),this.za&&(G.Ga(Z.f.ColorKind,this.za,D),this.hasVertexAlpha&&void 0!==G.hasVertexAlpha&&(G.hasVertexAlpha=!0),N&&(yield)),this.matricesIndices&&(G.Ga(Z.f.MatricesIndicesKind,this.matricesIndices,D),N&&(yield)),this.matricesWeights&&(G.Ga(Z.f.MatricesWeightsKind,this.matricesWeights,D),N&&(yield)),this.matricesIndicesExtra&&(G.Ga(Z.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,D),N&&(yield)),this.matricesWeightsExtra&&(G.Ga(Z.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,D),N&&(yield)),this.indices?(G.setIndices(this.indices,null,D),N&&(yield)):G.setIndices([],null),G.le&&this.materialInfos&&this.materialInfos.length>1){const D=G;D.le=[];for(const G of this.materialInfos)new g.c(G.materialIndex,G.verticesStart,G.verticesCount,G.indexStart,G.indexCount,D)}return this}_update(G,D,N){return this.xa&&G.updateVerticesData(Z.f.PositionKind,this.xa,D,N),this.ya&&G.updateVerticesData(Z.f.NormalKind,this.ya,D,N),this.tangents&&G.updateVerticesData(Z.f.TangentKind,this.tangents,D,N),this.Aa&&G.updateVerticesData(Z.f.UVKind,this.Aa,D,N),this.uvs2&&G.updateVerticesData(Z.f.UV2Kind,this.uvs2,D,N),this.uvs3&&G.updateVerticesData(Z.f.UV3Kind,this.uvs3,D,N),this.uvs4&&G.updateVerticesData(Z.f.UV4Kind,this.uvs4,D,N),this.uvs5&&G.updateVerticesData(Z.f.UV5Kind,this.uvs5,D,N),this.uvs6&&G.updateVerticesData(Z.f.UV6Kind,this.uvs6,D,N),this.za&&G.updateVerticesData(Z.f.ColorKind,this.za,D,N),this.matricesIndices&&G.updateVerticesData(Z.f.MatricesIndicesKind,this.matricesIndices,D,N),this.matricesWeights&&G.updateVerticesData(Z.f.MatricesWeightsKind,this.matricesWeights,D,N),this.matricesIndicesExtra&&G.updateVerticesData(Z.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,D,N),this.matricesWeightsExtra&&G.updateVerticesData(Z.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,D,N),this.indices&&G.setIndices(this.indices,null),this}static _TransformVector3Coordinates(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.length;const Z=o.k.Ad[0],n=o.k.Ad[1];for(let C=N;C<N+T;C+=3)o.s.FromArrayToRef(G,C,Z),o.s.TransformCoordinatesToRef(Z,D,n),G[C]=n.x,G[C+1]=n.y,G[C+2]=n.z}static _TransformVector3Normals(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.length;const Z=o.k.Ad[0],n=o.k.Ad[1];for(let C=N;C<N+T;C+=3)o.s.FromArrayToRef(G,C,Z),o.s.TransformNormalToRef(Z,D,n),G[C]=n.x,G[C+1]=n.y,G[C+2]=n.z}static _TransformVector4Normals(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.length;const Z=o.k.Vector4[0],n=o.k.Vector4[1];for(let C=N;C<N+T;C+=4)o.v.FromArrayToRef(G,C,Z),o.v.TransformNormalToRef(Z,D,n),G[C]=n.x,G[C+1]=n.y,G[C+2]=n.z,G[C+3]=n.w}static _FlipFaces(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.length;for(let T=D;T<D+N;T+=3){const D=G[T+1];G[T+1]=G[T+2],G[T+2]=D}}transform(G){const D=G.determinant()<0;return this.xa&&W._TransformVector3Coordinates(this.xa,G),this.ya&&W._TransformVector3Normals(this.ya,G),this.tangents&&W._TransformVector4Normals(this.tangents,G),D&&this.indices&&W._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const G=[];for(const D of this.materialInfos){const N=new W;if(this.xa&&(N.xa=this.xa.slice(3*D.verticesStart,3*(D.verticesCount+D.verticesStart))),this.ya&&(N.ya=this.ya.slice(3*D.verticesStart,3*(D.verticesCount+D.verticesStart))),this.tangents&&(N.tangents=this.tangents.slice(4*D.verticesStart,4*(D.verticesCount+D.verticesStart))),this.za&&(N.za=this.za.slice(4*D.verticesStart,4*(D.verticesCount+D.verticesStart))),this.Aa&&(N.Aa=this.Aa.slice(2*D.verticesStart,2*(D.verticesCount+D.verticesStart))),this.uvs2&&(N.uvs2=this.uvs2.slice(2*D.verticesStart,2*(D.verticesCount+D.verticesStart))),this.uvs3&&(N.uvs3=this.uvs3.slice(2*D.verticesStart,2*(D.verticesCount+D.verticesStart))),this.uvs4&&(N.uvs4=this.uvs4.slice(2*D.verticesStart,2*(D.verticesCount+D.verticesStart))),this.uvs5&&(N.uvs5=this.uvs5.slice(2*D.verticesStart,2*(D.verticesCount+D.verticesStart))),this.uvs6&&(N.uvs6=this.uvs6.slice(2*D.verticesStart,2*(D.verticesCount+D.verticesStart))),this.matricesIndices&&(N.matricesIndices=this.matricesIndices.slice(4*D.verticesStart,4*(D.verticesCount+D.verticesStart))),this.matricesIndicesExtra&&(N.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*D.verticesStart,4*(D.verticesCount+D.verticesStart))),this.matricesWeights&&(N.matricesWeights=this.matricesWeights.slice(4*D.verticesStart,4*(D.verticesCount+D.verticesStart))),this.matricesWeightsExtra&&(N.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*D.verticesStart,4*(D.verticesCount+D.verticesStart))),this.indices){N.indices=[];for(let G=D.indexStart;G<D.indexStart+D.indexCount;G++)N.indices.push(this.indices[G]-D.verticesStart)}const T=new X;T.indexStart=0,T.indexCount=N.indices?N.indices.length:0,T.materialIndex=D.materialIndex,T.verticesStart=0,T.verticesCount=(N.xa?N.xa.length:0)/3,N.materialInfos=[T],G.push(N)}return G}merge(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const Z=Array.isArray(G)?G.map((G=>({vertexData:G}))):[{vertexData:G}];return(0,v.n)(this._mergeCoroutine(void 0,Z,D,!1,N,T,o))}*_mergeCoroutine(G,D){var N,T;let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let v=D.map((G=>G.vertexData)),q=this;if(r)for(const Z of v)Z&&(Z._validate(),!this.ya&&Z.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&Z.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&Z.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&Z.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&Z.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&Z.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&Z.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&Z.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&Z.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&Z.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&Z.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&Z.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&Z.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const Z of v)if(Z)if(r)this.ya&&!Z.ya&&(Z.ya=new Float32Array(Z.xa.length)),this.tangents&&!Z.tangents&&(Z.tangents=new Float32Array(Z.xa.length/3*4)),this.Aa&&!Z.Aa&&(Z.Aa=new Float32Array(Z.xa.length/3*2)),this.uvs2&&!Z.uvs2&&(Z.uvs2=new Float32Array(Z.xa.length/3*2)),this.uvs3&&!Z.uvs3&&(Z.uvs3=new Float32Array(Z.xa.length/3*2)),this.uvs4&&!Z.uvs4&&(Z.uvs4=new Float32Array(Z.xa.length/3*2)),this.uvs5&&!Z.uvs5&&(Z.uvs5=new Float32Array(Z.xa.length/3*2)),this.uvs6&&!Z.uvs6&&(Z.uvs6=new Float32Array(Z.xa.length/3*2)),this.za&&!Z.za&&(Z.za=new Float32Array(Z.xa.length/3*4),Z.za.fill(1)),this.matricesIndices&&!Z.matricesIndices&&(Z.matricesIndices=new Float32Array(Z.xa.length/3*4)),this.matricesWeights&&!Z.matricesWeights&&(Z.matricesWeights=new Float32Array(Z.xa.length/3*4)),this.matricesIndicesExtra&&!Z.matricesIndicesExtra&&(Z.matricesIndicesExtra=new Float32Array(Z.xa.length/3*4)),this.matricesWeightsExtra&&!Z.matricesWeightsExtra&&(Z.matricesWeightsExtra=new Float32Array(Z.xa.length/3*4));else if(Z._validate(),!this.ya!==!Z.ya||!this.tangents!==!Z.tangents||!this.Aa!==!Z.Aa||!this.uvs2!==!Z.uvs2||!this.uvs3!==!Z.uvs3||!this.uvs4!==!Z.uvs4||!this.uvs5!==!Z.uvs5||!this.uvs6!==!Z.uvs6||!this.za!==!Z.za||!this.matricesIndices!==!Z.matricesIndices||!this.matricesWeights!==!Z.matricesWeights||!this.matricesIndicesExtra!==!Z.matricesIndicesExtra||!this.matricesWeightsExtra!==!Z.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(P){let N=0,T=0,o=0;const Z=[];let n=null;const C=[];for(const D of this.splitBasedOnMaterialID())C.push({vertexData:D,transform:G});for(const G of D)if(G.vertexData)for(const D of G.vertexData.splitBasedOnMaterialID())C.push({vertexData:D,transform:G.transform});C.sort(((G,D)=>{const N=G.vertexData.materialInfos?G.vertexData.materialInfos[0].materialIndex:0,T=D.vertexData.materialInfos?D.vertexData.materialInfos[0].materialIndex:0;return N>T?1:N===T?0:-1}));for(const G of C){const D=G.vertexData;if(N=D.materialInfos?D.materialInfos[0].materialIndex:0,n&&n.materialIndex===N)n.indexCount+=D.indices.length,n.verticesCount+=D.xa.length/3;else{const G=new X;G.materialIndex=N,G.indexStart=T,G.indexCount=D.indices.length,G.verticesStart=o,G.verticesCount=D.xa.length/3,Z.push(G),n=G}T+=D.indices.length,o+=D.xa.length/3}const P=C.splice(0,1)[0];q=P.vertexData,G=P.transform,v=C.map((G=>G.vertexData)),D=C,this.materialInfos=Z}const g=v.reduce(((G,D)=>{var N;return G+((null===(N=D.indices)||void 0===N?void 0:N.length)??0)}),(null===(N=q.indices)||void 0===N?void 0:N.length)??0);let j=C||v.some((G=>G.indices===q.indices))?null===(T=q.indices)||void 0===T?void 0:T.slice():q.indices;if(g>0){var Y;let N=(null===(Y=j)||void 0===Y?void 0:Y.length)??0;if(j||(j=new Array(g)),j.length!==g){if(Array.isArray(j))j.length=g;else{const G=o||j instanceof Uint32Array?new Uint32Array(g):new Uint16Array(g);G.set(j),j=G}G&&G.determinant()<0&&W._FlipFaces(j,0,N)}let T=q.xa?q.xa.length/3:0;for(const{vertexData:G,transform:o}of D)if(G.indices){for(let D=0;D<G.indices.length;D++)j[N+D]=G.indices[D]+T;o&&o.determinant()<0&&W._FlipFaces(j,N,G.indices.length),T+=G.xa.length/3,N+=G.indices.length,n&&(yield)}}return this.indices=j,this.xa=W._MergeElement(Z.f.PositionKind,q.xa,G,D.map((G=>[G.vertexData.xa,G.transform]))),n&&(yield),q.ya&&(this.ya=W._MergeElement(Z.f.NormalKind,q.ya,G,D.map((G=>[G.vertexData.ya,G.transform]))),n&&(yield)),q.tangents&&(this.tangents=W._MergeElement(Z.f.TangentKind,q.tangents,G,D.map((G=>[G.vertexData.tangents,G.transform]))),n&&(yield)),q.Aa&&(this.Aa=W._MergeElement(Z.f.UVKind,q.Aa,G,D.map((G=>[G.vertexData.Aa,G.transform]))),n&&(yield)),q.uvs2&&(this.uvs2=W._MergeElement(Z.f.UV2Kind,q.uvs2,G,D.map((G=>[G.vertexData.uvs2,G.transform]))),n&&(yield)),q.uvs3&&(this.uvs3=W._MergeElement(Z.f.UV3Kind,q.uvs3,G,D.map((G=>[G.vertexData.uvs3,G.transform]))),n&&(yield)),q.uvs4&&(this.uvs4=W._MergeElement(Z.f.UV4Kind,q.uvs4,G,D.map((G=>[G.vertexData.uvs4,G.transform]))),n&&(yield)),q.uvs5&&(this.uvs5=W._MergeElement(Z.f.UV5Kind,q.uvs5,G,D.map((G=>[G.vertexData.uvs5,G.transform]))),n&&(yield)),q.uvs6&&(this.uvs6=W._MergeElement(Z.f.UV6Kind,q.uvs6,G,D.map((G=>[G.vertexData.uvs6,G.transform]))),n&&(yield)),q.za&&(this.za=W._MergeElement(Z.f.ColorKind,q.za,G,D.map((G=>[G.vertexData.za,G.transform]))),(void 0!==q.hasVertexAlpha||D.some((G=>void 0!==G.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=q.hasVertexAlpha||D.some((G=>G.vertexData.hasVertexAlpha))),n&&(yield)),q.matricesIndices&&(this.matricesIndices=W._MergeElement(Z.f.MatricesIndicesKind,q.matricesIndices,G,D.map((G=>[G.vertexData.matricesIndices,G.transform]))),n&&(yield)),q.matricesWeights&&(this.matricesWeights=W._MergeElement(Z.f.MatricesWeightsKind,q.matricesWeights,G,D.map((G=>[G.vertexData.matricesWeights,G.transform]))),n&&(yield)),q.matricesIndicesExtra&&(this.matricesIndicesExtra=W._MergeElement(Z.f.MatricesIndicesExtraKind,q.matricesIndicesExtra,G,D.map((G=>[G.vertexData.matricesIndicesExtra,G.transform]))),n&&(yield)),q.matricesWeightsExtra&&(this.matricesWeightsExtra=W._MergeElement(Z.f.MatricesWeightsExtraKind,q.matricesWeightsExtra,G,D.map((G=>[G.vertexData.matricesWeightsExtra,G.transform])))),this}static _MergeElement(G,D,N,T){const o=T.filter((G=>null!==G[0]&&void 0!==G[0]));if(!D&&0==o.length)return D;if(!D)return this._MergeElement(G,o[0][0],o[0][1],o.slice(1));const n=o.reduce(((G,D)=>G+D[0].length),D.length),C=G===Z.f.PositionKind?W._TransformVector3Coordinates:G===Z.f.NormalKind?W._TransformVector3Normals:G===Z.f.TangentKind?W._TransformVector4Normals:()=>{};if(D instanceof Float32Array){const G=new Float32Array(n);G.set(D),N&&C(G,N,0,D.length);let T=D.length;for(const[D,N]of o)G.set(D,T),N&&C(G,N,T,D.length),T+=D.length;return G}{const G=new Array(n);for(let N=0;N<D.length;N++)G[N]=D[N];N&&C(G,N,0,D.length);let T=D.length;for(const[D,N]of o){for(let N=0;N<D.length;N++)G[T+N]=D[N];N&&C(G,N,T,D.length),T+=D.length}return G}}_validate(){if(!this.xa)throw new q.j("Positions are required",q.g.MeshInvalidPositionsError);const G=(G,D)=>{const N=Z.f.DeduceStride(G);if(D.length%N!==0)throw new Error("The "+G+"s array count must be a multiple of "+N);return D.length/N},D=G(Z.f.PositionKind,this.xa),N=(N,T)=>{const o=G(N,T);if(o!==D)throw new Error("The "+N+"s element count ("+o+") does not match the positions count ("+D+")")};this.ya&&N(Z.f.NormalKind,this.ya),this.tangents&&N(Z.f.TangentKind,this.tangents),this.Aa&&N(Z.f.UVKind,this.Aa),this.uvs2&&N(Z.f.UV2Kind,this.uvs2),this.uvs3&&N(Z.f.UV3Kind,this.uvs3),this.uvs4&&N(Z.f.UV4Kind,this.uvs4),this.uvs5&&N(Z.f.UV5Kind,this.uvs5),this.uvs6&&N(Z.f.UV6Kind,this.uvs6),this.za&&N(Z.f.ColorKind,this.za),this.matricesIndices&&N(Z.f.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&N(Z.f.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&N(Z.f.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&N(Z.f.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const G=this.serialize();return W.Parse(G)}serialize(){const G={};if(this.xa&&(G.xa=Array.from(this.xa)),this.ya&&(G.ya=Array.from(this.ya)),this.tangents&&(G.tangents=Array.from(this.tangents)),this.Aa&&(G.Aa=Array.from(this.Aa)),this.uvs2&&(G.uvs2=Array.from(this.uvs2)),this.uvs3&&(G.uvs3=Array.from(this.uvs3)),this.uvs4&&(G.uvs4=Array.from(this.uvs4)),this.uvs5&&(G.uvs5=Array.from(this.uvs5)),this.uvs6&&(G.uvs6=Array.from(this.uvs6)),this.za&&(G.za=Array.from(this.za),G.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(G.matricesIndices=Array.from(this.matricesIndices),G.matricesIndices._isExpanded=!0),this.matricesWeights&&(G.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(G.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),G.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(G.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),G.indices=Array.from(this.indices),this.materialInfos){G.materialInfos=[];for(const D of this.materialInfos){const N={indexStart:D.indexStart,indexCount:D.indexCount,materialIndex:D.materialIndex,verticesStart:D.verticesStart,verticesCount:D.verticesCount};G.materialInfos.push(N)}}return G}static ExtractFromMesh(G,D,N){return W._ExtractFrom(G,D,N)}static ExtractFromGeometry(G,D,N){return W._ExtractFrom(G,D,N)}static _ExtractFrom(G,D,N){const T=new W;if(G.isVerticesDataPresent(Z.f.PositionKind)&&(T.xa=G.getVerticesData(Z.f.PositionKind,D,N)),G.isVerticesDataPresent(Z.f.NormalKind)&&(T.ya=G.getVerticesData(Z.f.NormalKind,D,N)),G.isVerticesDataPresent(Z.f.TangentKind)&&(T.tangents=G.getVerticesData(Z.f.TangentKind,D,N)),G.isVerticesDataPresent(Z.f.UVKind)&&(T.Aa=G.getVerticesData(Z.f.UVKind,D,N)),G.isVerticesDataPresent(Z.f.UV2Kind)&&(T.uvs2=G.getVerticesData(Z.f.UV2Kind,D,N)),G.isVerticesDataPresent(Z.f.UV3Kind)&&(T.uvs3=G.getVerticesData(Z.f.UV3Kind,D,N)),G.isVerticesDataPresent(Z.f.UV4Kind)&&(T.uvs4=G.getVerticesData(Z.f.UV4Kind,D,N)),G.isVerticesDataPresent(Z.f.UV5Kind)&&(T.uvs5=G.getVerticesData(Z.f.UV5Kind,D,N)),G.isVerticesDataPresent(Z.f.UV6Kind)&&(T.uvs6=G.getVerticesData(Z.f.UV6Kind,D,N)),G.isVerticesDataPresent(Z.f.ColorKind)){const o=G.ve||G,n=o.getVertexBuffer(Z.f.ColorKind),C=o.getVerticesData(Z.f.ColorKind,D,N);if(3===n.getSize()){const G=new Float32Array(4*C.length/3);for(let D=0,N=0;D<C.length;D+=3,N+=4)G[N]=C[D],G[N+1]=C[D+1],G[N+2]=C[D+2],G[N+3]=1;T.za=G}else{if(4!==n.getSize())throw new Error(`Unexpected number of color components: ${n.getSize()}`);T.za=C}}return G.isVerticesDataPresent(Z.f.MatricesIndicesKind)&&(T.matricesIndices=G.getVerticesData(Z.f.MatricesIndicesKind,D,N)),G.isVerticesDataPresent(Z.f.MatricesWeightsKind)&&(T.matricesWeights=G.getVerticesData(Z.f.MatricesWeightsKind,D,N)),G.isVerticesDataPresent(Z.f.MatricesIndicesExtraKind)&&(T.matricesIndicesExtra=G.getVerticesData(Z.f.MatricesIndicesExtraKind,D,N)),G.isVerticesDataPresent(Z.f.MatricesWeightsExtraKind)&&(T.matricesWeightsExtra=G.getVerticesData(Z.f.MatricesWeightsExtraKind,D,N)),T.indices=G.ye(D,N),T}static CreateRibbon(G){throw(0,n.d)("ribbonBuilder")}static CreateBox(G){throw(0,n.d)("boxBuilder")}static CreateTiledBox(G){throw(0,n.d)("tiledBoxBuilder")}static CreateTiledPlane(G){throw(0,n.d)("tiledPlaneBuilder")}static CreateSphere(G){throw(0,n.d)("sphereBuilder")}static CreateCylinder(G){throw(0,n.d)("cylinderBuilder")}static CreateTorus(G){throw(0,n.d)("torusBuilder")}static CreateLineSystem(G){throw(0,n.d)("linesBuilder")}static CreateDashedLines(G){throw(0,n.d)("linesBuilder")}static CreateGround(G){throw(0,n.d)("groundBuilder")}static CreateTiledGround(G){throw(0,n.d)("groundBuilder")}static CreateGroundFromHeightMap(G){throw(0,n.d)("groundBuilder")}static Mg(G){throw(0,n.d)("planeBuilder")}static kb(G){throw(0,n.d)("discBuilder")}static CreatePolygon(G,D,N,T,o,Z,C){throw(0,n.d)("polygonBuilder")}static CreateIcoSphere(G){throw(0,n.d)("icoSphereBuilder")}static CreatePolyhedron(G){throw(0,n.d)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||o.s.Up();throw(0,n.d)("capsuleBuilder")}static CreateTorusKnot(G){throw(0,n.d)("torusKnotBuilder")}static ComputeNormals(G,D,N,T){let Z=0,n=0,C=0,P=0,r=0,v=0,q=0,g=0,X=0,W=0,j=0,Y=0,y=0,h=0,m=0,R=0,L=0,w=0,B=0,F=0,S=!1,V=!1,U=!1,z=!1,i=1,J=0,p=null;T&&(S=!!T.facetNormals,V=!!T.facetPositions,U=!!T.facetPartitioning,i=!0===T.useRightHandedSystem?-1:1,J=T.ratio||0,z=!!T.depthSort,p=T.distanceTo,z&&void 0===p&&(p=o.s.Zero()));let t=0,H=0,s=0,c=0;for(U&&T&&T.bbSize&&(t=T.subDiv.X*J/T.bbSize.x,H=T.subDiv.Y*J/T.bbSize.y,s=T.subDiv.Z*J/T.bbSize.z,c=T.subDiv.max*T.subDiv.max,T.facetPartitioning.length=0),Z=0;Z<G.length;Z++)N[Z]=0;const K=D.length/3|0;for(Z=0;Z<K;Z++){if(Y=3*D[3*Z],y=Y+1,h=Y+2,m=3*D[3*Z+1],R=m+1,L=m+2,w=3*D[3*Z+2],B=w+1,F=w+2,n=G[Y]-G[m],C=G[y]-G[R],P=G[h]-G[L],r=G[w]-G[m],v=G[B]-G[R],q=G[F]-G[L],g=i*(C*q-P*v),X=i*(P*r-n*q),W=i*(n*v-C*r),j=Math.sqrt(g*g+X*X+W*W),j=0===j?1:j,g/=j,X/=j,W/=j,S&&T&&(T.facetNormals[Z].x=g,T.facetNormals[Z].y=X,T.facetNormals[Z].z=W),V&&T&&(T.facetPositions[Z].x=(G[Y]+G[m]+G[w])/3,T.facetPositions[Z].y=(G[y]+G[R]+G[B])/3,T.facetPositions[Z].z=(G[h]+G[L]+G[F])/3),U&&T){const D=Math.floor((T.facetPositions[Z].x-T.bInfo.minimum.x*J)*t),N=Math.floor((T.facetPositions[Z].y-T.bInfo.minimum.y*J)*H),o=Math.floor((T.facetPositions[Z].z-T.bInfo.minimum.z*J)*s),n=Math.floor((G[Y]-T.bInfo.minimum.x*J)*t),C=Math.floor((G[y]-T.bInfo.minimum.y*J)*H),P=Math.floor((G[h]-T.bInfo.minimum.z*J)*s),r=Math.floor((G[m]-T.bInfo.minimum.x*J)*t),v=Math.floor((G[R]-T.bInfo.minimum.y*J)*H),q=Math.floor((G[L]-T.bInfo.minimum.z*J)*s),g=Math.floor((G[w]-T.bInfo.minimum.x*J)*t),X=Math.floor((G[B]-T.bInfo.minimum.y*J)*H),W=Math.floor((G[F]-T.bInfo.minimum.z*J)*s),j=n+T.subDiv.max*C+c*P,S=r+T.subDiv.max*v+c*q,V=g+T.subDiv.max*X+c*W,U=D+T.subDiv.max*N+c*o;T.facetPartitioning[U]=T.facetPartitioning[U]?T.facetPartitioning[U]:new Array,T.facetPartitioning[j]=T.facetPartitioning[j]?T.facetPartitioning[j]:new Array,T.facetPartitioning[S]=T.facetPartitioning[S]?T.facetPartitioning[S]:new Array,T.facetPartitioning[V]=T.facetPartitioning[V]?T.facetPartitioning[V]:new Array,T.facetPartitioning[j].push(Z),S!=j&&T.facetPartitioning[S].push(Z),V!=S&&V!=j&&T.facetPartitioning[V].push(Z),U!=j&&U!=S&&U!=V&&T.facetPartitioning[U].push(Z)}if(z&&T&&T.facetPositions){const G=T.depthSortedFacets[Z];G.ind=3*Z,G.sqDistance=o.s.DistanceSquared(T.facetPositions[Z],p)}N[Y]+=g,N[y]+=X,N[h]+=W,N[m]+=g,N[R]+=X,N[L]+=W,N[w]+=g,N[B]+=X,N[F]+=W}for(Z=0;Z<N.length/3;Z++)g=N[3*Z],X=N[3*Z+1],W=N[3*Z+2],j=Math.sqrt(g*g+X*X+W*W),j=0===j?1:j,g/=j,X/=j,W/=j,N[3*Z]=g,N[3*Z+1]=X,N[3*Z+2]=W}static _ComputeSides(G,D,N,T,Z,n,C){const P=N.length,r=T.length;let v,q;switch(G=G||W.DEFAULTSIDE){case W.FRONTSIDE:break;case W.BACKSIDE:for(v=0;v<P;v+=3){const G=N[v];N[v]=N[v+2],N[v+2]=G}for(q=0;q<r;q++)T[q]=-T[q];break;case W.DOUBLESIDE:{const G=D.length,g=G/3;for(let N=0;N<G;N++)D[G+N]=D[N];for(v=0;v<P;v+=3)N[v+P]=N[v+2]+g,N[v+1+P]=N[v+1]+g,N[v+2+P]=N[v]+g;for(q=0;q<r;q++)T[r+q]=-T[q];const X=Z.length;let W=0;for(W=0;W<X;W++)Z[W+X]=Z[W];for(n=n||new o.v(0,0,1,1),C=C||new o.v(0,0,1,1),W=0,v=0;v<X/2;v++)Z[W]=n.x+(n.z-n.x)*Z[W],Z[W+1]=n.y+(n.w-n.y)*Z[W+1],Z[W+X]=C.x+(C.z-C.x)*Z[W+X],Z[W+X+1]=C.y+(C.w-C.y)*Z[W+X+1],W+=2;break}}}static Parse(G){const D=new W,N=G.xa;N&&D.set(N,Z.f.PositionKind);const T=G.ya;T&&D.set(T,Z.f.NormalKind);const o=G.tangents;o&&D.set(o,Z.f.TangentKind);const n=G.Aa;n&&D.set(n,Z.f.UVKind);const P=G.uvs2;P&&D.set(P,Z.f.UV2Kind);const r=G.uvs3;r&&D.set(r,Z.f.UV3Kind);const v=G.uvs4;v&&D.set(v,Z.f.UV4Kind);const q=G.uvs5;q&&D.set(q,Z.f.UV5Kind);const g=G.uvs6;g&&D.set(g,Z.f.UV6Kind);const j=G.za;j&&(D.set(C.g.CheckColors4(j,N.length/3),Z.f.ColorKind),void 0!==G.hasVertexAlpha&&(D.hasVertexAlpha=G.hasVertexAlpha));const Y=G.matricesIndices;Y&&D.set(Y,Z.f.MatricesIndicesKind);const y=G.matricesWeights;y&&D.set(y,Z.f.MatricesWeightsKind);const h=G.indices;h&&(D.indices=h);const m=G.materialInfos;if(m){D.materialInfos=[];for(const G of m){const N=new X;N.indexCount=G.indexCount,N.indexStart=G.indexStart,N.verticesCount=G.verticesCount,N.verticesStart=G.verticesStart,N.materialIndex=G.materialIndex,D.materialInfos.push(N)}}return D}static ImportVertexData(G,D){const N=W.Parse(G);D.setAllVerticesData(N,G.updatable)}}W.FRONTSIDE=0,W.BACKSIDE=1,W.DOUBLESIDE=2,W.DEFAULTSIDE=0,W._UniqueIDGenerator=0,(0,T.c)([r.h.filter((function(){for(var G=arguments.length,D=new Array(G),N=0;N<G;N++)D[N]=arguments[N];let[T]=D;return!Array.isArray(T)}))],W,"_TransformVector3Coordinates",null),(0,T.c)([r.h.filter((function(){for(var G=arguments.length,D=new Array(G),N=0;N<G;N++)D[N]=arguments[N];let[T]=D;return!Array.isArray(T)}))],W,"_TransformVector3Normals",null),(0,T.c)([r.h.filter((function(){for(var G=arguments.length,D=new Array(G),N=0;N<G;N++)D[N]=arguments[N];let[T]=D;return!Array.isArray(T)}))],W,"_TransformVector4Normals",null),(0,T.c)([r.h.filter((function(){for(var G=arguments.length,D=new Array(G),N=0;N<G;N++)D[N]=arguments[N];let[T]=D;return!Array.isArray(T)}))],W,"_FlipFaces",null)},12061:(G,D,N)=>{"use strict";N.d(D,{d:()=>jG});var T=N(1009),o=N(11378),Z=N(1255),n=N(11407),C=N(1199);function P(G){let D=G.pathArray;const N=G.closeArray||!1,T=G.closePath||!1,o=G.invertUV||!1,P=Math.floor(D[0].length/2);let r=G.offset||P;r=r>P?P:Math.floor(r);const v=0===G.sideOrientation?0:G.sideOrientation||n.c.DEFAULTSIDE,q=G.Aa,g=G.za,X=[],W=[],j=[],Y=[],y=[],h=[],m=[],R=[];let L;const w=[],B=[];let F,S,V;if(D.length<2){const G=[],N=[];for(S=0;S<D[0].length-r;S++)G.push(D[0][S]),N.push(D[0][S+r]);D=[G,N]}let U=0;const z=T?1:0,i=N?1:0;let J,p,t,H,s,c;for(L=D[0].length,F=0;F<D.length+i;F++){for(m[F]=0,y[F]=[0],J=F===D.length?D[0]:D[F],p=J.length,L=L<p?L:p,V=0;V<p;)X.push(J[V].x,J[V].y,J[V].z),V>0&&(t=J[V].Jc(J[V-1]).length(),H=t+m[F],y[F].push(H),m[F]=H),V++;T&&(V--,X.push(J[0].x,J[0].y,J[0].z),t=J[V].Jc(J[0]).length(),H=t+m[F],y[F].push(H),m[F]=H),w[F]=p+z,B[F]=U,U+=p+z}let K,b,O=null,Q=null;for(S=0;S<L+z;S++)for(R[S]=0,h[S]=[0],F=0;F<D.length-1+i;F++)s=D[F],c=F===D.length-1?D[0]:D[F+1],S===L?(O=s[0],Q=c[0]):(O=s[S],Q=c[S]),t=Q.Jc(O).length(),H=t+R[S],h[S].push(H),R[S]=H;if(q)for(F=0;F<q.length;F++)Y.push(q[F].x,C.c?1-q[F].y:q[F].y);else for(F=0;F<D.length+i;F++)for(S=0;S<L+z;S++)K=0!=m[F]?y[F][S]/m[F]:0,b=0!=R[S]?h[S][F]/R[S]:0,o?Y.push(b,K):Y.push(K,C.c?1-b:b);F=0;let A=0,I=w[F]-1,d=w[F+1]-1,u=I<d?I:d,l=B[1]-B[0];const x=w.length-1;for(;A<=u&&F<x;)W.push(A,A+l,A+1),W.push(A+l+1,A+1,A+l),A+=1,A===u&&(F++,l=B[F+1]-B[F],I=w[F]-1,d=w[F+1]-1,A=B[F],u=I<d?I+A:d+A);if(n.c.ComputeNormals(X,W,j),T){let G=0,N=0;for(F=0;F<D.length;F++){G=3*B[F],N=F+1<D.length?3*(B[F+1]-1):j.length-3,j[G]=.5*(j[G]+j[N]),j[G+1]=.5*(j[G+1]+j[N+1]),j[G+2]=.5*(j[G+2]+j[N+2]);const T=Math.sqrt(j[G]*j[G]+j[G+1]*j[G+1]+j[G+2]*j[G+2]);j[G]/=T,j[G+1]/=T,j[G+2]/=T,j[N]=j[G],j[N+1]=j[G+1],j[N+2]=j[G+2]}}if(N){let G=3*B[0],N=3*B[D.length];for(S=0;S<L+z;S++){j[G]=.5*(j[G]+j[N]),j[G+1]=.5*(j[G+1]+j[N+1]),j[G+2]=.5*(j[G+2]+j[N+2]);const D=Math.sqrt(j[G]*j[G]+j[G+1]*j[G+1]+j[G+2]*j[G+2]);j[G]/=D,j[G+1]/=D,j[G+2]/=D,j[N]=j[G],j[N+1]=j[G+1],j[N+2]=j[G+2],G+=3,N+=3}}n.c._ComputeSides(v,X,W,j,Y,G.frontUVs,G.backUVs);let k=null;if(g){k=new Float32Array(4*g.length);for(let G=0;G<g.length;G++)k[4*G]=g[G].r,k[4*G+1]=g[G].g,k[4*G+2]=g[G].b,k[4*G+3]=g[G].a}const a=new n.c,E=new Float32Array(X),M=new Float32Array(j),e=new Float32Array(Y);return a.indices=W,a.xa=E,a.ya=M,a.Aa=e,k&&a.set(k,Z.f.ColorKind),T&&(a._idx=B),a}function r(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=D.pathArray,v=D.closeArray,q=D.closePath,g=o.d._GetDefaultSideOrientation(D.sideOrientation),X=D.instance,W=D.updatable;if(X){const G=T.k.Ad[0].zd(Number.MAX_VALUE),N=T.k.Ad[1].zd(-Number.MAX_VALUE),P=D=>{let T=r[0].length;const Z=X;let n=0;const C=Z._originalBuilderSideOrientation===o.d.DOUBLESIDE?2:1;for(let o=1;o<=C;++o)for(let C=0;C<r.length;++C){const o=r[C],P=o.length;T=T<P?T:P;for(let Z=0;Z<T;++Z){const T=o[Z];D[n]=T.x,D[n+1]=T.y,D[n+2]=T.z,G.minimizeInPlaceFromFloats(T.x,T.y,T.z),N.maximizeInPlaceFromFloats(T.x,T.y,T.z),n+=3}if(Z._creationDataStorage&&Z._creationDataStorage.closePath){const G=o[0];D[n]=G.x,D[n+1]=G.y,D[n+2]=G.z,n+=3}}},v=X.getVerticesData(Z.f.PositionKind);if(P(v),X.hasBoundingInfo?X.getBoundingInfo().reConstruct(G,N,X._worldMatrix):X.buildBoundingInfo(G,N,X._worldMatrix),X.updateVerticesData(Z.f.PositionKind,v,!1,!1),D.za){const G=X.getVerticesData(Z.f.ColorKind);for(let N=0,T=0;N<D.za.length;N++,T+=4){const o=D.za[N];G[T]=o.r,G[T+1]=o.g,G[T+2]=o.b,G[T+3]=o.a}X.updateVerticesData(Z.f.ColorKind,G,!1,!1)}if(D.Aa){const G=X.getVerticesData(Z.f.UVKind);for(let N=0;N<D.Aa.length;N++)G[2*N]=D.Aa[N].x,G[2*N+1]=C.c?1-D.Aa[N].y:D.Aa[N].y;X.updateVerticesData(Z.f.UVKind,G,!1,!1)}if(!X.areNormalsFrozen||X.isFacetDataEnabled){const G=X.ye(),D=X.getVerticesData(Z.f.NormalKind),N=X.isFacetDataEnabled?X.getFacetDataParameters():null;if(n.c.ComputeNormals(v,G,D,N),X._creationDataStorage&&X._creationDataStorage.closePath){let G=0,N=0;for(let T=0;T<r.length;T++)G=3*X._creationDataStorage.idx[T],N=T+1<r.length?3*(X._creationDataStorage.idx[T+1]-1):D.length-3,D[G]=.5*(D[G]+D[N]),D[G+1]=.5*(D[G+1]+D[N+1]),D[G+2]=.5*(D[G+2]+D[N+2]),D[N]=D[G],D[N+1]=D[G+1],D[N+2]=D[G+2]}X.areNormalsFrozen||X.updateVerticesData(Z.f.NormalKind,D,!1,!1)}return X}{const T=new o.d(G,N);T._originalBuilderSideOrientation=g,T._creationDataStorage=new o.g;const Z=P(D);return q&&(T._creationDataStorage.idx=Z._idx),T._creationDataStorage.closePath=q,T._creationDataStorage.closeArray=v,Z.Ca(T,W),T}}n.c.CreateRibbon=P,o.d.CreateRibbon=function(G,D){return r(G,{pathArray:D,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var v=N(11547),q=N(11447),g=N(1185);function X(G){const D=G.pattern||o.d.NO_FLIP,N=G.tileWidth||G.tileSize||1,T=G.tileHeight||G.tileSize||1,Z=G.alignHorizontal||0,C=G.alignVertical||0,P=G.width||G.size||1,r=Math.floor(P/N);let v=P-r*N;const q=G.height||G.size||1,g=Math.floor(q/T);let X=q-g*T;const W=N*r/2,j=T*g/2;let Y=0,y=0,h=0,m=0,R=0,L=0;if(v>0||X>0){switch(h=-W,m=-j,R=W,L=j,Z){case o.d.CENTER:v/=2,h-=v,R+=v;break;case o.d.LEFT:R+=v,Y=-v/2;break;case o.d.RIGHT:h-=v,Y=v/2}switch(C){case o.d.CENTER:X/=2,m-=X,L+=X;break;case o.d.BOTTOM:L+=X,y=-X/2;break;case o.d.TOP:m-=X,y=X/2}}const w=[],B=[],F=[];F[0]=[0,0,1,0,1,1,0,1],F[1]=[0,0,1,0,1,1,0,1],D!==o.d.ROTATE_TILE&&D!==o.d.ROTATE_ROW||(F[1]=[1,1,0,1,0,0,1,0]),D!==o.d.FLIP_TILE&&D!==o.d.FLIP_ROW||(F[1]=[1,0,0,0,0,1,1,1]),D!==o.d.FLIP_N_ROTATE_TILE&&D!==o.d.FLIP_N_ROTATE_ROW||(F[1]=[0,1,1,1,1,0,0,0]);let S=[];const V=[],U=[];let z=0;for(let n=0;n<g;n++)for(let G=0;G<r;G++)w.push(G*N-W+Y,n*T-j+y,0),w.push((G+1)*N-W+Y,n*T-j+y,0),w.push((G+1)*N-W+Y,(n+1)*T-j+y,0),w.push(G*N-W+Y,(n+1)*T-j+y,0),U.push(z,z+1,z+3,z+1,z+2,z+3),S=D===o.d.FLIP_TILE||D===o.d.ROTATE_TILE||D===o.d.FLIP_N_ROTATE_TILE?S.concat(F[(G%2+n%2)%2]):D===o.d.FLIP_ROW||D===o.d.ROTATE_ROW||D===o.d.FLIP_N_ROTATE_ROW?S.concat(F[n%2]):S.concat(F[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),B.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),z+=4;if(v>0||X>0){const G=X>0&&(C===o.d.CENTER||C===o.d.TOP),n=X>0&&(C===o.d.CENTER||C===o.d.BOTTOM),P=v>0&&(Z===o.d.CENTER||Z===o.d.RIGHT),q=v>0&&(Z===o.d.CENTER||Z===o.d.LEFT);let F,i,J,p,t=[];if(G&&P&&(w.push(h+Y,m+y,0),w.push(-W+Y,m+y,0),w.push(-W+Y,m+X+y,0),w.push(h+Y,m+X+y,0),U.push(z,z+1,z+3,z+1,z+2,z+3),z+=4,F=1-v/N,i=1-X/T,J=1,p=1,t=[F,i,J,i,J,p,F,p],D===o.d.ROTATE_ROW&&(t=[1-F,1-i,1-J,1-i,1-J,1-p,1-F,1-p]),D===o.d.FLIP_ROW&&(t=[1-F,i,1-J,i,1-J,p,1-F,p]),D===o.d.FLIP_N_ROTATE_ROW&&(t=[F,1-i,J,1-i,J,1-p,F,1-p]),S=S.concat(t),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),B.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),G&&q&&(w.push(W+Y,m+y,0),w.push(R+Y,m+y,0),w.push(R+Y,m+X+y,0),w.push(W+Y,m+X+y,0),U.push(z,z+1,z+3,z+1,z+2,z+3),z+=4,F=0,i=1-X/T,J=v/N,p=1,t=[F,i,J,i,J,p,F,p],(D===o.d.ROTATE_ROW||D===o.d.ROTATE_TILE&&r%2===0)&&(t=[1-F,1-i,1-J,1-i,1-J,1-p,1-F,1-p]),(D===o.d.FLIP_ROW||D===o.d.FLIP_TILE&&r%2===0)&&(t=[1-F,i,1-J,i,1-J,p,1-F,p]),(D===o.d.FLIP_N_ROTATE_ROW||D===o.d.FLIP_N_ROTATE_TILE&&r%2===0)&&(t=[F,1-i,J,1-i,J,1-p,F,1-p]),S=S.concat(t),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),B.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),n&&P&&(w.push(h+Y,j+y,0),w.push(-W+Y,j+y,0),w.push(-W+Y,L+y,0),w.push(h+Y,L+y,0),U.push(z,z+1,z+3,z+1,z+2,z+3),z+=4,F=1-v/N,i=0,J=1,p=X/T,t=[F,i,J,i,J,p,F,p],(D===o.d.ROTATE_ROW&&g%2===1||D===o.d.ROTATE_TILE&&g%1===0)&&(t=[1-F,1-i,1-J,1-i,1-J,1-p,1-F,1-p]),(D===o.d.FLIP_ROW&&g%2===1||D===o.d.FLIP_TILE&&g%2===0)&&(t=[1-F,i,1-J,i,1-J,p,1-F,p]),(D===o.d.FLIP_N_ROTATE_ROW&&g%2===1||D===o.d.FLIP_N_ROTATE_TILE&&g%2===0)&&(t=[F,1-i,J,1-i,J,1-p,F,1-p]),S=S.concat(t),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),B.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),n&&q&&(w.push(W+Y,j+y,0),w.push(R+Y,j+y,0),w.push(R+Y,L+y,0),w.push(W+Y,L+y,0),U.push(z,z+1,z+3,z+1,z+2,z+3),z+=4,F=0,i=0,J=v/N,p=X/T,t=[F,i,J,i,J,p,F,p],(D===o.d.ROTATE_ROW&&g%2===1||D===o.d.ROTATE_TILE&&(g+r)%2===1)&&(t=[1-F,1-i,1-J,1-i,1-J,1-p,1-F,1-p]),(D===o.d.FLIP_ROW&&g%2===1||D===o.d.FLIP_TILE&&(g+r)%2===1)&&(t=[1-F,i,1-J,i,1-J,p,1-F,p]),(D===o.d.FLIP_N_ROTATE_ROW&&g%2===1||D===o.d.FLIP_N_ROTATE_TILE&&(g+r)%2===1)&&(t=[F,1-i,J,1-i,J,1-p,F,1-p]),S=S.concat(t),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),B.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),G){const G=[];F=0,i=1-X/T,J=1,p=1,G[0]=[F,i,J,i,J,p,F,p],G[1]=[F,i,J,i,J,p,F,p],D!==o.d.ROTATE_TILE&&D!==o.d.ROTATE_ROW||(G[1]=[1-F,1-i,1-J,1-i,1-J,1-p,1-F,1-p]),D!==o.d.FLIP_TILE&&D!==o.d.FLIP_ROW||(G[1]=[1-F,i,1-J,i,1-J,p,1-F,p]),D!==o.d.FLIP_N_ROTATE_TILE&&D!==o.d.FLIP_N_ROTATE_ROW||(G[1]=[F,1-i,J,1-i,J,1-p,F,1-p]);for(let T=0;T<r;T++)w.push(T*N-W+Y,m+y,0),w.push((T+1)*N-W+Y,m+y,0),w.push((T+1)*N-W+Y,m+X+y,0),w.push(T*N-W+Y,m+X+y,0),U.push(z,z+1,z+3,z+1,z+2,z+3),z+=4,S=D===o.d.FLIP_TILE||D===o.d.ROTATE_TILE||D===o.d.FLIP_N_ROTATE_TILE?S.concat(G[(T+1)%2]):D===o.d.FLIP_ROW||D===o.d.ROTATE_ROW||D===o.d.FLIP_N_ROTATE_ROW?S.concat(G[1]):S.concat(G[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),B.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(n){const G=[];F=0,i=0,J=1,p=X/T,G[0]=[F,i,J,i,J,p,F,p],G[1]=[F,i,J,i,J,p,F,p],D!==o.d.ROTATE_TILE&&D!==o.d.ROTATE_ROW||(G[1]=[1-F,1-i,1-J,1-i,1-J,1-p,1-F,1-p]),D!==o.d.FLIP_TILE&&D!==o.d.FLIP_ROW||(G[1]=[1-F,i,1-J,i,1-J,p,1-F,p]),D!==o.d.FLIP_N_ROTATE_TILE&&D!==o.d.FLIP_N_ROTATE_ROW||(G[1]=[F,1-i,J,1-i,J,1-p,F,1-p]);for(let T=0;T<r;T++)w.push(T*N-W+Y,L-X+y,0),w.push((T+1)*N-W+Y,L-X+y,0),w.push((T+1)*N-W+Y,L+y,0),w.push(T*N-W+Y,L+y,0),U.push(z,z+1,z+3,z+1,z+2,z+3),z+=4,S=D===o.d.FLIP_TILE||D===o.d.ROTATE_TILE||D===o.d.FLIP_N_ROTATE_TILE?S.concat(G[(T+g)%2]):D===o.d.FLIP_ROW||D===o.d.ROTATE_ROW||D===o.d.FLIP_N_ROTATE_ROW?S.concat(G[g%2]):S.concat(G[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),B.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(P){const G=[];F=1-v/N,i=0,J=1,p=1,G[0]=[F,i,J,i,J,p,F,p],G[1]=[F,i,J,i,J,p,F,p],D!==o.d.ROTATE_TILE&&D!==o.d.ROTATE_ROW||(G[1]=[1-F,1-i,1-J,1-i,1-J,1-p,1-F,1-p]),D!==o.d.FLIP_TILE&&D!==o.d.FLIP_ROW||(G[1]=[1-F,i,1-J,i,1-J,p,1-F,p]),D!==o.d.FLIP_N_ROTATE_TILE&&D!==o.d.FLIP_N_ROTATE_ROW||(G[1]=[F,1-i,J,1-i,J,1-p,F,1-p]);for(let N=0;N<g;N++)w.push(h+Y,N*T-j+y,0),w.push(h+v+Y,N*T-j+y,0),w.push(h+v+Y,(N+1)*T-j+y,0),w.push(h+Y,(N+1)*T-j+y,0),U.push(z,z+1,z+3,z+1,z+2,z+3),z+=4,S=D===o.d.FLIP_TILE||D===o.d.ROTATE_TILE||D===o.d.FLIP_N_ROTATE_TILE?S.concat(G[(N+1)%2]):D===o.d.FLIP_ROW||D===o.d.ROTATE_ROW||D===o.d.FLIP_N_ROTATE_ROW?S.concat(G[N%2]):S.concat(G[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),B.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(q){const G=[];F=0,i=0,J=v/T,p=1,G[0]=[F,i,J,i,J,p,F,p],G[1]=[F,i,J,i,J,p,F,p],D!==o.d.ROTATE_TILE&&D!==o.d.ROTATE_ROW||(G[1]=[1-F,1-i,1-J,1-i,1-J,1-p,1-F,1-p]),D!==o.d.FLIP_TILE&&D!==o.d.FLIP_ROW||(G[1]=[1-F,i,1-J,i,1-J,p,1-F,p]),D!==o.d.FLIP_N_ROTATE_TILE&&D!==o.d.FLIP_N_ROTATE_ROW||(G[1]=[F,1-i,J,1-i,J,1-p,F,1-p]);for(let N=0;N<g;N++)w.push(R-v+Y,N*T-j+y,0),w.push(R+Y,N*T-j+y,0),w.push(R+Y,(N+1)*T-j+y,0),w.push(R-v+Y,(N+1)*T-j+y,0),U.push(z,z+1,z+3,z+1,z+2,z+3),z+=4,S=D===o.d.FLIP_TILE||D===o.d.ROTATE_TILE||D===o.d.FLIP_N_ROTATE_TILE?S.concat(G[(N+r)%2]):D===o.d.FLIP_ROW||D===o.d.ROTATE_ROW||D===o.d.FLIP_N_ROTATE_ROW?S.concat(G[N%2]):S.concat(G[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),B.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const i=0===G.sideOrientation?0:G.sideOrientation||n.c.DEFAULTSIDE;n.c._ComputeSides(i,w,U,B,S,G.frontUVs,G.backUVs);const J=new n.c;J.indices=U,J.xa=w,J.ya=B,J.Aa=S;const p=i===n.c.DOUBLESIDE?V.concat(V):V;return J.za=p,J}function W(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new o.d(G,N);D.sideOrientation=o.d._GetDefaultSideOrientation(D.sideOrientation),T._originalBuilderSideOrientation=D.sideOrientation;return X(D).Ca(T,D.updatable),T}function j(G){const D=G.faceUV||new Array(6),N=G.faceColors,Z=G.pattern||o.d.NO_FLIP,P=G.width||G.size||1,r=G.height||G.size||1,v=G.depth||G.size||1,q=G.tileWidth||G.tileSize||1,W=G.tileHeight||G.tileSize||1,j=G.alignHorizontal||0,Y=G.alignVertical||0,y=0===G.sideOrientation?0:G.sideOrientation||n.c.DEFAULTSIDE;for(let o=0;o<6;o++)void 0===D[o]&&(D[o]=new T.v(0,0,1,1)),N&&void 0===N[o]&&(N[o]=new g.g(1,1,1,1));const h=P/2,m=r/2,R=v/2,L=[];for(let T=0;T<2;T++)L[T]=X({pattern:Z,tileWidth:q,tileHeight:W,width:P,height:r,alignVertical:Y,alignHorizontal:j,sideOrientation:y});for(let T=2;T<4;T++)L[T]=X({pattern:Z,tileWidth:q,tileHeight:W,width:v,height:r,alignVertical:Y,alignHorizontal:j,sideOrientation:y});let w=Y;Y===o.d.BOTTOM?w=o.d.TOP:Y===o.d.TOP&&(w=o.d.BOTTOM);for(let T=4;T<6;T++)L[T]=X({pattern:Z,tileWidth:q,tileHeight:W,width:P,height:v,alignVertical:w,alignHorizontal:j,sideOrientation:y});let B=[],F=[],S=[],V=[];const U=[],z=[],i=[],J=[];let p=0,t=0;for(let o=0;o<6;o++){const G=L[o].xa.length;z[o]=[],i[o]=[];for(let D=0;D<G/3;D++)z[o].push(new T.s(L[o].xa[3*D],L[o].xa[3*D+1],L[o].xa[3*D+2])),i[o].push(new T.s(L[o].ya[3*D],L[o].ya[3*D+1],L[o].ya[3*D+2]));p=L[o].Aa.length,J[o]=[];for(let N=0;N<p;N+=2)J[o][N]=D[o].x+(D[o].z-D[o].x)*L[o].Aa[N],J[o][N+1]=D[o].y+(D[o].w-D[o].y)*L[o].Aa[N+1],C.c&&(J[o][N+1]=1-J[o][N+1]);if(S=S.concat(J[o]),V=V.concat(L[o].indices.map((G=>G+t))),t+=z[o].length,N)for(let D=0;D<4;D++)U.push(N[o].r,N[o].g,N[o].b,N[o].a)}const H=new T.s(0,0,R),s=T.c.RotationY(Math.PI);B=z[0].map((G=>T.s.TransformNormal(G,s).add(H))).map((G=>[G.x,G.y,G.z])).reduce(((G,D)=>G.concat(D)),[]),F=i[0].map((G=>T.s.TransformNormal(G,s))).map((G=>[G.x,G.y,G.z])).reduce(((G,D)=>G.concat(D)),[]),B=B.concat(z[1].map((G=>G.Jc(H))).map((G=>[G.x,G.y,G.z])).reduce(((G,D)=>G.concat(D)),[])),F=F.concat(i[1].map((G=>[G.x,G.y,G.z])).reduce(((G,D)=>G.concat(D)),[]));const c=new T.s(h,0,0),K=T.c.RotationY(-Math.PI/2);B=B.concat(z[2].map((G=>T.s.TransformNormal(G,K).add(c))).map((G=>[G.x,G.y,G.z])).reduce(((G,D)=>G.concat(D)),[])),F=F.concat(i[2].map((G=>T.s.TransformNormal(G,K))).map((G=>[G.x,G.y,G.z])).reduce(((G,D)=>G.concat(D)),[]));const b=T.c.RotationY(Math.PI/2);B=B.concat(z[3].map((G=>T.s.TransformNormal(G,b).Jc(c))).map((G=>[G.x,G.y,G.z])).reduce(((G,D)=>G.concat(D)),[])),F=F.concat(i[3].map((G=>T.s.TransformNormal(G,b))).map((G=>[G.x,G.y,G.z])).reduce(((G,D)=>G.concat(D)),[]));const O=new T.s(0,m,0),Q=T.c.RotationX(Math.PI/2);B=B.concat(z[4].map((G=>T.s.TransformNormal(G,Q).add(O))).map((G=>[G.x,G.y,G.z])).reduce(((G,D)=>G.concat(D)),[])),F=F.concat(i[4].map((G=>T.s.TransformNormal(G,Q))).map((G=>[G.x,G.y,G.z])).reduce(((G,D)=>G.concat(D)),[]));const A=T.c.RotationX(-Math.PI/2);B=B.concat(z[5].map((G=>T.s.TransformNormal(G,A).Jc(O))).map((G=>[G.x,G.y,G.z])).reduce(((G,D)=>G.concat(D)),[])),F=F.concat(i[5].map((G=>T.s.TransformNormal(G,A))).map((G=>[G.x,G.y,G.z])).reduce(((G,D)=>G.concat(D)),[])),n.c._ComputeSides(y,B,V,F,S);const I=new n.c;if(I.indices=V,I.xa=B,I.ya=F,I.Aa=S,N){const G=y===n.c.DOUBLESIDE?U.concat(U):U;I.za=G}return I}function Y(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new o.d(G,N);D.sideOrientation=o.d._GetDefaultSideOrientation(D.sideOrientation),T._originalBuilderSideOrientation=D.sideOrientation;return j(D).Ca(T,D.updatable),T}n.c.CreateTiledPlane=X;n.c.CreateTiledBox=j;var y=N(11536),h=N(1218),m=N(1477);function R(G){const D=G.height||2;let N=0===G.diameterTop?0:G.diameterTop||G.diameter||1,Z=0===G.diameterBottom?0:G.diameterBottom||G.diameter||1;N=N||1e-5,Z=Z||1e-5;const P=0|(G.Uk||24),r=0|(G.subdivisions||1),v=!!G.hasRings,q=!!G.enclose,X=0===G.cap?0:G.cap||o.d.CAP_ALL,W=G.arc&&(G.arc<=0||G.arc>1)?1:G.arc||1,j=0===G.sideOrientation?0:G.sideOrientation||n.c.DEFAULTSIDE,Y=G.faceUV||new Array(3),y=G.faceColors,h=2+(1+(1!==W&&q?2:0))*(v?r:1);let R;for(R=0;R<h;R++)y&&void 0===y[R]&&(y[R]=new g.g(1,1,1,1));for(R=0;R<h;R++)Y&&void 0===Y[R]&&(Y[R]=new T.v(0,0,1,1));const L=[],w=[],B=[],F=[],S=[],V=2*Math.PI*W/P;let U,z,i;const J=(Z-N)/2/D,p=T.s.Zero(),t=T.s.Zero(),H=T.s.Zero(),s=T.s.Zero(),c=T.s.Zero(),K=m.d.Y;let b,O,Q,A=1,I=1,d=0,u=0;for(b=0;b<=r;b++)for(z=b/r,i=(z*(N-Z)+Z)/2,A=v&&0!==b&&b!==r?2:1,Q=0;Q<A;Q++){for(v&&(I+=Q),q&&(I+=2*Q),O=0;O<=P;O++)U=O*V,p.x=Math.cos(-U)*i,p.y=-D/2+z*D,p.z=Math.sin(-U)*i,0===N&&b===r?(t.x=B[B.length-3*(P+1)],t.y=B[B.length-3*(P+1)+1],t.z=B[B.length-3*(P+1)+2]):(t.x=p.x,t.z=p.z,t.y=Math.sqrt(t.x*t.x+t.z*t.z)*J,t.normalize()),0===O&&(H.p(p),s.p(t)),w.push(p.x,p.y,p.z),B.push(t.x,t.y,t.z),u=v?d!==I?Y[I].y:Y[I].w:Y[I].y+(Y[I].w-Y[I].y)*z,F.push(Y[I].x+(Y[I].z-Y[I].x)*O/P,C.c?1-u:u),y&&S.push(y[I].r,y[I].g,y[I].b,y[I].a);1!==W&&q&&(w.push(p.x,p.y,p.z),w.push(0,p.y,0),w.push(0,p.y,0),w.push(H.x,H.y,H.z),T.s.CrossToRef(K,t,c),c.normalize(),B.push(c.x,c.y,c.z,c.x,c.y,c.z),T.s.CrossToRef(s,K,c),c.normalize(),B.push(c.x,c.y,c.z,c.x,c.y,c.z),u=v?d!==I?Y[I+1].y:Y[I+1].w:Y[I+1].y+(Y[I+1].w-Y[I+1].y)*z,F.push(Y[I+1].x,C.c?1-u:u),F.push(Y[I+1].z,C.c?1-u:u),u=v?d!==I?Y[I+2].y:Y[I+2].w:Y[I+2].y+(Y[I+2].w-Y[I+2].y)*z,F.push(Y[I+2].x,C.c?1-u:u),F.push(Y[I+2].z,C.c?1-u:u),y&&(S.push(y[I+1].r,y[I+1].g,y[I+1].b,y[I+1].a),S.push(y[I+1].r,y[I+1].g,y[I+1].b,y[I+1].a),S.push(y[I+2].r,y[I+2].g,y[I+2].b,y[I+2].a),S.push(y[I+2].r,y[I+2].g,y[I+2].b,y[I+2].a))),d!==I&&(d=I)}const l=1!==W&&q?P+4:P;for(b=0,I=0;I<r;I++){let G=0,D=0,N=0,T=0;for(O=0;O<P;O++)G=b*(l+1)+O,D=(b+1)*(l+1)+O,N=b*(l+1)+(O+1),T=(b+1)*(l+1)+(O+1),L.push(G,D,N),L.push(T,N,D);1!==W&&q&&(L.push(G+2,D+2,N+2),L.push(T+2,N+2,D+2),L.push(G+4,D+4,N+4),L.push(T+4,N+4,D+4)),b=v?b+2:b+1}const x=G=>{const o=G?N/2:Z/2;if(0===o)return;let n,r,v;const q=G?Y[h-1]:Y[0];let g=null;y&&(g=G?y[h-1]:y[0]);const X=w.length/3,j=G?D/2:-D/2,m=new T.s(0,j,0);w.push(m.x,m.y,m.z),B.push(0,G?1:-1,0);const R=q.y+.5*(q.w-q.y);F.push(q.x+.5*(q.z-q.x),C.c?1-R:R),g&&S.push(g.r,g.g,g.b,g.a);const V=new T.o(.5,.5);for(v=0;v<=P;v++){n=2*Math.PI*v*W/P;const D=Math.cos(-n),N=Math.sin(-n);r=new T.s(D*o,j,N*o);const Z=new T.o(D*V.x+.5,N*V.y+.5);w.push(r.x,r.y,r.z),B.push(0,G?1:-1,0);const X=q.y+(q.w-q.y)*Z.y;F.push(q.x+(q.z-q.x)*Z.x,C.c?1-X:X),g&&S.push(g.r,g.g,g.b,g.a)}for(v=0;v<P;v++)G?(L.push(X),L.push(X+(v+2)),L.push(X+(v+1))):(L.push(X),L.push(X+(v+1)),L.push(X+(v+2)))};X!==o.d.CAP_START&&X!==o.d.CAP_ALL||x(!1),X!==o.d.CAP_END&&X!==o.d.CAP_ALL||x(!0),n.c._ComputeSides(j,w,L,B,F,G.frontUVs,G.backUVs);const k=new n.c;return k.indices=L,k.xa=w,k.ya=B,k.Aa=F,y&&(k.za=S),k}function L(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2?arguments[2]:void 0;const T=new o.d(G,N);D.sideOrientation=o.d._GetDefaultSideOrientation(D.sideOrientation),T._originalBuilderSideOrientation=D.sideOrientation;return R(D).Ca(T,D.updatable),T}function w(G){const D=[],N=[],o=[],Z=[],P=G.diameter||1,r=G.thickness||.5,v=0|(G.Uk||16),q=0===G.sideOrientation?0:G.sideOrientation||n.c.DEFAULTSIDE,g=v+1;for(let n=0;n<=v;n++){const G=n/v,q=n*Math.PI*2/v-Math.PI/2,X=T.c.Translation(P/2,0,0).multiply(T.c.RotationY(q));for(let P=0;P<=v;P++){const q=1-P/v,W=P*Math.PI*2/v+Math.PI,j=Math.cos(W),Y=Math.sin(W);let y=new T.s(j,Y,0),h=y.scale(r/2);const m=new T.o(G,q);h=T.s.TransformCoordinates(h,X),y=T.s.TransformNormal(y,X),N.push(h.x,h.y,h.z),o.push(y.x,y.y,y.z),Z.push(m.x,C.c?1-m.y:m.y);const R=(n+1)%g,L=(P+1)%g;D.push(n*g+P),D.push(n*g+L),D.push(R*g+P),D.push(n*g+L),D.push(R*g+L),D.push(R*g+P)}}n.c._ComputeSides(q,N,D,o,Z,G.frontUVs,G.backUVs);const X=new n.c;return X.indices=D,X.xa=N,X.ya=o,X.Aa=Z,X}function B(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2?arguments[2]:void 0;const T=new o.d(G,N);D.sideOrientation=o.d._GetDefaultSideOrientation(D.sideOrientation),T._originalBuilderSideOrientation=D.sideOrientation;return w(D).Ca(T,D.updatable),T}n.c.CreateCylinder=R,o.d.CreateCylinder=(G,D,N,T,Z,n,C,P,r)=>{void 0!==C&&C instanceof h.e||(void 0!==C&&(r=P||o.d.DEFAULTSIDE,P=C),C=n,n=1);return L(G,{height:D,diameterTop:N,diameterBottom:T,Uk:Z,subdivisions:n,sideOrientation:r,updatable:P},C)};function F(G){const D=[],N=[],o=[],Z=[],P=G.i||2,r=G.tube||.5,v=G.radialSegments||32,q=G.tubularSegments||32,g=G.p||2,X=G.q||3,W=0===G.sideOrientation?0:G.sideOrientation||n.c.DEFAULTSIDE,j=G=>{const D=Math.cos(G),N=Math.sin(G),o=X/g*G,Z=Math.cos(o),n=P*(2+Z)*.5*D,C=P*(2+Z)*N*.5,r=P*Math.sin(o)*.5;return new T.s(n,C,r)};let Y,y;for(Y=0;Y<=v;Y++){const G=Y%v/v*2*g*Math.PI,D=j(G),o=j(G+.01),n=o.Jc(D);let P=o.add(D);const X=T.s.Cross(n,P);for(P=T.s.Cross(X,n),X.normalize(),P.normalize(),y=0;y<q;y++){const G=y%q/q*2*Math.PI,T=-r*Math.cos(G),o=r*Math.sin(G);N.push(D.x+T*P.x+o*X.x),N.push(D.y+T*P.y+o*X.y),N.push(D.z+T*P.z+o*X.z),Z.push(Y/v),Z.push(C.c?1-y/q:y/q)}}for(Y=0;Y<v;Y++)for(y=0;y<q;y++){const G=(y+1)%q,N=Y*q+y,T=(Y+1)*q+y,o=(Y+1)*q+G,Z=Y*q+G;D.push(Z),D.push(T),D.push(N),D.push(Z),D.push(o),D.push(T)}n.c.ComputeNormals(N,D,o),n.c._ComputeSides(W,N,D,o,Z,G.frontUVs,G.backUVs);const h=new n.c;return h.indices=D,h.xa=N,h.ya=o,h.Aa=Z,h}function S(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2?arguments[2]:void 0;const T=new o.d(G,N);D.sideOrientation=o.d._GetDefaultSideOrientation(D.sideOrientation),T._originalBuilderSideOrientation=D.sideOrientation;return F(D).Ca(T,D.updatable),T}n.c.CreateTorus=w,o.d.CreateTorus=(G,D,N,T,o,Z,n)=>B(G,{diameter:D,thickness:N,Uk:T,sideOrientation:n,updatable:Z},o);n.c.CreateTorusKnot=F,o.d.CreateTorusKnot=(G,D,N,T,o,Z,n,C,P,r)=>S(G,{i:D,tube:N,radialSegments:T,tubularSegments:o,p:Z,q:n,sideOrientation:r,updatable:P},C);var V=N(12064),U=N(1105),z=N(1486),i=N(1012),J=N(1030);class p extends T.o{constructor(G,D){super(G.x,G.y),this.index=D}}class t{constructor(){this.elements=[]}add(G){const D=[];return G.forEach((G=>{const N=new p(G,this.elements.length);D.push(N),this.elements.push(N)})),D}computeBounds(){const G=new T.o(this.elements[0].x,this.elements[0].y),D=new T.o(this.elements[0].x,this.elements[0].y);return this.elements.forEach((N=>{N.x<G.x?G.x=N.x:N.x>D.x&&(D.x=N.x),N.y<G.y?G.y=N.y:N.y>D.y&&(D.y=N.y)})),{min:G,max:D,width:D.x-G.x,height:D.y-G.y}}}class H{_addToepoint(G){for(const D of G)this._epoints.push(D.x,D.y)}constructor(G,D,N){let T,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new t,this._outlinepoints=new t,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=o,this._name=G,this._scene=N||J.e.LastCreatedScene,T=D instanceof z.i?D.getPoints():D,this._addToepoint(T),this._points.add(T),this._outlinepoints.add(T),"undefined"===typeof this.bjsEarcut&&U.d.Warn("Earcut was not found, the polygon will not be built.")}addHole(G){this._points.add(G);const D=new t;return D.add(G),this._holes.push(D),this._eholes.push(this._epoints.length/2),this._addToepoint(G),this}build(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const T=new o.d(this._name,this._scene),n=this.buildVertexData(D,N);return T.Ga(Z.f.PositionKind,n.xa,G),T.Ga(Z.f.NormalKind,n.ya,G),T.Ga(Z.f.UVKind,n.Aa,G),T.setIndices(n.indices),T}buildVertexData(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const N=new n.c,T=[],o=[],Z=[],C=this._points.computeBounds();this._points.elements.forEach((G=>{T.push(0,1,0),o.push(G.x,0,G.y),Z.push((G.x-C.min.x)/C.width,(G.y-C.min.y)/C.height)}));const P=[],r=this.bjsEarcut(this._epoints,this._eholes,2);for(let n=0;n<r.length;n++)P.push(r[n]);if(G>0){const N=o.length/3;this._points.elements.forEach((D=>{T.push(0,-1,0),o.push(D.x,-G,D.y),Z.push(1-(D.x-C.min.x)/C.width,1-(D.y-C.min.y)/C.height)}));const n=P.length;for(let G=0;G<n;G+=3){const D=P[G+0],T=P[G+1],o=P[G+2];P.push(o+N),P.push(T+N),P.push(D+N)}this._addSide(o,T,Z,P,C,this._outlinepoints,G,!1,D),this._holes.forEach((N=>{this._addSide(o,T,Z,P,C,N,G,!0,D)}))}return N.indices=P,N.xa=o,N.ya=T,N.Aa=Z,N}_addSide(G,D,N,o,Z,n,C,P,r){let v=G.length/3,q=0;for(let g=0;g<n.elements.length;g++){const X=n.elements[g],W=n.elements[(g+1)%n.elements.length];G.push(X.x,0,X.y),G.push(X.x,-C,X.y),G.push(W.x,0,W.y),G.push(W.x,-C,W.y);const j=n.elements[(g+n.elements.length-1)%n.elements.length],Y=n.elements[(g+2)%n.elements.length];let y=new T.s(-(W.y-X.y),0,W.x-X.x),h=new T.s(-(X.y-j.y),0,X.x-j.x),m=new T.s(-(Y.y-W.y),0,Y.x-W.x);P||(y=y.scale(-1),h=h.scale(-1),m=m.scale(-1));const R=y.normalizeToNew();let L=h.normalizeToNew(),w=m.normalizeToNew();const B=T.s.Dot(L,R);L=B>r?B<i.d-1?new T.s(X.x,0,X.y).Jc(new T.s(W.x,0,W.y)).normalize():h.add(y).normalize():R;const F=T.s.Dot(m,y);w=F>r?F<i.d-1?new T.s(W.x,0,W.y).Jc(new T.s(X.x,0,X.y)).normalize():m.add(y).normalize():R,N.push(q/Z.width,0),N.push(q/Z.width,1),q+=y.length(),N.push(q/Z.width,0),N.push(q/Z.width,1),D.push(L.x,L.y,L.z),D.push(L.x,L.y,L.z),D.push(w.x,w.y,w.z),D.push(w.x,w.y,w.z),P?(o.push(v),o.push(v+2),o.push(v+1),o.push(v+1),o.push(v+2),o.push(v+3)):(o.push(v),o.push(v+1),o.push(v+2),o.push(v+1),o.push(v+3),o.push(v+2)),v+=4}}}function s(G,D,N,o,P,r,v){const q=N||new Array(3),X=o,W=[],j=v||!1;for(let Z=0;Z<3;Z++)void 0===q[Z]&&(q[Z]=new T.v(0,0,1,1)),X&&void 0===X[Z]&&(X[Z]=new g.g(1,1,1,1));const Y=G.getVerticesData(Z.f.PositionKind),y=G.getVerticesData(Z.f.NormalKind),h=G.getVerticesData(Z.f.UVKind),m=G.ye(),R=Y.length/9;let L=0,w=0,B=0,F=0,S=0;const V=[0];if(j)for(let T=R;T<Y.length/3;T+=4)w=Y[3*(T+2)]-Y[3*T],B=Y[3*(T+2)+2]-Y[3*T+2],F=Math.sqrt(w*w+B*B),S+=F,V.push(S);let U=0,z=0;for(let T=0;T<y.length;T+=3)Math.abs(y[T+1])<.001&&(z=1),Math.abs(y[T+1]-1)<.001&&(z=0),Math.abs(y[T+1]+1)<.001&&(z=2),U=T/3,1===z?(L=U-R,h[2*U]=L%4<1.5?j?q[z].x+(q[z].z-q[z].x)*V[Math.floor(L/4)]/S:q[z].x:j?q[z].x+(q[z].z-q[z].x)*V[Math.floor(L/4)+1]/S:q[z].z,h[2*U+1]=L%2===0?C.c?1-q[z].w:q[z].w:C.c?1-q[z].y:q[z].y):(h[2*U]=(1-h[2*U])*q[z].x+h[2*U]*q[z].z,h[2*U+1]=(1-h[2*U+1])*q[z].y+h[2*U+1]*q[z].w,C.c&&(h[2*U+1]=1-h[2*U+1])),X&&W.push(X[z].r,X[z].g,X[z].b,X[z].a);n.c._ComputeSides(D,Y,m,y,h,P,r);const i=new n.c;if(i.indices=m,i.xa=Y,i.ya=y,i.Aa=h,X){const G=D===n.c.DOUBLESIDE?W.concat(W):W;i.za=G}return i}function c(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;D.sideOrientation=o.d._GetDefaultSideOrientation(D.sideOrientation);const n=D.shape,C=D.holes||[],P=D.depth||0,r=D.smoothingThreshold||2,v=[];let q=[];for(let o=0;o<n.length;o++)v[o]=new T.o(n[o].x,n[o].z);v[0].equalsWithEpsilon(v[v.length-1],1e-8)&&v.pop();const g=new H(G,v,N||J.e.LastCreatedScene,Z);for(let o=0;o<C.length;o++){q=[];for(let G=0;G<C[o].length;G++)q.push(new T.o(C[o][G].x,C[o][G].z));g.addHole(q)}const X=g.build(!1,P,r);X._originalBuilderSideOrientation=D.sideOrientation;return s(X,D.sideOrientation,D.faceUV,D.faceColors,D.frontUVs,D.backUVs,D.wrap).Ca(X,D.updatable),X}function K(G,D){return c(G,D,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function b(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=D.path,Z=D.shape,n=D.scale||1,C=D.rotation||0,P=0===D.cap?0:D.cap||o.d.NO_CAP,r=D.updatable,v=o.d._GetDefaultSideOrientation(D.sideOrientation),q=D.instance||null,g=D.invertUV||!1,X=D.closeShape||!1;return Q(G,Z,T,n,C,null,null,D.closePath||!1,X,P,!1,N,!!r,v,q,g,D.frontUVs||null,D.backUVs||null,D.firstNormal||null,!!D.adjustFrame)}function O(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=D.path,Z=D.shape,n=D.scaleFunction||(()=>1),C=D.rotationFunction||(()=>0),P=D.closePath||D.ribbonCloseArray||!1,r=D.closeShape||D.ribbonClosePath||!1,v=0===D.cap?0:D.cap||o.d.NO_CAP,q=D.updatable,g=D.firstNormal||null,X=D.adjustFrame||!1;return Q(G,Z,T,null,null,n,C,P,r,v,!0,N,!!q,o.d._GetDefaultSideOrientation(D.sideOrientation),D.instance||null,D.invertUV||!1,D.frontUVs||null,D.backUVs||null,g,X)}function Q(G,D,N,Z,n,C,P,v,q,g,X,W,j,Y,y,h,m,R,L,w){const B=(G,D,N,Z,n,C,P,r,v,q,g)=>{const X=N.getTangents(),W=N.getNormals(),j=N.getBinormals(),Y=N.getDistances();if(g)for(let o=0;o<X.length;o++)if(0==X[o].x&&0==X[o].y&&0==X[o].z&&X[o].p(X[o-1]),0==W[o].x&&0==W[o].y&&0==W[o].z&&W[o].p(W[o-1]),0==j[o].x&&0==j[o].y&&0==j[o].z&&j[o].p(j[o-1]),o>0){let G=X[o-1];T.s.Dot(G,X[o])<0&&X[o].scaleInPlace(-1),G=W[o-1],T.s.Dot(G,W[o])<0&&W[o].scaleInPlace(-1),G=j[o-1],T.s.Dot(G,j[o])<0&&j[o].scaleInPlace(-1)}let y=0;const h=q&&r?r:()=>null!==C?C:0,m=q&&P?P:()=>null!==n?n:1;let R=v===o.d.NO_CAP||v===o.d.CAP_END?0:2;const L=T.k.Matrix[0];for(let o=0;o<D.length;o++){const N=[],n=h(o,Y[o]),C=m(o,Y[o]);T.c.RotationAxisToRef(X[o],y,L);for(let Z=0;Z<G.length;Z++){const n=X[o].scale(G[Z].z).add(W[o].scale(G[Z].x)).add(j[o].scale(G[Z].y)),P=T.s.Zero();T.s.TransformCoordinatesToRef(n,L,P),P.scaleInPlace(C).addInPlace(D[o]),N[Z]=P}Z[R]=N,y+=n,R++}const w=G=>{const D=Array(),N=T.s.Zero();let o;for(o=0;o<G.length;o++)N.addInPlace(G[o]);for(N.scaleInPlace(1/G.length),o=0;o<G.length;o++)D.push(N);return D};switch(v){case o.d.NO_CAP:break;case o.d.CAP_START:Z[0]=w(Z[2]),Z[1]=Z[2];break;case o.d.CAP_END:Z[R]=Z[R-1],Z[R+1]=w(Z[R-1]);break;case o.d.CAP_ALL:Z[0]=w(Z[2]),Z[1]=Z[2],Z[R]=Z[R-1],Z[R+1]=w(Z[R-1])}return Z};let F,S;if(y){const G=y._creationDataStorage;return F=L?G.path3D.update(N,L):G.path3D.update(N),S=B(D,N,G.path3D,G.pathArray,Z,n,C,P,G.cap,X,w),y=r("",{pathArray:S,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:y},W||void 0)}F=L?new z.j(N,L):new z.j(N);S=B(D,N,F,new Array,Z,n,C,P,g=g<0||g>3?0:g,X,w);const V=r(G,{pathArray:S,closeArray:v,closePath:q,updatable:j,sideOrientation:Y,invertUV:h,frontUVs:m||void 0,backUVs:R||void 0},W);return V._creationDataStorage.pathArray=S,V._creationDataStorage.path3D=F,V._creationDataStorage.cap=g,V}n.c.CreatePolygon=s,o.d.CreatePolygon=function(G,D,N,T,o,Z){return c(G,{shape:D,holes:T,updatable:o,sideOrientation:Z},N,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},o.d.ExtrudePolygon=function(G,D,N,T,o,Z,n){return K(G,{shape:D,holes:o,depth:N,updatable:Z,sideOrientation:n},T,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function A(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=D.arc?D.arc<=0||D.arc>1?1:D.arc:1,n=void 0===D.closed||D.closed,C=D.shape,P=D.i||1,v=D.Uk||64,q=D.clip||0,g=D.updatable,X=o.d._GetDefaultSideOrientation(D.sideOrientation),W=D.cap||o.d.NO_CAP,j=2*Math.PI,Y=[],y=D.invertUV||!1;let h=0,m=0;const R=j/v*Z;let L,w;for(h=0;h<=v-q;h++){for(w=[],W!=o.d.CAP_START&&W!=o.d.CAP_ALL||(w.push(new T.s(0,C[0].y,0)),w.push(new T.s(Math.cos(h*R)*C[0].x*P,C[0].y,Math.sin(h*R)*C[0].x*P))),m=0;m<C.length;m++)L=new T.s(Math.cos(h*R)*C[m].x*P,C[m].y,Math.sin(h*R)*C[m].x*P),w.push(L);W!=o.d.CAP_END&&W!=o.d.CAP_ALL||(w.push(new T.s(Math.cos(h*R)*C[C.length-1].x*P,C[C.length-1].y,Math.sin(h*R)*C[C.length-1].x*P)),w.push(new T.s(0,C[C.length-1].y,0))),Y.push(w)}return r(G,{pathArray:Y,closeArray:n,sideOrientation:X,updatable:g,invertUV:y,frontUVs:D.frontUVs,backUVs:D.backUVs},N)}o.d.ExtrudeShape=function(G,D,N,T,Z,n){let C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7?arguments[7]:void 0,r=arguments.length>8?arguments[8]:void 0,v=arguments.length>9?arguments[9]:void 0;return b(G,{shape:D,path:N,scale:T,rotation:Z,cap:0===n?0:n||o.d.NO_CAP,sideOrientation:r,instance:v,updatable:P},C)},o.d.ExtrudeShapeCustom=(G,D,N,T,Z,n,C,P,r,v,q,g)=>O(G,{shape:D,path:N,scaleFunction:T,rotationFunction:Z,ribbonCloseArray:n,ribbonClosePath:C,cap:0===P?0:P||o.d.NO_CAP,sideOrientation:q,instance:g,updatable:v},r);o.d.CreateLathe=(G,D,N,T,o,Z,n)=>A(G,{shape:D,i:N,Uk:T,sideOrientation:n,updatable:Z},o);var I=N(11496),d=N(11452);function u(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=D.path;let n=D.instance,C=1;void 0!==D.i?C=D.i:n&&(C=n._creationDataStorage.i);const P=D.Uk||64,v=D.radiusFunction||null;let q=D.cap||o.d.NO_CAP;const g=D.invertUV||!1,X=D.updatable,W=o.d._GetDefaultSideOrientation(D.sideOrientation);D.arc=D.arc&&(D.arc<=0||D.arc>1)?1:D.arc||1;const j=(G,D,N,Z,n,C,P,r)=>{const v=D.getTangents(),q=D.getNormals(),g=D.getDistances(),X=2*Math.PI/n*r,W=C||(()=>Z);let j,Y,y,h;const m=T.k.Matrix[0];let R=P===o.d.NO_CAP||P===o.d.CAP_END?0:2;for(let o=0;o<G.length;o++){Y=W(o,g[o]),j=Array(),y=q[o];for(let D=0;D<n;D++)T.c.RotationAxisToRef(v[o],X*D,m),h=j[D]?j[D]:T.s.Zero(),T.s.TransformCoordinatesToRef(y,m,h),h.scaleInPlace(Y).addInPlace(G[o]),j[D]=h;N[R]=j,R++}const L=(D,N)=>{const T=Array();for(let o=0;o<D;o++)T.push(G[N]);return T};switch(P){case o.d.NO_CAP:break;case o.d.CAP_START:N[0]=L(n,0),N[1]=N[2].slice(0);break;case o.d.CAP_END:N[R]=N[R-1].slice(0),N[R+1]=L(n,G.length-1);break;case o.d.CAP_ALL:N[0]=L(n,0),N[1]=N[2].slice(0),N[R]=N[R-1].slice(0),N[R+1]=L(n,G.length-1)}return N};let Y,y;if(n){const G=n._creationDataStorage,N=D.arc||G.arc;return Y=G.path3D.update(Z),y=j(Z,Y,G.pathArray,C,G.Uk,v,G.cap,N),n=r("",{pathArray:y,instance:n}),G.path3D=Y,G.pathArray=y,G.arc=N,G.i=C,n}Y=new z.j(Z);q=q<0||q>3?0:q,y=j(Z,Y,new Array,C,P,v,q,D.arc);const h=r(G,{pathArray:y,closePath:!0,closeArray:!1,updatable:X,sideOrientation:W,invertUV:g,frontUVs:D.frontUVs,backUVs:D.backUVs},N);return h._creationDataStorage.pathArray=y,h._creationDataStorage.path3D=Y,h._creationDataStorage.Uk=P,h._creationDataStorage.cap=q,h._creationDataStorage.arc=D.arc,h._creationDataStorage.i=C,h}function l(G){const D=[];D[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},D[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},D[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},D[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},D[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},D[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},D[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},D[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},D[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},D[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},D[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},D[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},D[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},D[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},D[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const N=G.type&&(G.type<0||G.type>=D.length)?0:G.type||0,o=G.size,Z=G.sizeX||o||1,P=G.sizeY||o||1,r=G.sizeZ||o||1,v=G.custom||D[N],q=v.face.length,X=G.faceUV||new Array(q),W=G.faceColors,j=void 0===G.flat||G.flat,Y=0===G.sideOrientation?0:G.sideOrientation||n.c.DEFAULTSIDE,y=[],h=[],m=[],R=[],L=[];let w=0,B=0;const F=[];let S,V,U,z,i,J,p=0,t=0;if(j)for(t=0;t<q;t++)W&&void 0===W[t]&&(W[t]=new g.g(1,1,1,1)),X&&void 0===X[t]&&(X[t]=new T.v(0,0,1,1));if(j)for(t=0;t<q;t++){const G=v.face[t].length;for(U=2*Math.PI/G,z=.5*Math.tan(U/2),i=.5,p=0;p<G;p++)y.push(v.vertex[v.face[t][p]][0]*Z,v.vertex[v.face[t][p]][1]*P,v.vertex[v.face[t][p]][2]*r),F.push(w),w++,S=X[t].x+(X[t].z-X[t].x)*(.5+z),V=X[t].y+(X[t].w-X[t].y)*(i-.5),R.push(S,C.c?1-V:V),J=z*Math.cos(U)-i*Math.sin(U),i=z*Math.sin(U)+i*Math.cos(U),z=J,W&&L.push(W[t].r,W[t].g,W[t].b,W[t].a);for(p=0;p<G-2;p++)h.push(F[0+B],F[p+2+B],F[p+1+B]);B+=G}else{for(p=0;p<v.vertex.length;p++)y.push(v.vertex[p][0]*Z,v.vertex[p][1]*P,v.vertex[p][2]*r),R.push(0,C.c?1:0);for(t=0;t<q;t++)for(p=0;p<v.face[t].length-2;p++)h.push(v.face[t][0],v.face[t][p+2],v.face[t][p+1])}n.c.ComputeNormals(y,h,m),n.c._ComputeSides(Y,y,h,m,R,G.frontUVs,G.backUVs);const H=new n.c;return H.xa=y,H.indices=h,H.ya=m,H.Aa=R,W&&j&&(H.za=L),H}function x(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new o.d(G,N);D.sideOrientation=o.d._GetDefaultSideOrientation(D.sideOrientation),T._originalBuilderSideOrientation=D.sideOrientation;return l(D).Ca(T,D.updatable),T}o.d.CreateTube=(G,D,N,T,o,Z,n,C,P,r)=>u(G,{path:D,i:N,Uk:T,radiusFunction:o,arc:1,cap:Z,updatable:C,sideOrientation:P,instance:r},n);function k(G){const D=G.sideOrientation||n.c.DEFAULTSIDE,N=G.i||1,o=void 0===G.flat||G.flat,Z=0|(G.subdivisions||4),P=G.radiusX||N,r=G.radiusY||N,v=G.radiusZ||N,q=(1+Math.sqrt(5))/2,g=[-1,q,-0,1,q,0,-1,-q,0,1,-q,0,0,-1,-q,0,1,-q,0,-1,q,0,1,q,q,0,1,q,0,-1,-q,0,1,-q,0,-1],X=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],W=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],j=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],Y=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],y=[],h=[],m=[],R=[];let L=0;const w=new Array(3),B=new Array(3);let F;for(F=0;F<3;F++)w[F]=T.s.Zero(),B[F]=T.o.Zero();for(let n=0;n<20;n++){for(F=0;F<3;F++){const G=X[3*n+F];w[F].xd(g[3*W[G]],g[3*W[G]+1],g[3*W[G]+2]),w[F].normalize(),B[F].xd(.134765625*j[2*G]+.05859375+-.0390625*Y[n],.2333984375*j[2*G+1]+.025390625+.01953125*Y[n])}const G=(G,D,N,n)=>{const q=T.s.Lerp(w[0],w[2],D/Z),g=T.s.Lerp(w[1],w[2],D/Z),X=Z===D?w[2]:T.s.Lerp(q,g,G/(Z-D));let W;if(X.normalize(),o){const G=T.s.Lerp(w[0],w[2],n/Z),D=T.s.Lerp(w[1],w[2],n/Z);W=T.s.Lerp(G,D,N/(Z-n))}else W=new T.s(X.x,X.y,X.z);W.x/=P,W.y/=r,W.z/=v,W.normalize();const j=T.o.Lerp(B[0],B[2],D/Z),Y=T.o.Lerp(B[1],B[2],D/Z),F=Z===D?B[2]:T.o.Lerp(j,Y,G/(Z-D));h.push(X.x*P,X.y*r,X.z*v),m.push(W.x,W.y,W.z),R.push(F.x,C.c?1-F.y:F.y),y.push(L),L++};for(let D=0;D<Z;D++)for(let N=0;N+D<Z;N++)G(N,D,N+1/3,D+1/3),G(N+1,D,N+1/3,D+1/3),G(N,D+1,N+1/3,D+1/3),N+D+1<Z&&(G(N+1,D,N+2/3,D+2/3),G(N+1,D+1,N+2/3,D+2/3),G(N,D+1,N+2/3,D+2/3))}n.c._ComputeSides(D,h,y,m,R,G.frontUVs,G.backUVs);const S=new n.c;return S.indices=y,S.xa=h,S.ya=m,S.Aa=R,S}function a(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const T=new o.d(G,N);D.sideOrientation=o.d._GetDefaultSideOrientation(D.sideOrientation),T._originalBuilderSideOrientation=D.sideOrientation;return k(D).Ca(T,D.updatable),T}n.c.CreatePolyhedron=l,o.d.CreatePolyhedron=(G,D,N)=>x(G,D,N);n.c.CreateIcoSphere=k,o.d.CreateIcoSphere=(G,D,N)=>a(G,D,N);var E=N(1038);const M=new T.s(1,0,0),e=new T.s(-1,0,0),f=new T.s(0,1,0),GG=new T.s(0,-1,0),DG=new T.s(0,0,1),NG=new T.s(0,0,-1);class TG{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.s.Zero(),D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.s.Up(),N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T.o.Zero(),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=G,this.Bd=D,this.uv=N,this.vertexIdx=o,this.vertexIdxForBones=Z,this.localPositionOverride=n,this.localNormalOverride=C,this.matrixIndicesOverride=P,this.matrixWeightsOverride=r}clone(){var G,D,N,T;return new TG(this.position.clone(),this.Bd.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(G=this.localPositionOverride)||void 0===G?void 0:G.slice(),null===(D=this.localNormalOverride)||void 0===D?void 0:D.slice(),null===(N=this.matrixIndicesOverride)||void 0===N?void 0:N.slice(),null===(T=this.matrixWeightsOverride)||void 0===T?void 0:T.slice())}}function oG(G,D,N){var P,r,v,q;const g=!!D.skeleton,X=N.localMode||g,W=D.ye(),j=g?D.Tf(!0,!0):D.getVerticesData(Z.f.PositionKind),Y=g?D.getNormalsData(!0,!0):D.getVerticesData(Z.f.NormalKind),y=X?g?D.getVerticesData(Z.f.PositionKind):j:null,h=X?g?D.getVerticesData(Z.f.NormalKind):Y:null,m=D.getVerticesData(Z.f.UVKind),R=g?D.getVerticesData(Z.f.MatricesIndicesKind):null,L=g?D.getVerticesData(Z.f.MatricesWeightsKind):null,w=g?D.getVerticesData(Z.f.MatricesIndicesExtraKind):null,B=g?D.getVerticesData(Z.f.MatricesWeightsExtraKind):null,F=N.position||T.s.Zero();let S=N.Bd||T.s.Up();const V=N.size||T.s.One(),U=N.angle||0;if(!S){const G=new T.s(0,0,1),N=D.va().activeCamera,o=T.s.TransformCoordinates(G,N.getWorldMatrix());S=N.globalPosition.Jc(o)}const z=-Math.atan2(S.z,S.x)-Math.PI/2,i=Math.sqrt(S.x*S.x+S.z*S.z),J=Math.atan2(S.y,i),p=new n.c;p.indices=[],p.xa=[],p.ya=[],p.Aa=[],p.matricesIndices=g?[]:null,p.matricesWeights=g?[]:null,p.matricesIndicesExtra=w?[]:null,p.matricesWeightsExtra=B?[]:null;let t=0;const H=(G,D)=>{const o=new TG;if(!W||!j||!Y)return o;const Z=W[G];if(o.vertexIdx=3*Z,o.vertexIdxForBones=4*Z,o.position=new T.s(j[3*Z],j[3*Z+1],j[3*Z+2]),T.s.TransformCoordinatesToRef(o.position,D,o.position),o.Bd=new T.s(Y[3*Z],Y[3*Z+1],Y[3*Z+2]),T.s.TransformNormalToRef(o.Bd,D,o.Bd),N.captureUVS&&m){const G=m[2*Z+1];o.uv=new T.o(m[2*Z],C.c?1-G:G)}return o},s=[0,0,0,0],c=(G,D)=>{if(0===G.length)return G;const N=.5*Math.abs(T.s.Dot(V,D)),o=(G,D,N,T)=>{for(let o=0;o<T;++o)if(G[N+o]===D)return N+o;return-1},Z=(G,Z)=>{const n=T.s.GetClipFactor(G.position,Z.position,D,N);let C=s,P=s;if(R&&L){const D=G.matrixIndicesOverride?0:G.vertexIdxForBones,N=G.matrixIndicesOverride??R,T=G.matrixWeightsOverride??L,r=Z.matrixIndicesOverride?0:Z.vertexIdxForBones,v=Z.matrixIndicesOverride??R,q=Z.matrixWeightsOverride??L;C=[0,0,0,0],P=[0,0,0,0];let g=0;for(let G=0;G<4;++G)if(T[D+G]>0){const Z=o(v,N[D+G],r,4);C[g]=N[D+G],P[g]=(0,E.o)(T[D+G],Z>=0?q[Z]:0,n),g++}for(let G=0;G<4&&g<4;++G){const T=v[r+G];-1===o(N,T,D,4)&&(C[g]=T,P[g]=(0,E.o)(0,q[r+G],n),g++)}const X=P[0]+P[1]+P[2]+P[3];P[0]/=X,P[1]/=X,P[2]/=X,P[3]/=X}const r=G.localPositionOverride?G.localPositionOverride[0]:(null===y||void 0===y?void 0:y[G.vertexIdx])??0,v=G.localPositionOverride?G.localPositionOverride[1]:(null===y||void 0===y?void 0:y[G.vertexIdx+1])??0,q=G.localPositionOverride?G.localPositionOverride[2]:(null===y||void 0===y?void 0:y[G.vertexIdx+2])??0,g=Z.localPositionOverride?Z.localPositionOverride[0]:(null===y||void 0===y?void 0:y[Z.vertexIdx])??0,X=Z.localPositionOverride?Z.localPositionOverride[1]:(null===y||void 0===y?void 0:y[Z.vertexIdx+1])??0,W=Z.localPositionOverride?Z.localPositionOverride[2]:(null===y||void 0===y?void 0:y[Z.vertexIdx+2])??0,j=G.localNormalOverride?G.localNormalOverride[0]:(null===h||void 0===h?void 0:h[G.vertexIdx])??0,Y=G.localNormalOverride?G.localNormalOverride[1]:(null===h||void 0===h?void 0:h[G.vertexIdx+1])??0,m=G.localNormalOverride?G.localNormalOverride[2]:(null===h||void 0===h?void 0:h[G.vertexIdx+2])??0,w=j+((Z.localNormalOverride?Z.localNormalOverride[0]:(null===h||void 0===h?void 0:h[Z.vertexIdx])??0)-j)*n,B=Y+((Z.localNormalOverride?Z.localNormalOverride[1]:(null===h||void 0===h?void 0:h[Z.vertexIdx+1])??0)-Y)*n,F=m+((Z.localNormalOverride?Z.localNormalOverride[2]:(null===h||void 0===h?void 0:h[Z.vertexIdx+2])??0)-m)*n,S=Math.sqrt(w*w+B*B+F*F);return new TG(T.s.Lerp(G.position,Z.position,n),T.s.Lerp(G.Bd,Z.Bd,n).normalize(),T.o.Lerp(G.uv,Z.uv,n),-1,-1,y?[r+(g-r)*n,v+(X-v)*n,q+(W-q)*n]:null,h?[w/S,B/S,F/S]:null,C,P)};let n=null;G.length>3&&(n=[]);for(let C=0;C<G.length;C+=3){let o=0,P=null,r=null,v=null,q=null;const g=T.s.Dot(G[C].position,D)-N>0,X=T.s.Dot(G[C+1].position,D)-N>0,W=T.s.Dot(G[C+2].position,D)-N>0;switch(o=(g?1:0)+(X?1:0)+(W?1:0),o){case 0:G.length>3?(n.push(G[C]),n.push(G[C+1]),n.push(G[C+2])):n=G;break;case 1:if(n=n??new Array,g&&(P=G[C+1],r=G[C+2],v=Z(G[C],P),q=Z(G[C],r)),X){P=G[C],r=G[C+2],v=Z(G[C+1],P),q=Z(G[C+1],r),n.push(v),n.push(r.clone()),n.push(P.clone()),n.push(r.clone()),n.push(v.clone()),n.push(q);break}W&&(P=G[C],r=G[C+1],v=Z(G[C+2],P),q=Z(G[C+2],r)),P&&r&&v&&q&&(n.push(P.clone()),n.push(r.clone()),n.push(v),n.push(q),n.push(v.clone()),n.push(r.clone()));break;case 2:n=n??new Array,g||(P=G[C].clone(),r=Z(P,G[C+1]),v=Z(P,G[C+2]),n.push(P),n.push(r),n.push(v)),X||(P=G[C+1].clone(),r=Z(P,G[C+2]),v=Z(P,G[C]),n.push(P),n.push(r),n.push(v)),W||(P=G[C+2].clone(),r=Z(P,G[C]),v=Z(P,G[C+1]),n.push(P),n.push(r),n.push(v))}}return n},K=D instanceof o.d?D:null,b=null===K||void 0===K?void 0:K._thinInstanceDataStorage.matrixData,O=(null===K||void 0===K?void 0:K.Oj)||1,Q=T.k.Matrix[0];Q.p(T.c.IdentityReadOnly);for(let o=0;o<O;++o){if(null!==K&&void 0!==K&&K.hasThinInstances&&b){const G=16*o;Q.setRowFromFloats(0,b[G+0],b[G+1],b[G+2],b[G+3]),Q.setRowFromFloats(1,b[G+4],b[G+5],b[G+6],b[G+7]),Q.setRowFromFloats(2,b[G+8],b[G+9],b[G+10],b[G+11]),Q.setRowFromFloats(3,b[G+12],b[G+13],b[G+14],b[G+15])}const G=T.c.RotationYawPitchRoll(z,J,U).multiply(T.c.Translation(F.x,F.y,F.z)),Z=T.c.Invert(G),n=D.getWorldMatrix(),P=Q.multiply(n).multiply(Z),r=new Array(3);for(let D=0;D<W.length;D+=3){let G=r;if(G[0]=H(D,P),G[1]=H(D+1,P),G[2]=H(D+2,P),!(N.cullBackFaces&&-G[0].Bd.z<=0&&-G[1].Bd.z<=0&&-G[2].Bd.z<=0)&&(G=c(G,M),G&&(G=c(G,e),G&&(G=c(G,f),G&&(G=c(G,GG),G&&(G=c(G,DG),G&&(G=c(G,NG),G)))))))for(let D=0;D<G.length;D++){const T=G[D];if(p.indices.push(t),X?(T.localPositionOverride?(p.xa[3*t]=T.localPositionOverride[0],p.xa[3*t+1]=T.localPositionOverride[1],p.xa[3*t+2]=T.localPositionOverride[2]):y&&(p.xa[3*t]=y[T.vertexIdx],p.xa[3*t+1]=y[T.vertexIdx+1],p.xa[3*t+2]=y[T.vertexIdx+2]),T.localNormalOverride?(p.ya[3*t]=T.localNormalOverride[0],p.ya[3*t+1]=T.localNormalOverride[1],p.ya[3*t+2]=T.localNormalOverride[2]):h&&(p.ya[3*t]=h[T.vertexIdx],p.ya[3*t+1]=h[T.vertexIdx+1],p.ya[3*t+2]=h[T.vertexIdx+2])):(T.position.toArray(p.xa,3*t),T.Bd.toArray(p.ya,3*t)),p.matricesIndices&&p.matricesWeights&&(T.matrixIndicesOverride?(p.matricesIndices[4*t]=T.matrixIndicesOverride[0],p.matricesIndices[4*t+1]=T.matrixIndicesOverride[1],p.matricesIndices[4*t+2]=T.matrixIndicesOverride[2],p.matricesIndices[4*t+3]=T.matrixIndicesOverride[3]):(R&&(p.matricesIndices[4*t]=R[T.vertexIdxForBones],p.matricesIndices[4*t+1]=R[T.vertexIdxForBones+1],p.matricesIndices[4*t+2]=R[T.vertexIdxForBones+2],p.matricesIndices[4*t+3]=R[T.vertexIdxForBones+3]),w&&p.matricesIndicesExtra&&(p.matricesIndicesExtra[4*t]=w[T.vertexIdxForBones],p.matricesIndicesExtra[4*t+1]=w[T.vertexIdxForBones+1],p.matricesIndicesExtra[4*t+2]=w[T.vertexIdxForBones+2],p.matricesIndicesExtra[4*t+3]=w[T.vertexIdxForBones+3])),T.matrixWeightsOverride?(p.matricesWeights[4*t]=T.matrixWeightsOverride[0],p.matricesWeights[4*t+1]=T.matrixWeightsOverride[1],p.matricesWeights[4*t+2]=T.matrixWeightsOverride[2],p.matricesWeights[4*t+3]=T.matrixWeightsOverride[3]):(L&&(p.matricesWeights[4*t]=L[T.vertexIdxForBones],p.matricesWeights[4*t+1]=L[T.vertexIdxForBones+1],p.matricesWeights[4*t+2]=L[T.vertexIdxForBones+2],p.matricesWeights[4*t+3]=L[T.vertexIdxForBones+3]),B&&p.matricesWeightsExtra&&(p.matricesWeightsExtra[4*t]=B[T.vertexIdxForBones],p.matricesWeightsExtra[4*t+1]=B[T.vertexIdxForBones+1],p.matricesWeightsExtra[4*t+2]=B[T.vertexIdxForBones+2],p.matricesWeightsExtra[4*t+3]=B[T.vertexIdxForBones+3]))),N.captureUVS)T.uv.toArray(p.Aa,2*t);else{p.Aa.push(.5+T.position.x/V.x);const G=.5+T.position.y/V.y;p.Aa.push(C.c?1-G:G)}t++}}}0===p.indices.length&&(p.indices=null),0===p.xa.length&&(p.xa=null),0===p.ya.length&&(p.ya=null),0===p.Aa.length&&(p.Aa=null),0===(null===(P=p.matricesIndices)||void 0===P?void 0:P.length)&&(p.matricesIndices=null),0===(null===(r=p.matricesWeights)||void 0===r?void 0:r.length)&&(p.matricesWeights=null),0===(null===(v=p.matricesIndicesExtra)||void 0===v?void 0:v.length)&&(p.matricesIndicesExtra=null),0===(null===(q=p.matricesWeightsExtra)||void 0===q?void 0:q.length)&&(p.matricesWeightsExtra=null);const A=new o.d(G,D.va());return p.Ca(A),X?(A.skeleton=D.skeleton,A.parent=D):(A.position=F.clone(),A.rotation=new T.s(J,z,U)),A.se(!0),A.refreshBoundingInfo(!0,!0),A}function ZG(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,Uk:16,height:1,i:.25,capSubdivisions:6};const D=0|Math.max(G.subdivisions?G.subdivisions:2,1),N=0|Math.max(G.Uk?G.Uk:16,3),o=Math.max(G.height?G.height:1,0),Z=Math.max(G.i?G.i:.25,0),P=0|Math.max(G.capSubdivisions?G.capSubdivisions:6,1),r=N,v=D,q=Math.max(G.radiusTop?G.radiusTop:Z,0),g=Math.max(G.radiusBottom?G.radiusBottom:Z,0),X=o-(q+g),W=2*Math.PI,j=Math.max(G.topCapSubdivisions?G.topCapSubdivisions:P,1),Y=Math.max(G.bottomCapSubdivisions?G.bottomCapSubdivisions:P,1),y=Math.acos((g-q)/o);let h=[];const m=[],R=[],L=[];let w=0;const B=[],F=.5*X,S=.5*Math.PI;let V,U;const z=T.s.Zero(),i=T.s.Zero(),J=Math.cos(y),p=Math.sin(y),t=new T.o(q*p,F+q*J).Jc(new T.o(g*p,g*J-F)).length(),H=q*y+t+g*(S-y);let s=0;for(U=0;U<=j;U++){const G=[],D=S-y*(U/j);s+=q*y/j;const N=Math.cos(D),T=Math.sin(D),o=N*q;for(V=0;V<=r;V++){const D=V/r,Z=D*W+0,n=Math.sin(Z),P=Math.cos(Z);i.x=o*n,i.y=F+T*q,i.z=o*P,m.push(i.x,i.y,i.z),z.set(N*n,T,N*P),R.push(z.x,z.y,z.z),L.push(D,C.c?s/H:1-s/H),G.push(w),w++}B.push(G)}const c=o-q-g+J*q-J*g,K=p*(g-q)/c;for(U=1;U<=v;U++){const G=[];s+=t/v;const D=p*(U*(g-q)/v+q);for(V=0;V<=r;V++){const N=V/r,T=N*W+0,o=Math.sin(T),Z=Math.cos(T);i.x=D*o,i.y=F+J*q-U*c/v,i.z=D*Z,m.push(i.x,i.y,i.z),z.set(o,K,Z).normalize(),R.push(z.x,z.y,z.z),L.push(N,C.c?s/H:1-s/H),G.push(w),w++}B.push(G)}for(U=1;U<=Y;U++){const G=[],D=S-y-(Math.PI-y)*(U/Y);s+=g*y/Y;const N=Math.cos(D),T=Math.sin(D),o=N*g;for(V=0;V<=r;V++){const D=V/r,Z=D*W+0,n=Math.sin(Z),P=Math.cos(Z);i.x=o*n,i.y=T*g-F,i.z=o*P,m.push(i.x,i.y,i.z),z.set(N*n,T,N*P),R.push(z.x,z.y,z.z),L.push(D,C.c?s/H:1-s/H),G.push(w),w++}B.push(G)}for(V=0;V<r;V++)for(U=0;U<j+v+Y;U++){const G=B[U][V],D=B[U+1][V],N=B[U+1][V+1],T=B[U][V+1];h.push(G),h.push(D),h.push(T),h.push(D),h.push(N),h.push(T)}if(h=h.reverse(),G.orientation&&!G.orientation.equals(T.s.Up())){const D=new T.c;G.orientation.clone().scale(.5*Math.PI).cross(T.s.Up()).toQuaternion().toRotationMatrix(D);const N=T.s.Zero();for(let G=0;G<m.length;G+=3)N.set(m[G],m[G+1],m[G+2]),T.s.TransformCoordinatesToRef(N.clone(),D,N),m[G]=N.x,m[G+1]=N.y,m[G+2]=N.z}const b=new n.c;return b.xa=m,b.ya=R,b.Aa=L,b.indices=h,b}function nG(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:T.s.Up(),subdivisions:2,Uk:16,height:1,i:.25,capSubdivisions:6,updatable:!1},N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new o.d(G,N);return ZG(D).Ca(Z,D.updatable),Z}o.d.CreateDecal=(G,D,N,T,o,Z)=>oG(G,D,{position:N,Bd:T,size:o,angle:Z});o.d.CreateCapsule=(G,D,N)=>nG(G,D,N),n.c.CreateCapsule=ZG;class CG{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=G,this.y=D,G!==Math.floor(G)&&(G=Math.floor(G),U.d.Warn("x is not an integer, floor(x) used")),D!==Math.floor(D)&&(D=Math.floor(D),U.d.Warn("y is not an integer, floor(y) used"))}clone(){return new CG(this.x,this.y)}rotate60About(G){const D=this.x;return this.x=G.x+G.y-this.y,this.y=D+this.y-G.x,this}rotateNeg60About(G){const D=this.x;return this.x=D+this.y-G.y,this.y=G.x+G.y-D,this}rotate120(G,D){G!==Math.floor(G)&&(G=Math.floor(G),U.d.Warn("m not an integer only floor(m) used")),D!==Math.floor(D)&&(D=Math.floor(D),U.d.Warn("n not an integer only floor(n) used"));const N=this.x;return this.x=G-N-this.y,this.y=D+N,this}rotateNeg120(G,D){G!==Math.floor(G)&&(G=Math.floor(G),U.d.Warn("m is not an integer, floor(m) used")),D!==Math.floor(D)&&(D=Math.floor(D),U.d.Warn("n is not an integer,   floor(n) used"));const N=this.x;return this.x=this.y-D,this.y=G+D-N-this.y,this}toCartesianOrigin(G,D){const N=T.s.Zero();return N.x=G.x+2*this.x*D+this.y*D,N.y=G.y+Math.sqrt(3)*this.y*D,N}static Zero(){return new CG(0,0)}}class PG{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new rG("icosahedron","Regular",[[0,i.g,-1],[-i.g,1,0],[-1,0,-i.g],[1,0,-i.g],[i.g,1,0],[0,i.g,1],[-1,0,i.g],[-i.g,-1,0],[0,-i.g,-1],[i.g,-1,0],[1,0,i.g],[0,-i.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let G=12;const D={},N=this.m,T=this.n;let o,Z,n,C,P,r=N,v=1,q=0;0!==T&&(r=(0,E.i)(N,T)),v=N/r,q=T/r;const g=CG.Zero(),X=new CG(N,T),W=new CG(-T,N+T),j=CG.Zero(),Y=CG.Zero(),y=CG.Zero();let h,m,R,L,w=[];const B=[],F=this.vertByDist,S=(N,T,o,Z)=>{h=N+"|"+o,m=T+"|"+Z,h in D||m in D?h in D&&!(m in D)?D[m]=D[h]:m in D&&!(h in D)&&(D[h]=D[m]):(D[h]=G,D[m]=G,G++),F[o][0]>2?B[D[h]]=[-F[o][0],F[o][1],D[h]]:B[D[h]]=[w[F[o][0]],F[o][1],D[h]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let V=0;V<20;V++){if(w=this.IDATA.face[V],n=w[2],C=w[1],P=w[0],R=g.x+"|"+g.y,h=V+"|"+R,h in D||(D[h]=n,B[n]=[w[F[R][0]],F[R][1]]),R=X.x+"|"+X.y,h=V+"|"+R,h in D||(D[h]=C,B[C]=[w[F[R][0]],F[R][1]]),R=W.x+"|"+W.y,h=V+"|"+R,h in D||(D[h]=P,B[P]=[w[F[R][0]],F[R][1]]),o=this.IDATA.edgematch[V][0],Z=this.IDATA.edgematch[V][1],"B"===Z)for(let G=1;G<r;G++)Y.x=N-G*(v+q),Y.y=T+G*v,y.x=-G*q,y.y=G*(v+q),R=Y.x+"|"+Y.y,L=y.x+"|"+y.y,S(V,o,R,L);if("O"===Z)for(let G=1;G<r;G++)y.x=-G*q,y.y=G*(v+q),j.x=G*v,j.y=G*q,R=y.x+"|"+y.y,L=j.x+"|"+j.y,S(V,o,R,L);if(o=this.IDATA.edgematch[V][2],Z=this.IDATA.edgematch[V][3],Z&&"A"===Z)for(let G=1;G<r;G++)j.x=G*v,j.y=G*q,Y.x=N-(r-G)*(v+q),Y.y=T+(r-G)*v,R=j.x+"|"+j.y,L=Y.x+"|"+Y.y,S(V,o,R,L);for(let N=0;N<this.vertices.length;N++)R=this.vertices[N].x+"|"+this.vertices[N].y,h=V+"|"+R,h in D||(D[h]=G++,F[R][0]>2?B[D[h]]=[-F[R][0],F[R][1],D[h]]:B[D[h]]=[w[F[R][0]],F[R][1],D[h]])}this.closestTo=B,this.vecToidx=D}calcCoeffs(){const G=this.m,D=this.n,N=Math.sqrt(3)/3,T=G*G+D*D+G*D;this.coau=(G+D)/T,this.cobu=-D/T,this.coav=-N*(G-D)/T,this.cobv=N*(2*G+D)/T}createInnerFacets(){const G=this.m,D=this.n;for(let N=0;N<D+G+1;N++)for(let G=this.min[N];G<this.max[N]+1;G++)G<this.max[N]&&G<this.max[N+1]+1&&this.innerFacets.push(["|"+G+"|"+N,"|"+G+"|"+(N+1),"|"+(G+1)+"|"+N]),N>0&&G<this.max[N-1]&&G+1<this.max[N]+1&&this.innerFacets.push(["|"+G+"|"+N,"|"+(G+1)+"|"+N,"|"+(G+1)+"|"+(N-1)])}edgeVecsABOB(){const G=this.m,D=this.n,N=new CG(-D,G+D);for(let T=1;T<G+D;T++){const G=new CG(this.min[T],T),D=new CG(this.min[T-1],T-1),o=new CG(this.min[T+1],T+1),Z=G.clone(),n=D.clone(),C=o.clone();Z.rotate60About(N),n.rotate60About(N),C.rotate60About(N);const P=new CG(this.max[Z.y],Z.y),r=new CG(this.max[Z.y-1],Z.y-1),v=new CG(this.max[Z.y-1]-1,Z.y-1);Z.x===P.x&&Z.y===P.y||(Z.x!==r.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([G,r,v]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([G,v,P])):Z.y===C.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([G,D,r]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([G,r,o])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([G,D,r]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([G,r,P])))}}mapABOBtoOBOA(){const G=new CG(0,0);for(let D=0;D<this.isoVecsABOB.length;D++){const N=[];for(let T=0;T<3;T++)G.x=this.isoVecsABOB[D][T].x,G.y=this.isoVecsABOB[D][T].y,0===this.vertexTypes[D][T]&&G.rotateNeg120(this.m,this.n),N.push(G.clone());this.isoVecsOBOA.push(N)}}mapABOBtoBAOA(){const G=new CG(0,0);for(let D=0;D<this.isoVecsABOB.length;D++){const N=[];for(let T=0;T<3;T++)G.x=this.isoVecsABOB[D][T].x,G.y=this.isoVecsABOB[D][T].y,1===this.vertexTypes[D][T]&&G.rotate120(this.m,this.n),N.push(G.clone());this.isoVecsBAOA.push(N)}}MapToFace(G,D){const N=this.IDATA.face[G],o=N[2],Z=N[1],n=N[0],C=T.s.od(this.IDATA.vertex[o]),P=T.s.od(this.IDATA.vertex[Z]),r=T.s.od(this.IDATA.vertex[n]),v=P.Jc(C),q=r.Jc(C),g=v.scale(this.coau).add(q.scale(this.cobu)),X=v.scale(this.coav).add(q.scale(this.cobv)),W=[];let j,Y=T.k.Ad[0];for(let T=0;T<this.cartesian.length;T++)Y=g.scale(this.cartesian[T].x).add(X.scale(this.cartesian[T].y)).add(C),W[T]=[Y.x,Y.y,Y.z],j=G+"|"+this.vertices[T].x+"|"+this.vertices[T].y,D.vertex[this.vecToidx[j]]=[Y.x,Y.y,Y.z]}build(G,D){const N=[],T=CG.Zero(),o=new CG(G,D),Z=new CG(-D,G+D);N.push(T,o,Z);for(let R=D;R<G+1;R++)for(let D=0;D<G+1-R;D++)N.push(new CG(D,R));if(D>0){const T=(0,E.i)(G,D),o=G/T,Z=D/T;for(let C=1;C<T;C++)N.push(new CG(C*o,C*Z)),N.push(new CG(-C*Z,C*(o+Z))),N.push(new CG(G-C*(o+Z),D+C*o));const n=G/D;for(let C=1;C<D;C++)for(let T=0;T<C*n;T++)N.push(new CG(T,C)),N.push(new CG(T,C).rotate120(G,D)),N.push(new CG(T,C).rotateNeg120(G,D))}N.sort(((G,D)=>G.x-D.x)),N.sort(((G,D)=>G.y-D.y));const n=new Array(G+D+1),C=new Array(G+D+1);for(let R=0;R<n.length;R++)n[R]=1/0,C[R]=-1/0;let P=0,r=0;const v=N.length;for(let R=0;R<v;R++)r=N[R].x,P=N[R].y,n[P]=Math.min(r,n[P]),C[P]=Math.max(r,C[P]);const q=(N,T)=>{const o=N.clone();return"A"===T&&o.rotateNeg120(G,D),"B"===T&&o.rotate120(G,D),o.x<0?o.y:o.x+o.y},g=[],X=[],W=[],j=[],Y={},y=[];let h=-1,m=-1;for(let R=0;R<v;R++)g[R]=N[R].toCartesianOrigin(new CG(0,0),.5),X[R]=q(N[R],"O"),W[R]=q(N[R],"A"),j[R]=q(N[R],"B"),X[R]===W[R]&&W[R]===j[R]?(h=3,m=X[R]):X[R]===W[R]?(h=4,m=X[R]):W[R]===j[R]?(h=5,m=W[R]):j[R]===X[R]&&(h=6,m=X[R]),X[R]<W[R]&&X[R]<j[R]&&(h=2,m=X[R]),W[R]<X[R]&&W[R]<j[R]&&(h=1,m=W[R]),j[R]<W[R]&&j[R]<X[R]&&(h=0,m=j[R]),y.push([h,m,N[R].x,N[R].y]);y.sort(((G,D)=>G[2]-D[2])),y.sort(((G,D)=>G[3]-D[3])),y.sort(((G,D)=>G[1]-D[1])),y.sort(((G,D)=>G[0]-D[0]));for(let R=0;R<y.length;R++)Y[y[R][2]+"|"+y[R][3]]=[y[R][0],y[R][1],R];return this.m=G,this.n=D,this.vertices=N,this.vertByDist=Y,this.cartesian=g,this.min=n,this.max=C,this}}class rG{constructor(G,D,N,T){this.name=G,this.category=D,this.vertex=N,this.face=T}}class vG extends rG{innerToData(G,D){for(let N=0;N<D.innerFacets.length;N++)this.face.push(D.innerFacets[N].map((N=>D.vecToidx[G+N])))}mapABOBtoDATA(G,D){const N=D.IDATA.edgematch[G][0];for(let T=0;T<D.isoVecsABOB.length;T++){const o=[];for(let Z=0;Z<3;Z++)0===D.vertexTypes[T][Z]?o.push(G+"|"+D.isoVecsABOB[T][Z].x+"|"+D.isoVecsABOB[T][Z].y):o.push(N+"|"+D.isoVecsABOB[T][Z].x+"|"+D.isoVecsABOB[T][Z].y);this.face.push([D.vecToidx[o[0]],D.vecToidx[o[1]],D.vecToidx[o[2]]])}}mapOBOAtoDATA(G,D){const N=D.IDATA.edgematch[G][0];for(let T=0;T<D.isoVecsOBOA.length;T++){const o=[];for(let Z=0;Z<3;Z++)1===D.vertexTypes[T][Z]?o.push(G+"|"+D.isoVecsOBOA[T][Z].x+"|"+D.isoVecsOBOA[T][Z].y):o.push(N+"|"+D.isoVecsOBOA[T][Z].x+"|"+D.isoVecsOBOA[T][Z].y);this.face.push([D.vecToidx[o[0]],D.vecToidx[o[1]],D.vecToidx[o[2]]])}}mapBAOAtoDATA(G,D){const N=D.IDATA.edgematch[G][2];for(let T=0;T<D.isoVecsBAOA.length;T++){const o=[];for(let Z=0;Z<3;Z++)1===D.vertexTypes[T][Z]?o.push(G+"|"+D.isoVecsBAOA[T][Z].x+"|"+D.isoVecsBAOA[T][Z].y):o.push(N+"|"+D.isoVecsBAOA[T][Z].x+"|"+D.isoVecsBAOA[T][Z].y);this.face.push([D.vecToidx[o[0]],D.vecToidx[o[1]],D.vecToidx[o[2]]])}}orderData(G){const D=[];for(let Z=0;Z<13;Z++)D[Z]=[];const N=G.closestTo;for(let Z=0;Z<N.length;Z++)N[Z][0]>-1?N[Z][1]>0&&D[N[Z][0]].push([Z,N[Z][1]]):D[12].push([Z,N[Z][0]]);const T=[];for(let Z=0;Z<12;Z++)T[Z]=Z;let o=12;for(let Z=0;Z<12;Z++){D[Z].sort(((G,D)=>G[1]-D[1]));for(let G=0;G<D[Z].length;G++)T[D[Z][G][0]]=o++}for(let Z=0;Z<D[12].length;Z++)T[D[12][Z][0]]=o++;for(let Z=0;Z<this.vertex.length;Z++)this.vertex[Z].push(T[Z]);this.vertex.sort(((G,D)=>G[3]-D[3]));for(let Z=0;Z<this.vertex.length;Z++)this.vertex[Z].pop();for(let Z=0;Z<this.face.length;Z++)for(let G=0;G<this.face[Z].length;G++)this.face[Z][G]=T[this.face[Z][G]];this.sharedNodes=D[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(G,D){const N=[],T=[];let o=D.pop();T.push(o);let Z=this.face[o].indexOf(G);Z=(Z+2)%3;let n=this.face[o][Z];N.push(n);let C=0;for(;D.length>0;)o=D[C],this.face[o].indexOf(n)>-1?(Z=(this.face[o].indexOf(n)+1)%3,n=this.face[o][Z],N.push(n),T.push(o),D.splice(C,1),C=0):C++;return this.adjacentFaces.push(N),T}toGoldbergPolyhedronData(){const G=new rG("GeoDual","Goldberg",[],[]);G.name="GD dual";const D=this.vertex.length,N=new Array(D);for(let P=0;P<D;P++)N[P]=[];for(let P=0;P<this.face.length;P++)for(let G=0;G<3;G++)N[this.face[P][G]].push(P);let T=0,o=0,Z=0,n=[],C=[];this.adjacentFaces=[];for(let P=0;P<N.length;P++)G.face[P]=this.setOrder(P,N[P].concat([])),N[P].forEach((D=>{T=0,o=0,Z=0,n=this.face[D];for(let G=0;G<3;G++)C=this.vertex[n[G]],T+=C[0],o+=C[1],Z+=C[2];G.vertex[D]=[T/3,o/3,Z/3]}));return G}static BuildGeodesicData(G){const D=new vG("Geodesic-m-n","Geodesic",[[0,i.g,-1],[-i.g,1,0],[-1,0,-i.g],[1,0,-i.g],[i.g,1,0],[0,i.g,1],[-1,0,i.g],[-i.g,-1,0],[0,-i.g,-1],[i.g,-1,0],[1,0,i.g],[0,-i.g,1]],[]);G.setIndices(),G.calcCoeffs(),G.createInnerFacets(),G.edgeVecsABOB(),G.mapABOBtoOBOA(),G.mapABOBtoBAOA();for(let N=0;N<G.IDATA.face.length;N++)G.MapToFace(N,D),D.innerToData(N,G),"B"===G.IDATA.edgematch[N][1]&&D.mapABOBtoDATA(N,G),"O"===G.IDATA.edgematch[N][1]&&D.mapOBOAtoDATA(N,G),"A"===G.IDATA.edgematch[N][3]&&D.mapBAOAtoDATA(N,G);D.orderData(G);return D.vertex=D.vertex.map((function(G){const D=G[0],N=G[1],T=G[2],o=Math.sqrt(D*D+N*N+T*T);return G[0]*=1/o,G[1]*=1/o,G[2]*=1/o,G})),D}}o.d._GoldbergMeshParser=(G,D)=>qG.Parse(G,D);class qG extends o.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(G,D){return void 0===D?(G>this.goldbergData.nbUnsharedFaces-1&&(U.d.Warn("Maximum number of unshared faces used"),G=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+G):(G>11&&(U.d.Warn("Last pole used"),G=11),D>this.goldbergData.nbFacesAtPole-1&&(U.d.Warn("Maximum number of faces at a pole used"),D=this.goldbergData.nbFacesAtPole-1),12+G*this.goldbergData.nbFacesAtPole+D)}_changeGoldbergFaceColors(G){for(let N=0;N<G.length;N++){const D=G[N][0],T=G[N][1],o=G[N][2];for(let G=D;G<T+1;G++)this.goldbergData.faceColors[G]=o}const D=[];for(let N=0;N<12;N++)for(let G=0;G<5;G++)D.push(this.goldbergData.faceColors[N].r,this.goldbergData.faceColors[N].g,this.goldbergData.faceColors[N].b,this.goldbergData.faceColors[N].a);for(let N=12;N<this.goldbergData.faceColors.length;N++)for(let G=0;G<6;G++)D.push(this.goldbergData.faceColors[N].r,this.goldbergData.faceColors[N].g,this.goldbergData.faceColors[N].b,this.goldbergData.faceColors[N].a);return D}setGoldbergFaceColors(G){const D=this._changeGoldbergFaceColors(G);this.Ga(Z.f.ColorKind,D)}updateGoldbergFaceColors(G){const D=this._changeGoldbergFaceColors(G);this.updateVerticesData(Z.f.ColorKind,D)}_changeGoldbergFaceUVs(G){const D=this.getVerticesData(Z.f.UVKind);for(let N=0;N<G.length;N++){const T=G[N][0],o=G[N][1],Z=G[N][2],n=G[N][3],C=G[N][4],P=[],r=[];let v,q;for(let G=0;G<5;G++)v=Z.x+n*Math.cos(C+G*Math.PI/2.5),q=Z.y+n*Math.sin(C+G*Math.PI/2.5),v<0&&(v=0),v>1&&(v=1),P.push(v,q);for(let G=0;G<6;G++)v=Z.x+n*Math.cos(C+G*Math.PI/3),q=Z.y+n*Math.sin(C+G*Math.PI/3),v<0&&(v=0),v>1&&(v=1),r.push(v,q);for(let G=T;G<Math.min(12,o+1);G++)for(let N=0;N<5;N++)D[10*G+2*N]=P[2*N],D[10*G+2*N+1]=P[2*N+1];for(let G=Math.max(12,T);G<o+1;G++)for(let N=0;N<6;N++)D[12*G-24+2*N]=r[2*N],D[12*G-23+2*N]=r[2*N+1]}return D}setGoldbergFaceUVs(G){const D=this._changeGoldbergFaceUVs(G);this.Ga(Z.f.UVKind,D)}updateGoldbergFaceUVs(G){const D=this._changeGoldbergFaceUVs(G);this.updateVerticesData(Z.f.UVKind,D)}placeOnGoldbergFaceAt(G,D,N){const o=T.s.RotationFromAxis(this.goldbergData.faceXaxis[D],this.goldbergData.faceYaxis[D],this.goldbergData.faceZaxis[D]);G.rotation=o,G.position=this.goldbergData.faceCenters[D].add(this.goldbergData.faceXaxis[D].scale(N.x)).add(this.goldbergData.faceYaxis[D].scale(N.y)).add(this.goldbergData.faceZaxis[D].scale(N.z))}serialize(G){super.serialize(G),G.type="GoldbergMesh";const D={};if(D.adjacentFaces=this.goldbergData.adjacentFaces,D.nbSharedFaces=this.goldbergData.nbSharedFaces,D.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,D.nbFaces=this.goldbergData.nbFaces,D.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){D.faceColors=[];for(const G of this.goldbergData.faceColors)D.faceColors.push(G.vd())}if(this.goldbergData.faceCenters){D.faceCenters=[];for(const G of this.goldbergData.faceCenters)D.faceCenters.push(G.vd())}if(this.goldbergData.faceZaxis){D.faceZaxis=[];for(const G of this.goldbergData.faceZaxis)D.faceZaxis.push(G.vd())}if(this.goldbergData.faceYaxis){D.faceYaxis=[];for(const G of this.goldbergData.faceYaxis)D.faceYaxis.push(G.vd())}if(this.goldbergData.faceXaxis){D.faceXaxis=[];for(const G of this.goldbergData.faceXaxis)D.faceXaxis.push(G.vd())}G.goldbergData=D}static Parse(G,D){const N=G.goldbergData;N.faceColors=N.faceColors.map((G=>g.g.od(G))),N.faceCenters=N.faceCenters.map((G=>T.s.od(G))),N.faceZaxis=N.faceZaxis.map((G=>T.s.od(G))),N.faceXaxis=N.faceXaxis.map((G=>T.s.od(G))),N.faceYaxis=N.faceYaxis.map((G=>T.s.od(G)));const o=new qG(G.name,D);return o.goldbergData=N,o}}var gG=N(11437);class XG{constructor(G){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=G}moveTo(G,D){this._currentPath=new z.i(G,D),this._tempPaths.push(this._currentPath)}lineTo(G,D){this._currentPath.addLineTo(G,D)}quadraticCurveTo(G,D,N,T){this._currentPath.addQuadraticCurveTo(G,D,N,T,this._resolution)}bezierCurveTo(G,D,N,T,o,Z){this._currentPath.addBezierCurveTo(G,D,N,T,o,Z,this._resolution)}extractHoles(){for(const G of this._tempPaths)G.area()>0?this._holes.push(G):this._paths.push(G);if(!this._paths.length&&this._holes.length){const G=this._holes;this._holes=this._paths,this._paths=G}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function WG(G,D,N,T,o,Z){const n=Z.glyphs[G]||Z.glyphs["?"];if(!n)return null;const C=new XG(o);if(n.o){const G=n.o.split(" ");for(let o=0,Z=G.length;o<Z;){switch(G[o++]){case"m":{const Z=parseInt(G[o++])*D+N,n=parseInt(G[o++])*D+T;C.moveTo(Z,n);break}case"l":{const Z=parseInt(G[o++])*D+N,n=parseInt(G[o++])*D+T;C.lineTo(Z,n);break}case"q":{const Z=parseInt(G[o++])*D+N,n=parseInt(G[o++])*D+T,P=parseInt(G[o++])*D+N,r=parseInt(G[o++])*D+T;C.quadraticCurveTo(P,r,Z,n);break}case"b":{const Z=parseInt(G[o++])*D+N,n=parseInt(G[o++])*D+T,P=parseInt(G[o++])*D+N,r=parseInt(G[o++])*D+T,v=parseInt(G[o++])*D+N,q=parseInt(G[o++])*D+T;C.bezierCurveTo(P,r,v,q,Z,n);break}}}}return C.extractHoles(),{offsetX:n.ha*D,shapePath:C}}const jG={CreateBox:q.g,CreateTiledBox:Y,CreateSphere:y.d,kb:v.e,CreateIcoSphere:a,CreateRibbon:r,CreateCylinder:L,CreateTorus:B,CreateTorusKnot:S,CreateLineSystem:V.f,lb:V.g,CreateDashedLines:V.c,ExtrudeShape:b,ExtrudeShapeCustom:O,CreateLathe:A,CreateTiledPlane:W,Mg:I.c,CreateGround:d.g,CreateTiledGround:d.k,CreateGroundFromHeightMap:d.d,CreatePolygon:c,ExtrudePolygon:K,CreateTube:u,CreatePolyhedron:x,CreateGeodesic:function(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,T=D.m||1;T!==Math.floor(T)&&(T=Math.floor(T),U.d.Warn("m not an integer only floor(m) used"));let o=D.n||0;if(o!==Math.floor(o)&&(o=Math.floor(o),U.d.Warn("n not an integer only floor(n) used")),o>T){const G=o;o=T,T=G,U.d.Warn("n > m therefore m and n swapped")}const Z=new PG;return Z.build(T,o),x(G,{custom:vG.BuildGeodesicData(Z),size:D.size,sizeX:D.sizeX,sizeY:D.sizeY,sizeZ:D.sizeZ,faceUV:D.faceUV,faceColors:D.faceColors,flat:D.flat,updatable:D.updatable,sideOrientation:D.sideOrientation,frontUVs:D.frontUVs,backUVs:D.backUVs},N)},CreateGoldberg:function(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=D.size,P=D.sizeX||Z||1,r=D.sizeY||Z||1,v=D.sizeZ||Z||1;let q=D.m||1;q!==Math.floor(q)&&(q=Math.floor(q),U.d.Warn("m not an integer only floor(m) used"));let X=D.n||0;if(X!==Math.floor(X)&&(X=Math.floor(X),U.d.Warn("n not an integer only floor(n) used")),X>q){const G=X;X=q,q=G,U.d.Warn("n > m therefore m and n swapped")}const W=new PG;W.build(q,X);const j=vG.BuildGeodesicData(W),Y=j.toGoldbergPolyhedronData(),y=new qG(G,N);D.sideOrientation=o.d._GetDefaultSideOrientation(D.sideOrientation),y._originalBuilderSideOrientation=D.sideOrientation;(function(G,D){const N=G.size,o=G.sizeX||N||1,Z=G.sizeY||N||1,P=G.sizeZ||N||1,r=0===G.sideOrientation?0:G.sideOrientation||n.c.DEFAULTSIDE,v=[],q=[],g=[],X=[];let W=1/0,j=-1/0,Y=1/0,y=-1/0;for(let T=0;T<D.vertex.length;T++)W=Math.min(W,D.vertex[T][0]*o),j=Math.max(j,D.vertex[T][0]*o),Y=Math.min(Y,D.vertex[T][1]*Z),y=Math.max(y,D.vertex[T][1]*Z);let h=0;for(let n=0;n<D.face.length;n++){const G=D.face[n],N=T.s.od(D.vertex[G[0]]),r=T.s.od(D.vertex[G[2]]),m=T.s.od(D.vertex[G[1]]),R=r.Jc(N),L=m.Jc(N),w=T.s.Cross(L,R).normalize();for(let T=0;T<G.length;T++){g.push(w.x,w.y,w.z);const N=D.vertex[G[T]];v.push(N[0]*o,N[1]*Z,N[2]*P);const n=(N[1]*Z-Y)/(y-Y);X.push((N[0]*o-W)/(j-W),C.c?1-n:n)}for(let D=0;D<G.length-2;D++)q.push(h,h+D+2,h+D+1);h+=G.length}n.c._ComputeSides(r,v,q,g,X);const m=new n.c;return m.xa=v,m.indices=q,m.ya=g,m.Aa=X,m})(D,Y).Ca(y,D.updatable),y.goldbergData.nbSharedFaces=j.sharedNodes,y.goldbergData.nbUnsharedFaces=j.poleNodes,y.goldbergData.adjacentFaces=j.adjacentFaces,y.goldbergData.nbFaces=y.goldbergData.nbSharedFaces+y.goldbergData.nbUnsharedFaces,y.goldbergData.nbFacesAtPole=(y.goldbergData.nbUnsharedFaces-12)/12;for(let o=0;o<j.vertex.length;o++)y.goldbergData.faceCenters.push(T.s.od(j.vertex[o])),y.goldbergData.faceCenters[o].x*=P,y.goldbergData.faceCenters[o].y*=r,y.goldbergData.faceCenters[o].z*=v,y.goldbergData.faceColors.push(new g.g(1,1,1,1));for(let o=0;o<Y.face.length;o++){const G=Y.face[o],D=T.s.od(Y.vertex[G[0]]),N=T.s.od(Y.vertex[G[2]]),Z=T.s.od(Y.vertex[G[1]]),n=N.Jc(D),C=Z.Jc(D),P=T.s.Cross(C,n).normalize(),r=T.s.Cross(C,P).normalize();y.goldbergData.faceXaxis.push(C.normalize()),y.goldbergData.faceYaxis.push(P),y.goldbergData.faceZaxis.push(r)}return y},CreateDecal:oG,CreateCapsule:nG,CreateText:function(G,D,N){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const P=function(G,D,N,T){const o=Array.from(G),Z=D/T.resolution,n=(T.boundingBox.yMax-T.boundingBox.yMin+T.underlineThickness)*Z,C=[];let P=0,r=0;for(let v=0;v<o.length;v++){const G=o[v];if("\n"===G)P=0,r-=n;else{const D=WG(G,Z,P,r,N,T);D&&(P+=D.offsetX,C.push(D.shapePath))}}return C}(D,Z.size||50,Z.resolution||8,N),r=[];let v=0;for(const W of P){if(!W.paths.length)continue;const D=W.holes.slice();for(const N of W.paths){var q,g;const P=[],X=[],W=N.getPoints();for(const G of W)X.push(new T.s(G.x,0,G.y));const j=D.slice();for(const G of j){const o=G.getPoints();let Z=!1;for(const G of o)if(N.isPointInside(G)){Z=!0;break}if(!Z)continue;const n=[];for(const G of o)n.push(new T.s(G.x,0,G.y));P.push(n),D.splice(D.indexOf(G),1)}if(!P.length&&D.length)for(const G of D){const D=G.getPoints(),N=[];for(const G of D)N.push(new T.s(G.x,0,G.y));P.push(N)}const Y=K(G,{shape:X,holes:P.length?P:void 0,depth:Z.depth||1,faceUV:Z.faceUV||(null===(q=Z.perLetterFaceUV)||void 0===q?void 0:q.call(Z,v)),faceColors:Z.faceColors||(null===(g=Z.perLetterFaceColors)||void 0===g?void 0:g.call(Z,v)),sideOrientation:o.d._GetDefaultSideOrientation(Z.sideOrientation||o.d.DOUBLESIDE)},n,C);r.push(Y),v++}}const X=o.d.MergeMeshes(r,!0,!0);if(X){const D=X.getBoundingInfo().boundingBox;X.position.x+=-(D.minimumWorld.x+D.maximumWorld.x)/2,X.position.y+=-(D.minimumWorld.y+D.maximumWorld.y)/2,X.position.z+=-(D.minimumWorld.z+D.maximumWorld.z)/2+D.extendSize.z,X.name=G;const N=new gG.e("pivot",n);N.rotation.x=-Math.PI/2,X.parent=N,X.bakeCurrentTransformIntoVertices(),X.parent=null,N.dispose()}return X}}},11772:(G,D,N)=>{"use strict";var T=N(11378),o=N(1255),Z=N(1009),n=N(1105),C=N(1347);T.d.prototype.thinInstanceAdd=function(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return n.d.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(G)?G.length:1);const N=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(G))for(let T=0;T<G.length;++T)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,G[T],T===G.length-1&&D);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,G,D);return N},T.d.prototype.thinInstanceAddSelf=function(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(Z.c.IdentityReadOnly,G)},T.d.prototype.thinInstanceRegisterAttribute=function(G,D){G===o.f.ColorKind&&(G=o.f.ColorInstanceKind),this.removeVerticesData(G),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[G]=D,this._userThinInstanceBuffersStorage.sizes[G]=D*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[G]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[G]),this._userThinInstanceBuffersStorage.vertexBuffers[G]=new o.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[G],G,!0,!1,D,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[G])},T.d.prototype.thinInstanceSetMatrixAt=function(G,D){let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||G>=this._thinInstanceDataStorage.instancesCount)return!1;const T=this._thinInstanceDataStorage.matrixData;return D.copyToArray(T,16*G),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[G]=D),N&&(this.Rj("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},T.d.prototype.thinInstanceSetAttributeAt=function(G,D,N){let T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return G===o.f.ColorKind&&(G=o.f.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[G]||D>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(G,0),this._userThinInstanceBuffersStorage.data[G].set(N,D*this._userThinInstanceBuffersStorage.strides[G]),T&&this.Rj(G),!0)},Object.defineProperty(T.d.prototype,"Oj",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(G){var D;const N=this._thinInstanceDataStorage.matrixData??(null===(D=this.source)||void 0===D?void 0:D._thinInstanceDataStorage.matrixData);G<=(N?N.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=G)},enumerable:!0,configurable:!0}),T.d.prototype._thinInstanceCreateMatrixBuffer=function(G,D){let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const T=new o.c(this.getEngine(),D,!N,16,!1,!0);for(let o=0;o<4;o++)this.setVerticesBuffer(T.createVertexBuffer(G+o,4*o,4));return T},T.d.prototype.Sj=function(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var Z;if(N=N||16,"matrix"===G)null===(Z=this._thinInstanceDataStorage.matrixBuffer)||void 0===Z||Z.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=D?D.length:32*N,this._thinInstanceDataStorage.matrixData=D,this._thinInstanceDataStorage.worldMatrices=null,null!==D?(this._thinInstanceDataStorage.instancesCount=D.length/N,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",D,T),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===G){var n;null===(n=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===n||n.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=D,null!==D&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",D,T))}else{var C;if(G===o.f.ColorKind&&(G=o.f.ColorInstanceKind),null===D)null!==(C=this._userThinInstanceBuffersStorage)&&void 0!==C&&C.data[G]&&(this.removeVerticesData(G),delete this._userThinInstanceBuffersStorage.data[G],delete this._userThinInstanceBuffersStorage.strides[G],delete this._userThinInstanceBuffersStorage.sizes[G],delete this._userThinInstanceBuffersStorage.vertexBuffers[G]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[G]=D,this._userThinInstanceBuffersStorage.strides[G]=N,this._userThinInstanceBuffersStorage.sizes[G]=D.length,this._userThinInstanceBuffersStorage.vertexBuffers[G]=new o.f(this.getEngine(),D,G,!T,!1,N,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[G])}},T.d.prototype.Rj=function(G){var D;if("matrix"===G)this.Nj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(G),null===(D=this._thinInstanceDataStorage.matrixBuffer)||void 0===D||D.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===G){var N;this.Nj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(G),null===(N=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===N||N.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var T;G===o.f.ColorKind&&(G=o.f.ColorInstanceKind),null!==(T=this._userThinInstanceBuffersStorage)&&void 0!==T&&T.vertexBuffers[G]&&(this.Nj&&!this._userThinInstanceBuffersStorage.vertexBuffers[G].isUpdatable()&&this._thinInstanceRecreateBuffer(G),this._userThinInstanceBuffersStorage.vertexBuffers[G].updateDirectly(this._userThinInstanceBuffersStorage.data[G],0))}},T.d.prototype.thinInstancePartialBufferUpdate=function(G,D,N){var T;"matrix"===G?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(D,N):(G===o.f.ColorKind&&(G=o.f.ColorInstanceKind),null!==(T=this._userThinInstanceBuffersStorage)&&void 0!==T&&T.vertexBuffers[G]&&this._userThinInstanceBuffersStorage.vertexBuffers[G].updateDirectly(D,N))},T.d.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const G=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let D=0;D<this._thinInstanceDataStorage.instancesCount;++D)this._thinInstanceDataStorage.worldMatrices[D]=Z.c.od(G,16*D)}return this._thinInstanceDataStorage.worldMatrices},T.d.prototype.thinInstanceRefreshBoundingInfo=function(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const T=this._thinInstanceDataStorage.boundingVectors;if(G||!this.rawBoundingInfo){T.length=0,this.refreshBoundingInfo(D,N);const G=this.getBoundingInfo();this.rawBoundingInfo=new C.e(G.minimum,G.maximum)}const o=this.getBoundingInfo(),n=this._thinInstanceDataStorage.matrixData;if(0===T.length)for(let Z=0;Z<o.boundingBox.vectors.length;++Z)T.push(o.boundingBox.vectors[Z].clone());Z.k.Ad[0].zd(Number.POSITIVE_INFINITY),Z.k.Ad[1].zd(Number.NEGATIVE_INFINITY);for(let C=0;C<this._thinInstanceDataStorage.instancesCount;++C){Z.c.FromArrayToRef(n,16*C,Z.k.Matrix[0]);for(let G=0;G<T.length;++G)Z.s.TransformCoordinatesToRef(T[G],Z.k.Matrix[0],Z.k.Ad[2]),Z.k.Ad[0].minimizeInPlace(Z.k.Ad[2]),Z.k.Ad[1].maximizeInPlace(Z.k.Ad[2])}o.reConstruct(Z.k.Ad[0],Z.k.Ad[1]),this.Ea()},T.d.prototype._thinInstanceRecreateBuffer=function(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var N;if("matrix"===G)null===(N=this._thinInstanceDataStorage.matrixBuffer)||void 0===N||N.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,D);else if("previousMatrix"===G){var T;if(this._scene.needsPreviousWorldMatrices)null===(T=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===T||T.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,D)}else{var Z;G===o.f.ColorKind&&(G=o.f.ColorInstanceKind),null===(Z=this._userThinInstanceBuffersStorage.vertexBuffers[G])||void 0===Z||Z.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[G]=new o.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[G],G,!D,!1,this._userThinInstanceBuffersStorage.strides[G],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[G])}},T.d.prototype._thinInstanceUpdateBufferSize=function(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;G===o.f.ColorKind&&(G=o.f.ColorInstanceKind);const N="matrix"===G;if(!N&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[G]))return;const T=N?16:this._userThinInstanceBuffersStorage.strides[G],Z=N?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[G];let n=N?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[G];const C=(this._thinInstanceDataStorage.instancesCount+D)*T;let P=Z;for(;P<C;)P*=2;if(!n||Z!=P){if(n){const G=new Float32Array(P);G.set(n,0),n=G}else n=new Float32Array(P);var r,v,q;if(N){if(null===(r=this._thinInstanceDataStorage.matrixBuffer)||void 0===r||r.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",n,!1),this._thinInstanceDataStorage.matrixData=n,this._thinInstanceDataStorage.matrixBufferSize=P,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(v=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===v||v.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",n,!1)}else null===(q=this._userThinInstanceBuffersStorage.vertexBuffers[G])||void 0===q||q.dispose(),this._userThinInstanceBuffersStorage.data[G]=n,this._userThinInstanceBuffersStorage.sizes[G]=P,this._userThinInstanceBuffersStorage.vertexBuffers[G]=new o.f(this.getEngine(),n,G,!0,!1,T,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[G])}},T.d.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},T.d.prototype._disposeThinInstanceSpecificData=function(){var G;null!==(G=this._thinInstanceDataStorage)&&void 0!==G&&G.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11437:(G,D,N)=>{"use strict";N.d(D,{e:()=>q});var T=N(980),o=N(985),Z=N(1181),n=N(1003),C=N(1009),P=N(11399),r=N(1018);const v=C.c.Compose(C.s.One(),C.g.FromEulerAngles(0,Math.PI,0),C.s.Zero());class q extends P.b{get billboardMode(){return this._billboardMode}set billboardMode(G){this._billboardMode!==G&&(this._billboardMode=G,this._cache.useBillboardPosition=0!==(this._billboardMode&q.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(G){G!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=G,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==q.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(G){this._infiniteDistance!==G&&(this._infiniteDistance=G)}constructor(G){let D=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(G,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new C.s(0,0,1),this._up=new C.s(0,1,0),this._right=new C.s(1,0,0),this._position=C.s.Zero(),this._rotation=C.s.Zero(),this._rotationQuaternion=null,this._scaling=C.s.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=q.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Qj=C.c.Zero(),this._usePivotMatrix=!1,this._absolutePosition=C.s.Zero(),this._absoluteScaling=C.s.Zero(),this._absoluteRotationQuaternion=C.g.Identity(),this._pivotMatrix=C.c.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new n.b,this._nonUniformScaling=!1,D&&this.va().addTransformNode(this)}getClassName(){return"mb"}get position(){return this._position}set position(G){this._position=G,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(G){this._rotation=G,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Ed(){return this._scaling}set Ed(G){this._scaling=G,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(G){this._rotationQuaternion=G,G&&this._rotation.zd(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return C.s.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return C.s.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return C.s.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(G){return this._poseMatrix?(this._poseMatrix.p(G),this):(this._poseMatrix=G.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=C.c.Identity()),this._poseMatrix}_isSynchronized(){const G=this._cache;return this._billboardMode===G.billboardMode&&this._billboardMode===q.BILLBOARDMODE_NONE&&(!G.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const G=this._cache;G.localMatrixUpdated=!1,G.billboardMode=-1,G.infiniteDistance=!1,G.useBillboardPosition=!1,G.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(G){return this.setPivotMatrix(G,!1)}setPivotMatrix(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(G),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=D,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=C.c.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,D=arguments.length>1?arguments[1]:void 0,N=arguments.length>2?arguments[2]:void 0;const T=this.clone("Clone of "+(this.name||this.id),G||this.parent,!0);T&&N&&N(this,T);for(const o of this.getChildTransformNodes(!0))o.instantiateHierarchy(T,D,N);return T}ei(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return G?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.zd(0),this._rotationQuaternion=this._rotationQuaternion||C.g.Identity(),G.decompose(this._scaling,this._rotationQuaternion,this._position),this.se(!0)):(this._worldMatrix=G,this._absolutePosition.xd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.se(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.se(!0),this}get tj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.se(),this._absolutePosition}setAbsolutePosition(G){if(!G)return this;let D,N,T;if(void 0===G.x){if(arguments.length<3)return this;D=arguments[0],N=arguments[1],T=arguments[2]}else D=G.x,N=G.y,T=G.z;if(this.parent){const G=C.k.Matrix[0];this.parent.getWorldMatrix().invertToRef(G),C.s.TransformCoordinatesFromFloatsToRef(D,N,T,G,this.position)}else this.position.x=D,this.position.y=N,this.position.z=T;return this._absolutePosition.p(G),this}setPositionWithLocalVector(G){return this.se(),this.position=C.s.TransformNormal(G,this.Qj),this}getPositionExpressedInLocalSpace(){this.se();const G=C.k.Matrix[0];return this.Qj.invertToRef(G),C.s.TransformNormal(this.position,G)}locallyTranslate(G){return this.se(!0),this.position=C.s.TransformCoordinates(G,this.Qj),this}lookAt(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const Z=q._LookAtVectorCache,n=0===o?this.position:this.getAbsolutePosition();if(G.subtractToRef(n,Z),this.setDirection(Z,D,N,T),1===o&&this.parent)if(this.rotationQuaternion){const G=C.k.Matrix[0];this.rotationQuaternion.toRotationMatrix(G);const D=C.k.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(D),D.invert(),G.multiplyToRef(D,G),this.rotationQuaternion.fromRotationMatrix(G)}else{const G=C.k.Quaternion[0];C.g.FromEulerVectorToRef(this.rotation,G);const D=C.k.Matrix[0];G.toRotationMatrix(D);const N=C.k.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(N),N.invert(),D.multiplyToRef(N,D),G.fromRotationMatrix(D),G.toEulerAnglesToRef(this.rotation)}return this}te(G){const D=C.s.Zero();return this.getDirectionToRef(G,D),D}getDirectionToRef(G,D){return C.s.TransformNormalToRef(G,this.getWorldMatrix(),D),this}setDirection(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=-Math.atan2(G.z,G.x)+Math.PI/2,Z=Math.sqrt(G.x*G.x+G.z*G.z),n=-Math.atan2(G.y,Z);return this.rotationQuaternion?C.g.RotationYawPitchRollToRef(o+D,n+N,T,this.rotationQuaternion):(this.rotation.x=n+N,this.rotation.y=o+D,this.rotation.z=T),this}setPivotPoint(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.se(!0);const N=this.getWorldMatrix();if(1==D){const D=C.k.Matrix[0];N.invertToRef(D),G=C.s.TransformCoordinates(G,D)}return this.setPivotMatrix(C.c.Translation(-G.x,-G.y,-G.z),!0)}getPivotPoint(){const G=C.s.Zero();return this.getPivotPointToRef(G),G}getPivotPointToRef(G){return G.x=-this._pivotMatrix.m[12],G.y=-this._pivotMatrix.m[13],G.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const G=C.s.Zero();return this.getAbsolutePivotPointToRef(G),G}getAbsolutePivotPointToRef(G){return this.getPivotPointToRef(G),C.s.TransformCoordinatesToRef(G,this.getWorldMatrix(),G),this}we(G){if(this._isDirty)return this;if(this._children)for(const D of this._children)D.we(G);return super.we(G)}setParent(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!G&&!this.parent)return this;const T=C.k.Quaternion[0],o=C.k.Ad[0],Z=C.k.Ad[1],n=C.k.Matrix[1];C.c.IdentityToRef(n);const P=C.k.Matrix[0];this.se(!0);let r=this.rotationQuaternion;return r||(r=q._TmpRotation,C.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,r)),C.c.ComposeToRef(this.Ed,r,this.position,P),this.parent&&P.multiplyToRef(this.parent.se(!0),P),G&&(G.se(!0).invertToRef(n),P.multiplyToRef(n,P)),P.decompose(Z,T,o,D?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(T):T.toEulerAnglesToRef(this.rotation),this.Ed.p(Z),this.position.p(o),this.parent=G,N&&this.setPivotMatrix(C.c.Identity()),this}addChild(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return G.setParent(this,D),this}removeChild(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return G.setParent(null,D),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(G){return this._nonUniformScaling!==G&&(this._nonUniformScaling=G,!0)}attachToBone(G,D){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=D,this.parent=G,G.getSkeleton().prepare(!0),G.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=G?this._currentParentWhenAttachingToBone:null,this):(G&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(G,D,N){let T;if(G.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.zd(0)),N&&0!==N){if(this.parent){const N=this.parent.getWorldMatrix(),T=C.k.Matrix[0];N.invertToRef(T),G=C.s.TransformNormal(G,T),N.determinant()<0&&(D*=-1)}T=C.g.RotationAxisToRef(G,D,q._RotationAxisCache),T.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else T=C.g.RotationAxisToRef(G,D,q._RotationAxisCache),this.rotationQuaternion.multiplyToRef(T,this.rotationQuaternion);return this}rotateAround(G,D,N){D.normalize(),this.rotationQuaternion||(this.rotationQuaternion=C.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.zd(0));const T=C.k.Ad[0],o=C.k.Ad[1],Z=C.k.Ad[2],n=C.k.Quaternion[0],P=C.k.Matrix[0],r=C.k.Matrix[1],v=C.k.Matrix[2],q=C.k.Matrix[3];return G.subtractToRef(this.position,T),C.c.TranslationToRef(T.x,T.y,T.z,P),C.c.TranslationToRef(-T.x,-T.y,-T.z,r),C.c.RotationAxisToRef(D,N,v),r.multiplyToRef(v,q),q.multiplyToRef(P,q),q.decompose(o,n,Z),this.position.addInPlace(Z),n.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(G,D,N){const T=G.scale(D);if(N&&0!==N)this.setAbsolutePosition(this.getAbsolutePosition().add(T));else{const G=this.getPositionExpressedInLocalSpace().add(T);this.setPositionWithLocalVector(G)}return this}addRotation(G,D,N){let T;this.rotationQuaternion?T=this.rotationQuaternion:(T=C.k.Quaternion[1],C.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,T));const o=C.k.Quaternion[0];return C.g.RotationYawPitchRollToRef(D,G,N,o),T.multiplyInPlace(o),this.rotationQuaternion||T.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==q.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}se(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const N=this.va().getRenderId();if(!this._isDirty&&!G&&(this._currentRenderId===N||this.isSynchronized()))return this._currentRenderId=N,this._worldMatrix;D=D||this.va().activeCamera,this._updateCache();const T=this._cache;T.pivotMatrixUpdated=!1,T.billboardMode=this.billboardMode,T.infiniteDistance=this.infiniteDistance,T.parent=this._parentNode,this._currentRenderId=N,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const o=this._getEffectiveParent(),Z=q._TmpScaling;let n,P=this._position;if(this._infiniteDistance&&!this.parent&&D){const G=D.getWorldMatrix(),N=new C.s(G.m[12],G.m[13],G.m[14]);P=q._TmpTranslation,P.xd(this._position.x+N.x,this._position.y+N.y,this._position.z+N.z)}if(Z.xd(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,n=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(C.g.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.xd(0,0,0))}}else n=q._TmpRotation,C.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,n);if(this._usePivotMatrix){const G=C.k.Matrix[1];C.c.ScalingToRef(Z.x,Z.y,Z.z,G);const D=C.k.Matrix[0];n.toRotationMatrix(D),this._pivotMatrix.multiplyToRef(G,C.k.Matrix[4]),C.k.Matrix[4].multiplyToRef(D,this.Qj),this._postMultiplyPivotMatrix&&this.Qj.multiplyToRef(this._pivotMatrixInverse,this.Qj),this.Qj.addTranslationFromFloats(P.x,P.y,P.z)}else C.c.ComposeToRef(Z,n,P,this.Qj);if(o&&o.getWorldMatrix){if(G&&o.se(G),T.useBillboardPath){if(this._transformToBoneReferal){const G=this.parent;G.getSkeleton().prepare(),G.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),C.k.Matrix[7])}else C.k.Matrix[7].p(o.getWorldMatrix());const G=C.k.Ad[5],D=C.k.Ad[6],N=C.k.Quaternion[0];C.k.Matrix[7].decompose(D,N,G),C.c.ScalingToRef(D.x,D.y,D.z,C.k.Matrix[7]),C.k.Matrix[7].setTranslation(G),q.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(N,G),this.Qj.setTranslation(G)),this.Qj.multiplyToRef(C.k.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const G=this.parent;G.getSkeleton().prepare(),this.Qj.multiplyToRef(G.getFinalMatrix(),C.k.Matrix[6]),C.k.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Qj.multiplyToRef(o.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Qj);if(T.useBillboardPath&&D&&this.billboardMode&&!T.useBillboardPosition){const G=C.k.Ad[0];if(this._worldMatrix.getTranslationToRef(G),C.k.Matrix[1].p(D.getViewMatrix()),this._scene.useRightHandedSystem&&C.k.Matrix[1].multiplyToRef(v,C.k.Matrix[1]),C.k.Matrix[1].setTranslationFromFloats(0,0,0),C.k.Matrix[1].invertToRef(C.k.Matrix[0]),(this.billboardMode&q.BILLBOARDMODE_ALL)!==q.BILLBOARDMODE_ALL){C.k.Matrix[0].decompose(void 0,C.k.Quaternion[0],void 0);const G=C.k.Ad[1];C.k.Quaternion[0].toEulerAnglesToRef(G),(this.billboardMode&q.BILLBOARDMODE_X)!==q.BILLBOARDMODE_X&&(G.x=0),(this.billboardMode&q.BILLBOARDMODE_Y)!==q.BILLBOARDMODE_Y&&(G.y=0),(this.billboardMode&q.BILLBOARDMODE_Z)!==q.BILLBOARDMODE_Z&&(G.z=0),C.c.RotationYawPitchRollToRef(G.y,G.x,G.z,C.k.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(C.k.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(C.k.Ad[0])}else if(T.useBillboardPath&&D&&T.useBillboardPosition){const G=C.k.Ad[0];this._worldMatrix.getTranslationToRef(G);const N=D.globalPosition;this._worldMatrix.invertToRef(C.k.Matrix[1]);const T=C.k.Ad[1];C.s.TransformCoordinatesToRef(N,C.k.Matrix[1],T),T.normalize();const o=-Math.atan2(T.z,T.x)+Math.PI/2,Z=Math.sqrt(T.x*T.x+T.z*T.z),n=-Math.atan2(T.y,Z);if(C.g.RotationYawPitchRollToRef(o,n,0,C.k.Quaternion[0]),(this.billboardMode&q.BILLBOARDMODE_ALL)!==q.BILLBOARDMODE_ALL){const G=C.k.Ad[1];C.k.Quaternion[0].toEulerAnglesToRef(G),(this.billboardMode&q.BILLBOARDMODE_X)!==q.BILLBOARDMODE_X&&(G.x=0),(this.billboardMode&q.BILLBOARDMODE_Y)!==q.BILLBOARDMODE_Y&&(G.y=0),(this.billboardMode&q.BILLBOARDMODE_Z)!==q.BILLBOARDMODE_Z&&(G.z=0),C.c.RotationYawPitchRollToRef(G.y,G.x,G.z,C.k.Matrix[0])}else C.c.FromQuaternionToRef(C.k.Quaternion[0],C.k.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(C.k.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(C.k.Ad[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):o&&o._nonUniformScaling?this._updateNonUniformScalingState(o._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.xd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=C.c.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.se(),G){const G=this.getChildren();for(let D=0;D<G.length;++D){const N=G[D];if(N){N.se();const G=C.k.Matrix[0];N.Qj.multiplyToRef(this.Qj,G);const D=C.k.Quaternion[0];G.decompose(N.Ed,D,N.position),N.rotationQuaternion?N.rotationQuaternion.p(D):D.toEulerAnglesToRef(N.rotation)}}}this.Ed.xd(1,1,1),this.position.xd(0,0,0),this.rotation.xd(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=C.g.Identity()),this._worldMatrix=C.c.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(G){return this.onAfterWorldMatrixUpdateObservable.add(G),this}unregisterAfterWorldMatrixUpdate(G){return this.onAfterWorldMatrixUpdateObservable.removeCallback(G),this}getPositionInCameraSpace(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return G||(G=this.va().activeCamera),C.s.TransformCoordinates(this.getAbsolutePosition(),G.getViewMatrix())}getDistanceToCamera(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return G||(G=this.va().activeCamera),this.getAbsolutePosition().Jc(G.globalPosition).length()}clone(G,D,N){const T=Z.e.Clone((()=>new q(G,this.va())),this);if(T.name=G,T.id=G,D&&(T.parent=D),!N){const D=this.getDescendants(!0);for(let N=0;N<D.length;N++){const o=D[N];o.clone&&o.clone(G+"."+o.name,T)}}return T}serialize(G){const D=Z.e.Serialize(this,G);return D.type=this.getClassName(),D.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(D),D.localMatrix=this.getPivotMatrix().vd(),D.isEnabled=this.isEnabled(),Z.e.AppendSerializedAnimations(this,D),D.ranges=this.serializeAnimationRanges(),D}static Parse(G,D,N){const T=Z.e.Parse((()=>new q(G.name,D)),G,D,N);if(G.localMatrix?T.setPreTransformMatrix(C.c.od(G.localMatrix)):G.pivotMatrix&&T.setPivotMatrix(C.c.od(G.pivotMatrix)),T.Lg(G.isEnabled),T._waitingParsedUniqueId=G.uniqueId,void 0!==G.parentId&&(T._waitingParentId=G.parentId),void 0!==G.parentInstanceIndex&&(T._waitingParentInstanceIndex=G.parentInstanceIndex),G.animations){for(let D=0;D<G.animations.length;D++){const N=G.animations[D],o=(0,r.e)("BABYLON.Animation");o&&T.animations.push(o.Parse(N))}P.b.ParseAnimationRanges(T,G,D)}return G.autoAnimate&&D.beginAnimation(T,G.autoAnimateFrom,G.autoAnimateTo,G.autoAnimateLoop,G.autoAnimateSpeed||1),T}getChildTransformNodes(G,D){const N=[];return this._getDescendants(N,G,(G=>(!D||D(G))&&G instanceof q)),N}dispose(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const G=this._parentContainer.transformNodes.indexOf(this);G>-1&&this._parentContainer.transformNodes.splice(G,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),G){const G=this.getChildTransformNodes(!0);for(const D of G)D.parent=null,D.se(!0)}super.dispose(G,D)}normalizeToUnitCube(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2?arguments[2]:void 0,T=null,o=null;D&&(this.rotationQuaternion?(o=this.rotationQuaternion.clone(),this.rotationQuaternion.xd(0,0,0,1)):this.rotation&&(T=this.rotation.clone(),this.rotation.xd(0,0,0)));const Z=this.getHierarchyBoundingVectors(G,N),n=Z.max.Jc(Z.min),C=Math.max(n.x,n.y,n.z);if(0===C)return this;const P=1/C;return this.Ed.scaleInPlace(P),D&&(this.rotationQuaternion&&o?this.rotationQuaternion.p(o):this.rotation&&T&&this.rotation.p(T)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}q.BILLBOARDMODE_NONE=0,q.BILLBOARDMODE_X=1,q.BILLBOARDMODE_Y=2,q.BILLBOARDMODE_Z=4,q.BILLBOARDMODE_ALL=7,q.BILLBOARDMODE_USE_POSITION=128,q.BillboardUseParentOrientation=!1,q._TmpRotation=C.g.Zero(),q._TmpScaling=C.s.Zero(),q._TmpTranslation=C.s.Zero(),q._LookAtVectorCache=new C.s(0,0,0),q._RotationAxisCache=new C.g,(0,T.c)([(0,o.O)("position")],q.prototype,"_position",void 0),(0,T.c)([(0,o.O)("rotation")],q.prototype,"_rotation",void 0),(0,T.c)([(0,o.F)("rotationQuaternion")],q.prototype,"_rotationQuaternion",void 0),(0,T.c)([(0,o.O)("Ed")],q.prototype,"_scaling",void 0),(0,T.c)([(0,o.S)("billboardMode")],q.prototype,"_billboardMode",void 0),(0,T.c)([(0,o.S)()],q.prototype,"scalingDeterminant",void 0),(0,T.c)([(0,o.S)("infiniteDistance")],q.prototype,"_infiniteDistance",void 0),(0,T.c)([(0,o.S)()],q.prototype,"ignoreNonUniformScaling",void 0),(0,T.c)([(0,o.S)()],q.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11740:(G,D,N)=>{"use strict";N.d(D,{b:()=>n});var T=N(978),o=N(10320);let Z=0;const n=G=>{if(!G.environmentBRDFTexture){const D=G.useDelayedTextureLoading;G.useDelayedTextureLoading=!1;const N=G._blockEntityCollection;G._blockEntityCollection=!1;const n=T.e.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+Z++,G,!0,!1,T.e.BILINEAR_SAMPLINGMODE);G._blockEntityCollection=N;const C=G.getEngine().getLoadedTexturesCache(),P=C.indexOf(n.getInternalTexture());-1!==P&&C.splice(P,1),n.isRGBD=!0,n.wrapU=T.e.CLAMP_ADDRESSMODE,n.wrapV=T.e.CLAMP_ADDRESSMODE,G.environmentBRDFTexture=n,G.useDelayedTextureLoading=D,o.d.ExpandRGBDTexture(n);const r=G.getEngine().onContextRestoredObservable.add((()=>{n.isRGBD=!0;const D=G.onBeforeRenderObservable.add((()=>{n.isReady()&&(G.onBeforeRenderObservable.remove(D),o.d.ExpandRGBDTexture(n))}))}));G.Fd.add((()=>{G.getEngine().onContextRestoredObservable.remove(r)}))}return G.environmentBRDFTexture}},11385:(G,D,N)=>{"use strict";function T(G,D,N){try{const T=G.next();T.done?D(T):T.value?T.value.then((()=>{T.value=void 0,D(T)}),N):D(T)}catch(T){N(T)}}function o(){let G,D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(N,o,Z)=>{const n=performance.now();void 0===G||n-G>D?(G=n,setTimeout((()=>{T(N,o,Z)}),0)):T(N,o,Z)}}function Z(G,D,N,T,o){const Z=()=>{let n;const C=G=>{G.done?N(G.value):void 0===n?n=!0:Z()};do{n=void 0,o&&o.aborted?T(new Error("Aborted")):D(G,C,T),void 0===n&&(n=!1)}while(n)};Z()}function n(G,D){let N;return Z(G,T,(G=>N=G),(G=>{throw G}),D),N}function C(G,D,N){return new Promise(((T,o)=>{Z(G,D,T,o,N)}))}function P(G,D){return function(){return n(G(...arguments),D)}}N.d(D,{e:()=>o,h:()=>P,k:()=>C,n:()=>n})},10351:(G,D,N)=>{"use strict";N.d(D,{e:()=>o});class T{constructor(G){this._pendingActions=new Array,this._workerInfos=G.map((G=>({workerPromise:Promise.resolve(G),idle:!0})))}dispose(){for(const G of this._workerInfos)G.workerPromise.then((G=>{G.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(G){this._executeOnIdleWorker(G)||this._pendingActions.push(G)}_executeOnIdleWorker(G){for(const D of this._workerInfos)if(D.idle)return this._execute(D,G),!0;return!1}_execute(G,D){G.idle=!1,G.workerPromise.then((N=>{D(N,(()=>{const D=this._pendingActions.shift();D?this._execute(G,D):G.idle=!0}))}))}}class o extends T{constructor(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.DefaultOptions;super([]),this._maxWorkers=G,this._createWorkerAsync=D,this._options=N}push(G){if(!this._executeOnIdleWorker(G))if(this._workerInfos.length<this._maxWorkers){const D={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(D),this._execute(D,G)}else this._pendingActions.push(G)}_execute(G,D){G.timeoutId&&(clearTimeout(G.timeoutId),delete G.timeoutId),super._execute(G,((N,T)=>{D(N,(()=>{T(),G.idle&&(G.timeoutId=setTimeout((()=>{G.workerPromise.then((G=>{G.terminate()}));const D=this._workerInfos.indexOf(G);-1!==D&&this._workerInfos.splice(D,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}o.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11525:(G,D,N)=>{"use strict";N.d(D,{c:()=>yG});var T=N(1009),o=N(1385);class Z extends o.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var n=N(1185),C=(N(1453),N(1018));class P{get noiseTexture(){return this._noiseTexture}set noiseTexture(G){this._noiseTexture!==G&&(this._noiseTexture=G,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(G){this._isAnimationSheetEnabled!=G&&(this._isAnimationSheetEnabled=G,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(G){this._useLogarithmicDepth=G&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:T.s.Zero()}set direction1(G){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=G)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:T.s.Zero()}set direction2(G){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=G)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:T.s.Zero()}set minEmitBox(G){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=G)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:T.s.Zero()}set maxEmitBox(G){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=G)}get billboardMode(){return this._billboardMode}set billboardMode(G){this._billboardMode!==G&&(this._billboardMode=G,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(G){this._isBillboardBased!==G&&(this._isBillboardBased=G,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(G){this._attachImageProcessingConfiguration(G)}_attachImageProcessingConfiguration(G){G!==this._imageProcessingConfiguration&&(!G&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=G)}_reset(){}_removeGradientAndTexture(G,D,N){if(!D)return this;let T=0;for(const o of D){if(o.gradient===G){D.splice(T,1);break}T++}return N&&N.dispose(),this}constructor(G){this.animations=[],this.renderingGroupId=0,this.k=T.s.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new T.s(10,10,10),this.onAnimationEnd=null,this.blendMode=P.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new T.o(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Ag=new T.s(0,0,0),this._useLogarithmicDepth=!1,this.gravity=T.s.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new n.g(1,1,1,1),this.color2=new n.g(1,1,1,1),this.colorDead=new n.g(0,0,0,1),this.textureMask=new n.g(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new Z,this.id=G,this.name=G}createPointEmitter(G,D){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new T.s(0,1,0),arguments.length>2&&void 0!==arguments[2]||new T.s(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new T.s(0,1,0),arguments.length>4&&void 0!==arguments[4]||new T.s(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new T.s(0,1,0),arguments.length>3&&void 0!==arguments[3]||new T.s(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(G,D,N,T){throw new Error("Method not implemented.")}}P.BLENDMODE_ONEONE=0,P.BLENDMODE_STANDARD=1,P.BLENDMODE_ADD=2,P.BLENDMODE_MULTIPLY=3,P.BLENDMODE_MULTIPLYADD=4,(0,C.h)("BABYLON.BaseParticleSystem",P);var r=N(1038),v=N(1225);class q{constructor(){this.direction1=new T.s(0,1,0),this.direction2=new T.s(0,1,0),this.minEmitBox=new T.s(-.5,-.5,-.5),this.maxEmitBox=new T.s(.5,.5,.5)}startDirectionFunction(G,D,N,o){const Z=(0,r.u)(this.direction1.x,this.direction2.x),n=(0,r.u)(this.direction1.y,this.direction2.y),C=(0,r.u)(this.direction1.z,this.direction2.z);if(o)return D.x=Z,D.y=n,void(D.z=C);T.s.TransformNormalFromFloatsToRef(Z,n,C,G,D)}startPositionFunction(G,D,N,o){const Z=(0,r.u)(this.minEmitBox.x,this.maxEmitBox.x),n=(0,r.u)(this.minEmitBox.y,this.maxEmitBox.y),C=(0,r.u)(this.minEmitBox.z,this.maxEmitBox.z);if(o)return D.x=Z,D.y=n,void(D.z=C);T.s.TransformCoordinatesFromFloatsToRef(Z,n,C,G,D)}clone(){const G=new q;return v.e.DeepCopy(this,G),G}applyToShader(G){G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2),G.setVector3("minEmitBox",this.minEmitBox),G.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(G){G.addUniform("direction1",3),G.addUniform("direction2",3),G.addUniform("minEmitBox",3),G.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.direction1=this.direction1.vd(),G.direction2=this.direction2.vd(),G.minEmitBox=this.minEmitBox.vd(),G.maxEmitBox=this.maxEmitBox.vd(),G}parse(G){T.s.FromArrayToRef(G.direction1,0,this.direction1),T.s.FromArrayToRef(G.direction2,0,this.direction2),T.s.FromArrayToRef(G.minEmitBox,0,this.minEmitBox),T.s.FromArrayToRef(G.maxEmitBox,0,this.maxEmitBox)}}class g{get i(){return this._radius}set i(G){this._radius=G,this._buildHeight()}get angle(){return this._angle}set angle(G){this._angle=G,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=N,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=D,this.i=G}startDirectionFunction(G,D,N,o){o?T.k.Ad[0].p(N.Gg).normalize():N.position.subtractToRef(G.getTranslation(),T.k.Ad[0]).normalize();const Z=(0,r.u)(0,this.directionRandomizer),n=(0,r.u)(0,this.directionRandomizer),C=(0,r.u)(0,this.directionRandomizer);D.x=T.k.Ad[0].x+Z,D.y=T.k.Ad[0].y+n,D.z=T.k.Ad[0].z+C,D.normalize()}startPositionFunction(G,D,N,o){const Z=(0,r.u)(0,2*Math.PI);let n;this.emitFromSpawnPointOnly?n=1e-4:(n=(0,r.u)(0,this.heightRange),n=1-n*n);let C=this._radius-(0,r.u)(0,this._radius*this.radiusRange);C*=n;const P=C*Math.sin(Z),v=C*Math.cos(Z),q=n*this._height;if(o)return D.x=P,D.y=q,void(D.z=v);T.s.TransformCoordinatesFromFloatsToRef(P,q,v,G,D)}clone(){const G=new g(this._radius,this._angle,this.directionRandomizer);return v.e.DeepCopy(this,G),G}applyToShader(G){G.setFloat2("i",this._radius,this.radiusRange),G.setFloat("coneAngle",this._angle),G.setFloat2("height",this._height,this.heightRange),G.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(G){G.addUniform("i",2),G.addUniform("coneAngle",1),G.addUniform("height",2),G.addUniform("directionRandomizer",1)}getEffectDefines(){let G="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(G+="\n#define CONEEMITTERSPAWNPOINT"),G}getClassName(){return"ConeParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.i=this._radius,G.angle=this._angle,G.directionRandomizer=this.directionRandomizer,G.radiusRange=this.radiusRange,G.heightRange=this.heightRange,G.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,G}parse(G){this.i=G.i,this.angle=G.angle,this.directionRandomizer=G.directionRandomizer,this.radiusRange=void 0!==G.radiusRange?G.radiusRange:1,this.heightRange=void 0!==G.radiusRange?G.heightRange:1,this.emitFromSpawnPointOnly=void 0!==G.emitFromSpawnPointOnly&&G.emitFromSpawnPointOnly}}class X extends g{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.s(0,1,0),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.s(0,1,0);super(G,D),this.direction1=N,this.direction2=o}startDirectionFunction(G,D){const N=(0,r.u)(this.direction1.x,this.direction2.x),o=(0,r.u)(this.direction1.y,this.direction2.y),Z=(0,r.u)(this.direction1.z,this.direction2.z);T.s.TransformNormalFromFloatsToRef(N,o,Z,G,D)}clone(){const G=new X(this.i,this.angle,this.direction1,this.direction2);return v.e.DeepCopy(this,G),G}applyToShader(G){G.setFloat("i",this.i),G.setFloat("radiusRange",this.radiusRange),G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2)}buildUniformLayout(G){G.addUniform("i",1),G.addUniform("radiusRange",1),G.addUniform("direction1",3),G.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const G=super.serialize();return G.direction1=this.direction1.vd(),G.direction2=this.direction2.vd(),G}parse(G){super.parse(G),this.direction1.p(G.direction1),this.direction2.p(G.direction2)}}class W{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.i=G,this.height=D,this.radiusRange=N,this.directionRandomizer=o,this._tempVector=T.s.Zero()}startDirectionFunction(G,D,N,o,Z){N.position.subtractToRef(G.getTranslation(),this._tempVector),this._tempVector.normalize(),T.s.TransformNormalToRef(this._tempVector,Z,this._tempVector);const n=(0,r.u)(-this.directionRandomizer/2,this.directionRandomizer/2);let C=Math.atan2(this._tempVector.x,this._tempVector.z);C+=(0,r.u)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=n,this._tempVector.x=Math.sin(C),this._tempVector.z=Math.cos(C),this._tempVector.normalize(),o?D.p(this._tempVector):T.s.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,G,D)}startPositionFunction(G,D,N,o){const Z=(0,r.u)(-this.height/2,this.height/2),n=(0,r.u)(0,2*Math.PI),C=(0,r.u)((1-this.radiusRange)*(1-this.radiusRange),1),P=Math.sqrt(C)*this.i,v=P*Math.cos(n),q=P*Math.sin(n);o?D.xd(v,Z,q):T.s.TransformCoordinatesFromFloatsToRef(v,Z,q,G,D)}clone(){const G=new W(this.i,this.directionRandomizer);return v.e.DeepCopy(this,G),G}applyToShader(G){G.setFloat("i",this.i),G.setFloat("height",this.height),G.setFloat("radiusRange",this.radiusRange),G.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(G){G.addUniform("i",1),G.addUniform("height",1),G.addUniform("radiusRange",1),G.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.i=this.i,G.height=this.height,G.radiusRange=this.radiusRange,G.directionRandomizer=this.directionRandomizer,G}parse(G){this.i=G.i,this.height=G.height,this.radiusRange=G.radiusRange,this.directionRandomizer=G.directionRandomizer}}class j extends W{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.s(0,1,0),Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new T.s(0,1,0);super(G,D,N),this.direction1=o,this.direction2=Z}startDirectionFunction(G,D,N,o){const Z=(0,r.u)(this.direction1.x,this.direction2.x),n=(0,r.u)(this.direction1.y,this.direction2.y),C=(0,r.u)(this.direction1.z,this.direction2.z);o?D.xd(Z,n,C):T.s.TransformNormalFromFloatsToRef(Z,n,C,G,D)}clone(){const G=new j(this.i,this.height,this.radiusRange,this.direction1,this.direction2);return v.e.DeepCopy(this,G),G}applyToShader(G){G.setFloat("i",this.i),G.setFloat("height",this.height),G.setFloat("radiusRange",this.radiusRange),G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2)}buildUniformLayout(G){G.addUniform("i",1),G.addUniform("height",1),G.addUniform("radiusRange",1),G.addUniform("direction1",3),G.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const G=super.serialize();return G.direction1=this.direction1.vd(),G.direction2=this.direction2.vd(),G}parse(G){super.parse(G),T.s.FromArrayToRef(G.direction1,0,this.direction1),T.s.FromArrayToRef(G.direction2,0,this.direction2)}}class Y{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=G,this.radiusRange=D,this.directionRandomizer=N}startDirectionFunction(G,D,N,o){const Z=N.position.Jc(G.getTranslation()).normalize(),n=(0,r.u)(0,this.directionRandomizer),C=(0,r.u)(0,this.directionRandomizer),P=(0,r.u)(0,this.directionRandomizer);Z.x+=n,Z.y+=C,Z.z+=P,Z.normalize(),o?D.p(Z):T.s.TransformNormalFromFloatsToRef(Z.x,Z.y,Z.z,G,D)}startPositionFunction(G,D,N,o){const Z=this.i-(0,r.u)(0,this.i*this.radiusRange),n=(0,r.u)(0,1),C=(0,r.u)(0,2*Math.PI),P=Math.acos(2*n-1),v=Z*Math.cos(C)*Math.sin(P),q=Z*Math.cos(P),g=Z*Math.sin(C)*Math.sin(P);o?D.xd(v,Math.abs(q),g):T.s.TransformCoordinatesFromFloatsToRef(v,Math.abs(q),g,G,D)}clone(){const G=new Y(this.i,this.directionRandomizer);return v.e.DeepCopy(this,G),G}applyToShader(G){G.setFloat("i",this.i),G.setFloat("radiusRange",this.radiusRange),G.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(G){G.addUniform("i",1),G.addUniform("radiusRange",1),G.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.i=this.i,G.radiusRange=this.radiusRange,G.directionRandomizer=this.directionRandomizer,G}parse(G){this.i=G.i,this.radiusRange=G.radiusRange,this.directionRandomizer=G.directionRandomizer}}class y{constructor(){this.direction1=new T.s(0,1,0),this.direction2=new T.s(0,1,0)}startDirectionFunction(G,D,N,o){const Z=(0,r.u)(this.direction1.x,this.direction2.x),n=(0,r.u)(this.direction1.y,this.direction2.y),C=(0,r.u)(this.direction1.z,this.direction2.z);o?D.xd(Z,n,C):T.s.TransformNormalFromFloatsToRef(Z,n,C,G,D)}startPositionFunction(G,D,N,o){o?D.xd(0,0,0):T.s.TransformCoordinatesFromFloatsToRef(0,0,0,G,D)}clone(){const G=new y;return v.e.DeepCopy(this,G),G}applyToShader(G){G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2)}buildUniformLayout(G){G.addUniform("direction1",3),G.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.direction1=this.direction1.vd(),G.direction2=this.direction2.vd(),G}parse(G){T.s.FromArrayToRef(G.direction1,0,this.direction1),T.s.FromArrayToRef(G.direction2,0,this.direction2)}}class h{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=G,this.radiusRange=D,this.directionRandomizer=N}startDirectionFunction(G,D,N,o){const Z=N.position.Jc(G.getTranslation()).normalize(),n=(0,r.u)(0,this.directionRandomizer),C=(0,r.u)(0,this.directionRandomizer),P=(0,r.u)(0,this.directionRandomizer);Z.x+=n,Z.y+=C,Z.z+=P,Z.normalize(),o?D.p(Z):T.s.TransformNormalFromFloatsToRef(Z.x,Z.y,Z.z,G,D)}startPositionFunction(G,D,N,o){const Z=this.i-(0,r.u)(0,this.i*this.radiusRange),n=(0,r.u)(0,1),C=(0,r.u)(0,2*Math.PI),P=Math.acos(2*n-1),v=Z*Math.cos(C)*Math.sin(P),q=Z*Math.cos(P),g=Z*Math.sin(C)*Math.sin(P);o?D.xd(v,q,g):T.s.TransformCoordinatesFromFloatsToRef(v,q,g,G,D)}clone(){const G=new h(this.i,this.directionRandomizer);return v.e.DeepCopy(this,G),G}applyToShader(G){G.setFloat("i",this.i),G.setFloat("radiusRange",this.radiusRange),G.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(G){G.addUniform("i",1),G.addUniform("radiusRange",1),G.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.i=this.i,G.radiusRange=this.radiusRange,G.directionRandomizer=this.directionRandomizer,G}parse(G){this.i=G.i,this.radiusRange=G.radiusRange,this.directionRandomizer=G.directionRandomizer}}class m extends h{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new T.s(0,1,0),N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.s(0,1,0);super(G),this.direction1=D,this.direction2=N}startDirectionFunction(G,D){const N=(0,r.u)(this.direction1.x,this.direction2.x),o=(0,r.u)(this.direction1.y,this.direction2.y),Z=(0,r.u)(this.direction1.z,this.direction2.z);T.s.TransformNormalFromFloatsToRef(N,o,Z,G,D)}clone(){const G=new m(this.i,this.direction1,this.direction2);return v.e.DeepCopy(this,G),G}applyToShader(G){G.setFloat("i",this.i),G.setFloat("radiusRange",this.radiusRange),G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2)}buildUniformLayout(G){G.addUniform("i",1),G.addUniform("radiusRange",1),G.addUniform("direction1",3),G.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const G=super.serialize();return G.direction1=this.direction1.vd(),G.direction2=this.direction2.vd(),G}parse(G){super.parse(G),this.direction1.p(G.direction1),this.direction2.p(G.direction2)}}class R{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(G,D,N,o){const Z=T.k.Ad[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,N,Z);const G=T.k.Ad[1];Z.subtractToRef(N.position,G),G.scaleToRef(1/N.lifeTime,Z)}else Z.set(0,0,0);o?D.p(Z):T.s.TransformNormalToRef(Z,G,D)}startPositionFunction(G,D,N,o){const Z=T.k.Ad[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,N,Z):Z.set(0,0,0),o?D.p(Z):T.s.TransformCoordinatesToRef(Z,G,D)}clone(){const G=new R;return v.e.DeepCopy(this,G),G}applyToShader(G){}buildUniformLayout(G){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const G={};return G.type=this.getClassName(),G.particlePositionGenerator=this.particlePositionGenerator,G.particleDestinationGenerator=this.particleDestinationGenerator,G}parse(G){G.particlePositionGenerator&&(this.particlePositionGenerator=G.particlePositionGenerator),G.particleDestinationGenerator&&(this.particleDestinationGenerator=G.particleDestinationGenerator)}}var L=N(1255);class w{get mesh(){return this.Je}set mesh(G){this.Je!==G&&(this.Je=G,G?(this._indices=G.ye(),this._positions=G.getVerticesData(L.f.PositionKind),this._normals=G.getVerticesData(L.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=T.s.Zero(),this.Je=null,this.direction1=new T.s(0,1,0),this.direction2=new T.s(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=G}startDirectionFunction(G,D,N,o){if(this.useMeshNormalsForDirection&&this._normals)return void T.s.TransformNormalToRef(this._storedNormal,G,D);const Z=(0,r.u)(this.direction1.x,this.direction2.x),n=(0,r.u)(this.direction1.y,this.direction2.y),C=(0,r.u)(this.direction1.z,this.direction2.z);o?D.xd(Z,n,C):T.s.TransformNormalFromFloatsToRef(Z,n,C,G,D)}startPositionFunction(G,D,N,o){if(!this._indices||!this._positions)return;const Z=3*Math.random()*(this._indices.length/3)|0,n=Math.random(),C=Math.random()*(1-n),P=1-n-C,r=this._indices[Z],v=this._indices[Z+1],q=this._indices[Z+2],g=T.k.Ad[0],X=T.k.Ad[1],W=T.k.Ad[2],j=T.k.Ad[3];T.s.FromArrayToRef(this._positions,3*r,g),T.s.FromArrayToRef(this._positions,3*v,X),T.s.FromArrayToRef(this._positions,3*q,W),j.x=n*g.x+C*X.x+P*W.x,j.y=n*g.y+C*X.y+P*W.y,j.z=n*g.z+C*X.z+P*W.z,o?D.xd(j.x,j.y,j.z):T.s.TransformCoordinatesFromFloatsToRef(j.x,j.y,j.z,G,D),this.useMeshNormalsForDirection&&this._normals&&(T.s.FromArrayToRef(this._normals,3*r,g),T.s.FromArrayToRef(this._normals,3*v,X),T.s.FromArrayToRef(this._normals,3*q,W),this._storedNormal.x=n*g.x+C*X.x+P*W.x,this._storedNormal.y=n*g.y+C*X.y+P*W.y,this._storedNormal.z=n*g.z+C*X.z+P*W.z)}clone(){const G=new w(this.mesh);return v.e.DeepCopy(this,G),G}applyToShader(G){G.setVector3("direction1",this.direction1),G.setVector3("direction2",this.direction2)}buildUniformLayout(G){G.addUniform("direction1",3),G.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var G;const D={};return D.type=this.getClassName(),D.direction1=this.direction1.vd(),D.direction2=this.direction2.vd(),D.meshId=null===(G=this.mesh)||void 0===G?void 0:G.id,D.useMeshNormalsForDirection=this.useMeshNormalsForDirection,D}parse(G,D){T.s.FromArrayToRef(G.direction1,0,this.direction1),T.s.FromArrayToRef(G.direction2,0,this.direction2),G.meshId&&D&&(this.mesh=D.getLastMeshById(G.meshId)),this.useMeshNormalsForDirection=G.useMeshNormalsForDirection}}var B=N(1129);class F{_isUbo(G){return void 0!==G.addUniform}constructor(G){this._isUbo(G)?(this.setMatrix3x3=G.updateMatrix3x3.bind(G),this.setMatrix2x2=G.updateMatrix2x2.bind(G),this.setFloat=G.updateFloat.bind(G),this.setFloat2=G.updateFloat2.bind(G),this.setFloat3=G.updateFloat3.bind(G),this.setFloat4=G.updateFloat4.bind(G),this.setFloatArray=G.updateFloatArray.bind(G),this.setArray=G.updateArray.bind(G),this.setIntArray=G.updateIntArray.bind(G),this.setMatrix=G.Rd.bind(G),this.setMatrices=G.updateMatrices.bind(G),this.setVector3=G.updateVector3.bind(G),this.setVector4=G.updateVector4.bind(G),this.setColor3=G.updateColor3.bind(G),this.setColor4=G.updateColor4.bind(G),this.setDirectColor4=G.updateDirectColor4.bind(G),this.setInt=G.updateInt.bind(G),this.setInt2=G.updateInt2.bind(G),this.setInt3=G.updateInt3.bind(G),this.setInt4=G.updateInt4.bind(G)):(this.setMatrix3x3=G.setMatrix3x3.bind(G),this.setMatrix2x2=G.setMatrix2x2.bind(G),this.setFloat=G.setFloat.bind(G),this.setFloat2=G.setFloat2.bind(G),this.setFloat3=G.setFloat3.bind(G),this.setFloat4=G.setFloat4.bind(G),this.setFloatArray=G.setFloatArray.bind(G),this.setArray=G.setArray.bind(G),this.setIntArray=G.setIntArray.bind(G),this.setMatrix=G.setMatrix.bind(G),this.setMatrices=G.setMatrices.bind(G),this.setVector3=G.setVector3.bind(G),this.setVector4=G.setVector4.bind(G),this.setColor3=G.setColor3.bind(G),this.setColor4=G.setColor4.bind(G),this.setDirectColor4=G.setDirectColor4.bind(G),this.setInt=G.setInt.bind(G),this.setInt2=G.setInt2.bind(G),this.setInt3=G.setInt3.bind(G),this.setInt4=G.setInt4.bind(G))}}var S=N(1133);const V="gpuUpdateParticlesPixelShader",U="#version 300 es\nvoid main() {discard;}\n";S.d.ShadersStore[V]=U;const z="gpuUpdateParticlesVertexShader",i="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";S.d.ShadersStore[z]=i;(0,C.h)("BABYLON.WebGL2ParticleSystem",class{constructor(G,D){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=G,this._engine=D,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","i","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var G;return(null===(G=this._updateEffect)||void 0===G?void 0:G.isReady())??!1}createUpdateBuffer(G){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof R&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=G,this._updateEffect=new B.d("gpuUpdateParticles",this._updateEffectOptions,this._engine),new F(this._updateEffect)}createVertexBuffers(G,D){this._updateVAO.push(this._createUpdateVAO(G)),this._renderVAO.push(this._engine.recordVertexArrayObject(D,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=D}createParticleBuffer(G){return G}bindDrawBuffers(G,D,N){N?this._engine.bindBuffers(this._renderVertexBuffers,N,D):this._engine.bindVertexArrayObject(this._renderVAO[G],null)}preUpdateParticleBuffer(){const G=this._engine;if(this._engine.enableEffect(this._updateEffect),!G.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(G,D,N){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[G],null);const T=this._engine;T.bindTransformFeedbackBuffer(D.getBuffer()),T.setRasterizerState(!1),T.beginTransformFeedback(!0),T.drawArraysType(3,0,N),T.endTransformFeedback(),T.setRasterizerState(!0),T.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let G=0;G<this._updateVAO.length;G++)this._engine.releaseVertexArrayObject(this._updateVAO[G]);this._updateVAO.length=0;for(let G=0;G<this._renderVAO.length;G++)this._engine.releaseVertexArrayObject(this._renderVAO[G]);this._renderVAO.length=0}_createUpdateVAO(G){const D={};D.position=G.createVertexBuffer("position",0,3);let N=3;D.age=G.createVertexBuffer("age",N,1),N+=1,D.size=G.createVertexBuffer("size",N,3),N+=3,D.life=G.createVertexBuffer("life",N,1),N+=1,D.seed=G.createVertexBuffer("seed",N,4),N+=4,D.direction=G.createVertexBuffer("direction",N,3),N+=3,this._parent.particleEmitterType instanceof R&&(D.initialPosition=G.createVertexBuffer("initialPosition",N,3),N+=3),this._parent._colorGradientsTexture||(D.color=G.createVertexBuffer("color",N,4),N+=4),this._parent._isBillboardBased||(D.initialDirection=G.createVertexBuffer("initialDirection",N,3),N+=3),this._parent.noiseTexture&&(D.noiseCoordinates1=G.createVertexBuffer("noiseCoordinates1",N,3),N+=3,D.noiseCoordinates2=G.createVertexBuffer("noiseCoordinates2",N,3),N+=3),this._parent._angularSpeedGradientsTexture?(D.angle=G.createVertexBuffer("angle",N,1),N+=1):(D.angle=G.createVertexBuffer("angle",N,2),N+=2),this._parent._isAnimationSheetEnabled&&(D.cellIndex=G.createVertexBuffer("cellIndex",N,1),N+=1,this._parent.spriteRandomStartCell&&(D.cellStartOffset=G.createVertexBuffer("cellStartOffset",N,1),N+=1));const T=this._engine.recordVertexArrayObject(D,null,this._updateEffect);return this._engine.bindArrayBuffer(null),T}});class J{constructor(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,T=arguments.length>3?arguments[3]:void 0;this._engine=G,this._label=T,this._engine._storageBuffers.push(this),this._create(D,N)}_create(G,D){this._bufferSize=G,this._creationFlags=D,this._buffer=this._engine.createStorageBuffer(G,D,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(G,D,N){this._buffer&&this._engine.updateStorageBuffer(this._buffer,G,D,N)}read(G,D,N,T){return this._engine.readFromStorageBuffer(this._buffer,G,D,N,T)}dispose(){const G=this._engine._storageBuffers,D=G.indexOf(this);-1!==D&&(G[D]=G[G.length-1],G.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var p=N(980),t=N(985),H=N(1181),s=N(978),c=N(1317),K=N(1105),b=N(1166),O=N(1304);class Q{constructor(){this._gpuTimeInFrameId=-1,this.counter=new O.c}_addDuration(G,D){G<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==G?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(D,!1),this._gpuTimeInFrameId=G):this.counter.addCount(D,!1))}}class A{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(G,D,N){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=G,this._engine=D,this.uniqueId=c.d.UniqueId,D.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new Q),this._engine.getCaps().supportComputeShaders?T.bindingsMapping?(this._context=D.createComputeContext(),this._shaderPath=N,this._options={bindingsMapping:{},defines:[],...T}):K.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):K.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(G,D){let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const T=this._bindings[G];this._bindings[G]={type:N?0:4,object:D,indexInGroupEntries:null===T||void 0===T?void 0:T.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!T||T.object!==D||T.type!==this._bindings[G].type)}setStorageTexture(G,D){const N=this._bindings[G];this._contextIsDirty||(this._contextIsDirty=!N||N.object!==D),this._bindings[G]={type:1,object:D,indexInGroupEntries:null===N||void 0===N?void 0:N.indexInGroupEntries}}setExternalTexture(G,D){const N=this._bindings[G];this._contextIsDirty||(this._contextIsDirty=!N||N.object!==D),this._bindings[G]={type:6,object:D,indexInGroupEntries:null===N||void 0===N?void 0:N.indexInGroupEntries}}setVideoTexture(G,D){return!!D.externalTexture&&(this.setExternalTexture(G,D.externalTexture),!0)}setUniformBuffer(G,D){const N=this._bindings[G];this._contextIsDirty||(this._contextIsDirty=!N||N.object!==D),this._bindings[G]={type:A._BufferIsDataBuffer(D)?7:2,object:D,indexInGroupEntries:null===N||void 0===N?void 0:N.indexInGroupEntries}}setStorageBuffer(G,D){const N=this._bindings[G];this._contextIsDirty||(this._contextIsDirty=!N||N.object!==D),this._bindings[G]={type:A._BufferIsDataBuffer(D)?7:3,object:D,indexInGroupEntries:null===N||void 0===N?void 0:N.indexInGroupEntries}}setTextureSampler(G,D){const N=this._bindings[G];this._contextIsDirty||(this._contextIsDirty=!N||!D.compareSampler(N.object)),this._bindings[G]={type:5,object:D,indexInGroupEntries:null===N||void 0===N?void 0:N.indexInGroupEntries}}isReady(){let G=this._effect;for(const o in this._bindings){const G=this._bindings[o],D=G.type,N=G.object;switch(D){case 0:case 4:case 1:if(!N.isReady())return!1;break;case 6:if(!N.isReady())return!1;break}}const D=[],N=this._shaderPath;if(this._options.defines)for(let o=0;o<this._options.defines.length;o++)D.push(this._options.defines[o]);const T=D.join("\n");return this._cachedDefines!==T&&(this._cachedDefines=T,G=this._engine.createComputeEffect(N,{defines:T,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=G),!!G.isReady()}dispatch(G,D,N){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,G,D,N,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const N=A._BufferIsDataBuffer(G)?G:G.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,N,D,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const D in this._bindings){const N=this._bindings[D];if(!this._options.bindingsMapping[D])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+D+"'");switch(N.type){case 0:{const T=this._samplers[D],o=N.object;var G;if(!T||!o._texture||!T.compareSampler(o._texture))this._samplers[D]=(new b.c).setParameters(o.wrapU,o.wrapV,o.wrapR,o.anisotropicFilteringLevel,o._texture.samplingMode,null===(G=o._texture)||void 0===G?void 0:G._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const G=N.object;G.getBuffer()!==N.buffer&&(N.buffer=G.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(G,D,N){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((o=>{const Z=()=>{this.dispatch(G,D,N)?o():setTimeout(Z,T)};Z()}))}serialize(){const G=H.e.Serialize(this);G.options=this._options,G.shaderPath=this._shaderPath,G.Aj={},G.textures={};for(const D in this._bindings){const N=this._bindings[D],T=N.object;switch(N.type){case 0:case 4:case 1:{const o=T.serialize();o&&(G.textures[D]=o,G.Aj[D]={type:N.type});break}}}return G}static Parse(G,D,N){const T=H.e.Parse((()=>new A(G.name,D.getEngine(),G.shaderPath,G.options)),G,D,N);for(const o in G.textures){const Z=G.Aj[o],n=s.e.Parse(G.textures[o],D,N);0===Z.type?T.setTexture(o,n):4===Z.type?T.setTexture(o,n,!1):T.setStorageTexture(o,n)}return T}static _BufferIsDataBuffer(G){return void 0!==G.underlyingResource}}(0,p.c)([(0,t.S)()],A.prototype,"name",void 0),(0,p.c)([(0,t.S)()],A.prototype,"fastMode",void 0),(0,C.h)("BABYLON.ComputeShader",A);var I=N(1246);const d="gpuUpdateParticlesComputeShader",u="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";S.d.ShadersStoreWGSL[d]=u;(0,C.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(G,D){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=G,this._engine=D}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var G;return(null===(G=this._updateComputeShader)||void 0===G?void 0:G.isReady())??!1}createUpdateBuffer(G){var D;const N={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(N.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(N.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(N.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(N.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(N.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(N.noiseTexture={group:1,binding:11}),this._updateComputeShader=new A("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:N,defines:G.split("\n")}),null===(D=this._simParamsComputeShader)||void 0===D||D.dispose(),this._simParamsComputeShader=new I.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new F(this._simParamsComputeShader)}createVertexBuffers(G,D){this._renderVertexBuffers.push(D)}createParticleBuffer(G){const D=new J(this._engine,4*G.length,11,"ComputeShaderParticleSystemBuffer");return D.update(G),this._bufferComputeShader.push(D),D.getBuffer()}bindDrawBuffers(G,D,N){this._engine.bindBuffers(this._renderVertexBuffers[G],N,D)}preUpdateParticleBuffer(){}updateParticleBuffer(G,D,N){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[G]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^G]),this._updateComputeShader.dispatch(Math.ceil(N/64))}releaseBuffers(){var G;for(let D=0;D<this._bufferComputeShader.length;++D)this._bufferComputeShader[D].dispose();this._bufferComputeShader.length=0,null===(G=this._simParamsComputeShader)||void 0===G||G.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class l{constructor(G,D,N){this.gradient=G,this.color1=D,this.color2=N}getColorToRef(G){this.color2?n.g.LerpToRef(this.color1,this.color2,Math.random(),G):G.p(this.color1)}}class x{constructor(G,D){this.gradient=G,this.color=D}}class k{constructor(G,D,N){this.gradient=G,this.factor1=D,this.factor2=N}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class a{static GetCurrentGradient(G,D,N){if(D[0].gradient>G)return void N(D[0],D[0],1);for(let o=0;o<D.length-1;o++){const T=D[o],Z=D[o+1];if(G>=T.gradient&&G<=Z.gradient){return void N(T,Z,(G-T.gradient)/(Z.gradient-T.gradient))}}const T=D.length-1;N(D[T],D[T],1)}}var E=N(1003),M=N(11529),e=N(1030);class f{constructor(G){this.particleSystem=G,this.position=T.s.Zero(),this.direction=T.s.Zero(),this.color=new n.g(0,0,0,0),this.colorStep=new n.g(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new T.o(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new n.g(0,0,0,0),this._currentColor2=new n.g(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=f._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let G=this.age,D=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===D?(D=1,G=this._randomCellOffset):G+=this._randomCellOffset);const N=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let T;T=this._initialSpriteCellLoop?(0,r.e)(G*D%this.lifeTime/this.lifeTime):(0,r.e)(G*D/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+T*N|0}_inheritParticleInfoToSubEmitter(G){if(G.particleSystem.k.position){const D=G.particleSystem.k;if(D.position.p(this.position),G.inheritDirection){const G=T.k.Ad[0];this.direction.normalizeToRef(G),D.setDirection(G,0,Math.PI/2)}}else{G.particleSystem.k.p(this.position)}this.direction.scaleToRef(G.inheritedVelocityAmount/2,T.k.Ad[0]),G.particleSystem._inheritedVelocityOffset.p(T.k.Ad[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((G=>{this._inheritParticleInfoToSubEmitter(G)}))}_reset(){this.age=0,this.id=f._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(G){G.position.p(this.position),this._initialDirection?G._initialDirection?G._initialDirection.p(this._initialDirection):G._initialDirection=this._initialDirection.clone():G._initialDirection=null,G.direction.p(this.direction),this.Gg&&(G.Gg?G.Gg.p(this.Gg):G.Gg=this.Gg.clone()),G.color.p(this.color),G.colorStep.p(this.colorStep),G.lifeTime=this.lifeTime,G.age=this.age,G._randomCellOffset=this._randomCellOffset,G.size=this.size,G.scale.p(this.scale),G.angle=this.angle,G.angularSpeed=this.angularSpeed,G.particleSystem=this.particleSystem,G.cellIndex=this.cellIndex,G.id=this.id,G._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(G._currentColorGradient=this._currentColorGradient,G._currentColor1.p(this._currentColor1),G._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(G._currentSizeGradient=this._currentSizeGradient,G._currentSize1=this._currentSize1,G._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(G._currentAngularSpeedGradient=this._currentAngularSpeedGradient,G._currentAngularSpeed1=this._currentAngularSpeed1,G._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(G._currentVelocityGradient=this._currentVelocityGradient,G._currentVelocity1=this._currentVelocity1,G._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(G._currentLimitVelocityGradient=this._currentLimitVelocityGradient,G._currentLimitVelocity1=this._currentLimitVelocity1,G._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(G._currentDragGradient=this._currentDragGradient,G._currentDrag1=this._currentDrag1,G._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(G._initialStartSpriteCellID=this._initialStartSpriteCellID,G._initialEndSpriteCellID=this._initialEndSpriteCellID,G._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(G.remapData&&this.remapData?G.remapData.p(this.remapData):G.remapData=new T.v(0,0,0,0)),this._randomNoiseCoordinates1&&(G._randomNoiseCoordinates1?(G._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),G._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(G._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),G._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}f._Count=0;var GG=N(1372),DG=(N(1445),N(1380)),NG=N(1374),TG=N(1244);class oG extends P{set onDispose(G){this._onDisposeObserver&&this.Fd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Fd.add(G)}get useRampGradients(){return this._useRampGradients}set useRampGradients(G){this._useRampGradients!==G&&(this._useRampGradients=G,this._resetEffect())}get particles(){return this.vj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.vj.length}getClassName(){return"Be"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var G;let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(G=this._customWrappers[D])||void 0===G?void 0:G.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[G]??this._customWrappers[0]}setCustomEffect(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[D]=new GG.c(this._engine),this._customWrappers[D].effect=G,this._customWrappers[D].drawContext&&(this._customWrappers[D].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new E.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(G,D,N){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(G),this._emitterInverseWorldMatrix=T.c.Identity(),this._inheritedVelocityOffset=new T.s,this.Fd=new E.b,this.onStoppedObservable=new E.b,this.vj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new n.g(0,0,0,0),this._colorDiff=new n.g(0,0,0,0),this._scaledDirection=T.s.Zero(),this._scaledGravity=T.s.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=G=>{},this.recycleParticle=G=>{const D=this.vj.pop();D!==G&&D.copyTo(G),this._stockParticles.push(D)},this._createParticle=()=>{let G;return 0!==this._stockParticles.length?(G=this._stockParticles.pop(),G._reset()):G=new f(this),this._prepareParticle(G),G},this._shadersLoaded=!1,this._capacity=D,this._epsilon=C,this._isAnimationSheetEnabled=Z,N&&"Scene"!==N.getClassName()?(this._engine=N,this.defaultProjectionMatrix=T.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=N||e.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.fe.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new GG.c(this._engine)},this._customWrappers[0].effect=o,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new q;let P=null;this.updateFunction=G=>{let D=null;var N;this.noiseTexture&&(D=this.noiseTexture.getSize(),null===(N=this.noiseTexture.getContent())||void 0===N||N.then((G=>{P=G})));const o=G===this.vj;for(let Z=0;Z<G.length;Z++){const N=G[Z];let C=this._scaledUpdateSpeed;const v=N.age;if(N.age+=C,N.age>N.lifeTime){const G=N.age-v;C=(N.lifeTime-v)*C/G,N.age=N.lifeTime}const q=N.age/N.lifeTime;this._colorGradients&&this._colorGradients.length>0?a.GetCurrentGradient(q,this._colorGradients,((G,D,T)=>{G!==N._currentColorGradient&&(N._currentColor1.p(N._currentColor2),D.getColorToRef(N._currentColor2),N._currentColorGradient=G),n.g.LerpToRef(N._currentColor1,N._currentColor2,T,N.color)})):(N.colorStep.scaleToRef(C,this._scaledColorStep),N.color.addInPlace(this._scaledColorStep),N.color.a<0&&(N.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&a.GetCurrentGradient(q,this._angularSpeedGradients,((G,D,T)=>{G!==N._currentAngularSpeedGradient&&(N._currentAngularSpeed1=N._currentAngularSpeed2,N._currentAngularSpeed2=D.getFactor(),N._currentAngularSpeedGradient=G),N.angularSpeed=(0,r.o)(N._currentAngularSpeed1,N._currentAngularSpeed2,T)})),N.angle+=N.angularSpeed*C;let g=C;if(this._velocityGradients&&this._velocityGradients.length>0&&a.GetCurrentGradient(q,this._velocityGradients,((G,D,T)=>{G!==N._currentVelocityGradient&&(N._currentVelocity1=N._currentVelocity2,N._currentVelocity2=D.getFactor(),N._currentVelocityGradient=G),g*=(0,r.o)(N._currentVelocity1,N._currentVelocity2,T)})),N.direction.scaleToRef(g,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&a.GetCurrentGradient(q,this._limitVelocityGradients,((G,D,T)=>{G!==N._currentLimitVelocityGradient&&(N._currentLimitVelocity1=N._currentLimitVelocity2,N._currentLimitVelocity2=D.getFactor(),N._currentLimitVelocityGradient=G);const o=(0,r.o)(N._currentLimitVelocity1,N._currentLimitVelocity2,T);N.direction.length()>o&&N.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&a.GetCurrentGradient(q,this._dragGradients,((G,D,T)=>{G!==N._currentDragGradient&&(N._currentDrag1=N._currentDrag2,N._currentDrag2=D.getFactor(),N._currentDragGradient=G);const o=(0,r.o)(N._currentDrag1,N._currentDrag2,T);this._scaledDirection.scaleInPlace(1-o)})),this.isLocal&&N.Gg?(N.Gg.addInPlace(this._scaledDirection),T.s.TransformCoordinatesToRef(N.Gg,this._emitterWorldMatrix,N.position)):N.position.addInPlace(this._scaledDirection),P&&D&&N._randomNoiseCoordinates1){const G=this._fetchR(N._randomNoiseCoordinates1.x,N._randomNoiseCoordinates1.y,D.width,D.height,P),o=this._fetchR(N._randomNoiseCoordinates1.z,N._randomNoiseCoordinates2.x,D.width,D.height,P),Z=this._fetchR(N._randomNoiseCoordinates2.y,N._randomNoiseCoordinates2.z,D.width,D.height,P),n=T.k.Ad[0],r=T.k.Ad[1];n.xd((2*G-1)*this.noiseStrength.x,(2*o-1)*this.noiseStrength.y,(2*Z-1)*this.noiseStrength.z),n.scaleToRef(C,r),N.direction.addInPlace(r)}this.gravity.scaleToRef(C,this._scaledGravity),N.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&a.GetCurrentGradient(q,this._sizeGradients,((G,D,T)=>{G!==N._currentSizeGradient&&(N._currentSize1=N._currentSize2,N._currentSize2=D.getFactor(),N._currentSizeGradient=G),N.size=(0,r.o)(N._currentSize1,N._currentSize2,T)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&a.GetCurrentGradient(q,this._colorRemapGradients,((G,D,T)=>{const o=(0,r.o)(G.factor1,D.factor1,T),Z=(0,r.o)(G.factor2,D.factor2,T);N.remapData.x=o,N.remapData.y=Z-o})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&a.GetCurrentGradient(q,this._alphaRemapGradients,((G,D,T)=>{const o=(0,r.o)(G.factor1,D.factor1,T),Z=(0,r.o)(G.factor2,D.factor2,T);N.remapData.z=o,N.remapData.w=Z-o}))),this._isAnimationSheetEnabled&&N.updateCellIndex(),N._inheritParticleInfoToSubEmitters(),N.age>=N.lifeTime&&(this._emitFromParticle(N),N._attachedSubEmitters&&(N._attachedSubEmitters.forEach((G=>{G.particleSystem.disposeOnStop=!0,G.particleSystem.stop()})),N._attachedSubEmitters=null),this.recycleParticle(N),o&&Z--)}}}serialize(G){throw new Error("Method not implemented.")}clone(G,D){throw new Error("Method not implemented.")}_addFactorGradient(G,D,N,T){const o=new k(D,N,T);G.push(o),G.sort(((G,D)=>G.gradient<D.gradient?-1:G.gradient>D.gradient?1:0))}_removeFactorGradient(G,D){if(!G)return;let N=0;for(const T of G){if(T.gradient===D){G.splice(N,1);break}N++}}addLifeTimeGradient(G,D,N){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,G,D,N),this}removeLifeTimeGradient(G){return this._removeFactorGradient(this._lifeTimeGradients,G),this}addSizeGradient(G,D,N){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,G,D,N),this}removeSizeGradient(G){return this._removeFactorGradient(this._sizeGradients,G),this}addColorRemapGradient(G,D,N){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,G,D,N),this}removeColorRemapGradient(G){return this._removeFactorGradient(this._colorRemapGradients,G),this}addAlphaRemapGradient(G,D,N){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,G,D,N),this}removeAlphaRemapGradient(G){return this._removeFactorGradient(this._alphaRemapGradients,G),this}addAngularSpeedGradient(G,D,N){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,G,D,N),this}removeAngularSpeedGradient(G){return this._removeFactorGradient(this._angularSpeedGradients,G),this}addVelocityGradient(G,D,N){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,G,D,N),this}removeVelocityGradient(G){return this._removeFactorGradient(this._velocityGradients,G),this}addLimitVelocityGradient(G,D,N){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,G,D,N),this}removeLimitVelocityGradient(G){return this._removeFactorGradient(this._limitVelocityGradients,G),this}addDragGradient(G,D,N){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,G,D,N),this}removeDragGradient(G){return this._removeFactorGradient(this._dragGradients,G),this}addEmitRateGradient(G,D,N){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,G,D,N),this}removeEmitRateGradient(G){return this._removeFactorGradient(this._emitRateGradients,G),this}addStartSizeGradient(G,D,N){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,G,D,N),this}removeStartSizeGradient(G){return this._removeFactorGradient(this._startSizeGradients,G),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const G=new Uint8Array(4*this._rawTextureWidth),D=n.k.Md[0];for(let N=0;N<this._rawTextureWidth;N++){const T=N/this._rawTextureWidth;a.GetCurrentGradient(T,this._rampGradients,((T,o,Z)=>{n.d.LerpToRef(T.color,o.color,Z,D),G[4*N]=255*D.r,G[4*N+1]=255*D.g,G[4*N+2]=255*D.b,G[4*N+3]=255}))}this._rampGradientsTexture=M.c.CreateRGBATexture(G,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((G,D)=>G.gradient<D.gradient?-1:G.gradient>D.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(G,D){this._rampGradients||(this._rampGradients=[]);const N=new x(G,D);return this._rampGradients.push(N),this._syncRampGradientTexture(),this}removeRampGradient(G){return this._removeGradientAndTexture(G,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(G,D,N){this._colorGradients||(this._colorGradients=[]);const T=new l(G,D,N);return this._colorGradients.push(T),this._colorGradients.sort(((G,D)=>G.gradient<D.gradient?-1:G.gradient>D.gradient?1:0)),this}removeColorGradient(G){if(!this._colorGradients)return this;let D=0;for(const N of this._colorGradients){if(N.gradient===G){this._colorGradients.splice(D,1);break}D++}return this}resetDrawCache(){for(const G of this._drawWrappers)if(G)for(const D of G)null===D||void 0===D||D.dispose();this._drawWrappers=[]}_fetchR(G,D,N,T,o){return o[4*(((G=.5*Math.abs(G)+.5)*N%N|0)+((D=.5*Math.abs(D)+.5)*T%T|0)*N)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const G=this._engine,D=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*D),this._vertexBuffer=new L.c(G,this._vertexData,!0,D);let N=0;const T=this._vertexBuffer.createVertexBuffer(L.f.PositionKind,N,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[L.f.PositionKind]=T,N+=3;const o=this._vertexBuffer.createVertexBuffer(L.f.ColorKind,N,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[L.f.ColorKind]=o,N+=4;const Z=this._vertexBuffer.createVertexBuffer("angle",N,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=Z,N+=1;const n=this._vertexBuffer.createVertexBuffer("size",N,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=n,N+=2,this._isAnimationSheetEnabled){const G=this._vertexBuffer.createVertexBuffer("cellIndex",N,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=G,N+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const G=this._vertexBuffer.createVertexBuffer("direction",N,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=G,N+=3}if(this._useRampGradients){const G=this._vertexBuffer.createVertexBuffer("remapData",N,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=G,N+=4}let C;if(this._useInstancing){const D=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new L.c(G,D,!1,2),C=this._spriteBuffer.createVertexBuffer("offset",0,2)}else C=this._vertexBuffer.createVertexBuffer("offset",N,2,this._vertexBufferSize,this._useInstancing),N+=2;this._vertexBuffers.offset=C,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const G=[],D=[];let N=0;for(let T=0;T<this._capacity;T++)G.push(N),G.push(N+1),G.push(N+2),G.push(N),G.push(N+2),G.push(N+3),D.push(N,N+1,N+1,N+2,N+2,N+3,N+3,N,N,N+3),N+=4;this._indexBuffer=this._engine.createIndexBuffer(G),this._linesIndexBuffer=this._engine.createIndexBuffer(D)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(G)setTimeout((()=>{this.start(0)}),G);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var D;-1!==(null===(D=this.k)||void 0===D?void 0:D.getClassName().indexOf("Mesh"))&&this.k.se(!0);const G=this.noiseTexture;if(G&&G.onGeneratedObservable)G.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let D=0;D<this.preWarmCycles;D++)this.animate(!0),G.render()}))}));else for(let D=0;D<this.preWarmCycles;D++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(G))}_postStop(G){}reset(){this._stockParticles.length=0,this.vj.length=0}_appendParticleVertex(G,D,N,o){let Z=G*this._vertexBufferSize;if(this._vertexData[Z++]=D.position.x+this.Ag.x,this._vertexData[Z++]=D.position.y+this.Ag.y,this._vertexData[Z++]=D.position.z+this.Ag.z,this._vertexData[Z++]=D.color.r,this._vertexData[Z++]=D.color.g,this._vertexData[Z++]=D.color.b,this._vertexData[Z++]=D.color.a,this._vertexData[Z++]=D.angle,this._vertexData[Z++]=D.scale.x*D.size,this._vertexData[Z++]=D.scale.y*D.size,this._isAnimationSheetEnabled&&(this._vertexData[Z++]=D.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[Z++]=D.direction.x,this._vertexData[Z++]=D.direction.y,this._vertexData[Z++]=D.direction.z);else if(D._initialDirection){let G=D._initialDirection;this.isLocal&&(T.s.TransformNormalToRef(G,this._emitterWorldMatrix,T.k.Ad[0]),G=T.k.Ad[0]),0===G.x&&0===G.z&&(G.x=.001),this._vertexData[Z++]=G.x,this._vertexData[Z++]=G.y,this._vertexData[Z++]=G.z}else{let G=D.direction;this.isLocal&&(T.s.TransformNormalToRef(G,this._emitterWorldMatrix,T.k.Ad[0]),G=T.k.Ad[0]),0===G.x&&0===G.z&&(G.x=.001),this._vertexData[Z++]=G.x,this._vertexData[Z++]=G.y,this._vertexData[Z++]=G.z}this._useRampGradients&&D.remapData&&(this._vertexData[Z++]=D.remapData.x,this._vertexData[Z++]=D.remapData.y,this._vertexData[Z++]=D.remapData.z,this._vertexData[Z++]=D.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===N?N=this._epsilon:1===N&&(N=1-this._epsilon),0===o?o=this._epsilon:1===o&&(o=1-this._epsilon)),this._vertexData[Z++]=N,this._vertexData[Z++]=o)}_prepareParticle(G){}_update(G){if(this._alive=this.vj.length>0,this.k.position){const G=this.k;this._emitterWorldMatrix=G.getWorldMatrix()}else{const G=this.k;this._emitterWorldMatrix=T.c.Translation(G.x,G.y,G.z)}let D;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.vj);for(let N=0;N<G&&this.vj.length!==this._capacity;N++){if(D=this._createParticle(),this.vj.push(D),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const G=(0,r.e)(this._actualFrame/this.targetStopDuration);a.GetCurrentGradient(G,this._lifeTimeGradients,((N,T)=>{const o=N,Z=T,n=o.getFactor(),C=Z.getFactor(),P=(G-o.gradient)/(Z.gradient-o.gradient);D.lifeTime=(0,r.o)(n,C,P)}))}else D.lifeTime=(0,r.u)(this.minLifeTime,this.maxLifeTime);const G=(0,r.u)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,D.position,D,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,D.position,D,this.isLocal),this.isLocal&&(D.Gg?D.Gg.p(D.position):D.Gg=D.position.clone(),T.s.TransformCoordinatesToRef(D.Gg,this._emitterWorldMatrix,D.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,D.direction,D,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,D.direction,D,this.isLocal,this._emitterInverseWorldMatrix),0===G?D._initialDirection?D._initialDirection.p(D.direction):D._initialDirection=D.direction.clone():D._initialDirection=null,D.direction.scaleInPlace(G),this._sizeGradients&&0!==this._sizeGradients.length?(D._currentSizeGradient=this._sizeGradients[0],D._currentSize1=D._currentSizeGradient.getFactor(),D.size=D._currentSize1,this._sizeGradients.length>1?D._currentSize2=this._sizeGradients[1].getFactor():D._currentSize2=D._currentSize1):D.size=(0,r.u)(this.minSize,this.maxSize),D.scale.xd((0,r.u)(this.minScaleX,this.maxScaleX),(0,r.u)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const G=this._actualFrame/this.targetStopDuration;a.GetCurrentGradient(G,this._startSizeGradients,((G,N,T)=>{G!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=N.getFactor(),this._currentStartSizeGradient=G);const o=(0,r.o)(this._currentStartSize1,this._currentStartSize2,T);D.scale.scaleInPlace(o)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(D._currentAngularSpeedGradient=this._angularSpeedGradients[0],D.angularSpeed=D._currentAngularSpeedGradient.getFactor(),D._currentAngularSpeed1=D.angularSpeed,this._angularSpeedGradients.length>1?D._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():D._currentAngularSpeed2=D._currentAngularSpeed1):D.angularSpeed=(0,r.u)(this.minAngularSpeed,this.maxAngularSpeed),D.angle=(0,r.u)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(D._currentVelocityGradient=this._velocityGradients[0],D._currentVelocity1=D._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?D._currentVelocity2=this._velocityGradients[1].getFactor():D._currentVelocity2=D._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(D._currentLimitVelocityGradient=this._limitVelocityGradients[0],D._currentLimitVelocity1=D._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?D._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():D._currentLimitVelocity2=D._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(D._currentDragGradient=this._dragGradients[0],D._currentDrag1=D._currentDragGradient.getFactor(),this._dragGradients.length>1?D._currentDrag2=this._dragGradients[1].getFactor():D._currentDrag2=D._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)D._currentColorGradient=this._colorGradients[0],D._currentColorGradient.getColorToRef(D.color),D._currentColor1.p(D.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(D._currentColor2):D._currentColor2.p(D.color);else{const G=(0,r.u)(0,1);n.g.LerpToRef(this.color1,this.color2,G,D.color),this.colorDead.subtractToRef(D.color,this._colorDiff),this._colorDiff.scaleToRef(1/D.lifeTime,D.colorStep)}this._isAnimationSheetEnabled&&(D._initialStartSpriteCellID=this.startSpriteCellID,D._initialEndSpriteCellID=this.endSpriteCellID,D._initialSpriteCellLoop=this.spriteCellLoop),D.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(D.remapData=new T.v(0,1,0,1)),this.noiseTexture&&(D._randomNoiseCoordinates1?(D._randomNoiseCoordinates1.xd(Math.random(),Math.random(),Math.random()),D._randomNoiseCoordinates2.xd(Math.random(),Math.random(),Math.random())):(D._randomNoiseCoordinates1=new T.s(Math.random(),Math.random(),Math.random()),D._randomNoiseCoordinates2=new T.s(Math.random(),Math.random(),Math.random()))),D._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T=[L.f.PositionKind,L.f.ColorKind,"angle","offset","size"];return G&&T.push("cellIndex"),D||T.push("direction"),N&&T.push("remapData"),T}static _GetEffectCreationOptions(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,DG.e)(T),G&&T.push("particlesInfos"),D&&T.push("logarithmicDepthConstant"),N&&(T.push("vFogInfos"),T.push("vFogColor")),T}fillDefines(G,D){let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,DG.k)(this,this._scene,G),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&G.push("#define FOG")),this._isAnimationSheetEnabled&&G.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&G.push("#define LOGARITHMICDEPTH"),D===P.BLENDMODE_MULTIPLY&&G.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&G.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(G.push("#define BILLBOARD"),this.billboardMode){case 2:G.push("#define BILLBOARDY");break;case 8:case 9:G.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&G.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:G.push("#define BILLBOARDMODE_ALL")}N&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),G.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(G,D,N){D.push(...oG._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),G.push(...oG._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),N.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,TG.h)(G,this._imageProcessingConfigurationDefines),(0,TG.d)(N,this._imageProcessingConfigurationDefines))}_getWrapper(G){const D=this._getCustomDrawWrapper(G);if(null!==D&&void 0!==D&&D.effect)return D;const N=[];this.fillDefines(N,G);const T=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let o=this._drawWrappers[T];o||(o=this._drawWrappers[T]=[]);let Z=o[G];Z||(Z=new GG.c(this._engine),Z.drawContext&&(Z.drawContext.useInstancing=this._useInstancing),o[G]=Z);const n=N.join("\n");if(Z.defines!==n){const G=[],D=[],N=[];this.fillUniformsAttributesAndSamplerNames(D,G,N),Z.setEffect(this._engine.createEffect("particles",G,D,N,n,void 0,void 0,void 0,void 0,this._shaderLanguage),n)}return Z}animate(){var G;let D,N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!N&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(N?this.preWarmStepOffset:(null===(G=this._scene)||void 0===G?void 0:G.getAnimationRatio())||1),this.manualEmitCount>-1)D=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let G=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const D=this._actualFrame/this.targetStopDuration;a.GetCurrentGradient(D,this._emitRateGradients,((D,N,T)=>{D!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=N.getFactor(),this._currentEmitRateGradient=D),G=(0,r.o)(this._currentEmitRate1,this._currentEmitRate2,T)}))}D=G*this._scaledUpdateSpeed|0,this._newPartsExcess+=G*this._scaledUpdateSpeed-D}if(this._newPartsExcess>1&&(D+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?D=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(D),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!N){let G=0;for(let D=0;D<this.vj.length;D++){const N=this.vj[D];this._appendParticleVertices(G,N),G+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.vj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(G,D){this._appendParticleVertex(G++,D,0,0),this._useInstancing||(this._appendParticleVertex(G++,D,1,0),this._appendParticleVertex(G++,D,1,1),this._appendParticleVertex(G++,D,0,1))}rebuild(){var G;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(G=this._spriteBuffer)||void 0===G||G._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!oG.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(N.bind(N,11574)),Promise.resolve().then(N.bind(N,11569))])):await Promise.all([Promise.resolve().then(N.bind(N,11561)),Promise.resolve().then(N.bind(N,11559))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==P.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(P.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(P.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(G){const D=this._getWrapper(G),N=D.effect,o=this._engine;o.enableEffect(D);const Z=this.defaultViewMatrix??this._scene.getViewMatrix();if(N.setTexture("diffuseSampler",this.particleTexture),N.setMatrix("view",Z),N.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const G=this.particleTexture.getBaseSize();N.setFloat3("particlesInfos",this.spriteCellWidth/G.width,this.spriteCellHeight/G.height,this.spriteCellWidth/G.width)}if(N.setVector2("translationPivot",this.translationPivot),N.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const G=this._scene.activeCamera;N.setVector3("eyePosition",G.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),N.setTexture("rampSampler",this._rampGradientsTexture));const n=N.defines;var C,r,v,q,g,X;(this._scene&&((0,DG.g)(N,this,this._scene),this.applyFog&&(0,NG.f)(this._scene,void 0,N)),n.indexOf("#define BILLBOARDMODE_ALL")>=0&&(Z.invertToRef(T.k.Matrix[0]),N.setMatrix("invView",T.k.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?o.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,N):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,N)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?o.bindBuffers(this._vertexBuffers,null!==(v=this._scene)&&void 0!==v&&v.forceWireframe?this._linesIndexBuffer:this._indexBuffer,N):o.bindBuffers(this._vertexBuffers,null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._linesIndexBufferUseInstancing:null,N);switch(this.useLogarithmicDepth&&this._scene&&(0,NG.k)(n,N,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(N),G){case P.BLENDMODE_ADD:o.setAlphaMode(1);break;case P.BLENDMODE_ONEONE:o.setAlphaMode(6);break;case P.BLENDMODE_STANDARD:o.setAlphaMode(2);break;case P.BLENDMODE_MULTIPLY:o.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(N),this._useInstancing)?null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?o.drawElementsType(6,0,10,this.vj.length):o.drawArraysType(7,0,4,this.vj.length):null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?o.drawElementsType(1,0,10*this.vj.length):o.drawElementsType(0,0,6*this.vj.length);return this.vj.length}render(){if(!this.isReady()||!this.vj.length)return 0;const G=this._engine;G.setState&&(G.setState(!1),this.forceDepthWrite&&G.setDepthWrite(!0));let D=0;return D=this.blendMode===P.BLENDMODE_MULTIPLYADD?this._render(P.BLENDMODE_MULTIPLY)+this._render(P.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),D}_onDispose(){}dispose(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),G&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),G&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(D,N),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const G=this._scene.fe.indexOf(this);G>-1&&this._scene.fe.splice(G,1),this._scene._activeParticleSystems.dispose()}this.Fd.notifyObservers(this),this.Fd.clear(),this.onStoppedObservable.clear(),this.reset()}}oG.ForceGLSL=!1;var ZG,nG=N(1094);!function(G){G[G.ATTACHED=0]="ATTACHED",G[G.END=1]="END"}(ZG||(ZG={}));class CG{constructor(G){if(this.particleSystem=G,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!G.k||!G.k.dispose){const D=(0,C.e)("BABYLON.AbstractMesh");G.k=new D("SubemitterSystemEmitter",G.va()),G._disposeEmitterOnDispose=!0}}clone(){let G=this.particleSystem.k;if(G){if(G instanceof T.s)G=G.clone();else if(-1!==G.getClassName().indexOf("Mesh")){G=new((0,C.e)("BABYLON.Mesh"))("",G.va()),G.isVisible=!1}}else G=new T.s;const D=new CG(this.particleSystem.clone(this.particleSystem.name,G));return D.particleSystem.name+="Clone",D.type=this.type,D.inheritDirection=this.inheritDirection,D.inheritedVelocityAmount=this.inheritedVelocityAmount,D.particleSystem._disposeEmitterOnDispose=!0,D.particleSystem.disposeOnStop=!0,D}serialize(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const D={};return D.type=this.type,D.inheritDirection=this.inheritDirection,D.inheritedVelocityAmount=this.inheritedVelocityAmount,D.particleSystem=this.particleSystem.serialize(G),D}static _ParseParticleSystem(G,D,N){throw(0,nG.d)("ParseParticle")}static Parse(G,D,N){const T=G.particleSystem,o=new CG(CG._ParseParticleSystem(T,D,N,!0));return o.type=G.type,o.inheritDirection=G.inheritDirection,o.inheritedVelocityAmount=G.inheritedVelocityAmount,o.particleSystem._isSubEmitter=!0,o}dispose(){this.particleSystem.dispose()}}var PG=N(1122);function rG(G,D){const N=new y;return N.direction1=G,N.direction2=D,N}function vG(){return new Y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function qG(){return new h(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function gG(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new T.s(0,1,0),N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.s(0,1,0);return new m(G,D,N)}function XG(){return new W(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function WG(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.s(0,1,0),Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new T.s(0,1,0);return new j(G,D,N,o,Z)}function jG(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new g(G,D)}function YG(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.s(0,1,0),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.s(0,1,0);return new X(G,D,N,o)}class yG extends oG{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=G=>{if(!this._subEmitters||0===this._subEmitters.length)return;const D=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[D].forEach((D=>{if(1===D.type){const N=D.clone();G._inheritParticleInfoToSubEmitter(N),N.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(N.particleSystem),N.particleSystem.start()}}))}}createPointEmitter(G,D){const N=rG(G,D);return this.particleEmitterType=N,N}createHemisphericEmitter(){const G=vG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=G,G}createSphereEmitter(){const G=qG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=G,G}createDirectedSphereEmitter(){const G=gG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new T.s(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.s(0,1,0));return this.particleEmitterType=G,G}createCylinderEmitter(){const G=XG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=G,G}createDirectedCylinderEmitter(){const G=WG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.s(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new T.s(0,1,0));return this.particleEmitterType=G,G}createConeEmitter(){const G=jG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=G,G}createDirectedConeEmitter(){const G=YG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.s(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.s(0,1,0));return this.particleEmitterType=G,G}createBoxEmitter(G,D,N,T){const o=new q;return this.particleEmitterType=o,this.direction1=G,this.direction2=D,this.minEmitBox=N,this.maxEmitBox=T,o}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((G=>{G instanceof yG?this._subEmitters.push([new CG(G)]):G instanceof CG?this._subEmitters.push([G]):G instanceof Array&&this._subEmitters.push(G)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((G=>{G.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const G=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==G&&this._rootParticleSystem.activeSubSystems.splice(G,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(G){G&&this._stopSubEmitters()}_prepareParticle(G){if(this._subEmitters&&this._subEmitters.length>0){const D=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];G._attachedSubEmitters=[],D.forEach((D=>{if(0===D.type){const N=D.clone();G._attachedSubEmitters.push(N),N.particleSystem.start()}}))}}_onDispose(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var N;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),G)&&(null===(N=this.particles)||void 0===N||N.forEach((G=>{if(G._attachedSubEmitters)for(let D=G._attachedSubEmitters.length-1;D>=0;D-=1)G._attachedSubEmitters[D].dispose()})));if(D&&this.activeSubSystems)for(let T=this.activeSubSystems.length-1;T>=0;T-=1)this.activeSubSystems[T].dispose();if(this._subEmitters&&this._subEmitters.length){for(let G=0;G<this._subEmitters.length;G++)for(const D of this._subEmitters[G])D.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(G,D,N,o){let Z;Z=N instanceof PG.b?null:N;const P=(0,C.e)("BABYLON.Texture");if(P&&Z&&(G.texture?D.particleTexture=P.Parse(G.texture,Z,o):G.textureName&&(D.particleTexture=new P(o+G.textureName,Z,!1,void 0===G.invertY||G.invertY),D.particleTexture.name=G.textureName)),G.emitterId||0===G.emitterId||void 0!==G.k?G.emitterId&&Z?D.k=Z.getLastMeshById(G.emitterId):D.k=T.s.od(G.k):D.k=T.s.Zero(),D.isLocal=!!G.isLocal,void 0!==G.renderingGroupId&&(D.renderingGroupId=G.renderingGroupId),void 0!==G.isBillboardBased&&(D.isBillboardBased=G.isBillboardBased),void 0!==G.billboardMode&&(D.billboardMode=G.billboardMode),void 0!==G.useLogarithmicDepth&&(D.useLogarithmicDepth=G.useLogarithmicDepth),G.animations){for(let N=0;N<G.animations.length;N++){const T=G.animations[N],o=(0,C.e)("BABYLON.Animation");o&&D.animations.push(o.Parse(T))}D.beginAnimationOnStart=G.beginAnimationOnStart,D.beginAnimationFrom=G.beginAnimationFrom,D.beginAnimationTo=G.beginAnimationTo,D.beginAnimationLoop=G.beginAnimationLoop}if(G.autoAnimate&&Z&&Z.beginAnimation(D,G.autoAnimateFrom,G.autoAnimateTo,G.autoAnimateLoop,G.autoAnimateSpeed||1),D.startDelay=0|G.startDelay,D.minAngularSpeed=G.minAngularSpeed,D.maxAngularSpeed=G.maxAngularSpeed,D.minSize=G.minSize,D.maxSize=G.maxSize,G.minScaleX&&(D.minScaleX=G.minScaleX,D.maxScaleX=G.maxScaleX,D.minScaleY=G.minScaleY,D.maxScaleY=G.maxScaleY),void 0!==G.preWarmCycles&&(D.preWarmCycles=G.preWarmCycles,D.preWarmStepOffset=G.preWarmStepOffset),void 0!==G.minInitialRotation&&(D.minInitialRotation=G.minInitialRotation,D.maxInitialRotation=G.maxInitialRotation),D.minLifeTime=G.minLifeTime,D.maxLifeTime=G.maxLifeTime,D.minEmitPower=G.minEmitPower,D.maxEmitPower=G.maxEmitPower,D.emitRate=G.emitRate,D.gravity=T.s.od(G.gravity),G.noiseStrength&&(D.noiseStrength=T.s.od(G.noiseStrength)),D.color1=n.g.od(G.color1),D.color2=n.g.od(G.color2),D.colorDead=n.g.od(G.colorDead),D.updateSpeed=G.updateSpeed,D.targetStopDuration=G.targetStopDuration,D.blendMode=G.blendMode,G.colorGradients)for(const T of G.colorGradients)D.addColorGradient(T.gradient,n.g.od(T.color1),T.color2?n.g.od(T.color2):void 0);if(G.rampGradients){for(const N of G.rampGradients)D.addRampGradient(N.gradient,n.d.od(N.color));D.useRampGradients=G.useRampGradients}if(G.colorRemapGradients)for(const T of G.colorRemapGradients)D.addColorRemapGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(G.alphaRemapGradients)for(const T of G.alphaRemapGradients)D.addAlphaRemapGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(G.sizeGradients)for(const T of G.sizeGradients)D.addSizeGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(G.angularSpeedGradients)for(const T of G.angularSpeedGradients)D.addAngularSpeedGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(G.velocityGradients)for(const T of G.velocityGradients)D.addVelocityGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(G.dragGradients)for(const T of G.dragGradients)D.addDragGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(G.emitRateGradients)for(const T of G.emitRateGradients)D.addEmitRateGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(G.startSizeGradients)for(const T of G.startSizeGradients)D.addStartSizeGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(G.lifeTimeGradients)for(const T of G.lifeTimeGradients)D.addLifeTimeGradient(T.gradient,void 0!==T.factor1?T.factor1:T.factor,T.factor2);if(G.limitVelocityGradients){for(const N of G.limitVelocityGradients)D.addLimitVelocityGradient(N.gradient,void 0!==N.factor1?N.factor1:N.factor,N.factor2);D.limitVelocityDamping=G.limitVelocityDamping}if(G.noiseTexture&&Z){const N=(0,C.e)("BABYLON.ProceduralTexture");D.noiseTexture=N.Parse(G.noiseTexture,Z,o)}let r;if(G.particleEmitterType){switch(G.particleEmitterType.type){case"SphereParticleEmitter":r=new h;break;case"SphereDirectedParticleEmitter":r=new m;break;case"ConeEmitter":case"ConeParticleEmitter":r=new g;break;case"ConeDirectedParticleEmitter":r=new X;break;case"CylinderParticleEmitter":r=new W;break;case"CylinderDirectedParticleEmitter":r=new j;break;case"HemisphericParticleEmitter":r=new Y;break;case"PointParticleEmitter":r=new y;break;case"MeshParticleEmitter":r=new w;break;case"CustomParticleEmitter":r=new R;break;default:r=new q}r.parse(G.particleEmitterType,Z)}else r=new q,r.parse(G,Z);D.particleEmitterType=r,D.startSpriteCellID=G.startSpriteCellID,D.endSpriteCellID=G.endSpriteCellID,D.spriteCellLoop=G.spriteCellLoop??!0,D.spriteCellWidth=G.spriteCellWidth,D.spriteCellHeight=G.spriteCellHeight,D.spriteCellChangeSpeed=G.spriteCellChangeSpeed,D.spriteRandomStartCell=G.spriteRandomStartCell,D.disposeOnStop=G.disposeOnStop??!1,D.manualEmitCount=G.manualEmitCount??-1}static Parse(G,D,N){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Z=arguments.length>4?arguments[4]:void 0;const C=G.name;let P,r,v=null,q=null;if(D instanceof PG.b?P=D:(r=D,P=r.getEngine()),G.customShader&&P.createEffectForParticles){q=G.customShader;const D=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"";v=P.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,D)}const g=new yG(C,Z||G.ze,D,v,G.isAnimationSheetEnabled);if(g.customShader=q,g._rootUrl=N,G.id&&(g.id=G.id),G.subEmitters){g.subEmitters=[];for(const T of G.subEmitters){const G=[];for(const o of T)G.push(CG.Parse(o,D,N));g.subEmitters.push(G)}}return yG._Parse(G,g,D,N),G.textureMask&&(g.textureMask=n.g.od(G.textureMask)),G.Ag&&(g.Ag=T.s.od(G.Ag)),G.preventAutoStart&&(g.preventAutoStart=G.preventAutoStart),o||g.preventAutoStart||g.start(),g}serialize(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const D={};if(yG._Serialize(D,this,G),D.textureMask=this.textureMask.vd(),D.customShader=this.customShader,D.preventAutoStart=this.preventAutoStart,D.Ag=this.Ag.vd(),this.subEmitters){D.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const N of this._subEmitters){const T=[];for(const D of N)T.push(D.serialize(G));D.subEmitters.push(T)}}return D}static _Serialize(G,D,N){if(G.name=D.name,G.id=D.id,G.ze=D.getCapacity(),G.disposeOnStop=D.disposeOnStop,G.manualEmitCount=D.manualEmitCount,D.k.position){const N=D.k;G.emitterId=N.id}else{const N=D.k;G.k=N.vd()}D.particleEmitterType&&(G.particleEmitterType=D.particleEmitterType.serialize()),D.particleTexture&&(N?G.texture=D.particleTexture.serialize():(G.textureName=D.particleTexture.name,G.invertY=!!D.particleTexture._invertY)),G.isLocal=D.isLocal,H.e.AppendSerializedAnimations(D,G),G.beginAnimationOnStart=D.beginAnimationOnStart,G.beginAnimationFrom=D.beginAnimationFrom,G.beginAnimationTo=D.beginAnimationTo,G.beginAnimationLoop=D.beginAnimationLoop,G.startDelay=D.startDelay,G.renderingGroupId=D.renderingGroupId,G.isBillboardBased=D.isBillboardBased,G.billboardMode=D.billboardMode,G.minAngularSpeed=D.minAngularSpeed,G.maxAngularSpeed=D.maxAngularSpeed,G.minSize=D.minSize,G.maxSize=D.maxSize,G.minScaleX=D.minScaleX,G.maxScaleX=D.maxScaleX,G.minScaleY=D.minScaleY,G.maxScaleY=D.maxScaleY,G.minEmitPower=D.minEmitPower,G.maxEmitPower=D.maxEmitPower,G.minLifeTime=D.minLifeTime,G.maxLifeTime=D.maxLifeTime,G.emitRate=D.emitRate,G.gravity=D.gravity.vd(),G.noiseStrength=D.noiseStrength.vd(),G.color1=D.color1.vd(),G.color2=D.color2.vd(),G.colorDead=D.colorDead.vd(),G.updateSpeed=D.updateSpeed,G.targetStopDuration=D.targetStopDuration,G.blendMode=D.blendMode,G.preWarmCycles=D.preWarmCycles,G.preWarmStepOffset=D.preWarmStepOffset,G.minInitialRotation=D.minInitialRotation,G.maxInitialRotation=D.maxInitialRotation,G.startSpriteCellID=D.startSpriteCellID,G.spriteCellLoop=D.spriteCellLoop,G.endSpriteCellID=D.endSpriteCellID,G.spriteCellChangeSpeed=D.spriteCellChangeSpeed,G.spriteCellWidth=D.spriteCellWidth,G.spriteCellHeight=D.spriteCellHeight,G.spriteRandomStartCell=D.spriteRandomStartCell,G.isAnimationSheetEnabled=D.isAnimationSheetEnabled,G.useLogarithmicDepth=D.useLogarithmicDepth;const T=D.getColorGradients();if(T){G.colorGradients=[];for(const D of T){const N={gradient:D.gradient,color1:D.color1.vd()};D.color2?N.color2=D.color2.vd():N.color2=D.color1.vd(),G.colorGradients.push(N)}}const o=D.getRampGradients();if(o){G.rampGradients=[];for(const D of o){const N={gradient:D.gradient,color:D.color.vd()};G.rampGradients.push(N)}G.useRampGradients=D.useRampGradients}const Z=D.getColorRemapGradients();if(Z){G.colorRemapGradients=[];for(const D of Z){const N={gradient:D.gradient,factor1:D.factor1};void 0!==D.factor2?N.factor2=D.factor2:N.factor2=D.factor1,G.colorRemapGradients.push(N)}}const n=D.getAlphaRemapGradients();if(n){G.alphaRemapGradients=[];for(const D of n){const N={gradient:D.gradient,factor1:D.factor1};void 0!==D.factor2?N.factor2=D.factor2:N.factor2=D.factor1,G.alphaRemapGradients.push(N)}}const C=D.getSizeGradients();if(C){G.sizeGradients=[];for(const D of C){const N={gradient:D.gradient,factor1:D.factor1};void 0!==D.factor2?N.factor2=D.factor2:N.factor2=D.factor1,G.sizeGradients.push(N)}}const P=D.getAngularSpeedGradients();if(P){G.angularSpeedGradients=[];for(const D of P){const N={gradient:D.gradient,factor1:D.factor1};void 0!==D.factor2?N.factor2=D.factor2:N.factor2=D.factor1,G.angularSpeedGradients.push(N)}}const r=D.getVelocityGradients();if(r){G.velocityGradients=[];for(const D of r){const N={gradient:D.gradient,factor1:D.factor1};void 0!==D.factor2?N.factor2=D.factor2:N.factor2=D.factor1,G.velocityGradients.push(N)}}const v=D.getDragGradients();if(v){G.dragGradients=[];for(const D of v){const N={gradient:D.gradient,factor1:D.factor1};void 0!==D.factor2?N.factor2=D.factor2:N.factor2=D.factor1,G.dragGradients.push(N)}}const q=D.getEmitRateGradients();if(q){G.emitRateGradients=[];for(const D of q){const N={gradient:D.gradient,factor1:D.factor1};void 0!==D.factor2?N.factor2=D.factor2:N.factor2=D.factor1,G.emitRateGradients.push(N)}}const g=D.getStartSizeGradients();if(g){G.startSizeGradients=[];for(const D of g){const N={gradient:D.gradient,factor1:D.factor1};void 0!==D.factor2?N.factor2=D.factor2:N.factor2=D.factor1,G.startSizeGradients.push(N)}}const X=D.getLifeTimeGradients();if(X){G.lifeTimeGradients=[];for(const D of X){const N={gradient:D.gradient,factor1:D.factor1};void 0!==D.factor2?N.factor2=D.factor2:N.factor2=D.factor1,G.lifeTimeGradients.push(N)}}const W=D.getLimitVelocityGradients();if(W){G.limitVelocityGradients=[];for(const D of W){const N={gradient:D.gradient,factor1:D.factor1};void 0!==D.factor2?N.factor2=D.factor2:N.factor2=D.factor1,G.limitVelocityGradients.push(N)}G.limitVelocityDamping=D.limitVelocityDamping}D.noiseTexture&&(G.noiseTexture=D.noiseTexture.serialize())}clone(G,D){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T={...this._customWrappers};let o=null;const Z=this._engine;if(Z.createEffectForParticles&&null!=this.customShader){o=this.customShader;const G=o.shaderOptions.defines.length>0?o.shaderOptions.defines.join("\n"):"",D=Z.createEffectForParticles(o.shaderPath.fragmentElement,o.shaderOptions.uniforms,o.shaderOptions.samplers,G);T[0]?T[0].effect=D:this.setCustomEffect(D,0)}const n=this.serialize(N),C=yG.Parse(n,this._scene||this._engine,this._rootUrl);return C.name=G,C.customShader=o,C._customWrappers=T,void 0===D&&(D=this.k),this.noiseTexture&&(C.noiseTexture=this.noiseTexture.clone()),C.k=D,this.preventAutoStart||C.start(),C}}yG.BILLBOARDMODE_Y=2,yG.BILLBOARDMODE_ALL=7,yG.BILLBOARDMODE_STRETCHED=8,yG.BILLBOARDMODE_STRETCHED_LOCAL=9,CG._ParseParticleSystem=yG.Parse;var hG=N(1233),mG=N(1218),RG=N(1424);RG.d.prototype.createTransformFeedback=function(){const G=this._gl.createTransformFeedback();if(!G)throw new Error("Unable to create Transform Feedback");return G},RG.d.prototype.deleteTransformFeedback=function(G){this._gl.deleteTransformFeedback(G)},RG.d.prototype.bindTransformFeedback=function(G){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,G)},RG.d.prototype.beginTransformFeedback=function(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(G?this._gl.POINTS:this._gl.TRIANGLES)},RG.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},RG.d.prototype.setTranformFeedbackVaryings=function(G,D){this._gl.transformFeedbackVaryings(G,D,this._gl.INTERLEAVED_ATTRIBS)},RG.d.prototype.bindTransformFeedbackBuffer=function(G){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,G?G.underlyingResource:null)},RG.d.prototype.readTransformFeedbackBuffer=function(G){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,G)};const LG="clipPlaneFragmentDeclaration2",wG="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";S.d.IncludesShadersStore[LG]=wG;N(10893),N(10755),N(10693),N(10899),N(10922),N(10930),N(10962),N(10964);const BG="gpuRenderParticlesPixelShader",FG="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";S.d.ShadersStore[BG]=FG;const SG="clipPlaneVertexDeclaration2",VG="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";S.d.IncludesShadersStore[SG]=VG;N(10736),N(10814),N(10817),N(10838);const UG="gpuRenderParticlesVertexShader",zG="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";S.d.ShadersStore[UG]=zG;class iG extends P{static get IsSupported(){if(!e.e.LastCreatedEngine)return!1;const G=e.e.LastCreatedEngine.getCaps();return G.supportTransformFeedbacks||G.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(G){this._maxActiveParticleCount=Math.min(G,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(G){this.maxActiveParticleCount=G}createPointEmitter(G,D){const N=rG(G,D);return this.particleEmitterType=N,N}createHemisphericEmitter(){const G=vG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=G,G}createSphereEmitter(){const G=qG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=G,G}createDirectedSphereEmitter(){const G=gG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new T.s(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.s(0,1,0));return this.particleEmitterType=G,G}createCylinderEmitter(){const G=XG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=G,G}createDirectedCylinderEmitter(){const G=WG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.s(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new T.s(0,1,0));return this.particleEmitterType=G,G}createConeEmitter(){const G=jG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=G,G}createDirectedConeEmitter(){const G=YG(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new T.s(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new T.s(0,1,0));return this.particleEmitterType=G,G}createBoxEmitter(G,D,N,T){const o=new q;return this.particleEmitterType=o,this.direction1=G,this.direction2=D,this.minEmitBox=N,this.maxEmitBox=T,o}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==yG.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(yG.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(yG.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";G?setTimeout((()=>{this.start(0)}),G):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var G;let D=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(G=this._customWrappers[D])||void 0===G?void 0:G.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[G]??this._customWrappers[0]}setCustomEffect(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[D]=new GG.c(this._engine),this._customWrappers[D].effect=G}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new E.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(G,D,N){return super._removeGradientAndTexture(G,D,N),this._releaseBuffers(),this}addColorGradient(G,D){this._colorGradients||(this._colorGradients=[]);const N=new l(G,D);return this._colorGradients.push(N),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(G&&this._colorGradients.sort(((G,D)=>G.gradient<D.gradient?-1:G.gradient>D.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(G){return this._removeGradientAndTexture(G,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const D in this._drawWrappers){var G;null===(G=this._drawWrappers[D].drawContext)||void 0===G||G.reset()}}_addFactorGradient(G,D,N){const T=new k(D,N);G.push(T),this._releaseBuffers()}addSizeGradient(G,D){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,G,D),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(G){return this._removeGradientAndTexture(G,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(G,D){if(!G)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&G.sort(((G,D)=>G.gradient<D.gradient?-1:G.gradient>D.gradient?1:0));const N=this;N[D]&&(N[D].dispose(),N[D]=null)}addAngularSpeedGradient(G,D){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,G,D),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(G){return this._removeGradientAndTexture(G,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(G,D){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,G,D),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(G){return this._removeGradientAndTexture(G,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(G,D){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,G,D),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(G){return this._removeGradientAndTexture(G,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(G,D){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,G,D),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(G){return this._removeGradientAndTexture(G,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(G){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(G,D,N){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(G),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Fd=new E.b,this.onStoppedObservable=new E.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,N&&"Scene"!==N.getClassName()?(this._engine=N,this.defaultProjectionMatrix=T.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=N||e.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.fe.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,C.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,C.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,C.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,C.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new GG.c(this._engine)},this._customWrappers[0].effect=o,this._drawWrappers={0:new GG.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(D=D??{}).randomTextureSize||delete D.randomTextureSize;const n={ze:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...D},P=D;isFinite(P)&&(n.ze=P),this._capacity=n.ze,this._maxActiveParticleCount=n.ze,this._currentActiveCount=0,this._isAnimationSheetEnabled=Z,this.particleEmitterType=new q;const r=Math.min(this._engine.getCaps().maxTextureSize,n.randomTextureSize);let v=[];for(let T=0;T<r;++T)v.push(Math.random()),v.push(Math.random()),v.push(Math.random()),v.push(Math.random());this._randomTexture=new M.c(new Float32Array(v),r,1,5,N,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,v=[];for(let T=0;T<r;++T)v.push(Math.random()),v.push(Math.random()),v.push(Math.random()),v.push(Math.random());this._randomTexture2=new M.c(new Float32Array(v),r,1,5,N,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=r}_reset(){this._releaseBuffers()}_createVertexBuffers(G,D,N){const T={};T.position=D.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let o=3;T.age=D.createVertexBuffer("age",o,1,this._attributesStrideSize,!0),o+=1,T.size=D.createVertexBuffer("size",o,3,this._attributesStrideSize,!0),o+=3,T.life=D.createVertexBuffer("life",o,1,this._attributesStrideSize,!0),o+=1,o+=4,this.billboardMode===yG.BILLBOARDMODE_STRETCHED&&(T.direction=D.createVertexBuffer("direction",o,3,this._attributesStrideSize,!0)),o+=3,this._platform.alignDataInBuffer&&(o+=1),this.particleEmitterType instanceof R&&(o+=3,this._platform.alignDataInBuffer&&(o+=1)),this._colorGradientsTexture||(T.color=D.createVertexBuffer("color",o,4,this._attributesStrideSize,!0),o+=4),this._isBillboardBased||(T.initialDirection=D.createVertexBuffer("initialDirection",o,3,this._attributesStrideSize,!0),o+=3,this._platform.alignDataInBuffer&&(o+=1)),this.noiseTexture&&(T.noiseCoordinates1=D.createVertexBuffer("noiseCoordinates1",o,3,this._attributesStrideSize,!0),o+=3,this._platform.alignDataInBuffer&&(o+=1),T.noiseCoordinates2=D.createVertexBuffer("noiseCoordinates2",o,3,this._attributesStrideSize,!0),o+=3,this._platform.alignDataInBuffer&&(o+=1)),T.angle=D.createVertexBuffer("angle",o,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?o++:o+=2,this._isAnimationSheetEnabled&&(T.cellIndex=D.createVertexBuffer("cellIndex",o,1,this._attributesStrideSize,!0),o+=1,this.spriteRandomStartCell&&(T.cellStartOffset=D.createVertexBuffer("cellStartOffset",o,1,this._attributesStrideSize,!0),o+=1)),T.offset=N.createVertexBuffer("offset",0,2),T.uv=N.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(T),this._platform.createVertexBuffers(G,T),this.resetDrawCache()}_initialize(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!G)return;const D=this._engine,N=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof R&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const o=this.particleEmitterType instanceof R,Z=T.k.Ad[0];let n=0;for(let T=0;T<this._capacity;T++)if(N.push(0),N.push(0),N.push(0),N.push(0),N.push(0),N.push(0),N.push(0),N.push(0),N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),o?(this.particleEmitterType.particleDestinationGenerator(T,null,Z),N.push(Z.x),N.push(Z.y),N.push(Z.z)):(N.push(0),N.push(0),N.push(0)),this._platform.alignDataInBuffer&&N.push(0),n+=16,o&&(this.particleEmitterType.particlePositionGenerator(T,null,Z),N.push(Z.x),N.push(Z.y),N.push(Z.z),this._platform.alignDataInBuffer&&N.push(0),n+=4),this._colorGradientsTexture||(N.push(0),N.push(0),N.push(0),N.push(0),n+=4),this.isBillboardBased||(N.push(0),N.push(0),N.push(0),this._platform.alignDataInBuffer&&N.push(0),n+=4),this.noiseTexture&&(N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),this._platform.alignDataInBuffer&&N.push(0),N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),this._platform.alignDataInBuffer&&N.push(0),n+=8),N.push(0),n+=1,this._angularSpeedGradientsTexture||(N.push(0),n+=1),this._isAnimationSheetEnabled&&(N.push(0),n+=1,this.spriteRandomStartCell&&(N.push(0),n+=1)),this._platform.alignDataInBuffer){let G=3-(n+3&3);for(n+=G;G-- >0;)N.push(0)}const C=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),P=this._platform.createParticleBuffer(N),r=this._platform.createParticleBuffer(N);this._buffer0=new L.c(D,P,!1,this._attributesStrideSize),this._buffer1=new L.c(D,r,!1,this._attributesStrideSize),this._spriteBuffer=new L.c(D,C,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let G=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(G+="\n#define BILLBOARD"),this._colorGradientsTexture&&(G+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(G+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(G+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(G+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(G+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(G+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(G+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(G+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(G+="\n#define NOISE"),this.isLocal&&(G+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===G||(this._cachedUpdateDefines=G,this._updateBuffer=this._platform.createUpdateBuffer(G)),this._platform.isUpdateBufferReady()}_getWrapper(G){const D=this._getCustomDrawWrapper(G);if(null!==D&&void 0!==D&&D.effect)return D;const N=[];this.fillDefines(N,G);let T=this._drawWrappers[G];T||(T=new GG.c(this._engine),T.drawContext&&(T.drawContext.useInstancing=!0),this._drawWrappers[G]=T);const o=N.join("\n");if(T.defines!==o){const G=[],D=[],N=[];this.fillUniformsAttributesAndSamplerNames(D,G,N),T.setEffect(this._engine.createEffect("gpuRenderParticles",G,D,N,o),o)}return T}static _GetAttributeNamesOrOptions(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=[L.f.PositionKind,"age","life","size","angle"];return G||o.push(L.f.ColorKind),D&&o.push("cellIndex"),N||o.push("initialDirection"),T&&o.push("direction"),o.push("offset",L.f.UVKind),o}static _GetEffectCreationOptions(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0],D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T=["emitterWM","Ag","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,DG.e)(T),G&&T.push("sheetInfos"),D&&T.push("logarithmicDepthConstant"),N&&(T.push("vFogInfos"),T.push("vFogColor")),T}fillDefines(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,DG.k)(this,this._scene,G),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==mG.e.FOGMODE_NONE&&G.push("#define FOG")),D===yG.BLENDMODE_MULTIPLY&&G.push("#define BLENDMULTIPLYMODE"),this.isLocal&&G.push("#define LOCAL"),this.useLogarithmicDepth&&G.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(G.push("#define BILLBOARD"),this.billboardMode){case yG.BILLBOARDMODE_Y:G.push("#define BILLBOARDY");break;case yG.BILLBOARDMODE_STRETCHED:G.push("#define BILLBOARDSTRETCHED");break;case yG.BILLBOARDMODE_ALL:G.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&G.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&G.push("#define ANIMATESHEET"),N&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),G.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(G,D,N){D.push(...iG._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===yG.BILLBOARDMODE_STRETCHED)),G.push(...iG._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),N.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(hG.b.PrepareUniforms(G,this._imageProcessingConfigurationDefines),hG.b.PrepareSamplers(N,this._imageProcessingConfigurationDefines))}animate(){var G;let D=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(D?this.preWarmStepOffset:(null===(G=this._scene)||void 0===G?void 0:G.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(G,D){const N=this[D];if(!G||!G.length||N)return;const T=new Float32Array(this._rawTextureWidth);for(let o=0;o<this._rawTextureWidth;o++){const D=o/this._rawTextureWidth;a.GetCurrentGradient(D,G,((G,D,N)=>{T[o]=(0,r.o)(G.factor1,D.factor1,N)}))}this[D]=M.c.CreateRTexture(T,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[D].name=D.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const G=new Uint8Array(4*this._rawTextureWidth),D=n.k.Pd[0];for(let N=0;N<this._rawTextureWidth;N++){const T=N/this._rawTextureWidth;a.GetCurrentGradient(T,this._colorGradients,((T,o,Z)=>{n.g.LerpToRef(T.color1,o.color1,Z,D),G[4*N]=255*D.r,G[4*N+1]=255*D.g,G[4*N+2]=255*D.b,G[4*N+3]=255*D.a}))}this._colorGradientsTexture=M.c.CreateRGBATexture(G,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(G,D){var N,o,Z,n;const C=this._getWrapper(G),P=C.effect;this._engine.enableEffect(C);const r=(null===(N=this._scene)||void 0===N?void 0:N.getViewMatrix())||T.c.IdentityReadOnly;if(P.setMatrix("view",r),P.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),P.setTexture("diffuseSampler",this.particleTexture),P.setVector2("translationPivot",this.translationPivot),P.setVector3("Ag",this.Ag),this.isLocal&&P.setMatrix("emitterWM",D),this._colorGradientsTexture?P.setTexture("colorGradientSampler",this._colorGradientsTexture):P.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const G=this.particleTexture.getBaseSize();P.setFloat3("sheetInfos",this.spriteCellWidth/G.width,this.spriteCellHeight/G.height,G.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const G=this._scene.activeCamera;P.setVector3("eyePosition",G.globalPosition)}const v=P.defines;if(this._scene&&((0,DG.g)(P,this,this._scene),this.applyFog&&(0,NG.f)(this._scene,void 0,P)),v.indexOf("#define BILLBOARDMODE_ALL")>=0){const G=r.clone();G.invert(),P.setMatrix("invView",G)}switch(this.useLogarithmicDepth&&this._scene&&(0,NG.k)(v,P,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(P),G){case yG.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case yG.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case yG.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case yG.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,P,null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(P),null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(n=this._scene)&&void 0!==n&&n.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(G){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!G)if(this.k.position){G=this.k.getWorldMatrix()}else{const D=this.k;G=T.k.Matrix[0],T.c.TranslationToRef(D.x,D.y,D.z,G)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",G),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const D=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=D}render(){let G,D=arguments.length>0&&void 0!==arguments[0]&&arguments[0],N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!D&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let G=0;G<this.preWarmCycles;G++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const G=0|this._accumulatedCount;this._accumulatedCount-=G,this._currentActiveCount+=G}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){G=this.k.getWorldMatrix()}else{const D=this.k;G=T.k.Matrix[0],T.c.TranslationToRef(D.x,D.y,D.z,G)}const o=this._engine;this.updateInAnimate||this._update(G);let Z=0;return D||N||(o.setState(!1),this.forceDepthWrite&&o.setDepthWrite(!0),Z=this.blendMode===yG.BLENDMODE_MULTIPLYADD?this._render(yG.BLENDMODE_MULTIPLY,G)+this._render(yG.BLENDMODE_ADD,G):this._render(this.blendMode,G),this._engine.setAlphaMode(0)),Z}rebuild(){const G=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(G,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,G()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const D in this._drawWrappers){this._drawWrappers[D].dispose()}if(this._drawWrappers={},this._scene){const G=this._scene.fe.indexOf(this);G>-1&&this._scene.fe.splice(G,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let D=0;D<this._renderVertexBuffers.length;++D){const G=this._renderVertexBuffers[D];for(const D in G)G[D].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),G&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),G&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Fd.notifyObservers(this),this.Fd.clear()}clone(G,D){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const T={...this._customWrappers};let o=null;const Z=this._engine;if(Z.createEffectForParticles&&null!=this.customShader){o=this.customShader;const G=o.shaderOptions.defines.length>0?o.shaderOptions.defines.join("\n"):"";T[0]=Z.createEffectForParticles(o.shaderPath.fragmentElement,o.shaderOptions.uniforms,o.shaderOptions.samplers,G,void 0,void 0,void 0,this)}const n=this.serialize(N),C=iG.Parse(n,this._scene||this._engine,this._rootUrl);return C.name=G,C.customShader=o,C._customWrappers=T,void 0===D&&(D=this.k),this.noiseTexture&&(C.noiseTexture=this.noiseTexture.clone()),C.k=D,C}serialize(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const D={};return yG._Serialize(D,this,G),D.activeParticleCount=this.activeParticleCount,D.randomTextureSize=this._randomTextureSize,D.customShader=this.customShader,D}static Parse(G,D,N){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0;const Z=G.name;let n,C;D instanceof PG.b?n=D:(C=D,n=C.getEngine());const P=new iG(Z,{ze:o||G.ze,randomTextureSize:G.randomTextureSize},D,null,G.isAnimationSheetEnabled);if(P._rootUrl=N,G.customShader&&n.createEffectForParticles){const D=G.customShader,N=D.shaderOptions.defines.length>0?D.shaderOptions.defines.join("\n"):"",T=n.createEffectForParticles(D.shaderPath.fragmentElement,D.shaderOptions.uniforms,D.shaderOptions.samplers,N,void 0,void 0,void 0,P);P.setCustomEffect(T,0),P.customShader=D}return G.id&&(P.id=G.id),G.activeParticleCount&&(P.activeParticleCount=G.activeParticleCount),yG._Parse(G,P,D,N),G.preventAutoStart&&(P.preventAutoStart=G.preventAutoStart),T||P.preventAutoStart||P.start(),P}}var JG=N(1223),pG=N(11536),tG=N(1207);class HG{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(G){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const D of this.systems)D.k=G;this._emitterNode=G}setEmitterAsSphere(G,D,N){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:G,renderingGroupId:D};const T=(0,pG.d)("emitterSphere",{diameter:G.diameter,segments:G.segments},N);T.renderingGroupId=D;const o=new tG.e("emitterSphereMaterial",N);o.emissiveColor=G.color,T.material=o;for(const Z of this.systems)Z.k=T;this._emitterNode=T}start(G){for(const D of this.systems)G&&(D.k=G),D.start()}dispose(){for(const G of this.systems)G.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const D={systems:[]};for(const N of this.systems)D.systems.push(N.serialize(G));return this._emitterNode&&(D.k=this._emitterCreationOptions),D}static Parse(G,D){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3?arguments[3]:void 0;const o=new HG,Z=this.BaseAssetsUrl+"/textures/";D=D||e.e.LastCreatedScene;for(const n of G.systems)o.systems.push(N?iG.Parse(n,D,Z,!0,T):yG.Parse(n,D,Z,!0,T));if(G.k){const N=G.k.options;if("Sphere"===G.k.kind)o.setEmitterAsSphere({diameter:N.diameter,segments:N.segments,color:n.d.od(N.color)},G.k.renderingGroupId,D)}return o}}HG.BaseAssetsUrl="https://assets.babylonjs.com/particles";var sG=N(1064);class cG{static CreateDefault(G){let D,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,T=arguments.length>2?arguments[2]:void 0;return D=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new iG("default system",{ze:N},T):new yG("default system",N,T),D.k=G,D.particleTexture=new s.e("https://assets.babylonjs.com/textures/flare.png",D.va()),D.createConeEmitter(.1,Math.PI/4),D.color1=new n.g(1,1,1,1),D.color2=new n.g(1,1,1,1),D.colorDead=new n.g(1,1,1,0),D.minSize=.1,D.maxSize=.1,D.minEmitPower=2,D.maxEmitPower=2,D.updateSpeed=1/60,D.emitRate=30,D}static CreateAsync(G,D){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3?arguments[3]:void 0;D||(D=e.e.LastCreatedScene);const o={};return D.addPendingData(o),new Promise(((Z,n)=>{if(N&&!iG.IsSupported)return D.removePendingData(o),n("Particle system with GPU is not supported.");JG.f.LoadFile(`${cG.BaseAssetsUrl}/systems/${G}.json`,(G=>{D.removePendingData(o);const n=JSON.parse(G.toString());return Z(HG.Parse(n,D,N,T))}),void 0,void 0,void 0,(()=>(D.removePendingData(o),n(`An error occurred with the creation of your particle system. Check if your type '${G}' exists.`))))}))}static ExportSet(G){const D=new HG;for(const N of G)D.systems.push(N);return D}static ParseFromFileAsync(G,D,N){let T=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",Z=arguments.length>5?arguments[5]:void 0;return new Promise(((n,C)=>{const P=new sG.e;P.addEventListener("readystatechange",(()=>{if(4==P.readyState)if(200==P.status){const D=JSON.parse(P.responseText);let C;C=T?iG.Parse(D,N,o,!1,Z):yG.Parse(D,N,o,!1,Z),G&&(C.name=G),n(C)}else C("Unable to load the particle system")})),P.open("GET",D),P.send()}))}static ParseFromSnippetAsync(G,D){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4?arguments[4]:void 0;if("_BLANK"===G){const G=this.CreateDefault(null);return G.start(),Promise.resolve(G)}return new Promise(((Z,n)=>{const C=new sG.e;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){const n=JSON.parse(JSON.parse(C.responseText).jsonPayload),P=JSON.parse(n.particleSystem);let r;r=N?iG.Parse(P,D,T,!1,o):yG.Parse(P,D,T,!1,o),r.snippetId=G,Z(r)}else n("Unable to load the snippet "+G)})),C.open("GET",this.SnippetUrl+"/"+G.replace(/#/g,"/")),C.send()}))}}cG.BaseAssetsUrl=HG.BaseAssetsUrl,cG.SnippetUrl="https://snippet.babylonjs.com",cG.CreateFromSnippetAsync=cG.ParseFromSnippetAsync;var KG=N(11378),bG=N(1276),OG=N(11539);(0,OG.g)(bG.c.NAME_PARTICLESYSTEM,((G,D,N,T)=>{const o=(0,OG.j)(bG.c.NAME_PARTICLESYSTEM);if(o&&void 0!==G.fe&&null!==G.fe)for(let Z=0,n=G.fe.length;Z<n;Z++){const n=G.fe[Z];N.fe.push(o(n,D,T))}})),(0,OG.e)(bG.c.NAME_PARTICLESYSTEM,((G,D,N)=>{if(G.activeParticleCount){return iG.Parse(G,D,N)}return yG.Parse(G,D,N)})),PG.b.prototype.createEffectForParticles=function(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",Z=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0,C=arguments.length>6?arguments[6]:void 0,P=arguments.length>7?arguments[7]:void 0,r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,v=[],q=[];const g=[];return P?P.fillUniformsAttributesAndSamplerNames(q,v,g):(v=yG._GetAttributeNamesOrOptions(),q=yG._GetEffectCreationOptions()),-1===o.indexOf(" BILLBOARD")&&(o+="\n#define BILLBOARD\n"),null!==P&&void 0!==P&&P.isAnimationSheetEnabled&&-1===o.indexOf(" ANIMATESHEET")&&(o+="\n#define ANIMATESHEET\n"),-1===T.indexOf("diffuseSampler")&&T.push("diffuseSampler"),this.createEffect({vertex:(null===P||void 0===P?void 0:P.vertexShaderName)??"particles",fragmentElement:G},v,q.concat(D),g.concat(T),o,Z,n,C,void 0,r,(async()=>{0===r?await Promise.resolve().then(N.bind(N,11561)):await Promise.resolve().then(N.bind(N,11574))}))},KG.d.prototype.getEmittedParticleSystems=function(){const G=[];for(let D=0;D<this.va().fe.length;D++){const N=this.va().fe[D];N.k===this&&G.push(N)}return G},KG.d.prototype.getHierarchyEmittedParticleSystems=function(){const G=[],D=this.getDescendants();D.push(this);for(let N=0;N<this.va().fe.length;N++){const T=this.va().fe[N],o=T.k;o.position&&-1!==D.indexOf(o)&&G.push(T)}return G};N(1347),N(1359),N(11428);N(11407),N(11547),N(1477),N(1337),N(11441);N(1473);var QG;N(11552),N(1047);!function(G){G[G.Color=2]="Color",G[G.UV=1]="UV",G[G.Random=0]="Random",G[G.Stated=3]="Stated"}(QG||(QG={}));N(11559),N(11561),N(11569),N(11574)},10605:(G,D,N)=>{"use strict";const T="clipPlaneFragment",o="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";N(1133).d.IncludesShadersStoreWGSL[T]=o},10596:(G,D,N)=>{"use strict";const T="clipPlaneFragmentDeclaration",o="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";N(1133).d.IncludesShadersStoreWGSL[T]=o},10517:(G,D,N)=>{"use strict";const T="clipPlaneVertex",o="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";N(1133).d.IncludesShadersStoreWGSL[T]=o},10432:(G,D,N)=>{"use strict";const T="clipPlaneVertexDeclaration",o="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";N(1133).d.IncludesShadersStoreWGSL[T]=o},10648:(G,D,N)=>{"use strict";const T="fogFragment",o="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";N(1133).d.IncludesShadersStoreWGSL[T]=o},10601:(G,D,N)=>{"use strict";const T="fogFragmentDeclaration",o="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";N(1133).d.IncludesShadersStoreWGSL[T]=o},10522:(G,D,N)=>{"use strict";const T="fogVertex",o="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";N(1133).d.IncludesShadersStoreWGSL[T]=o},10439:(G,D,N)=>{"use strict";const T="fogVertexDeclaration",o="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";N(1133).d.IncludesShadersStoreWGSL[T]=o},10389:(G,D,N)=>{"use strict";const T="helperFunctions",o="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";N(1133).d.IncludesShadersStoreWGSL[T]=o},10569:(G,D,N)=>{"use strict";const T="imageProcessingDeclaration",o="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";N(1133).d.IncludesShadersStoreWGSL[T]=o},10577:(G,D,N)=>{"use strict";const T="imageProcessingFunctions",o="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";N(1133).d.IncludesShadersStoreWGSL[T]=o},10464:(G,D,N)=>{"use strict";const T="logDepthDeclaration",o="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";N(1133).d.IncludesShadersStoreWGSL[T]=o},10640:(G,D,N)=>{"use strict";const T="logDepthFragment",o="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";N(1133).d.IncludesShadersStoreWGSL[T]=o},10537:(G,D,N)=>{"use strict";const T="logDepthVertex",o="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";N(1133).d.IncludesShadersStoreWGSL[T]=o},11569:(G,D,N)=>{"use strict";N.r(D),N.d(D,{particlesPixelShaderWGSL:()=>n});var T=N(1133);N(10596),N(10569),N(10464),N(10389),N(10577),N(10601),N(10605),N(10640),N(10648);const o="particlesPixelShader",Z="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";T.d.ShadersStoreWGSL[o]=Z;const n={name:o,shader:Z}},11574:(G,D,N)=>{"use strict";N.r(D),N.d(D,{particlesVertexShaderWGSL:()=>n});var T=N(1133);N(10432),N(10439),N(10464),N(10517),N(10522),N(10537);const o="particlesVertexShader",Z="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";T.d.ShadersStoreWGSL[o]=Z;const n={name:o,shader:Z}},10930:(G,D,N)=>{"use strict";const T="clipPlaneFragment",o="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";N(1133).d.IncludesShadersStore[T]=o},10916:(G,D,N)=>{"use strict";const T="clipPlaneFragmentDeclaration",o="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";N(1133).d.IncludesShadersStore[T]=o},10814:(G,D,N)=>{"use strict";const T="clipPlaneVertex",o="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";N(1133).d.IncludesShadersStore[T]=o},10728:(G,D,N)=>{"use strict";const T="clipPlaneVertexDeclaration",o="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";N(1133).d.IncludesShadersStore[T]=o},10964:(G,D,N)=>{"use strict";const T="fogFragment",o="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";N(1133).d.IncludesShadersStore[T]=o},10922:(G,D,N)=>{"use strict";const T="fogFragmentDeclaration",o="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";N(1133).d.IncludesShadersStore[T]=o},10817:(G,D,N)=>{"use strict";const T="fogVertex",o="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";N(1133).d.IncludesShadersStore[T]=o},10736:(G,D,N)=>{"use strict";const T="fogVertexDeclaration",o="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";N(1133).d.IncludesShadersStore[T]=o},10693:(G,D,N)=>{"use strict";const T="helperFunctions",o="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";N(1133).d.IncludesShadersStore[T]=o},10893:(G,D,N)=>{"use strict";const T="imageProcessingDeclaration",o="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";N(1133).d.IncludesShadersStore[T]=o},10899:(G,D,N)=>{"use strict";const T="imageProcessingFunctions",o="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";N(1133).d.IncludesShadersStore[T]=o},10755:(G,D,N)=>{"use strict";const T="logDepthDeclaration",o="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";N(1133).d.IncludesShadersStore[T]=o},10962:(G,D,N)=>{"use strict";const T="logDepthFragment",o="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";N(1133).d.IncludesShadersStore[T]=o},10838:(G,D,N)=>{"use strict";const T="logDepthVertex",o="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";N(1133).d.IncludesShadersStore[T]=o},11559:(G,D,N)=>{"use strict";N.r(D),N.d(D,{particlesPixelShader:()=>n});var T=N(1133);N(10916),N(10893),N(10755),N(10693),N(10899),N(10922),N(10930),N(10962),N(10964);const o="particlesPixelShader",Z="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";T.d.ShadersStore[o]=Z;const n={name:o,shader:Z}},11561:(G,D,N)=>{"use strict";N.r(D),N.d(D,{particlesVertexShader:()=>n});var T=N(1133);N(10728),N(10736),N(10755),N(10814),N(10817),N(10838);const o="particlesVertexShader",Z="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";T.d.ShadersStore[o]=Z;const n={name:o,shader:Z}},11399:(G,D,N)=>{"use strict";N.d(D,{b:()=>q});var T=N(980),o=N(1009),Z=N(985),n=N(1003),C=N(1030),P=N(1094),r=N(1181);class v{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new n.b,this._onClonedObservable=new n.b}}class q{static AddNodeConstructor(G,D){this._NodeConstructors[G]=D}static Construct(G,D,N,T){const o=this._NodeConstructors[G];return o?o(D,N,T):null}set accessibilityTag(G){this._accessibilityTag=G,this.onAccessibilityTagChangedObservable.notifyObservers(G)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(G){this._nodeDataStorage._doNotSerialize=G}u(){return this._nodeDataStorage._isDisposed}set parent(G){if(this._parentNode===G)return;const D=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const D=this._parentNode._children.indexOf(this);-1!==D&&this._parentNode._children.splice(D,1),G||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=G,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),D||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(G){G.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const G=this._scene.rootNodes,D=G.length-1;G[this._nodeDataStorage._sceneRootNodesIndex]=G[D],G[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(G){this._animationPropertiesOverride=G}getClassName(){return"Node"}set onDispose(G){this._onDisposeObserver&&this.Fd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Fd.add(G)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new v,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new n.b,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=o.c.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.Fd=new n.b,this._onDisposeObserver=null,this._behaviors=new Array,this.name=G,this.id=G,this._scene=D||C.e.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),N&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(G)||(G.init(),this._scene.isLoading&&!D?this._scene.onDataLoadedObservable.addOnce((()=>{G.attach(this)})):G.attach(this),this._behaviors.push(G)),this}removeBehavior(G){const D=this._behaviors.indexOf(G);return-1===D||(this._behaviors[D].detach(),this._behaviors.splice(D,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(G){for(const D of this._behaviors)if(D.name===G)return D;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.se(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(G){!G&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(G){return this.parent?this.parent._getActionManagerForTrigger(G,!1):null}_updateCache(G){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}we(G){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((G=>{G._syncParentEnabledState()}))}Lg(G){this._nodeDataStorage._isEnabled!==G&&(this._nodeDataStorage._isEnabled=G,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(G))}isDescendantOf(G){return!!this.parent&&(this.parent===G||this.parent.isDescendantOf(G))}_getDescendants(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2?arguments[2]:void 0;if(this._children)for(let T=0;T<this._children.length;T++){const o=this._children[T];N&&!N(o)||G.push(o),D||o._getDescendants(G,!1,N)}}getDescendants(G,D){const N=[];return this._getDescendants(N,G,D),N}getChildMeshes(G,D){const N=[];return this._getDescendants(N,G,(G=>(!D||D(G))&&void 0!==G.Le)),N}getChildren(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(D,G)}_setReady(G){G!==this._nodeDataStorage._isReady&&(G?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(G){for(let D=0;D<this.animations.length;D++){const N=this.animations[D];if(N.name===G)return N}return null}createAnimationRange(G,D,N){if(!this._ranges[G]){this._ranges[G]=q._AnimationRangeFactory(G,D,N);for(let T=0,o=this.animations.length;T<o;T++)this.animations[T]&&this.animations[T].createRange(G,D,N)}}deleteAnimationRange(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let N=0,T=this.animations.length;N<T;N++)this.animations[N]&&this.animations[N].deleteRange(G,D);this._ranges[G]=null}getAnimationRange(G){return this._ranges[G]||null}clone(G,D,N){const T=r.e.Clone((()=>new q(G,this.va())),this);if(D&&(T.parent=D),!N){const D=this.getDescendants(!0);for(let N=0;N<D.length;N++){const o=D[N];o.clone(G+"."+o.name,T)}}return T}getAnimationRanges(){const G=[];let D;for(D in this._ranges)G.push(this._ranges[D]);return G}beginAnimation(G,D,N,T){const o=this.getAnimationRange(G);return o?this._scene.beginAnimation(this,o.from,o.to,D,N,T):null}serializeAnimationRanges(){const G=[];for(const D in this._ranges){const N=this._ranges[D];if(!N)continue;const T={};T.name=D,T.from=N.from,T.to=N.to,G.push(T)}return G}se(G){return this._worldMatrix||(this._worldMatrix=o.c.Identity()),this._worldMatrix}dispose(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!G){const N=this.getDescendants(!0);for(const T of N)T.dispose(G,D)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.Fd.notifyObservers(this),this.Fd.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const N of this._behaviors)N.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(G,D,N){if(D.ranges)for(let T=0;T<D.ranges.length;T++){const N=D.ranges[T];G.createAnimationRange(N.name,N.from,N.to)}}getHierarchyBoundingVectors(){let G,D,N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],T=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.se(!0);const Z=this;if(Z.getBoundingInfo&&Z.le){const N=Z.getBoundingInfo();G=N.boundingBox.minimumWorld.clone(),D=N.boundingBox.maximumWorld.clone()}else G=new o.s(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),D=new o.s(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(N){const N=this.getDescendants(!1);for(const Z of N){const N=Z;if(N.se(!0),T&&!T(N))continue;if(!N.getBoundingInfo||0===N.getTotalVertices())continue;const n=N.getBoundingInfo().boundingBox,C=n.minimumWorld,P=n.maximumWorld;o.s.CheckExtends(C,G,D),o.s.CheckExtends(P,G,D)}}return{min:G,max:D}}}q._AnimationRangeFactory=(G,D,N)=>{throw(0,P.d)("AnimationRange")},q._NodeConstructors={},(0,T.c)([(0,Z.S)()],q.prototype,"name",void 0),(0,T.c)([(0,Z.S)()],q.prototype,"id",void 0),(0,T.c)([(0,Z.S)()],q.prototype,"uniqueId",void 0),(0,T.c)([(0,Z.S)()],q.prototype,"state",void 0),(0,T.c)([(0,Z.S)()],q.prototype,"metadata",void 0)},11701:(G,D,N)=>{"use strict";class T{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((G,D)=>{this._resolve=G,this._reject=D}))}}var o=N(1009),Z=N(1185),n=N(1223),C=N(11393),P=N(11703),r=N(11724),v=N(1003),q=N(11529),g=N(11733),X=N(11736),W=N(1030),j=N(1105),Y=N(1225);class y{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(G){this._useTextureToStoreBoneMatrices=G,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(G){this._animationPropertiesOverride=G}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(G,D,N){this.name=G,this.id=D,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=o.c.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new v.b,this.bones=[],this._scene=N||W.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const T=this._scene.getEngine().getCaps();this._canUseTextureForBones=T.textureFloat&&T.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((G=>!G.getParent()))}getTransformMatrices(G){if(this.needInitialSkinMatrix){if(!G)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return G._bonesTransformMatrices||this.prepare(!0),G._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(G){return this.needInitialSkinMatrix&&G._transformMatrixTexture?G._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(G){let D=`Name: ${this.name}, nBones: ${this.bones.length}`;if(D+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,G){D+=", Ranges: {";let G=!0;for(const N in this._ranges)G&&(D+=", ",G=!1),D+=N;D+="}"}return D}getBoneIndexByName(G){for(let D=0,N=this.bones.length;D<N;D++)if(this.bones[D].name===G)return D;return-1}createAnimationRange(G,D,N){if(!this._ranges[G]){this._ranges[G]=new X.d(G,D,N);for(let T=0,o=this.bones.length;T<o;T++)this.bones[T].animations[0]&&this.bones[T].animations[0].createRange(G,D,N)}}deleteAnimationRange(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let N=0,T=this.bones.length;N<T;N++)this.bones[N].animations[0]&&this.bones[N].animations[0].deleteRange(G,D);this._ranges[G]=null}getAnimationRange(G){return this._ranges[G]||null}getAnimationRanges(){const G=[];let D;for(D in this._ranges)G.push(this._ranges[D]);return G}copyAnimationRange(G,D){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[D]||!G.getAnimationRange(D))return!1;let T=!0;const o=this._getHighestAnimationFrame()+1,Z={},n=G.bones;let C,P;for(P=0,C=n.length;P<C;P++)Z[n[P].name]=n[P];this.bones.length!==n.length&&(j.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${n.length}`),T=!1);const r=N&&this.dimensionsAtRest&&G.dimensionsAtRest?this.dimensionsAtRest.divide(G.dimensionsAtRest):null;for(P=0,C=this.bones.length;P<C;P++){const G=this.bones[P].name,n=Z[G];n?T=T&&this.bones[P].copyAnimationRange(n,D,o,N,r):(j.d.Warn("copyAnimationRange: not same rig, missing source bone "+G),T=!1)}const v=G.getAnimationRange(D);return v&&(this._ranges[D]=new X.d(D,v.from+o,v.to+o)),T}returnToRest(){for(const G of this.bones)-1!==G._index&&G.returnToRest()}_getHighestAnimationFrame(){let G=0;for(let D=0,N=this.bones.length;D<N;D++)if(this.bones[D].animations[0]){const N=this.bones[D].animations[0].getHighestFrame();G<N&&(G=N)}return G}beginAnimation(G,D,N,T){const o=this.getAnimationRange(G);return o?this._scene.beginAnimation(this,o.from,o.to,D,N,T):null}static MakeAnimationAdditive(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2?arguments[2]:void 0;const T=G.getAnimationRange(N);if(!T)return null;const o=G._scene.getAllAnimatablesByTarget(G);let Z=null;for(let C=0;C<o.length;C++){const G=o[C];if(G.fromFrame===(null===T||void 0===T?void 0:T.from)&&G.toFrame===(null===T||void 0===T?void 0:T.to)){Z=G;break}}const n=G.getAnimatables();for(let C=0;C<n.length;C++){const G=n[C].animations;if(G)for(let T=0;T<G.length;T++)g.b.MakeAnimationAdditive(G[T],D,N)}return Z&&(Z.isAdditive=!0),G}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(G){this._meshesWithPoseMatrix.push(G)}_unregisterMeshWithPoseMatrix(G){const D=this._meshesWithPoseMatrix.indexOf(G);D>-1&&this._meshesWithPoseMatrix.splice(D,1)}_computeTransformMatrices(G,D){this.onBeforeComputeObservable.notifyObservers(this);for(let N=0;N<this.bones.length;N++){const T=this.bones[N];T._childUpdateId++;const o=T.getParent();if(o?T.getLocalMatrix().multiplyToRef(o.getFinalMatrix(),T.getFinalMatrix()):D?T.getLocalMatrix().multiplyToRef(D,T.getFinalMatrix()):T.getFinalMatrix().p(T.getLocalMatrix()),-1!==T._index){const D=null===T._index?N:T._index;T.getAbsoluteInverseBindMatrix().multiplyToArray(T.getFinalMatrix(),G,16*D)}}this._identity.copyToArray(G,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const G=this.va().getRenderId();if(this._currentRenderId===G)return;this._currentRenderId=G}if(this._numBonesWithLinkedTransformNode>0)for(const G of this.bones)if(G._linkedTransformNode){const D=G._linkedTransformNode;G.position=D.position,D.rotationQuaternion?G.rotationQuaternion=D.rotationQuaternion:G.rotation=D.rotation,G.Ed=D.Ed}if(this.needInitialSkinMatrix)for(const G of this._meshesWithPoseMatrix){const D=G.getPoseMatrix();let N=this._isDirty;if(G._bonesTransformMatrices&&G._bonesTransformMatrices.length===16*(this.bones.length+1)||(G._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),N=!0),N){if(this._synchronizedWithMesh!==G){this._synchronizedWithMesh=G;for(const G of this.bones)if(!G.getParent()){G.getBindMatrix().multiplyToRef(D,o.k.Matrix[1]),G._updateAbsoluteBindMatrices(o.k.Matrix[1])}if(this.isUsingTextureForMatrices){const D=4*(this.bones.length+1);G._transformMatrixTexture&&G._transformMatrixTexture.getSize().width===D||(G._transformMatrixTexture&&G._transformMatrixTexture.dispose(),G._transformMatrixTexture=q.c.CreateRGBATexture(G._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(G._bonesTransformMatrices,D),this.isUsingTextureForMatrices&&G._transformMatrixTexture&&G._transformMatrixTexture.update(G._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=q.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let G=0;G<this.bones.length;G++)this._animatables.push(this.bones[G])}return this._animatables}clone(G,D){const N=new y(G,D||G,this._scene);N.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let T=0;T<this.bones.length;T++){const G=this.bones[T];let D=null;const o=G.getParent();if(o){const G=this.bones.indexOf(o);D=N.bones[G]}const Z=new r.e(G.name,N,D,G.getBindMatrix().clone(),G.getRestMatrix().clone());Z._index=G._index,G._linkedTransformNode&&Z.linkTransformNode(G._linkedTransformNode),Y.e.DeepCopy(G.animations,Z.animations)}if(this._ranges){N._ranges={};for(const G in this._ranges){const D=this._ranges[G];D&&(N._ranges[G]=D.clone())}}return this._isDirty=!0,N.prepare(!0),N}enableBlending(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((D=>{D.animations.forEach((D=>{D.enableBlending=!0,D.blendingSpeed=G}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const G=this._parentContainer.skeletons.indexOf(this);G>-1&&this._parentContainer.skeletons.splice(G,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const G={};G.name=this.name,G.id=this.id,this.dimensionsAtRest&&(G.dimensionsAtRest=this.dimensionsAtRest.vd()),G.bones=[],G.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let N=0;N<this.bones.length;N++){var D;const T=this.bones[N],o=T.getParent(),Z={parentBoneIndex:o?this.bones.indexOf(o):-1,index:T.getIndex(),name:T.name,id:T.id,matrix:T.getBindMatrix().vd(),rest:T.getRestMatrix().vd(),linkedTransformNodeId:null===(D=T.getTransformNode())||void 0===D?void 0:D.id};G.bones.push(Z),T.length&&(Z.length=T.length),T.metadata&&(Z.metadata=T.metadata),T.animations&&T.animations.length>0&&(Z.animation=T.animations[0].serialize()),G.ranges=[];for(const D in this._ranges){const N=this._ranges[D];if(!N)continue;const T={};T.name=D,T.from=N.from,T.to=N.to,G.ranges.push(T)}}return G}static Parse(G,D){const N=new y(G.name,G.id,D);let T;for(G.dimensionsAtRest&&(N.dimensionsAtRest=o.s.od(G.dimensionsAtRest)),N.needInitialSkinMatrix=G.needInitialSkinMatrix,T=0;T<G.bones.length;T++){const D=G.bones[T],Z=G.bones[T].index;let n=null;D.parentBoneIndex>-1&&(n=N.bones[D.parentBoneIndex]);const C=D.rest?o.c.od(D.rest):null,P=new r.e(D.name,N,n,o.c.od(D.matrix),C,null,Z);void 0!==D.id&&null!==D.id&&(P.id=D.id),D.length&&(P.length=D.length),D.metadata&&(P.metadata=D.metadata),D.animation&&P.animations.push(g.b.Parse(D.animation)),void 0!==D.linkedTransformNodeId&&null!==D.linkedTransformNodeId&&(N._hasWaitingData=!0,P._waitingTransformNodeId=D.linkedTransformNodeId)}if(G.ranges)for(T=0;T<G.ranges.length;T++){const D=G.ranges[T];N.createAnimationRange(D.name,D.from,D.to)}return N}computeAbsoluteMatrices(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||G)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(G)}getPoseMatrix(){let G=null;return this._meshesWithPoseMatrix.length>0&&(G=this._meshesWithPoseMatrix[0].getPoseMatrix()),G}sortBones(){const G=[],D=new Array(this.bones.length);for(let N=0;N<this.bones.length;N++)this._sortBones(N,G,D);this.bones=G}_sortBones(G,D,N){if(N[G])return;N[G]=!0;const T=this.bones[G];if(!T)return;void 0===T._index&&(T._index=G);const o=T.getParent();o&&this._sortBones(this.bones.indexOf(o),D,N),D.push(T)}setCurrentPoseAsRest(){this.bones.forEach((G=>{G.setCurrentPoseAsRest()}))}}var h=N(1329),m=N(980),R=N(985),L=N(11740),w=N(11744),B=N(1018),F=N(1181);class S extends w.c{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(G){this.subSurface.refractionTexture=G,G?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(G){this.subSurface.indexOfRefraction=G}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(G){this.subSurface.invertRefractionY=G}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(G){this.subSurface.linkRefractionWithTransparency=G,G&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===w.c.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(G){G!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=G?w.c.LIGHTFALLOFF_PHYSICAL:w.c.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===w.c.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(G){G!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=G?w.c.LIGHTFALLOFF_GLTF:w.c.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(G){this._attachImageProcessingConfiguration(G),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(G){this.imageProcessingConfiguration.colorCurvesEnabled=G}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(G){this.imageProcessingConfiguration.colorGradingEnabled=G}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(G){this._imageProcessingConfiguration.toneMappingEnabled=G}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(G){this._imageProcessingConfiguration.exposure=G}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(G){this._imageProcessingConfiguration.contrast=G}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(G){this._imageProcessingConfiguration.colorGradingTexture=G}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(G){this._imageProcessingConfiguration.colorCurves=G}constructor(G,D){super(G,D,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=S.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=Z.d.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new Z.d(0,0,0),this.albedoColor=new Z.d(1,1,1),this.reflectivityColor=new Z.d(1,1,1),this.reflectionColor=new Z.d(1,1,1),this.emissiveColor=new Z.d(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,L.b)(this.va())}getClassName(){return"PBRMaterial"}clone(G){let D=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const T=F.e.Clone((()=>new S(G,this.va())),this,{cloneTexturesOnlyOnce:D});return T.id=G,T.name=G,this.stencil.copyTo(T.stencil),this._clonePlugins(T,N),T}serialize(){const G=super.serialize();return G.customType="BABYLON.PBRMaterial",G}static Parse(G,D,N){const T=F.e.Parse((()=>new S(G.name,D)),G,D,N);return G.stencil&&T.stencil.parse(G.stencil,D,N),h.d._ParsePlugins(G,T,D,N),G.clearCoat&&T.clearCoat.parse(G.clearCoat,D,N),G.anisotropy&&T.anisotropy.parse(G.anisotropy,D,N),G.brdf&&T.brdf.parse(G.brdf,D,N),G.sheen&&T.sheen.parse(G.sheen,D,N),G.subSurface&&T.subSurface.parse(G.subSurface,D,N),G.iridescence&&T.iridescence.parse(G.iridescence,D,N),T}}S.PBRMATERIAL_OPAQUE=w.c.PBRMATERIAL_OPAQUE,S.PBRMATERIAL_ALPHATEST=w.c.PBRMATERIAL_ALPHATEST,S.PBRMATERIAL_ALPHABLEND=w.c.PBRMATERIAL_ALPHABLEND,S.PBRMATERIAL_ALPHATESTANDBLEND=w.c.PBRMATERIAL_ALPHATESTANDBLEND,S.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=w.c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"directIntensity",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"emissiveIntensity",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"environmentIntensity",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"specularIntensity",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"disableBumpMap",void 0),(0,m.c)([(0,R.G)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"albedoTexture",void 0),(0,m.c)([(0,R.G)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientTexture",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientTextureStrength",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,m.c)([(0,R.G)(),(0,R.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"opacityTexture",void 0),(0,m.c)([(0,R.G)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectionTexture",void 0),(0,m.c)([(0,R.G)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"emissiveTexture",void 0),(0,m.c)([(0,R.G)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectivityTexture",void 0),(0,m.c)([(0,R.G)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallicTexture",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallic",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"roughness",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallicF0Factor",void 0),(0,m.c)([(0,R.m)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallicReflectanceColor",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,m.c)([(0,R.G)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"metallicReflectanceTexture",void 0),(0,m.c)([(0,R.G)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectanceTexture",void 0),(0,m.c)([(0,R.G)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"microSurfaceTexture",void 0),(0,m.c)([(0,R.G)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"bumpTexture",void 0),(0,m.c)([(0,R.G)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty",null)],S.prototype,"lightmapTexture",void 0),(0,m.c)([(0,R.m)("ambient"),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"ambientColor",void 0),(0,m.c)([(0,R.m)("albedo"),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"albedoColor",void 0),(0,m.c)([(0,R.m)("reflectivity"),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectivityColor",void 0),(0,m.c)([(0,R.m)("reflection"),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"reflectionColor",void 0),(0,m.c)([(0,R.m)("emissive"),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"emissiveColor",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"microSurface",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useLightmapAsShadowmap",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"useAlphaFromAlbedoTexture",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"forceAlphaTest",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesAndMiscDirty")],S.prototype,"alphaCutOff",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useSpecularOverAlpha",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useAmbientInGrayScale",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,m.c)([(0,R.S)()],S.prototype,"usePhysicalLightFalloff",null),(0,m.c)([(0,R.S)()],S.prototype,"useGLTFLightFalloff",null),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRadianceOverAlpha",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useObjectSpaceNormalMap",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useParallax",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useParallaxOcclusion",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"parallaxScaleBias",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsLightsDirty")],S.prototype,"disableLighting",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"forceIrradianceInFragment",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsLightsDirty")],S.prototype,"maxSimultaneousLights",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"invertNormalMapX",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"invertNormalMapY",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"twoSidedLighting",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useAlphaFresnel",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useLinearAlphaFresnel",void 0),(0,m.c)([(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"environmentBRDFTexture",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"forceNormalForward",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"enableSpecularAntiAliasing",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useHorizonOcclusion",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsTexturesDirty")],S.prototype,"useRadianceOcclusion",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsMiscDirty")],S.prototype,"unlit",void 0),(0,m.c)([(0,R.S)(),(0,R.e)("_markAllSubMeshesAsMiscDirty")],S.prototype,"applyDecalMapAfterDetailMap",void 0),(0,B.h)("BABYLON.PBRMaterial",S);var V=N(978),U=N(11437),z=N(1255),i=N(11412),J=N(11428),p=N(11378);class t{get influence(){return this._influence}set influence(G){if(this._influence===G)return;const D=this._influence;this._influence=G,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===D||0===G)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(G){this._animationPropertiesOverride=G}constructor(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=G,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new v.b,this._onDataLayoutChanged=new v.b,this._animationPropertiesOverride=null,this.id=G,this._scene=N||W.e.LastCreatedScene,this.influence=D,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(G){const D=this.hasPositions;this._positions=G,D!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(G){const D=this.hasNormals;this._normals=G,D!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(G){const D=this.hasTangents;this._tangents=G,D!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(G){const D=this.hasUVs;this._uvs=G,D!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const G=F.e.Clone((()=>new t(this.name,this.influence,this._scene)),this);return G._positions=this._positions,G._normals=this._normals,G._tangents=this._tangents,G._uvs=this._uvs,G}serialize(){const G={};return G.name=this.name,G.influence=this.influence,G.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(G.id=this.id),this.hasNormals&&(G.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(G.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(G.Aa=Array.prototype.slice.call(this.getUVs())),F.e.AppendSerializedAnimations(this,G),G}getClassName(){return"MorphTarget"}static Parse(G,D){const N=new t(G.name,G.influence);if(N.setPositions(G.xa),null!=G.id&&(N.id=G.id),G.ya&&N.setNormals(G.ya),G.tangents&&N.setTangents(G.tangents),G.Aa&&N.setUVs(G.Aa),G.animations){for(let D=0;D<G.animations.length;D++){const T=G.animations[D],o=(0,B.e)("BABYLON.Animation");o&&N.animations.push(o.Parse(T))}G.autoAnimate&&D&&D.beginAnimation(N,G.autoAnimateFrom,G.autoAnimateTo,G.autoAnimateLoop,G.autoAnimateSpeed||1)}return N}static FromMesh(G,D,N){D||(D=G.name);const T=new t(D,N,G.va());return T.setPositions(G.getVerticesData(z.f.PositionKind)),G.isVerticesDataPresent(z.f.NormalKind)&&T.setNormals(G.getVerticesData(z.f.NormalKind)),G.isVerticesDataPresent(z.f.TangentKind)&&T.setTangents(G.getVerticesData(z.f.TangentKind)),G.isVerticesDataPresent(z.f.UVKind)&&T.setUVs(G.getVerticesData(z.f.UVKind)),T}}(0,m.c)([(0,R.S)()],t.prototype,"id",void 0);var H=N(1210),s=N(1552);class c{set areUpdatesFrozen(G){G?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new H.e(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,G||(G=W.e.LastCreatedScene),this._scene=G,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const G=this._scene.getEngine().getCaps();this._canUseTextureForTargets=G.canUseGLVertexID&&G.textureFloat&&G.maxVertexTextureImageUnits>0&&G.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(G){this._numMaxInfluencers!==G&&(this._numMaxInfluencers=G,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(G){this._useTextureToStoreTargets=G}get isUsingTextureForTargets(){var G;return c.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(G=this._scene)&&void 0!==G&&G.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(G){return this._activeTargets.data[G]}getTarget(G){return this._targets[G]}getTargetByName(G){for(const D of this._targets)if(D.name===G)return D;return null}addTarget(G){this._targets.push(G),this._targetInfluenceChangedObservers.push(G.onInfluenceChanged.add((G=>{this._syncActiveTargets(G)}))),this._targetDataLayoutChangedObservers.push(G._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(G){const D=this._targets.indexOf(G);D>=0&&(this._targets.splice(D,1),G.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(D,1)[0]),G._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(D,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(G)}_bind(G){G.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),G.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),G.setTexture("morphTargets",this._targetStoreTexture),G.setInt("morphTargetCount",this.numInfluencers)}clone(){const G=new c(this._scene);for(const D of this._targets)G.addTarget(D.clone());return G.enableNormalMorphing=this.enableNormalMorphing,G.enableTangentMorphing=this.enableTangentMorphing,G.enableUVMorphing=this.enableUVMorphing,G}serialize(){const G={};G.id=this.uniqueId,G.targets=[];for(const D of this._targets)G.targets.push(D.serialize());return G}_syncActiveTargets(G){if(this.areUpdatesFrozen)return;let D=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let N=-1;for(const T of this._targets){if(N++,0===T.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=c.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(T),this._morphTargetTextureIndices[D]=N,this._tempInfluences[D++]=T.influence,this._supportsNormals=this._supportsNormals&&T.hasNormals,this._supportsTangents=this._supportsTangents&&T.hasTangents,this._supportsUVs=this._supportsUVs&&T.hasUVs;const G=T.getPositions();if(G){const D=G.length/3;if(0===this._vertexCount)this._vertexCount=D;else if(this._vertexCount!==D)return void j.d.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==D&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,D)),this._influences&&this._influences.length===D||(this._influences=new Float32Array(D));for(let T=0;T<D;T++)this._influences[T]=this._tempInfluences[T];G&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const G=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>G&&(this._textureHeight=Math.ceil(this._textureWidth/G),this._textureWidth=G);let D=!0;if(this._targetStoreTexture){const G=this._targetStoreTexture.getSize();G.width===this._textureWidth&&G.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(D=!1)}if(D){this._targetStoreTexture&&this._targetStoreTexture.dispose();const G=this._targets.length,D=new Float32Array(G*this._textureWidth*this._textureHeight*4);let N=0;for(let T=0;T<G;T++){const G=this._targets[T],o=G.getPositions(),Z=G.getNormals(),n=G.getUVs(),C=G.getTangents();if(!o)return void(0===T&&j.d.Error("Invalid morph target. Target must have positions."));N=T*this._textureWidth*this._textureHeight*4;for(let T=0;T<this._vertexCount;T++)D[N]=o[3*T],D[N+1]=o[3*T+1],D[N+2]=o[3*T+2],N+=4,this._supportsNormals&&Z&&(D[N]=Z[3*T],D[N+1]=Z[3*T+1],D[N+2]=Z[3*T+2],N+=4),this._supportsUVs&&n&&(D[N]=n[2*T],D[N+1]=n[2*T+1],N+=4),this._supportsTangents&&C&&(D[N]=C[3*T],D[N+1]=C[3*T+1],D[N+2]=C[3*T+2],N+=4)}this._targetStoreTexture=s.e.CreateRGBATexture(D,this._textureWidth,this._textureHeight,G,this._scene,!1,!1,1,1)}}for(const G of this._scene.meshes)G.morphTargetManager===this&&G._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const G=this._parentContainer.morphTargetManagers.indexOf(this);G>-1&&this._parentContainer.morphTargetManagers.splice(G,1),this._parentContainer=null}for(const G of this._targets)this._scene.stopAnimation(G)}}static Parse(G,D){const N=new c(D);for(const T of G.targets)N.addTarget(t.Parse(T,D));return N}}c.EnableTextureStorage=!0,c.MaxActiveMorphTargetsInVertexAttributeMode=8;var K=N(11746),b=N(1055),O=N(1347);function Q(G,D,N,T){return o.s.od(D,N).scaleInPlace(T)}class A{constructor(G,D,N,T){this.type=G,this.name=D,this.getValue=N,this.getStride=T}_buildAnimation(G,D,N){const T=new g.b(G,this.name,D,this.type);return T.setKeys(N),T}}class I extends A{buildAnimations(G,D,N,T,o){o(G._babylonTransformNode,this._buildAnimation(D,N,T))}}const d={translation:[new I(g.b.ANIMATIONTYPE_VECTOR3,"position",Q,(()=>3))],rotation:[new I(g.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(G,D,N,T){return o.g.od(D,N).scaleInPlace(T)}),(()=>4))],scale:[new I(g.b.ANIMATIONTYPE_VECTOR3,"Ed",Q,(()=>3))],weights:[new class extends A{buildAnimations(G,D,N,T,o){if(G._numMorphTargets)for(let Z=0;Z<G._numMorphTargets;Z++){const n=new g.b(`${D}_${Z}`,this.name,N,this.type);if(n.setKeys(T.map((G=>({frame:G.frame,inTangent:G.inTangent?G.inTangent[Z]:void 0,value:G.value[Z],outTangent:G.outTangent?G.outTangent[Z]:void 0,interpolation:G.interpolation})))),G._primitiveBabylonMeshes)for(const D of G._primitiveBabylonMeshes)if(D.morphTargetManager){const G=D.morphTargetManager.getTarget(Z),N=n.clone();G.animations.push(N),o(G,N)}}}}(g.b.ANIMATIONTYPE_FLOAT,"influence",(function(G,D,N,T){const o=new Array(G._numMorphTargets);for(let Z=0;Z<o.length;Z++)o[Z]=D[N++]*T;return o}),(G=>G._numMorphTargets))]},u=new Map,l=u;function x(G,D,N){k(G)&&j.d.Warn(`Extension with the name '${G}' already exists`),u.set(G,{isGLTFExtension:D,factory:N})}function k(G){return u.delete(G)}function a(){const G=G=>G&&"object"===typeof G;for(var D=arguments.length,N=new Array(D),T=0;T<D;T++)N[T]=arguments[T];return N.reduce(((D,N)=>(Object.keys(N).forEach((T=>{const o=D[T],Z=N[T];Array.isArray(o)&&Array.isArray(Z)?D[T]=o.concat(...Z):G(o)&&G(Z)?D[T]=a(o,Z):D[T]=Z})),D)),{})}class E{static Get(G,D,N){if(!D||void 0==N||!D[N])throw new Error(`${G}: Failed to find index (${N})`);return D[N]}static TryGet(G,D){return G&&void 0!=D&&G[D]?G[D]:null}static Assign(G){if(G)for(let D=0;D<G.length;D++)G[D].index=D}}class M{static RegisterExtension(G,D){x(G,!1,D)}static UnregisterExtension(G){return k(G)}get aj(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(G){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=G}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((G=>G.dispose&&G.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(G,D,N,T,o,Z){let n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=D,this._assetContainer=N,this._loadData(T);let Z=null;if(G){const D={};if(this._gltf.nodes)for(const G of this._gltf.nodes)G.name&&(D[G.name]=G.index);Z=(G instanceof Array?G:[G]).map((G=>{const N=D[G];if(void 0===N)throw new Error(`Failed to find node '${G}'`);return N}))}return this._loadAsync(o,n,Z,(()=>({meshes:this._getMeshes(),fe:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(G,D,N,T){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=G,this._loadData(D),this._loadAsync(N,o,null,(()=>{})))))}_loadAsync(G,D,N,T){return Promise.resolve().then((async()=>{this._rootUrl=G,this._uniqueRootUrl=!G.startsWith("file:")&&D?G:`${G}${Date.now()}/`,this._fileName=D,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const o=`${K.m[K.m.LOADING]} => ${K.m[K.m.READY]}`,Z=`${K.m[K.m.LOADING]} => ${K.m[K.m.COMPLETE]}`;this._parent._startPerformanceCounter(o),this._parent._startPerformanceCounter(Z),this._parent._setState(K.m.LOADING),this._extensionsOnLoading();const C=new Array;if(!this.parent.loadOnlyMaterials)if(N)C.push(this.loadSceneAsync("/nodes",{nodes:N,index:-1}));else if(void 0!=this._gltf.oe||this._gltf.scenes&&this._gltf.scenes[0]){const G=E.Get("/scene",this._gltf.scenes,this._gltf.oe||0);C.push(this.loadSceneAsync(`/scenes/${G.index}`,G))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let G=0;G<this._gltf.materials.length;++G){const D=this._gltf.materials[G],N="/materials/"+G,T=h.d.TriangleFillMode;C.push(this._loadMaterialAsync(N,D,null,T,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&C.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&C.push(this._compileShadowGeneratorsAsync());return Promise.all(C).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Lg(!0),this._extensionsOnReady(),this._parent._setState(K.m.READY),this._startAnimations(),T()))).then((G=>(this._parent._endPerformanceCounter(o),n.f.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(Z),this._parent._setState(K.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(G=>{this._parent.onErrorObservable.notifyObservers(G),this._parent.onErrorObservable.clear(),this.dispose()}))})),G)))})).catch((G=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(G),this._parent.onErrorObservable.clear(),this.dispose()),G}))}_loadData(G){if(this._gltf=G.json,this._setupData(),G.bin){const D=this._gltf.buffers;if(D&&D[0]&&!D[0].uri){const N=D[0];(N.byteLength<G.bin.byteLength-3||N.byteLength>G.bin.byteLength)&&j.d.Warn(`Binary buffer length (${N.byteLength}) from JSON does not match chunk length (${G.bin.byteLength})`),this._bin=G.bin}else j.d.Warn("Unexpected BIN chunk")}}_setupData(){if(E.Assign(this._gltf.accessors),E.Assign(this._gltf.animations),E.Assign(this._gltf.buffers),E.Assign(this._gltf.bufferViews),E.Assign(this._gltf.cameras),E.Assign(this._gltf.images),E.Assign(this._gltf.materials),E.Assign(this._gltf.meshes),E.Assign(this._gltf.nodes),E.Assign(this._gltf.samplers),E.Assign(this._gltf.scenes),E.Assign(this._gltf.skins),E.Assign(this._gltf.textures),this._gltf.nodes){const G={};for(const N of this._gltf.nodes)if(N.children)for(const D of N.children)G[D]=N.index;const D=this._createRootNode();for(const N of this._gltf.nodes){const T=G[N.index];N.parent=void 0===T?D:this._gltf.nodes[T]}}}async _loadExtensionsAsync(){const G=[];if(l.forEach(((D,N)=>{var T;!1===(null===(T=this.parent.extensionOptions[N])||void 0===T?void 0:T.enabled)?D.isGLTFExtension&&this.isExtensionUsed(N)&&j.d.Warn(`Extension ${N} is used but has been explicitly disabled.`):D.isGLTFExtension&&!this.isExtensionUsed(N)||G.push((async()=>{const G=await D.factory(this);return G.name!==N&&j.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${G.name} !== ${N}`),this._parent.onExtensionLoadedObservable.notifyObservers(G),G})())})),this._extensions.push(...await Promise.all(G)),this._extensions.sort(((G,D)=>(G.order||Number.MAX_VALUE)-(D.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const N of this._gltf.extensionsRequired){if(!this._extensions.some((G=>G.name===N&&G.enabled))){var D;if(!1===(null===(D=this.parent.extensionOptions[N])||void 0===D?void 0:D.enabled))throw new Error(`Required extension ${N} is disabled`);throw new Error(`Required extension ${N} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new p.d("__root__",this._babylonScene);this._rootBabylonMesh=G,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Lg(!1);const D={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case K.j.AUTO:this._babylonScene.useRightHandedSystem||(D.rotation=[0,1,0,0],D.scale=[1,1,-1],M._LoadTransform(D,this._rootBabylonMesh));break;case K.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(G),D}loadSceneAsync(G,D){const N=this._extensionsLoadSceneAsync(G,D);if(N)return N;const T=new Array;if(this.logOpen(`${G} ${D.name||""}`),D.nodes)for(const o of D.nodes){const D=E.Get(`${G}/nodes/${o}`,this._gltf.nodes,o);T.push(this.loadNodeAsync(`/nodes/${D.index}`,D,(G=>{G.parent=this._rootBabylonMesh})))}for(const o of this._postSceneLoadActions)o();return T.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(T).then((()=>{}))}_forEachPrimitive(G,D){if(G._primitiveBabylonMeshes)for(const N of G._primitiveBabylonMeshes)D(N)}_getGeometries(){const G=[],D=this._gltf.nodes;if(D)for(const N of D)this._forEachPrimitive(N,(D=>{const N=D.ve;N&&-1===G.indexOf(N)&&G.push(N)}));return G}_getMeshes(){const G=[];this._rootBabylonMesh instanceof J.d&&G.push(this._rootBabylonMesh);const D=this._gltf.nodes;if(D)for(const N of D)this._forEachPrimitive(N,(D=>{G.push(D)}));return G}_getTransformNodes(){const G=[],D=this._gltf.nodes;if(D)for(const N of D)N._babylonTransformNode&&"mb"===N._babylonTransformNode.getClassName()&&G.push(N._babylonTransformNode),N._babylonTransformNodeForSkin&&G.push(N._babylonTransformNodeForSkin);return G}_getSkeletons(){const G=[],D=this._gltf.skins;if(D)for(const N of D)N._data&&G.push(N._data.babylonSkeleton);return G}_getAnimationGroups(){const G=[],D=this._gltf.animations;if(D)for(const N of D)N._babylonAnimationGroup&&G.push(N._babylonAnimationGroup);return G}_startAnimations(){switch(this._parent.animationStartMode){case K.f.NONE:break;case K.f.FIRST:{const G=this._getAnimationGroups();0!==G.length&&G[0].start(!0);break}case K.f.ALL:{const G=this._getAnimationGroups();for(const D of G)D.start(!0);break}default:return void j.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const T=this._extensionsLoadNodeAsync(G,D,N);if(T)return T;if(D._babylonTransformNode)throw new Error(`${G}: Invalid recursive node hierarchy`);const o=new Array;this.logOpen(`${G} ${D.name||""}`);const Z=T=>{if(M.AddPointerMetadata(T,G),M._LoadTransform(D,T),void 0!=D.camera){const N=E.Get(`${G}/camera`,this._gltf.cameras,D.camera);o.push(this.loadCameraAsync(`/cameras/${N.index}`,N,(G=>{G.parent=T})))}if(D.children)for(const N of D.children){const D=E.Get(`${G}/children/${N}`,this._gltf.nodes,N);o.push(this.loadNodeAsync(`/nodes/${D.index}`,D,(G=>{G.parent=T})))}N(T)},n=void 0!=D.mesh,C=this._parent.loadSkins&&void 0!=D.skin;if(!n||C){const G=D.name||`node${D.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new U.e(G,this._babylonScene);N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==D.mesh?D._babylonTransformNode=N:D._babylonTransformNodeForSkin=N,Z(N)}if(n)if(C){const N=E.Get(`${G}/mesh`,this._gltf.meshes,D.mesh);o.push(this._loadMeshAsync(`/meshes/${N.index}`,D,N,(N=>{const T=D._babylonTransformNodeForSkin;N.metadata=a(T.metadata,N.metadata||{});const Z=E.Get(`${G}/skin`,this._gltf.skins,D.skin);o.push(this._loadSkinAsync(`/skins/${Z.index}`,D,Z,(G=>{this._forEachPrimitive(D,(D=>{D.skeleton=G})),this._postSceneLoadActions.push((()=>{if(void 0!=Z.skeleton){const G=E.Get(`/skins/${Z.index}/skeleton`,this._gltf.nodes,Z.skeleton).parent;D.index===G.index?N.parent=T.parent:N.parent=G._babylonTransformNode}else N.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:T,skinnedNode:N})}))})))})))}else{const N=E.Get(`${G}/mesh`,this._gltf.meshes,D.mesh);o.push(this._loadMeshAsync(`/meshes/${N.index}`,D,N,Z))}return this.logClose(),Promise.all(o).then((()=>(this._forEachPrimitive(D,(G=>{G.ve&&G.ve.useBoundingInfoFromGeometry?G.Ea():G.refreshBoundingInfo(!0,!0)})),D._babylonTransformNode)))}_loadMeshAsync(G,D,N,T){const o=N.primitives;if(!o||!o.length)throw new Error(`${G}: Primitives are missing`);void 0==o[0].index&&E.Assign(o);const Z=new Array;this.logOpen(`${G} ${N.name||""}`);const n=D.name||`node${D.index}`;if(1===o.length){const T=N.primitives[0];Z.push(this._loadMeshPrimitiveAsync(`${G}/primitives/${T.index}`,n,D,N,T,(G=>{D._babylonTransformNode=G,D._primitiveBabylonMeshes=[G]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,D._babylonTransformNode=new U.e(n,this._babylonScene),D._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,D._primitiveBabylonMeshes=[];for(const T of o)Z.push(this._loadMeshPrimitiveAsync(`${G}/primitives/${T.index}`,`${n}_primitive${T.index}`,D,N,T,(G=>{G.parent=D._babylonTransformNode,D._primitiveBabylonMeshes.push(G)})))}return T(D._babylonTransformNode),this.logClose(),Promise.all(Z).then((()=>D._babylonTransformNode))}_loadMeshPrimitiveAsync(G,D,N,T,o,Z){const n=this._extensionsLoadMeshPrimitiveAsync(G,D,N,T,o,Z);if(n)return n;this.logOpen(`${G}`);const C=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==N.skin&&!T.primitives[0].targets;let P,r;if(C&&o._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,P=o._instanceData.babylonSourceMesh.nb(D),P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r=o._instanceData.promise;else{const Z=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new p.d(D,this._babylonScene);n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.sideOrientation=this._babylonScene.useRightHandedSystem?h.d.CounterClockWiseSideOrientation:h.d.ClockWiseSideOrientation,this._createMorphTargets(G,N,T,o,n),Z.push(this._loadVertexDataAsync(G,o,n).then((D=>this._loadMorphTargetsAsync(G,o,n,D).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,D.Ca(n),D._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const v=M._GetDrawMode(G,o.mode);if(void 0==o.material){let G=this._defaultBabylonMaterialData[v];G||(G=this._createDefaultMaterial("__GLTFLoader._default",v),this._parent.onMaterialLoadedObservable.notifyObservers(G),this._defaultBabylonMaterialData[v]=G),n.material=G}else if(!this.parent.skipMaterials){const D=E.Get(`${G}/material`,this._gltf.materials,o.material);Z.push(this._loadMaterialAsync(`/materials/${D.index}`,D,n,v,(G=>{n.material=G})))}r=Promise.all(Z),C&&(o._instanceData={babylonSourceMesh:n,promise:r}),P=n}return M.AddPointerMetadata(P,G),this._parent.onMeshLoadedObservable.notifyObservers(P),Z(P),this.logClose(),r.then((()=>P))}_loadVertexDataAsync(G,D,N){const T=this._extensionsLoadVertexDataAsync(G,D,N);if(T)return T;const Z=D.attributes;if(!Z)throw new Error(`${G}: Attributes are missing`);const n=new Array,C=new i.d(N.name,this._babylonScene);if(void 0==D.indices)N.isUnIndexed=!0;else{const N=E.Get(`${G}/indices`,this._gltf.accessors,D.indices);n.push(this._loadIndicesAccessorAsync(`/accessors/${N.index}`,N).then((G=>{C.setIndices(G)})))}const P=(D,T,P)=>{if(void 0==Z[D])return;N._delayInfo=N._delayInfo||[],-1===N._delayInfo.indexOf(T)&&N._delayInfo.push(T);const r=E.Get(`${G}/attributes/${D}`,this._gltf.accessors,Z[D]);n.push(this._loadVertexAccessorAsync(`/accessors/${r.index}`,r,T).then((G=>{if(G.getKind()===z.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!N.skeleton&&r.min&&r.max){const G=o.k.Ad[0].xd(...r.min),D=o.k.Ad[1].xd(...r.max);if(r.normalized&&5126!==r.componentType){let N=1;switch(r.componentType){case 5120:N=127;break;case 5121:N=255;break;case 5122:N=32767;break;case 5123:N=65535}const T=1/N;G.scaleInPlace(T),D.scaleInPlace(T)}C._boundingInfo=new O.e(G,D),C.useBoundingInfoFromGeometry=!0}C.setVerticesBuffer(G,r.count)}))),T==z.f.MatricesIndicesExtraKind&&(N.numBoneInfluencers=8),P&&P(r)};return P("POSITION",z.f.PositionKind),P("NORMAL",z.f.NormalKind),P("TANGENT",z.f.TangentKind),P("TEXCOORD_0",z.f.UVKind),P("TEXCOORD_1",z.f.UV2Kind),P("TEXCOORD_2",z.f.UV3Kind),P("TEXCOORD_3",z.f.UV4Kind),P("TEXCOORD_4",z.f.UV5Kind),P("TEXCOORD_5",z.f.UV6Kind),P("JOINTS_0",z.f.MatricesIndicesKind),P("WEIGHTS_0",z.f.MatricesWeightsKind),P("JOINTS_1",z.f.MatricesIndicesExtraKind),P("WEIGHTS_1",z.f.MatricesWeightsExtraKind),P("COLOR_0",z.f.ColorKind,(G=>{"VEC4"===G.type&&(N.hasVertexAlpha=!0)})),Promise.all(n).then((()=>C))}_createMorphTargets(G,D,N,T,o){if(!T.targets||!this._parent.loadMorphTargets)return;if(void 0==D._numMorphTargets)D._numMorphTargets=T.targets.length;else if(T.targets.length!==D._numMorphTargets)throw new Error(`${G}: Primitives do not have the same number of targets`);const Z=N.extras?N.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,o.morphTargetManager=new c(this._babylonScene),o.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.morphTargetManager.areUpdatesFrozen=!0;for(let n=0;n<T.targets.length;n++){const G=D.weights?D.weights[n]:N.weights?N.weights[n]:0,T=Z?Z[n]:`morphTarget${n}`;o.morphTargetManager.addTarget(new t(T,G,o.va()))}}_loadMorphTargetsAsync(G,D,N,T){if(!D.targets||!this._parent.loadMorphTargets)return Promise.resolve();const o=new Array,Z=N.morphTargetManager;for(let n=0;n<Z.numTargets;n++){const N=Z.getTarget(n);o.push(this._loadMorphTargetVertexDataAsync(`${G}/targets/${n}`,T,D.targets[n],N))}return Promise.all(o).then((()=>{Z.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(G,D,N,T){const o=new Array,Z=(T,Z,n)=>{if(void 0==N[T])return;const C=D.getVertexBuffer(Z);if(!C)return;const P=E.Get(`${G}/${T}`,this._gltf.accessors,N[T]);o.push(this._loadFloatAccessorAsync(`/accessors/${P.index}`,P).then((G=>{n(C,G)})))};return Z("POSITION",z.f.PositionKind,((G,D)=>{const N=new Float32Array(D.length);G.forEach(D.length,((G,T)=>{N[T]=D[T]+G})),T.setPositions(N)})),Z("NORMAL",z.f.NormalKind,((G,D)=>{const N=new Float32Array(D.length);G.forEach(N.length,((G,T)=>{N[T]=D[T]+G})),T.setNormals(N)})),Z("TANGENT",z.f.TangentKind,((G,D)=>{const N=new Float32Array(D.length/3*4);let o=0;G.forEach(D.length/3*4,((G,T)=>{(T+1)%4!==0&&(N[o]=D[o]+G,o++)})),T.setTangents(N)})),Promise.all(o).then((()=>{}))}static _LoadTransform(G,D){if(void 0!=G.skin)return;let N=o.s.Zero(),T=o.g.Identity(),Z=o.s.One();if(G.matrix){o.c.od(G.matrix).decompose(Z,T,N)}else G.translation&&(N=o.s.od(G.translation)),G.rotation&&(T=o.g.od(G.rotation)),G.scale&&(Z=o.s.od(G.scale));D.position=N,D.rotationQuaternion=T,D.Ed=Z}_loadSkinAsync(G,D,N,T){if(!this._parent.loadSkins)return Promise.resolve();const o=this._extensionsLoadSkinAsync(G,D,N);if(o)return o;if(N._data)return T(N._data.babylonSkeleton),N._data.promise;const Z=`skeleton${N.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new y(N.name||Z,Z,this._babylonScene);n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(G,N,n);const C=this._loadSkinInverseBindMatricesDataAsync(G,N).then((G=>{this._updateBoneMatrices(n,G)}));return N._data={babylonSkeleton:n,promise:C},T(n),C}_loadBones(G,D,N){if(void 0==D.skeleton||this._parent.alwaysComputeSkeletonRootNode){const N=this._findSkeletonRootNode(`${G}/joints`,D.joints);if(N)if(void 0===D.skeleton)D.skeleton=N.index;else{const T=(G,D)=>{for(;D.parent;D=D.parent)if(D.parent===G)return!0;return!1},o=E.Get(`${G}/skeleton`,this._gltf.nodes,D.skeleton);o===N||T(o,N)||(j.d.Warn(`${G}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),D.skeleton=N.index)}else j.d.Warn(`${G}: Failed to find common root`)}const T={};for(const o of D.joints){const Z=E.Get(`${G}/joints/${o}`,this._gltf.nodes,o);this._loadBone(Z,D,N,T)}}_findSkeletonRootNode(G,D){if(0===D.length)return null;const N={};for(const o of D){const D=[];let T=E.Get(`${G}/${o}`,this._gltf.nodes,o);for(;-1!==T.index;)D.unshift(T),T=T.parent;N[o]=D}let T=null;for(let o=0;;++o){let G=N[D[0]];if(o>=G.length)return T;const Z=G[o];for(let n=1;n<D.length;++n)if(G=N[D[n]],o>=G.length||Z!==G[o])return T;T=Z}}_loadBone(G,D,N,T){G._isJoint=!0;let o=T[G.index];if(o)return o;let Z=null;G.index!==D.skeleton&&(G.parent&&-1!==G.parent.index?Z=this._loadBone(G.parent,D,N,T):void 0!==D.skeleton&&j.d.Warn(`/skins/${D.index}/skeleton: Skeleton node is not a common root`));const n=D.joints.indexOf(G.index);return o=new r.e(G.name||`joint${G.index}`,N,Z,this._getNodeMatrix(G),null,null,n),T[G.index]=o,this._postSceneLoadActions.push((()=>{o.linkTransformNode(G._babylonTransformNode)})),o}_loadSkinInverseBindMatricesDataAsync(G,D){if(void 0==D.inverseBindMatrices)return Promise.resolve(null);const N=E.Get(`${G}/inverseBindMatrices`,this._gltf.accessors,D.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${N.index}`,N)}_updateBoneMatrices(G,D){for(const N of G.bones){const G=o.c.Identity(),T=N._index;D&&-1!==T&&(o.c.FromArrayToRef(D,16*T,G),G.invertToRef(G));const Z=N.getParent();Z&&G.multiplyToRef(Z.getAbsoluteInverseBindMatrix(),G),N.Rd(G,!1,!1),N._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(G){return G.matrix?o.c.od(G.matrix):o.c.Compose(G.scale?o.s.od(G.scale):o.s.One(),G.rotation?o.g.od(G.rotation):o.g.Identity(),G.translation?o.s.od(G.translation):o.s.Zero())}loadCameraAsync(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const T=this._extensionsLoadCameraAsync(G,D,N);if(T)return T;const Z=new Array;this.logOpen(`${G} ${D.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new P.d(D.name||`camera${D.index}`,o.s.Zero(),this._babylonScene,!1);switch(n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.ignoreParentScaling=!0,D._babylonCamera=n,n.rotation.set(0,Math.PI,0),D.type){case"perspective":{const N=D.perspective;if(!N)throw new Error(`${G}: Camera perspective properties are missing`);n.fov=N.yfov,n.fj=N.znear,n.maxZ=N.zfar||0;break}case"orthographic":if(!D.orthographic)throw new Error(`${G}: Camera orthographic properties are missing`);n.mode=C.d.ORTHOGRAPHIC_CAMERA,n.orthoLeft=-D.orthographic.xmag,n.orthoRight=D.orthographic.xmag,n.orthoBottom=-D.orthographic.ymag,n.orthoTop=D.orthographic.ymag,n.fj=D.orthographic.znear,n.maxZ=D.orthographic.zfar;break;default:throw new Error(`${G}: Invalid camera type (${D.type})`)}return M.AddPointerMetadata(n,G),this._parent.onCameraLoadedObservable.notifyObservers(n),N(n),this.logClose(),Promise.all(Z).then((()=>n))}_loadAnimationsAsync(){const G=this._gltf.animations;if(!G)return Promise.resolve();const D=new Array;for(let N=0;N<G.length;N++){const T=G[N];D.push(this.loadAnimationAsync(`/animations/${T.index}`,T).then((G=>{0===G.targetedAnimations.length&&G.dispose()})))}return Promise.all(D).then((()=>{}))}loadAnimationAsync(G,D){const T=this._extensionsLoadAnimationAsync(G,D);return T||N.e(43).then(N.bind(N,12335)).then((N=>{let{AnimationGroup:T}=N;this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new T(D.name||`animation${D.index}`,this._babylonScene);o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,D._babylonAnimationGroup=o;const Z=new Array;E.Assign(D.channels),E.Assign(D.samplers);for(const n of D.channels)Z.push(this._loadAnimationChannelAsync(`${G}/channels/${n.index}`,G,D,n,((G,D)=>{G.animations=G.animations||[],G.animations.push(D),o.addTargetedAnimation(D,G)})));return Promise.all(Z).then((()=>(o.normalize(0),o)))}))}_loadAnimationChannelAsync(G,D,N,T,o){const Z=this._extensionsLoadAnimationChannelAsync(G,D,N,T,o);if(Z)return Z;if(void 0==T.target.node)return Promise.resolve();const n=E.Get(`${G}/target/node`,this._gltf.nodes,T.target.node),C=T.target.path,P="weights"===C;if(P&&!n._numMorphTargets||!P&&!n._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!P&&!n._isJoint)return Promise.resolve();let r;switch(C){case"translation":r=d.translation;break;case"rotation":r=d.rotation;break;case"scale":r=d.scale;break;case"weights":r=d.weights;break;default:throw new Error(`${G}/target/path: Invalid value (${T.target.path})`)}const v={object:n,info:r};return this._loadAnimationChannelFromTargetInfoAsync(G,D,N,T,v,o)}_loadAnimationChannelFromTargetInfoAsync(G,D,N,T,o,Z){const n=this.parent.targetFps,C=1/n,P=E.Get(`${G}/sampler`,N.samplers,T.sampler);return this._loadAnimationSamplerAsync(`${D}/samplers/${T.sampler}`,P).then((G=>{let D=0;const P=o.object,r=o.info;for(const o of r){const r=o.getStride(P),v=G.input,q=G.output,g=new Array(v.length);let X=0;switch(G.interpolation){case"STEP":for(let G=0;G<v.length;G++){const D=o.getValue(P,q,X,1);X+=r,g[G]={frame:v[G]*n,value:D,interpolation:1}}break;case"CUBICSPLINE":for(let G=0;G<v.length;G++){const D=o.getValue(P,q,X,C);X+=r;const N=o.getValue(P,q,X,1);X+=r;const T=o.getValue(P,q,X,C);X+=r,g[G]={frame:v[G]*n,inTangent:D,value:N,outTangent:T}}break;case"LINEAR":for(let G=0;G<v.length;G++){const D=o.getValue(P,q,X,1);X+=r,g[G]={frame:v[G]*n,value:D}}}if(X>0){const G=`${N.name||`animation${N.index}`}_channel${T.index}_${D}`;o.buildAnimations(P,G,n,g,((G,N)=>{++D,Z(G,N)}))}}}))}_loadAnimationSamplerAsync(G,D){if(D._data)return D._data;const N=D.interpolation||"LINEAR";switch(N){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${G}/interpolation: Invalid value (${D.interpolation})`)}const T=E.Get(`${G}/input`,this._gltf.accessors,D.input),o=E.Get(`${G}/output`,this._gltf.accessors,D.output);return D._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${T.index}`,T),this._loadFloatAccessorAsync(`/accessors/${o.index}`,o)]).then((G=>{let[D,T]=G;return{input:D,interpolation:N,output:T}})),D._data}loadBufferAsync(G,D,N,T){const o=this._extensionsLoadBufferAsync(G,D,N,T);if(o)return o;if(!D._data)if(D.uri)D._data=this.loadUriAsync(`${G}/uri`,D,D.uri);else{if(!this._bin)throw new Error(`${G}: Uri is missing or the binary glTF is missing its binary chunk`);D._data=this._bin.readAsync(0,D.byteLength)}return D._data.then((D=>{try{return new Uint8Array(D.buffer,D.byteOffset+N,T)}catch(o){throw new Error(`${G}: ${o.message}`)}}))}loadBufferViewAsync(G,D){const N=this._extensionsLoadBufferViewAsync(G,D);if(N)return N;if(D._data)return D._data;const T=E.Get(`${G}/buffer`,this._gltf.buffers,D.buffer);return D._data=this.loadBufferAsync(`/buffers/${T.index}`,T,D.byteOffset||0,D.byteLength),D._data}_loadAccessorAsync(G,D,N){if(D._data)return D._data;const T=M._GetNumComponents(G,D.type),o=T*z.f.GetTypeByteLength(D.componentType),Z=T*D.count;if(void 0==D.bufferView)D._data=Promise.resolve(new N(Z));else{const n=E.Get(`${G}/bufferView`,this._gltf.bufferViews,D.bufferView);D._data=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n).then((C=>{if(5126!==D.componentType||D.normalized||n.byteStride&&n.byteStride!==o){const G=new N(Z);return z.f.ForEach(C,D.byteOffset||0,n.byteStride||o,T,D.componentType,G.length,D.normalized||!1,((D,N)=>{G[N]=D})),G}return M._GetTypedArray(G,D.componentType,C,D.byteOffset,Z)}))}if(D.sparse){const Z=D.sparse;D._data=D._data.then((n=>{const C=n,P=E.Get(`${G}/sparse/indices/bufferView`,this._gltf.bufferViews,Z.indices.bufferView),r=E.Get(`${G}/sparse/values/bufferView`,this._gltf.bufferViews,Z.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${P.index}`,P),this.loadBufferViewAsync(`/bufferViews/${r.index}`,r)]).then((n=>{let[P,r]=n;const v=M._GetTypedArray(`${G}/sparse/indices`,Z.indices.componentType,P,Z.indices.byteOffset,Z.count),q=T*Z.count;let g;if(5126!==D.componentType||D.normalized){const n=M._GetTypedArray(`${G}/sparse/values`,D.componentType,r,Z.values.byteOffset,q);g=new N(q),z.f.ForEach(n,0,o,T,D.componentType,g.length,D.normalized||!1,((G,D)=>{g[D]=G}))}else g=M._GetTypedArray(`${G}/sparse/values`,D.componentType,r,Z.values.byteOffset,q);let X=0;for(let G=0;G<v.length;G++){let D=v[G]*T;for(let G=0;G<T;G++)C[D++]=g[X++]}return C}))}))}return D._data}_loadFloatAccessorAsync(G,D){return this._loadAccessorAsync(G,D,Float32Array)}_loadIndicesAccessorAsync(G,D){if("SCALAR"!==D.type)throw new Error(`${G}/type: Invalid value ${D.type}`);if(5121!==D.componentType&&5123!==D.componentType&&5125!==D.componentType)throw new Error(`${G}/componentType: Invalid value ${D.componentType}`);if(D._data)return D._data;if(D.sparse){const N=M._GetTypedArrayConstructor(`${G}/componentType`,D.componentType);D._data=this._loadAccessorAsync(G,D,N)}else{const N=E.Get(`${G}/bufferView`,this._gltf.bufferViews,D.bufferView);D._data=this.loadBufferViewAsync(`/bufferViews/${N.index}`,N).then((N=>M._GetTypedArray(G,D.componentType,N,D.byteOffset,D.count)))}return D._data}_loadVertexBufferViewAsync(G){if(G._babylonBuffer)return G._babylonBuffer;const D=this._babylonScene.getEngine();return G._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${G.index}`,G).then((G=>new z.c(D,G,!1))),G._babylonBuffer}_loadVertexAccessorAsync(G,D,N){var T;if(null!==(T=D._babylonVertexBuffer)&&void 0!==T&&T[N])return D._babylonVertexBuffer[N];D._babylonVertexBuffer||(D._babylonVertexBuffer={});const o=this._babylonScene.getEngine();if(D.sparse||void 0==D.bufferView)D._babylonVertexBuffer[N]=this._loadFloatAccessorAsync(G,D).then((G=>new z.f(o,G,N,!1)));else{const T=E.Get(`${G}/bufferView`,this._gltf.bufferViews,D.bufferView);D._babylonVertexBuffer[N]=this._loadVertexBufferViewAsync(T).then((Z=>{const n=M._GetNumComponents(G,D.type);return new z.f(o,Z,N,!1,void 0,T.byteStride,void 0,D.byteOffset,n,D.componentType,D.normalized,!0,void 0,!0)}))}return D._babylonVertexBuffer[N]}_loadMaterialMetallicRoughnessPropertiesAsync(G,D,N){if(!(N instanceof S))throw new Error(`${G}: Material type not supported`);const T=new Array;return D&&(D.baseColorFactor?(N.albedoColor=Z.d.od(D.baseColorFactor),N.alpha=D.baseColorFactor[3]):N.albedoColor=Z.d.White(),N.metallic=void 0==D.metallicFactor?1:D.metallicFactor,N.roughness=void 0==D.roughnessFactor?1:D.roughnessFactor,D.baseColorTexture&&T.push(this.loadTextureInfoAsync(`${G}/baseColorTexture`,D.baseColorTexture,(G=>{G.name=`${N.name} (Base Color)`,N.albedoTexture=G}))),D.metallicRoughnessTexture&&(D.metallicRoughnessTexture.nonColorData=!0,T.push(this.loadTextureInfoAsync(`${G}/metallicRoughnessTexture`,D.metallicRoughnessTexture,(G=>{G.name=`${N.name} (Metallic Roughness)`,N.metallicTexture=G}))),N.useMetallnessFromMetallicTextureBlue=!0,N.useRoughnessFromMetallicTextureGreen=!0,N.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(T).then((()=>{}))}_loadMaterialAsync(G,D,N,T){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const Z=this._extensionsLoadMaterialAsync(G,D,N,T,o);if(Z)return Z;D._data=D._data||{};let n=D._data[T];if(!n){this.logOpen(`${G} ${D.name||""}`);const N=this.createMaterial(G,D,T);n={babylonMaterial:N,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(G,D,N)},D._data[T]=n,M.AddPointerMetadata(N,G),this._parent.onMaterialLoadedObservable.notifyObservers(N),this.logClose()}return N&&(n.babylonMeshes.push(N),N.Fd.addOnce((()=>{const G=n.babylonMeshes.indexOf(N);-1!==G&&n.babylonMeshes.splice(G,1)}))),o(n.babylonMaterial),n.promise.then((()=>n.babylonMaterial))}_createDefaultMaterial(G,D){this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new S(G,this._babylonScene);return N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,N.fillMode=D,N.enableSpecularAntiAliasing=!0,N.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,N.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,N.transparencyMode=S.PBRMATERIAL_OPAQUE,N.metallic=1,N.roughness=1,N}createMaterial(G,D,N){const T=this._extensionsCreateMaterial(G,D,N);if(T)return T;const o=D.name||`material${D.index}`;return this._createDefaultMaterial(o,N)}loadMaterialPropertiesAsync(G,D,N){const T=this._extensionsLoadMaterialPropertiesAsync(G,D,N);if(T)return T;const o=new Array;return o.push(this.loadMaterialBasePropertiesAsync(G,D,N)),D.pbrMetallicRoughness&&o.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${G}/pbrMetallicRoughness`,D.pbrMetallicRoughness,N)),this.loadMaterialAlphaProperties(G,D,N),Promise.all(o).then((()=>{}))}loadMaterialBasePropertiesAsync(G,D,N){if(!(N instanceof S))throw new Error(`${G}: Material type not supported`);const T=new Array;return N.emissiveColor=D.emissiveFactor?Z.d.od(D.emissiveFactor):new Z.d(0,0,0),D.doubleSided&&(N.Ge=!1,N.twoSidedLighting=!0),D.normalTexture&&(D.normalTexture.nonColorData=!0,T.push(this.loadTextureInfoAsync(`${G}/normalTexture`,D.normalTexture,(G=>{G.name=`${N.name} (Normal)`,N.bumpTexture=G}))),N.invertNormalMapX=!this._babylonScene.useRightHandedSystem,N.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=D.normalTexture.scale&&N.bumpTexture&&(N.bumpTexture.level=D.normalTexture.scale),N.forceIrradianceInFragment=!0),D.occlusionTexture&&(D.occlusionTexture.nonColorData=!0,T.push(this.loadTextureInfoAsync(`${G}/occlusionTexture`,D.occlusionTexture,(G=>{G.name=`${N.name} (Occlusion)`,N.ambientTexture=G}))),N.useAmbientInGrayScale=!0,void 0!=D.occlusionTexture.strength&&(N.ambientTextureStrength=D.occlusionTexture.strength)),D.emissiveTexture&&T.push(this.loadTextureInfoAsync(`${G}/emissiveTexture`,D.emissiveTexture,(G=>{G.name=`${N.name} (Emissive)`,N.emissiveTexture=G}))),Promise.all(T).then((()=>{}))}loadMaterialAlphaProperties(G,D,N){if(!(N instanceof S))throw new Error(`${G}: Material type not supported`);switch(D.alphaMode||"OPAQUE"){case"OPAQUE":N.transparencyMode=S.PBRMATERIAL_OPAQUE,N.alpha=1;break;case"MASK":N.transparencyMode=S.PBRMATERIAL_ALPHATEST,N.alphaCutOff=void 0==D.alphaCutoff?.5:D.alphaCutoff,N.albedoTexture&&(N.albedoTexture.jd=!0);break;case"BLEND":N.transparencyMode=S.PBRMATERIAL_ALPHABLEND,N.albedoTexture&&(N.albedoTexture.jd=!0,N.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${G}/alphaMode: Invalid value (${D.alphaMode})`)}}loadTextureInfoAsync(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const T=this._extensionsLoadTextureInfoAsync(G,D,N);if(T)return T;if(this.logOpen(`${G}`),D.texCoord>=6)throw new Error(`${G}/texCoord: Invalid value (${D.texCoord})`);const o=E.Get(`${G}/index`,this._gltf.textures,D.index);o._textureInfo=D;const Z=this._loadTextureAsync(`/textures/${D.index}`,o,(T=>{T.coordinatesIndex=D.texCoord||0,M.AddPointerMetadata(T,G),this._parent.onTextureLoadedObservable.notifyObservers(T),N(T)}));return this.logClose(),Z}_loadTextureAsync(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const T=this._extensionsLoadTextureAsync(G,D,N);if(T)return T;this.logOpen(`${G} ${D.name||""}`);const o=void 0==D.sampler?M.DefaultSampler:E.Get(`${G}/sampler`,this._gltf.samplers,D.sampler),Z=E.Get(`${G}/source`,this._gltf.images,D.source),n=this._createTextureAsync(G,o,Z,N,void 0,!D._textureInfo.nonColorData);return this.logClose(),n}_createTextureAsync(G,D,N){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},Z=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0;const C=this._loadSampler(`/samplers/${D.index}`,D),P=new Array,r=new T;this._babylonScene._blockEntityCollection=!!this._assetContainer;const v={noMipmap:C.noMipMaps,invertY:!1,samplingMode:C.samplingMode,X:()=>{this._disposed||r.resolve()},onError:(D,N)=>{this._disposed||r.reject(new Error(`${G}: ${N&&N.message?N.message:D||"Failed to load texture"}`))},mimeType:N.mimeType,loaderOptions:Z,useSRGBBuffer:!!n&&this._parent.useSRGBBuffers},q=new V.e(null,this._babylonScene,v);return q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,P.push(r.promise),P.push(this.loadImageAsync(`/images/${N.index}`,N).then((G=>{const D=N.uri||`${this._fileName}#image${N.index}`,T=`data:${this._uniqueRootUrl}${D}`;q.updateURL(T,G);const o=q.getInternalTexture();o&&(o.label=N.name)}))),q.wrapU=C.wrapU,q.wrapV=C.wrapV,o(q),this._parent.useGltfTextureNames&&(q.name=N.name||N.uri||`image${N.index}`),Promise.all(P).then((()=>q))}_loadSampler(G,D){return D._data||(D._data={noMipMaps:9728===D.minFilter||9729===D.minFilter,samplingMode:M._GetTextureSamplingMode(G,D),wrapU:M._GetTextureWrapMode(`${G}/wrapS`,D.wrapS),wrapV:M._GetTextureWrapMode(`${G}/wrapT`,D.wrapT)}),D._data}loadImageAsync(G,D){if(!D._data){if(this.logOpen(`${G} ${D.name||""}`),D.uri)D._data=this.loadUriAsync(`${G}/uri`,D,D.uri);else{const N=E.Get(`${G}/bufferView`,this._gltf.bufferViews,D.bufferView);D._data=this.loadBufferViewAsync(`/bufferViews/${N.index}`,N)}this.logClose()}return D._data}loadUriAsync(G,D,N){const T=this._extensionsLoadUriAsync(G,D,N);if(T)return T;if(!M._ValidateUri(N))throw new Error(`${G}: '${N}' is invalid`);if((0,b.g)(N)){const D=new Uint8Array((0,b.c)(N));return this.log(`${G}: Decoded ${N.substring(0,64)}... (${D.length} bytes)`),Promise.resolve(D)}return this.log(`${G}: Loading ${N}`),this._parent.preprocessUrlAsync(this._rootUrl+N).then((D=>new Promise(((T,o)=>{this._parent._loadFile(this._babylonScene,D,(D=>{this._disposed||(this.log(`${G}: Loaded ${N} (${D.byteLength} bytes)`),T(new Uint8Array(D)))}),!0,(D=>{o(new b.i(`${G}: Failed to load '${N}'${D?": "+D.status+" "+D.statusText:""}`,D))}))}))))}static AddPointerMetadata(G,D){G.metadata=G.metadata||{};const N=G._internalMetadata=G._internalMetadata||{},T=N.aj=N.aj||{};(T.pointers=T.pointers||[]).push(D)}static _GetTextureWrapMode(G,D){switch(D=void 0==D?10497:D){case 33071:return V.e.CLAMP_ADDRESSMODE;case 33648:return V.e.MIRROR_ADDRESSMODE;case 10497:return V.e.WRAP_ADDRESSMODE;default:return j.d.Warn(`${G}: Invalid value (${D})`),V.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(G,D){const N=void 0==D.magFilter?9729:D.magFilter,T=void 0==D.minFilter?9987:D.minFilter;if(9729===N)switch(T){case 9728:return V.e.LINEAR_NEAREST;case 9729:return V.e.LINEAR_LINEAR;case 9984:return V.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return V.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return V.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return V.e.LINEAR_LINEAR_MIPLINEAR;default:return j.d.Warn(`${G}/minFilter: Invalid value (${T})`),V.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==N&&j.d.Warn(`${G}/magFilter: Invalid value (${N})`),T){case 9728:return V.e.NEAREST_NEAREST;case 9729:return V.e.NEAREST_LINEAR;case 9984:return V.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return V.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return V.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return V.e.NEAREST_LINEAR_MIPLINEAR;default:return j.d.Warn(`${G}/minFilter: Invalid value (${T})`),V.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(G,D){switch(D){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${G}: Invalid component type ${D}`)}}static _GetTypedArray(G,D,N,T,o){const Z=N.buffer;T=N.byteOffset+(T||0);const n=M._GetTypedArrayConstructor(`${G}/componentType`,D),C=z.f.GetTypeByteLength(D);return T%C!==0?(j.d.Warn(`${G}: Copying buffer as byte offset (${T}) is not a multiple of component type byte length (${C})`),new n(Z.slice(T,T+o*C),0)):new n(Z,T,o)}static _GetNumComponents(G,D){switch(D){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${G}: Invalid type (${D})`)}static _ValidateUri(G){return n.f.IsBase64(G)||-1===G.indexOf("..")}static _GetDrawMode(G,D){switch(void 0==D&&(D=4),D){case 0:return h.d.PointListDrawMode;case 1:return h.d.LineListDrawMode;case 2:return h.d.LineLoopDrawMode;case 3:return h.d.LineStripDrawMode;case 4:return h.d.TriangleFillMode;case 5:return h.d.TriangleStripDrawMode;case 6:return h.d.TriangleFanDrawMode}throw new Error(`${G}: Invalid mesh primitive mode (${D})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const G=new Array;if(this._gltf.materials)for(const D of this._gltf.materials)if(D._data)for(const N in D._data){const T=D._data[N];for(const D of T.babylonMeshes){D.se(!0);const N=T.babylonMaterial;G.push(N.forceCompilationAsync(D)),G.push(N.forceCompilationAsync(D,{useInstances:!0})),this._parent.useClipPlane&&(G.push(N.forceCompilationAsync(D,{clipPlane:!0})),G.push(N.forceCompilationAsync(D,{clipPlane:!0,useInstances:!0})))}}return Promise.all(G).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const G=new Array,D=this._babylonScene.lights;for(const N of D){const D=N.getShadowGenerator();D&&G.push(D.forceCompilationAsync())}return Promise.all(G).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(G){for(const D of this._extensions)D.enabled&&G(D)}_applyExtensions(G,D,N){for(const T of this._extensions)if(T.enabled){const o=`${T.name}.${D}`,Z=G;Z._activeLoaderExtensionFunctions=Z._activeLoaderExtensionFunctions||{};const n=Z._activeLoaderExtensionFunctions;if(!n[o]){n[o]=!0;try{const G=N(T);if(G)return G}finally{delete n[o]}}}return null}_extensionsOnLoading(){this._forEachExtensions((G=>G.onLoading&&G.onLoading()))}_extensionsOnReady(){this._forEachExtensions((G=>G.onReady&&G.onReady()))}_extensionsLoadSceneAsync(G,D){return this._applyExtensions(D,"loadScene",(N=>N.loadSceneAsync&&N.loadSceneAsync(G,D)))}_extensionsLoadNodeAsync(G,D,N){return this._applyExtensions(D,"loadNode",(T=>T.loadNodeAsync&&T.loadNodeAsync(G,D,N)))}_extensionsLoadCameraAsync(G,D,N){return this._applyExtensions(D,"loadCamera",(T=>T.loadCameraAsync&&T.loadCameraAsync(G,D,N)))}_extensionsLoadVertexDataAsync(G,D,N){return this._applyExtensions(D,"loadVertexData",(T=>T._loadVertexDataAsync&&T._loadVertexDataAsync(G,D,N)))}_extensionsLoadMeshPrimitiveAsync(G,D,N,T,o,Z){return this._applyExtensions(o,"loadMeshPrimitive",(n=>n._loadMeshPrimitiveAsync&&n._loadMeshPrimitiveAsync(G,D,N,T,o,Z)))}_extensionsLoadMaterialAsync(G,D,N,T,o){return this._applyExtensions(D,"loadMaterial",(Z=>Z._loadMaterialAsync&&Z._loadMaterialAsync(G,D,N,T,o)))}_extensionsCreateMaterial(G,D,N){return this._applyExtensions(D,"createMaterial",(T=>T.createMaterial&&T.createMaterial(G,D,N)))}_extensionsLoadMaterialPropertiesAsync(G,D,N){return this._applyExtensions(D,"loadMaterialProperties",(T=>T.loadMaterialPropertiesAsync&&T.loadMaterialPropertiesAsync(G,D,N)))}_extensionsLoadTextureInfoAsync(G,D,N){return this._applyExtensions(D,"loadTextureInfo",(T=>T.loadTextureInfoAsync&&T.loadTextureInfoAsync(G,D,N)))}_extensionsLoadTextureAsync(G,D,N){return this._applyExtensions(D,"loadTexture",(T=>T._loadTextureAsync&&T._loadTextureAsync(G,D,N)))}_extensionsLoadAnimationAsync(G,D){return this._applyExtensions(D,"loadAnimation",(N=>N.loadAnimationAsync&&N.loadAnimationAsync(G,D)))}_extensionsLoadAnimationChannelAsync(G,D,N,T,o){return this._applyExtensions(N,"loadAnimationChannel",(Z=>Z._loadAnimationChannelAsync&&Z._loadAnimationChannelAsync(G,D,N,T,o)))}_extensionsLoadSkinAsync(G,D,N){return this._applyExtensions(N,"loadSkin",(T=>T._loadSkinAsync&&T._loadSkinAsync(G,D,N)))}_extensionsLoadUriAsync(G,D,N){return this._applyExtensions(D,"loadUri",(T=>T._loadUriAsync&&T._loadUriAsync(G,D,N)))}_extensionsLoadBufferViewAsync(G,D){return this._applyExtensions(D,"loadBufferView",(N=>N.loadBufferViewAsync&&N.loadBufferViewAsync(G,D)))}_extensionsLoadBufferAsync(G,D,N,T){return this._applyExtensions(D,"loadBuffer",(o=>o.loadBufferAsync&&o.loadBufferAsync(G,D,N,T)))}static LoadExtensionAsync(G,D,N,T){if(!D.extensions)return null;const o=D.extensions[N];return o?T(`${G}/extensions/${N}`,o):null}static LoadExtraAsync(G,D,N,T){if(!D.extras)return null;const o=D.extras[N];return o?T(`${G}/extras/${N}`,o):null}isExtensionUsed(G){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(G)}logOpen(G){this._parent._logOpen(G)}logClose(){this._parent._logClose()}log(G){this._parent._log(G)}startPerformanceCounter(G){this._parent._startPerformanceCounter(G)}endPerformanceCounter(G){this._parent._endPerformanceCounter(G)}}M.DefaultSampler={index:-1},K.b._CreateGLTF2Loader=G=>new M(G);var e=N(1471),f=N(10314),GG=N(11764);class DG extends GG.e{constructor(G,D,N){let T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",G),this._texture=G.getEngine().createRawCubeTexture(D,N,T,o,Z,n,C,P)}update(G,D,N,T){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,G,D,N,T,o)}updateRGBDAsync(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,f.h)(this._texture,G,D,N,T).then((()=>{}))}clone(){return F.e.Clone((()=>{const G=this.va(),D=this._texture,N=new DG(G,D._bufferViewArray,D.width,D.format,D.type,D.generateMipMaps,D.invertY,D.samplingMode,D._compression);return 13===D.source&&N.updateRGBDAsync(D._bufferViewArrayArray,D._sphericalPolynomial,D._lodGenerationScale,D._lodGenerationOffset),N}),this)}}const NG="EXT_lights_image_based";class TG{constructor(G){this.name=NG,this._loader=G,this.enabled=this._loader.isExtensionUsed(NG)}dispose(){this._loader=null,delete this._lights}onLoading(){const G=this._loader.aj.extensions;if(G&&G[this.name]){const D=G[this.name];this._lights=D.lights}}loadSceneAsync(G,D){return M.LoadExtensionAsync(G,D,this.name,((N,T)=>{this._loader._allMaterialsDirtyRequired=!0;const o=new Array;o.push(this._loader.loadSceneAsync(G,D)),this._loader.logOpen(`${N}`);const Z=E.Get(`${N}/light`,this._lights,T.eb);return o.push(this._loadLightAsync(`/extensions/${this.name}/lights/${T.eb}`,Z).then((G=>{this._loader.babylonScene.environmentTexture=G}))),this._loader.logClose(),Promise.all(o).then((()=>{}))}))}_loadLightAsync(G,D){if(!D._loaded){const N=new Array;this._loader.logOpen(`${G}`);const T=new Array(D.specularImages.length);for(let o=0;o<D.specularImages.length;o++){const Z=D.specularImages[o];T[o]=new Array(Z.length);for(let D=0;D<Z.length;D++){const n=`${G}/specularImages/${o}/${D}`;this._loader.logOpen(`${n}`);const C=Z[D],P=E.Get(n,this._loader.aj.images,C);N.push(this._loader.loadImageAsync(`/images/${C}`,P).then((G=>{T[o][D]=G}))),this._loader.logClose()}}this._loader.logClose(),D._loaded=Promise.all(N).then((()=>{const N=new DG(this._loader.babylonScene,null,D.specularImageSize);if(N.name=D.name||"environment",D._babylonTexture=N,void 0!=D.jj&&(N.level=D.jj),D.rotation){let G=o.g.od(D.rotation);this._loader.babylonScene.useRightHandedSystem||(G=o.g.Inverse(G)),o.c.FromQuaternionToRef(G,N.getReflectionTextureMatrix())}if(!D.irradianceCoefficients)throw new Error(`${G}: Irradiance coefficients are missing`);const Z=e.e.od(D.irradianceCoefficients);Z.scaleInPlace(D.jj),Z.convertIrradianceToLambertianRadiance();const n=e.g.FromHarmonics(Z),C=(T.length-1)/Math.log2(D.specularImageSize);return N.updateRGBDAsync(T,n,C)}))}return D._loaded.then((()=>D._babylonTexture))}}k(NG),x(NG,!0,(G=>new TG(G)));N(11772);const oG="EXT_mesh_gpu_instancing";class ZG{constructor(G){this.name=oG,this._loader=G,this.enabled=this._loader.isExtensionUsed(oG)}dispose(){this._loader=null}loadNodeAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((G,T)=>{this._loader._disableInstancedMesh++;const Z=this._loader.loadNodeAsync(`/nodes/${D.index}`,D,N);if(this._loader._disableInstancedMesh--,!D._primitiveBabylonMeshes)return Z;const n=new Array;let C=0;const P=D=>{if(void 0==T.attributes[D])return void n.push(Promise.resolve(null));const N=E.Get(`${G}/attributes/${D}`,this._loader.aj.accessors,T.attributes[D]);if(n.push(this._loader._loadFloatAccessorAsync(`/accessors/${N.bufferView}`,N)),0===C)C=N.count;else if(C!==N.count)throw new Error(`${G}/attributes: Instance buffer accessors do not have the same count.`)};return P("TRANSLATION"),P("ROTATION"),P("SCALE"),Z.then((G=>Promise.all(n).then((N=>{let[T,Z,n]=N;const P=new Float32Array(16*C);o.k.Ad[0].xd(0,0,0),o.k.Quaternion[0].xd(0,0,0,1),o.k.Ad[1].xd(1,1,1);for(let G=0;G<C;++G)T&&o.s.FromArrayToRef(T,3*G,o.k.Ad[0]),Z&&o.g.FromArrayToRef(Z,4*G,o.k.Quaternion[0]),n&&o.s.FromArrayToRef(n,3*G,o.k.Ad[1]),o.c.ComposeToRef(o.k.Ad[1],o.k.Quaternion[0],o.k.Ad[0],o.k.Matrix[0]),o.k.Matrix[0].copyToArray(P,16*G);for(const G of D._primitiveBabylonMeshes)G.Sj("matrix",P,16,!0);return G}))))}))}}k(oG),x(oG,!0,(G=>new ZG(G)));class nG{static get Default(){return nG._Default||(nG._Default=new nG),nG._Default}constructor(){const G=nG.Configuration.decoder;this._decoderModulePromise=n.f.LoadBabylonScriptAsync(G.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(G,D,N,T,o){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const Z=await MeshoptDecoder.decodeGltfBufferAsync(D,N,G,T,o);return MeshoptDecoder.useWorkers(0),Z}))}}nG.Configuration={decoder:{url:`${n.f._DefaultCdnUrl}/meshopt_decoder.js`}},nG._Default=null;const CG="EXT_meshopt_compression";class PG{constructor(G){this.name=CG,this.enabled=G.isExtensionUsed(CG),this._loader=G}dispose(){this._loader=null}loadBufferViewAsync(G,D){return M.LoadExtensionAsync(G,D,this.name,((N,T)=>{const o=D;if(o._meshOptData)return o._meshOptData;const Z=E.Get(`${G}/buffer`,this._loader.aj.buffers,T.buffer);return o._meshOptData=this._loader.loadBufferAsync(`/buffers/${Z.index}`,Z,T.byteOffset||0,T.byteLength).then((G=>nG.Default.decodeGltfBufferAsync(G,T.count,T.byteStride,T.mode,T.filter))),o._meshOptData}))}}k(CG),x(CG,!0,(G=>new PG(G)));const rG="EXT_texture_webp";class vG{constructor(G){this.name=rG,this._loader=G,this.enabled=G.isExtensionUsed(rG)}dispose(){this._loader=null}_loadTextureAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>{const Z=void 0==D.sampler?M.DefaultSampler:E.Get(`${G}/sampler`,this._loader.aj.samplers,D.sampler),n=E.Get(`${T}/source`,this._loader.aj.images,o.source);return this._loader._createTextureAsync(G,Z,n,(G=>{N(G)}),void 0,!D._textureInfo.nonColorData)}))}}k(rG),x(rG,!0,(G=>new vG(G)));const qG="EXT_texture_avif";class gG{constructor(G){this.name=qG,this._loader=G,this.enabled=G.isExtensionUsed(qG)}dispose(){this._loader=null}_loadTextureAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>{const Z=void 0==D.sampler?M.DefaultSampler:E.Get(`${G}/sampler`,this._loader.aj.samplers,D.sampler),n=E.Get(`${T}/source`,this._loader.aj.images,o.source);return this._loader._createTextureAsync(G,Z,n,(G=>{N(G)}),void 0,!D._textureInfo.nonColorData)}))}}k(qG),x(qG,!0,(G=>new gG(G)));var XG=N(11774);const WG="KHR_draco_mesh_compression";class jG{constructor(G){this.name=WG,this.useNormalizedFlagFromAccessor=!0,this._loader=G,this.enabled=XG.c.DecoderAvailable&&this._loader.isExtensionUsed(WG)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>{if(void 0!=D.mode&&4!==D.mode&&5!==D.mode)throw new Error(`${G}: Unsupported mode ${D.mode}`);const Z={},n={},C=(G,T)=>{const C=o.attributes[G];if(void 0!=C&&(N._delayInfo=N._delayInfo||[],-1===N._delayInfo.indexOf(T)&&N._delayInfo.push(T),Z[T]=C,this.useNormalizedFlagFromAccessor)){const N=E.TryGet(this._loader.aj.accessors,D.attributes[G]);N&&(n[T]=N.normalized||!1)}};C("POSITION",z.f.PositionKind),C("NORMAL",z.f.NormalKind),C("TANGENT",z.f.TangentKind),C("TEXCOORD_0",z.f.UVKind),C("TEXCOORD_1",z.f.UV2Kind),C("TEXCOORD_2",z.f.UV3Kind),C("TEXCOORD_3",z.f.UV4Kind),C("TEXCOORD_4",z.f.UV5Kind),C("TEXCOORD_5",z.f.UV6Kind),C("JOINTS_0",z.f.MatricesIndicesKind),C("WEIGHTS_0",z.f.MatricesWeightsKind),C("COLOR_0",z.f.ColorKind);const P=E.Get(T,this._loader.aj.bufferViews,o.bufferView);return P._dracoBabylonGeometry||(P._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${P.index}`,P).then((D=>(this.dracoCompression||XG.c.Default)._decodeMeshToGeometryForGltfAsync(N.name,this._loader.babylonScene,D,Z,n).catch((D=>{throw new Error(`${G}: ${D.message}`)}))))),P._dracoBabylonGeometry}))}}k(WG),x(WG,!0,(G=>new jG(G)));var YG=N(11780),yG=N(11399),hG=N(11753),mG=N(11784);yG.b.AddNodeConstructor("Light_Type_0",((G,D)=>()=>new RG(G,o.s.Zero(),D)));class RG extends mG.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(G){this._shadowAngle=G,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(G){const D=this.needCube();if(this._direction=G,this.needCube()!==D&&this._shadowGenerators){const G=this._shadowGenerators.values();for(let D=G.next();!0!==D.done;D=G.next()){D.value.recreateShadowMap()}}}constructor(G,D,N){super(G,N),this._shadowAngle=Math.PI/2,this.position=D}getClassName(){return"PointLight"}getTypeID(){return hG.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(G){if(this.direction)return super.getShadowDirection(G);switch(G){case 0:return new o.s(1,0,0);case 1:return new o.s(-1,0,0);case 2:return new o.s(0,-1,0);case 3:return new o.s(0,1,0);case 4:return new o.s(0,0,1);case 5:return new o.s(0,0,-1)}return o.s.Zero()}_setDefaultShadowProjectionMatrix(G,D,N){const T=this.va().activeCamera;if(!T)return;const Z=void 0!==this.shadowMinZ?this.shadowMinZ:T.fj,n=void 0!==this.shadowMaxZ?this.shadowMaxZ:T.maxZ,C=this.va().getEngine().useReverseDepthBuffer;o.c.PerspectiveFovLHToRef(this.shadowAngle,1,C?n:Z,C?Z:n,G,!0,this._scene.getEngine().isNDCHalfZRange,void 0,C)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(G,D){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,D):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,D),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,D),this}transferToNodeMaterialEffect(G,D){return this.computeTransformedInformation()?G.setFloat3(D,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):G.setFloat3(D,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(G,D){G["POINTLIGHT"+D]=!0}}(0,m.c)([(0,R.S)()],RG.prototype,"shadowAngle",null),(0,B.h)("BABYLON.PointLight",RG),yG.b.AddNodeConstructor("Light_Type_2",((G,D)=>()=>new LG(G,o.s.Zero(),o.s.Zero(),0,0,D)));class LG extends mG.c{get angle(){return this._angle}set angle(G){this._angle=G,this._cosHalfAngle=Math.cos(.5*G),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(G){this._innerAngle=G,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(G){this._shadowAngleScale=G,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(G){this._projectionTextureLightNear=G,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(G){this._projectionTextureLightFar=G,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(G){this._projectionTextureUpDirection=G,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(G){this._projectionTexture!==G&&(this._projectionTexture=G,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(LG._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):LG._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(G){return void 0!==G.onGeneratedObservable}static _IsTexture(G){return void 0!==G.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(G){this._projectionTextureProjectionLightMatrix=G,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(G,D,N,T,Z,n){super(G,n),this._innerAngle=0,this._projectionTextureMatrix=o.c.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=o.s.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=o.s.Zero(),this._projectionTextureViewLightMatrix=o.c.Zero(),this._projectionTextureProjectionLightMatrix=o.c.Zero(),this._projectionTextureScalingMatrix=o.c.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=D,this.direction=N,this.angle=T,this.exponent=Z}getClassName(){return"SpotLight"}getTypeID(){return hG.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(G){super._setDirection(G),this._projectionTextureViewLightDirty=!0}_setPosition(G){super._setPosition(G),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(G,D,N){const T=this.va().activeCamera;if(!T)return;this._shadowAngleScale=this._shadowAngleScale||1;const Z=this._shadowAngleScale*this._angle,n=void 0!==this.shadowMinZ?this.shadowMinZ:T.fj,C=void 0!==this.shadowMaxZ?this.shadowMaxZ:T.maxZ,P=this.va().getEngine().useReverseDepthBuffer;o.c.PerspectiveFovLHToRef(Z,1,P?C:n,P?n:C,G,!0,this._scene.getEngine().isNDCHalfZRange,void 0,P)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),o.c.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const G=this.projectionTextureLightFar,D=this.projectionTextureLightNear,N=G/(G-D),T=-N*D,Z=1/Math.tan(this._angle/2);o.c.FromValuesToRef(Z/1,0,0,0,0,Z,0,0,0,0,N,1,0,0,T,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof V.e){const G=this._projectionTexture.uScale/2,D=this._projectionTexture.vScale/2;o.c.FromValuesToRef(G,0,0,0,0,D,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(G,D){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),G.setMatrix("textureProjectionMatrix"+D,this._projectionTextureMatrix),G.setTexture("projectionLightTexture"+D,this.projectionTexture)),this}transferToEffect(G,D){let N;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,D),N=o.s.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,D),N=o.s.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",N.x,N.y,N.z,this._cosHalfAngle,D),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,D),this}transferToNodeMaterialEffect(G,D){let N;return N=this.computeTransformedInformation()?o.s.Normalize(this.transformedDirection):o.s.Normalize(this.direction),this.va().useRightHandedSystem?G.setFloat3(D,-N.x,-N.y,-N.z):G.setFloat3(D,N.x,N.y,N.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(G){const D=this._scene.getEngine(),N=void 0!==this.shadowMinZ?this.shadowMinZ:G.fj;return D.useReverseDepthBuffer&&D.isNDCHalfZRange?N:this._scene.getEngine().isNDCHalfZRange?0:N}getDepthMaxZ(G){const D=this._scene.getEngine(),N=void 0!==this.shadowMaxZ?this.shadowMaxZ:G.maxZ;return D.useReverseDepthBuffer&&D.isNDCHalfZRange?0:N}prepareLightSpecificDefines(G,D){G["SPOTLIGHT"+D]=!0,G["PROJECTEDLIGHTTEXTURE"+D]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,m.c)([(0,R.S)()],LG.prototype,"angle",null),(0,m.c)([(0,R.S)()],LG.prototype,"innerAngle",null),(0,m.c)([(0,R.S)()],LG.prototype,"shadowAngleScale",null),(0,m.c)([(0,R.S)()],LG.prototype,"exponent",void 0),(0,m.c)([(0,R.S)()],LG.prototype,"projectionTextureLightNear",null),(0,m.c)([(0,R.S)()],LG.prototype,"projectionTextureLightFar",null),(0,m.c)([(0,R.S)()],LG.prototype,"projectionTextureUpDirection",null),(0,m.c)([(0,R.G)("projectedLightTexture")],LG.prototype,"_projectionTexture",void 0),(0,B.h)("BABYLON.SpotLight",LG);const wG="KHR_lights_punctual";class BG{constructor(G){this.name=wG,this._loader=G,this.enabled=this._loader.isExtensionUsed(wG)}dispose(){this._loader=null,delete this._lights}onLoading(){const G=this._loader.aj.extensions;if(G&&G[this.name]){const D=G[this.name];this._lights=D.lights,E.Assign(this._lights)}}loadNodeAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,n)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(G,D,(G=>{let D;const C=E.Get(T,this._lights,n.eb),P=C.name||G.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,C.type){case"directional":{const G=new YG.d(P,o.s.Backward(),this._loader.babylonScene);G.position.zd(0),D=G;break}case"point":D=new RG(P,o.s.Zero(),this._loader.babylonScene);break;case"spot":{const G=new LG(P,o.s.Zero(),o.s.Backward(),0,1,this._loader.babylonScene);G.angle=2*(C.spot&&C.spot.outerConeAngle||Math.PI/4),G.innerAngle=2*(C.spot&&C.spot.innerConeAngle||0),D=G;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${T}: Invalid light type (${C.type})`)}D._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,C._babylonLight=D,D.falloffType=hG.e.FALLOFF_GLTF,D.Th=C.color?Z.d.od(C.color):Z.d.White(),D.jj=void 0==C.jj?1:C.jj,D.range=void 0==C.range?Number.MAX_VALUE:C.range,D.parent=G,this._loader._babylonLights.push(D),M.AddPointerMetadata(D,T),N(G)})))))}}k(wG),x(wG,!0,(G=>new BG(G)));const FG="KHR_materials_pbrSpecularGlossiness";class SG{constructor(G){this.name=FG,this.order=200,this._loader=G,this.enabled=this._loader.isExtensionUsed(FG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>{const Z=new Array;return Z.push(this._loader.loadMaterialBasePropertiesAsync(G,D,N)),Z.push(this._loadSpecularGlossinessPropertiesAsync(T,o,N)),this._loader.loadMaterialAlphaProperties(G,D,N),Promise.all(Z).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(G,D,N){if(!(N instanceof S))throw new Error(`${G}: Material type not supported`);const T=new Array;return N.metallic=null,N.roughness=null,D.diffuseFactor?(N.albedoColor=Z.d.od(D.diffuseFactor),N.alpha=D.diffuseFactor[3]):N.albedoColor=Z.d.White(),N.reflectivityColor=D.specularFactor?Z.d.od(D.specularFactor):Z.d.White(),N.microSurface=void 0==D.glossinessFactor?1:D.glossinessFactor,D.diffuseTexture&&T.push(this._loader.loadTextureInfoAsync(`${G}/diffuseTexture`,D.diffuseTexture,(G=>{G.name=`${N.name} (Diffuse)`,N.albedoTexture=G}))),D.specularGlossinessTexture&&(T.push(this._loader.loadTextureInfoAsync(`${G}/specularGlossinessTexture`,D.specularGlossinessTexture,(G=>{G.name=`${N.name} (Specular Glossiness)`,N.reflectivityTexture=G,N.reflectivityTexture.jd=!0}))),N.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(T).then((()=>{}))}}k(FG),x(FG,!0,(G=>new SG(G)));const VG="KHR_materials_unlit";class UG{constructor(G){this.name=VG,this.order=210,this._loader=G,this.enabled=this._loader.isExtensionUsed(VG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,(()=>this._loadUnlitPropertiesAsync(G,D,N)))}_loadUnlitPropertiesAsync(G,D,N){if(!(N instanceof S))throw new Error(`${G}: Material type not supported`);const T=new Array;N.unlit=!0;const o=D.pbrMetallicRoughness;return o&&(o.baseColorFactor?(N.albedoColor=Z.d.od(o.baseColorFactor),N.alpha=o.baseColorFactor[3]):N.albedoColor=Z.d.White(),o.baseColorTexture&&T.push(this._loader.loadTextureInfoAsync(`${G}/baseColorTexture`,o.baseColorTexture,(G=>{G.name=`${N.name} (Base Color)`,N.albedoTexture=G})))),D.doubleSided&&(N.Ge=!1,N.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(G,D,N),Promise.all(T).then((()=>{}))}}k(VG),x(VG,!0,(G=>new UG(G)));const zG="KHR_materials_clearcoat";class iG{constructor(G){this.name=zG,this.order=190,this._loader=G,this.enabled=this._loader.isExtensionUsed(zG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(G,D,N)),Z.push(this._loadClearCoatPropertiesAsync(T,o,N)),Promise.all(Z).then((()=>{}))}))}_loadClearCoatPropertiesAsync(G,D,N){if(!(N instanceof S))throw new Error(`${G}: Material type not supported`);const T=new Array;return N.clearCoat.isEnabled=!0,N.clearCoat.useRoughnessFromMainTexture=!1,N.clearCoat.remapF0OnInterfaceChange=!1,void 0!=D.clearcoatFactor?N.clearCoat.jj=D.clearcoatFactor:N.clearCoat.jj=0,D.clearcoatTexture&&T.push(this._loader.loadTextureInfoAsync(`${G}/clearcoatTexture`,D.clearcoatTexture,(G=>{G.name=`${N.name} (ClearCoat)`,N.clearCoat.texture=G}))),void 0!=D.clearcoatRoughnessFactor?N.clearCoat.roughness=D.clearcoatRoughnessFactor:N.clearCoat.roughness=0,D.clearcoatRoughnessTexture&&(D.clearcoatRoughnessTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${G}/clearcoatRoughnessTexture`,D.clearcoatRoughnessTexture,(G=>{G.name=`${N.name} (ClearCoat Roughness)`,N.clearCoat.textureRoughness=G})))),D.clearcoatNormalTexture&&(D.clearcoatNormalTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${G}/clearcoatNormalTexture`,D.clearcoatNormalTexture,(G=>{G.name=`${N.name} (ClearCoat Normal)`,N.clearCoat.bumpTexture=G}))),N.invertNormalMapX=!N.va().useRightHandedSystem,N.invertNormalMapY=N.va().useRightHandedSystem,void 0!=D.clearcoatNormalTexture.scale&&(N.clearCoat.bumpTexture.level=D.clearcoatNormalTexture.scale)),Promise.all(T).then((()=>{}))}}k(zG),x(zG,!0,(G=>new iG(G)));const JG="KHR_materials_iridescence";class pG{constructor(G){this.name=JG,this.order=195,this._loader=G,this.enabled=this._loader.isExtensionUsed(JG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(G,D,N)),Z.push(this._loadIridescencePropertiesAsync(T,o,N)),Promise.all(Z).then((()=>{}))}))}_loadIridescencePropertiesAsync(G,D,N){if(!(N instanceof S))throw new Error(`${G}: Material type not supported`);const T=new Array;return N.iridescence.isEnabled=!0,N.iridescence.jj=D.iridescenceFactor??0,N.iridescence.indexOfRefraction=D.iridescenceIor??D.iridescenceIOR??1.3,N.iridescence.minimumThickness=D.iridescenceThicknessMinimum??100,N.iridescence.maximumThickness=D.iridescenceThicknessMaximum??400,D.iridescenceTexture&&T.push(this._loader.loadTextureInfoAsync(`${G}/iridescenceTexture`,D.iridescenceTexture,(G=>{G.name=`${N.name} (Iridescence)`,N.iridescence.texture=G}))),D.iridescenceThicknessTexture&&T.push(this._loader.loadTextureInfoAsync(`${G}/iridescenceThicknessTexture`,D.iridescenceThicknessTexture,(G=>{G.name=`${N.name} (Iridescence Thickness)`,N.iridescence.thicknessTexture=G}))),Promise.all(T).then((()=>{}))}}k(JG),x(JG,!0,(G=>new pG(G)));const tG="KHR_materials_anisotropy";class HG{constructor(G){this.name=tG,this.order=195,this._loader=G,this.enabled=this._loader.isExtensionUsed(tG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(G,D,N)),Z.push(this._loadIridescencePropertiesAsync(T,o,N)),Promise.all(Z).then((()=>{}))}))}_loadIridescencePropertiesAsync(G,D,N){if(!(N instanceof S))throw new Error(`${G}: Material type not supported`);const T=new Array;return N.anisotropy.isEnabled=!0,N.anisotropy.jj=D.anisotropyStrength??0,N.anisotropy.angle=D.anisotropyRotation??0,D.anisotropyTexture&&(D.anisotropyTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${G}/anisotropyTexture`,D.anisotropyTexture,(G=>{G.name=`${N.name} (Anisotropy Intensity)`,N.anisotropy.texture=G})))),Promise.all(T).then((()=>{}))}}k(tG),x(tG,!0,(G=>new HG(G)));const sG="KHR_materials_emissive_strength";class cG{constructor(G){this.name=sG,this.order=170,this._loader=G,this.enabled=this._loader.isExtensionUsed(sG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>this._loader.loadMaterialPropertiesAsync(G,D,N).then((()=>{this._loadEmissiveProperties(T,o,N)}))))}_loadEmissiveProperties(G,D,N){if(!(N instanceof S))throw new Error(`${G}: Material type not supported`);void 0!==D.emissiveStrength&&(N.emissiveIntensity=D.emissiveStrength)}}k(sG),x(sG,!0,(G=>new cG(G)));const KG="KHR_materials_sheen";class bG{constructor(G){this.name=KG,this.order=190,this._loader=G,this.enabled=this._loader.isExtensionUsed(KG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(G,D,N)),Z.push(this._loadSheenPropertiesAsync(T,o,N)),Promise.all(Z).then((()=>{}))}))}_loadSheenPropertiesAsync(G,D,N){if(!(N instanceof S))throw new Error(`${G}: Material type not supported`);const T=new Array;return N.sheen.isEnabled=!0,N.sheen.jj=1,void 0!=D.sheenColorFactor?N.sheen.color=Z.d.od(D.sheenColorFactor):N.sheen.color=Z.d.Black(),D.sheenColorTexture&&T.push(this._loader.loadTextureInfoAsync(`${G}/sheenColorTexture`,D.sheenColorTexture,(G=>{G.name=`${N.name} (Sheen Color)`,N.sheen.texture=G}))),void 0!==D.sheenRoughnessFactor?N.sheen.roughness=D.sheenRoughnessFactor:N.sheen.roughness=0,D.sheenRoughnessTexture&&(D.sheenRoughnessTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${G}/sheenRoughnessTexture`,D.sheenRoughnessTexture,(G=>{G.name=`${N.name} (Sheen Roughness)`,N.sheen.textureRoughness=G})))),N.sheen.albedoScaling=!0,N.sheen.useRoughnessFromMainTexture=!1,Promise.all(T).then((()=>{}))}}k(KG),x(KG,!0,(G=>new bG(G)));const OG="KHR_materials_specular";class QG{constructor(G){this.name=OG,this.order=190,this._loader=G,this.enabled=this._loader.isExtensionUsed(OG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(G,D,N)),Z.push(this._loadSpecularPropertiesAsync(T,o,N)),Promise.all(Z).then((()=>{}))}))}_loadSpecularPropertiesAsync(G,D,N){if(!(N instanceof S))throw new Error(`${G}: Material type not supported`);const T=new Array;return void 0!==D.specularFactor&&(N.metallicF0Factor=D.specularFactor),void 0!==D.specularColorFactor&&(N.metallicReflectanceColor=Z.d.od(D.specularColorFactor)),D.specularTexture&&(D.specularTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${G}/specularTexture`,D.specularTexture,(G=>{G.name=`${N.name} (Specular)`,N.metallicReflectanceTexture=G,N.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),D.specularColorTexture&&T.push(this._loader.loadTextureInfoAsync(`${G}/specularColorTexture`,D.specularColorTexture,(G=>{G.name=`${N.name} (Specular Color)`,N.reflectanceTexture=G}))),Promise.all(T).then((()=>{}))}}k(OG),x(OG,!0,(G=>new QG(G)));const AG="KHR_materials_ior";class IG{constructor(G){this.name=AG,this.order=180,this._loader=G,this.enabled=this._loader.isExtensionUsed(AG)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(G,D,N)),Z.push(this._loadIorPropertiesAsync(T,o,N)),Promise.all(Z).then((()=>{}))}))}_loadIorPropertiesAsync(G,D,N){if(!(N instanceof S))throw new Error(`${G}: Material type not supported`);return void 0!==D.ior?N.indexOfRefraction=D.ior:N.indexOfRefraction=IG._DEFAULT_IOR,Promise.resolve()}}IG._DEFAULT_IOR=1.5,k(AG),x(AG,!0,(G=>new IG(G)));const dG="KHR_materials_variants";class uG{constructor(G){this.name=dG,this._loader=G,this.enabled=this._loader.isExtensionUsed(dG)}dispose(){this._loader=null}static GetAvailableVariants(G){const D=this._GetExtensionMetadata(G);return D?Object.keys(D.variants):[]}getAvailableVariants(G){return uG.GetAvailableVariants(G)}static SelectVariant(G,D){const N=this._GetExtensionMetadata(G);if(!N)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${dG} extension`);const T=G=>{const D=N.variants[G];if(D)for(const N of D)N.mesh.material=N.material};if(D instanceof Array)for(const o of D)T(o);else T(D);N.lastSelected=D}selectVariant(G,D){uG.SelectVariant(G,D)}static Reset(G){const D=this._GetExtensionMetadata(G);if(!D)throw new Error(`Cannot reset on a glTF mesh that does not have the ${dG} extension`);for(const N of D.original)N.mesh.material=N.material;D.lastSelected=null}reset(G){uG.Reset(G)}static GetLastSelectedVariant(G){const D=this._GetExtensionMetadata(G);if(!D)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${dG} extension`);return D.lastSelected}getLastSelectedVariant(G){return uG.GetLastSelectedVariant(G)}static _GetExtensionMetadata(G){var D,N;return(null===G||void 0===G||null===(D=G._internalMetadata)||void 0===D||null===(N=D.aj)||void 0===N?void 0:N[dG])||null}onLoading(){const G=this._loader.aj.extensions;if(G&&G[this.name]){const D=G[this.name];this._variants=D.variants}}_loadMeshPrimitiveAsync(G,D,N,T,o,Z){return M.LoadExtensionAsync(G,o,this.name,((n,C)=>{const P=new Array;return P.push(this._loader._loadMeshPrimitiveAsync(G,D,N,T,o,(D=>{if(Z(D),D instanceof p.d){const N=M._GetDrawMode(G,o.mode),T=this._loader.rootBabylonMesh,Z=T?T._internalMetadata=T._internalMetadata||{}:{},r=Z.aj=Z.aj||{},v=r[dG]=r[dG]||{lastSelected:null,original:[],variants:{}};v.original.push({mesh:D,material:D.material});for(let G=0;G<C.mappings.length;++G){const o=C.mappings[G],Z=E.Get(`${n}/mappings/${G}/material`,this._loader.aj.materials,o.material);P.push(this._loader._loadMaterialAsync(`#/materials/${o.material}`,Z,D,N,(G=>{for(let N=0;N<o.variants.length;++N){const Z=o.variants[N],n=E.Get(`/extensions/${dG}/variants/${Z}`,this._variants,Z);v.variants[n.name]=v.variants[n.name]||[],v.variants[n.name].push({mesh:D,material:G}),D.onClonedObservable.add((G=>{const N=G;let o=null,Z=N;do{if(Z=Z.parent,!Z)return;o=uG._GetExtensionMetadata(Z)}while(null===o);if(T&&o===uG._GetExtensionMetadata(T)){Z._internalMetadata={};for(const G in T._internalMetadata)Z._internalMetadata[G]=T._internalMetadata[G];Z._internalMetadata.aj=[];for(const G in T._internalMetadata.aj)Z._internalMetadata.aj[G]=T._internalMetadata.aj[G];Z._internalMetadata.aj[dG]={lastSelected:null,original:[],variants:{}};for(const G of o.original)Z._internalMetadata.aj[dG].original.push({mesh:G.mesh,material:G.material});for(const G in o.variants)if(Object.prototype.hasOwnProperty.call(o.variants,G)){Z._internalMetadata.aj[dG].variants[G]=[];for(const D of o.variants[G])Z._internalMetadata.aj[dG].variants[G].push({mesh:D.mesh,material:D.material})}o=Z._internalMetadata.aj[dG]}for(const T of o.original)T.mesh===D&&(T.mesh=N);for(const T of o.variants[n.name])T.mesh===D&&(T.mesh=N)}))}})))}}}))),Promise.all(P).then((G=>{let[D]=G;return D}))}))}}k(dG),x(dG,!0,(G=>new uG(G)));var lG=N(1507);class xG{}xG.AUTOSAMPLERSUFFIX="Sampler",xG.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",xG.ALPHA_DISABLE=0,xG.ALPHA_ADD=1,xG.ALPHA_COMBINE=2,xG.ALPHA_SUBTRACT=3,xG.ALPHA_MULTIPLY=4,xG.ALPHA_MAXIMIZED=5,xG.ALPHA_ONEONE=6,xG.ALPHA_PREMULTIPLIED=7,xG.ALPHA_PREMULTIPLIED_PORTERDUFF=8,xG.ALPHA_INTERPOLATE=9,xG.ALPHA_SCREENMODE=10,xG.ALPHA_ONEONE_ONEONE=11,xG.ALPHA_ALPHATOCOLOR=12,xG.ALPHA_REVERSEONEMINUS=13,xG.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,xG.ALPHA_ONEONE_ONEZERO=15,xG.ALPHA_EXCLUSION=16,xG.ALPHA_LAYER_ACCUMULATE=17,xG.ALPHA_EQUATION_ADD=0,xG.ALPHA_EQUATION_SUBSTRACT=1,xG.ALPHA_EQUATION_REVERSE_SUBTRACT=2,xG.ALPHA_EQUATION_MAX=3,xG.ALPHA_EQUATION_MIN=4,xG.ALPHA_EQUATION_DARKEN=5,xG.DELAYLOADSTATE_NONE=0,xG.DELAYLOADSTATE_LOADED=1,xG.DELAYLOADSTATE_LOADING=2,xG.DELAYLOADSTATE_NOTLOADED=4,xG.NEVER=512,xG.ALWAYS=519,xG.LESS=513,xG.EQUAL=514,xG.LEQUAL=515,xG.GREATER=516,xG.GEQUAL=518,xG.NOTEQUAL=517,xG.KEEP=7680,xG.ZERO=0,xG.REPLACE=7681,xG.INCR=7682,xG.DECR=7683,xG.INVERT=5386,xG.INCR_WRAP=34055,xG.DECR_WRAP=34056,xG.TEXTURE_CLAMP_ADDRESSMODE=0,xG.TEXTURE_WRAP_ADDRESSMODE=1,xG.TEXTURE_MIRROR_ADDRESSMODE=2,xG.TEXTURE_CREATIONFLAG_STORAGE=1,xG.TEXTUREFORMAT_ALPHA=0,xG.TEXTUREFORMAT_LUMINANCE=1,xG.TEXTUREFORMAT_LUMINANCE_ALPHA=2,xG.TEXTUREFORMAT_RGB=4,xG.TEXTUREFORMAT_RGBA=5,xG.TEXTUREFORMAT_RED=6,xG.TEXTUREFORMAT_R=6,xG.TEXTUREFORMAT_RG=7,xG.TEXTUREFORMAT_RED_INTEGER=8,xG.TEXTUREFORMAT_R_INTEGER=8,xG.TEXTUREFORMAT_RG_INTEGER=9,xG.TEXTUREFORMAT_RGB_INTEGER=10,xG.TEXTUREFORMAT_RGBA_INTEGER=11,xG.TEXTUREFORMAT_BGRA=12,xG.TEXTUREFORMAT_DEPTH24_STENCIL8=13,xG.TEXTUREFORMAT_DEPTH32_FLOAT=14,xG.TEXTUREFORMAT_DEPTH16=15,xG.TEXTUREFORMAT_DEPTH24=16,xG.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,xG.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,xG.TEXTUREFORMAT_STENCIL8=19,xG.TEXTUREFORMAT_UNDEFINED=4294967295,xG.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,xG.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,xG.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,xG.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,xG.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,xG.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,xG.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,xG.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,xG.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,xG.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,xG.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,xG.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,xG.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,xG.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,xG.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,xG.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,xG.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,xG.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,xG.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,xG.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,xG.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,xG.TEXTURETYPE_UNSIGNED_BYTE=0,xG.TEXTURETYPE_UNSIGNED_INT=0,xG.TEXTURETYPE_FLOAT=1,xG.TEXTURETYPE_HALF_FLOAT=2,xG.TEXTURETYPE_BYTE=3,xG.TEXTURETYPE_SHORT=4,xG.TEXTURETYPE_UNSIGNED_SHORT=5,xG.TEXTURETYPE_INT=6,xG.TEXTURETYPE_UNSIGNED_INTEGER=7,xG.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,xG.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,xG.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,xG.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,xG.TEXTURETYPE_UNSIGNED_INT_24_8=12,xG.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,xG.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,xG.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,xG.TEXTURETYPE_UNDEFINED=16,xG.TEXTURE_2D=3553,xG.TEXTURE_2D_ARRAY=35866,xG.TEXTURE_CUBE_MAP=34067,xG.TEXTURE_CUBE_MAP_ARRAY=3735928559,xG.TEXTURE_3D=32879,xG.TEXTURE_NEAREST_SAMPLINGMODE=1,xG.TEXTURE_NEAREST_NEAREST=1,xG.TEXTURE_BILINEAR_SAMPLINGMODE=2,xG.TEXTURE_LINEAR_LINEAR=2,xG.TEXTURE_TRILINEAR_SAMPLINGMODE=3,xG.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,xG.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,xG.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,xG.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,xG.TEXTURE_NEAREST_LINEAR=7,xG.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,xG.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,xG.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,xG.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,xG.TEXTURE_LINEAR_NEAREST=12,xG.TEXTURE_EXPLICIT_MODE=0,xG.TEXTURE_SPHERICAL_MODE=1,xG.TEXTURE_PLANAR_MODE=2,xG.TEXTURE_CUBIC_MODE=3,xG.TEXTURE_PROJECTION_MODE=4,xG.TEXTURE_SKYBOX_MODE=5,xG.TEXTURE_INVCUBIC_MODE=6,xG.TEXTURE_EQUIRECTANGULAR_MODE=7,xG.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,xG.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,xG.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,xG.TEXTURE_FILTERING_QUALITY_HIGH=64,xG.TEXTURE_FILTERING_QUALITY_MEDIUM=16,xG.TEXTURE_FILTERING_QUALITY_LOW=8,xG.SCALEMODE_FLOOR=1,xG.SCALEMODE_NEAREST=2,xG.SCALEMODE_CEILING=3,xG.MATERIAL_TextureDirtyFlag=1,xG.MATERIAL_LightDirtyFlag=2,xG.MATERIAL_FresnelDirtyFlag=4,xG.MATERIAL_AttributesDirtyFlag=8,xG.MATERIAL_MiscDirtyFlag=16,xG.MATERIAL_PrePassDirtyFlag=32,xG.MATERIAL_AllDirtyFlag=63,xG.MATERIAL_TriangleFillMode=0,xG.MATERIAL_WireFrameFillMode=1,xG.MATERIAL_PointFillMode=2,xG.MATERIAL_PointListDrawMode=3,xG.MATERIAL_LineListDrawMode=4,xG.MATERIAL_LineLoopDrawMode=5,xG.MATERIAL_LineStripDrawMode=6,xG.MATERIAL_TriangleStripDrawMode=7,xG.MATERIAL_TriangleFanDrawMode=8,xG.MATERIAL_ClockWiseSideOrientation=0,xG.MATERIAL_CounterClockWiseSideOrientation=1,xG.ACTION_NothingTrigger=0,xG.ACTION_OnPickTrigger=1,xG.ACTION_OnLeftPickTrigger=2,xG.ACTION_OnRightPickTrigger=3,xG.ACTION_OnCenterPickTrigger=4,xG.ACTION_OnPickDownTrigger=5,xG.ACTION_OnDoublePickTrigger=6,xG.ACTION_OnPickUpTrigger=7,xG.ACTION_OnPickOutTrigger=16,xG.ACTION_OnLongPressTrigger=8,xG.ACTION_OnPointerOverTrigger=9,xG.ACTION_OnPointerOutTrigger=10,xG.ACTION_OnEveryFrameTrigger=11,xG.ACTION_OnIntersectionEnterTrigger=12,xG.ACTION_OnIntersectionExitTrigger=13,xG.ACTION_OnKeyDownTrigger=14,xG.ACTION_OnKeyUpTrigger=15,xG.PARTICLES_BILLBOARDMODE_Y=2,xG.PARTICLES_BILLBOARDMODE_ALL=7,xG.PARTICLES_BILLBOARDMODE_STRETCHED=8,xG.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,xG.MESHES_CULLINGSTRATEGY_STANDARD=0,xG.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,xG.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,xG.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,xG.SCENELOADER_NO_LOGGING=0,xG.SCENELOADER_MINIMAL_LOGGING=1,xG.SCENELOADER_SUMMARY_LOGGING=2,xG.SCENELOADER_DETAILED_LOGGING=3,xG.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,xG.PREPASS_POSITION_TEXTURE_TYPE=1,xG.PREPASS_VELOCITY_TEXTURE_TYPE=2,xG.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,xG.PREPASS_COLOR_TEXTURE_TYPE=4,xG.PREPASS_DEPTH_TEXTURE_TYPE=5,xG.PREPASS_NORMAL_TEXTURE_TYPE=6,xG.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,xG.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,xG.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,xG.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,xG.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,xG.PREPASS_ALBEDO_TEXTURE_TYPE=12,xG.BUFFER_CREATIONFLAG_READ=1,xG.BUFFER_CREATIONFLAG_WRITE=2,xG.BUFFER_CREATIONFLAG_READWRITE=3,xG.BUFFER_CREATIONFLAG_UNIFORM=4,xG.BUFFER_CREATIONFLAG_VERTEX=8,xG.BUFFER_CREATIONFLAG_INDEX=16,xG.BUFFER_CREATIONFLAG_STORAGE=32,xG.BUFFER_CREATIONFLAG_INDIRECT=64,xG.RENDERPASS_MAIN=0,xG.INPUT_ALT_KEY=18,xG.INPUT_CTRL_KEY=17,xG.INPUT_META_KEY1=91,xG.INPUT_META_KEY2=92,xG.INPUT_META_KEY3=93,xG.INPUT_SHIFT_KEY=16,xG.SNAPSHOTRENDERING_STANDARD=0,xG.SNAPSHOTRENDERING_FAST=1,xG.PERSPECTIVE_CAMERA=0,xG.ORTHOGRAPHIC_CAMERA=1,xG.FOVMODE_VERTICAL_FIXED=0,xG.FOVMODE_HORIZONTAL_FIXED=1,xG.RIG_MODE_NONE=0,xG.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,xG.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,xG.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,xG.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,xG.RIG_MODE_STEREOSCOPIC_INTERLACED=14,xG.RIG_MODE_VR=20,xG.RIG_MODE_CUSTOM=22,xG.MAX_SUPPORTED_UV_SETS=6,xG.GL_ALPHA_EQUATION_ADD=32774,xG.GL_ALPHA_EQUATION_MIN=32775,xG.GL_ALPHA_EQUATION_MAX=32776,xG.GL_ALPHA_EQUATION_SUBTRACT=32778,xG.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,xG.GL_ALPHA_FUNCTION_SRC=768,xG.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,xG.GL_ALPHA_FUNCTION_SRC_ALPHA=770,xG.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,xG.GL_ALPHA_FUNCTION_DST_ALPHA=772,xG.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,xG.GL_ALPHA_FUNCTION_DST_COLOR=774,xG.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,xG.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,xG.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,xG.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,xG.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,xG.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,xG.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,xG.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,xG.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,xG.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,xG.SnippetUrl="https://snippet.babylonjs.com",xG.FOGMODE_NONE=0,xG.FOGMODE_EXP=1,xG.FOGMODE_EXP2=2,xG.FOGMODE_LINEAR=3,xG.BYTE=5120,xG.UNSIGNED_BYTE=5121,xG.SHORT=5122,xG.UNSIGNED_SHORT=5123,xG.INT=5124,xG.UNSIGNED_INT=5125,xG.FLOAT=5126,xG.PositionKind="position",xG.NormalKind="Bd",xG.TangentKind="tangent",xG.UVKind="uv",xG.UV2Kind="uv2",xG.UV3Kind="uv3",xG.UV4Kind="uv4",xG.UV5Kind="uv5",xG.UV6Kind="uv6",xG.ColorKind="color",xG.ColorInstanceKind="instanceColor",xG.MatricesIndicesKind="matricesIndices",xG.MatricesWeightsKind="matricesWeights",xG.MatricesIndicesExtraKind="matricesIndicesExtra",xG.MatricesWeightsExtraKind="matricesWeightsExtra";class kG{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:xG.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(G,D){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...kG._GetDefaultOptions(),...G},this._scene=D,this._scene._transmissionHelper=this,this.onErrorObservable=new v.b,this._scene.Fd.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(G){if(!Object.keys(G).filter((D=>this._options[D]!==G[D])).length)return;const D={...this._options,...G},N=this._options;this._options=D,D.renderSize===N.renderSize&&D.renderTargetTextureType===N.renderTargetTextureType&&D.generateMipmaps===N.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=D.samples,this._opaqueRenderTarget.lodGenerationScale=D.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=D.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(G){return!!G&&!!(G instanceof S&&G.subSurface.isRefractionEnabled)}_addMesh(G){this._materialObservers[G.uniqueId]=G.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),n.f.SetImmediate((()=>{this._shouldRenderAsTransmission(G.material)?(G.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(G)&&this._transparentMeshesCache.push(G)):-1===this._opaqueMeshesCache.indexOf(G)&&this._opaqueMeshesCache.push(G)}))}_removeMesh(G){G.onMaterialChangedObservable.remove(this._materialObservers[G.uniqueId]),delete this._materialObservers[G.uniqueId];let D=this._transparentMeshesCache.indexOf(G);-1!==D&&this._transparentMeshesCache.splice(D,1),D=this._opaqueMeshesCache.indexOf(G),-1!==D&&this._opaqueMeshesCache.splice(D,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(G){const D=this._transparentMeshesCache.indexOf(G),N=this._opaqueMeshesCache.indexOf(G);this._shouldRenderAsTransmission(G.material)?(G.material instanceof S&&(G.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==N?(this._opaqueMeshesCache.splice(N,1),this._transparentMeshesCache.push(G)):-1===D&&this._transparentMeshesCache.push(G)):-1!==D?(this._transparentMeshesCache.splice(D,1),this._opaqueMeshesCache.push(G)):-1===N&&this._opaqueMeshesCache.push(G)}_isRenderTargetValid(){var G;return null!==(null===(G=this._opaqueRenderTarget)||void 0===G?void 0:G.getInternalTexture())}_setupRenderTargets(){var G;let D,N;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new lG.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(G=this._options.clearColor)||void 0===G?void 0:G.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((G=>{N=this._scene.environmentIntensity,this._scene.environmentIntensity=1,D=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?G.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(G.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=N,this._scene.imageProcessingConfiguration._applyByPostProcess=D})),this._transparentMeshesCache.forEach((G=>{this._shouldRenderAsTransmission(G.material)&&(G.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const aG="KHR_materials_transmission";class EG{constructor(G){this.name=aG,this.order=175,this._loader=G,this.enabled=this._loader.isExtensionUsed(aG),this.enabled&&(G.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(G,D,N)),Z.push(this._loadTransparentPropertiesAsync(T,D,N,o)),Promise.all(Z).then((()=>{}))}))}_loadTransparentPropertiesAsync(G,D,N,T){if(!(N instanceof S))throw new Error(`${G}: Material type not supported`);const o=N;if(o.subSurface.isRefractionEnabled=!0,o.subSurface.volumeIndexOfRefraction=1,o.subSurface.useAlbedoToTintRefraction=!0,void 0===T.transmissionFactor)return o.subSurface.refractionIntensity=0,o.subSurface.isRefractionEnabled=!1,Promise.resolve();{var Z;o.subSurface.refractionIntensity=T.transmissionFactor;const G=o.va();if(o.subSurface.refractionIntensity&&!G._transmissionHelper)new kG({},o.va());else if(o.subSurface.refractionIntensity&&(null===(Z=G._transmissionHelper)||void 0===Z||!Z._isRenderTargetValid())){var n;null===(n=G._transmissionHelper)||void 0===n||n._setupRenderTargets()}}return o.subSurface.minimumThickness=0,o.subSurface.maximumThickness=0,T.transmissionTexture?(T.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${G}/transmissionTexture`,T.transmissionTexture,void 0).then((G=>{G.name=`${N.name} (Transmission)`,o.subSurface.refractionIntensityTexture=G,o.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}k(aG),x(aG,!0,(G=>new EG(G)));const MG="KHR_materials_diffuse_transmission";class eG{constructor(G){this.name=MG,this.order=174,this._loader=G,this.enabled=this._loader.isExtensionUsed(MG),this.enabled&&(G.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(G,D,N)),Z.push(this._loadTranslucentPropertiesAsync(T,D,N,o)),Promise.all(Z).then((()=>{}))}))}_loadTranslucentPropertiesAsync(G,D,N,T){if(!(N instanceof S))throw new Error(`${G}: Material type not supported`);const o=N;if(o.subSurface.isTranslucencyEnabled=!0,o.subSurface.volumeIndexOfRefraction=1,o.subSurface.minimumThickness=0,o.subSurface.maximumThickness=0,o.subSurface.useAlbedoToTintTranslucency=!1,void 0===T.diffuseTransmissionFactor)return o.subSurface.translucencyIntensity=0,o.subSurface.isTranslucencyEnabled=!1,Promise.resolve();o.subSurface.translucencyIntensity=T.diffuseTransmissionFactor;const n=new Array;return o.subSurface.useGltfStyleTextures=!0,T.diffuseTransmissionTexture&&(T.diffuseTransmissionTexture.nonColorData=!0,n.push(this._loader.loadTextureInfoAsync(`${G}/diffuseTransmissionTexture`,T.diffuseTransmissionTexture).then((G=>{G.name=`${N.name} (Diffuse Transmission)`,o.subSurface.translucencyIntensityTexture=G})))),void 0!==T.diffuseTransmissionColorFactor?o.subSurface.translucencyColor=Z.d.od(T.diffuseTransmissionColorFactor):o.subSurface.translucencyColor=Z.d.White(),T.diffuseTransmissionColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${G}/diffuseTransmissionColorTexture`,T.diffuseTransmissionColorTexture).then((G=>{G.name=`${N.name} (Diffuse Transmission Color)`,o.subSurface.translucencyColorTexture=G}))),Promise.all(n).then((()=>{}))}}k(MG),x(MG,!0,(G=>new eG(G)));const fG="KHR_materials_volume";class GD{constructor(G){this.name=fG,this.order=173,this._loader=G,this.enabled=this._loader.isExtensionUsed(fG),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(G,D,N)),Z.push(this._loadVolumePropertiesAsync(T,D,N,o)),Promise.all(Z).then((()=>{}))}))}_loadVolumePropertiesAsync(G,D,N,T){if(!(N instanceof S))throw new Error(`${G}: Material type not supported`);if(!N.subSurface.isRefractionEnabled&&!N.subSurface.isTranslucencyEnabled||!T.thicknessFactor)return Promise.resolve();N.subSurface.volumeIndexOfRefraction=N.indexOfRefraction;const o=void 0!==T.attenuationDistance?T.attenuationDistance:Number.MAX_VALUE;return N.subSurface.tintColorAtDistance=o,void 0!==T.attenuationColor&&3==T.attenuationColor.length&&N.subSurface.tintColor.xd(T.attenuationColor[0],T.attenuationColor[1],T.attenuationColor[2]),N.subSurface.minimumThickness=0,N.subSurface.maximumThickness=T.thicknessFactor,N.subSurface.useThicknessAsDepth=!0,T.thicknessTexture?(T.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${G}/thicknessTexture`,T.thicknessTexture).then((G=>{G.name=`${N.name} (Thickness)`,N.subSurface.thicknessTexture=G,N.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}k(fG),x(fG,!0,(G=>new GD(G)));const DD="KHR_materials_dispersion";class ND{constructor(G){this.name=DD,this.order=174,this._loader=G,this.enabled=this._loader.isExtensionUsed(DD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>{const Z=new Array;return Z.push(this._loader.loadMaterialPropertiesAsync(G,D,N)),Z.push(this._loadDispersionPropertiesAsync(T,D,N,o)),Promise.all(Z).then((()=>{}))}))}_loadDispersionPropertiesAsync(G,D,N,T){if(!(N instanceof S))throw new Error(`${G}: Material type not supported`);return N.subSurface.isRefractionEnabled&&T.dispersion?(N.subSurface.isDispersionEnabled=!0,N.subSurface.dispersion=T.dispersion,Promise.resolve()):Promise.resolve()}}k(DD),x(DD,!0,(G=>new ND(G)));const TD="KHR_mesh_quantization";class oD{constructor(G){this.name=TD,this.enabled=G.isExtensionUsed(TD)}dispose(){}}k(TD),x(TD,!0,(G=>new oD(G)));const ZD="KHR_texture_basisu";class nD{constructor(G){this.name=ZD,this._loader=G,this.enabled=G.isExtensionUsed(ZD)}dispose(){this._loader=null}_loadTextureAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>{const Z=void 0==D.sampler?M.DefaultSampler:E.Get(`${G}/sampler`,this._loader.aj.samplers,D.sampler),n=E.Get(`${T}/source`,this._loader.aj.images,o.source);return this._loader._createTextureAsync(G,Z,n,(G=>{N(G)}),D._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!D._textureInfo.nonColorData)}))}}k(ZD),x(ZD,!0,(G=>new nD(G)));const CD="KHR_texture_transform";class PD{constructor(G){this.name=CD,this._loader=G,this.enabled=this._loader.isExtensionUsed(CD)}dispose(){this._loader=null}loadTextureInfoAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((T,o)=>this._loader.loadTextureInfoAsync(G,D,(G=>{if(!(G instanceof V.e))throw new Error(`${T}: Texture type not supported`);o.offset&&(G.uOffset=o.offset[0],G.vOffset=o.offset[1]),G.uRotationCenter=0,G.vRotationCenter=0,o.rotation&&(G.wAng=-o.rotation),o.scale&&(G.uScale=o.scale[0],G.vScale=o.scale[1]),void 0!=o.texCoord&&(G.coordinatesIndex=o.texCoord),N(G)}))))}}k(CD),x(CD,!0,(G=>new PD(G)));const rD="KHR_xmp_json_ld";class vD{constructor(G){this.name=rD,this.order=100,this._loader=G,this.enabled=this._loader.isExtensionUsed(rD)}dispose(){this._loader=null}onLoading(){var G,D,N;if(null===this._loader.rootBabylonMesh)return;const T=null===(G=this._loader.aj.extensions)||void 0===G?void 0:G.KHR_xmp_json_ld,o=null===(D=this._loader.aj.asset)||void 0===D||null===(N=D.extensions)||void 0===N?void 0:N.KHR_xmp_json_ld;if(T&&o){const G=+o.packet;T.packets&&G<T.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=T.packets[G])}}}function qD(G,D,N,T){return Z.d.od(D,N).scale(T)}function gD(G,D,N,T){return D[N]*T}function XD(G,D,N,T){return-D[N]*T}function WD(G,D,N,T){return D[N+1]*T}function jD(G,D,N,T){return D[N]*T*2}function YD(G){return{scale:[new hD(g.b.ANIMATIONTYPE_FLOAT,`${G}.uScale`,gD,(()=>2)),new hD(g.b.ANIMATIONTYPE_FLOAT,`${G}.vScale`,WD,(()=>2))],offset:[new hD(g.b.ANIMATIONTYPE_FLOAT,`${G}.uOffset`,gD,(()=>2)),new hD(g.b.ANIMATIONTYPE_FLOAT,`${G}.vOffset`,WD,(()=>2))],rotation:[new hD(g.b.ANIMATIONTYPE_FLOAT,`${G}.wAng`,XD,(()=>1))]}}k(rD),x(rD,!0,(G=>new vD(G)));class yD extends A{buildAnimations(G,D,N,T,o){o(G._babylonCamera,this._buildAnimation(D,N,T))}}class hD extends A{buildAnimations(G,D,N,T,o){for(const Z in G._data)o(G._data[Z].babylonMaterial,this._buildAnimation(D,N,T))}}class mD extends A{buildAnimations(G,D,N,T,o){o(G._babylonLight,this._buildAnimation(D,N,T))}}const RD={__array__:{__target__:!0,...d}},LD={__array__:{__target__:!0,orthographic:{xmag:[new yD(g.b.ANIMATIONTYPE_FLOAT,"orthoLeft",XD,(()=>1)),new yD(g.b.ANIMATIONTYPE_FLOAT,"orthoRight",WD,(()=>1))],ymag:[new yD(g.b.ANIMATIONTYPE_FLOAT,"orthoBottom",XD,(()=>1)),new yD(g.b.ANIMATIONTYPE_FLOAT,"orthoTop",WD,(()=>1))],zfar:[new yD(g.b.ANIMATIONTYPE_FLOAT,"maxZ",gD,(()=>1))],znear:[new yD(g.b.ANIMATIONTYPE_FLOAT,"fj",gD,(()=>1))]},perspective:{yfov:[new yD(g.b.ANIMATIONTYPE_FLOAT,"fov",gD,(()=>1))],zfar:[new yD(g.b.ANIMATIONTYPE_FLOAT,"maxZ",gD,(()=>1))],znear:[new yD(g.b.ANIMATIONTYPE_FLOAT,"fj",gD,(()=>1))]}}},wD={nodes:RD,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new hD(g.b.ANIMATIONTYPE_COLOR3,"albedoColor",qD,(()=>4)),new hD(g.b.ANIMATIONTYPE_FLOAT,"alpha",(function(G,D,N,T){return D[N+3]*T}),(()=>4))],metallicFactor:[new hD(g.b.ANIMATIONTYPE_FLOAT,"metallic",gD,(()=>1))],roughnessFactor:[new hD(g.b.ANIMATIONTYPE_FLOAT,"roughness",gD,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:YD("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:YD("metallicTexture")}}},emissiveFactor:[new hD(g.b.ANIMATIONTYPE_COLOR3,"emissiveColor",qD,(()=>3))],normalTexture:{scale:[new hD(g.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",gD,(()=>1))],extensions:{KHR_texture_transform:YD("bumpTexture")}},occlusionTexture:{strength:[new hD(g.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",gD,(()=>1))],extensions:{KHR_texture_transform:YD("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:YD("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new hD(g.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",gD,(()=>1))],anisotropyRotation:[new hD(g.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",gD,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:YD("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new hD(g.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",gD,(()=>1))],clearcoatRoughnessFactor:[new hD(g.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",gD,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:YD("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new hD(g.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",gD,(()=>1))],extensions:{KHR_texture_transform:YD("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:YD("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new hD(g.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",gD,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new hD(g.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",gD,(()=>1))]},KHR_materials_ior:{ior:[new hD(g.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",gD,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new hD(g.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",gD,(()=>1))],iridescenceIor:[new hD(g.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",gD,(()=>1))],iridescenceThicknessMinimum:[new hD(g.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",gD,(()=>1))],iridescenceThicknessMaximum:[new hD(g.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",gD,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:YD("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:YD("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new hD(g.b.ANIMATIONTYPE_COLOR3,"sheen.color",qD,(()=>3))],sheenRoughnessFactor:[new hD(g.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",gD,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:YD("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:YD("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new hD(g.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",gD,(()=>1))],specularColorFactor:[new hD(g.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",qD,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:YD("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:YD("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new hD(g.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",gD,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:YD("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new hD(g.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",qD,(()=>3))],attenuationDistance:[new hD(g.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",gD,(()=>1))],thicknessFactor:[new hD(g.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",gD,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:YD("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new hD(g.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",gD,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:YD("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new hD(g.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",qD,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:YD("subSurface.translucencyColorTexture")}}}}}},cameras:LD,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new mD(g.b.ANIMATIONTYPE_COLOR3,"diffuse",qD,(()=>3))],jj:[new mD(g.b.ANIMATIONTYPE_FLOAT,"intensity",gD,(()=>1))],range:[new mD(g.b.ANIMATIONTYPE_FLOAT,"range",gD,(()=>1))],spot:{innerConeAngle:[new mD(g.b.ANIMATIONTYPE_FLOAT,"innerAngle",jD,(()=>1))],outerConeAngle:[new mD(g.b.ANIMATIONTYPE_FLOAT,"angle",jD,(()=>1))]}}}}}};class BD{constructor(G,D){this._gltf=G,this._infoTree=D}convert(G){let D,N=this._gltf,T=this._infoTree;if(!G.startsWith("/"))throw new Error("Path must start with a /");const o=G.split("/");o.shift();for(const Z of o){if(T.__array__)T=T.__array__;else if(T=T[Z],!T)throw new Error(`Path ${G} is invalid`);if(void 0===N)throw new Error(`Path ${G} is invalid`);N=N[Z],T.__target__&&(D=N)}return{object:D,info:T}}}const FD="KHR_animation_pointer";class SD extends BD{constructor(G){super(G,wD)}}class VD{constructor(G){this.name=FD,this._loader=G,this._pathToObjectConverter=new SD(this._loader.aj)}get enabled(){return this._loader.isExtensionUsed(FD)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(G,D,N,T,o){var Z;const n=null===(Z=T.target.extensions)||void 0===Z?void 0:Z.KHR_animation_pointer;if(!n||!this._pathToObjectConverter)return null;"pointer"!==T.target.path&&j.d.Warn(`${G}/target/path: Value (${T.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=T.target.node&&j.d.Warn(`${G}/target/node: Value (${T.target.node}) must not be present when using the ${this.name} extension`);const C=`${G}/extensions/${this.name}`,P=n.pointer;if(!P)throw new Error(`${C}: Pointer is missing`);try{const Z=this._pathToObjectConverter.convert(P);return this._loader._loadAnimationChannelFromTargetInfoAsync(G,D,N,T,Z,o)}catch(r){return j.d.Warn(`${C}/pointer: Invalid pointer (${P}) skipped`),null}}}k(FD),x(FD,!0,(G=>new VD(G)));class UD{constructor(G,D,N){this.frame=G,this.action=D,this.onlyOnce=N,this.isDone=!1}_clone(){return new UD(this.frame,this.action,this.onlyOnce)}}var zD=N(1094),iD=N(1122);class JD{get loop(){return this._loop}set loop(G){G!==this._loop&&(this._loop=G,this.updateOptions({loop:G}))}get currentTime(){var G;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(G=iD.b.audioEngine)&&void 0!==G&&G.audioContext&&(this.isPlaying||this.isPaused)){const G=this.isPaused?0:iD.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+G}return 0}get spatialSound(){return this._spatialSound}set spatialSound(G){if(G==this._spatialSound)return;const D=this.isPlaying;this.pause(),G?(this._spatialSound=G,this._updateSpatialParameters()):this._disableSpatialSound(),D&&this.play()}constructor(G,D,N){var T;let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new v.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=o.s.Zero(),this._localDirection=new o.s(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=G,N=N||W.e.LastCreatedScene)if(this._scene=N,JD._SceneComponentInitialization(N),this._readyToPlayCallback=Z,this._customAttenuationFunction=(G,D,N,T,o)=>D<N?G*(1-D/N):0,C&&(this.autoplay=C.autoplay||!1,this._loop=C.loop||!1,void 0!==C.volume&&(this._volume=C.volume),this._spatialSound=C.spatialSound??!1,this.maxDistance=C.maxDistance??100,this.useCustomAttenuation=C.useCustomAttenuation??!1,this.rolloffFactor=C.rolloffFactor||1,this.refDistance=C.refDistance||1,this.distanceModel=C.distanceModel||"linear",this._playbackRate=C.playbackRate||1,this._streaming=C.streaming??!1,this._length=C.length,this._offset=C.offset),null!==(T=iD.b.audioEngine)&&void 0!==T&&T.canUseWebAudio&&iD.b.audioEngine.audioContext){this._soundGain=iD.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let G=!0;if(D)try{"string"===typeof D?(this._urlType="String",this._url=D):D instanceof ArrayBuffer?this._urlType="ArrayBuffer":D instanceof HTMLMediaElement?this._urlType="MediaElement":D instanceof MediaStream?this._urlType="MediaStream":D instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(D)&&(this._urlType="Array");let N=[],T=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=iD.b.audioEngine.audioContext.createMediaElementSource(D),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=iD.b.audioEngine.audioContext.createMediaStreamSource(D),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":D.byteLength>0&&(T=!0,this._soundLoaded(D));break;case"AudioBuffer":this._audioBufferLoaded(D);break;case"String":N.push(D);case"Array":0===N.length&&(N=D);for(let G=0;G<N.length;G++){const D=N[G];if(T=C&&C.skipCodecCheck||-1!==D.indexOf(".mp3",D.length-4)&&iD.b.audioEngine.isMP3supported||-1!==D.indexOf(".ogg",D.length-4)&&iD.b.audioEngine.isOGGsupported||-1!==D.indexOf(".wav",D.length-4)||-1!==D.indexOf(".m4a",D.length-4)||-1!==D.indexOf(".mp4",D.length-4)||-1!==D.indexOf("blob:"),T){this._streaming?(this._htmlAudioElement=new Audio(D),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,n.f.SetCorsBehavior(D,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(D,(G=>{this._soundLoaded(G)}),void 0,!0,!0,(G=>{G&&j.d.Error("XHR "+G.status+" error on: "+D+"."),j.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:G=!1}G?T||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):j.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(P){j.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),iD.b.audioEngine&&!iD.b.audioEngine.WarnedWebAudioUnsupported&&(j.d.Error("Web Audio is not supported by your browser."),iD.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var G;null!==(G=iD.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(G){var D;null!==(D=iD.b.audioEngine)&&void 0!==D&&D.audioContext&&(this._audioBuffer=G,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(G){var D;null!==(D=iD.b.audioEngine)&&void 0!==D&&D.audioContext&&iD.b.audioEngine.audioContext.decodeAudioData(G,(G=>{this._audioBufferLoaded(G)}),(G=>{j.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+G)}))}setAudioBuffer(G){var D;null!==(D=iD.b.audioEngine)&&void 0!==D&&D.canUseWebAudio&&(this._audioBuffer=G,this._isReadyToPlay=!0)}updateOptions(G){G&&(this.loop=G.loop??this.loop,this.maxDistance=G.maxDistance??this.maxDistance,this.useCustomAttenuation=G.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=G.rolloffFactor??this.rolloffFactor,this.refDistance=G.refDistance??this.refDistance,this.distanceModel=G.distanceModel??this.distanceModel,this._playbackRate=G.playbackRate??this._playbackRate,this._length=G.length??void 0,this.spatialSound=G.spatialSound??this._spatialSound,this._setOffset(G.offset??void 0),this.setVolume(G.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var G;null!==(G=iD.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&iD.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??iD.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var G;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(G=this._soundPanner)||void 0===G||G.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var G;null!==(G=iD.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(G){var D;null!==(D=iD.b.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(G),this._isOutputConnected=!0)}setDirectionalCone(G,D,N){D<G?j.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=G,this._coneOuterAngle=D,this._coneOuterGain=N,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(G){if(G!=this._coneInnerAngle){var D;if(this._coneOuterAngle<G)return void j.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=G,null!==(D=iD.b.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(G){if(G!=this._coneOuterAngle){var D;if(G<this._coneInnerAngle)return void j.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=G,null!==(D=iD.b.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(G){var D;G.equals(this._position)||(this._position.p(G),null!==(D=iD.b.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(G){var D;this._localDirection=G,null!==(D=iD.b.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const G=this._connectedTransformNode.getWorldMatrix(),D=o.s.TransformNormal(this._localDirection,G);D.normalize(),this._soundPanner.orientationX.value=D.x,this._soundPanner.orientationY.value=D.y,this._soundPanner.orientationZ.value=D.z}updateDistanceFromListener(){var G;if(null!==(G=iD.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const G=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Jc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,G,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(G){this._customAttenuationFunction=G}play(G,D,N){var T;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(T=iD.b.audioEngine)&&void 0!==T&&T.audioContext)try{var o,Z;this._clearTimeoutsAndObservers();let T=G?(null===(o=iD.b.audioEngine)||void 0===o?void 0:o.audioContext.currentTime)+G:null===(Z=iD.b.audioEngine)||void 0===Z?void 0:Z.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=iD.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const G=()=>{var N;if(null!==(N=iD.b.audioEngine)&&void 0!==N&&N.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=D??0;const N=this._htmlAudioElement.play();void 0!==N&&N.catch((()=>{var D,N;(null===(D=iD.b.audioEngine)||void 0===D||D.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(N=iD.b.audioEngine)||void 0===N?void 0:N.onAudioUnlockedObservable.addOnce((()=>{G()})))}))}else{var T;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(T=iD.b.audioEngine)||void 0===T?void 0:T.onAudioUnlockedObservable.addOnce((()=>{G()}))}};G()}}else{var n;const o=()=>{var o;if(null!==(o=iD.b.audioEngine)&&void 0!==o&&o.audioContext){var Z;if(N=N||this._length,void 0!==D&&this._setOffset(D),this._soundSource){const G=this._soundSource;G.onended=()=>{G.disconnect()}}if(this._soundSource=null===(Z=iD.b.audioEngine)||void 0===Z?void 0:Z.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var n;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==D&&(this._soundSource.loopStart=D),void 0!==N&&(this._soundSource.loopEnd=(0|D)+N),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},T=G?(null===(n=iD.b.audioEngine)||void 0===n?void 0:n.audioContext.currentTime)+G:iD.b.audioEngine.audioContext.currentTime;const o=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(T,o,this.loop?void 0:N)}}};"suspended"===(null===(n=iD.b.audioEngine)||void 0===n?void 0:n.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var G;"suspended"===(null===(G=iD.b.audioEngine)||void 0===G?void 0:G.audioContext.state)?(iD.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=iD.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{o()})))):o()}),500):o()}this._startTime=T,this.isPlaying=!0,this.isPaused=!1}catch(C){j.d.Error("Error while trying to play audio: "+this.name+", "+C.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(G){var D;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var N;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(N=this._streamingSource)||void 0===N||N.disconnect();this.isPlaying=!1}else if(null!==(D=iD.b.audioEngine)&&void 0!==D&&D.audioContext&&this._soundSource){const D=G?iD.b.audioEngine.audioContext.currentTime+G:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(D)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var G;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var D;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(D=this._streamingSource)||void 0===D||D.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(G=iD.b.audioEngine)&&void 0!==G&&G.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=iD.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(G,D){var N;null!==(N=iD.b.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._soundGain&&(D&&iD.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(iD.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,iD.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(G,iD.b.audioEngine.audioContext.currentTime+D)):this._soundGain.gain.value=G),this._volume=G}setPlaybackRate(G){this._playbackRate=G,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(G){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=G,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=G=>this._onRegisterAfterWorldMatrixUpdate(G),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(G){var D;if(G.getBoundingInfo){const D=G.getBoundingInfo();this.setPosition(D.boundingSphere.centerWorld)}else this.setPosition(G.absolutePosition);null!==(D=iD.b.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const G=()=>{this._isReadyToPlay?(N._audioBuffer=this.getAudioBuffer(),N._isReadyToPlay=!0,N.autoplay&&N.play(0,this._offset,this._length)):setTimeout(G,300)},D={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},N=new JD(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,D);return this.useCustomAttenuation&&N.setAttenuationFunction(this._customAttenuationFunction),N.setPosition(this._position),N.setPlaybackRate(this._playbackRate),G(),N}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const G={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(G.connectedMeshId=this._connectedTransformNode.id),G.position=this._position.vd(),G.refDistance=this.refDistance,G.distanceModel=this.distanceModel,G.isDirectional=this._isDirectional,G.localDirectionToMesh=this._localDirection.vd(),G.coneInnerAngle=this._coneInnerAngle,G.coneOuterAngle=this._coneOuterAngle,G.coneOuterGain=this._coneOuterGain),G}static Parse(G,D,N,T){const Z=G.name;let n;n=G.url?N+G.url:N+Z;const C={autoplay:G.autoplay,loop:G.loop,volume:G.volume,spatialSound:G.spatialSound,maxDistance:G.maxDistance,rolloffFactor:G.rolloffFactor,refDistance:G.refDistance,distanceModel:G.distanceModel,playbackRate:G.playbackRate};let P;if(T){const G=()=>{T._isReadyToPlay?(P._audioBuffer=T.getAudioBuffer(),P._isReadyToPlay=!0,P.autoplay&&P.play(0,P._offset,P._length)):setTimeout(G,300)};P=new JD(Z,new ArrayBuffer(0),D,null,C),G()}else P=new JD(Z,n,D,(()=>{D.removePendingData(P)}),C),D.addPendingData(P);if(G.position){const D=o.s.od(G.position);P.setPosition(D)}if(G.isDirectional&&(P.setDirectionalCone(G.coneInnerAngle||360,G.coneOuterAngle||360,G.coneOuterGain||0),G.localDirectionToMesh)){const D=o.s.od(G.localDirectionToMesh);P.setLocalDirectionToMesh(D)}if(G.connectedMeshId){const N=D.getMeshById(G.connectedMeshId);N&&P.attachToMesh(N)}return G.metadata&&(P.metadata=G.metadata),P}_setOffset(G){this._offset!==G&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=G)}_clearTimeoutsAndObservers(){var G;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(G=iD.b.audioEngine)||void 0===G||G.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}JD._SceneComponentInitialization=G=>{throw(0,zD.d)("AudioSceneComponent")},(0,B.h)("BABYLON.Sound",JD);class pD{constructor(G,D,N){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],D.length!==N.length)throw new Error("Sounds length does not equal weights length");this.loop=G,this._weights=N;let T=0;for(const Z of N)T+=Z;const o=T>0?1/T:0;for(let Z=0;Z<this._weights.length;Z++)this._weights[Z]*=o;this._sounds=D;for(const Z of this._sounds)Z.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(G){if(G!==this._coneInnerAngle){if(this._coneOuterAngle<G)return void j.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=G;for(const D of this._sounds)D.directionalConeInnerAngle=G}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(G){if(G!==this._coneOuterAngle){if(G<this._coneInnerAngle)return void j.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=G;for(const D of this._sounds)D.directionalConeOuterAngle=G}}get volume(){return this._volume}set volume(G){if(G!==this._volume)for(const D of this._sounds)D.setVolume(G)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(G){if(!this.isPaused){this.stop();const G=Math.random();let D=0;for(let N=0;N<this._weights.length;N++)if(D+=this._weights[N],G<=D){this._currentIndex=N;break}}const D=this._sounds[this._currentIndex??0];D.isReady()?D.play(0,this.isPaused?void 0:G):D.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class tD{constructor(G){let D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(G=G||W.e.LastCreatedScene)&&(this._scene=G,this.soundCollection=[],this._options=D,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var G;null!==(G=iD.b.audioEngine)&&void 0!==G&&G.canUseWebAudio&&iD.b.audioEngine.audioContext&&(this._outputAudioNode=iD.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(iD.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(iD.b.audioEngine&&iD.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(G){var D;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(D=iD.b.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._outputAudioNode&&G.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==G.soundTrackId&&(-1===G.soundTrackId?this._scene.mainSoundTrack.removeSound(G):this._scene.soundTracks&&this._scene.soundTracks[G.soundTrackId].removeSound(G)),this.soundCollection.push(G),G.soundTrackId=this.id}removeSound(G){const D=this.soundCollection.indexOf(G);-1!==D&&this.soundCollection.splice(D,1)}setVolume(G){var D;null!==(D=iD.b.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=G)}switchPanningModelToHRTF(){var G;if(null!==(G=iD.b.audioEngine)&&void 0!==G&&G.canUseWebAudio)for(let D=0;D<this.soundCollection.length;D++)this.soundCollection[D].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var G;if(null!==(G=iD.b.audioEngine)&&void 0!==G&&G.canUseWebAudio)for(let D=0;D<this.soundCollection.length;D++)this.soundCollection[D].switchPanningModelToEqualPower()}connectToAnalyser(G){var D;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=G,null!==(D=iD.b.audioEngine)&&void 0!==D&&D.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,iD.b.audioEngine.masterGain))}}var HD=N(1276),sD=N(1218),cD=(N(1548),N(1153));(0,N(11539).g)(HD.c.NAME_AUDIO,((G,D,N,T)=>{let o,Z=[];if(N.je=N.je||[],void 0!==G.je&&null!==G.je)for(let C=0,P=G.je.length;C<P;C++){var n;const P=G.je[C];null!==(n=iD.b.audioEngine)&&void 0!==n&&n.canUseWebAudio?(P.url||(P.url=P.name),Z[P.url]?N.je.push(JD.Parse(P,D,T,Z[P.url])):(o=JD.Parse(P,D,T),Z[P.url]=o,N.je.push(o))):N.je.push(new JD(P.name,null,D))}Z=[]})),Object.defineProperty(sD.e.prototype,"mainSoundTrack",{get:function(){let G=this._getComponent(HD.c.NAME_AUDIO);return G||(G=new KD(this),this.ee(G)),this._mainSoundTrack||(this._mainSoundTrack=new tD(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),sD.e.prototype.getSoundByName=function(G){let D;for(D=0;D<this.mainSoundTrack.soundCollection.length;D++)if(this.mainSoundTrack.soundCollection[D].name===G)return this.mainSoundTrack.soundCollection[D];if(this.soundTracks)for(let N=0;N<this.soundTracks.length;N++)for(D=0;D<this.soundTracks[N].soundCollection.length;D++)if(this.soundTracks[N].soundCollection[D].name===G)return this.soundTracks[N].soundCollection[D];return null},Object.defineProperty(sD.e.prototype,"audioEnabled",{get:function(){let G=this._getComponent(HD.c.NAME_AUDIO);return G||(G=new KD(this),this.ee(G)),G.audioEnabled},set:function(G){let D=this._getComponent(HD.c.NAME_AUDIO);D||(D=new KD(this),this.ee(D)),G?D.enableAudio():D.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(sD.e.prototype,"headphone",{get:function(){let G=this._getComponent(HD.c.NAME_AUDIO);return G||(G=new KD(this),this.ee(G)),G.headphone},set:function(G){let D=this._getComponent(HD.c.NAME_AUDIO);D||(D=new KD(this),this.ee(D)),G?D.switchAudioModeForHeadphones():D.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(sD.e.prototype,"audioListenerPositionProvider",{get:function(){let G=this._getComponent(HD.c.NAME_AUDIO);return G||(G=new KD(this),this.ee(G)),G.audioListenerPositionProvider},set:function(G){let D=this._getComponent(HD.c.NAME_AUDIO);if(D||(D=new KD(this),this.ee(D)),G&&"function"!==typeof G)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");D.audioListenerPositionProvider=G},enumerable:!0,configurable:!0}),Object.defineProperty(sD.e.prototype,"audioListenerRotationProvider",{get:function(){let G=this._getComponent(HD.c.NAME_AUDIO);return G||(G=new KD(this),this.ee(G)),G.audioListenerRotationProvider},set:function(G){let D=this._getComponent(HD.c.NAME_AUDIO);if(D||(D=new KD(this),this.ee(D)),G&&"function"!==typeof G)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");D.audioListenerRotationProvider=G},enumerable:!0,configurable:!0}),Object.defineProperty(sD.e.prototype,"audioPositioningRefreshRate",{get:function(){let G=this._getComponent(HD.c.NAME_AUDIO);return G||(G=new KD(this),this.ee(G)),G.audioPositioningRefreshRate},set:function(G){let D=this._getComponent(HD.c.NAME_AUDIO);D||(D=new KD(this),this.ee(D)),D.audioPositioningRefreshRate=G},enumerable:!0,configurable:!0});class KD{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(G){this.name=HD.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new o.s,this._cachedCameraPosition=new o.s,this._lastCheck=0,this._invertMatrixTemp=new o.c,this._cameraDirectionTemp=new o.s,(G=G||W.e.LastCreatedScene)&&(this.oe=G,G.soundTracks=[],G.je=[])}register(){this.oe._afterRenderStage.registerStep(HD.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(G){if(G.je=[],this.oe.soundTracks)for(let D=0;D<this.oe.soundTracks.length;D++){const N=this.oe.soundTracks[D];for(let D=0;D<N.soundCollection.length;D++)G.je.push(N.soundCollection[D].serialize())}}addFromContainer(G){G.je&&G.je.forEach((G=>{G.play(),G.autoplay=!0,this.oe.mainSoundTrack.addSound(G)}))}removeFromContainer(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];G.je&&G.je.forEach((G=>{G.stop(),G.autoplay=!1,this.oe.mainSoundTrack.removeSound(G),D&&G.dispose()}))}dispose(){const G=this.oe;if(G._mainSoundTrack&&G.mainSoundTrack.dispose(),G.soundTracks)for(let D=0;D<G.soundTracks.length;D++)G.soundTracks[D].dispose()}disableAudio(){const G=this.oe;let D;for(this._audioEnabled=!1,iD.b.audioEngine&&iD.b.audioEngine.audioContext&&iD.b.audioEngine.audioContext.suspend(),D=0;D<G.mainSoundTrack.soundCollection.length;D++)G.mainSoundTrack.soundCollection[D].pause();if(G.soundTracks)for(D=0;D<G.soundTracks.length;D++)for(let N=0;N<G.soundTracks[D].soundCollection.length;N++)G.soundTracks[D].soundCollection[N].pause()}enableAudio(){const G=this.oe;let D;for(this._audioEnabled=!0,iD.b.audioEngine&&iD.b.audioEngine.audioContext&&iD.b.audioEngine.audioContext.resume(),D=0;D<G.mainSoundTrack.soundCollection.length;D++)G.mainSoundTrack.soundCollection[D].isPaused&&G.mainSoundTrack.soundCollection[D].play();if(G.soundTracks)for(D=0;D<G.soundTracks.length;D++)for(let N=0;N<G.soundTracks[D].soundCollection.length;N++)G.soundTracks[D].soundCollection[N].isPaused&&G.soundTracks[D].soundCollection[N].play()}switchAudioModeForHeadphones(){const G=this.oe;if(this._headphone=!0,G.mainSoundTrack.switchPanningModelToHRTF(),G.soundTracks)for(let D=0;D<G.soundTracks.length;D++)G.soundTracks[D].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const G=this.oe;if(this._headphone=!1,G.mainSoundTrack.switchPanningModelToEqualPower(),G.soundTracks)for(let D=0;D<G.soundTracks.length;D++)G.soundTracks[D].switchPanningModelToEqualPower()}_afterRender(){const G=cD.e.Now;if(this._lastCheck&&G-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=G;const D=this.oe;if(!this._audioEnabled||!D._mainSoundTrack||!D.soundTracks||0===D._mainSoundTrack.soundCollection.length&&1===D.soundTracks.length)return;const N=iD.b.audioEngine;if(N&&N.audioContext){let G,T=D.activeCamera;if(D.activeCameras&&D.activeCameras.length>0&&(T=D.activeCameras[0]),this.audioListenerPositionProvider){const G=this.audioListenerPositionProvider();N.audioContext.listener.setPosition(G.x||0,G.y||0,G.z||0)}else T?this._cachedCameraPosition.equals(T.globalPosition)||(this._cachedCameraPosition.p(T.globalPosition),N.audioContext.listener.setPosition(T.globalPosition.x,T.globalPosition.y,T.globalPosition.z)):N.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const G=this.audioListenerRotationProvider();N.audioContext.listener.setOrientation(G.x||0,G.y||0,G.z||0,0,1,0)}else T?(T.rigCameras&&T.rigCameras.length>0&&(T=T.rigCameras[0]),T.getViewMatrix().invertToRef(this._invertMatrixTemp),o.s.TransformNormalToRef(KD._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),N.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):N.audioContext.listener.setOrientation(0,0,0,0,1,0);for(G=0;G<D.mainSoundTrack.soundCollection.length;G++){const N=D.mainSoundTrack.soundCollection[G];N.useCustomAttenuation&&N.updateDistanceFromListener()}if(D.soundTracks)for(G=0;G<D.soundTracks.length;G++)for(let N=0;N<D.soundTracks[G].soundCollection.length;N++){const T=D.soundTracks[G].soundCollection[N];T.useCustomAttenuation&&T.updateDistanceFromListener()}}}}KD._CameraDirection=new o.s(0,0,-1),JD._SceneComponentInitialization=G=>{let D=G._getComponent(HD.c.NAME_AUDIO);D||(D=new KD(G),G.ee(D))};const bD="MSFT_audio_emitter";class OD{constructor(G){this.name=bD,this._loader=G,this.enabled=this._loader.isExtensionUsed(bD)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const G=this._loader.aj.extensions;if(G&&G[this.name]){const D=G[this.name];this._clips=D.clips,this._emitters=D.emitters,E.Assign(this._clips),E.Assign(this._emitters)}}loadSceneAsync(G,D){return M.LoadExtensionAsync(G,D,this.name,((N,T)=>{const o=new Array;o.push(this._loader.loadSceneAsync(G,D));for(const G of T.emitters){const D=E.Get(`${N}/emitters`,this._emitters,G);if(void 0!=D.refDistance||void 0!=D.maxDistance||void 0!=D.rolloffFactor||void 0!=D.distanceModel||void 0!=D.innerAngle||void 0!=D.outerAngle)throw new Error(`${N}: Direction or Distance properties are not allowed on emitters attached to a scene`);o.push(this._loadEmitterAsync(`${N}/emitters/${D.index}`,D))}return Promise.all(o).then((()=>{}))}))}loadNodeAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((G,T)=>{const Z=new Array;return this._loader.loadNodeAsync(G,D,(D=>{for(const N of T.emitters){const T=E.Get(`${G}/emitters`,this._emitters,N);Z.push(this._loadEmitterAsync(`${G}/emitters/${T.index}`,T).then((()=>{for(const G of T._babylonSounds)G.attachToMesh(D),void 0==T.innerAngle&&void 0==T.outerAngle||(G.setLocalDirectionToMesh(o.s.Forward()),G.setDirectionalCone(2*n.f.ToDegrees(void 0==T.innerAngle?Math.PI:T.innerAngle),2*n.f.ToDegrees(void 0==T.outerAngle?Math.PI:T.outerAngle),0))})))}N(D)})).then((G=>Promise.all(Z).then((()=>G))))}))}loadAnimationAsync(G,D){return M.LoadExtensionAsync(G,D,this.name,((N,T)=>this._loader.loadAnimationAsync(G,D).then((o=>{const Z=new Array;E.Assign(T.events);for(const n of T.events)Z.push(this._loadAnimationEventAsync(`${N}/events/${n.index}`,G,D,n,o));return Promise.all(Z).then((()=>o))}))))}_loadClipAsync(G,D){if(D._objectURL)return D._objectURL;let N;if(D.uri)N=this._loader.loadUriAsync(G,D,D.uri);else{const T=E.Get(`${G}/bufferView`,this._loader.aj.bufferViews,D.bufferView);N=this._loader.loadBufferViewAsync(`/bufferViews/${T.index}`,T)}return D._objectURL=N.then((G=>URL.createObjectURL(new Blob([G],{type:D.mimeType})))),D._objectURL}_loadEmitterAsync(G,D){if(D._babylonSounds=D._babylonSounds||[],!D._babylonData){const G=new Array,N=D.name||`emitter${D.index}`,T={loop:!1,autoplay:!1,volume:void 0==D.volume?1:D.volume};for(let Z=0;Z<D.clips.length;Z++){const o=`/extensions/${this.name}/clips`,n=E.Get(o,this._clips,D.clips[Z].clip);G.push(this._loadClipAsync(`${o}/${D.clips[Z].clip}`,n).then((G=>{const o=D._babylonSounds[Z]=new JD(N,G,this._loader.babylonScene,null,T);o.refDistance=D.refDistance||1,o.maxDistance=D.maxDistance||256,o.rolloffFactor=D.rolloffFactor||1,o.distanceModel=D.distanceModel||"exponential"})))}const o=Promise.all(G).then((()=>{const G=D.clips.map((G=>G.weight||1)),N=new pD(D.loop||!1,D._babylonSounds,G);D.innerAngle&&(N.directionalConeInnerAngle=2*n.f.ToDegrees(D.innerAngle)),D.outerAngle&&(N.directionalConeOuterAngle=2*n.f.ToDegrees(D.outerAngle)),D.volume&&(N.volume=D.volume),D._babylonData.sound=N}));D._babylonData={loaded:o}}return D._babylonData.loaded}_getEventAction(G,D,N,T,o){switch(N){case"play":return G=>{const N=(o||0)+(G-T);D.play(N)};case"stop":return()=>{D.stop()};case"pause":return()=>{D.pause()};default:throw new Error(`${G}: Unsupported action ${N}`)}}_loadAnimationEventAsync(G,D,N,T,o){if(0==o.targetedAnimations.length)return Promise.resolve();const Z=o.targetedAnimations[0],n=T.k,C=E.Get(`/extensions/${this.name}/emitters`,this._emitters,n);return this._loadEmitterAsync(G,C).then((()=>{const D=C._babylonData.sound;if(D){const N=new UD(T.time,this._getEventAction(G,D,T.action,T.time,T.startOffset));Z.animation.addEvent(N),o.onAnimationGroupEndObservable.add((()=>{D.stop()})),o.onAnimationGroupPauseObservable.add((()=>{D.pause()}))}}))}}k(bD),x(bD,!0,(G=>new OD(G)));const QD="MSFT_lod";class AD{constructor(G){var D;this.name=QD,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new v.b,this.onMaterialLODsLoadedObservable=new v.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=G,this.maxLODsToLoad=(null===(D=this._loader.parent.extensionOptions[QD])||void 0===D?void 0:D.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(QD)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let G=0;G<this._nodePromiseLODs.length;G++){const D=Promise.all(this._nodePromiseLODs[G]).then((()=>{0!==G&&(this._loader.endPerformanceCounter(`Node LOD ${G}`),this._loader.log(`Loaded node LOD ${G}`)),this.onNodeLODsLoadedObservable.notifyObservers(G),G!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${G+1}`),this._loadBufferLOD(this._nodeBufferLODs,G+1),this._nodeSignalLODs[G]&&this._nodeSignalLODs[G].resolve())}));this._loader._completePromises.push(D)}for(let G=0;G<this._materialPromiseLODs.length;G++){const D=Promise.all(this._materialPromiseLODs[G]).then((()=>{0!==G&&(this._loader.endPerformanceCounter(`Material LOD ${G}`),this._loader.log(`Loaded material LOD ${G}`)),this.onMaterialLODsLoadedObservable.notifyObservers(G),G!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${G+1}`),this._loadBufferLOD(this._materialBufferLODs,G+1),this._materialSignalLODs[G]&&this._materialSignalLODs[G].resolve())}));this._loader._completePromises.push(D)}}loadSceneAsync(G,D){const N=this._loader.loadSceneAsync(G,D);return this._loadBufferLOD(this._bufferLODs,0),N}loadNodeAsync(G,D,N){return M.LoadExtensionAsync(G,D,this.name,((G,o)=>{let Z;const n=this._getLODs(G,D,this._loader.aj.nodes,o.ids);this._loader.logOpen(`${G}`);for(let D=0;D<n.length;D++){const G=n[D];0!==D&&(this._nodeIndexLOD=D,this._nodeSignalLODs[D]=this._nodeSignalLODs[D]||new T);const o=G=>{N(G),G.Lg(!1)},C=this._loader.loadNodeAsync(`/nodes/${G.index}`,G,o).then((G=>{if(0!==D){const G=n[D-1];G._babylonTransformNode&&(this._disposeTransformNode(G._babylonTransformNode),delete G._babylonTransformNode)}return G.Lg(!0),G}));this._nodePromiseLODs[D]=this._nodePromiseLODs[D]||[],0===D?Z=C:(this._nodeIndexLOD=null,this._nodePromiseLODs[D].push(C))}return this._loader.logClose(),Z}))}_loadMaterialAsync(G,D,N,T,o){return this._nodeIndexLOD?null:M.LoadExtensionAsync(G,D,this.name,((G,Z)=>{let n;const C=this._getLODs(G,D,this._loader.aj.materials,Z.ids);this._loader.logOpen(`${G}`);for(let D=0;D<C.length;D++){const G=C[D];0!==D&&(this._materialIndexLOD=D);const Z=this._loader._loadMaterialAsync(`/materials/${G.index}`,G,N,T,(G=>{0===D&&o(G)})).then((G=>{if(0!==D){o(G);const N=C[D-1]._data;N[T]&&(this._disposeMaterials([N[T].babylonMaterial]),delete N[T])}return G}));this._materialPromiseLODs[D]=this._materialPromiseLODs[D]||[],0===D?n=Z:(this._materialIndexLOD=null,this._materialPromiseLODs[D].push(Z))}return this._loader.logClose(),n}))}_loadUriAsync(G,D,N){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const o=this._nodeIndexLOD-1;return this._nodeSignalLODs[o]=this._nodeSignalLODs[o]||new T,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(G,D,N)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const o=this._materialIndexLOD-1;return this._materialSignalLODs[o]=this._materialSignalLODs[o]||new T,this._materialSignalLODs[o].promise.then((()=>this._loader.loadUriAsync(G,D,N)))}return null}loadBufferAsync(G,D,N,o){if(this._loader.parent.useRangeRequests&&!D.uri){if(!this._loader.bin)throw new Error(`${G}: Uri is missing or the binary glTF is missing its binary chunk`);const D=(G,D)=>{const Z=N,n=Z+o-1;let C=G[D];return C?(C.start=Math.min(C.start,Z),C.end=Math.max(C.end,n)):(C={start:Z,end:n,loaded:new T},G[D]=C),C.loaded.promise.then((G=>new Uint8Array(G.buffer,G.byteOffset+N-C.start,o)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?D(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?D(this._materialBufferLODs,this._materialIndexLOD):D(this._bufferLODs,0)}return null}_loadBufferLOD(G,D){const N=G[D];N&&(this._loader.log(`Loading buffer range [${N.start}-${N.end}]`),this._loader.bin.readAsync(N.start,N.end-N.start+1).then((G=>{N.loaded.resolve(G)}),(G=>{N.loaded.reject(G)})))}_getLODs(G,D,N,T){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const o=[];for(let Z=T.length-1;Z>=0;Z--)if(o.push(E.Get(`${G}/ids/${T[Z]}`,N,T[Z])),o.length===this.maxLODsToLoad)return o;return o.push(D),o}_disposeTransformNode(G){const D=[],N=G.material;N&&D.push(N);for(const o of G.getChildMeshes())o.material&&D.push(o.material);G.dispose();const T=D.filter((G=>this._loader.babylonScene.meshes.every((D=>D.material!=G))));this._disposeMaterials(T)}_disposeMaterials(G){const D={};for(const N of G){for(const G of N.getActiveTextures())D[G.uniqueId]=G;N.dispose()}for(const N in D)for(const G of this._loader.babylonScene.materials)G.hasTexture(D[N])&&delete D[N];for(const N in D)D[N].dispose()}}k(QD),x(QD,!0,(G=>new AD(G)));const ID="MSFT_minecraftMesh";class dD{constructor(G){this.name=ID,this._loader=G,this.enabled=this._loader.isExtensionUsed(ID)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,D,N){return M.LoadExtraAsync(G,D,this.name,((T,o)=>{if(o){if(!(N instanceof S))throw new Error(`${T}: Material type not supported`);const o=this._loader.loadMaterialPropertiesAsync(G,D,N);return N.needAlphaBlending()&&(N.forceDepthWrite=!0,N.separateCullingPass=!0),N.Ge=N.forceDepthWrite,N.twoSidedLighting=!0,o}return null}))}}k(ID),x(ID,!0,(G=>new dD(G)));const uD="MSFT_sRGBFactors";class lD{constructor(G){this.name=uD,this._loader=G,this.enabled=this._loader.isExtensionUsed(uD)}dispose(){this._loader=null}loadMaterialPropertiesAsync(G,D,N){return M.LoadExtraAsync(G,D,this.name,((T,o)=>{if(o){if(!(N instanceof S))throw new Error(`${T}: Material type not supported`);const o=this._loader.loadMaterialPropertiesAsync(G,D,N),Z=N.va().getEngine().useExactSrgbConversions;return N.albedoTexture||N.albedoColor.toLinearSpaceToRef(N.albedoColor,Z),N.reflectivityTexture||N.reflectivityColor.toLinearSpaceToRef(N.reflectivityColor,Z),o}return null}))}}k(uD),x(uD,!0,(G=>new lD(G)));var xD,kD=N(1051);!function(G){G[G.Input=0]="Input",G[G.Output=1]="Output"}(xD||(xD={}));class aD{constructor(G,D,N){this._ownerBlock=N,this._connectedPoint=[],this.uniqueId=(0,kD.c)(),this.connectedPointIds=[],this.name=G,this._connectionType=D}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(G){if(this._connectionType===G._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||G._isSingularConnection()&&G._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(G),G._connectedPoint.push(this)}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};G.uniqueId=this.uniqueId,G.name=this.name,G._connectionType=this._connectionType,G.connectedPointIds=[],G.className=this.getClassName();for(const D of this._connectedPoint)G.connectedPointIds.push(D.uniqueId)}getClassName(){return"FGConnection"}deserialize(G){this.uniqueId=G.uniqueId,this.name=G.name,this._connectionType=G._connectionType,this.connectedPointIds=G.connectedPointIds}static Parse(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},D=arguments.length>1?arguments[1]:void 0;const N=new(n.f.Instantiate(G.className))(G.name,G._connectionType,D);return N.deserialize(G),N}}class ED{constructor(G){this.value=this._toInt(G)}_toInt(G){return 0|G}add(G){return new ED(this.value+G.value)}Jc(G){return new ED(this.value-G.value)}multiply(G){return new ED(Math.imul(this.value,G.value))}divide(G){return new ED(this.value/G.value)}getClassName(){return ED.ClassName}equals(G){return this.value===G.value}static Parse(G){return new ED(G.value)}}ED.ClassName="FlowGraphInteger",(0,B.h)("FlowGraphInteger",ED);class MD{constructor(G,D){this.typeName=G,this.defaultValue=D}serialize(G){G.typeName=this.typeName,G.defaultValue=this.defaultValue}static Parse(G){return new MD(G.typeName,G.defaultValue)}}const eD=new MD("any",void 0),fD=(new MD("string",""),new MD("number",0)),GN=new MD("boolean",!1),DN=new MD("Vector2",o.o.Zero()),NN=new MD("Ad",o.s.Zero()),TN=(new MD("Vector4",o.v.Zero()),new MD("Matrix",o.c.Identity())),oN=(new MD("Md",Z.d.Black()),new MD("Pd",new Z.g(0,0,0,0)),new MD("Quaternion",o.g.Identity()),new MD("FlowGraphInteger",new ED(0)));class ZN extends aD{constructor(G,D,N,T){super(G,D,N),this.richType=T}_isSingularConnection(){return 0===this.connectionType}setValue(G,D){D._setConnectionValue(this,G)}connectTo(G){super.connectTo(G)}_getValueOrDefault(G){return G._hasConnectionValue(this)?G._getConnectionValue(this):this.richType.defaultValue}getValue(G){return 1===this.connectionType?(G._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(G),this._getValueOrDefault(G)):this.isConnected()?this._connectedPoint[0].getValue(G):this._getValueOrDefault(G)}getClassName(){return"FGDataConnection"}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(G),G.richType={},this.richType.serialize(G.richType)}static Parse(G,D){const N=aD.Parse(G,D);return N.richType=MD.Parse(G.richType),N}}function nN(G){return"Mesh"===G||"AbstractMesh"===G||"GroundMesh"===G||"InstanceMesh"===G||"LinesMesh"===G||"GoldbergMesh"===G||"GreasedLineMesh"===G||"TrailMesh"===G}function CN(G){return"Vector2"===G||"Ad"===G||"Vector4"===G||"Quaternion"===G||"Md"===G||"Pd"===G}function PN(G,D,N){var T;const o=(null===D||void 0===D||null===(T=D.getClassName)||void 0===T?void 0:T.call(D))??"";nN(o)?N[G]={name:D.name,className:o}:CN(o)?N[G]={value:D.vd(),className:o}:N[G]=D}function rN(G,D,N){const T=D[G];let n;const C=null===T||void 0===T?void 0:T.className;return n=nN(C)?N.getMeshByName(T.name):CN(C)?function(G,D){if("Vector2"===G)return o.o.od(D);if("Ad"===G)return o.s.od(D);if("Vector4"===G)return o.v.od(D);if("Quaternion"===G)return o.g.od(D);if("Md"===G)return new Z.d(D[0],D[1],D[2]);if("Pd"===G)return new Z.g(D[0],D[1],D[2],D[3]);throw new Error(`Unknown vector class name ${G}`)}(C,T.value):"Matrix"===C?o.c.od(T.value):C===ED.ClassName?ED.Parse(T):T&&void 0!==T.value?T.value:T,n}(0,B.h)("FGDataConnection",ZN);class vN{constructor(G){var D;this.config=G,this.uniqueId=(0,kD.c)(),this.name=(null===(D=this.config)||void 0===D?void 0:D.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(G){}registerDataInput(G,D){const N=new ZN(G,0,this,D);return this.dataInputs.push(N),N}registerDataOutput(G,D){const N=new ZN(G,1,this,D);return this.dataOutputs.push(N),N}getDataInput(G){return this.dataInputs.find((D=>D.name===G))}getDataOutput(G){return this.dataOutputs.find((D=>D.name===G))}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};G.uniqueId=this.uniqueId,G.config={},this.config&&(G.config.name=this.config.name),G.dataInputs=[],G.dataOutputs=[],G.className=this.getClassName();for(const D of this.dataInputs){const N={};D.serialize(N),G.dataInputs.push(N)}for(const D of this.dataOutputs){const N={};D.serialize(N),G.dataOutputs.push(N)}}getClassName(){return"FGBlock"}static Parse(G,D){const N=n.f.Instantiate(G.className),T={},o=D.valueParseFunction??rN;if(G.config)for(const n in G.config)T[n]=o(n,G.config,D.oe);var Z;("FGSetPropertyBlock"===(Z=G.className)||"FGGetPropertyBlock"===Z||"FGPlayAnimationBlock"===Z||"FGMeshPickEventBlock"===Z)&&(T.pathConverter=D.pathConverter);const C=new N(T);C.uniqueId=G.uniqueId;for(let n=0;n<G.dataInputs.length;n++){const D=C.getDataInput(G.dataInputs[n].name);if(!D)throw new Error("Could not find data input with name "+G.dataInputs[n].name+" in block "+G.className);D.deserialize(G.dataInputs[n])}for(let n=0;n<G.dataOutputs.length;n++){const D=C.getDataOutput(G.dataOutputs[n].name);if(!D)throw new Error("Could not find data output with name "+G.dataOutputs[n].name+" in block "+G.className);D.deserialize(G.dataOutputs[n])}return C.metadata=G.metadata,C.deserialize&&C.deserialize(G),C}}class qN extends aD{_isSingularConnection(){return 1===this.connectionType}_activateSignal(G){var D;0===this.connectionType?(G._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(G,this),G._increaseExecutionId()):null===(D=this._connectedPoint[0])||void 0===D||D._activateSignal(G)}}(0,B.h)("FlowGraphSignalConnection",qN);class gN extends vN{constructor(G){super(G),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(G){const D=new qN(G,0,this);return this.signalInputs.push(D),D}_registerSignalOutput(G){const D=new qN(G,1,this);return this.signalOutputs.push(D),D}getSignalInput(G){return this.signalInputs.find((D=>D.name===G))}getSignalOutput(G){return this.signalOutputs.find((D=>D.name===G))}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(G),G.signalInputs=[],G.signalOutputs=[];for(const D of this.signalInputs){const N={};D.serialize(N),G.signalInputs.push(N)}for(const D of this.signalOutputs){const N={};D.serialize(N),G.signalOutputs.push(N)}}deserialize(G){for(let D=0;D<G.signalInputs.length;D++){const N=this.getSignalInput(G.signalInputs[D].name);if(!N)throw new Error("Could not find signal input with name "+G.signalInputs[D].name+" in block "+G.className);N.deserialize(G.signalInputs[D])}for(let D=0;D<G.signalOutputs.length;D++){const N=this.getSignalOutput(G.signalOutputs[D].name);if(!N)throw new Error("Could not find signal output with name "+G.signalOutputs[D].name+" in block "+G.className);N.deserialize(G.signalOutputs[D])}}getClassName(){return"FGExecutionBlock"}}class XN extends gN{constructor(G){super(G),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(G){this._preparePendingTasks(G),G._addPendingBlock(this)}}class WN extends XN{_execute(G){G._notifyExecuteNode(this),this.out._activateSignal(G)}}class jN{constructor(G){this.uniqueId=(0,kD.c)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new v.b,this._configuration=G}hasVariable(G){return G in this._userVariables}setVariable(G,D){this._userVariables[G]=D}getVariable(G){return this._userVariables[G]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(G,D){return`${G.uniqueId}_${D}`}_setExecutionVariable(G,D,N){this._executionVariables[this._getUniqueIdPrefixedName(G,D)]=N}_getExecutionVariable(G,D,N){return this._hasExecutionVariable(G,D)?this._executionVariables[this._getUniqueIdPrefixedName(G,D)]:N}_deleteExecutionVariable(G,D){delete this._executionVariables[this._getUniqueIdPrefixedName(G,D)]}_hasExecutionVariable(G,D){return this._getUniqueIdPrefixedName(G,D)in this._executionVariables}_hasConnectionValue(G){return G.uniqueId in this._connectionValues}_setConnectionValue(G,D){this._connectionValues[G.uniqueId]=D}_getConnectionValue(G){return this._connectionValues[G.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(G){this._pendingBlocks.push(G)}_removePendingBlock(G){const D=this._pendingBlocks.indexOf(G);-1!==D&&this._pendingBlocks.splice(D,1)}_clearPendingBlocks(){for(const G of this._pendingBlocks)G._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(G){this.onNodeExecutedObservable.notifyObservers(G)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},D=arguments.length>1&&void 0!==arguments[1]?arguments[1]:PN;G.uniqueId=this.uniqueId,G._userVariables={};for(const N in this._userVariables)D(N,this._userVariables[N],G._userVariables);G._connectionValues={};for(const N in this._connectionValues)D(N,this._connectionValues[N],G._connectionValues)}getClassName(){return"FGContext"}static Parse(G,D){const N=D.graph.createContext(),T=D.valueParseFunction??rN;N.uniqueId=G.uniqueId;for(const o in G._userVariables){const D=T(o,G._userVariables,N._configuration.oe);N._userVariables[o]=D}for(const o in G._connectionValues){const D=T(o,G._connectionValues,N._configuration.oe);N._connectionValues[o]=D}return N}}(0,m.c)([(0,R.S)()],jN.prototype,"uniqueId",void 0);var YN,yN,hN=N(1285);function mN(G,D){return!(!G.parent||G.parent!==D&&!mN(G.parent,D))}class RN extends WN{constructor(G){super(G),this.config=G}_getReferencedMesh(){const G=this.config.pathConverter.convert(this.config.path),D=G.info.getObject(G.object);if(!D||!(D instanceof J.d))throw new Error("Mesh pick event block requires a valid mesh");return D}_preparePendingTasks(G){let D=G._getExecutionVariable(this,"meshPickObserver");if(!D){const N=this._getReferencedMesh();G._setExecutionVariable(this,"mesh",N),D=N.va().onPointerObservable.add((D=>{var T,o,Z;D.type===hN.b.POINTERPICK&&null!==(T=D.pickInfo)&&void 0!==T&&T.pickedMesh&&((null===(o=D.pickInfo)||void 0===o?void 0:o.pickedMesh)===N||mN(null===(Z=D.pickInfo)||void 0===Z?void 0:Z.pickedMesh,N))&&this._execute(G)}));const T=N.Fd.add((()=>this._onDispose));G._setExecutionVariable(this,"meshPickObserver",D),G._setExecutionVariable(this,"meshDisposeObserver",T)}}_onDispose(G){this._cancelPendingTasks(G),G._removePendingBlock(this)}_cancelPendingTasks(G){const D=G._getExecutionVariable(this,"mesh"),N=G._getExecutionVariable(this,"meshPickObserver"),T=G._getExecutionVariable(this,"meshDisposeObserver");D.va().onPointerObservable.remove(N),D.Fd.remove(T),G._deleteExecutionVariable(this,"mesh"),G._deleteExecutionVariable(this,"meshPickObserver"),G._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return RN.ClassName}serialize(G){super.serialize(G),G.config.path=this.config.path}}RN.ClassName="FGMeshPickEventBlock",(0,B.h)(RN.ClassName,RN),function(G){G[G.Stopped=0]="Stopped",G[G.Started=1]="Started"}(YN||(YN={}));class LN{constructor(G){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=G.oe,this._coordinator=G.coordinator,this._sceneDisposeObserver=this._scene.Fd.add((()=>this.dispose()))}createContext(){const G=new jN({oe:this._scene,coordinator:this._coordinator});return this._executionContexts.push(G),G}getContext(G){return this._executionContexts[G]}addEventBlock(G){this._eventBlocks.push(G)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const G of this._executionContexts){const D=this._getContextualOrder();for(const N of D)N._startPendingTasks(G)}}}_getContextualOrder(){const G=[];for(const D of this._eventBlocks)if(D.getClassName()===RN.ClassName){const N=D._getReferencedMesh();let T=0;for(;T<G.length;T++){const D=G[T]._getReferencedMesh();if(N&&D&&mN(N,D))break}G.splice(T,0,D)}else G.push(D);return G}dispose(){if(0!==this.state){this.state=0;for(const G of this._executionContexts)G._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.Fd.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(G){const D=[],N=new Set;for(const T of this._eventBlocks)D.push(T),N.add(T.uniqueId);for(;D.length>0;){const T=D.pop();G(T);for(const G of T.dataInputs)for(const T of G._connectedPoint)N.has(T._ownerBlock.uniqueId)||(D.push(T._ownerBlock),N.add(T._ownerBlock.uniqueId));if(T instanceof gN)for(const G of T.signalOutputs)for(const T of G._connectedPoint)N.has(T._ownerBlock.uniqueId)||(D.push(T._ownerBlock),N.add(T._ownerBlock.uniqueId))}}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},D=arguments.length>1?arguments[1]:void 0;G.allBlocks=[],this.visitAllBlocks((D=>{const N={};D.serialize(N),G.allBlocks.push(N)})),G.executionContexts=[];for(const N of this._executionContexts){const T={};N.serialize(T,D),G.executionContexts.push(T)}}static GetDataOutConnectionByUniqueId(G,D){for(const N of G)for(const G of N.dataOutputs)if(G.uniqueId===D)return G;throw new Error("Could not find data out connection with unique id "+D)}static GetSignalInConnectionByUniqueId(G,D){for(const N of G)if(N instanceof gN)for(const G of N.signalInputs)if(G.uniqueId===D)return G;throw new Error("Could not find signal in connection with unique id "+D)}static Parse(G,D){const N=D.coordinator.createGraph(),T=[],o=D.valueParseFunction??rN;for(const Z of G.allBlocks){const G=vN.Parse(Z,{oe:D.coordinator.config.oe,pathConverter:D.pathConverter,valueParseFunction:o});T.push(G),G instanceof WN&&N.addEventBlock(G)}for(const Z of T){for(const G of Z.dataInputs)for(const D of G.connectedPointIds){const N=LN.GetDataOutConnectionByUniqueId(T,D);G.connectTo(N)}if(Z instanceof gN)for(const G of Z.signalOutputs)for(const D of G.connectedPointIds){const N=LN.GetSignalInConnectionByUniqueId(T,D);G.connectTo(N)}}for(const Z of G.executionContexts)jN.Parse(Z,{graph:N,valueParseFunction:o});return N}}class wN{constructor(G){this.config=G,this._flowGraphs=[],this._customEventsMap=new Map,this.config.oe.Fd.add((()=>{this.dispose()}));(wN.SceneCoordinators.get(this.config.oe)??[]).push(this)}createGraph(){const G=new LN({oe:this.config.oe,coordinator:this});return this._flowGraphs.push(G),G}removeGraph(G){const D=this._flowGraphs.indexOf(G);-1!==D&&(G.dispose(),this._flowGraphs.splice(D,1))}start(){this._flowGraphs.forEach((G=>G.start()))}dispose(){this._flowGraphs.forEach((G=>G.dispose())),this._flowGraphs.length=0;const G=wN.SceneCoordinators.get(this.config.oe)??[],D=G.indexOf(this);-1!==D&&G.splice(D,1)}serialize(G,D){G._flowGraphs=[],this._flowGraphs.forEach((N=>{const T={};N.serialize(T,D),G._flowGraphs.push(T)}))}static Parse(G,D){var N;const T=D.valueParseFunction??rN,o=new wN({oe:D.oe});return null===(N=G._flowGraphs)||void 0===N||N.forEach((G=>{LN.Parse(G,{coordinator:o,valueParseFunction:T,pathConverter:D.pathConverter})})),o}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(G){let D=this._customEventsMap.get(G);return D||(D=new v.b,this._customEventsMap.set(G,D)),D}notifyCustomEvent(G,D){const N=this._customEventsMap.get(G);N&&N.notifyObservers(D)}}wN.SceneCoordinators=new Map;class BN extends WN{_preparePendingTasks(G){if(!G._getExecutionVariable(this,"sceneReadyObserver")){const D=G.configuration.oe.onReadyObservable.add((()=>{this._execute(G)}));G._setExecutionVariable(this,"sceneReadyObserver",D)}}_cancelPendingTasks(G){const D=G._getExecutionVariable(this,"sceneReadyObserver");G.configuration.oe.onReadyObservable.remove(D),G._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return BN.ClassName}}BN.ClassName="FGSceneReadyEventBlock",(0,B.h)("FGSceneReadyEventBlock",BN);class FN extends WN{_preparePendingTasks(G){if(!G._getExecutionVariable(this,"sceneBeforeRender")){const D=G.configuration.oe.onBeforeRenderObservable.add((()=>{this._execute(G)}));G._setExecutionVariable(this,"sceneBeforeRender",D)}}_cancelPendingTasks(G){const D=G._getExecutionVariable(this,"sceneBeforeRender");G.configuration.oe.onBeforeRenderObservable.remove(D),G._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return FN.ClassName}}FN.ClassName="FGSceneTickEventBlock",(0,B.h)(FN.ClassName,FN);class SN extends gN{constructor(G){super(G),this.out=this._registerSignalOutput("out")}}class VN extends SN{constructor(G){super(G),this.message=this.registerDataInput("message",eD)}_execute(G){const D=this.message.getValue(G);j.d.Log(D),this.out._activateSignal(G)}getClassName(){return VN.ClassName}}VN.ClassName="FGConsoleLogBlock",(0,B.h)(VN.ClassName,VN),function(G){G[G.INIT=0]="INIT",G[G.STARTED=1]="STARTED",G[G.ENDED=2]="ENDED"}(yN||(yN={}));class UN{constructor(G){this.onEachCountObservable=new v.b,this.onTimerAbortedObservable=new v.b,this.onTimerEndedObservable=new v.b,this.onStateChangedObservable=new v.b,this._observer=null,this._breakOnNextTick=!1,this._tick=G=>{const D=Date.now();this._timer=D-this._startTime;const N={startTime:this._startTime,currentTime:D,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:G},T=this._breakOnNextTick||this._breakCondition(N);T||this._timer>=this._timeToEnd?this._stop(N,T):this.onEachCountObservable.notifyObservers(N)},this._setState(0),this._contextObservable=G.contextObservable,this._observableParameters=G.observableParameters??{},this._breakCondition=G.breakCondition??(()=>!1),this._timeToEnd=G.timeout,G.onEnded&&this.onTimerEndedObservable.add(G.onEnded),G.ti&&this.onEachCountObservable.add(G.ti),G.onAborted&&this.onTimerAbortedObservable.add(G.onAborted)}set breakCondition(G){this._breakCondition=G}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=G,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(G){this._state=G,this.onStateChangedObservable.notifyObservers(this._state)}_stop(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),D?this.onTimerAbortedObservable.notifyObservers(G):this.onTimerEndedObservable.notifyObservers(G)}}class zN extends XN{constructor(G){super(G),this.timeout=this.registerDataInput("timeout",fD)}_preparePendingTasks(G){const D=this.timeout.getValue(G);if(void 0!==D&&D>=0){const N=G._getExecutionVariable(this,"runningTimers")||[],T=G.configuration.oe,o=new UN({timeout:D,contextObservable:T.onBeforeRenderObservable,onEnded:()=>this._onEnded(o,G)});o.start(),N.push(o),G._setExecutionVariable(this,"runningTimers",N)}}_execute(G){this._startPendingTasks(G),this.out._activateSignal(G)}_onEnded(G,D){const N=D._getExecutionVariable(this,"runningTimers")||[],T=N.indexOf(G);-1!==T?N.splice(T,1):n.f.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),D._removePendingBlock(this),this.done._activateSignal(D)}_cancelPendingTasks(G){const D=G._getExecutionVariable(this,"runningTimers")||[];for(const N of D)N.dispose();G._deleteExecutionVariable(this,"runningTimers")}getClassName(){return zN.ClassName}}zN.ClassName="FGTimerBlock",(0,B.h)("FGTimerBlock",zN);class iN extends SN{constructor(G){super(G),this.config=G;for(let D=0;D<this.config.eventData.length;D++){const G=this.config.eventData[D];this.registerDataInput(G,eD)}}_execute(G){const D=this.config.eventId,N=this.dataInputs.map((D=>D.getValue(G)));G.configuration.coordinator.notifyCustomEvent(D,N),this.out._activateSignal(G)}getClassName(){return iN.ClassName}}iN.ClassName="FGSendCustomEventBlock",(0,B.h)("FGSendCustomEventBlock",iN);class JN extends WN{constructor(G){super(G),this.config=G;for(let D=0;D<this.config.eventData.length;D++){const G=this.config.eventData[D];this.registerDataOutput(G,eD)}}_preparePendingTasks(G){const D=G.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=D.add((D=>{for(let N=0;N<D.length;N++)this.dataOutputs[N].setValue(D[N],G);this._execute(G)}))}_cancelPendingTasks(G){const D=G.configuration.coordinator.getCustomEventObservable(this.config.eventId);D?D.remove(this._eventObserver):n.f.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return JN.ClassName}serialize(G){super.serialize(G),G.eventId=this.config.eventId,G.eventData=this.config.eventData}}JN.ClassName="FGReceiveCustomEventBlock",(0,B.h)(JN.ClassName,JN);class pN extends gN{constructor(G){super(G),this.config=G,this.outFlows=[];for(let D=0;D<this.config.numberOutputFlows;D++)this.outFlows.push(this._registerSignalOutput(`${D}`))}_execute(G){for(let D=0;D<this.config.numberOutputFlows;D++)this.outFlows[D]._activateSignal(G)}getClassName(){return pN.ClassName}}pN.ClassName="FGSequenceBlock",(0,B.h)(pN.ClassName,pN);const tN=new RegExp(/\{(\w+)\}/g);class HN{constructor(G,D){this.path=G,this.ownerBlock=D,this.templatedInputs=[];let N=tN.exec(G);for(;N;){const[,T]=N;this.templatedInputs.push(D.registerDataInput(T,oN)),N=tN.exec(G)}}getAccessor(G,D){let N=this.path;for(const T of this.templatedInputs){const G=T.getValue(D).value;N=N.replace(`{${T.name}}`,G.toString())}return G.convert(N)}}class sN extends vN{constructor(G){super(G),this.config=G,this.value=this.registerDataOutput("value",eD),this.templateComponent=new HN(G.path,this)}_updateOutputs(G){const D=this.templateComponent.getAccessor(this.config.pathConverter,G),N=D.info.get(D.object);this.value.setValue(N,G)}getClassName(){return sN.ClassName}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(G),G.config.path=this.config.path}}sN.ClassName="FGGetPropertyBlock",(0,B.h)(sN.ClassName,sN);class cN extends SN{constructor(G){super(G),this.config=G,this.a=this.registerDataInput("a",eD),this.templateComponent=new HN(G.path,this)}_execute(G){const D=this.a.getValue(G),N=this.templateComponent.getAccessor(this.config.pathConverter,G);N.info.set(D,N.object),this.out._activateSignal(G)}serialize(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(G),G.config.path=this.config.path}getClassName(){return cN.ClassName}}cN.ClassName="FGSetPropertyBlock",(0,B.h)("FGSetPropertyBlock",cN);const KN="cachedOperationValue",bN="cachedExecutionId";class ON extends vN{constructor(G,D){super(D),this.value=this.registerDataOutput("value",G)}_updateOutputs(G){const D=G._getExecutionVariable(this,bN),N=G._getExecutionVariable(this,KN);if(void 0!==N&&D===G.executionId)this.value.setValue(N,G);else{const D=this._doOperation(G);G._setExecutionVariable(this,KN,D),G._setExecutionVariable(this,bN,G.executionId),this.value.setValue(D,G)}}}class QN extends ON{constructor(G,D,N,T,o,Z){super(N,Z),this._operation=T,this._className=o,this.a=this.registerDataInput("a",G),this.b=this.registerDataInput("b",D)}_doOperation(G){return this._operation(this.a.getValue(G),this.b.getValue(G))}getClassName(){return this._className}}class AN extends ON{constructor(G,D,N,T){super(G,T),this._operation=D,this._className=N}_doOperation(G){return this._operation()}getClassName(){return this._className}}class IN extends ON{constructor(G,D,N,T,o){super(D,o),this._operation=N,this._className=T,this.a=this.registerDataInput("a",G)}_doOperation(G){return this._operation(this.a.getValue(G))}getClassName(){return this._className}}class dN extends ON{constructor(G,D,N,T,o,Z,n){super(T,n),this._operation=o,this._className=Z,this.a=this.registerDataInput("a",G),this.b=this.registerDataInput("b",D),this.c=this.registerDataInput("c",N)}_doOperation(G){return this._operation(this.a.getValue(G),this.b.getValue(G),this.c.getValue(G))}getClassName(){return this._className}}function uN(G){return G.getClassName?G.getClassName():""}function lN(G,D){return"Vector2"===G&&"Vector2"===D||"Ad"===G&&"Ad"===D||"Vector4"===G&&"Vector4"===D}function xN(G,D){return"Matrix"===G&&"Matrix"===D}function kN(G,D){return"FlowGraphInteger"===G&&"FlowGraphInteger"===D}class aN extends QN{constructor(G){super(eD,eD,eD,((G,D)=>this._polymorphicAdd(G,D)),aN.ClassName,G)}_polymorphicAdd(G,D){const N=uN(G),T=uN(D);return lN(N,T)||xN(N,T)||kN(N,T)?G.add(D):G+D}}aN.ClassName="FGAddBlock",(0,B.h)(aN.ClassName,aN);class EN extends QN{constructor(G){super(eD,eD,eD,((G,D)=>this._polymorphicAdd(G,D)),EN.ClassName,G)}_polymorphicAdd(G,D){const N=uN(G),T=uN(D);return lN(N,T)||kN(N,T)?G.Jc(D):xN(N,T)?G.add(D.scale(-1)):G-D}}EN.ClassName="FGSubBlock",(0,B.h)(EN.ClassName,EN);class MN extends QN{constructor(G){super(eD,eD,eD,((G,D)=>this._polymorphicMultiply(G,D)),MN.ClassName,G)}_polymorphicMultiply(G,D){const N=uN(G),T=uN(D);return lN(N,T)||kN(N,T)?G.multiply(D):xN(N,T)?o.c.FromValues(G.m[0]*D.m[0],G.m[4]*D.m[4],G.m[8]*D.m[8],G.m[12]*D.m[12],G.m[1]*D.m[1],G.m[5]*D.m[5],G.m[9]*D.m[9],G.m[13]*D.m[13],G.m[2]*D.m[2],G.m[6]*D.m[6],G.m[10]*D.m[10],G.m[14]*D.m[14],G.m[3]*D.m[3],G.m[7]*D.m[7],G.m[11]*D.m[11],G.m[15]*D.m[15]):G*D}}MN.ClassName="FGMultiplyBlock",(0,B.h)(MN.ClassName,MN);class eN extends QN{constructor(G){super(eD,eD,eD,((G,D)=>this._polymorphicDivide(G,D)),eN.ClassName,G)}_polymorphicDivide(G,D){const N=uN(G),T=uN(D);return lN(N,T)||kN(N,T)?G.divide(D):xN(N,T)?o.c.FromValues(G.m[0]/D.m[0],G.m[4]/D.m[4],G.m[8]/D.m[8],G.m[12]/D.m[12],G.m[1]/D.m[1],G.m[5]/D.m[5],G.m[9]/D.m[9],G.m[13]/D.m[13],G.m[2]/D.m[2],G.m[6]/D.m[6],G.m[10]/D.m[10],G.m[14]/D.m[14],G.m[3]/D.m[3],G.m[7]/D.m[7],G.m[11]/D.m[11],G.m[15]/D.m[15]):G/D}}eN.ClassName="FGDivideBlock",(0,B.h)(eN.ClassName,eN);class fN extends AN{constructor(G){super(fD,(()=>Math.random()),fN.ClassName,G)}}fN.ClassName="FGRandomBlock",(0,B.h)(fN.ClassName,fN);class GT extends QN{constructor(G){super(eD,eD,fD,((G,D)=>this._polymorphicDot(G,D)),GT.ClassName,G)}_polymorphicDot(G,D){switch(uN(G)){case"Vector2":return o.o.Dot(G,D);case"Ad":return o.s.Dot(G,D);case"Vector4":return o.v.Dot(G,D);default:throw new Error(`Cannot get dot product of ${G} and ${D}`)}}}GT.ClassName="FGDotBlock",(0,B.h)(GT.ClassName,GT);class DT extends AN{constructor(G){super(fD,(()=>Math.E),DT.ClassName,G)}}DT.ClassName="FGEBlock",(0,B.h)(DT.ClassName,DT);class NT extends AN{constructor(G){super(fD,(()=>Math.PI),NT.ClassName,G)}}NT.ClassName="FGPIBlock",(0,B.h)(NT.ClassName,NT);class TT extends AN{constructor(G){super(fD,(()=>Number.POSITIVE_INFINITY),TT.ClassName,G)}}TT.ClassName="FGInfBlock",(0,B.h)(TT.ClassName,TT);class oT extends AN{constructor(G){super(fD,(()=>Number.NaN),oT.ClassName,G)}}function ZT(G,D){switch(uN(G)){case"FlowGraphInteger":return new ED(D(G.value));case"Vector2":return new o.o(D(G.x),D(G.y));case"Ad":return new o.s(D(G.x),D(G.y),D(G.z));case"Vector4":return new o.v(D(G.x),D(G.y),D(G.z),D(G.w));case"Matrix":return o.c.FromValues(D(G.m[0]),D(G.m[4]),D(G.m[8]),D(G.m[12]),D(G.m[1]),D(G.m[5]),D(G.m[9]),D(G.m[13]),D(G.m[2]),D(G.m[6]),D(G.m[10]),D(G.m[14]),D(G.m[3]),D(G.m[7]),D(G.m[11]),D(G.m[15]));default:return D(G)}}oT.ClassName="FGNaNBlock",(0,B.h)(oT.ClassName,oT);class nT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicAbs(G)),nT.ClassName,G)}_polymorphicAbs(G){return ZT(G,Math.abs)}}nT.ClassName="FGAbsBlock",(0,B.h)(nT.ClassName,nT);class CT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicSign(G)),CT.ClassName,G)}_polymorphicSign(G){return ZT(G,Math.sign)}}CT.ClassName="FGSignBlock",(0,B.h)(CT.ClassName,CT);class PT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicTrunc(G)),PT.ClassName,G)}_polymorphicTrunc(G){return ZT(G,Math.trunc)}}PT.ClassName="FGTruncBlock",(0,B.h)(PT.ClassName,PT);class rT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicFloor(G)),rT.ClassName,G)}_polymorphicFloor(G){return ZT(G,Math.floor)}}rT.ClassName="FGFloorBlock",(0,B.h)(rT.ClassName,rT);class vT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicCeiling(G)),vT.ClassName,G)}_polymorphicCeiling(G){return ZT(G,Math.ceil)}}vT.ClassName="FGCeilBlock",(0,B.h)(vT.ClassName,vT);class qT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicFract(G)),qT.ClassName,G)}_polymorphicFract(G){return ZT(G,(G=>G-Math.floor(G)))}}qT.ClassName="FGFractBlock",(0,B.h)(qT.ClassName,qT);class gT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicNeg(G)),gT.ClassName,G)}_polymorphicNeg(G){return ZT(G,(G=>-G))}}function XT(G,D,N){switch(uN(G)){case"FlowGraphInteger":return new ED(N(G.value,D.value));case"Vector2":return new o.o(N(G.x,D.x),N(G.y,D.y));case"Ad":return new o.s(N(G.x,D.x),N(G.y,D.y),N(G.z,D.z));case"Vector4":return new o.v(N(G.x,D.x),N(G.y,D.y),N(G.z,D.z),N(G.w,D.w));case"Matrix":return o.c.FromValues(N(G.m[0],D.m[0]),N(G.m[4],D.m[4]),N(G.m[8],D.m[8]),N(G.m[12],D.m[12]),N(G.m[1],D.m[1]),N(G.m[5],D.m[5]),N(G.m[9],D.m[9]),N(G.m[13],D.m[13]),N(G.m[2],D.m[2]),N(G.m[6],D.m[6]),N(G.m[10],D.m[10]),N(G.m[14],D.m[14]),N(G.m[3],D.m[3]),N(G.m[7],D.m[7]),N(G.m[11],D.m[11]),N(G.m[15],D.m[15]));default:return N(G,D)}}gT.ClassName="FGNegBlock",(0,B.h)(gT.ClassName,gT);class WT extends QN{constructor(G){super(eD,eD,eD,((G,D)=>this._polymorphicRemainder(G,D)),WT.ClassName,G)}_polymorphicRemainder(G,D){return XT(G,D,((G,D)=>G%D))}}WT.ClassName="FGRemainderBlock",(0,B.h)(WT.ClassName,WT);class jT extends QN{constructor(G){super(eD,eD,eD,((G,D)=>this._polymorphicMin(G,D)),jT.ClassName,G)}_polymorphicMin(G,D){return XT(G,D,Math.min)}}jT.ClassName="FGMinBlock",(0,B.h)(jT.ClassName,jT);class YT extends QN{constructor(G){super(eD,eD,eD,((G,D)=>this._polymorphicMax(G,D)),YT.ClassName,G)}_polymorphicMax(G,D){return XT(G,D,Math.max)}}function yT(G,D,N){return Math.min(Math.max(G,Math.min(D,N)),Math.max(D,N))}function hT(G,D,N,T){switch(uN(G)){case"FlowGraphInteger":return new ED(T(G.value,D.value,N.value));case"Vector2":return new o.o(T(G.x,D.x,N.x),T(G.y,D.y,N.y));case"Ad":return new o.s(T(G.x,D.x,N.x),T(G.y,D.y,N.y),T(G.z,D.z,N.z));case"Vector4":return new o.v(T(G.x,D.x,N.x),T(G.y,D.y,N.y),T(G.z,D.z,N.z),T(G.w,D.w,N.w));case"Matrix":return o.c.FromValues(T(G.m[0],D.m[0],N.m[0]),T(G.m[4],D.m[4],N.m[4]),T(G.m[8],D.m[8],N.m[8]),T(G.m[12],D.m[12],N.m[12]),T(G.m[1],D.m[1],N.m[1]),T(G.m[5],D.m[5],N.m[5]),T(G.m[9],D.m[9],N.m[9]),T(G.m[13],D.m[13],N.m[13]),T(G.m[2],D.m[2],N.m[2]),T(G.m[6],D.m[6],N.m[6]),T(G.m[10],D.m[10],N.m[10]),T(G.m[14],D.m[14],N.m[14]),T(G.m[3],D.m[3],N.m[3]),T(G.m[7],D.m[7],N.m[7]),T(G.m[11],D.m[11],N.m[11]),T(G.m[15],D.m[15],N.m[15]));default:return T(G,D,N)}}YT.ClassName="FGMaxBlock",(0,B.h)(YT.ClassName,YT);class mT extends dN{constructor(G){super(eD,eD,eD,eD,((G,D,N)=>this._polymorphicClamp(G,D,N)),mT.ClassName,G)}_polymorphicClamp(G,D,N){return hT(G,D,N,yT)}}function RT(G){return Math.min(Math.max(G,0),1)}mT.ClassName="FGClampBlock",(0,B.h)(mT.ClassName,mT);class LT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicSaturate(G)),LT.ClassName,G)}_polymorphicSaturate(G){return ZT(G,RT)}}LT.ClassName="FGSaturateBlock",(0,B.h)(LT.ClassName,LT);class wT extends dN{constructor(G){super(eD,eD,eD,eD,((G,D,N)=>this._polymorphicInterpolate(G,D,N)),wT.ClassName,G)}_interpolate(G,D,N){return(1-N)*G+N*D}_polymorphicInterpolate(G,D,N){return hT(G,D,N,this._interpolate)}}wT.ClassName="FGInterpolateBlock",(0,B.h)(wT.ClassName,wT);class BT extends QN{constructor(G){super(eD,eD,GN,((G,D)=>this._polymorphicEq(G,D)),BT.ClassName,G)}_polymorphicEq(G,D){const N=uN(G),T=uN(D);return lN(N,T)||xN(N,T)||kN(N,T)?G.equals(D):G===D}}function FT(G,D,N){const T=uN(G);if(T===uN(D)){if(""===T)return N(G,D);if("FlowGraphInteger"===T)return N(G.value,D.value);throw new Error(`Cannot compare ${G} and ${D}`)}throw new Error(`${G} and ${D} are of different types.`)}BT.ClassName="FGEqBlock",(0,B.h)(BT.ClassName,BT);class ST extends QN{constructor(G){super(eD,eD,GN,((G,D)=>this._polymorphicLessThan(G,D)),ST.ClassName,G)}_polymorphicLessThan(G,D){return FT(G,D,((G,D)=>G<D))}}ST.ClassName="FGLessThanBlock",(0,B.h)(ST.ClassName,ST);class VT extends QN{constructor(G){super(eD,eD,GN,((G,D)=>this._polymorphicLessThanOrEqual(G,D)),VT.ClassName,G)}_polymorphicLessThanOrEqual(G,D){return FT(G,D,((G,D)=>G<=D))}}VT.ClassName="FGLessThanOrEqualBlock";class UT extends QN{constructor(G){super(eD,eD,GN,((G,D)=>this._polymorphicGreaterThan(G,D)),UT.ClassName,G)}_polymorphicGreaterThan(G,D){return FT(G,D,((G,D)=>G>D))}}UT.ClassName="FGGreaterThanBlock",(0,B.h)(UT.ClassName,UT);class zT extends QN{constructor(G){super(eD,eD,GN,((G,D)=>this._polymorphicGreaterThanOrEqual(G,D)),zT.ClassName,G)}_polymorphicGreaterThanOrEqual(G,D){return FT(G,D,((G,D)=>G>=D))}}zT.ClassName="FGGreaterThanOrEqualBlock",(0,B.h)(zT.ClassName,zT);class iT extends IN{constructor(G){super(eD,GN,(G=>this._polymorphicIsNan(G)),iT.ClassName,G)}_polymorphicIsNan(G){const D=uN(G);if(""===D)return isNaN(G);if("FlowGraphInteger"===D)return isNaN(G.value);throw new Error(`Cannot get NaN of ${G}`)}}iT.ClassName="FGIsNanBlock",(0,B.h)(iT.ClassName,iT);class JT extends IN{constructor(G){super(eD,GN,(G=>this._polymorphicIsInf(G)),JT.ClassName,G)}_polymorphicIsInf(G){const D=uN(G);if(""===D)return!isFinite(G);if("FlowGraphInteger"===D)return!isFinite(G.value);throw new Error(`Cannot get isInf of ${G}`)}}JT.ClassName="FGIsInfBlock";class pT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicDegToRad(G)),pT.ClassName,G)}_degToRad(G){return G*Math.PI/180}_polymorphicDegToRad(G){return ZT(G,this._degToRad)}}pT.ClassName="FGDegToRadBlock",(0,B.h)(pT.ClassName,pT);class tT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicRadToDeg(G)),tT.ClassName,G)}_radToDeg(G){return 180*G/Math.PI}_polymorphicRadToDeg(G){return ZT(G,this._radToDeg)}}tT.ClassName="FGRadToDegBlock",(0,B.h)(tT.ClassName,tT);class HT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicSin(G)),HT.ClassName,G)}_polymorphicSin(G){return ZT(G,Math.sin)}}HT.ClassName="FGSinBlock",(0,B.h)(HT.ClassName,HT);class sT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicCos(G)),sT.ClassName,G)}_polymorphicCos(G){return ZT(G,Math.cos)}}sT.ClassName="FGCosBlock",(0,B.h)(sT.ClassName,sT);class cT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicTan(G)),cT.ClassName,G)}_polymorphicTan(G){return ZT(G,Math.tan)}}cT.ClassName="FGTanBlock",(0,B.h)(cT.ClassName,cT);class KT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicAsin(G)),KT.ClassName,G)}_polymorphicAsin(G){return ZT(G,Math.asin)}}KT.ClassName="FGAsinBlock",(0,B.h)(KT.ClassName,KT);class bT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicAcos(G)),bT.ClassName,G)}_polymorphicAcos(G){return ZT(G,Math.acos)}}bT.ClassName="FGAcosBlock",(0,B.h)(bT.ClassName,bT);class OT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicAtan(G)),OT.ClassName,G)}_polymorphicAtan(G){return ZT(G,Math.atan)}}OT.ClassName="FGAtanBlock",(0,B.h)(OT.ClassName,OT);class QT extends QN{constructor(G){super(eD,eD,eD,((G,D)=>this._polymorphicAtan2(G,D)),QT.ClassName,G)}_polymorphicAtan2(G,D){return XT(G,D,Math.atan2)}}QT.ClassName="FGAtan2Block",(0,B.h)(QT.ClassName,QT);class AT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicSinh(G)),AT.ClassName,G)}_polymorphicSinh(G){return ZT(G,Math.sinh)}}AT.ClassName="FGSinhBlock",(0,B.h)(AT.ClassName,AT);class IT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicCosh(G)),IT.ClassName,G)}_polymorphicCosh(G){return ZT(G,Math.cosh)}}IT.ClassName="FGCoshBlock",(0,B.h)(IT.ClassName,IT);class dT extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicTanh(G)),dT.ClassName,G)}_polymorphicTanh(G){return ZT(G,Math.tanh)}}dT.ClassName="FGTanhBlock",(0,B.h)(dT.ClassName,dT);class uT extends IN{constructor(G){super(eD,fD,(G=>this._polymorphicAsinh(G)),uT.ClassName,G)}_polymorphicAsinh(G){return ZT(G,Math.asinh)}}uT.ClassName="FGAsinhBlock",(0,B.h)(uT.ClassName,uT);class lT extends IN{constructor(G){super(eD,fD,(G=>this._polymorphicAcosh(G)),lT.ClassName,G)}_polymorphicAcosh(G){return ZT(G,Math.acosh)}}lT.ClassName="FGAcoshBlock",(0,B.h)(lT.ClassName,lT);class xT extends IN{constructor(G){super(eD,fD,(G=>this._polymorphicAtanh(G)),xT.ClassName,G)}_polymorphicAtanh(G){return ZT(G,Math.atanh)}}xT.ClassName="FGAtanhBlock",(0,B.h)(xT.ClassName,xT);class kT extends IN{constructor(G){super(eD,fD,(G=>this._polymorphicExp(G)),kT.ClassName,G)}_polymorphicExp(G){return ZT(G,Math.exp)}}kT.ClassName="FGExpBlock",(0,B.h)(kT.ClassName,kT);class aT extends IN{constructor(G){super(eD,fD,(G=>this._polymorphicLog(G)),aT.ClassName,G)}_polymorphicLog(G){return ZT(G,Math.log)}}aT.ClassName="FGLogBlock",(0,B.h)(aT.ClassName,aT);class ET extends IN{constructor(G){super(eD,fD,(G=>this._polymorphicLog2(G)),ET.ClassName,G)}_polymorphicLog2(G){return ZT(G,Math.log2)}}ET.ClassName="FGLog2Block",(0,B.h)(ET.ClassName,ET);class MT extends IN{constructor(G){super(eD,fD,(G=>this._polymorphicLog10(G)),MT.ClassName,G)}_polymorphicLog10(G){return ZT(G,Math.log10)}}MT.ClassName="FGLog10Block",(0,B.h)(MT.ClassName,MT);class eT extends IN{constructor(G){super(eD,fD,(G=>this._polymorphicSqrt(G)),eT.ClassName,G)}_polymorphicSqrt(G){return ZT(G,Math.sqrt)}}eT.ClassName="FGSqrtBlock",(0,B.h)(eT.ClassName,eT);class fT extends IN{constructor(G){super(eD,fD,(G=>this._polymorphicCubeRoot(G)),fT.ClassName,G)}_polymorphicCubeRoot(G){return ZT(G,Math.cbrt)}}fT.ClassName="FGCubeRootBlock",(0,B.h)(fT.ClassName,fT);class Go extends QN{constructor(G){super(eD,fD,fD,((G,D)=>this._polymorphicPow(G,D)),Go.ClassName,G)}_polymorphicPow(G,D){return XT(G,D,Math.pow)}}Go.ClassName="FGPowBlock",(0,B.h)(Go.ClassName,Go);class Do extends IN{constructor(G){super(eD,fD,(G=>this._polymorphicLength(G)),Do.ClassName,G)}_polymorphicLength(G){switch(uN(G)){case"Vector2":case"Ad":case"Vector4":return G.length();default:throw new Error(`Cannot compute length of value ${G}`)}}}Do.ClassName="FGLengthBlock",(0,B.h)(Do.ClassName,Do);class No extends IN{constructor(G){super(eD,eD,(G=>this._polymorphicNormalize(G)),No.ClassName,G)}_polymorphicNormalize(G){switch(uN(G)){case"Vector2":case"Ad":case"Vector4":return G.normalize();default:throw new Error(`Cannot normalize value ${G}`)}}}No.ClassName="FGNormalizeBlock",(0,B.h)(No.ClassName,No);class To extends QN{constructor(G){super(NN,NN,NN,((G,D)=>o.s.Cross(G,D)),To.ClassName,G)}}To.ClassName="FGCrossBlock",(0,B.h)(To.ClassName,To);class oo extends QN{constructor(G){super(DN,fD,DN,((G,D)=>o.o.Transform(G,o.c.RotationZ(D))),oo.ClassName,G)}}oo.ClassName="FGRotate2DBlock",(0,B.h)(oo.ClassName,oo);class Zo extends dN{constructor(G){super(NN,NN,fD,NN,((G,D,N)=>o.s.TransformCoordinates(G,o.c.RotationAxis(D,N))),Zo.ClassName,G)}}Zo.ClassName="FGRotate3DBlock",(0,B.h)(Zo.ClassName,Zo);class no extends IN{constructor(G){super(TN,TN,(G=>o.c.Transpose(G)),no.ClassName,G)}}no.ClassName="FGTransposeBlock",(0,B.h)(no.ClassName,no);class Co extends IN{constructor(G){super(TN,fD,(G=>G.determinant()),Co.ClassName,G)}}Co.ClassName="FGDeterminantBlock",(0,B.h)(Co.ClassName,Co);class Po extends IN{constructor(G){super(TN,TN,(G=>o.c.Invert(G)),Po.ClassName,G)}}Po.ClassName="FGInvertMatrixBlock",(0,B.h)(Po.ClassName,Po);class ro extends QN{constructor(G){super(TN,TN,TN,((G,D)=>D.multiply(G)),ro.ClassName,G)}}ro.ClassName="FGMatMulBlock",(0,B.h)(ro.ClassName,ro);class vo extends IN{constructor(G){super(oN,oN,(G=>new ED(~G.value)),vo.ClassName,G)}}vo.ClassName="FGBitwiseNotBlock",(0,B.h)(vo.ClassName,vo);class qo extends QN{constructor(G){super(oN,oN,oN,((G,D)=>new ED(G.value&D.value)),qo.ClassName,G)}}qo.ClassName="FGBitwiseAndBlock",(0,B.h)(qo.ClassName,qo);class go extends QN{constructor(G){super(oN,oN,oN,((G,D)=>new ED(G.value|D.value)),go.ClassName,G)}}go.ClassName="FGBitwiseOrBlock",(0,B.h)(go.ClassName,go);class Xo extends QN{constructor(G){super(oN,oN,oN,((G,D)=>new ED(G.value^D.value)),Xo.ClassName,G)}}Xo.ClassName="FGBitwiseXorBlock",(0,B.h)(Xo.ClassName,Xo);class Wo extends QN{constructor(G){super(oN,oN,oN,((G,D)=>new ED(G.value<<D.value)),Wo.ClassName,G)}}Wo.ClassName="FGBitwiseLeftShiftBlock",(0,B.h)(Wo.ClassName,Wo);class jo extends QN{constructor(G){super(oN,oN,oN,((G,D)=>new ED(G.value>>D.value)),jo.ClassName,G)}}jo.ClassName="FGBitwiseRightShiftBlock",(0,B.h)(jo.ClassName,jo);class Yo extends IN{constructor(G){super(oN,oN,(G=>new ED(Math.clz32(G.value))),Yo.ClassName,G)}}Yo.ClassName="FGCountLeadingZerosBlock",(0,B.h)(Yo.ClassName,Yo);class yo extends IN{constructor(G){super(oN,oN,(G=>new ED(G.value?31-Math.clz32(G.value&-G.value):32)),yo.ClassName,G)}}yo.ClassName="FGCountTrailingZerosBlock",(0,B.h)(yo.ClassName,yo);class ho extends IN{constructor(G){super(oN,oN,(G=>new ED(function(G){let D=0;for(;G;)D+=1&G,G>>=1;return D}(G.value))),ho.ClassName,G)}}ho.ClassName="FGCountOneBitsBlock",(0,B.h)(ho.ClassName,ho);class mo extends SN{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new ED(0)};super(G),this.config=G,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",oN),this.value=this.registerDataOutput("value",oN)}_execute(G,D){if(D===this.reset)this.value.setValue(this.config.startIndex,G);else{const D=this.value.getValue(G);D.value<this.n.getValue(G).value&&(this.value.setValue(new ED(D.value+1),G),this.out._activateSignal(G))}}getClassName(){return mo.ClassName}}mo.ClassName="FGDoNBlock",(0,B.h)(mo.ClassName,mo);class Ro extends vN{constructor(G){super(G),this.config=G,this.output=this.registerDataOutput(G.variableName,eD)}_updateOutputs(G){const D=this.config.variableName;G.hasVariable(D)&&this.output.setValue(G.getVariable(D),G)}getClassName(){return Ro.ClassName}serialize(G){super.serialize(G),G.config.variableName=this.config.variableName}}Ro.ClassName="FGGetVariableBlock",(0,B.h)(Ro.ClassName,Ro);class Lo extends SN{constructor(G){super(G),this.config=G,this.input=this.registerDataInput(G.variableName,eD)}_execute(G){const D=this.config.variableName,N=this.input.getValue(G);G.setVariable(D,N),this.out._activateSignal(G)}getClassName(){return Lo.ClassName}}Lo.ClassName="FGSetVariableBlock",(0,B.h)(Lo.ClassName,Lo);class wo extends SN{constructor(G){super(G),this.config=G,this.condition=this.registerDataInput("condition",GN),this.loopBody=this._registerSignalOutput("loopBody")}_execute(G,D){var N;let T=this.condition.getValue(G);for(null!==(N=this.config)&&void 0!==N&&N.isDo&&!T&&this.loopBody._activateSignal(G);T;)this.loopBody._activateSignal(G),T=this.condition.getValue(G);this.out._activateSignal(G)}getClassName(){return wo.ClassName}serialize(G){var D;super.serialize(G),G.isDo=null===(D=this.config)||void 0===D?void 0:D.isDo}}wo.ClassName="FGWhileLoopBlock",(0,B.h)(wo.ClassName,wo);const Bo={"lifecycle/onStart":BN.ClassName,"lifecycle/onTick":FN.ClassName,log:VN.ClassName,"flow/delay":zN.ClassName,"customEvent/send":iN.ClassName,"customEvent/receive":JN.ClassName,"flow/sequence":pN.ClassName,"world/get":sN.ClassName,"world/set":cN.ClassName,"flow/doN":mo.ClassName,"variable/get":Ro.ClassName,"variable/set":Lo.ClassName,"flow/whileLoop":wo.ClassName,"math/random":fN.ClassName,"math/e":DT.ClassName,"math/pi":NT.ClassName,"math/inf":TT.ClassName,"math/nan":oT.ClassName,"math/abs":nT.ClassName,"math/sign":CT.ClassName,"math/trunc":PT.ClassName,"math/floor":rT.ClassName,"math/ceil":vT.ClassName,"math/fract":qT.ClassName,"math/neg":gT.ClassName,"math/add":aN.ClassName,"math/sub":EN.ClassName,"math/mul":MN.ClassName,"math/div":eN.ClassName,"math/rem":WT.ClassName,"math/min":jT.ClassName,"math/max":YT.ClassName,"math/clamp":mT.ClassName,"math/saturate":LT.ClassName,"math/mix":wT.ClassName,"math/eq":BT.ClassName,"math/lt":ST.ClassName,"math/le":VT.ClassName,"math/gt":UT.ClassName,"math/ge":zT.ClassName,"math/isnan":iT.ClassName,"math/isinf":JT.ClassName,"math/rad":pT.ClassName,"math/deg":tT.ClassName,"math/sin":HT.ClassName,"math/cos":sT.ClassName,"math/tan":cT.ClassName,"math/asin":KT.ClassName,"math/acos":bT.ClassName,"math/atan":OT.ClassName,"math/atan2":QT.ClassName,"math/sinh":AT.ClassName,"math/cosh":IT.ClassName,"math/tanh":dT.ClassName,"math/asinh":uT.ClassName,"math/acosh":lT.ClassName,"math/atanh":xT.ClassName,"math/exp":kT.ClassName,"math/log":aT.ClassName,"math/log2":ET.ClassName,"math/log10":MT.ClassName,"math/sqrt":eT.ClassName,"math/cbrt":fT.ClassName,"math/pow":Go.ClassName,"math/length":Do.ClassName,"math/normalize":No.ClassName,"math/dot":GT.ClassName,"math/cross":To.ClassName,"math/rotate2d":oo.ClassName,"math/rotate3d":Zo.ClassName,"math/transpose":no.ClassName,"math/determinant":Co.ClassName,"math/inverse":Po.ClassName,"math/matmul":ro.ClassName,"math/not":vo.ClassName,"math/and":qo.ClassName,"math/or":go.ClassName,"math/xor":Xo.ClassName,"math/asr":jo.ClassName,"math/lsl":Wo.ClassName,"math/clz":Yo.ClassName,"math/ctz":yo.ClassName,"math/popcnt":ho.ClassName},Fo={float2:"Vector2",float3:"Ad",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function So(G,D,N){if(void 0!==G.type){const T=D.types&&D.types[G.type];if(!T)throw new Error(`${N}: Unknown type: ${G.type}`);const o=T.signature;if(!o)throw new Error(`${N}: Type ${G.type} has no signature`);const Z=Fo[o];return{value:G.value,className:Z}}return G.value}function Vo(G,D,N){const T=Bo[D.type];if(!T)throw new Error(`/extensions/KHR_interactivity/nodes/${G}: Unknown block type: ${D.type}`);const o=G.toString(),Z=function(G,D,N){const T={},o=G.configuration??[];for(const Z of o)if("customEvent"===Z.id){const G=D.customEvents&&D.customEvents[Z.value];if(!G)throw new Error(`/extensions/KHR_interactivity/nodes/${N}: Unknown custom event: ${Z.value}`);T.eventId=G.id,T.eventData=G.values.map((G=>G.id))}else if("variable"===Z.id){const G=D.variables&&D.variables[Z.value];if(!G)throw new Error(`/extensions/KHR_interactivity/nodes/${N}: Unknown variable: ${Z.value}`);T.variableName=G.id}else if("path"===Z.id){const G=Z.value;T.path=G}else T[Z.id]=So(Z,D,`/extensions/KHR_interactivity/nodes/${N}`);return T}(D,N,o);return{className:T,config:Z,uniqueId:o,metadata:D.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class Uo extends BD{constructor(G){super(G,io)}}const zo={__array__:{__target__:!0,translation:{type:"Ad",get:G=>G._babylonTransformNode.position,set:(G,D)=>{D._babylonTransformNode.position=G},getObject:G=>G._babylonTransformNode}}},io={nodes:zo},Jo="KHR_interactivity";class po{constructor(G){this._loader=G,this.name=Jo,this.enabled=this._loader.isExtensionUsed(Jo),this._pathConverter=new Uo(this._loader.aj)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var G;if(!this._loader.babylonScene||!this._pathConverter)return;const D=this._loader.babylonScene,N=function(G){const D={uniqueId:(0,kD.c)(),_userVariables:{},_connectionValues:{}},N=[D],T=[];for(let Z=0;Z<G.nodes.length;Z++){const D=Vo(Z,G.nodes[Z],G);T.push(D)}for(let Z=0;Z<G.nodes.length;Z++){const N=G.nodes[Z],o=T[Z],n=N.flows??[];for(const G of n){const D=G.id,N={uniqueId:(0,kD.c)(),name:D,_connectionType:1,connectedPointIds:[]};o.signalOutputs.push(N);const n=G.node,C=G.socket,P=T[n];if(!P)throw new Error(`/extensions/KHR_interactivity/nodes/${Z}: Could not find node with id ${n} that connects its input with with node ${Z}'s output ${D}`);let r=P.signalInputs.find((G=>G.name===C));r||(r={uniqueId:(0,kD.c)(),name:C,_connectionType:0,connectedPointIds:[]},P.signalInputs.push(r)),r.connectedPointIds.push(N.uniqueId),N.connectedPointIds.push(r.uniqueId)}const C=N.values??[];for(const P of C){const N=P.id,n={uniqueId:(0,kD.c)(),name:N,_connectionType:0,connectedPointIds:[]};if(o.dataInputs.push(n),void 0!==P.value){const N=So(P,G,`/extensions/KHR_interactivity/nodes/${Z}`);D._connectionValues[n.uniqueId]=N}else{if(void 0===P.node||void 0===P.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${Z}: Invalid socket ${N} in node ${Z}`);{const G=P.node,D=P.socket,o=T[G];if(!o)throw new Error(`/extensions/KHR_interactivity/nodes/${Z}: Could not find node with id ${G} that connects its output with node${Z}'s input ${N}`);let C=o.dataOutputs.find((G=>G.name===D));C||(C={uniqueId:(0,kD.c)(),name:D,_connectionType:1,connectedPointIds:[]},o.dataOutputs.push(C)),n.connectedPointIds.push(C.uniqueId),C.connectedPointIds.push(n.uniqueId)}}}}const o=G.variables??[];for(let Z=0;Z<o.length;Z++){const N=o[Z],T=N.id;D._userVariables[T]=So(N,G,`/extensions/KHR_interactivity/variables/${Z}`)}return{allBlocks:T,executionContexts:N}}(null===(G=this._loader.aj.extensions)||void 0===G?void 0:G.KHR_interactivity),T=new wN({oe:D});LN.Parse(N,{coordinator:T,pathConverter:this._pathConverter}),T.start()}}k(Jo),x(Jo,!0,(G=>new po(G)));const to="KHR_node_visibility";class Ho{constructor(G){this.name=to,this._loader=G,this.enabled=G.isExtensionUsed(to)}async onReady(){var G;null===(G=this._loader.aj.nodes)||void 0===G||G.forEach((G=>{var D,N,T,o;(null===(D=G._primitiveBabylonMeshes)||void 0===D||D.forEach((G=>{G.inheritVisibility=!0})),null!==(N=G.extensions)&&void 0!==N&&N.KHR_node_visibility)&&(!1===(null===(T=G.extensions)||void 0===T?void 0:T.KHR_node_visibility.visible)&&(G._babylonTransformNode&&(G._babylonTransformNode.isVisible=!1),null===(o=G._primitiveBabylonMeshes)||void 0===o||o.forEach((G=>{G.isVisible=!1}))))}))}dispose(){this._loader=null}}k(to),x(to,!0,(G=>new Ho(G)));const so="ExtrasAsMetadata";class co{_assignExtras(G,D){if(D.extras&&Object.keys(D.extras).length>0){const N=G.metadata=G.metadata||{};(N.aj=N.aj||{}).extras=D.extras}}constructor(G){this.name=so,this.enabled=!0,this._loader=G}dispose(){this._loader=null}loadNodeAsync(G,D,N){return this._loader.loadNodeAsync(G,D,(G=>{this._assignExtras(G,D),N(G)}))}loadCameraAsync(G,D,N){return this._loader.loadCameraAsync(G,D,(G=>{this._assignExtras(G,D),N(G)}))}createMaterial(G,D,N){const T=this._loader.createMaterial(G,D,N);return this._assignExtras(T,D),T}}k(so),x(so,!1,(G=>new co(G)))},11746:(G,D,N)=>{"use strict";N.d(D,{b:()=>J,f:()=>F,j:()=>B,m:()=>S});var T=N(1003),o=N(1223),Z=N(11488),n=N(11378),C=N(11437),P=N(11428),r=N(1105),v=N(1030),q=N(11750),g=N(11753),X=N(11393);class W{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.fe=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.je=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(G){this._environmentTexture=G}getNodes(){let G=[];return G=G.concat(this.meshes),G=G.concat(this.lights),G=G.concat(this.cameras),G=G.concat(this.transformNodes),this.skeletons.forEach((D=>G=G.concat(D.bones))),G}}class j extends W{}class Y{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((G=>{G.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((G=>{G.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((G=>{G.dispose()})),this.animationGroups.length=0}}class y extends W{constructor(G){super(),this._wasAddedToScene=!1,(G=G||v.e.LastCreatedScene)&&(this.oe=G,this.proceduralTextures=[],G.Fd.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=G.getEngine().onContextRestoredObservable.add((()=>{for(const G of this.geometries)G._rebuild();for(const G of this.meshes)G._rebuild();for(const G of this.fe)G.rebuild();for(const G of this.textures)G._rebuild()})))}_topologicalSort(G){const D=new Map;for(const n of G)D.set(n.uniqueId,n);const N={dependsOn:new Map,dependedBy:new Map};for(const n of G){const G=n.uniqueId;N.dependsOn.set(G,new Set),N.dependedBy.set(G,new Set)}for(const n of G){const G=n.uniqueId,T=N.dependsOn.get(G);if(n instanceof q.d){const o=n.sourceMesh;D.has(o.uniqueId)&&(T.add(o.uniqueId),N.dependedBy.get(o.uniqueId).add(G))}const o=N.dependedBy.get(G);for(const Z of n.getDescendants()){const T=Z.uniqueId;if(D.has(T)){o.add(T);N.dependsOn.get(T).add(G)}}}const T=[],o=[];for(const n of G){const G=n.uniqueId;0===N.dependsOn.get(G).size&&(o.push(n),D.delete(G))}const Z=o;for(;Z.length>0;){const G=Z.shift();T.push(G);const o=N.dependedBy.get(G.uniqueId);for(const T of Array.from(o.values())){const o=N.dependsOn.get(T);o.delete(G.uniqueId),0===o.size&&D.get(T)&&(Z.push(D.get(T)),D.delete(T))}}return D.size>0&&(r.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),D.forEach((G=>r.d.Error(G.name)))),T}_addNodeAndDescendantsToList(G,D,N,T){if(N&&(!T||T(N))&&!D.has(N.uniqueId)){G.push(N),D.add(N.uniqueId);for(const o of N.getDescendants(!0))this._addNodeAndDescendantsToList(G,D,o,T)}}_isNodeInContainer(G){return G instanceof P.d&&-1!==this.meshes.indexOf(G)||(G instanceof C.e&&-1!==this.transformNodes.indexOf(G)||(G instanceof g.e&&-1!==this.lights.indexOf(G)||G instanceof X.d&&-1!==this.cameras.indexOf(G)))}_isValidHierarchy(){for(const G of this.meshes)if(G.parent&&!this._isNodeInContainer(G.parent))return r.d.Warn(`Node ${G.name} has a parent that is not in the container.`),!1;for(const G of this.transformNodes)if(G.parent&&!this._isNodeInContainer(G.parent))return r.d.Warn(`Node ${G.name} has a parent that is not in the container.`),!1;for(const G of this.lights)if(G.parent&&!this._isNodeInContainer(G.parent))return r.d.Warn(`Node ${G.name} has a parent that is not in the container.`),!1;for(const G of this.cameras)if(G.parent&&!this._isNodeInContainer(G.parent))return r.d.Warn(`Node ${G.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(G){let D=arguments.length>1&&void 0!==arguments[1]&&arguments[1],N=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||o.f.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const T={},Z={},C=new Y,P=[],r=[],v={doNotInstantiate:!0,...N},q=[],g=new Set;for(const o of this.transformNodes)null===o.parent&&this._addNodeAndDescendantsToList(q,g,o,v.predicate);for(const o of this.meshes)null===o.parent&&this._addNodeAndDescendantsToList(q,g,o,v.predicate);const X=this._topologicalSort(q),W=(N,o)=>{if(((D,N)=>{if(T[D.uniqueId]=N.uniqueId,Z[N.uniqueId]=N,G&&(N.name=G(D.name)),N instanceof n.d){const G=N;if(G.morphTargetManager){const N=D.morphTargetManager;G.morphTargetManager=N.clone();for(let D=0;D<N.numTargets;D++){const o=N.getTarget(D),n=G.morphTargetManager.getTarget(D);T[o.uniqueId]=n.uniqueId,Z[n.uniqueId]=n}}}})(N,o),N.parent){const G=T[N.parent.uniqueId],D=Z[G];o.parent=D||N.parent}if(o.position&&N.position&&o.position.p(N.position),o.rotationQuaternion&&N.rotationQuaternion&&o.rotationQuaternion.p(N.rotationQuaternion),o.rotation&&N.rotation&&o.rotation.p(N.rotation),o.Ed&&N.Ed&&o.Ed.p(N.Ed),o.material){const n=o;if(n.material)if(D){const D=N.material;if(-1===r.indexOf(D)){let N=D.clone(G?G(D.name):"Clone of "+D.name);if(r.push(D),T[D.uniqueId]=N.uniqueId,Z[N.uniqueId]=N,"MultiMaterial"===D.getClassName()){const o=D;for(const D of o.Jg)D&&(N=D.clone(G?G(D.name):"Clone of "+D.name),r.push(D),T[D.uniqueId]=N.uniqueId,Z[N.uniqueId]=N);o.Jg=o.Jg.map((G=>G&&Z[T[G.uniqueId]]))}}"InstancedMesh"!==n.getClassName()&&(n.material=Z[T[D.uniqueId]])}else"MultiMaterial"===n.material.getClassName()?-1===this.oe.multiMaterials.indexOf(n.material)&&this.oe.addMultiMaterial(n.material):-1===this.oe.materials.indexOf(n.material)&&this.oe.addMaterial(n.material)}null===o.parent&&C.rootNodes.push(o)};return X.forEach((G=>{if("InstancedMesh"===G.getClassName()){const D=G,N=D.sourceMesh,o=T[N.uniqueId],n=("number"===typeof o?Z[o]:N).nb(D.name);W(D,n)}else{let D=!0;"mb"===G.getClassName()||"Node"===G.getClassName()||G.skeleton||!G.getTotalVertices||0===G.getTotalVertices()?D=!1:v.doNotInstantiate&&(D="function"===typeof v.doNotInstantiate?!v.doNotInstantiate(G):!v.doNotInstantiate);const N=D?G.nb(`instance of ${G.name}`):G.clone(`Clone of ${G.name}`,null,!0);if(!N)throw new Error(`Could not clone or instantiate node on Asset Container ${G.name}`);W(G,N)}})),this.skeletons.forEach((D=>{if(v.predicate&&!v.predicate(D))return;const N=D.clone(G?G(D.name):"Clone of "+D.name);for(const G of this.meshes)if(G.skeleton===D&&!G.isAnInstance){const D=Z[T[G.uniqueId]];if(!D||D.isAnInstance)continue;if(D.skeleton=N,-1!==P.indexOf(N))continue;P.push(N);for(const G of N.bones)G._linkedTransformNode&&(G._linkedTransformNode=Z[T[G._linkedTransformNode.uniqueId]])}C.skeletons.push(N)})),this.animationGroups.forEach((D=>{if(v.predicate&&!v.predicate(D))return;const N=D.clone(G?G(D.name):"Clone of "+D.name,(G=>Z[T[G.uniqueId]]||G));C.animationGroups.push(N)})),C}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||o.f.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.oe.environmentTexture=this.environmentTexture);for(const G of this.oe._serializableComponents)G.addFromContainer(this);this.oe.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const D=[];this.cameras.forEach((N=>{G&&!G(N)||(this.oe.addCamera(N),D.push(N))})),this.lights.forEach((N=>{G&&!G(N)||(this.oe.addLight(N),D.push(N))})),this.meshes.forEach((N=>{G&&!G(N)||(this.oe.qe(N),D.push(N))})),this.skeletons.forEach((D=>{G&&!G(D)||this.oe.addSkeleton(D)})),this.animations.forEach((D=>{G&&!G(D)||this.oe.addAnimation(D)})),this.animationGroups.forEach((D=>{G&&!G(D)||this.oe.addAnimationGroup(D)})),this.multiMaterials.forEach((D=>{G&&!G(D)||this.oe.addMultiMaterial(D)})),this.materials.forEach((D=>{G&&!G(D)||this.oe.addMaterial(D)})),this.morphTargetManagers.forEach((D=>{G&&!G(D)||this.oe.addMorphTargetManager(D)})),this.geometries.forEach((D=>{G&&!G(D)||this.oe.addGeometry(D)})),this.transformNodes.forEach((N=>{G&&!G(N)||(this.oe.addTransformNode(N),D.push(N))})),this.actionManagers.forEach((D=>{G&&!G(D)||this.oe.addActionManager(D)})),this.textures.forEach((D=>{G&&!G(D)||this.oe.addTexture(D)})),this.reflectionProbes.forEach((D=>{G&&!G(D)||this.oe.addReflectionProbe(D)}));for(const N of D)N.parent&&-1===this.oe.getNodes().indexOf(N.parent)&&(N.setParent?N.setParent(null):N.parent=null)}removeAllFromScene(){this._isValidHierarchy()||o.f.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.oe.environmentTexture&&(this.oe.environmentTexture=null);for(const G of this.oe._serializableComponents)G.removeFromContainer(this)}removeFromScene(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((D=>{G&&!G(D)||this.oe.removeCamera(D)})),this.lights.forEach((D=>{G&&!G(D)||this.oe.removeLight(D)})),this.meshes.forEach((D=>{G&&!G(D)||this.oe.re(D,!0)})),this.skeletons.forEach((D=>{G&&!G(D)||this.oe.removeSkeleton(D)})),this.animations.forEach((D=>{G&&!G(D)||this.oe.removeAnimation(D)})),this.animationGroups.forEach((D=>{G&&!G(D)||this.oe.removeAnimationGroup(D)})),this.multiMaterials.forEach((D=>{G&&!G(D)||this.oe.removeMultiMaterial(D)})),this.materials.forEach((D=>{G&&!G(D)||this.oe.removeMaterial(D)})),this.morphTargetManagers.forEach((D=>{G&&!G(D)||this.oe.removeMorphTargetManager(D)})),this.geometries.forEach((D=>{G&&!G(D)||this.oe.removeGeometry(D)})),this.transformNodes.forEach((D=>{G&&!G(D)||this.oe.removeTransformNode(D)})),this.actionManagers.forEach((D=>{G&&!G(D)||this.oe.removeActionManager(D)})),this.textures.forEach((D=>{G&&!G(D)||this.oe.removeTexture(D)})),this.reflectionProbes.forEach((D=>{G&&!G(D)||this.oe.removeReflectionProbe(D)}))}dispose(){this.cameras.slice(0).forEach((G=>{G.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((G=>{G.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((G=>{G.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((G=>{G.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((G=>{G.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((G=>{G.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((G=>{G.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((G=>{G.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((G=>{G.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((G=>{G.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((G=>{G.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((G=>{G.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((G=>{G.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const G of this.oe._serializableComponents)G.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.oe.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(G,D,N){if(G&&D)for(const T of G){let G=!0;if(N)for(const D of N)if(T===D){G=!1;break}G&&(D.push(T),T._parentContainer=this)}}moveAllFromScene(G){this._wasAddedToScene=!1,void 0===G&&(G=new j);for(const D in this)Object.prototype.hasOwnProperty.call(this,D)&&(this[D]=this[D]||("_environmentTexture"===D?null:[]),this._moveAssets(this.oe[D],this[D],G[D]));this.environmentTexture=this.oe.environmentTexture,this.removeAllFromScene()}createRootMesh(){const G=new n.d("assetContainerRootMesh",this.oe);return this.meshes.forEach((D=>{D.parent||G.addChild(D)})),this.meshes.unshift(G),G}mergeAnimationsTo(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v.e.LastCreatedScene,D=arguments.length>1?arguments[1]:void 0,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!G)return r.d.Error("No scene available to merge animations to"),[];const T=N||(D=>{let N=null;const T=D.animations.length?D.animations[0].targetProperty:"",o=D.name.split(".").join("").split("_primitive")[0];switch(T){case"position":case"rotationQuaternion":N=G.getTransformNodeByName(D.name)||G.getTransformNodeByName(o);break;case"influence":N=G.getMorphTargetByName(D.name)||G.getMorphTargetByName(o);break;default:N=G.getNodeByName(D.name)||G.getNodeByName(o)}return N});this.getNodes().forEach((G=>{const D=T(G);if(null!==D){for(const N of G.animations){const G=D.animations.filter((G=>G.targetProperty===N.targetProperty));for(const N of G){const G=D.animations.indexOf(N,0);G>-1&&D.animations.splice(G,1)}}D.animations=D.animations.concat(G.animations)}}));const o=[];return this.animationGroups.slice().forEach((G=>{o.push(G.clone(G.name,T)),G.animatables.forEach((G=>{G.stop()}))})),D.forEach((D=>{const N=T(D.target);N&&(G.beginAnimation(N,D.fromFrame,D.toFrame,D.loopAnimation,D.speedRatio,D.onAnimationEnd?D.onAnimationEnd:void 0,void 0,!0,void 0,D.onAnimationLoop?D.onAnimationLoop:void 0),G.stopAnimation(D.target))})),o}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((G=>{G.parent||-1!==this.rootNodes.indexOf(G)||this.rootNodes.push(G)})),this.transformNodes.forEach((G=>{G.parent||-1!==this.rootNodes.indexOf(G)||this.rootNodes.push(G)})),this.lights.forEach((G=>{G.parent||-1!==this.rootNodes.indexOf(G)||this.rootNodes.push(G)})),this.cameras.forEach((G=>{G.parent||-1!==this.rootNodes.indexOf(G)||this.rootNodes.push(G)}))}addAllAssetsToContainer(G){if(!G)return;const D=[],N=new Set;for(D.push(G);D.length>0;){const G=D.pop();if(G instanceof n.d?(G.ve&&-1===this.geometries.indexOf(G.ve)&&this.geometries.push(G.ve),this.meshes.push(G)):G instanceof C.e?this.transformNodes.push(G):G instanceof g.e?this.lights.push(G):G instanceof X.d&&this.cameras.push(G),G instanceof P.d){if(G.material&&-1===this.materials.indexOf(G.material)){this.materials.push(G.material);for(const D of G.material.getActiveTextures())-1===this.textures.indexOf(D)&&this.textures.push(D)}G.skeleton&&-1===this.skeletons.indexOf(G.skeleton)&&this.skeletons.push(G.skeleton),G.morphTargetManager&&-1===this.morphTargetManagers.indexOf(G.morphTargetManager)&&this.morphTargetManagers.push(G.morphTargetManager)}for(const T of G.getChildren())N.has(T)||D.push(T);N.add(G)}this.populateRootNodes()}}var h=N(1079);class m{constructor(G){this.byteOffset=0,this.buffer=G}loadAsync(G){return this.buffer.readAsync(this.byteOffset,G).then((G=>{this._dataView=new DataView(G.buffer,G.byteOffset,G.byteLength),this._dataByteOffset=0}))}readUint32(){const G=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,G}readUint8Array(G){const D=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,G);return this._dataByteOffset+=G,this.byteOffset+=G,D}readString(G){return(0,h.e)(this.readUint8Array(G))}skipBytes(G){this._dataByteOffset+=G,this.byteOffset+=G}}var R=N(11759);const L="Z2xURg",w={name:"aj",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:G=>-1!==G.indexOf("asset")&&-1!==G.indexOf("version")||G.startsWith("data:base64,"+L)||G.startsWith("data:;base64,"+L)||G.startsWith("data:application/octet-stream;base64,"+L)||G.startsWith("data:model/gltf-binary;base64,"+L)};var B,F,S,V=N(1055),U=N(1072);function z(G,D,N){try{return Promise.resolve(new Uint8Array(G,D,N))}catch(T){return Promise.reject(T)}}!function(G){G[G.AUTO=0]="AUTO",G[G.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(B||(B={})),function(G){G[G.NONE=0]="NONE",G[G.FIRST=1]="FIRST",G[G.ALL=2]="ALL"}(F||(F={})),function(G){G[G.LOADING=0]="LOADING",G[G.READY=1]="READY",G[G.COMPLETE=2]="COMPLETE"}(S||(S={}));class i{constructor(){this.coordinateSystemMode=B.AUTO,this.animationStartMode=F.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=G=>Promise.resolve(G),this.extensionOptions={}}p(G){G&&(this.onParsed=G.onParsed,this.coordinateSystemMode=G.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=G.animationStartMode??this.animationStartMode,this.loadNodeAnimations=G.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=G.loadSkins??this.loadSkins,this.loadMorphTargets=G.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=G.compileMaterials??this.compileMaterials,this.useClipPlane=G.useClipPlane??this.useClipPlane,this.compileShadowGenerators=G.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=G.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=G.useRangeRequests??this.useRangeRequests,this.createInstances=G.createInstances??this.createInstances,this.alwaysComputeBoundingBox=G.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=G.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=G.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=G.skipMaterials??this.skipMaterials,this.useSRGBBuffers=G.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=G.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=G.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=G.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=G.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=G.customRootNode,this.onMeshLoaded=G.onMeshLoaded,this.onSkinLoaded=G.onSkinLoaded,this.onTextureLoaded=G.onTextureLoaded,this.onMaterialLoaded=G.onMaterialLoaded,this.onCameraLoaded=G.onCameraLoaded,this.extensionOptions=G.extensionOptions??this.extensionOptions)}}class J extends i{constructor(G){super(),this.onParsedObservable=new T.b,this.onMeshLoadedObservable=new T.b,this.onSkinLoadedObservable=new T.b,this.onTextureLoadedObservable=new T.b,this.onMaterialLoadedObservable=new T.b,this.onCameraLoadedObservable=new T.b,this.onCompleteObservable=new T.b,this.onErrorObservable=new T.b,this.Fd=new T.b,this.onExtensionLoadedObservable=new T.b,this.validate=!1,this.onValidatedObservable=new T.b,this._loader=null,this._state=null,this._requests=new Array,this.name=w.name,this.extensions=w.extensions,this.onLoaderStateChangedObservable=new T.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(G)}set onParsed(G){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),G&&(this._onParsedObserver=this.onParsedObservable.add(G))}set onMeshLoaded(G){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),G&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(G))}set onSkinLoaded(G){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),G&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((D=>G(D.node,D.skinnedNode))))}set onTextureLoaded(G){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),G&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(G))}set onMaterialLoaded(G){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),G&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(G))}set onCameraLoaded(G){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),G&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(G))}set onComplete(G){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(G)}set onError(G){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(G)}set onDispose(G){this._onDisposeObserver&&this.Fd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Fd.add(G)}set onExtensionLoaded(G){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(G)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(G){this._loggingEnabled!==G&&(this._loggingEnabled=G,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(G){this._capturePerformanceCounters!==G&&(this._capturePerformanceCounters=G,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(G){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(G)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const G of this._requests)G.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=G=>Promise.resolve(G),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Fd.notifyObservers(void 0),this.Fd.clear()}loadFile(G,D,N,Z,n,C,P,v){if(ArrayBuffer.isView(D))return this._loadBinary(G,D,N,Z,P,v),null;this._progressCallback=n;const q=D.name||o.f.GetFilename(D);if(C){if(this.useRangeRequests){this.validate&&r.d.Warn("glTF validation is not supported when range requests are enabled");const N={abort:()=>{},onCompleteObservable:new T.b},o={readAsync:(N,T)=>new Promise(((o,Z)=>{this._loadFile(G,D,(G=>{o(new Uint8Array(G))}),!0,(G=>{Z(G)}),(G=>{G.setRequestHeader("Range",`bytes=${N}-${N+T-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new m(o)).then((G=>{N.onCompleteObservable.notifyObservers(N),Z(G)}),P?G=>P(void 0,G):void 0),N}return this._loadFile(G,D,(D=>{this._validate(G,new Uint8Array(D,0,D.byteLength),N,q),this._unpackBinaryAsync(new m({readAsync:(G,N)=>z(D,G,N),byteLength:D.byteLength})).then((G=>{Z(G)}),P?G=>P(void 0,G):void 0)}),!0,P)}return this._loadFile(G,D,(D=>{try{this._validate(G,D,N,q),Z({json:this._parseJson(D)})}catch{P&&P()}}),!1,P)}_loadBinary(G,D,N,T,o,Z){this._validate(G,new Uint8Array(D.buffer,D.byteOffset,D.byteLength),N,Z),this._unpackBinaryAsync(new m({readAsync:(G,N)=>function(G,D,N){try{if(D<0||D>=G.byteLength)throw new RangeError("Offset is out of range.");if(D+N>G.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(G.buffer,G.byteOffset+D,N))}catch(T){return Promise.reject(T)}}(D,G,N),byteLength:D.byteLength})).then((G=>{T(G)}),o?G=>o(void 0,G):void 0)}importMeshAsync(G,D,N,T,o,Z){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(N),this.onParsedObservable.clear(),this._log(`Loading ${Z||""}`),this._loader=this._getLoader(N),this._loader.importMeshAsync(G,D,null,N,T,o,Z))))}loadAsync(G,D,N,T,o){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(D),this.onParsedObservable.clear(),this._log(`Loading ${o||""}`),this._loader=this._getLoader(D),this._loader.loadAsync(G,D,N,T,o))))}loadAssetContainerAsync(G,D,N,T,o){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(D),this.onParsedObservable.clear(),this._log(`Loading ${o||""}`),this._loader=this._getLoader(D);const Z=new y(G),n=[];this.onMaterialLoadedObservable.add((G=>{n.push(G)}));const C=[];this.onTextureLoadedObservable.add((G=>{C.push(G)}));const P=[];this.onCameraLoadedObservable.add((G=>{P.push(G)}));const r=[];return this.onMeshLoadedObservable.add((G=>{G.morphTargetManager&&r.push(G.morphTargetManager)})),this._loader.importMeshAsync(null,G,Z,D,N,T,o).then((G=>(Array.prototype.push.apply(Z.geometries,G.geometries),Array.prototype.push.apply(Z.meshes,G.meshes),Array.prototype.push.apply(Z.fe,G.fe),Array.prototype.push.apply(Z.skeletons,G.skeletons),Array.prototype.push.apply(Z.animationGroups,G.animationGroups),Array.prototype.push.apply(Z.materials,n),Array.prototype.push.apply(Z.textures,C),Array.prototype.push.apply(Z.lights,G.lights),Array.prototype.push.apply(Z.transformNodes,G.transformNodes),Array.prototype.push.apply(Z.cameras,P),Array.prototype.push.apply(Z.morphTargetManagers,r),Z)))}))}canDirectLoad(G){return w.canDirectLoad(G)}directLoad(G,D){if(D.startsWith("base64,"+L)||D.startsWith(";base64,"+L)||D.startsWith("application/octet-stream;base64,"+L)||D.startsWith("model/gltf-binary;base64,"+L)){const N=(0,V.c)(D);return this._validate(G,new Uint8Array(N,0,N.byteLength)),this._unpackBinaryAsync(new m({readAsync:(G,D)=>z(N,G,D),byteLength:N.byteLength}))}return this._validate(G,D),Promise.resolve({json:this._parseJson(D)})}createPlugin(G){return new J(G[w.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((G,D)=>{this.onCompleteObservable.addOnce((()=>{G()})),this.onErrorObservable.addOnce((G=>{D(G)}))}))}_setState(G){this._state!==G&&(this._state=G,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(S[this._state]))}_loadFile(G,D,N,T,o,Z){const n=G._loadFile(D,N,(G=>{this._onProgress(G,n)}),!0,T,o,Z);return n.onCompleteObservable.add((()=>{n._lengthComputable=!0,n._total=n._loaded})),this._requests.push(n),n}_onProgress(G,D){if(!this._progressCallback)return;D._lengthComputable=G.lengthComputable,D._loaded=G.loaded,D._total=G.total;let N=!0,T=0,o=0;for(const Z of this._requests){if(void 0===Z._lengthComputable||void 0===Z._loaded||void 0===Z._total)return;N=N&&Z._lengthComputable,T+=Z._loaded,o+=Z._total}this._progressCallback({lengthComputable:N,loaded:T,total:N?o:0})}_validate(G,D){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",T=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),R.b.ValidateAsync(D,N,T,(D=>this.preprocessUrlAsync(N+D).then((D=>G._loadFileAsync(D,void 0,!0,!0).then((G=>new Uint8Array(G,0,G.byteLength))))))).then((G=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(G),this.onValidatedObservable.clear()}),(G=>{this._endPerformanceCounter("Validate JSON"),o.f.Warn(`Failed to validate: ${G.message}`),this.onValidatedObservable.clear()})))}_getLoader(G){const D=G.json.asset||{};this._log(`Asset version: ${D.version}`),D.minVersion&&this._log(`Asset minimum version: ${D.minVersion}`),D.generator&&this._log(`Asset generator: ${D.generator}`);const N=J._parseVersion(D.version);if(!N)throw new Error("Invalid version: "+D.version);if(void 0!==D.minVersion){const G=J._parseVersion(D.minVersion);if(!G)throw new Error("Invalid minimum version: "+D.minVersion);if(J._compareVersion(G,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+D.minVersion)}const T={1:J._CreateGLTF1Loader,2:J._CreateGLTF2Loader}[N.major];if(!T)throw new Error("Unsupported version: "+D.version);return T(this)}_parseJson(G){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${G.length}`);const D=JSON.parse(G);return this._endPerformanceCounter("Parse JSON"),D}_unpackBinaryAsync(G){return this._startPerformanceCounter("Unpack Binary"),G.loadAsync(20).then((()=>{const D=G.readUint32();if(1179937895!==D)throw new U.j("Unexpected magic: "+D,U.g.GLTFLoaderUnexpectedMagicError);const N=G.readUint32();this.loggingEnabled&&this._log(`Binary version: ${N}`);const T=G.readUint32();let o;switch(this.useRangeRequests||T===G.buffer.byteLength||r.d.Warn(`Length in header does not match actual data length: ${T} != ${G.buffer.byteLength}`),N){case 1:o=this._unpackBinaryV1Async(G,T);break;case 2:o=this._unpackBinaryV2Async(G,T);break;default:throw new Error("Unsupported version: "+N)}return this._endPerformanceCounter("Unpack Binary"),o}))}_unpackBinaryV1Async(G,D){const N=G.readUint32(),T=G.readUint32();if(0!==T)throw new Error(`Unexpected content format: ${T}`);const o=D-G.byteOffset,Z={json:this._parseJson(G.readString(N)),bin:null};if(0!==o){const D=G.byteOffset;Z.bin={readAsync:(N,T)=>G.buffer.readAsync(D+N,T),byteLength:o}}return Promise.resolve(Z)}_unpackBinaryV2Async(G,D){const N=1313821514,T=5130562,o=G.readUint32();if(G.readUint32()!==N)throw new Error("First chunk format is not JSON");return G.byteOffset+o===D?G.loadAsync(o).then((()=>({json:this._parseJson(G.readString(o)),bin:null}))):G.loadAsync(o+8).then((()=>{const Z={json:this._parseJson(G.readString(o)),bin:null},n=()=>{const o=G.readUint32();switch(G.readUint32()){case N:throw new Error("Unexpected JSON chunk");case T:{const D=G.byteOffset;Z.bin={readAsync:(N,T)=>G.buffer.readAsync(D+N,T),byteLength:o},G.skipBytes(o);break}default:G.skipBytes(o)}return G.byteOffset!==D?G.loadAsync(8).then(n):Promise.resolve(Z)};return n()}))}static _parseVersion(G){if("1.0"===G||"1.0.1"===G)return{major:1,minor:0};const D=(G+"").match(/^(\d+)\.(\d+)/);return D?{major:parseInt(D[1]),minor:parseInt(D[2])}:null}static _compareVersion(G,D){return G.major>D.major?1:G.major<D.major?-1:G.minor>D.minor?1:G.minor<D.minor?-1:0}_logOpen(G){this._log(G),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(G){const D=J._logSpaces.substring(0,2*this._logIndentLevel);r.d.Log(`${D}${G}`)}_logDisabled(G){}_startPerformanceCounterEnabled(G){o.f.StartPerformanceCounter(G)}_startPerformanceCounterDisabled(G){}_endPerformanceCounterEnabled(G){o.f.EndPerformanceCounter(G)}_endPerformanceCounterDisabled(G){}}J.IncrementalLoading=!0,J.HomogeneousCoordinates=!1,J._logSpaces="                                ",(0,Z.h)(new J)},11759:(G,D,N)=>{"use strict";N.d(D,{b:()=>n});var T=N(1223);function o(G,D,N,T){const o={externalResourceFunction:T};return N&&(o.uri="file:"===D?N:D+N),ArrayBuffer.isView(G)?GLTFValidator.validateBytes(G,o):GLTFValidator.validateString(G,o)}function Z(){const G=[];onmessage=D=>{const N=D.data;switch(N.id){case"init":importScripts(N.url);break;case"validate":o(N.data,N.rootUrl,N.fileName,(D=>new Promise(((N,T)=>{const o=G.length;G.push({resolve:N,reject:T}),postMessage({id:"getExternalResource",index:o,uri:D})})))).then((G=>{postMessage({id:"validate.resolve",value:G})}),(G=>{postMessage({id:"validate.reject",reason:G})}));break;case"getExternalResource.resolve":G[N.index].resolve(N.value);break;case"getExternalResource.reject":G[N.index].reject(N.reason)}}}class n{static ValidateAsync(G,D,N,n){return"function"===typeof Worker?new Promise(((C,P)=>{const r=`${o}(${Z})()`,v=URL.createObjectURL(new Blob([r],{type:"application/javascript"})),q=new Worker(v),g=G=>{q.removeEventListener("error",g),q.removeEventListener("message",X),P(G)},X=G=>{const D=G.data;switch(D.id){case"getExternalResource":n(D.uri).then((G=>{q.postMessage({id:"getExternalResource.resolve",index:D.index,value:G},[G.buffer])}),(G=>{q.postMessage({id:"getExternalResource.reject",index:D.index,reason:G})}));break;case"validate.resolve":q.removeEventListener("error",g),q.removeEventListener("message",X),C(D.value),q.terminate();break;case"validate.reject":q.removeEventListener("error",g),q.removeEventListener("message",X),P(D.reason),q.terminate()}};if(q.addEventListener("error",g),q.addEventListener("message",X),q.postMessage({id:"init",url:T.f.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(G)){const T=G.slice();q.postMessage({id:"validate",data:T,rootUrl:D,fileName:N},[T.buffer])}else q.postMessage({id:"validate",data:G,rootUrl:D,fileName:N})})):(this._LoadScriptPromise||(this._LoadScriptPromise=T.f.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>o(G,D,N,n))))}}n.Configuration={url:`${T.f._DefaultCdnUrl}/gltf_validator.js`}},12073:(G,D,N)=>{"use strict";N.d(D,{e:()=>B});var T=N(980),o=N(985),Z=N(1181),n=N(1009),C=N(1385),P=N(1387),r=N(1255),v=N(1218),q=N(1018),g=N(1133);N(10916),N(10755),N(10922),N(10693),N(10930),N(10962),N(10964);const X="imageProcessingCompatibility",W="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";g.d.IncludesShadersStore[X]=W;const j="skyPixelShader",Y="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";g.d.ShadersStore[j]=Y;N(10728),N(10736),N(10814),N(10838),N(10817);const y="skyVertexShader",h="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";g.d.ShadersStore[y]=h;var m=N(1395),R=N(1380),L=N(1374);class w extends C.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class B extends P.d{constructor(G,D){super(G,D),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new n.s(0,100,0),this.useSunPosition=!1,this.cameraOffset=n.s.Zero(),this.up=n.s.Up(),this.dithering=!1,this._cameraPosition=n.s.Zero(),this._skyOrientation=new n.g}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(G,D){const N=D._drawWrapper;if(this.isFrozen&&N.effect&&N._wasPreviouslyReady)return!0;D.materialDefines||(D.materialDefines=new w);const T=D.materialDefines,o=this.va();if(this._isReadyForSubMesh(D))return!0;if((0,L.T)(G,o,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,T),(0,L.K)(G,T,!0,!1),T.IMAGEPROCESSINGPOSTPROCESS!==o.imageProcessingConfiguration.applyByPostProcess&&T.markAsMiscDirty(),T.DITHER!==this.dithering&&T.markAsMiscDirty(),T.isDirty){T.markAsProcessed(),o.resetCachedMaterial();const G=new m.e;T.FOG&&G.addFallback(1,"FOG"),T.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess,T.DITHER=this.dithering;const N=[r.f.PositionKind];T.VERTEXCOLOR&&N.push(r.f.ColorKind);const Z="sky",n=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,R.e)(n);const C=T.toString();D.setEffect(o.getEngine().createEffect(Z,N,n,[],C,G,this.onCompiled,this.onError),T,this._materialContext)}return!(!D.effect||!D.effect.isReady())&&(T._renderId=o.getRenderId(),N._wasPreviouslyReady=!0,!0)}bindForSubMesh(G,D,N){const T=this.va(),o=N.materialDefines;if(!o)return;const Z=N.effect;if(!Z)return;this._activeEffect=Z,this.bindOnlyWorldMatrix(G),this._activeEffect.setMatrix("viewProjection",T.getTransformMatrix()),this._mustRebind(T,Z,N)&&((0,R.g)(Z,this,T),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,L.k)(o,Z,T)),T.fogEnabled&&D.applyFog&&T.fogMode!==v.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",T.getViewMatrix()),(0,L.f)(T,D,this._activeEffect);const C=T.activeCamera;if(C){const G=C.getWorldMatrix();this._cameraPosition.x=G.m[12],this._cameraPosition.y=G.m[13],this._cameraPosition.z=G.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const G=Math.PI*(this.inclination-.5),D=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(D)*Math.cos(G),this.sunPosition.y=this.distance*Math.sin(-G),this.sunPosition.z=this.distance*Math.sin(D)*Math.cos(G),n.g.FromUnitVectorsToRef(n.s.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(D,this._activeEffect,N)}getAnimatables(){return[]}dispose(G){super.dispose(G)}clone(G){return Z.e.Clone((()=>new B(G,this.va())),this)}serialize(){const G=super.serialize();return G.customType="BABYLON.SkyMaterial",G}getClassName(){return"SkyMaterial"}static Parse(G,D,N){return Z.e.Parse((()=>new B(G.name,D)),G,D,N)}}(0,T.c)([(0,o.S)()],B.prototype,"luminance",void 0),(0,T.c)([(0,o.S)()],B.prototype,"turbidity",void 0),(0,T.c)([(0,o.S)()],B.prototype,"rayleigh",void 0),(0,T.c)([(0,o.S)()],B.prototype,"mieCoefficient",void 0),(0,T.c)([(0,o.S)()],B.prototype,"mieDirectionalG",void 0),(0,T.c)([(0,o.S)()],B.prototype,"distance",void 0),(0,T.c)([(0,o.S)()],B.prototype,"inclination",void 0),(0,T.c)([(0,o.S)()],B.prototype,"azimuth",void 0),(0,T.c)([(0,o.O)()],B.prototype,"sunPosition",void 0),(0,T.c)([(0,o.S)()],B.prototype,"useSunPosition",void 0),(0,T.c)([(0,o.O)()],B.prototype,"cameraOffset",void 0),(0,T.c)([(0,o.O)()],B.prototype,"up",void 0),(0,T.c)([(0,o.S)()],B.prototype,"dithering",void 0),(0,q.h)("BABYLON.SkyMaterial",B)},11090:(G,D,N)=>{"use strict";function T(G,D){D.headers=G.headers||{},D.statusMessage=G.statusText,D.statusCode=G.status,D.data=G.response}function o(G,D,N){return new Promise((function(o,Z){N=N||{};var n,C,P,r=new XMLHttpRequest,v=N.body,q=N.headers||{};for(n in N.timeout&&(r.timeout=N.timeout),r.ontimeout=r.onerror=function(G){G.timeout="timeout"==G.type,Z(G)},r.open(G,D.href||D),r.onload=function(){for(P=r.getAllResponseHeaders().trim().split(/[\r\n]+/),T(r,r);C=P.shift();)C=C.split(": "),r.headers[C.shift().toLowerCase()]=C.join(": ");if((C=r.headers["content-type"])&&~C.indexOf("application/json"))try{r.data=JSON.parse(r.data,N.reviver)}catch(G){return T(r,G),Z(G)}(r.status>=400?Z:o)(r)},typeof FormData<"u"&&v instanceof FormData||v&&"object"==typeof v&&(q["content-type"]="application/json",v=JSON.stringify(v)),r.withCredentials=!!N.withCredentials,q)r.setRequestHeader(n,q[n]);r.send(v)}))}N.r(D),N.d(D,{del:()=>P,get:()=>Z,patch:()=>C,post:()=>n,put:()=>r,send:()=>o});var Z=o.bind(o,"GET"),n=o.bind(o,"POST"),C=o.bind(o,"PATCH"),P=o.bind(o,"DELETE"),r=o.bind(o,"PUT")},12187:(G,D,N)=>{"use strict";N.d(D,{c:()=>q});const T=.5*(Math.sqrt(3)-1),o=(3-Math.sqrt(3))/6,Z=1/3,n=1/6,C=(Math.sqrt(5)-1)/4,P=(5-Math.sqrt(5))/20,r=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),v=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const q=class{constructor(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const D="function"==typeof G?G:function(G){let D=0,N=0,T=0,o=1;const Z=function(){let G=4022871197;return function(D){D=D.toString();for(let N=0;N<D.length;N++){G+=D.charCodeAt(N);let T=.02519603282416938*G;G=T>>>0,T-=G,T*=G,G=T>>>0,T-=G,G+=4294967296*T}return 2.3283064365386963e-10*(G>>>0)}}();D=Z(" "),N=Z(" "),T=Z(" "),D-=Z(G),D<0&&(D+=1);N-=Z(G),N<0&&(N+=1);T-=Z(G),T<0&&(T+=1);return function(){const G=2091639*D+2.3283064365386963e-10*o;return D=N,N=T,T=G-(o=0|G)}}(G);this.p=function(G){const D=new Uint8Array(256);for(let N=0;N<256;N++)D[N]=N;for(let N=0;N<255;N++){const T=N+~~(G()*(256-N)),o=D[N];D[N]=D[T],D[T]=o}return D}(D),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let N=0;N<512;N++)this.perm[N]=this.p[255&N],this.permMod12[N]=this.perm[N]%12}noise2D(G,D){const N=this.permMod12,Z=this.perm;let n=0,C=0,P=0;const v=(G+D)*T,q=Math.floor(G+v),g=Math.floor(D+v),X=(q+g)*o,W=G-(q-X),j=D-(g-X);let Y,y;W>j?(Y=1,y=0):(Y=0,y=1);const h=W-Y+o,m=j-y+o,R=W-1+2*o,L=j-1+2*o,w=255&q,B=255&g;let F=.5-W*W-j*j;if(F>=0){const G=3*N[w+Z[B]];F*=F,n=F*F*(r[G]*W+r[G+1]*j)}let S=.5-h*h-m*m;if(S>=0){const G=3*N[w+Y+Z[B+y]];S*=S,C=S*S*(r[G]*h+r[G+1]*m)}let V=.5-R*R-L*L;if(V>=0){const G=3*N[w+1+Z[B+1]];V*=V,P=V*V*(r[G]*R+r[G+1]*L)}return 70*(n+C+P)}noise3D(G,D,N){const T=this.permMod12,o=this.perm;let C,P,v,q;const g=(G+D+N)*Z,X=Math.floor(G+g),W=Math.floor(D+g),j=Math.floor(N+g),Y=(X+W+j)*n,y=G-(X-Y),h=D-(W-Y),m=N-(j-Y);let R,L,w,B,F,S;y>=h?h>=m?(R=1,L=0,w=0,B=1,F=1,S=0):y>=m?(R=1,L=0,w=0,B=1,F=0,S=1):(R=0,L=0,w=1,B=1,F=0,S=1):h<m?(R=0,L=0,w=1,B=0,F=1,S=1):y<m?(R=0,L=1,w=0,B=0,F=1,S=1):(R=0,L=1,w=0,B=1,F=1,S=0);const V=y-R+n,U=h-L+n,z=m-w+n,i=y-B+2*n,J=h-F+2*n,p=m-S+2*n,t=y-1+.5,H=h-1+.5,s=m-1+.5,c=255&X,K=255&W,b=255&j;let O=.6-y*y-h*h-m*m;if(O<0)C=0;else{const G=3*T[c+o[K+o[b]]];O*=O,C=O*O*(r[G]*y+r[G+1]*h+r[G+2]*m)}let Q=.6-V*V-U*U-z*z;if(Q<0)P=0;else{const G=3*T[c+R+o[K+L+o[b+w]]];Q*=Q,P=Q*Q*(r[G]*V+r[G+1]*U+r[G+2]*z)}let A=.6-i*i-J*J-p*p;if(A<0)v=0;else{const G=3*T[c+B+o[K+F+o[b+S]]];A*=A,v=A*A*(r[G]*i+r[G+1]*J+r[G+2]*p)}let I=.6-t*t-H*H-s*s;if(I<0)q=0;else{const G=3*T[c+1+o[K+1+o[b+1]]];I*=I,q=I*I*(r[G]*t+r[G+1]*H+r[G+2]*s)}return 32*(C+P+v+q)}noise4D(G,D,N,T){const o=this.perm;let Z,n,r,q,g;const X=(G+D+N+T)*C,W=Math.floor(G+X),j=Math.floor(D+X),Y=Math.floor(N+X),y=Math.floor(T+X),h=(W+j+Y+y)*P,m=G-(W-h),R=D-(j-h),L=N-(Y-h),w=T-(y-h);let B=0,F=0,S=0,V=0;m>R?B++:F++,m>L?B++:S++,m>w?B++:V++,R>L?F++:S++,R>w?F++:V++,L>w?S++:V++;const U=B>=3?1:0,z=F>=3?1:0,i=S>=3?1:0,J=V>=3?1:0,p=B>=2?1:0,t=F>=2?1:0,H=S>=2?1:0,s=V>=2?1:0,c=B>=1?1:0,K=F>=1?1:0,b=S>=1?1:0,O=V>=1?1:0,Q=m-U+P,A=R-z+P,I=L-i+P,d=w-J+P,u=m-p+2*P,l=R-t+2*P,x=L-H+2*P,k=w-s+2*P,a=m-c+3*P,E=R-K+3*P,M=L-b+3*P,e=w-O+3*P,f=m-1+4*P,GG=R-1+4*P,DG=L-1+4*P,NG=w-1+4*P,TG=255&W,oG=255&j,ZG=255&Y,nG=255&y;let CG=.6-m*m-R*R-L*L-w*w;if(CG<0)Z=0;else{const G=o[TG+o[oG+o[ZG+o[nG]]]]%32*4;CG*=CG,Z=CG*CG*(v[G]*m+v[G+1]*R+v[G+2]*L+v[G+3]*w)}let PG=.6-Q*Q-A*A-I*I-d*d;if(PG<0)n=0;else{const G=o[TG+U+o[oG+z+o[ZG+i+o[nG+J]]]]%32*4;PG*=PG,n=PG*PG*(v[G]*Q+v[G+1]*A+v[G+2]*I+v[G+3]*d)}let rG=.6-u*u-l*l-x*x-k*k;if(rG<0)r=0;else{const G=o[TG+p+o[oG+t+o[ZG+H+o[nG+s]]]]%32*4;rG*=rG,r=rG*rG*(v[G]*u+v[G+1]*l+v[G+2]*x+v[G+3]*k)}let vG=.6-a*a-E*E-M*M-e*e;if(vG<0)q=0;else{const G=o[TG+c+o[oG+K+o[ZG+b+o[nG+O]]]]%32*4;vG*=vG,q=vG*vG*(v[G]*a+v[G+1]*E+v[G+2]*M+v[G+3]*e)}let qG=.6-f*f-GG*GG-DG*DG-NG*NG;if(qG<0)g=0;else{const G=o[TG+1+o[oG+1+o[ZG+1+o[nG+1]]]]%32*4;qG*=qG,g=qG*qG*(v[G]*f+v[G+1]*GG+v[G+2]*DG+v[G+3]*NG)}return 27*(Z+n+r+q+g)}}}}]);