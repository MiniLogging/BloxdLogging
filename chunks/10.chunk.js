"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[10],{2436:(R,x,H)=>{H.d(x,{b:()=>i,d:()=>b,e:()=>a,g:()=>X});var k=H(485),c=H(661),t=H(681),A=H(2274),D=H(590),U=H(2319),J=(H(2445),H(2336)),V=H(493);H(2489),H(2498),H(2503);const n="image/png",g=2,I=[134,22,135,150,246,214,150,54];function i(R){const x=new DataView(R.buffer,R.byteOffset,R.byteLength);let H=0;for(let A=0;A<I.length;A++)if(x.getUint8(H++)!==I[A])return V.c.Error("Not a babylon environment map"),null;let k="",c=0;for(;c=x.getUint8(H++);)k+=String.fromCharCode(c);let t=JSON.parse(k);return t=q(t),t.binaryDataPosition=H,t.pj&&(t.pj.lodGenerationScale=t.pj.lodGenerationScale||.8),t}function q(R){if(R.version>g)throw new Error(`Unsupported babylon environment map version "${R.version}". Latest supported version is "${g}".`);return 2===R.version?R:R={...R,version:2,imageType:n}}function S(R,x){const H=(x=q(x)).pj;let k=Math.log2(x.width);if(k=Math.round(k)+1,H.mipmaps.length!==6*k)throw new Error(`Unsupported specular mipmaps number "${H.mipmaps.length}"`);const c=new Array(k);for(let t=0;t<k;t++){c[t]=new Array(6);for(let k=0;k<6;k++){const A=H.mipmaps[6*t+k];c[t][k]=new Uint8Array(R.buffer,R.byteOffset+x.binaryDataPosition+A.position,A.length)}}return c}function L(R,x){var H;x=q(x);const k=new Array(6),c=null===(H=x.irradiance)||void 0===H?void 0:H.irradianceTexture;if(c){if(6!==c.faces.length)throw new Error(`Incorrect irradiance texture faces number "${c.faces.length}"`);for(let H=0;H<6;H++){const t=c.faces[H];k[H]=new Uint8Array(R.buffer,R.byteOffset+x.binaryDataPosition+t.position,t.length)}}return k}function b(R,x,H){var k;const t=(H=q(H)).pj;if(!t)return Promise.resolve([]);R._lodGenerationScale=t.lodGenerationScale;const A=[],D=S(x,H);A.push(F(R,D,H.imageType));const U=null===(k=H.irradiance)||void 0===k?void 0:k.irradianceTexture;if(U){var J,V;const k=L(x,H);let t=null;null!==(J=H.irradiance)&&void 0!==J&&null!==(V=J.irradianceTexture)&&void 0!==V&&V.dominantDirection&&(t=c.o.zi(H.irradiance.irradianceTexture.dominantDirection)),A.push(d(R,k,U.size,H.imageType,t))}return Promise.all(A)}async function C(R,x,H,k,c,t,A,D,U,J,V){return await new Promise(((n,g)=>{if(H){const H=x.createTexture(null,!0,!0,null,1,null,(R=>{g(R)}),R);null===k||void 0===k||k.onEffectCreatedObservable.addOnce((D=>{D.executeWhenCompiled((()=>{k.externalTextureSamplerBinding=!0,k.onApply=k=>{k._bindTexture("textureSampler",H),k.setFloat2("scale",1,x._features.needsInvertingBitmap&&R instanceof ImageBitmap?-1:1)},x.scenes.length&&(x.scenes[0].postProcessManager.directRender([k],J,!0,t,A),x.restoreDefaultFramebuffer(),H.dispose(),URL.revokeObjectURL(c),n())}))}))}else{if(x._uploadImageToTexture(V,R,t,A),D){const H=U[A];H&&x._uploadImageToTexture(H._texture,R,t,0)}n()}}))}async function F(R,x){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n;const k=R.getEngine();R.format=5,R.type=0,R.generateMipMaps=!0,R._cachedAnisotropicFilteringLevel=null,k.updateTextureSamplingMode(3,R),await P(R,x,!0,H),R.isReady=!0}async function d(R,x,H){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const t=R.getEngine(),A=new D.b(t,5),J=new U.e(t,A);R._irradianceTexture=J,J._dominantDirection=c,A.isCube=!0,A.format=5,A.type=0,A.generateMipMaps=!0,A._cachedAnisotropicFilteringLevel=null,A.generateMipMaps=!0,A.width=H,A.height=H,t.updateTextureSamplingMode(3,A),await P(A,[x],!1,k),t.generateMipMapsForCubemap(A),A.isReady=!0}async function P(R,x,c){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;if(!k.e.IsExponentOfTwo(R.width))throw new Error("Texture size must be a power of two");const V=(0,t.ILog2)(R.width)+1,g=R.getEngine();let I=!1,i=!1,q=null,S=null,L=null;const b=g.getCaps();b.textureLOD?g._features.supportRenderAndCopyToLodForFloatTextures?b.textureHalfFloatRender&&b.textureHalfFloatLinearFiltering?(I=!0,R.type=2):b.textureFloatRender&&b.textureFloatLinearFiltering&&(I=!0,R.type=1):I=!1:(I=!1,i=c);let F=0;if(I)g.isWebGPU?(F=1,await H.e(36).then(H.bind(H,13822))):await H.e(29).then(H.bind(H,13829)),q=new J.b("rgbdDecode","rgbdDecode",null,null,1,null,3,g,!1,void 0,R.type,void 0,null,!1,void 0,F),R._isRGBD=!1,R.invertY=!1,S=g.createRenderTargetCubeTexture(R.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:R.type,format:5});else if(R._isRGBD=!0,R.invertY=!0,i){const x=3;L={};const H=R._lodGenerationScale,k=R._lodGenerationOffset;for(let c=0;c<x;c++){const t=(V-1)*H+k,A=k+(t-k)*(1-c/(x-1)),J=Math.round(Math.min(Math.max(A,0),t)),n=new D.b(g,2);n.isCube=!0,n.invertY=!0,n.generateMipMaps=!1,g.updateTextureSamplingMode(2,n);const I=new U.e(null);switch(I._isCube=!0,I._texture=n,L[J]=I,c){case 0:R._lodTextureLow=I;break;case 1:R._lodTextureMid=I;break;case 2:R._lodTextureHigh=I}}}const d=[];for(let H=0;H<x.length;H++)for(let k=0;k<6;k++){const c=x[H][k],t=new Blob([c],{type:A}),D=URL.createObjectURL(t);let U;if(g._features.forceBitmapOverHTMLImageElement)U=g.createImageBitmap(t,{premultiplyAlpha:"none"}).then((async x=>await C(x,g,I,q,D,k,H,i,L,S,R)));else{const x=new Image;x.src=D,U=new Promise(((c,t)=>{x.onload=()=>{C(x,g,I,q,D,k,H,i,L,S,R).then((()=>c())).catch((R=>{t(R)}))},x.onerror=R=>{t(R)}}))}d.push(U)}if(await Promise.all(d),x.length<V){let H;const k=Math.pow(2,V-1-x.length),c=k*k*4;switch(R.type){case 0:H=new Uint8Array(c);break;case 2:H=new Uint16Array(c);break;case 1:H=new Float32Array(c)}for(let t=x.length;t<V;t++)for(let x=0;x<6;x++){var P;g._uploadArrayBufferViewToTexture((null===(P=S)||void 0===P?void 0:P.texture)||R,H,x,t)}}if(S){const x=R._irradianceTexture;R._irradianceTexture=null,g._releaseTexture(R),S._swapAndDie(R),R._irradianceTexture=x}q&&q.dispose(),i&&(R._lodTextureHigh&&R._lodTextureHigh._texture&&(R._lodTextureHigh._texture.isReady=!0),R._lodTextureMid&&R._lodTextureMid._texture&&(R._lodTextureMid._texture.isReady=!0),R._lodTextureLow&&R._lodTextureLow._texture&&(R._lodTextureLow._texture.isReady=!0))}function a(R,x){const H=(x=q(x)).irradiance;if(!H)return;const k=new A.e;c.o.FromArrayToRef(H.x,0,k.x),c.o.FromArrayToRef(H.y,0,k.y),c.o.FromArrayToRef(H.z,0,k.z),c.o.FromArrayToRef(H.xx,0,k.xx),c.o.FromArrayToRef(H.yy,0,k.yy),c.o.FromArrayToRef(H.zz,0,k.zz),c.o.FromArrayToRef(H.yz,0,k.yz),c.o.FromArrayToRef(H.zx,0,k.zx),c.o.FromArrayToRef(H.xy,0,k.xy),R._sphericalPolynomial=k}function X(R,x,H,k,c){const t=F(R.getEngine().createRawCubeTexture(null,R.width,R.format,R.type,R.generateMipMaps,R.invertY,R.samplingMode,R._compression),x).then((()=>R));return R.onRebuildCallback=R=>({proxy:t,isReady:!0,isAsync:!0}),R._source=13,R._bufferViewArrayArray=x,R._lodGenerationScale=k,R._lodGenerationOffset=c,R._sphericalPolynomial=H,F(R,x).then((()=>(R.isReady=!0,R)))}}}]);