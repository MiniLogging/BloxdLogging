/*! For license information please see yjotl.10.569cf4b1.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[10],{12152:(R,N,q)=>{"use strict";var w=q(12158),u=q(12167),M=q(12170);q.g.__TYPEDARRAY_POOL||(q.g.__TYPEDARRAY_POOL={UINT8:u([32,0]),UINT16:u([32,0]),UINT32:u([32,0]),INT8:u([32,0]),INT16:u([32,0]),INT32:u([32,0]),FLOAT:u([32,0]),DOUBLE:u([32,0]),DATA:u([32,0]),UINT8C:u([32,0]),BUFFER:u([32,0])});var v="undefined"!==typeof Uint8ClampedArray,G=q.g.__TYPEDARRAY_POOL;G.UINT8C||(G.UINT8C=u([32,0])),G.BUFFER||(G.BUFFER=u([32,0]));var J=G.DATA,y=G.BUFFER;function a(R){if(R){var N=R.length||R.byteLength,q=w.log2(N);J[q].push(R)}}function j(R){R=w.nextPow2(R);var N=w.log2(R),q=J[N];return q.length>0?q.pop():new ArrayBuffer(R)}function F(R){return new Uint8Array(j(R),0,R)}function S(R){return new Uint16Array(j(2*R),0,R)}function H(R){return new Uint32Array(j(4*R),0,R)}function W(R){return new Int8Array(j(R),0,R)}function k(R){return new Int16Array(j(2*R),0,R)}function C(R){return new Int32Array(j(4*R),0,R)}function e(R){return new Float32Array(j(4*R),0,R)}function K(R){return new Float64Array(j(8*R),0,R)}function r(R){return v?new Uint8ClampedArray(j(R),0,R):F(R)}function Z(R){return new DataView(j(R),0,R)}N.free=function(R){if(M(R))y[w.log2(R.length)].push(R);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(R)&&(R=R.buffer),!R)return;var N=R.length||R.byteLength,q=0|w.log2(N);J[q].push(R)}},N.freeUint8=N.freeUint16=N.freeUint32=N.freeInt8=N.freeInt16=N.freeInt32=N.freeFloat32=N.freeFloat=N.freeFloat64=N.freeDouble=N.freeUint8Clamped=N.freeDataView=function(R){a(R.buffer)},N.freeArrayBuffer=a,N.freeBuffer=function(R){y[w.log2(R.length)].push(R)},N.malloc=function(R,N){if(void 0===N||"arraybuffer"===N)return j(R);switch(N){case"uint8":return F(R);case"uint16":return S(R);case"uint32":return H(R);case"int8":return W(R);case"int16":return k(R);case"int32":return C(R);case"float":case"float32":return e(R);case"double":case"float64":return K(R);case"uint8_clamped":return r(R);case"buffer":throw"Buffer not supported";case"data":case"dataview":return Z(R);default:return null}return null},N.mallocArrayBuffer=j,N.mallocUint8=F,N.mallocUint16=S,N.mallocUint32=H,N.mallocInt8=W,N.mallocInt16=k,N.mallocInt32=C,N.mallocFloat32=N.mallocFloat=e,N.mallocFloat64=N.mallocDouble=K,N.mallocUint8Clamped=r,N.mallocDataView=Z,N.clearCache=function(){for(var R=0;R<32;++R)G.UINT8[R].length=0,G.UINT16[R].length=0,G.UINT32[R].length=0,G.INT8[R].length=0,G.INT16[R].length=0,G.INT32[R].length=0,G.FLOAT[R].length=0,G.DOUBLE[R].length=0,G.UINT8C[R].length=0,J[R].length=0,y[R].length=0}},12255:(R,N,q)=>{R.exports=u;var w=q(11707);function u(R,N){if(!(this instanceof u))return new u(R,N);var q=w.create();w.add(q,R,N),this.Hd=w.min(w.create(),R,q),this.Fh=w.clone(N),this.max=w.max(w.create(),R,q),this.mag=w.length(this.Fh)}var M=u.prototype;M.width=function(){return this.Fh[0]},M.height=function(){return this.Fh[1]},M.depth=function(){return this.Fh[2]},M.x0=function(){return this.Hd[0]},M.y0=function(){return this.Hd[1]},M.z0=function(){return this.Hd[2]},M.x1=function(){return this.max[0]},M.y1=function(){return this.max[1]},M.z1=function(){return this.max[2]},M.translate=function(R){return w.add(this.max,this.max,R),w.add(this.Hd,this.Hd,R),this},M.setPosition=function(R){return w.add(this.max,R,this.Fh),w.j(this.Hd,R),this},M.expand=function(R){var N=w.create(),q=w.create();return w.max(N,R.max,this.max),w.min(q,R.Hd,this.Hd),w.Vc(N,N,q),new u(q,N)},M.intersects=function(R){return!(R.Hd[0]>this.max[0])&&(!(R.Hd[1]>this.max[1])&&(!(R.Hd[2]>this.max[2])&&(!(R.max[0]<this.Hd[0])&&(!(R.max[1]<this.Hd[1])&&!(R.max[2]<this.Hd[2])))))},M.touches=function(R){var N=this.union(R);return null!==N&&(0==N.width()||0==N.height()||0==N.depth())},M.union=function(R){if(!this.intersects(R))return null;var N=Math.max(R.Hd[0],this.Hd[0]),q=Math.max(R.Hd[1],this.Hd[1]),w=Math.max(R.Hd[2],this.Hd[2]);return new u([N,q,w],[Math.min(R.max[0],this.max[0])-N,Math.min(R.max[1],this.max[1])-q,Math.min(R.max[2],this.max[2])-w])}},12158:(R,N)=>{"use strict";function q(R){var N=32;return(R&=-R)&&N--,65535&R&&(N-=16),16711935&R&&(N-=8),252645135&R&&(N-=4),858993459&R&&(N-=2),1431655765&R&&(N-=1),N}N.INT_BITS=32,N.INT_MAX=2147483647,N.INT_MIN=-1<<31,N.sign=function(R){return(R>0)-(R<0)},N.abs=function(R){var N=R>>31;return(R^N)-N},N.min=function(R,N){return N^(R^N)&-(R<N)},N.max=function(R,N){return R^(R^N)&-(R<N)},N.isPow2=function(R){return!(R&R-1)&&!!R},N.log2=function(R){var N,q;return N=(R>65535)<<4,N|=q=((R>>>=N)>255)<<3,N|=q=((R>>>=q)>15)<<2,(N|=q=((R>>>=q)>3)<<1)|(R>>>=q)>>1},N.log10=function(R){return R>=1e9?9:R>=1e8?8:R>=1e7?7:R>=1e6?6:R>=1e5?5:R>=1e4?4:R>=1e3?3:R>=100?2:R>=10?1:0},N.popCount=function(R){return 16843009*((R=(858993459&(R-=R>>>1&1431655765))+(R>>>2&858993459))+(R>>>4)&252645135)>>>24},N.countTrailingZeros=q,N.nextPow2=function(R){return R+=0===R,--R,R|=R>>>1,R|=R>>>2,R|=R>>>4,R|=R>>>8,(R|=R>>>16)+1},N.prevPow2=function(R){return R|=R>>>1,R|=R>>>2,R|=R>>>4,R|=R>>>8,(R|=R>>>16)-(R>>>1)},N.parity=function(R){return R^=R>>>16,R^=R>>>8,R^=R>>>4,27030>>>(R&=15)&1};var w=new Array(256);!function(R){for(var N=0;N<256;++N){var q=N,w=N,u=7;for(q>>>=1;q;q>>>=1)w<<=1,w|=1&q,--u;R[N]=w<<u&255}}(w),N.reverse=function(R){return w[255&R]<<24|w[R>>>8&255]<<16|w[R>>>16&255]<<8|w[R>>>24&255]},N.interleave2=function(R,N){return(R=1431655765&((R=858993459&((R=252645135&((R=16711935&((R&=65535)|R<<8))|R<<4))|R<<2))|R<<1))|(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N&=65535)|N<<8))|N<<4))|N<<2))|N<<1))<<1},N.deinterleave2=function(R,N){return(R=65535&((R=16711935&((R=252645135&((R=858993459&((R=R>>>N&1431655765)|R>>>1))|R>>>2))|R>>>4))|R>>>16))<<16>>16},N.interleave3=function(R,N,q){return R=1227133513&((R=3272356035&((R=251719695&((R=4278190335&((R&=1023)|R<<16))|R<<8))|R<<4))|R<<2),(R|=(N=1227133513&((N=3272356035&((N=251719695&((N=4278190335&((N&=1023)|N<<16))|N<<8))|N<<4))|N<<2))<<1)|(q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2))<<2},N.deinterleave3=function(R,N){return(R=1023&((R=4278190335&((R=251719695&((R=3272356035&((R=R>>>N&1227133513)|R>>>2))|R>>>4))|R>>>8))|R>>>16))<<22>>22},N.nextCombination=function(R){var N=R|R-1;return N+1|(~N&-~N)-1>>>q(R)+1}},12143:(R,N,q)=>{"use strict";R.exports=function(R,N,q){switch(arguments.length){case 1:return w=[],y(u=R,u,a,!0),w;case 2:return"function"===typeof N?y(R,R,N,!0):function(R,N){return w=[],y(R,N,a,!1),w}(R,N);case 3:return y(R,N,q,!1);default:throw new Error("box-intersect: Invalid arguments")}var u};var w,u=q(12152),M=q(12175),v=q(12189);function G(R,N){for(var q=0;q<R;++q)if(!(N[q]<=N[q+R]))return!0;return!1}function J(R,N,q,w){for(var u=0,M=0,v=0,J=R.length;v<J;++v){var y=R[v];if(!G(N,y)){for(var a=0;a<2*N;++a)q[u++]=y[a];w[M++]=v}}return M}function y(R,N,q,w){var G=R.length,y=N.length;if(!(G<=0||y<=0)){var a=R[0].length>>>1;if(!(a<=0)){var j,F=u.mallocDouble(2*a*G),S=u.mallocInt32(G);if((G=J(R,a,F,S))>0){if(1===a&&w)M.init(G),j=M.sweepComplete(a,q,0,G,F,S,0,G,F,S);else{var H=u.mallocDouble(2*a*y),W=u.mallocInt32(y);(y=J(N,a,H,W))>0&&(M.init(G+y),j=1===a?M.sweepBipartite(a,q,0,G,F,S,0,y,H,W):v(a,q,w,G,F,S,y,H,W),u.free(H),u.free(W))}u.free(F),u.free(S)}return j}}}function a(R,N){w.push([R,N])}},12194:(R,N)=>{"use strict";var q="d",w="ax",u="fp",M="es",v="rs",G="re",J="rb",y="bs",a="be",j="bb",F=[q,w,"vv",v,G,J,"ri",y,a,j,"bi"];function S(R){var N="bruteForce"+(R?"Full":"Partial"),w=[],v=F.slice();R||v.splice(3,0,u);var G=["function "+N+"("+v.join()+"){"];function J(N,u){var v=function(R,N,w){var u="bruteForce"+(R?"Red":"Blue")+(N?"Flip":"")+(w?"Full":""),v=["function ",u,"(",F.join(),"){","var ",M,"=2*",q,";"],G="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",J="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(w?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return R?v.push(G,"Q",":",J):v.push(J,"Q",":",G),w?v.push("if(y1<x0||x1<y0)continue;"):N?v.push("if(y0<=x0||x1<y0)continue;"):v.push("if(y0<x0||x1<y0)continue;"),v.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),N?v.push("yi,xi"):v.push("xi,yi"),v.push(");if(rv!==void 0)return rv;}}}"),{name:u,code:v.join("")}}(N,u,R);w.push(v.code),G.push("return "+v.name+"("+F.join()+");")}G.push("if(re-rs>be-bs){"),R?(J(!0,!1),G.push("}else{"),J(!1,!1)):(G.push("if(fp){"),J(!0,!0),G.push("}else{"),J(!0,!1),G.push("}}else{if(fp){"),J(!1,!0),G.push("}else{"),J(!1,!1),G.push("}")),G.push("}}return "+N);var y=w.join("")+G.join("");return new Function(y)()}N.partial=S(!1),N.full=S(!0)},12189:(R,N,q)=>{"use strict";R.exports=function(R,N,q,M,a,s,O,L,m){!function(R,N){var q=8*u.log2(N+1)*(R+1)|0,M=u.nextPow2(r*q);z.length<M&&(w.free(z),z=w.mallocInt32(M));var v=u.nextPow2(Z*q);d.length<v&&(w.free(d),d=w.mallocDouble(v))}(R,M+O);var o,A=0,n=2*R;x(A++,0,0,M,0,O,q?16:0,-1/0,1/0),q||x(A++,0,0,O,0,M,1,-1/0,1/0);for(;A>0;){var Q=(A-=1)*r,Y=z[Q],T=z[Q+1],f=z[Q+2],c=z[Q+3],b=z[Q+4],I=z[Q+5],V=A*Z,t=d[V],i=d[V+1],g=1&I,U=!!(16&I),B=a,l=s,X=L,h=m;if(g&&(B=L,l=m,X=a,h=s),!(2&I&&T>=(f=k(R,Y,T,f,B,l,i)))&&!(4&I&&(T=C(R,Y,T,f,B,l,t))>=f)){var D=f-T,p=b-c;if(U){if(R*D*(D+p)<S){if(void 0!==(o=J.scanComplete(R,Y,N,T,f,B,l,c,b,X,h)))return o;continue}}else{if(R*Math.min(D,p)<j){if(void 0!==(o=v(R,Y,N,g,T,f,B,l,c,b,X,h)))return o;continue}if(R*D*p<F){if(void 0!==(o=J.scanBipartite(R,Y,N,g,T,f,B,l,c,b,X,h)))return o;continue}}var RR=H(R,Y,T,f,B,l,t,i);if(T<RR)if(R*(RR-T)<j){if(void 0!==(o=G(R,Y+1,N,T,RR,B,l,c,b,X,h)))return o}else if(Y===R-2){if(void 0!==(o=g?J.sweepBipartite(R,N,c,b,X,h,T,RR,B,l):J.sweepBipartite(R,N,T,RR,B,l,c,b,X,h)))return o}else x(A++,Y+1,T,RR,c,b,g,-1/0,1/0),x(A++,Y+1,c,b,T,RR,1^g,-1/0,1/0);if(RR<f){var NR=y(R,Y,c,b,X,h),qR=X[n*NR+Y],wR=W(R,Y,NR,b,X,h,qR);if(wR<b&&x(A++,Y,RR,f,wR,b,(4|g)+(U?16:0),qR,i),c<NR&&x(A++,Y,RR,f,c,NR,(2|g)+(U?16:0),t,qR),NR+1===wR){if(void 0!==(o=U?P(R,Y,N,RR,f,B,l,NR,X,h[NR]):E(R,Y,N,g,RR,f,B,l,NR,X,h[NR])))return o}else if(NR<wR){var uR;if(U){if(RR<(uR=e(R,Y,RR,f,B,l,qR))){var MR=W(R,Y,RR,uR,B,l,qR);if(Y===R-2){if(RR<MR&&void 0!==(o=J.sweepComplete(R,N,RR,MR,B,l,NR,wR,X,h)))return o;if(MR<uR&&void 0!==(o=J.sweepBipartite(R,N,MR,uR,B,l,NR,wR,X,h)))return o}else RR<MR&&x(A++,Y+1,RR,MR,NR,wR,16,-1/0,1/0),MR<uR&&(x(A++,Y+1,MR,uR,NR,wR,0,-1/0,1/0),x(A++,Y+1,NR,wR,MR,uR,1,-1/0,1/0))}}else RR<(uR=g?K(R,Y,RR,f,B,l,qR):e(R,Y,RR,f,B,l,qR))&&(Y===R-2?o=g?J.sweepBipartite(R,N,NR,wR,X,h,RR,uR,B,l):J.sweepBipartite(R,N,RR,uR,B,l,NR,wR,X,h):(x(A++,Y+1,RR,uR,NR,wR,g,-1/0,1/0),x(A++,Y+1,NR,wR,RR,uR,1^g,-1/0,1/0)))}}}}};var w=q(12152),u=q(12158),M=q(12194),v=M.partial,G=M.full,J=q(12175),y=q(12196),a=q(12203),j=128,F=1<<22,S=1<<22,H=a("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),W=a("lo===p0",["p0"]),k=a("lo<p0",["p0"]),C=a("hi<=p0",["p0"]),e=a("lo<=p0&&p0<=hi",["p0"]),K=a("lo<p0&&p0<=hi",["p0"]),r=6,Z=2,z=w.mallocInt32(1024),d=w.mallocDouble(1024);function x(R,N,q,w,u,M,v,G,J){var y=r*R;z[y]=N,z[y+1]=q,z[y+2]=w,z[y+3]=u,z[y+4]=M,z[y+5]=v;var a=Z*R;d[a]=G,d[a+1]=J}function E(R,N,q,w,u,M,v,G,J,y,a){var j=2*R,F=J*j,S=y[F+N];R:for(var H=u,W=u*j;H<M;++H,W+=j){var k=v[W+N],C=v[W+N+R];if(!(S<k||C<S)&&(!w||S!==k)){for(var e,K=G[H],r=N+1;r<R;++r){k=v[W+r],C=v[W+r+R];var Z=y[F+r],z=y[F+r+R];if(C<Z||z<k)continue R}if(void 0!==(e=w?q(a,K):q(K,a)))return e}}}function P(R,N,q,w,u,M,v,G,J,y){var a=2*R,j=G*a,F=J[j+N];R:for(var S=w,H=w*a;S<u;++S,H+=a){var W=v[S];if(W!==y){var k=M[H+N],C=M[H+N+R];if(!(F<k||C<F)){for(var e=N+1;e<R;++e){k=M[H+e],C=M[H+e+R];var K=J[j+e],r=J[j+e+R];if(C<K||r<k)continue R}var Z=q(W,y);if(void 0!==Z)return Z}}}}},12196:(R,N,q)=>{"use strict";R.exports=function(R,N,q,v,G,J){if(v<=q+1)return q;var y=q,a=v,j=v+q>>>1,F=2*R,S=j,H=G[F*j+N];for(;y<a;){if(a-y<u){M(R,N,y,a,G,J),H=G[F*j+N];break}var W=a-y,k=Math.random()*W+y|0,C=G[F*k+N],e=Math.random()*W+y|0,K=G[F*e+N],r=Math.random()*W+y|0,Z=G[F*r+N];C<=K?Z>=K?(S=e,H=K):C>=Z?(S=k,H=C):(S=r,H=Z):K>=Z?(S=e,H=K):Z>=C?(S=k,H=C):(S=r,H=Z);for(var z=F*(a-1),d=F*S,x=0;x<F;++x,++z,++d){var E=G[z];G[z]=G[d],G[d]=E}var P=J[a-1];J[a-1]=J[S],J[S]=P;for(z=F*(a-1),d=F*(S=w(R,N,y,a-1,G,J,H)),x=0;x<F;++x,++z,++d){E=G[z];G[z]=G[d],G[d]=E}P=J[a-1];if(J[a-1]=J[S],J[S]=P,j<S){for(a=S-1;y<a&&G[F*(a-1)+N]===H;)a-=1;a+=1}else{if(!(S<j))break;for(y=S+1;y<a&&G[F*y+N]===H;)y+=1}}return w(R,N,q,j,G,J,G[F*j+N])};var w=q(12203)("lo<p0",["p0"]),u=8;function M(R,N,q,w,u,M){for(var v=2*R,G=v*(q+1)+N,J=q+1;J<w;++J,G+=v)for(var y=u[G],a=J,j=v*(J-1);a>q&&u[j+N]>y;--a,j-=v){for(var F=j,S=j+v,H=0;H<v;++H,++F,++S){var W=u[F];u[F]=u[S],u[S]=W}var k=M[a];M[a]=M[a-1],M[a-1]=k}}},12203:R=>{"use strict";R.exports=function(R,q){var w="abcdef".split("").concat(q),u=[];R.indexOf("lo")>=0&&u.push("lo=e[k+n]");R.indexOf("hi")>=0&&u.push("hi=e[k+o]");return w.push(N.replace("_",u.join()).replace("$",R)),Function.apply(void 0,w)};var N="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12181:R=>{"use strict";R.exports=function(R,w){w<=4*N?q(0,w-1,R):y(0,w-1,R)};var N=32;function q(R,N,q){for(var w=2*(R+1),u=R+1;u<=N;++u){for(var M=q[w++],v=q[w++],G=u,J=w-2;G-- >R;){var y=q[J-2],a=q[J-1];if(y<M)break;if(y===M&&a<v)break;q[J]=y,q[J+1]=a,J-=2}q[J]=M,q[J+1]=v}}function w(R,N,q){N*=2;var w=q[R*=2],u=q[R+1];q[R]=q[N],q[R+1]=q[N+1],q[N]=w,q[N+1]=u}function u(R,N,q){N*=2,q[R*=2]=q[N],q[R+1]=q[N+1]}function M(R,N,q,w){N*=2,q*=2;var u=w[R*=2],M=w[R+1];w[R]=w[N],w[R+1]=w[N+1],w[N]=w[q],w[N+1]=w[q+1],w[q]=u,w[q+1]=M}function v(R,N,q,w,u){N*=2,u[R*=2]=u[N],u[N]=q,u[R+1]=u[N+1],u[N+1]=w}function G(R,N,q){N*=2;var w=q[R*=2],u=q[N];return!(w<u)&&(w!==u||q[R+1]>q[N+1])}function J(R,N,q,w){var u=w[R*=2];return u<N||u===N&&w[R+1]<q}function y(R,a,j){var F=(a-R+1)/6|0,S=R+F,H=a-F,W=R+a>>1,k=W-F,C=W+F,e=S,K=k,r=W,Z=C,z=H,d=R+1,x=a-1,E=0;G(e,K,j)&&(E=e,e=K,K=E),G(Z,z,j)&&(E=Z,Z=z,z=E),G(e,r,j)&&(E=e,e=r,r=E),G(K,r,j)&&(E=K,K=r,r=E),G(e,Z,j)&&(E=e,e=Z,Z=E),G(r,Z,j)&&(E=r,r=Z,Z=E),G(K,z,j)&&(E=K,K=z,z=E),G(K,r,j)&&(E=K,K=r,r=E),G(Z,z,j)&&(E=Z,Z=z,z=E);for(var P=j[2*K],s=j[2*K+1],O=j[2*Z],L=j[2*Z+1],m=2*e,o=2*r,A=2*z,n=2*S,Q=2*W,Y=2*H,T=0;T<2;++T){var f=j[m+T],c=j[o+T],b=j[A+T];j[n+T]=f,j[Q+T]=c,j[Y+T]=b}u(k,R,j),u(C,a,j);for(var I=d;I<=x;++I)if(J(I,P,s,j))I!==d&&w(I,d,j),++d;else if(!J(I,O,L,j))for(;;){if(J(x,O,L,j)){J(x,P,s,j)?(M(I,d,x,j),++d,--x):(w(I,x,j),--x);break}if(--x<I)break}v(R,d-1,P,s,j),v(a,x+1,O,L,j),d-2-R<=N?q(R,d-2,j):y(R,d-2,j),a-(x+2)<=N?q(x+2,a,j):y(x+2,a,j),x-d<=N?q(d,x,j):y(d,x,j)}},12175:(R,N,q)=>{"use strict";R.exports={init:function(R){var N=u.nextPow2(R);J.length<N&&(w.free(J),J=w.mallocInt32(N));y.length<N&&(w.free(y),y=w.mallocInt32(N));a.length<N&&(w.free(a),a=w.mallocInt32(N));j.length<N&&(w.free(j),j=w.mallocInt32(N));F.length<N&&(w.free(F),F=w.mallocInt32(N));S.length<N&&(w.free(S),S=w.mallocInt32(N));var q=8*N;H.length<q&&(w.free(H),H=w.mallocDouble(q))},sweepBipartite:function(R,N,q,w,u,G,F,S,C,e){for(var K=0,r=2*R,Z=R-1,z=r-1,d=q;d<w;++d){var x=G[d],E=r*d;H[K++]=u[E+Z],H[K++]=-(x+1),H[K++]=u[E+z],H[K++]=x}for(d=F;d<S;++d){x=e[d]+v;var P=r*d;H[K++]=C[P+Z],H[K++]=-x,H[K++]=C[P+z],H[K++]=x}var s=K>>>1;M(H,s);var O=0,L=0;for(d=0;d<s;++d){var m=0|H[2*d+1];if(m>=v)W(a,j,L--,m=m-v|0);else if(m>=0)W(J,y,O--,m);else if(m<=-v){m=-m-v|0;for(var o=0;o<O;++o){if(void 0!==(A=N(J[o],m)))return A}k(a,j,L++,m)}else{m=-m-1|0;for(o=0;o<L;++o){var A;if(void 0!==(A=N(m,a[o])))return A}k(J,y,O++,m)}}},sweepComplete:function(R,N,q,w,u,v,G,C,e,K){for(var r=0,Z=2*R,z=R-1,d=Z-1,x=q;x<w;++x){var E=v[x]+1<<1,P=Z*x;H[r++]=u[P+z],H[r++]=-E,H[r++]=u[P+d],H[r++]=E}for(x=G;x<C;++x){E=K[x]+1<<1;var s=Z*x;H[r++]=e[s+z],H[r++]=1|-E,H[r++]=e[s+d],H[r++]=1|E}var O=r>>>1;M(H,O);var L=0,m=0,o=0;for(x=0;x<O;++x){var A=0|H[2*x+1],n=1&A;if(x<O-1&&A>>1===H[2*x+3]>>1&&(n=2,x+=1),A<0){for(var Q=-(A>>1)-1,Y=0;Y<o;++Y){if(void 0!==(T=N(F[Y],Q)))return T}if(0!==n)for(Y=0;Y<L;++Y){if(void 0!==(T=N(J[Y],Q)))return T}if(1!==n)for(Y=0;Y<m;++Y){var T;if(void 0!==(T=N(a[Y],Q)))return T}0===n?k(J,y,L++,Q):1===n?k(a,j,m++,Q):2===n&&k(F,S,o++,Q)}else{Q=(A>>1)-1;0===n?W(J,y,L--,Q):1===n?W(a,j,m--,Q):2===n&&W(F,S,o--,Q)}}},scanBipartite:function(R,N,q,w,u,G,a,j,F,S,C,e){var K=0,r=2*R,Z=N,z=N+R,d=1,x=1;w?x=v:d=v;for(var E=u;E<G;++E){var P=E+d,s=r*E;H[K++]=a[s+Z],H[K++]=-P,H[K++]=a[s+z],H[K++]=P}for(E=F;E<S;++E){P=E+x;var O=r*E;H[K++]=C[O+Z],H[K++]=-P}var L=K>>>1;M(H,L);var m=0;for(E=0;E<L;++E){var o=0|H[2*E+1];if(o<0){var A=!1;if((P=-o)>=v?(A=!w,P-=v):(A=!!w,P-=1),A)k(J,y,m++,P);else{var n=e[P],Q=r*P,Y=C[Q+N+1],T=C[Q+N+1+R];R:for(var f=0;f<m;++f){var c=J[f],b=r*c;if(!(T<a[b+N+1]||a[b+N+1+R]<Y)){for(var I=N+2;I<R;++I)if(C[Q+I+R]<a[b+I]||a[b+I+R]<C[Q+I])continue R;var V,t=j[c];if(void 0!==(V=w?q(n,t):q(t,n)))return V}}}}else W(J,y,m--,o-d)}},scanComplete:function(R,N,q,w,u,G,y,a,j,F,S){for(var W=0,k=2*R,C=N,e=N+R,K=w;K<u;++K){var r=K+v,Z=k*K;H[W++]=G[Z+C],H[W++]=-r,H[W++]=G[Z+e],H[W++]=r}for(K=a;K<j;++K){r=K+1;var z=k*K;H[W++]=F[z+C],H[W++]=-r}var d=W>>>1;M(H,d);var x=0;for(K=0;K<d;++K){var E=0|H[2*K+1];if(E<0){if((r=-E)>=v)J[x++]=r-v;else{var P=S[r-=1],s=k*r,O=F[s+N+1],L=F[s+N+1+R];R:for(var m=0;m<x;++m){var o=J[m],A=y[o];if(A===P)break;var n=k*o;if(!(L<G[n+N+1]||G[n+N+1+R]<O)){for(var Q=N+2;Q<R;++Q)if(F[s+Q+R]<G[n+Q]||G[n+Q+R]<F[s+Q])continue R;var Y=q(A,P);if(void 0!==Y)return Y}}}}else{for(r=E-v,m=x-1;m>=0;--m)if(J[m]===r){for(Q=m+1;Q<x;++Q)J[Q-1]=J[Q];break}--x}}}};var w=q(12152),u=q(12158),M=q(12181),v=1<<28,G=1024,J=w.mallocInt32(G),y=w.mallocInt32(G),a=w.mallocInt32(G),j=w.mallocInt32(G),F=w.mallocInt32(G),S=w.mallocInt32(G),H=w.mallocDouble(8192);function W(R,N,q,w){var u=N[w],M=R[q-1];R[u]=M,N[M]=u}function k(R,N,q,w){R[q]=w,N[w]=q}},12167:R=>{"use strict";function N(R,q,w){var u=0|R[w];if(u<=0)return[];var M,v=new Array(u);if(w===R.length-1)for(M=0;M<u;++M)v[M]=q;else for(M=0;M<u;++M)v[M]=N(R,q,w+1);return v}R.exports=function(R,q){switch("undefined"===typeof q&&(q=0),typeof R){case"number":if(R>0)return function(R,N){var q,w;for(q=new Array(R),w=0;w<R;++w)q[w]=N;return q}(0|R,q);break;case"object":if("number"===typeof R.length)return N(R,q,0)}return[]}},12124:(R,N,q)=>{R.exports=function(){var R=this;this.components={},this.comps=this.components;var N=this.components,q=1,u={},M=[],v=[],G={timeout:!1,removals:[],multiComps:[]};function J(R,q){var w=N[q],M=u[q],v=M.hash[R];v&&(M.remove(R),w.ab&&(w.multi?(v.forEach((N=>{N&&w.ab(R,N)})),v.length=0):w.ab(R,v)),G.removals.push(M),y())}function y(){G.timeout||(G.timeout=!0,setTimeout(a,1))}function a(){G.timeout=!1,j()}function j(){G.multiComps.length&&function(R){for(var N=0;N<R.length;N++){var{entID:q,data:w}=R[N],u=w.hash[q];if(u){for(var M=0;M<u.length;M++)u[M]||(u.splice(M,1),M--);0===u.length&&(w.remove(q),G.removals.push(w))}}R.length=0}(G.multiComps),G.removals.length&&function(R){for(var N=0;N<R.length;N++){R[N].flush()}R.length=0}(G.removals)}this.Pi=u,this._systems=M,this._renderSystems=v,this.Ih=function(N){var w=q++;return Array.isArray(N)&&N.forEach((N=>R.yf(w,N))),w},this.deleteEntity=function(N){return Object.keys(u).forEach((R=>{u[R].hash[N]&&J(N,R)})),R},this.Vh=function(R){if(!R)throw new Error("Missing component definition");var q=R.name;if(!q)throw new Error("Component definition must have a name property.");if("string"!==typeof q)throw new Error("Component name must be a string.");if(""===q)throw new Error("Component name must be a non-empty string.");if(u[q])throw new Error(`Component ${q} already exists.`);var G={};return G.name=q,G.multi=!!R.multi,G.order=isNaN(R.order)?99:R.order,G.stateConstructor=R.stateConstructor||null,G.state=R.state||{},G.Mf=R.Mf||null,G.ab=R.ab||null,G.system=R.system||null,G.bh=R.bh||null,N[q]=G,u[q]=new w,u[q]._pendingMultiCleanup=!1,u[q]._multiCleanupIDs=G.multi?[]:null,G.system&&(M.push(q),M.sort(((R,q)=>N[R].order-N[q].order))),G.bh&&(v.push(q),v.sort(((R,q)=>N[R].order-N[q].order))),q},this.overwriteComponent=function(R,q){var w=N[R];if(!w)throw new Error(`Unknown component: ${R}`);if(!q)throw new Error("Missing component definition");if(w.name!==q.name)throw new Error("Overwriting component must use the same name property.");var G={};G.name=R,G.multi=!!q.multi,G.order=isNaN(q.order)?99:q.order,G.state=q.state||{},G.Mf=q.Mf||null,G.ab=q.ab||null,G.system=q.system||null,G.bh=q.bh||null,N[R]=G,u[R]._pendingMultiCleanup=!1,u[R]._multiCleanupIDs=G.multi?[]:null;var J=M.indexOf(R);G.system&&J<0&&M.push(R),!G.system&&J>=0&&M.splice(J,1),M.sort(((R,q)=>N[R].order-N[q].order));var y=v.indexOf(R);G.bh&&y<0&&v.push(R),!G.bh&&y>=0&&v.splice(y,1),v.sort(((R,q)=>N[R].order-N[q].order));var a=G.state;return this.gh(R).forEach((R=>{for(var N in a)N in R||(R[N]=a[N]);G.Mf&&G.Mf(R._g,R)})),R},this.deleteComponent=function(q){var w=u[q];if(!w)throw new Error(`Unknown component: ${q}`);w.flush(),w.list.forEach((R=>{R&&J(R._g||R[0]._g,q)}));var G=M.indexOf(q),y=v.indexOf(q);return G>-1&&M.splice(G,1),y>-1&&v.splice(y,1),u[q].dispose(),delete u[q],delete N[q],R},this.yf=function(R,q,w){var M,v=N[q],G=u[q];if(!G)throw new Error(`Unknown component: ${q}.`);if(G.hash[R]&&!v.multi)throw new Error(`Entity ${R} already has component: ${q}.`);if(v.stateConstructor){if(!(M=new v.stateConstructor).hasOwnProperty("_g"))throw new Error(`Component ${v.name} stateConstructor type does not have property __id`)}else M=Object.assign({},{_g:R},v.state,w);if(M._g=R,v.multi){var J=G.hash[R];J||(J=[],G.add(R,J)),J.push(M)}else G.add(R,M);return v.Mf&&v.Mf(R,M),this},this.Wf=function(R,N){var q=u[N];if(!q)throw new Error(`Unknown component: ${N}.`);return!!q.hash[R]},this.Ef=function(N,q){if(!u[q])throw new Error(`Unknown component: ${q}.`);return J(N,q),R},this.getState=function(R,N){var q=u[N];if(!q)throw new Error(`Unknown component: ${N}.`);return q.hash[R]},this.gh=function(R){var N=u[R];if(!N)throw new Error(`Unknown component: ${R}.`);return j(),N.list},this.wk=function(R){if(!u[R])throw new Error(`Unknown component: ${R}.`);var N=u[R].hash;return R=>N[R]},this.zk=function(R){if(!u[R])throw new Error(`Unknown component: ${R}.`);var N=u[R].hash;return R=>!!N[R]},this.cf=function(q){j();for(var w=0;w<M.length;w++){var v=M[w],G=N[v],J=u[v];G.system(q,J.list),j()}return R},this.render=function(q){j();for(var w=0;w<v.length;w++){var M=v[w],G=N[M],J=u[M];G.bh(q,J.list),j()}return R},this.removeMultiComponent=function(q,w,M){var v=N[w],J=u[w];if(!J)throw new Error(`Unknown component: ${w}.`);if(!v.multi)throw new Error("removeMultiComponent called on non-multi component");return function(R,N,q,w){var u=q.hash[R];if(u){var M=u[w];M&&(u[w]=null,N.ab&&N.ab(R,M),G.multiComps.push({entID:R,data:q}),y())}}(q,v,J,M),R}};var w=q(12126)},12126:R=>{function N(R,N){var q=R._map[N];if(delete R.hash[N],delete R._map[N],q===R.list.length-1)R.list.pop();else{var w=R.list.pop();if(R.list[q]=w,null===w||null===w[0]){var u=R.list.length;for(var M in R._map)if(R._map[M]===u)return void(R._map[M]=q)}else{var v=w._g||w[0]._g;R._map[v]=q}}}R.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(R,N){if("number"===typeof this._map[R]){var q=this._map[R];this.hash[R]=N,this.list[q]=N}else this._map[R]=this.list.length,this.hash[R]=N,this.list.push(N)}remove(R){var N=this._map[R];this.hash[R]=null,this.list[N]=null,this._pendingRemovals.push(R)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var R=0;R<this._pendingRemovals.length;R++){var q=this._pendingRemovals[R];null===this.hash[q]&&N(this,q)}this._pendingRemovals.length=0}}},12098:R=>{"use strict";var N,q="object"===typeof Reflect?Reflect:null,w=function(R,N,q){return Function.prototype.apply.call(R,N,q)};N=q&&"function"===typeof q.ownKeys?q.ownKeys:Object.getOwnPropertySymbols?function(R){return Object.getOwnPropertyNames(R).concat(Object.getOwnPropertySymbols(R))}:function(R){return Object.getOwnPropertyNames(R)};var u=Number.isNaN||function(R){return R!==R};function M(){M.init.call(this)}R.exports=M,R.exports.once=function(R,N){return new Promise((function(q,w){function u(q){R.removeListener(N,M),w(q)}function M(){"function"===typeof R.removeListener&&R.removeListener("error",u),q([].slice.call(arguments))}W(R,N,M,{once:!0}),"error"!==N&&function(R,N,q){"function"===typeof R.on&&W(R,"error",N,q)}(R,u,{once:!0})}))},M.EventEmitter=M,M.prototype._events=void 0,M.prototype._eventsCount=0,M.prototype._maxListeners=void 0;var v=10;function G(R){if("function"!==typeof R)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof R)}function J(R){return void 0===R._maxListeners?M.defaultMaxListeners:R._maxListeners}function y(R,N,q,w){var u,M,v,y;if(G(q),void 0===(M=R._events)?(M=R._events=Object.create(null),R._eventsCount=0):(void 0!==M.newListener&&(R.emit("newListener",N,q.listener?q.listener:q),M=R._events),v=M[N]),void 0===v)v=M[N]=q,++R._eventsCount;else if("function"===typeof v?v=M[N]=w?[q,v]:[v,q]:w?v.unshift(q):v.push(q),(u=J(R))>0&&v.length>u&&!v.warned){v.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+v.length+" "+String(N)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.k=R,a.type=N,a.count=v.length,y=a,console&&console.warn&&console.warn(y)}return R}function a(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function j(R,N,q){var w={fired:!1,wrapFn:void 0,target:R,type:N,listener:q},u=a.bind(w);return u.listener=q,w.wrapFn=u,u}function F(R,N,q){var w=R._events;if(void 0===w)return[];var u=w[N];return void 0===u?[]:"function"===typeof u?q?[u.listener||u]:[u]:q?function(R){for(var N=new Array(R.length),q=0;q<N.length;++q)N[q]=R[q].listener||R[q];return N}(u):H(u,u.length)}function S(R){var N=this._events;if(void 0!==N){var q=N[R];if("function"===typeof q)return 1;if(void 0!==q)return q.length}return 0}function H(R,N){for(var q=new Array(N),w=0;w<N;++w)q[w]=R[w];return q}function W(R,N,q,w){if("function"===typeof R.on)w.once?R.once(N,q):R.on(N,q);else{if("function"!==typeof R.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof R);R.addEventListener(N,(function u(M){w.once&&R.removeEventListener(N,u),q(M)}))}}Object.defineProperty(M,"defaultMaxListeners",{enumerable:!0,get:function(){return v},set:function(R){if("number"!==typeof R||R<0||u(R))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+R+".");v=R}}),M.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},M.prototype.setMaxListeners=function(R){if("number"!==typeof R||R<0||u(R))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+R+".");return this._maxListeners=R,this},M.prototype.getMaxListeners=function(){return J(this)},M.prototype.emit=function(R){for(var N=[],q=1;q<arguments.length;q++)N.push(arguments[q]);var u="error"===R,M=this._events;if(void 0!==M)u=u&&void 0===M.error;else if(!u)return!1;if(u){var v;if(N.length>0&&(v=N[0]),v instanceof Error)throw v;var G=new Error("Unhandled error."+(v?" ("+v.message+")":""));throw G.context=v,G}var J=M[R];if(void 0===J)return!1;if("function"===typeof J)w(J,this,N);else{var y=J.length,a=H(J,y);for(q=0;q<y;++q)w(a[q],this,N)}return!0},M.prototype.addListener=function(R,N){return y(this,R,N,!1)},M.prototype.on=M.prototype.addListener,M.prototype.prependListener=function(R,N){return y(this,R,N,!0)},M.prototype.once=function(R,N){return G(N),this.on(R,j(this,R,N)),this},M.prototype.prependOnceListener=function(R,N){return G(N),this.prependListener(R,j(this,R,N)),this},M.prototype.removeListener=function(R,N){var q,w,u,M,v;if(G(N),void 0===(w=this._events))return this;if(void 0===(q=w[R]))return this;if(q===N||q.listener===N)0===--this._eventsCount?this._events=Object.create(null):(delete w[R],w.removeListener&&this.emit("removeListener",R,q.listener||N));else if("function"!==typeof q){for(u=-1,M=q.length-1;M>=0;M--)if(q[M]===N||q[M].listener===N){v=q[M].listener,u=M;break}if(u<0)return this;0===u?q.shift():function(R,N){for(;N+1<R.length;N++)R[N]=R[N+1];R.pop()}(q,u),1===q.length&&(w[R]=q[0]),void 0!==w.removeListener&&this.emit("removeListener",R,v||N)}return this},M.prototype.off=M.prototype.removeListener,M.prototype.removeAllListeners=function(R){var N,q,w;if(void 0===(q=this._events))return this;if(void 0===q.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==q[R]&&(0===--this._eventsCount?this._events=Object.create(null):delete q[R]),this;if(0===arguments.length){var u,M=Object.keys(q);for(w=0;w<M.length;++w)"removeListener"!==(u=M[w])&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(N=q[R]))this.removeListener(R,N);else if(void 0!==N)for(w=N.length-1;w>=0;w--)this.removeListener(R,N[w]);return this},M.prototype.listeners=function(R){return F(this,R,!0)},M.prototype.rawListeners=function(R){return F(this,R,!1)},M.listenerCount=function(R,N){return"function"===typeof R.listenerCount?R.listenerCount(N):S.call(R,N)},M.prototype.listenerCount=S,M.prototype.eventNames=function(){return this._eventsCount>0?N(this._events):[]}},12394:R=>{"use strict";R.exports=function(R,N,q,w,u,M){var v=+N[0],G=+N[1],J=+N[2],y=+q[0],a=+q[1],j=+q[2],F=Math.sqrt(y*y+a*a+j*j);if(0===F)throw new Error("Can't raycast along a zero vector");return function(R,N,q,w,u,M,v,G,J,y){for(var a=0,j=Math.floor,F=0|j(N),S=0|j(q),H=0|j(w),W=u>0?1:-1,k=M>0?1:-1,C=v>0?1:-1,e=Math.abs(1/u),K=Math.abs(1/M),r=Math.abs(1/v),Z=e<1/0?e*(W>0?F+1-N:N-F):1/0,z=K<1/0?K*(k>0?S+1-q:q-S):1/0,d=r<1/0?r*(C>0?H+1-w:w-H):1/0,x=-1;a<=G;){var E=R(F,S,H);if(E)return J&&(J[0]=N+a*u,J[1]=q+a*M,J[2]=w+a*v),y&&(y[0]=y[1]=y[2]=0,0===x&&(y[0]=-W),1===x&&(y[1]=-k),2===x&&(y[2]=-C)),E;Z<z?Z<d?(F+=W,a=Z,Z+=e,x=0):(H+=C,a=d,d+=r,x=2):z<d?(S+=k,a=z,z+=K,x=1):(H+=C,a=d,d+=r,x=2)}return J&&(J[0]=N+a*u,J[1]=q+a*M,J[2]=w+a*v),y&&(y[0]=y[1]=y[2]=0),0}(R,v,G,J,y/=F,a/=F,j/=F,w="undefined"===typeof w?64:+w,u,M)}},12428:(R,N,q)=>{"use strict";q.d(N,{d:()=>M});var w=q(12098);function u(){this.wj=!1,this.stopPropagation=!1,this.xj=!1,this.disabled=!1}class M{constructor(R,N){this.version="0.7.0";var q=Object.assign({},new u,N||{});this.element=R||document,this.wj=!!q.wj,this.stopPropagation=!!q.stopPropagation,this.xj=!!q.xj,this.disabled=!!q.disabled,this.filterEvents=(R,N)=>!0,this.down=new w.EventEmitter,this.up=new w.EventEmitter,this.state={},this.Vg={dx:0,dy:0,mk:0,Tg:0,nk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?G(this):document.addEventListener("DOMContentLoaded",(R=>{G(this)}),{once:!0})}bind(R){for(var N=arguments.length,q=new Array(N>1?N-1:0),w=1;w<N;w++)q[w-1]=arguments[w];q.forEach((N=>{var q=this._keyBindmap[N]||[];q.includes(R)||(q.push(R),this._keyBindmap[N]=q)})),this.state[R]=!!this.state[R],this.pressCount[R]=this.pressCount[R]||0,this.releaseCount[R]=this.releaseCount[R]||0}unbind(R){for(var N in this._keyBindmap){var q=this._keyBindmap[N],w=q.indexOf(R);w>-1&&q.splice(w,1)}}getBindings(){var R={};for(var N in this._keyBindmap){this._keyBindmap[N].forEach((q=>{R[q]=R[q]||[],R[q].push(N)}))}return R}cf(){v(this.Vg),v(this.pressCount),v(this.releaseCount)}}function v(R){for(var N in R)R[N]=0}function G(R){window.addEventListener("keydown",H.bind(null,R,!0),!1),window.addEventListener("keyup",H.bind(null,R,!1),!1);var N={passive:!0};R.element.addEventListener("touchstart",j.bind(void 0,R),{passive:!1}),R.element.addEventListener("touchend",S.bind(void 0,R),N),R.element.addEventListener("mousedown",W.bind(null,R,!0),N),window.document.addEventListener("mouseup",W.bind(null,R,!1),N),R.element.addEventListener("touchmove",k.bind(null,R),N),R.element.addEventListener("mousemove",k.bind(null,R),N),window.PointerEvent,R.element.addEventListener("wheel",C.bind(null,R),N),R.element.addEventListener("contextmenu",e.bind(null,R),!1),window.addEventListener("blur",K.bind(null,R),!1)}var J=0,y=0,a=null;function j(R,N){N.preventDefault(),F(N)}function F(R){let N=!1;for(let q=0;q<R.touches.length;++q)if(R.touches[q].identifier===a){N=!0;break}if(!N){const N=R.changedTouches[0];J=N.clientX,y=N.clientY,a=N.identifier}}function S(R,N){for(var q=N.changedTouches,w=0;w<q.length;++w)q[w].identifier===a&&(a=null)}function H(R,N,q){r(q.code,N,R,q)}function W(R,N,q){if("pointerId"in q)if(N){if(null!==R._touches.currID)return;R._touches.currID=q.pointerId}else{if(R._touches.currID!==q.pointerId)return;R._touches.currID=null}return r("Mouse"+("button"in q?q.button+1:1),N,R,q),!1}function k(R,N){var q=N.movementX||N.mozMovementX||0,w=N.movementY||N.mozMovementY||0;if(N.touches&&0===(q|w)){var u=function(R){F(R);for(let N=0;N<R.changedTouches.length;++N)if(R.changedTouches[N].identifier==a){const q=R.changedTouches[N],w=[q.clientX-J,q.clientY-y];return J=q.clientX,y=q.clientY,w}return console.error(`Did not find touch id ${a}`),[0,0]}(N);q=u[0],w=u[1]}R.Vg.dx+=q,R.Vg.dy+=w}function C(R,N){var q=1;switch(N.deltaMode){case 0:q=1;break;case 1:q=12;break;case 2:q=R.element.clientHeight||window.innerHeight}R.Vg.mk+=(N.deltaX||0)*q,R.Vg.Tg+=(N.deltaY||0)*q,R.Vg.nk+=(N.deltaZ||0)*q}function e(R,N){if(!R.xj)return N.preventDefault(),!1}function K(R){for(var N in R._keyStates)R._keyStates[N]&&(/^Mouse\d/.test(N)||r(N,!1,R,{code:N,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function r(R,N,q,w){var u=q._keyBindmap[R];u&&(Z(q._keyStates[R],N)&&(q._keyStates[R]=N,u.forEach((R=>{(!q.filterEvents||q.filterEvents(w,R))&&function(R,N,q,w){var u=N?q.pressCount:q.releaseCount;u[R]=(u[R]||0)+1;var M=q._bindPressCount[R]||0;(M+=N?1:-1)<0&&(M=0);q._bindPressCount[R]=M;var v=q.state[R];if(Z(v,M)){q.state[R]=M>0;var G=N?q.down:q.up;q.disabled||G.emit(R,w)}}(R,N,q,w)}))),"button"in w||(q.wj&&!w.defaultPrevented&&w.preventDefault(),q.stopPropagation&&w.stopPropagation()))}function Z(R,N){return R?!N:N}},11782:R=>{R.exports=function(R,N,q){return R[0]=N[0]+q[0],R[1]=N[1]+q[1],R[2]=N[2]+q[2],R}},11727:(R,N,q)=>{R.exports=function(R,N){var q=w(R[0],R[1],R[2]),v=w(N[0],N[1],N[2]);u(q,q),u(v,v);var G=M(q,v);return G>1?0:Math.acos(G)};var w=q(11734),u=q(11742),M=q(11750)},11845:R=>{R.exports=function(R,N){return R[0]=Math.ceil(N[0]),R[1]=Math.ceil(N[1]),R[2]=Math.ceil(N[2]),R}},11722:R=>{R.exports=function(R){var N=new Float32Array(3);return N[0]=R[0],N[1]=R[1],N[2]=R[2],N}},11753:R=>{R.exports=function(R,N){return R[0]=N[0],R[1]=N[1],R[2]=N[2],R}},11718:R=>{R.exports=function(){var R=new Float32Array(3);return R[0]=0,R[1]=0,R[2]=0,R}},11910:R=>{R.exports=function(R,N,q){var w=N[0],u=N[1],M=N[2],v=q[0],G=q[1],J=q[2];return R[0]=u*J-M*G,R[1]=M*v-w*J,R[2]=w*G-u*v,R}},11867:(R,N,q)=>{R.exports=q(11864)},11864:R=>{R.exports=function(R,N){var q=N[0]-R[0],w=N[1]-R[1],u=N[2]-R[2];return Math.sqrt(q*q+w*w+u*u)}},11815:(R,N,q)=>{R.exports=q(11812)},11812:R=>{R.exports=function(R,N,q){return R[0]=N[0]/q[0],R[1]=N[1]/q[1],R[2]=N[2]/q[2],R}},11750:R=>{R.exports=function(R,N){return R[0]*N[0]+R[1]*N[1]+R[2]*N[2]}},11709:R=>{R.exports=1e-6},11771:(R,N,q)=>{R.exports=function(R,N){var q=R[0],u=R[1],M=R[2],v=N[0],G=N[1],J=N[2];return Math.abs(q-v)<=w*Math.max(1,Math.abs(q),Math.abs(v))&&Math.abs(u-G)<=w*Math.max(1,Math.abs(u),Math.abs(G))&&Math.abs(M-J)<=w*Math.max(1,Math.abs(M),Math.abs(J))};var w=q(11709)},11778:R=>{R.exports=function(R,N){return R[0]===N[0]&&R[1]===N[1]&&R[2]===N[2]}},11837:R=>{R.exports=function(R,N){return R[0]=Math.floor(N[0]),R[1]=Math.floor(N[1]),R[2]=Math.floor(N[2]),R}},11961:(R,N,q)=>{R.exports=function(R,N,q,u,M,v){var G,J;N||(N=3);q||(q=0);J=u?Math.min(u*N+q,R.length):R.length;for(G=q;G<J;G+=N)w[0]=R[G],w[1]=R[G+1],w[2]=R[G+2],M(w,w,v),R[G]=w[0],R[G+1]=w[1],R[G+2]=w[2];return R};var w=q(11718)()},11734:R=>{R.exports=function(R,N,q){var w=new Float32Array(3);return w[0]=R,w[1]=N,w[2]=q,w}},11707:(R,N,q)=>{R.exports={EPSILON:q(11709),create:q(11718),clone:q(11722),angle:q(11727),wd:q(11734),j:q(11753),set:q(11762),equals:q(11771),exactEquals:q(11778),add:q(11782),Vc:q(11787),sub:q(11794),multiply:q(11797),mul:q(11805),divide:q(11812),div:q(11815),min:q(11822),max:q(11829),floor:q(11837),ceil:q(11845),round:q(11852),scale:q(11856),xd:q(11859),distance:q(11864),dist:q(11867),zd:q(11870),sqrDist:q(11872),length:q(11876),len:q(11884),squaredLength:q(11892),Bd:q(11901),negate:q(11905),inverse:q(11908),normalize:q(11742),dot:q(11750),cross:q(11910),md:q(11916),random:q(11925),transformMat4:q(11927),transformMat3:q(11933),transformQuat:q(11939),Cd:q(11946),Dd:q(11953),Fd:q(11959),forEach:q(11961)}},11908:R=>{R.exports=function(R,N){return R[0]=1/N[0],R[1]=1/N[1],R[2]=1/N[2],R}},11884:(R,N,q)=>{R.exports=q(11876)},11876:R=>{R.exports=function(R){var N=R[0],q=R[1],w=R[2];return Math.sqrt(N*N+q*q+w*w)}},11916:R=>{R.exports=function(R,N,q,w){var u=N[0],M=N[1],v=N[2];return R[0]=u+w*(q[0]-u),R[1]=M+w*(q[1]-M),R[2]=v+w*(q[2]-v),R}},11829:R=>{R.exports=function(R,N,q){return R[0]=Math.max(N[0],q[0]),R[1]=Math.max(N[1],q[1]),R[2]=Math.max(N[2],q[2]),R}},11822:R=>{R.exports=function(R,N,q){return R[0]=Math.min(N[0],q[0]),R[1]=Math.min(N[1],q[1]),R[2]=Math.min(N[2],q[2]),R}},11805:(R,N,q)=>{R.exports=q(11797)},11797:R=>{R.exports=function(R,N,q){return R[0]=N[0]*q[0],R[1]=N[1]*q[1],R[2]=N[2]*q[2],R}},11905:R=>{R.exports=function(R,N){return R[0]=-N[0],R[1]=-N[1],R[2]=-N[2],R}},11742:R=>{R.exports=function(R,N){var q=N[0],w=N[1],u=N[2],M=q*q+w*w+u*u;M>0&&(M=1/Math.sqrt(M),R[0]=N[0]*M,R[1]=N[1]*M,R[2]=N[2]*M);return R}},11925:R=>{R.exports=function(R,N){N=N||1;var q=2*Math.random()*Math.PI,w=2*Math.random()-1,u=Math.sqrt(1-w*w)*N;return R[0]=Math.cos(q)*u,R[1]=Math.sin(q)*u,R[2]=w*N,R}},11946:R=>{R.exports=function(R,N,q,w){var u=q[1],M=q[2],v=N[1]-u,G=N[2]-M,J=Math.sin(w),y=Math.cos(w);return R[0]=N[0],R[1]=u+v*y-G*J,R[2]=M+v*J+G*y,R}},11953:R=>{R.exports=function(R,N,q,w){var u=q[0],M=q[2],v=N[0]-u,G=N[2]-M,J=Math.sin(w),y=Math.cos(w);return R[0]=u+G*J+v*y,R[1]=N[1],R[2]=M+G*y-v*J,R}},11959:R=>{R.exports=function(R,N,q,w){var u=q[0],M=q[1],v=N[0]-u,G=N[1]-M,J=Math.sin(w),y=Math.cos(w);return R[0]=u+v*y-G*J,R[1]=M+v*J+G*y,R[2]=N[2],R}},11852:R=>{R.exports=function(R,N){return R[0]=Math.round(N[0]),R[1]=Math.round(N[1]),R[2]=Math.round(N[2]),R}},11856:R=>{R.exports=function(R,N,q){return R[0]=N[0]*q,R[1]=N[1]*q,R[2]=N[2]*q,R}},11859:R=>{R.exports=function(R,N,q,w){return R[0]=N[0]+q[0]*w,R[1]=N[1]+q[1]*w,R[2]=N[2]+q[2]*w,R}},11762:R=>{R.exports=function(R,N,q,w){return R[0]=N,R[1]=q,R[2]=w,R}},11872:(R,N,q)=>{R.exports=q(11870)},11901:(R,N,q)=>{R.exports=q(11892)},11870:R=>{R.exports=function(R,N){var q=N[0]-R[0],w=N[1]-R[1],u=N[2]-R[2];return q*q+w*w+u*u}},11892:R=>{R.exports=function(R){var N=R[0],q=R[1],w=R[2];return N*N+q*q+w*w}},11794:(R,N,q)=>{R.exports=q(11787)},11787:R=>{R.exports=function(R,N,q){return R[0]=N[0]-q[0],R[1]=N[1]-q[1],R[2]=N[2]-q[2],R}},11933:R=>{R.exports=function(R,N,q){var w=N[0],u=N[1],M=N[2];return R[0]=w*q[0]+u*q[3]+M*q[6],R[1]=w*q[1]+u*q[4]+M*q[7],R[2]=w*q[2]+u*q[5]+M*q[8],R}},11927:R=>{R.exports=function(R,N,q){var w=N[0],u=N[1],M=N[2],v=q[3]*w+q[7]*u+q[11]*M+q[15];return v=v||1,R[0]=(q[0]*w+q[4]*u+q[8]*M+q[12])/v,R[1]=(q[1]*w+q[5]*u+q[9]*M+q[13])/v,R[2]=(q[2]*w+q[6]*u+q[10]*M+q[14])/v,R}},11939:R=>{R.exports=function(R,N,q){var w=N[0],u=N[1],M=N[2],v=q[0],G=q[1],J=q[2],y=q[3],a=y*w+G*M-J*u,j=y*u+J*w-v*M,F=y*M+v*u-G*w,S=-v*w-G*u-J*M;return R[0]=a*y+S*-v+j*-J-F*-G,R[1]=j*y+S*-G+F*-v-a*-J,R[2]=F*y+S*-J+a*-G-j*-v,R}},12116:R=>{"use strict";R.exports=function(R){for(var N=new Array(R),q=0;q<R;++q)N[q]=q;return N}},12170:R=>{R.exports=function(R){return null!=R&&null!=R.constructor&&"function"===typeof R.constructor.isBuffer&&R.constructor.isBuffer(R)}},12403:(R,N,q)=>{"use strict";q.d(N,{d:()=>w});class w{constructor(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.oi=!1,this.pi=!1,this.mi=30,this.ni=0,this.yi=!1,this.fullscreen=!1,this.ri=function(R){},this.si=function(){},this.wi=function(){},this.bb=function(){},this.ti=function(R){},this.onFullscreenChanged=function(R){},y((()=>{!function(R,N){R._nowObject=performance||Date,R._lastTick=0,R._renderAccum=0,R._rt=0,R._frameCB=G.bind(null,R),requestAnimationFrame(R._frameCB),N>0&&(R._intervalCB=v.bind(null,R),R._interval=setInterval(R._intervalCB,Math.max(N,1e3/R.mi/2)))}(this,N),function(R,N){if(!N)return;var q=!1,w=!1;document.addEventListener("pointerlockchange",(w=>{q=document.pointerLockElement===N,R.ti(q)})),document.addEventListener("fullscreenchange",(q=>{w=document.fullscreenElement===N,R.onFullscreenChanged(w)})),Object.defineProperty(R,"yi",{get:()=>q,set:R=>{R&&!q?J(N):q&&!R&&function(R){R.exitPointerLock&&R.exitPointerLock()}(document)}}),Object.defineProperty(R,"fullscreen",{get:()=>w,set:R=>{R&&!w?N.requestFullscreen():w&&!R&&document.exitFullscreen()}}),N.addEventListener("click",(u=>{R.oi&&!q&&J(N),R.pi&&!w&&N.requestFullscreen()}));var u=()=>R.bb();if(window.ResizeObserver){new ResizeObserver(u).observe(N)}else window.addEventListener("resize",u)}(this,R),this.wi()}))}}var u=3,M=20;function v(R){for(var N=1e3/R.mi,q=R._nowObject.now()+M,w=0;R._nowObject.now()>=R._lastTick+N&&R._nowObject.now()<q&&++w<=u;)R.ri(N),R._lastTick+=N;var v=5*(N+5),G=R._nowObject.now();if(G-R._lastTick>v)for(;G>=R._lastTick+N;)R._lastTick+=N}function G(R){requestAnimationFrame(R._frameCB),v(R);var N=R._nowObject.now(),q=N-R._rt;if(R._rt=N,R.ni>0){R._renderAccum+=q;var w=1e3/R.ni;if(R._renderAccum<w)return;R._renderAccum=Math.min(R._renderAccum-w,w)}var u=1e3/R.mi,M=(N-R._lastTick)/u;R.si(q,M,u)}function J(R){R.requestPointerLock&&R.requestPointerLock()}var y=R=>{if("loading"===document.readyState){var N=()=>{document.removeEventListener("readystatechange",N),R()};document.addEventListener("readystatechange",N)}else setTimeout(R,1)}},12112:(R,N,q)=>{var w=q(12116),u=q(12119),M="undefined"!==typeof Float64Array;function v(R,N){return R[0]-N[0]}function G(){var R,N=this.stride,q=new Array(N.length);for(R=0;R<q.length;++R)q[R]=[Math.abs(N[R]),R];q.sort(v);var w=new Array(q.length);for(R=0;R<w.length;++R)w[R]=q[R][1];return w}function J(R,N){var q=["View",N,"d",R].join("");N<0&&(q="View_Nil"+R);var u="generic"===R;if(-1===N){var M="function "+q+"(a){this.data=a;};var proto="+q+".prototype;proto.dtype='"+R+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+q+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+q+"(a){return new "+q+"(a);}";return new Function(M)()}if(0===N){M="function "+q+"(a,d) {this.data = a;this.offset = d};var proto="+q+".prototype;proto.dtype='"+R+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+q+"_copy() {return new "+q+"(this.data,this.offset)};proto.pick=function "+q+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+q+"_get(){return "+(u?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+q+"_set(v){return "+(u?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+q+"(a,b,c,d){return new "+q+"(a,d)}";return new Function("TrivialArray",M)(y[R][0])}M=["'use strict'"];var v=w(N),J=v.map((function(R){return"i"+R})),a="this.offset+"+v.map((function(R){return"this.stride["+R+"]*i"+R})).join("+"),j=v.map((function(R){return"b"+R})).join(","),F=v.map((function(R){return"c"+R})).join(",");M.push("function "+q+"(a,"+j+","+F+",d){this.data=a","this.shape=["+j+"]","this.stride=["+F+"]","this.offset=d|0}","var proto="+q+".prototype","proto.dtype='"+R+"'","proto.dimension="+N),M.push("Object.defineProperty(proto,'size',{get:function "+q+"_size(){return "+v.map((function(R){return"this.shape["+R+"]"})).join("*"),"}})"),1===N?M.push("proto.order=[0]"):(M.push("Object.defineProperty(proto,'order',{get:"),N<4?(M.push("function "+q+"_order(){"),2===N?M.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===N&&M.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):M.push("ORDER})")),M.push("proto.set=function "+q+"_set("+J.join(",")+",v){"),u?M.push("return this.data.set("+a+",v)}"):M.push("return this.data["+a+"]=v}"),M.push("proto.get=function "+q+"_get("+J.join(",")+"){"),u?M.push("return this.data.get("+a+")}"):M.push("return this.data["+a+"]}"),M.push("proto.index=function "+q+"_index(",J.join(),"){return "+a+"}"),M.push("proto.hi=function "+q+"_hi("+J.join(",")+"){return new "+q+"(this.data,"+v.map((function(R){return["(typeof i",R,"!=='number'||i",R,"<0)?this.shape[",R,"]:i",R,"|0"].join("")})).join(",")+","+v.map((function(R){return"this.stride["+R+"]"})).join(",")+",this.offset)}");var S=v.map((function(R){return"a"+R+"=this.shape["+R+"]"})),H=v.map((function(R){return"c"+R+"=this.stride["+R+"]"}));M.push("proto.lo=function "+q+"_lo("+J.join(",")+"){var b=this.offset,d=0,"+S.join(",")+","+H.join(","));for(var W=0;W<N;++W)M.push("if(typeof i"+W+"==='number'&&i"+W+">=0){d=i"+W+"|0;b+=c"+W+"*d;a"+W+"-=d}");M.push("return new "+q+"(this.data,"+v.map((function(R){return"a"+R})).join(",")+","+v.map((function(R){return"c"+R})).join(",")+",b)}"),M.push("proto.step=function "+q+"_step("+J.join(",")+"){var "+v.map((function(R){return"a"+R+"=this.shape["+R+"]"})).join(",")+","+v.map((function(R){return"b"+R+"=this.stride["+R+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(W=0;W<N;++W)M.push("if(typeof i"+W+"==='number'){d=i"+W+"|0;if(d<0){c+=b"+W+"*(a"+W+"-1);a"+W+"=ceil(-a"+W+"/d)}else{a"+W+"=ceil(a"+W+"/d)}b"+W+"*=d}");M.push("return new "+q+"(this.data,"+v.map((function(R){return"a"+R})).join(",")+","+v.map((function(R){return"b"+R})).join(",")+",c)}");var k=new Array(N),C=new Array(N);for(W=0;W<N;++W)k[W]="a[i"+W+"]",C[W]="b[i"+W+"]";M.push("proto.transpose=function "+q+"_transpose("+J+"){"+J.map((function(R,N){return R+"=("+R+"===undefined?"+N+":"+R+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+q+"(this.data,"+k.join(",")+","+C.join(",")+",this.offset)}"),M.push("proto.pick=function "+q+"_pick("+J+"){var a=[],b=[],c=this.offset");for(W=0;W<N;++W)M.push("if(typeof i"+W+"==='number'&&i"+W+">=0){c=(c+this.stride["+W+"]*i"+W+")|0}else{a.push(this.shape["+W+"]);b.push(this.stride["+W+"])}");return M.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),M.push("return function construct_"+q+"(data,shape,stride,offset){return new "+q+"(data,"+v.map((function(R){return"shape["+R+"]"})).join(",")+","+v.map((function(R){return"stride["+R+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",M.join("\n"))(y[R],G)}var y={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};R.exports=function(R,N,q,w){if(void 0===R)return(0,y.array[0])([]);"number"===typeof R&&(R=[R]),void 0===N&&(N=[R.length]);var v=N.length;if(void 0===q){q=new Array(v);for(var G=v-1,a=1;G>=0;--G)q[G]=a,a*=N[G]}if(void 0===w){w=0;for(G=0;G<v;++G)q[G]<0&&(w-=(N[G]-1)*q[G])}for(var j=function(R){if(u(R))return"buffer";if(M)switch(Object.prototype.toString.call(R)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(R)?"array":"generic"}(R),F=y[j];F.length<=v+1;)F.push(J(j,F.length-1));return(0,F[v+1])(R,N,q,w)}},12119:R=>{function N(R){return!!R.constructor&&"function"===typeof R.constructor.isBuffer&&R.constructor.isBuffer(R)}R.exports=function(R){return null!=R&&(N(R)||function(R){return"function"===typeof R.readFloatLE&&"function"===typeof R.slice&&N(R.slice(0,0))}(R)||!!R._isBuffer)}},12259:R=>{"use strict";var N=[],q=[],w=[],u=[],M=[],v=[],G=[],J=[],y=[],a=[],j=[],F=[];R.exports=function(R,S,H,W,k,C){for(var e=G,K=y,r=a,Z=F,z=0;z<3;z++)e[z]=+H[z],r[z]=+S.max[z],K[z]=+S.Hd[z];C||(C=1e-10);var d=function(R,G,y,a,F,S){var H=N,W=q,k=w,C=u,e=M,K=v,r=J,Z=Math.floor,z=0,d=0,x=0,E=0,P=0;if(s(),0===x)return 0;for(E=m();d<=x;){if(O(E)&&L())return z;E=m()}for(z+=x,P=0;P<3;P++)a[P]+=y[P],F[P]+=y[P];return z;function s(){if(d=0,0!==(x=Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2])))for(var R=0;R<3;R++){var N=y[R]>=0;C[R]=N?1:-1;var q=N?F[R]:a[R];H[R]=N?a[R]:F[R],W[R]=o(q,C[R]),k[R]=A(H[R],C[R]),r[R]=y[R]/x,e[R]=Math.abs(1/r[R]);var w=N?W[R]+1-q:q-W[R];K[R]=e[R]<1/0?e[R]*w:1/0}}function O(N){for(var q=C[0],w=0===N?W[0]:k[0],u=W[0]+q,M=C[1],v=1===N?W[1]:k[1],G=W[1]+M,J=C[2],y=2===N?W[2]:k[2],a=W[2]+J,j=w;j!=u;j+=q)for(var F=v;F!=G;F+=M)for(var S=y;S!=a;S+=J)if(R(j,F,S))return!0;return!1}function L(){z+=d;var R=C[E],N=d/x,q=j;for(P=0;P<3;P++){var w=y[P]*N;a[P]+=w,F[P]+=w,q[P]=y[P]-w}if(R>0?F[E]=Math.round(F[E]):a[E]=Math.round(a[E]),G(z,E,R,q))return!0;for(P=0;P<3;P++)y[P]=q[P];return s(),0===x}function m(){var R=K[0]<K[1]?K[0]<K[2]?0:2:K[1]<K[2]?1:2,N=K[R]-d;for(d=K[R],W[R]+=C[R],K[R]+=e[R],P=0;P<3;P++)H[P]+=N*r[P],k[P]=A(H[P],C[P]);return R}function o(R,N){return Z(R-N*S)}function A(R,N){return Z(R+N*S)}}(R,W,e,K,r,C);if(!k){for(z=0;z<3;z++)Z[z]=H[z]>0?r[z]-S.max[z]:K[z]-S.Hd[z];S.translate(Z)}return d}},12433:(R,N,q)=>{"use strict";q.d(N,{d:()=>j});var w=q(12255),u=q(11707);class M{constructor(R,N,q,M,v,G,J){this.fh=new w(R.Hd,R.Fh),this.mass=N,this.friction=q,this.restitution=M,this.Yc=v,this.Hk=G,this.Zc=!!J,this.Eh=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.ul=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.rg=u.create(),this.$g=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=u.create(),this._impulses=u.create(),this._sleepFrameCount=10}loadFromCopy(R){u.j(this.fh.Hd,R.fh.Hd),u.j(this.fh.Fh,R.fh.Fh),u.j(this.fh.max,R.fh.max),this.fh.mag=R.fh.mag,this.mass=R.mass,this.friction=R.friction,this.restitution=R.restitution,this.Yc=R.Yc,this.Hk=R.Hk,this.Zc=R.Zc,this.Eh=R.Eh,this.fluidDrag=R.fluidDrag,this.ul=R.ul,this.preventFallOffEdge=R.preventFallOffEdge,this.rolledBackLastTick=R.rolledBackLastTick,u.j(this.rg,R.rg),u.j(this.$g,R.$g),this.inFluid=R.inFluid,this._ratioInFluid=R._ratioInFluid,u.j(this._forces,R._forces),u.j(this._impulses,R._impulses),this._sleepFrameCount=R._sleepFrameCount}setPosition(R){v(R),u.Vc(R,R,this.fh.Hd),this.fh.translate(R),this.ug()}cb(){return u.clone(this.fh.Hd)}applyForce(R){v(R),u.add(this._forces,this._forces,R),this.ug()}applyImpulse(R){v(R),u.add(this._impulses,this._impulses,R),this.ug()}ug(){this._sleepFrameCount=10}atRestX(){return this.$g[0]}atRestY(){return this.$g[1]}atRestZ(){return this.$g[2]}}var v=R=>{};var G=q(12255),J=q(11707),y=q(12259);function a(){this.Eh=.1,this.fluidDrag=.4,this.ld=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function j(R,N,q){R=Object.assign(new a,R),this.gravity=R.gravity||[0,-10,0],this.Eh=R.Eh||.1,this.ld=R.ld||2,this.fluidDrag=R.fluidDrag||.4,this.minBounceImpulse=R.minBounceImpulse,this.bodies=[],this.ck=R.ck,this.testSolid=N,this.testFluid=q}j.prototype.Ok=function(R,N,q,w,u,v){R=R||new G([0,0,0],[1,1,1]),"undefined"==typeof N&&(N=1),"undefined"==typeof q&&(q=1),"undefined"==typeof w&&(w=0),"undefined"==typeof u&&(u=1);var J=new M(R,N,q,w,u,v);return this.bodies.push(J),J},j.prototype.Pk=function(R){var N=this.bodies.indexOf(R);N<0||(this.bodies.splice(N,1),R.fh=R.Hk=null)};var F=J.create(),S=J.create(),H=J.create(),W=J.create(),k=J.create(),C=J.create(),e=J.create(),K=new G([0,0,0],[1,1,1]),r=new M(K,1,1,0,1,(()=>{}),!1);function Z(R,N,q){return N=q,N*=1-(1-R.ratioInFluid)**2}j.prototype.cf=function(R){R/=1e3;var N=f(0,J.squaredLength(this.gravity));this.bodies.forEach((q=>function(R,N,q,w){J.j(k,N.$g),R.ck&&r.loadFromCopy(N);if(N.mass<=0)return J.set(N.rg,0,0,0),J.set(N._forces,0,0,0),void J.set(N._impulses,0,0,0);var u=w||0===N.Yc;if(function(R,N,q,w){if(N._sleepFrameCount>0)return!1;if(w)return!0;var u=!1,M=.5*q*q*N.Yc;return J.scale(T,R.gravity,M),y(R.testSolid,N.fh,T,(function(){return u=!0,!0}),!0),u}(R,N,q,u))return;N._sleepFrameCount--,function(R,N){var q=N.fh,w=Math.floor(q.Hd[0]),u=Math.floor(q.Hd[2]),M=Math.floor(q.Hd[1]),v=Math.floor(q.max[1]);if(!R.testFluid(w,M,u))return N.inFluid=!1,void(N.ratioInFluid=0);var G=1,y=M+1;for(;y<=v&&R.testFluid(w,y,u);)G++,y++;var a=(M+G-q.Hd[1])/q.Fh[1];a>1&&(a=1);var j=q.Fh[0]*q.Fh[1]*q.Fh[2]*a,F=d;J.scale(F,R.gravity,-R.ld*j*N.Yc),N.applyForce(F),N.inFluid=!0,N.ratioInFluid=a}(R,N),b(N._forces),b(N._impulses),b(N.rg),b(N.$g),J.scale(F,N._forces,1/N.mass),J.xd(F,F,R.gravity,N.Yc),J.scale(S,N._impulses,1/N.mass),J.xd(S,S,F,q),J.add(N.rg,N.rg,S),N.friction&&(x(R,0,N,S,q),x(R,1,N,S,q),x(R,2,N,S,q));var M=N.fluidDrag>=0?N.fluidDrag:R.fluidDrag,v=N.Eh>=0?N.Eh:R.Eh,G=v,a=v;N.inFluid&&(G=Z(N,G,N.fluidDragHoriz>=0?N.fluidDragHoriz:M),a=Z(N,a,N.fluidDragVert>=0?N.fluidDragVert:M));G=Math.max(1-G*q/N.mass,0),a=Math.max(1-a*q/N.mass,0),J.set(z,G,a,G),J.multiply(N.rg,N.rg,z),J.scale(H,N.rg,q),J.set(N._forces,0,0,0),J.set(N._impulses,0,0,0),N.Zc&&c(s,N.fh);J.j(C,H),J.set(e,0,0,0),N.preventFallOffEdge&&function(R,N,q,w){if(!N.$g[1]||q[1]>0)return;var u=n;c(u,N.fh);for(var M=0;M<3;M+=2){J.set(A,0,0,0),A[M]=q[M];var v=!0;(v=(v=(v=(v=v&&!Y(R,u.Hd[0]+A[0]+1e-5,u.Hd[1],u.Hd[2]+A[2]+1e-5))&&!Y(R,u.max[0]+A[0]-1e-5,u.Hd[1],u.Hd[2]+A[2]+1e-5))&&!Y(R,u.Hd[0]+A[0]+1e-5,u.Hd[1],u.max[2]+A[2]-1e-5))&&!Y(R,u.max[0]+A[0]-1e-5,u.Hd[1],u.max[2]+A[2]-1e-5))?(w[M]=q[M]>0?1:-1,q[M]=0):0===M&&(J.set(Q,q[0],0,0),P(R,u,Q,w,N.slideOnCollision))}}(R,N,H,e);P(R,N.fh,H,N.$g,N.slideOnCollision),N.Zc&&function(R,N,q,w){if(N.$g[1]>=0&&!N.inFluid)return;var u=0!==N.$g[0],M=0!==N.$g[2];if(!u&&!M)return;var v=Math.abs(w[0]/w[2]),G=4;if(!u&&v>G)return;if(!M&&v<1/G)return;J.add(L,q.Hd,w);var a=R.testSolid;y(a,q,w,(function(R,N,q,w){if(1!==N)return!0;w[N]=0}));var j=q.Hd[1],F=N.inFluid?1.951:1.001,S=Math.floor(j+F)-j;J.set(m,0,S,0);var H=!1;if(y(a,q,m,(function(R,N,q,w){return H=!0,!0})),H)return;J.Vc(o,L,q.Hd),o[1]=0,P(R,q,o,O,!0);var W=f(q.Hd[0],L[0]),k=f(q.Hd[2],L[2]);if(u&&!W&&(!k||!M))return;if(M&&(!W||!u)&&!k)return;var C=!0;if(C=C&&!Y(R,q.Hd[0]+1e-5,q.Hd[1],q.Hd[2]+1e-5),C=C&&!Y(R,q.max[0]-1e-5,q.Hd[1],q.Hd[2]+1e-5),C=C&&!Y(R,q.Hd[0]+1e-5,q.Hd[1],q.max[2]-1e-5),C=C&&!Y(R,q.max[0]-1e-5,q.Hd[1],q.max[2]-1e-5),C)return;c(N.fh,q),N.$g[0]=O[0],N.$g[2]=O[2],N.ul&&N.ul()}(R,N,s,C);for(var j=0;j<3;++j)N.$g[j]=N.$g[j]||e[j],W[j]=0,N.$g[j]&&(k[j]||(W[j]=-N.rg[j]),N.rg[j]=0);var K=J.length(W);K>.001&&(J.scale(W,W,N.mass),N.Hk&&N.Hk(W),N.restitution>0&&K>R.minBounceImpulse&&(J.scale(W,W,N.restitution),N.applyImpulse(W)));var E=J.squaredLength(N.rg);E>1e-5&&N.ug();R.ck&&R.ck(N)?(N.loadFromCopy(r),N.rolledBackLastTick=!0):N.rolledBackLastTick=!1}(this,q,R,N)))};var z=J.create([0,0,0]);var d=J.create();function x(R,N,q,w,u){var M=q.$g[N],v=w[N];if(!q.alwaysApplyHorizFriction||1!==N){if(0===M)return;if(M*v<=0)return}J.j(E,q.rg),E[N]=0;var G=J.length(E);if(!f(G,0)){var y=Math.abs(q.friction*R.gravity[N]*u),a=G>y?(G-y)/G:0;q.rg[(N+1)%3]*=a,q.rg[(N+2)%3]*=a}}var E=J.create();function P(R,N,q,w,u){return J.set(w,0,0,0),y(R.testSolid,N,q,(function(R,N,q,M){w[N]=q,M[N]=0,u||(M[0]=0,M[1]=0,M[2]=0)}))}var s=new G([],[]),O=J.create(),L=J.create(),m=J.create(),o=J.create();var A=J.create(),n=new G([],[]),Q=J.create();function Y(R,N,q,w){return R.testSolid(Math.floor(N),Math.floor(q-1),Math.floor(w))}var T=J.create();function f(R,N){return Math.abs(R-N)<1e-5}function c(R,N){for(var q=0;q<3;q++)R.Hd[q]=N.Hd[q],R.max[q]=N.max[q],R.Fh[q]=N.Fh[q]}var b=function(R){}},11167:function(R,N){!function(R){"use strict";var N=function(R,q){return N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,N){R.__proto__=N}||function(R,N){for(var q in N)Object.prototype.hasOwnProperty.call(N,q)&&(R[q]=N[q])},N(R,q)};function q(R,q){if("function"!==typeof q&&null!==q)throw new TypeError("Class extends value "+String(q)+" is not a constructor or null");function w(){this.constructor=R}N(R,q),R.prototype=null===q?Object.create(q):(w.prototype=q.prototype,new w)}function w(R,N,q,w){var u,M=arguments.length,v=M<3?N:null===w?w=Object.getOwnPropertyDescriptor(N,q):w;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)v=Reflect.decorate(R,N,q,w);else for(var G=R.length-1;G>=0;G--)(u=R[G])&&(v=(M<3?u(v):M>3?u(N,q,v):u(N,q))||v);return M>3&&v&&Object.defineProperty(N,q,v),v}function u(R,N,q){if(q||2===arguments.length)for(var w,u=0,M=N.length;u<M;u++)!w&&u in N||(w||(w=Array.prototype.slice.call(N,0,u)),w[u]=N[u]);return R.concat(w||Array.prototype.slice.call(N))}var M,v=255,G=213;R.OPERATION=void 0,(M=R.OPERATION||(R.OPERATION={}))[M.ADD=128]="ADD",M[M.REPLACE=0]="REPLACE",M[M.DELETE=64]="DELETE",M[M.DELETE_AND_ADD=192]="DELETE_AND_ADD",M[M.TOUCH=1]="TOUCH",M[M.CLEAR=10]="CLEAR";var J=function(){function N(R,N,q){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=R,this.setParent(N,q)}return N.prototype.setParent=function(R,N,q){var w=this;if(this.indexes||(this.indexes=this.ref instanceof oR?this.ref._definition.indexes:{}),this.parent=R,this.parentIndex=q,N)if(this.root=N,this.ref instanceof oR){var u=this.ref._definition;for(var M in u.schema){var v=this.ref[M];if(v&&v.$changes){var G=u.indexes[M];v.$changes.setParent(this.ref,N,G)}}}else"object"===typeof this.ref&&this.ref.forEach((function(R,N){if(R instanceof oR){var q=R.$changes,u=w.ref.$changes.indexes[N];q.setParent(w.ref,w.root,u)}}))},N.prototype.operation=function(R){this.changes.set(--this.currentCustomOperation,R)},N.prototype.change=function(N,q){void 0===q&&(q=R.OPERATION.ADD);var w="number"===typeof N?N:this.indexes[N];this.assertValidIndex(w,N);var u=this.changes.get(w);u&&u.op!==R.OPERATION.DELETE&&u.op!==R.OPERATION.TOUCH||this.changes.set(w,{op:u&&u.op===R.OPERATION.DELETE?R.OPERATION.DELETE_AND_ADD:q,index:w}),this.allChanges.add(w),this.changed=!0,this.touchParents()},N.prototype.touch=function(N){var q="number"===typeof N?N:this.indexes[N];this.assertValidIndex(q,N),this.changes.has(q)||this.changes.set(q,{op:R.OPERATION.TOUCH,index:q}),this.allChanges.add(q),this.touchParents()},N.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},N.prototype.getType=function(R){if(this.ref._definition)return(N=this.ref._definition).schema[N.fieldsByIndex[R]];var N,q=(N=this.parent._definition).schema[N.fieldsByIndex[this.parentIndex]];return Object.values(q)[0]},N.prototype.getChildrenFilter=function(){var R=this.parent._definition.childFilters;return R&&R[this.parentIndex]},N.prototype.getValue=function(R){return this.ref.getByIndex(R)},N.prototype.delete=function(N){var q="number"===typeof N?N:this.indexes[N];if(void 0!==q){var w=this.getValue(q);this.changes.set(q,{op:R.OPERATION.DELETE,index:q}),this.allChanges.delete(q),delete this.caches[q],w&&w.$changes&&(w.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(N," (").concat(q,")"))},N.prototype.discard=function(N,q){var w=this;void 0===N&&(N=!1),void 0===q&&(q=!1),this.ref instanceof oR||this.changes.forEach((function(N){if(N.op===R.OPERATION.DELETE){var q=w.ref.getIndex(N.index);delete w.indexes[q]}})),this.changes.clear(),this.changed=N,q&&this.allChanges.clear(),this.currentCustomOperation=0},N.prototype.discardAll=function(){var R=this;this.changes.forEach((function(N){var q=R.getValue(N.index);q&&q.$changes&&q.$changes.discardAll()})),this.discard()},N.prototype.cache=function(R,N){this.caches[R]=N},N.prototype.clone=function(){return new N(this.ref,this.parent,this.root)},N.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},N.prototype.assertValidIndex=function(R,N){if(void 0===R)throw new Error('ChangeTree: missing index for field "'.concat(N,'"'))},N}();function y(R,N,q,w){return R[N]||(R[N]=[]),R[N].push(q),null===w||void 0===w||w.forEach((function(R,N){return q(R,N)})),function(){return j(R[N],R[N].indexOf(q))}}function a(N){var q=this,w="string"!==typeof this.$changes.getType();this.$items.forEach((function(u,M){N.push({refId:q.$changes.refId,op:R.OPERATION.DELETE,field:M,value:void 0,previousValue:u}),w&&q.$changes.root.removeRef(u.$changes.refId)}))}function j(R,N){if(-1===N||N>=R.length)return!1;for(var q=R.length-1,w=N;w<q;w++)R[w]=R[w+1];return R.length=q,!0}var F=function(R,N){var q=R.toString(),w=N.toString();return q<w?-1:q>w?1:0};function S(R){return R.$proxy=!0,R=new Proxy(R,{get:function(R,N){return"symbol"===typeof N||isNaN(N)?R[N]:R.at(N)},set:function(R,N,q){if("symbol"===typeof N||isNaN(N))R[N]=q;else{var w=Array.from(R.$items.keys()),u=parseInt(w[N]||N);void 0===q||null===q?R.deleteAt(u):R.setAt(u,q)}return!0},deleteProperty:function(R,N){return"number"===typeof N?R.deleteAt(N):delete R[N],!0}})}var H=function(){function N(){for(var R=[],N=0;N<arguments.length;N++)R[N]=arguments[N];this.$changes=new J(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,R)}return N.prototype.Mf=function(N,q){return void 0===q&&(q=!0),y(this.$callbacks||(this.$callbacks=[]),R.OPERATION.ADD,N,q?this.$items:void 0)},N.prototype.ab=function(N){return y(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,N)},N.prototype.onChange=function(N){return y(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,N)},N.is=function(R){return Array.isArray(R)||void 0!==R.array},Object.defineProperty(N.prototype,"length",{get:function(){return this.$items.size},set:function(R){0===R?this.clear():this.splice(R,this.length-R)},enumerable:!1,configurable:!0}),N.prototype.push=function(){for(var R,N=this,q=[],w=0;w<arguments.length;w++)q[w]=arguments[w];return q.forEach((function(q){R=N.$refId++,N.setAt(R,q)})),R},N.prototype.pop=function(){var R=Array.from(this.$indexes.values()).pop();if(void 0!==R){this.$changes.delete(R),this.$indexes.delete(R);var N=this.$items.get(R);return this.$items.delete(R),N}},N.prototype.at=function(R){var N=Array.from(this.$items.keys())[R];return this.$items.get(N)},N.prototype.setAt=function(N,q){var w,u;if(void 0!==q&&null!==q){if(this.$items.get(N)!==q){void 0!==q.$changes&&q.$changes.setParent(this,this.$changes.root,N);var M=null!==(u=null===(w=this.$changes.indexes[N])||void 0===w?void 0:w.op)&&void 0!==u?u:R.OPERATION.ADD;this.$changes.indexes[N]=N,this.$indexes.set(N,N),this.$items.set(N,q),this.$changes.change(N,M)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},N.prototype.deleteAt=function(R){var N=Array.from(this.$items.keys())[R];return void 0!==N&&this.$deleteAt(N)},N.prototype.$deleteAt=function(R){return this.$changes.delete(R),this.$indexes.delete(R),this.$items.delete(R)},N.prototype.clear=function(N){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),N&&a.call(this,N),this.$items.clear(),this.$changes.operation({index:0,op:R.OPERATION.CLEAR}),this.$changes.touchParents()},N.prototype.concat=function(){for(var R,q=[],w=0;w<arguments.length;w++)q[w]=arguments[w];return new(N.bind.apply(N,u([void 0],(R=Array.from(this.$items.values())).concat.apply(R,q),!1)))},N.prototype.join=function(R){return Array.from(this.$items.values()).join(R)},N.prototype.reverse=function(){var R=this,N=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(q,w){R.setAt(N[w],q)})),this},N.prototype.shift=function(){var R=Array.from(this.$items.keys()).shift();if(void 0!==R){var N=this.$items.get(R);return this.$deleteAt(R),N}},N.prototype.slice=function(R,q){var w=new N;return w.push.apply(w,Array.from(this.$items.values()).slice(R,q)),w},N.prototype.sort=function(R){var N=this;void 0===R&&(R=F);var q=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(R).forEach((function(R,w){N.setAt(q[w],R)})),this},N.prototype.splice=function(R,N){void 0===N&&(N=this.length-R);for(var q=Array.from(this.$items.keys()),w=[],u=R;u<R+N;u++)w.push(this.$items.get(q[u])),this.$deleteAt(q[u]);return w},N.prototype.unshift=function(){for(var R=this,N=[],q=0;q<arguments.length;q++)N[q]=arguments[q];var w=this.length,u=N.length,M=Array.from(this.$items.values());return N.forEach((function(N,q){R.setAt(q,N)})),M.forEach((function(N,q){R.setAt(u+q,N)})),w+u},N.prototype.indexOf=function(R,N){return Array.from(this.$items.values()).indexOf(R,N)},N.prototype.lastIndexOf=function(R,N){return void 0===N&&(N=this.length-1),Array.from(this.$items.values()).lastIndexOf(R,N)},N.prototype.every=function(R,N){return Array.from(this.$items.values()).every(R,N)},N.prototype.some=function(R,N){return Array.from(this.$items.values()).some(R,N)},N.prototype.forEach=function(R,N){Array.from(this.$items.values()).forEach(R,N)},N.prototype.map=function(R,N){return Array.from(this.$items.values()).map(R,N)},N.prototype.filter=function(R,N){return Array.from(this.$items.values()).filter(R,N)},N.prototype.reduce=function(R,N){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},N.prototype.reduceRight=function(R,N){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},N.prototype.find=function(R,N){return Array.from(this.$items.values()).find(R,N)},N.prototype.findIndex=function(R,N){return Array.from(this.$items.values()).findIndex(R,N)},N.prototype.fill=function(R,N,q){throw new Error("ArraySchema#fill() not implemented")},N.prototype.copyWithin=function(R,N,q){throw new Error("ArraySchema#copyWithin() not implemented")},N.prototype.toString=function(){return this.$items.toString()},N.prototype.toLocaleString=function(){return this.$items.toLocaleString()},N.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(N,Symbol.species,{get:function(){return N},enumerable:!1,configurable:!0}),N.prototype.entries=function(){return this.$items.entries()},N.prototype.keys=function(){return this.$items.keys()},N.prototype.values=function(){return this.$items.values()},N.prototype.includes=function(R,N){return Array.from(this.$items.values()).includes(R,N)},N.prototype.flatMap=function(R,N){throw new Error("ArraySchema#flatMap() is not supported.")},N.prototype.flat=function(R){throw new Error("ArraySchema#flat() is not supported.")},N.prototype.findLast=function(){var R=Array.from(this.$items.values());return R.findLast.apply(R,arguments)},N.prototype.findLastIndex=function(){var R=Array.from(this.$items.values());return R.findLastIndex.apply(R,arguments)},N.prototype.setIndex=function(R,N){this.$indexes.set(R,N)},N.prototype.getIndex=function(R){return this.$indexes.get(R)},N.prototype.getByIndex=function(R){return this.$items.get(this.$indexes.get(R))},N.prototype.deleteByIndex=function(R){var N=this.$indexes.get(R);this.$items.delete(N),this.$indexes.delete(R)},N.prototype.toArray=function(){return Array.from(this.$items.values())},N.prototype.toJSON=function(){return this.toArray().map((function(R){return"function"===typeof R.toJSON?R.toJSON():R}))},N.prototype.clone=function(R){return R?new(N.bind.apply(N,u([void 0],Array.from(this.$items.values()),!1))):new(N.bind.apply(N,u([void 0],this.map((function(R){return R.$changes?R.clone():R})),!1)))},N}();function W(R){return R.$proxy=!0,R=new Proxy(R,{get:function(R,N){return"symbol"!==typeof N&&"undefined"===typeof R[N]?R.get(N):R[N]},set:function(R,N,q){return"symbol"!==typeof N&&-1===N.indexOf("$")&&"Mf"!==N&&"ab"!==N&&"onChange"!==N?R.set(N,q):R[N]=q,!0},deleteProperty:function(R,N){return R.delete(N),!0}})}var k=function(){function N(R){var q=this;if(this.$changes=new J(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,R)if(R instanceof Map||R instanceof N)R.forEach((function(R,N){return q.set(N,R)}));else for(var w in R)this.set(w,R[w])}return N.prototype.Mf=function(N,q){return void 0===q&&(q=!0),y(this.$callbacks||(this.$callbacks=[]),R.OPERATION.ADD,N,q?this.$items:void 0)},N.prototype.ab=function(N){return y(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,N)},N.prototype.onChange=function(N){return y(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,N)},N.is=function(R){return void 0!==R.map},N.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(N.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(N,Symbol.species,{get:function(){return N},enumerable:!1,configurable:!0}),N.prototype.set=function(N,q){if(void 0===q||null===q)throw new Error("MapSchema#set('".concat(N,"', ").concat(q,"): trying to set ").concat(q," value on '").concat(N,"'."));N=N.toString();var w="undefined"!==typeof this.$changes.indexes[N],u=w?this.$changes.indexes[N]:this.$refId++,M=w?R.OPERATION.REPLACE:R.OPERATION.ADD,v=void 0!==q.$changes;if(v&&q.$changes.setParent(this,this.$changes.root,u),w){if(!v&&this.$items.get(N)===q)return;v&&this.$items.get(N)!==q&&(M=R.OPERATION.ADD)}else this.$changes.indexes[N]=u,this.$indexes.set(u,N);return this.$items.set(N,q),this.$changes.change(N,M),this},N.prototype.get=function(R){return this.$items.get(R)},N.prototype.delete=function(R){return this.$changes.delete(R),this.$items.delete(R)},N.prototype.clear=function(N){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),N&&a.call(this,N),this.$items.clear(),this.$changes.operation({index:0,op:R.OPERATION.CLEAR}),this.$changes.touchParents()},N.prototype.has=function(R){return this.$items.has(R)},N.prototype.forEach=function(R){this.$items.forEach(R)},N.prototype.entries=function(){return this.$items.entries()},N.prototype.keys=function(){return this.$items.keys()},N.prototype.values=function(){return this.$items.values()},Object.defineProperty(N.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),N.prototype.setIndex=function(R,N){this.$indexes.set(R,N)},N.prototype.getIndex=function(R){return this.$indexes.get(R)},N.prototype.getByIndex=function(R){return this.$items.get(this.$indexes.get(R))},N.prototype.deleteByIndex=function(R){var N=this.$indexes.get(R);this.$items.delete(N),this.$indexes.delete(R)},N.prototype.toJSON=function(){var R={};return this.forEach((function(N,q){R[q]="function"===typeof N.toJSON?N.toJSON():N})),R},N.prototype.clone=function(R){var q;return R?q=Object.assign(new N,this):(q=new N,this.forEach((function(R,N){R.$changes?q.set(N,R.clone()):q.set(N,R)}))),q},N}(),C={};function e(R,N){C[R]=N}function K(R){return C[R]}var r=function(){function R(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return R.create=function(N){var q=new R;return q.schema=Object.assign({},N&&N.schema||{}),q.indexes=Object.assign({},N&&N.indexes||{}),q.fieldsByIndex=Object.assign({},N&&N.fieldsByIndex||{}),q.descriptors=Object.assign({},N&&N.descriptors||{}),q.deprecated=Object.assign({},N&&N.deprecated||{}),q},R.prototype.addField=function(R,N){var q=this.getNextFieldIndex();this.fieldsByIndex[q]=R,this.indexes[R]=q,this.schema[R]=Array.isArray(N)?{array:N[0]}:N},R.prototype.hasField=function(R){return void 0!==this.indexes[R]},R.prototype.addFilter=function(R,N){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[R]]=N,this.indexesWithFilters.push(this.indexes[R]),!0},R.prototype.addChildrenFilter=function(R,N){var q=this.indexes[R],w=this.schema[R];if(K(Object.keys(w)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[q]=N,!0;console.warn("@filterChildren: field '".concat(R,"' can't have children. Ignoring filter."))},R.prototype.getChildrenFilter=function(R){return this.childFilters&&this.childFilters[this.indexes[R]]},R.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},R}();function Z(R){return R._context&&R._context.useFilters}var z=function(){function R(){this.types={},this.schemas=new Map,this.useFilters=!1}return R.prototype.has=function(R){return this.schemas.has(R)},R.prototype.get=function(R){return this.types[R]},R.prototype.add=function(R,N){void 0===N&&(N=this.schemas.size),R._definition=r.create(R._definition),R._typeid=N,this.types[N]=R,this.schemas.set(R,N)},R.create=function(N){return void 0===N&&(N={}),function(q){return N.context||(N.context=new R),x(q,N)}},R}(),d=new z;function x(R,N){return void 0===N&&(N={}),function(q,w){var M=N.context||d,v=q.constructor;if(v._context=M,!R)throw new Error("".concat(v.name,': @type() reference provided for "').concat(w,"\" is undefined. Make sure you don't have any circular dependencies."));M.has(v)||M.add(v);var G=v._definition;if(G.addField(w,R),G.descriptors[w]){if(G.deprecated[w])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(w,"' definition on '").concat(v.name,"'.\nCheck @type() annotation"))}catch(C){var J=C.stack.split("\n")[4].trim();throw new Error("".concat(C.message," ").concat(J))}}var y=H.is(R),a=!y&&k.is(R);if("string"!==typeof R&&!oR.is(R)){var j=Object.values(R)[0];"string"===typeof j||M.has(j)||M.add(j)}if(N.manual)G.descriptors[w]={enumerable:!0,configurable:!0,writable:!0};else{var F="_".concat(w);G.descriptors[F]={enumerable:!1,configurable:!1,writable:!0},G.descriptors[w]={get:function(){return this[F]},set:function(R){R!==this[F]&&(void 0!==R&&null!==R?(!y||R instanceof H||(R=new(H.bind.apply(H,u([void 0],R,!1)))),!a||R instanceof k||(R=new k(R)),void 0===R.$proxy&&(a?R=W(R):y&&(R=S(R))),this.$changes.change(w),R.$changes&&R.$changes.setParent(this,this.$changes.root,this._definition.indexes[w])):this[F]&&this.$changes.delete(w),this[F]=R)},enumerable:!0,configurable:!0}}}}function E(R){return function(N,q){var w=N.constructor;w._definition.addFilter(q,R)&&(w._context.useFilters=!0)}}function P(R){return function(N,q){var w=N.constructor;w._definition.addChildrenFilter(q,R)&&(w._context.useFilters=!0)}}function s(R){return void 0===R&&(R=!0),function(N,q){var w=N.constructor._definition;w.deprecated[q]=!0,R&&(w.descriptors[q]={get:function(){throw new Error("".concat(q," is deprecated."))},set:function(R){},enumerable:!1,configurable:!0})}}function O(R,N,q){for(var w in void 0===q&&(q={}),q.context||(q.context=R._context||q.context||d),N)x(N[w],q)(R.prototype,w);return R}function L(R){for(var N=0,q=0,w=0,u=R.length;w<u;w++)(N=R.charCodeAt(w))<128?q+=1:N<2048?q+=2:N<55296||N>=57344?q+=3:(w++,q+=4);return q}function m(R,N,q){for(var w=0,u=0,M=q.length;u<M;u++)(w=q.charCodeAt(u))<128?R[N++]=w:w<2048?(R[N++]=192|w>>6,R[N++]=128|63&w):w<55296||w>=57344?(R[N++]=224|w>>12,R[N++]=128|w>>6&63,R[N++]=128|63&w):(u++,w=65536+((1023&w)<<10|1023&q.charCodeAt(u)),R[N++]=240|w>>18,R[N++]=128|w>>12&63,R[N++]=128|w>>6&63,R[N++]=128|63&w)}function o(R,N){R.push(255&N)}function A(R,N){R.push(255&N)}function n(R,N){R.push(255&N),R.push(N>>8&255)}function Q(R,N){R.push(255&N),R.push(N>>8&255)}function Y(R,N){R.push(255&N),R.push(N>>8&255),R.push(N>>16&255),R.push(N>>24&255)}function T(R,N){var q=N>>24,w=N>>16,u=N>>8,M=N;R.push(255&M),R.push(255&u),R.push(255&w),R.push(255&q)}function f(R,N){var q=Math.floor(N/Math.pow(2,32));T(R,N>>>0),T(R,q)}function c(R,N){var q=N/Math.pow(2,32)|0;T(R,N>>>0),T(R,q)}function b(R,N){g(R,N)}function I(R,N){U(R,N)}var V=new Int32Array(2),t=new Float32Array(V.buffer),i=new Float64Array(V.buffer);function g(R,N){t[0]=N,Y(R,V[0])}function U(R,N){i[0]=N,Y(R,V[0]),Y(R,V[1])}function B(R,N){return A(R,N?1:0)}function l(R,N){N||(N="");var q=L(N),w=0;if(q<32)R.push(160|q),w=1;else if(q<256)R.push(217),A(R,q),w=2;else if(q<65536)R.push(218),Q(R,q),w=3;else{if(!(q<4294967296))throw new Error("String too long");R.push(219),T(R,q),w=5}return m(R,R.length,N),w+q}function X(R,N){return isNaN(N)?X(R,0):isFinite(N)?N!==(0|N)?(R.push(203),U(R,N),9):N>=0?N<128?(A(R,N),1):N<256?(R.push(204),A(R,N),2):N<65536?(R.push(205),Q(R,N),3):N<4294967296?(R.push(206),T(R,N),5):(R.push(207),c(R,N),9):N>=-32?(R.push(224|N+32),1):N>=-128?(R.push(208),o(R,N),2):N>=-32768?(R.push(209),n(R,N),3):N>=-2147483648?(R.push(210),Y(R,N),5):(R.push(211),f(R,N),9):X(R,N>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var h=Object.freeze({__proto__:null,utf8Write:m,int8:o,uint8:A,int16:n,uint16:Q,int32:Y,uint32:T,int64:f,uint64:c,float32:b,float64:I,writeFloat32:g,writeFloat64:U,boolean:B,string:l,number:X});function D(R,N,q){for(var w="",u=0,M=N,v=N+q;M<v;M++){var G=R[M];0!==(128&G)?192!==(224&G)?224!==(240&G)?240!==(248&G)?console.error("Invalid byte "+G.toString(16)):(u=(7&G)<<18|(63&R[++M])<<12|(63&R[++M])<<6|63&R[++M])>=65536?(u-=65536,w+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):w+=String.fromCharCode(u):w+=String.fromCharCode((15&G)<<12|(63&R[++M])<<6|63&R[++M]):w+=String.fromCharCode((31&G)<<6|63&R[++M]):w+=String.fromCharCode(G)}return w}function p(R,N){return RR(R,N)<<24>>24}function RR(R,N){return R[N.offset++]}function NR(R,N){return qR(R,N)<<16>>16}function qR(R,N){return R[N.offset++]|R[N.offset++]<<8}function wR(R,N){return R[N.offset++]|R[N.offset++]<<8|R[N.offset++]<<16|R[N.offset++]<<24}function uR(R,N){return wR(R,N)>>>0}function MR(R,N){return FR(R,N)}function vR(R,N){return SR(R,N)}function GR(R,N){var q=uR(R,N);return wR(R,N)*Math.pow(2,32)+q}function JR(R,N){var q=uR(R,N);return uR(R,N)*Math.pow(2,32)+q}var yR=new Int32Array(2),aR=new Float32Array(yR.buffer),jR=new Float64Array(yR.buffer);function FR(R,N){return yR[0]=wR(R,N),aR[0]}function SR(R,N){return yR[0]=wR(R,N),yR[1]=wR(R,N),jR[0]}function HR(R,N){return RR(R,N)>0}function WR(R,N){var q,w=R[N.offset++];w<192?q=31&w:217===w?q=RR(R,N):218===w?q=qR(R,N):219===w&&(q=uR(R,N));var u=D(R,N.offset,q);return N.offset+=q,u}function kR(R,N){var q=R[N.offset];return q<192&&q>160||217===q||218===q||219===q}function CR(R,N){var q=R[N.offset++];return q<128?q:202===q?FR(R,N):203===q?SR(R,N):204===q?RR(R,N):205===q?qR(R,N):206===q?uR(R,N):207===q?JR(R,N):208===q?p(R,N):209===q?NR(R,N):210===q?wR(R,N):211===q?GR(R,N):q>223?-1*(255-q+1):void 0}function eR(R,N){var q=R[N.offset];return q<128||q>=202&&q<=211}function KR(R,N){return R[N.offset]<160}function rR(R,N){return R[N.offset-1]===v&&(R[N.offset]<128||R[N.offset]>=202&&R[N.offset]<=211)}var ZR=Object.freeze({__proto__:null,int8:p,uint8:RR,int16:NR,uint16:qR,int32:wR,uint32:uR,float32:MR,float64:vR,int64:GR,uint64:JR,readFloat32:FR,readFloat64:SR,boolean:HR,string:WR,stringCheck:kR,number:CR,numberCheck:eR,arrayCheck:KR,switchStructureCheck:rR}),zR=function(){function N(R){var N=this;this.$changes=new J(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,R&&R.forEach((function(R){return N.add(R)}))}return N.prototype.Mf=function(N,q){return void 0===q&&(q=!0),y(this.$callbacks||(this.$callbacks=[]),R.OPERATION.ADD,N,q?this.$items:void 0)},N.prototype.ab=function(N){return y(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,N)},N.prototype.onChange=function(N){return y(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,N)},N.is=function(R){return void 0!==R.collection},N.prototype.add=function(R){var N=this.$refId++;return void 0!==R.$changes&&R.$changes.setParent(this,this.$changes.root,N),this.$changes.indexes[N]=N,this.$indexes.set(N,N),this.$items.set(N,R),this.$changes.change(N),N},N.prototype.at=function(R){var N=Array.from(this.$items.keys())[R];return this.$items.get(N)},N.prototype.entries=function(){return this.$items.entries()},N.prototype.delete=function(R){for(var N,q,w=this.$items.entries();(q=w.next())&&!q.done;)if(R===q.value[1]){N=q.value[0];break}return void 0!==N&&(this.$changes.delete(N),this.$indexes.delete(N),this.$items.delete(N))},N.prototype.clear=function(N){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),N&&a.call(this,N),this.$items.clear(),this.$changes.operation({index:0,op:R.OPERATION.CLEAR}),this.$changes.touchParents()},N.prototype.has=function(R){return Array.from(this.$items.values()).some((function(N){return N===R}))},N.prototype.forEach=function(R){var N=this;this.$items.forEach((function(q,w,u){return R(q,w,N)}))},N.prototype.values=function(){return this.$items.values()},Object.defineProperty(N.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),N.prototype.setIndex=function(R,N){this.$indexes.set(R,N)},N.prototype.getIndex=function(R){return this.$indexes.get(R)},N.prototype.getByIndex=function(R){return this.$items.get(this.$indexes.get(R))},N.prototype.deleteByIndex=function(R){var N=this.$indexes.get(R);this.$items.delete(N),this.$indexes.delete(R)},N.prototype.toArray=function(){return Array.from(this.$items.values())},N.prototype.toJSON=function(){var R=[];return this.forEach((function(N,q){R.push("function"===typeof N.toJSON?N.toJSON():N)})),R},N.prototype.clone=function(R){var q;return R?q=Object.assign(new N,this):(q=new N,this.forEach((function(R){R.$changes?q.add(R.clone()):q.add(R)}))),q},N}(),dR=function(){function N(R){var N=this;this.$changes=new J(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,R&&R.forEach((function(R){return N.add(R)}))}return N.prototype.Mf=function(N,q){return void 0===q&&(q=!0),y(this.$callbacks||(this.$callbacks=[]),R.OPERATION.ADD,N,q?this.$items:void 0)},N.prototype.ab=function(N){return y(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,N)},N.prototype.onChange=function(N){return y(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,N)},N.is=function(R){return void 0!==R.set},N.prototype.add=function(N){var q,w;if(this.has(N))return!1;var u=this.$refId++;void 0!==N.$changes&&N.$changes.setParent(this,this.$changes.root,u);var M=null!==(w=null===(q=this.$changes.indexes[u])||void 0===q?void 0:q.op)&&void 0!==w?w:R.OPERATION.ADD;return this.$changes.indexes[u]=u,this.$indexes.set(u,u),this.$items.set(u,N),this.$changes.change(u,M),u},N.prototype.entries=function(){return this.$items.entries()},N.prototype.delete=function(R){for(var N,q,w=this.$items.entries();(q=w.next())&&!q.done;)if(R===q.value[1]){N=q.value[0];break}return void 0!==N&&(this.$changes.delete(N),this.$indexes.delete(N),this.$items.delete(N))},N.prototype.clear=function(N){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),N&&a.call(this,N),this.$items.clear(),this.$changes.operation({index:0,op:R.OPERATION.CLEAR}),this.$changes.touchParents()},N.prototype.has=function(R){for(var N,q=this.$items.values(),w=!1;(N=q.next())&&!N.done;)if(R===N.value){w=!0;break}return w},N.prototype.forEach=function(R){var N=this;this.$items.forEach((function(q,w,u){return R(q,w,N)}))},N.prototype.values=function(){return this.$items.values()},Object.defineProperty(N.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),N.prototype.setIndex=function(R,N){this.$indexes.set(R,N)},N.prototype.getIndex=function(R){return this.$indexes.get(R)},N.prototype.getByIndex=function(R){return this.$items.get(this.$indexes.get(R))},N.prototype.deleteByIndex=function(R){var N=this.$indexes.get(R);this.$items.delete(N),this.$indexes.delete(R)},N.prototype.toArray=function(){return Array.from(this.$items.values())},N.prototype.toJSON=function(){var R=[];return this.forEach((function(N,q){R.push("function"===typeof N.toJSON?N.toJSON():N)})),R},N.prototype.clone=function(R){var q;return R?q=Object.assign(new N,this):(q=new N,this.forEach((function(R){R.$changes?q.add(R.clone()):q.add(R)}))),q},N}(),xR=function(){function R(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return R.prototype.addRefId=function(R){this.refIds.has(R)||(this.refIds.add(R),this.containerIndexes.set(R,new Set))},R.get=function(N){return void 0===N.$filterState&&(N.$filterState=new R),N.$filterState},R}(),ER=function(){function R(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return R.prototype.getNextUniqueId=function(){return this.nextUniqueId++},R.prototype.addRef=function(R,N,q){void 0===q&&(q=!0),this.refs.set(R,N),q&&(this.refCounts[R]=(this.refCounts[R]||0)+1)},R.prototype.removeRef=function(R){this.refCounts[R]=this.refCounts[R]-1,this.deletedRefs.add(R)},R.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},R.prototype.garbageCollectDeletedRefs=function(){var R=this;this.deletedRefs.forEach((function(N){if(!(R.refCounts[N]>0)){var q=R.refs.get(N);if(q instanceof oR)for(var w in q._definition.schema)"string"!==typeof q._definition.schema[w]&&q[w]&&q[w].$changes&&R.removeRef(q[w].$changes.refId);else{var u=q.$changes.parent._definition,M=u.schema[u.fieldsByIndex[q.$changes.parentIndex]];"function"===typeof Object.values(M)[0]&&Array.from(q.values()).forEach((function(N){return R.removeRef(N.$changes.refId)}))}R.refs.delete(N),delete R.refCounts[N]}})),this.deletedRefs.clear()},R}(),PR=function(R){function N(){return null!==R&&R.apply(this,arguments)||this}return q(N,R),N}(Error);function sR(R,N,q,w){var u,M=!1;switch(N){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":u="number",isNaN(R)&&console.log('trying to encode "NaN" in '.concat(q.constructor.name,"#").concat(w));break;case"string":u="string",M=!0;break;case"boolean":return}if(typeof R!==u&&(!M||M&&null!==R)){var v="'".concat(JSON.stringify(R),"'").concat(R&&R.constructor&&" (".concat(R.constructor.name,")")||"");throw new PR("a '".concat(u,"' was expected, but ").concat(v," was provided in ").concat(q.constructor.name,"#").concat(w))}}function OR(R,N,q,w){if(!(R instanceof N))throw new PR("a '".concat(N.name,"' was expected, but '").concat(R.constructor.name,"' was provided in ").concat(q.constructor.name,"#").concat(w))}function LR(R,N,q,w,u){sR(q,R,w,u);var M=h[R];if(!M)throw new PR("a '".concat(R,"' was expected, but ").concat(q," was provided in ").concat(w.constructor.name,"#").concat(u));M(N,q)}function mR(R,N,q){return ZR[R](N,q)}var oR=function(){function N(){for(var R=[],N=0;N<arguments.length;N++)R[N]=arguments[N];Object.defineProperties(this,{$changes:{value:new J(this,void 0,new ER),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var q=this._definition.descriptors;q&&Object.defineProperties(this,q),R[0]&&this.assign(R[0])}return N.onError=function(R){console.error(R)},N.is=function(R){return R._definition&&void 0!==R._definition.schema},N.prototype.onChange=function(N){return y(this.$callbacks||(this.$callbacks=[]),R.OPERATION.REPLACE,N)},N.prototype.ab=function(N){return y(this.$callbacks||(this.$callbacks=[]),R.OPERATION.DELETE,N)},N.prototype.assign=function(R){return Object.assign(this,R),this},Object.defineProperty(N.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),N.prototype.setDirty=function(R,N){this.$changes.change(R,N)},N.prototype.listen=function(R,N,q){var w=this;return void 0===q&&(q=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[R]||(this.$callbacks[R]=[]),this.$callbacks[R].push(N),q&&void 0!==this[R]&&N(this[R],void 0),function(){return j(w.$callbacks[R],w.$callbacks[R].indexOf(N))}},N.prototype.decode=function(q,w,u){var M;void 0===w&&(w={offset:0}),void 0===u&&(u=this);var G=[],J=this.$changes.root,y=q.length,a=0;for(J.refs.set(a,this);w.offset<y;){var j=q[w.offset++];if(j!=v){var F=u.$changes,S=void 0!==u._definition,W=S?j>>6<<6:j;if(W!==R.OPERATION.CLEAR){var C=S?j%(W||255):CR(q,w),e=S?u._definition.fieldsByIndex[C]:"",r=F.getType(C),Z=void 0,z=void 0,d=void 0;if(S?z=u["_".concat(e)]:(z=u.getByIndex(C),(W&R.OPERATION.ADD)===R.OPERATION.ADD?(d=u instanceof k?WR(q,w):C,u.setIndex(C,d)):d=u.getIndex(C)),(W&R.OPERATION.DELETE)===R.OPERATION.DELETE&&(W!==R.OPERATION.DELETE_AND_ADD&&u.deleteByIndex(C),z&&z.$changes&&J.removeRef(z.$changes.refId),Z=null),void 0!==e){if(W===R.OPERATION.DELETE);else if(N.is(r)){var x=CR(q,w);if(Z=J.refs.get(x),W!==R.OPERATION.REPLACE){var E=this.getSchemaType(q,w,r);Z||((Z=this.createTypeInstance(E)).$changes.refId=x,z&&(Z.$callbacks=z.$callbacks,z.$changes.refId&&x!==z.$changes.refId&&J.removeRef(z.$changes.refId))),J.addRef(x,Z,Z!==z)}}else if("string"===typeof r)Z=mR(r,q,w);else{var P=K(Object.keys(r)[0]),s=CR(q,w),O=J.refs.has(s)?z||J.refs.get(s):new P.constructor;if((Z=O.clone(!0)).$changes.refId=s,z&&(Z.$callbacks=z.$callbacks,z.$changes.refId&&s!==z.$changes.refId)){J.removeRef(z.$changes.refId);for(var L=z.entries(),m=void 0;(m=L.next())&&!m.done;){var o=(M=m.value)[0],A=M[1];G.push({refId:s,op:R.OPERATION.DELETE,field:o,value:void 0,previousValue:A})}}J.addRef(s,Z,O!==z)}if(null!==Z&&void 0!==Z)if(Z.$changes&&Z.$changes.setParent(F.ref,F.root,C),u instanceof N)u[e]=Z;else if(u instanceof k)o=d,u.$items.set(o,Z),u.$changes.allChanges.add(C);else if(u instanceof H)u.setAt(C,Z);else if(u instanceof zR){var n=u.add(Z);u.setIndex(C,n)}else u instanceof dR&&!1!==(n=u.add(Z))&&u.setIndex(C,n);z!==Z&&G.push({refId:a,op:W,field:e,dynamicIndex:d,value:Z,previousValue:z})}else{console.warn("@colyseus/schema: definition mismatch");for(var Q={offset:w.offset};w.offset<y&&(!rR(q,w)||(Q.offset=w.offset+1,!J.refs.has(CR(q,Q))));)w.offset++}}else u.clear(G)}else{a=CR(q,w);var Y=J.refs.get(a);if(!Y)throw new Error('"refId" not found: '.concat(a));u=Y}}return this._triggerChanges(G),J.garbageCollectDeletedRefs(),G},N.prototype.encode=function(q,w,u){void 0===q&&(q=!1),void 0===w&&(w=[]),void 0===u&&(u=!1);for(var M=this.$changes,G=new WeakSet,J=[M],y=1,a=0;a<y;a++){var j=J[a],F=j.ref,S=F instanceof N;j.ensureRefId(),G.add(j),j!==M&&(j.changed||q)&&(A(w,v),X(w,j.refId));for(var H=q?Array.from(j.allChanges):Array.from(j.changes.values()),W=0,C=H.length;W<C;W++){var e=q?{op:R.OPERATION.ADD,index:H[W]}:H[W],r=e.index,Z=S?F._definition.fieldsByIndex&&F._definition.fieldsByIndex[r]:r,z=w.length;if(e.op!==R.OPERATION.TOUCH)if(S)A(w,r|e.op);else{if(A(w,e.op),e.op===R.OPERATION.CLEAR)continue;X(w,r)}if(S||(e.op&R.OPERATION.ADD)!=R.OPERATION.ADD||F instanceof k&&l(w,j.ref.$indexes.get(r)),e.op!==R.OPERATION.DELETE){var d=j.getType(r),x=j.getValue(r);if(x&&x.$changes&&!G.has(x.$changes)&&(J.push(x.$changes),x.$changes.ensureRefId(),y++),e.op!==R.OPERATION.TOUCH){if(N.is(d))OR(x,d,F,Z),X(w,x.$changes.refId),(e.op&R.OPERATION.ADD)===R.OPERATION.ADD&&this.tryEncodeTypeId(w,d,x.constructor);else if("string"===typeof d)LR(d,w,x,F,Z);else{var E=K(Object.keys(d)[0]);OR(F["_".concat(Z)],E.constructor,F,Z),X(w,x.$changes.refId)}u&&j.cache(r,w.slice(z))}}}q||u||j.discard()}return w},N.prototype.encodeAll=function(R){return this.encode(!0,[],R)},N.prototype.applyFilters=function(q,w){var u,M;void 0===w&&(w=!1);for(var G=this,J=new Set,y=xR.get(q),a=[this.$changes],j=1,F=[],S=function(S){var H=a[S];if(J.has(H.refId))return"continue";var W=H.ref,C=W instanceof N;A(F,v),X(F,H.refId);var e=y.refIds.has(H),K=w||!e;y.addRefId(H);var r=y.containerIndexes.get(H),Z=K?Array.from(H.allChanges):Array.from(H.changes.values());!w&&C&&W._definition.indexesWithFilters&&W._definition.indexesWithFilters.forEach((function(N){!r.has(N)&&H.allChanges.has(N)&&(K?Z.push(N):Z.push({op:R.OPERATION.ADD,index:N}))}));for(var z=0,d=Z.length;z<d;z++){var x=K?{op:R.OPERATION.ADD,index:Z[z]}:Z[z];if(x.op!==R.OPERATION.CLEAR){var E=x.index;if(x.op!==R.OPERATION.DELETE){var P=H.getValue(E),s=H.getType(E);if(C){if((O=W._definition.filters&&W._definition.filters[E])&&!O.call(W,q,P,G)){P&&P.$changes&&J.add(P.$changes.refId);continue}}else{var O,L=H.parent;if((O=H.getChildrenFilter())&&!O.call(L,q,W.$indexes.get(E),P,G)){P&&P.$changes&&J.add(P.$changes.refId);continue}}if(P.$changes&&(a.push(P.$changes),j++),x.op!==R.OPERATION.TOUCH)if(x.op===R.OPERATION.ADD||C)F.push.apply(F,null!==(u=H.caches[E])&&void 0!==u?u:[]),r.add(E);else if(r.has(E))F.push.apply(F,null!==(M=H.caches[E])&&void 0!==M?M:[]);else{if(r.add(E),A(F,R.OPERATION.ADD),X(F,E),W instanceof k){var m=H.ref.$indexes.get(E);l(F,m)}P.$changes?X(F,P.$changes.refId):h[s](F,P)}else P.$changes&&!C&&(A(F,R.OPERATION.ADD),X(F,E),W instanceof k&&(m=H.ref.$indexes.get(E),l(F,m)),X(F,P.$changes.refId))}else C?A(F,x.op|E):(A(F,x.op),X(F,E))}else A(F,x.op)}},H=0;H<j;H++)S(H);return F},N.prototype.clone=function(){var R,N=new this.constructor,q=this._definition.schema;for(var w in q)"object"===typeof this[w]&&"function"===typeof(null===(R=this[w])||void 0===R?void 0:R.clone)?N[w]=this[w].clone():N[w]=this[w];return N},N.prototype.toJSON=function(){var R=this._definition.schema,N=this._definition.deprecated,q={};for(var w in R)N[w]||null===this[w]||"undefined"===typeof this[w]||(q[w]="function"===typeof this[w].toJSON?this[w].toJSON():this["_".concat(w)]);return q},N.prototype.discardAllChanges=function(){this.$changes.discardAll()},N.prototype.getByIndex=function(R){return this[this._definition.fieldsByIndex[R]]},N.prototype.deleteByIndex=function(R){this[this._definition.fieldsByIndex[R]]=void 0},N.prototype.tryEncodeTypeId=function(R,N,q){N._typeid!==q._typeid&&(A(R,G),X(R,q._typeid))},N.prototype.getSchemaType=function(R,N,q){var w;return R[N.offset]===G&&(N.offset++,w=this.constructor._context.get(CR(R,N))),w||q},N.prototype.createTypeInstance=function(R){var N=new R;return N.$changes.root=this.$changes.root,N},N.prototype._triggerChanges=function(q){for(var w,u,M,v,G,J,y,a,j,F=new Set,S=this.$changes.root.refs,H=function(H){var W=q[H],k=W.refId,C=S.get(k),e=C.$callbacks;if((W.op&R.OPERATION.DELETE)===R.OPERATION.DELETE&&W.previousValue instanceof N&&(null===(u=null===(w=W.previousValue.$callbacks)||void 0===w?void 0:w[R.OPERATION.DELETE])||void 0===u||u.forEach((function(R){return R()}))),!e)return"continue";if(C instanceof N){if(!F.has(k))try{null===(M=null===e||void 0===e?void 0:e[R.OPERATION.REPLACE])||void 0===M||M.forEach((function(R){return R()}))}catch(K){N.onError(K)}try{e.hasOwnProperty(W.field)&&(null===(v=e[W.field])||void 0===v||v.forEach((function(R){return R(W.value,W.previousValue)})))}catch(K){N.onError(K)}}else W.op===R.OPERATION.ADD&&void 0===W.previousValue?null===(G=e[R.OPERATION.ADD])||void 0===G||G.forEach((function(R){var N;return R(W.value,null!==(N=W.dynamicIndex)&&void 0!==N?N:W.field)})):W.op===R.OPERATION.DELETE?void 0!==W.previousValue&&(null===(J=e[R.OPERATION.DELETE])||void 0===J||J.forEach((function(R){var N;return R(W.previousValue,null!==(N=W.dynamicIndex)&&void 0!==N?N:W.field)}))):W.op===R.OPERATION.DELETE_AND_ADD&&(void 0!==W.previousValue&&(null===(y=e[R.OPERATION.DELETE])||void 0===y||y.forEach((function(R){var N;return R(W.previousValue,null!==(N=W.dynamicIndex)&&void 0!==N?N:W.field)}))),null===(a=e[R.OPERATION.ADD])||void 0===a||a.forEach((function(R){var N;return R(W.value,null!==(N=W.dynamicIndex)&&void 0!==N?N:W.field)}))),W.value!==W.previousValue&&(null===(j=e[R.OPERATION.REPLACE])||void 0===j||j.forEach((function(R){var N;return R(W.value,null!==(N=W.dynamicIndex)&&void 0!==N?N:W.field)})));F.add(k)},W=0;W<q.length;W++)H(W)},N._definition=r.create(),N}();function AR(R){for(var N=[R.$changes],q=1,w={},u=w,M=function(R){var q=N[R];q.changes.forEach((function(R){var N=q.ref,w=R.index,M=N._definition?N._definition.fieldsByIndex[w]:N.$indexes.get(w);u[M]=q.getValue(w)}))},v=0;v<q;v++)M(v);return w}var nR={context:new z},QR=function(R){function N(){return null!==R&&R.apply(this,arguments)||this}return q(N,R),w([x("string",nR)],N.prototype,"name",void 0),w([x("string",nR)],N.prototype,"type",void 0),w([x("number",nR)],N.prototype,"referencedType",void 0),N}(oR),YR=function(R){function N(){var N=null!==R&&R.apply(this,arguments)||this;return N.fields=new H,N}return q(N,R),w([x("number",nR)],N.prototype,"id",void 0),w([x([QR],nR)],N.prototype,"fields",void 0),N}(oR),TR=function(R){function N(){var N=null!==R&&R.apply(this,arguments)||this;return N.types=new H,N}return q(N,R),N.encode=function(R){var q=R.constructor,w=new N;w.rootType=q._typeid;var u=function(R,N){for(var q in N){var u=new QR;u.name=q;var M=void 0;if("string"===typeof N[q])M=N[q];else{var v=N[q],G=void 0;oR.is(v)?(M="ref",G=N[q]):"string"===typeof v[M=Object.keys(v)[0]]?M+=":"+v[M]:G=v[M],u.referencedType=G?G._typeid:-1}u.type=M,R.fields.push(u)}w.types.push(R)},M=q._context.types;for(var v in M){var G=new YR;G.id=Number(v),u(G,M[v]._definition.schema)}return w.encodeAll()},N.decode=function(R,w){var u=new z,M=new N;M.decode(R,w);var v=M.types.reduce((function(R,N){var w=function(R){function N(){return null!==R&&R.apply(this,arguments)||this}return q(N,R),N}(oR),M=N.id;return R[M]=w,u.add(w,M),R}),{});M.types.forEach((function(R){var N=v[R.id];R.fields.forEach((function(R){var q;if(void 0!==R.referencedType){var w=R.type,M=v[R.referencedType];if(!M){var G=R.type.split(":");w=G[0],M=G[1]}"ref"===w?x(M,{context:u})(N.prototype,R.name):x(((q={})[w]=M,q),{context:u})(N.prototype,R.name)}else x(R.type,{context:u})(N.prototype,R.name)}))}));var G=v[M.rootType],J=new G;for(var y in G._definition.schema){var a=G._definition.schema[y];"string"!==typeof a&&(J[y]="function"===typeof a?new a:new(K(Object.keys(a)[0]).constructor))}return J},w([x([YR],nR)],N.prototype,"types",void 0),w([x("number",nR)],N.prototype,"rootType",void 0),N}(oR);e("map",{constructor:k}),e("array",{constructor:H}),e("set",{constructor:dR}),e("collection",{constructor:zR}),R.ArraySchema=H,R.CollectionSchema=zR,R.Context=z,R.MapSchema=k,R.Reflection=TR,R.ReflectionField=QR,R.ReflectionType=YR,R.Schema=oR,R.SchemaDefinition=r,R.SetSchema=dR,R.decode=ZR,R.defineTypes=O,R.deprecated=s,R.dumpChanges=AR,R.encode=h,R.filter=E,R.filterChildren=P,R.hasFilter=Z,R.registerType=e,R.type=x,Object.defineProperty(R,"__esModule",{value:!0})}(N)},12298:R=>{"use strict";R.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12296:(R,N,q)=>{var w=q(12298),u=q(12301),M=Object.hasOwnProperty,v=Object.create(null);for(var G in w)M.call(w,G)&&(v[w[G]]=G);var J=R.exports={to:{},get:{}};function y(R,N,q){return Math.min(Math.max(N,R),q)}function a(R){var N=Math.round(R).toString(16).toUpperCase();return N.length<2?"0"+N:N}J.get=function(R){var N,q;switch(R.substring(0,3).toLowerCase()){case"hsl":N=J.get.hsl(R),q="hsl";break;case"hwb":N=J.get.hwb(R),q="hwb";break;default:N=J.get.rgb(R),q="rgb"}return N?{model:q,value:N}:null},J.get.rgb=function(R){if(!R)return null;var N,q,u,v=[0,0,0,1];if(N=R.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(u=N[2],N=N[1],q=0;q<3;q++){var G=2*q;v[q]=parseInt(N.slice(G,G+2),16)}u&&(v[3]=parseInt(u,16)/255)}else if(N=R.match(/^#([a-f0-9]{3,4})$/i)){for(u=(N=N[1])[3],q=0;q<3;q++)v[q]=parseInt(N[q]+N[q],16);u&&(v[3]=parseInt(u+u,16)/255)}else if(N=R.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(q=0;q<3;q++)v[q]=parseInt(N[q+1],0);N[4]&&(N[5]?v[3]=.01*parseFloat(N[4]):v[3]=parseFloat(N[4]))}else{if(!(N=R.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(N=R.match(/^(\w+)$/))?"transparent"===N[1]?[0,0,0,0]:M.call(w,N[1])?((v=w[N[1]])[3]=1,v):null:null;for(q=0;q<3;q++)v[q]=Math.round(2.55*parseFloat(N[q+1]));N[4]&&(N[5]?v[3]=.01*parseFloat(N[4]):v[3]=parseFloat(N[4]))}for(q=0;q<3;q++)v[q]=y(v[q],0,255);return v[3]=y(v[3],0,1),v},J.get.hsl=function(R){if(!R)return null;var N=R.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(N){var q=parseFloat(N[4]);return[(parseFloat(N[1])%360+360)%360,y(parseFloat(N[2]),0,100),y(parseFloat(N[3]),0,100),y(isNaN(q)?1:q,0,1)]}return null},J.get.hwb=function(R){if(!R)return null;var N=R.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(N){var q=parseFloat(N[4]);return[(parseFloat(N[1])%360+360)%360,y(parseFloat(N[2]),0,100),y(parseFloat(N[3]),0,100),y(isNaN(q)?1:q,0,1)]}return null},J.to.hex=function(){var R=u(arguments);return"#"+a(R[0])+a(R[1])+a(R[2])+(R[3]<1?a(Math.round(255*R[3])):"")},J.to.rgb=function(){var R=u(arguments);return R.length<4||1===R[3]?"rgb("+Math.round(R[0])+", "+Math.round(R[1])+", "+Math.round(R[2])+")":"rgba("+Math.round(R[0])+", "+Math.round(R[1])+", "+Math.round(R[2])+", "+R[3]+")"},J.to.rgb.percent=function(){var R=u(arguments),N=Math.round(R[0]/255*100),q=Math.round(R[1]/255*100),w=Math.round(R[2]/255*100);return R.length<4||1===R[3]?"rgb("+N+"%, "+q+"%, "+w+"%)":"rgba("+N+"%, "+q+"%, "+w+"%, "+R[3]+")"},J.to.hsl=function(){var R=u(arguments);return R.length<4||1===R[3]?"hsl("+R[0]+", "+R[1]+"%, "+R[2]+"%)":"hsla("+R[0]+", "+R[1]+"%, "+R[2]+"%, "+R[3]+")"},J.to.hwb=function(){var R=u(arguments),N="";return R.length>=4&&1!==R[3]&&(N=", "+R[3]),"hwb("+R[0]+", "+R[1]+"%, "+R[2]+"%"+N+")"},J.to.keyword=function(R){return v[R.slice(0,3)]}},12290:(R,N,q)=>{const w=q(12296),u=q(12318),M=["keyword","gray","hex"],v={};for(const S of Object.keys(u))v[[...u[S].labels].sort().join("")]=S;const G={};function J(R,N){if(!(this instanceof J))return new J(R,N);if(N&&N in M&&(N=null),N&&!(N in u))throw new Error("Unknown model: "+N);let q,y;if(null==R)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(R instanceof J)this.model=R.model,this.color=[...R.color],this.valpha=R.valpha;else if("string"===typeof R){const N=w.get(R);if(null===N)throw new Error("Unable to parse color from string: "+R);this.model=N.model,y=u[this.model].channels,this.color=N.value.slice(0,y),this.valpha="number"===typeof N.value[y]?N.value[y]:1}else if(R.length>0){this.model=N||"rgb",y=u[this.model].channels;const q=Array.prototype.slice.call(R,0,y);this.color=F(q,y),this.valpha="number"===typeof R[y]?R[y]:1}else if("number"===typeof R)this.model="rgb",this.color=[R>>16&255,R>>8&255,255&R],this.valpha=1;else{this.valpha=1;const N=Object.keys(R);"alpha"in R&&(N.splice(N.indexOf("alpha"),1),this.valpha="number"===typeof R.alpha?R.alpha:0);const w=N.sort().join("");if(!(w in v))throw new Error("Unable to parse color from object: "+JSON.stringify(R));this.model=v[w];const{labels:M}=u[this.model],G=[];for(q=0;q<M.length;q++)G.push(R[M[q]]);this.color=F(G)}if(G[this.model])for(y=u[this.model].channels,q=0;q<y;q++){const R=G[this.model][q];R&&(this.color[q]=R(this.color[q]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}J.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(R){let N=this.model in w.to?this:this.rgb();N=N.round("number"===typeof R?R:1);const q=1===N.valpha?N.color:[...N.color,this.valpha];return w.to[N.model](q)},percentString(R){const N=this.rgb().round("number"===typeof R?R:1),q=1===N.valpha?N.color:[...N.color,this.valpha];return w.to.rgb.percent(q)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const R={},{channels:N}=u[this.model],{labels:q}=u[this.model];for(let w=0;w<N;w++)R[q[w]]=this.color[w];return 1!==this.valpha&&(R.alpha=this.valpha),R},unitArray(){const R=this.rgb().color;return R[0]/=255,R[1]/=255,R[2]/=255,1!==this.valpha&&R.push(this.valpha),R},unitObject(){const R=this.rgb().object();return R.r/=255,R.g/=255,R.b/=255,1!==this.valpha&&(R.alpha=this.valpha),R},round(R){return R=Math.max(R||0,0),new J([...this.color.map(y(R)),this.valpha],this.model)},alpha(R){return void 0!==R?new J([...this.color,Math.max(0,Math.min(1,R))],this.model):this.valpha},red:a("rgb",0,j(255)),green:a("rgb",1,j(255)),blue:a("rgb",2,j(255)),hue:a(["hsl","hsv","hsl","hwb","hcg"],0,(R=>(R%360+360)%360)),saturationl:a("hsl",1,j(100)),lightness:a("hsl",2,j(100)),saturationv:a("hsv",1,j(100)),value:a("hsv",2,j(100)),chroma:a("hcg",1,j(100)),gray:a("hcg",2,j(100)),white:a("hwb",1,j(100)),wblack:a("hwb",2,j(100)),cyan:a("cmyk",0,j(100)),magenta:a("cmyk",1,j(100)),yellow:a("cmyk",2,j(100)),black:a("cmyk",3,j(100)),x:a("xyz",0,j(95.047)),y:a("xyz",1,j(100)),z:a("xyz",2,j(108.833)),l:a("lab",0,j(100)),a:a("lab",1),b:a("lab",2),keyword(R){return void 0!==R?new J(R):u[this.model].keyword(this.color)},hex(R){return void 0!==R?new J(R):w.to.hex(this.rgb().round().color)},hexa(R){if(void 0!==R)return new J(R);const N=this.rgb().round().color;let q=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===q.length&&(q="0"+q),w.to.hex(N)+q},rgbNumber(){const R=this.rgb().color;return(255&R[0])<<16|(255&R[1])<<8|255&R[2]},luminosity(){const R=this.rgb().color,N=[];for(const[q,w]of R.entries()){const R=w/255;N[q]=R<=.04045?R/12.92:((R+.055)/1.055)**2.4}return.2126*N[0]+.7152*N[1]+.0722*N[2]},contrast(R){const N=this.luminosity(),q=R.luminosity();return N>q?(N+.05)/(q+.05):(q+.05)/(N+.05)},level(R){const N=this.contrast(R);return N>=7?"AAA":N>=4.5?"AA":""},isDark(){const R=this.rgb().color;return(2126*R[0]+7152*R[1]+722*R[2])/1e4<128},isLight(){return!this.isDark()},negate(){const R=this.rgb();for(let N=0;N<3;N++)R.color[N]=255-R.color[N];return R},lighten(R){const N=this.hsl();return N.color[2]+=N.color[2]*R,N},darken(R){const N=this.hsl();return N.color[2]-=N.color[2]*R,N},saturate(R){const N=this.hsl();return N.color[1]+=N.color[1]*R,N},desaturate(R){const N=this.hsl();return N.color[1]-=N.color[1]*R,N},whiten(R){const N=this.hwb();return N.color[1]+=N.color[1]*R,N},blacken(R){const N=this.hwb();return N.color[2]+=N.color[2]*R,N},grayscale(){const R=this.rgb().color,N=.3*R[0]+.59*R[1]+.11*R[2];return J.rgb(N,N,N)},fade(R){return this.alpha(this.valpha-this.valpha*R)},opaquer(R){return this.alpha(this.valpha+this.valpha*R)},rotate(R){const N=this.hsl();let q=N.color[0];return q=(q+R)%360,q=q<0?360+q:q,N.color[0]=q,N},mix(R,N){if(!R||!R.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof R);const q=R.rgb(),w=this.rgb(),u=void 0===N?.5:N,M=2*u-1,v=q.alpha()-w.alpha(),G=((M*v===-1?M:(M+v)/(1+M*v))+1)/2,y=1-G;return J.rgb(G*q.red()+y*w.red(),G*q.green()+y*w.green(),G*q.blue()+y*w.blue(),q.alpha()*u+w.alpha()*(1-u))}};for(const S of Object.keys(u)){if(M.includes(S))continue;const{channels:R}=u[S];J.prototype[S]=function(){if(this.model===S)return new J(this);for(var R=arguments.length,N=new Array(R),q=0;q<R;q++)N[q]=arguments[q];return N.length>0?new J(N,S):new J([...(w=u[this.model][S].raw(this.color),Array.isArray(w)?w:[w]),this.valpha],S);var w},J[S]=function(){for(var N=arguments.length,q=new Array(N),w=0;w<N;w++)q[w]=arguments[w];let u=q[0];return"number"===typeof u&&(u=F(q,R)),new J(u,S)}}function y(R){return function(N){return function(R,N){return Number(R.toFixed(N))}(N,R)}}function a(R,N,q){R=Array.isArray(R)?R:[R];for(const w of R)(G[w]||(G[w]=[]))[N]=q;return R=R[0],function(w){let u;return void 0!==w?(q&&(w=q(w)),u=this[R](),u.color[N]=w,u):(u=this[R]().color[N],q&&(u=q(u)),u)}}function j(R){return function(N){return Math.max(0,Math.min(R,N))}}function F(R,N){for(let q=0;q<N;q++)"number"!==typeof R[q]&&(R[q]=0);return R}R.exports=J},12324:(R,N,q)=>{const w=q(12330),u={};for(const v of Object.keys(w))u[w[v]]=v;const M={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};R.exports=M;for(const v of Object.keys(M)){if(!("channels"in M[v]))throw new Error("missing channels property: "+v);if(!("labels"in M[v]))throw new Error("missing channel labels property: "+v);if(M[v].labels.length!==M[v].channels)throw new Error("channel and label counts mismatch: "+v);const{channels:R,labels:N}=M[v];delete M[v].channels,delete M[v].labels,Object.defineProperty(M[v],"channels",{value:R}),Object.defineProperty(M[v],"labels",{value:N})}M.rgb.hsl=function(R){const N=R[0]/255,q=R[1]/255,w=R[2]/255,u=Math.min(N,q,w),M=Math.max(N,q,w),v=M-u;let G,J;M===u?G=0:N===M?G=(q-w)/v:q===M?G=2+(w-N)/v:w===M&&(G=4+(N-q)/v),G=Math.min(60*G,360),G<0&&(G+=360);const y=(u+M)/2;return J=M===u?0:y<=.5?v/(M+u):v/(2-M-u),[G,100*J,100*y]},M.rgb.hsv=function(R){let N,q,w,u,M;const v=R[0]/255,G=R[1]/255,J=R[2]/255,y=Math.max(v,G,J),a=y-Math.min(v,G,J),j=function(R){return(y-R)/6/a+.5};return 0===a?(u=0,M=0):(M=a/y,N=j(v),q=j(G),w=j(J),v===y?u=w-q:G===y?u=1/3+N-w:J===y&&(u=2/3+q-N),u<0?u+=1:u>1&&(u-=1)),[360*u,100*M,100*y]},M.rgb.hwb=function(R){const N=R[0],q=R[1];let w=R[2];const u=M.rgb.hsl(R)[0],v=1/255*Math.min(N,Math.min(q,w));return w=1-1/255*Math.max(N,Math.max(q,w)),[u,100*v,100*w]},M.rgb.cmyk=function(R){const N=R[0]/255,q=R[1]/255,w=R[2]/255,u=Math.min(1-N,1-q,1-w);return[100*((1-N-u)/(1-u)||0),100*((1-q-u)/(1-u)||0),100*((1-w-u)/(1-u)||0),100*u]},M.rgb.keyword=function(R){const N=u[R];if(N)return N;let q,M=1/0;for(const u of Object.keys(w)){const N=w[u],J=(G=N,((v=R)[0]-G[0])**2+(v[1]-G[1])**2+(v[2]-G[2])**2);J<M&&(M=J,q=u)}var v,G;return q},M.keyword.rgb=function(R){return w[R]},M.rgb.xyz=function(R){let N=R[0]/255,q=R[1]/255,w=R[2]/255;N=N>.04045?((N+.055)/1.055)**2.4:N/12.92,q=q>.04045?((q+.055)/1.055)**2.4:q/12.92,w=w>.04045?((w+.055)/1.055)**2.4:w/12.92;return[100*(.4124*N+.3576*q+.1805*w),100*(.2126*N+.7152*q+.0722*w),100*(.0193*N+.1192*q+.9505*w)]},M.rgb.lab=function(R){const N=M.rgb.xyz(R);let q=N[0],w=N[1],u=N[2];q/=95.047,w/=100,u/=108.883,q=q>.008856?q**(1/3):7.787*q+16/116,w=w>.008856?w**(1/3):7.787*w+16/116,u=u>.008856?u**(1/3):7.787*u+16/116;return[116*w-16,500*(q-w),200*(w-u)]},M.hsl.rgb=function(R){const N=R[0]/360,q=R[1]/100,w=R[2]/100;let u,M,v;if(0===q)return v=255*w,[v,v,v];u=w<.5?w*(1+q):w+q-w*q;const G=2*w-u,J=[0,0,0];for(let y=0;y<3;y++)M=N+1/3*-(y-1),M<0&&M++,M>1&&M--,v=6*M<1?G+6*(u-G)*M:2*M<1?u:3*M<2?G+(u-G)*(2/3-M)*6:G,J[y]=255*v;return J},M.hsl.hsv=function(R){const N=R[0];let q=R[1]/100,w=R[2]/100,u=q;const M=Math.max(w,.01);w*=2,q*=w<=1?w:2-w,u*=M<=1?M:2-M;return[N,100*(0===w?2*u/(M+u):2*q/(w+q)),100*((w+q)/2)]},M.hsv.rgb=function(R){const N=R[0]/60,q=R[1]/100;let w=R[2]/100;const u=Math.floor(N)%6,M=N-Math.floor(N),v=255*w*(1-q),G=255*w*(1-q*M),J=255*w*(1-q*(1-M));switch(w*=255,u){case 0:return[w,J,v];case 1:return[G,w,v];case 2:return[v,w,J];case 3:return[v,G,w];case 4:return[J,v,w];case 5:return[w,v,G]}},M.hsv.hsl=function(R){const N=R[0],q=R[1]/100,w=R[2]/100,u=Math.max(w,.01);let M,v;v=(2-q)*w;const G=(2-q)*u;return M=q*u,M/=G<=1?G:2-G,M=M||0,v/=2,[N,100*M,100*v]},M.hwb.rgb=function(R){const N=R[0]/360;let q=R[1]/100,w=R[2]/100;const u=q+w;let M;u>1&&(q/=u,w/=u);const v=Math.floor(6*N),G=1-w;M=6*N-v,0!==(1&v)&&(M=1-M);const J=q+M*(G-q);let y,a,j;switch(v){default:case 6:case 0:y=G,a=J,j=q;break;case 1:y=J,a=G,j=q;break;case 2:y=q,a=G,j=J;break;case 3:y=q,a=J,j=G;break;case 4:y=J,a=q,j=G;break;case 5:y=G,a=q,j=J}return[255*y,255*a,255*j]},M.cmyk.rgb=function(R){const N=R[0]/100,q=R[1]/100,w=R[2]/100,u=R[3]/100;return[255*(1-Math.min(1,N*(1-u)+u)),255*(1-Math.min(1,q*(1-u)+u)),255*(1-Math.min(1,w*(1-u)+u))]},M.xyz.rgb=function(R){const N=R[0]/100,q=R[1]/100,w=R[2]/100;let u,M,v;return u=3.2406*N+-1.5372*q+-.4986*w,M=-.9689*N+1.8758*q+.0415*w,v=.0557*N+-.204*q+1.057*w,u=u>.0031308?1.055*u**(1/2.4)-.055:12.92*u,M=M>.0031308?1.055*M**(1/2.4)-.055:12.92*M,v=v>.0031308?1.055*v**(1/2.4)-.055:12.92*v,u=Math.min(Math.max(0,u),1),M=Math.min(Math.max(0,M),1),v=Math.min(Math.max(0,v),1),[255*u,255*M,255*v]},M.xyz.lab=function(R){let N=R[0],q=R[1],w=R[2];N/=95.047,q/=100,w/=108.883,N=N>.008856?N**(1/3):7.787*N+16/116,q=q>.008856?q**(1/3):7.787*q+16/116,w=w>.008856?w**(1/3):7.787*w+16/116;return[116*q-16,500*(N-q),200*(q-w)]},M.lab.xyz=function(R){let N,q,w;q=(R[0]+16)/116,N=R[1]/500+q,w=q-R[2]/200;const u=q**3,M=N**3,v=w**3;return q=u>.008856?u:(q-16/116)/7.787,N=M>.008856?M:(N-16/116)/7.787,w=v>.008856?v:(w-16/116)/7.787,N*=95.047,q*=100,w*=108.883,[N,q,w]},M.lab.lch=function(R){const N=R[0],q=R[1],w=R[2];let u;u=360*Math.atan2(w,q)/2/Math.PI,u<0&&(u+=360);return[N,Math.sqrt(q*q+w*w),u]},M.lch.lab=function(R){const N=R[0],q=R[1],w=R[2]/360*2*Math.PI;return[N,q*Math.cos(w),q*Math.sin(w)]},M.rgb.ansi16=function(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[q,w,u]=R;let v=null===N?M.rgb.hsv(R)[2]:N;if(v=Math.round(v/50),0===v)return 30;let G=30+(Math.round(u/255)<<2|Math.round(w/255)<<1|Math.round(q/255));return 2===v&&(G+=60),G},M.hsv.ansi16=function(R){return M.rgb.ansi16(M.hsv.rgb(R),R[2])},M.rgb.ansi256=function(R){const N=R[0],q=R[1],w=R[2];if(N===q&&q===w)return N<8?16:N>248?231:Math.round((N-8)/247*24)+232;return 16+36*Math.round(N/255*5)+6*Math.round(q/255*5)+Math.round(w/255*5)},M.ansi16.rgb=function(R){let N=R%10;if(0===N||7===N)return R>50&&(N+=3.5),N=N/10.5*255,[N,N,N];const q=.5*(1+~~(R>50));return[(1&N)*q*255,(N>>1&1)*q*255,(N>>2&1)*q*255]},M.ansi256.rgb=function(R){if(R>=232){const N=10*(R-232)+8;return[N,N,N]}let N;R-=16;return[Math.floor(R/36)/5*255,Math.floor((N=R%36)/6)/5*255,N%6/5*255]},M.rgb.hex=function(R){const N=(((255&Math.round(R[0]))<<16)+((255&Math.round(R[1]))<<8)+(255&Math.round(R[2]))).toString(16).toUpperCase();return"000000".substring(N.length)+N},M.hex.rgb=function(R){const N=R.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!N)return[0,0,0];let q=N[0];3===N[0].length&&(q=q.split("").map((R=>R+R)).join(""));const w=parseInt(q,16);return[w>>16&255,w>>8&255,255&w]},M.rgb.hcg=function(R){const N=R[0]/255,q=R[1]/255,w=R[2]/255,u=Math.max(Math.max(N,q),w),M=Math.min(Math.min(N,q),w),v=u-M;let G,J;return G=v<1?M/(1-v):0,J=v<=0?0:u===N?(q-w)/v%6:u===q?2+(w-N)/v:4+(N-q)/v,J/=6,J%=1,[360*J,100*v,100*G]},M.hsl.hcg=function(R){const N=R[1]/100,q=R[2]/100,w=q<.5?2*N*q:2*N*(1-q);let u=0;return w<1&&(u=(q-.5*w)/(1-w)),[R[0],100*w,100*u]},M.hsv.hcg=function(R){const N=R[1]/100,q=R[2]/100,w=N*q;let u=0;return w<1&&(u=(q-w)/(1-w)),[R[0],100*w,100*u]},M.hcg.rgb=function(R){const N=R[0]/360,q=R[1]/100,w=R[2]/100;if(0===q)return[255*w,255*w,255*w];const u=[0,0,0],M=N%1*6,v=M%1,G=1-v;let J=0;switch(Math.floor(M)){case 0:u[0]=1,u[1]=v,u[2]=0;break;case 1:u[0]=G,u[1]=1,u[2]=0;break;case 2:u[0]=0,u[1]=1,u[2]=v;break;case 3:u[0]=0,u[1]=G,u[2]=1;break;case 4:u[0]=v,u[1]=0,u[2]=1;break;default:u[0]=1,u[1]=0,u[2]=G}return J=(1-q)*w,[255*(q*u[0]+J),255*(q*u[1]+J),255*(q*u[2]+J)]},M.hcg.hsv=function(R){const N=R[1]/100,q=N+R[2]/100*(1-N);let w=0;return q>0&&(w=N/q),[R[0],100*w,100*q]},M.hcg.hsl=function(R){const N=R[1]/100,q=R[2]/100*(1-N)+.5*N;let w=0;return q>0&&q<.5?w=N/(2*q):q>=.5&&q<1&&(w=N/(2*(1-q))),[R[0],100*w,100*q]},M.hcg.hwb=function(R){const N=R[1]/100,q=N+R[2]/100*(1-N);return[R[0],100*(q-N),100*(1-q)]},M.hwb.hcg=function(R){const N=R[1]/100,q=1-R[2]/100,w=q-N;let u=0;return w<1&&(u=(q-w)/(1-w)),[R[0],100*w,100*u]},M.apple.rgb=function(R){return[R[0]/65535*255,R[1]/65535*255,R[2]/65535*255]},M.rgb.apple=function(R){return[R[0]/255*65535,R[1]/255*65535,R[2]/255*65535]},M.gray.rgb=function(R){return[R[0]/100*255,R[0]/100*255,R[0]/100*255]},M.gray.hsl=function(R){return[0,0,R[0]]},M.gray.hsv=M.gray.hsl,M.gray.hwb=function(R){return[0,100,R[0]]},M.gray.cmyk=function(R){return[0,0,0,R[0]]},M.gray.lab=function(R){return[R[0],0,0]},M.gray.hex=function(R){const N=255&Math.round(R[0]/100*255),q=((N<<16)+(N<<8)+N).toString(16).toUpperCase();return"000000".substring(q.length)+q},M.rgb.gray=function(R){return[(R[0]+R[1]+R[2])/3/255*100]}},12318:(R,N,q)=>{const w=q(12324),u=q(12336),M={};Object.keys(w).forEach((R=>{M[R]={},Object.defineProperty(M[R],"channels",{value:w[R].channels}),Object.defineProperty(M[R],"labels",{value:w[R].labels});const N=u(R);Object.keys(N).forEach((q=>{const w=N[q];M[R][q]=function(R){const N=function(){for(var N=arguments.length,q=new Array(N),w=0;w<N;w++)q[w]=arguments[w];const u=q[0];if(void 0===u||null===u)return u;u.length>1&&(q=u);const M=R(q);if("object"===typeof M)for(let R=M.length,v=0;v<R;v++)M[v]=Math.round(M[v]);return M};return"conversion"in R&&(N.conversion=R.conversion),N}(w),M[R][q].raw=function(R){const N=function(){for(var N=arguments.length,q=new Array(N),w=0;w<N;w++)q[w]=arguments[w];const u=q[0];return void 0===u||null===u?u:(u.length>1&&(q=u),R(q))};return"conversion"in R&&(N.conversion=R.conversion),N}(w)}))})),R.exports=M},12336:(R,N,q)=>{const w=q(12324);function u(R){const N=function(){const R={},N=Object.keys(w);for(let q=N.length,w=0;w<q;w++)R[N[w]]={distance:-1,parent:null};return R}(),q=[R];for(N[R].distance=0;q.length;){const R=q.pop(),u=Object.keys(w[R]);for(let w=u.length,M=0;M<w;M++){const w=u[M],v=N[w];-1===v.distance&&(v.distance=N[R].distance+1,v.parent=R,q.unshift(w))}}return N}function M(R,N){return function(q){return N(R(q))}}function v(R,N){const q=[N[R].parent,R];let u=w[N[R].parent][R],v=N[R].parent;for(;N[v].parent;)q.unshift(N[v].parent),u=M(w[N[v].parent][v],u),v=N[v].parent;return u.conversion=q,u}R.exports=function(R){const N=u(R),q={},w=Object.keys(N);for(let u=w.length,M=0;M<u;M++){const R=w[M];null!==N[R].parent&&(q[R]=v(R,N))}return q}},12330:R=>{"use strict";R.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11173:function(R,N,q){"use strict";var w=this&&this.__createBinding||(Object.create?function(R,N,q,w){void 0===w&&(w=q);var u=Object.getOwnPropertyDescriptor(N,q);u&&!("get"in u?!N.__esModule:u.writable||u.configurable)||(u={enumerable:!0,get:function(){return N[q]}}),Object.defineProperty(R,w,u)}:function(R,N,q,w){void 0===w&&(w=q),R[w]=N[q]}),u=this&&this.__setModuleDefault||(Object.create?function(R,N){Object.defineProperty(R,"default",{enumerable:!0,value:N})}:function(R,N){R.default=N}),M=this&&this.__importStar||function(R){if(R&&R.__esModule)return R;var N={};if(null!=R)for(var q in R)"default"!==q&&Object.prototype.hasOwnProperty.call(R,q)&&w(N,R,q);return u(N,R),N},v=this&&this.__awaiter||function(R,N,q,w){return new(q||(q=Promise))((function(u,M){function v(R){try{J(w.next(R))}catch(N){M(N)}}function G(R){try{J(w.throw(R))}catch(N){M(N)}}function J(R){var N;R.done?u(R.value):(N=R.value,N instanceof q?N:new q((function(R){R(N)}))).then(v,G)}J((w=w.apply(R,N||[])).next())}))};Object.defineProperty(N,"__esModule",{value:!0}),N.Auth=N.Platform=void 0;const G=M(q(11116)),J=q(11181),y="colyseus-auth-token";!function(R){R.ios="ios",R.android="android"}(N.Platform||(N.Platform={}));N.Auth=class{constructor(R){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=R.replace("ws","http"),(0,J.getItem)(y,(R=>this.token=R))}get hasToken(){return!!this.token}login(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return v(this,void 0,void 0,(function*(){const N=Object.assign({},R);this.hasToken&&(N.token=this.token);const q=yield this.request("post","/auth",N);this.token=q.token,(0,J.setItem)(y,this.token);for(let R in q)this.hasOwnProperty(R)&&(this[R]=q[R]);return this.registerPingService(),this}))}save(){return v(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return v(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return v(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return v(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(R){return v(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:R})}))}acceptFriendRequest(R){return v(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:R})}))}declineFriendRequest(R){return v(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:R})}))}blockUser(R){return v(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:R})}))}unblockUser(R){return v(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:R})}))}request(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},w=arguments.length>3?arguments[3]:void 0,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return v(this,void 0,void 0,(function*(){u.Accept="application/json",this.hasToken&&(u.Authorization="Bearer "+this.token);const M=[];for(const R in q)M.push(`${R}=${q[R]}`);const v=M.length>0?`?${M.join("&")}`:"",J={headers:u};return w&&(J.body=w),(yield G[R](`${this.endpoint}${N}${v}`,J)).data}))}logout(){this.token=void 0,(0,J.removeItem)(y),this.unregisterPingService()}registerPingService(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),R)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11108:function(R,N,q){"use strict";var w,u=this&&this.__awaiter||function(R,N,q,w){return new(q||(q=Promise))((function(u,M){function v(R){try{J(w.next(R))}catch(N){M(N)}}function G(R){try{J(w.throw(R))}catch(N){M(N)}}function J(R){var N;R.done?u(R.value):(N=R.value,N instanceof q?N:new q((function(R){R(N)}))).then(v,G)}J((w=w.apply(R,N||[])).next())}))};Object.defineProperty(N,"__esModule",{value:!0}),N.Client=N.MatchMakeError=void 0;const M=q(11116),v=q(11118),G=q(11120);class J extends Error{constructor(R,N){super(R),this.code=N,Object.setPrototypeOf(this,J.prototype)}}N.MatchMakeError=J;const y="undefined"!==typeof window&&"undefined"!==typeof(null===(w=null===window||void 0===window?void 0:window.location)||void 0===w?void 0:w.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";N.Client=class{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y;if("string"===typeof R){const N=new URL(R),q="https:"===N.protocol||"wss:"===N.protocol,w=Number(N.port||(q?443:80));this.settings={hostname:N.hostname,pathname:"/"!==N.pathname?N.pathname:"",port:w,secure:q}}else void 0===R.port&&(R.port=R.secure?443:80),void 0===R.pathname&&(R.pathname=""),this.settings=R}joinOrCreate(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2?arguments[2]:void 0;return u(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",R,N,q)}))}create(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2?arguments[2]:void 0;return u(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",R,N,q)}))}join(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2?arguments[2]:void 0;return u(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",R,N,q)}))}joinById(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2?arguments[2]:void 0;return u(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",R,N,q)}))}reconnect(R,N){return u(this,void 0,void 0,(function*(){if("string"===typeof R&&"string"===typeof N)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[q,w]=R.split(":");return yield this.createMatchMakeRequest("reconnect",q,{reconnectionToken:w},N)}))}getAvailableRooms(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return u(this,void 0,void 0,(function*(){return(yield(0,M.get)(this.getHttpEndpoint(`${R}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(R,N,q){return u(this,void 0,void 0,(function*(){const w=this.createRoom(R.room.name,N);w.roomId=R.room.roomId,w.sessionId=R.sessionId;const M={sessionId:w.sessionId};R.reconnectionToken&&(M.reconnectionToken=R.reconnectionToken);const G=q||w;return w.connect(this.buildEndpoint(R.room,M),R.devMode&&(()=>u(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${w.roomId}'...`);let q=0;const M=()=>u(this,void 0,void 0,(function*(){q++;try{yield this.consumeSeatReservation(R,N,G),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${w.roomId}'`)}catch(u){q<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${q} out of 8)`),setTimeout(M,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(M,2e3)}))),G),new Promise(((R,N)=>{const q=(R,q)=>N(new v.ServerError(R,q));G.onError.once(q),G.onJoin.once((()=>{G.onError.remove(q),R(G)}))}))}))}createMatchMakeRequest(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},w=arguments.length>3?arguments[3]:void 0,v=arguments.length>4?arguments[4]:void 0;return u(this,void 0,void 0,(function*(){const u=(yield(0,M.post)(this.getHttpEndpoint(`${R}/${N}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(q)})).data;if(u.error)throw new J(u.error,u.code);return"reconnect"===R&&(u.reconnectionToken=q.reconnectionToken),yield this.consumeSeatReservation(u,w,v)}))}createRoom(R,N){return new G.Room(R,N)}buildEndpoint(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const q=[];for(const u in N)N.hasOwnProperty(u)&&q.push(`${u}=${N[u]}`);let w=this.settings.secure?"wss://":"ws://";return R.publicAddress?w+=`${R.publicAddress}`:w+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${w}/${R.processId}/${R.roomId}?${q.join("&")}`}getHttpEndpoint(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${R}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11124:(R,N,q)=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.Connection=void 0;const w=q(11130);N.Connection=class{constructor(){this.events={},this.transport=new w.WebSocketTransport(this.events)}send(R){this.transport.send(R)}connect(R){this.transport.connect(R)}close(R,N){this.transport.close(R,N)}get isOpen(){return this.transport.isOpen}}},11142:(R,N)=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.utf8Length=N.utf8Read=N.ErrorCode=N.Protocol=void 0,function(R){R[R.HANDSHAKE=9]="HANDSHAKE",R[R.JOIN_ROOM=10]="JOIN_ROOM",R[R.ERROR=11]="ERROR",R[R.LEAVE_ROOM=12]="LEAVE_ROOM",R[R.ROOM_DATA=13]="ROOM_DATA",R[R.ROOM_STATE=14]="ROOM_STATE",R[R.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",R[R.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",R[R.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(N.Protocol||(N.Protocol={})),function(R){R[R.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",R[R.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",R[R.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",R[R.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",R[R.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",R[R.AUTH_FAILED=4215]="AUTH_FAILED",R[R.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(N.ErrorCode||(N.ErrorCode={})),N.utf8Read=function(R,N){const q=R[N++];for(var w="",u=0,M=N,v=N+q;M<v;M++){var G=R[M];if(0!==(128&G))if(192!==(224&G))if(224!==(240&G)){if(240!==(248&G))throw new Error("Invalid byte "+G.toString(16));(u=(7&G)<<18|(63&R[++M])<<12|(63&R[++M])<<6|63&R[++M])>=65536?(u-=65536,w+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):w+=String.fromCharCode(u)}else w+=String.fromCharCode((15&G)<<12|(63&R[++M])<<6|63&R[++M]);else w+=String.fromCharCode((31&G)<<6|63&R[++M]);else w+=String.fromCharCode(G)}return w},N.utf8Length=function(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",N=0,q=0;for(let w=0,u=R.length;w<u;w++)N=R.charCodeAt(w),N<128?q+=1:N<2048?q+=2:N<55296||N>=57344?q+=3:(w++,q+=4);return q+1}},11120:function(R,N,q){"use strict";var w=this&&this.__createBinding||(Object.create?function(R,N,q,w){void 0===w&&(w=q);var u=Object.getOwnPropertyDescriptor(N,q);u&&!("get"in u?!N.__esModule:u.writable||u.configurable)||(u={enumerable:!0,get:function(){return N[q]}}),Object.defineProperty(R,w,u)}:function(R,N,q,w){void 0===w&&(w=q),R[w]=N[q]}),u=this&&this.__setModuleDefault||(Object.create?function(R,N){Object.defineProperty(R,"default",{enumerable:!0,value:N})}:function(R,N){R.default=N}),M=this&&this.__importStar||function(R){if(R&&R.__esModule)return R;var N={};if(null!=R)for(var q in R)"default"!==q&&Object.prototype.hasOwnProperty.call(R,q)&&w(N,R,q);return u(N,R),N};Object.defineProperty(N,"__esModule",{value:!0}),N.Room=void 0;const v=M(q(11122)),G=q(11124),J=q(11142),y=q(11151),a=q(11157),j=q(11160),F=q(11167),S=q(11118);class H{constructor(R,N){this.onStateChange=(0,j.createSignal)(),this.onError=(0,j.createSignal)(),this.onLeave=(0,j.createSignal)(),this.onJoin=(0,j.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,a.createNanoEvents)(),this.roomId=null,this.name=R,N&&(this.serializer=new((0,y.getSerializer)("schema")),this.rootSchema=N,this.serializer.state=new N),this.onError(((R,N)=>{var q;return null===(q=console.warn)||void 0===q?void 0:q.call(console,`colyseus.js - onError => (${R}) ${N}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const w=new G.Connection;q.connection=w,w.events.onmessage=H.prototype.onMessageCallback.bind(q),w.events.onclose=function(R){var w;if(!q.hasJoined)return null===(w=console.warn)||void 0===w||w.call(console,`Room connection was closed unexpectedly (${R.code}): ${R.reason}`),void q.onError.invoke(R.code,R.reason);R.code===S.CloseCode.DEVMODE_RESTART&&N?N():(q.onLeave.invoke(R.code),q.destroy())},w.events.onerror=function(R){var N;null===(N=console.warn)||void 0===N||N.call(console,`Room, onError (${R.code}): ${R.reason}`),q.onError.invoke(R.code,R.reason)},w.connect(R)}leave(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((N=>{this.onLeave((R=>N(R))),this.connection?R?this.connection.send([J.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(S.CloseCode.CONSENTED)}))}onMessage(R,N){return this.onMessageHandlers.on(this.getMessageHandlerKey(R),N)}send(R,N){const q=[J.Protocol.ROOM_DATA];let w;if("string"===typeof R?F.encode.string(q,R):F.encode.number(q,R),void 0!==N){const R=v.encode(N);w=new Uint8Array(q.length+R.byteLength),w.set(new Uint8Array(q),0),w.set(new Uint8Array(R),q.length)}else w=new Uint8Array(q);this.connection.send(w.buffer)}sendBytes(R,N){const q=[J.Protocol.ROOM_DATA_BYTES];let w;"string"===typeof R?F.encode.string(q,R):F.encode.number(q,R),w=new Uint8Array(q.length+(N.byteLength||N.length)),w.set(new Uint8Array(q),0),w.set(new Uint8Array(N),q.length),this.connection.send(w.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(R){const N=Array.from(new Uint8Array(R.data)),q=N[0];if(q===J.Protocol.JOIN_ROOM){let R=1;const q=(0,J.utf8Read)(N,R);if(R+=(0,J.utf8Length)(q),this.serializerId=(0,J.utf8Read)(N,R),R+=(0,J.utf8Length)(this.serializerId),!this.serializer){const R=(0,y.getSerializer)(this.serializerId);this.serializer=new R}N.length>R&&this.serializer.handshake&&this.serializer.handshake(N,{offset:R}),this.reconnectionToken=`${this.roomId}:${q}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([J.Protocol.JOIN_ROOM])}else if(q===J.Protocol.ERROR){const R={offset:1},q=F.decode.number(N,R),w=F.decode.string(N,R);this.onError.invoke(q,w)}else if(q===J.Protocol.LEAVE_ROOM)this.leave();else if(q===J.Protocol.ROOM_DATA_SCHEMA){const R={offset:1},q=this.serializer.getState().constructor._context.get(F.decode.number(N,R)),w=new q;w.decode(N,R),this.dispatchMessage(q,w)}else if(q===J.Protocol.ROOM_STATE)N.shift(),this.setState(N);else if(q===J.Protocol.ROOM_STATE_PATCH)N.shift(),this.patch(N);else if(q===J.Protocol.ROOM_DATA){const q={offset:1},w=F.decode.stringCheck(N,q)?F.decode.string(N,q):F.decode.number(N,q),u=N.length>q.offset?v.decode(R.data,q.offset):void 0;this.dispatchMessage(w,u)}else if(q===J.Protocol.ROOM_DATA_BYTES){const R={offset:1},q=F.decode.stringCheck(N,R)?F.decode.string(N,R):F.decode.number(N,R);this.dispatchMessage(q,new Uint8Array(N.slice(R.offset)))}}setState(R){this.serializer.setState(R),this.onStateChange.invoke(this.serializer.getState())}patch(R){this.serializer.patch(R),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(R,N){var q;const w=this.getMessageHandlerKey(R);this.onMessageHandlers.events[w]?this.onMessageHandlers.emit(w,N):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",R,N):null===(q=console.warn)||void 0===q||q.call(console,`colyseus.js: onMessage() not registered for type '${R}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(R){switch(typeof R){case"function":return`$${R._typeid}`;case"string":return R;case"number":return`i${R}`;default:throw new Error("invalid message type.")}}}N.Room=H},11181:(R,N)=>{"use strict";let q;function w(){return q||(q="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(R,N){this.cache[R]=N},getItem:function(R){this.cache[R]},removeItem:function(R){delete this.cache[R]}}),q}Object.defineProperty(N,"__esModule",{value:!0}),N.getItem=N.removeItem=N.setItem=void 0,N.setItem=function(R,N){w().setItem(R,N)},N.removeItem=function(R){w().removeItem(R)},N.getItem=function(R,N){const q=w().getItem(R);"undefined"!==typeof Promise&&q instanceof Promise?q.then((R=>N(R))):N(q)}},11157:(R,N)=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.createNanoEvents=void 0;N.createNanoEvents=()=>({emit(R){let N=this.events[R]||[];for(var q=arguments.length,w=new Array(q>1?q-1:0),u=1;u<q;u++)w[u-1]=arguments[u];for(let M=0,v=N.length;M<v;M++)N[M](...w)},events:{},on(R,N){var q;return(null===(q=this.events[R])||void 0===q?void 0:q.push(N))||(this.events[R]=[N]),()=>{var q;this.events[R]=null===(q=this.events[R])||void 0===q?void 0:q.filter((R=>N!==R))}}})},11160:(R,N)=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.createSignal=N.EventEmitter=void 0;class q{constructor(){this.handlers=[]}register(R){return this.handlers.push(R),this}invoke(){for(var R=arguments.length,N=new Array(R),q=0;q<R;q++)N[q]=arguments[q];this.handlers.forEach((R=>R.apply(this,N)))}invokeAsync(){for(var R=arguments.length,N=new Array(R),q=0;q<R;q++)N[q]=arguments[q];return Promise.all(this.handlers.map((R=>R.apply(this,N))))}remove(R){const N=this.handlers.indexOf(R);this.handlers[N]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}N.EventEmitter=q,N.createSignal=function(){const R=new q;function N(N){return R.register(N,null===this)}return N.once=N=>{const q=function(){for(var w=arguments.length,u=new Array(w),M=0;M<w;M++)u[M]=arguments[M];N.apply(this,u),R.remove(q)};R.register(q)},N.remove=N=>R.remove(N),N.invoke=function(){return R.invoke(...arguments)},N.invokeAsync=function(){return R.invokeAsync(...arguments)},N.clear=()=>R.clear(),N}},11118:(R,N)=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.ServerError=N.CloseCode=void 0,function(R){R[R.CONSENTED=4e3]="CONSENTED",R[R.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(N.CloseCode||(N.CloseCode={}));class q extends Error{constructor(R,N){super(N),this.name="ServerError",this.code=R}}N.ServerError=q},11097:(R,N,q)=>{"use strict";N.c=void 0,q(11099);var w=q(11108);Object.defineProperty(N,"c",{enumerable:!0,get:function(){return w.Client}});var u=q(11142);var M=q(11120);var v=q(11173);const G=q(11190);const J=q(11195),y=q(11151);(0,y.registerSerializer)("schema",G.SchemaSerializer),(0,y.registerSerializer)("none",J.NoneSerializer)},11099:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=R=>null!==R&&"object"===typeof R&&R.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11122:(R,N)=>{"use strict";function q(R,N){if(this._offset=N,R instanceof ArrayBuffer)this._buffer=R,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(R))throw new Error("Invalid argument");this._buffer=R.buffer,this._view=new DataView(this._buffer,R.byteOffset,R.byteLength)}}Object.defineProperty(N,"__esModule",{value:!0}),N.decode=N.encode=void 0,q.prototype._array=function(R){for(var N=new Array(R),q=0;q<R;q++)N[q]=this._parse();return N},q.prototype._map=function(R){for(var N={},q=0;q<R;q++)N[this._parse()]=this._parse();return N},q.prototype._str=function(R){var N=function(R,N,q){for(var w="",u=0,M=N,v=N+q;M<v;M++){var G=R.getUint8(M);if(0!==(128&G))if(192!==(224&G))if(224!==(240&G)){if(240!==(248&G))throw new Error("Invalid byte "+G.toString(16));(u=(7&G)<<18|(63&R.getUint8(++M))<<12|(63&R.getUint8(++M))<<6|63&R.getUint8(++M))>=65536?(u-=65536,w+=String.fromCharCode(55296+(u>>>10),56320+(1023&u))):w+=String.fromCharCode(u)}else w+=String.fromCharCode((15&G)<<12|(63&R.getUint8(++M))<<6|63&R.getUint8(++M));else w+=String.fromCharCode((31&G)<<6|63&R.getUint8(++M));else w+=String.fromCharCode(G)}return w}(this._view,this._offset,R);return this._offset+=R,N},q.prototype._bin=function(R){var N=this._buffer.slice(this._offset,this._offset+R);return this._offset+=R,N},q.prototype._parse=function(){var R,N=this._view.getUint8(this._offset++),q=0,w=0,u=0,M=0;if(N<192)return N<128?N:N<144?this._map(15&N):N<160?this._array(15&N):this._str(31&N);if(N>223)return-1*(255-N+1);switch(N){case 192:return null;case 194:return!1;case 195:return!0;case 196:return q=this._view.getUint8(this._offset),this._offset+=1,this._bin(q);case 197:return q=this._view.getUint16(this._offset),this._offset+=2,this._bin(q);case 198:return q=this._view.getUint32(this._offset),this._offset+=4,this._bin(q);case 199:if(q=this._view.getUint8(this._offset),w=this._view.getInt8(this._offset+1),this._offset+=2,-1===w){var v=this._view.getUint32(this._offset);return u=this._view.getInt32(this._offset+4),M=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*u+M)+v/1e6)}return[w,this._bin(q)];case 200:return q=this._view.getUint16(this._offset),w=this._view.getInt8(this._offset+2),this._offset+=3,[w,this._bin(q)];case 201:return q=this._view.getUint32(this._offset),w=this._view.getInt8(this._offset+4),this._offset+=5,[w,this._bin(q)];case 202:return R=this._view.getFloat32(this._offset),this._offset+=4,R;case 203:return R=this._view.getFloat64(this._offset),this._offset+=8,R;case 204:return R=this._view.getUint8(this._offset),this._offset+=1,R;case 205:return R=this._view.getUint16(this._offset),this._offset+=2,R;case 206:return R=this._view.getUint32(this._offset),this._offset+=4,R;case 207:return u=this._view.getUint32(this._offset)*Math.pow(2,32),M=this._view.getUint32(this._offset+4),this._offset+=8,u+M;case 208:return R=this._view.getInt8(this._offset),this._offset+=1,R;case 209:return R=this._view.getInt16(this._offset),this._offset+=2,R;case 210:return R=this._view.getInt32(this._offset),this._offset+=4,R;case 211:return u=this._view.getInt32(this._offset)*Math.pow(2,32),M=this._view.getUint32(this._offset+4),this._offset+=8,u+M;case 212:return w=this._view.getInt8(this._offset),this._offset+=1,0===w?void(this._offset+=1):[w,this._bin(1)];case 213:return w=this._view.getInt8(this._offset),this._offset+=1,[w,this._bin(2)];case 214:return w=this._view.getInt8(this._offset),this._offset+=1,-1===w?(R=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*R)):[w,this._bin(4)];case 215:return w=this._view.getInt8(this._offset),this._offset+=1,0===w?(u=this._view.getInt32(this._offset)*Math.pow(2,32),M=this._view.getUint32(this._offset+4),this._offset+=8,new Date(u+M)):-1===w?(u=this._view.getUint32(this._offset),M=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&u)+M)+(u>>>2)/1e6)):[w,this._bin(8)];case 216:return w=this._view.getInt8(this._offset),this._offset+=1,[w,this._bin(16)];case 217:return q=this._view.getUint8(this._offset),this._offset+=1,this._str(q);case 218:return q=this._view.getUint16(this._offset),this._offset+=2,this._str(q);case 219:return q=this._view.getUint32(this._offset),this._offset+=4,this._str(q);case 220:return q=this._view.getUint16(this._offset),this._offset+=2,this._array(q);case 221:return q=this._view.getUint32(this._offset),this._offset+=4,this._array(q);case 222:return q=this._view.getUint16(this._offset),this._offset+=2,this._map(q);case 223:return q=this._view.getUint32(this._offset),this._offset+=4,this._map(q)}throw new Error("Could not parse")},N.decode=function(R){var N=new q(R,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),w=N._parse();if(N._offset!==R.byteLength)throw new Error(R.byteLength-N._offset+" trailing bytes");return w};function w(R,N,q){for(var w=0,u=0,M=q.length;u<M;u++)(w=q.charCodeAt(u))<128?R.setUint8(N++,w):w<2048?(R.setUint8(N++,192|w>>6),R.setUint8(N++,128|63&w)):w<55296||w>=57344?(R.setUint8(N++,224|w>>12),R.setUint8(N++,128|w>>6&63),R.setUint8(N++,128|63&w)):(u++,w=65536+((1023&w)<<10|1023&q.charCodeAt(u)),R.setUint8(N++,240|w>>18),R.setUint8(N++,128|w>>12&63),R.setUint8(N++,128|w>>6&63),R.setUint8(N++,128|63&w))}function u(R,N,q){var w=typeof q,M=0,v=0,G=0,J=0,y=0,a=0;if("string"===w){if(y=function(R){for(var N=0,q=0,w=0,u=R.length;w<u;w++)(N=R.charCodeAt(w))<128?q+=1:N<2048?q+=2:N<55296||N>=57344?q+=3:(w++,q+=4);return q}(q),y<32)R.push(160|y),a=1;else if(y<256)R.push(217,y),a=2;else if(y<65536)R.push(218,y>>8,y),a=3;else{if(!(y<4294967296))throw new Error("String too long");R.push(219,y>>24,y>>16,y>>8,y),a=5}return N.push({_str:q,_length:y,_offset:R.length}),a+y}if("number"===w)return Math.floor(q)===q&&isFinite(q)?q>=0?q<128?(R.push(q),1):q<256?(R.push(204,q),2):q<65536?(R.push(205,q>>8,q),3):q<4294967296?(R.push(206,q>>24,q>>16,q>>8,q),5):(G=q/Math.pow(2,32)|0,J=q>>>0,R.push(207,G>>24,G>>16,G>>8,G,J>>24,J>>16,J>>8,J),9):q>=-32?(R.push(q),1):q>=-128?(R.push(208,q),2):q>=-32768?(R.push(209,q>>8,q),3):q>=-2147483648?(R.push(210,q>>24,q>>16,q>>8,q),5):(G=Math.floor(q/Math.pow(2,32)),J=q>>>0,R.push(211,G>>24,G>>16,G>>8,G,J>>24,J>>16,J>>8,J),9):(R.push(203),N.push({_float:q,_length:8,_offset:R.length}),9);if("object"===w){if(null===q)return R.push(192),1;if(Array.isArray(q)){if((y=q.length)<16)R.push(144|y),a=1;else if(y<65536)R.push(220,y>>8,y),a=3;else{if(!(y<4294967296))throw new Error("Array too large");R.push(221,y>>24,y>>16,y>>8,y),a=5}for(M=0;M<y;M++)a+=u(R,N,q[M]);return a}if(q instanceof Date){var j=q.getTime(),F=Math.floor(j/1e3),S=1e6*(j-1e3*F);return F>=0&&S>=0&&F<=17179869183?0===S&&F<=4294967295?(R.push(214,255,F>>24,F>>16,F>>8,F),6):(G=F/4294967296,J=4294967295&F,R.push(215,255,S>>22,S>>14,S>>6,G,J>>24,J>>16,J>>8,J),10):(G=Math.floor(F/4294967296),J=F>>>0,R.push(199,12,255,S>>24,S>>16,S>>8,S,G>>24,G>>16,G>>8,G,J>>24,J>>16,J>>8,J),15)}if(q instanceof ArrayBuffer){if((y=q.byteLength)<256)R.push(196,y),a=2;else if(y<65536)R.push(197,y>>8,y),a=3;else{if(!(y<4294967296))throw new Error("Buffer too large");R.push(198,y>>24,y>>16,y>>8,y),a=5}return N.push({_bin:q,_length:y,_offset:R.length}),a+y}if("function"===typeof q.toJSON)return u(R,N,q.toJSON());var H=[],W="",k=Object.keys(q);for(M=0,v=k.length;M<v;M++)void 0!==q[W=k[M]]&&"function"!==typeof q[W]&&H.push(W);if((y=H.length)<16)R.push(128|y),a=1;else if(y<65536)R.push(222,y>>8,y),a=3;else{if(!(y<4294967296))throw new Error("Object too large");R.push(223,y>>24,y>>16,y>>8,y),a=5}for(M=0;M<y;M++)a+=u(R,N,W=H[M]),a+=u(R,N,q[W]);return a}if("boolean"===w)return R.push(q?195:194),1;if("undefined"===w)return R.push(192),1;if("function"===typeof q.toJSON)return u(R,N,q.toJSON());throw new Error("Could not encode")}N.encode=function(R){var N=[],q=[],M=u(N,q,R),v=new ArrayBuffer(M),G=new DataView(v),J=0,y=0,a=-1;q.length>0&&(a=q[0]._offset);for(var j,F=0,S=0,H=0,W=N.length;H<W;H++)if(G.setUint8(y+H,N[H]),H+1===a){if(F=(j=q[J])._length,S=y+a,j._bin)for(var k=new Uint8Array(j._bin),C=0;C<F;C++)G.setUint8(S+C,k[C]);else j._str?w(G,S,j._str):void 0!==j._float&&G.setFloat64(S,j._float);y+=F,q[++J]&&(a=q[J]._offset)}return v}},11195:(R,N)=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.NoneSerializer=void 0;N.NoneSerializer=class{setState(R){}getState(){return null}patch(R){}teardown(){}handshake(R){}}},11190:(R,N,q)=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.SchemaSerializer=void 0;const w=q(11167);N.SchemaSerializer=class{setState(R){return this.state.decode(R)}getState(){return this.state}patch(R){return this.state.decode(R)}teardown(){var R,N;null===(N=null===(R=this.state)||void 0===R?void 0:R.$changes)||void 0===N||N.root.clearRefs()}handshake(R,N){if(this.state){(new w.Reflection).decode(R,N)}else this.state=w.Reflection.decode(R,N)}}},11151:(R,N)=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0}),N.getSerializer=N.registerSerializer=void 0;const q={};N.registerSerializer=function(R,N){q[R]=N},N.getSerializer=function(R){const N=q[R];if(!N)throw new Error("missing serializer: "+R);return N}},11130:function(R,N,q){"use strict";var w=this&&this.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(N,"__esModule",{value:!0}),N.WebSocketTransport=void 0;const u=w(q(11139)),M=globalThis.WebSocket||u.default;N.WebSocketTransport=class{constructor(R){this.events=R}send(R){R instanceof ArrayBuffer?this.ws.send(R):Array.isArray(R)&&this.ws.send(new Uint8Array(R).buffer)}connect(R){this.ws=new M(R,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(R,N){this.ws.close(R,N)}get isOpen(){return this.ws.readyState===M.OPEN}}},11139:R=>{"use strict";R.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},11245:R=>{"use strict";R.exports=function(R){for(var N=new Array(R),q=0;q<R;++q)N[q]=q;return N}},11247:R=>{function N(R){return!!R.constructor&&"function"===typeof R.constructor.isBuffer&&R.constructor.isBuffer(R)}R.exports=function(R){return null!=R&&(N(R)||function(R){return"function"===typeof R.readFloatLE&&"function"===typeof R.slice&&N(R.slice(0,0))}(R)||!!R._isBuffer)}},11242:(R,N,q)=>{var w=q(11245),u=q(11247),M="undefined"!==typeof Float64Array;function v(R,N){return R[0]-N[0]}function G(){var R,N=this.stride,q=new Array(N.length);for(R=0;R<q.length;++R)q[R]=[Math.abs(N[R]),R];q.sort(v);var w=new Array(q.length);for(R=0;R<w.length;++R)w[R]=q[R][1];return w}function J(R,N){var q=["View",N,"d",R].join("");N<0&&(q="View_Nil"+R);var u="generic"===R;if(-1===N){var M="function "+q+"(a){this.data=a;};var proto="+q+".prototype;proto.dtype='"+R+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+q+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+q+"(a){return new "+q+"(a);}";return new Function(M)()}if(0===N){M="function "+q+"(a,d) {this.data = a;this.offset = d};var proto="+q+".prototype;proto.dtype='"+R+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+q+"_copy() {return new "+q+"(this.data,this.offset)};proto.pick=function "+q+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+q+"_get(){return "+(u?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+q+"_set(v){return "+(u?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+q+"(a,b,c,d){return new "+q+"(a,d)}";return new Function("TrivialArray",M)(y[R][0])}M=["'use strict'"];var v=w(N),J=v.map((function(R){return"i"+R})),a="this.offset+"+v.map((function(R){return"this.stride["+R+"]*i"+R})).join("+"),j=v.map((function(R){return"b"+R})).join(","),F=v.map((function(R){return"c"+R})).join(",");M.push("function "+q+"(a,"+j+","+F+",d){this.data=a","this.shape=["+j+"]","this.stride=["+F+"]","this.offset=d|0}","var proto="+q+".prototype","proto.dtype='"+R+"'","proto.dimension="+N),M.push("Object.defineProperty(proto,'size',{get:function "+q+"_size(){return "+v.map((function(R){return"this.shape["+R+"]"})).join("*"),"}})"),1===N?M.push("proto.order=[0]"):(M.push("Object.defineProperty(proto,'order',{get:"),N<4?(M.push("function "+q+"_order(){"),2===N?M.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===N&&M.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):M.push("ORDER})")),M.push("proto.set=function "+q+"_set("+J.join(",")+",v){"),u?M.push("return this.data.set("+a+",v)}"):M.push("return this.data["+a+"]=v}"),M.push("proto.get=function "+q+"_get("+J.join(",")+"){"),u?M.push("return this.data.get("+a+")}"):M.push("return this.data["+a+"]}"),M.push("proto.index=function "+q+"_index(",J.join(),"){return "+a+"}"),M.push("proto.hi=function "+q+"_hi("+J.join(",")+"){return new "+q+"(this.data,"+v.map((function(R){return["(typeof i",R,"!=='number'||i",R,"<0)?this.shape[",R,"]:i",R,"|0"].join("")})).join(",")+","+v.map((function(R){return"this.stride["+R+"]"})).join(",")+",this.offset)}");var S=v.map((function(R){return"a"+R+"=this.shape["+R+"]"})),H=v.map((function(R){return"c"+R+"=this.stride["+R+"]"}));M.push("proto.lo=function "+q+"_lo("+J.join(",")+"){var b=this.offset,d=0,"+S.join(",")+","+H.join(","));for(var W=0;W<N;++W)M.push("if(typeof i"+W+"==='number'&&i"+W+">=0){d=i"+W+"|0;b+=c"+W+"*d;a"+W+"-=d}");M.push("return new "+q+"(this.data,"+v.map((function(R){return"a"+R})).join(",")+","+v.map((function(R){return"c"+R})).join(",")+",b)}"),M.push("proto.step=function "+q+"_step("+J.join(",")+"){var "+v.map((function(R){return"a"+R+"=this.shape["+R+"]"})).join(",")+","+v.map((function(R){return"b"+R+"=this.stride["+R+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(W=0;W<N;++W)M.push("if(typeof i"+W+"==='number'){d=i"+W+"|0;if(d<0){c+=b"+W+"*(a"+W+"-1);a"+W+"=ceil(-a"+W+"/d)}else{a"+W+"=ceil(a"+W+"/d)}b"+W+"*=d}");M.push("return new "+q+"(this.data,"+v.map((function(R){return"a"+R})).join(",")+","+v.map((function(R){return"b"+R})).join(",")+",c)}");var k=new Array(N),C=new Array(N);for(W=0;W<N;++W)k[W]="a[i"+W+"]",C[W]="b[i"+W+"]";M.push("proto.transpose=function "+q+"_transpose("+J+"){"+J.map((function(R,N){return R+"=("+R+"===undefined?"+N+":"+R+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+q+"(this.data,"+k.join(",")+","+C.join(",")+",this.offset)}"),M.push("proto.pick=function "+q+"_pick("+J+"){var a=[],b=[],c=this.offset");for(W=0;W<N;++W)M.push("if(typeof i"+W+"==='number'&&i"+W+">=0){c=(c+this.stride["+W+"]*i"+W+")|0}else{a.push(this.shape["+W+"]);b.push(this.stride["+W+"])}");return M.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),M.push("return function construct_"+q+"(data,shape,stride,offset){return new "+q+"(data,"+v.map((function(R){return"shape["+R+"]"})).join(",")+","+v.map((function(R){return"stride["+R+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",M.join("\n"))(y[R],G)}var y={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};R.exports=function(R,N,q,w){if(void 0===R)return(0,y.array[0])([]);"number"===typeof R&&(R=[R]),void 0===N&&(N=[R.length]);var v=N.length;if(void 0===q){q=new Array(v);for(var G=v-1,a=1;G>=0;--G)q[G]=a,a*=N[G]}if(void 0===w){w=0;for(G=0;G<v;++G)q[G]<0&&(w-=(N[G]-1)*q[G])}for(var j=function(R){if(u(R))return"buffer";if(M)switch(Object.prototype.toString.call(R)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(R)?"array":"generic"}(R),F=y[j];F.length<=v+1;)F.push(J(j,F.length-1));return(0,F[v+1])(R,N,q,w)}},11212:R=>{var N;self,N=()=>(()=>{"use strict";var R={d:(N,q)=>{for(var w in q)R.o(q,w)&&!R.o(N,w)&&Object.defineProperty(N,w,{enumerable:!0,get:q[w]})},o:(R,N)=>Object.prototype.hasOwnProperty.call(R,N)},N={};R.d(N,{default:()=>A});var q,w=function(R,N){var q=N.x-R.x,w=N.y-R.y;return Math.sqrt(q*q+w*w)},u=function(R){return R*(Math.PI/180)},M=new Map,v=function(R){M.has(R)&&clearTimeout(M.get(R)),M.set(R,setTimeout(R,100))},G=function(R,N,q){for(var w,u=N.split(/[ ,]+/g),M=0;M<u.length;M+=1)w=u[M],R.addEventListener?R.addEventListener(w,q,!1):R.attachEvent&&R.attachEvent(w,q)},J=function(R,N,q){for(var w,u=N.split(/[ ,]+/g),M=0;M<u.length;M+=1)w=u[M],R.removeEventListener?R.removeEventListener(w,q):R.detachEvent&&R.detachEvent(w,q)},y=function(R){return R.preventDefault(),R.type.match(/^touch/)?R.changedTouches:R},a=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},j=function(R,N){N.top||N.right||N.bottom||N.left?(R.style.top=N.top,R.style.right=N.right,R.style.bottom=N.bottom,R.style.left=N.left):(R.style.left=N.x+"px",R.style.top=N.y+"px")},F=function(R,N,q){var w=S(R);for(var u in w)if(w.hasOwnProperty(u))if("string"==typeof N)w[u]=N+" "+q;else{for(var M="",v=0,G=N.length;v<G;v+=1)M+=N[v]+" "+q+", ";w[u]=M.slice(0,-2)}return w},S=function(R){var N={};return N[R]="",["webkit","Moz","o"].forEach((function(q){N[q+R.charAt(0).toUpperCase()+R.slice(1)]=""})),N},H=function(R,N){for(var q in N)N.hasOwnProperty(q)&&(R[q]=N[q]);return R},W=function(R,N){if(R.length)for(var q=0,w=R.length;q<w;q+=1)N(R[q]);else N(R)},k="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,C=window.matchMedia("(any-hover: none)").matches,e=!!("ontouchstart"in window),K=!!window.PointerEvent,r=!!window.MSPointerEvent,Z={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},z={start:"mousedown",move:"mousemove",end:"mouseup"},d={};function x(){}k&&!C?q=Z:K?q={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:r?q={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:e?(q=Z,d=z):q=z,x.prototype.on=function(R,N){var q,w=this,u=R.split(/[ ,]+/g);w._handlers_=w._handlers_||{};for(var M=0;M<u.length;M+=1)q=u[M],w._handlers_[q]=w._handlers_[q]||[],w._handlers_[q].push(N);return w},x.prototype.off=function(R,N){var q=this;return q._handlers_=q._handlers_||{},void 0===R?q._handlers_={}:void 0===N?q._handlers_[R]=null:q._handlers_[R]&&q._handlers_[R].indexOf(N)>=0&&q._handlers_[R].splice(q._handlers_[R].indexOf(N),1),q},x.prototype.trigger=function(R,N){var q,w=this,u=R.split(/[ ,]+/g);w._handlers_=w._handlers_||{};for(var M=0;M<u.length;M+=1)q=u[M],w._handlers_[q]&&w._handlers_[q].length&&w._handlers_[q].forEach((function(R){R.call(w,{type:q,target:w},N)}))},x.prototype.config=function(R){var N=this;N.options=N.defaults||{},R&&(N.options=function(R,N){var q={};for(var w in R)R.hasOwnProperty(w)&&N.hasOwnProperty(w)?q[w]=N[w]:R.hasOwnProperty(w)&&(q[w]=R[w]);return q}(N.options,R))},x.prototype.bindEvt=function(R,N){var w=this;return w._domHandlers_=w._domHandlers_||{},w._domHandlers_[N]=function(){"function"==typeof w["on"+N]?w["on"+N].apply(w,arguments):console.warn('[WARNING] : Missing "on'+N+'" handler.')},G(R,q[N],w._domHandlers_[N]),d[N]&&G(R,d[N],w._domHandlers_[N]),w},x.prototype.unbindEvt=function(R,N){var w=this;return w._domHandlers_=w._domHandlers_||{},J(R,q[N],w._domHandlers_[N]),d[N]&&J(R,d[N],w._domHandlers_[N]),delete w._domHandlers_[N],this};const E=x;function P(R,N){return this.identifier=N.identifier,this.position=N.position,this.frontPosition=N.frontPosition,this.collection=R,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(N),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=P.id,P.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}P.prototype=new E,P.constructor=P,P.id=0,P.prototype.buildEl=function(R){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},P.prototype.stylize=function(){if(this.options.dataOnly)return this;var R=this.options.fadeTime+"ms",N=function(){var R=S("borderRadius");for(var N in R)R.hasOwnProperty(N)&&(R[N]="50%");return R}(),q=F("transition","opacity",R),w={};return w.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},w.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},w.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},H(w.el,q),"circle"===this.options.shape&&H(w.back,N),H(w.front,N),this.applyStyles(w),this},P.prototype.applyStyles=function(R){for(var N in this.ui)if(this.ui.hasOwnProperty(N))for(var q in R[N])this.ui[N].style[q]=R[N][q];return this},P.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},P.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},P.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},P.prototype.show=function(R){var N=this;return N.options.dataOnly||(clearTimeout(N.removeTimeout),clearTimeout(N.showTimeout),clearTimeout(N.restTimeout),N.addToDom(),N.restCallback(),setTimeout((function(){N.ui.el.style.opacity=1}),0),N.showTimeout=setTimeout((function(){N.trigger("shown",N.instance),"function"==typeof R&&R.call(this)}),N.options.fadeTime)),N},P.prototype.hide=function(R){var N=this;if(N.options.dataOnly)return N;if(N.ui.el.style.opacity=N.options.restOpacity,clearTimeout(N.removeTimeout),clearTimeout(N.showTimeout),clearTimeout(N.restTimeout),N.removeTimeout=setTimeout((function(){var q="dynamic"===N.options.mode?"none":"block";N.ui.el.style.display=q,"function"==typeof R&&R.call(N),N.trigger("hidden",N.instance)}),N.options.fadeTime),N.options.restJoystick){var q=N.options.restJoystick,w={};w.x=!0===q||!1!==q.x?0:N.instance.frontPosition.x,w.y=!0===q||!1!==q.y?0:N.instance.frontPosition.y,N.setPosition(R,w)}return N},P.prototype.setPosition=function(R,N){var q=this;q.frontPosition={x:N.x,y:N.y};var w=q.options.fadeTime+"ms",u={};u.front=F("transition",["transform"],w);var M={front:{}};M.front={transform:"translate("+q.frontPosition.x+"px,"+q.frontPosition.y+"px)"},q.applyStyles(u),q.applyStyles(M),q.restTimeout=setTimeout((function(){"function"==typeof R&&R.call(q),q.restCallback()}),q.options.fadeTime)},P.prototype.restCallback=function(){var R=this,N={};N.front=F("transition","none",""),R.applyStyles(N),R.trigger("rested",R.instance)},P.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},P.prototype.computeDirection=function(R){var N,q,w,u=R.angle.radian,M=Math.PI/4,v=Math.PI/2;if(u>M&&u<3*M&&!R.lockX?N="up":u>-M&&u<=M&&!R.lockY?N="left":u>3*-M&&u<=-M&&!R.lockX?N="down":R.lockY||(N="right"),R.lockY||(q=u>-v&&u<v?"left":"right"),R.lockX||(w=u>0?"up":"down"),R.force>this.options.threshold){var G,J={};for(G in this.direction)this.direction.hasOwnProperty(G)&&(J[G]=this.direction[G]);var y={};for(G in this.direction={x:q,y:w,angle:N},R.direction=this.direction,J)J[G]===this.direction[G]&&(y[G]=!0);if(y.x&&y.y&&y.angle)return R;y.x&&y.y||this.trigger("plain",R),y.x||this.trigger("plain:"+q,R),y.y||this.trigger("plain:"+w,R),y.angle||this.trigger("dir dir:"+N,R)}else this.resetDirection();return R};const s=P;function O(R,N){var q=this;q.nipples=[],q.idles=[],q.actives=[],q.ids=[],q.pressureIntervals={},q.manager=R,q.id=O.id,O.id+=1,q.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},q.config(N),"static"!==q.options.mode&&"semi"!==q.options.mode||(q.options.multitouch=!1),q.options.multitouch||(q.options.maxNumberOfNipples=1);var w=getComputedStyle(q.options.zone.parentElement);return w&&"flex"===w.display&&(q.parentIsFlex=!0),q.updateBox(),q.prepareNipples(),q.yj(),q.begin(),q.nipples}O.prototype=new E,O.constructor=O,O.id=0,O.prototype.prepareNipples=function(){var R=this,N=R.nipples;N.on=R.on.bind(R),N.off=R.off.bind(R),N.options=R.options,N.destroy=R.destroy.bind(R),N.ids=R.ids,N.id=R.id,N.processOnMove=R.processOnMove.bind(R),N.processOnEnd=R.processOnEnd.bind(R),N.get=function(R){if(void 0===R)return N[0];for(var q=0,w=N.length;q<w;q+=1)if(N[q].identifier===R)return N[q];return!1}},O.prototype.yj=function(){var R=this;R.bindEvt(R.options.zone,"start"),R.options.zone.style.touchAction="none",R.options.zone.style.msTouchAction="none"},O.prototype.begin=function(){var R=this,N=R.options;if("static"===N.mode){var q=R.createNipple(N.position,R.manager.getIdentifier());q.add(),R.idles.push(q)}},O.prototype.createNipple=function(R,N){var q=this,w=q.manager.scroll,u={},M=q.options,v=q.parentIsFlex?w.x:w.x+q.box.left,G=q.parentIsFlex?w.y:w.y+q.box.top;if(R.x&&R.y)u={x:R.x-v,y:R.y-G};else if(R.top||R.right||R.bottom||R.left){var J=document.createElement("DIV");J.style.display="hidden",J.style.top=R.top,J.style.right=R.right,J.style.bottom=R.bottom,J.style.left=R.left,J.style.position="absolute",M.zone.appendChild(J);var y=J.getBoundingClientRect();M.zone.removeChild(J),u=R,R={x:y.left+w.x,y:y.top+w.y}}var a=new s(q,{color:M.color,size:M.size,threshold:M.threshold,fadeTime:M.fadeTime,dataOnly:M.dataOnly,restJoystick:M.restJoystick,restOpacity:M.restOpacity,mode:M.mode,identifier:N,position:R,zone:M.zone,frontPosition:{x:0,y:0},shape:M.shape});return M.dataOnly||(j(a.ui.el,u),j(a.ui.front,a.frontPosition)),q.nipples.push(a),q.trigger("added "+a.identifier+":added",a),q.manager.trigger("added "+a.identifier+":added",a),q.bindNipple(a),a},O.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},O.prototype.bindNipple=function(R){var N,q=this,w=function(R,w){N=R.type+" "+w.id+":"+R.type,q.trigger(N,w)};R.on("destroyed",q.onDestroyed.bind(q)),R.on("shown hidden rested dir plain",w),R.on("dir:up dir:right dir:down dir:left",w),R.on("plain:up plain:right plain:down plain:left",w)},O.prototype.pressureFn=function(R,N,q){var w=this,u=0;clearInterval(w.pressureIntervals[q]),w.pressureIntervals[q]=setInterval(function(){var q=R.force||R.pressure||R.webkitForce||0;q!==u&&(N.trigger("pressure",q),w.trigger("pressure "+N.identifier+":pressure",q),u=q)}.bind(w),100)},O.prototype.onstart=function(R){var N=this,q=N.options,w=R;return R=y(R),N.updateBox(),W(R,(function(u){N.actives.length<q.maxNumberOfNipples?N.processOnStart(u):w.type.match(/^touch/)&&(Object.keys(N.manager.ids).forEach((function(q){if(Object.values(w.touches).findIndex((function(R){return R.identifier===q}))<0){var u=[R[0]];u.identifier=q,N.processOnEnd(u)}})),N.actives.length<q.maxNumberOfNipples&&N.processOnStart(u))})),N.manager.bindDocument(),!1},O.prototype.processOnStart=function(R){var N,q=this,u=q.options,M=q.manager.getIdentifier(R),v=R.force||R.pressure||R.webkitForce||0,G={x:R.pageX,y:R.pageY},J=q.getOrCreate(M,G);J.identifier!==M&&q.manager.removeIdentifier(J.identifier),J.identifier=M;var y=function(N){N.trigger("start",N),q.trigger("start "+N.id+":start",N),N.show(),v>0&&q.pressureFn(R,N,N.identifier),q.processOnMove(R)};if((N=q.idles.indexOf(J))>=0&&q.idles.splice(N,1),q.actives.push(J),q.ids.push(J.identifier),"semi"!==u.mode)y(J);else{if(!(w(G,J.position)<=u.catchDistance))return J.destroy(),void q.processOnStart(R);y(J)}return J},O.prototype.getOrCreate=function(R,N){var q,w=this,u=w.options;return/(semi|static)/.test(u.mode)?(q=w.idles[0])?(w.idles.splice(0,1),q):"semi"===u.mode?w.createNipple(N,R):(console.warn("Coudln't find the needed nipple."),!1):q=w.createNipple(N,R)},O.prototype.processOnMove=function(R){var N=this,q=N.options,M=N.manager.getIdentifier(R),v=N.nipples.get(M),G=N.manager.scroll;if(function(R){return isNaN(R.buttons)?0!==R.pressure:0!==R.buttons}(R)){if(!v)return console.error("Found zombie joystick with ID "+M),void N.manager.removeIdentifier(M);if(q.dynamicPage){var J=v.el.getBoundingClientRect();v.position={x:G.x+J.left,y:G.y+J.top}}v.identifier=M;var y=v.options.size/2,a={x:R.pageX,y:R.pageY};q.lockX&&(a.y=v.position.y),q.lockY&&(a.x=v.position.x);var j,F,S,H,W,k,C,e,K,r,Z=w(a,v.position),z=(j=a,S=(F=v.position).x-j.x,H=F.y-j.y,function(R){return R*(180/Math.PI)}(Math.atan2(H,S))),d=u(z),x=Z/y,E={distance:Z,position:a};if("circle"===v.options.shape?(W=Math.min(Z,y),C=v.position,e=W,r={x:0,y:0},K=u(K=z),r.x=C.x-e*Math.cos(K),r.y=C.y-e*Math.sin(K),k=r):(k=function(R,N,q){return{x:Math.min(Math.max(R.x,N.x-q),N.x+q),y:Math.min(Math.max(R.y,N.y-q),N.y+q)}}(a,v.position,y),W=w(k,v.position)),q.follow){if(Z>y){var P=a.x-k.x,s=a.y-k.y;v.position.x+=P,v.position.y+=s,v.el.style.top=v.position.y-(N.box.top+G.y)+"px",v.el.style.left=v.position.x-(N.box.left+G.x)+"px",Z=w(a,v.position)}}else a=k,Z=W;var O=a.x-v.position.x,L=a.y-v.position.y;v.frontPosition={x:O,y:L},q.dataOnly||(v.ui.front.style.transform="translate("+O+"px,"+L+"px)");var m={identifier:v.identifier,position:a,force:x,pressure:R.force||R.pressure||R.webkitForce||0,distance:Z,angle:{radian:d,degree:z},vector:{x:O/y,y:-L/y},raw:E,instance:v,lockX:q.lockX,lockY:q.lockY};(m=v.computeDirection(m)).angle={radian:u(180-z),degree:180-z},v.trigger("move",m),N.trigger("move "+v.id+":move",m)}else this.processOnEnd(R)},O.prototype.processOnEnd=function(R){var N=this,q=N.options,w=N.manager.getIdentifier(R),u=N.nipples.get(w),M=N.manager.removeIdentifier(u.identifier);u&&(q.dataOnly||u.hide((function(){"dynamic"===q.mode&&(u.trigger("removed",u),N.trigger("removed "+u.id+":removed",u),N.manager.trigger("removed "+u.id+":removed",u),u.destroy())})),clearInterval(N.pressureIntervals[u.identifier]),u.resetDirection(),u.trigger("end",u),N.trigger("end "+u.id+":end",u),N.ids.indexOf(u.identifier)>=0&&N.ids.splice(N.ids.indexOf(u.identifier),1),N.actives.indexOf(u)>=0&&N.actives.splice(N.actives.indexOf(u),1),/(semi|static)/.test(q.mode)?N.idles.push(u):N.nipples.indexOf(u)>=0&&N.nipples.splice(N.nipples.indexOf(u),1),N.manager.unbindDocument(),/(semi|static)/.test(q.mode)&&(N.manager.ids[M.id]=M.identifier))},O.prototype.onDestroyed=function(R,N){var q=this;q.nipples.indexOf(N)>=0&&q.nipples.splice(q.nipples.indexOf(N),1),q.actives.indexOf(N)>=0&&q.actives.splice(q.actives.indexOf(N),1),q.idles.indexOf(N)>=0&&q.idles.splice(q.idles.indexOf(N),1),q.ids.indexOf(N.identifier)>=0&&q.ids.splice(q.ids.indexOf(N.identifier),1),q.manager.removeIdentifier(N.identifier),q.manager.unbindDocument()},O.prototype.destroy=function(){var R=this;for(var N in R.unbindEvt(R.options.zone,"start"),R.nipples.forEach((function(R){R.destroy()})),R.pressureIntervals)R.pressureIntervals.hasOwnProperty(N)&&clearInterval(R.pressureIntervals[N]);R.trigger("destroyed",R.nipples),R.manager.unbindDocument(),R.off()};const L=O;function m(R){var N=this;N.ids={},N.index=0,N.collections=[],N.scroll=a(),N.config(R),N.prepareCollections();var q=function(){var R;N.collections.forEach((function(q){q.forEach((function(q){R=q.el.getBoundingClientRect(),q.position={x:N.scroll.x+R.left,y:N.scroll.y+R.top}}))}))};G(window,"resize",(function(){v(q)}));var w=function(){N.scroll=a()};return G(window,"scroll",(function(){v(w)})),N.collections}m.prototype=new E,m.constructor=m,m.prototype.prepareCollections=function(){var R=this;R.collections.create=R.create.bind(R),R.collections.on=R.on.bind(R),R.collections.off=R.off.bind(R),R.collections.destroy=R.destroy.bind(R),R.collections.get=function(N){var q;return R.collections.every((function(R){return!(q=R.get(N))})),q}},m.prototype.create=function(R){return this.createCollection(R)},m.prototype.createCollection=function(R){var N=this,q=new L(N,R);return N.bindCollection(q),N.collections.push(q),q},m.prototype.bindCollection=function(R){var N,q=this,w=function(R,w){N=R.type+" "+w.id+":"+R.type,q.trigger(N,w)};R.on("destroyed",q.onDestroyed.bind(q)),R.on("shown hidden rested dir plain",w),R.on("dir:up dir:right dir:down dir:left",w),R.on("plain:up plain:right plain:down plain:left",w)},m.prototype.bindDocument=function(){var R=this;R.binded||(R.bindEvt(document,"move").bindEvt(document,"end"),R.binded=!0)},m.prototype.unbindDocument=function(R){var N=this;Object.keys(N.ids).length&&!0!==R||(N.unbindEvt(document,"move").unbindEvt(document,"end"),N.binded=!1)},m.prototype.getIdentifier=function(R){var N;return R?void 0===(N=void 0===R.identifier?R.pointerId:R.identifier)&&(N=this.latest||0):N=this.index,void 0===this.ids[N]&&(this.ids[N]=this.index,this.index+=1),this.latest=N,this.ids[N]},m.prototype.removeIdentifier=function(R){var N={};for(var q in this.ids)if(this.ids[q]===R){N.id=q,N.identifier=this.ids[q],delete this.ids[q];break}return N},m.prototype.onmove=function(R){return this.onAny("move",R),!1},m.prototype.onend=function(R){return this.onAny("end",R),!1},m.prototype.oncancel=function(R){return this.onAny("end",R),!1},m.prototype.onAny=function(R,N){var q,w=this,u="processOn"+R.charAt(0).toUpperCase()+R.slice(1);N=y(N);var M=function(R,N,q){q.ids.indexOf(N)>=0&&(q[u](R),R._found_=!0)};return W(N,(function(R){q=w.getIdentifier(R),W(w.collections,M.bind(null,R,q)),R._found_||w.removeIdentifier(q)})),!1},m.prototype.destroy=function(){var R=this;R.unbindDocument(!0),R.ids={},R.index=0,R.collections.forEach((function(R){R.destroy()})),R.off()},m.prototype.onDestroyed=function(R,N){var q=this;if(q.collections.indexOf(N)<0)return!1;q.collections.splice(q.collections.indexOf(N),1)};var o=new m;const A={create:function(R){return o.create(R)},factory:o};return N.default})(),R.exports=N()},11255:(R,N,q)=>{"use strict";const{Deflate:w,deflate:u,deflateRaw:M,gzip:v}=q(11264),{Inflate:G,inflate:J,inflateRaw:y,ungzip:a}=q(11329),j=q(11301);R.exports.Deflate=w,R.exports.deflate=u,R.exports.deflateRaw=M,R.exports.gzip=v,R.exports.Inflate=G,R.exports.inflate=J,R.exports.inflateRaw=y,R.exports.ungzip=a,R.exports.constants=j},11264:(R,N,q)=>{"use strict";const w=q(11268),u=q(11308),M=q(11315),v=q(11299),G=q(11322),J=Object.prototype.toString,{Z_NO_FLUSH:y,Z_SYNC_FLUSH:a,Z_FULL_FLUSH:j,Z_FINISH:F,Z_OK:S,Z_STREAM_END:H,Z_DEFAULT_COMPRESSION:W,Z_DEFAULT_STRATEGY:k,Z_DEFLATED:C}=q(11301);function e(R){this.options=u.assign({level:W,method:C,Ja:16384,windowBits:15,memLevel:8,strategy:k},R||{});let N=this.options;N.raw&&N.windowBits>0?N.windowBits=-N.windowBits:N.gzip&&N.windowBits>0&&N.windowBits<16&&(N.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new G,this.strm.avail_out=0;let q=w.deflateInit2(this.strm,N.level,N.method,N.windowBits,N.memLevel,N.strategy);if(q!==S)throw new Error(v[q]);if(N.header&&w.deflateSetHeader(this.strm,N.header),N.dictionary){let R;if(R="string"===typeof N.dictionary?M.string2buf(N.dictionary):"[object ArrayBuffer]"===J.call(N.dictionary)?new Uint8Array(N.dictionary):N.dictionary,q=w.deflateSetDictionary(this.strm,R),q!==S)throw new Error(v[q]);this._dict_set=!0}}function K(R,N){const q=new e(N);if(q.push(R,!0),q.err)throw q.msg||v[q.err];return q.result}e.prototype.push=function(R,N){const q=this.strm,u=this.options.Ja;let v,G;if(this.ended)return!1;for(G=N===~~N?N:!0===N?F:y,"string"===typeof R?q.input=M.string2buf(R):"[object ArrayBuffer]"===J.call(R)?q.input=new Uint8Array(R):q.input=R,q.next_in=0,q.avail_in=q.input.length;;)if(0===q.avail_out&&(q.output=new Uint8Array(u),q.next_out=0,q.avail_out=u),(G===a||G===j)&&q.avail_out<=6)this.onData(q.output.subarray(0,q.next_out)),q.avail_out=0;else{if(v=w.deflate(q,G),v===H)return q.next_out>0&&this.onData(q.output.subarray(0,q.next_out)),v=w.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===S;if(0!==q.avail_out){if(G>0&&q.next_out>0)this.onData(q.output.subarray(0,q.next_out)),q.avail_out=0;else if(0===q.avail_in)break}else this.onData(q.output)}return!0},e.prototype.onData=function(R){this.chunks.push(R)},e.prototype.onEnd=function(R){R===S&&(this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=R,this.msg=this.strm.msg},R.exports.Deflate=e,R.exports.deflate=K,R.exports.deflateRaw=function(R,N){return(N=N||{}).raw=!0,K(R,N)},R.exports.gzip=function(R,N){return(N=N||{}).gzip=!0,K(R,N)},R.exports.constants=q(11301)},11329:(R,N,q)=>{"use strict";const w=q(11332),u=q(11308),M=q(11315),v=q(11299),G=q(11322),J=q(11347),y=Object.prototype.toString,{Z_NO_FLUSH:a,Z_FINISH:j,Z_OK:F,Z_STREAM_END:S,Z_NEED_DICT:H,Z_STREAM_ERROR:W,Z_DATA_ERROR:k,Z_MEM_ERROR:C}=q(11301);function e(R){this.options=u.assign({Ja:65536,windowBits:15,to:""},R||{});const N=this.options;N.raw&&N.windowBits>=0&&N.windowBits<16&&(N.windowBits=-N.windowBits,0===N.windowBits&&(N.windowBits=-15)),!(N.windowBits>=0&&N.windowBits<16)||R&&R.windowBits||(N.windowBits+=32),N.windowBits>15&&N.windowBits<48&&0===(15&N.windowBits)&&(N.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new G,this.strm.avail_out=0;let q=w.inflateInit2(this.strm,N.windowBits);if(q!==F)throw new Error(v[q]);if(this.header=new J,w.inflateGetHeader(this.strm,this.header),N.dictionary&&("string"===typeof N.dictionary?N.dictionary=M.string2buf(N.dictionary):"[object ArrayBuffer]"===y.call(N.dictionary)&&(N.dictionary=new Uint8Array(N.dictionary)),N.raw&&(q=w.inflateSetDictionary(this.strm,N.dictionary),q!==F)))throw new Error(v[q])}function K(R,N){const q=new e(N);if(q.push(R),q.err)throw q.msg||v[q.err];return q.result}e.prototype.push=function(R,N){const q=this.strm,u=this.options.Ja,v=this.options.dictionary;let G,J,e;if(this.ended)return!1;for(J=N===~~N?N:!0===N?j:a,"[object ArrayBuffer]"===y.call(R)?q.input=new Uint8Array(R):q.input=R,q.next_in=0,q.avail_in=q.input.length;;){for(0===q.avail_out&&(q.output=new Uint8Array(u),q.next_out=0,q.avail_out=u),G=w.inflate(q,J),G===H&&v&&(G=w.inflateSetDictionary(q,v),G===F?G=w.inflate(q,J):G===k&&(G=H));q.avail_in>0&&G===S&&q.state.wrap>0&&0!==R[q.next_in];)w.inflateReset(q),G=w.inflate(q,J);switch(G){case W:case k:case H:case C:return this.onEnd(G),this.ended=!0,!1}if(e=q.avail_out,q.next_out&&(0===q.avail_out||G===S))if("string"===this.options.to){let R=M.utf8border(q.output,q.next_out),N=q.next_out-R,w=M.buf2string(q.output,R);q.next_out=N,q.avail_out=u-N,N&&q.output.set(q.output.subarray(R,R+N),0),this.onData(w)}else this.onData(q.output.length===q.next_out?q.output:q.output.subarray(0,q.next_out));if(G!==F||0!==e){if(G===S)return G=w.inflateEnd(this.strm),this.onEnd(G),this.ended=!0,!0;if(0===q.avail_in)break}}return!0},e.prototype.onData=function(R){this.chunks.push(R)},e.prototype.onEnd=function(R){R===F&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=R,this.msg=this.strm.msg},R.exports.Inflate=e,R.exports.inflate=K,R.exports.inflateRaw=function(R,N){return(N=N||{}).raw=!0,K(R,N)},R.exports.ungzip=K,R.exports.constants=q(11301)},11308:R=>{"use strict";const N=(R,N)=>Object.prototype.hasOwnProperty.call(R,N);R.exports.assign=function(R){const q=Array.prototype.slice.call(arguments,1);for(;q.length;){const w=q.shift();if(w){if("object"!==typeof w)throw new TypeError(w+"must be non-object");for(const q in w)N(w,q)&&(R[q]=w[q])}}return R},R.exports.flattenChunks=R=>{let N=0;for(let w=0,u=R.length;w<u;w++)N+=R[w].length;const q=new Uint8Array(N);for(let w=0,u=0,M=R.length;w<M;w++){let N=R[w];q.set(N,u),u+=N.length}return q}},11315:R=>{"use strict";let N=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(w){N=!1}const q=new Uint8Array(256);for(let u=0;u<256;u++)q[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;q[254]=q[254]=1,R.exports.string2buf=R=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(R);let N,q,w,u,M,v=R.length,G=0;for(u=0;u<v;u++)q=R.charCodeAt(u),55296===(64512&q)&&u+1<v&&(w=R.charCodeAt(u+1),56320===(64512&w)&&(q=65536+(q-55296<<10)+(w-56320),u++)),G+=q<128?1:q<2048?2:q<65536?3:4;for(N=new Uint8Array(G),M=0,u=0;M<G;u++)q=R.charCodeAt(u),55296===(64512&q)&&u+1<v&&(w=R.charCodeAt(u+1),56320===(64512&w)&&(q=65536+(q-55296<<10)+(w-56320),u++)),q<128?N[M++]=q:q<2048?(N[M++]=192|q>>>6,N[M++]=128|63&q):q<65536?(N[M++]=224|q>>>12,N[M++]=128|q>>>6&63,N[M++]=128|63&q):(N[M++]=240|q>>>18,N[M++]=128|q>>>12&63,N[M++]=128|q>>>6&63,N[M++]=128|63&q);return N};R.exports.buf2string=(R,w)=>{const u=w||R.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(R.subarray(0,w));let M,v;const G=new Array(2*u);for(v=0,M=0;M<u;){let N=R[M++];if(N<128){G[v++]=N;continue}let w=q[N];if(w>4)G[v++]=65533,M+=w-1;else{for(N&=2===w?31:3===w?15:7;w>1&&M<u;)N=N<<6|63&R[M++],w--;w>1?G[v++]=65533:N<65536?G[v++]=N:(N-=65536,G[v++]=55296|N>>10&1023,G[v++]=56320|1023&N)}}return((R,q)=>{if(q<65534&&R.subarray&&N)return String.fromCharCode.apply(null,R.length===q?R:R.subarray(0,q));let w="";for(let N=0;N<q;N++)w+=String.fromCharCode(R[N]);return w})(G,v)},R.exports.utf8border=(R,N)=>{(N=N||R.length)>R.length&&(N=R.length);let w=N-1;for(;w>=0&&128===(192&R[w]);)w--;return w<0||0===w?N:w+q[R[w]]>N?w:N}},11282:R=>{"use strict";R.exports=(R,N,q,w)=>{let u=65535&R,M=R>>>16&65535,v=0;for(;0!==q;){v=q>2e3?2e3:q,q-=v;do{u=u+N[w++]|0,M=M+u|0}while(--v);u%=65521,M%=65521}return u|M<<16}},11301:R=>{"use strict";R.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},11290:R=>{"use strict";const N=new Uint32Array((()=>{let R,N=[];for(var q=0;q<256;q++){R=q;for(var w=0;w<8;w++)R=1&R?3988292384^R>>>1:R>>>1;N[q]=R}return N})());R.exports=(R,q,w,u)=>{const M=N,v=u+w;R^=-1;for(let N=u;N<v;N++)R=R>>>8^M[255&(R^q[N])];return~R}},11268:(R,N,q)=>{"use strict";const{_tr_init:w,_tr_stored_block:u,_tr_flush_block:M,_tr_tally:v,_tr_align:G}=q(11275),J=q(11282),y=q(11290),a=q(11299),{Z_NO_FLUSH:j,Z_PARTIAL_FLUSH:F,Z_FULL_FLUSH:S,Z_FINISH:H,Z_BLOCK:W,Z_OK:k,Z_STREAM_END:C,Z_STREAM_ERROR:e,Z_DATA_ERROR:K,Z_BUF_ERROR:r,Z_DEFAULT_COMPRESSION:Z,Z_FILTERED:z,Z_HUFFMAN_ONLY:d,Z_RLE:x,Z_FIXED:E,Z_DEFAULT_STRATEGY:P,Z_UNKNOWN:s,Z_DEFLATED:O}=q(11301),L=258,m=262,o=103,A=113,n=666,Q=(R,N)=>(R.msg=a[N],N),Y=R=>(R<<1)-(R>4?9:0),T=R=>{let N=R.length;for(;--N>=0;)R[N]=0};let f=(R,N,q)=>(N<<R.hash_shift^q)&R.hash_mask;const c=R=>{const N=R.state;let q=N.pending;q>R.avail_out&&(q=R.avail_out),0!==q&&(R.output.set(N.pending_buf.subarray(N.pending_out,N.pending_out+q),R.next_out),R.next_out+=q,N.pending_out+=q,R.total_out+=q,R.avail_out-=q,N.pending-=q,0===N.pending&&(N.pending_out=0))},b=(R,N)=>{M(R,R.block_start>=0?R.block_start:-1,R.strstart-R.block_start,N),R.block_start=R.strstart,c(R.strm)},I=(R,N)=>{R.pending_buf[R.pending++]=N},V=(R,N)=>{R.pending_buf[R.pending++]=N>>>8&255,R.pending_buf[R.pending++]=255&N},t=(R,N,q,w)=>{let u=R.avail_in;return u>w&&(u=w),0===u?0:(R.avail_in-=u,N.set(R.input.subarray(R.next_in,R.next_in+u),q),1===R.state.wrap?R.adler=J(R.adler,N,u,q):2===R.state.wrap&&(R.adler=y(R.adler,N,u,q)),R.next_in+=u,R.total_in+=u,u)},i=(R,N)=>{let q,w,u=R.max_chain_length,M=R.strstart,v=R.prev_length,G=R.nice_match;const J=R.strstart>R.w_size-m?R.strstart-(R.w_size-m):0,y=R.window,a=R.w_mask,j=R.prev,F=R.strstart+L;let S=y[M+v-1],H=y[M+v];R.prev_length>=R.good_match&&(u>>=2),G>R.lookahead&&(G=R.lookahead);do{if(q=N,y[q+v]===H&&y[q+v-1]===S&&y[q]===y[M]&&y[++q]===y[M+1]){M+=2,q++;do{}while(y[++M]===y[++q]&&y[++M]===y[++q]&&y[++M]===y[++q]&&y[++M]===y[++q]&&y[++M]===y[++q]&&y[++M]===y[++q]&&y[++M]===y[++q]&&y[++M]===y[++q]&&M<F);if(w=L-(F-M),M=F-L,w>v){if(R.match_start=N,v=w,w>=G)break;S=y[M+v-1],H=y[M+v]}}}while((N=j[N&a])>J&&0!==--u);return v<=R.lookahead?v:R.lookahead},g=R=>{const N=R.w_size;let q,w,u,M,v;do{if(M=R.window_size-R.lookahead-R.strstart,R.strstart>=N+(N-m)){R.window.set(R.window.subarray(N,N+N),0),R.match_start-=N,R.strstart-=N,R.block_start-=N,w=R.hash_size,q=w;do{u=R.head[--q],R.head[q]=u>=N?u-N:0}while(--w);w=N,q=w;do{u=R.prev[--q],R.prev[q]=u>=N?u-N:0}while(--w);M+=N}if(0===R.strm.avail_in)break;if(w=t(R.strm,R.window,R.strstart+R.lookahead,M),R.lookahead+=w,R.lookahead+R.insert>=3)for(v=R.strstart-R.insert,R.ins_h=R.window[v],R.ins_h=f(R,R.ins_h,R.window[v+1]);R.insert&&(R.ins_h=f(R,R.ins_h,R.window[v+3-1]),R.prev[v&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=v,v++,R.insert--,!(R.lookahead+R.insert<3)););}while(R.lookahead<m&&0!==R.strm.avail_in)},U=(R,N)=>{let q,w;for(;;){if(R.lookahead<m){if(g(R),R.lookahead<m&&N===j)return 1;if(0===R.lookahead)break}if(q=0,R.lookahead>=3&&(R.ins_h=f(R,R.ins_h,R.window[R.strstart+3-1]),q=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),0!==q&&R.strstart-q<=R.w_size-m&&(R.match_length=i(R,q)),R.match_length>=3)if(w=v(R,R.strstart-R.match_start,R.match_length-3),R.lookahead-=R.match_length,R.match_length<=R.max_lazy_match&&R.lookahead>=3){R.match_length--;do{R.strstart++,R.ins_h=f(R,R.ins_h,R.window[R.strstart+3-1]),q=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart}while(0!==--R.match_length);R.strstart++}else R.strstart+=R.match_length,R.match_length=0,R.ins_h=R.window[R.strstart],R.ins_h=f(R,R.ins_h,R.window[R.strstart+1]);else w=v(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++;if(w&&(b(R,!1),0===R.strm.avail_out))return 1}return R.insert=R.strstart<2?R.strstart:2,N===H?(b(R,!0),0===R.strm.avail_out?3:4):R.last_lit&&(b(R,!1),0===R.strm.avail_out)?1:2},B=(R,N)=>{let q,w,u;for(;;){if(R.lookahead<m){if(g(R),R.lookahead<m&&N===j)return 1;if(0===R.lookahead)break}if(q=0,R.lookahead>=3&&(R.ins_h=f(R,R.ins_h,R.window[R.strstart+3-1]),q=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),R.prev_length=R.match_length,R.prev_match=R.match_start,R.match_length=2,0!==q&&R.prev_length<R.max_lazy_match&&R.strstart-q<=R.w_size-m&&(R.match_length=i(R,q),R.match_length<=5&&(R.strategy===z||3===R.match_length&&R.strstart-R.match_start>4096)&&(R.match_length=2)),R.prev_length>=3&&R.match_length<=R.prev_length){u=R.strstart+R.lookahead-3,w=v(R,R.strstart-1-R.prev_match,R.prev_length-3),R.lookahead-=R.prev_length-1,R.prev_length-=2;do{++R.strstart<=u&&(R.ins_h=f(R,R.ins_h,R.window[R.strstart+3-1]),q=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart)}while(0!==--R.prev_length);if(R.match_available=0,R.match_length=2,R.strstart++,w&&(b(R,!1),0===R.strm.avail_out))return 1}else if(R.match_available){if(w=v(R,0,R.window[R.strstart-1]),w&&b(R,!1),R.strstart++,R.lookahead--,0===R.strm.avail_out)return 1}else R.match_available=1,R.strstart++,R.lookahead--}return R.match_available&&(w=v(R,0,R.window[R.strstart-1]),R.match_available=0),R.insert=R.strstart<2?R.strstart:2,N===H?(b(R,!0),0===R.strm.avail_out?3:4):R.last_lit&&(b(R,!1),0===R.strm.avail_out)?1:2};function l(R,N,q,w,u){this.good_length=R,this.max_lazy=N,this.nice_length=q,this.max_chain=w,this.func=u}const X=[new l(0,0,0,0,((R,N)=>{let q=65535;for(q>R.pending_buf_size-5&&(q=R.pending_buf_size-5);;){if(R.lookahead<=1){if(g(R),0===R.lookahead&&N===j)return 1;if(0===R.lookahead)break}R.strstart+=R.lookahead,R.lookahead=0;const w=R.block_start+q;if((0===R.strstart||R.strstart>=w)&&(R.lookahead=R.strstart-w,R.strstart=w,b(R,!1),0===R.strm.avail_out))return 1;if(R.strstart-R.block_start>=R.w_size-m&&(b(R,!1),0===R.strm.avail_out))return 1}return R.insert=0,N===H?(b(R,!0),0===R.strm.avail_out?3:4):(R.strstart>R.block_start&&(b(R,!1),R.strm.avail_out),1)})),new l(4,4,8,4,U),new l(4,5,16,8,U),new l(4,6,32,32,U),new l(4,4,16,16,B),new l(8,16,32,32,B),new l(8,16,128,128,B),new l(8,32,128,256,B),new l(32,128,258,1024,B),new l(32,258,258,4096,B)];function h(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=O,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),T(this.dyn_ltree),T(this.dyn_dtree),T(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),T(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),T(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const D=R=>{if(!R||!R.state)return Q(R,e);R.total_in=R.total_out=0,R.data_type=s;const N=R.state;return N.pending=0,N.pending_out=0,N.wrap<0&&(N.wrap=-N.wrap),N.status=N.wrap?42:A,R.adler=2===N.wrap?0:1,N.last_flush=j,w(N),k},p=R=>{const N=D(R);var q;return N===k&&((q=R.state).window_size=2*q.w_size,T(q.head),q.max_lazy_match=X[q.level].max_lazy,q.good_match=X[q.level].good_length,q.nice_match=X[q.level].nice_length,q.max_chain_length=X[q.level].max_chain,q.strstart=0,q.block_start=0,q.lookahead=0,q.insert=0,q.match_length=q.prev_length=2,q.match_available=0,q.ins_h=0),N},RR=(R,N,q,w,u,M)=>{if(!R)return e;let v=1;if(N===Z&&(N=6),w<0?(v=0,w=-w):w>15&&(v=2,w-=16),u<1||u>9||q!==O||w<8||w>15||N<0||N>9||M<0||M>E)return Q(R,e);8===w&&(w=9);const G=new h;return R.state=G,G.strm=R,G.wrap=v,G.gzhead=null,G.w_bits=w,G.w_size=1<<G.w_bits,G.w_mask=G.w_size-1,G.hash_bits=u+7,G.hash_size=1<<G.hash_bits,G.hash_mask=G.hash_size-1,G.hash_shift=~~((G.hash_bits+3-1)/3),G.window=new Uint8Array(2*G.w_size),G.head=new Uint16Array(G.hash_size),G.prev=new Uint16Array(G.w_size),G.lit_bufsize=1<<u+6,G.pending_buf_size=4*G.lit_bufsize,G.pending_buf=new Uint8Array(G.pending_buf_size),G.d_buf=1*G.lit_bufsize,G.l_buf=3*G.lit_bufsize,G.level=N,G.strategy=M,G.method=q,p(R)};R.exports.deflateInit=(R,N)=>RR(R,N,O,15,8,P),R.exports.deflateInit2=RR,R.exports.deflateReset=p,R.exports.deflateResetKeep=D,R.exports.deflateSetHeader=(R,N)=>R&&R.state?2!==R.state.wrap?e:(R.state.gzhead=N,k):e,R.exports.deflate=(R,N)=>{let q,w;if(!R||!R.state||N>W||N<0)return R?Q(R,e):e;const M=R.state;if(!R.output||!R.input&&0!==R.avail_in||M.status===n&&N!==H)return Q(R,0===R.avail_out?r:e);M.strm=R;const J=M.last_flush;if(M.last_flush=N,42===M.status)if(2===M.wrap)R.adler=0,I(M,31),I(M,139),I(M,8),M.gzhead?(I(M,(M.gzhead.text?1:0)+(M.gzhead.hcrc?2:0)+(M.gzhead.extra?4:0)+(M.gzhead.name?8:0)+(M.gzhead.comment?16:0)),I(M,255&M.gzhead.time),I(M,M.gzhead.time>>8&255),I(M,M.gzhead.time>>16&255),I(M,M.gzhead.time>>24&255),I(M,9===M.level?2:M.strategy>=d||M.level<2?4:0),I(M,255&M.gzhead.os),M.gzhead.extra&&M.gzhead.extra.length&&(I(M,255&M.gzhead.extra.length),I(M,M.gzhead.extra.length>>8&255)),M.gzhead.hcrc&&(R.adler=y(R.adler,M.pending_buf,M.pending,0)),M.gzindex=0,M.status=69):(I(M,0),I(M,0),I(M,0),I(M,0),I(M,0),I(M,9===M.level?2:M.strategy>=d||M.level<2?4:0),I(M,3),M.status=A);else{let N=O+(M.w_bits-8<<4)<<8,q=-1;q=M.strategy>=d||M.level<2?0:M.level<6?1:6===M.level?2:3,N|=q<<6,0!==M.strstart&&(N|=32),N+=31-N%31,M.status=A,V(M,N),0!==M.strstart&&(V(M,R.adler>>>16),V(M,65535&R.adler)),R.adler=1}if(69===M.status)if(M.gzhead.extra){for(q=M.pending;M.gzindex<(65535&M.gzhead.extra.length)&&(M.pending!==M.pending_buf_size||(M.gzhead.hcrc&&M.pending>q&&(R.adler=y(R.adler,M.pending_buf,M.pending-q,q)),c(R),q=M.pending,M.pending!==M.pending_buf_size));)I(M,255&M.gzhead.extra[M.gzindex]),M.gzindex++;M.gzhead.hcrc&&M.pending>q&&(R.adler=y(R.adler,M.pending_buf,M.pending-q,q)),M.gzindex===M.gzhead.extra.length&&(M.gzindex=0,M.status=73)}else M.status=73;if(73===M.status)if(M.gzhead.name){q=M.pending;do{if(M.pending===M.pending_buf_size&&(M.gzhead.hcrc&&M.pending>q&&(R.adler=y(R.adler,M.pending_buf,M.pending-q,q)),c(R),q=M.pending,M.pending===M.pending_buf_size)){w=1;break}w=M.gzindex<M.gzhead.name.length?255&M.gzhead.name.charCodeAt(M.gzindex++):0,I(M,w)}while(0!==w);M.gzhead.hcrc&&M.pending>q&&(R.adler=y(R.adler,M.pending_buf,M.pending-q,q)),0===w&&(M.gzindex=0,M.status=91)}else M.status=91;if(91===M.status)if(M.gzhead.comment){q=M.pending;do{if(M.pending===M.pending_buf_size&&(M.gzhead.hcrc&&M.pending>q&&(R.adler=y(R.adler,M.pending_buf,M.pending-q,q)),c(R),q=M.pending,M.pending===M.pending_buf_size)){w=1;break}w=M.gzindex<M.gzhead.comment.length?255&M.gzhead.comment.charCodeAt(M.gzindex++):0,I(M,w)}while(0!==w);M.gzhead.hcrc&&M.pending>q&&(R.adler=y(R.adler,M.pending_buf,M.pending-q,q)),0===w&&(M.status=o)}else M.status=o;if(M.status===o&&(M.gzhead.hcrc?(M.pending+2>M.pending_buf_size&&c(R),M.pending+2<=M.pending_buf_size&&(I(M,255&R.adler),I(M,R.adler>>8&255),R.adler=0,M.status=A)):M.status=A),0!==M.pending){if(c(R),0===R.avail_out)return M.last_flush=-1,k}else if(0===R.avail_in&&Y(N)<=Y(J)&&N!==H)return Q(R,r);if(M.status===n&&0!==R.avail_in)return Q(R,r);if(0!==R.avail_in||0!==M.lookahead||N!==j&&M.status!==n){let q=M.strategy===d?((R,N)=>{let q;for(;;){if(0===R.lookahead&&(g(R),0===R.lookahead)){if(N===j)return 1;break}if(R.match_length=0,q=v(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++,q&&(b(R,!1),0===R.strm.avail_out))return 1}return R.insert=0,N===H?(b(R,!0),0===R.strm.avail_out?3:4):R.last_lit&&(b(R,!1),0===R.strm.avail_out)?1:2})(M,N):M.strategy===x?((R,N)=>{let q,w,u,M;const G=R.window;for(;;){if(R.lookahead<=L){if(g(R),R.lookahead<=L&&N===j)return 1;if(0===R.lookahead)break}if(R.match_length=0,R.lookahead>=3&&R.strstart>0&&(u=R.strstart-1,w=G[u],w===G[++u]&&w===G[++u]&&w===G[++u])){M=R.strstart+L;do{}while(w===G[++u]&&w===G[++u]&&w===G[++u]&&w===G[++u]&&w===G[++u]&&w===G[++u]&&w===G[++u]&&w===G[++u]&&u<M);R.match_length=L-(M-u),R.match_length>R.lookahead&&(R.match_length=R.lookahead)}if(R.match_length>=3?(q=v(R,1,R.match_length-3),R.lookahead-=R.match_length,R.strstart+=R.match_length,R.match_length=0):(q=v(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++),q&&(b(R,!1),0===R.strm.avail_out))return 1}return R.insert=0,N===H?(b(R,!0),0===R.strm.avail_out?3:4):R.last_lit&&(b(R,!1),0===R.strm.avail_out)?1:2})(M,N):X[M.level].func(M,N);if(3!==q&&4!==q||(M.status=n),1===q||3===q)return 0===R.avail_out&&(M.last_flush=-1),k;if(2===q&&(N===F?G(M):N!==W&&(u(M,0,0,!1),N===S&&(T(M.head),0===M.lookahead&&(M.strstart=0,M.block_start=0,M.insert=0))),c(R),0===R.avail_out))return M.last_flush=-1,k}return N!==H?k:M.wrap<=0?C:(2===M.wrap?(I(M,255&R.adler),I(M,R.adler>>8&255),I(M,R.adler>>16&255),I(M,R.adler>>24&255),I(M,255&R.total_in),I(M,R.total_in>>8&255),I(M,R.total_in>>16&255),I(M,R.total_in>>24&255)):(V(M,R.adler>>>16),V(M,65535&R.adler)),c(R),M.wrap>0&&(M.wrap=-M.wrap),0!==M.pending?k:C)},R.exports.deflateEnd=R=>{if(!R||!R.state)return e;const N=R.state.status;return 42!==N&&69!==N&&73!==N&&91!==N&&N!==o&&N!==A&&N!==n?Q(R,e):(R.state=null,N===A?Q(R,K):k)},R.exports.deflateSetDictionary=(R,N)=>{let q=N.length;if(!R||!R.state)return e;const w=R.state,u=w.wrap;if(2===u||1===u&&42!==w.status||w.lookahead)return e;if(1===u&&(R.adler=J(R.adler,N,q,0)),w.wrap=0,q>=w.w_size){0===u&&(T(w.head),w.strstart=0,w.block_start=0,w.insert=0);let R=new Uint8Array(w.w_size);R.set(N.subarray(q-w.w_size,q),0),N=R,q=w.w_size}const M=R.avail_in,v=R.next_in,G=R.input;for(R.avail_in=q,R.next_in=0,R.input=N,g(w);w.lookahead>=3;){let R=w.strstart,N=w.lookahead-2;do{w.ins_h=f(w,w.ins_h,w.window[R+3-1]),w.prev[R&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=R,R++}while(--N);w.strstart=R,w.lookahead=2,g(w)}return w.strstart+=w.lookahead,w.block_start=w.strstart,w.insert=w.lookahead,w.lookahead=0,w.match_length=w.prev_length=2,w.match_available=0,R.next_in=v,R.input=G,R.avail_in=M,w.wrap=u,k},R.exports.deflateInfo="pako deflate (from Nodeca project)"},11347:R=>{"use strict";R.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},11334:R=>{"use strict";R.exports=function(R,N){let q,w,u,M,v,G,J,y,a,j,F,S,H,W,k,C,e,K,r,Z,z,d,x,E;const P=R.state;q=R.next_in,x=R.input,w=q+(R.avail_in-5),u=R.next_out,E=R.output,M=u-(N-R.avail_out),v=u+(R.avail_out-257),G=P.dmax,J=P.wsize,y=P.whave,a=P.wnext,j=P.window,F=P.hold,S=P.bits,H=P.lencode,W=P.distcode,k=(1<<P.lenbits)-1,C=(1<<P.distbits)-1;R:do{S<15&&(F+=x[q++]<<S,S+=8,F+=x[q++]<<S,S+=8),e=H[F&k];N:for(;;){if(K=e>>>24,F>>>=K,S-=K,K=e>>>16&255,0===K)E[u++]=65535&e;else{if(!(16&K)){if(0===(64&K)){e=H[(65535&e)+(F&(1<<K)-1)];continue N}if(32&K){P.mode=12;break R}R.msg="invalid literal/length code",P.mode=30;break R}r=65535&e,K&=15,K&&(S<K&&(F+=x[q++]<<S,S+=8),r+=F&(1<<K)-1,F>>>=K,S-=K),S<15&&(F+=x[q++]<<S,S+=8,F+=x[q++]<<S,S+=8),e=W[F&C];q:for(;;){if(K=e>>>24,F>>>=K,S-=K,K=e>>>16&255,!(16&K)){if(0===(64&K)){e=W[(65535&e)+(F&(1<<K)-1)];continue q}R.msg="invalid distance code",P.mode=30;break R}if(Z=65535&e,K&=15,S<K&&(F+=x[q++]<<S,S+=8,S<K&&(F+=x[q++]<<S,S+=8)),Z+=F&(1<<K)-1,Z>G){R.msg="invalid distance too far back",P.mode=30;break R}if(F>>>=K,S-=K,K=u-M,Z>K){if(K=Z-K,K>y&&P.sane){R.msg="invalid distance too far back",P.mode=30;break R}if(z=0,d=j,0===a){if(z+=J-K,K<r){r-=K;do{E[u++]=j[z++]}while(--K);z=u-Z,d=E}}else if(a<K){if(z+=J+a-K,K-=a,K<r){r-=K;do{E[u++]=j[z++]}while(--K);if(z=0,a<r){K=a,r-=K;do{E[u++]=j[z++]}while(--K);z=u-Z,d=E}}}else if(z+=a-K,K<r){r-=K;do{E[u++]=j[z++]}while(--K);z=u-Z,d=E}for(;r>2;)E[u++]=d[z++],E[u++]=d[z++],E[u++]=d[z++],r-=3;r&&(E[u++]=d[z++],r>1&&(E[u++]=d[z++]))}else{z=u-Z;do{E[u++]=E[z++],E[u++]=E[z++],E[u++]=E[z++],r-=3}while(r>2);r&&(E[u++]=E[z++],r>1&&(E[u++]=E[z++]))}break}}break}}while(q<w&&u<v);r=S>>3,q-=r,S-=r<<3,F&=(1<<S)-1,R.next_in=q,R.next_out=u,R.avail_in=q<w?w-q+5:5-(q-w),R.avail_out=u<v?v-u+257:257-(u-v),P.hold=F,P.bits=S}},11332:(R,N,q)=>{"use strict";const w=q(11282),u=q(11290),M=q(11334),v=q(11340),{Z_FINISH:G,Z_BLOCK:J,Z_TREES:y,Z_OK:a,Z_STREAM_END:j,Z_NEED_DICT:F,Z_STREAM_ERROR:S,Z_DATA_ERROR:H,Z_MEM_ERROR:W,Z_BUF_ERROR:k,Z_DEFLATED:C}=q(11301),e=12,K=30,r=R=>(R>>>24&255)+(R>>>8&65280)+((65280&R)<<8)+((255&R)<<24);function Z(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const z=R=>{if(!R||!R.state)return S;const N=R.state;return R.total_in=R.total_out=N.total=0,R.msg="",N.wrap&&(R.adler=1&N.wrap),N.mode=1,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new Int32Array(852),N.distcode=N.distdyn=new Int32Array(592),N.sane=1,N.back=-1,a},d=R=>{if(!R||!R.state)return S;const N=R.state;return N.wsize=0,N.whave=0,N.wnext=0,z(R)},x=(R,N)=>{let q;if(!R||!R.state)return S;const w=R.state;return N<0?(q=0,N=-N):(q=1+(N>>4),N<48&&(N&=15)),N&&(N<8||N>15)?S:(null!==w.window&&w.wbits!==N&&(w.window=null),w.wrap=q,w.wbits=N,d(R))},E=(R,N)=>{if(!R)return S;const q=new Z;R.state=q,q.window=null;const w=x(R,N);return w!==a&&(R.state=null),w};let P,s,O=!0;const L=R=>{if(O){P=new Int32Array(512),s=new Int32Array(32);let N=0;for(;N<144;)R.lens[N++]=8;for(;N<256;)R.lens[N++]=9;for(;N<280;)R.lens[N++]=7;for(;N<288;)R.lens[N++]=8;for(v(1,R.lens,0,288,P,0,R.work,{bits:9}),N=0;N<32;)R.lens[N++]=5;v(2,R.lens,0,32,s,0,R.work,{bits:5}),O=!1}R.lencode=P,R.lenbits=9,R.distcode=s,R.distbits=5},m=(R,N,q,w)=>{let u;const M=R.state;return null===M.window&&(M.wsize=1<<M.wbits,M.wnext=0,M.whave=0,M.window=new Uint8Array(M.wsize)),w>=M.wsize?(M.window.set(N.subarray(q-M.wsize,q),0),M.wnext=0,M.whave=M.wsize):(u=M.wsize-M.wnext,u>w&&(u=w),M.window.set(N.subarray(q-w,q-w+u),M.wnext),(w-=u)?(M.window.set(N.subarray(q-w,q),0),M.wnext=w,M.whave=M.wsize):(M.wnext+=u,M.wnext===M.wsize&&(M.wnext=0),M.whave<M.wsize&&(M.whave+=u))),0};R.exports.inflateReset=d,R.exports.inflateReset2=x,R.exports.inflateResetKeep=z,R.exports.inflateInit=R=>E(R,15),R.exports.inflateInit2=E,R.exports.inflate=(R,N)=>{let q,Z,z,d,x,E,P,s,O,o,A,n,Q,Y,T,f,c,b,I,V,t,i,g=0;const U=new Uint8Array(4);let B,l;const X=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!R||!R.state||!R.output||!R.input&&0!==R.avail_in)return S;q=R.state,q.mode===e&&(q.mode=13),x=R.next_out,z=R.output,P=R.avail_out,d=R.next_in,Z=R.input,E=R.avail_in,s=q.hold,O=q.bits,o=E,A=P,i=a;R:for(;;)switch(q.mode){case 1:if(0===q.wrap){q.mode=13;break}for(;O<16;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}if(2&q.wrap&&35615===s){q.check=0,U[0]=255&s,U[1]=s>>>8&255,q.check=u(q.check,U,2,0),s=0,O=0,q.mode=2;break}if(q.flags=0,q.head&&(q.head.done=!1),!(1&q.wrap)||(((255&s)<<8)+(s>>8))%31){R.msg="incorrect header check",q.mode=K;break}if((15&s)!==C){R.msg="unknown compression method",q.mode=K;break}if(s>>>=4,O-=4,t=8+(15&s),0===q.wbits)q.wbits=t;else if(t>q.wbits){R.msg="invalid window size",q.mode=K;break}q.dmax=1<<q.wbits,R.adler=q.check=1,q.mode=512&s?10:e,s=0,O=0;break;case 2:for(;O<16;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}if(q.flags=s,(255&q.flags)!==C){R.msg="unknown compression method",q.mode=K;break}if(57344&q.flags){R.msg="unknown header flags set",q.mode=K;break}q.head&&(q.head.text=s>>8&1),512&q.flags&&(U[0]=255&s,U[1]=s>>>8&255,q.check=u(q.check,U,2,0)),s=0,O=0,q.mode=3;case 3:for(;O<32;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}q.head&&(q.head.time=s),512&q.flags&&(U[0]=255&s,U[1]=s>>>8&255,U[2]=s>>>16&255,U[3]=s>>>24&255,q.check=u(q.check,U,4,0)),s=0,O=0,q.mode=4;case 4:for(;O<16;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}q.head&&(q.head.xflags=255&s,q.head.os=s>>8),512&q.flags&&(U[0]=255&s,U[1]=s>>>8&255,q.check=u(q.check,U,2,0)),s=0,O=0,q.mode=5;case 5:if(1024&q.flags){for(;O<16;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}q.length=s,q.head&&(q.head.extra_len=s),512&q.flags&&(U[0]=255&s,U[1]=s>>>8&255,q.check=u(q.check,U,2,0)),s=0,O=0}else q.head&&(q.head.extra=null);q.mode=6;case 6:if(1024&q.flags&&(n=q.length,n>E&&(n=E),n&&(q.head&&(t=q.head.extra_len-q.length,q.head.extra||(q.head.extra=new Uint8Array(q.head.extra_len)),q.head.extra.set(Z.subarray(d,d+n),t)),512&q.flags&&(q.check=u(q.check,Z,n,d)),E-=n,d+=n,q.length-=n),q.length))break R;q.length=0,q.mode=7;case 7:if(2048&q.flags){if(0===E)break R;n=0;do{t=Z[d+n++],q.head&&t&&q.length<65536&&(q.head.name+=String.fromCharCode(t))}while(t&&n<E);if(512&q.flags&&(q.check=u(q.check,Z,n,d)),E-=n,d+=n,t)break R}else q.head&&(q.head.name=null);q.length=0,q.mode=8;case 8:if(4096&q.flags){if(0===E)break R;n=0;do{t=Z[d+n++],q.head&&t&&q.length<65536&&(q.head.comment+=String.fromCharCode(t))}while(t&&n<E);if(512&q.flags&&(q.check=u(q.check,Z,n,d)),E-=n,d+=n,t)break R}else q.head&&(q.head.comment=null);q.mode=9;case 9:if(512&q.flags){for(;O<16;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}if(s!==(65535&q.check)){R.msg="header crc mismatch",q.mode=K;break}s=0,O=0}q.head&&(q.head.hcrc=q.flags>>9&1,q.head.done=!0),R.adler=q.check=0,q.mode=e;break;case 10:for(;O<32;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}R.adler=q.check=r(s),s=0,O=0,q.mode=11;case 11:if(0===q.havedict)return R.next_out=x,R.avail_out=P,R.next_in=d,R.avail_in=E,q.hold=s,q.bits=O,F;R.adler=q.check=1,q.mode=e;case e:if(N===J||N===y)break R;case 13:if(q.last){s>>>=7&O,O-=7&O,q.mode=27;break}for(;O<3;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}switch(q.last=1&s,s>>>=1,O-=1,3&s){case 0:q.mode=14;break;case 1:if(L(q),q.mode=20,N===y){s>>>=2,O-=2;break R}break;case 2:q.mode=17;break;case 3:R.msg="invalid block type",q.mode=K}s>>>=2,O-=2;break;case 14:for(s>>>=7&O,O-=7&O;O<32;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}if((65535&s)!==(s>>>16^65535)){R.msg="invalid stored block lengths",q.mode=K;break}if(q.length=65535&s,s=0,O=0,q.mode=15,N===y)break R;case 15:q.mode=16;case 16:if(n=q.length,n){if(n>E&&(n=E),n>P&&(n=P),0===n)break R;z.set(Z.subarray(d,d+n),x),E-=n,d+=n,P-=n,x+=n,q.length-=n;break}q.mode=e;break;case 17:for(;O<14;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}if(q.nlen=257+(31&s),s>>>=5,O-=5,q.ndist=1+(31&s),s>>>=5,O-=5,q.ncode=4+(15&s),s>>>=4,O-=4,q.nlen>286||q.ndist>30){R.msg="too many length or distance symbols",q.mode=K;break}q.have=0,q.mode=18;case 18:for(;q.have<q.ncode;){for(;O<3;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}q.lens[X[q.have++]]=7&s,s>>>=3,O-=3}for(;q.have<19;)q.lens[X[q.have++]]=0;if(q.lencode=q.lendyn,q.lenbits=7,B={bits:q.lenbits},i=v(0,q.lens,0,19,q.lencode,0,q.work,B),q.lenbits=B.bits,i){R.msg="invalid code lengths set",q.mode=K;break}q.have=0,q.mode=19;case 19:for(;q.have<q.nlen+q.ndist;){for(;g=q.lencode[s&(1<<q.lenbits)-1],T=g>>>24,f=g>>>16&255,c=65535&g,!(T<=O);){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}if(c<16)s>>>=T,O-=T,q.lens[q.have++]=c;else{if(16===c){for(l=T+2;O<l;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}if(s>>>=T,O-=T,0===q.have){R.msg="invalid bit length repeat",q.mode=K;break}t=q.lens[q.have-1],n=3+(3&s),s>>>=2,O-=2}else if(17===c){for(l=T+3;O<l;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}s>>>=T,O-=T,t=0,n=3+(7&s),s>>>=3,O-=3}else{for(l=T+7;O<l;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}s>>>=T,O-=T,t=0,n=11+(127&s),s>>>=7,O-=7}if(q.have+n>q.nlen+q.ndist){R.msg="invalid bit length repeat",q.mode=K;break}for(;n--;)q.lens[q.have++]=t}}if(q.mode===K)break;if(0===q.lens[256]){R.msg="invalid code -- missing end-of-block",q.mode=K;break}if(q.lenbits=9,B={bits:q.lenbits},i=v(1,q.lens,0,q.nlen,q.lencode,0,q.work,B),q.lenbits=B.bits,i){R.msg="invalid literal/lengths set",q.mode=K;break}if(q.distbits=6,q.distcode=q.distdyn,B={bits:q.distbits},i=v(2,q.lens,q.nlen,q.ndist,q.distcode,0,q.work,B),q.distbits=B.bits,i){R.msg="invalid distances set",q.mode=K;break}if(q.mode=20,N===y)break R;case 20:q.mode=21;case 21:if(E>=6&&P>=258){R.next_out=x,R.avail_out=P,R.next_in=d,R.avail_in=E,q.hold=s,q.bits=O,M(R,A),x=R.next_out,z=R.output,P=R.avail_out,d=R.next_in,Z=R.input,E=R.avail_in,s=q.hold,O=q.bits,q.mode===e&&(q.back=-1);break}for(q.back=0;g=q.lencode[s&(1<<q.lenbits)-1],T=g>>>24,f=g>>>16&255,c=65535&g,!(T<=O);){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}if(f&&0===(240&f)){for(b=T,I=f,V=c;g=q.lencode[V+((s&(1<<b+I)-1)>>b)],T=g>>>24,f=g>>>16&255,c=65535&g,!(b+T<=O);){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}s>>>=b,O-=b,q.back+=b}if(s>>>=T,O-=T,q.back+=T,q.length=c,0===f){q.mode=26;break}if(32&f){q.back=-1,q.mode=e;break}if(64&f){R.msg="invalid literal/length code",q.mode=K;break}q.extra=15&f,q.mode=22;case 22:if(q.extra){for(l=q.extra;O<l;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}q.length+=s&(1<<q.extra)-1,s>>>=q.extra,O-=q.extra,q.back+=q.extra}q.was=q.length,q.mode=23;case 23:for(;g=q.distcode[s&(1<<q.distbits)-1],T=g>>>24,f=g>>>16&255,c=65535&g,!(T<=O);){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}if(0===(240&f)){for(b=T,I=f,V=c;g=q.distcode[V+((s&(1<<b+I)-1)>>b)],T=g>>>24,f=g>>>16&255,c=65535&g,!(b+T<=O);){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}s>>>=b,O-=b,q.back+=b}if(s>>>=T,O-=T,q.back+=T,64&f){R.msg="invalid distance code",q.mode=K;break}q.offset=c,q.extra=15&f,q.mode=24;case 24:if(q.extra){for(l=q.extra;O<l;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}q.offset+=s&(1<<q.extra)-1,s>>>=q.extra,O-=q.extra,q.back+=q.extra}if(q.offset>q.dmax){R.msg="invalid distance too far back",q.mode=K;break}q.mode=25;case 25:if(0===P)break R;if(n=A-P,q.offset>n){if(n=q.offset-n,n>q.whave&&q.sane){R.msg="invalid distance too far back",q.mode=K;break}n>q.wnext?(n-=q.wnext,Q=q.wsize-n):Q=q.wnext-n,n>q.length&&(n=q.length),Y=q.window}else Y=z,Q=x-q.offset,n=q.length;n>P&&(n=P),P-=n,q.length-=n;do{z[x++]=Y[Q++]}while(--n);0===q.length&&(q.mode=21);break;case 26:if(0===P)break R;z[x++]=q.length,P--,q.mode=21;break;case 27:if(q.wrap){for(;O<32;){if(0===E)break R;E--,s|=Z[d++]<<O,O+=8}if(A-=P,R.total_out+=A,q.total+=A,A&&(R.adler=q.check=q.flags?u(q.check,z,A,x-A):w(q.check,z,A,x-A)),A=P,(q.flags?s:r(s))!==q.check){R.msg="incorrect data check",q.mode=K;break}s=0,O=0}q.mode=28;case 28:if(q.wrap&&q.flags){for(;O<32;){if(0===E)break R;E--,s+=Z[d++]<<O,O+=8}if(s!==(4294967295&q.total)){R.msg="incorrect length check",q.mode=K;break}s=0,O=0}q.mode=29;case 29:i=j;break R;case K:i=H;break R;case 31:return W;default:return S}return R.next_out=x,R.avail_out=P,R.next_in=d,R.avail_in=E,q.hold=s,q.bits=O,(q.wsize||A!==R.avail_out&&q.mode<K&&(q.mode<27||N!==G))&&m(R,R.output,R.next_out,A-R.avail_out)?(q.mode=31,W):(o-=R.avail_in,A-=R.avail_out,R.total_in+=o,R.total_out+=A,q.total+=A,q.wrap&&A&&(R.adler=q.check=q.flags?u(q.check,z,A,R.next_out-A):w(q.check,z,A,R.next_out-A)),R.data_type=q.bits+(q.last?64:0)+(q.mode===e?128:0)+(20===q.mode||15===q.mode?256:0),(0===o&&0===A||N===G)&&i===a&&(i=k),i)},R.exports.inflateEnd=R=>{if(!R||!R.state)return S;let N=R.state;return N.window&&(N.window=null),R.state=null,a},R.exports.inflateGetHeader=(R,N)=>{if(!R||!R.state)return S;const q=R.state;return 0===(2&q.wrap)?S:(q.head=N,N.done=!1,a)},R.exports.inflateSetDictionary=(R,N)=>{const q=N.length;let u,M,v;return R&&R.state?(u=R.state,0!==u.wrap&&11!==u.mode?S:11===u.mode&&(M=1,M=w(M,N,q,0),M!==u.check)?H:(v=m(R,N,q,q),v?(u.mode=31,W):(u.havedict=1,a))):S},R.exports.inflateInfo="pako inflate (from Nodeca project)"},11340:R=>{"use strict";const N=15,q=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),w=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),u=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),M=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);R.exports=(R,v,G,J,y,a,j,F)=>{const S=F.bits;let H,W,k,C,e,K,r=0,Z=0,z=0,d=0,x=0,E=0,P=0,s=0,O=0,L=0,m=null,o=0;const A=new Uint16Array(16),n=new Uint16Array(16);let Q,Y,T,f=null,c=0;for(r=0;r<=N;r++)A[r]=0;for(Z=0;Z<J;Z++)A[v[G+Z]]++;for(x=S,d=N;d>=1&&0===A[d];d--);if(x>d&&(x=d),0===d)return y[a++]=20971520,y[a++]=20971520,F.bits=1,0;for(z=1;z<d&&0===A[z];z++);for(x<z&&(x=z),s=1,r=1;r<=N;r++)if(s<<=1,s-=A[r],s<0)return-1;if(s>0&&(0===R||1!==d))return-1;for(n[1]=0,r=1;r<N;r++)n[r+1]=n[r]+A[r];for(Z=0;Z<J;Z++)0!==v[G+Z]&&(j[n[v[G+Z]]++]=Z);if(0===R?(m=f=j,K=19):1===R?(m=q,o-=257,f=w,c-=257,K=256):(m=u,f=M,K=-1),L=0,Z=0,r=z,e=a,E=x,P=0,k=-1,O=1<<x,C=O-1,1===R&&O>852||2===R&&O>592)return 1;for(;;){Q=r-P,j[Z]<K?(Y=0,T=j[Z]):j[Z]>K?(Y=f[c+j[Z]],T=m[o+j[Z]]):(Y=96,T=0),H=1<<r-P,W=1<<E,z=W;do{W-=H,y[e+(L>>P)+W]=Q<<24|Y<<16|T}while(0!==W);for(H=1<<r-1;L&H;)H>>=1;if(0!==H?(L&=H-1,L+=H):L=0,Z++,0===--A[r]){if(r===d)break;r=v[G+j[Z]]}if(r>x&&(L&C)!==k){for(0===P&&(P=x),e+=z,E=r-P,s=1<<E;E+P<d&&(s-=A[E+P],!(s<=0));)E++,s<<=1;if(O+=1<<E,1===R&&O>852||2===R&&O>592)return 1;k=L&C,y[k]=x<<24|E<<16|e-a}}return 0!==L&&(y[e+L]=r-P<<24|64<<16),F.bits=x,0}},11299:R=>{"use strict";R.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},11275:R=>{"use strict";function N(R){let N=R.length;for(;--N>=0;)R[N]=0}const q=256,w=286,u=30,M=15,v=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),G=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),J=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),y=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=new Array(576);N(a);const j=new Array(60);N(j);const F=new Array(512);N(F);const S=new Array(256);N(S);const H=new Array(29);N(H);const W=new Array(u);function k(R,N,q,w,u){this.static_tree=R,this.extra_bits=N,this.extra_base=q,this.elems=w,this.max_length=u,this.has_stree=R&&R.length}let C,e,K;function r(R,N){this.dyn_tree=R,this.max_code=0,this.stat_desc=N}N(W);const Z=R=>R<256?F[R]:F[256+(R>>>7)],z=(R,N)=>{R.pending_buf[R.pending++]=255&N,R.pending_buf[R.pending++]=N>>>8&255},d=(R,N,q)=>{R.bi_valid>16-q?(R.bi_buf|=N<<R.bi_valid&65535,z(R,R.bi_buf),R.bi_buf=N>>16-R.bi_valid,R.bi_valid+=q-16):(R.bi_buf|=N<<R.bi_valid&65535,R.bi_valid+=q)},x=(R,N,q)=>{d(R,q[2*N],q[2*N+1])},E=(R,N)=>{let q=0;do{q|=1&R,R>>>=1,q<<=1}while(--N>0);return q>>>1},P=(R,N,q)=>{const w=new Array(16);let u,v,G=0;for(u=1;u<=M;u++)w[u]=G=G+q[u-1]<<1;for(v=0;v<=N;v++){let N=R[2*v+1];0!==N&&(R[2*v]=E(w[N]++,N))}},s=R=>{let N;for(N=0;N<w;N++)R.dyn_ltree[2*N]=0;for(N=0;N<u;N++)R.dyn_dtree[2*N]=0;for(N=0;N<19;N++)R.bl_tree[2*N]=0;R.dyn_ltree[512]=1,R.opt_len=R.static_len=0,R.last_lit=R.matches=0},O=R=>{R.bi_valid>8?z(R,R.bi_buf):R.bi_valid>0&&(R.pending_buf[R.pending++]=R.bi_buf),R.bi_buf=0,R.bi_valid=0},L=(R,N,q,w)=>{const u=2*N,M=2*q;return R[u]<R[M]||R[u]===R[M]&&w[N]<=w[q]},m=(R,N,q)=>{const w=R.heap[q];let u=q<<1;for(;u<=R.heap_len&&(u<R.heap_len&&L(N,R.heap[u+1],R.heap[u],R.depth)&&u++,!L(N,w,R.heap[u],R.depth));)R.heap[q]=R.heap[u],q=u,u<<=1;R.heap[q]=w},o=(R,N,w)=>{let u,M,J,y,a=0;if(0!==R.last_lit)do{u=R.pending_buf[R.d_buf+2*a]<<8|R.pending_buf[R.d_buf+2*a+1],M=R.pending_buf[R.l_buf+a],a++,0===u?x(R,M,N):(J=S[M],x(R,J+q+1,N),y=v[J],0!==y&&(M-=H[J],d(R,M,y)),u--,J=Z(u),x(R,J,w),y=G[J],0!==y&&(u-=W[J],d(R,u,y)))}while(a<R.last_lit);x(R,256,N)},A=(R,N)=>{const q=N.dyn_tree,w=N.stat_desc.static_tree,u=N.stat_desc.has_stree,v=N.stat_desc.elems;let G,J,y,a=-1;for(R.heap_len=0,R.heap_max=573,G=0;G<v;G++)0!==q[2*G]?(R.heap[++R.heap_len]=a=G,R.depth[G]=0):q[2*G+1]=0;for(;R.heap_len<2;)y=R.heap[++R.heap_len]=a<2?++a:0,q[2*y]=1,R.depth[y]=0,R.opt_len--,u&&(R.static_len-=w[2*y+1]);for(N.max_code=a,G=R.heap_len>>1;G>=1;G--)m(R,q,G);y=v;do{G=R.heap[1],R.heap[1]=R.heap[R.heap_len--],m(R,q,1),J=R.heap[1],R.heap[--R.heap_max]=G,R.heap[--R.heap_max]=J,q[2*y]=q[2*G]+q[2*J],R.depth[y]=(R.depth[G]>=R.depth[J]?R.depth[G]:R.depth[J])+1,q[2*G+1]=q[2*J+1]=y,R.heap[1]=y++,m(R,q,1)}while(R.heap_len>=2);R.heap[--R.heap_max]=R.heap[1],((R,N)=>{const q=N.dyn_tree,w=N.max_code,u=N.stat_desc.static_tree,v=N.stat_desc.has_stree,G=N.stat_desc.extra_bits,J=N.stat_desc.extra_base,y=N.stat_desc.max_length;let a,j,F,S,H,W,k=0;for(S=0;S<=M;S++)R.bl_count[S]=0;for(q[2*R.heap[R.heap_max]+1]=0,a=R.heap_max+1;a<573;a++)j=R.heap[a],S=q[2*q[2*j+1]+1]+1,S>y&&(S=y,k++),q[2*j+1]=S,j>w||(R.bl_count[S]++,H=0,j>=J&&(H=G[j-J]),W=q[2*j],R.opt_len+=W*(S+H),v&&(R.static_len+=W*(u[2*j+1]+H)));if(0!==k){do{for(S=y-1;0===R.bl_count[S];)S--;R.bl_count[S]--,R.bl_count[S+1]+=2,R.bl_count[y]--,k-=2}while(k>0);for(S=y;0!==S;S--)for(j=R.bl_count[S];0!==j;)F=R.heap[--a],F>w||(q[2*F+1]!==S&&(R.opt_len+=(S-q[2*F+1])*q[2*F],q[2*F+1]=S),j--)}})(R,N),P(q,a,R.bl_count)},n=(R,N,q)=>{let w,u,M=-1,v=N[1],G=0,J=7,y=4;for(0===v&&(J=138,y=3),N[2*(q+1)+1]=65535,w=0;w<=q;w++)u=v,v=N[2*(w+1)+1],++G<J&&u===v||(G<y?R.bl_tree[2*u]+=G:0!==u?(u!==M&&R.bl_tree[2*u]++,R.bl_tree[32]++):G<=10?R.bl_tree[34]++:R.bl_tree[36]++,G=0,M=u,0===v?(J=138,y=3):u===v?(J=6,y=3):(J=7,y=4))},Q=(R,N,q)=>{let w,u,M=-1,v=N[1],G=0,J=7,y=4;for(0===v&&(J=138,y=3),w=0;w<=q;w++)if(u=v,v=N[2*(w+1)+1],!(++G<J&&u===v)){if(G<y)do{x(R,u,R.bl_tree)}while(0!==--G);else 0!==u?(u!==M&&(x(R,u,R.bl_tree),G--),x(R,16,R.bl_tree),d(R,G-3,2)):G<=10?(x(R,17,R.bl_tree),d(R,G-3,3)):(x(R,18,R.bl_tree),d(R,G-11,7));G=0,M=u,0===v?(J=138,y=3):u===v?(J=6,y=3):(J=7,y=4)}};let Y=!1;const T=(R,N,q,w)=>{d(R,0+(w?1:0),3),((R,N,q,w)=>{O(R),w&&(z(R,q),z(R,~q)),R.pending_buf.set(R.window.subarray(N,N+q),R.pending),R.pending+=q})(R,N,q,!0)};R.exports._tr_init=R=>{Y||((()=>{let R,N,q,y,r;const Z=new Array(16);for(q=0,y=0;y<28;y++)for(H[y]=q,R=0;R<1<<v[y];R++)S[q++]=y;for(S[q-1]=y,r=0,y=0;y<16;y++)for(W[y]=r,R=0;R<1<<G[y];R++)F[r++]=y;for(r>>=7;y<u;y++)for(W[y]=r<<7,R=0;R<1<<G[y]-7;R++)F[256+r++]=y;for(N=0;N<=M;N++)Z[N]=0;for(R=0;R<=143;)a[2*R+1]=8,R++,Z[8]++;for(;R<=255;)a[2*R+1]=9,R++,Z[9]++;for(;R<=279;)a[2*R+1]=7,R++,Z[7]++;for(;R<=287;)a[2*R+1]=8,R++,Z[8]++;for(P(a,287,Z),R=0;R<u;R++)j[2*R+1]=5,j[2*R]=E(R,5);C=new k(a,v,257,w,M),e=new k(j,G,0,u,M),K=new k(new Array(0),J,0,19,7)})(),Y=!0),R.l_desc=new r(R.dyn_ltree,C),R.d_desc=new r(R.dyn_dtree,e),R.bl_desc=new r(R.bl_tree,K),R.bi_buf=0,R.bi_valid=0,s(R)},R.exports._tr_stored_block=T,R.exports._tr_flush_block=(R,N,w,u)=>{let M,v,G=0;R.level>0?(2===R.strm.data_type&&(R.strm.data_type=(R=>{let N,w=4093624447;for(N=0;N<=31;N++,w>>>=1)if(1&w&&0!==R.dyn_ltree[2*N])return 0;if(0!==R.dyn_ltree[18]||0!==R.dyn_ltree[20]||0!==R.dyn_ltree[26])return 1;for(N=32;N<q;N++)if(0!==R.dyn_ltree[2*N])return 1;return 0})(R)),A(R,R.l_desc),A(R,R.d_desc),G=(R=>{let N;for(n(R,R.dyn_ltree,R.l_desc.max_code),n(R,R.dyn_dtree,R.d_desc.max_code),A(R,R.bl_desc),N=18;N>=3&&0===R.bl_tree[2*y[N]+1];N--);return R.opt_len+=3*(N+1)+5+5+4,N})(R),M=R.opt_len+3+7>>>3,v=R.static_len+3+7>>>3,v<=M&&(M=v)):M=v=w+5,w+4<=M&&-1!==N?T(R,N,w,u):4===R.strategy||v===M?(d(R,2+(u?1:0),3),o(R,a,j)):(d(R,4+(u?1:0),3),((R,N,q,w)=>{let u;for(d(R,N-257,5),d(R,q-1,5),d(R,w-4,4),u=0;u<w;u++)d(R,R.bl_tree[2*y[u]+1],3);Q(R,R.dyn_ltree,N-1),Q(R,R.dyn_dtree,q-1)})(R,R.l_desc.max_code+1,R.d_desc.max_code+1,G+1),o(R,R.dyn_ltree,R.dyn_dtree)),s(R),u&&O(R)},R.exports._tr_tally=(R,N,w)=>(R.pending_buf[R.d_buf+2*R.last_lit]=N>>>8&255,R.pending_buf[R.d_buf+2*R.last_lit+1]=255&N,R.pending_buf[R.l_buf+R.last_lit]=255&w,R.last_lit++,0===N?R.dyn_ltree[2*w]++:(R.matches++,N--,R.dyn_ltree[2*(S[w]+q+1)]++,R.dyn_dtree[2*Z(N)]++),R.last_lit===R.lit_bufsize-1),R.exports._tr_align=R=>{d(R,2,3),x(R,256,a),(R=>{16===R.bi_valid?(z(R,R.bi_buf),R.bi_buf=0,R.bi_valid=0):R.bi_valid>=8&&(R.pending_buf[R.pending++]=255&R.bi_buf,R.bi_buf>>=8,R.bi_valid-=8)})(R)}},11322:R=>{"use strict";R.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11698:R=>{function N(R,N,q){for(var w=R.length,u=-1/0,M=1/0,v=0;v<w;v++){var G=(q[0][v]-R[v])/N[v],J=(q[1][v]-R[v])/N[v];if(G>J){var y=G;G=J,J=y}if(J<u||G>M)return 1/0;G>u&&(u=G),J<M&&(M=J)}return u>M?1/0:u}R.exports=function(R,q,w,u){var M=N(q,w,u);if(M===1/0)R=null;else{R=R||[];for(var v=0;v<q.length;v++)R[v]=q[v]+w[v]*M}return R},R.exports.distance=N},12352:(R,N,q)=>{"use strict";q.d(N,{c:()=>M});var w=q(47),u=q(2429),M=function(R){var N=(0,u.b)(R);(0,w.useEffect)((function(){var R=function(R){var q;if(null!=N.current&&(q=N.current(R)),R.defaultPrevented&&(R.returnValue=""),"string"===typeof q)return R.returnValue=q,q};return window.addEventListener("beforeunload",R),function(){window.removeEventListener("beforeunload",R)}}),[])}},12301:(R,N,q)=>{"use strict";var w=q(12310),u=Array.prototype.concat,M=Array.prototype.slice,v=R.exports=function(R){for(var N=[],q=0,v=R.length;q<v;q++){var G=R[q];w(G)?N=u.call(N,M.call(G)):N.push(G)}return N};v.wrap=function(R){return function(){return R(v(arguments))}}},12310:R=>{R.exports=function(R){return!(!R||"string"===typeof R)&&(R instanceof Array||Array.isArray(R)||R.length>=0&&(R.splice instanceof Function||Object.getOwnPropertyDescriptor(R,R.length-1)&&"String"!==R.constructor.name))}},11230:(R,N,q)=>{var w=q(11234);function u(R){for(var N,q,u=0,M=R.length,v=0;v<R.length;){for(N=R[v],q=0;v<M&&R[v]===N;)++v,++q;u+=w.log2(q)/7|0,u+=w.log2(N>>>0)/7|0,u+=2}return u}N.size=u,N.encode=function(R,N){N||(N=new Uint8Array(u(R)));for(var q,w,M=0,v=N.length,G=0;G<R.length;){for(q=R[G],w=0;G<R.length&&R[G]===q;)++G,++w;for(;M<v&&w>=128;)N[M++]=128+(127&w),w>>>=7;if(M>=v)throw new Error("RLE buffer overflow");for(N[M++]=w,q>>>=0;M<v&&q>=128;)N[M++]=128+(127&q),q>>>=7;if(M>=v)throw new Error("RLE buffer overflow");N[M++]=q}return N},N.decode=function(R,N){for(var q,w,u,M,v=N.length,G=R.length,J=0,y=0;y<G;){for(q=0,w=0;y<G&&R[y]>=128;)q+=(127&R[y++])<<w,w+=7;if(q+=R[y++]<<w,y>=G)throw new Error("RLE buffer underrun");if(J+q>v)throw new Error("Chunk buffer overflow");for(u=0,w=0;y<G&&R[y]>=128;)u+=(127&R[y++])<<w,w+=7;if(y>=G)throw new Error("RLE buffer underrun");for(u+=R[y++]<<w,M=0;M<q;++M)N[J++]=u}return N}},11234:(R,N)=>{"use strict";function q(R){var N=32;return(R&=-R)&&N--,65535&R&&(N-=16),16711935&R&&(N-=8),252645135&R&&(N-=4),858993459&R&&(N-=2),1431655765&R&&(N-=1),N}N.INT_BITS=32,N.INT_MAX=2147483647,N.INT_MIN=-1<<31,N.sign=function(R){return(R>0)-(R<0)},N.abs=function(R){var N=R>>31;return(R^N)-N},N.min=function(R,N){return N^(R^N)&-(R<N)},N.max=function(R,N){return R^(R^N)&-(R<N)},N.isPow2=function(R){return!(R&R-1)&&!!R},N.log2=function(R){var N,q;return N=(R>65535)<<4,N|=q=((R>>>=N)>255)<<3,N|=q=((R>>>=q)>15)<<2,(N|=q=((R>>>=q)>3)<<1)|(R>>>=q)>>1},N.log10=function(R){return R>=1e9?9:R>=1e8?8:R>=1e7?7:R>=1e6?6:R>=1e5?5:R>=1e4?4:R>=1e3?3:R>=100?2:R>=10?1:0},N.popCount=function(R){return 16843009*((R=(858993459&(R-=R>>>1&1431655765))+(R>>>2&858993459))+(R>>>4)&252645135)>>>24},N.countTrailingZeros=q,N.nextPow2=function(R){return R+=0===R,--R,R|=R>>>1,R|=R>>>2,R|=R>>>4,R|=R>>>8,(R|=R>>>16)+1},N.prevPow2=function(R){return R|=R>>>1,R|=R>>>2,R|=R>>>4,R|=R>>>8,(R|=R>>>16)-(R>>>1)},N.parity=function(R){return R^=R>>>16,R^=R>>>8,R^=R>>>4,27030>>>(R&=15)&1};var w=new Array(256);!function(R){for(var N=0;N<256;++N){var q=N,w=N,u=7;for(q>>>=1;q;q>>>=1)w<<=1,w|=1&q,--u;R[N]=w<<u&255}}(w),N.reverse=function(R){return w[255&R]<<24|w[R>>>8&255]<<16|w[R>>>16&255]<<8|w[R>>>24&255]},N.interleave2=function(R,N){return(R=1431655765&((R=858993459&((R=252645135&((R=16711935&((R&=65535)|R<<8))|R<<4))|R<<2))|R<<1))|(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N&=65535)|N<<8))|N<<4))|N<<2))|N<<1))<<1},N.deinterleave2=function(R,N){return(R=65535&((R=16711935&((R=252645135&((R=858993459&((R=R>>>N&1431655765)|R>>>1))|R>>>2))|R>>>4))|R>>>16))<<16>>16},N.interleave3=function(R,N,q){return R=1227133513&((R=3272356035&((R=251719695&((R=4278190335&((R&=1023)|R<<16))|R<<8))|R<<4))|R<<2),(R|=(N=1227133513&((N=3272356035&((N=251719695&((N=4278190335&((N&=1023)|N<<16))|N<<8))|N<<4))|N<<2))<<1)|(q=1227133513&((q=3272356035&((q=251719695&((q=4278190335&((q&=1023)|q<<16))|q<<8))|q<<4))|q<<2))<<2},N.deinterleave3=function(R,N){return(R=1023&((R=4278190335&((R=251719695&((R=3272356035&((R=R>>>N&1227133513)|R>>>2))|R>>>4))|R>>>8))|R>>>16))<<22>>22},N.nextCombination=function(R){var N=R|R-1;return N+1|(~N&-~N)-1>>>q(R)+1}},11252:R=>{"use strict";R.exports=function(R,N,q,w){var u=self||window;try{try{var M;try{M=new u.Blob([R])}catch(y){(M=new(u.BlobBuilder||u.WebKitBlobBuilder||u.MozBlobBuilder||u.MSBlobBuilder)).append(R),M=M.getBlob()}var v=u.URL||u.webkitURL,G=v.createObjectURL(M),J=new u[N](G,q);return v.revokeObjectURL(G),J}catch(y){return new u[N]("data:application/javascript,".concat(encodeURIComponent(R)),q)}}catch(y){if(!w)throw Error("Inline worker is not supported");return new u[N](w,q)}}},11684:(R,N,q)=>{"use strict";function w(R,N,q,w,u){var M={};return Object.keys(w).forEach((function(R){M[R]=w[R]})),M.enumerable=!!M.enumerable,M.configurable=!!M.configurable,("value"in M||M.initializer)&&(M.writable=!0),M=q.slice().reverse().reduce((function(q,w){return w(R,N,q)||q}),M),u&&void 0!==M.initializer&&(M.value=M.initializer?M.initializer.call(u):void 0,M.initializer=void 0),void 0===M.initializer&&(Object.defineProperty(R,N,M),M=null),M}q.d(N,{b:()=>w})},11681:(R,N,q)=>{"use strict";function w(R,N,q,w){q&&Object.defineProperty(R,N,{enumerable:q.enumerable,configurable:q.configurable,writable:q.writable,value:q.initializer?q.initializer.call(w):void 0})}q.d(N,{e:()=>w})},12006:(R,N,q)=>{"use strict";q.d(N,{c:()=>K,f:()=>k,g:()=>C,h:()=>F,i:()=>W,j:()=>H,l:()=>S});var w=q(966),u=q(1133),M=q(1001),v=q(982),G=q(12010),J=q(11398),y=q(1119),a=q(1019),j=q(1128);const F=Object.freeze(new w.e(0,0,0,0)),S=Object.freeze(w.m.Zero()),H=Object.freeze(w.j.Zero()),W=Object.freeze(y.e.Zero()),k=Object.freeze(u.c.Black()),C=Object.freeze(new u.d(0,0,0,0)),e={key:0,repeatCount:0,loopMode:2};class K{static _PrepareAnimation(R,N,q,M,v,G,J,a){let j;if(!isNaN(parseFloat(v))&&isFinite(v)?j=K.ANIMATIONTYPE_FLOAT:v instanceof w.e?j=K.ANIMATIONTYPE_QUATERNION:v instanceof w.m?j=K.ANIMATIONTYPE_VECTOR3:v instanceof w.j?j=K.ANIMATIONTYPE_VECTOR2:v instanceof u.c?j=K.ANIMATIONTYPE_COLOR3:v instanceof u.d?j=K.ANIMATIONTYPE_COLOR4:v instanceof y.e&&(j=K.ANIMATIONTYPE_SIZE),void 0==j)return null;const F=new K(R,N,q,j,J),S=[{frame:0,value:v},{frame:M,value:G}];return F.setKeys(S),void 0!==a&&F.setEasingFunction(a),F}static CreateAnimation(R,N,q,w){const u=new K(R+"Animation",R,q,N,K.ANIMATIONLOOPMODE_CONSTANT);return u.setEasingFunction(w),u}static CreateAndStartAnimation(R,N,q,w,u,M,v,G,J,y,a){const j=K._PrepareAnimation(R,q,w,u,M,v,G,J);return j?(N.va&&(a=N.va()),a?a.beginDirectAnimation(N,[j],0,u,1===j.loopMode,1,y):null):null}static CreateAndStartHierarchyAnimation(R,N,q,w,u,M,v,G,J,y,a){const j=K._PrepareAnimation(R,w,u,M,v,G,J,y);if(!j)return null;return N.va().beginDirectHierarchyAnimation(N,q,[j],0,M,1===j.loopMode,1,a)}static CreateMergeAndStartAnimation(R,N,q,w,u,M,v,G,J,y){const a=K._PrepareAnimation(R,q,w,u,M,v,G,J);return a?(N.animations.push(a),N.va().beginAnimation(N,0,u,1===a.loopMode,1,y)):null}static MakeAnimationAdditive(R,N,q){let u;u="object"===typeof N?N:{referenceFrame:N??0,range:q,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let M=R;if(u.cloneOriginalAnimation&&(M=R.clone(),M.name=u.clonedAnimationName||M.name),!M._keys.length)return M;const v=u.referenceFrame&&u.referenceFrame>=0?u.referenceFrame:0;let G=0;const J=M._keys[0];let y=M._keys.length-1;const a=M._keys[y],j={referenceValue:J.value,referencePosition:w.f.Od[0],referenceQuaternion:w.f.Quaternion[0],referenceScaling:w.f.Od[1],keyPosition:w.f.Od[2],keyQuaternion:w.f.Quaternion[1],keyScaling:w.f.Od[3]};let F=J.frame,S=a.frame;if(u.range){const R=M.getRange(u.range);R&&(F=R.from,S=R.to)}else F=u.fromFrame??F,S=u.toFrame??S;if(F!==J.frame&&(G=M.createKeyForFrame(F)),S!==a.frame&&(y=M.createKeyForFrame(S)),1===M._keys.length){const R=M._getKeyValue(M._keys[0]);j.referenceValue=R.clone?R.clone():R}else if(v<=J.frame){const R=M._getKeyValue(J.value);j.referenceValue=R.clone?R.clone():R}else if(v>=a.frame){const R=M._getKeyValue(a.value);j.referenceValue=R.clone?R.clone():R}else{e.key=0;const R=M._interpolate(v,e);j.referenceValue=R.clone?R.clone():R}M.dataType===K.ANIMATIONTYPE_QUATERNION?j.referenceValue.normalize().conjugateInPlace():M.dataType===K.ANIMATIONTYPE_MATRIX&&(j.referenceValue.decompose(j.referenceScaling,j.referenceQuaternion,j.referencePosition),j.referenceQuaternion.normalize().conjugateInPlace());let H=Number.MAX_VALUE;const W=u.clipKeys?[]:null;for(let k=G;k<=y;k++){let R=M._keys[k];if((W||u.cloneOriginalAnimation)&&(R={frame:R.frame,value:R.value.clone?R.value.clone():R.value,inTangent:R.inTangent,outTangent:R.outTangent,interpolation:R.interpolation,lockedTangent:R.lockedTangent},W&&(H===Number.MAX_VALUE&&(H=R.frame),R.frame-=H,W.push(R))),!k||M.dataType===K.ANIMATIONTYPE_FLOAT||R.value!==J.value)switch(M.dataType){case K.ANIMATIONTYPE_MATRIX:R.value.decompose(j.keyScaling,j.keyQuaternion,j.keyPosition),j.keyPosition.Vd(j.referencePosition),j.keyScaling.divideInPlace(j.referenceScaling),j.referenceQuaternion.multiplyToRef(j.keyQuaternion,j.keyQuaternion),w.c.ComposeToRef(j.keyScaling,j.keyQuaternion,j.keyPosition,R.value);break;case K.ANIMATIONTYPE_QUATERNION:j.referenceValue.multiplyToRef(R.value,R.value);break;case K.ANIMATIONTYPE_VECTOR2:case K.ANIMATIONTYPE_VECTOR3:case K.ANIMATIONTYPE_COLOR3:case K.ANIMATIONTYPE_COLOR4:R.value.subtractToRef(j.referenceValue,R.value);break;case K.ANIMATIONTYPE_SIZE:R.value.width-=j.referenceValue.width,R.value.height-=j.referenceValue.height;break;default:R.value-=j.referenceValue}}return W&&M.setKeys(W,!0),M}static TransitionTo(R,N,q,w,u,M,v){let G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(v<=0)return q[R]=N,G&&G(),null;const J=u*(v/1e3);M.setKeys([{frame:0,value:q[R].clone?q[R].clone():q[R]},{frame:J,value:N}]),q.animations||(q.animations=[]),q.animations.push(M);const y=w.beginAnimation(q,0,J,!1);return y.onAnimationEnd=G,y}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const R of this._runtimeAnimations)if(!R.isStopped())return!0;return!1}constructor(R,N,q,w,u,M){this.name=R,this.targetProperty=N,this.framePerSecond=q,this.dataType=w,this.loopMode=u,this.enableBlending=M,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=N.split("."),this.dataType=w,this.loopMode=void 0===u?K.ANIMATIONLOOPMODE_CYCLE:u,this.uniqueId=K._UniqueIdGenerator++}toString(R){let N="Name: "+this.name+", property: "+this.targetProperty;if(N+=", datatype: "+["Float","Od","Quaternion","Matrix","Be","Vector2"][this.dataType],N+=", nKeys: "+(this._keys?this._keys.length:"none"),N+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),R){N+=", Ranges: {";let R=!0;for(const q in this._ranges)R&&(N+=", ",R=!1),N+=q;N+="}"}return N}addEvent(R){this._events.push(R),this._events.sort(((R,N)=>R.frame-N.frame))}removeEvents(R){for(let N=0;N<this._events.length;N++)this._events[N].frame===R&&(this._events.splice(N,1),N--)}getEvents(){return this._events}createRange(R,N,q){this._ranges[R]||(this._ranges[R]=new G.b(R,N,q))}deleteRange(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const q=this._ranges[R];if(q){if(N){const R=q.from,N=q.to;for(let q=this._keys.length-1;q>=0;q--)this._keys[q].frame>=R&&this._keys[q].frame<=N&&this._keys.splice(q,1)}this._ranges[R]=null}}getRange(R){return this._ranges[R]}getKeys(){return this._keys}getHighestFrame(){let R=0;for(let N=0,q=this._keys.length;N<q;N++)R<this._keys[N].frame&&(R=this._keys[N].frame);return R}getEasingFunction(){return this._easingFunction}setEasingFunction(R){this._easingFunction=R}floatInterpolateFunction(R,N,q){return(0,M.o)(R,N,q)}floatInterpolateFunctionWithTangents(R,N,q,w,u){return(0,M.f)(R,N,q,w,u)}quaternionInterpolateFunction(R,N,q){return w.e.Slerp(R,N,q)}quaternionInterpolateFunctionWithTangents(R,N,q,u,M){return w.e.Hermite(R,N,q,u,M).normalize()}vector3InterpolateFunction(R,N,q){return w.m.Lerp(R,N,q)}vector3InterpolateFunctionWithTangents(R,N,q,u,M){return w.m.Hermite(R,N,q,u,M)}vector2InterpolateFunction(R,N,q){return w.j.Lerp(R,N,q)}vector2InterpolateFunctionWithTangents(R,N,q,u,M){return w.j.Hermite(R,N,q,u,M)}sizeInterpolateFunction(R,N,q){return y.e.Lerp(R,N,q)}color3InterpolateFunction(R,N,q){return u.c.Lerp(R,N,q)}color3InterpolateFunctionWithTangents(R,N,q,w,M){return u.c.Hermite(R,N,q,w,M)}color4InterpolateFunction(R,N,q){return u.d.Lerp(R,N,q)}color4InterpolateFunctionWithTangents(R,N,q,w,M){return u.d.Hermite(R,N,q,w,M)}_getKeyValue(R){return"function"===typeof R?R():R}evaluate(R){return e.key=0,this._interpolate(R,e)}_interpolate(R,N){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(N.loopMode===K.ANIMATIONLOOPMODE_CONSTANT&&N.repeatCount>0)return N.highLimitValue.clone?N.highLimitValue.clone():N.highLimitValue;const w=this._keys,u=w.length;let M=N.key;for(;M>=0&&R<w[M].frame;)--M;for(;M+1<=u-1&&R>=w[M+1].frame;)++M;if(N.key=M,M<0)return q?void 0:this._getKeyValue(w[0].value);if(M+1>u-1)return q?void 0:this._getKeyValue(w[u-1].value);const v=w[M],G=w[M+1];if(q&&(R===v.frame||R===G.frame))return;const J=this._getKeyValue(v.value),y=this._getKeyValue(G.value);if(1===v.interpolation)return G.frame>R?J:y;const a=void 0!==v.outTangent&&void 0!==G.inTangent,j=G.frame-v.frame;let e=(R-v.frame)/j;const r=v.easingFunction||this.getEasingFunction();switch(null!==r&&(e=r.ease(e)),this.dataType){case K.ANIMATIONTYPE_FLOAT:{const R=a?this.floatInterpolateFunctionWithTangents(J,v.outTangent*j,y,G.inTangent*j,e):this.floatInterpolateFunction(J,y,e);switch(N.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return R;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(N.offsetValue??0)*N.repeatCount+R}break}case K.ANIMATIONTYPE_QUATERNION:{const R=a?this.quaternionInterpolateFunctionWithTangents(J,v.outTangent.scale(j),y,G.inTangent.scale(j),e):this.quaternionInterpolateFunction(J,y,e);switch(N.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return R;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return R.addInPlace((N.offsetValue||F).scale(N.repeatCount))}return R}case K.ANIMATIONTYPE_VECTOR3:{const R=a?this.vector3InterpolateFunctionWithTangents(J,v.outTangent.scale(j),y,G.inTangent.scale(j),e):this.vector3InterpolateFunction(J,y,e);switch(N.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return R;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return R.add((N.offsetValue||S).scale(N.repeatCount))}break}case K.ANIMATIONTYPE_VECTOR2:{const R=a?this.vector2InterpolateFunctionWithTangents(J,v.outTangent.scale(j),y,G.inTangent.scale(j),e):this.vector2InterpolateFunction(J,y,e);switch(N.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return R;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return R.add((N.offsetValue||H).scale(N.repeatCount))}break}case K.ANIMATIONTYPE_SIZE:switch(N.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(J,y,e);case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(J,y,e).add((N.offsetValue||W).scale(N.repeatCount))}break;case K.ANIMATIONTYPE_COLOR3:{const R=a?this.color3InterpolateFunctionWithTangents(J,v.outTangent.scale(j),y,G.inTangent.scale(j),e):this.color3InterpolateFunction(J,y,e);switch(N.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return R;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return R.add((N.offsetValue||k).scale(N.repeatCount))}break}case K.ANIMATIONTYPE_COLOR4:{const R=a?this.color4InterpolateFunctionWithTangents(J,v.outTangent.scale(j),y,G.inTangent.scale(j),e):this.color4InterpolateFunction(J,y,e);switch(N.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return R;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return R.add((N.offsetValue||C).scale(N.repeatCount))}break}case K.ANIMATIONTYPE_MATRIX:switch(N.loopMode){case K.ANIMATIONLOOPMODE_CYCLE:case K.ANIMATIONLOOPMODE_CONSTANT:case K.ANIMATIONLOOPMODE_YOYO:return K.AllowMatricesInterpolation?this.matrixInterpolateFunction(J,y,e,N.workValue):J;case K.ANIMATIONLOOPMODE_RELATIVE:case K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return J}}return 0}matrixInterpolateFunction(R,N,q,u){return K.AllowMatrixDecomposeForInterpolation?u?(w.c.DecomposeLerpToRef(R,N,q,u),u):w.c.DecomposeLerp(R,N,q):u?(w.c.LerpToRef(R,N,q,u),u):w.c.Lerp(R,N,q)}clone(){const R=new K(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(R.enableBlending=this.enableBlending,R.blendingSpeed=this.blendingSpeed,this._keys&&R.setKeys(this._keys),this._ranges){R._ranges={};for(const N in this._ranges){const q=this._ranges[N];q&&(R._ranges[N]=q.clone())}}return R}setKeys(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=N?R:R.slice(0)}createKeyForFrame(R){e.key=0;const N=this._interpolate(R,e,!0);if(!N)return this._keys[e.key].frame===R?e.key:e.key+1;const q={frame:R,value:N.clone?N.clone():N};return this._keys.splice(e.key+1,0,q),e.key+1}serialize(){const R={};R.name=this.name,R.property=this.targetProperty,R.framePerSecond=this.framePerSecond,R.dataType=this.dataType,R.loopBehavior=this.loopMode,R.enableBlending=this.enableBlending,R.blendingSpeed=this.blendingSpeed;const N=this.dataType;R.keys=[];const q=this.getKeys();for(let w=0;w<q.length;w++){const u=q[w],M={};switch(M.frame=u.frame,N){case K.ANIMATIONTYPE_FLOAT:M.values=[u.value],void 0!==u.inTangent&&M.values.push(u.inTangent),void 0!==u.outTangent&&(void 0===u.inTangent&&M.values.push(void 0),M.values.push(u.outTangent)),void 0!==u.interpolation&&(void 0===u.inTangent&&M.values.push(void 0),void 0===u.outTangent&&M.values.push(void 0),M.values.push(u.interpolation));break;case K.ANIMATIONTYPE_QUATERNION:case K.ANIMATIONTYPE_MATRIX:case K.ANIMATIONTYPE_VECTOR3:case K.ANIMATIONTYPE_COLOR3:case K.ANIMATIONTYPE_COLOR4:M.values=u.value.de(),void 0!=u.inTangent&&M.values.push(u.inTangent.de()),void 0!=u.outTangent&&(void 0===u.inTangent&&M.values.push(void 0),M.values.push(u.outTangent.de())),void 0!==u.interpolation&&(void 0===u.inTangent&&M.values.push(void 0),void 0===u.outTangent&&M.values.push(void 0),M.values.push(u.interpolation))}R.keys.push(M)}R.ranges=[];for(const w in this._ranges){const N=this._ranges[w];if(!N)continue;const q={};q.name=w,q.from=N.from,q.to=N.to,R.ranges.push(q)}return R}static _UniversalLerp(R,N,q){const w=R.constructor;return w.Lerp?w.Lerp(R,N,q):w.Slerp?w.Slerp(R,N,q):R.toFixed?R*(1-q)+q*N:N}static Parse(R){const N=new K(R.name,R.property,R.framePerSecond,R.dataType,R.loopBehavior),q=R.dataType,M=[];let v,G;for(R.enableBlending&&(N.enableBlending=R.enableBlending),R.blendingSpeed&&(N.blendingSpeed=R.blendingSpeed),G=0;G<R.keys.length;G++){const N=R.keys[G];let J,y,a;switch(q){case K.ANIMATIONTYPE_FLOAT:v=N.values[0],N.values.length>=2&&(J=N.values[1]),N.values.length>=3&&(y=N.values[2]),N.values.length>=4&&(a=N.values[3]);break;case K.ANIMATIONTYPE_QUATERNION:if(v=w.e.Sd(N.values),N.values.length>=8){const R=w.e.Sd(N.values.slice(4,8));R.equals(w.e.Zero())||(J=R)}if(N.values.length>=12){const R=w.e.Sd(N.values.slice(8,12));R.equals(w.e.Zero())||(y=R)}N.values.length>=13&&(a=N.values[12]);break;case K.ANIMATIONTYPE_MATRIX:v=w.c.Sd(N.values),N.values.length>=17&&(a=N.values[16]);break;case K.ANIMATIONTYPE_COLOR3:v=u.c.Sd(N.values),N.values[3]&&(J=u.c.Sd(N.values[3])),N.values[4]&&(y=u.c.Sd(N.values[4])),N.values[5]&&(a=N.values[5]);break;case K.ANIMATIONTYPE_COLOR4:v=u.d.Sd(N.values),N.values[4]&&(J=u.d.Sd(N.values[4])),N.values[5]&&(y=u.d.Sd(N.values[5])),N.values[6]&&(a=u.d.Sd(N.values[6]));break;case K.ANIMATIONTYPE_VECTOR3:default:v=w.m.Sd(N.values),N.values[3]&&(J=w.m.Sd(N.values[3])),N.values[4]&&(y=w.m.Sd(N.values[4])),N.values[5]&&(a=N.values[5])}const j={};j.frame=N.frame,j.value=v,void 0!=J&&(j.inTangent=J),void 0!=y&&(j.outTangent=y),void 0!=a&&(j.interpolation=a),M.push(j)}if(N.setKeys(M),R.ranges)for(G=0;G<R.ranges.length;G++)v=R.ranges[G],N.createRange(v.name,v.from,v.to);return N}static AppendSerializedAnimations(R,N){j.e.AppendSerializedAnimations(R,N)}static ParseFromFileAsync(R,N){return new Promise(((q,w)=>{const u=new a.b;u.addEventListener("readystatechange",(()=>{if(4==u.readyState)if(200==u.status){let N=JSON.parse(u.responseText);if(N.animations&&(N=N.animations),N.length){const R=[];for(const q of N)R.push(this.Parse(q));q(R)}else{const w=this.Parse(N);R&&(w.name=R),q(w)}}else w("Unable to load the animation")})),u.open("GET",N),u.send()}))}static ParseFromSnippetAsync(R){return new Promise(((N,q)=>{const w=new a.b;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const q=JSON.parse(JSON.parse(w.responseText).jsonPayload);if(q.animations){const w=JSON.parse(q.animations),u=[];for(const N of w.animations){const q=this.Parse(N);q.snippetId=R,u.push(q)}N(u)}else{const w=JSON.parse(q.animation),u=this.Parse(w);u.snippetId=R,N(u)}}else q("Unable to load the snippet "+R)})),w.open("GET",this.SnippetUrl+"/"+R.replace(/#/g,"/")),w.send()}))}}K._UniqueIdGenerator=0,K.AllowMatricesInterpolation=!1,K.AllowMatrixDecomposeForInterpolation=!0,K.SnippetUrl="https://snippet.babylonjs.com",K.ANIMATIONTYPE_FLOAT=0,K.ANIMATIONTYPE_VECTOR3=1,K.ANIMATIONTYPE_QUATERNION=2,K.ANIMATIONTYPE_MATRIX=3,K.ANIMATIONTYPE_COLOR3=4,K.ANIMATIONTYPE_COLOR4=7,K.ANIMATIONTYPE_VECTOR2=5,K.ANIMATIONTYPE_SIZE=6,K.ANIMATIONLOOPMODE_RELATIVE=0,K.ANIMATIONLOOPMODE_CYCLE=1,K.ANIMATIONLOOPMODE_CONSTANT=2,K.ANIMATIONLOOPMODE_YOYO=4,K.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,K.CreateFromSnippetAsync=K.ParseFromSnippetAsync,(0,v.h)("BABYLON.Animation",K),J.d._AnimationRangeFactory=(R,N,q)=>new G.b(R,N,q)},12010:(R,N,q)=>{"use strict";q.d(N,{b:()=>w});class w{constructor(R,N,q){this.name=R,this.from=N,this.to=q}clone(){return new w(this.name,this.from,this.to)}}},12003:(R,N,q)=>{"use strict";q.d(N,{b:()=>v});var w=q(966),u=q(978),M=q(11398);class v extends M.d{get _matrix(){return this._compose(),this.Oj}set _matrix(R){(R.updateFlag!==this.Oj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Oj.p(R),this._markAsDirtyAndDecompose())}constructor(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(R,N.va(),!1),this.name=R,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=N,this.Oj=(null===u||void 0===u?void 0:u.clone())??w.c.Identity(),this._restMatrix=M??this.Oj.clone(),this._bindMatrix=v??this.Oj.clone(),this._index=G,this._absoluteMatrix=new w.c,this._absoluteBindMatrix=new w.c,this._absoluteInverseBindMatrix=new w.c,this._finalMatrix=new w.c,N.bones.push(this),this.setParent(q,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(R){this.setParent(R)}setParent(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==R){if(this.parent){const R=this.parent.children.indexOf(this);-1!==R&&this.parent.children.splice(R,1)}this._parentNode=R,this.parent&&this.parent.children.push(this),N&&this._updateAbsoluteBindMatrices(),this.pe()}}getLocalMatrix(){return this._compose(),this.Oj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(R){this._restMatrix.p(R)}setRestPose(R){this.setRestMatrix(R)}getBindPose(){return this.getBindMatrix()}setBindMatrix(R){this.ve(R)}setBindPose(R){this.setBindMatrix(R)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const R=w.f.Od[0],N=w.f.Quaternion[0],q=w.f.Od[1];this.getRestMatrix().decompose(R,N,q),this._linkedTransformNode.position.p(q),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??w.e.Identity(),this._linkedTransformNode.rotationQuaternion.p(N),this._linkedTransformNode.Fe.p(R)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(R){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=R,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Dg}set position(R){this._decompose(),this.Dg.p(R),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(R){this.setRotation(R)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(R){this.setRotationQuaternion(R)}get Fe(){return this.getScale()}set Fe(R){this.setScale(R)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=w.m.Zero(),this._localRotation=w.e.Zero(),this.Dg=w.m.Zero()),this.Oj.decompose(this._localScaling,this._localRotation,this.Dg))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,w.c.ComposeToRef(this._localScaling,this._localRotation,this.Dg,this.Oj)):this._needToCompose=!1)}ve(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(R),N&&this._updateAbsoluteBindMatrices(),q?this._matrix=R:this.pe()}_updateAbsoluteBindMatrices(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(R||(R=this._bindMatrix),this.parent?R.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(R),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),N)for(let q=0;q<this.children.length;q++)this.children[q]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}pe(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.pe(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.pe(),this._needToDecompose=!0}_updatePosition(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2?arguments[2]:void 0,u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const M=this.getLocalMatrix();if(0==N)u?(M.addAtIndex(12,R.x),M.addAtIndex(13,R.y),M.addAtIndex(14,R.z)):M.setTranslationFromFloats(R.x,R.y,R.z);else{let N=null;q&&(N=q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const G=v._TmpMats[0],J=v._TmpVecs[0];this.parent?q&&N?(G.p(this.parent.getAbsoluteMatrix()),G.multiplyToRef(N,G)):G.p(this.parent.getAbsoluteMatrix()):w.c.IdentityToRef(G),u&&G.setTranslationFromFloats(0,0,0),G.invert(),w.m.TransformCoordinatesToRef(R,G,J),u?(M.addAtIndex(12,J.x),M.addAtIndex(13,J.y),M.addAtIndex(14,J.z)):M.setTranslationFromFloats(J.x,J.y,J.z)}this._markAsDirtyAndDecompose()}translate(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2?arguments[2]:void 0;this._updatePosition(R,N,q,!0)}setPosition(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2?arguments[2]:void 0;this._updatePosition(R,N,q,!1)}setAbsolutePosition(R,N){this.setPosition(R,1,N)}scale(R,N,q){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const M=this.getLocalMatrix(),G=v._TmpMats[0];w.c.ScalingToRef(R,N,q,G),G.multiplyToRef(M,M),G.invert();for(const w of this.children){const u=w.getLocalMatrix();u.multiplyToRef(G,u),u.multiplyAtIndex(12,R),u.multiplyAtIndex(13,N),u.multiplyAtIndex(14,q),w._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),u)for(const w of this.children)w.scale(R,N,q,u)}setScale(R){this._decompose(),this._localScaling.p(R),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(R){this._decompose(),R.p(this._localScaling)}setYawPitchRoll(R,N,q){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,M=arguments.length>4?arguments[4]:void 0;if(0===u){const G=v._TmpQuat;return w.e.RotationYawPitchRollToRef(R,N,q,G),void this.setRotationQuaternion(G,u,M)}const G=v._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(G,M))return;const J=v._TmpMats[1];w.c.RotationYawPitchRollToRef(R,N,q,J),G.multiplyToRef(J,J),this._rotateWithMatrix(J,u,M)}rotate(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0;const M=v._TmpMats[0];M.setTranslationFromFloats(0,0,0),w.c.RotationAxisToRef(R,N,M),this._rotateWithMatrix(M,q,u)}setAxisAngle(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0;if(0===q){const M=v._TmpQuat;return w.e.RotationAxisToRef(R,N,M),void this.setRotationQuaternion(M,q,u)}const M=v._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(M,u))return;const G=v._TmpMats[1];w.c.RotationAxisToRef(R,N,G),M.multiplyToRef(G,G),this._rotateWithMatrix(G,q,u)}setRotation(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(R.y,R.x,R.z,N,q)}setRotationQuaternion(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2?arguments[2]:void 0;if(0===N)return this._decompose(),this._localRotation.p(R),void this._markAsDirtyAndCompose();const u=v._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(u,q))return;const M=v._TmpMats[1];w.c.FromQuaternionToRef(R,M),u.multiplyToRef(M,M),this._rotateWithMatrix(M,N,q)}setRotationMatrix(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2?arguments[2]:void 0;if(0===N){const u=v._TmpQuat;return w.e.FromRotationMatrixToRef(R,u),void this.setRotationQuaternion(u,N,q)}const u=v._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(u,q))return;const M=v._TmpMats[1];M.p(R),u.multiplyToRef(R,M),this._rotateWithMatrix(M,N,q)}_rotateWithMatrix(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2?arguments[2]:void 0;const w=this.getLocalMatrix(),u=w.m[12],M=w.m[13],G=w.m[14],J=this.getParent(),y=v._TmpMats[3],a=v._TmpMats[4];J&&1==N?(q?(y.p(q.getWorldMatrix()),J.getAbsoluteMatrix().multiplyToRef(y,y)):y.p(J.getAbsoluteMatrix()),a.p(y),a.invert(),w.multiplyToRef(y,w),w.multiplyToRef(R,w),w.multiplyToRef(a,w)):1==N&&q?(y.p(q.getWorldMatrix()),a.p(y),a.invert(),w.multiplyToRef(y,w),w.multiplyToRef(R,w),w.multiplyToRef(a,w)):w.multiplyToRef(R,w),w.setTranslationFromFloats(u,M,G),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(R,N){const q=v._TmpMats[2];return R.p(this.getAbsoluteMatrix()),N?(R.multiplyToRef(N.getWorldMatrix(),R),w.c.ScalingToRef(N.Fe.x,N.Fe.y,N.Fe.z,q)):w.c.IdentityToRef(q),R.invert(),!isNaN(R.m[0])&&(q.multiplyAtIndex(0,this._scalingDeterminant),R.multiplyToRef(q,R),!0)}cb(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=w.m.Zero();return this.getPositionToRef(R,N,q),q}getPositionToRef(){let R=arguments.length>1?arguments[1]:void 0,N=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const R=this.getLocalMatrix();N.x=R.m[12],N.y=R.m[13],N.z=R.m[14]}else{let q=null;R&&(q=R.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let w=v._TmpMats[0];R&&q?(w.p(this.getAbsoluteMatrix()),w.multiplyToRef(q,w)):w=this.getAbsoluteMatrix(),N.x=w.m[12],N.y=w.m[13],N.z=w.m[14]}}getAbsolutePosition(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const N=w.m.Zero();return this.getPositionToRef(1,R,N),N}getAbsolutePositionToRef(R,N){this.getPositionToRef(1,R,N)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Oj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Oj);const R=this._skeleton.getPoseMatrix();R&&this._absoluteMatrix.multiplyToRef(R,this._absoluteMatrix)}const R=this.children,N=R.length;for(let q=0;q<N;q++)R[q].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}nf(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=w.m.Zero();return this.getDirectionToRef(R,N,q),q}getDirectionToRef(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2?arguments[2]:void 0,u=null;N&&(u=N.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const M=v._TmpMats[0];M.p(this.getAbsoluteMatrix()),N&&u&&M.multiplyToRef(u,M),w.m.TransformNormalToRef(R,M,q),q.normalize()}getRotation(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=w.m.Zero();return this.getRotationToRef(R,N,q),q}getRotationToRef(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2?arguments[2]:void 0;const w=v._TmpQuat;this.getRotationQuaternionToRef(R,N,w),w.toEulerAnglesToRef(q)}getRotationQuaternion(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=w.e.Identity();return this.getRotationQuaternionToRef(R,N,q),q}getRotationQuaternionToRef(){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),N.p(this._localRotation);else{const q=v._TmpMats[0],w=this.getAbsoluteMatrix();R?w.multiplyToRef(R.getWorldMatrix(),q):q.p(w),q.multiplyAtIndex(0,this._scalingDeterminant),q.multiplyAtIndex(1,this._scalingDeterminant),q.multiplyAtIndex(2,this._scalingDeterminant),q.decompose(void 0,N,void 0)}}getRotationMatrix(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,N=arguments.length>1?arguments[1]:void 0;const q=w.c.Identity();return this.getRotationMatrixToRef(R,N,q),q}getRotationMatrixToRef(){let R=arguments.length>1?arguments[1]:void 0,N=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(N);else{const q=v._TmpMats[0],w=this.getAbsoluteMatrix();R?w.multiplyToRef(R.getWorldMatrix(),q):q.p(w),q.multiplyAtIndex(0,this._scalingDeterminant),q.multiplyAtIndex(1,this._scalingDeterminant),q.multiplyAtIndex(2,this._scalingDeterminant),q.getRotationMatrixToRef(N)}}getAbsolutePositionFromLocal(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=w.m.Zero();return this.getAbsolutePositionFromLocalToRef(R,N,q),q}getAbsolutePositionFromLocalToRef(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2?arguments[2]:void 0,u=null;N&&(u=N.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const M=v._TmpMats[0];M.p(this.getAbsoluteMatrix()),N&&u&&M.multiplyToRef(u,M),w.m.TransformCoordinatesToRef(R,M,q)}getLocalPositionFromAbsolute(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=w.m.Zero();return this.getLocalPositionFromAbsoluteToRef(R,N,q),q}getLocalPositionFromAbsoluteToRef(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2?arguments[2]:void 0,u=null;N&&(u=N.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const M=v._TmpMats[0];M.p(this.getAbsoluteMatrix()),N&&u&&M.multiplyToRef(u,M),M.invert(),w.m.TransformCoordinatesToRef(R,M,q)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}v._TmpVecs=(0,u.c)(2,w.m.Zero),v._TmpQuat=w.e.Identity(),v._TmpMats=(0,u.c)(5,w.c.Identity)},12345:(R,N,q)=>{"use strict";q.d(N,{d:()=>o});var w=q(942),u=q(947),M=q(959),v=q(966),G=q(11398),J=q(11381),y=q(1259),a=q(1097),j=q(974);class F{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(R){this._zoomStopsAnimation=R}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(R){this._idleRotationSpeed=R}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(R){this._idleRotationWaitTime=R}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(R){this._idleRotationSpinupTime=R}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(R){this._attachedCamera=R;const N=this._attachedCamera.va();this._onPrePointerObservableObserver=N.onPrePointerObservable.add((R=>{R.type!==y.d.POINTERDOWN?R.type===y.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=R.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const R=a.b.Now;let N=0;null!=this._lastFrameTime&&(N=R-this._lastFrameTime),this._lastFrameTime=R,this._applyUserInteraction();const q=R-this._lastInteractionTime-this._idleRotationWaitTime,w=Math.max(Math.min(q/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*w,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(N/1e3))}))}detach(){if(!this._attachedCamera)return;const R=this._attachedCamera.va();this._onPrePointerObservableObserver&&R.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(R){this._lastInteractionTime=R??a.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<j.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let R=!1;return this._lastFrameRadius===this._attachedCamera.i&&0!==this._attachedCamera.inertialRadiusOffset&&(R=!0),this._lastFrameRadius=this._attachedCamera.i,this._zoomStopsAnimation?R:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=a.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}q(1468);class S{constructor(){this._easingMode=S.EASINGMODE_EASEIN}setEasingMode(R){const N=Math.min(Math.max(R,0),2);this._easingMode=N}getEasingMode(){return this._easingMode}easeInCore(R){throw new Error("You must implement this method")}ease(R){switch(this._easingMode){case S.EASINGMODE_EASEIN:return this.easeInCore(R);case S.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-R)}return R>=.5?.5*(1-this.easeInCore(2*(1-R)))+.5:.5*this.easeInCore(2*R)}}S.EASINGMODE_EASEIN=0,S.EASINGMODE_EASEOUT=1,S.EASINGMODE_EASEINOUT=2;var H=q(12006);class W{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(R){if(this._autoTransitionRange===R)return;this._autoTransitionRange=R;const N=this._attachedCamera;N&&(R?this._onMeshTargetChangedObserver=N.onMeshTargetChangedObservable.add((R=>{if(R&&(R.je(!0),R.getBoundingInfo)){const N=R.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*N,this.upperRadiusTransitionRange=.05*N}})):this._onMeshTargetChangedObserver&&N.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(R){this._attachedCamera=R,this._onAfterCheckInputsObserver=R.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(R){return!!this._attachedCamera&&(this._attachedCamera.i===R&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(R){if(!this._attachedCamera)return;this._radiusBounceTransition||(W.EasingFunction.setEasingMode(W.EasingMode),this._radiusBounceTransition=H.c.CreateAnimation("i",H.c.ANIMATIONTYPE_FLOAT,60,W.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const N=H.c.TransitionTo("i",this._attachedCamera.i+R,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));N&&this._animatables.push(N)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}W.EasingFunction=new class extends S{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=R}easeInCore(R){const N=Math.max(0,this.amplitude);return Math.pow(R,3)-R*N*Math.sin(3.141592653589793*R)}}(.3),W.EasingMode=S.EASINGMODE_EASEOUT;class k{constructor(){this.onTargetFramingAnimationEndObservable=new M.c,this._mode=k.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(R){this._mode=R}get mode(){return this._mode}set radiusScale(R){this._radiusScale=R}get radiusScale(){return this._radiusScale}set positionScale(R){this._positionScale=R}get positionScale(){return this._positionScale}set defaultElevation(R){this._defaultElevation=R}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(R){this._elevationReturnTime=R}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(R){this._elevationReturnWaitTime=R}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(R){this._zoomStopsAnimation=R}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(R){this._framingTime=R}get framingTime(){return this._framingTime}init(){}attach(R){this._attachedCamera=R;const N=this._attachedCamera.va();k.EasingFunction.setEasingMode(k.EasingMode),this._onPrePointerObservableObserver=N.onPrePointerObservable.add((R=>{R.type!==y.d.POINTERDOWN?R.type===y.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=R.onMeshTargetChangedObservable.add((R=>{R&&R.getBoundingInfo&&this.zoomOnMesh(R,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=R.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const R=this._attachedCamera.va();this._onPrePointerObservableObserver&&R.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;R.je(!0);const w=R.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(w.minimumWorld,w.maximumWorld,N,q)}zoomOnMeshHierarchy(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;R.je(!0);const w=R.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(w.min,w.max,N,q)}zoomOnMeshesHierarchy(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new v.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),u=new v.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let M=0;M<R.length;M++){const N=R[M].getHierarchyBoundingVectors(!0);v.m.CheckExtends(N.min,w,u),v.m.CheckExtends(N.max,w,u)}this.zoomOnBoundingInfo(w,u,N,q)}zoomOnBoundingInfo(R,N){let q,w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const M=R.y,G=M+(N.y-M)*this._positionScale,J=N.Vc(R).scale(.5);if(w)q=new v.m(0,G,0);else{const N=R.add(J);q=new v.m(N.x,G,N.z)}this._vectorTransition||(this._vectorTransition=H.c.CreateAnimation("target",H.c.ANIMATIONTYPE_VECTOR3,60,k.EasingFunction)),this._betaIsAnimating=!0;let y=H.c.TransitionTo("target",q,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);y&&this._animatables.push(y);let a=0;if(this._mode===k.FitFrustumSidesMode){const q=this._calculateLowerRadiusFromModelBoundingSphere(R,N);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=J.length()+this._attachedCamera.dj),a=q}else this._mode===k.IgnoreBoundsSizeMode&&(a=this._calculateLowerRadiusFromModelBoundingSphere(R,N),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.dj));if(this.autoCorrectCameraLimitsAndSensibility){const q=N.Vc(R).length();this._attachedCamera.panningSensibility=5e3/q,this._attachedCamera.wheelPrecision=100/a}return this._radiusTransition||(this._radiusTransition=H.c.CreateAnimation("i",H.c.ANIMATIONTYPE_FLOAT,60,k.EasingFunction)),y=H.c.TransitionTo("i",a,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),u&&u(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),y&&this._animatables.push(y),!0}_calculateLowerRadiusFromModelBoundingSphere(R,N){const q=this._attachedCamera;if(!q)return 0;let w=q._calculateLowerRadiusFromModelBoundingSphere(R,N,this._radiusScale);return q.lowerRadiusLimit&&this._mode===k.IgnoreBoundsSizeMode&&(w=w<q.lowerRadiusLimit?q.lowerRadiusLimit:w),q.upperRadiusLimit&&(w=w>q.upperRadiusLimit?q.upperRadiusLimit:w),w}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const R=a.b.Now-this._lastInteractionTime,N=.5*Math.PI-this._defaultElevation,q=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>q&&R>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=H.c.CreateAnimation("beta",H.c.ANIMATIONTYPE_FLOAT,60,k.EasingFunction));const R=H.c.TransitionTo("beta",N,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));R&&this._animatables.push(R)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=a.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}k.EasingFunction=new class extends S{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=R}easeInCore(R){return this.exponent<=0?R:(Math.exp(this.exponent*R)-1)/(Math.exp(this.exponent)-1)}},k.EasingMode=S.EASINGMODE_EASEINOUT,k.IgnoreBoundsSizeMode=0,k.FitFrustumSidesMode=1;var C=q(11396),e=q(11987),K=q(11995),r=q(1177);class Z{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(R){R=r.i.BackCompatCameraNoPreventDefault(arguments);const N=this.camera.getEngine(),q=N.getInputElement();let w=0,u=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=M=>{var v,G;const J=M.event,a="touch"===J.pointerType;if(M.type!==y.d.POINTERMOVE&&-1===this.buttons.indexOf(J.button))return;const j=J.target;if(this._altKey=J.altKey,this._ctrlKey=J.ctrlKey,this._metaKey=J.metaKey,this._shiftKey=J.shiftKey,this._buttonsPressed=J.buttons,N.isPointerLock){const R=J.movementX,N=J.movementY;this.onTouch(null,R,N),this._pointA=null,this._pointB=null}else{if(M.type!==y.d.POINTERDOWN&&M.type!==y.d.POINTERDOUBLETAP&&a&&(null===(v=this._pointA)||void 0===v?void 0:v.pointerId)!==J.pointerId&&(null===(G=this._pointB)||void 0===G?void 0:G.pointerId)!==J.pointerId)return;if(M.type!==y.d.POINTERDOWN||-1!==this._currentActiveButton&&!a)if(M.type===y.d.POINTERDOUBLETAP)this.onDoubleTap(J.pointerType);else if(M.type!==y.d.POINTERUP||this._currentActiveButton!==J.button&&!a){if(M.type===y.d.POINTERMOVE)if(R||J.preventDefault(),this._pointA&&null===this._pointB){const R=J.clientX-this._pointA.x,N=J.clientY-this._pointA.y;this._pointA.x=J.clientX,this._pointA.y=J.clientY,this.onTouch(this._pointA,R,N)}else if(this._pointA&&this._pointB){const R=this._pointA.pointerId===J.pointerId?this._pointA:this._pointB;R.x=J.clientX,R.y=J.clientY;const N=this._pointA.x-this._pointB.x,q=this._pointA.y-this._pointB.y,v=N*N+q*q,G={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:J.pointerId,type:M.type};this.onMultiTouch(this._pointA,this._pointB,w,v,u,G),u=G,w=v}}else{try{null===j||void 0===j||j.releasePointerCapture(J.pointerId)}catch(F){}a||(this._pointB=null),N._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==J.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==J.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==w||u)&&(this.onMultiTouch(this._pointA,this._pointB,w,0,u,null),w=0,u=null),this._currentActiveButton=-1,this.onButtonUp(J),R||J.preventDefault()}else{try{null===j||void 0===j||j.setPointerCapture(J.pointerId)}catch(F){}if(null===this._pointA)this._pointA={x:J.clientX,y:J.clientY,pointerId:J.pointerId,type:J.pointerType};else{if(null!==this._pointB)return;this._pointB={x:J.clientX,y:J.clientY,pointerId:J.pointerId,type:J.pointerType}}-1!==this._currentActiveButton||a||(this._currentActiveButton=J.button),this.onButtonDown(J),R||(J.preventDefault(),q&&q.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,y.d.POINTERDOWN|y.d.POINTERUP|y.d.POINTERMOVE|y.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,w=0,u=null,this.onLostFocus()},this._contextMenuBind=R=>this.onContextMenu(R),q&&q.addEventListener("contextmenu",this._contextMenuBind,!1);const M=this.camera.va().getEngine().getHostWindow();M&&r.i.RegisterTopRootEvents(M,[{name:"blur",handler:this._onLostFocus}])}Pe(){if(this._onLostFocus){const R=this.camera.va().getEngine().getHostWindow();R&&r.i.UnregisterTopRootEvents(R,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const R=this.camera.va().getEngine().getInputElement();R&&R.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(R){}onTouch(R,N,q){}onMultiTouch(R,N,q,w,u,M){}onContextMenu(R){R.preventDefault()}onButtonDown(R){}onButtonUp(R){}onLostFocus(){}}(0,w.b)([(0,u.E)()],Z.prototype,"buttons",void 0);class z extends Z{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(R,N){if(0!==this.panningSensibility&&R&&N){const q=N.x-R.x,w=N.y-R.y;this.camera.inertialPanningX+=-q/this.panningSensibility,this.camera.inertialPanningY+=w/this.panningSensibility}}_computePinchZoom(R,N){const q=this.camera.i||z.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.i=q*Math.sqrt(R)/Math.sqrt(N):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(N-R)*q*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(N-R)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(R,N,q){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-N/this.panningSensibility,this.camera.inertialPanningY+=q/this.panningSensibility):(this.camera.inertialAlphaOffset-=N/this.angularSensibilityX,this.camera.inertialBetaOffset-=q/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(R,N,q,w,u,M){0===q&&null===u||0===w&&null===M||(this.multiTouchPanAndZoom?(this._computePinchZoom(q,w),this._computeMultiTouchPanning(u,M)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(w)-Math.sqrt(q))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(q,w),this._isPinching=!0):this._computeMultiTouchPanning(u,M)):this.multiTouchPanning?this._computeMultiTouchPanning(u,M):this.pinchZoom&&this._computePinchZoom(q,w))}onButtonDown(R){this._isPanClick=R.button===this.camera._panningMouseButton}onButtonUp(R){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}z.MinimumRadiusForPinch=.001,(0,w.b)([(0,u.E)()],z.prototype,"buttons",void 0),(0,w.b)([(0,u.E)()],z.prototype,"angularSensibilityX",void 0),(0,w.b)([(0,u.E)()],z.prototype,"angularSensibilityY",void 0),(0,w.b)([(0,u.E)()],z.prototype,"pinchPrecision",void 0),(0,w.b)([(0,u.E)()],z.prototype,"pinchDeltaPercentage",void 0),(0,w.b)([(0,u.E)()],z.prototype,"useNaturalPinchZoom",void 0),(0,w.b)([(0,u.E)()],z.prototype,"pinchZoom",void 0),(0,w.b)([(0,u.E)()],z.prototype,"panningSensibility",void 0),(0,w.b)([(0,u.E)()],z.prototype,"multiTouchPanning",void 0),(0,w.b)([(0,u.E)()],z.prototype,"multiTouchPanAndZoom",void 0),K.d.ArcRotateCameraPointersInput=z;var d=q(1262);class x{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(R){R=r.i.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((N=>{const q=N.event;if(!q.metaKey)if(N.type===d.d.KEYDOWN){if(this._ctrlPressed=q.ctrlKey,this._altPressed=q.altKey,-1!==this.keysUp.indexOf(q.keyCode)||-1!==this.keysDown.indexOf(q.keyCode)||-1!==this.keysLeft.indexOf(q.keyCode)||-1!==this.keysRight.indexOf(q.keyCode)||-1!==this.keysReset.indexOf(q.keyCode)){-1===this._keys.indexOf(q.keyCode)&&this._keys.push(q.keyCode),q.preventDefault&&(R||q.preventDefault())}}else if(-1!==this.keysUp.indexOf(q.keyCode)||-1!==this.keysDown.indexOf(q.keyCode)||-1!==this.keysLeft.indexOf(q.keyCode)||-1!==this.keysRight.indexOf(q.keyCode)||-1!==this.keysReset.indexOf(q.keyCode)){const N=this._keys.indexOf(q.keyCode);N>=0&&this._keys.splice(N,1),q.preventDefault&&(R||q.preventDefault())}})))}Pe(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const R=this.camera;for(let N=0;N<this._keys.length;N++){const q=this._keys[N];-1!==this.keysLeft.indexOf(q)?this._ctrlPressed&&this.camera._useCtrlForPanning?R.inertialPanningX-=1/this.panningSensibility:R.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(q)?this._ctrlPressed&&this.camera._useCtrlForPanning?R.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?R.inertialRadiusOffset+=1/this.zoomingSensibility:R.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(q)?this._ctrlPressed&&this.camera._useCtrlForPanning?R.inertialPanningX+=1/this.panningSensibility:R.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(q)?this._ctrlPressed&&this.camera._useCtrlForPanning?R.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?R.inertialRadiusOffset-=1/this.zoomingSensibility:R.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(q)&&R.useInputToRestoreState&&R.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,w.b)([(0,u.E)()],x.prototype,"keysUp",void 0),(0,w.b)([(0,u.E)()],x.prototype,"keysDown",void 0),(0,w.b)([(0,u.E)()],x.prototype,"keysLeft",void 0),(0,w.b)([(0,u.E)()],x.prototype,"keysRight",void 0),(0,w.b)([(0,u.E)()],x.prototype,"keysReset",void 0),(0,w.b)([(0,u.E)()],x.prototype,"panningSensibility",void 0),(0,w.b)([(0,u.E)()],x.prototype,"zoomingSensibility",void 0),(0,w.b)([(0,u.E)()],x.prototype,"useAltToZoom",void 0),(0,w.b)([(0,u.E)()],x.prototype,"angularSpeed",void 0),K.d.ArcRotateCameraKeyboardMoveInput=x;var E=q(1151),P=q(1268),s=q(1001);class O{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new v.m(0,0,0),this._globalOffset=new v.m(0,0,0),this._inertialPanning=v.m.Zero()}_computeDeltaFromMouseWheelLegacyEvent(R,N){let q=0;const w=.01*R*this.wheelDeltaPercentage*N;return q=R>0?w/(1+this.wheelDeltaPercentage):w*(1+this.wheelDeltaPercentage),q}attachControl(R){R=r.i.BackCompatCameraNoPreventDefault(arguments),this._wheel=N=>{if(N.type!==y.d.POINTERWHEEL)return;const q=N.event;let w=0;const u=q.deltaMode===P.d.DOM_DELTA_LINE?40:1,M=-q.deltaY*u;if(this.customComputeDeltaFromMouseWheel)w=this.customComputeDeltaFromMouseWheel(M,this,q);else if(this.wheelDeltaPercentage){if(w=this._computeDeltaFromMouseWheelLegacyEvent(M,this.camera.i),w>0){let R=this.camera.i,N=this.camera.inertialRadiusOffset+w;for(let q=0;q<20&&Math.abs(N)>.001;q++)R-=N,N*=this.camera.inertia;R=(0,s.b)(R,0,Number.MAX_VALUE),w=this._computeDeltaFromMouseWheelLegacyEvent(M,R)}}else w=M/(40*this.wheelPrecision);w&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(w)):this.camera.inertialRadiusOffset+=w),q.preventDefault&&(R||q.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,y.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Td(0)}Pe(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const R=this.camera;0+R.inertialAlphaOffset+R.inertialBetaOffset+R.inertialRadiusOffset&&(this._updateHitPlane(),R.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(R.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const R=this.camera,N=R.target.Vc(R.position);this._hitPlane=E.d.FromPositionAndNormal(R.target,N)}_getPosition(){const R=this.camera,N=R.va(),q=N.createPickingRay(N.pointerX,N.pointerY,v.c.Identity(),R,!1);0===R.targetScreenOffset.x&&0===R.targetScreenOffset.y||(this._viewOffset.set(R.targetScreenOffset.x,R.targetScreenOffset.y,0),R.getViewMatrix().invertToRef(R._cameraTransformMatrix),this._globalOffset=v.m.TransformNormal(this._viewOffset,R._cameraTransformMatrix),q.origin.addInPlace(this._globalOffset));let w=0;return this._hitPlane&&(w=q.intersectsPlane(this._hitPlane)??0),q.origin.addInPlace(q.direction.scaleInPlace(w))}_zoomToMouse(R){const N=this.camera,q=1-N.inertia;if(N.lowerRadiusLimit){const w=N.lowerRadiusLimit??0;N.i-(N.inertialRadiusOffset+R)/q<w&&(R=(N.i-w)*q-N.inertialRadiusOffset)}if(N.upperRadiusLimit){const w=N.upperRadiusLimit??0;N.i-(N.inertialRadiusOffset+R)/q>w&&(R=(N.i-w)*q-N.inertialRadiusOffset)}const w=R/q/N.i,u=this._getPosition(),M=v.f.Od[6];u.subtractToRef(N.target,M),M.scaleInPlace(w),M.scaleInPlace(q),this._inertialPanning.addInPlace(M),N.inertialRadiusOffset+=R}_zeroIfClose(R){Math.abs(R.x)<j.b&&(R.x=0),Math.abs(R.y)<j.b&&(R.y=0),Math.abs(R.z)<j.b&&(R.z=0)}}(0,w.b)([(0,u.E)()],O.prototype,"wheelPrecision",void 0),(0,w.b)([(0,u.E)()],O.prototype,"zoomToMouseLocation",void 0),(0,w.b)([(0,u.E)()],O.prototype,"wheelDeltaPercentage",void 0),K.d.ArcRotateCameraMouseWheelInput=O;class L extends K.g{constructor(R){super(R)}addMouseWheel(){return this.add(new O),this}addPointers(){return this.add(new z),this}addKeyboard(){return this.add(new x),this}}var m=q(982);G.d.AddNodeConstructor("ArcRotateCamera",((R,N)=>()=>new o(R,0,0,1,v.m.Zero(),N)));class o extends e.b{get target(){return this._target}set target(R){this.setTarget(R)}get targetHost(){return this._targetHost}set targetHost(R){R&&this.setTarget(R)}getTarget(){return this.target}get position(){return this._position}set position(R){this.setPosition(R)}set upVector(R){this._upToYMatrix||(this._yToUpMatrix=new v.c,this._upToYMatrix=new v.c,this._upVector=v.m.Zero()),R.normalize(),this._upVector.p(R),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){v.c.RotationAlignToRef(v.m.UpReadOnly,this._upVector,this._yToUpMatrix),v.c.RotationAlignToRef(this._upVector,v.m.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const R=this.inputs.attached.pointers;return R?R.angularSensibilityX:0}set angularSensibilityX(R){const N=this.inputs.attached.pointers;N&&(N.angularSensibilityX=R)}get angularSensibilityY(){const R=this.inputs.attached.pointers;return R?R.angularSensibilityY:0}set angularSensibilityY(R){const N=this.inputs.attached.pointers;N&&(N.angularSensibilityY=R)}get pinchPrecision(){const R=this.inputs.attached.pointers;return R?R.pinchPrecision:0}set pinchPrecision(R){const N=this.inputs.attached.pointers;N&&(N.pinchPrecision=R)}get pinchDeltaPercentage(){const R=this.inputs.attached.pointers;return R?R.pinchDeltaPercentage:0}set pinchDeltaPercentage(R){const N=this.inputs.attached.pointers;N&&(N.pinchDeltaPercentage=R)}get useNaturalPinchZoom(){const R=this.inputs.attached.pointers;return!!R&&R.useNaturalPinchZoom}set useNaturalPinchZoom(R){const N=this.inputs.attached.pointers;N&&(N.useNaturalPinchZoom=R)}get panningSensibility(){const R=this.inputs.attached.pointers;return R?R.panningSensibility:0}set panningSensibility(R){const N=this.inputs.attached.pointers;N&&(N.panningSensibility=R)}get keysUp(){const R=this.inputs.attached.keyboard;return R?R.keysUp:[]}set keysUp(R){const N=this.inputs.attached.keyboard;N&&(N.keysUp=R)}get keysDown(){const R=this.inputs.attached.keyboard;return R?R.keysDown:[]}set keysDown(R){const N=this.inputs.attached.keyboard;N&&(N.keysDown=R)}get keysLeft(){const R=this.inputs.attached.keyboard;return R?R.keysLeft:[]}set keysLeft(R){const N=this.inputs.attached.keyboard;N&&(N.keysLeft=R)}get keysRight(){const R=this.inputs.attached.keyboard;return R?R.keysRight:[]}set keysRight(R){const N=this.inputs.attached.keyboard;N&&(N.keysRight=R)}get wheelPrecision(){const R=this.inputs.attached.mousewheel;return R?R.wheelPrecision:0}set wheelPrecision(R){const N=this.inputs.attached.mousewheel;N&&(N.wheelPrecision=R)}get zoomToMouseLocation(){const R=this.inputs.attached.mousewheel;return!!R&&R.zoomToMouseLocation}set zoomToMouseLocation(R){const N=this.inputs.attached.mousewheel;N&&(N.zoomToMouseLocation=R)}get wheelDeltaPercentage(){const R=this.inputs.attached.mousewheel;return R?R.wheelDeltaPercentage:0}set wheelDeltaPercentage(R){const N=this.inputs.attached.mousewheel;N&&(N.wheelDeltaPercentage=R)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(R){R!==this.useBouncingBehavior&&(R?(this._bouncingBehavior=new W,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(R){R!==this.useFramingBehavior&&(R?(this._framingBehavior=new k,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(R){R!==this.useAutoRotationBehavior&&(R?(this._autoRotationBehavior=new F,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(R,N,q,w,u,G){var J;let y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(R,v.m.Zero(),G,y),J=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=v.m.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=v.j.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new v.c,this.panningAxis=new v.m(1,1,0),this._transformedDirection=new v.m,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new M.c,this.checkCollisions=!1,this.collisionRadius=new v.m(.5,.5,.5),this._previousPosition=v.m.Zero(),this._collisionVelocity=v.m.Zero(),this._newPosition=v.m.Zero(),this._computationVector=v.m.Zero(),this._onCollisionPositionChange=function(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q?(J.setPosition(N),J.Hk&&J.Hk(q)):J._previousPosition.p(J._position);const w=Math.cos(J.alpha),u=Math.sin(J.alpha),M=Math.cos(J.beta);let v=Math.sin(J.beta);0===v&&(v=1e-4);const G=J._getTargetPosition();J._computationVector.Rd(J.i*w*v,J.i*M,J.i*u*v),G.addToRef(J._computationVector,J._newPosition),J._position.p(J._newPosition);let y=J.upVector;J.allowUpsideDown&&J.beta<0&&(y=y.clone(),y=y.negate()),J._computeViewMatrix(J._position,G,y),J._viewMatrix.addAtIndex(12,J.targetScreenOffset.x),J._viewMatrix.addAtIndex(13,J.targetScreenOffset.y),J._collisionTriggered=!1},this._target=v.m.Zero(),u&&this.setTarget(u),this.alpha=N,this.beta=q,this.i=w,this.getViewMatrix(),this.inputs=new L(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new v.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.i=void 0,this._cache.targetScreenOffset=v.j.Zero()}_updateCache(R){R||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.i=this.i,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const R=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?R.addToRef(this._targetBoundingCenter,this._target):this._target.p(R)}const R=this._getLockedTargetPosition();return R||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.i,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>j.b&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.i=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.i===this.i&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(R,N){let q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const u=arguments;N=r.i.BackCompatCameraNoPreventDefault(u),this._useCtrlForPanning=q,this._panningMouseButton=w,"boolean"===typeof u[0]&&(u.length>1&&(this._useCtrlForPanning=u[1]),u.length>2&&(this._panningMouseButton=u[2])),this.inputs.attachElement(N),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Pe(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const R=this._scene.getEngine().getDeltaTime()/1e3,N=1-Math.pow(2,-R/this.restoreStateInterpolationFactor);this.setTarget(v.m.Lerp(this.getTarget(),this._storedTarget,N)),v.e.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,v.f.Quaternion[0]),v.e.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,v.f.Quaternion[1]),v.e.SlerpToRef(v.f.Quaternion[1],v.f.Quaternion[0],N,v.f.Quaternion[2]),v.f.Quaternion[2].normalize(),v.f.Quaternion[2].toAlphaBetaGammaToRef(v.f.Od[0]),this.alpha=v.f.Od[0].x,this.beta=v.f.Od[0].y,this.i+=(this._storedRadius-this.i)*N,v.j.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,N,this.targetScreenOffset),(v.m.DistanceSquared(this.getTarget(),this._storedTarget)<j.b&&v.f.Quaternion[2].equalsWithEpsilon(v.f.Quaternion[0])&&Math.pow(this._storedRadius-this.i,2)<j.b&&v.j.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<j.b||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const R=this.invertRotation?-1:1,N=this._calculateHandednessMultiplier();let q=this.inertialAlphaOffset*N;this.beta<0&&(q*=-1),this.alpha+=q*R,this.beta+=this.inertialBetaOffset*R,this.i-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<j.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<j.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*j.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const R=new v.m(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),R.multiplyInPlace(this.panningAxis),v.m.TransformNormalToRef(R,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const R=this.upVector,N=v.m.CrossToRef(this._transformedDirection,R,this._transformedDirection);v.m.CrossToRef(R,N,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);v.m.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const R=v.f.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(R),R.transposeToRef(R),v.m.TransformCoordinatesToRef(this._transformedDirection,R,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*j.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*j.b&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.i<this.lowerRadiusLimit&&(this.i=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.i>this.upperRadiusLimit&&(this.i=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||v.m.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.i=this._computationVector.length(),0===this.i&&(this.i=1e-4);const R=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const N=Math.round((R-this.alpha)/(2*Math.PI));this.alpha+=2*N*Math.PI,this.beta=Math.acos(this._computationVector.y/this.i),this._checkLimits()}setPosition(R){this._position.equals(R)||(this._position.p(R),this.rebuildAnglesAndRadius())}setTarget(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(w=this.overrideCloneAlphaBetaRadius??w,R.je)N&&R.getBoundingInfo?this._targetBoundingCenter=R.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,R.je(),this._targetHost=R,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const N=R,w=this._getTargetPosition();if(w&&!q&&w.equals(N))return;this._targetHost=null,this._target=N,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}w||this.rebuildAnglesAndRadius()}_getViewMatrix(){const R=Math.cos(this.alpha),N=Math.sin(this.alpha),q=Math.cos(this.beta);let w=Math.sin(this.beta);0===w&&(w=1e-4),0===this.i&&(this.i=1e-4);const u=this._getTargetPosition();if(this._computationVector.Rd(this.i*R*w,this.i*q,this.i*N*w),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||v.m.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),u.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const R=this.va().collisionCoordinator;this._collider||(this._collider=R.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,R.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let R=this.upVector;this.allowUpsideDown&&w<0&&(R=R.negate()),this._computeViewMatrix(this._position,u,R),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=u,this._viewMatrix}zoomOn(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];R=R||this.va().meshes;const q=J.b.MinMax(R);let w=this._calculateLowerRadiusFromModelBoundingSphere(q.min,q.max);w=Math.max(Math.min(w,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.i=w*this.zoomOnFactor,this.focusOn({min:q.min,max:q.max,distance:w},N)}focusOn(R){let N,q,w=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===R.min){const w=R||this.va().meshes;N=J.b.MinMax(w),q=v.m.Distance(N.min,N.max)}else{N=R,q=R.distance}this._target=J.b.Center(N),w||(this.maxZ=2*q)}createRigCamera(R,N){let q=0;switch(this.cameraRigMode){case C.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case C.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case C.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case C.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case C.e.RIG_MODE_VR:q=this._cameraRigParams.stereoHalfAngle*(0===N?1:-1);break;case C.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:q=this._cameraRigParams.stereoHalfAngle*(0===N?-1:1)}const w=new o(R,this.alpha+q,this.beta,this.i,this._target,this.va());return w._cameraRigParams={},w.isRigCamera=!0,w.rigParent=this,w.upVector=this.upVector,w.mode=this.mode,w.orthoLeft=this.orthoLeft,w.orthoRight=this.orthoRight,w.orthoBottom=this.orthoBottom,w.orthoTop=this.orthoTop,w}_updateRigCameras(){const R=this._rigCameras[0],N=this._rigCameras[1];switch(R.beta=N.beta=this.beta,this.cameraRigMode){case C.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case C.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case C.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case C.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case C.e.RIG_MODE_VR:R.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,N.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case C.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:R.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,N.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const w=v.m.Distance(R,N),u=this.va().getEngine().getAspectRatio(this),M=Math.tan(this.fov/2),G=M*u,J=.5*w*q,y=J*Math.sqrt(1+1/(G*G)),a=J*Math.sqrt(1+1/(M*M));return Math.max(y,a)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,w.b)([(0,u.E)()],o.prototype,"alpha",void 0),(0,w.b)([(0,u.E)()],o.prototype,"beta",void 0),(0,w.b)([(0,u.E)()],o.prototype,"i",void 0),(0,w.b)([(0,u.E)()],o.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,w.b)([(0,u.C)("target")],o.prototype,"_target",void 0),(0,w.b)([(0,u.u)("targetHost")],o.prototype,"_targetHost",void 0),(0,w.b)([(0,u.E)()],o.prototype,"inertialAlphaOffset",void 0),(0,w.b)([(0,u.E)()],o.prototype,"inertialBetaOffset",void 0),(0,w.b)([(0,u.E)()],o.prototype,"inertialRadiusOffset",void 0),(0,w.b)([(0,u.E)()],o.prototype,"lowerAlphaLimit",void 0),(0,w.b)([(0,u.E)()],o.prototype,"upperAlphaLimit",void 0),(0,w.b)([(0,u.E)()],o.prototype,"lowerBetaLimit",void 0),(0,w.b)([(0,u.E)()],o.prototype,"upperBetaLimit",void 0),(0,w.b)([(0,u.E)()],o.prototype,"lowerRadiusLimit",void 0),(0,w.b)([(0,u.E)()],o.prototype,"upperRadiusLimit",void 0),(0,w.b)([(0,u.E)()],o.prototype,"inertialPanningX",void 0),(0,w.b)([(0,u.E)()],o.prototype,"inertialPanningY",void 0),(0,w.b)([(0,u.E)()],o.prototype,"pinchToPanMaxDistance",void 0),(0,w.b)([(0,u.E)()],o.prototype,"panningDistanceLimit",void 0),(0,w.b)([(0,u.C)()],o.prototype,"panningOriginTarget",void 0),(0,w.b)([(0,u.E)()],o.prototype,"panningInertia",void 0),(0,w.b)([(0,u.E)()],o.prototype,"zoomToMouseLocation",null),(0,w.b)([(0,u.E)()],o.prototype,"zoomOnFactor",void 0),(0,w.b)([(0,u.z)()],o.prototype,"targetScreenOffset",void 0),(0,w.b)([(0,u.E)()],o.prototype,"allowUpsideDown",void 0),(0,w.b)([(0,u.E)()],o.prototype,"useInputToRestoreState",void 0),(0,w.b)([(0,u.E)()],o.prototype,"restoreStateInterpolationFactor",void 0),(0,m.h)("BABYLON.ArcRotateCamera",o)},11396:(R,N,q)=>{"use strict";q.d(N,{e:()=>k});var w=q(942),u=q(947),M=q(1171),v=q(1177),G=q(959),J=q(966),y=q(11398),a=q(1056),j=q(982),F=q(1044),S=q(1477),H=q(1287),W=q(1128);class k extends y.d{get position(){return this._position}set position(R){this._position=R}set upVector(R){this._upVector=R}get upVector(){return this._upVector}get screenArea(){let R=0,N=0;if(this.mode===k.PERSPECTIVE_CAMERA)this.fovMode===k.FOVMODE_VERTICAL_FIXED?(N=2*this.dj*Math.tan(this.fov/2),R=this.getEngine().getAspectRatio(this)*N):(R=2*this.dj*Math.tan(this.fov/2),N=R/this.getEngine().getAspectRatio(this));else{const q=this.getEngine().getRenderWidth()/2,w=this.getEngine().getRenderHeight()/2;R=(this.orthoRight??q)-(this.orthoLeft??-q),N=(this.orthoTop??w)-(this.orthoBottom??-w)}return R*N}set orthoLeft(R){this._orthoLeft=R;for(const N of this._rigCameras)N.orthoLeft=R}get orthoLeft(){return this._orthoLeft}set orthoRight(R){this._orthoRight=R;for(const N of this._rigCameras)N.orthoRight=R}get orthoRight(){return this._orthoRight}set orthoBottom(R){this._orthoBottom=R;for(const N of this._rigCameras)N.orthoBottom=R}get orthoBottom(){return this._orthoBottom}set orthoTop(R){this._orthoTop=R;for(const N of this._rigCameras)N.orthoTop=R}get orthoTop(){return this._orthoTop}set mode(R){this._mode=R;for(const N of this._rigCameras)N.mode=R}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(R,N,q){let w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(R,q,!1),this._position=J.m.Zero(),this._upVector=J.m.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.dj=1,this.maxZ=1e4,this.inertia=.9,this._mode=k.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new S.d(0,0,1,1),this.layerMask=268435455,this.fovMode=k.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=k.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new G.c,this.onProjectionMatrixChangedObservable=new G.c,this.onAfterCheckInputsObservable=new G.c,this.onRestoreStateObservable=new G.c,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new J.c,this._postProcesses=new Array,this._activeMeshes=new M.f(256),this._globalPosition=J.m.Zero(),this._computedViewMatrix=J.c.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=J.c.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=J.e.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),w&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=N,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${R}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Qh"}toString(R){let N="Name: "+this.name;if(N+=", type: "+this.getClassName(),this.animations)for(let q=0;q<this.animations.length;q++)N+=", animation[0]: "+this.animations[q].toString(R);return N}applyVerticalCorrection(){const R=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-R.x:R.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(R){return-1!==this._activeMeshes.indexOf(R)}isReady(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(R)for(const N of this._postProcesses)if(N&&!N.isReady())return!1;return super.isReady(R)}_initCache(){super._initCache(),this._cache.position=new J.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new J.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.dj=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(R){R||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let R=this._cache.mode===this.mode&&this._cache.dj===this.dj&&this._cache.maxZ===this.maxZ;if(!R)return!1;const N=this.getEngine();return this.mode===k.PERSPECTIVE_CAMERA?R=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===N.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(R=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===N.getRenderWidth()&&this._cache.renderHeight===N.getRenderHeight(),this.oblique&&(R=R&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),R}attachControl(R,N){}Pe(R){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==k.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let R=0;R<this._postProcesses.length;R++)if(null!==this._postProcesses[R])return this._postProcesses[R];return null}_cascadePostProcessesToRigCams(){const R=this._getFirstPostProcess();R&&R.markTextureDirty();for(let N=0,q=this._rigCameras.length;N<q;N++){const R=this._rigCameras[N],q=R._rigPostProcess;if(q){"pass"===q.getEffectName()&&(R.isIntermediate=0===this._postProcesses.length),R._postProcesses=this._postProcesses.slice(0).concat(q),q.markTextureDirty()}else R._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!R.isReusable()&&this._postProcesses.indexOf(R)>-1?(a.e.Error("You're trying to reuse a post process not defined as reusable."),0):(null==N||N<0?this._postProcesses.push(R):null===this._postProcesses[N]?this._postProcesses[N]=R:this._postProcesses.splice(N,0,R),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.pe(),this._postProcesses.indexOf(R))}detachPostProcess(R){const N=this._postProcesses.indexOf(R);-1!==N&&(this._postProcesses[N]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.pe(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return J.c.Identity()}getViewMatrix(R){return!R&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(R){this._doNotComputeProjectionMatrix=!0,void 0!==R&&(this._projectionMatrix=R)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(R){if(this._doNotComputeProjectionMatrix||!R&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.dj=this.dj,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const N=this.getEngine(),q=this.va(),w=N.useReverseDepthBuffer;if(this.mode===k.PERSPECTIVE_CAMERA){let R;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=N.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.dj<=0&&(this.dj=.1),R=q.useRightHandedSystem?J.c.PerspectiveFovRHToRef:J.c.PerspectiveFovLHToRef,R(this.fov,N.getAspectRatio(this),w?this.maxZ:this.dj,w?this.dj:this.maxZ,this._projectionMatrix,this.fovMode===k.FOVMODE_VERTICAL_FIXED,N.isNDCHalfZRange,this.projectionPlaneTilt,w)}else{var u,M,v;const R=N.getRenderWidth()/2,G=N.getRenderHeight()/2;q.useRightHandedSystem?this.oblique?J.c.ObliqueOffCenterRHToRef(this.orthoLeft??-R,this.orthoRight??R,this.orthoBottom??-G,this.orthoTop??G,w?this.maxZ:this.dj,w?this.dj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,N.isNDCHalfZRange):J.c.OrthoOffCenterRHToRef(this.orthoLeft??-R,this.orthoRight??R,this.orthoBottom??-G,this.orthoTop??G,w?this.maxZ:this.dj,w?this.dj:this.maxZ,this._projectionMatrix,N.isNDCHalfZRange):this.oblique?J.c.ObliqueOffCenterLHToRef(this.orthoLeft??-R,this.orthoRight??R,this.orthoBottom??-G,this.orthoTop??G,w?this.maxZ:this.dj,w?this.dj:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,N.isNDCHalfZRange):J.c.OrthoOffCenterLHToRef(this.orthoLeft??-R,this.orthoRight??R,this.orthoBottom??-G,this.orthoTop??G,w?this.maxZ:this.dj,w?this.dj:this.maxZ,this._projectionMatrix,N.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(u=this.oblique)||void 0===u?void 0:u.angle,this._cache.obliqueLength=null===(M=this.oblique)||void 0===M?void 0:M.length,this._cache.obliqueOffset=null===(v=this.oblique)||void 0===v?void 0:v.offset,this._cache.renderWidth=N.getRenderWidth(),this._cache.renderHeight=N.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(R){return(this.i||(this.target?J.m.Distance(this.position,this.target):this.position.length()))+R}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?H.c.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=H.c.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),N&&this.rigCameras.length>0){let N=!1;return this.rigCameras.forEach((q=>{q._updateFrustumPlanes(),N=N||R.isInFrustum(q._frustumPlanes)})),N}return R.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(R){return this._updateFrustumPlanes(),R.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,F.c)("Ray")}getForwardRayToRef(R){throw(0,F.c)("Ray")}dispose(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const R=this._rigCameras.pop();R&&R.dispose()}if(this._parentContainer){const R=this._parentContainer.cameras.indexOf(this);R>-1&&this._parentContainer.cameras.splice(R,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==k.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let R=this._postProcesses.length;for(;--R>=0;){const N=this._postProcesses[R];N&&N.dispose(this)}}let q=this.customRenderTargets.length;for(;--q>=0;)this.customRenderTargets[q].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(R,N)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(R,N){if(this.cameraRigMode!==R){for(;this._rigCameras.length>0;){const R=this._rigCameras.pop();R&&R.dispose()}if(this.cameraRigMode=R,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=N.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=v.i.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==k.RIG_MODE_NONE){const R=this.createRigCamera(this.name+"_L",0);R&&(R._isLeftCamera=!0);const N=this.createRigCamera(this.name+"_R",1);N&&(N._isRightCamera=!0),R&&N&&(this._rigCameras.push(R),this._rigCameras.push(N))}this._setRigMode(N),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(R){}_getVRProjectionMatrix(){return J.c.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.dj,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(R,N){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[R]=N,"interaxialDistance"===R&&(this._cameraRigParams.stereoHalfAngle=v.i.ToRadians(N/.0637))}createRigCamera(R,N){return null}_updateRigCameras(){for(let R=0;R<this._rigCameras.length;R++)this._rigCameras[R].dj=this.dj,this._rigCameras[R].maxZ=this.maxZ,this._rigCameras[R].fov=this.fov,this._rigCameras[R].upVector.p(this.upVector);this.cameraRigMode===k.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const R=W.e.Serialize(this);return R.uniqueId=this.uniqueId,R.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(R),this.inputs&&this.inputs.serialize(R),W.e.AppendSerializedAnimations(this,R),R.ranges=this.serializeAnimationRanges(),R.isEnabled=this.isEnabled(),R}clone(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=W.e.Clone(k.GetConstructorFromName(this.getClassName(),R,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return q.name=R,q.parent=N,this.onClonedObservable.notifyObservers(q),q}nf(R){const N=J.m.Zero();return this.getDirectionToRef(R,N),N}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(R,N){J.m.TransformNormalToRef(R,this.getWorldMatrix(),N)}static GetConstructorFromName(R,N,q){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const M=y.d.Construct(R,N,q,{interaxial_distance:w,isStereoscopicSideBySide:u});return M||(()=>k._CreateDefaultParsedCamera(N,q))}je(){return this.getWorldMatrix()}static Parse(R,N){const q=R.type,w=k.GetConstructorFromName(q,R.name,N,R.interaxial_distance,R.isStereoscopicSideBySide),u=W.e.Parse(w,R,N);if(void 0!==R.parentId&&(u._waitingParentId=R.parentId),void 0!==R.parentInstanceIndex&&(u._waitingParentInstanceIndex=R.parentInstanceIndex),u.inputs&&(u.inputs.parse(R),u._setupInputs()),R.upVector&&(u.upVector=J.m.Sd(R.upVector)),u.setPosition&&(u.position.Rd(0,0,0),u.setPosition(J.m.Sd(R.position))),R.target&&u.setTarget&&u.setTarget(J.m.Sd(R.target)),R.cameraRigMode){const N=R.interaxial_distance?{interaxialDistance:R.interaxial_distance}:{};u.setCameraRigMode(R.cameraRigMode,N)}if(R.animations){for(let N=0;N<R.animations.length;N++){const q=R.animations[N],w=(0,j.e)("BABYLON.Animation");w&&u.animations.push(w.Parse(q))}y.d.ParseAnimationRanges(u,R,N)}return R.autoAnimate&&N.beginAnimation(u,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1),void 0!==R.isEnabled&&u.Jg(R.isEnabled),u}_calculateHandednessMultiplier(){let R=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(R*=-1),R}}k._CreateDefaultParsedCamera=(R,N)=>{throw(0,F.c)("UniversalCamera")},k.PERSPECTIVE_CAMERA=0,k.ORTHOGRAPHIC_CAMERA=1,k.FOVMODE_VERTICAL_FIXED=0,k.FOVMODE_HORIZONTAL_FIXED=1,k.RIG_MODE_NONE=0,k.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,k.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,k.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,k.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,k.RIG_MODE_STEREOSCOPIC_INTERLACED=14,k.RIG_MODE_VR=20,k.RIG_MODE_CUSTOM=22,k.ForceAttachControlToAlwaysPreventDefault=!1,(0,w.b)([(0,u.C)("position")],k.prototype,"_position",void 0),(0,w.b)([(0,u.C)("upVector")],k.prototype,"_upVector",void 0),(0,w.b)([(0,u.E)()],k.prototype,"orthoLeft",null),(0,w.b)([(0,u.E)()],k.prototype,"orthoRight",null),(0,w.b)([(0,u.E)()],k.prototype,"orthoBottom",null),(0,w.b)([(0,u.E)()],k.prototype,"orthoTop",null),(0,w.b)([(0,u.E)()],k.prototype,"fov",void 0),(0,w.b)([(0,u.E)()],k.prototype,"projectionPlaneTilt",void 0),(0,w.b)([(0,u.E)()],k.prototype,"dj",void 0),(0,w.b)([(0,u.E)()],k.prototype,"maxZ",void 0),(0,w.b)([(0,u.E)()],k.prototype,"inertia",void 0),(0,w.b)([(0,u.E)()],k.prototype,"mode",null),(0,w.b)([(0,u.E)()],k.prototype,"layerMask",void 0),(0,w.b)([(0,u.E)()],k.prototype,"fovMode",void 0),(0,w.b)([(0,u.E)()],k.prototype,"cameraRigMode",void 0),(0,w.b)([(0,u.E)()],k.prototype,"interaxialDistance",void 0),(0,w.b)([(0,u.E)()],k.prototype,"isStereoscopicSideBySide",void 0)},11995:(R,N,q)=>{"use strict";q.d(N,{d:()=>v,g:()=>G});var w=q(1056),u=q(1128),M=q(11396),v={};class G{constructor(R){this.attachedToElement=!1,this.attached={},this.camera=R,this.checkInputs=()=>{}}add(R){const N=R.getSimpleName();this.attached[N]?w.e.Warn("camera input of type "+N+" already exists on camera"):(this.attached[N]=R,R.camera=this.camera,R.checkInputs&&(this.checkInputs=this._addCheckInputs(R.checkInputs.bind(R))),this.attachedToElement&&R.attachControl(this.noPreventDefault))}remove(R){for(const N in this.attached){const q=this.attached[N];if(q===R)return q.Pe(),q.camera=null,delete this.attached[N],void this.rebuildInputCheck()}}removeByType(R){for(const N in this.attached){const q=this.attached[N];q.getClassName()===R&&(q.Pe(),q.camera=null,delete this.attached[N],this.rebuildInputCheck())}}_addCheckInputs(R){const N=this.checkInputs;return()=>{N(),R()}}attachInput(R){this.attachedToElement&&R.attachControl(this.noPreventDefault)}attachElement(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){R=!M.e.ForceAttachControlToAlwaysPreventDefault&&R,this.attachedToElement=!0,this.noPreventDefault=R;for(const N in this.attached)this.attached[N].attachControl(R)}}detachElement(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const N in this.attached)this.attached[N].Pe(),R&&(this.attached[N].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const R in this.attached){const N=this.attached[R];N.checkInputs&&(this.checkInputs=this._addCheckInputs(N.checkInputs.bind(N)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(R){const N={};for(const q in this.attached){const R=this.attached[q],w=u.e.Serialize(R);N[R.getClassName()]=w}R.inputsmgr=N}parse(R){const N=R.inputsmgr;if(N){this.clear();for(const R in N){const q=v[R];if(q){const w=N[R],M=u.e.Parse((()=>new q),w,null);this.add(M)}}}else for(const q in this.attached){const N=v[this.attached[q].getClassName()];if(N){const w=u.e.Parse((()=>new N),R,null);this.remove(this.attached[q]),this.add(w)}}}}},11983:(R,N,q)=>{"use strict";q.d(N,{e:()=>z});var w=q(942),u=q(947),M=q(966),v=q(11987),G=q(11995),J=q(1262),y=q(1177);class a{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(R){R=y.i.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((N=>{const q=N.event;if(!q.metaKey)if(N.type===J.d.KEYDOWN){if(-1!==this.keysUp.indexOf(q.keyCode)||-1!==this.keysDown.indexOf(q.keyCode)||-1!==this.keysLeft.indexOf(q.keyCode)||-1!==this.keysRight.indexOf(q.keyCode)||-1!==this.keysUpward.indexOf(q.keyCode)||-1!==this.keysDownward.indexOf(q.keyCode)||-1!==this.keysRotateLeft.indexOf(q.keyCode)||-1!==this.keysRotateRight.indexOf(q.keyCode)||-1!==this.keysRotateUp.indexOf(q.keyCode)||-1!==this.keysRotateDown.indexOf(q.keyCode)){-1===this._keys.indexOf(q.keyCode)&&this._keys.push(q.keyCode),R||q.preventDefault()}}else if(-1!==this.keysUp.indexOf(q.keyCode)||-1!==this.keysDown.indexOf(q.keyCode)||-1!==this.keysLeft.indexOf(q.keyCode)||-1!==this.keysRight.indexOf(q.keyCode)||-1!==this.keysUpward.indexOf(q.keyCode)||-1!==this.keysDownward.indexOf(q.keyCode)||-1!==this.keysRotateLeft.indexOf(q.keyCode)||-1!==this.keysRotateRight.indexOf(q.keyCode)||-1!==this.keysRotateUp.indexOf(q.keyCode)||-1!==this.keysRotateDown.indexOf(q.keyCode)){const N=this._keys.indexOf(q.keyCode);N>=0&&this._keys.splice(N,1),R||q.preventDefault()}})))}Pe(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const R=this.camera;for(let N=0;N<this._keys.length;N++){const q=this._keys[N],w=R._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(q)?R._localDirection.Rd(-w,0,0):-1!==this.keysUp.indexOf(q)?R._localDirection.Rd(0,0,w):-1!==this.keysRight.indexOf(q)?R._localDirection.Rd(w,0,0):-1!==this.keysDown.indexOf(q)?R._localDirection.Rd(0,0,-w):-1!==this.keysUpward.indexOf(q)?R._localDirection.Rd(0,w,0):-1!==this.keysDownward.indexOf(q)?R._localDirection.Rd(0,-w,0):-1!==this.keysRotateLeft.indexOf(q)?(R._localDirection.Rd(0,0,0),R.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(q)?(R._localDirection.Rd(0,0,0),R.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(q)?(R._localDirection.Rd(0,0,0),R.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(q)&&(R._localDirection.Rd(0,0,0),R.cameraRotation.x+=this._getLocalRotation()),R.va().useRightHandedSystem&&(R._localDirection.z*=-1),R.getViewMatrix().invertToRef(R._cameraTransformMatrix),M.m.TransformNormalToRef(R._localDirection,R._cameraTransformMatrix,R._transformedDirection),R.cameraDirection.addInPlace(R._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const R=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*R}}(0,w.b)([(0,u.E)()],a.prototype,"keysUp",void 0),(0,w.b)([(0,u.E)()],a.prototype,"keysUpward",void 0),(0,w.b)([(0,u.E)()],a.prototype,"keysDown",void 0),(0,w.b)([(0,u.E)()],a.prototype,"keysDownward",void 0),(0,w.b)([(0,u.E)()],a.prototype,"keysLeft",void 0),(0,w.b)([(0,u.E)()],a.prototype,"keysRight",void 0),(0,w.b)([(0,u.E)()],a.prototype,"rotationSpeed",void 0),(0,w.b)([(0,u.E)()],a.prototype,"keysRotateLeft",void 0),(0,w.b)([(0,u.E)()],a.prototype,"keysRotateRight",void 0),(0,w.b)([(0,u.E)()],a.prototype,"keysRotateUp",void 0),(0,w.b)([(0,u.E)()],a.prototype,"keysRotateDown",void 0),G.d.FreeCameraKeyboardMoveInput=a;var j=q(959),F=q(1259);class S{constructor(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=R,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new j.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(R){R=y.i.BackCompatCameraNoPreventDefault(arguments);const N=this.camera.getEngine(),q=N.getInputElement();this._pointerInput||(this._pointerInput=w=>{const u=w.event,M="touch"===u.pointerType;if(!this.touchEnabled&&M)return;if(w.type!==F.d.POINTERMOVE&&-1===this.buttons.indexOf(u.button))return;const v=u.target;if(w.type===F.d.POINTERDOWN){if(M&&-1!==this._activePointerId||!M&&-1!==this._currentActiveButton)return;this._activePointerId=u.pointerId;try{null===v||void 0===v||v.setPointerCapture(u.pointerId)}catch(G){}-1===this._currentActiveButton&&(this._currentActiveButton=u.button),this._previousPosition={x:u.clientX,y:u.clientY},R||(u.preventDefault(),q&&q.focus()),N.isPointerLock&&this._onMouseMove&&this._onMouseMove(w.event)}else if(w.type===F.d.POINTERUP){if(M&&this._activePointerId!==u.pointerId||!M&&this._currentActiveButton!==u.button)return;try{null===v||void 0===v||v.releasePointerCapture(u.pointerId)}catch(G){}this._currentActiveButton=-1,this._previousPosition=null,R||u.preventDefault(),this._activePointerId=-1}else if(w.type===F.d.POINTERMOVE&&(this._activePointerId===u.pointerId||!M))if(N.isPointerLock&&this._onMouseMove)this._onMouseMove(w.event);else if(this._previousPosition){const N=this.camera._calculateHandednessMultiplier(),q=(u.clientX-this._previousPosition.x)*N,w=u.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=q/this.angularSensibility,this.camera.cameraRotation.x+=w/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:q,offsetY:w}),this._previousPosition={x:u.clientX,y:u.clientY},R||u.preventDefault()}}),this._onMouseMove=q=>{if(!N.isPointerLock)return;const w=this.camera._calculateHandednessMultiplier(),u=q.movementX*w;this.camera.cameraRotation.y+=u/this.angularSensibility;const M=q.movementY;this.camera.cameraRotation.x+=M/this.angularSensibility,this._previousPosition=null,R||q.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,F.d.POINTERDOWN|F.d.POINTERUP|F.d.POINTERMOVE),q&&(this._contextMenuBind=R=>this.onContextMenu(R),q.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(R){R.preventDefault()}Pe(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const R=this.camera.getEngine().getInputElement();R&&R.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,w.b)([(0,u.E)()],S.prototype,"buttons",void 0),(0,w.b)([(0,u.E)()],S.prototype,"angularSensibility",void 0),G.d.FreeCameraMouseInput=S;var H,W=q(1268);class k{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new j.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(R){R=y.i.BackCompatCameraNoPreventDefault(arguments),this._wheel=N=>{if(N.type!==F.d.POINTERWHEEL)return;const q=N.event,w=q.deltaMode===W.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*w*q.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*w*q.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*w*q.deltaZ/this._normalize,q.preventDefault&&(R||q.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,F.d.POINTERWHEEL)}Pe(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,w.b)([(0,u.E)()],k.prototype,"wheelPrecisionX",void 0),(0,w.b)([(0,u.E)()],k.prototype,"wheelPrecisionY",void 0),(0,w.b)([(0,u.E)()],k.prototype,"wheelPrecisionZ",void 0),function(R){R[R.MoveRelative=0]="MoveRelative",R[R.RotateRelative=1]="RotateRelative",R[R.MoveScene=2]="MoveScene"}(H||(H={}));class C extends k{constructor(){super(...arguments),this._moveRelative=M.m.Zero(),this._rotateRelative=M.m.Zero(),this._moveScene=M.m.Zero(),this._wheelXAction=H.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=H.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(R){null===R&&this._wheelXAction!==H.MoveRelative||(this._wheelXAction=H.MoveRelative,this._wheelXActionCoordinate=R)}get wheelXMoveRelative(){return this._wheelXAction!==H.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(R){null===R&&this._wheelYAction!==H.MoveRelative||(this._wheelYAction=H.MoveRelative,this._wheelYActionCoordinate=R)}get wheelYMoveRelative(){return this._wheelYAction!==H.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(R){null===R&&this._wheelZAction!==H.MoveRelative||(this._wheelZAction=H.MoveRelative,this._wheelZActionCoordinate=R)}get wheelZMoveRelative(){return this._wheelZAction!==H.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(R){null===R&&this._wheelXAction!==H.RotateRelative||(this._wheelXAction=H.RotateRelative,this._wheelXActionCoordinate=R)}get wheelXRotateRelative(){return this._wheelXAction!==H.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(R){null===R&&this._wheelYAction!==H.RotateRelative||(this._wheelYAction=H.RotateRelative,this._wheelYActionCoordinate=R)}get wheelYRotateRelative(){return this._wheelYAction!==H.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(R){null===R&&this._wheelZAction!==H.RotateRelative||(this._wheelZAction=H.RotateRelative,this._wheelZActionCoordinate=R)}get wheelZRotateRelative(){return this._wheelZAction!==H.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(R){null===R&&this._wheelXAction!==H.MoveScene||(this._wheelXAction=H.MoveScene,this._wheelXActionCoordinate=R)}get wheelXMoveScene(){return this._wheelXAction!==H.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(R){null===R&&this._wheelYAction!==H.MoveScene||(this._wheelYAction=H.MoveScene,this._wheelYActionCoordinate=R)}get wheelYMoveScene(){return this._wheelYAction!==H.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(R){null===R&&this._wheelZAction!==H.MoveScene||(this._wheelZAction=H.MoveScene,this._wheelZActionCoordinate=R)}get wheelZMoveScene(){return this._wheelZAction!==H.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Td(0),this._rotateRelative.Td(0),this._moveScene.Td(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const R=M.c.Zero();this.camera.getViewMatrix().invertToRef(R);const N=M.m.Zero();M.m.TransformNormalToRef(this._moveRelative,R,N),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(N),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(R,N,q){if(0===R)return;if(null===N||null===q)return;let w=null;switch(N){case H.MoveRelative:w=this._moveRelative;break;case H.RotateRelative:w=this._rotateRelative;break;case H.MoveScene:w=this._moveScene}switch(q){case 0:w.set(R,0,0);break;case 1:w.set(0,R,0);break;case 2:w.set(0,0,R)}}}(0,w.b)([(0,u.E)()],C.prototype,"wheelXMoveRelative",null),(0,w.b)([(0,u.E)()],C.prototype,"wheelYMoveRelative",null),(0,w.b)([(0,u.E)()],C.prototype,"wheelZMoveRelative",null),(0,w.b)([(0,u.E)()],C.prototype,"wheelXRotateRelative",null),(0,w.b)([(0,u.E)()],C.prototype,"wheelYRotateRelative",null),(0,w.b)([(0,u.E)()],C.prototype,"wheelZRotateRelative",null),(0,w.b)([(0,u.E)()],C.prototype,"wheelXMoveScene",null),(0,w.b)([(0,u.E)()],C.prototype,"wheelYMoveScene",null),(0,w.b)([(0,u.E)()],C.prototype,"wheelZMoveScene",null),G.d.FreeCameraMouseWheelInput=C;class e{constructor(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=R,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=y.i.IsSafari()}attachControl(R){R=y.i.BackCompatCameraNoPreventDefault(arguments);let N=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=q=>{const w=q.event,u="mouse"===w.pointerType||this._isSafari&&"undefined"===typeof w.pointerType;if(this.allowMouse||!u)if(q.type===F.d.POINTERDOWN){if(R||w.preventDefault(),this._pointerPressed.push(w.pointerId),1!==this._pointerPressed.length)return;N={x:w.clientX,y:w.clientY}}else if(q.type===F.d.POINTERUP){R||w.preventDefault();const q=this._pointerPressed.indexOf(w.pointerId);if(-1===q)return;if(this._pointerPressed.splice(q,1),0!=q)return;N=null,this._offsetX=null,this._offsetY=null}else if(q.type===F.d.POINTERMOVE){if(R||w.preventDefault(),!N)return;if(0!=this._pointerPressed.indexOf(w.pointerId))return;this._offsetX=w.clientX-N.x,this._offsetY=-(w.clientY-N.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,F.d.POINTERDOWN|F.d.POINTERUP|F.d.POINTERMOVE),this._onLostFocus){const R=this.camera.getEngine().getInputElement();R&&R.addEventListener("blur",this._onLostFocus)}}Pe(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const R=this.camera.getEngine().getInputElement();R&&R.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const R=this.camera,N=R._calculateHandednessMultiplier();R.cameraRotation.y=N*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)R.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const N=R._computeLocalCameraSpeed(),q=new M.m(0,0,0!==this.touchMoveSensibility?N*this._offsetY/this.touchMoveSensibility:0);M.c.RotationYawPitchRollToRef(R.rotation.y,R.rotation.x,0,R._cameraRotationMatrix),R.cameraDirection.addInPlace(M.m.TransformCoordinates(q,R._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,w.b)([(0,u.E)()],e.prototype,"touchAngularSensibility",void 0),(0,w.b)([(0,u.E)()],e.prototype,"touchMoveSensibility",void 0),G.d.FreeCameraTouchInput=e;class K extends G.g{constructor(R){super(R),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new a),this}addMouse(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new S(R),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new C,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new e),this}clear(){super.clear(),this._mouseInput=null}}var r=q(982),Z=q(1070);class z extends v.b{get angularSensibility(){const R=this.inputs.attached.mouse;return R?R.angularSensibility:0}set angularSensibility(R){const N=this.inputs.attached.mouse;N&&(N.angularSensibility=R)}get keysUp(){const R=this.inputs.attached.keyboard;return R?R.keysUp:[]}set keysUp(R){const N=this.inputs.attached.keyboard;N&&(N.keysUp=R)}get keysUpward(){const R=this.inputs.attached.keyboard;return R?R.keysUpward:[]}set keysUpward(R){const N=this.inputs.attached.keyboard;N&&(N.keysUpward=R)}get keysDown(){const R=this.inputs.attached.keyboard;return R?R.keysDown:[]}set keysDown(R){const N=this.inputs.attached.keyboard;N&&(N.keysDown=R)}get keysDownward(){const R=this.inputs.attached.keyboard;return R?R.keysDownward:[]}set keysDownward(R){const N=this.inputs.attached.keyboard;N&&(N.keysDownward=R)}get keysLeft(){const R=this.inputs.attached.keyboard;return R?R.keysLeft:[]}set keysLeft(R){const N=this.inputs.attached.keyboard;N&&(N.keysLeft=R)}get keysRight(){const R=this.inputs.attached.keyboard;return R?R.keysRight:[]}set keysRight(R){const N=this.inputs.attached.keyboard;N&&(N.keysRight=R)}get keysRotateLeft(){const R=this.inputs.attached.keyboard;return R?R.keysRotateLeft:[]}set keysRotateLeft(R){const N=this.inputs.attached.keyboard;N&&(N.keysRotateLeft=R)}get keysRotateRight(){const R=this.inputs.attached.keyboard;return R?R.keysRotateRight:[]}set keysRotateRight(R){const N=this.inputs.attached.keyboard;N&&(N.keysRotateRight=R)}get keysRotateUp(){const R=this.inputs.attached.keyboard;return R?R.keysRotateUp:[]}set keysRotateUp(R){const N=this.inputs.attached.keyboard;N&&(N.keysRotateUp=R)}get keysRotateDown(){const R=this.inputs.attached.keyboard;return R?R.keysRotateDown:[]}set keysRotateDown(R){const N=this.inputs.attached.keyboard;N&&(N.keysRotateDown=R)}constructor(R,N,q){var w;super(R,N,q,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),w=this,this.ellipsoid=new M.m(.5,1,.5),this.ellipsoidOffset=new M.m(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=M.m.Zero(),this._diffPosition=M.m.Zero(),this._newPosition=M.m.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;w._newPosition.p(N),w._newPosition.subtractToRef(w._oldPosition,w._diffPosition),w._diffPosition.length()>Z.e.CollisionsEpsilon&&(w.position.addToRef(w._diffPosition,w._deferredPositionUpdate),w._deferOnly?w._deferredUpdated=!0:w.position.p(w._deferredPositionUpdate),w.Hk&&q&&w.Hk(q))},this.inputs=new K(this),this.inputs.addKeyboard().addMouse()}attachControl(R,N){N=y.i.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(N)}Pe(){this.inputs.detachElement(),this.cameraDirection=new M.m(0,0,0),this.cameraRotation=new M.j(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(R){this._collisionMask=isNaN(R)?-1:R}_collideWithWorld(R){let N;N=this.parent?M.m.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,N.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const q=this.va().collisionCoordinator;this._collider||(this._collider=q.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let w=R;this.applyGravity&&(w=R.add(this.va().gravity)),q.getNewPosition(this._oldPosition,w,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=M.m.Zero(),this._transformedDirection=M.m.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(R){this._needMoveForGravity=R}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"fb"}}(0,w.b)([(0,u.C)()],z.prototype,"ellipsoid",void 0),(0,w.b)([(0,u.C)()],z.prototype,"ellipsoidOffset",void 0),(0,w.b)([(0,u.E)()],z.prototype,"checkCollisions",void 0),(0,w.b)([(0,u.E)()],z.prototype,"applyGravity",void 0),(0,r.h)("BABYLON.FreeCamera",z)},11987:(R,N,q)=>{"use strict";q.d(N,{b:()=>y});var w=q(942),u=q(947),M=q(11396),v=q(966),G=q(974),J=q(1460);q(11398).d.AddNodeConstructor("TargetCamera",((R,N)=>()=>new y(R,v.m.Zero(),N)));class y extends M.e{constructor(R,N,q){super(R,N,q,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=v.m.Zero(),this._tmpTargetVector=v.m.Zero(),this.cameraDirection=new v.m(0,0,0),this.cameraRotation=new v.j(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new v.e,this.rotation=new v.m(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=v.m.Zero(),this._initialFocalDistance=1,this._viewMatrix=v.c.Zero(),this._camMatrix=v.c.Zero(),this._cameraTransformMatrix=v.c.Zero(),this._cameraRotationMatrix=v.c.Zero(),this._referencePoint=new v.m(0,0,1),this._transformedReferencePoint=v.m.Zero(),this._deferredPositionUpdate=new v.m,this._deferredRotationQuaternionUpdate=new v.e,this._deferredRotationUpdate=new v.m,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=v.m.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(R){this.getWorldMatrix();const N=this.getTarget().Vc(this.position);return N.normalize(),N.scaleInPlace(R),this.globalPosition.add(N)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const R=this.lockedTarget;R.je().getTranslationToRef(R.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Rd(0,0,0),this.cameraRotation.Rd(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new v.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new v.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new v.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(R){R||super._updateCache();const N=this._getLockedTargetPosition();N?this._cache.lockedTarget?this._cache.lockedTarget.p(N):this._cache.lockedTarget=N.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const R=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(R):!R)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const R=this.getEngine();return this.speed*Math.sqrt(R.getDeltaTime()/(100*R.getFps()))}setTarget(R){this.upVector.normalize(),this._initialFocalDistance=R.Vc(this.position).length(),this.position.z===R.z&&(this.position.z+=G.b),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),v.c.LookAtLHToRef(this.position,R,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const N=R.Vc(this.position);N.x>=0?this.rotation.y=-Math.atan(N.z/N.x)+Math.PI/2:this.rotation.y=-Math.atan(N.z/N.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&v.e.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(R){this.setTarget(R)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(v.f.Matrix[0]),v.m.TransformNormalToRef(this.cameraDirection,v.f.Matrix[0],v.f.Od[0]),this._deferredPositionUpdate.addInPlace(v.f.Od[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const R=this.invertRotation?-this.inverseRotationSpeed:1,N=this._decideIfNeedsToMove(),q=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),N&&this._updatePosition(),q){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*R,this._deferredRotationUpdate.y+=this.cameraRotation.y*R,!this.noRotationConstraint){const R=1.570796;this._deferredRotationUpdate.x>R&&(this._deferredRotationUpdate.x=R),this._deferredRotationUpdate.x<-R&&(this._deferredRotationUpdate.x=-R)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(v.e.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}N&&(Math.abs(this.cameraDirection.x)<this.speed*G.b&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*G.b&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*G.b&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),q&&(Math.abs(this.cameraRotation.x)<this.speed*G.b&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*G.b&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):v.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return v.m.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),v.m.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?J.d.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(v.e.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),J.d.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(R,N,q){if(this.ignoreParentScaling){if(this.parent){const w=this.parent.getWorldMatrix();v.m.TransformCoordinatesToRef(R,w,this._globalPosition),v.m.TransformCoordinatesToRef(N,w,this._tmpTargetVector),v.m.TransformNormalToRef(q,w,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(R),this._tmpTargetVector.p(N),this._tmpUpVector.p(q);this.va().useRightHandedSystem?v.c.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):v.c.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?v.c.LookAtRHToRef(R,N,q,this._viewMatrix):v.c.LookAtLHToRef(R,N,q,this._viewMatrix),this.parent){const R=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(R,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(R)}createRigCamera(R,N){if(this.cameraRigMode!==M.e.RIG_MODE_NONE){const N=new y(R,this.position.clone(),this.va());return N.isRigCamera=!0,N.rigParent=this,this.cameraRigMode===M.e.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new v.e),N._cameraRigParams={},N.rotationQuaternion=new v.e),N.mode=this.mode,N.orthoLeft=this.orthoLeft,N.orthoRight=this.orthoRight,N.orthoTop=this.orthoTop,N.orthoBottom=this.orthoBottom,N}return null}_updateRigCameras(){const R=this._rigCameras[0],N=this._rigCameras[1];switch(this.je(),this.cameraRigMode){case M.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case M.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case M.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case M.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case M.e.RIG_MODE_STEREOSCOPIC_INTERLACED:{const q=this.cameraRigMode===M.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,w=this.cameraRigMode===M.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*q,R),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*w,N);break}case M.e.RIG_MODE_VR:R.rotationQuaternion?(R.rotationQuaternion.p(this.rotationQuaternion),N.rotationQuaternion.p(this.rotationQuaternion)):(R.rotation.p(this.rotation),N.rotation.p(this.rotation)),R.position.p(this.position),N.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(R,N){this.getTarget().subtractToRef(this.position,y._TargetFocalPoint),y._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const q=y._TargetFocalPoint.addInPlace(this.position);v.c.TranslationToRef(-q.x,-q.y,-q.z,y._TargetTransformMatrix),y._TargetTransformMatrix.multiplyToRef(v.c.RotationAxis(N.upVector,R),y._RigCamTransformMatrix),v.c.TranslationToRef(q.x,q.y,q.z,y._TargetTransformMatrix),y._RigCamTransformMatrix.multiplyToRef(y._TargetTransformMatrix,y._RigCamTransformMatrix),v.m.TransformCoordinatesToRef(this.position,y._RigCamTransformMatrix,N.position),N.setTarget(q)}getClassName(){return"TargetCamera"}}y._RigCamTransformMatrix=new v.c,y._TargetTransformMatrix=new v.c,y._TargetFocalPoint=new v.m,(0,w.b)([(0,u.C)()],y.prototype,"rotation",void 0),(0,w.b)([(0,u.E)()],y.prototype,"speed",void 0),(0,w.b)([(0,u.u)("lockedTargetId")],y.prototype,"lockedTarget",void 0)},12408:(R,N,q)=>{"use strict";q.d(N,{d:()=>M});var w=q(1171),u=q(12411);class M{constructor(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=q,this.Bi=[],this._maxBlockCapacity=N||64,this._selectionContent=new w.e(1024),this._creationFunc=R}update(R,N,q){u.d._CreateBlocks(R,N,q,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}We(R){for(let N=0;N<this.Uh.length;N++){this.Uh[N].addEntry(R)}}Xe(R){for(let N=0;N<this.Uh.length;N++){this.Uh[N].removeEntry(R)}}select(R,N){this._selectionContent.reset();for(let q=0;q<this.Uh.length;q++){this.Uh[q].select(R,this._selectionContent,N)}return N?this._selectionContent.concat(this.Bi):this._selectionContent.concatWithNoDuplicate(this.Bi),this._selectionContent}intersects(R,N,q){this._selectionContent.reset();for(let w=0;w<this.Uh.length;w++){this.Uh[w].intersects(R,N,this._selectionContent,q)}return q?this._selectionContent.concat(this.Bi):this._selectionContent.concatWithNoDuplicate(this.Bi),this._selectionContent}intersectsRay(R){this._selectionContent.reset();for(let N=0;N<this.Uh.length;N++){this.Uh[N].intersectsRay(R,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Bi),this._selectionContent}}M.CreationFuncForMeshes=(R,N)=>{const q=R.getBoundingInfo();!R.isBlocked&&q.boundingBox.intersectsMinMax(N.Fi,N.Gi)&&N.entries.push(R)},M.CreationFuncForSubMeshes=(R,N)=>{R.getBoundingInfo().boundingBox.intersectsMinMax(N.Fi,N.Gi)&&N.entries.push(R)}},12411:(R,N,q)=>{"use strict";q.d(N,{d:()=>M});var w=q(966),u=q(1331);class M{constructor(R,N,q,w,u,M){this.entries=[],this.Hi=new Array,this._capacity=q,this._depth=w,this._maxDepth=u,this._creationFunc=M,this._minPoint=R,this._maxPoint=N,this.Hi.push(R.clone()),this.Hi.push(N.clone()),this.Hi.push(R.clone()),this.Hi[2].x=N.x,this.Hi.push(R.clone()),this.Hi[3].y=N.y,this.Hi.push(R.clone()),this.Hi[4].z=N.z,this.Hi.push(N.clone()),this.Hi[5].z=R.z,this.Hi.push(N.clone()),this.Hi[6].x=R.x,this.Hi.push(N.clone()),this.Hi[7].y=R.y}get Kd(){return this._capacity}get Fi(){return this._minPoint}get Gi(){return this._maxPoint}addEntry(R){if(this.Uh)for(let N=0;N<this.Uh.length;N++){this.Uh[N].addEntry(R)}else this._creationFunc(R,this),this.entries.length>this.Kd&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(R){if(this.Uh){for(let N=0;N<this.Uh.length;N++){this.Uh[N].removeEntry(R)}return}const N=this.entries.indexOf(R);N>-1&&this.entries.splice(N,1)}addEntries(R){for(let N=0;N<R.length;N++){const q=R[N];this.addEntry(q)}}select(R,N,q){if(u.e.IsInFrustum(this.Hi,R)){if(this.Uh){for(let w=0;w<this.Uh.length;w++){this.Uh[w].select(R,N,q)}return}q?N.concat(this.entries):N.concatWithNoDuplicate(this.entries)}}intersects(R,N,q,w){if(u.e.IntersectsSphere(this._minPoint,this._maxPoint,R,N)){if(this.Uh){for(let u=0;u<this.Uh.length;u++){this.Uh[u].intersects(R,N,q,w)}return}w?q.concat(this.entries):q.concatWithNoDuplicate(this.entries)}}intersectsRay(R,N){if(R.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.Uh){for(let q=0;q<this.Uh.length;q++){this.Uh[q].intersectsRay(R,N)}return}N.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){M._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(R,N,q,u,v,G,J,y){J.Uh=new Array;const a=new w.m((N.x-R.x)/2,(N.y-R.y)/2,(N.z-R.z)/2);for(let w=0;w<2;w++)for(let N=0;N<2;N++)for(let j=0;j<2;j++){const F=R.add(a.multiplyByFloats(w,N,j)),S=R.add(a.multiplyByFloats(w+1,N+1,j+1)),H=new M(F,S,u,v+1,G,y);H.addEntries(q),J.Uh.push(H)}}}},12418:(R,N,q)=>{"use strict";q.d(N,{b:()=>a});var w=q(1174),u=q(966),M=q(11412),v=q(11559),G=q(1255),J=q(12408),y=q(997);w.e.prototype.createOrUpdateSelectionOctree=function(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,q=this._getComponent(G.b.NAME_OCTREE);q||(q=new a(this),this.Te(q)),this.zi||(this.zi=new J.d(J.d.CreationFuncForMeshes,R,N));const w=this.getWorldExtends();return this.zi.update(w.min,w.max,this.meshes),this.zi},Object.defineProperty(w.e.prototype,"selectionOctree",{get:function(){return this.zi},enumerable:!0,configurable:!0}),M.e.prototype.createOrUpdateSubmeshesOctree=function(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const q=this.va();let w=q._getComponent(G.b.NAME_OCTREE);w||(w=new a(q),q.Te(w)),this._submeshesOctree||(this._submeshesOctree=new J.d(J.d.CreationFuncForSubMeshes,R,N)),this.je(!0);const u=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(u.minimumWorld,u.maximumWorld,this.ae),this._submeshesOctree};class a{constructor(R){this.name=G.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new v.b(u.m.Zero(),new u.m(1,1,1)),(R=R||y.e.LastCreatedScene)&&(this.Ke=R,this.Ke.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Ke.getActiveSubMeshCandidates=R=>this.getActiveSubMeshCandidates(R),this.Ke.getCollidingSubMeshCandidates=(R,N)=>this.getCollidingSubMeshCandidates(R,N),this.Ke.getIntersectingSubMeshCandidates=(R,N)=>this.getIntersectingSubMeshCandidates(R,N))}register(){this.Ke.onMeshRemovedObservable.add((R=>{const N=this.Ke.selectionOctree;if(void 0!==N&&null!==N){const q=N.Bi.indexOf(R);-1!==q&&N.Bi.splice(q,1)}})),this.Ke.onMeshImportedObservable.add((R=>{const N=this.Ke.selectionOctree;void 0!==N&&null!==N&&N.We(R)}))}getActiveMeshCandidates(){var R;return(null===(R=this.Ke.zi)||void 0===R?void 0:R.select(this.Ke.frustumPlanes))||this.Ke._getDefaultMeshCandidates()}getActiveSubMeshCandidates(R){if(R._submeshesOctree&&R.useOctreeForRenderingSelection){return R._submeshesOctree.select(this.Ke.frustumPlanes)}return this.Ke._getDefaultSubMeshCandidates(R)}getIntersectingSubMeshCandidates(R,N){if(R._submeshesOctree&&R.useOctreeForPicking){v.b.TransformToRef(N,R.getWorldMatrix(),this._tempRay);return R._submeshesOctree.intersectsRay(this._tempRay)}return this.Ke._getDefaultSubMeshCandidates(R)}getCollidingSubMeshCandidates(R,N){if(R._submeshesOctree&&R.useOctreeForCollisions){const q=N._velocityWorldLength+Math.max(N._radius.x,N._radius.y,N._radius.z);return R._submeshesOctree.intersects(N._basePointWorld,q)}return this.Ke._getDefaultSubMeshCandidates(R)}rebuild(){}dispose(){}}},11559:(R,N,q)=>{"use strict";q.d(N,{b:()=>S});var w=q(1174),u=q(11396),M=q(974),v=q(966),G=q(978),J=q(1320),y=q(1220),a=q(997),j=q(1272);const F={internalPickerForMesh:void 0};class S{constructor(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:M.b;this.origin=R,this.direction=N,this.length=q,this.epsilon=w}clone(){return new S(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const w=S._TmpVector3[0].Rd(R.x-q,R.y-q,R.z-q),u=S._TmpVector3[1].Rd(N.x+q,N.y+q,N.z+q);let M,v,G,J,y=0,a=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<w.x||this.origin.x>u.x)return!1}else if(M=1/this.direction.x,v=(w.x-this.origin.x)*M,G=(u.x-this.origin.x)*M,G===-1/0&&(G=1/0),v>G&&(J=v,v=G,G=J),y=Math.max(v,y),a=Math.min(G,a),y>a)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<w.y||this.origin.y>u.y)return!1}else if(M=1/this.direction.y,v=(w.y-this.origin.y)*M,G=(u.y-this.origin.y)*M,G===-1/0&&(G=1/0),v>G&&(J=v,v=G,G=J),y=Math.max(v,y),a=Math.min(G,a),y>a)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<w.z||this.origin.z>u.z)return!1}else if(M=1/this.direction.z,v=(w.z-this.origin.z)*M,G=(u.z-this.origin.z)*M,G===-1/0&&(G=1/0),v>G&&(J=v,v=G,G=J),y=Math.max(v,y),a=Math.min(G,a),y>a)return!1;return!0}intersectsBox(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(R.minimum,R.maximum,N)}intersectsSphere(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const q=R.center.x-this.origin.x,w=R.center.y-this.origin.y,u=R.center.z-this.origin.z,M=q*q+w*w+u*u,v=R.i+N,G=v*v;if(M<=G)return!0;const J=q*this.direction.x+w*this.direction.y+u*this.direction.z;if(J<0)return!1;return M-J*J<=G}intersectsTriangle(R,N,q){const w=S._TmpVector3[0],u=S._TmpVector3[1],M=S._TmpVector3[2],G=S._TmpVector3[3],y=S._TmpVector3[4];N.subtractToRef(R,w),q.subtractToRef(R,u),v.m.CrossToRef(this.direction,u,M);const a=v.m.Dot(w,M);if(0===a)return null;const j=1/a;this.origin.subtractToRef(R,G);const F=v.m.Dot(G,M)*j;if(F<-this.epsilon||F>1+this.epsilon)return null;v.m.CrossToRef(G,w,y);const H=v.m.Dot(this.direction,y)*j;if(H<-this.epsilon||F+H>1+this.epsilon)return null;const W=v.m.Dot(u,y)*j;return W>this.length?null:new J.d(1-F-H,F,W)}intersectsPlane(R){let N;const q=v.m.Dot(R.ke,this.direction);if(Math.abs(q)<9.99999997475243e-7)return null;{const w=v.m.Dot(R.ke,this.origin);return N=(-R.d-w)/q,N<0?N<-9.99999997475243e-7?null:0:N}}intersectsAxis(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(R){case"y":{const R=(this.origin.y-N)/this.direction.y;return R>0?null:new v.m(this.origin.x+this.direction.x*-R,N,this.origin.z+this.direction.z*-R)}case"x":{const R=(this.origin.x-N)/this.direction.x;return R>0?null:new v.m(N,this.origin.y+this.direction.y*-R,this.origin.z+this.direction.z*-R)}case"z":{const R=(this.origin.z-N)/this.direction.z;return R>0?null:new v.m(this.origin.x+this.direction.x*-R,this.origin.y+this.direction.y*-R,N)}default:return null}}intersectsMesh(R,N,q){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4?arguments[4]:void 0,M=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const G=v.f.Matrix[0];return R.getWorldMatrix().invertToRef(G),this._tmpRay?S.TransformToRef(this,G,this._tmpRay):this._tmpRay=S.Transform(this,G),R.intersects(this._tmpRay,N,q,w,u,M)}intersectsMeshes(R,N,q){q?q.length=0:q=[];for(let w=0;w<R.length;w++){const u=this.intersectsMesh(R[w],N);u.hit&&q.push(u)}return q.sort(this._comparePickingInfo),q}_comparePickingInfo(R,N){return R.distance<N.distance?-1:R.distance>N.distance?1:0}intersectionSegment(R,N,q){const w=this.origin,u=v.f.Od[0],M=v.f.Od[1],G=v.f.Od[2],J=v.f.Od[3];N.subtractToRef(R,u),this.direction.scaleToRef(S._Rayl,G),w.addToRef(G,M),R.subtractToRef(w,J);const y=v.m.Dot(u,u),a=v.m.Dot(u,G),j=v.m.Dot(G,G),F=v.m.Dot(u,J),H=v.m.Dot(G,J),W=y*j-a*a;let k,C,e=W,K=W;W<S._Smallnum?(k=0,e=1,C=H,K=j):(k=a*H-j*F,C=y*H-a*F,k<0?(k=0,C=H,K=j):k>e&&(k=e,C=H+a,K=j)),C<0?(C=0,-F<0?k=0:-F>y?k=e:(k=-F,e=y)):C>K&&(C=K,-F+a<0?k=0:-F+a>y?k=e:(k=-F+a,e=y));const r=Math.abs(k)<S._Smallnum?0:k/e,Z=Math.abs(C)<S._Smallnum?0:C/K,z=v.f.Od[4];G.scaleToRef(Z,z);const d=v.f.Od[5];u.scaleToRef(r,d),d.addInPlace(J);const x=v.f.Od[6];d.subtractToRef(z,x);return Z>0&&Z<=this.length&&x.lengthSquared()<q*q?d.length():-1}update(R,N,q,w,u,M,G){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){S._RayDistant||(S._RayDistant=S.Zero()),S._RayDistant.unprojectRayToRef(R,N,q,w,v.c.IdentityReadOnly,M,G);const J=v.f.Matrix[0];u.invertToRef(J),S.TransformToRef(S._RayDistant,J,this)}else this.unprojectRayToRef(R,N,q,w,u,M,G);return this}static Zero(){return new S(v.m.Zero(),v.m.Zero())}static CreateNew(R,N,q,w,u,M,v){return S.Zero().update(R,N,q,w,u,M,v)}static CreateNewFromTo(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.c.IdentityReadOnly;const w=new S(new v.m(0,0,0),new v.m(0,0,0));return S.CreateFromToToRef(R,N,w,q)}static CreateFromToToRef(R,N,q){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v.c.IdentityReadOnly;q.origin.p(R);const u=N.subtractToRef(R,q.direction),M=Math.sqrt(u.x*u.x+u.y*u.y+u.z*u.z);return q.length=M,q.direction.normalize(),S.TransformToRef(q,w,q)}static Transform(R,N){const q=new S(new v.m(0,0,0),new v.m(0,0,0));return S.TransformToRef(R,N,q),q}static TransformToRef(R,N,q){v.m.TransformCoordinatesToRef(R.origin,N,q.origin),v.m.TransformNormalToRef(R.direction,N,q.direction),q.length=R.length,q.epsilon=R.epsilon;const w=q.direction,u=w.length();if(0!==u&&1!==u){const R=1/u;w.x*=R,w.y*=R,w.z*=R,q.length*=u}return q}unprojectRayToRef(R,N,q,w,u,M,G){const J=v.f.Matrix[0];u.multiplyToRef(M,J),J.multiplyToRef(G,J),J.invert();const y=a.e.LastCreatedEngine,j=v.f.Od[0];j.x=R/q*2-1,j.y=-(N/w*2-1),j.z=null!==y&&void 0!==y&&y.useReverseDepthBuffer?1:null!==y&&void 0!==y&&y.isNDCHalfZRange?0:-1;const F=v.f.Od[1].Rd(j.x,j.y,1-1e-8),S=v.f.Od[2],H=v.f.Od[3];v.m._UnprojectFromInvertedMatrixToRef(j,J,S),v.m._UnprojectFromInvertedMatrixToRef(F,J,H),this.origin.p(S),H.subtractToRef(S,this.direction),this.direction.normalize()}}function H(R,N,q,w,u){let M=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const v=S.Zero();return W(R,N,q,w,v,u,M),v}function W(R,N,q,w,u,M){let G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const y=R.getEngine();if(!M&&!(M=R.activeCamera))return R;const a=M.viewport,j=y.getRenderHeight(),{x:F,y:S,width:H,height:W}=a.toGlobal(y.getRenderWidth(),j),k=1/y.getHardwareScalingLevel();return N=N*k-F,q=q*k-(j-S-W),u.update(N,q,H,W,w||v.c.IdentityReadOnly,G?v.c.IdentityReadOnly:M.getViewMatrix(),M.getProjectionMatrix(),J),R}function k(R,N,q,w,u){if(!y.b)return R;const M=R.getEngine();if(!u&&!(u=R.activeCamera))throw new Error("Active camera not set");const G=u.viewport,J=M.getRenderHeight(),{x:a,y:j,width:F,height:S}=G.toGlobal(M.getRenderWidth(),J),H=v.c.Identity(),W=1/M.getHardwareScalingLevel();return N=N*W-a,q=q*W-(J-j-S),w.update(N,q,F,S,H,H,u.getProjectionMatrix()),R}function C(R,N,q,w,u,M,v,G){const J=N(w,q.enableDistantPicking),y=q.intersects(J,u,v,M,w,G);return y&&y.hit?!u&&null!=R&&y.distance>=R.distance?null:y:null}function e(R,N,q,w,u,M){let G=null;const J=!!(R.activeCameras&&R.activeCameras.length>1&&R.cameraToUseForPointers!==R.activeCamera),a=R.cameraToUseForPointers||R.activeCamera,j=F.internalPickerForMesh||C;for(let y=0;y<R.meshes.length;y++){const F=R.meshes[y];if(q){if(!q(F,-1))continue}else if(!F.isEnabled()||!F.isVisible||!F.Me)continue;const S=J&&F.isWorldMatrixCameraDependent(),H=F.je(S,a);if(F.hasThinInstances&&F.thinInstanceEnablePicking){const R=j(G,N,F,H,!0,!0,M);if(R){if(u)return R;const J=v.f.Matrix[1],y=F.thinInstanceGetWorldMatrices();for(let R=0;R<y.length;R++){if(q&&!q(F,R))continue;y[R].multiplyToRef(H,J);const v=j(G,N,F,J,w,u,M,!0);if(v&&(G=v,G.thinInstanceIndex=R,w))return G}}}else{const R=j(G,N,F,H,w,u,M);if(R&&(G=R,w))return G}}return G||new y.b}function K(R,N,q,w){if(!y.b)return null;const u=[],M=!!(R.activeCameras&&R.activeCameras.length>1&&R.cameraToUseForPointers!==R.activeCamera),G=R.cameraToUseForPointers||R.activeCamera,J=F.internalPickerForMesh||C;for(let y=0;y<R.meshes.length;y++){const a=R.meshes[y];if(q){if(!q(a,-1))continue}else if(!a.isEnabled()||!a.isVisible||!a.Me)continue;const j=M&&a.isWorldMatrixCameraDependent(),F=a.je(j,G);if(a.hasThinInstances&&a.thinInstanceEnablePicking){if(J(null,N,a,F,!0,!0,w)){const R=v.f.Matrix[1],M=a.thinInstanceGetWorldMatrices();for(let v=0;v<M.length;v++){if(q&&!q(a,v))continue;M[v].multiplyToRef(F,R);const G=J(null,N,a,R,!1,!1,w,!0);G&&(G.thinInstanceIndex=v,u.push(G))}}}else{const R=J(null,N,a,F,!1,!1,w);R&&u.push(R)}}return u}function r(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,w=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0;w||(w=R.getWorldMatrix()),N.length=q,u?N.origin.p(u):N.origin.p(R.position);const M=v.f.Od[2];M.set(0,0,R._scene.useRightHandedSystem?-1:1);const G=v.f.Od[3];return v.m.TransformNormalToRef(M,w,G),v.m.NormalizeToRef(G,N.direction),N}var Z,z;S._TmpVector3=(0,G.c)(6,v.m.Zero),S._RayDistant=S.Zero(),S._Smallnum=1e-8,S._Rayl=1e9,Z=w.e,(z=u.e)&&(z.prototype.getForwardRay=function(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,N=arguments.length>1?arguments[1]:void 0,q=arguments.length>2?arguments[2]:void 0;return r(this,new S(v.m.Zero(),v.m.Zero(),R),R,N,q)},z.prototype.getForwardRayToRef=function(R){return r(this,R,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),Z&&(j.e._IsPickingAvailable=!0,Z.prototype.createPickingRay=function(R,N,q,w){return H(this,R,N,q,w,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),w.e.prototype.createPickingRayToRef=function(R,N,q,w,u){return W(this,R,N,q,w,u,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},w.e.prototype.createPickingRayInCameraSpace=function(R,N,q){return function(R,N,q,w){const u=S.Zero();return k(R,N,q,u,w),u}(this,R,N,q)},w.e.prototype.createPickingRayInCameraSpaceToRef=function(R,N,q,w){return k(this,R,N,q,w)},w.e.prototype.pickWithBoundingInfo=function(R,N,q,w,u){return function(R,N,q,w,u,M){if(!y.b)return null;const G=e(R,(w=>(R._tempPickingRay||(R._tempPickingRay=S.Zero()),W(R,N,q,w,R._tempPickingRay,M||null),R._tempPickingRay)),w,u,!0);return G&&(G.ray=H(R,N,q,v.c.Identity(),M||null)),G}(this,R,N,q,w,u)},w.e.prototype.Uc=function(R,N,q,w,u,M){return function(R,N,q,w,u,M,G){const J=e(R,((w,u)=>(R._tempPickingRay||(R._tempPickingRay=S.Zero()),W(R,N,q,w,R._tempPickingRay,M||null,!1,u),R._tempPickingRay)),w,u,!1,G);return J&&(J.ray=H(R,N,q,v.c.Identity(),M||null)),J}(this,R,N,q,w,u,M)},w.e.prototype.pickWithRay=function(R,N,q,w){return function(R,N,q,w,u){const M=e(R,(q=>(R._pickWithRayInverseMatrix||(R._pickWithRayInverseMatrix=v.c.Identity()),q.invertToRef(R._pickWithRayInverseMatrix),R._cachedRayForTransform||(R._cachedRayForTransform=S.Zero()),S.TransformToRef(N,R._pickWithRayInverseMatrix,R._cachedRayForTransform),R._cachedRayForTransform)),q,w,!1,u);return M&&(M.ray=N),M}(this,R,N,q,w)},w.e.prototype.multiPick=function(R,N,q,w,u){return function(R,N,q,w,u,M){return K(R,(w=>H(R,N,q,w,u||null)),w,M)}(this,R,N,q,w,u)},w.e.prototype.multiPickWithRay=function(R,N,q){return function(R,N,q,w){return K(R,(q=>(R._pickWithRayInverseMatrix||(R._pickWithRayInverseMatrix=v.c.Identity()),q.invertToRef(R._pickWithRayInverseMatrix),R._cachedRayForTransform||(R._cachedRayForTransform=S.Zero()),S.TransformToRef(N,R._pickWithRayInverseMatrix,R._cachedRayForTransform),R._cachedRayForTransform)),q,w)}(this,R,N,q)}},12423:(R,N,q)=>{"use strict";q(1056);var w=q(1409);q(1104),q(1235),q(990),q(1442),q(1415);w.c},11250:(R,N,q)=>{"use strict";q.r(N),q.d(N,{SceneInstrumentation:()=>M});var w=q(1177),u=q(1280);class M{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(R){R!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=R,R?(this._onBeforeActiveMeshesEvaluationObserver=this.Ke.onBeforeActiveMeshesEvaluationObservable.add((()=>{w.i.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Ke.onAfterActiveMeshesEvaluationObservable.add((()=>{w.i.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Ke.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Ke.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(R){R!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=R,R?(this._onBeforeRenderTargetsRenderObserver=this.Ke.onBeforeRenderTargetsRenderObservable.add((()=>{w.i.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Ke.onAfterRenderTargetsRenderObservable.add((()=>{w.i.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Ke.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Ke.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(R){R!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=R,R?(this._onBeforeParticlesRenderingObserver=this.Ke.onBeforeParticlesRenderingObservable.add((()=>{w.i.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Ke.onAfterParticlesRenderingObservable.add((()=>{w.i.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Ke.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Ke.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(R){R!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=R,this.Ke.spriteManagers&&(R?(this._onBeforeSpritesRenderingObserver=this.Ke.onBeforeSpritesRenderingObservable.add((()=>{w.i.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Ke.onAfterSpritesRenderingObservable.add((()=>{w.i.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Ke.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Ke.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(R){R!==this._capturePhysicsTime&&this.Ke.onBeforePhysicsObservable&&(this._capturePhysicsTime=R,R?(this._onBeforePhysicsObserver=this.Ke.onBeforePhysicsObservable.add((()=>{w.i.StartPerformanceCounter("gb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Ke.onAfterPhysicsObservable.add((()=>{w.i.EndPerformanceCounter("gb"),this._physicsTime.endMonitoring()}))):(this.Ke.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Ke.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(R){R!==this._captureAnimationsTime&&(this._captureAnimationsTime=R,R?this._onAfterAnimationsObserver=this.Ke.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Ke.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(R){this._captureFrameTime=R}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(R){this._captureInterFrameTime=R}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(R){R!==this._captureRenderTime&&(this._captureRenderTime=R,R?(this._onBeforeDrawPhaseObserver=this.Ke.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),w.i.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Ke.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),w.i.EndPerformanceCounter("Main render")}))):(this.Ke.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Ke.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(R){R!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=R,R?(this._onBeforeCameraRenderObserver=this.Ke.onBeforeCameraRenderObservable.add((R=>{this._cameraRenderTime.beginMonitoring(),w.i.StartPerformanceCounter(`Rendering camera ${R.name}`)})),this._onAfterCameraRenderObserver=this.Ke.onAfterCameraRenderObservable.add((R=>{this._cameraRenderTime.endMonitoring(!1),w.i.EndPerformanceCounter(`Rendering camera ${R.name}`)}))):(this.Ke.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Ke.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Ke.getEngine()._drawCalls}constructor(R){this.Ke=R,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new u.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new u.b,this._captureFrameTime=!1,this._frameTime=new u.b,this._captureRenderTime=!1,this._renderTime=new u.b,this._captureInterFrameTime=!1,this._interFrameTime=new u.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new u.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new u.b,this._capturePhysicsTime=!1,this._physicsTime=new u.b,this._captureAnimationsTime=!1,this._animationsTime=new u.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new u.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=R.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(w.i.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Ke.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=R.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(w.i.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Yd(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Yd(),this._captureParticlesRenderTime&&this._particlesRenderTime.Yd(),this._captureSpritesRenderTime&&this._spritesRenderTime.Yd(),this._captureRenderTime&&this._renderTime.Yd(),this._captureCameraRenderTime&&this._cameraRenderTime.Yd()}))}dispose(){this.Ke.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Ke.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Ke.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Ke.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Ke.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Ke.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Ke.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Ke.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Ke.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Ke.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Ke.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Ke.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Ke.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Ke.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Ke.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Ke.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Ke.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Ke=null}}},12060:(R,N,q)=>{"use strict";q.d(N,{b:()=>a});var w=q(942),u=q(947),M=q(966),v=q(11398),G=q(12035),J=q(12066),y=q(982);v.d.AddNodeConstructor("Light_Type_1",((R,N)=>()=>new a(R,M.m.Zero(),N)));class a extends J.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(R){this._shadowFrustumSize=R,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(R){this._shadowOrthoScale=R,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(R){this._orthoLeft=R}get orthoRight(){return this._orthoRight}set orthoRight(R){this._orthoRight=R}get orthoTop(){return this._orthoTop}set orthoTop(R){this._orthoTop=R}get orthoBottom(){return this._orthoBottom}set orthoBottom(R){this._orthoBottom=R}constructor(R,N,q){super(R,q),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=N.scale(-1),this.direction=N}getClassName(){return"hb"}getTypeID(){return G.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(R,N,q){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(R):this._setDefaultAutoExtendShadowProjectionMatrix(R,N,q)}_setDefaultFixedFrustumShadowProjectionMatrix(R){const N=this.va().activeCamera;N&&M.c.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:N.dj,void 0!==this.shadowMaxZ?this.shadowMaxZ:N.maxZ,R,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(R,N,q){const w=this.va().activeCamera;if(!w)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const R=M.m.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let w=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(let v=0;v<q.length;v++){const G=q[v];if(!G)continue;const J=G.getBoundingInfo().boundingBox;for(let q=0;q<J.vectorsWorld.length;q++)M.m.TransformCoordinatesToRef(J.vectorsWorld[q],N,R),R.x<this._orthoLeft&&(this._orthoLeft=R.x),R.y<this._orthoBottom&&(this._orthoBottom=R.y),R.x>this._orthoRight&&(this._orthoRight=R.x),R.y>this._orthoTop&&(this._orthoTop=R.y),this.autoCalcShadowZBounds&&(R.z<w&&(w=R.z),R.z>u&&(u=R.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=w,this._shadowMaxZ=u)}const u=this._orthoRight-this._orthoLeft,v=this._orthoTop-this._orthoBottom,G=void 0!==this.shadowMinZ?this.shadowMinZ:w.dj,J=void 0!==this.shadowMaxZ?this.shadowMaxZ:w.maxZ,y=this.va().getEngine().useReverseDepthBuffer;M.c.OrthoOffCenterLHToRef(this._orthoLeft-u*this.shadowOrthoScale,this._orthoRight+u*this.shadowOrthoScale,this._orthoBottom-v*this.shadowOrthoScale,this._orthoTop+v*this.shadowOrthoScale,y?J:G,y?G:J,R,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(R,N){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,N),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,N),this)}transferToNodeMaterialEffect(R,N){return this.computeTransformedInformation()?(R.setFloat3(N,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(R.setFloat3(N,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(R){const N=this._scene.getEngine();return!N.useReverseDepthBuffer&&N.isNDCHalfZRange?0:1}getDepthMaxZ(R){const N=this._scene.getEngine();return N.useReverseDepthBuffer&&N.isNDCHalfZRange?0:1}prepareLightSpecificDefines(R,N){R["DIRLIGHT"+N]=!0}}(0,w.b)([(0,u.E)()],a.prototype,"shadowFrustumSize",null),(0,w.b)([(0,u.E)()],a.prototype,"shadowOrthoScale",null),(0,w.b)([(0,u.E)()],a.prototype,"autoUpdateExtends",void 0),(0,w.b)([(0,u.E)()],a.prototype,"autoCalcShadowZBounds",void 0),(0,w.b)([(0,u.E)("orthoLeft")],a.prototype,"_orthoLeft",void 0),(0,w.b)([(0,u.E)("orthoRight")],a.prototype,"_orthoRight",void 0),(0,w.b)([(0,u.E)("orthoTop")],a.prototype,"_orthoTop",void 0),(0,w.b)([(0,u.E)("orthoBottom")],a.prototype,"_orthoBottom",void 0),(0,y.h)("BABYLON.DirectionalLight",a)},12349:(R,N,q)=>{"use strict";q.d(N,{b:()=>a});var w=q(942),u=q(947),M=q(966),v=q(1133),G=q(11398),J=q(12035),y=q(982);G.d.AddNodeConstructor("Light_Type_3",((R,N)=>()=>new a(R,M.m.Zero(),N)));class a extends J.c{constructor(R,N,q){super(R,q),this.groundColor=new v.c(0,0,0),this.direction=N||M.m.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ib"}setDirectionToTarget(R){return this.direction=M.m.Normalize(R.Vc(M.m.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(R,N){const q=M.m.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",q.x,q.y,q.z,0,N),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.hj),N),this}transferToNodeMaterialEffect(R,N){const q=M.m.Normalize(this.direction);return R.setFloat3(N,q.x,q.y,q.z),this}je(){return this._worldMatrix||(this._worldMatrix=M.c.Identity()),this._worldMatrix}getTypeID(){return J.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(R,N){R["HEMILIGHT"+N]=!0}}(0,w.b)([(0,u.l)()],a.prototype,"groundColor",void 0),(0,w.b)([(0,u.C)()],a.prototype,"direction",void 0),(0,y.h)("BABYLON.HemisphericLight",a)},12035:(R,N,q)=>{"use strict";q.d(N,{c:()=>F});var w=q(942),u=q(947),M=q(966),v=q(1133),G=q(11398),J=q(1215),y=q(982),a=q(1296),j=q(1128);class F extends G.d{get range(){return this._range}set range(R){this._range=R,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(R){this._intensityMode=R,this._computePhotometricScale()}get i(){return this._radius}set i(R){this._radius=R,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(R){this._shadowEnabled!==R&&(this._shadowEnabled=R,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(R){this._includedOnlyMeshes=R,this._hookArrayForIncludedOnly(R)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(R){this._excludedMeshes=R,this._hookArrayForExcluded(R)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(R){this._excludeWithLayerMask=R,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(R){this._includeOnlyWithLayerMask=R,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(R){this._lightmapMode!==R&&(this._lightmapMode=R,this._markMeshesAsLightDirty())}getViewMatrix(R){return null}getProjectionMatrix(R,N){return null}constructor(R,N){super(R,N,!1),this.Rh=new v.c(1,1,1),this.ye=new v.c(1,1,1),this.falloffType=F.FALLOFF_DEFAULT,this.hj=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=F.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new J.d(this.va().getEngine(),void 0,void 0,R),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(R,N){return this}_bindLight(R,N,q,w){let u=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const M=R.toString();let G=!1;if(this._uniformBuffer.bindToEffect(q,"Light"+M),this._renderId!==N.getRenderId()||this._lastUseSpecular!==w||!this._uniformBuffer.useUbo){this._renderId=N.getRenderId(),this._lastUseSpecular=w;const R=this.getScaledIntensity();this.transferToEffect(q,M),this.Rh.scaleToRef(R,v.g.Be[0]),this._uniformBuffer.updateColor4("vLightDiffuse",v.g.Be[0],this.range,M),w&&(this.ye.scaleToRef(R,v.g.Be[1]),this._uniformBuffer.updateColor4("vLightSpecular",v.g.Be[1],this.i,M)),G=!0}if(this.transferTexturesToEffect(q,M),N.shadowsEnabled&&this.shadowEnabled&&u){const R=this.getShadowGenerator(N.activeCamera)??this.getShadowGenerator();R&&(R.bindShadowLight(M,q),G=!0)}G?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(R){let N="Name: "+this.name;if(N+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let q=0;q<this.animations.length;q++)N+=", animation[0]: "+this.animations[q].toString(R);return N}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Jg(R){super.Jg(R),this._resyncMeshes()}getShadowGenerator(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(R)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return M.m.Zero()}canAffectMesh(R){return!R||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(R))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(R))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&R.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&R.layerMask)))}dispose(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const R=this._shadowGenerators.values();for(let N=R.next();!0!==N.done;N=R.next()){N.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const R=this._parentContainer.lights.indexOf(this);R>-1&&this._parentContainer.lights.splice(R,1),this._parentContainer=null}for(const q of this.va().meshes)q._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(R,N)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.hj}clone(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=F.GetConstructorFromName(this.getTypeID(),R,this.va());if(!q)return null;const w=j.e.Clone(q,this);return R&&(w.name=R),N&&(w.parent=N),w.Jg(this.isEnabled()),this.onClonedObservable.notifyObservers(w),w}serialize(){const R=j.e.Serialize(this);return R.uniqueId=this.uniqueId,R.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(R),this.excludedMeshes.length>0&&(R.excludedMeshesIds=[],this.excludedMeshes.forEach((N=>{R.excludedMeshesIds.push(N.id)}))),this.includedOnlyMeshes.length>0&&(R.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((N=>{R.includedOnlyMeshesIds.push(N.id)}))),j.e.AppendSerializedAnimations(this,R),R.ranges=this.serializeAnimationRanges(),R.isEnabled=this.isEnabled(),R}static GetConstructorFromName(R,N,q){const w=G.d.Construct("Light_Type_"+R,N,q);return w||null}static Parse(R,N){const q=F.GetConstructorFromName(R.type,R.name,N);if(!q)return null;const w=j.e.Parse(q,R,N);if(R.excludedMeshesIds&&(w._excludedMeshesIds=R.excludedMeshesIds),R.includedOnlyMeshesIds&&(w._includedOnlyMeshesIds=R.includedOnlyMeshesIds),void 0!==R.parentId&&(w._waitingParentId=R.parentId),void 0!==R.parentInstanceIndex&&(w._waitingParentInstanceIndex=R.parentInstanceIndex),void 0!==R.falloffType&&(w.falloffType=R.falloffType),void 0!==R.lightmapMode&&(w.lightmapMode=R.lightmapMode),R.animations){for(let N=0;N<R.animations.length;N++){const q=R.animations[N],u=(0,y.e)("BABYLON.Animation");u&&w.animations.push(u.Parse(q))}G.d.ParseAnimationRanges(w,R,N)}return R.autoAnimate&&N.beginAnimation(w,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1),void 0!==R.isEnabled&&w.Jg(R.isEnabled),w}_hookArrayForExcluded(R){var N=this;const q=R.push;R.push=function(){for(var w=arguments.length,u=new Array(w),M=0;M<w;M++)u[M]=arguments[M];const v=q.apply(R,u);for(const R of u)R._resyncLightSource(N);return v};const w=R.splice;R.splice=(N,q)=>{const u=w.apply(R,[N,q]);for(const R of u)R._resyncLightSource(this);return u};for(const u of R)u._resyncLightSource(this)}_hookArrayForIncludedOnly(R){var N=this;const q=R.push;R.push=function(){for(var w=arguments.length,u=new Array(w),M=0;M<w;M++)u[M]=arguments[M];const v=q.apply(R,u);return N._resyncMeshes(),v};const w=R.splice;R.splice=(N,q)=>{const u=w.apply(R,[N,q]);return this._resyncMeshes(),u},this._resyncMeshes()}_resyncMeshes(){for(const R of this.va().meshes)R._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const R of this.va().meshes)-1!==R.lightSources.indexOf(this)&&R._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let R=0;const N=this.getTypeID();let q=this.intensityMode;switch(q===F.INTENSITYMODE_AUTOMATIC&&(q=N===F.LIGHTTYPEID_DIRECTIONALLIGHT?F.INTENSITYMODE_ILLUMINANCE:F.INTENSITYMODE_LUMINOUSINTENSITY),N){case F.LIGHTTYPEID_POINTLIGHT:case F.LIGHTTYPEID_SPOTLIGHT:switch(q){case F.INTENSITYMODE_LUMINOUSPOWER:R=1/(4*Math.PI);break;case F.INTENSITYMODE_LUMINOUSINTENSITY:R=1;break;case F.INTENSITYMODE_LUMINANCE:R=this.i*this.i}break;case F.LIGHTTYPEID_DIRECTIONALLIGHT:switch(q){case F.INTENSITYMODE_ILLUMINANCE:R=1;break;case F.INTENSITYMODE_LUMINANCE:{let N=this.i;N=Math.max(N,.001);R=2*Math.PI*(1-Math.cos(N));break}}break;case F.LIGHTTYPEID_HEMISPHERICLIGHT:R=1}return R}_reorderLightsInScene(){const R=this.va();0!=this._renderPriority&&(R.requireLightSorting=!0),this.va().sortLightsByPriority()}}F.FALLOFF_DEFAULT=a.c.FALLOFF_DEFAULT,F.FALLOFF_PHYSICAL=a.c.FALLOFF_PHYSICAL,F.FALLOFF_GLTF=a.c.FALLOFF_GLTF,F.FALLOFF_STANDARD=a.c.FALLOFF_STANDARD,F.LIGHTMAP_DEFAULT=a.c.LIGHTMAP_DEFAULT,F.LIGHTMAP_SPECULAR=a.c.LIGHTMAP_SPECULAR,F.LIGHTMAP_SHADOWSONLY=a.c.LIGHTMAP_SHADOWSONLY,F.INTENSITYMODE_AUTOMATIC=a.c.INTENSITYMODE_AUTOMATIC,F.INTENSITYMODE_LUMINOUSPOWER=a.c.INTENSITYMODE_LUMINOUSPOWER,F.INTENSITYMODE_LUMINOUSINTENSITY=a.c.INTENSITYMODE_LUMINOUSINTENSITY,F.INTENSITYMODE_ILLUMINANCE=a.c.INTENSITYMODE_ILLUMINANCE,F.INTENSITYMODE_LUMINANCE=a.c.INTENSITYMODE_LUMINANCE,F.LIGHTTYPEID_POINTLIGHT=a.c.LIGHTTYPEID_POINTLIGHT,F.LIGHTTYPEID_DIRECTIONALLIGHT=a.c.LIGHTTYPEID_DIRECTIONALLIGHT,F.LIGHTTYPEID_SPOTLIGHT=a.c.LIGHTTYPEID_SPOTLIGHT,F.LIGHTTYPEID_HEMISPHERICLIGHT=a.c.LIGHTTYPEID_HEMISPHERICLIGHT,(0,w.b)([(0,u.l)()],F.prototype,"diffuse",void 0),(0,w.b)([(0,u.l)()],F.prototype,"specular",void 0),(0,w.b)([(0,u.E)()],F.prototype,"falloffType",void 0),(0,w.b)([(0,u.E)()],F.prototype,"intensity",void 0),(0,w.b)([(0,u.E)()],F.prototype,"range",null),(0,w.b)([(0,u.E)()],F.prototype,"intensityMode",null),(0,w.b)([(0,u.E)()],F.prototype,"i",null),(0,w.b)([(0,u.E)()],F.prototype,"_renderPriority",void 0),(0,w.b)([(0,u.c)("_reorderLightsInScene")],F.prototype,"renderPriority",void 0),(0,w.b)([(0,u.E)("shadowEnabled")],F.prototype,"_shadowEnabled",void 0),(0,w.b)([(0,u.E)("excludeWithLayerMask")],F.prototype,"_excludeWithLayerMask",void 0),(0,w.b)([(0,u.E)("includeOnlyWithLayerMask")],F.prototype,"_includeOnlyWithLayerMask",void 0),(0,w.b)([(0,u.E)("lightmapMode")],F.prototype,"_lightmapMode",void 0)},12066:(R,N,q)=>{"use strict";q.d(N,{d:()=>J});var w=q(942),u=q(947),M=q(966),v=q(12035),G=q(1460);class J extends v.c{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=M.c.Identity(),this._projectionMatrix=M.c.Identity()}_setPosition(R){this._position=R}get position(){return this._position}set position(R){this._setPosition(R)}_setDirection(R){this._direction=R}get direction(){return this._direction}set direction(R){this._setDirection(R)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(R){this._shadowMinZ=R,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(R){this._shadowMaxZ=R,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=M.m.Zero()),M.m.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=M.m.Zero()),M.m.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(R){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(R){return this.direction=M.m.Normalize(R.Vc(this.position)),this.direction}getRotation(){this.direction.normalize();const R=M.m.Cross(this.direction,G.d.Y),N=M.m.Cross(R,this.direction);return M.m.RotationFromAxis(R,N,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=M.m.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}je(R){return!R&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=M.c.Identity()),M.c.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(R){return void 0!==this.shadowMinZ?this.shadowMinZ:R.dj}getDepthMaxZ(R){return void 0!==this.shadowMaxZ?this.shadowMaxZ:R.maxZ}setShadowProjectionMatrix(R,N,q){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(N,q,R):this._setDefaultShadowProjectionMatrix(R,N,q),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(R){const N=M.f.Od[0];let q=this.position;this.computeTransformedInformation()&&(q=this.transformedPosition),M.m.NormalizeToRef(this.getShadowDirection(R),N),1===Math.abs(M.m.Dot(N,M.m.Up()))&&(N.z=1e-13);const w=M.f.Od[1];return q.addToRef(N,w),M.c.LookAtLHToRef(q,w,M.m.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(R,N){return this.setShadowProjectionMatrix(this._projectionMatrix,R??this._viewMatrix,N??[]),this._projectionMatrix}}(0,w.b)([(0,u.C)()],J.prototype,"position",null),(0,w.b)([(0,u.C)()],J.prototype,"direction",null),(0,w.b)([(0,u.E)()],J.prototype,"shadowMinZ",null),(0,w.b)([(0,u.E)()],J.prototype,"shadowMaxZ",null)},11549:(R,N,q)=>{"use strict";q.d(N,{e:()=>v,g:()=>M,j:()=>G});const w={},u={};function M(R,N){w[R]=N}function v(R,N){u[R]=N}function G(R){return u[R]?u[R]:null}},11487:(R,N,q)=>{"use strict";q.d(N,{d:()=>A,g:()=>z});var w,u=q(1177),M=q(959),v=q(1174),G=q(997),J=q(1056),y=q(11410),a=q(1015),j=q(1026),F=q(1013),S=q(1070);!function(R){R[R.Clean=0]="Clean",R[R.Stop=1]="Stop",R[R.Sync=2]="Sync",R[R.NoSync=3]="NoSync"}(w||(w={}));const H=new M.c,W={};let k=!1;function C(){return W[".babylon"]}function e(R){const N=W[R];return N||(J.e.Warn("Unable to find a plugin to load "+R+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),C())}function K(R,N,q){let w="Unable to load from "+(R.rawData?"binary data":R.url);return N?w+=`: ${N}`:q&&(w+=`: ${q}`),w}function r(R,N,q,w,u,M,v,G,J){var y;const j="data:"===(F=R.url).substring(0,5)?F.substring(5):null;var F;if(R.rawData&&!v)throw"When using ArrayBufferView to load data the file extension must be provided.";const k=v?e(v):j?function(R){for(const N in W){const q=W[N].plugin;if(q.canDirectLoad&&q.canDirectLoad(R))return W[N]}return C()}(R.url):function(R){const N=R.indexOf("?");-1!==N&&(R=R.substring(0,N));const q=R.lastIndexOf(".");return e(R.substring(q,R.length).toLowerCase())}(R.url);if(!k)throw new Error(`No plugin or fallback for ${v??R.url}`);if(!1===(null===J||void 0===J||null===(y=J[k.plugin.name])||void 0===y?void 0:y.enabled))throw new Error(`The '${k.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(R.rawData&&!k.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(R=>{if(k.plugin.createPlugin){const N=k.plugin.createPlugin(J??{});return N instanceof Promise?(N.then(R).catch((R=>{u("Error instantiating plugin.",R)})),null):(R(N),N)}return R(k.plugin),k.plugin})((J=>{var y;if(!J)throw`The loader plugin corresponding to the '${v}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(H.notifyObservers(J),j&&(J.canDirectLoad&&J.canDirectLoad(R.url)||!(0,a.h)(R.url))){if(J.directLoad){const R=J.directLoad(N,j);R instanceof Promise?R.then((R=>{q(J,R)})).catch((R=>{u("Error in directLoad of _loadData: "+R,R)})):q(J,R)}else q(J,j);return}const F=k.isBinary,W=(R,w)=>{N.u?u("Scene has been disposed"):q(J,R,w)};let C=null,e=!1;null===(y=J.Zd)||void 0===y||y.add((()=>{e=!0,C&&(C.abort(),C=null),M()}));const K=()=>{if(e)return;const q=(R,N)=>{u(null===R||void 0===R?void 0:R.statusText,N)};if(!J.loadFile&&R.rawData)throw"Plugin does not support loading ArrayBufferView.";C=J.loadFile?J.loadFile(N,R.rawData||R.file||R.url,R.rootUrl,W,w,F,q,G):N._loadFile(R.file||R.url,W,w,!0,F,q)},r=N.getEngine();let Z=r.enableOfflineSupport;if(Z){let q=!1;for(const w of N.disableOfflineSupportExceptionRules)if(w.test(R.url)){q=!0;break}Z=!q}Z&&S.e.OfflineProviderFactory?N.offlineProvider=S.e.OfflineProviderFactory(R.url,K,r.disableManifestCheck):K()}))}function Z(R,N){let q,w,M=null,v=null;if(N)if(N.name)q=`file:${N.name}`,w=N.name,M=N;else if(ArrayBuffer.isView(N))q="",w=(0,F.d)(),v=N;else if(N.startsWith("data:"))q=N,w="";else if(R){const M=N;if("/"===M.substring(0,1))return u.i.Error("Wrong sceneFilename parameter"),null;q=R+M,w=M}else q=N,w=u.i.GetFilename(N),R=u.i.GetFolderPath(N);else q=R,w=u.i.GetFilename(R),R=u.i.GetFolderPath(R);return{url:q,rootUrl:R,name:w,file:M,rawData:v}}function z(R){if("string"===typeof R.extensions){const N=R.extensions;W[N.toLowerCase()]={plugin:R,isBinary:!1}}else{const N=R.extensions;Object.keys(N).forEach((q=>{W[q.toLowerCase()]={plugin:R,isBinary:N[q].isBinary}}))}}function d(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.e.LastCreatedScene,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!w)return J.e.Error("No scene available to import mesh to"),null;const S=Z(N,q);if(!S)return null;const H={};w.addPendingData(H);const W=()=>{w.removePendingData(H)},k=(R,N)=>{const q=K(S,R,N);v?v(w,q,new j.h(q,j.d.SceneLoaderError,N)):J.e.Error(q),W()},C=M?R=>{try{M(R)}catch(N){k("Error in onProgress callback: "+N,N)}}:void 0,e=(R,N,q,M,v,G,J,y)=>{if(w.importedMeshesFiles.push(S.url),u)try{u(R,N,q,M,v,G,J,y)}catch(a){k("Error in onSuccess callback: "+a,a)}w.removePendingData(H)};return r(S,w,((N,q,u)=>{if(N.rewriteRootURL&&(S.rootUrl=N.rewriteRootURL(S.rootUrl,u)),N.importMesh){const u=[],M=[],v=[];if(!N.importMesh(R,w,q,S.rootUrl,u,M,v,k))return;w.loadingPluginName=N.name,e(u,M,v,[],[],[],[],[])}else{N.importMeshAsync(R,w,q,S.rootUrl,C,S.name).then((R=>{w.loadingPluginName=N.name,e(R.meshes,R.he,R.skeletons,R.animationGroups,R.transformNodes,R.geometries,R.lights,R.spriteManagers)})).catch((R=>{k(R.message,R)}))}}),C,k,W,y,a,F)}function x(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.e.LastCreatedEngine,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",j=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return q?P(R,N,new v.e(q),w,M,J,y,a,j):(u.i.Error("No engine available"),null)}function E(R,N,q,w,u,M,v){return new Promise(((G,J)=>{x(R,N,q,(R=>{G(R)}),w,((R,N,q)=>{J(q||new Error(N))}),u,M,v)}))}function P(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.e.LastCreatedScene,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",F=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!q)return J.e.Error("No scene available to append to"),null;const S=Z(R,N);if(!S)return null;const H={};q.addPendingData(H);const W=()=>{q.removePendingData(H)};y.c.ShowLoadingScreen&&!k&&(k=!0,q.getEngine().displayLoadingUI(),q.executeWhenReady((()=>{q.getEngine().hideLoadingUI(),k=!1})));const C=(R,N)=>{const w=K(S,R,N);M?M(q,w,new j.h(w,j.d.SceneLoaderError,N)):J.e.Error(w),W()},e=u?R=>{try{u(R)}catch(N){C("Error in onProgress callback",N)}}:void 0,z=()=>{if(w)try{w(q)}catch(R){C("Error in onSuccess callback",R)}q.removePendingData(H)};return r(S,q,((R,N)=>{if(R.load){if(!R.load(q,N,S.rootUrl,C))return;q.loadingPluginName=R.name,z()}else{R.loadAsync(q,N,S.rootUrl,e,S.name).then((()=>{q.loadingPluginName=R.name,z()})).catch((R=>{C(R.message,R)}))}}),e,C,W,v,a,F)}function s(R,N,q,w,u,M,v){return new Promise(((G,J)=>{P(R,N,q,(R=>{G(R)}),w,((R,N,q)=>{J(q||new Error(N))}),u,M,v)}))}function O(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.e.LastCreatedScene,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!q)return J.e.Error("No scene available to load asset container to"),null;const F=Z(R,N);if(!F)return null;const S={};q.addPendingData(S);const H=()=>{q.removePendingData(S)},W=(R,N)=>{const w=K(F,R,N);M?M(q,w,new j.h(w,j.d.SceneLoaderError,N)):J.e.Error(w),H()},k=u?R=>{try{u(R)}catch(N){W("Error in onProgress callback",N)}}:void 0,C=R=>{if(w)try{w(R)}catch(N){W("Error in onSuccess callback",N)}q.removePendingData(S)};return r(F,q,((R,N)=>{if(R.loadAssetContainer){const w=R.loadAssetContainer(q,N,F.rootUrl,W);if(!w)return;w.populateRootNodes(),q.loadingPluginName=R.name,C(w)}else if(R.loadAssetContainerAsync){R.loadAssetContainerAsync(q,N,F.rootUrl,k,F.name).then((N=>{N.populateRootNodes(),q.loadingPluginName=R.name,C(N)})).catch((R=>{W(R.message,R)}))}else W("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),k,W,H,v,y,a)}function L(R,N,q,w,u,M,v){return new Promise(((G,J)=>{O(R,N,q,(R=>{G(R)}),w,((R,N,q)=>{J(q||new Error(N))}),u,M,v)}))}function m(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.e.LastCreatedScene,w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,j=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,F=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",S=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!q)return void J.e.Error("No scene available to load animations to");if(w){for(const R of q.animatables)R.reset();q.stopAllAnimations(),q.animationGroups.slice().forEach((R=>{R.dispose()}));q.getNodes().forEach((R=>{R.animations&&(R.animations=[])}))}else switch(u){case 0:q.animationGroups.slice().forEach((R=>{R.dispose()}));break;case 1:q.animationGroups.forEach((R=>{R.stop()}));break;case 2:q.animationGroups.forEach((R=>{R.reset(),R.restart()}));break;case 3:break;default:return void J.e.Error("Unknown animation group loading mode value '"+u+"'")}const H=q.animatables.length;O(R,N,q,(R=>{R.mergeAnimationsTo(q,q.animatables.slice(H),M),R.dispose(),q.onAnimationFileImportedObservable.notifyObservers(q),v&&v(q)}),y,a,j,F,S)}function o(R,N,q,w,u,M,v,G,J,y){return new Promise(((a,j)=>{m(R,N,q,w,u,M,(R=>{a(R)}),v,((R,N,q)=>{j(q||new Error(N))}),G,J,y)}))}class A{static get ForceFullSceneLoadingForIncremental(){return y.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(R){y.c.ForceFullSceneLoadingForIncremental=R}static get ShowLoadingScreen(){return y.c.ShowLoadingScreen}static set ShowLoadingScreen(R){y.c.ShowLoadingScreen=R}static get loggingLevel(){return y.c.loggingLevel}static set loggingLevel(R){y.c.loggingLevel=R}static get CleanBoneMatrixWeights(){return y.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(R){y.c.CleanBoneMatrixWeights=R}static GetDefaultPlugin(){return C()}static GetPluginForExtension(R){var N;return null===(N=e(R))||void 0===N?void 0:N.plugin}static IsPluginForExtensionAvailable(R){return function(R){return!!W[R]}(R)}static RegisterPlugin(R){z(R)}static ImportMesh(R,N,q,w,u,M,v,G,J){return d(R,N,q,w,u,M,v,G,J)}static ImportMeshAsync(R,N,q,w,u,M,v){return function(R,N,q,w,u,M,v,G){return new Promise(((J,y)=>{d(R,N,q,w,((R,N,q,w,u,M,v,G)=>{J({meshes:R,he:N,skeletons:q,animationGroups:w,transformNodes:u,geometries:M,lights:v,spriteManagers:G})}),u,((R,N,q)=>{y(q||new Error(N))}),M,v,G)}))}(R,N,q,w,u,M,v)}static Load(R,N,q,w,u,M,v,G){return x(R,N,q,w,u,M,v,G)}static LoadAsync(R,N,q,w,u,M){return E(R,N,q,w,u,M)}static Append(R,N,q,w,u,M,v,G){return P(R,N,q,w,u,M,v,G)}static AppendAsync(R,N,q,w,u,M){return s(R,N,q,w,u,M)}static LoadAssetContainer(R,N,q,w,u,M,v,G){return O(R,N,q,w,u,M,v,G)}static LoadAssetContainerAsync(R,N,q,w,u,M){return L(R,N,q,w,u,M)}static ImportAnimations(R,N,q,w,u,M,v,G,J,y,a){m(R,N,q,w,u,M,v,G,J,y,a)}static ImportAnimationsAsync(R,N,q,w,u,M,v,G,J,y,a){return o(R,N,q,w,u,M,G,y,a)}}A.NO_LOGGING=0,A.MINIMAL_LOGGING=1,A.SUMMARY_LOGGING=2,A.DETAILED_LOGGING=3,A.OnPluginActivatedObservable=H},11410:(R,N,q)=>{"use strict";q.d(N,{c:()=>w});class w{static get ForceFullSceneLoadingForIncremental(){return w._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(R){w._ForceFullSceneLoadingForIncremental=R}static get ShowLoadingScreen(){return w._ShowLoadingScreen}static set ShowLoadingScreen(R){w._ShowLoadingScreen=R}static get loggingLevel(){return w._LoggingLevel}static set loggingLevel(R){w._LoggingLevel=R}static get CleanBoneMatrixWeights(){return w._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(R){w._CleanBoneMatrixWeights=R}}w._ForceFullSceneLoadingForIncremental=!1,w._ShowLoadingScreen=!0,w._CleanBoneMatrixWeights=!1,w._LoggingLevel=0},12023:(R,N,q)=>{"use strict";q.d(N,{d:()=>b});var w=q(942),u=q(947),M=q(1056),v=q(1171),G=q(12018),J=q(1174),y=q(966),a=q(1227),j=q(1363),F=q(1394);class S extends j.b{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class H extends F.b{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(R,"PBRBRDF",90,new S,N),this._useEnergyConservation=H.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=H.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=H.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=H.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=H.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=H.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=H.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=H.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=R._dirtyCallbacks[16],this._enable(!0)}prepareDefines(R){R.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,R.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,R.SPHERICAL_HARMONICS=this._useSphericalHarmonics,R.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}H.DEFAULT_USE_ENERGY_CONSERVATION=!0,H.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,H.DEFAULT_USE_SPHERICAL_HARMONICS=!0,H.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useEnergyConservation",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useSphericalHarmonics",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var W=q(1299),k=q(1133),C=q(1191),e=q(1306),K=q(1367),r=q(933),Z=q(1376),z=(q(10352),q(1378)),d=q(1353);class x extends j.b{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class E extends F.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(R,"PBRClearCoat",100,new x,N),this._isEnabled=!1,this.isEnabled=!1,this.hj=1,this.roughness=0,this._indexOfRefraction=E._DefaultIndexOfRefraction,this.indexOfRefraction=E._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=k.c.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=R._dirtyCallbacks[1]}isReadyForSubMesh(R,N,q){if(!this._isEnabled)return!0;const w=this._material._disableBumpMap;if(R._areTexturesDirty&&N.texturesEnabled){if(this._texture&&Z.b.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&Z.b.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(q.getCaps().standardDerivatives&&this._bumpTexture&&Z.b.ClearCoatBumpTextureEnabled&&!w&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&Z.b.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(R,N){this._isEnabled?(R.CLEARCOAT=!0,R.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,R.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,R._areTexturesDirty&&N.texturesEnabled&&(this._texture&&Z.b.ClearCoatTextureEnabled?(0,d.O)(this._texture,R,"CLEARCOAT_TEXTURE"):R.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&Z.b.ClearCoatTextureEnabled?(0,d.O)(this._textureRoughness,R,"CLEARCOAT_TEXTURE_ROUGHNESS"):R.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&Z.b.ClearCoatBumpTextureEnabled?(0,d.O)(this._bumpTexture,R,"CLEARCOAT_BUMP"):R.CLEARCOAT_BUMP=!1,R.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===E._DefaultIndexOfRefraction,this._isTintEnabled?(R.CLEARCOAT_TINT=!0,this._tintTexture&&Z.b.ClearCoatTintTextureEnabled?((0,d.O)(this._tintTexture,R,"CLEARCOAT_TINT_TEXTURE"),R.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):R.CLEARCOAT_TINT_TEXTURE=!1):(R.CLEARCOAT_TINT=!1,R.CLEARCOAT_TINT_TEXTURE=!1))):(R.CLEARCOAT=!1,R.CLEARCOAT_TEXTURE=!1,R.CLEARCOAT_TEXTURE_ROUGHNESS=!1,R.CLEARCOAT_BUMP=!1,R.CLEARCOAT_TINT=!1,R.CLEARCOAT_TINT_TEXTURE=!1,R.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,R.CLEARCOAT_DEFAULTIOR=!1,R.CLEARCOAT_TEXTUREDIRECTUV=0,R.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,R.CLEARCOAT_BUMPDIRECTUV=0,R.CLEARCOAT_REMAP_F0=!1,R.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,R.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(R,N,q,w){if(!this._isEnabled)return;const u=w.materialDefines,M=this._material.isFrozen,v=this._material._disableBumpMap,G=this._material._invertNormalMapX,J=this._material._invertNormalMapY;if(!R.useUbo||!M||!R.isSync){var y,a,j,F;if((this._texture||this._textureRoughness)&&Z.b.ClearCoatTextureEnabled)R.updateFloat4("vClearCoatInfos",(null===(y=this._texture)||void 0===y?void 0:y.coordinatesIndex)??0,(null===(a=this._texture)||void 0===a?void 0:a.level)??0,(null===(j=this._textureRoughness)||void 0===j?void 0:j.coordinatesIndex)??0,(null===(F=this._textureRoughness)||void 0===F?void 0:F.level)??0),this._texture&&(0,d.s)(this._texture,R,"clearCoat"),this._textureRoughness&&!u.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,d.s)(this._textureRoughness,R,"clearCoatRoughness");this._bumpTexture&&q.getCaps().standardDerivatives&&Z.b.ClearCoatTextureEnabled&&!v&&(R.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,d.s)(this._bumpTexture,R,"clearCoatBump"),N._mirroredCameraPosition?R.updateFloat2("vClearCoatTangentSpaceParams",G?1:-1,J?1:-1):R.updateFloat2("vClearCoatTangentSpaceParams",G?-1:1,J?-1:1)),this._tintTexture&&Z.b.ClearCoatTintTextureEnabled&&(R.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,d.s)(this._tintTexture,R,"clearCoatTint")),R.updateFloat2("vClearCoatParams",this.hj,this.roughness);const w=1-this._indexOfRefraction,M=1+this._indexOfRefraction,S=Math.pow(-w/M,2),H=1/this._indexOfRefraction;R.updateFloat4("vClearCoatRefractionParams",S,H,w,M),this._isTintEnabled&&(R.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),R.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}N.texturesEnabled&&(this._texture&&Z.b.ClearCoatTextureEnabled&&R.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!u.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&Z.b.ClearCoatTextureEnabled&&R.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&q.getCaps().standardDerivatives&&Z.b.ClearCoatBumpTextureEnabled&&!v&&R.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&Z.b.ClearCoatTintTextureEnabled&&R.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(R){return this._texture===R||(this._textureRoughness===R||(this._bumpTexture===R||this._tintTexture===R))}getActiveTextures(R){this._texture&&R.push(this._texture),this._textureRoughness&&R.push(this._textureRoughness),this._bumpTexture&&R.push(this._bumpTexture),this._tintTexture&&R.push(this._tintTexture)}getAnimatables(R){this._texture&&this._texture.animations&&this._texture.animations.length>0&&R.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&R.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&R.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&R.push(this._tintTexture)}dispose(R){var N,q,w,u;R&&(null===(N=this._texture)||void 0===N||N.dispose(),null===(q=this._textureRoughness)||void 0===q||q.dispose(),null===(w=this._bumpTexture)||void 0===w||w.dispose(),null===(u=this._tintTexture)||void 0===u||u.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(R,N,q){return R.CLEARCOAT_BUMP&&N.addFallback(q++,"CLEARCOAT_BUMP"),R.CLEARCOAT_TINT&&N.addFallback(q++,"CLEARCOAT_TINT"),R.CLEARCOAT&&N.addFallback(q++,"CLEARCOAT"),q}getSamplers(R){R.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}E._DefaultIndexOfRefraction=1.5,(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"isEnabled",void 0),(0,w.b)([(0,u.E)()],E.prototype,"intensity",void 0),(0,w.b)([(0,u.E)()],E.prototype,"roughness",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"indexOfRefraction",void 0),(0,w.b)([(0,u.y)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"texture",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useRoughnessFromMainTexture",void 0),(0,w.b)([(0,u.y)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"textureRoughness",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"remapF0OnInterfaceChange",void 0),(0,w.b)([(0,u.y)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"bumpTexture",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"isTintEnabled",void 0),(0,w.b)([(0,u.l)()],E.prototype,"tintColor",void 0),(0,w.b)([(0,u.E)()],E.prototype,"tintColorAtDistance",void 0),(0,w.b)([(0,u.E)()],E.prototype,"tintThickness",void 0),(0,w.b)([(0,u.y)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"tintTexture",void 0);class P extends j.b{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class s extends F.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(R,"PBRIridescence",110,new P,N),this._isEnabled=!1,this.isEnabled=!1,this.hj=1,this.minimumThickness=s._DefaultMinimumThickness,this.maximumThickness=s._DefaultMaximumThickness,this.indexOfRefraction=s._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=R._dirtyCallbacks[1]}isReadyForSubMesh(R,N){if(!this._isEnabled)return!0;if(R._areTexturesDirty&&N.texturesEnabled){if(this._texture&&Z.b.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&Z.b.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(R,N){this._isEnabled?(R.IRIDESCENCE=!0,R._areTexturesDirty&&N.texturesEnabled&&(this._texture&&Z.b.IridescenceTextureEnabled?(0,d.O)(this._texture,R,"IRIDESCENCE_TEXTURE"):R.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&Z.b.IridescenceTextureEnabled?(0,d.O)(this._thicknessTexture,R,"IRIDESCENCE_THICKNESS_TEXTURE"):R.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(R.IRIDESCENCE=!1,R.IRIDESCENCE_TEXTURE=!1,R.IRIDESCENCE_THICKNESS_TEXTURE=!1,R.IRIDESCENCE_TEXTUREDIRECTUV=0,R.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(R,N){if(!this._isEnabled)return;const q=this._material.isFrozen;if(!R.useUbo||!q||!R.isSync){var w,u,M,v;if((this._texture||this._thicknessTexture)&&Z.b.IridescenceTextureEnabled)R.updateFloat4("vIridescenceInfos",(null===(w=this._texture)||void 0===w?void 0:w.coordinatesIndex)??0,(null===(u=this._texture)||void 0===u?void 0:u.level)??0,(null===(M=this._thicknessTexture)||void 0===M?void 0:M.coordinatesIndex)??0,(null===(v=this._thicknessTexture)||void 0===v?void 0:v.level)??0),this._texture&&(0,d.s)(this._texture,R,"iridescence"),this._thicknessTexture&&(0,d.s)(this._thicknessTexture,R,"iridescenceThickness");R.updateFloat4("vIridescenceParams",this.hj,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}N.texturesEnabled&&(this._texture&&Z.b.IridescenceTextureEnabled&&R.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&Z.b.IridescenceTextureEnabled&&R.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(R){return this._texture===R||this._thicknessTexture===R}getActiveTextures(R){this._texture&&R.push(this._texture),this._thicknessTexture&&R.push(this._thicknessTexture)}getAnimatables(R){this._texture&&this._texture.animations&&this._texture.animations.length>0&&R.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&R.push(this._thicknessTexture)}dispose(R){var N,q;R&&(null===(N=this._texture)||void 0===N||N.dispose(),null===(q=this._thicknessTexture)||void 0===q||q.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(R,N,q){return R.IRIDESCENCE&&N.addFallback(q++,"IRIDESCENCE"),q}getSamplers(R){R.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}s._DefaultMinimumThickness=100,s._DefaultMaximumThickness=400,s._DefaultIndexOfRefraction=1.3,(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"isEnabled",void 0),(0,w.b)([(0,u.E)()],s.prototype,"intensity",void 0),(0,w.b)([(0,u.E)()],s.prototype,"minimumThickness",void 0),(0,w.b)([(0,u.E)()],s.prototype,"maximumThickness",void 0),(0,w.b)([(0,u.E)()],s.prototype,"indexOfRefraction",void 0),(0,w.b)([(0,u.y)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"texture",void 0),(0,w.b)([(0,u.y)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],s.prototype,"thicknessTexture",void 0);class O extends j.b{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class L extends F.b{set angle(R){this.direction.x=Math.cos(R),this.direction.y=Math.sin(R)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(R,"PBRAnisotropic",110,new O,N),this._isEnabled=!1,this.isEnabled=!1,this.hj=1,this.direction=new y.j(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=R._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=R._dirtyCallbacks[16]}isReadyForSubMesh(R,N){return!this._isEnabled||!(R._areTexturesDirty&&N.texturesEnabled&&this._texture&&Z.b.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(R,N,q){this._isEnabled?(R.ANISOTROPIC=this._isEnabled,this._isEnabled&&!q.isVerticesDataPresent(a.e.TangentKind)&&(R._needUVs=!0,R.MAINUV1=!0),R._areTexturesDirty&&N.texturesEnabled&&(this._texture&&Z.b.AnisotropicTextureEnabled?(0,d.O)(this._texture,R,"ANISOTROPIC_TEXTURE"):R.ANISOTROPIC_TEXTURE=!1),R._areMiscDirty&&(R.ANISOTROPIC_LEGACY=this._legacy)):(R.ANISOTROPIC=!1,R.ANISOTROPIC_TEXTURE=!1,R.ANISOTROPIC_TEXTUREDIRECTUV=0,R.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(R,N){if(!this._isEnabled)return;const q=this._material.isFrozen;R.useUbo&&q&&R.isSync||(this._texture&&Z.b.AnisotropicTextureEnabled&&(R.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,d.s)(this._texture,R,"anisotropy")),R.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.hj)),N.texturesEnabled&&this._texture&&Z.b.AnisotropicTextureEnabled&&R.setTexture("anisotropySampler",this._texture)}hasTexture(R){return this._texture===R}getActiveTextures(R){this._texture&&R.push(this._texture)}getAnimatables(R){this._texture&&this._texture.animations&&this._texture.animations.length>0&&R.push(this._texture)}dispose(R){R&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(R,N,q){return R.ANISOTROPIC&&N.addFallback(q++,"ANISOTROPIC"),q}getSamplers(R){R.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(R,N,q){super.parse(R,N,q),void 0===R.legacy&&(this.legacy=!0)}}(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"isEnabled",void 0),(0,w.b)([(0,u.E)()],L.prototype,"intensity",void 0),(0,w.b)([(0,u.z)()],L.prototype,"direction",void 0),(0,w.b)([(0,u.y)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"texture",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsMiscDirty")],L.prototype,"legacy",void 0);class m extends j.b{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class o extends F.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(R,"Sheen",120,new m,N),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.hj=1,this.color=k.c.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=R._dirtyCallbacks[1]}isReadyForSubMesh(R,N){if(!this._isEnabled)return!0;if(R._areTexturesDirty&&N.texturesEnabled){if(this._texture&&Z.b.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&Z.b.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(R,N){this._isEnabled?(R.SHEEN=!0,R.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,R.SHEEN_ROUGHNESS=null!==this._roughness,R.SHEEN_ALBEDOSCALING=this._albedoScaling,R.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,R._areTexturesDirty&&N.texturesEnabled&&(this._texture&&Z.b.SheenTextureEnabled?((0,d.O)(this._texture,R,"SHEEN_TEXTURE"),R.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):R.SHEEN_TEXTURE=!1,this._textureRoughness&&Z.b.SheenTextureEnabled?(0,d.O)(this._textureRoughness,R,"SHEEN_TEXTURE_ROUGHNESS"):R.SHEEN_TEXTURE_ROUGHNESS=!1)):(R.SHEEN=!1,R.SHEEN_TEXTURE=!1,R.SHEEN_TEXTURE_ROUGHNESS=!1,R.SHEEN_LINKWITHALBEDO=!1,R.SHEEN_ROUGHNESS=!1,R.SHEEN_ALBEDOSCALING=!1,R.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,R.SHEEN_GAMMATEXTURE=!1,R.SHEEN_TEXTUREDIRECTUV=0,R.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(R,N,q,w){if(!this._isEnabled)return;const u=w.materialDefines,M=this._material.isFrozen;if(!R.useUbo||!M||!R.isSync){var v,G,J,y;if((this._texture||this._textureRoughness)&&Z.b.SheenTextureEnabled)R.updateFloat4("vSheenInfos",(null===(v=this._texture)||void 0===v?void 0:v.coordinatesIndex)??0,(null===(G=this._texture)||void 0===G?void 0:G.level)??0,(null===(J=this._textureRoughness)||void 0===J?void 0:J.coordinatesIndex)??0,(null===(y=this._textureRoughness)||void 0===y?void 0:y.level)??0),this._texture&&(0,d.s)(this._texture,R,"sheen"),this._textureRoughness&&!u.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,d.s)(this._textureRoughness,R,"sheenRoughness");R.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.hj),null!==this._roughness&&R.updateFloat("vSheenRoughness",this._roughness)}N.texturesEnabled&&(this._texture&&Z.b.SheenTextureEnabled&&R.setTexture("sheenSampler",this._texture),this._textureRoughness&&!u.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&Z.b.SheenTextureEnabled&&R.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(R){return this._texture===R||this._textureRoughness===R}getActiveTextures(R){this._texture&&R.push(this._texture),this._textureRoughness&&R.push(this._textureRoughness)}getAnimatables(R){this._texture&&this._texture.animations&&this._texture.animations.length>0&&R.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&R.push(this._textureRoughness)}dispose(R){var N,q;R&&(null===(N=this._texture)||void 0===N||N.dispose(),null===(q=this._textureRoughness)||void 0===q||q.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(R,N,q){return R.SHEEN&&N.addFallback(q++,"SHEEN"),q}getSamplers(R){R.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"isEnabled",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"linkSheenWithAlbedo",void 0),(0,w.b)([(0,u.E)()],o.prototype,"intensity",void 0),(0,w.b)([(0,u.l)()],o.prototype,"color",void 0),(0,w.b)([(0,u.y)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"texture",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"useRoughnessFromMainTexture",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"roughness",void 0),(0,w.b)([(0,u.y)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"textureRoughness",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],o.prototype,"albedoScaling",void 0);class A extends j.b{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class n extends F.b{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(R){this._scene.enableSubSurfaceForPrePass()&&R&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(R))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(R){this._volumeIndexOfRefraction=R>=1?R:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(R,"PBRSubSurface",130,new A,N),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=k.c.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=k.c.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=R.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=R._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=R._dirtyCallbacks[32]}isReadyForSubMesh(R,N){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(R._areTexturesDirty&&N.texturesEnabled){if(this._thicknessTexture&&Z.b.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&Z.b.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&Z.b.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const R=this._getRefractionTexture(N);if(R&&Z.b.RefractionTextureEnabled&&!R.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(R,N){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return R.SUBSURFACE=!1,R.SS_DISPERSION=!1,R.SS_TRANSLUCENCY=!1,R.SS_SCATTERING=!1,R.SS_REFRACTION=!1,R.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,R.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,R.SS_THICKNESSANDMASK_TEXTURE=!1,R.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,R.SS_HAS_THICKNESS=!1,R.SS_REFRACTIONINTENSITY_TEXTURE=!1,R.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,R.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,R.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,R.SS_REFRACTIONMAP_3D=!1,R.SS_REFRACTIONMAP_OPPOSITEZ=!1,R.SS_LODINREFRACTIONALPHA=!1,R.SS_GAMMAREFRACTION=!1,R.SS_RGBDREFRACTION=!1,R.SS_LINEARSPECULARREFRACTION=!1,R.SS_LINKREFRACTIONTOTRANSPARENCY=!1,R.SS_ALBEDOFORREFRACTIONTINT=!1,R.SS_ALBEDOFORTRANSLUCENCYTINT=!1,R.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,R.SS_USE_THICKNESS_AS_DEPTH=!1,R.SS_USE_GLTF_TEXTURES=!1,R.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(R.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(R._areTexturesDirty){if(R.SUBSURFACE=!0,R.SS_DISPERSION=this._isDispersionEnabled,R.SS_TRANSLUCENCY=this._isTranslucencyEnabled,R.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,R.SS_SCATTERING=this._isScatteringEnabled,R.SS_THICKNESSANDMASK_TEXTURE=!1,R.SS_REFRACTIONINTENSITY_TEXTURE=!1,R.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,R.SS_HAS_THICKNESS=!1,R.SS_USE_GLTF_TEXTURES=!1,R.SS_REFRACTION=!1,R.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,R.SS_REFRACTIONMAP_3D=!1,R.SS_GAMMAREFRACTION=!1,R.SS_RGBDREFRACTION=!1,R.SS_LINEARSPECULARREFRACTION=!1,R.SS_REFRACTIONMAP_OPPOSITEZ=!1,R.SS_LODINREFRACTIONALPHA=!1,R.SS_LINKREFRACTIONTOTRANSPARENCY=!1,R.SS_ALBEDOFORREFRACTIONTINT=!1,R.SS_ALBEDOFORTRANSLUCENCYTINT=!1,R.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,R.SS_USE_THICKNESS_AS_DEPTH=!1,R.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,R._areTexturesDirty&&N.texturesEnabled&&(this._thicknessTexture&&Z.b.ThicknessTextureEnabled&&(0,d.O)(this._thicknessTexture,R,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&Z.b.RefractionIntensityTextureEnabled&&(0,d.O)(this._refractionIntensityTexture,R,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&Z.b.TranslucencyIntensityTextureEnabled&&(0,d.O)(this._translucencyIntensityTexture,R,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&Z.b.TranslucencyColorTextureEnabled&&(0,d.O)(this._translucencyColorTexture,R,"SS_TRANSLUCENCYCOLOR_TEXTURE")),R.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,R.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,R.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,R.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&N.texturesEnabled){const q=this._getRefractionTexture(N);q&&Z.b.RefractionTextureEnabled&&(R.SS_REFRACTION=!0,R.SS_REFRACTIONMAP_3D=q.isCube,R.SS_GAMMAREFRACTION=q.gammaSpace,R.SS_RGBDREFRACTION=q.isRGBD,R.SS_LINEARSPECULARREFRACTION=q.linearSpecularLOD,R.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&q.isCube?!q.invertZ:q.invertZ,R.SS_LODINREFRACTIONALPHA=q.lodLevelInAlpha,R.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,R.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,R.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=q.isCube&&q.boundingBoxSize,R.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(R.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(R,N,q,w){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)R.updateFloat2("vThicknessParam",0,0);else{w.getRenderingMesh().getWorldMatrix().decompose(y.f.Od[0]);const N=Math.max(Math.abs(y.f.Od[0].x),Math.abs(y.f.Od[0].y),Math.abs(y.f.Od[0].z));R.updateFloat2("vThicknessParam",this.minimumThickness*N,(this.maximumThickness-this.minimumThickness)*N)}}bindForSubMesh(R,N,q,w){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const u=w.materialDefines,M=this._material.isFrozen,v=this._material.realTimeFiltering,G=u.LODBASEDMICROSFURACE,J=this._getRefractionTexture(N);if(!R.useUbo||!M||!R.isSync){if(this._thicknessTexture&&Z.b.ThicknessTextureEnabled&&(R.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,d.s)(this._thicknessTexture,R,"thickness")),this._refractionIntensityTexture&&Z.b.RefractionIntensityTextureEnabled&&u.SS_REFRACTIONINTENSITY_TEXTURE&&(R.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,d.s)(this._refractionIntensityTexture,R,"refractionIntensity")),this._translucencyColorTexture&&Z.b.TranslucencyColorTextureEnabled&&u.SS_TRANSLUCENCYCOLOR_TEXTURE&&(R.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,d.s)(this._translucencyColorTexture,R,"translucencyColor")),this._translucencyIntensityTexture&&Z.b.TranslucencyIntensityTextureEnabled&&u.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(R.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,d.s)(this._translucencyIntensityTexture,R,"translucencyIntensity")),J&&Z.b.RefractionTextureEnabled){R.ve("refractionMatrix",J.getRefractionTextureMatrix());let N=1;J.isCube||J.depth&&(N=J.depth);const q=J.getSize().width,w=this.volumeIndexOfRefraction;if(R.updateFloat4("vRefractionInfos",J.level,1/w,N,this._invertRefractionY?-1:1),R.updateFloat4("vRefractionMicrosurfaceInfos",q,J.lodGenerationScale,J.lodGenerationOffset,1/this.indexOfRefraction),v&&R.updateFloat2("vRefractionFilteringInfo",q,Math.log2(q)),J.boundingBoxSize){const N=J;R.updateVector3("vRefractionPosition",N.boundingBoxPosition),R.updateVector3("vRefractionSize",N.boundingBoxSize)}}this._isScatteringEnabled&&R.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),R.updateColor3("vDiffusionDistance",this.diffusionDistance),R.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),R.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),R.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),R.updateFloat("dispersion",this.dispersion)}N.texturesEnabled&&(this._thicknessTexture&&Z.b.ThicknessTextureEnabled&&R.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&Z.b.RefractionIntensityTextureEnabled&&u.SS_REFRACTIONINTENSITY_TEXTURE&&R.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&Z.b.TranslucencyIntensityTextureEnabled&&u.SS_TRANSLUCENCYINTENSITY_TEXTURE&&R.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&Z.b.TranslucencyColorTextureEnabled&&u.SS_TRANSLUCENCYCOLOR_TEXTURE&&R.setTexture("translucencyColorSampler",this._translucencyColorTexture),J&&Z.b.RefractionTextureEnabled&&(G?R.setTexture("refractionSampler",J):(R.setTexture("refractionSampler",J._lodTextureMid||J),R.setTexture("refractionSamplerLow",J._lodTextureLow||J),R.setTexture("refractionSamplerHigh",J._lodTextureHigh||J))))}_getRefractionTexture(R){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?R.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(R){Z.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&R.push(this._refractionTexture)}hasTexture(R){return this._thicknessTexture===R||(this._refractionTexture===R||(this._refractionIntensityTexture===R||(this._translucencyIntensityTexture===R||this._translucencyColorTexture===R)))}hasRenderTargetTextures(){return!!(Z.b.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(R){this._thicknessTexture&&R.push(this._thicknessTexture),this._refractionTexture&&R.push(this._refractionTexture),this._translucencyColorTexture&&R.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&R.push(this._translucencyIntensityTexture)}getAnimatables(R){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&R.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&R.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&R.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&R.push(this._translucencyIntensityTexture)}dispose(R){R&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(R,N,q){return R.SS_SCATTERING&&N.addFallback(q++,"SS_SCATTERING"),R.SS_TRANSLUCENCY&&N.addFallback(q++,"SS_TRANSLUCENCY"),q}getSamplers(R){R.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"isRefractionEnabled",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"isTranslucencyEnabled",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"isDispersionEnabled",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markScenePrePassDirty")],n.prototype,"isScatteringEnabled",void 0),(0,w.b)([(0,u.E)()],n.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,w.b)([(0,u.E)()],n.prototype,"refractionIntensity",void 0),(0,w.b)([(0,u.E)()],n.prototype,"translucencyIntensity",void 0),(0,w.b)([(0,u.E)()],n.prototype,"useAlbedoToTintRefraction",void 0),(0,w.b)([(0,u.E)()],n.prototype,"useAlbedoToTintTranslucency",void 0),(0,w.b)([(0,u.y)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"thicknessTexture",void 0),(0,w.b)([(0,u.y)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"refractionTexture",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"indexOfRefraction",void 0),(0,w.b)([(0,u.E)()],n.prototype,"_volumeIndexOfRefraction",void 0),(0,w.b)([(0,u.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"volumeIndexOfRefraction",null),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"invertRefractionY",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"linkRefractionWithTransparency",void 0),(0,w.b)([(0,u.E)()],n.prototype,"minimumThickness",void 0),(0,w.b)([(0,u.E)()],n.prototype,"maximumThickness",void 0),(0,w.b)([(0,u.E)()],n.prototype,"useThicknessAsDepth",void 0),(0,w.b)([(0,u.l)()],n.prototype,"tintColor",void 0),(0,w.b)([(0,u.E)()],n.prototype,"tintColorAtDistance",void 0),(0,w.b)([(0,u.E)()],n.prototype,"dispersion",void 0),(0,w.b)([(0,u.l)()],n.prototype,"diffusionDistance",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useMaskFromThicknessTexture",void 0),(0,w.b)([(0,u.y)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"refractionIntensityTexture",void 0),(0,w.b)([(0,u.y)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"translucencyIntensityTexture",void 0),(0,w.b)([(0,u.l)()],n.prototype,"translucencyColor",void 0),(0,w.b)([(0,u.y)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"translucencyColorTexture",void 0),(0,w.b)([(0,u.E)(),(0,u.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useGltfStyleTextures",void 0);var Q=q(1387),Y=q(1357),T=q(1399);const f={effect:null,subMesh:null};class c extends j.b{constructor(R){super(R),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class b extends K.d{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(R){this._realTimeFiltering=R,this.pe(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(R){this._realTimeFilteringQuality=R,this.pe(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(R){R!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=R||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(R,N){super(R,N,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||b.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new y.n(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=k.c.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new k.c(0,0,0),this._albedoColor=new k.c(1,1,1),this._reflectivityColor=new k.c(1,1,1),this._reflectionColor=new k.c(1,1,1),this._emissiveColor=new k.c(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=b.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new v.f(16),this._globalAmbientColor=new k.c(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new H(this),this.clearCoat=new E(this),this.iridescence=new s(this),this.anisotropy=new L(this),this.sheen=new o(this),this.subSurface=new n(this),this.detailMap=new Q.e(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),Z.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,G.c)(this.va()),this.prePassConfiguration=new W.c}get hasRenderTargetTextures(){return!!(Z.b.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var R;return this._transparencyMode===b.PBRMATERIAL_OPAQUE||this._transparencyMode===b.PBRMATERIAL_ALPHATEST||(null===(R=this.subSurface)||void 0===R?void 0:R.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var R;return!!this._forceAlphaTest||(null===(R=this.subSurface)||void 0===R||!R.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===b.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.ac&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==b.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.ac||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(R,N,q){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const w=N._drawWrapper;if(w.effect&&this.isFrozen&&w._wasPreviouslyReady&&w._wasPreviouslyUsingInstances===q)return!0;N.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),N.materialDefines=new c(this._eventInfo.defineNames));const u=N.materialDefines;if(this._isReadyForSubMesh(N))return!0;const v=this.va(),G=v.getEngine();if(u._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,v.texturesEnabled)){if(this._albedoTexture&&Z.b.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&Z.b.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&Z.b.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const R=this._getReflectionTexture();if(R&&Z.b.ReflectionTextureEnabled){if(!R.isReadyOrNotBlocking())return!1;var J;if(R.irradianceTexture){if(!R.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!R.sphericalPolynomial&&null!==(J=R.getInternalTexture())&&void 0!==J&&J._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&Z.b.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&Z.b.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(Z.b.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(G.getCaps().standardDerivatives&&this._bumpTexture&&Z.b.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&Z.b.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=u,this._eventInfo.subMesh=N,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(u._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;G.getCaps().standardDerivatives||R.isVerticesDataPresent(a.e.NormalKind)||(R.createNormals(!0),M.e.Warn("PBRMaterial: Normals have been created for the mesh: "+R.name));const y=N.effect,j=u._areLightsDisposed;let F=this._prepareEffect(R,u,this.onCompiled,this.onError,q,null,N.getRenderingMesh().hasThinInstances),S=!1;if(F)if(this._onEffectCreatedObservable&&(f.effect=F,f.subMesh=N,this._onEffectCreatedObservable.notifyObservers(f)),this.allowShaderHotSwapping&&y&&!F.isReady()){if(F=y,u.markAsUnprocessed(),S=this.isFrozen,j)return u._areLightsDisposed=!0,!1}else v.resetCachedMaterial(),N.setEffect(F,u,this._materialContext);return!(!N.effect||!N.effect.isReady())&&(u._renderId=v.getRenderId(),w._wasPreviouslyReady=!S,w._wasPreviouslyUsingInstances=!!q,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(R,N){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(R,N,M,v,G),!N.isDirty)return null;N.markAsProcessed();const J=this.va().getEngine(),y=new z.b;let j=0;N.USESPHERICALINVERTEX&&y.addFallback(j++,"USESPHERICALINVERTEX"),N.FOG&&y.addFallback(j,"FOG"),N.SPECULARAA&&y.addFallback(j,"SPECULARAA"),N.POINTSIZE&&y.addFallback(j,"POINTSIZE"),N.LOGARITHMICDEPTH&&y.addFallback(j,"LOGARITHMICDEPTH"),N.PARALLAX&&y.addFallback(j,"PARALLAX"),N.PARALLAX_RHS&&y.addFallback(j,"PARALLAX_RHS"),N.PARALLAXOCCLUSION&&y.addFallback(j++,"PARALLAXOCCLUSION"),N.ENVIRONMENTBRDF&&y.addFallback(j++,"ENVIRONMENTBRDF"),N.TANGENT&&y.addFallback(j++,"TANGENT"),N.BUMP&&y.addFallback(j++,"BUMP"),j=(0,d.u)(N,y,this._maxSimultaneousLights,j++),N.SPECULARTERM&&y.addFallback(j++,"SPECULARTERM"),N.USESPHERICALFROMREFLECTIONMAP&&y.addFallback(j++,"USESPHERICALFROMREFLECTIONMAP"),N.USEIRRADIANCEMAP&&y.addFallback(j++,"USEIRRADIANCEMAP"),N.LIGHTMAP&&y.addFallback(j++,"LIGHTMAP"),N.NORMAL&&y.addFallback(j++,"NORMAL"),N.AMBIENT&&y.addFallback(j++,"AMBIENT"),N.EMISSIVE&&y.addFallback(j++,"EMISSIVE"),N.VERTEXCOLOR&&y.addFallback(j++,"VERTEXCOLOR"),N.MORPHTARGETS&&y.addFallback(j++,"MORPHTARGETS"),N.MULTIVIEW&&y.addFallback(0,"MULTIVIEW");const F=[a.e.PositionKind];N.NORMAL&&F.push(a.e.NormalKind),N.TANGENT&&F.push(a.e.TangentKind);for(let q=1;q<=6;++q)N["UV"+q]&&F.push(`uv${1===q?"":q}`);N.VERTEXCOLOR&&F.push(a.e.ColorKind),(0,d.B)(F,R,N,y),(0,d.C)(F,N),(0,d.E)(F,R,N),(0,d.y)(F,R,N);let S="pbr";const H=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],k=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],e=["Material","Scene","Mesh"],K={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:N.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=y,this._eventInfo.fallbackRank=j,this._eventInfo.defines=N,this._eventInfo.uniforms=H,this._eventInfo.attributes=F,this._eventInfo.samplers=k,this._eventInfo.uniformBuffersNames=e,this._eventInfo.customCode=void 0,this._eventInfo.mesh=R,this._eventInfo.indexParameters=K,this._callbackPluginEventGeneric(128,this._eventInfo),T.c.AddUniformsAndSamplers(H,k),W.c.AddUniforms(H),W.c.AddSamplers(k),(0,Y.c)(H),C.c&&(C.c.PrepareUniforms(H,N),C.c.PrepareSamplers(k,N)),(0,d.ab)({uniformsNames:H,uniformBuffersNames:e,samplers:k,defines:N,maxSimultaneousLights:this._maxSimultaneousLights});const r={};this.customShaderNameResolve&&(S=this.customShaderNameResolve(S,H,e,k,N,F,r));const Z=N.toString(),x=J.createEffect(S,{attributes:F,uniformsNames:H,uniformBuffersNames:e,samplers:k,defines:Z,fallbacks:y,onCompiled:w,onError:u,indexParameters:K,processFinalCode:r.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:N.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([q.e(15),q.e(44)]).then(q.bind(q,12644)),Promise.all([q.e(16),q.e(45)]).then(q.bind(q,12656))]):await Promise.all([Promise.all([q.e(21),q.e(46)]).then(q.bind(q,12664)),Promise.all([q.e(23),q.e(47)]).then(q.bind(q,12677))]),this._shadersLoaded=!0}},J);return this._eventInfo.customCode=void 0,x}_prepareDefines(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const M=this.va(),v=M.getEngine();(0,d.K)(M,R,N,!0,this._maxSimultaneousLights,this._disableLighting),N._needNormals=!0,(0,d.T)(M,N);const G=this.needAlphaBlendingForMesh(R)&&this.va().useOrderIndependentTransparency;if((0,d.Y)(M,N,this.canRenderToMRT&&!G),(0,d.U)(M,N,G),T.c.PrepareDefines(v.currentRenderPassId,R,N),N.METALLICWORKFLOW=this.isMetallicWorkflow(),N._areTexturesDirty){N._needUVs=!1;for(let R=1;R<=6;++R)N["MAINUV"+R]=!1;if(M.texturesEnabled){N.ALBEDODIRECTUV=0,N.AMBIENTDIRECTUV=0,N.OPACITYDIRECTUV=0,N.EMISSIVEDIRECTUV=0,N.REFLECTIVITYDIRECTUV=0,N.MICROSURFACEMAPDIRECTUV=0,N.METALLIC_REFLECTANCEDIRECTUV=0,N.REFLECTANCEDIRECTUV=0,N.BUMPDIRECTUV=0,N.LIGHTMAPDIRECTUV=0,v.getCaps().textureLOD&&(N.LODBASEDMICROSFURACE=!0),this._albedoTexture&&Z.b.DiffuseTextureEnabled?((0,d.O)(this._albedoTexture,N,"ALBEDO"),N.GAMMAALBEDO=this._albedoTexture.gammaSpace):N.ALBEDO=!1,this._ambientTexture&&Z.b.AmbientTextureEnabled?((0,d.O)(this._ambientTexture,N,"AMBIENT"),N.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):N.AMBIENT=!1,this._opacityTexture&&Z.b.OpacityTextureEnabled?((0,d.O)(this._opacityTexture,N,"OPACITY"),N.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):N.OPACITY=!1;const R=this._getReflectionTexture();if(R&&Z.b.ReflectionTextureEnabled){switch(N.REFLECTION=!0,N.GAMMAREFLECTION=R.gammaSpace,N.RGBDREFLECTION=R.isRGBD,N.LODINREFLECTIONALPHA=R.lodLevelInAlpha,N.LINEARSPECULARREFLECTION=R.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(N.NUM_SAMPLES=""+this.realTimeFilteringQuality,v._features.needTypeSuffixInShaderConstants&&(N.NUM_SAMPLES=N.NUM_SAMPLES+"u"),N.REALTIME_FILTERING=!0):N.REALTIME_FILTERING=!1,N.INVERTCUBICMAP=R.coordinatesMode===r.e.INVCUBIC_MODE,N.REFLECTIONMAP_3D=R.isCube,N.REFLECTIONMAP_OPPOSITEZ=N.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!R.invertZ:R.invertZ,N.REFLECTIONMAP_CUBIC=!1,N.REFLECTIONMAP_EXPLICIT=!1,N.REFLECTIONMAP_PLANAR=!1,N.REFLECTIONMAP_PROJECTION=!1,N.REFLECTIONMAP_SKYBOX=!1,N.REFLECTIONMAP_SPHERICAL=!1,N.REFLECTIONMAP_EQUIRECTANGULAR=!1,N.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,N.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,R.coordinatesMode){case r.e.EXPLICIT_MODE:N.REFLECTIONMAP_EXPLICIT=!0;break;case r.e.PLANAR_MODE:N.REFLECTIONMAP_PLANAR=!0;break;case r.e.PROJECTION_MODE:N.REFLECTIONMAP_PROJECTION=!0;break;case r.e.SKYBOX_MODE:N.REFLECTIONMAP_SKYBOX=!0;break;case r.e.SPHERICAL_MODE:N.REFLECTIONMAP_SPHERICAL=!0;break;case r.e.EQUIRECTANGULAR_MODE:N.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case r.e.FIXED_EQUIRECTANGULAR_MODE:N.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case r.e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:N.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case r.e.CUBIC_MODE:case r.e.INVCUBIC_MODE:default:N.REFLECTIONMAP_CUBIC=!0,N.USE_LOCAL_REFLECTIONMAP_CUBIC=!!R.boundingBoxSize}R.coordinatesMode!==r.e.SKYBOX_MODE&&(R.irradianceTexture?(N.USEIRRADIANCEMAP=!0,N.USESPHERICALFROMREFLECTIONMAP=!1):R.isCube&&(N.USESPHERICALFROMREFLECTIONMAP=!0,N.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||v.getCaps().maxVaryingVectors<=8?N.USESPHERICALINVERTEX=!1:N.USESPHERICALINVERTEX=!0))}else N.REFLECTION=!1,N.REFLECTIONMAP_3D=!1,N.REFLECTIONMAP_SPHERICAL=!1,N.REFLECTIONMAP_PLANAR=!1,N.REFLECTIONMAP_CUBIC=!1,N.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,N.REFLECTIONMAP_PROJECTION=!1,N.REFLECTIONMAP_SKYBOX=!1,N.REFLECTIONMAP_EXPLICIT=!1,N.REFLECTIONMAP_EQUIRECTANGULAR=!1,N.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,N.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,N.INVERTCUBICMAP=!1,N.USESPHERICALFROMREFLECTIONMAP=!1,N.USEIRRADIANCEMAP=!1,N.USESPHERICALINVERTEX=!1,N.REFLECTIONMAP_OPPOSITEZ=!1,N.LODINREFLECTIONALPHA=!1,N.GAMMAREFLECTION=!1,N.RGBDREFLECTION=!1,N.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&Z.b.LightmapTextureEnabled?((0,d.O)(this._lightmapTexture,N,"LIGHTMAP"),N.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,N.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,N.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):N.LIGHTMAP=!1,this._emissiveTexture&&Z.b.EmissiveTextureEnabled?((0,d.O)(this._emissiveTexture,N,"EMISSIVE"),N.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):N.EMISSIVE=!1,Z.b.SpecularTextureEnabled?(this._metallicTexture?((0,d.O)(this._metallicTexture,N,"REFLECTIVITY"),N.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,N.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,N.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,N.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,N.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,d.O)(this._reflectivityTexture,N,"REFLECTIVITY"),N.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,N.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,N.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):N.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(N.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,d.O)(this._metallicReflectanceTexture,N,"METALLIC_REFLECTANCE"),N.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):N.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,d.O)(this._reflectanceTexture,N,"REFLECTANCE"),N.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):N.REFLECTANCE=!1):(N.METALLIC_REFLECTANCE=!1,N.REFLECTANCE=!1),this._microSurfaceTexture?(0,d.O)(this._microSurfaceTexture,N,"MICROSURFACEMAP"):N.MICROSURFACEMAP=!1):(N.REFLECTIVITY=!1,N.MICROSURFACEMAP=!1),v.getCaps().standardDerivatives&&this._bumpTexture&&Z.b.BumpTextureEnabled&&!this._disableBumpMap?((0,d.O)(this._bumpTexture,N,"BUMP"),this._useParallax&&this._albedoTexture&&Z.b.DiffuseTextureEnabled?(N.PARALLAX=!0,N.PARALLAX_RHS=M.useRightHandedSystem,N.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):N.PARALLAX=!1,N.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(N.BUMP=!1,N.PARALLAX=!1,N.PARALLAX_RHS=!1,N.PARALLAXOCCLUSION=!1,N.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&Z.b.ReflectionTextureEnabled?(N.ENVIRONMENTBRDF=!0,N.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(N.ENVIRONMENTBRDF=!1,N.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?N.ALPHAFROMALBEDO=!0:N.ALPHAFROMALBEDO=!1}N.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===b.LIGHTFALLOFF_STANDARD?(N.USEPHYSICALLIGHTFALLOFF=!1,N.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===b.LIGHTFALLOFF_GLTF?(N.USEPHYSICALLIGHTFALLOFF=!1,N.USEGLTFLIGHTFALLOFF=!0):(N.USEPHYSICALLIGHTFALLOFF=!0,N.USEGLTFLIGHTFALLOFF=!1),N.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.re&&this._twoSidedLighting?N.TWOSIDEDLIGHTING=!0:N.TWOSIDEDLIGHTING=!1,N.SPECULARAA=v.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(N._areTexturesDirty||N._areMiscDirty)&&(N.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,N.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,N.ALPHABLEND=this.needAlphaBlendingForMesh(R),N.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,N.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),N._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(N),N.FORCENORMALFORWARD=this._forceNormalForward,N.RADIANCEOCCLUSION=this._useRadianceOcclusion,N.HORIZONOCCLUSION=this._useHorizonOcclusion,N._areMiscDirty&&((0,d.Q)(R,M,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(R)||this._forceAlphaTest,N,this._applyDecalMapAfterDetailMap),N.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!R.isVerticesDataPresent(a.e.NormalKind),N.DEBUGMODE=this._debugMode),(0,d.H)(M,v,this,N,!!q,w,u),this._eventInfo.defines=N,this._eventInfo.mesh=R,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,d.G)(R,N,!0,!0,!0,this._transparencyMode!==b.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(R,N,q){const w={clipPlane:!1,useInstances:!1,...q};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const q=new c(this._eventInfo.defineNames),u=this._prepareEffect(R,q,void 0,void 0,w.useInstances,w.clipPlane,R.hasThinInstances);this._onEffectCreatedObservable&&(f.effect=u,f.subMesh=null,this._onEffectCreatedObservable.notifyObservers(f)),u.isReady()?N&&N(this):u.onCompileObservable.add((()=>{N&&N(this)}))})()}buildUniformLayout(){const R=this._uniformBuffer;R.addUniform("vAlbedoInfos",2),R.addUniform("vAmbientInfos",4),R.addUniform("vOpacityInfos",2),R.addUniform("vEmissiveInfos",2),R.addUniform("vLightmapInfos",2),R.addUniform("vReflectivityInfos",3),R.addUniform("vMicroSurfaceSamplerInfos",2),R.addUniform("vReflectionInfos",2),R.addUniform("vReflectionFilteringInfo",2),R.addUniform("vReflectionPosition",3),R.addUniform("vReflectionSize",3),R.addUniform("vBumpInfos",3),R.addUniform("albedoMatrix",16),R.addUniform("ambientMatrix",16),R.addUniform("opacityMatrix",16),R.addUniform("emissiveMatrix",16),R.addUniform("lightmapMatrix",16),R.addUniform("reflectivityMatrix",16),R.addUniform("microSurfaceSamplerMatrix",16),R.addUniform("bumpMatrix",16),R.addUniform("vTangentSpaceParams",2),R.addUniform("reflectionMatrix",16),R.addUniform("vReflectionColor",3),R.addUniform("vAlbedoColor",4),R.addUniform("vLightingIntensity",4),R.addUniform("vReflectionMicrosurfaceInfos",3),R.addUniform("pointSize",1),R.addUniform("vReflectivityColor",4),R.addUniform("vEmissiveColor",3),R.addUniform("vAmbientColor",3),R.addUniform("vDebugMode",2),R.addUniform("vMetallicReflectanceFactors",4),R.addUniform("vMetallicReflectanceInfos",2),R.addUniform("metallicReflectanceMatrix",16),R.addUniform("vReflectanceInfos",2),R.addUniform("reflectanceMatrix",16),R.addUniform("vSphericalL00",3),R.addUniform("vSphericalL1_1",3),R.addUniform("vSphericalL10",3),R.addUniform("vSphericalL11",3),R.addUniform("vSphericalL2_2",3),R.addUniform("vSphericalL2_1",3),R.addUniform("vSphericalL20",3),R.addUniform("vSphericalL21",3),R.addUniform("vSphericalL22",3),R.addUniform("vSphericalX",3),R.addUniform("vSphericalY",3),R.addUniform("vSphericalZ",3),R.addUniform("vSphericalXX_ZZ",3),R.addUniform("vSphericalYY_ZZ",3),R.addUniform("vSphericalZZ",3),R.addUniform("vSphericalXY",3),R.addUniform("vSphericalYZ",3),R.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(R,N,q){const w=this.va(),u=q.materialDefines;if(!u)return;const M=q.effect;if(!M)return;this._activeEffect=M,N.getMeshUniformBuffer().bindToEffect(M,"Mesh"),N.transferToEffect(R);const v=w.getEngine();this._uniformBuffer.bindToEffect(M,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,w,N,R,this.isFrozen),T.c.Bind(v.currentRenderPassId,this._activeEffect,N,R),this._eventInfo.subMesh=q,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),u.OBJECTSPACE_NORMALMAP&&(R.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const G=this._mustRebind(w,M,q,N.visibility);(0,d.c)(N,this._activeEffect,this.prePassConfiguration);let y=null;const a=this._uniformBuffer;if(G){if(this.bindViewProjection(M),y=this._getReflectionTexture(),!a.useUbo||!this.isFrozen||!a.isSync||q._drawWrapper._forceRebindOnNextCall){var j;if(w.texturesEnabled){if(this._albedoTexture&&Z.b.DiffuseTextureEnabled&&(a.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,d.s)(this._albedoTexture,a,"albedo")),this._ambientTexture&&Z.b.AmbientTextureEnabled&&(a.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,d.s)(this._ambientTexture,a,"ambient")),this._opacityTexture&&Z.b.OpacityTextureEnabled&&(a.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,d.s)(this._opacityTexture,a,"opacity")),y&&Z.b.ReflectionTextureEnabled){if(a.ve("reflectionMatrix",y.getReflectionTextureMatrix()),a.updateFloat2("vReflectionInfos",y.level,0),y.boundingBoxSize){const R=y;a.updateVector3("vReflectionPosition",R.boundingBoxPosition),a.updateVector3("vReflectionSize",R.boundingBoxSize)}if(this.realTimeFiltering){const R=y.getSize().width;a.updateFloat2("vReflectionFilteringInfo",R,Math.log2(R))}if(!u.USEIRRADIANCEMAP){const R=y.sphericalPolynomial;if(u.USESPHERICALFROMREFLECTIONMAP&&R)if(u.SPHERICAL_HARMONICS){const N=R.preScaledHarmonics;a.updateVector3("vSphericalL00",N.l00),a.updateVector3("vSphericalL1_1",N.l1_1),a.updateVector3("vSphericalL10",N.l10),a.updateVector3("vSphericalL11",N.l11),a.updateVector3("vSphericalL2_2",N.l2_2),a.updateVector3("vSphericalL2_1",N.l2_1),a.updateVector3("vSphericalL20",N.l20),a.updateVector3("vSphericalL21",N.l21),a.updateVector3("vSphericalL22",N.l22)}else a.updateFloat3("vSphericalX",R.x.x,R.x.y,R.x.z),a.updateFloat3("vSphericalY",R.y.x,R.y.y,R.y.z),a.updateFloat3("vSphericalZ",R.z.x,R.z.y,R.z.z),a.updateFloat3("vSphericalXX_ZZ",R.xx.x-R.zz.x,R.xx.y-R.zz.y,R.xx.z-R.zz.z),a.updateFloat3("vSphericalYY_ZZ",R.yy.x-R.zz.x,R.yy.y-R.zz.y,R.yy.z-R.zz.z),a.updateFloat3("vSphericalZZ",R.zz.x,R.zz.y,R.zz.z),a.updateFloat3("vSphericalXY",R.xy.x,R.xy.y,R.xy.z),a.updateFloat3("vSphericalYZ",R.yz.x,R.yz.y,R.yz.z),a.updateFloat3("vSphericalZX",R.zx.x,R.zx.y,R.zx.z)}a.updateFloat3("vReflectionMicrosurfaceInfos",y.getSize().width,y.lodGenerationScale,y.lodGenerationOffset)}this._emissiveTexture&&Z.b.EmissiveTextureEnabled&&(a.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,d.s)(this._emissiveTexture,a,"emissive")),this._lightmapTexture&&Z.b.LightmapTextureEnabled&&(a.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,d.s)(this._lightmapTexture,a,"lightmap")),Z.b.SpecularTextureEnabled&&(this._metallicTexture?(a.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,d.s)(this._metallicTexture,a,"reflectivity")):this._reflectivityTexture&&(a.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,d.s)(this._reflectivityTexture,a,"reflectivity")),this._metallicReflectanceTexture&&(a.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,d.s)(this._metallicReflectanceTexture,a,"metallicReflectance")),this._reflectanceTexture&&u.REFLECTANCE&&(a.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,d.s)(this._reflectanceTexture,a,"reflectance")),this._microSurfaceTexture&&(a.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,d.s)(this._microSurfaceTexture,a,"microSurfaceSampler"))),this._bumpTexture&&v.getCaps().standardDerivatives&&Z.b.BumpTextureEnabled&&!this._disableBumpMap&&(a.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,d.s)(this._bumpTexture,a,"bump"),w._mirroredCameraPosition?a.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):a.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&a.updateFloat("pointSize",this.pointSize),u.METALLICWORKFLOW){var F;k.g.Be[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,k.g.Be[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,a.updateColor4("vReflectivityColor",k.g.Be[0],1);const R=(null===(F=this.subSurface)||void 0===F?void 0:F._indexOfRefraction)??1.5,N=1,q=Math.pow((R-N)/(R+N),2);this._metallicReflectanceColor.scaleToRef(q*this._metallicF0Factor,k.g.Be[0]);const w=this._metallicF0Factor;a.updateColor4("vMetallicReflectanceFactors",k.g.Be[0],w)}else a.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);a.updateColor3("vEmissiveColor",Z.b.EmissiveTextureEnabled?this._emissiveColor:k.c.BlackReadOnly),a.updateColor3("vReflectionColor",this._reflectionColor),!u.SS_REFRACTION&&null!==(j=this.subSurface)&&void 0!==j&&j._linkRefractionWithTransparency?a.updateColor4("vAlbedoColor",this._albedoColor,1):a.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*w.environmentIntensity,this._lightingInfos.w=this._specularIntensity,a.updateVector4("vLightingIntensity",this._lightingInfos),w.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),a.updateColor3("vAmbientColor",this._globalAmbientColor),a.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}w.texturesEnabled&&(this._albedoTexture&&Z.b.DiffuseTextureEnabled&&a.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&Z.b.AmbientTextureEnabled&&a.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&Z.b.OpacityTextureEnabled&&a.setTexture("opacitySampler",this._opacityTexture),y&&Z.b.ReflectionTextureEnabled&&(u.LODBASEDMICROSFURACE?a.setTexture("reflectionSampler",y):(a.setTexture("reflectionSampler",y._lodTextureMid||y),a.setTexture("reflectionSamplerLow",y._lodTextureLow||y),a.setTexture("reflectionSamplerHigh",y._lodTextureHigh||y)),u.USEIRRADIANCEMAP&&a.setTexture("irradianceSampler",y.irradianceTexture)),u.ENVIRONMENTBRDF&&a.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&Z.b.EmissiveTextureEnabled&&a.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&Z.b.LightmapTextureEnabled&&a.setTexture("lightmapSampler",this._lightmapTexture),Z.b.SpecularTextureEnabled&&(this._metallicTexture?a.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&a.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&a.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&u.REFLECTANCE&&a.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&a.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&v.getCaps().standardDerivatives&&Z.b.BumpTextureEnabled&&!this._disableBumpMap&&a.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(N)&&this.va().depthPeelingRenderer.bind(M),this._eventInfo.subMesh=q,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,Y.d)(this._activeEffect,this,w),this.bindEyePosition(M)}else w.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(G||!this.isFrozen){var S;if(w.lightsEnabled&&!this._disableLighting&&(0,d.i)(w,N,this._activeEffect,u,this._maxSimultaneousLights),(w.fogEnabled&&N.applyFog&&w.fogMode!==J.e.FOGMODE_NONE||y||this.subSurface.refractionTexture||N.receiveShadows||u.PREPASS)&&this.bindView(M),(0,d.g)(w,N,this._activeEffect,!0),u.NUM_MORPH_INFLUENCERS&&(0,d.n)(N,this._activeEffect),u.BAKED_VERTEX_ANIMATION_TEXTURE)null===(S=N.bakedVertexAnimationManager)||void 0===S||S.bind(M,u.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,d.m)(u,this._activeEffect,w)}this._afterBind(N,this._activeEffect,q),a.update()}getAnimatables(){const R=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&R.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&R.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&R.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&R.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&R.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?R.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&R.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&R.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&R.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&R.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&R.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&R.push(this._microSurfaceTexture),R}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const R=super.getActiveTextures();return this._albedoTexture&&R.push(this._albedoTexture),this._ambientTexture&&R.push(this._ambientTexture),this._opacityTexture&&R.push(this._opacityTexture),this._reflectionTexture&&R.push(this._reflectionTexture),this._emissiveTexture&&R.push(this._emissiveTexture),this._reflectivityTexture&&R.push(this._reflectivityTexture),this._metallicTexture&&R.push(this._metallicTexture),this._metallicReflectanceTexture&&R.push(this._metallicReflectanceTexture),this._reflectanceTexture&&R.push(this._reflectanceTexture),this._microSurfaceTexture&&R.push(this._microSurfaceTexture),this._bumpTexture&&R.push(this._bumpTexture),this._lightmapTexture&&R.push(this._lightmapTexture),R}hasTexture(R){return!!super.hasTexture(R)||(this._albedoTexture===R||(this._ambientTexture===R||(this._opacityTexture===R||(this._reflectionTexture===R||(this._emissiveTexture===R||(this._reflectivityTexture===R||(this._metallicTexture===R||(this._metallicReflectanceTexture===R||(this._reflectanceTexture===R||(this._microSurfaceTexture===R||(this._bumpTexture===R||this._lightmapTexture===R)))))))))))}setPrePassRenderer(){var R;if(null===(R=this.subSurface)||void 0===R||!R.isScatteringEnabled)return!1;const N=this.va().enableSubSurfaceForPrePass();return N&&(N.enabled=!0),!0}dispose(R,N){var q,w,u,M,v,G,J,y,a,j,F,S;(this._breakShaderLoadedCheck=!0,N)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(q=this._albedoTexture)||void 0===q||q.dispose(),null===(w=this._ambientTexture)||void 0===w||w.dispose(),null===(u=this._opacityTexture)||void 0===u||u.dispose(),null===(M=this._reflectionTexture)||void 0===M||M.dispose(),null===(v=this._emissiveTexture)||void 0===v||v.dispose(),null===(G=this._metallicTexture)||void 0===G||G.dispose(),null===(J=this._reflectivityTexture)||void 0===J||J.dispose(),null===(y=this._bumpTexture)||void 0===y||y.dispose(),null===(a=this._lightmapTexture)||void 0===a||a.dispose(),null===(j=this._metallicReflectanceTexture)||void 0===j||j.dispose(),null===(F=this._reflectanceTexture)||void 0===F||F.dispose(),null===(S=this._microSurfaceTexture)||void 0===S||S.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(R,N)}}b.PBRMATERIAL_OPAQUE=e.e.MATERIAL_OPAQUE,b.PBRMATERIAL_ALPHATEST=e.e.MATERIAL_ALPHATEST,b.PBRMATERIAL_ALPHABLEND=e.e.MATERIAL_ALPHABLEND,b.PBRMATERIAL_ALPHATESTANDBLEND=e.e.MATERIAL_ALPHATESTANDBLEND,b.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,b.LIGHTFALLOFF_PHYSICAL=0,b.LIGHTFALLOFF_GLTF=1,b.LIGHTFALLOFF_STANDARD=2,b.ForceGLSL=!1,(0,w.b)([(0,u.q)()],b.prototype,"_imageProcessingConfiguration",void 0),(0,w.b)([(0,u.c)("_markAllSubMeshesAsMiscDirty")],b.prototype,"debugMode",void 0)},12045:(R,N,q)=>{"use strict";q.d(N,{d:()=>F});var w=q(942),u=q(947),M=q(1177),v=q(966),G=q(1007),J=q(933),y=q(982),a=q(959),j=q(1128);q(1531);class F extends G.b{set boundingBoxSize(R){if(this._boundingBoxSize&&this._boundingBoxSize.equals(R))return;this._boundingBoxSize=R;const N=this.va();N&&N.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(R){this._rotationY=R,this.setReflectionTextureMatrix(v.c.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(R,N,q){let w="";return R.forEach((R=>w+=R)),new F(w,N,null,q,R)}static CreateFromPrefilteredData(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const u=N.useDelayedTextureLoading;N.useDelayedTextureLoading=!1;const M=new F(R,N,null,!1,null,null,null,void 0,!0,q,w);return N.useDelayedTextureLoading=u,M}constructor(R,N){var q;let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,F=arguments.length>8&&void 0!==arguments[8]&&arguments[8],S=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,H=arguments.length>10&&void 0!==arguments[10]&&arguments[10],W=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,k=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,C=arguments.length>13?arguments[13]:void 0,e=arguments.length>14?arguments[14]:void 0;super(N),this.onLoadObservable=new a.c,this.boundingBoxPosition=v.m.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new v.c,this._buffer=null,this.name=R,this.url=R,this._noMipmap=u,this.ac=!1,this.isCube=!0,this._textureMatrix=v.c.Identity(),this.coordinatesMode=J.e.CUBIC_MODE;let K=null,r=null;null===w||Array.isArray(w)?(this._noMipmap=u,this._format=j,this._createPolynomials=H,K=w,this._loaderOptions=C,this._useSRGBBuffer=e,this._lodScale=W,this._lodOffset=k):(K=w.extensions??null,this._noMipmap=w.noMipmap??!1,M=w.files??null,r=w.buffer??null,this._format=w.format??5,F=w.prefiltered??!1,S=w.forcedExtension??null,this._createPolynomials=w.createPolynomials??!1,this._lodScale=w.lodScale??.8,this._lodOffset=w.lodOffset??0,this._loaderOptions=w.loaderOptions,this._useSRGBBuffer=w.useSRGBBuffer,G=w.X??null,y=w.onError??null),(R||M)&&this.updateURL(R,S,G,F,y,K,null===(q=this.va())||void 0===q?void 0:q.useDelayedTextureLoading,M,r)}getClassName(){return"CubeTexture"}updateURL(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,M=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=R),this.url=R,N&&(this._forcedExtension=N);const y=R.lastIndexOf("."),a=N||(y>-1?R.substring(y).toLowerCase():""),j=0===a.indexOf(".dds"),F=0===a.indexOf(".env"),S=0===a.indexOf(".basis");if(F?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=w,w&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),G)this._files=G;else if(S||F||j||M||(M=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,M){for(let N=0;N<M.length;N++)this._files.push(R+M[N]);this._extensions=M}this._buffer=J,v?(this.delayLoadState=4,this._delayedOnLoad=q,this._delayedOnError=u):this._loadTexture(q,u)}delayLoad(R){4===this.delayLoadState&&(R&&(this._forcedExtension=R),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(R){var N,q;if(R.updateFlag===this._textureMatrix.updateFlag)return;R.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(q=this.va())||void 0===q||q.markAllMaterialsAsDirty(1,(R=>-1!==R.getActiveTextures().indexOf(this))));if(this._textureMatrix=R,null===(N=this.va())||void 0===N||!N.useRightHandedSystem)return;const w=v.f.Od[0],u=v.f.Quaternion[0],M=v.f.Od[1];this._textureMatrix.decompose(w,u,M),u.z*=-1,u.w*=-1,v.c.ComposeToRef(w,u,M,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var R;return null!==(R=this.va())&&void 0!==R&&R.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=this.va(),w=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const u=()=>{var N;(this.onLoadObservable.notifyObservers(this),w)&&(w.dispose(),null===(N=this.va())||void 0===N||N.markAllMaterialsAsDirty(1));R&&R()},v=(R,q)=>{this._loadingError=!0,this._errorObject={message:R,exception:q},N&&N(R,q),J.e.OnTextureLoadErrorObservable.notifyObservers(this)};var G;this._texture?this._texture.isReady?M.i.SetImmediate((()=>u())):this._texture.onLoadedObservable.add((()=>u())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,q,this._lodScale,this._lodOffset,R,v,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,q,this._files,this._noMipmap,R,v,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(G=this._texture)||void 0===G||G.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(R,N,q){const w=j.e.Parse((()=>{let w=!1;return R.prefiltered&&(w=R.prefiltered),new F(q+(R.url??R.name),N,R.extensions,!1,R.files||null,null,null,void 0,w,R.forcedExtension)}),R,N);if(R.boundingBoxPosition&&(w.boundingBoxPosition=v.m.Sd(R.boundingBoxPosition)),R.boundingBoxSize&&(w.boundingBoxSize=v.m.Sd(R.boundingBoxSize)),R.animations)for(let u=0;u<R.animations.length;u++){const N=R.animations[u],q=(0,y.e)("BABYLON.Animation");q&&w.animations.push(q.Parse(N))}return w}clone(){let R=0;const N=j.e.Clone((()=>{const N=new F(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return R=N.uniqueId,N}),this);return N.uniqueId=R,N}}(0,w.b)([(0,u.E)()],F.prototype,"url",void 0),(0,w.b)([(0,u.C)()],F.prototype,"boundingBoxPosition",void 0),(0,w.b)([(0,u.C)()],F.prototype,"boundingBoxSize",null),(0,w.b)([(0,u.E)("rotationY")],F.prototype,"rotationY",null),(0,w.b)([(0,u.E)("files")],F.prototype,"_files",void 0),(0,w.b)([(0,u.E)("forcedExtension")],F.prototype,"_forcedExtension",void 0),(0,w.b)([(0,u.E)("extensions")],F.prototype,"_extensions",void 0),(0,w.b)([(0,u.r)("textureMatrix")],F.prototype,"_textureMatrix",void 0),(0,w.b)([(0,u.r)("textureMatrixRefraction")],F.prototype,"_textureMatrixRefraction",void 0),J.e._CubeTextureParser=F.Parse,(0,y.h)("BABYLON.CubeTexture",F)},12375:(R,N,q)=>{"use strict";q.d(N,{b:()=>J});var w=q(1056),u=q(933),M=q(1189),v=q(1411),G=q(1104);v.ThinEngine.prototype.createDynamicTexture=function(R,N,q,w){const u=new G.d(this,4);return u.baseWidth=R,u.baseHeight=N,q&&(R=this.needPOTTextures?(0,M.e)(R,this._caps.maxTextureSize):R,N=this.needPOTTextures?(0,M.e)(N,this._caps.maxTextureSize):N),u.width=R,u.height=N,u.isReady=!1,u.generateMipMaps=q,u.samplingMode=w,this.updateTextureSamplingMode(w,u),this._internalTexturesCache.push(u),u},v.ThinEngine.prototype.updateDynamicTexture=function(R,N,q){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4?arguments[4]:void 0,M=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!R)return;const v=this._gl,G=v.TEXTURE_2D,J=this._bindTextureDirectly(G,R,!0,M);this._unpackFlipY(void 0===q?R.invertY:q),w&&v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const y=this._getWebGLTextureType(R.type),a=this._getInternalFormat(u||R.format),j=this._getRGBABufferInternalSizedFormat(R.type,a);v.texImage2D(G,0,j,a,y,N),R.generateMipMaps&&v.generateMipmap(G),J||this._bindTextureDirectly(G,null),w&&v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),u&&(R.format=u),R._dynamicTextureSource=N,R._premulAlpha=w,R.invertY=q||!1,R.isReady=!0};class J extends u.e{constructor(R,N,q){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,G=arguments.length>6?arguments[6]:void 0;const J=!q||q._isScene;super(null,J?q:null===q||void 0===q?void 0:q.Ke,J?!w:q,G,M,void 0,void 0,void 0,void 0,v),this.name=R,this.wrapU=u.e.CLAMP_ADDRESSMODE,this.wrapV=u.e.CLAMP_ADDRESSMODE,this._generateMipMaps=w;const y=this._getEngine();if(!y)return;if(N.getContext)this._canvas=N,this._ownCanvas=!1,this._texture=y.createDynamicTexture(this._canvas.width,this._canvas.height,w,M);else{this._canvas=y.createCanvas(1,1),this._ownCanvas=!0;const R=N;R.width||0===R.width?this._texture=y.createDynamicTexture(R.width,R.height,w,M):this._texture=y.createDynamicTexture(N,N,w,M)}const a=this.getSize();this._canvas.width!==a.width&&(this._canvas.width=a.width),this._canvas.height!==a.height&&(this._canvas.height=a.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(R){this._canvas.width=R.width,this._canvas.height=R.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(R.width,R.height,this._generateMipMaps,this.samplingMode)}scale(R){const N=this.getSize();N.width*=R,N.height*=R,this._recreate(N)}scaleTo(R,N){const q=this.getSize();q.width=R,q.height=N,this._recreate(q)}getContext(){return this._context}clear(R){const N=this.getSize();R&&(this._context.fillStyle=R),this._context.clearRect(0,0,N.width,N.height)}update(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===R||R,N,this._format||void 0,void 0,q)}drawText(R,N,q,w,u,M,v){let G=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const J=this.getSize();if(M&&(this._context.fillStyle=M,this._context.fillRect(0,0,J.width,J.height)),this._context.font=w,null===N||void 0===N){const q=this._context.measureText(R);N=(J.width-q.width)/2}if(null===q||void 0===q){const R=parseInt(w.replace(/\D/g,""));q=J.height/2+R/3.65}this._context.fillStyle=u||"",this._context.fillText(R,N,q),G&&this.update(v)}dispose(){var R,N;(super.dispose(),this._ownCanvas)&&(null===(R=this._canvas)||void 0===R||null===(N=R.remove)||void 0===N||N.call(R));this._canvas=null,this._context=null}clone(){const R=this.va();if(!R)return this;const N=this.getSize(),q=new J(this.name,N,R,this._generateMipMaps);return q.ac=this.ac,q.level=this.level,q.wrapU=this.wrapU,q.wrapV=this.wrapV,q}serialize(){const R=this.va();R&&!R.isReady()&&w.e.Warn("The scene must be ready before serializing the dynamic texture");const N=super.serialize();return J._IsCanvasElement(this._canvas)&&(N.base64String=this._canvas.toDataURL()),N.invertY=this._invertY,N.samplingMode=this.samplingMode,N}static _IsCanvasElement(R){return void 0!==R.toDataURL}_rebuild(){this.update()}}},11545:(R,N,q)=>{"use strict";q.d(N,{c:()=>u});var w=q(933);class u extends w.e{constructor(R,N,q,u,M){let v=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,a=arguments.length>9?arguments[9]:void 0,j=arguments.length>10?arguments[10]:void 0;super(null,M,!v,G,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,a),this.format=u,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==y||(J=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==y||(J=1),this._texture=this._engine.createRawTexture(R,N,q,u,v,G,J,null,y,a??0,j??!1),this.wrapU=w.e.CLAMP_ADDRESSMODE,this.wrapV=w.e.CLAMP_ADDRESSMODE)}update(R){this._getEngine().updateRawTexture(this._texture,R,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const R=new u(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return R._texture=this._texture,this._texture.incrementReferences(),R}static CreateLuminanceTexture(R,N,q,w){return new u(R,N,q,1,w,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(R,N,q,w){return new u(R,N,q,2,w,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(R,N,q,w){return new u(R,N,q,0,w,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(R,N,q,w){return new u(R,N,q,4,w,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(R,N,q,w){return new u(R,N,q,5,w,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(R,N,q,w){return new u(R,N,q,5,w,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(R,N,q,M){let v=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:w.e.TRILINEAR_SAMPLINGMODE;return new u(R,N,q,6,M,v,G,J,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(R,N,q,M){let v=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:w.e.TRILINEAR_SAMPLINGMODE;return new u(R,N,q,6,M,v,G,J,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11429:(R,N,q)=>{"use strict";q.d(N,{d:()=>v});var w=q(1306),u=q(1131),M=q(982);class v extends w.e{get Hg(){return this._subMaterials}set Hg(R){this._subMaterials=R,this._hookArray(R)}getChildren(){return this.Hg}constructor(R,N){super(R,N,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.Hg=[],this._storeEffectOnSubMeshes=!0}_hookArray(R){var N=this;const q=R.push;R.push=function(){for(var w=arguments.length,u=new Array(w),M=0;M<w;M++)u[M]=arguments[M];const v=q.apply(R,u);return N._markAllSubMeshesAsTexturesDirty(),v};const w=R.splice;R.splice=(N,q)=>{const u=w.apply(R,[N,q]);return this._markAllSubMeshesAsTexturesDirty(),u}}getSubMaterial(R){return R<0||R>=this.Hg.length?this.va().defaultMaterial:this.Hg[R]}getActiveTextures(){return super.getActiveTextures().concat(...this.Hg.map((R=>R?R.getActiveTextures():[])))}hasTexture(R){if(super.hasTexture(R))return!0;for(let q=0;q<this.Hg.length;q++){var N;if(null!==(N=this.Hg[q])&&void 0!==N&&N.hasTexture(R))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(R,N,q){for(let w=0;w<this.Hg.length;w++){const u=this.Hg[w];if(u){if(u._storeEffectOnSubMeshes){if(!u.isReadyForSubMesh(R,N,q))return!1;continue}if(!u.isReady(R))return!1}}return!0}clone(R,N){const q=new v(R,this.va());for(let w=0;w<this.Hg.length;w++){let u=null;const M=this.Hg[w];u=N&&M?M.clone(R+"-"+M.name):this.Hg[w],q.Hg.push(u)}return q}serialize(){const R={};R.name=this.name,R.id=this.id,R.uniqueId=this.uniqueId,u.d&&(R.tags=u.d.GetTags(this)),R.materialsUniqueIds=[],R.materials=[];for(let N=0;N<this.Hg.length;N++){const q=this.Hg[N];q?(R.materialsUniqueIds.push(q.uniqueId),R.materials.push(q.id)):(R.materialsUniqueIds.push(null),R.materials.push(null))}return R}dispose(R,N,q){const w=this.va();if(!w)return;if(q)for(let M=0;M<this.Hg.length;M++){const q=this.Hg[M];q&&q.dispose(R,N)}const u=w.multiMaterials.indexOf(this);u>=0&&w.multiMaterials.splice(u,1),super.dispose(R,N)}static ParseMultiMaterial(R,N){const q=new v(R.name,N);return q.id=R.id,q._loadedUniqueId=R.uniqueId,u.d&&u.d.AddTagsTo(q,R.tags),R.materialsUniqueIds?q._waitingSubMaterialsUniqueIds=R.materialsUniqueIds:R.materials.forEach((R=>q.Hg.push(N.getLastMaterialById(R)))),q}}(0,M.h)("BABYLON.MultiMaterial",v)},11433:(R,N,q)=>{"use strict";q.d(N,{c:()=>a,f:()=>y});var w=q(966),u=q(1133),M=q(11381),v=q(11403),G=q(1159);q(11437);function J(R){let N=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const q=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],M=[];let J=[];const y=R.width||R.size||1,a=R.height||R.size||1,j=R.depth||R.size||1,F=R.wrap||!1;let S=void 0===R.topBaseAt?1:R.topBaseAt,H=void 0===R.bottomBaseAt?0:R.bottomBaseAt;S=(S+4)%4,H=(H+4)%4;let W=[2,0,3,1][S],k=[2,0,1,3][H],C=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(F){N=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],C=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let R=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],q=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const w=[17,18,19,16],u=[22,23,20,21];for(;W>0;)R.unshift(R.pop()),w.unshift(w.pop()),W--;for(;k>0;)q.unshift(q.pop()),u.unshift(u.pop()),k--;R=R.flat(),q=q.flat(),C=C.concat(R).concat(q),N.push(w[0],w[2],w[3],w[0],w[1],w[2]),N.push(u[0],u[2],u[3],u[0],u[1],u[2])}const e=[y/2,a/2,j/2];J=C.reduce(((R,N,q)=>R.concat(N*e[q%3])),[]);const K=0===R.sideOrientation?0:R.sideOrientation||v.d.DEFAULTSIDE,r=R.faceUV||new Array(6),Z=R.faceColors,z=[];for(let v=0;v<6;v++)void 0===r[v]&&(r[v]=new w.n(0,0,1,1)),Z&&void 0===Z[v]&&(Z[v]=new u.d(1,1,1,1));for(let w=0;w<6;w++)if(M.push(r[w].z,G.e?1-r[w].w:r[w].w),M.push(r[w].x,G.e?1-r[w].w:r[w].w),M.push(r[w].x,G.e?1-r[w].y:r[w].y),M.push(r[w].z,G.e?1-r[w].y:r[w].y),Z)for(let R=0;R<4;R++)z.push(Z[w].r,Z[w].g,Z[w].b,Z[w].a);v.d._ComputeSides(K,J,N,q,M,R.frontUVs,R.backUVs);const d=new v.d;if(d.indices=N,d.xa=J,d.ya=q,d.Aa=M,Z){const R=K===v.d.DOUBLESIDE?z.concat(z):z;d.za=R}return d}function y(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new M.b(R,q);N.sideOrientation=M.b._GetDefaultSideOrientation(N.sideOrientation),w._originalBuilderSideOrientation=N.sideOrientation;return J(N).Ca(w,N.updatable),w}const a={CreateBox:y};v.d.CreateBox=J,M.b.CreateBox=function(R,N){return y(R,{size:N,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11557:(R,N,q)=>{"use strict";q.d(N,{b:()=>G});var w=q(11381),u=q(11403),M=q(1159);function v(R){const N=[],q=[],w=[],v=[],G=R.i||.5,J=R.Sk||64,y=R.arc&&(R.arc<=0||R.arc>1)?1:R.arc||1,a=0===R.sideOrientation?0:R.sideOrientation||u.d.DEFAULTSIDE;N.push(0,0,0),v.push(.5,.5);const j=2*Math.PI*y,F=1===y?j/J:j/(J-1);let S=0;for(let u=0;u<J;u++){const R=Math.cos(S),q=Math.sin(S),w=(R+1)/2,u=(1-q)/2;N.push(G*R,G*q,0),v.push(w,M.e?1-u:u),S+=F}1===y&&(N.push(N[3],N[4],N[5]),v.push(v[2],M.e?1-v[3]:v[3]));const H=N.length/3;for(let u=1;u<H-1;u++)q.push(u+1,0,u);u.d.ComputeNormals(N,q,w),u.d._ComputeSides(a,N,q,w,v,R.frontUVs,R.backUVs);const W=new u.d;return W.indices=q,W.xa=N,W.ya=w,W.Aa=v,W}function G(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new w.b(R,q);N.sideOrientation=w.b._GetDefaultSideOrientation(N.sideOrientation),u._originalBuilderSideOrientation=N.sideOrientation;return v(N).Ca(u,N.updatable),u}u.d.kb=v,w.b.kb=function(R,N,q){return G(R,{i:N,Sk:q,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11437:(R,N,q)=>{"use strict";q.d(N,{g:()=>k,d:()=>e,k:()=>C});var w=q(966),u=q(1133),M=q(11381),v=q(11403),G=q(1227);M.b._GroundMeshParser=(R,N)=>J.Parse(R,N);class J extends M.b{constructor(R,N){super(R,N),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=R,this._subdivisionsY=R,this.subdivide(R);const q=this;q.createOrUpdateSubmeshesOctree&&q.createOrUpdateSubmeshesOctree(N)}getHeightAtCoordinates(R,N){const q=this.getWorldMatrix(),u=w.f.Matrix[5];q.invertToRef(u);const M=w.f.Od[8];if(w.m.TransformCoordinatesFromFloatsToRef(R,0,N,u,M),R=M.x,N=M.z,R<this._minX||R>=this._maxX||N<=this._minZ||N>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const v=this._getFacetAt(R,N),G=-(v.x*R+v.z*N+v.w)/v.y;return w.m.TransformCoordinatesFromFloatsToRef(0,G,0,q,M),M.y}getNormalAtCoordinates(R,N){const q=new w.m(0,1,0);return this.getNormalAtCoordinatesToRef(R,N,q),q}getNormalAtCoordinatesToRef(R,N,q){const u=this.getWorldMatrix(),M=w.f.Matrix[5];u.invertToRef(M);const v=w.f.Od[8];if(w.m.TransformCoordinatesFromFloatsToRef(R,0,N,M,v),R=v.x,N=v.z,R<this._minX||R>this._maxX||N<this._minZ||N>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const G=this._getFacetAt(R,N);return w.m.TransformNormalFromFloatsToRef(G.x,G.y,G.z,u,q),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(R,N){const q=Math.floor((R+this._maxX)*this._subdivisionsX/this._width),w=Math.floor(-(N+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),u=this._heightQuads[w*this._subdivisionsX+q];let M;return M=N<u.slope.x*R+u.slope.y?u.facet1:u.facet2,M}_initHeightQuads(){const R=this._subdivisionsX,N=this._subdivisionsY;this._heightQuads=new Array;for(let q=0;q<N;q++)for(let N=0;N<R;N++){const u={slope:w.j.Zero(),facet1:new w.n(0,0,0,0),facet2:new w.n(0,0,0,0)};this._heightQuads[q*R+N]=u}return this}_computeHeightQuads(){const R=this.getVerticesData(G.e.PositionKind);if(!R)return this;const N=w.f.Od[3],q=w.f.Od[2],u=w.f.Od[1],M=w.f.Od[0],v=w.f.Od[4],J=w.f.Od[5],y=w.f.Od[6],a=w.f.Od[7],j=w.f.Od[8];let F=0,S=0,H=0,W=0,k=0,C=0,e=0;const K=this._subdivisionsX,r=this._subdivisionsY;for(let G=0;G<r;G++)for(let r=0;r<K;r++){F=3*r,S=G*(K+1)*3,H=(G+1)*(K+1)*3,N.x=R[S+F],N.y=R[S+F+1],N.z=R[S+F+2],q.x=R[S+F+3],q.y=R[S+F+4],q.z=R[S+F+5],u.x=R[H+F],u.y=R[H+F+1],u.z=R[H+F+2],M.x=R[H+F+3],M.y=R[H+F+4],M.z=R[H+F+5],W=(M.z-N.z)/(M.x-N.x),k=N.z-W*N.x,q.subtractToRef(N,v),u.subtractToRef(N,J),M.subtractToRef(N,y),w.m.CrossToRef(y,J,a),w.m.CrossToRef(v,y,j),a.normalize(),j.normalize(),C=-(a.x*N.x+a.y*N.y+a.z*N.z),e=-(j.x*q.x+j.y*q.y+j.z*q.z);const Z=this._heightQuads[G*K+r];Z.slope.Rd(W,k),Z.facet1.Rd(a.x,a.y,a.z,C),Z.facet2.Rd(j.x,j.y,j.z,e)}return this}serialize(R){super.serialize(R),R.subdivisionsX=this._subdivisionsX,R.subdivisionsY=this._subdivisionsY,R.minX=this._minX,R.maxX=this._maxX,R.dj=this._minZ,R.maxZ=this._maxZ,R.width=this._width,R.height=this._height}static Parse(R,N){const q=new J(R.name,N);return q._subdivisionsX=R.subdivisionsX||1,q._subdivisionsY=R.subdivisionsY||1,q._minX=R.minX,q._maxX=R.maxX,q._minZ=R.dj,q._maxZ=R.maxZ,q._width=R.width,q._height=R.height,q}}var y=q(1177),a=q(997),j=q(974),F=q(1159);function S(R){const N=[],q=[],u=[],M=[];let G,J;const y=R.width||R.size||1,a=R.height||R.size||1,j=0|(R.subdivisionsX||R.subdivisions||1),S=0|(R.subdivisionsY||R.subdivisions||1);for(G=0;G<=S;G++)for(J=0;J<=j;J++){const R=new w.m(J*y/j-y/2,0,(S-G)*a/S-a/2),N=new w.m(0,1,0);q.push(R.x,R.y,R.z),u.push(N.x,N.y,N.z),M.push(J/j,F.e?G/S:1-G/S)}for(G=0;G<S;G++)for(J=0;J<j;J++)N.push(J+1+(G+1)*(j+1)),N.push(J+1+G*(j+1)),N.push(J+G*(j+1)),N.push(J+(G+1)*(j+1)),N.push(J+1+(G+1)*(j+1)),N.push(J+G*(j+1));const H=new v.d;return H.indices=N,H.xa=q,H.ya=u,H.Aa=M,H}function H(R){const N=void 0!==R.xmin&&null!==R.xmin?R.xmin:-1,q=void 0!==R.zmin&&null!==R.zmin?R.zmin:-1,u=void 0!==R.xmax&&null!==R.xmax?R.xmax:1,M=void 0!==R.zmax&&null!==R.zmax?R.zmax:1,G=R.subdivisions||{w:1,h:1},J=R.precision||{w:1,h:1},y=[],a=[],j=[],F=[];let S,H,W,k;G.h=G.h<1?1:G.h,G.w=G.w<1?1:G.w,J.w=J.w<1?1:J.w,J.h=J.h<1?1:J.h;const C=(u-N)/G.w,e=(M-q)/G.h;function K(R,N,q,u){const M=a.length/3,v=J.w+1;for(S=0;S<J.h;S++)for(H=0;H<J.w;H++){const R=[M+H+S*v,M+(H+1)+S*v,M+(H+1)+(S+1)*v,M+H+(S+1)*v];y.push(R[1]),y.push(R[2]),y.push(R[3]),y.push(R[0]),y.push(R[1]),y.push(R[3])}const G=w.m.Zero(),W=new w.m(0,1,0);for(S=0;S<=J.h;S++)for(G.z=S*(u-N)/J.h+N,H=0;H<=J.w;H++)G.x=H*(q-R)/J.w+R,G.y=0,a.push(G.x,G.y,G.z),j.push(W.x,W.y,W.z),F.push(H/J.w,S/J.h)}for(W=0;W<G.h;W++)for(k=0;k<G.w;k++)K(N+k*C,q+W*e,N+(k+1)*C,q+(W+1)*e);const r=new v.d;return r.indices=y,r.xa=a,r.ya=j,r.Aa=F,r}function W(R){const N=[],q=[],M=[],G=[];let J,y;const a=R.colorFilter||new u.c(.3,.59,.11),F=R.alphaFilter||0;let S=!1;if(R.minHeight>R.maxHeight){S=!0;const N=R.maxHeight;R.maxHeight=R.minHeight,R.minHeight=N}for(J=0;J<=R.subdivisions;J++)for(y=0;y<=R.subdivisions;y++){const N=new w.m(y*R.width/R.subdivisions-R.width/2,0,(R.subdivisions-J)*R.height/R.subdivisions-R.height/2),u=4*(((N.x+R.width/2)/R.width*(R.bufferWidth-1)|0)+((1-(N.z+R.height/2)/R.height)*(R.bufferHeight-1)|0)*R.bufferWidth);let v=R.buffer[u]/255,H=R.buffer[u+1]/255,W=R.buffer[u+2]/255;const k=R.buffer[u+3]/255;S&&(v=1-v,H=1-H,W=1-W);const C=v*a.r+H*a.g+W*a.b;N.y=k>=F?R.minHeight+(R.maxHeight-R.minHeight)*C:R.minHeight-j.b,R.heightBuffer&&(R.heightBuffer[J*(R.subdivisions+1)+y]=N.y),q.push(N.x,N.y,N.z),M.push(0,0,0),G.push(y/R.subdivisions,1-J/R.subdivisions)}for(J=0;J<R.subdivisions;J++)for(y=0;y<R.subdivisions;y++){const w=y+1+(J+1)*(R.subdivisions+1),u=y+1+J*(R.subdivisions+1),M=y+J*(R.subdivisions+1),v=y+(J+1)*(R.subdivisions+1),G=q[3*w+1]>=R.minHeight,a=q[3*u+1]>=R.minHeight,j=q[3*M+1]>=R.minHeight;G&&a&&j&&(N.push(w),N.push(u),N.push(M));q[3*v+1]>=R.minHeight&&G&&j&&(N.push(v),N.push(w),N.push(M))}v.d.ComputeNormals(q,N,M);const H=new v.d;return H.indices=N,H.xa=q,H.ya=M,H.Aa=G,H}function k(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const q=new J(R,arguments.length>2?arguments[2]:void 0);q._setReady(!1),q._subdivisionsX=N.subdivisionsX||N.subdivisions||1,q._subdivisionsY=N.subdivisionsY||N.subdivisions||1,q._width=N.width||1,q._height=N.height||1,q._maxX=q._width/2,q._maxZ=q._height/2,q._minX=-q._maxX,q._minZ=-q._maxZ;return S(N).Ca(q,N.updatable),q._setReady(!0),q}function C(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new M.b(R,q);return H(N).Ca(w,N.updatable),w}function e(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const M=q.width||10,v=q.height||10,G=q.subdivisions||1,j=q.minHeight||0,F=q.maxHeight||1,S=q.colorFilter||new u.c(.3,.59,.11),H=q.alphaFilter||0,k=q.updatable,C=q.onReady;w=w||a.e.LastCreatedScene;const e=new J(R,w);let K;e._subdivisionsX=G,e._subdivisionsY=G,e._width=M,e._height=v,e._maxX=e._width/2,e._maxZ=e._height/2,e._minX=-e._maxX,e._minZ=-e._maxZ,e._setReady(!1),q.passHeightBufferInCallback&&(K=new Float32Array((G+1)*(G+1)));const r=(R,N,q)=>{W({width:M,height:v,subdivisions:G,minHeight:j,maxHeight:F,colorFilter:S,buffer:R,bufferWidth:N,bufferHeight:q,alphaFilter:H,heightBuffer:K}).Ca(e,k),C&&C(e,K),e._setReady(!0)};if("string"===typeof N){const R=R=>{var N;const q=R.width,u=R.height;if(w.u)return;const M=null===(N=w)||void 0===N?void 0:N.getEngine().resizeImageBitmap(R,q,u);r(M,q,u)};y.i.LoadImage(N,R,q.onError?q.onError:()=>{},w.offlineProvider)}else r(N.data,N.width,N.height);return e}v.d.CreateGround=S,v.d.CreateTiledGround=H,v.d.CreateGroundFromHeightMap=W,M.b.CreateGround=(R,N,q,w,u,M)=>k(R,{width:N,height:q,subdivisions:w,updatable:M},u),M.b.CreateTiledGround=(R,N,q,w,u,M,v,G,J)=>C(R,{xmin:N,zmin:q,xmax:w,zmax:u,subdivisions:M,precision:v,updatable:J},G),M.b.CreateGroundFromHeightMap=(R,N,q,w,u,M,v,G,J,y,a)=>e(R,N,{width:q,height:w,subdivisions:u,minHeight:M,maxHeight:v,updatable:J,onReady:y,alphaFilter:a},G)},12366:(R,N,q)=>{"use strict";q.d(N,{d:()=>L,f:()=>s,j:()=>O});var w=q(966),u=q(11381),M=q(11403),v=q(1133),G=q(1227),J=q(12033),y=q(1306),a=q(1128),j=q(1174),F=q(933),S=q(982),H=q(1378),W=q(1019),k=q(1367),C=q(997),e=q(1357),K=q(1353);const r={effect:null,subMesh:null};class Z extends k.d{constructor(R,N,q){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(R,N,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new w.c,this._cachedWorldViewProjectionMatrix=new w.c,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=q,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","ke","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...u}}get shaderPath(){return this._shaderPath}set shaderPath(R){this._shaderPath=R}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(R){-1===this._options.uniforms.indexOf(R)&&this._options.uniforms.push(R)}setTexture(R,N){return-1===this._options.samplers.indexOf(R)&&this._options.samplers.push(R),this._textures[R]=N,this}removeTexture(R){delete this._textures[R]}setTextureArray(R,N){return-1===this._options.samplers.indexOf(R)&&this._options.samplers.push(R),this._checkUniform(R),this._textureArrays[R]=N,this}setExternalTexture(R,N){return-1===this._options.externalTextures.indexOf(R)&&this._options.externalTextures.push(R),this._externalTextures[R]=N,this}setFloat(R,N){return this._checkUniform(R),this._floats[R]=N,this}setInt(R,N){return this._checkUniform(R),this._ints[R]=N,this}setUInt(R,N){return this._checkUniform(R),this._uints[R]=N,this}setFloats(R,N){return this._checkUniform(R),this._floatsArrays[R]=N,this}setColor3(R,N){return this._checkUniform(R),this._colors3[R]=N,this}setColor3Array(R,N){return this._checkUniform(R),this._colors3Arrays[R]=N.reduce(((R,N)=>(N.toArray(R,R.length),R)),[]),this}setColor4(R,N){return this._checkUniform(R),this._colors4[R]=N,this}setColor4Array(R,N){return this._checkUniform(R),this._colors4Arrays[R]=N.reduce(((R,N)=>(N.toArray(R,R.length),R)),[]),this}setVector2(R,N){return this._checkUniform(R),this._vectors2[R]=N,this}setVector3(R,N){return this._checkUniform(R),this._vectors3[R]=N,this}setVector4(R,N){return this._checkUniform(R),this._vectors4[R]=N,this}setQuaternion(R,N){return this._checkUniform(R),this._quaternions[R]=N,this}setQuaternionArray(R,N){return this._checkUniform(R),this._quaternionsArrays[R]=N.reduce(((R,N)=>(N.toArray(R,R.length),R)),[]),this}setMatrix(R,N){return this._checkUniform(R),this._matrices[R]=N,this}setMatrices(R,N){this._checkUniform(R);const q=new Float32Array(16*N.length);for(let w=0;w<N.length;w++){N[w].copyToArray(q,16*w)}return this._matrixArrays[R]=q,this}setMatrix3x3(R,N){return this._checkUniform(R),this._matrices3x3[R]=N,this}setMatrix2x2(R,N){return this._checkUniform(R),this._matrices2x2[R]=N,this}setArray2(R,N){return this._checkUniform(R),this._vectors2Arrays[R]=N,this}setArray3(R,N){return this._checkUniform(R),this._vectors3Arrays[R]=N,this}setArray4(R,N){return this._checkUniform(R),this._vectors4Arrays[R]=N,this}setUniformBuffer(R,N){return-1===this._options.uniformBuffers.indexOf(R)&&this._options.uniformBuffers.push(R),this._uniformBuffers[R]=N,this}setTextureSampler(R,N){return-1===this._options.samplerObjects.indexOf(R)&&this._options.samplerObjects.push(R),this._textureSamplers[R]=N,this}setStorageBuffer(R,N){return-1===this._options.storageBuffers.indexOf(R)&&this._options.storageBuffers.push(R),this._storageBuffers[R]=N,this}setDefine(R,N){const q=R.trimEnd()+" ",w=this.options.defines.findIndex((N=>N===R||N.startsWith(q)));return w>=0&&this.options.defines.splice(w,1),("boolean"!==typeof N||N)&&this.options.defines.push(q+N),this}isReadyForSubMesh(R,N,q){return this.isReady(R,q,N)}isReady(R,N,q){var w;const u=q&&this._storeEffectOnSubMeshes;if(this.isFrozen){const R=u?q._drawWrapper:this._drawWrapper;if(R.effect&&R._wasPreviouslyReady&&R._wasPreviouslyUsingInstances===N)return!0}const M=this.va(),v=M.getEngine(),J=[],y=[],a=new H.b;let F=this._shaderPath,S=this._options.uniforms,W=this._options.uniformBuffers,k=this._options.samplers;v.getCaps().multiview&&M.activeCamera&&M.activeCamera.outputRenderTarget&&M.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,J.push("#define MULTIVIEW"),-1!==S.indexOf("viewProjection")&&-1===S.indexOf("viewProjectionR")&&S.push("viewProjectionR"));for(let G=0;G<this._options.defines.length;G++){const R=0===this._options.defines[G].indexOf("#define")?this._options.defines[G]:`#define ${this._options.defines[G]}`;J.push(R)}for(let G=0;G<this._options.attributes.length;G++)y.push(this._options.attributes[G]);if(R&&R.isVerticesDataPresent(G.e.ColorKind)&&(-1===y.indexOf(G.e.ColorKind)&&y.push(G.e.ColorKind),J.push("#define VERTEXCOLOR")),N&&(J.push("#define INSTANCES"),(0,K.eb)(y,this._materialHelperNeedsPreviousMatrices),null!==R&&void 0!==R&&R.hasThinInstances&&(J.push("#define THIN_INSTANCES"),R&&R.isVerticesDataPresent(G.e.ColorInstanceKind)&&(y.push(G.e.ColorInstanceKind),J.push("#define INSTANCESCOLOR")))),R&&R.useBones&&R.computeBonesUsingShaders&&R.skeleton){y.push(G.e.MatricesIndicesKind),y.push(G.e.MatricesWeightsKind),R.numBoneInfluencers>4&&(y.push(G.e.MatricesIndicesExtraKind),y.push(G.e.MatricesWeightsExtraKind));const N=R.skeleton;J.push("#define NUM_BONE_INFLUENCERS "+R.numBoneInfluencers),a.addCPUSkinningFallback(0,R),N.isUsingTextureForMatrices?(J.push("#define BONETEXTURE"),-1===S.indexOf("boneTextureWidth")&&S.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(J.push("#define BonesPerMesh "+(N.bones.length+1)),-1===S.indexOf("mBones")&&S.push("mBones"))}else J.push("#define NUM_BONE_INFLUENCERS 0");let C=0;const Z=R?R.morphTargetManager:null;if(Z){const R=Z.supportsUVs&&-1!==J.indexOf("#define UV1"),N=Z.supportsTangents&&-1!==J.indexOf("#define TANGENT"),q=Z.supportsNormals&&-1!==J.indexOf("#define NORMAL");C=Z.numMaxInfluencers||Z.numInfluencers,R&&J.push("#define MORPHTARGETS_UV"),N&&J.push("#define MORPHTARGETS_TANGENT"),q&&J.push("#define MORPHTARGETS_NORMAL"),C>0&&J.push("#define MORPHTARGETS"),Z.isUsingTextureForTargets&&(J.push("#define MORPHTARGETS_TEXTURE"),-1===S.indexOf("morphTargetTextureIndices")&&S.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),J.push("#define NUM_MORPH_INFLUENCERS "+C);for(let w=0;w<C;w++)y.push(G.e.PositionKind+w),q&&y.push(G.e.NormalKind+w),N&&y.push(G.e.TangentKind+w),R&&y.push(G.e.UVKind+"_"+w);C>0&&(S=S.slice(),S.push("morphTargetInfluences"),S.push("morphTargetCount"),S.push("morphTargetTextureInfo"),S.push("morphTargetTextureIndices"))}else J.push("#define NUM_MORPH_INFLUENCERS 0");if(R){const N=R.bakedVertexAnimationManager;N&&N.isEnabled&&(J.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===S.indexOf("bakedVertexAnimationSettings")&&S.push("bakedVertexAnimationSettings"),-1===S.indexOf("bakedVertexAnimationTextureSizeInverted")&&S.push("bakedVertexAnimationTextureSizeInverted"),-1===S.indexOf("bakedVertexAnimationTime")&&S.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,K.y)(y,R,J)}for(const G in this._textures)if(!this._textures[G].isReady())return!1;R&&this._shouldTurnAlphaTestOn(R)&&J.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,e.c)(S),(0,e.h)(this,M,J)),M.fogEnabled&&null!==R&&void 0!==R&&R.applyFog&&M.fogMode!==j.e.FOGMODE_NONE&&(J.push("#define FOG"),-1===S.indexOf("view")&&S.push("view"),-1===S.indexOf("vFogInfos")&&S.push("vFogInfos"),-1===S.indexOf("vFogColor")&&S.push("vFogColor")),this._useLogarithmicDepth&&(J.push("#define LOGARITHMICDEPTH"),-1===S.indexOf("logarithmicDepthConstant")&&S.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(S=S.slice(),W=W.slice(),k=k.slice(),F=this.customShaderNameResolve(this.name,S,W,k,J,y));const z=u?q._getDrawWrapper(void 0,!0):this._drawWrapper,d=(null===z||void 0===z?void 0:z.effect)??null,x=(null===z||void 0===z?void 0:z.defines)??null,E=J.join("\n");let P=d;return x!==E&&(P=v.createEffect(F,{attributes:y,uniformsNames:S,uniformBuffersNames:W,samplers:k,defines:E,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:C},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},v),u?q.setEffect(P,E,this._materialContext):z&&z.setEffect(P,E),this._onEffectCreatedObservable&&(r.effect=P,r.subMesh=q??(null===R||void 0===R?void 0:R.ae[0])??null,this._onEffectCreatedObservable.notifyObservers(r))),z._wasPreviouslyUsingInstances=!!N,!((null===(w=P)||void 0===w||!w.isReady())??1)&&(d!==P&&M.resetCachedMaterial(),z._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(R,N){const q=this.va(),w=N??this.getEffect();w&&(-1!==this._options.uniforms.indexOf("world")&&w.setMatrix("world",R),-1!==this._options.uniforms.indexOf("worldView")&&(R.multiplyToRef(q.getViewMatrix(),this._cachedWorldViewMatrix),w.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(R.multiplyToRef(q.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),w.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&w.setMatrix("view",q.getViewMatrix()))}bindForSubMesh(R,N,q){var w;this.bind(R,N,null===(w=q._drawWrapperOverride)||void 0===w?void 0:w.effect,q)}bind(R,N,q,w){const u=w&&this._storeEffectOnSubMeshes,M=q??(u?w.effect:this.getEffect());if(!M)return;const v=this.va();this._activeEffect=M,this.bindOnlyWorldMatrix(R,q);const G=this._options.uniformBuffers;let J=!1;if(M&&G&&G.length>0&&v.getEngine().supportsUniformBuffers)for(let j=0;j<G.length;++j){switch(G[j]){case"Mesh":N&&(N.getMeshUniformBuffer().bindToEffect(M,"Mesh"),N.transferToEffect(R));break;case"Scene":(0,K.o)(M,v.getSceneUniformBuffer()),v.finalizeSceneUbo(),J=!0}}const y=N&&u?this._mustRebind(v,M,w,N.visibility):v.getCachedMaterial()!==this;if(M&&y){let R;for(R in J||-1===this._options.uniforms.indexOf("view")||M.setMatrix("view",v.getViewMatrix()),J||-1===this._options.uniforms.indexOf("projection")||M.setMatrix("projection",v.getProjectionMatrix()),J||-1===this._options.uniforms.indexOf("viewProjection")||(M.setMatrix("viewProjection",v.getTransformMatrix()),this._multiview&&M.setMatrix("viewProjectionR",v._transformMatrixR)),v.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&M.setVector3("cameraPosition",v.activeCamera.globalPosition),(0,K.c)(N,M),(0,e.d)(M,this,v),this._useLogarithmicDepth&&(0,K.m)(u?w.materialDefines:M.defines,M,v),N&&(0,K.g)(v,N,M),this._textures)M.setTexture(R,this._textures[R]);for(R in this._textureArrays)M.setTextureArray(R,this._textureArrays[R]);for(R in this._ints)M.setInt(R,this._ints[R]);for(R in this._uints)M.setUInt(R,this._uints[R]);for(R in this._floats)M.setFloat(R,this._floats[R]);for(R in this._floatsArrays)M.setArray(R,this._floatsArrays[R]);for(R in this._colors3)M.setColor3(R,this._colors3[R]);for(R in this._colors3Arrays)M.setArray3(R,this._colors3Arrays[R]);for(R in this._colors4){const N=this._colors4[R];M.setFloat4(R,N.r,N.g,N.b,N.a)}for(R in this._colors4Arrays)M.setArray4(R,this._colors4Arrays[R]);for(R in this._vectors2)M.setVector2(R,this._vectors2[R]);for(R in this._vectors3)M.setVector3(R,this._vectors3[R]);for(R in this._vectors4)M.setVector4(R,this._vectors4[R]);for(R in this._quaternions)M.setQuaternion(R,this._quaternions[R]);for(R in this._matrices)M.setMatrix(R,this._matrices[R]);for(R in this._matrixArrays)M.setMatrices(R,this._matrixArrays[R]);for(R in this._matrices3x3)M.setMatrix3x3(R,this._matrices3x3[R]);for(R in this._matrices2x2)M.setMatrix2x2(R,this._matrices2x2[R]);for(R in this._vectors2Arrays)M.setArray2(R,this._vectors2Arrays[R]);for(R in this._vectors3Arrays)M.setArray3(R,this._vectors3Arrays[R]);for(R in this._vectors4Arrays)M.setArray4(R,this._vectors4Arrays[R]);for(R in this._quaternionsArrays)M.setArray4(R,this._quaternionsArrays[R]);for(R in this._uniformBuffers){const N=this._uniformBuffers[R].getBuffer();N&&M.bindUniformBuffer(N,R)}const q=v.getEngine(),G=q.setExternalTexture;if(G)for(R in this._externalTextures)G.call(q,R,this._externalTextures[R]);const y=q.setTextureSampler;if(y)for(R in this._textureSamplers)y.call(q,R,this._textureSamplers[R]);const a=q.setStorageBuffer;if(a)for(R in this._storageBuffers)a.call(q,R,this._storageBuffers[R])}if(M&&N&&(y||!this.isFrozen)){const R=N.morphTargetManager;R&&R.numInfluencers>0&&(0,K.n)(N,M);const q=N.bakedVertexAnimationManager;if(q&&q.isEnabled){var a;const R=u?w._drawWrapper:this._drawWrapper;null===(a=N.bakedVertexAnimationManager)||void 0===a||a.bind(M,!!R._wasPreviouslyUsingInstances)}}this._afterBind(N,M,w)}getActiveTextures(){const R=super.getActiveTextures();for(const N in this._textures)R.push(this._textures[N]);for(const N in this._textureArrays){const q=this._textureArrays[N];for(let N=0;N<q.length;N++)R.push(q[N])}return R}hasTexture(R){if(super.hasTexture(R))return!0;for(const N in this._textures)if(this._textures[N]===R)return!0;for(const N in this._textureArrays){const q=this._textureArrays[N];for(let N=0;N<q.length;N++)if(q[N]===R)return!0}return!1}clone(R){const N=a.e.Clone((()=>new Z(R,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);N.name=R,N.id=R,"object"===typeof N._shaderPath&&(N._shaderPath={...N._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((R=>{const N=this._options[R];Array.isArray(N)&&(this._options[R]=N.slice(0))})),this.stencil.copyTo(N.stencil);for(const q in this._textures)N.setTexture(q,this._textures[q]);for(const q in this._textureArrays)N.setTextureArray(q,this._textureArrays[q]);for(const q in this._externalTextures)N.setExternalTexture(q,this._externalTextures[q]);for(const q in this._ints)N.setInt(q,this._ints[q]);for(const q in this._uints)N.setUInt(q,this._uints[q]);for(const q in this._floats)N.setFloat(q,this._floats[q]);for(const q in this._floatsArrays)N.setFloats(q,this._floatsArrays[q]);for(const q in this._colors3)N.setColor3(q,this._colors3[q]);for(const q in this._colors3Arrays)N._colors3Arrays[q]=this._colors3Arrays[q];for(const q in this._colors4)N.setColor4(q,this._colors4[q]);for(const q in this._colors4Arrays)N._colors4Arrays[q]=this._colors4Arrays[q];for(const q in this._vectors2)N.setVector2(q,this._vectors2[q]);for(const q in this._vectors3)N.setVector3(q,this._vectors3[q]);for(const q in this._vectors4)N.setVector4(q,this._vectors4[q]);for(const q in this._quaternions)N.setQuaternion(q,this._quaternions[q]);for(const q in this._quaternionsArrays)N._quaternionsArrays[q]=this._quaternionsArrays[q];for(const q in this._matrices)N.setMatrix(q,this._matrices[q]);for(const q in this._matrixArrays)N._matrixArrays[q]=this._matrixArrays[q].slice();for(const q in this._matrices3x3)N.setMatrix3x3(q,this._matrices3x3[q]);for(const q in this._matrices2x2)N.setMatrix2x2(q,this._matrices2x2[q]);for(const q in this._vectors2Arrays)N.setArray2(q,this._vectors2Arrays[q]);for(const q in this._vectors3Arrays)N.setArray3(q,this._vectors3Arrays[q]);for(const q in this._vectors4Arrays)N.setArray4(q,this._vectors4Arrays[q]);for(const q in this._uniformBuffers)N.setUniformBuffer(q,this._uniformBuffers[q]);for(const q in this._textureSamplers)N.setTextureSampler(q,this._textureSamplers[q]);for(const q in this._storageBuffers)N.setStorageBuffer(q,this._storageBuffers[q]);return N}dispose(R,N,q){if(N){let R;for(R in this._textures)this._textures[R].dispose();for(R in this._textureArrays){const N=this._textureArrays[R];for(let R=0;R<N.length;R++)N[R].dispose()}}this._textures={},super.dispose(R,N,q)}serialize(){const R=a.e.Serialize(this);let N;for(N in R.customType="BABYLON.ShaderMaterial",R.uniqueId=this.uniqueId,R.options=this._options,R.shaderPath=this._shaderPath,R.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,R.stencil=this.stencil.serialize(),R.textures={},this._textures)R.textures[N]=this._textures[N].serialize();for(N in R.textureArrays={},this._textureArrays){R.textureArrays[N]=[];const q=this._textureArrays[N];for(let w=0;w<q.length;w++)R.textureArrays[N].push(q[w].serialize())}for(N in R.ints={},this._ints)R.ints[N]=this._ints[N];for(N in R.uints={},this._uints)R.uints[N]=this._uints[N];for(N in R.floats={},this._floats)R.floats[N]=this._floats[N];for(N in R.floatsArrays={},this._floatsArrays)R.floatsArrays[N]=this._floatsArrays[N];for(N in R.colors3={},this._colors3)R.colors3[N]=this._colors3[N].de();for(N in R.colors3Arrays={},this._colors3Arrays)R.colors3Arrays[N]=this._colors3Arrays[N];for(N in R.colors4={},this._colors4)R.colors4[N]=this._colors4[N].de();for(N in R.colors4Arrays={},this._colors4Arrays)R.colors4Arrays[N]=this._colors4Arrays[N];for(N in R.vectors2={},this._vectors2)R.vectors2[N]=this._vectors2[N].de();for(N in R.vectors3={},this._vectors3)R.vectors3[N]=this._vectors3[N].de();for(N in R.vectors4={},this._vectors4)R.vectors4[N]=this._vectors4[N].de();for(N in R.quaternions={},this._quaternions)R.quaternions[N]=this._quaternions[N].de();for(N in R.matrices={},this._matrices)R.matrices[N]=this._matrices[N].de();for(N in R.matrixArray={},this._matrixArrays)R.matrixArray[N]=this._matrixArrays[N];for(N in R.matrices3x3={},this._matrices3x3)R.matrices3x3[N]=this._matrices3x3[N];for(N in R.matrices2x2={},this._matrices2x2)R.matrices2x2[N]=this._matrices2x2[N];for(N in R.vectors2Arrays={},this._vectors2Arrays)R.vectors2Arrays[N]=this._vectors2Arrays[N];for(N in R.vectors3Arrays={},this._vectors3Arrays)R.vectors3Arrays[N]=this._vectors3Arrays[N];for(N in R.vectors4Arrays={},this._vectors4Arrays)R.vectors4Arrays[N]=this._vectors4Arrays[N];for(N in R.quaternionsArrays={},this._quaternionsArrays)R.quaternionsArrays[N]=this._quaternionsArrays[N];return R}static Parse(R,N,q){const u=a.e.Parse((()=>new Z(R.name,N,R.shaderPath,R.options,R.storeEffectOnSubMeshes)),R,N,q);let M;for(M in R.stencil&&u.stencil.parse(R.stencil,N,q),R.textures)u.setTexture(M,F.e.Parse(R.textures[M],N,q));for(M in R.textureArrays){const w=R.textureArrays[M],v=[];for(let R=0;R<w.length;R++)v.push(F.e.Parse(w[R],N,q));u.setTextureArray(M,v)}for(M in R.ints)u.setInt(M,R.ints[M]);for(M in R.uints)u.setUInt(M,R.uints[M]);for(M in R.floats)u.setFloat(M,R.floats[M]);for(M in R.floatsArrays)u.setFloats(M,R.floatsArrays[M]);for(M in R.colors3)u.setColor3(M,v.c.Sd(R.colors3[M]));for(M in R.colors3Arrays){const N=R.colors3Arrays[M].reduce(((R,N,q)=>(q%3===0?R.push([N]):R[R.length-1].push(N),R)),[]).map((R=>v.c.Sd(R)));u.setColor3Array(M,N)}for(M in R.colors4)u.setColor4(M,v.d.Sd(R.colors4[M]));for(M in R.colors4Arrays){const N=R.colors4Arrays[M].reduce(((R,N,q)=>(q%4===0?R.push([N]):R[R.length-1].push(N),R)),[]).map((R=>v.d.Sd(R)));u.setColor4Array(M,N)}for(M in R.vectors2)u.setVector2(M,w.j.Sd(R.vectors2[M]));for(M in R.vectors3)u.setVector3(M,w.m.Sd(R.vectors3[M]));for(M in R.vectors4)u.setVector4(M,w.n.Sd(R.vectors4[M]));for(M in R.quaternions)u.setQuaternion(M,w.e.Sd(R.quaternions[M]));for(M in R.matrices)u.setMatrix(M,w.c.Sd(R.matrices[M]));for(M in R.matrixArray)u._matrixArrays[M]=new Float32Array(R.matrixArray[M]);for(M in R.matrices3x3)u.setMatrix3x3(M,R.matrices3x3[M]);for(M in R.matrices2x2)u.setMatrix2x2(M,R.matrices2x2[M]);for(M in R.vectors2Arrays)u.setArray2(M,R.vectors2Arrays[M]);for(M in R.vectors3Arrays)u.setArray3(M,R.vectors3Arrays[M]);for(M in R.vectors4Arrays)u.setArray4(M,R.vectors4Arrays[M]);for(M in R.quaternionsArrays)u.setArray4(M,R.quaternionsArrays[M]);return u}static ParseFromFileAsync(R,N,q){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((u,M)=>{const v=new W.b;v.addEventListener("readystatechange",(()=>{if(4==v.readyState)if(200==v.status){const N=JSON.parse(v.responseText),M=this.Parse(N,q||C.e.LastCreatedScene,w);R&&(M.name=R),u(M)}else M("Unable to load the ShaderMaterial")})),v.open("GET",N),v.send()}))}static ParseFromSnippetAsync(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((w,u)=>{const M=new W.b;M.addEventListener("readystatechange",(()=>{if(4==M.readyState)if(200==M.status){const u=JSON.parse(JSON.parse(M.responseText).jsonPayload),v=JSON.parse(u.shaderMaterial),G=this.Parse(v,N||C.e.LastCreatedScene,q);G.snippetId=R,w(G)}else u("Unable to load the snippet "+R)})),M.open("GET",this.SnippetUrl+"/"+R.replace(/#/g,"/")),M.send()}))}}Z.SnippetUrl="https://snippet.babylonjs.com",Z.CreateFromSnippetAsync=Z.ParseFromSnippetAsync,(0,S.h)("BABYLON.ShaderMaterial",Z),u.b._LinesMeshParser=(R,N)=>z.Parse(R,N);class z extends u.b{_isShaderMaterial(R){return"ShaderMaterial"===R.getClassName()}constructor(R){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0,M=arguments.length>7?arguments[7]:void 0;super(R,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N,arguments.length>4?arguments[4]:void 0),this.useVertexColor=w,this.useVertexAlpha=u,this.color=new v.c(1,1,1),this.alpha=1,this._shaderLanguage=0,N&&(this.color=N.color.clone(),this.alpha=N.alpha,this.useVertexColor=N.useVertexColor,this.useVertexAlpha=N.useVertexAlpha),this.intersectionThreshold=.1;const J={attributes:[G.e.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===u?J.needAlphaBlending=!1:J.defines.push("#define VERTEXALPHA"),w?(J.defines.push("#define VERTEXCOLOR"),J.attributes.push(G.e.ColorKind)):(J.uniforms.push("color"),this._color4=new v.d),M)this.material=M;else{this.va().getEngine().isWebGPU&&!z.ForceGLSL&&(this._shaderLanguage=1),J.shaderLanguage=this._shaderLanguage,J.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([q.e(19).then(q.bind(q,12683)),q.e(48).then(q.bind(q,12689))]):await Promise.all([q.e(26).then(q.bind(q,12697)),q.e(49).then(q.bind(q,12703))])},this.material=new Z("colorShader",this.va(),"color",J,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(R){this._lineMaterial=R,this._lineMaterial.fillMode=y.e.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(R){}_bind(R,N){if(!this._geometry)return this;const q=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(N,q):this._geometry._bind(N,q,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:R,g:N,b:q}=this.color;this._color4.set(R,N,q,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(R,N,q){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const w=this.va().getEngine();return this._unIndexed?w.drawArraysType(y.e.LineListDrawMode,R.verticesStart,R.verticesCount,q):w.drawElementsType(y.e.LineListDrawMode,R.indexStart,R.indexCount,q),this}dispose(R){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(R)}clone(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2?arguments[2]:void 0;return new z(R,this.va(),N,this,q)}pd(R){const N=new d(R,this);if(this.instancedBuffers){N.instancedBuffers={};for(const R in this.instancedBuffers)N.instancedBuffers[R]=this.instancedBuffers[R]}return N}serialize(R){super.serialize(R),R.color=this.color.de(),R.alpha=this.alpha}static Parse(R,N){const q=new z(R.name,N);return q.color=v.c.Sd(R.color),q.alpha=R.alpha,q}}z.ForceGLSL=!1;class d extends J.d{constructor(R,N){super(R,N),this.intersectionThreshold=N.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var x=q(1056);function E(R){const N=[],q=[],w=R.lines,u=R.za,v=[];let G=0;for(let M=0;M<w.length;M++){const R=w[M];for(let w=0;w<R.length;w++){const{x:J,y:y,z:a}=R[w];if(q.push(J,y,a),u){const R=u[M],{r:N,g:q,b:G,a:J}=R[w];v.push(N,q,G,J)}w>0&&(N.push(G-1),N.push(G)),G++}}const J=new M.d;return J.indices=N,J.xa=q,u&&(J.za=v),J}function P(R){const N=R.dashSize||3,q=R.gapSize||1,u=R.dashNb||200,v=R.points,G=[],J=[],y=w.m.Zero();let a=0,j=0,F=0,S=0,H=0,W=0,k=0;for(k=0;k<v.length-1;k++)v[k+1].subtractToRef(v[k],y),a+=y.length();for(F=a/u,S=N*F/(N+q),k=0;k<v.length-1;k++){v[k+1].subtractToRef(v[k],y),j=Math.floor(y.length()/F),y.normalize();for(let R=0;R<j;R++)H=F*R,G.push(v[k].x+H*y.x,v[k].y+H*y.y,v[k].z+H*y.z),G.push(v[k].x+(H+S)*y.x,v[k].y+(H+S)*y.y,v[k].z+(H+S)*y.z),J.push(W,W+1),W+=2}const C=new M.d;return C.xa=G,C.indices=J,C}function s(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=N.instance,u=N.lines,M=N.za;if(w){const R=w.getVerticesData(G.e.PositionKind);let N,q;M&&(N=w.getVerticesData(G.e.ColorKind));let v=0,J=0;for(let w=0;w<u.length;w++){const G=u[w];for(let u=0;u<G.length;u++)R[v]=G[u].x,R[v+1]=G[u].y,R[v+2]=G[u].z,M&&N&&(q=M[w],N[J]=q[u].r,N[J+1]=q[u].g,N[J+2]=q[u].b,N[J+3]=q[u].a,J+=4),v+=3}return w.updateVerticesData(G.e.PositionKind,R,!1,!1),M&&N&&w.updateVerticesData(G.e.ColorKind,N,!1,!1),w.refreshBoundingInfo(),w}const v=new z(R,q,null,void 0,void 0,!!M,N.useVertexAlpha,N.material);return E(N).Ca(v,N.updatable),v}function O(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=N.za?[N.za]:null;return s(R,{lines:[N.points],updatable:N.updatable,instance:N.instance,za:w,useVertexAlpha:N.useVertexAlpha,material:N.material},q)}function L(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=N.points,v=N.instance,G=N.gapSize||1,J=N.dashSize||3;if(v){const R=R=>{const N=w.m.Zero(),q=R.length/6;let u=0,G=0,J=0,y=0,a=0,j=0,F=0,S=0;for(F=0;F<M.length-1;F++)M[F+1].subtractToRef(M[F],N),u+=N.length();J=u/q;const H=v._creationDataStorage.dashSize;for(y=H*J/(H+v._creationDataStorage.gapSize),F=0;F<M.length-1;F++)for(M[F+1].subtractToRef(M[F],N),G=Math.floor(N.length()/J),N.normalize(),S=0;S<G&&j<R.length;)a=J*S,R[j]=M[F].x+a*N.x,R[j+1]=M[F].y+a*N.y,R[j+2]=M[F].z+a*N.z,R[j+3]=M[F].x+(a+y)*N.x,R[j+4]=M[F].y+(a+y)*N.y,R[j+5]=M[F].z+(a+y)*N.z,j+=6,S++;for(;j<R.length;)R[j]=M[F].x,R[j+1]=M[F].y,R[j+2]=M[F].z,j+=3};return(N.dashNb||N.dashSize||N.gapSize||N.useVertexAlpha||N.material)&&x.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),v.updateMeshPositions(R,!1),v}const y=new z(R,q,null,void 0,void 0,void 0,N.useVertexAlpha,N.material);return P(N).Ca(y,N.updatable),y._creationDataStorage=new u.d,y._creationDataStorage.dashSize=J,y._creationDataStorage.gapSize=G,y}M.d.CreateLineSystem=E,M.d.CreateDashedLines=P,u.b.lb=function(R,N){return O(R,{points:N,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},u.b.CreateDashedLines=function(R,N,q,w,u){return L(R,{points:N,dashSize:q,gapSize:w,dashNb:u,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11496:(R,N,q)=>{"use strict";q.d(N,{d:()=>G,h:()=>J});var w=q(11381),u=q(11403),M=q(1159);function v(R){const N=[],q=[],w=[],v=[],G=R.width||R.size||1,J=R.height||R.size||1,y=0===R.sideOrientation?0:R.sideOrientation||u.d.DEFAULTSIDE,a=G/2,j=J/2;q.push(-a,-j,0),w.push(0,0,-1),v.push(0,M.e?1:0),q.push(a,-j,0),w.push(0,0,-1),v.push(1,M.e?1:0),q.push(a,j,0),w.push(0,0,-1),v.push(1,M.e?0:1),q.push(-a,j,0),w.push(0,0,-1),v.push(0,M.e?0:1),N.push(0),N.push(1),N.push(2),N.push(0),N.push(2),N.push(3),u.d._ComputeSides(y,q,N,w,v,R.frontUVs,R.backUVs);const F=new u.d;return F.indices=N,F.xa=q,F.ya=w,F.Aa=v,F}function G(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new w.b(R,q);N.sideOrientation=w.b._GetDefaultSideOrientation(N.sideOrientation),u._originalBuilderSideOrientation=N.sideOrientation;return v(N).Ca(u,N.updatable),N.sourcePlane&&(u.translate(N.sourcePlane.ke,-N.sourcePlane.d),u.setDirection(N.sourcePlane.ke.scale(-1))),u}const J={Kg:G};u.d.Kg=v,w.b.Kg=(R,N,q,w,u)=>G(R,{size:N,width:N,height:N,sideOrientation:u,updatable:w},q)},11547:(R,N,q)=>{"use strict";q.d(N,{c:()=>J});var w=q(966),u=q(11381),M=q(11403),v=q(1159);function G(R){const N=0|(R.segments||32),q=R.diameterX||R.diameter||1,u=R.diameterY||R.diameter||1,G=R.diameterZ||R.diameter||1,J=R.arc&&(R.arc<=0||R.arc>1)?1:R.arc||1,y=R.slice&&R.slice<=0?1:R.slice||1,a=0===R.sideOrientation?0:R.sideOrientation||M.d.DEFAULTSIDE,j=!!R.dedupTopBottomIndices,F=new w.m(q/2,u/2,G/2),S=2+N,H=2*S,W=[],k=[],C=[],e=[];for(let M=0;M<=S;M++){const R=M/S,N=R*Math.PI*y;for(let q=0;q<=H;q++){const u=q/H,M=u*Math.PI*2*J,G=w.c.RotationZ(-N),y=w.c.RotationY(M),a=w.m.TransformCoordinates(w.m.Up(),G),j=w.m.TransformCoordinates(a,y),S=j.multiply(F),W=j.divide(F).normalize();k.push(S.x,S.y,S.z),C.push(W.x,W.y,W.z),e.push(u,v.e?1-R:R)}if(M>0){const R=k.length/3;for(let N=R-2*(H+1);N+H+2<R;N++)j?(M>1&&(W.push(N),W.push(N+1),W.push(N+H+1)),(M<S||y<1)&&(W.push(N+H+1),W.push(N+1),W.push(N+H+2))):(W.push(N),W.push(N+1),W.push(N+H+1),W.push(N+H+1),W.push(N+1),W.push(N+H+2))}}M.d._ComputeSides(a,k,W,C,e,R.frontUVs,R.backUVs);const K=new M.d;return K.indices=W,K.xa=k,K.ya=C,K.Aa=e,K}function J(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new u.b(R,q);N.sideOrientation=u.b._GetDefaultSideOrientation(N.sideOrientation),w._originalBuilderSideOrientation=N.sideOrientation;return G(N).Ca(w,N.updatable),w}M.d.CreateSphere=G,u.b.CreateSphere=(R,N,q,w,u,M)=>J(R,{segments:N,diameterX:q,diameterY:q,diameterZ:q,sideOrientation:M,updatable:u},w)},12055:(R,N,q)=>{"use strict";q.d(N,{c:()=>j});var w=q(1177),u=q(10376),M=q(11405),v=q(1227),G=q(11403),J=q(1056);function y(R,N,q,w,u){let M=null,v=null,G=null;try{let J;M=new R.Decoder,v=new R.DecoderBuffer,v.Init(N,N.byteLength);const y=M.GetEncodedGeometryType(v);switch(y){case R.TRIANGULAR_MESH:{const N=new R.Mesh;if(J=M.DecodeBufferToMesh(v,N),!J.ok()||0===N.ptr)throw new Error(J.error_msg());const q=3*N.num_faces(),u=4*q,y=R._malloc(u);try{M.GetTrianglesUInt32Array(N,u,y);const v=new Uint32Array(q);v.set(new Uint32Array(R.HEAPF32.buffer,y,q)),w(v)}finally{R._free(y)}G=N;break}case R.POINT_CLOUD:{const N=new R.PointCloud;if(J=M.DecodeBufferToPointCloud(v,N),!J.ok()||!N.ptr)throw new Error(J.error_msg());G=N;break}default:throw new Error(`Invalid geometry type ${y}`)}const a=G.num_points(),j=(N,q,w,M)=>{const v=M.data_type(),G=M.num_components(),J=M.normalized(),y=M.byte_stride(),j=M.byte_offset(),F={[R.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:R.HEAPF32},[R.DT_INT8]:{typedArrayConstructor:Int8Array,heap:R.HEAP8},[R.DT_INT16]:{typedArrayConstructor:Int16Array,heap:R.HEAP16},[R.DT_INT32]:{typedArrayConstructor:Int32Array,heap:R.HEAP32},[R.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:R.HEAPU8},[R.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:R.HEAPU16},[R.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:R.HEAPU32}}[v];if(!F)throw new Error(`Invalid data type ${v}`);const S=a*G,H=S*F.typedArrayConstructor.BYTES_PER_ELEMENT,W=R._malloc(H);try{N.GetAttributeDataArrayForAllPoints(q,M,v,H,W);const R=new F.typedArrayConstructor(F.heap.buffer,W,S);u(w,R.slice(),G,j,y,J)}finally{R._free(W)}};if(q)for(const R in q){const N=q[R],w=M.GetAttributeByUniqueId(G,N);j(M,G,R,w)}else{const N={position:R.POSITION,ke:R.NORMAL,color:R.COLOR,uv:R.TEX_COORD};for(const R in N){const q=M.GetAttributeId(G,N[R]);if(-1!==q){const N=M.GetAttribute(G,q);j(M,G,R,N)}}}return a}finally{G&&R.destroy(G),v&&R.destroy(v),M&&R.destroy(M)}}function a(){let R;onmessage=N=>{const q=N.data;switch(q.id){case"init":{const N=q.decoder;N.url&&importScripts(N.url);const w=N.wasmBinary?{wasmBinary:N.wasmBinary}:{};R=DracoDecoderModule(w),postMessage({id:"initDone"});break}case"decodeMesh":if(!R)throw new Error("Draco decoder module is not available");R.then((R=>{const N=y(R,q.dataView,q.attributes,(R=>{postMessage({id:"indices",data:R},[R.buffer])}),((R,N,q,w,u,M)=>{postMessage({id:"attribute",kind:R,data:N,size:q,byteOffset:w,byteStride:u,normalized:M},[N.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:N})}))}}}class j{static get DecoderAvailable(){const R=j.Configuration.decoder;return!!(R.wasmUrl&&R.wasmBinaryUrl&&"object"===typeof WebAssembly||R.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return j._Default||(j._Default=new j),j._Default}static ResetDefault(R){j._Default&&(R||j._Default.dispose(),j._Default=null)}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.DefaultNumWorkers;const N=j.Configuration.decoder;if(N.workerPool||"object"===typeof R&&R.workerPool)this._workerPoolPromise=Promise.resolve(N.workerPool||R.workerPool);else{const q=N.wasmBinary||"object"===typeof R&&R.wasmBinary,M="number"===typeof R?R:R.numWorkers,v=M&&"function"===typeof Worker&&"function"===typeof URL,G=v||!v&&!N.jsModule,J=N.wasmUrl&&N.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:G?w.i.GetBabylonScriptURL(N.wasmUrl,!0):"",wasmBinaryPromise:q?Promise.resolve(q):w.i.LoadFileAsync(w.i.GetBabylonScriptURL(N.wasmBinaryUrl,!0))}:{url:G?w.i.GetBabylonScriptURL(N.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};v?this._workerPoolPromise=J.wasmBinaryPromise.then((R=>{const N=`${y}(${a})()`,q=URL.createObjectURL(new Blob([N],{type:"application/javascript"}));return new u.d(M,(()=>function(R,N,q){return new Promise(((w,u)=>{const M=N=>{R.removeEventListener("error",M),R.removeEventListener("message",v),u(N)},v=N=>{"initDone"===N.data.id&&(R.removeEventListener("error",M),R.removeEventListener("message",v),w(R))};if(R.addEventListener("error",M),R.addEventListener("message",v),N){const w=N.slice(0);R.postMessage({id:"init",decoder:{url:q,wasmBinary:w}},[w])}else R.postMessage({id:"init",decoder:{url:q}})}))}(new Worker(q),R,J.url)))})):this._decoderModulePromise=J.wasmBinaryPromise.then((async R=>{if("undefined"===typeof DracoDecoderModule&&!N.jsModule){if(!J.url)throw new Error("Draco decoder module is not available");await w.i.LoadBabylonScriptAsync(J.url)}return await(q=R,u=N.jsModule,new Promise((R=>{(u||DracoDecoderModule)({wasmBinary:q}).then((N=>{R({module:N})}))})));var q,u}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((R=>{R.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(R,N,q){const w=R instanceof ArrayBuffer?new Int8Array(R):new Int8Array(R.buffer,R.byteOffset,R.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((R=>new Promise(((u,M)=>{R.push(((R,v)=>{let G=null;const y=[],a=N=>{R.removeEventListener("error",a),R.removeEventListener("message",j),M(N),v()},j=N=>{const w=N.data;switch(w.id){case"decodeMeshDone":R.removeEventListener("error",a),R.removeEventListener("message",j),u({indices:G,attributes:y,totalVertices:w.totalVertices}),v();break;case"indices":G=w.data;break;case"attribute":y.push({kind:w.kind,data:w.data,size:w.size,byteOffset:w.byteOffset,byteStride:w.byteStride,normalized:(M=w.kind,F=w.normalized,q&&void 0!==q[M]?(F!==q[M]&&J.e.Warn(`Normalized flag from Draco data (${F}) does not match normalized flag from glTF accessor (${q[M]}). Using flag from glTF accessor.`),q[M]):F)})}var M,F};R.addEventListener("error",a),R.addEventListener("message",j);const F=w.slice();R.postMessage({id:"decodeMesh",dataView:F,attributes:N},[F.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((R=>{let q=null;const u=[],M=y(R.module,w,N,(R=>{q=R}),((R,N,q,w,M,v)=>{u.push({kind:R,data:N,size:q,byteOffset:w,byteStride:M,normalized:v})}));return{indices:q,attributes:u,totalVertices:M}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(R,N,q,w){const u=await this.decodeMeshToMeshDataAsync(q,w),G=new M.b(R,N);u.indices&&G.setIndices(u.indices);for(const M of u.attributes)G.setVerticesBuffer(new v.e(N.getEngine(),M.data,M.kind,!1,void 0,M.byteStride,void 0,M.byteOffset,M.size,void 0,M.normalized,!0),u.totalVertices);return G}async _decodeMeshToGeometryForGltfAsync(R,N,q,w,u){const G=await this.decodeMeshToMeshDataAsync(q,w,u),J=new M.b(R,N);G.indices&&J.setIndices(G.indices);for(const M of G.attributes)J.setVerticesBuffer(new v.e(N.getEngine(),M.data,M.kind,!1,void 0,M.byteStride,void 0,M.byteOffset,M.size,void 0,M.normalized,!0),G.totalVertices);return J}async decodeMeshAsync(R,N){const q=await this.decodeMeshToMeshDataAsync(R,N),w=new G.d;q.indices&&(w.indices=q.indices);for(const u of q.attributes){const R=v.e.GetFloatData(u.data,u.size,v.e.GetDataType(u.data),u.byteOffset,u.byteStride,u.normalized,q.totalVertices);w.set(R,u.kind)}return w}}j.Configuration={decoder:{wasmUrl:`${w.i._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${w.i._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${w.i._DefaultCdnUrl}/draco_decoder_gltf.js`}},j.DefaultNumWorkers=j.GetDefaultNumWorkers(),j._Default=null},11412:(R,N,q)=>{"use strict";q.d(N,{e:()=>d});var w=q(942),u=q(959),M=q(966),v=q(1227),G=q(11403),J=q(11420),y=q(1220),a=q(1328),j=q(1215);class F{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new M.m(0,0,0),this._diffPositionForCollisions=new M.m(0,0,0),this._collisionResponse=!0}}var S=q(1044),H=q(1337),W=q(1133),k=q(974),C=q(1460),e=q(982),K=q(947),r=q(1070);class Z{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=M.m.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class z{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new Z,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new F,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class d extends J.d{static get BILLBOARDMODE_NONE(){return J.d.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return J.d.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return J.d.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return J.d.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return J.d.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return J.d.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(R){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=R}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(R){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=R}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(R){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=R}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(R){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=R}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(R){this._internalAbstractMeshDataInfo._collisionRetryCount=R}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(R){this._internalAbstractMeshDataInfo._morphTargetManager!==R&&(this._internalAbstractMeshDataInfo._morphTargetManager=R,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(R){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==R&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=R,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(R){return!!super._updateNonUniformScalingState(R)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(R){this._internalAbstractMeshDataInfo._rawBoundingInfo=R}set Hk(R){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(R)}set onCollisionPositionChange(R){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(R)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(R){if(this._internalAbstractMeshDataInfo._visibility===R)return;const N=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=R,(1===N&&1!==R||1!==N&&1===R)&&this._markSubMeshesAsDirty((R=>{R.markAsMiscDirty(),R.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(R){this._internalAbstractMeshDataInfo._inheritVisibility=R}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let R=this._parentNode;for(;R;){const N=R.isVisible;if("undefined"!==typeof N)return N;R=R.parent}}return this._isVisible}set isVisible(R){this._isVisible=R}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(R){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=R}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(R){this._internalAbstractMeshDataInfo._renderingGroupId=R}get material(){return this._internalAbstractMeshDataInfo._material}set material(R){this._setMaterial(R)}_setMaterial(R){this._internalAbstractMeshDataInfo._material!==R&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=R,R&&R.meshMap&&(R.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.ae&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(R){var N;return null===(N=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===N?void 0:N[R]}setMaterialForRenderPass(R,N){this.resetDrawCache(R),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[R]=N}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(R){this._internalAbstractMeshDataInfo._receiveShadows!==R&&(this._internalAbstractMeshDataInfo._receiveShadows=R,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(R){this._internalAbstractMeshDataInfo._hasVertexAlpha!==R&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=R,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(R){this._internalAbstractMeshDataInfo._useVertexColors!==R&&(this._internalAbstractMeshDataInfo._useVertexColors=R,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(R){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==R&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=R,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(R){this._internalAbstractMeshDataInfo._numBoneInfluencers!==R&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=R,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(R){this._internalAbstractMeshDataInfo._applyFog!==R&&(this._internalAbstractMeshDataInfo._applyFog=R,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(R){this._internalAbstractMeshDataInfo._enableDistantPicking=R}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(R){R!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=R,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(R){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(R)?-1:R}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(R){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=R}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(R){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(R)?-1:R}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(R){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=R}get lightSources(){return this._lightSources}set skeleton(R){const N=this._internalAbstractMeshDataInfo._skeleton;N&&N.needInitialSkinMatrix&&N._unregisterMeshWithPoseMatrix(this),R&&R.needInitialSkinMatrix&&R._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=R,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(R){var N;let q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(R,q,!1),N=this,this._internalAbstractMeshDataInfo=new z,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.He=d.Qi,this.onCollideObservable=new u.c,this.onCollisionPositionChangeObservable=new u.c,this.onMaterialChangedObservable=new u.c,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Me=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=W.c.Red(),this.outlineWidth=.02,this.overlayColor=W.c.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.Ye=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new M.m(.5,1,.5),this.ellipsoidOffset=new M.m(0,0,0),this.edgesWidth=1,this.edgesColor=new W.d(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,ci:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new u.c,this._onCollisionPositionChange=function(R,q){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q.subtractToRef(N._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,N._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),N._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>r.e.CollisionsEpsilon&&N.position.addInPlace(N._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),w&&N.onCollideObservable.notifyObservers(w),N.onCollisionPositionChangeObservable.notifyObservers(N.position)},q=this.va(),q.We(this),this._resyncLightSources(),this._uniformBuffer=new j.d(this.va().getEngine(),void 0,void 0,R,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),q.performancePriority){case 2:this.Da=!0;case 1:this.Ye=!0,this.Me=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(R){const N=this._uniformBuffer;N.ve("world",R),N.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),N.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(R){let N="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");N+=", # of submeshes: "+(this.ae?this.ae.length:0);const q=this._internalAbstractMeshDataInfo._skeleton;return q&&(N+=", skeleton: "+q.name),R&&(N+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],N+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.ci?"YES":"NO")),N}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==J.d.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(N||this.actionManager.isRecursive)){if(!R)return this.actionManager;if(this.actionManager.hasSpecificTrigger(R))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(R,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.ae){for(const R of this.ae)R._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const R of this.va().lights)R.isEnabled()&&R.canAffectMesh(this)&&this._lightSources.push(R);this._markSubMeshesAsLightDirty()}_resyncLightSource(R){const N=R.isEnabled()&&R.canAffectMesh(this),q=this._lightSources.indexOf(R);let w=!1;if(-1===q){if(!N)return;this._lightSources.push(R)}else{if(N)return;w=!0,this._lightSources.splice(q,1)}this._markSubMeshesAsLightDirty(w)}_unBindEffect(){for(const R of this.ae)R.setEffect(null)}_removeLightSource(R,N){const q=this._lightSources.indexOf(R);-1!==q&&(this._lightSources.splice(q,1),this._markSubMeshesAsLightDirty(N))}_markSubMeshesAsDirty(R){if(this.ae)for(const N of this.ae)for(let q=0;q<N._drawWrappers.length;++q){const w=N._drawWrappers[q];w&&w.defines&&w.defines.markAllAsDirty&&R(w.defines)}}_markSubMeshesAsLightDirty(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((N=>N.markAsLightDirty(R)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((R=>R.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((R=>R.markAsMiscDirty()))}pe(R){return this._currentRenderId=Number.MAX_VALUE,super.pe(R),this._isDirty=!0,this}resetDrawCache(R){if(this.ae)for(const N of this.ae)N.resetDrawCache(R)}get isBlocked(){return!1}getLOD(R){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Md(){return null}getVerticesData(R){return null}Ga(R,N,q,w){return this}updateVerticesData(R,N,q,w){return this}setIndices(R,N){return this}isVerticesDataPresent(R){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(R){return this._boundingInfo=R,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(R,N,q){return this._boundingInfo=new a.b(R,N,q),this._boundingInfo}normalizeToUnitCube(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(R,N,q)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(v.e.MatricesIndicesKind)&&this.isVerticesDataPresent(v.e.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(R){}_activate(R,N){return this._renderId=R,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===J.d.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(R,N,q){return this.position.addInPlace(this.calcMovePOV(R,N,q)),this}calcMovePOV(R,N,q){const w=new M.c;(this.rotationQuaternion?this.rotationQuaternion:M.e.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(w);const u=M.m.Zero(),v=this.definedFacingForward?-1:1;return M.m.TransformCoordinatesFromFloatsToRef(R*v,N,q*v,w,u),u}rotatePOV(R,N,q){return this.rotation.addInPlace(this.calcRotatePOV(R,N,q)),this}calcRotatePOV(R,N,q){const w=this.definedFacingForward?1:-1;return new M.m(R*w,N,q*w)}Fa(R,N){if(R){const q=(0,H.g)(R,0,this.getTotalVertices(),N);this._boundingInfo?this._boundingInfo.reConstruct(q.minimum,q.maximum):this._boundingInfo=new a.b(q.minimum,q.maximum)}if(this.ae)for(let q=0;q<this.ae.length;q++)this.ae[q].refreshBoundingInfo(R);this.Ea()}_refreshBoundingInfoDirect(R){if(this._boundingInfo?this._boundingInfo.reConstruct(R.minimum,R.maximum):this._boundingInfo=new a.b(R.minimum,R.maximum),this.ae)for(let N=0;N<this.ae.length;N++)this.ae[N].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(R,N,q,w,u,G,J){!function(R,N,q,w,u,G,J){const y=M.f.Od[0],a=M.f.Matrix[0],j=M.f.Matrix[1],F=N===v.e.NormalKind?M.m.TransformNormalFromFloatsToRef:M.m.TransformCoordinatesFromFloatsToRef;for(let v=0,S=0;v<R.length;v+=3,S+=4){let N,H;for(a.reset(),N=0;N<4;N++)H=u[S+N],H>0&&(M.c.FromFloat32ArrayToRefScaled(q,Math.floor(16*w[S+N]),H,j),a.addToSelf(j));if(G&&J)for(N=0;N<4;N++)H=J[S+N],H>0&&(M.c.FromFloat32ArrayToRefScaled(q,Math.floor(16*G[S+N]),H,j),a.addToSelf(j));F(R[v],R[v+1],R[v+2],a,y),y.toArray(R,v)}}(R,N,q,w,u,G,J)}_getData(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.e.PositionKind;const w=R.cache,u=R=>{if(w){const N=w._vertexData||(w._vertexData={});return N[R]||this.copyVerticesData(R,N),N[R]}return this.getVerticesData(R)};if(N||(N=u(q)),!N)return null;if(w?(w._outputData?w._outputData.set(N):w._outputData=new Float32Array(N),N=w._outputData):(R.applyMorph&&this.morphTargetManager||R.applySkeleton&&this.skeleton)&&(N=N.slice()),R.applyMorph&&this.morphTargetManager&&function(R,N,q){let w=null;switch(N){case v.e.PositionKind:w=R=>R.getPositions();break;case v.e.NormalKind:w=R=>R.getNormals();break;case v.e.TangentKind:w=R=>R.getTangents();break;case v.e.UVKind:w=R=>R.getUVs();break;default:return}for(let u=0;u<R.length;u++){let N=R[u];for(let M=0;M<q.numTargets;M++){const v=q.getTarget(M),G=v.influence;if(0!==G){const q=w(v);q&&(N+=(q[u]-R[u])*G)}}R[u]=N}}(N,q,this.morphTargetManager),R.applySkeleton&&this.skeleton){const R=u(v.e.MatricesIndicesKind),w=u(v.e.MatricesWeightsKind);if(w&&R){const M=this.numBoneInfluencers>4,G=M?u(v.e.MatricesIndicesExtraKind):null,J=M?u(v.e.MatricesWeightsExtraKind):null,y=this.skeleton.getTransformMatrices(this);d._ApplySkeleton(N,q,y,R,w,G,J)}}if(!1!==R.updatePositionsArray&&q===v.e.PositionKind){const R=this._internalAbstractMeshDataInfo._positions||[],q=R.length;if(R.length=N.length/3,q<R.length)for(let N=q;N<R.length;N++)R[N]=new M.m;for(let w=0,u=0;w<R.length;w++,u+=3)R[w].Rd(N[u],N[u+1],N[u+2]);this._internalAbstractMeshDataInfo._positions=R}return N}getNormalsData(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:R,applyMorph:N,updatePositionsArray:!1},null,v.e.NormalKind)}Sf(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:R,applyMorph:N,updatePositionsArray:!1},q,v.e.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new a.b(M.m.Zero(),M.m.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(R){if(!this.ae)return this;const N=this.ae.length;for(let q=0;q<N;q++){const w=this.ae[q];(N>1||!w.IsGlobal)&&w.updateBoundingInfo(R)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(R){return this.getBoundingInfo().isInFrustum(R,this.He)}isCompletelyInFrustum(R){return this.getBoundingInfo().isCompletelyInFrustum(R)}intersectsMesh(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2?arguments[2]:void 0;const w=this.getBoundingInfo(),u=R.getBoundingInfo();if(w.intersects(u,N))return!0;if(q)for(const M of this.getChildMeshes())if(M.intersectsMesh(R,N,!0))return!0;return!1}intersectsPoint(R){return this.getBoundingInfo().intersectsPoint(R)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(R){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=R}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(R){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const N=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=N.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,N.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,R,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(R,N,q){var w;if(this._generatePointsArray(),!this._positions)return this;if(!R._lastColliderWorldVertices||!R._lastColliderTransformMatrix.equals(N)){R._lastColliderTransformMatrix=N.clone(),R._lastColliderWorldVertices=[],R._trianglePlanes=[];const q=R.verticesStart,w=R.verticesStart+R.verticesCount;for(let u=q;u<w;u++)R._lastColliderWorldVertices.push(M.m.TransformCoordinates(this._positions[u],N))}return q._collide(R._trianglePlanes,R._lastColliderWorldVertices,this.Md(),R.indexStart,R.indexStart+R.indexCount,R.verticesStart,!!R.Ha(),this,this._shouldConvertRHS(),7===(null===(w=R.Ha())||void 0===w?void 0:w.fillMode)),this}_processCollisionsForSubMeshes(R,N){const q=this._scene.getCollidingSubMeshCandidates(this,R),w=q.length;for(let u=0;u<w;u++){const M=q.data[u];w>1&&!M._checkCollision(R)||this._collideForSubMesh(M,N,R)}return this}_shouldConvertRHS(){return!1}_checkCollision(R){if(!this.getBoundingInfo()._checkCollision(R))return this;const N=M.f.Matrix[0],q=M.f.Matrix[1];return M.c.ScalingToRef(1/R._radius.x,1/R._radius.y,1/R._radius.z,N),this.worldMatrixFromCache.multiplyToRef(N,q),this._processCollisionsForSubMeshes(R,q),this}_generatePointsArray(){return!1}intersects(R,N,q){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4?arguments[4]:void 0,v=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const G=new y.b,J=this.getClassName(),a="InstancedLinesMesh"===J||"LinesMesh"===J||"GreasedLineMesh"===J?this.intersectionThreshold:0,j=this.getBoundingInfo();if(!this.ae)return G;if(!v&&(!R.intersectsSphere(j.boundingSphere,a)||!R.intersectsBox(j.boundingBox,a)))return G;if(w)return G.hit=!v,G.pickedMesh=v?null:this,G.distance=v?0:M.m.Distance(R.origin,j.boundingSphere.center),G.subMeshId=0,G;if(!this._generatePointsArray())return G;let F=null;const S=this._scene.getIntersectingSubMeshCandidates(this,R),H=S.length;let W=!1;for(let M=0;M<H;M++){const R=S.data[M].Ha();if(R&&(7==R.fillMode||0==R.fillMode||1==R.fillMode||2==R.fillMode||4==R.fillMode)){W=!0;break}}if(!W)return G.hit=!0,G.pickedMesh=this,G.distance=M.m.Distance(R.origin,j.boundingSphere.center),G.subMeshId=-1,G;for(let M=0;M<H;M++){const w=S.data[M];if(H>1&&!v&&!w.canIntersects(R))continue;const u=w.intersects(R,this._positions,this.Md(),N,q);if(u&&(N||!F||u.distance<F.distance)&&(F=u,F.subMeshId=M,N))break}if(F){const N=u??this.getWorldMatrix(),q=M.f.Od[0],w=M.f.Od[1];M.m.TransformCoordinatesToRef(R.origin,N,q),R.direction.scaleToRef(F.distance,w);const v=M.m.TransformNormal(w,N).addInPlace(q);return G.hit=!0,G.distance=M.m.Distance(q,v),G.pickedPoint=v,G.pickedMesh=this,G.bu=F.bu||0,G.bv=F.bv||0,G.subMeshFaceId=F.faceId,G.faceId=F.faceId+S.data[F.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),G.subMeshId=F.subMeshId,G}return G}clone(R,N,q){return null}releaseSubMeshes(){if(this.ae)for(;this.ae.length;)this.ae[0].dispose();else this.ae=[];return this}dispose(R){let N,q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const w=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),w.freeActiveMeshes(),w.freeRenderingGroups(),w.renderingManager.maintainStateBetweenFrames&&w.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((R=>R!==this&&R.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),N=0;N<this._intersectionsInProgress.length;N++){const R=this._intersectionsInProgress[N],q=R._intersectionsInProgress.indexOf(this);R._intersectionsInProgress.splice(q,1)}this._intersectionsInProgress.length=0;w.lights.forEach((R=>{let N=R.includedOnlyMeshes.indexOf(this);-1!==N&&R.includedOnlyMeshes.splice(N,1),N=R.excludedMeshes.indexOf(this),-1!==N&&R.excludedMeshes.splice(N,1);const q=R.getShadowGenerators();if(q){const R=q.values();for(let q=R.next();!0!==q.done;q=R.next()){const R=q.value.getShadowMap();R&&R.renderList&&(N=R.renderList.indexOf(this),-1!==N&&R.renderList.splice(N,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const u=w.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,u.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),u.wipeCaches(),w.Xe(this),this._parentContainer){const R=this._parentContainer.meshes.indexOf(this);R>-1&&this._parentContainer.meshes.splice(R,1),this._parentContainer=null}if(q&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!R)for(N=0;N<w.he.length;N++)w.he[N].k===this&&(w.he[N].dispose(),N--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(R,q)}_initFacetData(){const R=this._internalAbstractMeshDataInfo._facetData;R.facetNormals||(R.facetNormals=[]),R.facetPositions||(R.facetPositions=[]),R.facetPartitioning||(R.facetPartitioning=new Array),R.facetNb=this.Md().length/3|0,R.partitioningSubdivisions=R.partitioningSubdivisions?R.partitioningSubdivisions:10,R.partitioningBBoxRatio=R.partitioningBBoxRatio?R.partitioningBBoxRatio:1.01;for(let N=0;N<R.facetNb;N++)R.facetNormals[N]=M.m.Zero(),R.facetPositions[N]=M.m.Zero();return R.facetDataEnabled=!0,this}updateFacetData(){const R=this._internalAbstractMeshDataInfo._facetData;R.facetDataEnabled||this._initFacetData();const N=this.getVerticesData(v.e.PositionKind),q=this.Md(),w=this.getVerticesData(v.e.NormalKind),u=this.getBoundingInfo();if(R.facetDepthSort&&!R.facetDepthSortEnabled){if(R.facetDepthSortEnabled=!0,q instanceof Uint16Array)R.depthSortedIndices=new Uint16Array(q);else if(q instanceof Uint32Array)R.depthSortedIndices=new Uint32Array(q);else{let N=!1;for(let R=0;R<q.length;R++)if(q[R]>65535){N=!0;break}R.depthSortedIndices=N?new Uint32Array(q):new Uint16Array(q)}if(R.facetDepthSortFunction=function(R,N){return N.sqDistance-R.sqDistance},!R.facetDepthSortFrom){const N=this.va().activeCamera;R.facetDepthSortFrom=N?N.position:M.m.Zero()}R.depthSortedFacets=[];for(let N=0;N<R.facetNb;N++){const q={ind:3*N,sqDistance:0};R.depthSortedFacets.push(q)}R.invertedMatrix=M.c.Identity(),R.facetDepthSortOrigin=M.m.Zero()}R.bbSize.x=u.maximum.x-u.minimum.x>k.b?u.maximum.x-u.minimum.x:k.b,R.bbSize.y=u.maximum.y-u.minimum.y>k.b?u.maximum.y-u.minimum.y:k.b,R.bbSize.z=u.maximum.z-u.minimum.z>k.b?u.maximum.z-u.minimum.z:k.b;let J=R.bbSize.x>R.bbSize.y?R.bbSize.x:R.bbSize.y;if(J=J>R.bbSize.z?J:R.bbSize.z,R.subDiv.max=R.partitioningSubdivisions,R.subDiv.X=Math.floor(R.subDiv.max*R.bbSize.x/J),R.subDiv.Y=Math.floor(R.subDiv.max*R.bbSize.y/J),R.subDiv.Z=Math.floor(R.subDiv.max*R.bbSize.z/J),R.subDiv.X=R.subDiv.X<1?1:R.subDiv.X,R.subDiv.Y=R.subDiv.Y<1?1:R.subDiv.Y,R.subDiv.Z=R.subDiv.Z<1?1:R.subDiv.Z,R.facetParameters.facetNormals=this.getFacetLocalNormals(),R.facetParameters.facetPositions=this.getFacetLocalPositions(),R.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),R.facetParameters.bInfo=u,R.facetParameters.bbSize=R.bbSize,R.facetParameters.subDiv=R.subDiv,R.facetParameters.ratio=this.partitioningBBoxRatio,R.facetParameters.depthSort=R.facetDepthSort,R.facetDepthSort&&R.facetDepthSortEnabled&&(this.je(!0),this._worldMatrix.invertToRef(R.invertedMatrix),M.m.TransformCoordinatesToRef(R.facetDepthSortFrom,R.invertedMatrix,R.facetDepthSortOrigin),R.facetParameters.distanceTo=R.facetDepthSortOrigin),R.facetParameters.depthSortedFacets=R.depthSortedFacets,w&&G.d.ComputeNormals(N,q,w,R.facetParameters),R.facetDepthSort&&R.facetDepthSortEnabled){R.depthSortedFacets.sort(R.facetDepthSortFunction);const N=R.depthSortedIndices.length/3|0;for(let w=0;w<N;w++){const N=R.depthSortedFacets[w].ind;R.depthSortedIndices[3*w]=q[N],R.depthSortedIndices[3*w+1]=q[N+1],R.depthSortedIndices[3*w+2]=q[N+2]}this.updateIndices(R.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const R=this._internalAbstractMeshDataInfo._facetData;return R.facetNormals||this.updateFacetData(),R.facetNormals}getFacetLocalPositions(){const R=this._internalAbstractMeshDataInfo._facetData;return R.facetPositions||this.updateFacetData(),R.facetPositions}getFacetLocalPartitioning(){const R=this._internalAbstractMeshDataInfo._facetData;return R.facetPartitioning||this.updateFacetData(),R.facetPartitioning}getFacetPosition(R){const N=M.m.Zero();return this.getFacetPositionToRef(R,N),N}getFacetPositionToRef(R,N){const q=this.getFacetLocalPositions()[R],w=this.getWorldMatrix();return M.m.TransformCoordinatesToRef(q,w,N),this}getFacetNormal(R){const N=M.m.Zero();return this.getFacetNormalToRef(R,N),N}getFacetNormalToRef(R,N){const q=this.getFacetLocalNormals()[R];return M.m.TransformNormalToRef(q,this.getWorldMatrix(),N),this}getFacetsAtLocalCoordinates(R,N,q){const w=this.getBoundingInfo(),u=this._internalAbstractMeshDataInfo._facetData,M=Math.floor((R-w.minimum.x*u.partitioningBBoxRatio)*u.subDiv.X*u.partitioningBBoxRatio/u.bbSize.x),v=Math.floor((N-w.minimum.y*u.partitioningBBoxRatio)*u.subDiv.Y*u.partitioningBBoxRatio/u.bbSize.y),G=Math.floor((q-w.minimum.z*u.partitioningBBoxRatio)*u.subDiv.Z*u.partitioningBBoxRatio/u.bbSize.z);return M<0||M>u.subDiv.max||v<0||v>u.subDiv.max||G<0||G>u.subDiv.max?null:u.facetPartitioning[M+u.subDiv.max*v+u.subDiv.max*u.subDiv.max*G]}getClosestFacetAtCoordinates(R,N,q,w){let u=arguments.length>4&&void 0!==arguments[4]&&arguments[4],v=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const G=this.getWorldMatrix(),J=M.f.Matrix[5];G.invertToRef(J);const y=M.f.Od[8];M.m.TransformCoordinatesFromFloatsToRef(R,N,q,J,y);const a=this.getClosestFacetAtLocalCoordinates(y.x,y.y,y.z,w,u,v);return w&&M.m.TransformCoordinatesFromFloatsToRef(w.x,w.y,w.z,G,w),a}getClosestFacetAtLocalCoordinates(R,N,q,w){let u=arguments.length>4&&void 0!==arguments[4]&&arguments[4],M=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],v=null,G=0,J=0,y=0,a=0,j=0,F=0,S=0,H=0;const W=this.getFacetLocalPositions(),k=this.getFacetLocalNormals(),C=this.getFacetsAtLocalCoordinates(R,N,q);if(!C)return null;let e,K,r,Z=Number.MAX_VALUE,z=Z;for(let d=0;d<C.length;d++)e=C[d],K=k[e],r=W[e],a=(R-r.x)*K.x+(N-r.y)*K.y+(q-r.z)*K.z,(!u||u&&M&&a>=0||u&&!M&&a<=0)&&(a=K.x*r.x+K.y*r.y+K.z*r.z,j=-(K.x*R+K.y*N+K.z*q-a)/(K.x*K.x+K.y*K.y+K.z*K.z),F=R+K.x*j,S=N+K.y*j,H=q+K.z*j,G=F-R,J=S-N,y=H-q,z=G*G+J*J+y*y,z<Z&&(Z=z,v=e,w&&(w.x=F,w.y=S,w.z=H)));return v}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const R=this._internalAbstractMeshDataInfo._facetData;return R.facetDataEnabled&&(R.facetDataEnabled=!1,R.facetPositions=[],R.facetNormals=[],R.facetPartitioning=new Array,R.facetParameters=null,R.depthSortedIndices=new Uint32Array(0)),this}updateIndices(R,N){return this}createNormals(R){const N=this.getVerticesData(v.e.PositionKind),q=this.Md();let w;return w=this.isVerticesDataPresent(v.e.NormalKind)?this.getVerticesData(v.e.NormalKind):[],G.d.ComputeNormals(N,q,w,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(v.e.NormalKind,w,R),this}alignWithNormal(R,N){N||(N=C.d.Y);const q=M.f.Od[0],w=M.f.Od[1];return M.m.CrossToRef(N,R,w),M.m.CrossToRef(R,w,q),this.rotationQuaternion?M.e.RotationQuaternionFromAxisToRef(q,R,w,this.rotationQuaternion):M.m.RotationFromAxisToRef(q,R,w,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,S.c)("EdgesRenderer")}enableEdgesRendering(R,N,q){throw(0,S.c)("EdgesRenderer")}sj(){return this._scene.he.filter((R=>R.k===this))}}d.OCCLUSION_TYPE_NONE=0,d.OCCLUSION_TYPE_OPTIMISTIC=1,d.OCCLUSION_TYPE_STRICT=2,d.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,d.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,d.CULLINGSTRATEGY_STANDARD=0,d.Qi=1,d.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,d.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,w.b)([K.g.filter((function(){for(var R=arguments.length,N=new Array(R),q=0;q<R;q++)N[q]=arguments[q];let[w,u,M,v,G]=N;return!Array.isArray(w)&&!Array.isArray(u)&&!Array.isArray(M)&&!Array.isArray(v)&&!Array.isArray(G)}))],d,"_ApplySkeleton",null),(0,e.h)("BABYLON.AbstractMesh",d)},11405:(R,N,q)=>{"use strict";q.d(N,{b:()=>k});var w=q(966),u=q(1133),M=q(11403),v=q(1227),G=q(1312),J=q(11410),y=q(1328),a=q(1177),j=q(1131),F=q(1337),S=q(997),H=q(1159),W=q(1056);class k{get boundingBias(){return this._boundingBias}set boundingBias(R){this._boundingBias?this._boundingBias.p(R):this._boundingBias=R.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(R){const N=new k(k.RandomId(),R.va());return N.Ca(R),N}get meshes(){return this._meshes}constructor(R,N,q){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=N||S.e.LastCreatedScene,this._scene&&(this.id=R,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=w,q?this.setAllVerticesData(q,w):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),u&&(this.Ca(u),u.je(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let R=0;R<this._meshes.length;R++)if(!this._meshes[R].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const R=new Set;for(const N in this._vertexBuffers)R.add(this._vertexBuffers[N].getWrapperBuffer());R.forEach((R=>{R._rebuild()}))}setAllVerticesData(R,N){R.applyToGeometry(this,N),this._notifyUpdate()}Ga(R,N){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3?arguments[3]:void 0;q&&Array.isArray(N)&&(N=new Float32Array(N));const u=new v.e(this._engine,N,R,{updatable:q,postponeInternalCreation:0===this._meshes.length,stride:w,label:"Geometry_"+this.id+"_"+R});this.setVerticesBuffer(u)}removeVerticesData(R){this._vertexBuffers[R]&&(this._vertexBuffers[R].dispose(),delete this._vertexBuffers[R]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const u=R.getKind();this._vertexBuffers[u]&&q&&this._vertexBuffers[u].dispose(),R._buffer&&R._buffer._increaseReferences(),this._vertexBuffers[u]=R;const M=this._meshes,G=M.length;if(u===v.e.PositionKind){this._totalVertices=N??R._maxVerticesCount,this._updateExtend(R.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const q=this._extend&&this._extend.minimum||new w.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),u=this._extend&&this._extend.maximum||new w.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let R=0;R<G;R++){const N=M[R];N.buildBoundingInfo(q,u),N._createGlobalSubMesh(N.isUnIndexed),N.je(!0),N.synchronizeInstances()}}this._notifyUpdate(u)}updateVerticesDataDirectly(R,N,q){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const u=this.getVertexBuffer(R);u&&(u.updateDirectly(N,q,w),this._notifyUpdate(R))}updateVerticesData(R,N){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w=this.getVertexBuffer(R);w&&(w.update(N),R===v.e.PositionKind&&this.Ea(q,N),this._notifyUpdate(R))}Ea(R,N){if(R&&this._updateExtend(N),this._resetPointsArrayCache(),R){const R=this._meshes;for(const N of R){N.hasBoundingInfo?N.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):N.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const R=N.ae;for(const N of R)N.refreshBoundingInfo()}}}_bind(R,N,q,w){if(!R)return;void 0===N&&(N=this._indexBuffer);const u=this.getVertexBuffers();if(!u)return;if(N!=this._indexBuffer||!this._vertexArrayObjects&&!w)return void this._engine.bindBuffers(u,N,R,q);const M=w||this._vertexArrayObjects,v=this._engine;M[R.key]||(M[R.key]=v.recordVertexArrayObject(u,N,R,q)),v.bindVertexArrayObject(M[R.key],N)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(R,N,q){const w=this.getVertexBuffer(R);return w?w.getFloatData(this._totalVertices,q||N&&1!==this._meshes.length):null}copyVerticesData(R,N){const q=this.getVertexBuffer(R);if(!q)return;N[R]||(N[R]=new Float32Array(this._totalVertices*q.getSize()));const w=q.getData();w&&function(R,N,q,w,u,M,G,J){const y=N*v.e.GetTypeByteLength(q),a=G*N;if(J.length!==a)throw new Error("Output length is not valid");if(q===v.e.FLOAT&&u===y)if(R instanceof Array){const N=w/4;J.set(R,N)}else if(R instanceof ArrayBuffer){const N=new Float32Array(R,w,a);J.set(N)}else{const N=R.byteOffset+w;if(N%4)return W.e.Warn("CopyFloatData: copied misaligned data."),void J.set(new Float32Array(R.buffer.slice(N,N+4*a)));const q=new Float32Array(R.buffer,N,a);J.set(q)}else v.e.ForEach(R,w,u,N,q,a,M,((R,N)=>J[N]=R))}(w,q.getSize(),q.type,q.byteOffset,q.byteStride,q.normalized,this._totalVertices,N[R])}isVertexBufferUpdatable(R){const N=this._vertexBuffers[R];return!!N&&N.isUpdatable()}getVertexBuffer(R){return this.isReady()?this._vertexBuffers[R]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(R){return this._vertexBuffers?void 0!==this._vertexBuffers[R]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(R)}getVerticesDataKinds(){const R=[];let N;if(!this._vertexBuffers&&this._delayInfo)for(N in this._delayInfo)R.push(N);else for(N in this._vertexBuffers)R.push(N);return R}updateIndices(R,N){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const w=R.length!==this._indices.length;if(q||(this._indices=R.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,R,N),w)for(const R of this._meshes)R._createGlobalSubMesh(!0)}else this.setIndices(R,null,!0)}setIndexBuffer(R,N,q){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=R,this._totalVertices=N,this._totalIndices=q,R.is32Bits||(R.is32Bits=this._totalIndices>65535);for(const w of this._meshes)w._createGlobalSubMesh(!0),w.synchronizeInstances();this._notifyUpdate()}setIndices(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=R,this._indexBufferIsUpdatable=q,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,q,"Geometry_"+this.id+"_IndexBuffer")),void 0!=N&&(this._totalVertices=N);for(const u of this._meshes)u._createGlobalSubMesh(!w),u.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Md(R,N){if(!this.isReady())return null;const q=this._indices;return N||R&&1!==this._meshes.length?q.slice():q}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;R&&this._vertexArrayObjects&&this._vertexArrayObjects[R.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[R.key]),delete this._vertexArrayObjects[R.key])}releaseForMesh(R,N){const q=this._meshes,w=q.indexOf(R);-1!==w&&(q.splice(w,1),this._vertexArrayObjects&&R._invalidateInstanceVertexArrayObject(),R._geometry=null,0===q.length&&N&&this.dispose())}Ca(R){if(R._geometry===this)return;const N=R._geometry;N&&N.releaseForMesh(R),this._vertexArrayObjects&&R._invalidateInstanceVertexArrayObject();const q=this._meshes;R._geometry=this,R._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),q.push(R),this.isReady()?this._applyToMesh(R):this._boundingInfo&&R.setBoundingInfo(this._boundingInfo)}_updateExtend(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!R&&(R=this.getVerticesData(v.e.PositionKind),!R))return;this._extend=(0,F.g)(R,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(R){const N=this._meshes.length;for(const q in this._vertexBuffers)1===N&&this._vertexBuffers[q].create(),q===v.e.PositionKind&&(this._extend||this._updateExtend(),R.buildBoundingInfo(this._extend.minimum,this._extend.maximum),R._createGlobalSubMesh(R.isUnIndexed),R.Ea());1===N&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),R._syncGeometryWithMorphTargetManager(),R.synchronizeInstances()}_notifyUpdate(R){this.onGeometryUpdated&&this.onGeometryUpdated(this,R),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const N of this._meshes)N._markSubMeshesAsAttributesDirty()}load(R,N){2!==this.delayLoadState&&(this.isReady()?N&&N():(this.delayLoadState=2,this._queueLoad(R,N)))}_queueLoad(R,N){this.delayLoadingFile&&(R.addPendingData(this),R._loadFile(this.delayLoadingFile,(q=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(q),this),this.delayLoadState=1,this._delayInfo=[],R.removePendingData(this);const w=this._meshes,u=w.length;for(let R=0;R<u;R++)this._applyToMesh(w[R]);N&&N()}),void 0,!0))}toLeftHanded(){const R=this.Md(!1);if(null!=R&&R.length>0){for(let N=0;N<R.length;N+=3){const q=R[N+0];R[N+0]=R[N+2],R[N+2]=q}this.setIndices(R)}const N=this.getVerticesData(v.e.PositionKind,!1);if(null!=N&&N.length>0){for(let R=0;R<N.length;R+=3)N[R+2]=-N[R+2];this.Ga(v.e.PositionKind,N,!1)}const q=this.getVerticesData(v.e.NormalKind,!1);if(null!=q&&q.length>0){for(let R=0;R<q.length;R+=3)q[R+2]=-q[R+2];this.Ga(v.e.NormalKind,q,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const R=this.getVerticesData(v.e.PositionKind);if(!R||0===R.length)return!1;for(let N=3*this._positionsCache.length,q=this._positionsCache.length;N<R.length;N+=3,++q)this._positionsCache[q]=w.m.Sd(R,N);for(let N=0,q=0;N<R.length;N+=3,++q)this._positionsCache[q].set(R[0+N],R[1+N],R[2+N]);return this._positionsCache.length=R.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const q in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[q]);this._vertexArrayObjects={};const R=this._meshes,N=R.length;for(let q=0;q<N;q++)R[q]._invalidateInstanceVertexArrayObject()}}dispose(){const R=this._meshes,N=R.length;let q;for(q=0;q<N;q++)this.releaseForMesh(R[q]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const w in this._vertexBuffers)this._vertexBuffers[w].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const R=this._parentContainer.geometries.indexOf(this);R>-1&&this._parentContainer.geometries.splice(R,1),this._parentContainer=null}this._isDisposed=!0}j(R){const N=new M.d;N.indices=[];const q=this.Md();if(q)for(let M=0;M<q.length;M++)N.indices.push(q[M]);let w,u=!1,v=!1;for(w in this._vertexBuffers){const R=this.getVerticesData(w);if(R&&(R instanceof Float32Array?N.set(new Float32Array(R),w):N.set(R.slice(0),w),!v)){const R=this.getVertexBuffer(w);R&&(u=R.isUpdatable(),v=!u)}}const G=new k(R,this._scene,N,u);for(w in G.delayLoadState=this.delayLoadState,G.delayLoadingFile=this.delayLoadingFile,G._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)G._delayInfo=G._delayInfo||[],G._delayInfo.push(w);return G._boundingInfo=new y.b(this._extend.minimum,this._extend.maximum),G}serialize(){const R={};return R.id=this.id,R.uniqueId=this.uniqueId,R.updatable=this._updatable,j.d&&j.d.HasTags(this)&&(R.tags=j.d.GetTags(this)),R}_toNumberArray(R){return Array.isArray(R)?R:Array.prototype.slice.call(R)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const R in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,R)&&(this._vertexBuffers[R]._buffer._data=null)}serializeVerticeData(){const R=this.serialize();return this.isVerticesDataPresent(v.e.PositionKind)&&(R.xa=this._toNumberArray(this.getVerticesData(v.e.PositionKind)),this.isVertexBufferUpdatable(v.e.PositionKind)&&(R.xa._updatable=!0)),this.isVerticesDataPresent(v.e.NormalKind)&&(R.ya=this._toNumberArray(this.getVerticesData(v.e.NormalKind)),this.isVertexBufferUpdatable(v.e.NormalKind)&&(R.ya._updatable=!0)),this.isVerticesDataPresent(v.e.TangentKind)&&(R.tangents=this._toNumberArray(this.getVerticesData(v.e.TangentKind)),this.isVertexBufferUpdatable(v.e.TangentKind)&&(R.tangents._updatable=!0)),this.isVerticesDataPresent(v.e.UVKind)&&(R.Aa=this._toNumberArray(this.getVerticesData(v.e.UVKind)),this.isVertexBufferUpdatable(v.e.UVKind)&&(R.Aa._updatable=!0)),this.isVerticesDataPresent(v.e.UV2Kind)&&(R.uvs2=this._toNumberArray(this.getVerticesData(v.e.UV2Kind)),this.isVertexBufferUpdatable(v.e.UV2Kind)&&(R.uvs2._updatable=!0)),this.isVerticesDataPresent(v.e.UV3Kind)&&(R.uvs3=this._toNumberArray(this.getVerticesData(v.e.UV3Kind)),this.isVertexBufferUpdatable(v.e.UV3Kind)&&(R.uvs3._updatable=!0)),this.isVerticesDataPresent(v.e.UV4Kind)&&(R.uvs4=this._toNumberArray(this.getVerticesData(v.e.UV4Kind)),this.isVertexBufferUpdatable(v.e.UV4Kind)&&(R.uvs4._updatable=!0)),this.isVerticesDataPresent(v.e.UV5Kind)&&(R.uvs5=this._toNumberArray(this.getVerticesData(v.e.UV5Kind)),this.isVertexBufferUpdatable(v.e.UV5Kind)&&(R.uvs5._updatable=!0)),this.isVerticesDataPresent(v.e.UV6Kind)&&(R.uvs6=this._toNumberArray(this.getVerticesData(v.e.UV6Kind)),this.isVertexBufferUpdatable(v.e.UV6Kind)&&(R.uvs6._updatable=!0)),this.isVerticesDataPresent(v.e.ColorKind)&&(R.za=this._toNumberArray(this.getVerticesData(v.e.ColorKind)),this.isVertexBufferUpdatable(v.e.ColorKind)&&(R.za._updatable=!0)),this.isVerticesDataPresent(v.e.MatricesIndicesKind)&&(R.matricesIndices=this._toNumberArray(this.getVerticesData(v.e.MatricesIndicesKind)),R.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(v.e.MatricesIndicesKind)&&(R.matricesIndices._updatable=!0)),this.isVerticesDataPresent(v.e.MatricesWeightsKind)&&(R.matricesWeights=this._toNumberArray(this.getVerticesData(v.e.MatricesWeightsKind)),this.isVertexBufferUpdatable(v.e.MatricesWeightsKind)&&(R.matricesWeights._updatable=!0)),R.indices=this._toNumberArray(this.Md()),R}static ExtractFromMesh(R,N){const q=R._geometry;return q?q.j(N):null}static RandomId(){return a.i.RandomId()}static _GetGeometryByLoadedUniqueId(R,N){for(let q=0;q<N.geometries.length;q++)if(N.geometries[q]._loadedUniqueId===R)return N.geometries[q];return null}static _ImportGeometry(R,N){const q=N.va(),w=R.geometryUniqueId,M=R.geometryId;if(w||M){const R=w?this._GetGeometryByLoadedUniqueId(w,q):q.getGeometryById(M);R&&R.Ca(N)}else if(R instanceof ArrayBuffer){const q=N._binaryInfo;if(q.positionsAttrDesc&&q.positionsAttrDesc.count>0){const w=new Float32Array(R,q.positionsAttrDesc.offset,q.positionsAttrDesc.count);N.Ga(v.e.PositionKind,w,!1)}if(q.normalsAttrDesc&&q.normalsAttrDesc.count>0){const w=new Float32Array(R,q.normalsAttrDesc.offset,q.normalsAttrDesc.count);N.Ga(v.e.NormalKind,w,!1)}if(q.tangetsAttrDesc&&q.tangetsAttrDesc.count>0){const w=new Float32Array(R,q.tangetsAttrDesc.offset,q.tangetsAttrDesc.count);N.Ga(v.e.TangentKind,w,!1)}if(q.uvsAttrDesc&&q.uvsAttrDesc.count>0){const w=new Float32Array(R,q.uvsAttrDesc.offset,q.uvsAttrDesc.count);if(H.e)for(let R=1;R<w.length;R+=2)w[R]=1-w[R];N.Ga(v.e.UVKind,w,!1)}if(q.uvs2AttrDesc&&q.uvs2AttrDesc.count>0){const w=new Float32Array(R,q.uvs2AttrDesc.offset,q.uvs2AttrDesc.count);if(H.e)for(let R=1;R<w.length;R+=2)w[R]=1-w[R];N.Ga(v.e.UV2Kind,w,!1)}if(q.uvs3AttrDesc&&q.uvs3AttrDesc.count>0){const w=new Float32Array(R,q.uvs3AttrDesc.offset,q.uvs3AttrDesc.count);if(H.e)for(let R=1;R<w.length;R+=2)w[R]=1-w[R];N.Ga(v.e.UV3Kind,w,!1)}if(q.uvs4AttrDesc&&q.uvs4AttrDesc.count>0){const w=new Float32Array(R,q.uvs4AttrDesc.offset,q.uvs4AttrDesc.count);if(H.e)for(let R=1;R<w.length;R+=2)w[R]=1-w[R];N.Ga(v.e.UV4Kind,w,!1)}if(q.uvs5AttrDesc&&q.uvs5AttrDesc.count>0){const w=new Float32Array(R,q.uvs5AttrDesc.offset,q.uvs5AttrDesc.count);if(H.e)for(let R=1;R<w.length;R+=2)w[R]=1-w[R];N.Ga(v.e.UV5Kind,w,!1)}if(q.uvs6AttrDesc&&q.uvs6AttrDesc.count>0){const w=new Float32Array(R,q.uvs6AttrDesc.offset,q.uvs6AttrDesc.count);if(H.e)for(let R=1;R<w.length;R+=2)w[R]=1-w[R];N.Ga(v.e.UV6Kind,w,!1)}if(q.colorsAttrDesc&&q.colorsAttrDesc.count>0){const w=new Float32Array(R,q.colorsAttrDesc.offset,q.colorsAttrDesc.count);N.Ga(v.e.ColorKind,w,!1,q.colorsAttrDesc.stride)}if(q.matricesIndicesAttrDesc&&q.matricesIndicesAttrDesc.count>0){const w=new Int32Array(R,q.matricesIndicesAttrDesc.offset,q.matricesIndicesAttrDesc.count),u=[];for(let R=0;R<w.length;R++){const N=w[R];u.push(255&N),u.push((65280&N)>>8),u.push((16711680&N)>>16),u.push(N>>24&255)}N.Ga(v.e.MatricesIndicesKind,u,!1)}if(q.matricesIndicesExtraAttrDesc&&q.matricesIndicesExtraAttrDesc.count>0){const w=new Int32Array(R,q.matricesIndicesExtraAttrDesc.offset,q.matricesIndicesExtraAttrDesc.count),u=[];for(let R=0;R<w.length;R++){const N=w[R];u.push(255&N),u.push((65280&N)>>8),u.push((16711680&N)>>16),u.push(N>>24&255)}N.Ga(v.e.MatricesIndicesExtraKind,u,!1)}if(q.matricesWeightsAttrDesc&&q.matricesWeightsAttrDesc.count>0){const w=new Float32Array(R,q.matricesWeightsAttrDesc.offset,q.matricesWeightsAttrDesc.count);N.Ga(v.e.MatricesWeightsKind,w,!1)}if(q.indicesAttrDesc&&q.indicesAttrDesc.count>0){const w=new Int32Array(R,q.indicesAttrDesc.offset,q.indicesAttrDesc.count);N.setIndices(w,null)}if(q.subMeshesAttrDesc&&q.subMeshesAttrDesc.count>0){const w=new Int32Array(R,q.subMeshesAttrDesc.offset,5*q.subMeshesAttrDesc.count);N.ae=[];for(let R=0;R<q.subMeshesAttrDesc.count;R++){const q=w[5*R+0],u=w[5*R+1],M=w[5*R+2],v=w[5*R+3],J=w[5*R+4];G.e.AddToMesh(q,u,M,v,J,N)}}}else if(R.xa&&R.ya&&R.indices){if(N.Ga(v.e.PositionKind,R.xa,R.xa._updatable),N.Ga(v.e.NormalKind,R.ya,R.ya._updatable),R.tangents&&N.Ga(v.e.TangentKind,R.tangents,R.tangents._updatable),R.Aa&&N.Ga(v.e.UVKind,R.Aa,R.Aa._updatable),R.uvs2&&N.Ga(v.e.UV2Kind,R.uvs2,R.uvs2._updatable),R.uvs3&&N.Ga(v.e.UV3Kind,R.uvs3,R.uvs3._updatable),R.uvs4&&N.Ga(v.e.UV4Kind,R.uvs4,R.uvs4._updatable),R.uvs5&&N.Ga(v.e.UV5Kind,R.uvs5,R.uvs5._updatable),R.uvs6&&N.Ga(v.e.UV6Kind,R.uvs6,R.uvs6._updatable),R.za&&N.Ga(v.e.ColorKind,u.d.CheckColors4(R.za,R.xa.length/3),R.za._updatable),R.matricesIndices)if(R.matricesIndices._isExpanded)delete R.matricesIndices._isExpanded,N.Ga(v.e.MatricesIndicesKind,R.matricesIndices,R.matricesIndices._updatable);else{const q=[];for(let N=0;N<R.matricesIndices.length;N++){const w=R.matricesIndices[N];q.push(255&w),q.push((65280&w)>>8),q.push((16711680&w)>>16),q.push(w>>24&255)}N.Ga(v.e.MatricesIndicesKind,q,R.matricesIndices._updatable)}if(R.matricesIndicesExtra)if(R.matricesIndicesExtra._isExpanded)delete R.matricesIndices._isExpanded,N.Ga(v.e.MatricesIndicesExtraKind,R.matricesIndicesExtra,R.matricesIndicesExtra._updatable);else{const q=[];for(let N=0;N<R.matricesIndicesExtra.length;N++){const w=R.matricesIndicesExtra[N];q.push(255&w),q.push((65280&w)>>8),q.push((16711680&w)>>16),q.push(w>>24&255)}N.Ga(v.e.MatricesIndicesExtraKind,q,R.matricesIndicesExtra._updatable)}R.matricesWeights&&(k._CleanMatricesWeights(R,N),N.Ga(v.e.MatricesWeightsKind,R.matricesWeights,R.matricesWeights._updatable)),R.matricesWeightsExtra&&N.Ga(v.e.MatricesWeightsExtraKind,R.matricesWeightsExtra,R.matricesWeights._updatable),N.setIndices(R.indices,null)}if(R.ae){N.ae=[];for(let q=0;q<R.ae.length;q++){const w=R.ae[q];G.e.AddToMesh(w.materialIndex,w.verticesStart,w.verticesCount,w.indexStart,w.indexCount,N)}}N._shouldGenerateFlatShading&&(N.convertToFlatShadedMesh(),N._shouldGenerateFlatShading=!1),N.je(!0),q.onMeshImportedObservable.notifyObservers(N)}static _CleanMatricesWeights(R,N){const q=.001;if(!J.c.CleanBoneMatrixWeights)return;let w=0;if(!(R.skeletonId>-1))return;{const q=N.va().getLastSkeletonById(R.skeletonId);if(!q)return;w=q.bones.length}const u=N.getVerticesData(v.e.MatricesIndicesKind),M=N.getVerticesData(v.e.MatricesIndicesExtraKind),G=R.matricesWeights,y=R.matricesWeightsExtra,a=R.numBoneInfluencer,j=G.length;for(let v=0;v<j;v+=4){let R=0,N=-1;for(let w=0;w<4;w++){const u=G[v+w];R+=u,u<q&&N<0&&(N=w)}if(y)for(let w=0;w<4;w++){const u=y[v+w];R+=u,u<q&&N<0&&(N=w+4)}if((N<0||N>a-1)&&(N=a-1),R>q){const N=1/R;for(let R=0;R<4;R++)G[v+R]*=N;if(y)for(let R=0;R<4;R++)y[v+R]*=N}else N>=4?(y[v+N-4]=1-R,M[v+N-4]=w):(G[v+N]=1-R,u[v+N]=w)}N.Ga(v.e.MatricesIndicesKind,u),R.matricesWeightsExtra&&N.Ga(v.e.MatricesIndicesExtraKind,M)}static Parse(R,N,q){const u=new k(R.id,N,void 0,R.updatable);return u._loadedUniqueId=R.uniqueId,j.d&&j.d.AddTagsTo(u,R.tags),R.delayLoadingFile?(u.delayLoadState=4,u.delayLoadingFile=q+R.delayLoadingFile,u._boundingInfo=new y.b(w.m.Sd(R.boundingBoxMinimum),w.m.Sd(R.boundingBoxMaximum)),u._delayInfo=[],R.hasUVs&&u._delayInfo.push(v.e.UVKind),R.hasUVs2&&u._delayInfo.push(v.e.UV2Kind),R.hasUVs3&&u._delayInfo.push(v.e.UV3Kind),R.hasUVs4&&u._delayInfo.push(v.e.UV4Kind),R.hasUVs5&&u._delayInfo.push(v.e.UV5Kind),R.hasUVs6&&u._delayInfo.push(v.e.UV6Kind),R.hasColors&&u._delayInfo.push(v.e.ColorKind),R.hasMatricesIndices&&u._delayInfo.push(v.e.MatricesIndicesKind),R.hasMatricesWeights&&u._delayInfo.push(v.e.MatricesWeightsKind),u._delayLoadingFunction=M.d.ImportVertexData):M.d.ImportVertexData(R,u),N.pushGeometry(u,!0),u}}},12033:(R,N,q)=>{"use strict";q.d(N,{d:()=>F});var w=q(966),u=q(1056),M=q(11412),v=q(11381),G=q(1186),J=q(11420),y=q(1227),a=q(1177),j=q(982);v.b._instancedMeshFactory=(R,N)=>{const q=new F(R,N);if(N.instancedBuffers){q.instancedBuffers={};for(const R in N.instancedBuffers)q.instancedBuffers[R]=N.instancedBuffers[R]}return q};class F extends M.e{constructor(R,N){super(R,N.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,N.Gj(this),this._sourceMesh=N,this._unIndexed=N._unIndexed,this.position.p(N.position),this.rotation.p(N.rotation),this.Fe.p(N.Fe),N.rotationQuaternion&&(this.rotationQuaternion=N.rotationQuaternion.clone()),this.animations=N.animations.slice();for(const q of N.getAnimationRanges())null!=q&&this.createAnimationRange(q.name,q.from,q.to);this.infiniteDistance=N.infiniteDistance,this.setPivotMatrix(N.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(R){var N;(null===(N=this._sourceMesh)||void 0===N?void 0:N.receiveShadows)!==R&&a.i.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(R){var N;(null===(N=this._sourceMesh)||void 0===N?void 0:N.material)!==R&&a.i.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(R){var N;(null===(N=this._sourceMesh)||void 0===N?void 0:N.visibility)!==R&&a.i.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(R){var N;(null===(N=this._sourceMesh)||void 0===N?void 0:N.skeleton)!==R&&a.i.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(R){this._sourceMesh&&R!==this._sourceMesh.renderingGroupId&&u.e.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}pd(R){return this._sourceMesh.pd(R)}isReady(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(R,!0)}getVerticesData(R,N,q){return this._sourceMesh.getVerticesData(R,N,q)}copyVerticesData(R,N){this._sourceMesh.copyVerticesData(R,N)}Ga(R,N,q,w){return this.sourceMesh&&this.sourceMesh.Ga(R,N,q,w),this.sourceMesh}updateVerticesData(R,N,q,w){return this.sourceMesh&&this.sourceMesh.updateVerticesData(R,N,q,w),this.sourceMesh}setIndices(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(R,N),this.sourceMesh}isVerticesDataPresent(R){return this._sourceMesh.isVerticesDataPresent(R)}Md(){return this._sourceMesh.Md()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let R,N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;R="object"===typeof N?N:{applySkeleton:N,applyMorph:q};const w=this._sourceMesh.te?this._sourceMesh.te.boundingBias:null;return this.Fa(this._sourceMesh._getData(R,null,y.e.PositionKind),w),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(R,N){if(super._activate(R,N),this._sourceMesh.ae||u.e.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,R),N){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==J.d.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new w.c);const R=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,w.f.Od[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.je(!0)),this._currentLOD.position.p(w.f.Od[7]),this._currentLOD._masterMesh=R,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(R){if(!R)return this;const N=this.sourceMesh.getLODLevels();if(N&&0!==N.length){const N=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(R,N.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(R){return this.sourceMesh._preActivateForIntermediateRendering(R)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.ae)for(let R=0;R<this._sourceMesh.ae.length;R++)this._sourceMesh.ae[R].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2?arguments[2]:void 0;const w=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).pd(R);if(G.c.DeepCopy(this,w,["name","ae","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","rj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),N&&(w.parent=N),!q)for(let u=0;u<this.va().meshes.length;u++){const R=this.va().meshes[u];R.parent===this&&R.clone(R.name,w)}return w.je(!0),this.onClonedObservable.notifyObservers(w),w}dispose(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Fj(this),super.dispose(R,N)}_serializeAsParent(R){super._serializeAsParent(R),R.parentId=this._sourceMesh.uniqueId,R.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,N=arguments.length>1?arguments[1]:void 0,q=arguments.length>2?arguments[2]:void 0;const w=this.clone("Clone of "+(this.name||this.id),R||this.parent,!0,N&&N.newSourcedMesh);w&&q&&q(this,w);for(const u of this.getChildTransformNodes(!0))u.instantiateHierarchy(w,N,q);return w}}v.b.prototype.registerInstancedBuffer=function(R,N){var q,w;if(null===(q=this._userInstancedBuffersStorage)||void 0===q||null===(w=q.vertexBuffers[R])||void 0===w||w.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const R of this.instances)R.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[R]=null,this._userInstancedBuffersStorage.strides[R]=N,this._userInstancedBuffersStorage.sizes[R]=32*N,this._userInstancedBuffersStorage.data[R]=new Float32Array(this._userInstancedBuffersStorage.sizes[R]),this._userInstancedBuffersStorage.vertexBuffers[R]=new y.e(this.getEngine(),this._userInstancedBuffersStorage.data[R],R,!0,!1,N,!0);for(const u of this.instances)u.instancedBuffers[R]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},v.b.prototype._processInstancedBuffers=function(R,N){const q=R?R.length:0;for(const w in this.instancedBuffers){let u=this._userInstancedBuffersStorage.sizes[w];const M=this._userInstancedBuffersStorage.strides[w],v=(q+1)*M;for(;u<v;)u*=2;this._userInstancedBuffersStorage.data[w].length!=u&&(this._userInstancedBuffersStorage.data[w]=new Float32Array(u),this._userInstancedBuffersStorage.sizes[w]=u,this._userInstancedBuffersStorage.vertexBuffers[w]&&(this._userInstancedBuffersStorage.vertexBuffers[w].dispose(),this._userInstancedBuffersStorage.vertexBuffers[w]=null));const G=this._userInstancedBuffersStorage.data[w];let J=0;if(N){const R=this.instancedBuffers[w];R.toArray?R.toArray(G,J):R.copyToArray?R.copyToArray(G,J):G[J]=R,J+=M}for(let N=0;N<q;N++){const q=R[N].instancedBuffers[w];q.toArray?q.toArray(G,J):q.copyToArray?q.copyToArray(G,J):G[J]=q,J+=M}this._userInstancedBuffersStorage.vertexBuffers[w]?this._userInstancedBuffersStorage.vertexBuffers[w].updateDirectly(G,0):(this._userInstancedBuffersStorage.vertexBuffers[w]=new y.e(this.getEngine(),this._userInstancedBuffersStorage.data[w],w,!0,!1,M,!0),this._invalidateInstanceVertexArrayObject())}},v.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const R in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[R]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},v.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const R in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[R]&&this._userInstancedBuffersStorage.vertexBuffers[R].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,j.h)("BABYLON.InstancedMesh",F)},11381:(R,N,q)=>{"use strict";q.d(N,{b:()=>o,d:()=>P});var w=q(959),u=q(1177),M=q(1186),v=q(1131),G=q(11388),J=q(11396),y=q(966),a=q(1133),j=q(11398),F=q(1227),S=q(11403),H=q(11405),W=q(11412),k=q(1312),C=q(1306),e=q(11429),K=q(11410),r=q(1128),Z=q(1056),z=q(982),d=q(1044),x=q(1255);class E{constructor(R,N){this.distanceOrScreenCoverage=R,this.mesh=N}}class P{}class s{constructor(){this.visibleInstances={},this.batchCache=new O,this.batchCacheReplacementModeInFrozenMode=new O,this.instancesBufferSize=2048}}class O{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class L{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class m{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class o extends W.e{static _GetDefaultSideOrientation(R){return R||o.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(R){this._internalMeshDataInfo._useLODScreenCoverage=R,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(R){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==R&&(R&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(F.e.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(F.e.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=R,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new w.c),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new w.c),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new w.c),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new w.c),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new w.c),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(R){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(R)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(R){this._internalMeshDataInfo._forcedInstanceCount=R}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(R){this._internalMeshDataInfo._sideOrientation=R,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===R||!this._scene.useRightHandedSystem&&0===R}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(R){this.sideOrientation=R,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(R){this._internalMeshDataInfo._overrideRenderingFillMode=R}get material(){return this._internalAbstractMeshDataInfo._material}set material(R){R&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(R.sideOrientation=null),this._setMaterial(R)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(R){this._unIndexed!==R&&(this._unIndexed=R,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(R){this._instanceDataStorage.manualUpdate=R}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(R){this._instanceDataStorage.previousManualUpdate=R}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(R){this._instanceDataStorage.forceMatrixUpdates=R}_copySource(R,N){let q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const w=this.va();if(R._geometry&&R._geometry.Ca(this),M.c.DeepCopy(R,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","te","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","rj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=R,w.useClonedMeshMap&&(R._internalMeshDataInfo.meshMap||(R._internalMeshDataInfo.meshMap={}),R._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=R._originalBuilderSideOrientation,this._creationDataStorage=R._creationDataStorage,R._ranges){const N=R._ranges;for(const R in N)Object.prototype.hasOwnProperty.call(N,R)&&N[R]&&this.createAnimationRange(R,N[R].from,N[R].to)}if(R.metadata&&R.metadata.clone?this.metadata=R.metadata.clone():this.metadata=R.metadata,this._internalMetadata=R._internalMetadata,v.d&&v.d.HasTags(R)&&v.d.AddTagsTo(this,v.d.GetTags(R,!0)),this.Jg(R.isEnabled(!1)),this.parent=R.parent,this.setPivotMatrix(R.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+R.id,this.material=R.material,!N){const N=R.getDescendants(!0);for(let R=0;R<N.length;R++){const q=N[R];q.clone&&q.clone(this.name+"."+q.name,this)}}if(R.morphTargetManager&&(this.morphTargetManager=R.morphTargetManager),w.getPhysicsEngine){const N=w.getPhysicsEngine();if(q&&N)if(1===N.getPluginVersion()){const q=N.getImpostorForPhysicsObject(R);q&&(this.physicsImpostor=q.clone(this))}else 2===N.getPluginVersion()&&R.physicsBody&&R.physicsBody.clone(this)}for(let u=0;u<w.he.length;u++){const N=w.he[u];N.k===R&&N.clone(N.name,this)}this.skeleton=R.skeleton,this.refreshBoundingInfo(!0,!0),this.je(!0)}constructor(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4?arguments[4]:void 0,v=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(R,N),this._internalMeshDataInfo=new m,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new s,this._thinInstanceDataStorage=new L,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=o.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,N=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(R,N,q)=>{R&&q&&(this._uniformBuffer?this.transferToEffect(N):q.bindOnlyWorldMatrix(N))},u&&this._copySource(u,M,v),null!==q&&(this.parent=q),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=R=>{R.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new w.c(this._internalMeshDataInfo._onMeshReadyObserverAdded),u&&u.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,N=arguments.length>1?arguments[1]:void 0,q=arguments.length>2?arguments[2]:void 0;const w=0===this.getTotalVertices()||N&&N.doNotInstantiate&&(!0===N.doNotInstantiate||N.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),R||this.parent,!0):this.pd("instance of "+(this.name||this.id));w.parent=R||this.parent,w.position=this.position.clone(),w.Fe=this.Fe.clone(),this.rotationQuaternion?w.rotationQuaternion=this.rotationQuaternion.clone():w.rotation=this.rotation.clone(),q&&q(this,w);for(const u of this.getChildTransformNodes(!0))"InstancedMesh"===u.getClassName()&&"Mesh"===w.getClassName()&&u.sourceMesh===this?u.instantiateHierarchy(w,{doNotInstantiate:N&&N.doNotInstantiate||!1,newSourcedMesh:w},q):u.instantiateHierarchy(w,N,q);return w}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(R){let N=super.toString(R);if(N+=", n vertices: "+this.getTotalVertices(),N+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let q=0;q<this.animations.length;q++)N+=", animation[0]: "+this.animations[q].toString(R);if(R)if(this._geometry){const R=this.Md(),q=this.getVerticesData(F.e.PositionKind);q&&R&&(N+=", flat shading: "+(q.length/3===R.length?"YES":"NO"))}else N+=", flat shading: UNKNOWN";return N}_unBindEffect(){super._unBindEffect();for(const R of this.instances)R._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const R=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((N,q)=>N.distanceOrScreenCoverage<q.distanceOrScreenCoverage?R:N.distanceOrScreenCoverage>q.distanceOrScreenCoverage?-R:0))}addLODLevel(R,N){if(N&&N._masterMesh)return Z.e.Warn("You cannot use a mesh as LOD level twice"),this;const q=new E(R,N);return this._internalMeshDataInfo._LODLevels.push(q),N&&(N._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(R){const N=this._internalMeshDataInfo;for(let q=0;q<N._LODLevels.length;q++){const w=N._LODLevels[q];if(w.distanceOrScreenCoverage===R)return w.mesh}return null}removeLODLevel(R){const N=this._internalMeshDataInfo;for(let q=0;q<N._LODLevels.length;q++)N._LODLevels[q].mesh===R&&(N._LODLevels.splice(q,1),R&&(R._masterMesh=null));return this._sortLODLevels(),this}getLOD(R,N){const q=this._internalMeshDataInfo;if(!q._LODLevels||0===q._LODLevels.length)return this;const w=N||this.getBoundingInfo().boundingSphere,u=R.mode===J.e.ORTHOGRAPHIC_CAMERA?R.dj:w.centerWorld.Vc(R.globalPosition).length();let M=u,v=1;if(q._useLODScreenCoverage){const N=R.screenArea;let q=w.radiusWorld*R.dj/u;q=q*q*Math.PI,M=q/N,v=-1}if(v*q._LODLevels[q._LODLevels.length-1].distanceOrScreenCoverage>v*M)return this.onLODLevelSelection&&this.onLODLevelSelection(M,this,this),this;for(let G=0;G<q._LODLevels.length;G++){const R=q._LODLevels[G];if(v*R.distanceOrScreenCoverage<v*M){if(R.mesh){if(4===R.mesh.delayLoadState)return R.mesh._checkDelayState(),this;if(2===R.mesh.delayLoadState)return this;R.mesh._preActivate(),R.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(M,this,R.mesh),R.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(M,this,this),this}get te(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(R,N,q,w){var u,M;if(!this._geometry)return null;let v=w||null===(u=this._userInstancedBuffersStorage)||void 0===u||null===(M=u.vertexBuffers[R])||void 0===M?void 0:M.getFloatData(this.instances.length+1,q||N&&1!==this._geometry.meshes.length);return v||(v=this._geometry.getVerticesData(R,N,q)),v}copyVerticesData(R,N){this._geometry&&this._geometry.copyVerticesData(R,N)}getVertexBuffer(R,N){var q;return this._geometry?(N||null===(q=this._userInstancedBuffersStorage)||void 0===q?void 0:q.vertexBuffers[R])??this._geometry.getVertexBuffer(R):null}isVerticesDataPresent(R,N){var q;return this._geometry?!N&&void 0!==(null===(q=this._userInstancedBuffersStorage)||void 0===q?void 0:q.vertexBuffers[R])||this._geometry.isVerticesDataPresent(R):!!this._delayInfo&&-1!==this._delayInfo.indexOf(R)}isVertexBufferUpdatable(R,N){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(R);if(!N){var q;const N=null===(q=this._userInstancedBuffersStorage)||void 0===q?void 0:q.vertexBuffers[R];if(N)return N.isUpdatable()}return this._geometry.isVertexBufferUpdatable(R)}getVerticesDataKinds(R){if(!this._geometry){const R=[];return this._delayInfo&&this._delayInfo.forEach((function(N){R.push(N)})),R}const N=this._geometry.getVerticesDataKinds();if(!R&&this._userInstancedBuffersStorage)for(const q in this._userInstancedBuffersStorage.vertexBuffers)-1===N.indexOf(q)&&N.push(q);return N}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Md(R,N){return this._geometry?this._geometry.Md(R,N):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(R))return!1;if(!this.ae||0===this.ae.length)return!0;if(!R)return!0;const q=this.getEngine(),w=this.va(),u=N||q.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.je();const M=this.material||w.defaultMaterial;if(M)if(M._storeEffectOnSubMeshes)for(const F of this.ae){const R=F.Ha();if(R)if(R._storeEffectOnSubMeshes){if(!R.isReadyForSubMesh(this,F,u))return!1}else if(!R.isReady(this,u))return!1}else if(!M.isReady(this,u))return!1;const v=q.currentRenderPassId;for(const F of this.lightSources){const R=F.getShadowGenerators();if(!R)continue;const N=R.values();for(let w=N.next();!0!==w.done;w=N.next()){var G,J,y,a;const R=w.value;if(R&&(null===(G=R.getShadowMap())||void 0===G||!G.renderList||null!==(J=R.getShadowMap())&&void 0!==J&&J.renderList&&-1!==(null===(y=R.getShadowMap())||void 0===y||null===(a=y.renderList)||void 0===a?void 0:a.indexOf(this)))){const N=R.getShadowMap().renderPassIds??[q.currentRenderPassId];for(let w=0;w<N.length;++w){q.currentRenderPassId=N[w];for(const N of this.ae){var j;if(!R.isReady(N,u,(null===(j=N.Ha())||void 0===j?void 0:j.needAlphaBlendingForMesh(this))??!1))return q.currentRenderPassId=v,!1}}q.currentRenderPassId=v}}}for(const F of this._internalMeshDataInfo._LODLevels)if(F.mesh&&!F.mesh.isReady(u))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}ai(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(R){this._instanceDataStorage.overridenInstanceCount=R}_preActivate(){const R=this._internalMeshDataInfo,N=this.va().getRenderId();return R._preActivateId===N||(R._preActivateId=N,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(R){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=R),this}_registerInstanceForRenderId(R,N){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:N,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[N]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=N,this._instanceDataStorage.visibleInstances[N]=new Array),this._instanceDataStorage.visibleInstances[N].push(R),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let R,N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;R="object"===typeof N?N:{applySkeleton:N,applyMorph:q};const w=this.te?this.te.boundingBias:null;return this.Fa(this._getData(R,null,F.e.PositionKind),w),this}_createGlobalSubMesh(R){const N=this.getTotalVertices();if(!N||!this.Md())return null;if(this.ae&&this.ae.length>0){const q=this.Md();if(!q)return null;const w=q.length;let u=!1;if(R)u=!0;else for(const R of this.ae){if(R.indexStart+R.indexCount>w){u=!0;break}if(R.verticesStart+R.verticesCount>N){u=!0;break}}if(!u)return this.ae[0]}return this.releaseSubMeshes(),new k.e(0,0,N,0,this.getTotalIndices(),this)}subdivide(R){if(R<1)return;const N=this.getTotalIndices();let q=N/R|0,w=0;for(;q%3!==0;)q++;this.releaseSubMeshes();for(let u=0;u<R&&!(w>=N);u++)k.e.CreateFromIndices(0,w,u===R-1?N-w:q,this,void 0,!1),w+=q;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(R,N){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(R,N,q,w);else{const w=new S.d;w.set(N,R);const u=this.va();new H.b(H.b.RandomId(),u,w,q,this)}return this}removeVerticesData(R){this._geometry&&this._geometry.removeVerticesData(R)}markVerticesDataAsUpdatable(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const q=this.getVertexBuffer(R);q&&q.isUpdatable()!==N&&this.Ga(R,this.getVerticesData(R),N)}setVerticesBuffer(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=H.b.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(R,null,N),this}updateVerticesData(R,N,q,w){return this._geometry?(w?(this.makeGeometryUnique(),this.updateVerticesData(R,N,q,!1)):this._geometry.updateVerticesData(R,N,q),this):this}updateMeshPositions(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const q=this.getVerticesData(F.e.PositionKind);if(!q)return this;if(R(q),this.updateVerticesData(F.e.PositionKind,q,!1,!1),N){const R=this.Md(),N=this.getVerticesData(F.e.NormalKind);if(!N)return this;S.d.ComputeNormals(q,R,N),this.updateVerticesData(F.e.NormalKind,N,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const R=this._geometry,N=this._geometry.j(H.b.RandomId());return R.releaseForMesh(this,!0),N.Ca(this),this}setIndexBuffer(R,N,q){let w=this._geometry;w||(w=new H.b(H.b.RandomId(),this.va(),void 0,void 0,this)),w.setIndexBuffer(R,N,q)}setIndices(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(R,N,q,w);else{const N=new S.d;N.indices=R;const w=this.va();new H.b(H.b.RandomId(),w,N,q,this)}return this}updateIndices(R,N){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(R,N,q),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(R,N,q){let w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const u=this.va().getEngine();let M;if(this._unIndexed)if(this._getRenderingFillMode(q)===C.e.WireFrameFillMode)M=R._getLinesIndexBuffer(this.Md(),u);else M=null;else switch(this._getRenderingFillMode(q)){case C.e.PointFillMode:M=null;break;case C.e.WireFrameFillMode:M=R._getLinesIndexBuffer(this.Md(),u);break;default:case C.e.TriangleFillMode:M=this._geometry.getIndexBuffer()}return this._bindDirect(N,M,w)}_bindDirect(R,N){let q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(R),q&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(R,N,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(R,N),this):this}_draw(R,N,q){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const w=this.va().getEngine();return this._unIndexed&&N!==C.e.WireFrameFillMode||N==C.e.PointFillMode?w.drawArraysType(N,R.verticesStart,R.verticesCount,this.forcedInstanceCount||q):N==C.e.WireFrameFillMode?w.drawElementsType(N,0,R._linesIndexCount,this.forcedInstanceCount||q):w.drawElementsType(N,R.indexStart,R.indexCount,this.forcedInstanceCount||q),this}registerBeforeRender(R){return this.onBeforeRenderObservable.add(R),this}unregisterBeforeRender(R){return this.onBeforeRenderObservable.removeCallback(R),this}registerAfterRender(R){return this.onAfterRenderObservable.add(R),this}unregisterAfterRender(R){return this.onAfterRenderObservable.removeCallback(R),this}_getInstancesRenderList(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(N)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[R]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[R]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const q=this.va(),w=q._isInIntermediateRendering(),u=w?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,M=this._instanceDataStorage.batchCache;if(M.mustReturn=!1,M.renderSelf[R]=N||!u&&this.isEnabled()&&this.isVisible,M.visibleInstances[R]=null,this._instanceDataStorage.visibleInstances&&!N){const N=this._instanceDataStorage.visibleInstances,u=q.getRenderId(),v=w?N.intermediateDefaultRenderId:N.defaultRenderId;M.visibleInstances[R]=N[u],!M.visibleInstances[R]&&v&&(M.visibleInstances[R]=N[v])}return M.hardwareInstancedRendering[R]=!N&&this._instanceDataStorage.hardwareInstancedRendering&&null!==M.visibleInstances[R]&&void 0!==M.visibleInstances[R],this._instanceDataStorage.previousBatch=M,M}_renderWithInstances(R,N,q,w,u){const M=q.visibleInstances[R._id],v=M?M.length:0,G=this._instanceDataStorage,J=G.instancesBufferSize;let a=G.instancesBuffer,j=G.instancesPreviousBuffer;const S=16*(v+1)*4;for(;G.instancesBufferSize<S;)G.instancesBufferSize*=2;G.instancesData&&J==G.instancesBufferSize||(G.instancesData=new Float32Array(G.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!G.instancesPreviousData||J!=G.instancesBufferSize)&&(G.instancesPreviousData=new Float32Array(G.instancesBufferSize/4));let H=0,W=0;const k=q.renderSelf[R._id],C=!a||J!==G.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!G.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||G.isFrozen&&!C)W=(k?1:0)+v;else{const N=this.getWorldMatrix();if(k&&(this._scene.needsPreviousWorldMatrices&&(G.masterMeshPreviousWorldMatrix?(G.masterMeshPreviousWorldMatrix.copyToArray(G.instancesPreviousData,H),G.masterMeshPreviousWorldMatrix.p(N)):(G.masterMeshPreviousWorldMatrix=N.clone(),G.masterMeshPreviousWorldMatrix.copyToArray(G.instancesPreviousData,H))),N.copyToArray(G.instancesData,H),H+=16,W++),M){var e;if(o.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(e=R.Ha())&&void 0!==e&&e.needAlphaBlendingForMesh(R.getRenderingMesh())){const R=this._scene.activeCamera.globalPosition;for(let N=0;N<M.length;N++){const q=M[N];q._distanceToCamera=y.m.Distance(q.getBoundingInfo().boundingSphere.centerWorld,R)}M.sort(((R,N)=>R._distanceToCamera>N._distanceToCamera?-1:R._distanceToCamera<N._distanceToCamera?1:0))}for(let R=0;R<M.length;R++){const N=M[R],q=N.getWorldMatrix();q.copyToArray(G.instancesData,H),this._scene.needsPreviousWorldMatrices&&(N._previousWorldMatrix?(N._previousWorldMatrix.copyToArray(G.instancesPreviousData,H),N._previousWorldMatrix.p(q)):(N._previousWorldMatrix=q.clone(),N._previousWorldMatrix.copyToArray(G.instancesPreviousData,H))),H+=16,W++}}}return C?(a&&a.dispose(),j&&j.dispose(),a=new F.b(u,G.instancesData,!0,16,!1,!0),G.instancesBuffer=a,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=a.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=a.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=a.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=a.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(j=new F.b(u,G.instancesPreviousData,!0,16,!1,!0),G.instancesPreviousBuffer=j,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=j.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=j.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=j.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=j.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(a.updateDirectly(G.instancesData,0,W),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||j.updateDirectly(G.instancesPreviousData,0,W)),this._processInstancedBuffers(M,k),this.va()._activeIndices.addCount(R.indexCount*W,!1),u._currentDrawContext&&(u._currentDrawContext.useInstancing=!0),this._bind(R,w,N),this._draw(R,N,W),!this._scene.needsPreviousWorldMatrices||C||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||j.updateDirectly(G.instancesData,0,W),u.unbindInstanceAttributes(),this}_renderWithThinInstances(R,N,q,w){var u;const M=(null===(u=this._thinInstanceDataStorage)||void 0===u?void 0:u.instancesCount)??0;this.va()._activeIndices.addCount(R.indexCount*M,!1),w._currentDrawContext&&(w._currentDrawContext.useInstancing=!0),this._bind(R,q,N),this._draw(R,N,M),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,M):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),w.unbindInstanceAttributes()}_processInstancedBuffers(R,N){}_processRendering(R,N,q,w,u,M,v,G){const J=this.va(),y=J.getEngine();if(w=this._getRenderingFillMode(w),M&&N.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(N,w,q,y),this;if(M)this._renderWithInstances(N,w,u,q,y);else{y._currentDrawContext&&(y._currentDrawContext.useInstancing=!1);let q=0;u.renderSelf[N._id]&&(v&&v(!1,R.getWorldMatrix(),G),q++,this._draw(N,w,this._instanceDataStorage.overridenInstanceCount));const M=u.visibleInstances[N._id];if(M){const R=M.length;q+=R;for(let q=0;q<R;q++){const R=M[q].getWorldMatrix();v&&v(!0,R,G),this._draw(N,w)}}J._activeIndices.addCount(N.indexCount*q,!1)}return this}_rebuild(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(R&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const N in this._userInstancedBuffersStorage.vertexBuffers){const q=this._userInstancedBuffersStorage.vertexBuffers[N];q&&(R&&q.dispose(),this._userInstancedBuffersStorage.vertexBuffers[N]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(R)}_freeze(){if(this.ae){for(let R=0;R<this.ae.length;R++)this._getInstancesRenderList(R);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(R,N,q,w){let u=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const M=this._scene.getEngine(),v=M.currentRenderPassId;if(void 0!==R&&(M.currentRenderPassId=R),w)(!u||u&&w.isInFrustum(this._scene._frustumPlanes))&&this.render(w,!!N,q);else for(let G=0;G<this.ae.length;G++){const R=this.ae[G];(!u||u&&R.isInFrustum(this._scene._frustumPlanes))&&this.render(R,!!N,q)}return void 0!==R&&(M.currentRenderPassId=v),this}directRender(){if(!this.ae)return this;for(const R of this.ae)this.render(R,!1);return this}render(R,N,q){var w,u,M;const v=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const G=(null===(w=v.activeCameras)||void 0===w?void 0:w.length)??0;if((G>1&&v.activeCamera===v.activeCameras[0]||G<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const J=this._getInstancesRenderList(R._id,!!q);if(J.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const y=v.getEngine();let a=0,j=null;this.ignoreCameraMaxZ&&v.activeCamera&&!v._isInIntermediateRendering()&&(a=v.activeCamera.maxZ,j=v.activeCamera,v.activeCamera.maxZ=0,v.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const F=R.getRenderingMesh(),S=J.hardwareInstancedRendering[R._id]||F.hasThinInstances||!!this._userInstancedBuffersStorage&&!R.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,H=this._instanceDataStorage,W=R.Ha();if(!W)return j&&(j.maxZ=a,v.updateTransformMatrix(!0)),this;if(H.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===W){if(W._storeEffectOnSubMeshes&&(null===(u=R._drawWrapper)||void 0===u||!u._wasPreviouslyReady)||!W._storeEffectOnSubMeshes&&!W._getDrawWrapper()._wasPreviouslyReady)return j&&(j.maxZ=a,v.updateTransformMatrix(!0)),this}else{if(W._storeEffectOnSubMeshes){if(!W.isReadyForSubMesh(this,R,S))return j&&(j.maxZ=a,v.updateTransformMatrix(!0)),this}else if(!W.isReady(this,S))return j&&(j.maxZ=a,v.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=W}let k;N&&y.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),k=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?R._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const e=(null===(M=k)||void 0===M?void 0:M.effect)??null;for(const C of v._beforeRenderingMeshStage)C.action(this,R,J,e);if(!k||!e)return j&&(j.maxZ=a,v.updateTransformMatrix(!0)),this;const K=q||this;let r;if(H.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.re&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)r=H.sideOrientation;else{const R=K._getWorldMatrixDeterminant();r=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),R<0&&(r=r===C.e.ClockWiseSideOrientation?C.e.CounterClockWiseSideOrientation:C.e.ClockWiseSideOrientation),H.sideOrientation=r}const Z=this._internalMeshDataInfo._effectiveMaterial._preBind(k,r);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&y.setDepthWrite(!0);const z=this._internalMeshDataInfo._effectiveMaterial,d=z.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),S||this._bind(R,e,d,!1);const x=K.getWorldMatrix();z._storeEffectOnSubMeshes?z.bindForSubMesh(x,this,R):z.bind(x,this),!z.re&&z.separateCullingPass&&(y.setState(!0,z.zOffset,!1,!Z,z.cullBackFaces,z.stencil,z.zOffsetUnits),this._processRendering(this,R,e,d,J,S,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),y.setState(!0,z.zOffset,!1,Z,z.cullBackFaces,z.stencil,z.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(R)),this._processRendering(this,R,e,d,J,S,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const C of v._afterRenderingMeshStage)C.action(this,R,J,e);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),j&&(j.maxZ=a,v.updateTransformMatrix(!0)),2!==v.performancePriority||H.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(F.e.MatricesWeightsKind)&&(this.isVerticesDataPresent(F.e.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const R=this.getVerticesData(F.e.MatricesWeightsKind),N=R.length;for(let q=0;q<N;q+=4){const N=R[q]+R[q+1]+R[q+2]+R[q+3];if(0===N)R[q]=1;else{const w=1/N;R[q]*=w,R[q+1]*=w,R[q+2]*=w,R[q+3]*=w}}this.Ga(F.e.MatricesWeightsKind,R)}_normalizeSkinWeightsAndExtra(){const R=this.getVerticesData(F.e.MatricesWeightsExtraKind),N=this.getVerticesData(F.e.MatricesWeightsKind),q=N.length;for(let w=0;w<q;w+=4){let q=N[w]+N[w+1]+N[w+2]+N[w+3];if(q+=R[w]+R[w+1]+R[w+2]+R[w+3],0===q)N[w]=1;else{const u=1/q;N[w]*=u,N[w+1]*=u,N[w+2]*=u,N[w+3]*=u,R[w]*=u,R[w+1]*=u,R[w+2]*=u,R[w+3]*=u}}this.Ga(F.e.MatricesWeightsKind,N),this.Ga(F.e.MatricesWeightsKind,R)}validateSkinning(){const R=this.getVerticesData(F.e.MatricesWeightsExtraKind),N=this.getVerticesData(F.e.MatricesWeightsKind);if(null===N||null==this.skeleton)return{skinned:!1,valid:!0,Ie:"not skinned"};const q=N.length;let w=0,u=0,M=0,v=0;const G=null===R?4:8,J=[];for(let F=0;F<=G;F++)J[F]=0;for(let F=0;F<q;F+=4){let q=N[F],y=q,a=0===y?0:1;for(let u=1;u<G;u++){const M=u<4?N[F+u]:R[F+u-4];M>q&&w++,0!==M&&a++,y+=M,q=M}if(J[a]++,a>M&&(M=a),0===y)u++;else{const q=1/y;let w=0;for(let u=0;u<G;u++)w+=u<4?Math.abs(N[F+u]-N[F+u]*q):Math.abs(R[F+u-4]-R[F+u-4]*q);w>.001&&v++}}const y=this.skeleton.bones.length,a=this.getVerticesData(F.e.MatricesIndicesKind),j=this.getVerticesData(F.e.MatricesIndicesExtraKind);let S=0;for(let F=0;F<q;F+=4)for(let R=0;R<G;R++){const N=R<4?a[F+R]:j[F+R-4];(N>=y||N<0)&&S++}return{skinned:!0,valid:0===u&&0===v&&0===S,Ie:"Number of Weights = "+q/4+"\nMaximum influences = "+M+"\nMissing Weights = "+u+"\nNot Sorted = "+w+"\nNot Normalized = "+v+"\nWeightCounts = ["+J+"]\nNumber of bones = "+y+"\nBad Bone Indices = "+S}}_checkDelayState(){const R=this.va();return this._geometry?this._geometry.load(R):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(R)),this}_queueLoad(R){R.addPendingData(this);const N=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return u.i.LoadFile(this.delayLoadingFile,(N=>{N instanceof ArrayBuffer?this._delayLoadingFunction(N,this):this._delayLoadingFunction(JSON.parse(N),this),this.instances.forEach((R=>{R.refreshBoundingInfo(),R._syncSubMeshes()})),this.delayLoadState=1,R.removePendingData(this)}),(()=>{}),R.offlineProvider,N),this}isInFrustum(R){return 2!==this.delayLoadState&&(!!super.isInFrustum(R)&&(this._checkDelayState(),!0))}setMaterialById(R){const N=this.va().materials;let q;for(q=N.length-1;q>-1;q--)if(N[q].id===R)return this.material=N[q],this;const w=this.va().multiMaterials;for(q=w.length-1;q>-1;q--)if(w[q].id===R)return this.material=w[q],this;return this}getAnimatables(){const R=[];return this.material&&R.push(this.material),this.skeleton&&R.push(this.skeleton),R}bakeTransformIntoVertices(R){if(!this.isVerticesDataPresent(F.e.PositionKind))return this;const N=this.ae.splice(0);this._resetPointsArrayCache();let q=this.getVerticesData(F.e.PositionKind);const w=y.m.Zero();let u;for(u=0;u<q.length;u+=3)y.m.TransformCoordinatesFromFloatsToRef(q[u],q[u+1],q[u+2],R,w).toArray(q,u);if(this.Ga(F.e.PositionKind,q,this.getVertexBuffer(F.e.PositionKind).isUpdatable()),this.isVerticesDataPresent(F.e.NormalKind)){for(q=this.getVerticesData(F.e.NormalKind),u=0;u<q.length;u+=3)y.m.TransformNormalFromFloatsToRef(q[u],q[u+1],q[u+2],R,w).normalize().toArray(q,u);this.Ga(F.e.NormalKind,q,this.getVertexBuffer(F.e.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(F.e.TangentKind)){for(q=this.getVerticesData(F.e.TangentKind),u=0;u<q.length;u+=4)y.m.TransformNormalFromFloatsToRef(q[u],q[u+1],q[u+2],R,w).normalize().toArray(q,u);this.Ga(F.e.TangentKind,q,this.getVertexBuffer(F.e.TangentKind).isUpdatable())}return R.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.ae=N,this}bakeCurrentTransformIntoVertices(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.je(!0)),this.resetLocalMatrix(R),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0,q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new o(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),R,this,N,q)}dispose(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const q=this._internalMeshDataInfo;if(q._onBeforeDrawObservable&&q._onBeforeDrawObservable.clear(),q._onBeforeBindObservable&&q._onBeforeBindObservable.clear(),q._onBeforeRenderObservable&&q._onBeforeRenderObservable.clear(),q._onAfterRenderObservable&&q._onAfterRenderObservable.clear(),q._onBetweenPassObservable&&q._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(q.meshMap)for(const R in q.meshMap){const N=q.meshMap[R];N&&(N._internalMeshDataInfo._source=null,q.meshMap[R]=void 0)}q._source&&q._source._internalMeshDataInfo.meshMap&&(q._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const R=this.va().meshes;for(const N of R){const R=N;R._internalMeshDataInfo&&R._internalMeshDataInfo._source&&R._internalMeshDataInfo._source===this&&(R._internalMeshDataInfo._source=null)}}q._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(R,N)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(R,N,q,w,M,v){let G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7?arguments[7]:void 0;const y=this.va();return u.i.LoadImage(R,(R=>{const u=R.width,J=R.height,y=this.getEngine().createCanvas(u,J).getContext("2d");y.drawImage(R,0,0);const a=y.getImageData(0,0,u,J).data;this.applyDisplacementMapFromBuffer(a,u,J,N,q,M,v,G),w&&w(this)}),J||(()=>{}),y.offlineProvider),this}applyDisplacementMapFromBuffer(R,N,q,w,u,M,v){let G=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(F.e.PositionKind)||!this.isVerticesDataPresent(F.e.NormalKind)||!this.isVerticesDataPresent(F.e.UVKind))return Z.e.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const J=this.getVerticesData(F.e.PositionKind,!0,!0),a=this.getVerticesData(F.e.NormalKind),j=this.getVerticesData(F.e.UVKind);let H=y.m.Zero();const W=y.m.Zero(),k=y.j.Zero();M=M||y.j.Zero(),v=v||new y.j(1,1);for(let F=0;F<J.length;F+=3){y.m.FromArrayToRef(J,F,H),y.m.FromArrayToRef(a,F,W),y.j.FromArrayToRef(j,F/3*2,k);const G=4*((Math.abs(k.x*v.x+M.x%1)*(N-1)%N|0)+(Math.abs(k.y*v.y+M.y%1)*(q-1)%q|0)*N),S=.3*(R[G]/255)+.59*(R[G+1]/255)+.11*(R[G+2]/255);W.normalize(),W.scaleInPlace(w+(u-w)*S),H=H.add(W),H.toArray(J,F)}return S.d.ComputeNormals(J,this.Md(),a),G?(this.Ga(F.e.PositionKind,J),this.Ga(F.e.NormalKind,a),this.Ga(F.e.UVKind,j)):(this.updateVerticesData(F.e.PositionKind,J),this.updateVerticesData(F.e.NormalKind,a)),this}_getFlattenedNormals(R,N){const q=new Float32Array(3*R.length);let w=0;const u=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let M=0;M<R.length;M+=3){const v=y.m.Sd(N,3*R[M]),G=y.m.Sd(N,3*R[M+1]),J=y.m.Sd(N,3*R[M+2]),a=v.Vc(G),j=J.Vc(G),F=y.m.Normalize(y.m.Cross(a,j));u&&F.scaleInPlace(-1);for(let R=0;R<3;R++)q[w++]=F.x,q[w++]=F.y,q[w++]=F.z}return q}_convertToUnIndexedMesh(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const N=this.getVerticesDataKinds().filter((R=>{var N;return!(null!==(N=this.getVertexBuffer(R))&&void 0!==N&&N.getIsInstanced())})),q=this.Md(),w={},u=(R,N)=>{const w=new Float32Array(q.length*N);let u=0;for(let M=0;M<q.length;M++)for(let v=0;v<N;v++)w[u++]=R[q[M]*N+v];return w},M=this.getBoundingInfo(),v=this.te?this.ae.slice(0):[];for(const G of N)w[G]=this.getVerticesData(G);for(const G of N){const N=this.getVertexBuffer(G),M=N.getSize();if(R&&G===F.e.NormalKind){const R=this._getFlattenedNormals(q,w[F.e.PositionKind]);this.Ga(F.e.NormalKind,R,N.isUpdatable(),M)}else this.Ga(G,u(w[G],M),N.isUpdatable(),M)}if(this.morphTargetManager){for(let N=0;N<this.morphTargetManager.numTargets;N++){const w=this.morphTargetManager.getTarget(N),M=w.getPositions();w.setPositions(u(M,3));const v=w.getNormals();v&&w.setNormals(R?this._getFlattenedNormals(q,M):u(v,3));const G=w.getTangents();G&&w.setTangents(u(G,3));const J=w.getUVs();J&&w.setUVs(u(J,2))}this.morphTargetManager.synchronize()}for(let G=0;G<q.length;G++)q[G]=G;this.setIndices(q),this._unIndexed=!0,this.releaseSubMeshes();for(const G of v){const R=G.getBoundingInfo();k.e.AddToMesh(G.materialIndex,G.indexStart,G.indexCount,G.indexStart,G.indexCount,this).setBoundingInfo(R)}return this.setBoundingInfo(M),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const N=S.d.ExtractFromMesh(this);let q;if(R&&this.isVerticesDataPresent(F.e.NormalKind)&&N.ya){for(q=0;q<N.ya.length;q++)N.ya[q]*=-1;this.Ga(F.e.NormalKind,N.ya,this.isVertexBufferUpdatable(F.e.NormalKind))}if(N.indices){let R;for(q=0;q<N.indices.length;q+=3)R=N.indices[q+1],N.indices[q+1]=N.indices[q+2],N.indices[q+2]=R;this.setIndices(N.indices,null,this.isVertexBufferUpdatable(F.e.PositionKind),!0)}return this}increaseVertices(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const N=S.d.ExtractFromMesh(this),q=N.indices&&!Array.isArray(N.indices)&&Array.from?Array.from(N.indices):N.indices,w=N.xa&&!Array.isArray(N.xa)&&Array.from?Array.from(N.xa):N.xa,u=N.Aa&&!Array.isArray(N.Aa)&&Array.from?Array.from(N.Aa):N.Aa,M=N.ya&&!Array.isArray(N.ya)&&Array.from?Array.from(N.ya):N.ya;if(q&&w){N.indices=q,N.xa=w,u&&(N.Aa=u),M&&(N.ya=M);const v=R+1,G=new Array;for(let R=0;R<v+1;R++)G[R]=new Array;let J,a;const j=new y.m(0,0,0),S=new y.m(0,0,0),H=new y.j(0,0),W=new Array,k=new Array,C=new Array;let e,K,r,Z=w.length;u&&(K=u.length),M&&(r=M.length);for(let R=0;R<q.length;R+=3){k[0]=q[R],k[1]=q[R+1],k[2]=q[R+2];for(let R=0;R<3;R++)if(J=k[R],a=k[(R+1)%3],void 0===C[J]&&void 0===C[a]?(C[J]=new Array,C[a]=new Array):(void 0===C[J]&&(C[J]=new Array),void 0===C[a]&&(C[a]=new Array)),void 0===C[J][a]&&void 0===C[a][J]){C[J][a]=[],j.x=(w[3*a]-w[3*J])/v,j.y=(w[3*a+1]-w[3*J+1])/v,j.z=(w[3*a+2]-w[3*J+2])/v,M&&(S.x=(M[3*a]-M[3*J])/v,S.y=(M[3*a+1]-M[3*J+1])/v,S.z=(M[3*a+2]-M[3*J+2])/v),u&&(H.x=(u[2*a]-u[2*J])/v,H.y=(u[2*a+1]-u[2*J+1])/v),C[J][a].push(J);for(let R=1;R<v;R++)C[J][a].push(w.length/3),w[Z++]=w[3*J]+R*j.x,w[Z++]=w[3*J+1]+R*j.y,w[Z++]=w[3*J+2]+R*j.z,M&&(M[r++]=M[3*J]+R*S.x,M[r++]=M[3*J+1]+R*S.y,M[r++]=M[3*J+2]+R*S.z),u&&(u[K++]=u[2*J]+R*H.x,u[K++]=u[2*J+1]+R*H.y);C[J][a].push(a),C[a][J]=new Array,e=C[J][a].length;for(let R=0;R<e;R++)C[a][J][R]=C[J][a][e-1-R]}G[0][0]=q[R],G[1][0]=C[q[R]][q[R+1]][1],G[1][1]=C[q[R]][q[R+2]][1];for(let N=2;N<v;N++){G[N][0]=C[q[R]][q[R+1]][N],G[N][N]=C[q[R]][q[R+2]][N],j.x=(w[3*G[N][N]]-w[3*G[N][0]])/N,j.y=(w[3*G[N][N]+1]-w[3*G[N][0]+1])/N,j.z=(w[3*G[N][N]+2]-w[3*G[N][0]+2])/N,M&&(S.x=(M[3*G[N][N]]-M[3*G[N][0]])/N,S.y=(M[3*G[N][N]+1]-M[3*G[N][0]+1])/N,S.z=(M[3*G[N][N]+2]-M[3*G[N][0]+2])/N),u&&(H.x=(u[2*G[N][N]]-u[2*G[N][0]])/N,H.y=(u[2*G[N][N]+1]-u[2*G[N][0]+1])/N);for(let R=1;R<N;R++)G[N][R]=w.length/3,w[Z++]=w[3*G[N][0]]+R*j.x,w[Z++]=w[3*G[N][0]+1]+R*j.y,w[Z++]=w[3*G[N][0]+2]+R*j.z,M&&(M[r++]=M[3*G[N][0]]+R*S.x,M[r++]=M[3*G[N][0]+1]+R*S.y,M[r++]=M[3*G[N][0]+2]+R*S.z),u&&(u[K++]=u[2*G[N][0]]+R*H.x,u[K++]=u[2*G[N][0]+1]+R*H.y)}G[v]=C[q[R+1]][q[R+2]],W.push(G[0][0],G[1][0],G[1][1]);for(let R=1;R<v;R++){let N;for(N=0;N<R;N++)W.push(G[R][N],G[R+1][N],G[R+1][N+1]),W.push(G[R][N],G[R+1][N+1],G[R][N+1]);W.push(G[R][N],G[R+1][N],G[R+1][N+1])}}N.indices=W,N.Ca(this,this.isVertexBufferUpdatable(F.e.PositionKind))}else Z.e.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const R=S.d.ExtractFromMesh(this),N=R.Aa,q=R.indices,w=R.xa,u=R.za,M=R.matricesIndices,v=R.matricesWeights,G=R.matricesIndicesExtra,J=R.matricesWeightsExtra;if(void 0===q||void 0===w||null===q||null===w)Z.e.Warn("VertexData contains empty entries");else{const y=new Array,a=new Array,j=new Array,H=new Array,W=new Array,k=new Array,C=new Array,e=new Array;let K=new Array,r=0;const Z={};let z,d;for(let R=0;R<q.length;R+=3){d=[q[R],q[R+1],q[R+2]],K=[];for(let R=0;R<3;R++){K[R]="";for(let N=0;N<3;N++)Math.abs(w[3*d[R]+N])<1e-8&&(w[3*d[R]+N]=0),K[R]+=w[3*d[R]+N]+"|"}if(K[0]!=K[1]&&K[0]!=K[2]&&K[1]!=K[2])for(let R=0;R<3;R++){if(z=Z[K[R]],void 0===z){Z[K[R]]=r,z=r++;for(let N=0;N<3;N++)y.push(w[3*d[R]+N]);if(null!==u&&void 0!==u)for(let N=0;N<4;N++)H.push(u[4*d[R]+N]);if(null!==N&&void 0!==N)for(let q=0;q<2;q++)j.push(N[2*d[R]+q]);if(null!==M&&void 0!==M)for(let N=0;N<4;N++)W.push(M[4*d[R]+N]);if(null!==v&&void 0!==v)for(let N=0;N<4;N++)k.push(v[4*d[R]+N]);if(null!==G&&void 0!==G)for(let N=0;N<4;N++)C.push(G[4*d[R]+N]);if(null!==J&&void 0!==J)for(let N=0;N<4;N++)e.push(J[4*d[R]+N])}a.push(z)}}const x=new Array;S.d.ComputeNormals(y,a,x),R.xa=y,R.indices=a,R.ya=x,null!==N&&void 0!==N&&(R.Aa=j),null!==u&&void 0!==u&&(R.za=H),null!==M&&void 0!==M&&(R.matricesIndices=W),null!==v&&void 0!==v&&(R.matricesWeights=k),null!==G&&void 0!==G&&(R.matricesIndicesExtra=C),null!==v&&void 0!==v&&(R.matricesWeightsExtra=e),R.Ca(this,this.isVertexBufferUpdatable(F.e.PositionKind))}}static _instancedMeshFactory(R,N){throw(0,d.c)("InstancedMesh")}static _PhysicsImpostorParser(R,N,q){throw(0,d.c)("PhysicsImpostor")}pd(R){const N=o._instancedMeshFactory(R,this);return N.parent=this.parent,N}synchronizeInstances(){for(let R=0;R<this.instances.length;R++){this.instances[R]._syncSubMeshes()}return this}optimizeIndices(R){const N=this.Md(),q=this.getVerticesData(F.e.PositionKind);if(!q||!N)return this;const w=[];for(let u=0;u<q.length;u+=3)w.push(y.m.Sd(q,u));const M=[];return u.e.SyncAsyncForLoop(w.length,40,(R=>{const N=w.length-1-R,q=w[N];for(let u=0;u<N;++u){const R=w[u];if(q.equals(R)){M[N]=u;break}}}),(()=>{for(let R=0;R<N.length;++R)N[R]=M[N[R]]||N[R];const q=this.ae.slice(0);this.setIndices(N),this.ae=q,R&&R(this)})),this}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};R.name=this.name,R.id=this.id,R.uniqueId=this.uniqueId,R.type=this.getClassName(),v.d&&v.d.HasTags(this)&&(R.tags=v.d.GetTags(this)),R.position=this.position.de(),this.rotationQuaternion?R.rotationQuaternion=this.rotationQuaternion.de():this.rotation&&(R.rotation=this.rotation.de()),R.Fe=this.Fe.de(),this._postMultiplyPivotMatrix?R.pivotMatrix=this.getPivotMatrix().de():R.localMatrix=this.getPivotMatrix().de(),R.isEnabled=this.isEnabled(!1),R.isVisible=this.isVisible,R.infiniteDistance=this.infiniteDistance,R.pickable=this.Me,R.receiveShadows=this.receiveShadows,R.billboardMode=this.billboardMode,R.visibility=this.visibility,R.Ye=this.Ye,R.checkCollisions=this.checkCollisions,R.ellipsoid=this.ellipsoid.de(),R.ellipsoidOffset=this.ellipsoidOffset.de(),R.Da=this.Da,R.isBlocker=this.isBlocker,R.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(R),R.isUnIndexed=this.isUnIndexed;const N=this._geometry;if(N&&this.ae){R.geometryUniqueId=N.uniqueId,R.geometryId=N.id,R.ae=[];for(let N=0;N<this.ae.length;N++){const q=this.ae[N];R.ae.push({materialIndex:q.materialIndex,verticesStart:q.verticesStart,verticesCount:q.verticesCount,indexStart:q.indexStart,indexCount:q.indexCount})}}if(this.material?this.material.doNotSerialize||(R.materialUniqueId=this.material.uniqueId,R.materialId=this.material.id):(this.material=null,R.materialUniqueId=this._scene.defaultMaterial.uniqueId,R.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(R.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(R.skeletonId=this.skeleton.id,R.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(x.b.NAME_PHYSICSENGINE)){const N=this.getPhysicsImpostor();N&&(R.physicsMass=N.getParam("mass"),R.physicsFriction=N.getParam("friction"),R.physicsRestitution=N.getParam("mass"),R.physicsImpostor=N.type)}this.metadata&&(R.metadata=this.metadata),R.instances=[];for(let q=0;q<this.instances.length;q++){const N=this.instances[q];if(N.doNotSerialize)continue;const w={name:N.name,id:N.id,isEnabled:N.isEnabled(!1),isVisible:N.isVisible,Me:N.Me,checkCollisions:N.checkCollisions,position:N.position.de(),Fe:N.Fe.de()};if(N.parent&&N.parent._serializeAsParent(w),N.rotationQuaternion?w.rotationQuaternion=N.rotationQuaternion.de():N.rotation&&(w.rotation=N.rotation.de()),this.va()._getComponent(x.b.NAME_PHYSICSENGINE)){const R=N.getPhysicsImpostor();R&&(w.physicsMass=R.getParam("mass"),w.physicsFriction=R.getParam("friction"),w.physicsRestitution=R.getParam("mass"),w.physicsImpostor=R.type)}N.metadata&&(w.metadata=N.metadata),N.actionManager&&(w.actions=N.actionManager.serialize(N.name)),R.instances.push(w),r.e.AppendSerializedAnimations(N,w),w.ranges=N.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(R.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const N={data:{},sizes:{},strides:{}};for(const R in this._userThinInstanceBuffersStorage.data)N.data[R]=Array.from(this._userThinInstanceBuffersStorage.data[R]),N.sizes[R]=this._userThinInstanceBuffersStorage.sizes[R],N.strides[R]=this._userThinInstanceBuffersStorage.strides[R];R.thinInstances.userThinInstance=N}return r.e.AppendSerializedAnimations(this,R),R.ranges=this.serializeAnimationRanges(),R.layerMask=this.layerMask,R.alphaIndex=this.alphaIndex,R.hasVertexAlpha=this.hasVertexAlpha,R.overlayAlpha=this.overlayAlpha,R.overlayColor=this.overlayColor.de(),R.renderOverlay=this.renderOverlay,R.applyFog=this.applyFog,this.actionManager&&(R.actions=this.actionManager.serialize(this.name)),R}_syncGeometryWithMorphTargetManager(){if(!this.te)return;this._markSubMeshesAsAttributesDirty();const R=this._internalAbstractMeshDataInfo._morphTargetManager;if(R&&R.vertexCount){if(R.vertexCount!==this.getTotalVertices())return Z.e.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(R.isUsingTextureForTargets)return;for(let N=0;N<R.numInfluencers;N++){const q=R.getActiveTarget(N),w=q.getPositions();if(!w)return void Z.e.Error("Invalid morph target. Target must have positions.");this.te.Ga(F.e.PositionKind+N,w,!1,3);const u=q.getNormals();u&&this.te.Ga(F.e.NormalKind+N,u,!1,3);const M=q.getTangents();M&&this.te.Ga(F.e.TangentKind+N,M,!1,3);const v=q.getUVs();v&&this.te.Ga(F.e.UVKind+"_"+N,v,!1,2)}}else{let R=0;for(;this.te.isVerticesDataPresent(F.e.PositionKind+R);)this.te.removeVerticesData(F.e.PositionKind+R),this.te.isVerticesDataPresent(F.e.NormalKind+R)&&this.te.removeVerticesData(F.e.NormalKind+R),this.te.isVerticesDataPresent(F.e.TangentKind+R)&&this.te.removeVerticesData(F.e.TangentKind+R),this.te.isVerticesDataPresent(F.e.UVKind+R)&&this.te.removeVerticesData(F.e.UVKind+"_"+R),R++}}static Parse(R,N,q){let w;if(w=R.type&&"LinesMesh"===R.type?o._LinesMeshParser(R,N):R.type&&"GroundMesh"===R.type?o._GroundMeshParser(R,N):R.type&&"GoldbergMesh"===R.type?o._GoldbergMeshParser(R,N):R.type&&"GreasedLineMesh"===R.type?o._GreasedLineMeshParser(R,N):R.type&&"TrailMesh"===R.type?o._TrailMeshParser(R,N):new o(R.name,N),w.id=R.id,w._waitingParsedUniqueId=R.uniqueId,v.d&&v.d.AddTagsTo(w,R.tags),w.position=y.m.Sd(R.position),void 0!==R.metadata&&(w.metadata=R.metadata),R.rotationQuaternion?w.rotationQuaternion=y.e.Sd(R.rotationQuaternion):R.rotation&&(w.rotation=y.m.Sd(R.rotation)),w.Fe=y.m.Sd(R.Fe),R.localMatrix?w.setPreTransformMatrix(y.c.Sd(R.localMatrix)):R.pivotMatrix&&w.setPivotMatrix(y.c.Sd(R.pivotMatrix)),w.Jg(R.isEnabled),w.isVisible=R.isVisible,w.infiniteDistance=R.infiniteDistance,w.Ye=!!R.Ye,w.showBoundingBox=R.showBoundingBox,w.showSubMeshesBoundingBox=R.showSubMeshesBoundingBox,void 0!==R.applyFog&&(w.applyFog=R.applyFog),void 0!==R.pickable&&(w.Me=R.pickable),void 0!==R.alphaIndex&&(w.alphaIndex=R.alphaIndex),w.receiveShadows=R.receiveShadows,void 0!==R.billboardMode&&(w.billboardMode=R.billboardMode),void 0!==R.visibility&&(w.visibility=R.visibility),w.checkCollisions=R.checkCollisions,w.Da=!!R.Da,R.ellipsoid&&(w.ellipsoid=y.m.Sd(R.ellipsoid)),R.ellipsoidOffset&&(w.ellipsoidOffset=y.m.Sd(R.ellipsoidOffset)),null!=R.overrideMaterialSideOrientation&&(w.sideOrientation=R.overrideMaterialSideOrientation),void 0!==R.sideOrientation&&(w.sideOrientation=R.sideOrientation),void 0!==R.isBlocker&&(w.isBlocker=R.isBlocker),w._shouldGenerateFlatShading=R.useFlatShading,R.ci&&(w._waitingData.ci=R.ci),void 0!==R.parentId&&(w._waitingParentId=R.parentId),void 0!==R.parentInstanceIndex&&(w._waitingParentInstanceIndex=R.parentInstanceIndex),void 0!==R.actions&&(w._waitingData.actions=R.actions),void 0!==R.overlayAlpha&&(w.overlayAlpha=R.overlayAlpha),void 0!==R.overlayColor&&(w.overlayColor=a.c.Sd(R.overlayColor)),void 0!==R.renderOverlay&&(w.renderOverlay=R.renderOverlay),w.isUnIndexed=!!R.isUnIndexed,w.hasVertexAlpha=R.hasVertexAlpha,R.delayLoadingFile?(w.delayLoadState=4,w.delayLoadingFile=q+R.delayLoadingFile,w.buildBoundingInfo(y.m.Sd(R.boundingBoxMinimum),y.m.Sd(R.boundingBoxMaximum)),R._binaryInfo&&(w._binaryInfo=R._binaryInfo),w._delayInfo=[],R.hasUVs&&w._delayInfo.push(F.e.UVKind),R.hasUVs2&&w._delayInfo.push(F.e.UV2Kind),R.hasUVs3&&w._delayInfo.push(F.e.UV3Kind),R.hasUVs4&&w._delayInfo.push(F.e.UV4Kind),R.hasUVs5&&w._delayInfo.push(F.e.UV5Kind),R.hasUVs6&&w._delayInfo.push(F.e.UV6Kind),R.hasColors&&w._delayInfo.push(F.e.ColorKind),R.hasMatricesIndices&&w._delayInfo.push(F.e.MatricesIndicesKind),R.hasMatricesWeights&&w._delayInfo.push(F.e.MatricesWeightsKind),w._delayLoadingFunction=H.b._ImportGeometry,K.c.ForceFullSceneLoadingForIncremental&&w._checkDelayState()):H.b._ImportGeometry(R,w),R.materialUniqueId?w._waitingMaterialId=R.materialUniqueId:R.materialId&&(w._waitingMaterialId=R.materialId),R.morphTargetManagerId>-1&&(w._waitingMorphTargetManagerId=R.morphTargetManagerId),void 0!==R.skeletonId&&null!==R.skeletonId&&(w.skeleton=N.getLastSkeletonById(R.skeletonId),R.numBoneInfluencers&&(w.numBoneInfluencers=R.numBoneInfluencers)),R.animations){for(let N=0;N<R.animations.length;N++){const q=R.animations[N],u=(0,z.e)("BABYLON.Animation");u&&w.animations.push(u.Parse(q))}j.d.ParseAnimationRanges(w,R,N)}if(R.autoAnimate&&N.beginAnimation(w,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1),R.layerMask&&!isNaN(R.layerMask)?w.layerMask=Math.abs(parseInt(R.layerMask)):w.layerMask=268435455,R.physicsImpostor&&(w.physicsImpostor=o._PhysicsImpostorParser(N,w,R)),R.lodMeshIds&&(w._waitingData.lods={ids:R.lodMeshIds,distances:R.lodDistances?R.lodDistances:null,coverages:R.lodCoverages?R.lodCoverages:null}),R.instances)for(let u=0;u<R.instances.length;u++){const q=R.instances[u],M=w.pd(q.name);if(q.id&&(M.id=q.id),v.d&&(q.tags?v.d.AddTagsTo(M,q.tags):v.d.AddTagsTo(M,R.tags)),M.position=y.m.Sd(q.position),void 0!==q.metadata&&(M.metadata=q.metadata),void 0!==q.parentId&&(M._waitingParentId=q.parentId),void 0!==q.parentInstanceIndex&&(M._waitingParentInstanceIndex=q.parentInstanceIndex),void 0!==q.isEnabled&&null!==q.isEnabled&&M.Jg(q.isEnabled),void 0!==q.isVisible&&null!==q.isVisible&&(M.isVisible=q.isVisible),void 0!==q.Me&&null!==q.Me&&(M.Me=q.Me),q.rotationQuaternion?M.rotationQuaternion=y.e.Sd(q.rotationQuaternion):q.rotation&&(M.rotation=y.m.Sd(q.rotation)),M.Fe=y.m.Sd(q.Fe),void 0!=q.checkCollisions&&null!=q.checkCollisions&&(M.checkCollisions=q.checkCollisions),void 0!=q.pickable&&null!=q.pickable&&(M.Me=q.pickable),void 0!=q.showBoundingBox&&null!=q.showBoundingBox&&(M.showBoundingBox=q.showBoundingBox),void 0!=q.showSubMeshesBoundingBox&&null!=q.showSubMeshesBoundingBox&&(M.showSubMeshesBoundingBox=q.showSubMeshesBoundingBox),void 0!=q.alphaIndex&&null!=q.showSubMeshesBoundingBox&&(M.alphaIndex=q.alphaIndex),q.physicsImpostor&&(M.physicsImpostor=o._PhysicsImpostorParser(N,M,q)),void 0!==q.actions&&(M._waitingData.actions=q.actions),q.animations){for(let R=0;R<q.animations.length;R++){const N=q.animations[R],w=(0,z.e)("BABYLON.Animation");w&&M.animations.push(w.Parse(N))}j.d.ParseAnimationRanges(M,q,N),q.autoAnimate&&N.beginAnimation(M,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1)}}if(R.thinInstances){const N=R.thinInstances;if(w.thinInstanceEnablePicking=!!N.enablePicking,N.matrixData?(w.Qj("matrix",new Float32Array(N.matrixData),16,!1),w._thinInstanceDataStorage.matrixBufferSize=N.matrixBufferSize,w._thinInstanceDataStorage.instancesCount=N.instancesCount):w._thinInstanceDataStorage.matrixBufferSize=N.matrixBufferSize,R.thinInstances.userThinInstance){const N=R.thinInstances.userThinInstance;for(const R in N.data)w.Qj(R,new Float32Array(N.data[R]),N.strides[R],!1),w._userThinInstanceBuffersStorage.sizes[R]=N.sizes[R]}}return w}setPositionsForCPUSkinning(){const R=this._internalMeshDataInfo;if(!R._sourcePositions){const N=this.getVerticesData(F.e.PositionKind);if(!N)return R._sourcePositions;R._sourcePositions=new Float32Array(N),this.isVertexBufferUpdatable(F.e.PositionKind)||this.Ga(F.e.PositionKind,N,!0)}return R._sourcePositions}setNormalsForCPUSkinning(){const R=this._internalMeshDataInfo;if(!R._sourceNormals){const N=this.getVerticesData(F.e.NormalKind);if(!N)return R._sourceNormals;R._sourceNormals=new Float32Array(N),this.isVertexBufferUpdatable(F.e.NormalKind)||this.Ga(F.e.NormalKind,N,!0)}return R._sourceNormals}applySkeleton(R){if(!this.te)return this;if(this.te._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.te._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(F.e.PositionKind))return this;if(!this.isVerticesDataPresent(F.e.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(F.e.MatricesWeightsKind))return this;const N=this.isVerticesDataPresent(F.e.NormalKind),q=this._internalMeshDataInfo;if(!q._sourcePositions){const R=this.ae.slice();this.setPositionsForCPUSkinning(),this.ae=R}N&&!q._sourceNormals&&this.setNormalsForCPUSkinning();let w=this.getVerticesData(F.e.PositionKind);if(!w)return this;w instanceof Float32Array||(w=new Float32Array(w));let u=this.getVerticesData(F.e.NormalKind);if(N){if(!u)return this;u instanceof Float32Array||(u=new Float32Array(u))}const M=this.getVerticesData(F.e.MatricesIndicesKind),v=this.getVerticesData(F.e.MatricesWeightsKind);if(!v||!M)return this;const G=this.numBoneInfluencers>4,J=G?this.getVerticesData(F.e.MatricesIndicesExtraKind):null,a=G?this.getVerticesData(F.e.MatricesWeightsExtraKind):null,j=R.getTransformMatrices(this),S=y.m.Zero(),H=new y.c,W=new y.c;let k,C=0;for(let F=0;F<w.length;F+=3,C+=4){let R;for(k=0;k<4;k++)R=v[C+k],R>0&&(y.c.FromFloat32ArrayToRefScaled(j,Math.floor(16*M[C+k]),R,W),H.addToSelf(W));if(G)for(k=0;k<4;k++)R=a[C+k],R>0&&(y.c.FromFloat32ArrayToRefScaled(j,Math.floor(16*J[C+k]),R,W),H.addToSelf(W));y.m.TransformCoordinatesFromFloatsToRef(q._sourcePositions[F],q._sourcePositions[F+1],q._sourcePositions[F+2],H,S),S.toArray(w,F),N&&(y.m.TransformNormalFromFloatsToRef(q._sourceNormals[F],q._sourceNormals[F+1],q._sourceNormals[F+2],H,S),S.toArray(u,F)),H.reset()}return this.updateVerticesData(F.e.PositionKind,w),N&&this.updateVerticesData(F.e.NormalKind,u),this}static MinMax(R){let N=null,q=null;return R.forEach((function(R){const w=R.getBoundingInfo().boundingBox;N&&q?(N.minimizeInPlace(w.minimumWorld),q.maximizeInPlace(w.maximumWorld)):(N=w.minimumWorld,q=w.maximumWorld)})),N&&q?{min:N,max:q}:{min:y.m.Zero(),max:y.m.Zero()}}static Center(R){const N=R instanceof Array?o.MinMax(R):R;return y.m.Center(N.min,N.max)}static MergeMeshes(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],q=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,M=arguments.length>5?arguments[5]:void 0;return(0,G.p)(o._MergeMeshesCoroutine(R,N,q,w,u,M,!1))}static MergeMeshesAsync(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],q=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,M=arguments.length>5?arguments[5]:void 0;return(0,G.m)(o._MergeMeshesCoroutine(R,N,q,w,u,M,!0),(0,G.e)())}static*_MergeMeshesCoroutine(R){let N,q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],w=arguments.length>2?arguments[2]:void 0,u=arguments.length>3?arguments[3]:void 0,M=arguments.length>4?arguments[4]:void 0,v=arguments.length>5?arguments[5]:void 0,G=arguments.length>6?arguments[6]:void 0;if(0===(R=R.filter(Boolean)).length)return null;if(!w){let q=0;for(N=0;N<R.length;N++)if(q+=R[N].getTotalVertices(),q>=65536)return Z.e.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}v&&(M=!1);const J=new Array,y=new Array,a=new Array,j=R[0].sideOrientation;for(N=0;N<R.length;N++){const q=R[N];if(q.isAnInstance)return Z.e.Warn("Cannot merge instance meshes."),null;if(j!==q.sideOrientation)return Z.e.Warn("Cannot merge meshes with different sideOrientation values."),null;if(M&&a.push(q.getTotalIndices()),v)if(q.material){const R=q.material;if(R instanceof e.d){for(let N=0;N<R.Hg.length;N++)J.indexOf(R.Hg[N])<0&&J.push(R.Hg[N]);for(let N=0;N<q.ae.length;N++)y.push(J.indexOf(R.Hg[q.ae[N].materialIndex])),a.push(q.ae[N].indexCount)}else{J.indexOf(R)<0&&J.push(R);for(let N=0;N<q.ae.length;N++)y.push(J.indexOf(R)),a.push(q.ae[N].indexCount)}}else for(let R=0;R<q.ae.length;R++)y.push(0),a.push(q.ae[R].indexCount)}const F=R[0],H=R=>{const N=R.je(!0);return{vertexData:S.d.ExtractFromMesh(R,!1,!1),transform:N}},{vertexData:W,transform:C}=H(F);G&&(yield);const K=new Array(R.length-1);for(let S=1;S<R.length;S++)K[S-1]=H(R[S]),G&&(yield);const r=W._mergeCoroutine(C,K,w,G,!q);let z=r.next();for(;!z.done;)G&&(yield),z=r.next();const d=z.value;u||(u=new o(F.name+"_merged",F.va()));const x=d._applyToCoroutine(u,void 0,G);let E=x.next();for(;!E.done;)G&&(yield),E=x.next();if(u.checkCollisions=F.checkCollisions,u.sideOrientation=F.sideOrientation,q)for(N=0;N<R.length;N++)R[N].dispose();if(M||v){u.releaseSubMeshes(),N=0;let R=0;for(;N<a.length;)k.e.CreateFromIndices(0,R,a[N],u,void 0,!1),R+=a[N],N++;for(const N of u.ae)N.refreshBoundingInfo();u.je(!0)}if(v){const R=new e.d(F.name+"_merged",F.va());R.Hg=J;for(let N=0;N<u.ae.length;N++)u.ae[N].materialIndex=y[N];u.material=R}else u.material=F.material;return u}Gj(R){R._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(R)}Fj(R){const N=R._indexInSourceMeshInstanceArray;if(-1!=N){if(N!==this.instances.length-1){const R=this.instances[this.instances.length-1];this.instances[N]=R,R._indexInSourceMeshInstanceArray=N}R._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===C.e.CounterClockWiseSideOrientation}_getRenderingFillMode(R){const N=this.va();return N.forcePointsCloud?C.e.PointFillMode:N.forceWireframe?C.e.WireFrameFillMode:this.overrideRenderingFillMode??R}setMaterialByID(R){return this.setMaterialById(R)}static CreateRibbon(R,N,q,w,u,M,v,G,J){throw new Error("Import MeshBuilder to populate this function")}static kb(R,N,q,w,u,M){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(R,N,q,w,u){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(R,N,q,w,u,M){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(R,N,q,w){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(R,N,q,w,u,M,v,G,J){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(R,N,q,w,u,M,v){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(R,N,q,w,u,M,v,G,J,y){throw new Error("Import MeshBuilder to populate this function")}static lb(R,N,q,w,u){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(R,N,q,w,u,M,v,G){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(R,N,q,w,u,M,v){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(R,N,q,w,u,M,v,G){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(R,N,q,w,u,M,v,G,J,y){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(R,N,q,w,u,M,v,G,J,y,a,j){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(R,N,q,w,u,M,v){throw new Error("Import MeshBuilder to populate this function")}static Kg(R,N,q,w,u){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(R,N,q,w,u,M){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(R,N,q,w,u,M,v,G,J){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(R,N,q,w,u,M,v,G,J,y,a){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(R,N,q,w,u,M,v,G,J,y){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(R,N,q){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(R,N,q){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(R,N,q,w,u,M){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(R,N,q){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(R){throw new Error("Import MeshBuilder to populate this function")}}o.FRONTSIDE=S.d.FRONTSIDE,o.BACKSIDE=S.d.BACKSIDE,o.DOUBLESIDE=S.d.DOUBLESIDE,o.DEFAULTSIDE=S.d.DEFAULTSIDE,o.NO_CAP=0,o.CAP_START=1,o.CAP_END=2,o.CAP_ALL=3,o.NO_FLIP=0,o.FLIP_TILE=1,o.ROTATE_TILE=2,o.FLIP_ROW=3,o.ROTATE_ROW=4,o.FLIP_N_ROTATE_TILE=5,o.FLIP_N_ROTATE_ROW=6,o.CENTER=0,o.LEFT=1,o.RIGHT=2,o.TOP=3,o.BOTTOM=4,o.INSTANCEDMESH_SORT_TRANSPARENT=!1,o._GroundMeshParser=(R,N)=>{throw(0,d.c)("GroundMesh")},o._GoldbergMeshParser=(R,N)=>{throw(0,d.c)("GoldbergMesh")},o._LinesMeshParser=(R,N)=>{throw(0,d.c)("LinesMesh")},o._GreasedLineMeshParser=(R,N)=>{throw(0,d.c)("GreasedLineMesh")},o._GreasedLineRibbonMeshParser=(R,N)=>{throw(0,d.c)("GreasedLineRibbonMesh")},o._TrailMeshParser=(R,N)=>{throw(0,d.c)("TrailMesh")},(0,z.h)("BABYLON.Mesh",o)},11403:(R,N,q)=>{"use strict";q.d(N,{d:()=>H});var w=q(942),u=q(966),M=q(1227),v=q(1044),G=q(1133),J=q(1056),y=q(947),a=q(11388),j=q(1026),F=q(1312);class S{}class H{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,a.i)(this._applyToCoroutine.bind(this)),this.uniqueId=H._UniqueIDGenerator,H._UniqueIDGenerator++}set(R,N){switch(R.length||J.e.Warn(`Setting vertex data kind '${N}' with an empty array`),N){case M.e.PositionKind:this.xa=R;break;case M.e.NormalKind:this.ya=R;break;case M.e.TangentKind:this.tangents=R;break;case M.e.UVKind:this.Aa=R;break;case M.e.UV2Kind:this.uvs2=R;break;case M.e.UV3Kind:this.uvs3=R;break;case M.e.UV4Kind:this.uvs4=R;break;case M.e.UV5Kind:this.uvs5=R;break;case M.e.UV6Kind:this.uvs6=R;break;case M.e.ColorKind:this.za=R;break;case M.e.MatricesIndicesKind:this.matricesIndices=R;break;case M.e.MatricesWeightsKind:this.matricesWeights=R;break;case M.e.MatricesIndicesExtraKind:this.matricesIndicesExtra=R;break;case M.e.MatricesWeightsExtraKind:this.matricesWeightsExtra=R}}Ca(R,N){return this._applyTo(R,N,!1),this}applyToGeometry(R,N){return this._applyTo(R,N,!1),this}updateMesh(R){return this._update(R),this}updateGeometry(R){return this._update(R),this}*_applyToCoroutine(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2?arguments[2]:void 0;if(this.xa&&(R.Ga(M.e.PositionKind,this.xa,N),q&&(yield)),this.ya&&(R.Ga(M.e.NormalKind,this.ya,N),q&&(yield)),this.tangents&&(R.Ga(M.e.TangentKind,this.tangents,N),q&&(yield)),this.Aa&&(R.Ga(M.e.UVKind,this.Aa,N),q&&(yield)),this.uvs2&&(R.Ga(M.e.UV2Kind,this.uvs2,N),q&&(yield)),this.uvs3&&(R.Ga(M.e.UV3Kind,this.uvs3,N),q&&(yield)),this.uvs4&&(R.Ga(M.e.UV4Kind,this.uvs4,N),q&&(yield)),this.uvs5&&(R.Ga(M.e.UV5Kind,this.uvs5,N),q&&(yield)),this.uvs6&&(R.Ga(M.e.UV6Kind,this.uvs6,N),q&&(yield)),this.za&&(R.Ga(M.e.ColorKind,this.za,N),this.hasVertexAlpha&&void 0!==R.hasVertexAlpha&&(R.hasVertexAlpha=!0),q&&(yield)),this.matricesIndices&&(R.Ga(M.e.MatricesIndicesKind,this.matricesIndices,N),q&&(yield)),this.matricesWeights&&(R.Ga(M.e.MatricesWeightsKind,this.matricesWeights,N),q&&(yield)),this.matricesIndicesExtra&&(R.Ga(M.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,N),q&&(yield)),this.matricesWeightsExtra&&(R.Ga(M.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,N),q&&(yield)),this.indices?(R.setIndices(this.indices,null,N),q&&(yield)):R.setIndices([],null),R.ae&&this.materialInfos&&this.materialInfos.length>1){const N=R;N.ae=[];for(const R of this.materialInfos)new F.e(R.materialIndex,R.verticesStart,R.verticesCount,R.indexStart,R.indexCount,N)}return this}_update(R,N,q){return this.xa&&R.updateVerticesData(M.e.PositionKind,this.xa,N,q),this.ya&&R.updateVerticesData(M.e.NormalKind,this.ya,N,q),this.tangents&&R.updateVerticesData(M.e.TangentKind,this.tangents,N,q),this.Aa&&R.updateVerticesData(M.e.UVKind,this.Aa,N,q),this.uvs2&&R.updateVerticesData(M.e.UV2Kind,this.uvs2,N,q),this.uvs3&&R.updateVerticesData(M.e.UV3Kind,this.uvs3,N,q),this.uvs4&&R.updateVerticesData(M.e.UV4Kind,this.uvs4,N,q),this.uvs5&&R.updateVerticesData(M.e.UV5Kind,this.uvs5,N,q),this.uvs6&&R.updateVerticesData(M.e.UV6Kind,this.uvs6,N,q),this.za&&R.updateVerticesData(M.e.ColorKind,this.za,N,q),this.matricesIndices&&R.updateVerticesData(M.e.MatricesIndicesKind,this.matricesIndices,N,q),this.matricesWeights&&R.updateVerticesData(M.e.MatricesWeightsKind,this.matricesWeights,N,q),this.matricesIndicesExtra&&R.updateVerticesData(M.e.MatricesIndicesExtraKind,this.matricesIndicesExtra,N,q),this.matricesWeightsExtra&&R.updateVerticesData(M.e.MatricesWeightsExtraKind,this.matricesWeightsExtra,N,q),this.indices&&R.setIndices(this.indices,null),this}static _TransformVector3Coordinates(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R.length;const M=u.f.Od[0],v=u.f.Od[1];for(let G=q;G<q+w;G+=3)u.m.FromArrayToRef(R,G,M),u.m.TransformCoordinatesToRef(M,N,v),R[G]=v.x,R[G+1]=v.y,R[G+2]=v.z}static _TransformVector3Normals(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R.length;const M=u.f.Od[0],v=u.f.Od[1];for(let G=q;G<q+w;G+=3)u.m.FromArrayToRef(R,G,M),u.m.TransformNormalToRef(M,N,v),R[G]=v.x,R[G+1]=v.y,R[G+2]=v.z}static _TransformVector4Normals(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R.length;const M=u.f.Vector4[0],v=u.f.Vector4[1];for(let G=q;G<q+w;G+=4)u.n.FromArrayToRef(R,G,M),u.n.TransformNormalToRef(M,N,v),R[G]=v.x,R[G+1]=v.y,R[G+2]=v.z,R[G+3]=v.w}static _FlipFaces(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.length;for(let w=N;w<N+q;w+=3){const N=R[w+1];R[w+1]=R[w+2],R[w+2]=N}}transform(R){const N=R.determinant()<0;return this.xa&&H._TransformVector3Coordinates(this.xa,R),this.ya&&H._TransformVector3Normals(this.ya,R),this.tangents&&H._TransformVector4Normals(this.tangents,R),N&&this.indices&&H._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const R=[];for(const N of this.materialInfos){const q=new H;if(this.xa&&(q.xa=this.xa.slice(3*N.verticesStart,3*(N.verticesCount+N.verticesStart))),this.ya&&(q.ya=this.ya.slice(3*N.verticesStart,3*(N.verticesCount+N.verticesStart))),this.tangents&&(q.tangents=this.tangents.slice(4*N.verticesStart,4*(N.verticesCount+N.verticesStart))),this.za&&(q.za=this.za.slice(4*N.verticesStart,4*(N.verticesCount+N.verticesStart))),this.Aa&&(q.Aa=this.Aa.slice(2*N.verticesStart,2*(N.verticesCount+N.verticesStart))),this.uvs2&&(q.uvs2=this.uvs2.slice(2*N.verticesStart,2*(N.verticesCount+N.verticesStart))),this.uvs3&&(q.uvs3=this.uvs3.slice(2*N.verticesStart,2*(N.verticesCount+N.verticesStart))),this.uvs4&&(q.uvs4=this.uvs4.slice(2*N.verticesStart,2*(N.verticesCount+N.verticesStart))),this.uvs5&&(q.uvs5=this.uvs5.slice(2*N.verticesStart,2*(N.verticesCount+N.verticesStart))),this.uvs6&&(q.uvs6=this.uvs6.slice(2*N.verticesStart,2*(N.verticesCount+N.verticesStart))),this.matricesIndices&&(q.matricesIndices=this.matricesIndices.slice(4*N.verticesStart,4*(N.verticesCount+N.verticesStart))),this.matricesIndicesExtra&&(q.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*N.verticesStart,4*(N.verticesCount+N.verticesStart))),this.matricesWeights&&(q.matricesWeights=this.matricesWeights.slice(4*N.verticesStart,4*(N.verticesCount+N.verticesStart))),this.matricesWeightsExtra&&(q.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*N.verticesStart,4*(N.verticesCount+N.verticesStart))),this.indices){q.indices=[];for(let R=N.indexStart;R<N.indexStart+N.indexCount;R++)q.indices.push(this.indices[R]-N.verticesStart)}const w=new S;w.indexStart=0,w.indexCount=q.indices?q.indices.length:0,w.materialIndex=N.materialIndex,w.verticesStart=0,w.verticesCount=(q.xa?q.xa.length:0)/3,q.materialInfos=[w],R.push(q)}return R}merge(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const M=Array.isArray(R)?R.map((R=>({vertexData:R}))):[{vertexData:R}];return(0,a.p)(this._mergeCoroutine(void 0,M,N,!1,q,w,u))}*_mergeCoroutine(R,N){var q,w;let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3?arguments[3]:void 0,G=arguments.length>4?arguments[4]:void 0,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let a=N.map((R=>R.vertexData)),j=this;if(y)for(const M of a)M&&(M._validate(),!this.ya&&M.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&M.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&M.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&M.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&M.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&M.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&M.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&M.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&M.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&M.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&M.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&M.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&M.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const M of a)if(M)if(y)this.ya&&!M.ya&&(M.ya=new Float32Array(M.xa.length)),this.tangents&&!M.tangents&&(M.tangents=new Float32Array(M.xa.length/3*4)),this.Aa&&!M.Aa&&(M.Aa=new Float32Array(M.xa.length/3*2)),this.uvs2&&!M.uvs2&&(M.uvs2=new Float32Array(M.xa.length/3*2)),this.uvs3&&!M.uvs3&&(M.uvs3=new Float32Array(M.xa.length/3*2)),this.uvs4&&!M.uvs4&&(M.uvs4=new Float32Array(M.xa.length/3*2)),this.uvs5&&!M.uvs5&&(M.uvs5=new Float32Array(M.xa.length/3*2)),this.uvs6&&!M.uvs6&&(M.uvs6=new Float32Array(M.xa.length/3*2)),this.za&&!M.za&&(M.za=new Float32Array(M.xa.length/3*4),M.za.fill(1)),this.matricesIndices&&!M.matricesIndices&&(M.matricesIndices=new Float32Array(M.xa.length/3*4)),this.matricesWeights&&!M.matricesWeights&&(M.matricesWeights=new Float32Array(M.xa.length/3*4)),this.matricesIndicesExtra&&!M.matricesIndicesExtra&&(M.matricesIndicesExtra=new Float32Array(M.xa.length/3*4)),this.matricesWeightsExtra&&!M.matricesWeightsExtra&&(M.matricesWeightsExtra=new Float32Array(M.xa.length/3*4));else if(M._validate(),!this.ya!==!M.ya||!this.tangents!==!M.tangents||!this.Aa!==!M.Aa||!this.uvs2!==!M.uvs2||!this.uvs3!==!M.uvs3||!this.uvs4!==!M.uvs4||!this.uvs5!==!M.uvs5||!this.uvs6!==!M.uvs6||!this.za!==!M.za||!this.matricesIndices!==!M.matricesIndices||!this.matricesWeights!==!M.matricesWeights||!this.matricesIndicesExtra!==!M.matricesIndicesExtra||!this.matricesWeightsExtra!==!M.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(J){let q=0,w=0,u=0;const M=[];let v=null;const G=[];for(const N of this.splitBasedOnMaterialID())G.push({vertexData:N,transform:R});for(const R of N)if(R.vertexData)for(const N of R.vertexData.splitBasedOnMaterialID())G.push({vertexData:N,transform:R.transform});G.sort(((R,N)=>{const q=R.vertexData.materialInfos?R.vertexData.materialInfos[0].materialIndex:0,w=N.vertexData.materialInfos?N.vertexData.materialInfos[0].materialIndex:0;return q>w?1:q===w?0:-1}));for(const R of G){const N=R.vertexData;if(q=N.materialInfos?N.materialInfos[0].materialIndex:0,v&&v.materialIndex===q)v.indexCount+=N.indices.length,v.verticesCount+=N.xa.length/3;else{const R=new S;R.materialIndex=q,R.indexStart=w,R.indexCount=N.indices.length,R.verticesStart=u,R.verticesCount=N.xa.length/3,M.push(R),v=R}w+=N.indices.length,u+=N.xa.length/3}const J=G.splice(0,1)[0];j=J.vertexData,R=J.transform,a=G.map((R=>R.vertexData)),N=G,this.materialInfos=M}const F=a.reduce(((R,N)=>{var q;return R+((null===(q=N.indices)||void 0===q?void 0:q.length)??0)}),(null===(q=j.indices)||void 0===q?void 0:q.length)??0);let W=G||a.some((R=>R.indices===j.indices))?null===(w=j.indices)||void 0===w?void 0:w.slice():j.indices;if(F>0){var k;let q=(null===(k=W)||void 0===k?void 0:k.length)??0;if(W||(W=new Array(F)),W.length!==F){if(Array.isArray(W))W.length=F;else{const R=u||W instanceof Uint32Array?new Uint32Array(F):new Uint16Array(F);R.set(W),W=R}R&&R.determinant()<0&&H._FlipFaces(W,0,q)}let w=j.xa?j.xa.length/3:0;for(const{vertexData:R,transform:u}of N)if(R.indices){for(let N=0;N<R.indices.length;N++)W[q+N]=R.indices[N]+w;u&&u.determinant()<0&&H._FlipFaces(W,q,R.indices.length),w+=R.xa.length/3,q+=R.indices.length,v&&(yield)}}return this.indices=W,this.xa=H._MergeElement(M.e.PositionKind,j.xa,R,N.map((R=>[R.vertexData.xa,R.transform]))),v&&(yield),j.ya&&(this.ya=H._MergeElement(M.e.NormalKind,j.ya,R,N.map((R=>[R.vertexData.ya,R.transform]))),v&&(yield)),j.tangents&&(this.tangents=H._MergeElement(M.e.TangentKind,j.tangents,R,N.map((R=>[R.vertexData.tangents,R.transform]))),v&&(yield)),j.Aa&&(this.Aa=H._MergeElement(M.e.UVKind,j.Aa,R,N.map((R=>[R.vertexData.Aa,R.transform]))),v&&(yield)),j.uvs2&&(this.uvs2=H._MergeElement(M.e.UV2Kind,j.uvs2,R,N.map((R=>[R.vertexData.uvs2,R.transform]))),v&&(yield)),j.uvs3&&(this.uvs3=H._MergeElement(M.e.UV3Kind,j.uvs3,R,N.map((R=>[R.vertexData.uvs3,R.transform]))),v&&(yield)),j.uvs4&&(this.uvs4=H._MergeElement(M.e.UV4Kind,j.uvs4,R,N.map((R=>[R.vertexData.uvs4,R.transform]))),v&&(yield)),j.uvs5&&(this.uvs5=H._MergeElement(M.e.UV5Kind,j.uvs5,R,N.map((R=>[R.vertexData.uvs5,R.transform]))),v&&(yield)),j.uvs6&&(this.uvs6=H._MergeElement(M.e.UV6Kind,j.uvs6,R,N.map((R=>[R.vertexData.uvs6,R.transform]))),v&&(yield)),j.za&&(this.za=H._MergeElement(M.e.ColorKind,j.za,R,N.map((R=>[R.vertexData.za,R.transform]))),(void 0!==j.hasVertexAlpha||N.some((R=>void 0!==R.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=j.hasVertexAlpha||N.some((R=>R.vertexData.hasVertexAlpha))),v&&(yield)),j.matricesIndices&&(this.matricesIndices=H._MergeElement(M.e.MatricesIndicesKind,j.matricesIndices,R,N.map((R=>[R.vertexData.matricesIndices,R.transform]))),v&&(yield)),j.matricesWeights&&(this.matricesWeights=H._MergeElement(M.e.MatricesWeightsKind,j.matricesWeights,R,N.map((R=>[R.vertexData.matricesWeights,R.transform]))),v&&(yield)),j.matricesIndicesExtra&&(this.matricesIndicesExtra=H._MergeElement(M.e.MatricesIndicesExtraKind,j.matricesIndicesExtra,R,N.map((R=>[R.vertexData.matricesIndicesExtra,R.transform]))),v&&(yield)),j.matricesWeightsExtra&&(this.matricesWeightsExtra=H._MergeElement(M.e.MatricesWeightsExtraKind,j.matricesWeightsExtra,R,N.map((R=>[R.vertexData.matricesWeightsExtra,R.transform])))),this}static _MergeElement(R,N,q,w){const u=w.filter((R=>null!==R[0]&&void 0!==R[0]));if(!N&&0==u.length)return N;if(!N)return this._MergeElement(R,u[0][0],u[0][1],u.slice(1));const v=u.reduce(((R,N)=>R+N[0].length),N.length),G=R===M.e.PositionKind?H._TransformVector3Coordinates:R===M.e.NormalKind?H._TransformVector3Normals:R===M.e.TangentKind?H._TransformVector4Normals:()=>{};if(N instanceof Float32Array){const R=new Float32Array(v);R.set(N),q&&G(R,q,0,N.length);let w=N.length;for(const[N,q]of u)R.set(N,w),q&&G(R,q,w,N.length),w+=N.length;return R}{const R=new Array(v);for(let q=0;q<N.length;q++)R[q]=N[q];q&&G(R,q,0,N.length);let w=N.length;for(const[N,q]of u){for(let q=0;q<N.length;q++)R[w+q]=N[q];q&&G(R,q,w,N.length),w+=N.length}return R}}_validate(){if(!this.xa)throw new j.h("Positions are required",j.d.MeshInvalidPositionsError);const R=(R,N)=>{const q=M.e.DeduceStride(R);if(N.length%q!==0)throw new Error("The "+R+"s array count must be a multiple of "+q);return N.length/q},N=R(M.e.PositionKind,this.xa),q=(q,w)=>{const u=R(q,w);if(u!==N)throw new Error("The "+q+"s element count ("+u+") does not match the positions count ("+N+")")};this.ya&&q(M.e.NormalKind,this.ya),this.tangents&&q(M.e.TangentKind,this.tangents),this.Aa&&q(M.e.UVKind,this.Aa),this.uvs2&&q(M.e.UV2Kind,this.uvs2),this.uvs3&&q(M.e.UV3Kind,this.uvs3),this.uvs4&&q(M.e.UV4Kind,this.uvs4),this.uvs5&&q(M.e.UV5Kind,this.uvs5),this.uvs6&&q(M.e.UV6Kind,this.uvs6),this.za&&q(M.e.ColorKind,this.za),this.matricesIndices&&q(M.e.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&q(M.e.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&q(M.e.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&q(M.e.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const R=this.serialize();return H.Parse(R)}serialize(){const R={};if(this.xa&&(R.xa=Array.from(this.xa)),this.ya&&(R.ya=Array.from(this.ya)),this.tangents&&(R.tangents=Array.from(this.tangents)),this.Aa&&(R.Aa=Array.from(this.Aa)),this.uvs2&&(R.uvs2=Array.from(this.uvs2)),this.uvs3&&(R.uvs3=Array.from(this.uvs3)),this.uvs4&&(R.uvs4=Array.from(this.uvs4)),this.uvs5&&(R.uvs5=Array.from(this.uvs5)),this.uvs6&&(R.uvs6=Array.from(this.uvs6)),this.za&&(R.za=Array.from(this.za),R.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(R.matricesIndices=Array.from(this.matricesIndices),R.matricesIndices._isExpanded=!0),this.matricesWeights&&(R.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(R.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),R.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(R.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),R.indices=Array.from(this.indices),this.materialInfos){R.materialInfos=[];for(const N of this.materialInfos){const q={indexStart:N.indexStart,indexCount:N.indexCount,materialIndex:N.materialIndex,verticesStart:N.verticesStart,verticesCount:N.verticesCount};R.materialInfos.push(q)}}return R}static ExtractFromMesh(R,N,q){return H._ExtractFrom(R,N,q)}static ExtractFromGeometry(R,N,q){return H._ExtractFrom(R,N,q)}static _ExtractFrom(R,N,q){const w=new H;if(R.isVerticesDataPresent(M.e.PositionKind)&&(w.xa=R.getVerticesData(M.e.PositionKind,N,q)),R.isVerticesDataPresent(M.e.NormalKind)&&(w.ya=R.getVerticesData(M.e.NormalKind,N,q)),R.isVerticesDataPresent(M.e.TangentKind)&&(w.tangents=R.getVerticesData(M.e.TangentKind,N,q)),R.isVerticesDataPresent(M.e.UVKind)&&(w.Aa=R.getVerticesData(M.e.UVKind,N,q)),R.isVerticesDataPresent(M.e.UV2Kind)&&(w.uvs2=R.getVerticesData(M.e.UV2Kind,N,q)),R.isVerticesDataPresent(M.e.UV3Kind)&&(w.uvs3=R.getVerticesData(M.e.UV3Kind,N,q)),R.isVerticesDataPresent(M.e.UV4Kind)&&(w.uvs4=R.getVerticesData(M.e.UV4Kind,N,q)),R.isVerticesDataPresent(M.e.UV5Kind)&&(w.uvs5=R.getVerticesData(M.e.UV5Kind,N,q)),R.isVerticesDataPresent(M.e.UV6Kind)&&(w.uvs6=R.getVerticesData(M.e.UV6Kind,N,q)),R.isVerticesDataPresent(M.e.ColorKind)){const u=R.te||R,v=u.getVertexBuffer(M.e.ColorKind),G=u.getVerticesData(M.e.ColorKind,N,q);if(3===v.getSize()){const R=new Float32Array(4*G.length/3);for(let N=0,q=0;N<G.length;N+=3,q+=4)R[q]=G[N],R[q+1]=G[N+1],R[q+2]=G[N+2],R[q+3]=1;w.za=R}else{if(4!==v.getSize())throw new Error(`Unexpected number of color components: ${v.getSize()}`);w.za=G}}return R.isVerticesDataPresent(M.e.MatricesIndicesKind)&&(w.matricesIndices=R.getVerticesData(M.e.MatricesIndicesKind,N,q)),R.isVerticesDataPresent(M.e.MatricesWeightsKind)&&(w.matricesWeights=R.getVerticesData(M.e.MatricesWeightsKind,N,q)),R.isVerticesDataPresent(M.e.MatricesIndicesExtraKind)&&(w.matricesIndicesExtra=R.getVerticesData(M.e.MatricesIndicesExtraKind,N,q)),R.isVerticesDataPresent(M.e.MatricesWeightsExtraKind)&&(w.matricesWeightsExtra=R.getVerticesData(M.e.MatricesWeightsExtraKind,N,q)),w.indices=R.Md(N,q),w}static CreateRibbon(R){throw(0,v.c)("ribbonBuilder")}static CreateBox(R){throw(0,v.c)("boxBuilder")}static CreateTiledBox(R){throw(0,v.c)("tiledBoxBuilder")}static CreateTiledPlane(R){throw(0,v.c)("tiledPlaneBuilder")}static CreateSphere(R){throw(0,v.c)("sphereBuilder")}static CreateCylinder(R){throw(0,v.c)("cylinderBuilder")}static CreateTorus(R){throw(0,v.c)("torusBuilder")}static CreateLineSystem(R){throw(0,v.c)("linesBuilder")}static CreateDashedLines(R){throw(0,v.c)("linesBuilder")}static CreateGround(R){throw(0,v.c)("groundBuilder")}static CreateTiledGround(R){throw(0,v.c)("groundBuilder")}static CreateGroundFromHeightMap(R){throw(0,v.c)("groundBuilder")}static Kg(R){throw(0,v.c)("planeBuilder")}static kb(R){throw(0,v.c)("discBuilder")}static CreatePolygon(R,N,q,w,u,M,G){throw(0,v.c)("polygonBuilder")}static CreateIcoSphere(R){throw(0,v.c)("icoSphereBuilder")}static CreatePolyhedron(R){throw(0,v.c)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||u.m.Up();throw(0,v.c)("capsuleBuilder")}static CreateTorusKnot(R){throw(0,v.c)("torusKnotBuilder")}static ComputeNormals(R,N,q,w){let M=0,v=0,G=0,J=0,y=0,a=0,j=0,F=0,S=0,H=0,W=0,k=0,C=0,e=0,K=0,r=0,Z=0,z=0,d=0,x=0,E=!1,P=!1,s=!1,O=!1,L=1,m=0,o=null;w&&(E=!!w.facetNormals,P=!!w.facetPositions,s=!!w.facetPartitioning,L=!0===w.useRightHandedSystem?-1:1,m=w.ratio||0,O=!!w.depthSort,o=w.distanceTo,O&&void 0===o&&(o=u.m.Zero()));let A=0,n=0,Q=0,Y=0;for(s&&w&&w.bbSize&&(A=w.subDiv.X*m/w.bbSize.x,n=w.subDiv.Y*m/w.bbSize.y,Q=w.subDiv.Z*m/w.bbSize.z,Y=w.subDiv.max*w.subDiv.max,w.facetPartitioning.length=0),M=0;M<R.length;M++)q[M]=0;const T=N.length/3|0;for(M=0;M<T;M++){if(k=3*N[3*M],C=k+1,e=k+2,K=3*N[3*M+1],r=K+1,Z=K+2,z=3*N[3*M+2],d=z+1,x=z+2,v=R[k]-R[K],G=R[C]-R[r],J=R[e]-R[Z],y=R[z]-R[K],a=R[d]-R[r],j=R[x]-R[Z],F=L*(G*j-J*a),S=L*(J*y-v*j),H=L*(v*a-G*y),W=Math.sqrt(F*F+S*S+H*H),W=0===W?1:W,F/=W,S/=W,H/=W,E&&w&&(w.facetNormals[M].x=F,w.facetNormals[M].y=S,w.facetNormals[M].z=H),P&&w&&(w.facetPositions[M].x=(R[k]+R[K]+R[z])/3,w.facetPositions[M].y=(R[C]+R[r]+R[d])/3,w.facetPositions[M].z=(R[e]+R[Z]+R[x])/3),s&&w){const N=Math.floor((w.facetPositions[M].x-w.bInfo.minimum.x*m)*A),q=Math.floor((w.facetPositions[M].y-w.bInfo.minimum.y*m)*n),u=Math.floor((w.facetPositions[M].z-w.bInfo.minimum.z*m)*Q),v=Math.floor((R[k]-w.bInfo.minimum.x*m)*A),G=Math.floor((R[C]-w.bInfo.minimum.y*m)*n),J=Math.floor((R[e]-w.bInfo.minimum.z*m)*Q),y=Math.floor((R[K]-w.bInfo.minimum.x*m)*A),a=Math.floor((R[r]-w.bInfo.minimum.y*m)*n),j=Math.floor((R[Z]-w.bInfo.minimum.z*m)*Q),F=Math.floor((R[z]-w.bInfo.minimum.x*m)*A),S=Math.floor((R[d]-w.bInfo.minimum.y*m)*n),H=Math.floor((R[x]-w.bInfo.minimum.z*m)*Q),W=v+w.subDiv.max*G+Y*J,E=y+w.subDiv.max*a+Y*j,P=F+w.subDiv.max*S+Y*H,s=N+w.subDiv.max*q+Y*u;w.facetPartitioning[s]=w.facetPartitioning[s]?w.facetPartitioning[s]:new Array,w.facetPartitioning[W]=w.facetPartitioning[W]?w.facetPartitioning[W]:new Array,w.facetPartitioning[E]=w.facetPartitioning[E]?w.facetPartitioning[E]:new Array,w.facetPartitioning[P]=w.facetPartitioning[P]?w.facetPartitioning[P]:new Array,w.facetPartitioning[W].push(M),E!=W&&w.facetPartitioning[E].push(M),P!=E&&P!=W&&w.facetPartitioning[P].push(M),s!=W&&s!=E&&s!=P&&w.facetPartitioning[s].push(M)}if(O&&w&&w.facetPositions){const R=w.depthSortedFacets[M];R.ind=3*M,R.sqDistance=u.m.DistanceSquared(w.facetPositions[M],o)}q[k]+=F,q[C]+=S,q[e]+=H,q[K]+=F,q[r]+=S,q[Z]+=H,q[z]+=F,q[d]+=S,q[x]+=H}for(M=0;M<q.length/3;M++)F=q[3*M],S=q[3*M+1],H=q[3*M+2],W=Math.sqrt(F*F+S*S+H*H),W=0===W?1:W,F/=W,S/=W,H/=W,q[3*M]=F,q[3*M+1]=S,q[3*M+2]=H}static _ComputeSides(R,N,q,w,M,v,G){const J=q.length,y=w.length;let a,j;switch(R=R||H.DEFAULTSIDE){case H.FRONTSIDE:break;case H.BACKSIDE:for(a=0;a<J;a+=3){const R=q[a];q[a]=q[a+2],q[a+2]=R}for(j=0;j<y;j++)w[j]=-w[j];break;case H.DOUBLESIDE:{const R=N.length,F=R/3;for(let q=0;q<R;q++)N[R+q]=N[q];for(a=0;a<J;a+=3)q[a+J]=q[a+2]+F,q[a+1+J]=q[a+1]+F,q[a+2+J]=q[a]+F;for(j=0;j<y;j++)w[y+j]=-w[j];const S=M.length;let H=0;for(H=0;H<S;H++)M[H+S]=M[H];for(v=v||new u.n(0,0,1,1),G=G||new u.n(0,0,1,1),H=0,a=0;a<S/2;a++)M[H]=v.x+(v.z-v.x)*M[H],M[H+1]=v.y+(v.w-v.y)*M[H+1],M[H+S]=G.x+(G.z-G.x)*M[H+S],M[H+S+1]=G.y+(G.w-G.y)*M[H+S+1],H+=2;break}}}static Parse(R){const N=new H,q=R.xa;q&&N.set(q,M.e.PositionKind);const w=R.ya;w&&N.set(w,M.e.NormalKind);const u=R.tangents;u&&N.set(u,M.e.TangentKind);const v=R.Aa;v&&N.set(v,M.e.UVKind);const J=R.uvs2;J&&N.set(J,M.e.UV2Kind);const y=R.uvs3;y&&N.set(y,M.e.UV3Kind);const a=R.uvs4;a&&N.set(a,M.e.UV4Kind);const j=R.uvs5;j&&N.set(j,M.e.UV5Kind);const F=R.uvs6;F&&N.set(F,M.e.UV6Kind);const W=R.za;W&&(N.set(G.d.CheckColors4(W,q.length/3),M.e.ColorKind),void 0!==R.hasVertexAlpha&&(N.hasVertexAlpha=R.hasVertexAlpha));const k=R.matricesIndices;k&&N.set(k,M.e.MatricesIndicesKind);const C=R.matricesWeights;C&&N.set(C,M.e.MatricesWeightsKind);const e=R.indices;e&&(N.indices=e);const K=R.materialInfos;if(K){N.materialInfos=[];for(const R of K){const q=new S;q.indexCount=R.indexCount,q.indexStart=R.indexStart,q.verticesCount=R.verticesCount,q.verticesStart=R.verticesStart,q.materialIndex=R.materialIndex,N.materialInfos.push(q)}}return N}static ImportVertexData(R,N){const q=H.Parse(R);N.setAllVerticesData(q,R.updatable)}}H.FRONTSIDE=0,H.BACKSIDE=1,H.DOUBLESIDE=2,H.DEFAULTSIDE=0,H._UniqueIDGenerator=0,(0,w.b)([y.g.filter((function(){for(var R=arguments.length,N=new Array(R),q=0;q<R;q++)N[q]=arguments[q];let[w]=N;return!Array.isArray(w)}))],H,"_TransformVector3Coordinates",null),(0,w.b)([y.g.filter((function(){for(var R=arguments.length,N=new Array(R),q=0;q<R;q++)N[q]=arguments[q];let[w]=N;return!Array.isArray(w)}))],H,"_TransformVector3Normals",null),(0,w.b)([y.g.filter((function(){for(var R=arguments.length,N=new Array(R),q=0;q<R;q++)N[q]=arguments[q];let[w]=N;return!Array.isArray(w)}))],H,"_TransformVector4Normals",null),(0,w.b)([y.g.filter((function(){for(var R=arguments.length,N=new Array(R),q=0;q<R;q++)N[q]=arguments[q];let[w]=N;return!Array.isArray(w)}))],H,"_FlipFaces",null)},12360:(R,N,q)=>{"use strict";q.d(N,{d:()=>WR});var w=q(966),u=q(11381),M=q(1227),v=q(11403),G=q(1159);function J(R){let N=R.pathArray;const q=R.closeArray||!1,w=R.closePath||!1,u=R.invertUV||!1,J=Math.floor(N[0].length/2);let y=R.offset||J;y=y>J?J:Math.floor(y);const a=0===R.sideOrientation?0:R.sideOrientation||v.d.DEFAULTSIDE,j=R.Aa,F=R.za,S=[],H=[],W=[],k=[],C=[],e=[],K=[],r=[];let Z;const z=[],d=[];let x,E,P;if(N.length<2){const R=[],q=[];for(E=0;E<N[0].length-y;E++)R.push(N[0][E]),q.push(N[0][E+y]);N=[R,q]}let s=0;const O=w?1:0,L=q?1:0;let m,o,A,n,Q,Y;for(Z=N[0].length,x=0;x<N.length+L;x++){for(K[x]=0,C[x]=[0],m=x===N.length?N[0]:N[x],o=m.length,Z=Z<o?Z:o,P=0;P<o;)S.push(m[P].x,m[P].y,m[P].z),P>0&&(A=m[P].Vc(m[P-1]).length(),n=A+K[x],C[x].push(n),K[x]=n),P++;w&&(P--,S.push(m[0].x,m[0].y,m[0].z),A=m[P].Vc(m[0]).length(),n=A+K[x],C[x].push(n),K[x]=n),z[x]=o+O,d[x]=s,s+=o+O}let T,f,c=null,b=null;for(E=0;E<Z+O;E++)for(r[E]=0,e[E]=[0],x=0;x<N.length-1+L;x++)Q=N[x],Y=x===N.length-1?N[0]:N[x+1],E===Z?(c=Q[0],b=Y[0]):(c=Q[E],b=Y[E]),A=b.Vc(c).length(),n=A+r[E],e[E].push(n),r[E]=n;if(j)for(x=0;x<j.length;x++)k.push(j[x].x,G.e?1-j[x].y:j[x].y);else for(x=0;x<N.length+L;x++)for(E=0;E<Z+O;E++)T=0!=K[x]?C[x][E]/K[x]:0,f=0!=r[E]?e[E][x]/r[E]:0,u?k.push(f,T):k.push(T,G.e?1-f:f);x=0;let I=0,V=z[x]-1,t=z[x+1]-1,i=V<t?V:t,g=d[1]-d[0];const U=z.length-1;for(;I<=i&&x<U;)H.push(I,I+g,I+1),H.push(I+g+1,I+1,I+g),I+=1,I===i&&(x++,g=d[x+1]-d[x],V=z[x]-1,t=z[x+1]-1,I=d[x],i=V<t?V+I:t+I);if(v.d.ComputeNormals(S,H,W),w){let R=0,q=0;for(x=0;x<N.length;x++){R=3*d[x],q=x+1<N.length?3*(d[x+1]-1):W.length-3,W[R]=.5*(W[R]+W[q]),W[R+1]=.5*(W[R+1]+W[q+1]),W[R+2]=.5*(W[R+2]+W[q+2]);const w=Math.sqrt(W[R]*W[R]+W[R+1]*W[R+1]+W[R+2]*W[R+2]);W[R]/=w,W[R+1]/=w,W[R+2]/=w,W[q]=W[R],W[q+1]=W[R+1],W[q+2]=W[R+2]}}if(q){let R=3*d[0],q=3*d[N.length];for(E=0;E<Z+O;E++){W[R]=.5*(W[R]+W[q]),W[R+1]=.5*(W[R+1]+W[q+1]),W[R+2]=.5*(W[R+2]+W[q+2]);const N=Math.sqrt(W[R]*W[R]+W[R+1]*W[R+1]+W[R+2]*W[R+2]);W[R]/=N,W[R+1]/=N,W[R+2]/=N,W[q]=W[R],W[q+1]=W[R+1],W[q+2]=W[R+2],R+=3,q+=3}}v.d._ComputeSides(a,S,H,W,k,R.frontUVs,R.backUVs);let B=null;if(F){B=new Float32Array(4*F.length);for(let R=0;R<F.length;R++)B[4*R]=F[R].r,B[4*R+1]=F[R].g,B[4*R+2]=F[R].b,B[4*R+3]=F[R].a}const l=new v.d,X=new Float32Array(S),h=new Float32Array(W),D=new Float32Array(k);return l.indices=H,l.xa=X,l.ya=h,l.Aa=D,B&&l.set(B,M.e.ColorKind),w&&(l._idx=d),l}function y(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=N.pathArray,a=N.closeArray,j=N.closePath,F=u.b._GetDefaultSideOrientation(N.sideOrientation),S=N.instance,H=N.updatable;if(S){const R=w.f.Od[0].Td(Number.MAX_VALUE),q=w.f.Od[1].Td(-Number.MAX_VALUE),J=N=>{let w=y[0].length;const M=S;let v=0;const G=M._originalBuilderSideOrientation===u.b.DOUBLESIDE?2:1;for(let u=1;u<=G;++u)for(let G=0;G<y.length;++G){const u=y[G],J=u.length;w=w<J?w:J;for(let M=0;M<w;++M){const w=u[M];N[v]=w.x,N[v+1]=w.y,N[v+2]=w.z,R.minimizeInPlaceFromFloats(w.x,w.y,w.z),q.maximizeInPlaceFromFloats(w.x,w.y,w.z),v+=3}if(M._creationDataStorage&&M._creationDataStorage.closePath){const R=u[0];N[v]=R.x,N[v+1]=R.y,N[v+2]=R.z,v+=3}}},a=S.getVerticesData(M.e.PositionKind);if(J(a),S.hasBoundingInfo?S.getBoundingInfo().reConstruct(R,q,S._worldMatrix):S.buildBoundingInfo(R,q,S._worldMatrix),S.updateVerticesData(M.e.PositionKind,a,!1,!1),N.za){const R=S.getVerticesData(M.e.ColorKind);for(let q=0,w=0;q<N.za.length;q++,w+=4){const u=N.za[q];R[w]=u.r,R[w+1]=u.g,R[w+2]=u.b,R[w+3]=u.a}S.updateVerticesData(M.e.ColorKind,R,!1,!1)}if(N.Aa){const R=S.getVerticesData(M.e.UVKind);for(let q=0;q<N.Aa.length;q++)R[2*q]=N.Aa[q].x,R[2*q+1]=G.e?1-N.Aa[q].y:N.Aa[q].y;S.updateVerticesData(M.e.UVKind,R,!1,!1)}if(!S.areNormalsFrozen||S.isFacetDataEnabled){const R=S.Md(),N=S.getVerticesData(M.e.NormalKind),q=S.isFacetDataEnabled?S.getFacetDataParameters():null;if(v.d.ComputeNormals(a,R,N,q),S._creationDataStorage&&S._creationDataStorage.closePath){let R=0,q=0;for(let w=0;w<y.length;w++)R=3*S._creationDataStorage.idx[w],q=w+1<y.length?3*(S._creationDataStorage.idx[w+1]-1):N.length-3,N[R]=.5*(N[R]+N[q]),N[R+1]=.5*(N[R+1]+N[q+1]),N[R+2]=.5*(N[R+2]+N[q+2]),N[q]=N[R],N[q+1]=N[R+1],N[q+2]=N[R+2]}S.areNormalsFrozen||S.updateVerticesData(M.e.NormalKind,N,!1,!1)}return S}{const w=new u.b(R,q);w._originalBuilderSideOrientation=F,w._creationDataStorage=new u.d;const M=J(N);return j&&(w._creationDataStorage.idx=M._idx),w._creationDataStorage.closePath=j,w._creationDataStorage.closeArray=a,M.Ca(w,H),w}}v.d.CreateRibbon=J,u.b.CreateRibbon=function(R,N){return y(R,{pathArray:N,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var a=q(11557),j=q(11433),F=q(1133);function S(R){const N=R.pattern||u.b.NO_FLIP,q=R.tileWidth||R.tileSize||1,w=R.tileHeight||R.tileSize||1,M=R.alignHorizontal||0,G=R.alignVertical||0,J=R.width||R.size||1,y=Math.floor(J/q);let a=J-y*q;const j=R.height||R.size||1,F=Math.floor(j/w);let S=j-F*w;const H=q*y/2,W=w*F/2;let k=0,C=0,e=0,K=0,r=0,Z=0;if(a>0||S>0){switch(e=-H,K=-W,r=H,Z=W,M){case u.b.CENTER:a/=2,e-=a,r+=a;break;case u.b.LEFT:r+=a,k=-a/2;break;case u.b.RIGHT:e-=a,k=a/2}switch(G){case u.b.CENTER:S/=2,K-=S,Z+=S;break;case u.b.BOTTOM:Z+=S,C=-S/2;break;case u.b.TOP:K-=S,C=S/2}}const z=[],d=[],x=[];x[0]=[0,0,1,0,1,1,0,1],x[1]=[0,0,1,0,1,1,0,1],N!==u.b.ROTATE_TILE&&N!==u.b.ROTATE_ROW||(x[1]=[1,1,0,1,0,0,1,0]),N!==u.b.FLIP_TILE&&N!==u.b.FLIP_ROW||(x[1]=[1,0,0,0,0,1,1,1]),N!==u.b.FLIP_N_ROTATE_TILE&&N!==u.b.FLIP_N_ROTATE_ROW||(x[1]=[0,1,1,1,1,0,0,0]);let E=[];const P=[],s=[];let O=0;for(let v=0;v<F;v++)for(let R=0;R<y;R++)z.push(R*q-H+k,v*w-W+C,0),z.push((R+1)*q-H+k,v*w-W+C,0),z.push((R+1)*q-H+k,(v+1)*w-W+C,0),z.push(R*q-H+k,(v+1)*w-W+C,0),s.push(O,O+1,O+3,O+1,O+2,O+3),E=N===u.b.FLIP_TILE||N===u.b.ROTATE_TILE||N===u.b.FLIP_N_ROTATE_TILE?E.concat(x[(R%2+v%2)%2]):N===u.b.FLIP_ROW||N===u.b.ROTATE_ROW||N===u.b.FLIP_N_ROTATE_ROW?E.concat(x[v%2]):E.concat(x[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),O+=4;if(a>0||S>0){const R=S>0&&(G===u.b.CENTER||G===u.b.TOP),v=S>0&&(G===u.b.CENTER||G===u.b.BOTTOM),J=a>0&&(M===u.b.CENTER||M===u.b.RIGHT),j=a>0&&(M===u.b.CENTER||M===u.b.LEFT);let x,L,m,o,A=[];if(R&&J&&(z.push(e+k,K+C,0),z.push(-H+k,K+C,0),z.push(-H+k,K+S+C,0),z.push(e+k,K+S+C,0),s.push(O,O+1,O+3,O+1,O+2,O+3),O+=4,x=1-a/q,L=1-S/w,m=1,o=1,A=[x,L,m,L,m,o,x,o],N===u.b.ROTATE_ROW&&(A=[1-x,1-L,1-m,1-L,1-m,1-o,1-x,1-o]),N===u.b.FLIP_ROW&&(A=[1-x,L,1-m,L,1-m,o,1-x,o]),N===u.b.FLIP_N_ROTATE_ROW&&(A=[x,1-L,m,1-L,m,1-o,x,1-o]),E=E.concat(A),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),R&&j&&(z.push(H+k,K+C,0),z.push(r+k,K+C,0),z.push(r+k,K+S+C,0),z.push(H+k,K+S+C,0),s.push(O,O+1,O+3,O+1,O+2,O+3),O+=4,x=0,L=1-S/w,m=a/q,o=1,A=[x,L,m,L,m,o,x,o],(N===u.b.ROTATE_ROW||N===u.b.ROTATE_TILE&&y%2===0)&&(A=[1-x,1-L,1-m,1-L,1-m,1-o,1-x,1-o]),(N===u.b.FLIP_ROW||N===u.b.FLIP_TILE&&y%2===0)&&(A=[1-x,L,1-m,L,1-m,o,1-x,o]),(N===u.b.FLIP_N_ROTATE_ROW||N===u.b.FLIP_N_ROTATE_TILE&&y%2===0)&&(A=[x,1-L,m,1-L,m,1-o,x,1-o]),E=E.concat(A),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),v&&J&&(z.push(e+k,W+C,0),z.push(-H+k,W+C,0),z.push(-H+k,Z+C,0),z.push(e+k,Z+C,0),s.push(O,O+1,O+3,O+1,O+2,O+3),O+=4,x=1-a/q,L=0,m=1,o=S/w,A=[x,L,m,L,m,o,x,o],(N===u.b.ROTATE_ROW&&F%2===1||N===u.b.ROTATE_TILE&&F%1===0)&&(A=[1-x,1-L,1-m,1-L,1-m,1-o,1-x,1-o]),(N===u.b.FLIP_ROW&&F%2===1||N===u.b.FLIP_TILE&&F%2===0)&&(A=[1-x,L,1-m,L,1-m,o,1-x,o]),(N===u.b.FLIP_N_ROTATE_ROW&&F%2===1||N===u.b.FLIP_N_ROTATE_TILE&&F%2===0)&&(A=[x,1-L,m,1-L,m,1-o,x,1-o]),E=E.concat(A),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),v&&j&&(z.push(H+k,W+C,0),z.push(r+k,W+C,0),z.push(r+k,Z+C,0),z.push(H+k,Z+C,0),s.push(O,O+1,O+3,O+1,O+2,O+3),O+=4,x=0,L=0,m=a/q,o=S/w,A=[x,L,m,L,m,o,x,o],(N===u.b.ROTATE_ROW&&F%2===1||N===u.b.ROTATE_TILE&&(F+y)%2===1)&&(A=[1-x,1-L,1-m,1-L,1-m,1-o,1-x,1-o]),(N===u.b.FLIP_ROW&&F%2===1||N===u.b.FLIP_TILE&&(F+y)%2===1)&&(A=[1-x,L,1-m,L,1-m,o,1-x,o]),(N===u.b.FLIP_N_ROTATE_ROW&&F%2===1||N===u.b.FLIP_N_ROTATE_TILE&&(F+y)%2===1)&&(A=[x,1-L,m,1-L,m,1-o,x,1-o]),E=E.concat(A),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),R){const R=[];x=0,L=1-S/w,m=1,o=1,R[0]=[x,L,m,L,m,o,x,o],R[1]=[x,L,m,L,m,o,x,o],N!==u.b.ROTATE_TILE&&N!==u.b.ROTATE_ROW||(R[1]=[1-x,1-L,1-m,1-L,1-m,1-o,1-x,1-o]),N!==u.b.FLIP_TILE&&N!==u.b.FLIP_ROW||(R[1]=[1-x,L,1-m,L,1-m,o,1-x,o]),N!==u.b.FLIP_N_ROTATE_TILE&&N!==u.b.FLIP_N_ROTATE_ROW||(R[1]=[x,1-L,m,1-L,m,1-o,x,1-o]);for(let w=0;w<y;w++)z.push(w*q-H+k,K+C,0),z.push((w+1)*q-H+k,K+C,0),z.push((w+1)*q-H+k,K+S+C,0),z.push(w*q-H+k,K+S+C,0),s.push(O,O+1,O+3,O+1,O+2,O+3),O+=4,E=N===u.b.FLIP_TILE||N===u.b.ROTATE_TILE||N===u.b.FLIP_N_ROTATE_TILE?E.concat(R[(w+1)%2]):N===u.b.FLIP_ROW||N===u.b.ROTATE_ROW||N===u.b.FLIP_N_ROTATE_ROW?E.concat(R[1]):E.concat(R[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(v){const R=[];x=0,L=0,m=1,o=S/w,R[0]=[x,L,m,L,m,o,x,o],R[1]=[x,L,m,L,m,o,x,o],N!==u.b.ROTATE_TILE&&N!==u.b.ROTATE_ROW||(R[1]=[1-x,1-L,1-m,1-L,1-m,1-o,1-x,1-o]),N!==u.b.FLIP_TILE&&N!==u.b.FLIP_ROW||(R[1]=[1-x,L,1-m,L,1-m,o,1-x,o]),N!==u.b.FLIP_N_ROTATE_TILE&&N!==u.b.FLIP_N_ROTATE_ROW||(R[1]=[x,1-L,m,1-L,m,1-o,x,1-o]);for(let w=0;w<y;w++)z.push(w*q-H+k,Z-S+C,0),z.push((w+1)*q-H+k,Z-S+C,0),z.push((w+1)*q-H+k,Z+C,0),z.push(w*q-H+k,Z+C,0),s.push(O,O+1,O+3,O+1,O+2,O+3),O+=4,E=N===u.b.FLIP_TILE||N===u.b.ROTATE_TILE||N===u.b.FLIP_N_ROTATE_TILE?E.concat(R[(w+F)%2]):N===u.b.FLIP_ROW||N===u.b.ROTATE_ROW||N===u.b.FLIP_N_ROTATE_ROW?E.concat(R[F%2]):E.concat(R[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(J){const R=[];x=1-a/q,L=0,m=1,o=1,R[0]=[x,L,m,L,m,o,x,o],R[1]=[x,L,m,L,m,o,x,o],N!==u.b.ROTATE_TILE&&N!==u.b.ROTATE_ROW||(R[1]=[1-x,1-L,1-m,1-L,1-m,1-o,1-x,1-o]),N!==u.b.FLIP_TILE&&N!==u.b.FLIP_ROW||(R[1]=[1-x,L,1-m,L,1-m,o,1-x,o]),N!==u.b.FLIP_N_ROTATE_TILE&&N!==u.b.FLIP_N_ROTATE_ROW||(R[1]=[x,1-L,m,1-L,m,1-o,x,1-o]);for(let q=0;q<F;q++)z.push(e+k,q*w-W+C,0),z.push(e+a+k,q*w-W+C,0),z.push(e+a+k,(q+1)*w-W+C,0),z.push(e+k,(q+1)*w-W+C,0),s.push(O,O+1,O+3,O+1,O+2,O+3),O+=4,E=N===u.b.FLIP_TILE||N===u.b.ROTATE_TILE||N===u.b.FLIP_N_ROTATE_TILE?E.concat(R[(q+1)%2]):N===u.b.FLIP_ROW||N===u.b.ROTATE_ROW||N===u.b.FLIP_N_ROTATE_ROW?E.concat(R[q%2]):E.concat(R[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(j){const R=[];x=0,L=0,m=a/w,o=1,R[0]=[x,L,m,L,m,o,x,o],R[1]=[x,L,m,L,m,o,x,o],N!==u.b.ROTATE_TILE&&N!==u.b.ROTATE_ROW||(R[1]=[1-x,1-L,1-m,1-L,1-m,1-o,1-x,1-o]),N!==u.b.FLIP_TILE&&N!==u.b.FLIP_ROW||(R[1]=[1-x,L,1-m,L,1-m,o,1-x,o]),N!==u.b.FLIP_N_ROTATE_TILE&&N!==u.b.FLIP_N_ROTATE_ROW||(R[1]=[x,1-L,m,1-L,m,1-o,x,1-o]);for(let q=0;q<F;q++)z.push(r-a+k,q*w-W+C,0),z.push(r+k,q*w-W+C,0),z.push(r+k,(q+1)*w-W+C,0),z.push(r-a+k,(q+1)*w-W+C,0),s.push(O,O+1,O+3,O+1,O+2,O+3),O+=4,E=N===u.b.FLIP_TILE||N===u.b.ROTATE_TILE||N===u.b.FLIP_N_ROTATE_TILE?E.concat(R[(q+y)%2]):N===u.b.FLIP_ROW||N===u.b.ROTATE_ROW||N===u.b.FLIP_N_ROTATE_ROW?E.concat(R[q%2]):E.concat(R[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),d.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const L=0===R.sideOrientation?0:R.sideOrientation||v.d.DEFAULTSIDE;v.d._ComputeSides(L,z,s,d,E,R.frontUVs,R.backUVs);const m=new v.d;m.indices=s,m.xa=z,m.ya=d,m.Aa=E;const o=L===v.d.DOUBLESIDE?P.concat(P):P;return m.za=o,m}function H(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new u.b(R,q);N.sideOrientation=u.b._GetDefaultSideOrientation(N.sideOrientation),w._originalBuilderSideOrientation=N.sideOrientation;return S(N).Ca(w,N.updatable),w}function W(R){const N=R.faceUV||new Array(6),q=R.faceColors,M=R.pattern||u.b.NO_FLIP,J=R.width||R.size||1,y=R.height||R.size||1,a=R.depth||R.size||1,j=R.tileWidth||R.tileSize||1,H=R.tileHeight||R.tileSize||1,W=R.alignHorizontal||0,k=R.alignVertical||0,C=0===R.sideOrientation?0:R.sideOrientation||v.d.DEFAULTSIDE;for(let u=0;u<6;u++)void 0===N[u]&&(N[u]=new w.n(0,0,1,1)),q&&void 0===q[u]&&(q[u]=new F.d(1,1,1,1));const e=J/2,K=y/2,r=a/2,Z=[];for(let w=0;w<2;w++)Z[w]=S({pattern:M,tileWidth:j,tileHeight:H,width:J,height:y,alignVertical:k,alignHorizontal:W,sideOrientation:C});for(let w=2;w<4;w++)Z[w]=S({pattern:M,tileWidth:j,tileHeight:H,width:a,height:y,alignVertical:k,alignHorizontal:W,sideOrientation:C});let z=k;k===u.b.BOTTOM?z=u.b.TOP:k===u.b.TOP&&(z=u.b.BOTTOM);for(let w=4;w<6;w++)Z[w]=S({pattern:M,tileWidth:j,tileHeight:H,width:J,height:a,alignVertical:z,alignHorizontal:W,sideOrientation:C});let d=[],x=[],E=[],P=[];const s=[],O=[],L=[],m=[];let o=0,A=0;for(let u=0;u<6;u++){const R=Z[u].xa.length;O[u]=[],L[u]=[];for(let N=0;N<R/3;N++)O[u].push(new w.m(Z[u].xa[3*N],Z[u].xa[3*N+1],Z[u].xa[3*N+2])),L[u].push(new w.m(Z[u].ya[3*N],Z[u].ya[3*N+1],Z[u].ya[3*N+2]));o=Z[u].Aa.length,m[u]=[];for(let q=0;q<o;q+=2)m[u][q]=N[u].x+(N[u].z-N[u].x)*Z[u].Aa[q],m[u][q+1]=N[u].y+(N[u].w-N[u].y)*Z[u].Aa[q+1],G.e&&(m[u][q+1]=1-m[u][q+1]);if(E=E.concat(m[u]),P=P.concat(Z[u].indices.map((R=>R+A))),A+=O[u].length,q)for(let N=0;N<4;N++)s.push(q[u].r,q[u].g,q[u].b,q[u].a)}const n=new w.m(0,0,r),Q=w.c.RotationY(Math.PI);d=O[0].map((R=>w.m.TransformNormal(R,Q).add(n))).map((R=>[R.x,R.y,R.z])).reduce(((R,N)=>R.concat(N)),[]),x=L[0].map((R=>w.m.TransformNormal(R,Q))).map((R=>[R.x,R.y,R.z])).reduce(((R,N)=>R.concat(N)),[]),d=d.concat(O[1].map((R=>R.Vc(n))).map((R=>[R.x,R.y,R.z])).reduce(((R,N)=>R.concat(N)),[])),x=x.concat(L[1].map((R=>[R.x,R.y,R.z])).reduce(((R,N)=>R.concat(N)),[]));const Y=new w.m(e,0,0),T=w.c.RotationY(-Math.PI/2);d=d.concat(O[2].map((R=>w.m.TransformNormal(R,T).add(Y))).map((R=>[R.x,R.y,R.z])).reduce(((R,N)=>R.concat(N)),[])),x=x.concat(L[2].map((R=>w.m.TransformNormal(R,T))).map((R=>[R.x,R.y,R.z])).reduce(((R,N)=>R.concat(N)),[]));const f=w.c.RotationY(Math.PI/2);d=d.concat(O[3].map((R=>w.m.TransformNormal(R,f).Vc(Y))).map((R=>[R.x,R.y,R.z])).reduce(((R,N)=>R.concat(N)),[])),x=x.concat(L[3].map((R=>w.m.TransformNormal(R,f))).map((R=>[R.x,R.y,R.z])).reduce(((R,N)=>R.concat(N)),[]));const c=new w.m(0,K,0),b=w.c.RotationX(Math.PI/2);d=d.concat(O[4].map((R=>w.m.TransformNormal(R,b).add(c))).map((R=>[R.x,R.y,R.z])).reduce(((R,N)=>R.concat(N)),[])),x=x.concat(L[4].map((R=>w.m.TransformNormal(R,b))).map((R=>[R.x,R.y,R.z])).reduce(((R,N)=>R.concat(N)),[]));const I=w.c.RotationX(-Math.PI/2);d=d.concat(O[5].map((R=>w.m.TransformNormal(R,I).Vc(c))).map((R=>[R.x,R.y,R.z])).reduce(((R,N)=>R.concat(N)),[])),x=x.concat(L[5].map((R=>w.m.TransformNormal(R,I))).map((R=>[R.x,R.y,R.z])).reduce(((R,N)=>R.concat(N)),[])),v.d._ComputeSides(C,d,P,x,E);const V=new v.d;if(V.indices=P,V.xa=d,V.ya=x,V.Aa=E,q){const R=C===v.d.DOUBLESIDE?s.concat(s):s;V.za=R}return V}function k(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new u.b(R,q);N.sideOrientation=u.b._GetDefaultSideOrientation(N.sideOrientation),w._originalBuilderSideOrientation=N.sideOrientation;return W(N).Ca(w,N.updatable),w}v.d.CreateTiledPlane=S;v.d.CreateTiledBox=W;var C=q(11547),e=q(1174),K=q(1460);function r(R){const N=R.height||2;let q=0===R.diameterTop?0:R.diameterTop||R.diameter||1,M=0===R.diameterBottom?0:R.diameterBottom||R.diameter||1;q=q||1e-5,M=M||1e-5;const J=0|(R.Sk||24),y=0|(R.subdivisions||1),a=!!R.hasRings,j=!!R.enclose,S=0===R.cap?0:R.cap||u.b.CAP_ALL,H=R.arc&&(R.arc<=0||R.arc>1)?1:R.arc||1,W=0===R.sideOrientation?0:R.sideOrientation||v.d.DEFAULTSIDE,k=R.faceUV||new Array(3),C=R.faceColors,e=2+(1+(1!==H&&j?2:0))*(a?y:1);let r;for(r=0;r<e;r++)C&&void 0===C[r]&&(C[r]=new F.d(1,1,1,1));for(r=0;r<e;r++)k&&void 0===k[r]&&(k[r]=new w.n(0,0,1,1));const Z=[],z=[],d=[],x=[],E=[],P=2*Math.PI*H/J;let s,O,L;const m=(M-q)/2/N,o=w.m.Zero(),A=w.m.Zero(),n=w.m.Zero(),Q=w.m.Zero(),Y=w.m.Zero(),T=K.d.Y;let f,c,b,I=1,V=1,t=0,i=0;for(f=0;f<=y;f++)for(O=f/y,L=(O*(q-M)+M)/2,I=a&&0!==f&&f!==y?2:1,b=0;b<I;b++){for(a&&(V+=b),j&&(V+=2*b),c=0;c<=J;c++)s=c*P,o.x=Math.cos(-s)*L,o.y=-N/2+O*N,o.z=Math.sin(-s)*L,0===q&&f===y?(A.x=d[d.length-3*(J+1)],A.y=d[d.length-3*(J+1)+1],A.z=d[d.length-3*(J+1)+2]):(A.x=o.x,A.z=o.z,A.y=Math.sqrt(A.x*A.x+A.z*A.z)*m,A.normalize()),0===c&&(n.p(o),Q.p(A)),z.push(o.x,o.y,o.z),d.push(A.x,A.y,A.z),i=a?t!==V?k[V].y:k[V].w:k[V].y+(k[V].w-k[V].y)*O,x.push(k[V].x+(k[V].z-k[V].x)*c/J,G.e?1-i:i),C&&E.push(C[V].r,C[V].g,C[V].b,C[V].a);1!==H&&j&&(z.push(o.x,o.y,o.z),z.push(0,o.y,0),z.push(0,o.y,0),z.push(n.x,n.y,n.z),w.m.CrossToRef(T,A,Y),Y.normalize(),d.push(Y.x,Y.y,Y.z,Y.x,Y.y,Y.z),w.m.CrossToRef(Q,T,Y),Y.normalize(),d.push(Y.x,Y.y,Y.z,Y.x,Y.y,Y.z),i=a?t!==V?k[V+1].y:k[V+1].w:k[V+1].y+(k[V+1].w-k[V+1].y)*O,x.push(k[V+1].x,G.e?1-i:i),x.push(k[V+1].z,G.e?1-i:i),i=a?t!==V?k[V+2].y:k[V+2].w:k[V+2].y+(k[V+2].w-k[V+2].y)*O,x.push(k[V+2].x,G.e?1-i:i),x.push(k[V+2].z,G.e?1-i:i),C&&(E.push(C[V+1].r,C[V+1].g,C[V+1].b,C[V+1].a),E.push(C[V+1].r,C[V+1].g,C[V+1].b,C[V+1].a),E.push(C[V+2].r,C[V+2].g,C[V+2].b,C[V+2].a),E.push(C[V+2].r,C[V+2].g,C[V+2].b,C[V+2].a))),t!==V&&(t=V)}const g=1!==H&&j?J+4:J;for(f=0,V=0;V<y;V++){let R=0,N=0,q=0,w=0;for(c=0;c<J;c++)R=f*(g+1)+c,N=(f+1)*(g+1)+c,q=f*(g+1)+(c+1),w=(f+1)*(g+1)+(c+1),Z.push(R,N,q),Z.push(w,q,N);1!==H&&j&&(Z.push(R+2,N+2,q+2),Z.push(w+2,q+2,N+2),Z.push(R+4,N+4,q+4),Z.push(w+4,q+4,N+4)),f=a?f+2:f+1}const U=R=>{const u=R?q/2:M/2;if(0===u)return;let v,y,a;const j=R?k[e-1]:k[0];let F=null;C&&(F=R?C[e-1]:C[0]);const S=z.length/3,W=R?N/2:-N/2,K=new w.m(0,W,0);z.push(K.x,K.y,K.z),d.push(0,R?1:-1,0);const r=j.y+.5*(j.w-j.y);x.push(j.x+.5*(j.z-j.x),G.e?1-r:r),F&&E.push(F.r,F.g,F.b,F.a);const P=new w.j(.5,.5);for(a=0;a<=J;a++){v=2*Math.PI*a*H/J;const N=Math.cos(-v),q=Math.sin(-v);y=new w.m(N*u,W,q*u);const M=new w.j(N*P.x+.5,q*P.y+.5);z.push(y.x,y.y,y.z),d.push(0,R?1:-1,0);const S=j.y+(j.w-j.y)*M.y;x.push(j.x+(j.z-j.x)*M.x,G.e?1-S:S),F&&E.push(F.r,F.g,F.b,F.a)}for(a=0;a<J;a++)R?(Z.push(S),Z.push(S+(a+2)),Z.push(S+(a+1))):(Z.push(S),Z.push(S+(a+1)),Z.push(S+(a+2)))};S!==u.b.CAP_START&&S!==u.b.CAP_ALL||U(!1),S!==u.b.CAP_END&&S!==u.b.CAP_ALL||U(!0),v.d._ComputeSides(W,z,Z,d,x,R.frontUVs,R.backUVs);const B=new v.d;return B.indices=Z,B.xa=z,B.ya=d,B.Aa=x,C&&(B.za=E),B}function Z(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2?arguments[2]:void 0;const w=new u.b(R,q);N.sideOrientation=u.b._GetDefaultSideOrientation(N.sideOrientation),w._originalBuilderSideOrientation=N.sideOrientation;return r(N).Ca(w,N.updatable),w}function z(R){const N=[],q=[],u=[],M=[],J=R.diameter||1,y=R.thickness||.5,a=0|(R.Sk||16),j=0===R.sideOrientation?0:R.sideOrientation||v.d.DEFAULTSIDE,F=a+1;for(let v=0;v<=a;v++){const R=v/a,j=v*Math.PI*2/a-Math.PI/2,S=w.c.Translation(J/2,0,0).multiply(w.c.RotationY(j));for(let J=0;J<=a;J++){const j=1-J/a,H=J*Math.PI*2/a+Math.PI,W=Math.cos(H),k=Math.sin(H);let C=new w.m(W,k,0),e=C.scale(y/2);const K=new w.j(R,j);e=w.m.TransformCoordinates(e,S),C=w.m.TransformNormal(C,S),q.push(e.x,e.y,e.z),u.push(C.x,C.y,C.z),M.push(K.x,G.e?1-K.y:K.y);const r=(v+1)%F,Z=(J+1)%F;N.push(v*F+J),N.push(v*F+Z),N.push(r*F+J),N.push(v*F+Z),N.push(r*F+Z),N.push(r*F+J)}}v.d._ComputeSides(j,q,N,u,M,R.frontUVs,R.backUVs);const S=new v.d;return S.indices=N,S.xa=q,S.ya=u,S.Aa=M,S}function d(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2?arguments[2]:void 0;const w=new u.b(R,q);N.sideOrientation=u.b._GetDefaultSideOrientation(N.sideOrientation),w._originalBuilderSideOrientation=N.sideOrientation;return z(N).Ca(w,N.updatable),w}v.d.CreateCylinder=r,u.b.CreateCylinder=(R,N,q,w,M,v,G,J,y)=>{void 0!==G&&G instanceof e.e||(void 0!==G&&(y=J||u.b.DEFAULTSIDE,J=G),G=v,v=1);return Z(R,{height:N,diameterTop:q,diameterBottom:w,Sk:M,subdivisions:v,sideOrientation:y,updatable:J},G)};function x(R){const N=[],q=[],u=[],M=[],J=R.i||2,y=R.tube||.5,a=R.radialSegments||32,j=R.tubularSegments||32,F=R.p||2,S=R.q||3,H=0===R.sideOrientation?0:R.sideOrientation||v.d.DEFAULTSIDE,W=R=>{const N=Math.cos(R),q=Math.sin(R),u=S/F*R,M=Math.cos(u),v=J*(2+M)*.5*N,G=J*(2+M)*q*.5,y=J*Math.sin(u)*.5;return new w.m(v,G,y)};let k,C;for(k=0;k<=a;k++){const R=k%a/a*2*F*Math.PI,N=W(R),u=W(R+.01),v=u.Vc(N);let J=u.add(N);const S=w.m.Cross(v,J);for(J=w.m.Cross(S,v),S.normalize(),J.normalize(),C=0;C<j;C++){const R=C%j/j*2*Math.PI,w=-y*Math.cos(R),u=y*Math.sin(R);q.push(N.x+w*J.x+u*S.x),q.push(N.y+w*J.y+u*S.y),q.push(N.z+w*J.z+u*S.z),M.push(k/a),M.push(G.e?1-C/j:C/j)}}for(k=0;k<a;k++)for(C=0;C<j;C++){const R=(C+1)%j,q=k*j+C,w=(k+1)*j+C,u=(k+1)*j+R,M=k*j+R;N.push(M),N.push(w),N.push(q),N.push(M),N.push(u),N.push(w)}v.d.ComputeNormals(q,N,u),v.d._ComputeSides(H,q,N,u,M,R.frontUVs,R.backUVs);const e=new v.d;return e.indices=N,e.xa=q,e.ya=u,e.Aa=M,e}function E(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2?arguments[2]:void 0;const w=new u.b(R,q);N.sideOrientation=u.b._GetDefaultSideOrientation(N.sideOrientation),w._originalBuilderSideOrientation=N.sideOrientation;return x(N).Ca(w,N.updatable),w}v.d.CreateTorus=z,u.b.CreateTorus=(R,N,q,w,u,M,v)=>d(R,{diameter:N,thickness:q,Sk:w,sideOrientation:v,updatable:M},u);v.d.CreateTorusKnot=x,u.b.CreateTorusKnot=(R,N,q,w,u,M,v,G,J,y)=>E(R,{i:N,tube:q,radialSegments:w,tubularSegments:u,p:M,q:v,sideOrientation:y,updatable:J},G);var P=q(12366),s=q(1056),O=q(1468),L=q(974),m=q(997);class o extends w.j{constructor(R,N){super(R.x,R.y),this.index=N}}class A{constructor(){this.elements=[]}add(R){const N=[];return R.forEach((R=>{const q=new o(R,this.elements.length);N.push(q),this.elements.push(q)})),N}computeBounds(){const R=new w.j(this.elements[0].x,this.elements[0].y),N=new w.j(this.elements[0].x,this.elements[0].y);return this.elements.forEach((q=>{q.x<R.x?R.x=q.x:q.x>N.x&&(N.x=q.x),q.y<R.y?R.y=q.y:q.y>N.y&&(N.y=q.y)})),{min:R,max:N,width:N.x-R.x,height:N.y-R.y}}}class n{_addToepoint(R){for(const N of R)this._epoints.push(N.x,N.y)}constructor(R,N,q){let w,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new A,this._outlinepoints=new A,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=u,this._name=R,this._scene=q||m.e.LastCreatedScene,w=N instanceof O.e?N.getPoints():N,this._addToepoint(w),this._points.add(w),this._outlinepoints.add(w),"undefined"===typeof this.bjsEarcut&&s.e.Warn("Earcut was not found, the polygon will not be built.")}addHole(R){this._points.add(R);const N=new A;return N.add(R),this._holes.push(N),this._eholes.push(this._epoints.length/2),this._addToepoint(R),this}build(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const w=new u.b(this._name,this._scene),v=this.buildVertexData(N,q);return w.Ga(M.e.PositionKind,v.xa,R),w.Ga(M.e.NormalKind,v.ya,R),w.Ga(M.e.UVKind,v.Aa,R),w.setIndices(v.indices),w}buildVertexData(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const q=new v.d,w=[],u=[],M=[],G=this._points.computeBounds();this._points.elements.forEach((R=>{w.push(0,1,0),u.push(R.x,0,R.y),M.push((R.x-G.min.x)/G.width,(R.y-G.min.y)/G.height)}));const J=[],y=this.bjsEarcut(this._epoints,this._eholes,2);for(let v=0;v<y.length;v++)J.push(y[v]);if(R>0){const q=u.length/3;this._points.elements.forEach((N=>{w.push(0,-1,0),u.push(N.x,-R,N.y),M.push(1-(N.x-G.min.x)/G.width,1-(N.y-G.min.y)/G.height)}));const v=J.length;for(let R=0;R<v;R+=3){const N=J[R+0],w=J[R+1],u=J[R+2];J.push(u+q),J.push(w+q),J.push(N+q)}this._addSide(u,w,M,J,G,this._outlinepoints,R,!1,N),this._holes.forEach((q=>{this._addSide(u,w,M,J,G,q,R,!0,N)}))}return q.indices=J,q.xa=u,q.ya=w,q.Aa=M,q}_addSide(R,N,q,u,M,v,G,J,y){let a=R.length/3,j=0;for(let F=0;F<v.elements.length;F++){const S=v.elements[F],H=v.elements[(F+1)%v.elements.length];R.push(S.x,0,S.y),R.push(S.x,-G,S.y),R.push(H.x,0,H.y),R.push(H.x,-G,H.y);const W=v.elements[(F+v.elements.length-1)%v.elements.length],k=v.elements[(F+2)%v.elements.length];let C=new w.m(-(H.y-S.y),0,H.x-S.x),e=new w.m(-(S.y-W.y),0,S.x-W.x),K=new w.m(-(k.y-H.y),0,k.x-H.x);J||(C=C.scale(-1),e=e.scale(-1),K=K.scale(-1));const r=C.normalizeToNew();let Z=e.normalizeToNew(),z=K.normalizeToNew();const d=w.m.Dot(Z,r);Z=d>y?d<L.b-1?new w.m(S.x,0,S.y).Vc(new w.m(H.x,0,H.y)).normalize():e.add(C).normalize():r;const x=w.m.Dot(K,C);z=x>y?x<L.b-1?new w.m(H.x,0,H.y).Vc(new w.m(S.x,0,S.y)).normalize():K.add(C).normalize():r,q.push(j/M.width,0),q.push(j/M.width,1),j+=C.length(),q.push(j/M.width,0),q.push(j/M.width,1),N.push(Z.x,Z.y,Z.z),N.push(Z.x,Z.y,Z.z),N.push(z.x,z.y,z.z),N.push(z.x,z.y,z.z),J?(u.push(a),u.push(a+2),u.push(a+1),u.push(a+1),u.push(a+2),u.push(a+3)):(u.push(a),u.push(a+1),u.push(a+2),u.push(a+1),u.push(a+3),u.push(a+2)),a+=4}}}function Q(R,N,q,u,J,y,a){const j=q||new Array(3),S=u,H=[],W=a||!1;for(let M=0;M<3;M++)void 0===j[M]&&(j[M]=new w.n(0,0,1,1)),S&&void 0===S[M]&&(S[M]=new F.d(1,1,1,1));const k=R.getVerticesData(M.e.PositionKind),C=R.getVerticesData(M.e.NormalKind),e=R.getVerticesData(M.e.UVKind),K=R.Md(),r=k.length/9;let Z=0,z=0,d=0,x=0,E=0;const P=[0];if(W)for(let w=r;w<k.length/3;w+=4)z=k[3*(w+2)]-k[3*w],d=k[3*(w+2)+2]-k[3*w+2],x=Math.sqrt(z*z+d*d),E+=x,P.push(E);let s=0,O=0;for(let w=0;w<C.length;w+=3)Math.abs(C[w+1])<.001&&(O=1),Math.abs(C[w+1]-1)<.001&&(O=0),Math.abs(C[w+1]+1)<.001&&(O=2),s=w/3,1===O?(Z=s-r,e[2*s]=Z%4<1.5?W?j[O].x+(j[O].z-j[O].x)*P[Math.floor(Z/4)]/E:j[O].x:W?j[O].x+(j[O].z-j[O].x)*P[Math.floor(Z/4)+1]/E:j[O].z,e[2*s+1]=Z%2===0?G.e?1-j[O].w:j[O].w:G.e?1-j[O].y:j[O].y):(e[2*s]=(1-e[2*s])*j[O].x+e[2*s]*j[O].z,e[2*s+1]=(1-e[2*s+1])*j[O].y+e[2*s+1]*j[O].w,G.e&&(e[2*s+1]=1-e[2*s+1])),S&&H.push(S[O].r,S[O].g,S[O].b,S[O].a);v.d._ComputeSides(N,k,K,C,e,J,y);const L=new v.d;if(L.indices=K,L.xa=k,L.ya=C,L.Aa=e,S){const R=N===v.d.DOUBLESIDE?H.concat(H):H;L.za=R}return L}function Y(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;N.sideOrientation=u.b._GetDefaultSideOrientation(N.sideOrientation);const v=N.shape,G=N.holes||[],J=N.depth||0,y=N.smoothingThreshold||2,a=[];let j=[];for(let u=0;u<v.length;u++)a[u]=new w.j(v[u].x,v[u].z);a[0].equalsWithEpsilon(a[a.length-1],1e-8)&&a.pop();const F=new n(R,a,q||m.e.LastCreatedScene,M);for(let u=0;u<G.length;u++){j=[];for(let R=0;R<G[u].length;R++)j.push(new w.j(G[u][R].x,G[u][R].z));F.addHole(j)}const S=F.build(!1,J,y);S._originalBuilderSideOrientation=N.sideOrientation;return Q(S,N.sideOrientation,N.faceUV,N.faceColors,N.frontUVs,N.backUVs,N.wrap).Ca(S,N.updatable),S}function T(R,N){return Y(R,N,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function f(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=N.path,M=N.shape,v=N.scale||1,G=N.rotation||0,J=0===N.cap?0:N.cap||u.b.NO_CAP,y=N.updatable,a=u.b._GetDefaultSideOrientation(N.sideOrientation),j=N.instance||null,F=N.invertUV||!1,S=N.closeShape||!1;return b(R,M,w,v,G,null,null,N.closePath||!1,S,J,!1,q,!!y,a,j,F,N.frontUVs||null,N.backUVs||null,N.firstNormal||null,!!N.adjustFrame)}function c(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=N.path,M=N.shape,v=N.scaleFunction||(()=>1),G=N.rotationFunction||(()=>0),J=N.closePath||N.ribbonCloseArray||!1,y=N.closeShape||N.ribbonClosePath||!1,a=0===N.cap?0:N.cap||u.b.NO_CAP,j=N.updatable,F=N.firstNormal||null,S=N.adjustFrame||!1;return b(R,M,w,null,null,v,G,J,y,a,!0,q,!!j,u.b._GetDefaultSideOrientation(N.sideOrientation),N.instance||null,N.invertUV||!1,N.frontUVs||null,N.backUVs||null,F,S)}function b(R,N,q,M,v,G,J,a,j,F,S,H,W,k,C,e,K,r,Z,z){const d=(R,N,q,M,v,G,J,y,a,j,F)=>{const S=q.getTangents(),H=q.getNormals(),W=q.getBinormals(),k=q.getDistances();if(F)for(let u=0;u<S.length;u++)if(0==S[u].x&&0==S[u].y&&0==S[u].z&&S[u].p(S[u-1]),0==H[u].x&&0==H[u].y&&0==H[u].z&&H[u].p(H[u-1]),0==W[u].x&&0==W[u].y&&0==W[u].z&&W[u].p(W[u-1]),u>0){let R=S[u-1];w.m.Dot(R,S[u])<0&&S[u].scaleInPlace(-1),R=H[u-1],w.m.Dot(R,H[u])<0&&H[u].scaleInPlace(-1),R=W[u-1],w.m.Dot(R,W[u])<0&&W[u].scaleInPlace(-1)}let C=0;const e=j&&y?y:()=>null!==G?G:0,K=j&&J?J:()=>null!==v?v:1;let r=a===u.b.NO_CAP||a===u.b.CAP_END?0:2;const Z=w.f.Matrix[0];for(let u=0;u<N.length;u++){const q=[],v=e(u,k[u]),G=K(u,k[u]);w.c.RotationAxisToRef(S[u],C,Z);for(let M=0;M<R.length;M++){const v=S[u].scale(R[M].z).add(H[u].scale(R[M].x)).add(W[u].scale(R[M].y)),J=w.m.Zero();w.m.TransformCoordinatesToRef(v,Z,J),J.scaleInPlace(G).addInPlace(N[u]),q[M]=J}M[r]=q,C+=v,r++}const z=R=>{const N=Array(),q=w.m.Zero();let u;for(u=0;u<R.length;u++)q.addInPlace(R[u]);for(q.scaleInPlace(1/R.length),u=0;u<R.length;u++)N.push(q);return N};switch(a){case u.b.NO_CAP:break;case u.b.CAP_START:M[0]=z(M[2]),M[1]=M[2];break;case u.b.CAP_END:M[r]=M[r-1],M[r+1]=z(M[r-1]);break;case u.b.CAP_ALL:M[0]=z(M[2]),M[1]=M[2],M[r]=M[r-1],M[r+1]=z(M[r-1])}return M};let x,E;if(C){const R=C._creationDataStorage;return x=Z?R.path3D.update(q,Z):R.path3D.update(q),E=d(N,q,R.path3D,R.pathArray,M,v,G,J,R.cap,S,z),C=y("",{pathArray:E,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:C},H||void 0)}x=Z?new O.g(q,Z):new O.g(q);E=d(N,q,x,new Array,M,v,G,J,F=F<0||F>3?0:F,S,z);const P=y(R,{pathArray:E,closeArray:a,closePath:j,updatable:W,sideOrientation:k,invertUV:e,frontUVs:K||void 0,backUVs:r||void 0},H);return P._creationDataStorage.pathArray=E,P._creationDataStorage.path3D=x,P._creationDataStorage.cap=F,P}v.d.CreatePolygon=Q,u.b.CreatePolygon=function(R,N,q,w,u,M){return Y(R,{shape:N,holes:w,updatable:u,sideOrientation:M},q,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},u.b.ExtrudePolygon=function(R,N,q,w,u,M,v){return T(R,{shape:N,holes:u,depth:q,updatable:M,sideOrientation:v},w,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function I(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=N.arc?N.arc<=0||N.arc>1?1:N.arc:1,v=void 0===N.closed||N.closed,G=N.shape,J=N.i||1,a=N.Sk||64,j=N.clip||0,F=N.updatable,S=u.b._GetDefaultSideOrientation(N.sideOrientation),H=N.cap||u.b.NO_CAP,W=2*Math.PI,k=[],C=N.invertUV||!1;let e=0,K=0;const r=W/a*M;let Z,z;for(e=0;e<=a-j;e++){for(z=[],H!=u.b.CAP_START&&H!=u.b.CAP_ALL||(z.push(new w.m(0,G[0].y,0)),z.push(new w.m(Math.cos(e*r)*G[0].x*J,G[0].y,Math.sin(e*r)*G[0].x*J))),K=0;K<G.length;K++)Z=new w.m(Math.cos(e*r)*G[K].x*J,G[K].y,Math.sin(e*r)*G[K].x*J),z.push(Z);H!=u.b.CAP_END&&H!=u.b.CAP_ALL||(z.push(new w.m(Math.cos(e*r)*G[G.length-1].x*J,G[G.length-1].y,Math.sin(e*r)*G[G.length-1].x*J)),z.push(new w.m(0,G[G.length-1].y,0))),k.push(z)}return y(R,{pathArray:k,closeArray:v,sideOrientation:S,updatable:F,invertUV:C,frontUVs:N.frontUVs,backUVs:N.backUVs},q)}u.b.ExtrudeShape=function(R,N,q,w,M,v){let G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7?arguments[7]:void 0,y=arguments.length>8?arguments[8]:void 0,a=arguments.length>9?arguments[9]:void 0;return f(R,{shape:N,path:q,scale:w,rotation:M,cap:0===v?0:v||u.b.NO_CAP,sideOrientation:y,instance:a,updatable:J},G)},u.b.ExtrudeShapeCustom=(R,N,q,w,M,v,G,J,y,a,j,F)=>c(R,{shape:N,path:q,scaleFunction:w,rotationFunction:M,ribbonCloseArray:v,ribbonClosePath:G,cap:0===J?0:J||u.b.NO_CAP,sideOrientation:j,instance:F,updatable:a},y);u.b.CreateLathe=(R,N,q,w,u,M,v)=>I(R,{shape:N,i:q,Sk:w,sideOrientation:v,updatable:M},u);var V=q(11496),t=q(11437);function i(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=N.path;let v=N.instance,G=1;void 0!==N.i?G=N.i:v&&(G=v._creationDataStorage.i);const J=N.Sk||64,a=N.radiusFunction||null;let j=N.cap||u.b.NO_CAP;const F=N.invertUV||!1,S=N.updatable,H=u.b._GetDefaultSideOrientation(N.sideOrientation);N.arc=N.arc&&(N.arc<=0||N.arc>1)?1:N.arc||1;const W=(R,N,q,M,v,G,J,y)=>{const a=N.getTangents(),j=N.getNormals(),F=N.getDistances(),S=2*Math.PI/v*y,H=G||(()=>M);let W,k,C,e;const K=w.f.Matrix[0];let r=J===u.b.NO_CAP||J===u.b.CAP_END?0:2;for(let u=0;u<R.length;u++){k=H(u,F[u]),W=Array(),C=j[u];for(let N=0;N<v;N++)w.c.RotationAxisToRef(a[u],S*N,K),e=W[N]?W[N]:w.m.Zero(),w.m.TransformCoordinatesToRef(C,K,e),e.scaleInPlace(k).addInPlace(R[u]),W[N]=e;q[r]=W,r++}const Z=(N,q)=>{const w=Array();for(let u=0;u<N;u++)w.push(R[q]);return w};switch(J){case u.b.NO_CAP:break;case u.b.CAP_START:q[0]=Z(v,0),q[1]=q[2].slice(0);break;case u.b.CAP_END:q[r]=q[r-1].slice(0),q[r+1]=Z(v,R.length-1);break;case u.b.CAP_ALL:q[0]=Z(v,0),q[1]=q[2].slice(0),q[r]=q[r-1].slice(0),q[r+1]=Z(v,R.length-1)}return q};let k,C;if(v){const R=v._creationDataStorage,q=N.arc||R.arc;return k=R.path3D.update(M),C=W(M,k,R.pathArray,G,R.Sk,a,R.cap,q),v=y("",{pathArray:C,instance:v}),R.path3D=k,R.pathArray=C,R.arc=q,R.i=G,v}k=new O.g(M);j=j<0||j>3?0:j,C=W(M,k,new Array,G,J,a,j,N.arc);const e=y(R,{pathArray:C,closePath:!0,closeArray:!1,updatable:S,sideOrientation:H,invertUV:F,frontUVs:N.frontUVs,backUVs:N.backUVs},q);return e._creationDataStorage.pathArray=C,e._creationDataStorage.path3D=k,e._creationDataStorage.Sk=J,e._creationDataStorage.cap=j,e._creationDataStorage.arc=N.arc,e._creationDataStorage.i=G,e}function g(R){const N=[];N[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},N[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},N[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},N[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},N[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},N[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},N[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},N[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},N[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},N[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},N[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},N[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},N[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},N[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},N[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const q=R.type&&(R.type<0||R.type>=N.length)?0:R.type||0,u=R.size,M=R.sizeX||u||1,J=R.sizeY||u||1,y=R.sizeZ||u||1,a=R.custom||N[q],j=a.face.length,S=R.faceUV||new Array(j),H=R.faceColors,W=void 0===R.flat||R.flat,k=0===R.sideOrientation?0:R.sideOrientation||v.d.DEFAULTSIDE,C=[],e=[],K=[],r=[],Z=[];let z=0,d=0;const x=[];let E,P,s,O,L,m,o=0,A=0;if(W)for(A=0;A<j;A++)H&&void 0===H[A]&&(H[A]=new F.d(1,1,1,1)),S&&void 0===S[A]&&(S[A]=new w.n(0,0,1,1));if(W)for(A=0;A<j;A++){const R=a.face[A].length;for(s=2*Math.PI/R,O=.5*Math.tan(s/2),L=.5,o=0;o<R;o++)C.push(a.vertex[a.face[A][o]][0]*M,a.vertex[a.face[A][o]][1]*J,a.vertex[a.face[A][o]][2]*y),x.push(z),z++,E=S[A].x+(S[A].z-S[A].x)*(.5+O),P=S[A].y+(S[A].w-S[A].y)*(L-.5),r.push(E,G.e?1-P:P),m=O*Math.cos(s)-L*Math.sin(s),L=O*Math.sin(s)+L*Math.cos(s),O=m,H&&Z.push(H[A].r,H[A].g,H[A].b,H[A].a);for(o=0;o<R-2;o++)e.push(x[0+d],x[o+2+d],x[o+1+d]);d+=R}else{for(o=0;o<a.vertex.length;o++)C.push(a.vertex[o][0]*M,a.vertex[o][1]*J,a.vertex[o][2]*y),r.push(0,G.e?1:0);for(A=0;A<j;A++)for(o=0;o<a.face[A].length-2;o++)e.push(a.face[A][0],a.face[A][o+2],a.face[A][o+1])}v.d.ComputeNormals(C,e,K),v.d._ComputeSides(k,C,e,K,r,R.frontUVs,R.backUVs);const n=new v.d;return n.xa=C,n.indices=e,n.ya=K,n.Aa=r,H&&W&&(n.za=Z),n}function U(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new u.b(R,q);N.sideOrientation=u.b._GetDefaultSideOrientation(N.sideOrientation),w._originalBuilderSideOrientation=N.sideOrientation;return g(N).Ca(w,N.updatable),w}u.b.CreateTube=(R,N,q,w,u,M,v,G,J,y)=>i(R,{path:N,i:q,Sk:w,radiusFunction:u,arc:1,cap:M,updatable:G,sideOrientation:J,instance:y},v);function B(R){const N=R.sideOrientation||v.d.DEFAULTSIDE,q=R.i||1,u=void 0===R.flat||R.flat,M=0|(R.subdivisions||4),J=R.radiusX||q,y=R.radiusY||q,a=R.radiusZ||q,j=(1+Math.sqrt(5))/2,F=[-1,j,-0,1,j,0,-1,-j,0,1,-j,0,0,-1,-j,0,1,-j,0,-1,j,0,1,j,j,0,1,j,0,-1,-j,0,1,-j,0,-1],S=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],H=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],W=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],k=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],C=[],e=[],K=[],r=[];let Z=0;const z=new Array(3),d=new Array(3);let x;for(x=0;x<3;x++)z[x]=w.m.Zero(),d[x]=w.j.Zero();for(let v=0;v<20;v++){for(x=0;x<3;x++){const R=S[3*v+x];z[x].Rd(F[3*H[R]],F[3*H[R]+1],F[3*H[R]+2]),z[x].normalize(),d[x].Rd(.134765625*W[2*R]+.05859375+-.0390625*k[v],.2333984375*W[2*R+1]+.025390625+.01953125*k[v])}const R=(R,N,q,v)=>{const j=w.m.Lerp(z[0],z[2],N/M),F=w.m.Lerp(z[1],z[2],N/M),S=M===N?z[2]:w.m.Lerp(j,F,R/(M-N));let H;if(S.normalize(),u){const R=w.m.Lerp(z[0],z[2],v/M),N=w.m.Lerp(z[1],z[2],v/M);H=w.m.Lerp(R,N,q/(M-v))}else H=new w.m(S.x,S.y,S.z);H.x/=J,H.y/=y,H.z/=a,H.normalize();const W=w.j.Lerp(d[0],d[2],N/M),k=w.j.Lerp(d[1],d[2],N/M),x=M===N?d[2]:w.j.Lerp(W,k,R/(M-N));e.push(S.x*J,S.y*y,S.z*a),K.push(H.x,H.y,H.z),r.push(x.x,G.e?1-x.y:x.y),C.push(Z),Z++};for(let N=0;N<M;N++)for(let q=0;q+N<M;q++)R(q,N,q+1/3,N+1/3),R(q+1,N,q+1/3,N+1/3),R(q,N+1,q+1/3,N+1/3),q+N+1<M&&(R(q+1,N,q+2/3,N+2/3),R(q+1,N+1,q+2/3,N+2/3),R(q,N+1,q+2/3,N+2/3))}v.d._ComputeSides(N,e,C,K,r,R.frontUVs,R.backUVs);const E=new v.d;return E.indices=C,E.xa=e,E.ya=K,E.Aa=r,E}function l(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new u.b(R,q);N.sideOrientation=u.b._GetDefaultSideOrientation(N.sideOrientation),w._originalBuilderSideOrientation=N.sideOrientation;return B(N).Ca(w,N.updatable),w}v.d.CreatePolyhedron=g,u.b.CreatePolyhedron=(R,N,q)=>U(R,N,q);v.d.CreateIcoSphere=B,u.b.CreateIcoSphere=(R,N,q)=>l(R,N,q);var X=q(1001);const h=new w.m(1,0,0),D=new w.m(-1,0,0),p=new w.m(0,1,0),RR=new w.m(0,-1,0),NR=new w.m(0,0,1),qR=new w.m(0,0,-1);class wR{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.m.Zero(),N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.m.Up(),q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.j.Zero(),u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=R,this.ke=N,this.uv=q,this.vertexIdx=u,this.vertexIdxForBones=M,this.localPositionOverride=v,this.localNormalOverride=G,this.matrixIndicesOverride=J,this.matrixWeightsOverride=y}clone(){var R,N,q,w;return new wR(this.position.clone(),this.ke.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(R=this.localPositionOverride)||void 0===R?void 0:R.slice(),null===(N=this.localNormalOverride)||void 0===N?void 0:N.slice(),null===(q=this.matrixIndicesOverride)||void 0===q?void 0:q.slice(),null===(w=this.matrixWeightsOverride)||void 0===w?void 0:w.slice())}}function uR(R,N,q){var J,y,a,j;const F=!!N.skeleton,S=q.localMode||F,H=N.Md(),W=F?N.Sf(!0,!0):N.getVerticesData(M.e.PositionKind),k=F?N.getNormalsData(!0,!0):N.getVerticesData(M.e.NormalKind),C=S?F?N.getVerticesData(M.e.PositionKind):W:null,e=S?F?N.getVerticesData(M.e.NormalKind):k:null,K=N.getVerticesData(M.e.UVKind),r=F?N.getVerticesData(M.e.MatricesIndicesKind):null,Z=F?N.getVerticesData(M.e.MatricesWeightsKind):null,z=F?N.getVerticesData(M.e.MatricesIndicesExtraKind):null,d=F?N.getVerticesData(M.e.MatricesWeightsExtraKind):null,x=q.position||w.m.Zero();let E=q.ke||w.m.Up();const P=q.size||w.m.One(),s=q.angle||0;if(!E){const R=new w.m(0,0,1),q=N.va().activeCamera,u=w.m.TransformCoordinates(R,q.getWorldMatrix());E=q.globalPosition.Vc(u)}const O=-Math.atan2(E.z,E.x)-Math.PI/2,L=Math.sqrt(E.x*E.x+E.z*E.z),m=Math.atan2(E.y,L),o=new v.d;o.indices=[],o.xa=[],o.ya=[],o.Aa=[],o.matricesIndices=F?[]:null,o.matricesWeights=F?[]:null,o.matricesIndicesExtra=z?[]:null,o.matricesWeightsExtra=d?[]:null;let A=0;const n=(R,N)=>{const u=new wR;if(!H||!W||!k)return u;const M=H[R];if(u.vertexIdx=3*M,u.vertexIdxForBones=4*M,u.position=new w.m(W[3*M],W[3*M+1],W[3*M+2]),w.m.TransformCoordinatesToRef(u.position,N,u.position),u.ke=new w.m(k[3*M],k[3*M+1],k[3*M+2]),w.m.TransformNormalToRef(u.ke,N,u.ke),q.captureUVS&&K){const R=K[2*M+1];u.uv=new w.j(K[2*M],G.e?1-R:R)}return u},Q=[0,0,0,0],Y=(R,N)=>{if(0===R.length)return R;const q=.5*Math.abs(w.m.Dot(P,N)),u=(R,N,q,w)=>{for(let u=0;u<w;++u)if(R[q+u]===N)return q+u;return-1},M=(R,M)=>{const v=w.m.GetClipFactor(R.position,M.position,N,q);let G=Q,J=Q;if(r&&Z){const N=R.matrixIndicesOverride?0:R.vertexIdxForBones,q=R.matrixIndicesOverride??r,w=R.matrixWeightsOverride??Z,y=M.matrixIndicesOverride?0:M.vertexIdxForBones,a=M.matrixIndicesOverride??r,j=M.matrixWeightsOverride??Z;G=[0,0,0,0],J=[0,0,0,0];let F=0;for(let R=0;R<4;++R)if(w[N+R]>0){const M=u(a,q[N+R],y,4);G[F]=q[N+R],J[F]=(0,X.o)(w[N+R],M>=0?j[M]:0,v),F++}for(let R=0;R<4&&F<4;++R){const w=a[y+R];-1===u(q,w,N,4)&&(G[F]=w,J[F]=(0,X.o)(0,j[y+R],v),F++)}const S=J[0]+J[1]+J[2]+J[3];J[0]/=S,J[1]/=S,J[2]/=S,J[3]/=S}const y=R.localPositionOverride?R.localPositionOverride[0]:(null===C||void 0===C?void 0:C[R.vertexIdx])??0,a=R.localPositionOverride?R.localPositionOverride[1]:(null===C||void 0===C?void 0:C[R.vertexIdx+1])??0,j=R.localPositionOverride?R.localPositionOverride[2]:(null===C||void 0===C?void 0:C[R.vertexIdx+2])??0,F=M.localPositionOverride?M.localPositionOverride[0]:(null===C||void 0===C?void 0:C[M.vertexIdx])??0,S=M.localPositionOverride?M.localPositionOverride[1]:(null===C||void 0===C?void 0:C[M.vertexIdx+1])??0,H=M.localPositionOverride?M.localPositionOverride[2]:(null===C||void 0===C?void 0:C[M.vertexIdx+2])??0,W=R.localNormalOverride?R.localNormalOverride[0]:(null===e||void 0===e?void 0:e[R.vertexIdx])??0,k=R.localNormalOverride?R.localNormalOverride[1]:(null===e||void 0===e?void 0:e[R.vertexIdx+1])??0,K=R.localNormalOverride?R.localNormalOverride[2]:(null===e||void 0===e?void 0:e[R.vertexIdx+2])??0,z=W+((M.localNormalOverride?M.localNormalOverride[0]:(null===e||void 0===e?void 0:e[M.vertexIdx])??0)-W)*v,d=k+((M.localNormalOverride?M.localNormalOverride[1]:(null===e||void 0===e?void 0:e[M.vertexIdx+1])??0)-k)*v,x=K+((M.localNormalOverride?M.localNormalOverride[2]:(null===e||void 0===e?void 0:e[M.vertexIdx+2])??0)-K)*v,E=Math.sqrt(z*z+d*d+x*x);return new wR(w.m.Lerp(R.position,M.position,v),w.m.Lerp(R.ke,M.ke,v).normalize(),w.j.Lerp(R.uv,M.uv,v),-1,-1,C?[y+(F-y)*v,a+(S-a)*v,j+(H-j)*v]:null,e?[z/E,d/E,x/E]:null,G,J)};let v=null;R.length>3&&(v=[]);for(let G=0;G<R.length;G+=3){let u=0,J=null,y=null,a=null,j=null;const F=w.m.Dot(R[G].position,N)-q>0,S=w.m.Dot(R[G+1].position,N)-q>0,H=w.m.Dot(R[G+2].position,N)-q>0;switch(u=(F?1:0)+(S?1:0)+(H?1:0),u){case 0:R.length>3?(v.push(R[G]),v.push(R[G+1]),v.push(R[G+2])):v=R;break;case 1:if(v=v??new Array,F&&(J=R[G+1],y=R[G+2],a=M(R[G],J),j=M(R[G],y)),S){J=R[G],y=R[G+2],a=M(R[G+1],J),j=M(R[G+1],y),v.push(a),v.push(y.clone()),v.push(J.clone()),v.push(y.clone()),v.push(a.clone()),v.push(j);break}H&&(J=R[G],y=R[G+1],a=M(R[G+2],J),j=M(R[G+2],y)),J&&y&&a&&j&&(v.push(J.clone()),v.push(y.clone()),v.push(a),v.push(j),v.push(a.clone()),v.push(y.clone()));break;case 2:v=v??new Array,F||(J=R[G].clone(),y=M(J,R[G+1]),a=M(J,R[G+2]),v.push(J),v.push(y),v.push(a)),S||(J=R[G+1].clone(),y=M(J,R[G+2]),a=M(J,R[G]),v.push(J),v.push(y),v.push(a)),H||(J=R[G+2].clone(),y=M(J,R[G]),a=M(J,R[G+1]),v.push(J),v.push(y),v.push(a))}}return v},T=N instanceof u.b?N:null,f=null===T||void 0===T?void 0:T._thinInstanceDataStorage.matrixData,c=(null===T||void 0===T?void 0:T.Mj)||1,b=w.f.Matrix[0];b.p(w.c.IdentityReadOnly);for(let u=0;u<c;++u){if(null!==T&&void 0!==T&&T.hasThinInstances&&f){const R=16*u;b.setRowFromFloats(0,f[R+0],f[R+1],f[R+2],f[R+3]),b.setRowFromFloats(1,f[R+4],f[R+5],f[R+6],f[R+7]),b.setRowFromFloats(2,f[R+8],f[R+9],f[R+10],f[R+11]),b.setRowFromFloats(3,f[R+12],f[R+13],f[R+14],f[R+15])}const R=w.c.RotationYawPitchRoll(O,m,s).multiply(w.c.Translation(x.x,x.y,x.z)),M=w.c.Invert(R),v=N.getWorldMatrix(),J=b.multiply(v).multiply(M),y=new Array(3);for(let N=0;N<H.length;N+=3){let R=y;if(R[0]=n(N,J),R[1]=n(N+1,J),R[2]=n(N+2,J),!(q.cullBackFaces&&-R[0].ke.z<=0&&-R[1].ke.z<=0&&-R[2].ke.z<=0)&&(R=Y(R,h),R&&(R=Y(R,D),R&&(R=Y(R,p),R&&(R=Y(R,RR),R&&(R=Y(R,NR),R&&(R=Y(R,qR),R)))))))for(let N=0;N<R.length;N++){const w=R[N];if(o.indices.push(A),S?(w.localPositionOverride?(o.xa[3*A]=w.localPositionOverride[0],o.xa[3*A+1]=w.localPositionOverride[1],o.xa[3*A+2]=w.localPositionOverride[2]):C&&(o.xa[3*A]=C[w.vertexIdx],o.xa[3*A+1]=C[w.vertexIdx+1],o.xa[3*A+2]=C[w.vertexIdx+2]),w.localNormalOverride?(o.ya[3*A]=w.localNormalOverride[0],o.ya[3*A+1]=w.localNormalOverride[1],o.ya[3*A+2]=w.localNormalOverride[2]):e&&(o.ya[3*A]=e[w.vertexIdx],o.ya[3*A+1]=e[w.vertexIdx+1],o.ya[3*A+2]=e[w.vertexIdx+2])):(w.position.toArray(o.xa,3*A),w.ke.toArray(o.ya,3*A)),o.matricesIndices&&o.matricesWeights&&(w.matrixIndicesOverride?(o.matricesIndices[4*A]=w.matrixIndicesOverride[0],o.matricesIndices[4*A+1]=w.matrixIndicesOverride[1],o.matricesIndices[4*A+2]=w.matrixIndicesOverride[2],o.matricesIndices[4*A+3]=w.matrixIndicesOverride[3]):(r&&(o.matricesIndices[4*A]=r[w.vertexIdxForBones],o.matricesIndices[4*A+1]=r[w.vertexIdxForBones+1],o.matricesIndices[4*A+2]=r[w.vertexIdxForBones+2],o.matricesIndices[4*A+3]=r[w.vertexIdxForBones+3]),z&&o.matricesIndicesExtra&&(o.matricesIndicesExtra[4*A]=z[w.vertexIdxForBones],o.matricesIndicesExtra[4*A+1]=z[w.vertexIdxForBones+1],o.matricesIndicesExtra[4*A+2]=z[w.vertexIdxForBones+2],o.matricesIndicesExtra[4*A+3]=z[w.vertexIdxForBones+3])),w.matrixWeightsOverride?(o.matricesWeights[4*A]=w.matrixWeightsOverride[0],o.matricesWeights[4*A+1]=w.matrixWeightsOverride[1],o.matricesWeights[4*A+2]=w.matrixWeightsOverride[2],o.matricesWeights[4*A+3]=w.matrixWeightsOverride[3]):(Z&&(o.matricesWeights[4*A]=Z[w.vertexIdxForBones],o.matricesWeights[4*A+1]=Z[w.vertexIdxForBones+1],o.matricesWeights[4*A+2]=Z[w.vertexIdxForBones+2],o.matricesWeights[4*A+3]=Z[w.vertexIdxForBones+3]),d&&o.matricesWeightsExtra&&(o.matricesWeightsExtra[4*A]=d[w.vertexIdxForBones],o.matricesWeightsExtra[4*A+1]=d[w.vertexIdxForBones+1],o.matricesWeightsExtra[4*A+2]=d[w.vertexIdxForBones+2],o.matricesWeightsExtra[4*A+3]=d[w.vertexIdxForBones+3]))),q.captureUVS)w.uv.toArray(o.Aa,2*A);else{o.Aa.push(.5+w.position.x/P.x);const R=.5+w.position.y/P.y;o.Aa.push(G.e?1-R:R)}A++}}}0===o.indices.length&&(o.indices=null),0===o.xa.length&&(o.xa=null),0===o.ya.length&&(o.ya=null),0===o.Aa.length&&(o.Aa=null),0===(null===(J=o.matricesIndices)||void 0===J?void 0:J.length)&&(o.matricesIndices=null),0===(null===(y=o.matricesWeights)||void 0===y?void 0:y.length)&&(o.matricesWeights=null),0===(null===(a=o.matricesIndicesExtra)||void 0===a?void 0:a.length)&&(o.matricesIndicesExtra=null),0===(null===(j=o.matricesWeightsExtra)||void 0===j?void 0:j.length)&&(o.matricesWeightsExtra=null);const I=new u.b(R,N.va());return o.Ca(I),S?(I.skeleton=N.skeleton,I.parent=N):(I.position=x.clone(),I.rotation=new w.m(m,O,s)),I.je(!0),I.refreshBoundingInfo(!0,!0),I}function MR(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,Sk:16,height:1,i:.25,capSubdivisions:6};const N=0|Math.max(R.subdivisions?R.subdivisions:2,1),q=0|Math.max(R.Sk?R.Sk:16,3),u=Math.max(R.height?R.height:1,0),M=Math.max(R.i?R.i:.25,0),J=0|Math.max(R.capSubdivisions?R.capSubdivisions:6,1),y=q,a=N,j=Math.max(R.radiusTop?R.radiusTop:M,0),F=Math.max(R.radiusBottom?R.radiusBottom:M,0),S=u-(j+F),H=2*Math.PI,W=Math.max(R.topCapSubdivisions?R.topCapSubdivisions:J,1),k=Math.max(R.bottomCapSubdivisions?R.bottomCapSubdivisions:J,1),C=Math.acos((F-j)/u);let e=[];const K=[],r=[],Z=[];let z=0;const d=[],x=.5*S,E=.5*Math.PI;let P,s;const O=w.m.Zero(),L=w.m.Zero(),m=Math.cos(C),o=Math.sin(C),A=new w.j(j*o,x+j*m).Vc(new w.j(F*o,F*m-x)).length(),n=j*C+A+F*(E-C);let Q=0;for(s=0;s<=W;s++){const R=[],N=E-C*(s/W);Q+=j*C/W;const q=Math.cos(N),w=Math.sin(N),u=q*j;for(P=0;P<=y;P++){const N=P/y,M=N*H+0,v=Math.sin(M),J=Math.cos(M);L.x=u*v,L.y=x+w*j,L.z=u*J,K.push(L.x,L.y,L.z),O.set(q*v,w,q*J),r.push(O.x,O.y,O.z),Z.push(N,G.e?Q/n:1-Q/n),R.push(z),z++}d.push(R)}const Y=u-j-F+m*j-m*F,T=o*(F-j)/Y;for(s=1;s<=a;s++){const R=[];Q+=A/a;const N=o*(s*(F-j)/a+j);for(P=0;P<=y;P++){const q=P/y,w=q*H+0,u=Math.sin(w),M=Math.cos(w);L.x=N*u,L.y=x+m*j-s*Y/a,L.z=N*M,K.push(L.x,L.y,L.z),O.set(u,T,M).normalize(),r.push(O.x,O.y,O.z),Z.push(q,G.e?Q/n:1-Q/n),R.push(z),z++}d.push(R)}for(s=1;s<=k;s++){const R=[],N=E-C-(Math.PI-C)*(s/k);Q+=F*C/k;const q=Math.cos(N),w=Math.sin(N),u=q*F;for(P=0;P<=y;P++){const N=P/y,M=N*H+0,v=Math.sin(M),J=Math.cos(M);L.x=u*v,L.y=w*F-x,L.z=u*J,K.push(L.x,L.y,L.z),O.set(q*v,w,q*J),r.push(O.x,O.y,O.z),Z.push(N,G.e?Q/n:1-Q/n),R.push(z),z++}d.push(R)}for(P=0;P<y;P++)for(s=0;s<W+a+k;s++){const R=d[s][P],N=d[s+1][P],q=d[s+1][P+1],w=d[s][P+1];e.push(R),e.push(N),e.push(w),e.push(N),e.push(q),e.push(w)}if(e=e.reverse(),R.orientation&&!R.orientation.equals(w.m.Up())){const N=new w.c;R.orientation.clone().scale(.5*Math.PI).cross(w.m.Up()).toQuaternion().toRotationMatrix(N);const q=w.m.Zero();for(let R=0;R<K.length;R+=3)q.set(K[R],K[R+1],K[R+2]),w.m.TransformCoordinatesToRef(q.clone(),N,q),K[R]=q.x,K[R+1]=q.y,K[R+2]=q.z}const f=new v.d;return f.xa=K,f.ya=r,f.Aa=Z,f.indices=e,f}function vR(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:w.m.Up(),subdivisions:2,Sk:16,height:1,i:.25,capSubdivisions:6,updatable:!1},q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new u.b(R,q);return MR(N).Ca(M,N.updatable),M}u.b.CreateDecal=(R,N,q,w,u,M)=>uR(R,N,{position:q,ke:w,size:u,angle:M});u.b.CreateCapsule=(R,N,q)=>vR(R,N,q),v.d.CreateCapsule=MR;class GR{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=R,this.y=N,R!==Math.floor(R)&&(R=Math.floor(R),s.e.Warn("x is not an integer, floor(x) used")),N!==Math.floor(N)&&(N=Math.floor(N),s.e.Warn("y is not an integer, floor(y) used"))}clone(){return new GR(this.x,this.y)}rotate60About(R){const N=this.x;return this.x=R.x+R.y-this.y,this.y=N+this.y-R.x,this}rotateNeg60About(R){const N=this.x;return this.x=N+this.y-R.y,this.y=R.x+R.y-N,this}rotate120(R,N){R!==Math.floor(R)&&(R=Math.floor(R),s.e.Warn("m not an integer only floor(m) used")),N!==Math.floor(N)&&(N=Math.floor(N),s.e.Warn("n not an integer only floor(n) used"));const q=this.x;return this.x=R-q-this.y,this.y=N+q,this}rotateNeg120(R,N){R!==Math.floor(R)&&(R=Math.floor(R),s.e.Warn("m is not an integer, floor(m) used")),N!==Math.floor(N)&&(N=Math.floor(N),s.e.Warn("n is not an integer,   floor(n) used"));const q=this.x;return this.x=this.y-N,this.y=R+N-q-this.y,this}toCartesianOrigin(R,N){const q=w.m.Zero();return q.x=R.x+2*this.x*N+this.y*N,q.y=R.y+Math.sqrt(3)*this.y*N,q}static Zero(){return new GR(0,0)}}class JR{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new yR("icosahedron","Regular",[[0,L.e,-1],[-L.e,1,0],[-1,0,-L.e],[1,0,-L.e],[L.e,1,0],[0,L.e,1],[-1,0,L.e],[-L.e,-1,0],[0,-L.e,-1],[L.e,-1,0],[1,0,L.e],[0,-L.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let R=12;const N={},q=this.m,w=this.n;let u,M,v,G,J,y=q,a=1,j=0;0!==w&&(y=(0,X.h)(q,w)),a=q/y,j=w/y;const F=GR.Zero(),S=new GR(q,w),H=new GR(-w,q+w),W=GR.Zero(),k=GR.Zero(),C=GR.Zero();let e,K,r,Z,z=[];const d=[],x=this.vertByDist,E=(q,w,u,M)=>{e=q+"|"+u,K=w+"|"+M,e in N||K in N?e in N&&!(K in N)?N[K]=N[e]:K in N&&!(e in N)&&(N[e]=N[K]):(N[e]=R,N[K]=R,R++),x[u][0]>2?d[N[e]]=[-x[u][0],x[u][1],N[e]]:d[N[e]]=[z[x[u][0]],x[u][1],N[e]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let P=0;P<20;P++){if(z=this.IDATA.face[P],v=z[2],G=z[1],J=z[0],r=F.x+"|"+F.y,e=P+"|"+r,e in N||(N[e]=v,d[v]=[z[x[r][0]],x[r][1]]),r=S.x+"|"+S.y,e=P+"|"+r,e in N||(N[e]=G,d[G]=[z[x[r][0]],x[r][1]]),r=H.x+"|"+H.y,e=P+"|"+r,e in N||(N[e]=J,d[J]=[z[x[r][0]],x[r][1]]),u=this.IDATA.edgematch[P][0],M=this.IDATA.edgematch[P][1],"B"===M)for(let R=1;R<y;R++)k.x=q-R*(a+j),k.y=w+R*a,C.x=-R*j,C.y=R*(a+j),r=k.x+"|"+k.y,Z=C.x+"|"+C.y,E(P,u,r,Z);if("O"===M)for(let R=1;R<y;R++)C.x=-R*j,C.y=R*(a+j),W.x=R*a,W.y=R*j,r=C.x+"|"+C.y,Z=W.x+"|"+W.y,E(P,u,r,Z);if(u=this.IDATA.edgematch[P][2],M=this.IDATA.edgematch[P][3],M&&"A"===M)for(let R=1;R<y;R++)W.x=R*a,W.y=R*j,k.x=q-(y-R)*(a+j),k.y=w+(y-R)*a,r=W.x+"|"+W.y,Z=k.x+"|"+k.y,E(P,u,r,Z);for(let q=0;q<this.vertices.length;q++)r=this.vertices[q].x+"|"+this.vertices[q].y,e=P+"|"+r,e in N||(N[e]=R++,x[r][0]>2?d[N[e]]=[-x[r][0],x[r][1],N[e]]:d[N[e]]=[z[x[r][0]],x[r][1],N[e]])}this.closestTo=d,this.vecToidx=N}calcCoeffs(){const R=this.m,N=this.n,q=Math.sqrt(3)/3,w=R*R+N*N+R*N;this.coau=(R+N)/w,this.cobu=-N/w,this.coav=-q*(R-N)/w,this.cobv=q*(2*R+N)/w}createInnerFacets(){const R=this.m,N=this.n;for(let q=0;q<N+R+1;q++)for(let R=this.min[q];R<this.max[q]+1;R++)R<this.max[q]&&R<this.max[q+1]+1&&this.innerFacets.push(["|"+R+"|"+q,"|"+R+"|"+(q+1),"|"+(R+1)+"|"+q]),q>0&&R<this.max[q-1]&&R+1<this.max[q]+1&&this.innerFacets.push(["|"+R+"|"+q,"|"+(R+1)+"|"+q,"|"+(R+1)+"|"+(q-1)])}edgeVecsABOB(){const R=this.m,N=this.n,q=new GR(-N,R+N);for(let w=1;w<R+N;w++){const R=new GR(this.min[w],w),N=new GR(this.min[w-1],w-1),u=new GR(this.min[w+1],w+1),M=R.clone(),v=N.clone(),G=u.clone();M.rotate60About(q),v.rotate60About(q),G.rotate60About(q);const J=new GR(this.max[M.y],M.y),y=new GR(this.max[M.y-1],M.y-1),a=new GR(this.max[M.y-1]-1,M.y-1);M.x===J.x&&M.y===J.y||(M.x!==y.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([R,y,a]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([R,a,J])):M.y===G.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([R,N,y]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([R,y,u])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([R,N,y]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([R,y,J])))}}mapABOBtoOBOA(){const R=new GR(0,0);for(let N=0;N<this.isoVecsABOB.length;N++){const q=[];for(let w=0;w<3;w++)R.x=this.isoVecsABOB[N][w].x,R.y=this.isoVecsABOB[N][w].y,0===this.vertexTypes[N][w]&&R.rotateNeg120(this.m,this.n),q.push(R.clone());this.isoVecsOBOA.push(q)}}mapABOBtoBAOA(){const R=new GR(0,0);for(let N=0;N<this.isoVecsABOB.length;N++){const q=[];for(let w=0;w<3;w++)R.x=this.isoVecsABOB[N][w].x,R.y=this.isoVecsABOB[N][w].y,1===this.vertexTypes[N][w]&&R.rotate120(this.m,this.n),q.push(R.clone());this.isoVecsBAOA.push(q)}}MapToFace(R,N){const q=this.IDATA.face[R],u=q[2],M=q[1],v=q[0],G=w.m.Sd(this.IDATA.vertex[u]),J=w.m.Sd(this.IDATA.vertex[M]),y=w.m.Sd(this.IDATA.vertex[v]),a=J.Vc(G),j=y.Vc(G),F=a.scale(this.coau).add(j.scale(this.cobu)),S=a.scale(this.coav).add(j.scale(this.cobv)),H=[];let W,k=w.f.Od[0];for(let w=0;w<this.cartesian.length;w++)k=F.scale(this.cartesian[w].x).add(S.scale(this.cartesian[w].y)).add(G),H[w]=[k.x,k.y,k.z],W=R+"|"+this.vertices[w].x+"|"+this.vertices[w].y,N.vertex[this.vecToidx[W]]=[k.x,k.y,k.z]}build(R,N){const q=[],w=GR.Zero(),u=new GR(R,N),M=new GR(-N,R+N);q.push(w,u,M);for(let r=N;r<R+1;r++)for(let N=0;N<R+1-r;N++)q.push(new GR(N,r));if(N>0){const w=(0,X.h)(R,N),u=R/w,M=N/w;for(let G=1;G<w;G++)q.push(new GR(G*u,G*M)),q.push(new GR(-G*M,G*(u+M))),q.push(new GR(R-G*(u+M),N+G*u));const v=R/N;for(let G=1;G<N;G++)for(let w=0;w<G*v;w++)q.push(new GR(w,G)),q.push(new GR(w,G).rotate120(R,N)),q.push(new GR(w,G).rotateNeg120(R,N))}q.sort(((R,N)=>R.x-N.x)),q.sort(((R,N)=>R.y-N.y));const v=new Array(R+N+1),G=new Array(R+N+1);for(let r=0;r<v.length;r++)v[r]=1/0,G[r]=-1/0;let J=0,y=0;const a=q.length;for(let r=0;r<a;r++)y=q[r].x,J=q[r].y,v[J]=Math.min(y,v[J]),G[J]=Math.max(y,G[J]);const j=(q,w)=>{const u=q.clone();return"A"===w&&u.rotateNeg120(R,N),"B"===w&&u.rotate120(R,N),u.x<0?u.y:u.x+u.y},F=[],S=[],H=[],W=[],k={},C=[];let e=-1,K=-1;for(let r=0;r<a;r++)F[r]=q[r].toCartesianOrigin(new GR(0,0),.5),S[r]=j(q[r],"O"),H[r]=j(q[r],"A"),W[r]=j(q[r],"B"),S[r]===H[r]&&H[r]===W[r]?(e=3,K=S[r]):S[r]===H[r]?(e=4,K=S[r]):H[r]===W[r]?(e=5,K=H[r]):W[r]===S[r]&&(e=6,K=S[r]),S[r]<H[r]&&S[r]<W[r]&&(e=2,K=S[r]),H[r]<S[r]&&H[r]<W[r]&&(e=1,K=H[r]),W[r]<H[r]&&W[r]<S[r]&&(e=0,K=W[r]),C.push([e,K,q[r].x,q[r].y]);C.sort(((R,N)=>R[2]-N[2])),C.sort(((R,N)=>R[3]-N[3])),C.sort(((R,N)=>R[1]-N[1])),C.sort(((R,N)=>R[0]-N[0]));for(let r=0;r<C.length;r++)k[C[r][2]+"|"+C[r][3]]=[C[r][0],C[r][1],r];return this.m=R,this.n=N,this.vertices=q,this.vertByDist=k,this.cartesian=F,this.min=v,this.max=G,this}}class yR{constructor(R,N,q,w){this.name=R,this.category=N,this.vertex=q,this.face=w}}class aR extends yR{innerToData(R,N){for(let q=0;q<N.innerFacets.length;q++)this.face.push(N.innerFacets[q].map((q=>N.vecToidx[R+q])))}mapABOBtoDATA(R,N){const q=N.IDATA.edgematch[R][0];for(let w=0;w<N.isoVecsABOB.length;w++){const u=[];for(let M=0;M<3;M++)0===N.vertexTypes[w][M]?u.push(R+"|"+N.isoVecsABOB[w][M].x+"|"+N.isoVecsABOB[w][M].y):u.push(q+"|"+N.isoVecsABOB[w][M].x+"|"+N.isoVecsABOB[w][M].y);this.face.push([N.vecToidx[u[0]],N.vecToidx[u[1]],N.vecToidx[u[2]]])}}mapOBOAtoDATA(R,N){const q=N.IDATA.edgematch[R][0];for(let w=0;w<N.isoVecsOBOA.length;w++){const u=[];for(let M=0;M<3;M++)1===N.vertexTypes[w][M]?u.push(R+"|"+N.isoVecsOBOA[w][M].x+"|"+N.isoVecsOBOA[w][M].y):u.push(q+"|"+N.isoVecsOBOA[w][M].x+"|"+N.isoVecsOBOA[w][M].y);this.face.push([N.vecToidx[u[0]],N.vecToidx[u[1]],N.vecToidx[u[2]]])}}mapBAOAtoDATA(R,N){const q=N.IDATA.edgematch[R][2];for(let w=0;w<N.isoVecsBAOA.length;w++){const u=[];for(let M=0;M<3;M++)1===N.vertexTypes[w][M]?u.push(R+"|"+N.isoVecsBAOA[w][M].x+"|"+N.isoVecsBAOA[w][M].y):u.push(q+"|"+N.isoVecsBAOA[w][M].x+"|"+N.isoVecsBAOA[w][M].y);this.face.push([N.vecToidx[u[0]],N.vecToidx[u[1]],N.vecToidx[u[2]]])}}orderData(R){const N=[];for(let M=0;M<13;M++)N[M]=[];const q=R.closestTo;for(let M=0;M<q.length;M++)q[M][0]>-1?q[M][1]>0&&N[q[M][0]].push([M,q[M][1]]):N[12].push([M,q[M][0]]);const w=[];for(let M=0;M<12;M++)w[M]=M;let u=12;for(let M=0;M<12;M++){N[M].sort(((R,N)=>R[1]-N[1]));for(let R=0;R<N[M].length;R++)w[N[M][R][0]]=u++}for(let M=0;M<N[12].length;M++)w[N[12][M][0]]=u++;for(let M=0;M<this.vertex.length;M++)this.vertex[M].push(w[M]);this.vertex.sort(((R,N)=>R[3]-N[3]));for(let M=0;M<this.vertex.length;M++)this.vertex[M].pop();for(let M=0;M<this.face.length;M++)for(let R=0;R<this.face[M].length;R++)this.face[M][R]=w[this.face[M][R]];this.sharedNodes=N[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(R,N){const q=[],w=[];let u=N.pop();w.push(u);let M=this.face[u].indexOf(R);M=(M+2)%3;let v=this.face[u][M];q.push(v);let G=0;for(;N.length>0;)u=N[G],this.face[u].indexOf(v)>-1?(M=(this.face[u].indexOf(v)+1)%3,v=this.face[u][M],q.push(v),w.push(u),N.splice(G,1),G=0):G++;return this.adjacentFaces.push(q),w}toGoldbergPolyhedronData(){const R=new yR("GeoDual","Goldberg",[],[]);R.name="GD dual";const N=this.vertex.length,q=new Array(N);for(let J=0;J<N;J++)q[J]=[];for(let J=0;J<this.face.length;J++)for(let R=0;R<3;R++)q[this.face[J][R]].push(J);let w=0,u=0,M=0,v=[],G=[];this.adjacentFaces=[];for(let J=0;J<q.length;J++)R.face[J]=this.setOrder(J,q[J].concat([])),q[J].forEach((N=>{w=0,u=0,M=0,v=this.face[N];for(let R=0;R<3;R++)G=this.vertex[v[R]],w+=G[0],u+=G[1],M+=G[2];R.vertex[N]=[w/3,u/3,M/3]}));return R}static BuildGeodesicData(R){const N=new aR("Geodesic-m-n","Geodesic",[[0,L.e,-1],[-L.e,1,0],[-1,0,-L.e],[1,0,-L.e],[L.e,1,0],[0,L.e,1],[-1,0,L.e],[-L.e,-1,0],[0,-L.e,-1],[L.e,-1,0],[1,0,L.e],[0,-L.e,1]],[]);R.setIndices(),R.calcCoeffs(),R.createInnerFacets(),R.edgeVecsABOB(),R.mapABOBtoOBOA(),R.mapABOBtoBAOA();for(let q=0;q<R.IDATA.face.length;q++)R.MapToFace(q,N),N.innerToData(q,R),"B"===R.IDATA.edgematch[q][1]&&N.mapABOBtoDATA(q,R),"O"===R.IDATA.edgematch[q][1]&&N.mapOBOAtoDATA(q,R),"A"===R.IDATA.edgematch[q][3]&&N.mapBAOAtoDATA(q,R);N.orderData(R);return N.vertex=N.vertex.map((function(R){const N=R[0],q=R[1],w=R[2],u=Math.sqrt(N*N+q*q+w*w);return R[0]*=1/u,R[1]*=1/u,R[2]*=1/u,R})),N}}u.b._GoldbergMeshParser=(R,N)=>jR.Parse(R,N);class jR extends u.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(R,N){return void 0===N?(R>this.goldbergData.nbUnsharedFaces-1&&(s.e.Warn("Maximum number of unshared faces used"),R=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+R):(R>11&&(s.e.Warn("Last pole used"),R=11),N>this.goldbergData.nbFacesAtPole-1&&(s.e.Warn("Maximum number of faces at a pole used"),N=this.goldbergData.nbFacesAtPole-1),12+R*this.goldbergData.nbFacesAtPole+N)}_changeGoldbergFaceColors(R){for(let q=0;q<R.length;q++){const N=R[q][0],w=R[q][1],u=R[q][2];for(let R=N;R<w+1;R++)this.goldbergData.faceColors[R]=u}const N=[];for(let q=0;q<12;q++)for(let R=0;R<5;R++)N.push(this.goldbergData.faceColors[q].r,this.goldbergData.faceColors[q].g,this.goldbergData.faceColors[q].b,this.goldbergData.faceColors[q].a);for(let q=12;q<this.goldbergData.faceColors.length;q++)for(let R=0;R<6;R++)N.push(this.goldbergData.faceColors[q].r,this.goldbergData.faceColors[q].g,this.goldbergData.faceColors[q].b,this.goldbergData.faceColors[q].a);return N}setGoldbergFaceColors(R){const N=this._changeGoldbergFaceColors(R);this.Ga(M.e.ColorKind,N)}updateGoldbergFaceColors(R){const N=this._changeGoldbergFaceColors(R);this.updateVerticesData(M.e.ColorKind,N)}_changeGoldbergFaceUVs(R){const N=this.getVerticesData(M.e.UVKind);for(let q=0;q<R.length;q++){const w=R[q][0],u=R[q][1],M=R[q][2],v=R[q][3],G=R[q][4],J=[],y=[];let a,j;for(let R=0;R<5;R++)a=M.x+v*Math.cos(G+R*Math.PI/2.5),j=M.y+v*Math.sin(G+R*Math.PI/2.5),a<0&&(a=0),a>1&&(a=1),J.push(a,j);for(let R=0;R<6;R++)a=M.x+v*Math.cos(G+R*Math.PI/3),j=M.y+v*Math.sin(G+R*Math.PI/3),a<0&&(a=0),a>1&&(a=1),y.push(a,j);for(let R=w;R<Math.min(12,u+1);R++)for(let q=0;q<5;q++)N[10*R+2*q]=J[2*q],N[10*R+2*q+1]=J[2*q+1];for(let R=Math.max(12,w);R<u+1;R++)for(let q=0;q<6;q++)N[12*R-24+2*q]=y[2*q],N[12*R-23+2*q]=y[2*q+1]}return N}setGoldbergFaceUVs(R){const N=this._changeGoldbergFaceUVs(R);this.Ga(M.e.UVKind,N)}updateGoldbergFaceUVs(R){const N=this._changeGoldbergFaceUVs(R);this.updateVerticesData(M.e.UVKind,N)}placeOnGoldbergFaceAt(R,N,q){const u=w.m.RotationFromAxis(this.goldbergData.faceXaxis[N],this.goldbergData.faceYaxis[N],this.goldbergData.faceZaxis[N]);R.rotation=u,R.position=this.goldbergData.faceCenters[N].add(this.goldbergData.faceXaxis[N].scale(q.x)).add(this.goldbergData.faceYaxis[N].scale(q.y)).add(this.goldbergData.faceZaxis[N].scale(q.z))}serialize(R){super.serialize(R),R.type="GoldbergMesh";const N={};if(N.adjacentFaces=this.goldbergData.adjacentFaces,N.nbSharedFaces=this.goldbergData.nbSharedFaces,N.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,N.nbFaces=this.goldbergData.nbFaces,N.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){N.faceColors=[];for(const R of this.goldbergData.faceColors)N.faceColors.push(R.de())}if(this.goldbergData.faceCenters){N.faceCenters=[];for(const R of this.goldbergData.faceCenters)N.faceCenters.push(R.de())}if(this.goldbergData.faceZaxis){N.faceZaxis=[];for(const R of this.goldbergData.faceZaxis)N.faceZaxis.push(R.de())}if(this.goldbergData.faceYaxis){N.faceYaxis=[];for(const R of this.goldbergData.faceYaxis)N.faceYaxis.push(R.de())}if(this.goldbergData.faceXaxis){N.faceXaxis=[];for(const R of this.goldbergData.faceXaxis)N.faceXaxis.push(R.de())}R.goldbergData=N}static Parse(R,N){const q=R.goldbergData;q.faceColors=q.faceColors.map((R=>F.d.Sd(R))),q.faceCenters=q.faceCenters.map((R=>w.m.Sd(R))),q.faceZaxis=q.faceZaxis.map((R=>w.m.Sd(R))),q.faceXaxis=q.faceXaxis.map((R=>w.m.Sd(R))),q.faceYaxis=q.faceYaxis.map((R=>w.m.Sd(R)));const u=new jR(R.name,N);return u.goldbergData=q,u}}var FR=q(11420);class SR{constructor(R){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=R}moveTo(R,N){this._currentPath=new O.e(R,N),this._tempPaths.push(this._currentPath)}lineTo(R,N){this._currentPath.addLineTo(R,N)}quadraticCurveTo(R,N,q,w){this._currentPath.addQuadraticCurveTo(R,N,q,w,this._resolution)}bezierCurveTo(R,N,q,w,u,M){this._currentPath.addBezierCurveTo(R,N,q,w,u,M,this._resolution)}extractHoles(){for(const R of this._tempPaths)R.area()>0?this._holes.push(R):this._paths.push(R);if(!this._paths.length&&this._holes.length){const R=this._holes;this._holes=this._paths,this._paths=R}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function HR(R,N,q,w,u,M){const v=M.glyphs[R]||M.glyphs["?"];if(!v)return null;const G=new SR(u);if(v.o){const R=v.o.split(" ");for(let u=0,M=R.length;u<M;){switch(R[u++]){case"m":{const M=parseInt(R[u++])*N+q,v=parseInt(R[u++])*N+w;G.moveTo(M,v);break}case"l":{const M=parseInt(R[u++])*N+q,v=parseInt(R[u++])*N+w;G.lineTo(M,v);break}case"q":{const M=parseInt(R[u++])*N+q,v=parseInt(R[u++])*N+w,J=parseInt(R[u++])*N+q,y=parseInt(R[u++])*N+w;G.quadraticCurveTo(J,y,M,v);break}case"b":{const M=parseInt(R[u++])*N+q,v=parseInt(R[u++])*N+w,J=parseInt(R[u++])*N+q,y=parseInt(R[u++])*N+w,a=parseInt(R[u++])*N+q,j=parseInt(R[u++])*N+w;G.bezierCurveTo(J,y,a,j,M,v);break}}}}return G.extractHoles(),{offsetX:v.ha*N,shapePath:G}}const WR={CreateBox:j.f,CreateTiledBox:k,CreateSphere:C.c,kb:a.b,CreateIcoSphere:l,CreateRibbon:y,CreateCylinder:Z,CreateTorus:d,CreateTorusKnot:E,CreateLineSystem:P.f,lb:P.j,CreateDashedLines:P.d,ExtrudeShape:f,ExtrudeShapeCustom:c,CreateLathe:I,CreateTiledPlane:H,Kg:V.d,CreateGround:t.g,CreateTiledGround:t.k,CreateGroundFromHeightMap:t.d,CreatePolygon:Y,ExtrudePolygon:T,CreateTube:i,CreatePolyhedron:U,CreateGeodesic:function(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=N.m||1;w!==Math.floor(w)&&(w=Math.floor(w),s.e.Warn("m not an integer only floor(m) used"));let u=N.n||0;if(u!==Math.floor(u)&&(u=Math.floor(u),s.e.Warn("n not an integer only floor(n) used")),u>w){const R=u;u=w,w=R,s.e.Warn("n > m therefore m and n swapped")}const M=new JR;return M.build(w,u),U(R,{custom:aR.BuildGeodesicData(M),size:N.size,sizeX:N.sizeX,sizeY:N.sizeY,sizeZ:N.sizeZ,faceUV:N.faceUV,faceColors:N.faceColors,flat:N.flat,updatable:N.updatable,sideOrientation:N.sideOrientation,frontUVs:N.frontUVs,backUVs:N.backUVs},q)},CreateGoldberg:function(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=N.size,J=N.sizeX||M||1,y=N.sizeY||M||1,a=N.sizeZ||M||1;let j=N.m||1;j!==Math.floor(j)&&(j=Math.floor(j),s.e.Warn("m not an integer only floor(m) used"));let S=N.n||0;if(S!==Math.floor(S)&&(S=Math.floor(S),s.e.Warn("n not an integer only floor(n) used")),S>j){const R=S;S=j,j=R,s.e.Warn("n > m therefore m and n swapped")}const H=new JR;H.build(j,S);const W=aR.BuildGeodesicData(H),k=W.toGoldbergPolyhedronData(),C=new jR(R,q);N.sideOrientation=u.b._GetDefaultSideOrientation(N.sideOrientation),C._originalBuilderSideOrientation=N.sideOrientation;(function(R,N){const q=R.size,u=R.sizeX||q||1,M=R.sizeY||q||1,J=R.sizeZ||q||1,y=0===R.sideOrientation?0:R.sideOrientation||v.d.DEFAULTSIDE,a=[],j=[],F=[],S=[];let H=1/0,W=-1/0,k=1/0,C=-1/0;for(let w=0;w<N.vertex.length;w++)H=Math.min(H,N.vertex[w][0]*u),W=Math.max(W,N.vertex[w][0]*u),k=Math.min(k,N.vertex[w][1]*M),C=Math.max(C,N.vertex[w][1]*M);let e=0;for(let v=0;v<N.face.length;v++){const R=N.face[v],q=w.m.Sd(N.vertex[R[0]]),y=w.m.Sd(N.vertex[R[2]]),K=w.m.Sd(N.vertex[R[1]]),r=y.Vc(q),Z=K.Vc(q),z=w.m.Cross(Z,r).normalize();for(let w=0;w<R.length;w++){F.push(z.x,z.y,z.z);const q=N.vertex[R[w]];a.push(q[0]*u,q[1]*M,q[2]*J);const v=(q[1]*M-k)/(C-k);S.push((q[0]*u-H)/(W-H),G.e?1-v:v)}for(let N=0;N<R.length-2;N++)j.push(e,e+N+2,e+N+1);e+=R.length}v.d._ComputeSides(y,a,j,F,S);const K=new v.d;return K.xa=a,K.indices=j,K.ya=F,K.Aa=S,K})(N,k).Ca(C,N.updatable),C.goldbergData.nbSharedFaces=W.sharedNodes,C.goldbergData.nbUnsharedFaces=W.poleNodes,C.goldbergData.adjacentFaces=W.adjacentFaces,C.goldbergData.nbFaces=C.goldbergData.nbSharedFaces+C.goldbergData.nbUnsharedFaces,C.goldbergData.nbFacesAtPole=(C.goldbergData.nbUnsharedFaces-12)/12;for(let u=0;u<W.vertex.length;u++)C.goldbergData.faceCenters.push(w.m.Sd(W.vertex[u])),C.goldbergData.faceCenters[u].x*=J,C.goldbergData.faceCenters[u].y*=y,C.goldbergData.faceCenters[u].z*=a,C.goldbergData.faceColors.push(new F.d(1,1,1,1));for(let u=0;u<k.face.length;u++){const R=k.face[u],N=w.m.Sd(k.vertex[R[0]]),q=w.m.Sd(k.vertex[R[2]]),M=w.m.Sd(k.vertex[R[1]]),v=q.Vc(N),G=M.Vc(N),J=w.m.Cross(G,v).normalize(),y=w.m.Cross(G,J).normalize();C.goldbergData.faceXaxis.push(G.normalize()),C.goldbergData.faceYaxis.push(J),C.goldbergData.faceZaxis.push(y)}return C},CreateDecal:uR,CreateCapsule:vR,CreateText:function(R,N,q){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const J=function(R,N,q,w){const u=Array.from(R),M=N/w.resolution,v=(w.boundingBox.yMax-w.boundingBox.yMin+w.underlineThickness)*M,G=[];let J=0,y=0;for(let a=0;a<u.length;a++){const R=u[a];if("\n"===R)J=0,y-=v;else{const N=HR(R,M,J,y,q,w);N&&(J+=N.offsetX,G.push(N.shapePath))}}return G}(N,M.size||50,M.resolution||8,q),y=[];let a=0;for(const H of J){if(!H.paths.length)continue;const N=H.holes.slice();for(const q of H.paths){var j,F;const J=[],S=[],H=q.getPoints();for(const R of H)S.push(new w.m(R.x,0,R.y));const W=N.slice();for(const R of W){const u=R.getPoints();let M=!1;for(const R of u)if(q.isPointInside(R)){M=!0;break}if(!M)continue;const v=[];for(const R of u)v.push(new w.m(R.x,0,R.y));J.push(v),N.splice(N.indexOf(R),1)}if(!J.length&&N.length)for(const R of N){const N=R.getPoints(),q=[];for(const R of N)q.push(new w.m(R.x,0,R.y));J.push(q)}const k=T(R,{shape:S,holes:J.length?J:void 0,depth:M.depth||1,faceUV:M.faceUV||(null===(j=M.perLetterFaceUV)||void 0===j?void 0:j.call(M,a)),faceColors:M.faceColors||(null===(F=M.perLetterFaceColors)||void 0===F?void 0:F.call(M,a)),sideOrientation:u.b._GetDefaultSideOrientation(M.sideOrientation||u.b.DOUBLESIDE)},v,G);y.push(k),a++}}const S=u.b.MergeMeshes(y,!0,!0);if(S){const N=S.getBoundingInfo().boundingBox;S.position.x+=-(N.minimumWorld.x+N.maximumWorld.x)/2,S.position.y+=-(N.minimumWorld.y+N.maximumWorld.y)/2,S.position.z+=-(N.minimumWorld.z+N.maximumWorld.z)/2+N.extendSize.z,S.name=R;const q=new FR.d("pivot",v);q.rotation.x=-Math.PI/2,S.parent=q,S.bakeCurrentTransformIntoVertices(),S.parent=null,q.dispose()}return S}}},12053:(R,N,q)=>{"use strict";var w=q(11381),u=q(1227),M=q(966),v=q(1056),G=q(1328);w.b.prototype.thinInstanceAdd=function(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return v.e.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(R)?R.length:1);const q=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(R))for(let w=0;w<R.length;++w)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,R[w],w===R.length-1&&N);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,R,N);return q},w.b.prototype.thinInstanceAddSelf=function(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(M.c.IdentityReadOnly,R)},w.b.prototype.thinInstanceRegisterAttribute=function(R,N){R===u.e.ColorKind&&(R=u.e.ColorInstanceKind),this.removeVerticesData(R),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[R]=N,this._userThinInstanceBuffersStorage.sizes[R]=N*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[R]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[R]),this._userThinInstanceBuffersStorage.vertexBuffers[R]=new u.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[R],R,!0,!1,N,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[R])},w.b.prototype.thinInstanceSetMatrixAt=function(R,N){let q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||R>=this._thinInstanceDataStorage.instancesCount)return!1;const w=this._thinInstanceDataStorage.matrixData;return N.copyToArray(w,16*R),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[R]=N),q&&(this.Pj("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},w.b.prototype.thinInstanceSetAttributeAt=function(R,N,q){let w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return R===u.e.ColorKind&&(R=u.e.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[R]||N>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(R,0),this._userThinInstanceBuffersStorage.data[R].set(q,N*this._userThinInstanceBuffersStorage.strides[R]),w&&this.Pj(R),!0)},Object.defineProperty(w.b.prototype,"Mj",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(R){var N;const q=this._thinInstanceDataStorage.matrixData??(null===(N=this.source)||void 0===N?void 0:N._thinInstanceDataStorage.matrixData);R<=(q?q.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=R)},enumerable:!0,configurable:!0}),w.b.prototype._thinInstanceCreateMatrixBuffer=function(R,N){let q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const w=new u.b(this.getEngine(),N,!q,16,!1,!0);for(let u=0;u<4;u++)this.setVerticesBuffer(w.createVertexBuffer(R+u,4*u,4));return w},w.b.prototype.Qj=function(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var M;if(q=q||16,"matrix"===R)null===(M=this._thinInstanceDataStorage.matrixBuffer)||void 0===M||M.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=N?N.length:32*q,this._thinInstanceDataStorage.matrixData=N,this._thinInstanceDataStorage.worldMatrices=null,null!==N?(this._thinInstanceDataStorage.instancesCount=N.length/q,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",N,w),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===R){var v;null===(v=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===v||v.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=N,null!==N&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",N,w))}else{var G;if(R===u.e.ColorKind&&(R=u.e.ColorInstanceKind),null===N)null!==(G=this._userThinInstanceBuffersStorage)&&void 0!==G&&G.data[R]&&(this.removeVerticesData(R),delete this._userThinInstanceBuffersStorage.data[R],delete this._userThinInstanceBuffersStorage.strides[R],delete this._userThinInstanceBuffersStorage.sizes[R],delete this._userThinInstanceBuffersStorage.vertexBuffers[R]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[R]=N,this._userThinInstanceBuffersStorage.strides[R]=q,this._userThinInstanceBuffersStorage.sizes[R]=N.length,this._userThinInstanceBuffersStorage.vertexBuffers[R]=new u.e(this.getEngine(),N,R,!w,!1,q,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[R])}},w.b.prototype.Pj=function(R){var N;if("matrix"===R)this.Lj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(R),null===(N=this._thinInstanceDataStorage.matrixBuffer)||void 0===N||N.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===R){var q;this.Lj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(R),null===(q=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===q||q.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var w;R===u.e.ColorKind&&(R=u.e.ColorInstanceKind),null!==(w=this._userThinInstanceBuffersStorage)&&void 0!==w&&w.vertexBuffers[R]&&(this.Lj&&!this._userThinInstanceBuffersStorage.vertexBuffers[R].isUpdatable()&&this._thinInstanceRecreateBuffer(R),this._userThinInstanceBuffersStorage.vertexBuffers[R].updateDirectly(this._userThinInstanceBuffersStorage.data[R],0))}},w.b.prototype.thinInstancePartialBufferUpdate=function(R,N,q){var w;"matrix"===R?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(N,q):(R===u.e.ColorKind&&(R=u.e.ColorInstanceKind),null!==(w=this._userThinInstanceBuffersStorage)&&void 0!==w&&w.vertexBuffers[R]&&this._userThinInstanceBuffersStorage.vertexBuffers[R].updateDirectly(N,q))},w.b.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const R=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let N=0;N<this._thinInstanceDataStorage.instancesCount;++N)this._thinInstanceDataStorage.worldMatrices[N]=M.c.Sd(R,16*N)}return this._thinInstanceDataStorage.worldMatrices},w.b.prototype.thinInstanceRefreshBoundingInfo=function(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const w=this._thinInstanceDataStorage.boundingVectors;if(R||!this.rawBoundingInfo){w.length=0,this.refreshBoundingInfo(N,q);const R=this.getBoundingInfo();this.rawBoundingInfo=new G.b(R.minimum,R.maximum)}const u=this.getBoundingInfo(),v=this._thinInstanceDataStorage.matrixData;if(0===w.length)for(let M=0;M<u.boundingBox.vectors.length;++M)w.push(u.boundingBox.vectors[M].clone());M.f.Od[0].Td(Number.POSITIVE_INFINITY),M.f.Od[1].Td(Number.NEGATIVE_INFINITY);for(let G=0;G<this._thinInstanceDataStorage.instancesCount;++G){M.c.FromArrayToRef(v,16*G,M.f.Matrix[0]);for(let R=0;R<w.length;++R)M.m.TransformCoordinatesToRef(w[R],M.f.Matrix[0],M.f.Od[2]),M.f.Od[0].minimizeInPlace(M.f.Od[2]),M.f.Od[1].maximizeInPlace(M.f.Od[2])}u.reConstruct(M.f.Od[0],M.f.Od[1]),this.Ea()},w.b.prototype._thinInstanceRecreateBuffer=function(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var q;if("matrix"===R)null===(q=this._thinInstanceDataStorage.matrixBuffer)||void 0===q||q.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,N);else if("previousMatrix"===R){var w;if(this._scene.needsPreviousWorldMatrices)null===(w=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===w||w.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,N)}else{var M;R===u.e.ColorKind&&(R=u.e.ColorInstanceKind),null===(M=this._userThinInstanceBuffersStorage.vertexBuffers[R])||void 0===M||M.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[R]=new u.e(this.getEngine(),this._userThinInstanceBuffersStorage.data[R],R,!N,!1,this._userThinInstanceBuffersStorage.strides[R],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[R])}},w.b.prototype._thinInstanceUpdateBufferSize=function(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;R===u.e.ColorKind&&(R=u.e.ColorInstanceKind);const q="matrix"===R;if(!q&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[R]))return;const w=q?16:this._userThinInstanceBuffersStorage.strides[R],M=q?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[R];let v=q?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[R];const G=(this._thinInstanceDataStorage.instancesCount+N)*w;let J=M;for(;J<G;)J*=2;if(!v||M!=J){if(v){const R=new Float32Array(J);R.set(v,0),v=R}else v=new Float32Array(J);var y,a,j;if(q){if(null===(y=this._thinInstanceDataStorage.matrixBuffer)||void 0===y||y.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",v,!1),this._thinInstanceDataStorage.matrixData=v,this._thinInstanceDataStorage.matrixBufferSize=J,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(a=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===a||a.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",v,!1)}else null===(j=this._userThinInstanceBuffersStorage.vertexBuffers[R])||void 0===j||j.dispose(),this._userThinInstanceBuffersStorage.data[R]=v,this._userThinInstanceBuffersStorage.sizes[R]=J,this._userThinInstanceBuffersStorage.vertexBuffers[R]=new u.e(this.getEngine(),v,R,!0,!1,w,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[R])}},w.b.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},w.b.prototype._disposeThinInstanceSpecificData=function(){var R;null!==(R=this._thinInstanceDataStorage)&&void 0!==R&&R.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11420:(R,N,q)=>{"use strict";q.d(N,{d:()=>j});var w=q(942),u=q(947),M=q(1128),v=q(959),G=q(966),J=q(11398),y=q(982);const a=G.c.Compose(G.m.One(),G.e.FromEulerAngles(0,Math.PI,0),G.m.Zero());class j extends J.d{get billboardMode(){return this._billboardMode}set billboardMode(R){this._billboardMode!==R&&(this._billboardMode=R,this._cache.useBillboardPosition=0!==(this._billboardMode&j.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(R){R!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=R,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==j.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(R){this._infiniteDistance!==R&&(this._infiniteDistance=R)}constructor(R){let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(R,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new G.m(0,0,1),this._up=new G.m(0,1,0),this._right=new G.m(1,0,0),this._position=G.m.Zero(),this._rotation=G.m.Zero(),this._rotationQuaternion=null,this._scaling=G.m.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=j.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Oj=G.c.Zero(),this._usePivotMatrix=!1,this._absolutePosition=G.m.Zero(),this._absoluteScaling=G.m.Zero(),this._absoluteRotationQuaternion=G.e.Identity(),this._pivotMatrix=G.c.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new v.c,this._nonUniformScaling=!1,N&&this.va().addTransformNode(this)}getClassName(){return"mb"}get position(){return this._position}set position(R){this._position=R,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(R){this._rotation=R,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Fe(){return this._scaling}set Fe(R){this._scaling=R,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(R){this._rotationQuaternion=R,R&&this._rotation.Td(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return G.m.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return G.m.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return G.m.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(R){return this._poseMatrix?(this._poseMatrix.p(R),this):(this._poseMatrix=R.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=G.c.Identity()),this._poseMatrix}_isSynchronized(){const R=this._cache;return this._billboardMode===R.billboardMode&&this._billboardMode===j.BILLBOARDMODE_NONE&&(!R.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const R=this._cache;R.localMatrixUpdated=!1,R.billboardMode=-1,R.infiniteDistance=!1,R.useBillboardPosition=!1,R.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(R){return this.setPivotMatrix(R,!1)}setPivotMatrix(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(R),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=N,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=G.c.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,N=arguments.length>1?arguments[1]:void 0,q=arguments.length>2?arguments[2]:void 0;const w=this.clone("Clone of "+(this.name||this.id),R||this.parent,!0);w&&q&&q(this,w);for(const u of this.getChildTransformNodes(!0))u.instantiateHierarchy(w,N,q);return w}ci(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return R?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.Td(0),this._rotationQuaternion=this._rotationQuaternion||G.e.Identity(),R.decompose(this._scaling,this._rotationQuaternion,this._position),this.je(!0)):(this._worldMatrix=R,this._absolutePosition.Rd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.je(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.je(!0),this}get rj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.je(),this._absolutePosition}setAbsolutePosition(R){if(!R)return this;let N,q,w;if(void 0===R.x){if(arguments.length<3)return this;N=arguments[0],q=arguments[1],w=arguments[2]}else N=R.x,q=R.y,w=R.z;if(this.parent){const R=G.f.Matrix[0];this.parent.getWorldMatrix().invertToRef(R),G.m.TransformCoordinatesFromFloatsToRef(N,q,w,R,this.position)}else this.position.x=N,this.position.y=q,this.position.z=w;return this._absolutePosition.p(R),this}setPositionWithLocalVector(R){return this.je(),this.position=G.m.TransformNormal(R,this.Oj),this}getPositionExpressedInLocalSpace(){this.je();const R=G.f.Matrix[0];return this.Oj.invertToRef(R),G.m.TransformNormal(this.position,R)}locallyTranslate(R){return this.je(!0),this.position=G.m.TransformCoordinates(R,this.Oj),this}lookAt(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const M=j._LookAtVectorCache,v=0===u?this.position:this.getAbsolutePosition();if(R.subtractToRef(v,M),this.setDirection(M,N,q,w),1===u&&this.parent)if(this.rotationQuaternion){const R=G.f.Matrix[0];this.rotationQuaternion.toRotationMatrix(R);const N=G.f.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(N),N.invert(),R.multiplyToRef(N,R),this.rotationQuaternion.fromRotationMatrix(R)}else{const R=G.f.Quaternion[0];G.e.FromEulerVectorToRef(this.rotation,R);const N=G.f.Matrix[0];R.toRotationMatrix(N);const q=G.f.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(q),q.invert(),N.multiplyToRef(q,N),R.fromRotationMatrix(N),R.toEulerAnglesToRef(this.rotation)}return this}nf(R){const N=G.m.Zero();return this.getDirectionToRef(R,N),N}getDirectionToRef(R,N){return G.m.TransformNormalToRef(R,this.getWorldMatrix(),N),this}setDirection(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const u=-Math.atan2(R.z,R.x)+Math.PI/2,M=Math.sqrt(R.x*R.x+R.z*R.z),v=-Math.atan2(R.y,M);return this.rotationQuaternion?G.e.RotationYawPitchRollToRef(u+N,v+q,w,this.rotationQuaternion):(this.rotation.x=v+q,this.rotation.y=u+N,this.rotation.z=w),this}setPivotPoint(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.je(!0);const q=this.getWorldMatrix();if(1==N){const N=G.f.Matrix[0];q.invertToRef(N),R=G.m.TransformCoordinates(R,N)}return this.setPivotMatrix(G.c.Translation(-R.x,-R.y,-R.z),!0)}getPivotPoint(){const R=G.m.Zero();return this.getPivotPointToRef(R),R}getPivotPointToRef(R){return R.x=-this._pivotMatrix.m[12],R.y=-this._pivotMatrix.m[13],R.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const R=G.m.Zero();return this.getAbsolutePivotPointToRef(R),R}getAbsolutePivotPointToRef(R){return this.getPivotPointToRef(R),G.m.TransformCoordinatesToRef(R,this.getWorldMatrix(),R),this}pe(R){if(this._isDirty)return this;if(this._children)for(const N of this._children)N.pe(R);return super.pe(R)}setParent(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!R&&!this.parent)return this;const w=G.f.Quaternion[0],u=G.f.Od[0],M=G.f.Od[1],v=G.f.Matrix[1];G.c.IdentityToRef(v);const J=G.f.Matrix[0];this.je(!0);let y=this.rotationQuaternion;return y||(y=j._TmpRotation,G.e.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,y)),G.c.ComposeToRef(this.Fe,y,this.position,J),this.parent&&J.multiplyToRef(this.parent.je(!0),J),R&&(R.je(!0).invertToRef(v),J.multiplyToRef(v,J)),J.decompose(M,w,u,N?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(w):w.toEulerAnglesToRef(this.rotation),this.Fe.p(M),this.position.p(u),this.parent=R,q&&this.setPivotMatrix(G.c.Identity()),this}addChild(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return R.setParent(this,N),this}removeChild(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return R.setParent(null,N),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(R){return this._nonUniformScaling!==R&&(this._nonUniformScaling=R,!0)}attachToBone(R,N){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=N,this.parent=R,R.getSkeleton().prepare(!0),R.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=R?this._currentParentWhenAttachingToBone:null,this):(R&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(R,N,q){let w;if(R.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.Td(0)),q&&0!==q){if(this.parent){const q=this.parent.getWorldMatrix(),w=G.f.Matrix[0];q.invertToRef(w),R=G.m.TransformNormal(R,w),q.determinant()<0&&(N*=-1)}w=G.e.RotationAxisToRef(R,N,j._RotationAxisCache),w.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else w=G.e.RotationAxisToRef(R,N,j._RotationAxisCache),this.rotationQuaternion.multiplyToRef(w,this.rotationQuaternion);return this}rotateAround(R,N,q){N.normalize(),this.rotationQuaternion||(this.rotationQuaternion=G.e.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.Td(0));const w=G.f.Od[0],u=G.f.Od[1],M=G.f.Od[2],v=G.f.Quaternion[0],J=G.f.Matrix[0],y=G.f.Matrix[1],a=G.f.Matrix[2],j=G.f.Matrix[3];return R.subtractToRef(this.position,w),G.c.TranslationToRef(w.x,w.y,w.z,J),G.c.TranslationToRef(-w.x,-w.y,-w.z,y),G.c.RotationAxisToRef(N,q,a),y.multiplyToRef(a,j),j.multiplyToRef(J,j),j.decompose(u,v,M),this.position.addInPlace(M),v.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(R,N,q){const w=R.scale(N);if(q&&0!==q)this.setAbsolutePosition(this.getAbsolutePosition().add(w));else{const R=this.getPositionExpressedInLocalSpace().add(w);this.setPositionWithLocalVector(R)}return this}addRotation(R,N,q){let w;this.rotationQuaternion?w=this.rotationQuaternion:(w=G.f.Quaternion[1],G.e.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,w));const u=G.f.Quaternion[0];return G.e.RotationYawPitchRollToRef(N,R,q,u),w.multiplyInPlace(u),this.rotationQuaternion||w.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==j.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}je(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const q=this.va().getRenderId();if(!this._isDirty&&!R&&(this._currentRenderId===q||this.isSynchronized()))return this._currentRenderId=q,this._worldMatrix;N=N||this.va().activeCamera,this._updateCache();const w=this._cache;w.pivotMatrixUpdated=!1,w.billboardMode=this.billboardMode,w.infiniteDistance=this.infiniteDistance,w.parent=this._parentNode,this._currentRenderId=q,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const u=this._getEffectiveParent(),M=j._TmpScaling;let v,J=this._position;if(this._infiniteDistance&&!this.parent&&N){const R=N.getWorldMatrix(),q=new G.m(R.m[12],R.m[13],R.m[14]);J=j._TmpTranslation,J.Rd(this._position.x+q.x,this._position.y+q.y,this._position.z+q.z)}if(M.Rd(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,v=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(G.e.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Rd(0,0,0))}}else v=j._TmpRotation,G.e.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,v);if(this._usePivotMatrix){const R=G.f.Matrix[1];G.c.ScalingToRef(M.x,M.y,M.z,R);const N=G.f.Matrix[0];v.toRotationMatrix(N),this._pivotMatrix.multiplyToRef(R,G.f.Matrix[4]),G.f.Matrix[4].multiplyToRef(N,this.Oj),this._postMultiplyPivotMatrix&&this.Oj.multiplyToRef(this._pivotMatrixInverse,this.Oj),this.Oj.addTranslationFromFloats(J.x,J.y,J.z)}else G.c.ComposeToRef(M,v,J,this.Oj);if(u&&u.getWorldMatrix){if(R&&u.je(R),w.useBillboardPath){if(this._transformToBoneReferal){const R=this.parent;R.getSkeleton().prepare(),R.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),G.f.Matrix[7])}else G.f.Matrix[7].p(u.getWorldMatrix());const R=G.f.Od[5],N=G.f.Od[6],q=G.f.Quaternion[0];G.f.Matrix[7].decompose(N,q,R),G.c.ScalingToRef(N.x,N.y,N.z,G.f.Matrix[7]),G.f.Matrix[7].setTranslation(R),j.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(q,R),this.Oj.setTranslation(R)),this.Oj.multiplyToRef(G.f.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const R=this.parent;R.getSkeleton().prepare(),this.Oj.multiplyToRef(R.getFinalMatrix(),G.f.Matrix[6]),G.f.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Oj.multiplyToRef(u.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Oj);if(w.useBillboardPath&&N&&this.billboardMode&&!w.useBillboardPosition){const R=G.f.Od[0];if(this._worldMatrix.getTranslationToRef(R),G.f.Matrix[1].p(N.getViewMatrix()),this._scene.useRightHandedSystem&&G.f.Matrix[1].multiplyToRef(a,G.f.Matrix[1]),G.f.Matrix[1].setTranslationFromFloats(0,0,0),G.f.Matrix[1].invertToRef(G.f.Matrix[0]),(this.billboardMode&j.BILLBOARDMODE_ALL)!==j.BILLBOARDMODE_ALL){G.f.Matrix[0].decompose(void 0,G.f.Quaternion[0],void 0);const R=G.f.Od[1];G.f.Quaternion[0].toEulerAnglesToRef(R),(this.billboardMode&j.BILLBOARDMODE_X)!==j.BILLBOARDMODE_X&&(R.x=0),(this.billboardMode&j.BILLBOARDMODE_Y)!==j.BILLBOARDMODE_Y&&(R.y=0),(this.billboardMode&j.BILLBOARDMODE_Z)!==j.BILLBOARDMODE_Z&&(R.z=0),G.c.RotationYawPitchRollToRef(R.y,R.x,R.z,G.f.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(G.f.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(G.f.Od[0])}else if(w.useBillboardPath&&N&&w.useBillboardPosition){const R=G.f.Od[0];this._worldMatrix.getTranslationToRef(R);const q=N.globalPosition;this._worldMatrix.invertToRef(G.f.Matrix[1]);const w=G.f.Od[1];G.m.TransformCoordinatesToRef(q,G.f.Matrix[1],w),w.normalize();const u=-Math.atan2(w.z,w.x)+Math.PI/2,M=Math.sqrt(w.x*w.x+w.z*w.z),v=-Math.atan2(w.y,M);if(G.e.RotationYawPitchRollToRef(u,v,0,G.f.Quaternion[0]),(this.billboardMode&j.BILLBOARDMODE_ALL)!==j.BILLBOARDMODE_ALL){const R=G.f.Od[1];G.f.Quaternion[0].toEulerAnglesToRef(R),(this.billboardMode&j.BILLBOARDMODE_X)!==j.BILLBOARDMODE_X&&(R.x=0),(this.billboardMode&j.BILLBOARDMODE_Y)!==j.BILLBOARDMODE_Y&&(R.y=0),(this.billboardMode&j.BILLBOARDMODE_Z)!==j.BILLBOARDMODE_Z&&(R.z=0),G.c.RotationYawPitchRollToRef(R.y,R.x,R.z,G.f.Matrix[0])}else G.c.FromQuaternionToRef(G.f.Quaternion[0],G.f.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(G.f.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(G.f.Od[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):u&&u._nonUniformScaling?this._updateNonUniformScalingState(u._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Rd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=G.c.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.je(),R){const R=this.getChildren();for(let N=0;N<R.length;++N){const q=R[N];if(q){q.je();const R=G.f.Matrix[0];q.Oj.multiplyToRef(this.Oj,R);const N=G.f.Quaternion[0];R.decompose(q.Fe,N,q.position),q.rotationQuaternion?q.rotationQuaternion.p(N):N.toEulerAnglesToRef(q.rotation)}}}this.Fe.Rd(1,1,1),this.position.Rd(0,0,0),this.rotation.Rd(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=G.e.Identity()),this._worldMatrix=G.c.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(R){return this.onAfterWorldMatrixUpdateObservable.add(R),this}unregisterAfterWorldMatrixUpdate(R){return this.onAfterWorldMatrixUpdateObservable.removeCallback(R),this}getPositionInCameraSpace(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return R||(R=this.va().activeCamera),G.m.TransformCoordinates(this.getAbsolutePosition(),R.getViewMatrix())}getDistanceToCamera(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return R||(R=this.va().activeCamera),this.getAbsolutePosition().Vc(R.globalPosition).length()}clone(R,N,q){const w=M.e.Clone((()=>new j(R,this.va())),this);if(w.name=R,w.id=R,N&&(w.parent=N),!q){const N=this.getDescendants(!0);for(let q=0;q<N.length;q++){const u=N[q];u.clone&&u.clone(R+"."+u.name,w)}}return w}serialize(R){const N=M.e.Serialize(this,R);return N.type=this.getClassName(),N.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(N),N.localMatrix=this.getPivotMatrix().de(),N.isEnabled=this.isEnabled(),M.e.AppendSerializedAnimations(this,N),N.ranges=this.serializeAnimationRanges(),N}static Parse(R,N,q){const w=M.e.Parse((()=>new j(R.name,N)),R,N,q);if(R.localMatrix?w.setPreTransformMatrix(G.c.Sd(R.localMatrix)):R.pivotMatrix&&w.setPivotMatrix(G.c.Sd(R.pivotMatrix)),w.Jg(R.isEnabled),w._waitingParsedUniqueId=R.uniqueId,void 0!==R.parentId&&(w._waitingParentId=R.parentId),void 0!==R.parentInstanceIndex&&(w._waitingParentInstanceIndex=R.parentInstanceIndex),R.animations){for(let N=0;N<R.animations.length;N++){const q=R.animations[N],u=(0,y.e)("BABYLON.Animation");u&&w.animations.push(u.Parse(q))}J.d.ParseAnimationRanges(w,R,N)}return R.autoAnimate&&N.beginAnimation(w,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1),w}getChildTransformNodes(R,N){const q=[];return this._getDescendants(q,R,(R=>(!N||N(R))&&R instanceof j)),q}dispose(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const R=this._parentContainer.transformNodes.indexOf(this);R>-1&&this._parentContainer.transformNodes.splice(R,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),R){const R=this.getChildTransformNodes(!0);for(const N of R)N.parent=null,N.je(!0)}super.dispose(R,N)}normalizeToUnitCube(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2?arguments[2]:void 0,w=null,u=null;N&&(this.rotationQuaternion?(u=this.rotationQuaternion.clone(),this.rotationQuaternion.Rd(0,0,0,1)):this.rotation&&(w=this.rotation.clone(),this.rotation.Rd(0,0,0)));const M=this.getHierarchyBoundingVectors(R,q),v=M.max.Vc(M.min),G=Math.max(v.x,v.y,v.z);if(0===G)return this;const J=1/G;return this.Fe.scaleInPlace(J),N&&(this.rotationQuaternion&&u?this.rotationQuaternion.p(u):this.rotation&&w&&this.rotation.p(w)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}j.BILLBOARDMODE_NONE=0,j.BILLBOARDMODE_X=1,j.BILLBOARDMODE_Y=2,j.BILLBOARDMODE_Z=4,j.BILLBOARDMODE_ALL=7,j.BILLBOARDMODE_USE_POSITION=128,j.BillboardUseParentOrientation=!1,j._TmpRotation=G.e.Zero(),j._TmpScaling=G.m.Zero(),j._TmpTranslation=G.m.Zero(),j._LookAtVectorCache=new G.m(0,0,0),j._RotationAxisCache=new G.e,(0,w.b)([(0,u.C)("position")],j.prototype,"_position",void 0),(0,w.b)([(0,u.C)("rotation")],j.prototype,"_rotation",void 0),(0,w.b)([(0,u.x)("rotationQuaternion")],j.prototype,"_rotationQuaternion",void 0),(0,w.b)([(0,u.C)("Fe")],j.prototype,"_scaling",void 0),(0,w.b)([(0,u.E)("billboardMode")],j.prototype,"_billboardMode",void 0),(0,w.b)([(0,u.E)()],j.prototype,"scalingDeterminant",void 0),(0,w.b)([(0,u.E)("infiniteDistance")],j.prototype,"_infiniteDistance",void 0),(0,w.b)([(0,u.E)()],j.prototype,"ignoreNonUniformScaling",void 0),(0,w.b)([(0,u.E)()],j.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},12018:(R,N,q)=>{"use strict";q.d(N,{c:()=>v});var w=q(933),u=q(10349);let M=0;const v=R=>{if(!R.environmentBRDFTexture){const N=R.useDelayedTextureLoading;R.useDelayedTextureLoading=!1;const q=R._blockEntityCollection;R._blockEntityCollection=!1;const v=w.e.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+M++,R,!0,!1,w.e.BILINEAR_SAMPLINGMODE);R._blockEntityCollection=q;const G=R.getEngine().getLoadedTexturesCache(),J=G.indexOf(v.getInternalTexture());-1!==J&&G.splice(J,1),v.isRGBD=!0,v.wrapU=w.e.CLAMP_ADDRESSMODE,v.wrapV=w.e.CLAMP_ADDRESSMODE,R.environmentBRDFTexture=v,R.useDelayedTextureLoading=N,u.c.ExpandRGBDTexture(v);const y=R.getEngine().onContextRestoredObservable.add((()=>{v.isRGBD=!0;const N=R.onBeforeRenderObservable.add((()=>{v.isReady()&&(R.onBeforeRenderObservable.remove(N),u.c.ExpandRGBDTexture(v))}))}));R.Zd.add((()=>{R.getEngine().onContextRestoredObservable.remove(y)}))}return R.environmentBRDFTexture}},11388:(R,N,q)=>{"use strict";function w(R,N,q){try{const w=R.next();w.done?N(w):w.value?w.value.then((()=>{w.value=void 0,N(w)}),q):N(w)}catch(w){q(w)}}function u(){let R,N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(q,u,M)=>{const v=performance.now();void 0===R||v-R>N?(R=v,setTimeout((()=>{w(q,u,M)}),0)):w(q,u,M)}}function M(R,N,q,w,u){const M=()=>{let v;const G=R=>{R.done?q(R.value):void 0===v?v=!0:M()};do{v=void 0,u&&u.aborted?w(new Error("Aborted")):N(R,G,w),void 0===v&&(v=!1)}while(v)};M()}function v(R,N){let q;return M(R,w,(R=>q=R),(R=>{throw R}),N),q}function G(R,N,q){return new Promise(((w,u)=>{M(R,N,w,u,q)}))}function J(R,N){return function(){return v(R(...arguments),N)}}q.d(N,{e:()=>u,i:()=>J,m:()=>G,p:()=>v})},10376:(R,N,q)=>{"use strict";q.d(N,{d:()=>u});class w{constructor(R){this._pendingActions=new Array,this._workerInfos=R.map((R=>({workerPromise:Promise.resolve(R),idle:!0})))}dispose(){for(const R of this._workerInfos)R.workerPromise.then((R=>{R.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(R){this._executeOnIdleWorker(R)||this._pendingActions.push(R)}_executeOnIdleWorker(R){for(const N of this._workerInfos)if(N.idle)return this._execute(N,R),!0;return!1}_execute(R,N){R.idle=!1,R.workerPromise.then((q=>{N(q,(()=>{const N=this._pendingActions.shift();N?this._execute(R,N):R.idle=!0}))}))}}class u extends w{constructor(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.DefaultOptions;super([]),this._maxWorkers=R,this._createWorkerAsync=N,this._options=q}push(R){if(!this._executeOnIdleWorker(R))if(this._workerInfos.length<this._maxWorkers){const N={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(N),this._execute(N,R)}else this._pendingActions.push(R)}_execute(R,N){R.timeoutId&&(clearTimeout(R.timeoutId),delete R.timeoutId),super._execute(R,((q,w)=>{N(q,(()=>{w(),R.idle&&(R.timeoutId=setTimeout((()=>{R.workerPromise.then((R=>{R.terminate()}));const N=this._workerInfos.indexOf(R);-1!==N&&this._workerInfos.splice(N,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}u.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11538:(R,N,q)=>{"use strict";q.d(N,{e:()=>CR});var w=q(966),u=q(1363);class M extends u.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var v=q(1133),G=(q(1429),q(982));class J{get noiseTexture(){return this._noiseTexture}set noiseTexture(R){this._noiseTexture!==R&&(this._noiseTexture=R,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(R){this._isAnimationSheetEnabled!=R&&(this._isAnimationSheetEnabled=R,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(R){this._useLogarithmicDepth=R&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:w.m.Zero()}set direction1(R){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=R)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:w.m.Zero()}set direction2(R){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=R)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:w.m.Zero()}set minEmitBox(R){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=R)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:w.m.Zero()}set maxEmitBox(R){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=R)}get billboardMode(){return this._billboardMode}set billboardMode(R){this._billboardMode!==R&&(this._billboardMode=R,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(R){this._isBillboardBased!==R&&(this._isBillboardBased=R,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(R){this._attachImageProcessingConfiguration(R)}_attachImageProcessingConfiguration(R){R!==this._imageProcessingConfiguration&&(!R&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=R)}_reset(){}_removeGradientAndTexture(R,N,q){if(!N)return this;let w=0;for(const u of N){if(u.gradient===R){N.splice(w,1);break}w++}return q&&q.dispose(),this}constructor(R){this.animations=[],this.renderingGroupId=0,this.k=w.m.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new w.m(10,10,10),this.onAnimationEnd=null,this.blendMode=J.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new w.j(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.zg=new w.m(0,0,0),this._useLogarithmicDepth=!1,this.gravity=w.m.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new v.d(1,1,1,1),this.color2=new v.d(1,1,1,1),this.colorDead=new v.d(0,0,0,1),this.textureMask=new v.d(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new M,this.id=R,this.name=R}createPointEmitter(R,N){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new w.m(0,1,0),arguments.length>2&&void 0!==arguments[2]||new w.m(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new w.m(0,1,0),arguments.length>4&&void 0!==arguments[4]||new w.m(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new w.m(0,1,0),arguments.length>3&&void 0!==arguments[3]||new w.m(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(R,N,q,w){throw new Error("Method not implemented.")}}J.BLENDMODE_ONEONE=0,J.BLENDMODE_STANDARD=1,J.BLENDMODE_ADD=2,J.BLENDMODE_MULTIPLY=3,J.BLENDMODE_MULTIPLYADD=4,(0,G.h)("BABYLON.BaseParticleSystem",J);var y=q(1001),a=q(1186);class j{constructor(){this.direction1=new w.m(0,1,0),this.direction2=new w.m(0,1,0),this.minEmitBox=new w.m(-.5,-.5,-.5),this.maxEmitBox=new w.m(.5,.5,.5)}startDirectionFunction(R,N,q,u){const M=(0,y.s)(this.direction1.x,this.direction2.x),v=(0,y.s)(this.direction1.y,this.direction2.y),G=(0,y.s)(this.direction1.z,this.direction2.z);if(u)return N.x=M,N.y=v,void(N.z=G);w.m.TransformNormalFromFloatsToRef(M,v,G,R,N)}startPositionFunction(R,N,q,u){const M=(0,y.s)(this.minEmitBox.x,this.maxEmitBox.x),v=(0,y.s)(this.minEmitBox.y,this.maxEmitBox.y),G=(0,y.s)(this.minEmitBox.z,this.maxEmitBox.z);if(u)return N.x=M,N.y=v,void(N.z=G);w.m.TransformCoordinatesFromFloatsToRef(M,v,G,R,N)}clone(){const R=new j;return a.c.DeepCopy(this,R),R}applyToShader(R){R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2),R.setVector3("minEmitBox",this.minEmitBox),R.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(R){R.addUniform("direction1",3),R.addUniform("direction2",3),R.addUniform("minEmitBox",3),R.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.direction1=this.direction1.de(),R.direction2=this.direction2.de(),R.minEmitBox=this.minEmitBox.de(),R.maxEmitBox=this.maxEmitBox.de(),R}parse(R){w.m.FromArrayToRef(R.direction1,0,this.direction1),w.m.FromArrayToRef(R.direction2,0,this.direction2),w.m.FromArrayToRef(R.minEmitBox,0,this.minEmitBox),w.m.FromArrayToRef(R.maxEmitBox,0,this.maxEmitBox)}}class F{get i(){return this._radius}set i(R){this._radius=R,this._buildHeight()}get angle(){return this._angle}set angle(R){this._angle=R,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=q,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=N,this.i=R}startDirectionFunction(R,N,q,u){u?w.f.Od[0].p(q.Dg).normalize():q.position.subtractToRef(R.getTranslation(),w.f.Od[0]).normalize();const M=(0,y.s)(0,this.directionRandomizer),v=(0,y.s)(0,this.directionRandomizer),G=(0,y.s)(0,this.directionRandomizer);N.x=w.f.Od[0].x+M,N.y=w.f.Od[0].y+v,N.z=w.f.Od[0].z+G,N.normalize()}startPositionFunction(R,N,q,u){const M=(0,y.s)(0,2*Math.PI);let v;this.emitFromSpawnPointOnly?v=1e-4:(v=(0,y.s)(0,this.heightRange),v=1-v*v);let G=this._radius-(0,y.s)(0,this._radius*this.radiusRange);G*=v;const J=G*Math.sin(M),a=G*Math.cos(M),j=v*this._height;if(u)return N.x=J,N.y=j,void(N.z=a);w.m.TransformCoordinatesFromFloatsToRef(J,j,a,R,N)}clone(){const R=new F(this._radius,this._angle,this.directionRandomizer);return a.c.DeepCopy(this,R),R}applyToShader(R){R.setFloat2("i",this._radius,this.radiusRange),R.setFloat("coneAngle",this._angle),R.setFloat2("height",this._height,this.heightRange),R.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(R){R.addUniform("i",2),R.addUniform("coneAngle",1),R.addUniform("height",2),R.addUniform("directionRandomizer",1)}getEffectDefines(){let R="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(R+="\n#define CONEEMITTERSPAWNPOINT"),R}getClassName(){return"ConeParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.i=this._radius,R.angle=this._angle,R.directionRandomizer=this.directionRandomizer,R.radiusRange=this.radiusRange,R.heightRange=this.heightRange,R.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,R}parse(R){this.i=R.i,this.angle=R.angle,this.directionRandomizer=R.directionRandomizer,this.radiusRange=void 0!==R.radiusRange?R.radiusRange:1,this.heightRange=void 0!==R.radiusRange?R.heightRange:1,this.emitFromSpawnPointOnly=void 0!==R.emitFromSpawnPointOnly&&R.emitFromSpawnPointOnly}}class S extends F{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.m(0,1,0),u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.m(0,1,0);super(R,N),this.direction1=q,this.direction2=u}startDirectionFunction(R,N){const q=(0,y.s)(this.direction1.x,this.direction2.x),u=(0,y.s)(this.direction1.y,this.direction2.y),M=(0,y.s)(this.direction1.z,this.direction2.z);w.m.TransformNormalFromFloatsToRef(q,u,M,R,N)}clone(){const R=new S(this.i,this.angle,this.direction1,this.direction2);return a.c.DeepCopy(this,R),R}applyToShader(R){R.setFloat("i",this.i),R.setFloat("radiusRange",this.radiusRange),R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("i",1),R.addUniform("radiusRange",1),R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const R=super.serialize();return R.direction1=this.direction1.de(),R.direction2=this.direction2.de(),R}parse(R){super.parse(R),this.direction1.p(R.direction1),this.direction2.p(R.direction2)}}class H{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.i=R,this.height=N,this.radiusRange=q,this.directionRandomizer=u,this._tempVector=w.m.Zero()}startDirectionFunction(R,N,q,u,M){q.position.subtractToRef(R.getTranslation(),this._tempVector),this._tempVector.normalize(),w.m.TransformNormalToRef(this._tempVector,M,this._tempVector);const v=(0,y.s)(-this.directionRandomizer/2,this.directionRandomizer/2);let G=Math.atan2(this._tempVector.x,this._tempVector.z);G+=(0,y.s)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=v,this._tempVector.x=Math.sin(G),this._tempVector.z=Math.cos(G),this._tempVector.normalize(),u?N.p(this._tempVector):w.m.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,R,N)}startPositionFunction(R,N,q,u){const M=(0,y.s)(-this.height/2,this.height/2),v=(0,y.s)(0,2*Math.PI),G=(0,y.s)((1-this.radiusRange)*(1-this.radiusRange),1),J=Math.sqrt(G)*this.i,a=J*Math.cos(v),j=J*Math.sin(v);u?N.Rd(a,M,j):w.m.TransformCoordinatesFromFloatsToRef(a,M,j,R,N)}clone(){const R=new H(this.i,this.directionRandomizer);return a.c.DeepCopy(this,R),R}applyToShader(R){R.setFloat("i",this.i),R.setFloat("height",this.height),R.setFloat("radiusRange",this.radiusRange),R.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(R){R.addUniform("i",1),R.addUniform("height",1),R.addUniform("radiusRange",1),R.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.i=this.i,R.height=this.height,R.radiusRange=this.radiusRange,R.directionRandomizer=this.directionRandomizer,R}parse(R){this.i=R.i,this.height=R.height,this.radiusRange=R.radiusRange,this.directionRandomizer=R.directionRandomizer}}class W extends H{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.m(0,1,0),M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new w.m(0,1,0);super(R,N,q),this.direction1=u,this.direction2=M}startDirectionFunction(R,N,q,u){const M=(0,y.s)(this.direction1.x,this.direction2.x),v=(0,y.s)(this.direction1.y,this.direction2.y),G=(0,y.s)(this.direction1.z,this.direction2.z);u?N.Rd(M,v,G):w.m.TransformNormalFromFloatsToRef(M,v,G,R,N)}clone(){const R=new W(this.i,this.height,this.radiusRange,this.direction1,this.direction2);return a.c.DeepCopy(this,R),R}applyToShader(R){R.setFloat("i",this.i),R.setFloat("height",this.height),R.setFloat("radiusRange",this.radiusRange),R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("i",1),R.addUniform("height",1),R.addUniform("radiusRange",1),R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const R=super.serialize();return R.direction1=this.direction1.de(),R.direction2=this.direction2.de(),R}parse(R){super.parse(R),w.m.FromArrayToRef(R.direction1,0,this.direction1),w.m.FromArrayToRef(R.direction2,0,this.direction2)}}class k{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=R,this.radiusRange=N,this.directionRandomizer=q}startDirectionFunction(R,N,q,u){const M=q.position.Vc(R.getTranslation()).normalize(),v=(0,y.s)(0,this.directionRandomizer),G=(0,y.s)(0,this.directionRandomizer),J=(0,y.s)(0,this.directionRandomizer);M.x+=v,M.y+=G,M.z+=J,M.normalize(),u?N.p(M):w.m.TransformNormalFromFloatsToRef(M.x,M.y,M.z,R,N)}startPositionFunction(R,N,q,u){const M=this.i-(0,y.s)(0,this.i*this.radiusRange),v=(0,y.s)(0,1),G=(0,y.s)(0,2*Math.PI),J=Math.acos(2*v-1),a=M*Math.cos(G)*Math.sin(J),j=M*Math.cos(J),F=M*Math.sin(G)*Math.sin(J);u?N.Rd(a,Math.abs(j),F):w.m.TransformCoordinatesFromFloatsToRef(a,Math.abs(j),F,R,N)}clone(){const R=new k(this.i,this.directionRandomizer);return a.c.DeepCopy(this,R),R}applyToShader(R){R.setFloat("i",this.i),R.setFloat("radiusRange",this.radiusRange),R.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(R){R.addUniform("i",1),R.addUniform("radiusRange",1),R.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.i=this.i,R.radiusRange=this.radiusRange,R.directionRandomizer=this.directionRandomizer,R}parse(R){this.i=R.i,this.radiusRange=R.radiusRange,this.directionRandomizer=R.directionRandomizer}}class C{constructor(){this.direction1=new w.m(0,1,0),this.direction2=new w.m(0,1,0)}startDirectionFunction(R,N,q,u){const M=(0,y.s)(this.direction1.x,this.direction2.x),v=(0,y.s)(this.direction1.y,this.direction2.y),G=(0,y.s)(this.direction1.z,this.direction2.z);u?N.Rd(M,v,G):w.m.TransformNormalFromFloatsToRef(M,v,G,R,N)}startPositionFunction(R,N,q,u){u?N.Rd(0,0,0):w.m.TransformCoordinatesFromFloatsToRef(0,0,0,R,N)}clone(){const R=new C;return a.c.DeepCopy(this,R),R}applyToShader(R){R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.direction1=this.direction1.de(),R.direction2=this.direction2.de(),R}parse(R){w.m.FromArrayToRef(R.direction1,0,this.direction1),w.m.FromArrayToRef(R.direction2,0,this.direction2)}}class e{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=R,this.radiusRange=N,this.directionRandomizer=q}startDirectionFunction(R,N,q,u){const M=q.position.Vc(R.getTranslation()).normalize(),v=(0,y.s)(0,this.directionRandomizer),G=(0,y.s)(0,this.directionRandomizer),J=(0,y.s)(0,this.directionRandomizer);M.x+=v,M.y+=G,M.z+=J,M.normalize(),u?N.p(M):w.m.TransformNormalFromFloatsToRef(M.x,M.y,M.z,R,N)}startPositionFunction(R,N,q,u){const M=this.i-(0,y.s)(0,this.i*this.radiusRange),v=(0,y.s)(0,1),G=(0,y.s)(0,2*Math.PI),J=Math.acos(2*v-1),a=M*Math.cos(G)*Math.sin(J),j=M*Math.cos(J),F=M*Math.sin(G)*Math.sin(J);u?N.Rd(a,j,F):w.m.TransformCoordinatesFromFloatsToRef(a,j,F,R,N)}clone(){const R=new e(this.i,this.directionRandomizer);return a.c.DeepCopy(this,R),R}applyToShader(R){R.setFloat("i",this.i),R.setFloat("radiusRange",this.radiusRange),R.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(R){R.addUniform("i",1),R.addUniform("radiusRange",1),R.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.i=this.i,R.radiusRange=this.radiusRange,R.directionRandomizer=this.directionRandomizer,R}parse(R){this.i=R.i,this.radiusRange=R.radiusRange,this.directionRandomizer=R.directionRandomizer}}class K extends e{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w.m(0,1,0),q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.m(0,1,0);super(R),this.direction1=N,this.direction2=q}startDirectionFunction(R,N){const q=(0,y.s)(this.direction1.x,this.direction2.x),u=(0,y.s)(this.direction1.y,this.direction2.y),M=(0,y.s)(this.direction1.z,this.direction2.z);w.m.TransformNormalFromFloatsToRef(q,u,M,R,N)}clone(){const R=new K(this.i,this.direction1,this.direction2);return a.c.DeepCopy(this,R),R}applyToShader(R){R.setFloat("i",this.i),R.setFloat("radiusRange",this.radiusRange),R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("i",1),R.addUniform("radiusRange",1),R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const R=super.serialize();return R.direction1=this.direction1.de(),R.direction2=this.direction2.de(),R}parse(R){super.parse(R),this.direction1.p(R.direction1),this.direction2.p(R.direction2)}}class r{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(R,N,q,u){const M=w.f.Od[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,q,M);const R=w.f.Od[1];M.subtractToRef(q.position,R),R.scaleToRef(1/q.lifeTime,M)}else M.set(0,0,0);u?N.p(M):w.m.TransformNormalToRef(M,R,N)}startPositionFunction(R,N,q,u){const M=w.f.Od[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,q,M):M.set(0,0,0),u?N.p(M):w.m.TransformCoordinatesToRef(M,R,N)}clone(){const R=new r;return a.c.DeepCopy(this,R),R}applyToShader(R){}buildUniformLayout(R){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const R={};return R.type=this.getClassName(),R.particlePositionGenerator=this.particlePositionGenerator,R.particleDestinationGenerator=this.particleDestinationGenerator,R}parse(R){R.particlePositionGenerator&&(this.particlePositionGenerator=R.particlePositionGenerator),R.particleDestinationGenerator&&(this.particleDestinationGenerator=R.particleDestinationGenerator)}}var Z=q(1227);class z{get mesh(){return this.oe}set mesh(R){this.oe!==R&&(this.oe=R,R?(this._indices=R.Md(),this._positions=R.getVerticesData(Z.e.PositionKind),this._normals=R.getVerticesData(Z.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=w.m.Zero(),this.oe=null,this.direction1=new w.m(0,1,0),this.direction2=new w.m(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=R}startDirectionFunction(R,N,q,u){if(this.useMeshNormalsForDirection&&this._normals)return void w.m.TransformNormalToRef(this._storedNormal,R,N);const M=(0,y.s)(this.direction1.x,this.direction2.x),v=(0,y.s)(this.direction1.y,this.direction2.y),G=(0,y.s)(this.direction1.z,this.direction2.z);u?N.Rd(M,v,G):w.m.TransformNormalFromFloatsToRef(M,v,G,R,N)}startPositionFunction(R,N,q,u){if(!this._indices||!this._positions)return;const M=3*Math.random()*(this._indices.length/3)|0,v=Math.random(),G=Math.random()*(1-v),J=1-v-G,y=this._indices[M],a=this._indices[M+1],j=this._indices[M+2],F=w.f.Od[0],S=w.f.Od[1],H=w.f.Od[2],W=w.f.Od[3];w.m.FromArrayToRef(this._positions,3*y,F),w.m.FromArrayToRef(this._positions,3*a,S),w.m.FromArrayToRef(this._positions,3*j,H),W.x=v*F.x+G*S.x+J*H.x,W.y=v*F.y+G*S.y+J*H.y,W.z=v*F.z+G*S.z+J*H.z,u?N.Rd(W.x,W.y,W.z):w.m.TransformCoordinatesFromFloatsToRef(W.x,W.y,W.z,R,N),this.useMeshNormalsForDirection&&this._normals&&(w.m.FromArrayToRef(this._normals,3*y,F),w.m.FromArrayToRef(this._normals,3*a,S),w.m.FromArrayToRef(this._normals,3*j,H),this._storedNormal.x=v*F.x+G*S.x+J*H.x,this._storedNormal.y=v*F.y+G*S.y+J*H.y,this._storedNormal.z=v*F.z+G*S.z+J*H.z)}clone(){const R=new z(this.mesh);return a.c.DeepCopy(this,R),R}applyToShader(R){R.setVector3("direction1",this.direction1),R.setVector3("direction2",this.direction2)}buildUniformLayout(R){R.addUniform("direction1",3),R.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var R;const N={};return N.type=this.getClassName(),N.direction1=this.direction1.de(),N.direction2=this.direction2.de(),N.meshId=null===(R=this.mesh)||void 0===R?void 0:R.id,N.useMeshNormalsForDirection=this.useMeshNormalsForDirection,N}parse(R,N){w.m.FromArrayToRef(R.direction1,0,this.direction1),w.m.FromArrayToRef(R.direction2,0,this.direction2),R.meshId&&N&&(this.mesh=N.getLastMeshById(R.meshId)),this.useMeshNormalsForDirection=R.useMeshNormalsForDirection}}var d=q(1073);class x{_isUbo(R){return void 0!==R.addUniform}constructor(R){this._isUbo(R)?(this.setMatrix3x3=R.updateMatrix3x3.bind(R),this.setMatrix2x2=R.updateMatrix2x2.bind(R),this.setFloat=R.updateFloat.bind(R),this.setFloat2=R.updateFloat2.bind(R),this.setFloat3=R.updateFloat3.bind(R),this.setFloat4=R.updateFloat4.bind(R),this.setFloatArray=R.updateFloatArray.bind(R),this.setArray=R.updateArray.bind(R),this.setIntArray=R.updateIntArray.bind(R),this.setMatrix=R.ve.bind(R),this.setMatrices=R.updateMatrices.bind(R),this.setVector3=R.updateVector3.bind(R),this.setVector4=R.updateVector4.bind(R),this.setColor3=R.updateColor3.bind(R),this.setColor4=R.updateColor4.bind(R),this.setDirectColor4=R.updateDirectColor4.bind(R),this.setInt=R.updateInt.bind(R),this.setInt2=R.updateInt2.bind(R),this.setInt3=R.updateInt3.bind(R),this.setInt4=R.updateInt4.bind(R)):(this.setMatrix3x3=R.setMatrix3x3.bind(R),this.setMatrix2x2=R.setMatrix2x2.bind(R),this.setFloat=R.setFloat.bind(R),this.setFloat2=R.setFloat2.bind(R),this.setFloat3=R.setFloat3.bind(R),this.setFloat4=R.setFloat4.bind(R),this.setFloatArray=R.setFloatArray.bind(R),this.setArray=R.setArray.bind(R),this.setIntArray=R.setIntArray.bind(R),this.setMatrix=R.setMatrix.bind(R),this.setMatrices=R.setMatrices.bind(R),this.setVector3=R.setVector3.bind(R),this.setVector4=R.setVector4.bind(R),this.setColor3=R.setColor3.bind(R),this.setColor4=R.setColor4.bind(R),this.setDirectColor4=R.setDirectColor4.bind(R),this.setInt=R.setInt.bind(R),this.setInt2=R.setInt2.bind(R),this.setInt3=R.setInt3.bind(R),this.setInt4=R.setInt4.bind(R))}}var E=q(1078);const P="gpuUpdateParticlesPixelShader",s="#version 300 es\nvoid main() {discard;}\n";E.b.ShadersStore[P]=s;const O="gpuUpdateParticlesVertexShader",L="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";E.b.ShadersStore[O]=L;(0,G.h)("BABYLON.WebGL2ParticleSystem",class{constructor(R,N){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=R,this._engine=N,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","i","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var R;return(null===(R=this._updateEffect)||void 0===R?void 0:R.isReady())??!1}createUpdateBuffer(R){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof r&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=R,this._updateEffect=new d.c("gpuUpdateParticles",this._updateEffectOptions,this._engine),new x(this._updateEffect)}createVertexBuffers(R,N){this._updateVAO.push(this._createUpdateVAO(R)),this._renderVAO.push(this._engine.recordVertexArrayObject(N,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=N}createParticleBuffer(R){return R}bindDrawBuffers(R,N,q){q?this._engine.bindBuffers(this._renderVertexBuffers,q,N):this._engine.bindVertexArrayObject(this._renderVAO[R],null)}preUpdateParticleBuffer(){const R=this._engine;if(this._engine.enableEffect(this._updateEffect),!R.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(R,N,q){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[R],null);const w=this._engine;w.bindTransformFeedbackBuffer(N.getBuffer()),w.setRasterizerState(!1),w.beginTransformFeedback(!0),w.drawArraysType(3,0,q),w.endTransformFeedback(),w.setRasterizerState(!0),w.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let R=0;R<this._updateVAO.length;R++)this._engine.releaseVertexArrayObject(this._updateVAO[R]);this._updateVAO.length=0;for(let R=0;R<this._renderVAO.length;R++)this._engine.releaseVertexArrayObject(this._renderVAO[R]);this._renderVAO.length=0}_createUpdateVAO(R){const N={};N.position=R.createVertexBuffer("position",0,3);let q=3;N.age=R.createVertexBuffer("age",q,1),q+=1,N.size=R.createVertexBuffer("size",q,3),q+=3,N.life=R.createVertexBuffer("life",q,1),q+=1,N.seed=R.createVertexBuffer("seed",q,4),q+=4,N.direction=R.createVertexBuffer("direction",q,3),q+=3,this._parent.particleEmitterType instanceof r&&(N.initialPosition=R.createVertexBuffer("initialPosition",q,3),q+=3),this._parent._colorGradientsTexture||(N.color=R.createVertexBuffer("color",q,4),q+=4),this._parent._isBillboardBased||(N.initialDirection=R.createVertexBuffer("initialDirection",q,3),q+=3),this._parent.noiseTexture&&(N.noiseCoordinates1=R.createVertexBuffer("noiseCoordinates1",q,3),q+=3,N.noiseCoordinates2=R.createVertexBuffer("noiseCoordinates2",q,3),q+=3),this._parent._angularSpeedGradientsTexture?(N.angle=R.createVertexBuffer("angle",q,1),q+=1):(N.angle=R.createVertexBuffer("angle",q,2),q+=2),this._parent._isAnimationSheetEnabled&&(N.cellIndex=R.createVertexBuffer("cellIndex",q,1),q+=1,this._parent.spriteRandomStartCell&&(N.cellStartOffset=R.createVertexBuffer("cellStartOffset",q,1),q+=1));const w=this._engine.recordVertexArrayObject(N,null,this._updateEffect);return this._engine.bindArrayBuffer(null),w}});class m{constructor(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,w=arguments.length>3?arguments[3]:void 0;this._engine=R,this._label=w,this._engine._storageBuffers.push(this),this._create(N,q)}_create(R,N){this._bufferSize=R,this._creationFlags=N,this._buffer=this._engine.createStorageBuffer(R,N,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(R,N,q){this._buffer&&this._engine.updateStorageBuffer(this._buffer,R,N,q)}read(R,N,q,w){return this._engine.readFromStorageBuffer(this._buffer,R,N,q,w)}dispose(){const R=this._engine._storageBuffers,N=R.indexOf(this);-1!==N&&(R[N]=R[R.length-1],R.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var o=q(942),A=q(947),n=q(1128),Q=q(933),Y=q(1294),T=q(1056),f=q(1112),c=q(1280);class b{constructor(){this._gpuTimeInFrameId=-1,this.counter=new c.b}_addDuration(R,N){R<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==R?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(N,!1),this._gpuTimeInFrameId=R):this.counter.addCount(N,!1))}}class I{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(R,N,q){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=R,this._engine=N,this.uniqueId=Y.c.UniqueId,N.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new b),this._engine.getCaps().supportComputeShaders?w.bindingsMapping?(this._context=N.createComputeContext(),this._shaderPath=q,this._options={bindingsMapping:{},defines:[],...w}):T.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):T.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(R,N){let q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const w=this._bindings[R];this._bindings[R]={type:q?0:4,object:N,indexInGroupEntries:null===w||void 0===w?void 0:w.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!w||w.object!==N||w.type!==this._bindings[R].type)}setStorageTexture(R,N){const q=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!q||q.object!==N),this._bindings[R]={type:1,object:N,indexInGroupEntries:null===q||void 0===q?void 0:q.indexInGroupEntries}}setExternalTexture(R,N){const q=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!q||q.object!==N),this._bindings[R]={type:6,object:N,indexInGroupEntries:null===q||void 0===q?void 0:q.indexInGroupEntries}}setVideoTexture(R,N){return!!N.externalTexture&&(this.setExternalTexture(R,N.externalTexture),!0)}setUniformBuffer(R,N){const q=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!q||q.object!==N),this._bindings[R]={type:I._BufferIsDataBuffer(N)?7:2,object:N,indexInGroupEntries:null===q||void 0===q?void 0:q.indexInGroupEntries}}setStorageBuffer(R,N){const q=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!q||q.object!==N),this._bindings[R]={type:I._BufferIsDataBuffer(N)?7:3,object:N,indexInGroupEntries:null===q||void 0===q?void 0:q.indexInGroupEntries}}setTextureSampler(R,N){const q=this._bindings[R];this._contextIsDirty||(this._contextIsDirty=!q||!N.compareSampler(q.object)),this._bindings[R]={type:5,object:N,indexInGroupEntries:null===q||void 0===q?void 0:q.indexInGroupEntries}}isReady(){let R=this._effect;for(const u in this._bindings){const R=this._bindings[u],N=R.type,q=R.object;switch(N){case 0:case 4:case 1:if(!q.isReady())return!1;break;case 6:if(!q.isReady())return!1;break}}const N=[],q=this._shaderPath;if(this._options.defines)for(let u=0;u<this._options.defines.length;u++)N.push(this._options.defines[u]);const w=N.join("\n");return this._cachedDefines!==w&&(this._cachedDefines=w,R=this._engine.createComputeEffect(q,{defines:w,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=R),!!R.isReady()}dispatch(R,N,q){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,R,N,q,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const q=I._BufferIsDataBuffer(R)?R:R.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,q,N,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const N in this._bindings){const q=this._bindings[N];if(!this._options.bindingsMapping[N])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+N+"'");switch(q.type){case 0:{const w=this._samplers[N],u=q.object;var R;if(!w||!u._texture||!w.compareSampler(u._texture))this._samplers[N]=(new f.e).setParameters(u.wrapU,u.wrapV,u.wrapR,u.anisotropicFilteringLevel,u._texture.samplingMode,null===(R=u._texture)||void 0===R?void 0:R._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const R=q.object;R.getBuffer()!==q.buffer&&(q.buffer=R.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(R,N,q){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((u=>{const M=()=>{this.dispatch(R,N,q)?u():setTimeout(M,w)};M()}))}serialize(){const R=n.e.Serialize(this);R.options=this._options,R.shaderPath=this._shaderPath,R.yj={},R.textures={};for(const N in this._bindings){const q=this._bindings[N],w=q.object;switch(q.type){case 0:case 4:case 1:{const u=w.serialize();u&&(R.textures[N]=u,R.yj[N]={type:q.type});break}}}return R}static Parse(R,N,q){const w=n.e.Parse((()=>new I(R.name,N.getEngine(),R.shaderPath,R.options)),R,N,q);for(const u in R.textures){const M=R.yj[u],v=Q.e.Parse(R.textures[u],N,q);0===M.type?w.setTexture(u,v):4===M.type?w.setTexture(u,v,!1):w.setStorageTexture(u,v)}return w}static _BufferIsDataBuffer(R){return void 0!==R.underlyingResource}}(0,o.b)([(0,A.E)()],I.prototype,"name",void 0),(0,o.b)([(0,A.E)()],I.prototype,"fastMode",void 0),(0,G.h)("BABYLON.ComputeShader",I);var V=q(1215);const t="gpuUpdateParticlesComputeShader",i="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";E.b.ShadersStoreWGSL[t]=i;(0,G.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(R,N){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=R,this._engine=N}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var R;return(null===(R=this._updateComputeShader)||void 0===R?void 0:R.isReady())??!1}createUpdateBuffer(R){var N;const q={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(q.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(q.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(q.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(q.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(q.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(q.noiseTexture={group:1,binding:11}),this._updateComputeShader=new I("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:q,defines:R.split("\n")}),null===(N=this._simParamsComputeShader)||void 0===N||N.dispose(),this._simParamsComputeShader=new V.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new x(this._simParamsComputeShader)}createVertexBuffers(R,N){this._renderVertexBuffers.push(N)}createParticleBuffer(R){const N=new m(this._engine,4*R.length,11,"ComputeShaderParticleSystemBuffer");return N.update(R),this._bufferComputeShader.push(N),N.getBuffer()}bindDrawBuffers(R,N,q){this._engine.bindBuffers(this._renderVertexBuffers[R],q,N)}preUpdateParticleBuffer(){}updateParticleBuffer(R,N,q){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[R]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^R]),this._updateComputeShader.dispatch(Math.ceil(q/64))}releaseBuffers(){var R;for(let N=0;N<this._bufferComputeShader.length;++N)this._bufferComputeShader[N].dispose();this._bufferComputeShader.length=0,null===(R=this._simParamsComputeShader)||void 0===R||R.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class g{constructor(R,N,q){this.gradient=R,this.color1=N,this.color2=q}getColorToRef(R){this.color2?v.d.LerpToRef(this.color1,this.color2,Math.random(),R):R.p(this.color1)}}class U{constructor(R,N){this.gradient=R,this.color=N}}class B{constructor(R,N,q){this.gradient=R,this.factor1=N,this.factor2=q}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class l{static GetCurrentGradient(R,N,q){if(N[0].gradient>R)return void q(N[0],N[0],1);for(let u=0;u<N.length-1;u++){const w=N[u],M=N[u+1];if(R>=w.gradient&&R<=M.gradient){return void q(w,M,(R-w.gradient)/(M.gradient-w.gradient))}}const w=N.length-1;q(N[w],N[w],1)}}var X=q(959),h=q(11545),D=q(997);class p{constructor(R){this.particleSystem=R,this.position=w.m.Zero(),this.direction=w.m.Zero(),this.color=new v.d(0,0,0,0),this.colorStep=new v.d(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new w.j(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new v.d(0,0,0,0),this._currentColor2=new v.d(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=p._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let R=this.age,N=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===N?(N=1,R=this._randomCellOffset):R+=this._randomCellOffset);const q=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let w;w=this._initialSpriteCellLoop?(0,y.b)(R*N%this.lifeTime/this.lifeTime):(0,y.b)(R*N/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+w*q|0}_inheritParticleInfoToSubEmitter(R){if(R.particleSystem.k.position){const N=R.particleSystem.k;if(N.position.p(this.position),R.inheritDirection){const R=w.f.Od[0];this.direction.normalizeToRef(R),N.setDirection(R,0,Math.PI/2)}}else{R.particleSystem.k.p(this.position)}this.direction.scaleToRef(R.inheritedVelocityAmount/2,w.f.Od[0]),R.particleSystem._inheritedVelocityOffset.p(w.f.Od[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((R=>{this._inheritParticleInfoToSubEmitter(R)}))}_reset(){this.age=0,this.id=p._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(R){R.position.p(this.position),this._initialDirection?R._initialDirection?R._initialDirection.p(this._initialDirection):R._initialDirection=this._initialDirection.clone():R._initialDirection=null,R.direction.p(this.direction),this.Dg&&(R.Dg?R.Dg.p(this.Dg):R.Dg=this.Dg.clone()),R.color.p(this.color),R.colorStep.p(this.colorStep),R.lifeTime=this.lifeTime,R.age=this.age,R._randomCellOffset=this._randomCellOffset,R.size=this.size,R.scale.p(this.scale),R.angle=this.angle,R.angularSpeed=this.angularSpeed,R.particleSystem=this.particleSystem,R.cellIndex=this.cellIndex,R.id=this.id,R._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(R._currentColorGradient=this._currentColorGradient,R._currentColor1.p(this._currentColor1),R._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(R._currentSizeGradient=this._currentSizeGradient,R._currentSize1=this._currentSize1,R._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(R._currentAngularSpeedGradient=this._currentAngularSpeedGradient,R._currentAngularSpeed1=this._currentAngularSpeed1,R._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(R._currentVelocityGradient=this._currentVelocityGradient,R._currentVelocity1=this._currentVelocity1,R._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(R._currentLimitVelocityGradient=this._currentLimitVelocityGradient,R._currentLimitVelocity1=this._currentLimitVelocity1,R._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(R._currentDragGradient=this._currentDragGradient,R._currentDrag1=this._currentDrag1,R._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(R._initialStartSpriteCellID=this._initialStartSpriteCellID,R._initialEndSpriteCellID=this._initialEndSpriteCellID,R._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(R.remapData&&this.remapData?R.remapData.p(this.remapData):R.remapData=new w.n(0,0,0,0)),this._randomNoiseCoordinates1&&(R._randomNoiseCoordinates1?(R._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),R._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(R._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),R._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}p._Count=0;var RR=q(1344),NR=(q(1427),q(1357)),qR=q(1353),wR=q(1206);class uR extends J{set onDispose(R){this._onDisposeObserver&&this.Zd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Zd.add(R)}get useRampGradients(){return this._useRampGradients}set useRampGradients(R){this._useRampGradients!==R&&(this._useRampGradients=R,this._resetEffect())}get particles(){return this.tj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.tj.length}getClassName(){return"_e"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var R;let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(R=this._customWrappers[N])||void 0===R?void 0:R.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[R]??this._customWrappers[0]}setCustomEffect(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[N]=new RR.d(this._engine),this._customWrappers[N].effect=R,this._customWrappers[N].drawContext&&(this._customWrappers[N].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new X.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(R,N,q){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4&&void 0!==arguments[4]&&arguments[4],G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(R),this._emitterInverseWorldMatrix=w.c.Identity(),this._inheritedVelocityOffset=new w.m,this.Zd=new X.c,this.onStoppedObservable=new X.c,this.tj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new v.d(0,0,0,0),this._colorDiff=new v.d(0,0,0,0),this._scaledDirection=w.m.Zero(),this._scaledGravity=w.m.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=R=>{},this.recycleParticle=R=>{const N=this.tj.pop();N!==R&&N.copyTo(R),this._stockParticles.push(N)},this._createParticle=()=>{let R;return 0!==this._stockParticles.length?(R=this._stockParticles.pop(),R._reset()):R=new p(this),this._prepareParticle(R),R},this._shadersLoaded=!1,this._capacity=N,this._epsilon=G,this._isAnimationSheetEnabled=M,q&&"Scene"!==q.getClassName()?(this._engine=q,this.defaultProjectionMatrix=w.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=q||D.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.he.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new RR.d(this._engine)},this._customWrappers[0].effect=u,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new j;let J=null;this.updateFunction=R=>{let N=null;var q;this.noiseTexture&&(N=this.noiseTexture.getSize(),null===(q=this.noiseTexture.getContent())||void 0===q||q.then((R=>{J=R})));const u=R===this.tj;for(let M=0;M<R.length;M++){const q=R[M];let G=this._scaledUpdateSpeed;const a=q.age;if(q.age+=G,q.age>q.lifeTime){const R=q.age-a;G=(q.lifeTime-a)*G/R,q.age=q.lifeTime}const j=q.age/q.lifeTime;this._colorGradients&&this._colorGradients.length>0?l.GetCurrentGradient(j,this._colorGradients,((R,N,w)=>{R!==q._currentColorGradient&&(q._currentColor1.p(q._currentColor2),N.getColorToRef(q._currentColor2),q._currentColorGradient=R),v.d.LerpToRef(q._currentColor1,q._currentColor2,w,q.color)})):(q.colorStep.scaleToRef(G,this._scaledColorStep),q.color.addInPlace(this._scaledColorStep),q.color.a<0&&(q.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&l.GetCurrentGradient(j,this._angularSpeedGradients,((R,N,w)=>{R!==q._currentAngularSpeedGradient&&(q._currentAngularSpeed1=q._currentAngularSpeed2,q._currentAngularSpeed2=N.getFactor(),q._currentAngularSpeedGradient=R),q.angularSpeed=(0,y.o)(q._currentAngularSpeed1,q._currentAngularSpeed2,w)})),q.angle+=q.angularSpeed*G;let F=G;if(this._velocityGradients&&this._velocityGradients.length>0&&l.GetCurrentGradient(j,this._velocityGradients,((R,N,w)=>{R!==q._currentVelocityGradient&&(q._currentVelocity1=q._currentVelocity2,q._currentVelocity2=N.getFactor(),q._currentVelocityGradient=R),F*=(0,y.o)(q._currentVelocity1,q._currentVelocity2,w)})),q.direction.scaleToRef(F,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&l.GetCurrentGradient(j,this._limitVelocityGradients,((R,N,w)=>{R!==q._currentLimitVelocityGradient&&(q._currentLimitVelocity1=q._currentLimitVelocity2,q._currentLimitVelocity2=N.getFactor(),q._currentLimitVelocityGradient=R);const u=(0,y.o)(q._currentLimitVelocity1,q._currentLimitVelocity2,w);q.direction.length()>u&&q.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&l.GetCurrentGradient(j,this._dragGradients,((R,N,w)=>{R!==q._currentDragGradient&&(q._currentDrag1=q._currentDrag2,q._currentDrag2=N.getFactor(),q._currentDragGradient=R);const u=(0,y.o)(q._currentDrag1,q._currentDrag2,w);this._scaledDirection.scaleInPlace(1-u)})),this.isLocal&&q.Dg?(q.Dg.addInPlace(this._scaledDirection),w.m.TransformCoordinatesToRef(q.Dg,this._emitterWorldMatrix,q.position)):q.position.addInPlace(this._scaledDirection),J&&N&&q._randomNoiseCoordinates1){const R=this._fetchR(q._randomNoiseCoordinates1.x,q._randomNoiseCoordinates1.y,N.width,N.height,J),u=this._fetchR(q._randomNoiseCoordinates1.z,q._randomNoiseCoordinates2.x,N.width,N.height,J),M=this._fetchR(q._randomNoiseCoordinates2.y,q._randomNoiseCoordinates2.z,N.width,N.height,J),v=w.f.Od[0],y=w.f.Od[1];v.Rd((2*R-1)*this.noiseStrength.x,(2*u-1)*this.noiseStrength.y,(2*M-1)*this.noiseStrength.z),v.scaleToRef(G,y),q.direction.addInPlace(y)}this.gravity.scaleToRef(G,this._scaledGravity),q.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&l.GetCurrentGradient(j,this._sizeGradients,((R,N,w)=>{R!==q._currentSizeGradient&&(q._currentSize1=q._currentSize2,q._currentSize2=N.getFactor(),q._currentSizeGradient=R),q.size=(0,y.o)(q._currentSize1,q._currentSize2,w)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&l.GetCurrentGradient(j,this._colorRemapGradients,((R,N,w)=>{const u=(0,y.o)(R.factor1,N.factor1,w),M=(0,y.o)(R.factor2,N.factor2,w);q.remapData.x=u,q.remapData.y=M-u})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&l.GetCurrentGradient(j,this._alphaRemapGradients,((R,N,w)=>{const u=(0,y.o)(R.factor1,N.factor1,w),M=(0,y.o)(R.factor2,N.factor2,w);q.remapData.z=u,q.remapData.w=M-u}))),this._isAnimationSheetEnabled&&q.updateCellIndex(),q._inheritParticleInfoToSubEmitters(),q.age>=q.lifeTime&&(this._emitFromParticle(q),q._attachedSubEmitters&&(q._attachedSubEmitters.forEach((R=>{R.particleSystem.disposeOnStop=!0,R.particleSystem.stop()})),q._attachedSubEmitters=null),this.recycleParticle(q),u&&M--)}}}serialize(R){throw new Error("Method not implemented.")}clone(R,N){throw new Error("Method not implemented.")}_addFactorGradient(R,N,q,w){const u=new B(N,q,w);R.push(u),R.sort(((R,N)=>R.gradient<N.gradient?-1:R.gradient>N.gradient?1:0))}_removeFactorGradient(R,N){if(!R)return;let q=0;for(const w of R){if(w.gradient===N){R.splice(q,1);break}q++}}addLifeTimeGradient(R,N,q){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,R,N,q),this}removeLifeTimeGradient(R){return this._removeFactorGradient(this._lifeTimeGradients,R),this}addSizeGradient(R,N,q){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,R,N,q),this}removeSizeGradient(R){return this._removeFactorGradient(this._sizeGradients,R),this}addColorRemapGradient(R,N,q){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,R,N,q),this}removeColorRemapGradient(R){return this._removeFactorGradient(this._colorRemapGradients,R),this}addAlphaRemapGradient(R,N,q){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,R,N,q),this}removeAlphaRemapGradient(R){return this._removeFactorGradient(this._alphaRemapGradients,R),this}addAngularSpeedGradient(R,N,q){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,R,N,q),this}removeAngularSpeedGradient(R){return this._removeFactorGradient(this._angularSpeedGradients,R),this}addVelocityGradient(R,N,q){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,R,N,q),this}removeVelocityGradient(R){return this._removeFactorGradient(this._velocityGradients,R),this}addLimitVelocityGradient(R,N,q){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,R,N,q),this}removeLimitVelocityGradient(R){return this._removeFactorGradient(this._limitVelocityGradients,R),this}addDragGradient(R,N,q){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,R,N,q),this}removeDragGradient(R){return this._removeFactorGradient(this._dragGradients,R),this}addEmitRateGradient(R,N,q){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,R,N,q),this}removeEmitRateGradient(R){return this._removeFactorGradient(this._emitRateGradients,R),this}addStartSizeGradient(R,N,q){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,R,N,q),this}removeStartSizeGradient(R){return this._removeFactorGradient(this._startSizeGradients,R),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const R=new Uint8Array(4*this._rawTextureWidth),N=v.g.Be[0];for(let q=0;q<this._rawTextureWidth;q++){const w=q/this._rawTextureWidth;l.GetCurrentGradient(w,this._rampGradients,((w,u,M)=>{v.c.LerpToRef(w.color,u.color,M,N),R[4*q]=255*N.r,R[4*q+1]=255*N.g,R[4*q+2]=255*N.b,R[4*q+3]=255}))}this._rampGradientsTexture=h.c.CreateRGBATexture(R,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((R,N)=>R.gradient<N.gradient?-1:R.gradient>N.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(R,N){this._rampGradients||(this._rampGradients=[]);const q=new U(R,N);return this._rampGradients.push(q),this._syncRampGradientTexture(),this}removeRampGradient(R){return this._removeGradientAndTexture(R,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(R,N,q){this._colorGradients||(this._colorGradients=[]);const w=new g(R,N,q);return this._colorGradients.push(w),this._colorGradients.sort(((R,N)=>R.gradient<N.gradient?-1:R.gradient>N.gradient?1:0)),this}removeColorGradient(R){if(!this._colorGradients)return this;let N=0;for(const q of this._colorGradients){if(q.gradient===R){this._colorGradients.splice(N,1);break}N++}return this}resetDrawCache(){for(const R of this._drawWrappers)if(R)for(const N of R)null===N||void 0===N||N.dispose();this._drawWrappers=[]}_fetchR(R,N,q,w,u){return u[4*(((R=.5*Math.abs(R)+.5)*q%q|0)+((N=.5*Math.abs(N)+.5)*w%w|0)*q)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const R=this._engine,N=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*N),this._vertexBuffer=new Z.b(R,this._vertexData,!0,N);let q=0;const w=this._vertexBuffer.createVertexBuffer(Z.e.PositionKind,q,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Z.e.PositionKind]=w,q+=3;const u=this._vertexBuffer.createVertexBuffer(Z.e.ColorKind,q,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Z.e.ColorKind]=u,q+=4;const M=this._vertexBuffer.createVertexBuffer("angle",q,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=M,q+=1;const v=this._vertexBuffer.createVertexBuffer("size",q,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=v,q+=2,this._isAnimationSheetEnabled){const R=this._vertexBuffer.createVertexBuffer("cellIndex",q,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=R,q+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const R=this._vertexBuffer.createVertexBuffer("direction",q,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=R,q+=3}if(this._useRampGradients){const R=this._vertexBuffer.createVertexBuffer("remapData",q,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=R,q+=4}let G;if(this._useInstancing){const N=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new Z.b(R,N,!1,2),G=this._spriteBuffer.createVertexBuffer("offset",0,2)}else G=this._vertexBuffer.createVertexBuffer("offset",q,2,this._vertexBufferSize,this._useInstancing),q+=2;this._vertexBuffers.offset=G,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const R=[],N=[];let q=0;for(let w=0;w<this._capacity;w++)R.push(q),R.push(q+1),R.push(q+2),R.push(q),R.push(q+2),R.push(q+3),N.push(q,q+1,q+1,q+2,q+2,q+3,q+3,q,q,q+3),q+=4;this._indexBuffer=this._engine.createIndexBuffer(R),this._linesIndexBuffer=this._engine.createIndexBuffer(N)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(R)setTimeout((()=>{this.start(0)}),R);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var N;-1!==(null===(N=this.k)||void 0===N?void 0:N.getClassName().indexOf("Mesh"))&&this.k.je(!0);const R=this.noiseTexture;if(R&&R.onGeneratedObservable)R.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let N=0;N<this.preWarmCycles;N++)this.animate(!0),R.render()}))}));else for(let N=0;N<this.preWarmCycles;N++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(R))}_postStop(R){}reset(){this._stockParticles.length=0,this.tj.length=0}_appendParticleVertex(R,N,q,u){let M=R*this._vertexBufferSize;if(this._vertexData[M++]=N.position.x+this.zg.x,this._vertexData[M++]=N.position.y+this.zg.y,this._vertexData[M++]=N.position.z+this.zg.z,this._vertexData[M++]=N.color.r,this._vertexData[M++]=N.color.g,this._vertexData[M++]=N.color.b,this._vertexData[M++]=N.color.a,this._vertexData[M++]=N.angle,this._vertexData[M++]=N.scale.x*N.size,this._vertexData[M++]=N.scale.y*N.size,this._isAnimationSheetEnabled&&(this._vertexData[M++]=N.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[M++]=N.direction.x,this._vertexData[M++]=N.direction.y,this._vertexData[M++]=N.direction.z);else if(N._initialDirection){let R=N._initialDirection;this.isLocal&&(w.m.TransformNormalToRef(R,this._emitterWorldMatrix,w.f.Od[0]),R=w.f.Od[0]),0===R.x&&0===R.z&&(R.x=.001),this._vertexData[M++]=R.x,this._vertexData[M++]=R.y,this._vertexData[M++]=R.z}else{let R=N.direction;this.isLocal&&(w.m.TransformNormalToRef(R,this._emitterWorldMatrix,w.f.Od[0]),R=w.f.Od[0]),0===R.x&&0===R.z&&(R.x=.001),this._vertexData[M++]=R.x,this._vertexData[M++]=R.y,this._vertexData[M++]=R.z}this._useRampGradients&&N.remapData&&(this._vertexData[M++]=N.remapData.x,this._vertexData[M++]=N.remapData.y,this._vertexData[M++]=N.remapData.z,this._vertexData[M++]=N.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===q?q=this._epsilon:1===q&&(q=1-this._epsilon),0===u?u=this._epsilon:1===u&&(u=1-this._epsilon)),this._vertexData[M++]=q,this._vertexData[M++]=u)}_prepareParticle(R){}_update(R){if(this._alive=this.tj.length>0,this.k.position){const R=this.k;this._emitterWorldMatrix=R.getWorldMatrix()}else{const R=this.k;this._emitterWorldMatrix=w.c.Translation(R.x,R.y,R.z)}let N;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.tj);for(let q=0;q<R&&this.tj.length!==this._capacity;q++){if(N=this._createParticle(),this.tj.push(N),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const R=(0,y.b)(this._actualFrame/this.targetStopDuration);l.GetCurrentGradient(R,this._lifeTimeGradients,((q,w)=>{const u=q,M=w,v=u.getFactor(),G=M.getFactor(),J=(R-u.gradient)/(M.gradient-u.gradient);N.lifeTime=(0,y.o)(v,G,J)}))}else N.lifeTime=(0,y.s)(this.minLifeTime,this.maxLifeTime);const R=(0,y.s)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,N.position,N,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,N.position,N,this.isLocal),this.isLocal&&(N.Dg?N.Dg.p(N.position):N.Dg=N.position.clone(),w.m.TransformCoordinatesToRef(N.Dg,this._emitterWorldMatrix,N.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,N.direction,N,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,N.direction,N,this.isLocal,this._emitterInverseWorldMatrix),0===R?N._initialDirection?N._initialDirection.p(N.direction):N._initialDirection=N.direction.clone():N._initialDirection=null,N.direction.scaleInPlace(R),this._sizeGradients&&0!==this._sizeGradients.length?(N._currentSizeGradient=this._sizeGradients[0],N._currentSize1=N._currentSizeGradient.getFactor(),N.size=N._currentSize1,this._sizeGradients.length>1?N._currentSize2=this._sizeGradients[1].getFactor():N._currentSize2=N._currentSize1):N.size=(0,y.s)(this.minSize,this.maxSize),N.scale.Rd((0,y.s)(this.minScaleX,this.maxScaleX),(0,y.s)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const R=this._actualFrame/this.targetStopDuration;l.GetCurrentGradient(R,this._startSizeGradients,((R,q,w)=>{R!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=q.getFactor(),this._currentStartSizeGradient=R);const u=(0,y.o)(this._currentStartSize1,this._currentStartSize2,w);N.scale.scaleInPlace(u)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(N._currentAngularSpeedGradient=this._angularSpeedGradients[0],N.angularSpeed=N._currentAngularSpeedGradient.getFactor(),N._currentAngularSpeed1=N.angularSpeed,this._angularSpeedGradients.length>1?N._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():N._currentAngularSpeed2=N._currentAngularSpeed1):N.angularSpeed=(0,y.s)(this.minAngularSpeed,this.maxAngularSpeed),N.angle=(0,y.s)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(N._currentVelocityGradient=this._velocityGradients[0],N._currentVelocity1=N._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?N._currentVelocity2=this._velocityGradients[1].getFactor():N._currentVelocity2=N._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(N._currentLimitVelocityGradient=this._limitVelocityGradients[0],N._currentLimitVelocity1=N._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?N._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():N._currentLimitVelocity2=N._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(N._currentDragGradient=this._dragGradients[0],N._currentDrag1=N._currentDragGradient.getFactor(),this._dragGradients.length>1?N._currentDrag2=this._dragGradients[1].getFactor():N._currentDrag2=N._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)N._currentColorGradient=this._colorGradients[0],N._currentColorGradient.getColorToRef(N.color),N._currentColor1.p(N.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(N._currentColor2):N._currentColor2.p(N.color);else{const R=(0,y.s)(0,1);v.d.LerpToRef(this.color1,this.color2,R,N.color),this.colorDead.subtractToRef(N.color,this._colorDiff),this._colorDiff.scaleToRef(1/N.lifeTime,N.colorStep)}this._isAnimationSheetEnabled&&(N._initialStartSpriteCellID=this.startSpriteCellID,N._initialEndSpriteCellID=this.endSpriteCellID,N._initialSpriteCellLoop=this.spriteCellLoop),N.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(N.remapData=new w.n(0,1,0,1)),this.noiseTexture&&(N._randomNoiseCoordinates1?(N._randomNoiseCoordinates1.Rd(Math.random(),Math.random(),Math.random()),N._randomNoiseCoordinates2.Rd(Math.random(),Math.random(),Math.random())):(N._randomNoiseCoordinates1=new w.m(Math.random(),Math.random(),Math.random()),N._randomNoiseCoordinates2=new w.m(Math.random(),Math.random(),Math.random()))),N._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w=[Z.e.PositionKind,Z.e.ColorKind,"angle","offset","size"];return R&&w.push("cellIndex"),N||w.push("direction"),q&&w.push("remapData"),w}static _GetEffectCreationOptions(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,NR.c)(w),R&&w.push("particlesInfos"),N&&w.push("logarithmicDepthConstant"),q&&(w.push("vFogInfos"),w.push("vFogColor")),w}fillDefines(R,N){let q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,NR.h)(this,this._scene,R),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&R.push("#define FOG")),this._isAnimationSheetEnabled&&R.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&R.push("#define LOGARITHMICDEPTH"),N===J.BLENDMODE_MULTIPLY&&R.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&R.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(R.push("#define BILLBOARD"),this.billboardMode){case 2:R.push("#define BILLBOARDY");break;case 8:case 9:R.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&R.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:R.push("#define BILLBOARDMODE_ALL")}q&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),R.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(R,N,q){N.push(...uR._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),R.push(...uR._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),q.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,wR.f)(R,this._imageProcessingConfigurationDefines),(0,wR.c)(q,this._imageProcessingConfigurationDefines))}_getWrapper(R){const N=this._getCustomDrawWrapper(R);if(null!==N&&void 0!==N&&N.effect)return N;const q=[];this.fillDefines(q,R);const w=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let u=this._drawWrappers[w];u||(u=this._drawWrappers[w]=[]);let M=u[R];M||(M=new RR.d(this._engine),M.drawContext&&(M.drawContext.useInstancing=this._useInstancing),u[R]=M);const v=q.join("\n");if(M.defines!==v){const R=[],N=[],q=[];this.fillUniformsAttributesAndSamplerNames(N,R,q),M.setEffect(this._engine.createEffect("particles",R,N,q,v,void 0,void 0,void 0,void 0,this._shaderLanguage),v)}return M}animate(){var R;let N,q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!q&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(q?this.preWarmStepOffset:(null===(R=this._scene)||void 0===R?void 0:R.getAnimationRatio())||1),this.manualEmitCount>-1)N=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let R=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const N=this._actualFrame/this.targetStopDuration;l.GetCurrentGradient(N,this._emitRateGradients,((N,q,w)=>{N!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=q.getFactor(),this._currentEmitRateGradient=N),R=(0,y.o)(this._currentEmitRate1,this._currentEmitRate2,w)}))}N=R*this._scaledUpdateSpeed|0,this._newPartsExcess+=R*this._scaledUpdateSpeed-N}if(this._newPartsExcess>1&&(N+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?N=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(N),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!q){let R=0;for(let N=0;N<this.tj.length;N++){const q=this.tj[N];this._appendParticleVertices(R,q),R+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.tj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(R,N){this._appendParticleVertex(R++,N,0,0),this._useInstancing||(this._appendParticleVertex(R++,N,1,0),this._appendParticleVertex(R++,N,1,1),this._appendParticleVertex(R++,N,0,1))}rebuild(){var R;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(R=this._spriteBuffer)||void 0===R||R._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!uR.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(q.bind(q,11588)),Promise.resolve().then(q.bind(q,11580))])):await Promise.all([Promise.resolve().then(q.bind(q,11573)),Promise.resolve().then(q.bind(q,11566))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==J.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(J.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(J.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(R){const N=this._getWrapper(R),q=N.effect,u=this._engine;u.enableEffect(N);const M=this.defaultViewMatrix??this._scene.getViewMatrix();if(q.setTexture("diffuseSampler",this.particleTexture),q.setMatrix("view",M),q.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const R=this.particleTexture.getBaseSize();q.setFloat3("particlesInfos",this.spriteCellWidth/R.width,this.spriteCellHeight/R.height,this.spriteCellWidth/R.width)}if(q.setVector2("translationPivot",this.translationPivot),q.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const R=this._scene.activeCamera;q.setVector3("eyePosition",R.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),q.setTexture("rampSampler",this._rampGradientsTexture));const v=q.defines;var G,y,a,j,F,S;(this._scene&&((0,NR.d)(q,this,this._scene),this.applyFog&&(0,qR.g)(this._scene,void 0,q)),v.indexOf("#define BILLBOARDMODE_ALL")>=0&&(M.invertToRef(w.f.Matrix[0]),q.setMatrix("invView",w.f.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?u.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,q):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,q)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?u.bindBuffers(this._vertexBuffers,null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?this._linesIndexBuffer:this._indexBuffer,q):u.bindBuffers(this._vertexBuffers,null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?this._linesIndexBufferUseInstancing:null,q);switch(this.useLogarithmicDepth&&this._scene&&(0,qR.m)(v,q,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(q),R){case J.BLENDMODE_ADD:u.setAlphaMode(1);break;case J.BLENDMODE_ONEONE:u.setAlphaMode(6);break;case J.BLENDMODE_STANDARD:u.setAlphaMode(2);break;case J.BLENDMODE_MULTIPLY:u.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(q),this._useInstancing)?null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?u.drawElementsType(6,0,10,this.tj.length):u.drawArraysType(7,0,4,this.tj.length):null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?u.drawElementsType(1,0,10*this.tj.length):u.drawElementsType(0,0,6*this.tj.length);return this.tj.length}render(){if(!this.isReady()||!this.tj.length)return 0;const R=this._engine;R.setState&&(R.setState(!1),this.forceDepthWrite&&R.setDepthWrite(!0));let N=0;return N=this.blendMode===J.BLENDMODE_MULTIPLYADD?this._render(J.BLENDMODE_MULTIPLY)+this._render(J.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),N}_onDispose(){}dispose(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),R&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),R&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(N,q),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const R=this._scene.he.indexOf(this);R>-1&&this._scene.he.splice(R,1),this._scene._activeParticleSystems.dispose()}this.Zd.notifyObservers(this),this.Zd.clear(),this.onStoppedObservable.clear(),this.reset()}}uR.ForceGLSL=!1;var MR,vR=q(1044);!function(R){R[R.ATTACHED=0]="ATTACHED",R[R.END=1]="END"}(MR||(MR={}));class GR{constructor(R){if(this.particleSystem=R,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!R.k||!R.k.dispose){const N=(0,G.e)("BABYLON.AbstractMesh");R.k=new N("SubemitterSystemEmitter",R.va()),R._disposeEmitterOnDispose=!0}}clone(){let R=this.particleSystem.k;if(R){if(R instanceof w.m)R=R.clone();else if(-1!==R.getClassName().indexOf("Mesh")){R=new((0,G.e)("BABYLON.Mesh"))("",R.va()),R.isVisible=!1}}else R=new w.m;const N=new GR(this.particleSystem.clone(this.particleSystem.name,R));return N.particleSystem.name+="Clone",N.type=this.type,N.inheritDirection=this.inheritDirection,N.inheritedVelocityAmount=this.inheritedVelocityAmount,N.particleSystem._disposeEmitterOnDispose=!0,N.particleSystem.disposeOnStop=!0,N}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const N={};return N.type=this.type,N.inheritDirection=this.inheritDirection,N.inheritedVelocityAmount=this.inheritedVelocityAmount,N.particleSystem=this.particleSystem.serialize(R),N}static _ParseParticleSystem(R,N,q){throw(0,vR.c)("ParseParticle")}static Parse(R,N,q){const w=R.particleSystem,u=new GR(GR._ParseParticleSystem(w,N,q,!0));return u.type=R.type,u.inheritDirection=R.inheritDirection,u.inheritedVelocityAmount=R.inheritedVelocityAmount,u.particleSystem._isSubEmitter=!0,u}dispose(){this.particleSystem.dispose()}}var JR=q(1070);function yR(R,N){const q=new C;return q.direction1=R,q.direction2=N,q}function aR(){return new k(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function jR(){return new e(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function FR(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w.m(0,1,0),q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.m(0,1,0);return new K(R,N,q)}function SR(){return new H(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function HR(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.m(0,1,0),M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new w.m(0,1,0);return new W(R,N,q,u,M)}function WR(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new F(R,N)}function kR(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.m(0,1,0),u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.m(0,1,0);return new S(R,N,q,u)}class CR extends uR{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=R=>{if(!this._subEmitters||0===this._subEmitters.length)return;const N=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[N].forEach((N=>{if(1===N.type){const q=N.clone();R._inheritParticleInfoToSubEmitter(q),q.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(q.particleSystem),q.particleSystem.start()}}))}}createPointEmitter(R,N){const q=yR(R,N);return this.particleEmitterType=q,q}createHemisphericEmitter(){const R=aR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=R,R}createSphereEmitter(){const R=jR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=R,R}createDirectedSphereEmitter(){const R=FR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.m(0,1,0));return this.particleEmitterType=R,R}createCylinderEmitter(){const R=SR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=R,R}createDirectedCylinderEmitter(){const R=HR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new w.m(0,1,0));return this.particleEmitterType=R,R}createConeEmitter(){const R=WR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=R,R}createDirectedConeEmitter(){const R=kR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.m(0,1,0));return this.particleEmitterType=R,R}createBoxEmitter(R,N,q,w){const u=new j;return this.particleEmitterType=u,this.direction1=R,this.direction2=N,this.minEmitBox=q,this.maxEmitBox=w,u}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((R=>{R instanceof CR?this._subEmitters.push([new GR(R)]):R instanceof GR?this._subEmitters.push([R]):R instanceof Array&&this._subEmitters.push(R)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((R=>{R.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const R=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==R&&this._rootParticleSystem.activeSubSystems.splice(R,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(R){R&&this._stopSubEmitters()}_prepareParticle(R){if(this._subEmitters&&this._subEmitters.length>0){const N=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];R._attachedSubEmitters=[],N.forEach((N=>{if(0===N.type){const q=N.clone();R._attachedSubEmitters.push(q),q.particleSystem.start()}}))}}_onDispose(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var q;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),R)&&(null===(q=this.particles)||void 0===q||q.forEach((R=>{if(R._attachedSubEmitters)for(let N=R._attachedSubEmitters.length-1;N>=0;N-=1)R._attachedSubEmitters[N].dispose()})));if(N&&this.activeSubSystems)for(let w=this.activeSubSystems.length-1;w>=0;w-=1)this.activeSubSystems[w].dispose();if(this._subEmitters&&this._subEmitters.length){for(let R=0;R<this._subEmitters.length;R++)for(const N of this._subEmitters[R])N.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(R,N,q,u){let M;M=q instanceof JR.e?null:q;const J=(0,G.e)("BABYLON.Texture");if(J&&M&&(R.texture?N.particleTexture=J.Parse(R.texture,M,u):R.textureName&&(N.particleTexture=new J(u+R.textureName,M,!1,void 0===R.invertY||R.invertY),N.particleTexture.name=R.textureName)),R.emitterId||0===R.emitterId||void 0!==R.k?R.emitterId&&M?N.k=M.getLastMeshById(R.emitterId):N.k=w.m.Sd(R.k):N.k=w.m.Zero(),N.isLocal=!!R.isLocal,void 0!==R.renderingGroupId&&(N.renderingGroupId=R.renderingGroupId),void 0!==R.isBillboardBased&&(N.isBillboardBased=R.isBillboardBased),void 0!==R.billboardMode&&(N.billboardMode=R.billboardMode),void 0!==R.useLogarithmicDepth&&(N.useLogarithmicDepth=R.useLogarithmicDepth),R.animations){for(let q=0;q<R.animations.length;q++){const w=R.animations[q],u=(0,G.e)("BABYLON.Animation");u&&N.animations.push(u.Parse(w))}N.beginAnimationOnStart=R.beginAnimationOnStart,N.beginAnimationFrom=R.beginAnimationFrom,N.beginAnimationTo=R.beginAnimationTo,N.beginAnimationLoop=R.beginAnimationLoop}if(R.autoAnimate&&M&&M.beginAnimation(N,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1),N.startDelay=0|R.startDelay,N.minAngularSpeed=R.minAngularSpeed,N.maxAngularSpeed=R.maxAngularSpeed,N.minSize=R.minSize,N.maxSize=R.maxSize,R.minScaleX&&(N.minScaleX=R.minScaleX,N.maxScaleX=R.maxScaleX,N.minScaleY=R.minScaleY,N.maxScaleY=R.maxScaleY),void 0!==R.preWarmCycles&&(N.preWarmCycles=R.preWarmCycles,N.preWarmStepOffset=R.preWarmStepOffset),void 0!==R.minInitialRotation&&(N.minInitialRotation=R.minInitialRotation,N.maxInitialRotation=R.maxInitialRotation),N.minLifeTime=R.minLifeTime,N.maxLifeTime=R.maxLifeTime,N.minEmitPower=R.minEmitPower,N.maxEmitPower=R.maxEmitPower,N.emitRate=R.emitRate,N.gravity=w.m.Sd(R.gravity),R.noiseStrength&&(N.noiseStrength=w.m.Sd(R.noiseStrength)),N.color1=v.d.Sd(R.color1),N.color2=v.d.Sd(R.color2),N.colorDead=v.d.Sd(R.colorDead),N.updateSpeed=R.updateSpeed,N.targetStopDuration=R.targetStopDuration,N.blendMode=R.blendMode,R.colorGradients)for(const w of R.colorGradients)N.addColorGradient(w.gradient,v.d.Sd(w.color1),w.color2?v.d.Sd(w.color2):void 0);if(R.rampGradients){for(const q of R.rampGradients)N.addRampGradient(q.gradient,v.c.Sd(q.color));N.useRampGradients=R.useRampGradients}if(R.colorRemapGradients)for(const w of R.colorRemapGradients)N.addColorRemapGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(R.alphaRemapGradients)for(const w of R.alphaRemapGradients)N.addAlphaRemapGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(R.sizeGradients)for(const w of R.sizeGradients)N.addSizeGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(R.angularSpeedGradients)for(const w of R.angularSpeedGradients)N.addAngularSpeedGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(R.velocityGradients)for(const w of R.velocityGradients)N.addVelocityGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(R.dragGradients)for(const w of R.dragGradients)N.addDragGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(R.emitRateGradients)for(const w of R.emitRateGradients)N.addEmitRateGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(R.startSizeGradients)for(const w of R.startSizeGradients)N.addStartSizeGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(R.lifeTimeGradients)for(const w of R.lifeTimeGradients)N.addLifeTimeGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(R.limitVelocityGradients){for(const q of R.limitVelocityGradients)N.addLimitVelocityGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);N.limitVelocityDamping=R.limitVelocityDamping}if(R.noiseTexture&&M){const q=(0,G.e)("BABYLON.ProceduralTexture");N.noiseTexture=q.Parse(R.noiseTexture,M,u)}let y;if(R.particleEmitterType){switch(R.particleEmitterType.type){case"SphereParticleEmitter":y=new e;break;case"SphereDirectedParticleEmitter":y=new K;break;case"ConeEmitter":case"ConeParticleEmitter":y=new F;break;case"ConeDirectedParticleEmitter":y=new S;break;case"CylinderParticleEmitter":y=new H;break;case"CylinderDirectedParticleEmitter":y=new W;break;case"HemisphericParticleEmitter":y=new k;break;case"PointParticleEmitter":y=new C;break;case"MeshParticleEmitter":y=new z;break;case"CustomParticleEmitter":y=new r;break;default:y=new j}y.parse(R.particleEmitterType,M)}else y=new j,y.parse(R,M);N.particleEmitterType=y,N.startSpriteCellID=R.startSpriteCellID,N.endSpriteCellID=R.endSpriteCellID,N.spriteCellLoop=R.spriteCellLoop??!0,N.spriteCellWidth=R.spriteCellWidth,N.spriteCellHeight=R.spriteCellHeight,N.spriteCellChangeSpeed=R.spriteCellChangeSpeed,N.spriteRandomStartCell=R.spriteRandomStartCell,N.disposeOnStop=R.disposeOnStop??!1,N.manualEmitCount=R.manualEmitCount??-1}static Parse(R,N,q){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],M=arguments.length>4?arguments[4]:void 0;const G=R.name;let J,y,a=null,j=null;if(N instanceof JR.e?J=N:(y=N,J=y.getEngine()),R.customShader&&J.createEffectForParticles){j=R.customShader;const N=j.shaderOptions.defines.length>0?j.shaderOptions.defines.join("\n"):"";a=J.createEffectForParticles(j.shaderPath.fragmentElement,j.shaderOptions.uniforms,j.shaderOptions.samplers,N)}const F=new CR(G,M||R.Kd,N,a,R.isAnimationSheetEnabled);if(F.customShader=j,F._rootUrl=q,R.id&&(F.id=R.id),R.subEmitters){F.subEmitters=[];for(const w of R.subEmitters){const R=[];for(const u of w)R.push(GR.Parse(u,N,q));F.subEmitters.push(R)}}return CR._Parse(R,F,N,q),R.textureMask&&(F.textureMask=v.d.Sd(R.textureMask)),R.zg&&(F.zg=w.m.Sd(R.zg)),R.preventAutoStart&&(F.preventAutoStart=R.preventAutoStart),u||F.preventAutoStart||F.start(),F}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const N={};if(CR._Serialize(N,this,R),N.textureMask=this.textureMask.de(),N.customShader=this.customShader,N.preventAutoStart=this.preventAutoStart,N.zg=this.zg.de(),this.subEmitters){N.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const q of this._subEmitters){const w=[];for(const N of q)w.push(N.serialize(R));N.subEmitters.push(w)}}return N}static _Serialize(R,N,q){if(R.name=N.name,R.id=N.id,R.Kd=N.getCapacity(),R.disposeOnStop=N.disposeOnStop,R.manualEmitCount=N.manualEmitCount,N.k.position){const q=N.k;R.emitterId=q.id}else{const q=N.k;R.k=q.de()}N.particleEmitterType&&(R.particleEmitterType=N.particleEmitterType.serialize()),N.particleTexture&&(q?R.texture=N.particleTexture.serialize():(R.textureName=N.particleTexture.name,R.invertY=!!N.particleTexture._invertY)),R.isLocal=N.isLocal,n.e.AppendSerializedAnimations(N,R),R.beginAnimationOnStart=N.beginAnimationOnStart,R.beginAnimationFrom=N.beginAnimationFrom,R.beginAnimationTo=N.beginAnimationTo,R.beginAnimationLoop=N.beginAnimationLoop,R.startDelay=N.startDelay,R.renderingGroupId=N.renderingGroupId,R.isBillboardBased=N.isBillboardBased,R.billboardMode=N.billboardMode,R.minAngularSpeed=N.minAngularSpeed,R.maxAngularSpeed=N.maxAngularSpeed,R.minSize=N.minSize,R.maxSize=N.maxSize,R.minScaleX=N.minScaleX,R.maxScaleX=N.maxScaleX,R.minScaleY=N.minScaleY,R.maxScaleY=N.maxScaleY,R.minEmitPower=N.minEmitPower,R.maxEmitPower=N.maxEmitPower,R.minLifeTime=N.minLifeTime,R.maxLifeTime=N.maxLifeTime,R.emitRate=N.emitRate,R.gravity=N.gravity.de(),R.noiseStrength=N.noiseStrength.de(),R.color1=N.color1.de(),R.color2=N.color2.de(),R.colorDead=N.colorDead.de(),R.updateSpeed=N.updateSpeed,R.targetStopDuration=N.targetStopDuration,R.blendMode=N.blendMode,R.preWarmCycles=N.preWarmCycles,R.preWarmStepOffset=N.preWarmStepOffset,R.minInitialRotation=N.minInitialRotation,R.maxInitialRotation=N.maxInitialRotation,R.startSpriteCellID=N.startSpriteCellID,R.spriteCellLoop=N.spriteCellLoop,R.endSpriteCellID=N.endSpriteCellID,R.spriteCellChangeSpeed=N.spriteCellChangeSpeed,R.spriteCellWidth=N.spriteCellWidth,R.spriteCellHeight=N.spriteCellHeight,R.spriteRandomStartCell=N.spriteRandomStartCell,R.isAnimationSheetEnabled=N.isAnimationSheetEnabled,R.useLogarithmicDepth=N.useLogarithmicDepth;const w=N.getColorGradients();if(w){R.colorGradients=[];for(const N of w){const q={gradient:N.gradient,color1:N.color1.de()};N.color2?q.color2=N.color2.de():q.color2=N.color1.de(),R.colorGradients.push(q)}}const u=N.getRampGradients();if(u){R.rampGradients=[];for(const N of u){const q={gradient:N.gradient,color:N.color.de()};R.rampGradients.push(q)}R.useRampGradients=N.useRampGradients}const M=N.getColorRemapGradients();if(M){R.colorRemapGradients=[];for(const N of M){const q={gradient:N.gradient,factor1:N.factor1};void 0!==N.factor2?q.factor2=N.factor2:q.factor2=N.factor1,R.colorRemapGradients.push(q)}}const v=N.getAlphaRemapGradients();if(v){R.alphaRemapGradients=[];for(const N of v){const q={gradient:N.gradient,factor1:N.factor1};void 0!==N.factor2?q.factor2=N.factor2:q.factor2=N.factor1,R.alphaRemapGradients.push(q)}}const G=N.getSizeGradients();if(G){R.sizeGradients=[];for(const N of G){const q={gradient:N.gradient,factor1:N.factor1};void 0!==N.factor2?q.factor2=N.factor2:q.factor2=N.factor1,R.sizeGradients.push(q)}}const J=N.getAngularSpeedGradients();if(J){R.angularSpeedGradients=[];for(const N of J){const q={gradient:N.gradient,factor1:N.factor1};void 0!==N.factor2?q.factor2=N.factor2:q.factor2=N.factor1,R.angularSpeedGradients.push(q)}}const y=N.getVelocityGradients();if(y){R.velocityGradients=[];for(const N of y){const q={gradient:N.gradient,factor1:N.factor1};void 0!==N.factor2?q.factor2=N.factor2:q.factor2=N.factor1,R.velocityGradients.push(q)}}const a=N.getDragGradients();if(a){R.dragGradients=[];for(const N of a){const q={gradient:N.gradient,factor1:N.factor1};void 0!==N.factor2?q.factor2=N.factor2:q.factor2=N.factor1,R.dragGradients.push(q)}}const j=N.getEmitRateGradients();if(j){R.emitRateGradients=[];for(const N of j){const q={gradient:N.gradient,factor1:N.factor1};void 0!==N.factor2?q.factor2=N.factor2:q.factor2=N.factor1,R.emitRateGradients.push(q)}}const F=N.getStartSizeGradients();if(F){R.startSizeGradients=[];for(const N of F){const q={gradient:N.gradient,factor1:N.factor1};void 0!==N.factor2?q.factor2=N.factor2:q.factor2=N.factor1,R.startSizeGradients.push(q)}}const S=N.getLifeTimeGradients();if(S){R.lifeTimeGradients=[];for(const N of S){const q={gradient:N.gradient,factor1:N.factor1};void 0!==N.factor2?q.factor2=N.factor2:q.factor2=N.factor1,R.lifeTimeGradients.push(q)}}const H=N.getLimitVelocityGradients();if(H){R.limitVelocityGradients=[];for(const N of H){const q={gradient:N.gradient,factor1:N.factor1};void 0!==N.factor2?q.factor2=N.factor2:q.factor2=N.factor1,R.limitVelocityGradients.push(q)}R.limitVelocityDamping=N.limitVelocityDamping}N.noiseTexture&&(R.noiseTexture=N.noiseTexture.serialize())}clone(R,N){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w={...this._customWrappers};let u=null;const M=this._engine;if(M.createEffectForParticles&&null!=this.customShader){u=this.customShader;const R=u.shaderOptions.defines.length>0?u.shaderOptions.defines.join("\n"):"",N=M.createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,R);w[0]?w[0].effect=N:this.setCustomEffect(N,0)}const v=this.serialize(q),G=CR.Parse(v,this._scene||this._engine,this._rootUrl);return G.name=R,G.customShader=u,G._customWrappers=w,void 0===N&&(N=this.k),this.noiseTexture&&(G.noiseTexture=this.noiseTexture.clone()),G.k=N,this.preventAutoStart||G.start(),G}}CR.BILLBOARDMODE_Y=2,CR.BILLBOARDMODE_ALL=7,CR.BILLBOARDMODE_STRETCHED=8,CR.BILLBOARDMODE_STRETCHED_LOCAL=9,GR._ParseParticleSystem=CR.Parse;var eR=q(1191),KR=q(1174),rR=q(1409);rR.c.prototype.createTransformFeedback=function(){const R=this._gl.createTransformFeedback();if(!R)throw new Error("Unable to create Transform Feedback");return R},rR.c.prototype.deleteTransformFeedback=function(R){this._gl.deleteTransformFeedback(R)},rR.c.prototype.bindTransformFeedback=function(R){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,R)},rR.c.prototype.beginTransformFeedback=function(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(R?this._gl.POINTS:this._gl.TRIANGLES)},rR.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},rR.c.prototype.setTranformFeedbackVaryings=function(R,N){this._gl.transformFeedbackVaryings(R,N,this._gl.INTERLEAVED_ATTRIBS)},rR.c.prototype.bindTransformFeedbackBuffer=function(R){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,R?R.underlyingResource:null)},rR.c.prototype.readTransformFeedbackBuffer=function(R){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,R)};const ZR="clipPlaneFragmentDeclaration2",zR="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";E.b.IncludesShadersStore[ZR]=zR;q(10922),q(10806),q(10734),q(10930),q(10944),q(10949),q(10986),q(10991);const dR="gpuRenderParticlesPixelShader",xR="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";E.b.ShadersStore[dR]=xR;const ER="clipPlaneVertexDeclaration2",PR="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";E.b.IncludesShadersStore[ER]=PR;q(10777),q(10852),q(10859),q(10873);const sR="gpuRenderParticlesVertexShader",OR="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";E.b.ShadersStore[sR]=OR;class LR extends J{static get IsSupported(){if(!D.e.LastCreatedEngine)return!1;const R=D.e.LastCreatedEngine.getCaps();return R.supportTransformFeedbacks||R.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(R){this._maxActiveParticleCount=Math.min(R,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(R){this.maxActiveParticleCount=R}createPointEmitter(R,N){const q=yR(R,N);return this.particleEmitterType=q,q}createHemisphericEmitter(){const R=aR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=R,R}createSphereEmitter(){const R=jR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=R,R}createDirectedSphereEmitter(){const R=FR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w.m(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.m(0,1,0));return this.particleEmitterType=R,R}createCylinderEmitter(){const R=SR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=R,R}createDirectedCylinderEmitter(){const R=HR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.m(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new w.m(0,1,0));return this.particleEmitterType=R,R}createConeEmitter(){const R=WR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=R,R}createDirectedConeEmitter(){const R=kR(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.m(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.m(0,1,0));return this.particleEmitterType=R,R}createBoxEmitter(R,N,q,w){const u=new j;return this.particleEmitterType=u,this.direction1=R,this.direction2=N,this.minEmitBox=q,this.maxEmitBox=w,u}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==CR.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(CR.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(CR.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";R?setTimeout((()=>{this.start(0)}),R):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var R;let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(R=this._customWrappers[N])||void 0===R?void 0:R.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[R]??this._customWrappers[0]}setCustomEffect(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[N]=new RR.d(this._engine),this._customWrappers[N].effect=R}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new X.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(R,N,q){return super._removeGradientAndTexture(R,N,q),this._releaseBuffers(),this}addColorGradient(R,N){this._colorGradients||(this._colorGradients=[]);const q=new g(R,N);return this._colorGradients.push(q),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(R&&this._colorGradients.sort(((R,N)=>R.gradient<N.gradient?-1:R.gradient>N.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(R){return this._removeGradientAndTexture(R,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const N in this._drawWrappers){var R;null===(R=this._drawWrappers[N].drawContext)||void 0===R||R.reset()}}_addFactorGradient(R,N,q){const w=new B(N,q);R.push(w),this._releaseBuffers()}addSizeGradient(R,N){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,R,N),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(R){return this._removeGradientAndTexture(R,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(R,N){if(!R)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&R.sort(((R,N)=>R.gradient<N.gradient?-1:R.gradient>N.gradient?1:0));const q=this;q[N]&&(q[N].dispose(),q[N]=null)}addAngularSpeedGradient(R,N){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,R,N),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(R){return this._removeGradientAndTexture(R,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(R,N){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,R,N),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(R){return this._removeGradientAndTexture(R,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(R,N){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,R,N),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(R){return this._removeGradientAndTexture(R,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(R,N){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,R,N),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(R){return this._removeGradientAndTexture(R,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(R){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(R,N,q){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,M=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(R),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Zd=new X.c,this.onStoppedObservable=new X.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,q&&"Scene"!==q.getClassName()?(this._engine=q,this.defaultProjectionMatrix=w.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=q||D.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.he.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,G.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,G.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,G.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,G.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new RR.d(this._engine)},this._customWrappers[0].effect=u,this._drawWrappers={0:new RR.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(N=N??{}).randomTextureSize||delete N.randomTextureSize;const v={Kd:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...N},J=N;isFinite(J)&&(v.Kd=J),this._capacity=v.Kd,this._maxActiveParticleCount=v.Kd,this._currentActiveCount=0,this._isAnimationSheetEnabled=M,this.particleEmitterType=new j;const y=Math.min(this._engine.getCaps().maxTextureSize,v.randomTextureSize);let a=[];for(let w=0;w<y;++w)a.push(Math.random()),a.push(Math.random()),a.push(Math.random()),a.push(Math.random());this._randomTexture=new h.c(new Float32Array(a),y,1,5,q,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,a=[];for(let w=0;w<y;++w)a.push(Math.random()),a.push(Math.random()),a.push(Math.random()),a.push(Math.random());this._randomTexture2=new h.c(new Float32Array(a),y,1,5,q,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=y}_reset(){this._releaseBuffers()}_createVertexBuffers(R,N,q){const w={};w.position=N.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let u=3;w.age=N.createVertexBuffer("age",u,1,this._attributesStrideSize,!0),u+=1,w.size=N.createVertexBuffer("size",u,3,this._attributesStrideSize,!0),u+=3,w.life=N.createVertexBuffer("life",u,1,this._attributesStrideSize,!0),u+=1,u+=4,this.billboardMode===CR.BILLBOARDMODE_STRETCHED&&(w.direction=N.createVertexBuffer("direction",u,3,this._attributesStrideSize,!0)),u+=3,this._platform.alignDataInBuffer&&(u+=1),this.particleEmitterType instanceof r&&(u+=3,this._platform.alignDataInBuffer&&(u+=1)),this._colorGradientsTexture||(w.color=N.createVertexBuffer("color",u,4,this._attributesStrideSize,!0),u+=4),this._isBillboardBased||(w.initialDirection=N.createVertexBuffer("initialDirection",u,3,this._attributesStrideSize,!0),u+=3,this._platform.alignDataInBuffer&&(u+=1)),this.noiseTexture&&(w.noiseCoordinates1=N.createVertexBuffer("noiseCoordinates1",u,3,this._attributesStrideSize,!0),u+=3,this._platform.alignDataInBuffer&&(u+=1),w.noiseCoordinates2=N.createVertexBuffer("noiseCoordinates2",u,3,this._attributesStrideSize,!0),u+=3,this._platform.alignDataInBuffer&&(u+=1)),w.angle=N.createVertexBuffer("angle",u,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?u++:u+=2,this._isAnimationSheetEnabled&&(w.cellIndex=N.createVertexBuffer("cellIndex",u,1,this._attributesStrideSize,!0),u+=1,this.spriteRandomStartCell&&(w.cellStartOffset=N.createVertexBuffer("cellStartOffset",u,1,this._attributesStrideSize,!0),u+=1)),w.offset=q.createVertexBuffer("offset",0,2),w.uv=q.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(w),this._platform.createVertexBuffers(R,w),this.resetDrawCache()}_initialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!R)return;const N=this._engine,q=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof r&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const u=this.particleEmitterType instanceof r,M=w.f.Od[0];let v=0;for(let w=0;w<this._capacity;w++)if(q.push(0),q.push(0),q.push(0),q.push(0),q.push(0),q.push(0),q.push(0),q.push(0),q.push(Math.random()),q.push(Math.random()),q.push(Math.random()),q.push(Math.random()),u?(this.particleEmitterType.particleDestinationGenerator(w,null,M),q.push(M.x),q.push(M.y),q.push(M.z)):(q.push(0),q.push(0),q.push(0)),this._platform.alignDataInBuffer&&q.push(0),v+=16,u&&(this.particleEmitterType.particlePositionGenerator(w,null,M),q.push(M.x),q.push(M.y),q.push(M.z),this._platform.alignDataInBuffer&&q.push(0),v+=4),this._colorGradientsTexture||(q.push(0),q.push(0),q.push(0),q.push(0),v+=4),this.isBillboardBased||(q.push(0),q.push(0),q.push(0),this._platform.alignDataInBuffer&&q.push(0),v+=4),this.noiseTexture&&(q.push(Math.random()),q.push(Math.random()),q.push(Math.random()),this._platform.alignDataInBuffer&&q.push(0),q.push(Math.random()),q.push(Math.random()),q.push(Math.random()),this._platform.alignDataInBuffer&&q.push(0),v+=8),q.push(0),v+=1,this._angularSpeedGradientsTexture||(q.push(0),v+=1),this._isAnimationSheetEnabled&&(q.push(0),v+=1,this.spriteRandomStartCell&&(q.push(0),v+=1)),this._platform.alignDataInBuffer){let R=3-(v+3&3);for(v+=R;R-- >0;)q.push(0)}const G=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),J=this._platform.createParticleBuffer(q),y=this._platform.createParticleBuffer(q);this._buffer0=new Z.b(N,J,!1,this._attributesStrideSize),this._buffer1=new Z.b(N,y,!1,this._attributesStrideSize),this._spriteBuffer=new Z.b(N,G,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let R=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(R+="\n#define BILLBOARD"),this._colorGradientsTexture&&(R+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(R+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(R+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(R+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(R+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(R+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(R+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(R+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(R+="\n#define NOISE"),this.isLocal&&(R+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===R||(this._cachedUpdateDefines=R,this._updateBuffer=this._platform.createUpdateBuffer(R)),this._platform.isUpdateBufferReady()}_getWrapper(R){const N=this._getCustomDrawWrapper(R);if(null!==N&&void 0!==N&&N.effect)return N;const q=[];this.fillDefines(q,R);let w=this._drawWrappers[R];w||(w=new RR.d(this._engine),w.drawContext&&(w.drawContext.useInstancing=!0),this._drawWrappers[R]=w);const u=q.join("\n");if(w.defines!==u){const R=[],N=[],q=[];this.fillUniformsAttributesAndSamplerNames(N,R,q),w.setEffect(this._engine.createEffect("gpuRenderParticles",R,N,q,u),u)}return w}static _GetAttributeNamesOrOptions(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const u=[Z.e.PositionKind,"age","life","size","angle"];return R||u.push(Z.e.ColorKind),N&&u.push("cellIndex"),q||u.push("initialDirection"),w&&u.push("direction"),u.push("offset",Z.e.UVKind),u}static _GetEffectCreationOptions(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0],N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w=["emitterWM","zg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,NR.c)(w),R&&w.push("sheetInfos"),N&&w.push("logarithmicDepthConstant"),q&&(w.push("vFogInfos"),w.push("vFogColor")),w}fillDefines(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,NR.h)(this,this._scene,R),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==KR.e.FOGMODE_NONE&&R.push("#define FOG")),N===CR.BLENDMODE_MULTIPLY&&R.push("#define BLENDMULTIPLYMODE"),this.isLocal&&R.push("#define LOCAL"),this.useLogarithmicDepth&&R.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(R.push("#define BILLBOARD"),this.billboardMode){case CR.BILLBOARDMODE_Y:R.push("#define BILLBOARDY");break;case CR.BILLBOARDMODE_STRETCHED:R.push("#define BILLBOARDSTRETCHED");break;case CR.BILLBOARDMODE_ALL:R.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&R.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&R.push("#define ANIMATESHEET"),q&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),R.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(R,N,q){N.push(...LR._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===CR.BILLBOARDMODE_STRETCHED)),R.push(...LR._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),q.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(eR.c.PrepareUniforms(R,this._imageProcessingConfigurationDefines),eR.c.PrepareSamplers(q,this._imageProcessingConfigurationDefines))}animate(){var R;let N=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(N?this.preWarmStepOffset:(null===(R=this._scene)||void 0===R?void 0:R.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(R,N){const q=this[N];if(!R||!R.length||q)return;const w=new Float32Array(this._rawTextureWidth);for(let u=0;u<this._rawTextureWidth;u++){const N=u/this._rawTextureWidth;l.GetCurrentGradient(N,R,((R,N,q)=>{w[u]=(0,y.o)(R.factor1,N.factor1,q)}))}this[N]=h.c.CreateRTexture(w,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[N].name=N.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const R=new Uint8Array(4*this._rawTextureWidth),N=v.g.Ee[0];for(let q=0;q<this._rawTextureWidth;q++){const w=q/this._rawTextureWidth;l.GetCurrentGradient(w,this._colorGradients,((w,u,M)=>{v.d.LerpToRef(w.color1,u.color1,M,N),R[4*q]=255*N.r,R[4*q+1]=255*N.g,R[4*q+2]=255*N.b,R[4*q+3]=255*N.a}))}this._colorGradientsTexture=h.c.CreateRGBATexture(R,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(R,N){var q,u,M,v;const G=this._getWrapper(R),J=G.effect;this._engine.enableEffect(G);const y=(null===(q=this._scene)||void 0===q?void 0:q.getViewMatrix())||w.c.IdentityReadOnly;if(J.setMatrix("view",y),J.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),J.setTexture("diffuseSampler",this.particleTexture),J.setVector2("translationPivot",this.translationPivot),J.setVector3("zg",this.zg),this.isLocal&&J.setMatrix("emitterWM",N),this._colorGradientsTexture?J.setTexture("colorGradientSampler",this._colorGradientsTexture):J.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const R=this.particleTexture.getBaseSize();J.setFloat3("sheetInfos",this.spriteCellWidth/R.width,this.spriteCellHeight/R.height,R.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const R=this._scene.activeCamera;J.setVector3("eyePosition",R.globalPosition)}const a=J.defines;if(this._scene&&((0,NR.d)(J,this,this._scene),this.applyFog&&(0,qR.g)(this._scene,void 0,J)),a.indexOf("#define BILLBOARDMODE_ALL")>=0){const R=y.clone();R.invert(),J.setMatrix("invView",R)}switch(this.useLogarithmicDepth&&this._scene&&(0,qR.m)(a,J,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(J),R){case CR.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case CR.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case CR.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case CR.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,J,null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(J),null!==(M=this._scene)&&void 0!==M&&M.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(v=this._scene)&&void 0!==v&&v.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(R){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!R)if(this.k.position){R=this.k.getWorldMatrix()}else{const N=this.k;R=w.f.Matrix[0],w.c.TranslationToRef(N.x,N.y,N.z,R)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",R),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const N=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=N}render(){let R,N=arguments.length>0&&void 0!==arguments[0]&&arguments[0],q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!N&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let R=0;R<this.preWarmCycles;R++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const R=0|this._accumulatedCount;this._accumulatedCount-=R,this._currentActiveCount+=R}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){R=this.k.getWorldMatrix()}else{const N=this.k;R=w.f.Matrix[0],w.c.TranslationToRef(N.x,N.y,N.z,R)}const u=this._engine;this.updateInAnimate||this._update(R);let M=0;return N||q||(u.setState(!1),this.forceDepthWrite&&u.setDepthWrite(!0),M=this.blendMode===CR.BLENDMODE_MULTIPLYADD?this._render(CR.BLENDMODE_MULTIPLY,R)+this._render(CR.BLENDMODE_ADD,R):this._render(this.blendMode,R),this._engine.setAlphaMode(0)),M}rebuild(){const R=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(R,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,R()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const N in this._drawWrappers){this._drawWrappers[N].dispose()}if(this._drawWrappers={},this._scene){const R=this._scene.he.indexOf(this);R>-1&&this._scene.he.splice(R,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let N=0;N<this._renderVertexBuffers.length;++N){const R=this._renderVertexBuffers[N];for(const N in R)R[N].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),R&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),R&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Zd.notifyObservers(this),this.Zd.clear()}clone(R,N){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w={...this._customWrappers};let u=null;const M=this._engine;if(M.createEffectForParticles&&null!=this.customShader){u=this.customShader;const R=u.shaderOptions.defines.length>0?u.shaderOptions.defines.join("\n"):"";w[0]=M.createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,R,void 0,void 0,void 0,this)}const v=this.serialize(q),G=LR.Parse(v,this._scene||this._engine,this._rootUrl);return G.name=R,G.customShader=u,G._customWrappers=w,void 0===N&&(N=this.k),this.noiseTexture&&(G.noiseTexture=this.noiseTexture.clone()),G.k=N,G}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const N={};return CR._Serialize(N,this,R),N.activeParticleCount=this.activeParticleCount,N.randomTextureSize=this._randomTextureSize,N.customShader=this.customShader,N}static Parse(R,N,q){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4?arguments[4]:void 0;const M=R.name;let v,G;N instanceof JR.e?v=N:(G=N,v=G.getEngine());const J=new LR(M,{Kd:u||R.Kd,randomTextureSize:R.randomTextureSize},N,null,R.isAnimationSheetEnabled);if(J._rootUrl=q,R.customShader&&v.createEffectForParticles){const N=R.customShader,q=N.shaderOptions.defines.length>0?N.shaderOptions.defines.join("\n"):"",w=v.createEffectForParticles(N.shaderPath.fragmentElement,N.shaderOptions.uniforms,N.shaderOptions.samplers,q,void 0,void 0,void 0,J);J.setCustomEffect(w,0),J.customShader=N}return R.id&&(J.id=R.id),R.activeParticleCount&&(J.activeParticleCount=R.activeParticleCount),CR._Parse(R,J,N,q),R.preventAutoStart&&(J.preventAutoStart=R.preventAutoStart),w||J.preventAutoStart||J.start(),J}}var mR=q(1177),oR=q(11547),AR=q(1168);class nR{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(R){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const N of this.systems)N.k=R;this._emitterNode=R}setEmitterAsSphere(R,N,q){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:R,renderingGroupId:N};const w=(0,oR.c)("emitterSphere",{diameter:R.diameter,segments:R.segments},q);w.renderingGroupId=N;const u=new AR.e("emitterSphereMaterial",q);u.emissiveColor=R.color,w.material=u;for(const M of this.systems)M.k=w;this._emitterNode=w}start(R){for(const N of this.systems)R&&(N.k=R),N.start()}dispose(){for(const R of this.systems)R.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const N={systems:[]};for(const q of this.systems)N.systems.push(q.serialize(R));return this._emitterNode&&(N.k=this._emitterCreationOptions),N}static Parse(R,N){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3?arguments[3]:void 0;const u=new nR,M=this.BaseAssetsUrl+"/textures/";N=N||D.e.LastCreatedScene;for(const v of R.systems)u.systems.push(q?LR.Parse(v,N,M,!0,w):CR.Parse(v,N,M,!0,w));if(R.k){const q=R.k.options;if("Sphere"===R.k.kind)u.setEmitterAsSphere({diameter:q.diameter,segments:q.segments,color:v.c.Sd(q.color)},R.k.renderingGroupId,N)}return u}}nR.BaseAssetsUrl="https://assets.babylonjs.com/particles";var QR=q(1019);class YR{static CreateDefault(R){let N,q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,w=arguments.length>2?arguments[2]:void 0;return N=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new LR("default system",{Kd:q},w):new CR("default system",q,w),N.k=R,N.particleTexture=new Q.e("https://assets.babylonjs.com/textures/flare.png",N.va()),N.createConeEmitter(.1,Math.PI/4),N.color1=new v.d(1,1,1,1),N.color2=new v.d(1,1,1,1),N.colorDead=new v.d(1,1,1,0),N.minSize=.1,N.maxSize=.1,N.minEmitPower=2,N.maxEmitPower=2,N.updateSpeed=1/60,N.emitRate=30,N}static CreateAsync(R,N){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3?arguments[3]:void 0;N||(N=D.e.LastCreatedScene);const u={};return N.addPendingData(u),new Promise(((M,v)=>{if(q&&!LR.IsSupported)return N.removePendingData(u),v("Particle system with GPU is not supported.");mR.i.LoadFile(`${YR.BaseAssetsUrl}/systems/${R}.json`,(R=>{N.removePendingData(u);const v=JSON.parse(R.toString());return M(nR.Parse(v,N,q,w))}),void 0,void 0,void 0,(()=>(N.removePendingData(u),v(`An error occurred with the creation of your particle system. Check if your type '${R}' exists.`))))}))}static ExportSet(R){const N=new nR;for(const q of R)N.systems.push(q);return N}static ParseFromFileAsync(R,N,q){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",M=arguments.length>5?arguments[5]:void 0;return new Promise(((v,G)=>{const J=new QR.b;J.addEventListener("readystatechange",(()=>{if(4==J.readyState)if(200==J.status){const N=JSON.parse(J.responseText);let G;G=w?LR.Parse(N,q,u,!1,M):CR.Parse(N,q,u,!1,M),R&&(G.name=R),v(G)}else G("Unable to load the particle system")})),J.open("GET",N),J.send()}))}static ParseFromSnippetAsync(R,N){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",u=arguments.length>4?arguments[4]:void 0;if("_BLANK"===R){const R=this.CreateDefault(null);return R.start(),Promise.resolve(R)}return new Promise(((M,v)=>{const G=new QR.b;G.addEventListener("readystatechange",(()=>{if(4==G.readyState)if(200==G.status){const v=JSON.parse(JSON.parse(G.responseText).jsonPayload),J=JSON.parse(v.particleSystem);let y;y=q?LR.Parse(J,N,w,!1,u):CR.Parse(J,N,w,!1,u),y.snippetId=R,M(y)}else v("Unable to load the snippet "+R)})),G.open("GET",this.SnippetUrl+"/"+R.replace(/#/g,"/")),G.send()}))}}YR.BaseAssetsUrl=nR.BaseAssetsUrl,YR.SnippetUrl="https://snippet.babylonjs.com",YR.CreateFromSnippetAsync=YR.ParseFromSnippetAsync;var TR=q(11381),fR=q(1255),cR=q(11549);(0,cR.g)(fR.b.NAME_PARTICLESYSTEM,((R,N,q,w)=>{const u=(0,cR.j)(fR.b.NAME_PARTICLESYSTEM);if(u&&void 0!==R.he&&null!==R.he)for(let M=0,v=R.he.length;M<v;M++){const v=R.he[M];q.he.push(u(v,N,w))}})),(0,cR.e)(fR.b.NAME_PARTICLESYSTEM,((R,N,q)=>{if(R.activeParticleCount){return LR.Parse(R,N,q)}return CR.Parse(R,N,q)})),JR.e.prototype.createEffectForParticles=function(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",M=arguments.length>4?arguments[4]:void 0,v=arguments.length>5?arguments[5]:void 0,G=arguments.length>6?arguments[6]:void 0,J=arguments.length>7?arguments[7]:void 0,y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,a=[],j=[];const F=[];return J?J.fillUniformsAttributesAndSamplerNames(j,a,F):(a=CR._GetAttributeNamesOrOptions(),j=CR._GetEffectCreationOptions()),-1===u.indexOf(" BILLBOARD")&&(u+="\n#define BILLBOARD\n"),null!==J&&void 0!==J&&J.isAnimationSheetEnabled&&-1===u.indexOf(" ANIMATESHEET")&&(u+="\n#define ANIMATESHEET\n"),-1===w.indexOf("diffuseSampler")&&w.push("diffuseSampler"),this.createEffect({vertex:(null===J||void 0===J?void 0:J.vertexShaderName)??"particles",fragmentElement:R},a,j.concat(N),F.concat(w),u,M,v,G,void 0,y,(async()=>{0===y?await Promise.resolve().then(q.bind(q,11573)):await Promise.resolve().then(q.bind(q,11588))}))},TR.b.prototype.getEmittedParticleSystems=function(){const R=[];for(let N=0;N<this.va().he.length;N++){const q=this.va().he[N];q.k===this&&R.push(q)}return R},TR.b.prototype.getHierarchyEmittedParticleSystems=function(){const R=[],N=this.getDescendants();N.push(this);for(let q=0;q<this.va().he.length;q++){const w=this.va().he[q],u=w.k;u.position&&-1!==N.indexOf(u)&&R.push(w)}return R};q(1328),q(1334),q(11412);q(11403),q(11557),q(1460),q(1312),q(11429);q(1455);var bR;q(11559),q(1007);!function(R){R[R.Color=2]="Color",R[R.UV=1]="UV",R[R.Random=0]="Random",R[R.Stated=3]="Stated"}(bR||(bR={}));q(11566),q(11573),q(11580),q(11588)},10655:(R,N,q)=>{"use strict";const w="clipPlaneFragment",u="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";q(1078).b.IncludesShadersStoreWGSL[w]=u},10637:(R,N,q)=>{"use strict";const w="clipPlaneFragmentDeclaration",u="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";q(1078).b.IncludesShadersStoreWGSL[w]=u},10547:(R,N,q)=>{"use strict";const w="clipPlaneVertex",u="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";q(1078).b.IncludesShadersStoreWGSL[w]=u},10455:(R,N,q)=>{"use strict";const w="clipPlaneVertexDeclaration",u="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";q(1078).b.IncludesShadersStoreWGSL[w]=u},10689:(R,N,q)=>{"use strict";const w="fogFragment",u="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";q(1078).b.IncludesShadersStoreWGSL[w]=u},10646:(R,N,q)=>{"use strict";const w="fogFragmentDeclaration",u="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";q(1078).b.IncludesShadersStoreWGSL[w]=u},10553:(R,N,q)=>{"use strict";const w="fogVertex",u="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";q(1078).b.IncludesShadersStoreWGSL[w]=u},10464:(R,N,q)=>{"use strict";const w="fogVertexDeclaration",u="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";q(1078).b.IncludesShadersStoreWGSL[w]=u},10427:(R,N,q)=>{"use strict";const w="helperFunctions",u="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";q(1078).b.IncludesShadersStoreWGSL[w]=u},10617:(R,N,q)=>{"use strict";const w="imageProcessingDeclaration",u="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";q(1078).b.IncludesShadersStoreWGSL[w]=u},10626:(R,N,q)=>{"use strict";const w="imageProcessingFunctions",u="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";q(1078).b.IncludesShadersStoreWGSL[w]=u},10486:(R,N,q)=>{"use strict";const w="logDepthDeclaration",u="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";q(1078).b.IncludesShadersStoreWGSL[w]=u},10685:(R,N,q)=>{"use strict";const w="logDepthFragment",u="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";q(1078).b.IncludesShadersStoreWGSL[w]=u},10573:(R,N,q)=>{"use strict";const w="logDepthVertex",u="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";q(1078).b.IncludesShadersStoreWGSL[w]=u},11580:(R,N,q)=>{"use strict";q.r(N),q.d(N,{particlesPixelShaderWGSL:()=>v});var w=q(1078);q(10637),q(10617),q(10486),q(10427),q(10626),q(10646),q(10655),q(10685),q(10689);const u="particlesPixelShader",M="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";w.b.ShadersStoreWGSL[u]=M;const v={name:u,shader:M}},11588:(R,N,q)=>{"use strict";q.r(N),q.d(N,{particlesVertexShaderWGSL:()=>v});var w=q(1078);q(10455),q(10464),q(10486),q(10547),q(10553),q(10573);const u="particlesVertexShader",M="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";w.b.ShadersStoreWGSL[u]=M;const v={name:u,shader:M}},10949:(R,N,q)=>{"use strict";const w="clipPlaneFragment",u="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";q(1078).b.IncludesShadersStore[w]=u},10942:(R,N,q)=>{"use strict";const w="clipPlaneFragmentDeclaration",u="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";q(1078).b.IncludesShadersStore[w]=u},10852:(R,N,q)=>{"use strict";const w="clipPlaneVertex",u="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";q(1078).b.IncludesShadersStore[w]=u},10774:(R,N,q)=>{"use strict";const w="clipPlaneVertexDeclaration",u="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";q(1078).b.IncludesShadersStore[w]=u},10991:(R,N,q)=>{"use strict";const w="fogFragment",u="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";q(1078).b.IncludesShadersStore[w]=u},10944:(R,N,q)=>{"use strict";const w="fogFragmentDeclaration",u="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";q(1078).b.IncludesShadersStore[w]=u},10859:(R,N,q)=>{"use strict";const w="fogVertex",u="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";q(1078).b.IncludesShadersStore[w]=u},10777:(R,N,q)=>{"use strict";const w="fogVertexDeclaration",u="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";q(1078).b.IncludesShadersStore[w]=u},10734:(R,N,q)=>{"use strict";const w="helperFunctions",u="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";q(1078).b.IncludesShadersStore[w]=u},10922:(R,N,q)=>{"use strict";const w="imageProcessingDeclaration",u="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";q(1078).b.IncludesShadersStore[w]=u},10930:(R,N,q)=>{"use strict";const w="imageProcessingFunctions",u="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";q(1078).b.IncludesShadersStore[w]=u},10806:(R,N,q)=>{"use strict";const w="logDepthDeclaration",u="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";q(1078).b.IncludesShadersStore[w]=u},10986:(R,N,q)=>{"use strict";const w="logDepthFragment",u="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";q(1078).b.IncludesShadersStore[w]=u},10873:(R,N,q)=>{"use strict";const w="logDepthVertex",u="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";q(1078).b.IncludesShadersStore[w]=u},11566:(R,N,q)=>{"use strict";q.r(N),q.d(N,{particlesPixelShader:()=>v});var w=q(1078);q(10942),q(10922),q(10806),q(10734),q(10930),q(10944),q(10949),q(10986),q(10991);const u="particlesPixelShader",M="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";w.b.ShadersStore[u]=M;const v={name:u,shader:M}},11573:(R,N,q)=>{"use strict";q.r(N),q.d(N,{particlesVertexShader:()=>v});var w=q(1078);q(10774),q(10777),q(10806),q(10852),q(10859),q(10873);const u="particlesVertexShader",M="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";w.b.ShadersStore[u]=M;const v={name:u,shader:M}},11398:(R,N,q)=>{"use strict";q.d(N,{d:()=>j});var w=q(942),u=q(966),M=q(947),v=q(959),G=q(997),J=q(1044),y=q(1128);class a{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new v.c,this._onClonedObservable=new v.c}}class j{static AddNodeConstructor(R,N){this._NodeConstructors[R]=N}static Construct(R,N,q,w){const u=this._NodeConstructors[R];return u?u(N,q,w):null}set accessibilityTag(R){this._accessibilityTag=R,this.onAccessibilityTagChangedObservable.notifyObservers(R)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(R){this._nodeDataStorage._doNotSerialize=R}u(){return this._nodeDataStorage._isDisposed}set parent(R){if(this._parentNode===R)return;const N=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const N=this._parentNode._children.indexOf(this);-1!==N&&this._parentNode._children.splice(N,1),R||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=R,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),N||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(R){R.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const R=this._scene.rootNodes,N=R.length-1;R[this._nodeDataStorage._sceneRootNodesIndex]=R[N],R[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(R){this._animationPropertiesOverride=R}getClassName(){return"Node"}set onDispose(R){this._onDisposeObserver&&this.Zd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Zd.add(R)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new a,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new v.c,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=u.c.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.Zd=new v.c,this._onDisposeObserver=null,this._behaviors=new Array,this.name=R,this.id=R,this._scene=N||G.e.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),q&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(R)||(R.init(),this._scene.isLoading&&!N?this._scene.onDataLoadedObservable.addOnce((()=>{R.attach(this)})):R.attach(this),this._behaviors.push(R)),this}removeBehavior(R){const N=this._behaviors.indexOf(R);return-1===N||(this._behaviors[N].detach(),this._behaviors.splice(N,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(R){for(const N of this._behaviors)if(N.name===R)return N;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.je(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(R){!R&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(R){return this.parent?this.parent._getActionManagerForTrigger(R,!1):null}_updateCache(R){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}pe(R){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((R=>{R._syncParentEnabledState()}))}Jg(R){this._nodeDataStorage._isEnabled!==R&&(this._nodeDataStorage._isEnabled=R,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(R))}isDescendantOf(R){return!!this.parent&&(this.parent===R||this.parent.isDescendantOf(R))}_getDescendants(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2?arguments[2]:void 0;if(this._children)for(let w=0;w<this._children.length;w++){const u=this._children[w];q&&!q(u)||R.push(u),N||u._getDescendants(R,!1,q)}}getDescendants(R,N){const q=[];return this._getDescendants(q,R,N),q}getChildMeshes(R,N){const q=[];return this._getDescendants(q,R,(R=>(!N||N(R))&&void 0!==R.He)),q}getChildren(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(N,R)}_setReady(R){R!==this._nodeDataStorage._isReady&&(R?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(R){for(let N=0;N<this.animations.length;N++){const q=this.animations[N];if(q.name===R)return q}return null}createAnimationRange(R,N,q){if(!this._ranges[R]){this._ranges[R]=j._AnimationRangeFactory(R,N,q);for(let w=0,u=this.animations.length;w<u;w++)this.animations[w]&&this.animations[w].createRange(R,N,q)}}deleteAnimationRange(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let q=0,w=this.animations.length;q<w;q++)this.animations[q]&&this.animations[q].deleteRange(R,N);this._ranges[R]=null}getAnimationRange(R){return this._ranges[R]||null}clone(R,N,q){const w=y.e.Clone((()=>new j(R,this.va())),this);if(N&&(w.parent=N),!q){const N=this.getDescendants(!0);for(let q=0;q<N.length;q++){const u=N[q];u.clone(R+"."+u.name,w)}}return w}getAnimationRanges(){const R=[];let N;for(N in this._ranges)R.push(this._ranges[N]);return R}beginAnimation(R,N,q,w){const u=this.getAnimationRange(R);return u?this._scene.beginAnimation(this,u.from,u.to,N,q,w):null}serializeAnimationRanges(){const R=[];for(const N in this._ranges){const q=this._ranges[N];if(!q)continue;const w={};w.name=N,w.from=q.from,w.to=q.to,R.push(w)}return R}je(R){return this._worldMatrix||(this._worldMatrix=u.c.Identity()),this._worldMatrix}dispose(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!R){const q=this.getDescendants(!0);for(const w of q)w.dispose(R,N)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.Zd.notifyObservers(this),this.Zd.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const q of this._behaviors)q.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(R,N,q){if(N.ranges)for(let w=0;w<N.ranges.length;w++){const q=N.ranges[w];R.createAnimationRange(q.name,q.from,q.to)}}getHierarchyBoundingVectors(){let R,N,q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.je(!0);const M=this;if(M.getBoundingInfo&&M.ae){const q=M.getBoundingInfo();R=q.boundingBox.minimumWorld.clone(),N=q.boundingBox.maximumWorld.clone()}else R=new u.m(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),N=new u.m(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(q){const q=this.getDescendants(!1);for(const M of q){const q=M;if(q.je(!0),w&&!w(q))continue;if(!q.getBoundingInfo||0===q.getTotalVertices())continue;const v=q.getBoundingInfo().boundingBox,G=v.minimumWorld,J=v.maximumWorld;u.m.CheckExtends(G,R,N),u.m.CheckExtends(J,R,N)}}return{min:R,max:N}}}j._AnimationRangeFactory=(R,N,q)=>{throw(0,J.c)("AnimationRange")},j._NodeConstructors={},(0,w.b)([(0,M.E)()],j.prototype,"name",void 0),(0,w.b)([(0,M.E)()],j.prototype,"id",void 0),(0,w.b)([(0,M.E)()],j.prototype,"uniqueId",void 0),(0,w.b)([(0,M.E)()],j.prototype,"state",void 0),(0,w.b)([(0,M.E)()],j.prototype,"metadata",void 0)},11975:(R,N,q)=>{"use strict";class w{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((R,N)=>{this._resolve=R,this._reject=N}))}}var u=q(966),M=q(1133),v=q(1177),G=q(11396),J=q(11983),y=q(12003),a=q(959),j=q(11545),F=q(12006),S=q(12010),H=q(997),W=q(1056),k=q(1186);class C{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(R){this._useTextureToStoreBoneMatrices=R,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(R){this._animationPropertiesOverride=R}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(R,N,q){this.name=R,this.id=N,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=u.c.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new a.c,this.bones=[],this._scene=q||H.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const w=this._scene.getEngine().getCaps();this._canUseTextureForBones=w.textureFloat&&w.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((R=>!R.getParent()))}getTransformMatrices(R){if(this.needInitialSkinMatrix){if(!R)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return R._bonesTransformMatrices||this.prepare(!0),R._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(R){return this.needInitialSkinMatrix&&R._transformMatrixTexture?R._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(R){let N=`Name: ${this.name}, nBones: ${this.bones.length}`;if(N+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,R){N+=", Ranges: {";let R=!0;for(const q in this._ranges)R&&(N+=", ",R=!1),N+=q;N+="}"}return N}getBoneIndexByName(R){for(let N=0,q=this.bones.length;N<q;N++)if(this.bones[N].name===R)return N;return-1}createAnimationRange(R,N,q){if(!this._ranges[R]){this._ranges[R]=new S.b(R,N,q);for(let w=0,u=this.bones.length;w<u;w++)this.bones[w].animations[0]&&this.bones[w].animations[0].createRange(R,N,q)}}deleteAnimationRange(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let q=0,w=this.bones.length;q<w;q++)this.bones[q].animations[0]&&this.bones[q].animations[0].deleteRange(R,N);this._ranges[R]=null}getAnimationRange(R){return this._ranges[R]||null}getAnimationRanges(){const R=[];let N;for(N in this._ranges)R.push(this._ranges[N]);return R}copyAnimationRange(R,N){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[N]||!R.getAnimationRange(N))return!1;let w=!0;const u=this._getHighestAnimationFrame()+1,M={},v=R.bones;let G,J;for(J=0,G=v.length;J<G;J++)M[v[J].name]=v[J];this.bones.length!==v.length&&(W.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${v.length}`),w=!1);const y=q&&this.dimensionsAtRest&&R.dimensionsAtRest?this.dimensionsAtRest.divide(R.dimensionsAtRest):null;for(J=0,G=this.bones.length;J<G;J++){const R=this.bones[J].name,v=M[R];v?w=w&&this.bones[J].copyAnimationRange(v,N,u,q,y):(W.e.Warn("copyAnimationRange: not same rig, missing source bone "+R),w=!1)}const a=R.getAnimationRange(N);return a&&(this._ranges[N]=new S.b(N,a.from+u,a.to+u)),w}returnToRest(){for(const R of this.bones)-1!==R._index&&R.returnToRest()}_getHighestAnimationFrame(){let R=0;for(let N=0,q=this.bones.length;N<q;N++)if(this.bones[N].animations[0]){const q=this.bones[N].animations[0].getHighestFrame();R<q&&(R=q)}return R}beginAnimation(R,N,q,w){const u=this.getAnimationRange(R);return u?this._scene.beginAnimation(this,u.from,u.to,N,q,w):null}static MakeAnimationAdditive(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2?arguments[2]:void 0;const w=R.getAnimationRange(q);if(!w)return null;const u=R._scene.getAllAnimatablesByTarget(R);let M=null;for(let G=0;G<u.length;G++){const R=u[G];if(R.fromFrame===(null===w||void 0===w?void 0:w.from)&&R.toFrame===(null===w||void 0===w?void 0:w.to)){M=R;break}}const v=R.getAnimatables();for(let G=0;G<v.length;G++){const R=v[G].animations;if(R)for(let w=0;w<R.length;w++)F.c.MakeAnimationAdditive(R[w],N,q)}return M&&(M.isAdditive=!0),R}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(R){this._meshesWithPoseMatrix.push(R)}_unregisterMeshWithPoseMatrix(R){const N=this._meshesWithPoseMatrix.indexOf(R);N>-1&&this._meshesWithPoseMatrix.splice(N,1)}_computeTransformMatrices(R,N){this.onBeforeComputeObservable.notifyObservers(this);for(let q=0;q<this.bones.length;q++){const w=this.bones[q];w._childUpdateId++;const u=w.getParent();if(u?w.getLocalMatrix().multiplyToRef(u.getFinalMatrix(),w.getFinalMatrix()):N?w.getLocalMatrix().multiplyToRef(N,w.getFinalMatrix()):w.getFinalMatrix().p(w.getLocalMatrix()),-1!==w._index){const N=null===w._index?q:w._index;w.getAbsoluteInverseBindMatrix().multiplyToArray(w.getFinalMatrix(),R,16*N)}}this._identity.copyToArray(R,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const R=this.va().getRenderId();if(this._currentRenderId===R)return;this._currentRenderId=R}if(this._numBonesWithLinkedTransformNode>0)for(const R of this.bones)if(R._linkedTransformNode){const N=R._linkedTransformNode;R.position=N.position,N.rotationQuaternion?R.rotationQuaternion=N.rotationQuaternion:R.rotation=N.rotation,R.Fe=N.Fe}if(this.needInitialSkinMatrix)for(const R of this._meshesWithPoseMatrix){const N=R.getPoseMatrix();let q=this._isDirty;if(R._bonesTransformMatrices&&R._bonesTransformMatrices.length===16*(this.bones.length+1)||(R._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),q=!0),q){if(this._synchronizedWithMesh!==R){this._synchronizedWithMesh=R;for(const R of this.bones)if(!R.getParent()){R.getBindMatrix().multiplyToRef(N,u.f.Matrix[1]),R._updateAbsoluteBindMatrices(u.f.Matrix[1])}if(this.isUsingTextureForMatrices){const N=4*(this.bones.length+1);R._transformMatrixTexture&&R._transformMatrixTexture.getSize().width===N||(R._transformMatrixTexture&&R._transformMatrixTexture.dispose(),R._transformMatrixTexture=j.c.CreateRGBATexture(R._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(R._bonesTransformMatrices,N),this.isUsingTextureForMatrices&&R._transformMatrixTexture&&R._transformMatrixTexture.update(R._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=j.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let R=0;R<this.bones.length;R++)this._animatables.push(this.bones[R])}return this._animatables}clone(R,N){const q=new C(R,N||R,this._scene);q.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let w=0;w<this.bones.length;w++){const R=this.bones[w];let N=null;const u=R.getParent();if(u){const R=this.bones.indexOf(u);N=q.bones[R]}const M=new y.b(R.name,q,N,R.getBindMatrix().clone(),R.getRestMatrix().clone());M._index=R._index,R._linkedTransformNode&&M.linkTransformNode(R._linkedTransformNode),k.c.DeepCopy(R.animations,M.animations)}if(this._ranges){q._ranges={};for(const R in this._ranges){const N=this._ranges[R];N&&(q._ranges[R]=N.clone())}}return this._isDirty=!0,q.prepare(!0),q}enableBlending(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((N=>{N.animations.forEach((N=>{N.enableBlending=!0,N.blendingSpeed=R}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const R=this._parentContainer.skeletons.indexOf(this);R>-1&&this._parentContainer.skeletons.splice(R,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const R={};R.name=this.name,R.id=this.id,this.dimensionsAtRest&&(R.dimensionsAtRest=this.dimensionsAtRest.de()),R.bones=[],R.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let q=0;q<this.bones.length;q++){var N;const w=this.bones[q],u=w.getParent(),M={parentBoneIndex:u?this.bones.indexOf(u):-1,index:w.getIndex(),name:w.name,id:w.id,matrix:w.getBindMatrix().de(),rest:w.getRestMatrix().de(),linkedTransformNodeId:null===(N=w.getTransformNode())||void 0===N?void 0:N.id};R.bones.push(M),w.length&&(M.length=w.length),w.metadata&&(M.metadata=w.metadata),w.animations&&w.animations.length>0&&(M.animation=w.animations[0].serialize()),R.ranges=[];for(const N in this._ranges){const q=this._ranges[N];if(!q)continue;const w={};w.name=N,w.from=q.from,w.to=q.to,R.ranges.push(w)}}return R}static Parse(R,N){const q=new C(R.name,R.id,N);let w;for(R.dimensionsAtRest&&(q.dimensionsAtRest=u.m.Sd(R.dimensionsAtRest)),q.needInitialSkinMatrix=R.needInitialSkinMatrix,w=0;w<R.bones.length;w++){const N=R.bones[w],M=R.bones[w].index;let v=null;N.parentBoneIndex>-1&&(v=q.bones[N.parentBoneIndex]);const G=N.rest?u.c.Sd(N.rest):null,J=new y.b(N.name,q,v,u.c.Sd(N.matrix),G,null,M);void 0!==N.id&&null!==N.id&&(J.id=N.id),N.length&&(J.length=N.length),N.metadata&&(J.metadata=N.metadata),N.animation&&J.animations.push(F.c.Parse(N.animation)),void 0!==N.linkedTransformNodeId&&null!==N.linkedTransformNodeId&&(q._hasWaitingData=!0,J._waitingTransformNodeId=N.linkedTransformNodeId)}if(R.ranges)for(w=0;w<R.ranges.length;w++){const N=R.ranges[w];q.createAnimationRange(N.name,N.from,N.to)}return q}computeAbsoluteMatrices(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||R)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(R)}getPoseMatrix(){let R=null;return this._meshesWithPoseMatrix.length>0&&(R=this._meshesWithPoseMatrix[0].getPoseMatrix()),R}sortBones(){const R=[],N=new Array(this.bones.length);for(let q=0;q<this.bones.length;q++)this._sortBones(q,R,N);this.bones=R}_sortBones(R,N,q){if(q[R])return;q[R]=!0;const w=this.bones[R];if(!w)return;void 0===w._index&&(w._index=R);const u=w.getParent();u&&this._sortBones(this.bones.indexOf(u),N,q),N.push(w)}setCurrentPoseAsRest(){this.bones.forEach((R=>{R.setCurrentPoseAsRest()}))}}var e=q(1306),K=q(942),r=q(947),Z=q(12018),z=q(12023),d=q(982),x=q(1128);class E extends z.d{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(R){this.subSurface.refractionTexture=R,R?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(R){this.subSurface.indexOfRefraction=R}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(R){this.subSurface.invertRefractionY=R}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(R){this.subSurface.linkRefractionWithTransparency=R,R&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===z.d.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(R){R!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=R?z.d.LIGHTFALLOFF_PHYSICAL:z.d.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===z.d.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(R){R!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=R?z.d.LIGHTFALLOFF_GLTF:z.d.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(R){this._attachImageProcessingConfiguration(R),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(R){this.imageProcessingConfiguration.colorCurvesEnabled=R}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(R){this.imageProcessingConfiguration.colorGradingEnabled=R}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(R){this._imageProcessingConfiguration.toneMappingEnabled=R}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(R){this._imageProcessingConfiguration.exposure=R}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(R){this._imageProcessingConfiguration.contrast=R}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(R){this._imageProcessingConfiguration.colorGradingTexture=R}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(R){this._imageProcessingConfiguration.colorCurves=R}constructor(R,N){super(R,N,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=E.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=M.c.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new M.c(0,0,0),this.albedoColor=new M.c(1,1,1),this.reflectivityColor=new M.c(1,1,1),this.reflectionColor=new M.c(1,1,1),this.emissiveColor=new M.c(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,Z.c)(this.va())}getClassName(){return"PBRMaterial"}clone(R){let N=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const w=x.e.Clone((()=>new E(R,this.va())),this,{cloneTexturesOnlyOnce:N});return w.id=R,w.name=R,this.stencil.copyTo(w.stencil),this._clonePlugins(w,q),w}serialize(){const R=super.serialize();return R.customType="BABYLON.PBRMaterial",R}static Parse(R,N,q){const w=x.e.Parse((()=>new E(R.name,N)),R,N,q);return R.stencil&&w.stencil.parse(R.stencil,N,q),e.e._ParsePlugins(R,w,N,q),R.clearCoat&&w.clearCoat.parse(R.clearCoat,N,q),R.anisotropy&&w.anisotropy.parse(R.anisotropy,N,q),R.brdf&&w.brdf.parse(R.brdf,N,q),R.sheen&&w.sheen.parse(R.sheen,N,q),R.subSurface&&w.subSurface.parse(R.subSurface,N,q),R.iridescence&&w.iridescence.parse(R.iridescence,N,q),w}}E.PBRMATERIAL_OPAQUE=z.d.PBRMATERIAL_OPAQUE,E.PBRMATERIAL_ALPHATEST=z.d.PBRMATERIAL_ALPHATEST,E.PBRMATERIAL_ALPHABLEND=z.d.PBRMATERIAL_ALPHABLEND,E.PBRMATERIAL_ALPHATESTANDBLEND=z.d.PBRMATERIAL_ALPHATESTANDBLEND,E.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=z.d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"directIntensity",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"emissiveIntensity",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"environmentIntensity",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"specularIntensity",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"disableBumpMap",void 0),(0,K.b)([(0,r.y)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"albedoTexture",void 0),(0,K.b)([(0,r.y)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"ambientTexture",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"ambientTextureStrength",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,K.b)([(0,r.y)(),(0,r.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],E.prototype,"opacityTexture",void 0),(0,K.b)([(0,r.y)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"reflectionTexture",void 0),(0,K.b)([(0,r.y)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"emissiveTexture",void 0),(0,K.b)([(0,r.y)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"reflectivityTexture",void 0),(0,K.b)([(0,r.y)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"metallicTexture",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"metallic",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"roughness",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"metallicF0Factor",void 0),(0,K.b)([(0,r.l)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"metallicReflectanceColor",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,K.b)([(0,r.y)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"metallicReflectanceTexture",void 0),(0,K.b)([(0,r.y)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"reflectanceTexture",void 0),(0,K.b)([(0,r.y)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"microSurfaceTexture",void 0),(0,K.b)([(0,r.y)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"bumpTexture",void 0),(0,K.b)([(0,r.y)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty",null)],E.prototype,"lightmapTexture",void 0),(0,K.b)([(0,r.l)("ambient"),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"ambientColor",void 0),(0,K.b)([(0,r.l)("albedo"),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"albedoColor",void 0),(0,K.b)([(0,r.l)("reflectivity"),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"reflectivityColor",void 0),(0,K.b)([(0,r.l)("reflection"),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"reflectionColor",void 0),(0,K.b)([(0,r.l)("emissive"),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"emissiveColor",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"microSurface",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useLightmapAsShadowmap",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],E.prototype,"useAlphaFromAlbedoTexture",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],E.prototype,"forceAlphaTest",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],E.prototype,"alphaCutOff",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useSpecularOverAlpha",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useAmbientInGrayScale",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,K.b)([(0,r.E)()],E.prototype,"usePhysicalLightFalloff",null),(0,K.b)([(0,r.E)()],E.prototype,"useGLTFLightFalloff",null),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useRadianceOverAlpha",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useObjectSpaceNormalMap",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useParallax",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useParallaxOcclusion",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"parallaxScaleBias",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsLightsDirty")],E.prototype,"disableLighting",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"forceIrradianceInFragment",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsLightsDirty")],E.prototype,"maxSimultaneousLights",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"invertNormalMapX",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"invertNormalMapY",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"twoSidedLighting",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useAlphaFresnel",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useLinearAlphaFresnel",void 0),(0,K.b)([(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"environmentBRDFTexture",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"forceNormalForward",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"enableSpecularAntiAliasing",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useHorizonOcclusion",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsTexturesDirty")],E.prototype,"useRadianceOcclusion",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsMiscDirty")],E.prototype,"unlit",void 0),(0,K.b)([(0,r.E)(),(0,r.c)("_markAllSubMeshesAsMiscDirty")],E.prototype,"applyDecalMapAfterDetailMap",void 0),(0,d.h)("BABYLON.PBRMaterial",E);var P=q(933),s=q(11420),O=q(1227),L=q(11405),m=q(11412),o=q(11381);class A{get influence(){return this._influence}set influence(R){if(this._influence===R)return;const N=this._influence;this._influence=R,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===N||0===R)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(R){this._animationPropertiesOverride=R}constructor(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=R,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new a.c,this._onDataLayoutChanged=new a.c,this._animationPropertiesOverride=null,this.id=R,this._scene=q||H.e.LastCreatedScene,this.influence=N,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(R){const N=this.hasPositions;this._positions=R,N!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(R){const N=this.hasNormals;this._normals=R,N!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(R){const N=this.hasTangents;this._tangents=R,N!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(R){const N=this.hasUVs;this._uvs=R,N!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const R=x.e.Clone((()=>new A(this.name,this.influence,this._scene)),this);return R._positions=this._positions,R._normals=this._normals,R._tangents=this._tangents,R._uvs=this._uvs,R}serialize(){const R={};return R.name=this.name,R.influence=this.influence,R.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(R.id=this.id),this.hasNormals&&(R.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(R.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(R.Aa=Array.prototype.slice.call(this.getUVs())),x.e.AppendSerializedAnimations(this,R),R}getClassName(){return"MorphTarget"}static Parse(R,N){const q=new A(R.name,R.influence);if(q.setPositions(R.xa),null!=R.id&&(q.id=R.id),R.ya&&q.setNormals(R.ya),R.tangents&&q.setTangents(R.tangents),R.Aa&&q.setUVs(R.Aa),R.animations){for(let N=0;N<R.animations.length;N++){const w=R.animations[N],u=(0,d.e)("BABYLON.Animation");u&&q.animations.push(u.Parse(w))}R.autoAnimate&&N&&N.beginAnimation(q,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1)}return q}static FromMesh(R,N,q){N||(N=R.name);const w=new A(N,q,R.va());return w.setPositions(R.getVerticesData(O.e.PositionKind)),R.isVerticesDataPresent(O.e.NormalKind)&&w.setNormals(R.getVerticesData(O.e.NormalKind)),R.isVerticesDataPresent(O.e.TangentKind)&&w.setTangents(R.getVerticesData(O.e.TangentKind)),R.isVerticesDataPresent(O.e.UVKind)&&w.setUVs(R.getVerticesData(O.e.UVKind)),w}}(0,K.b)([(0,r.E)()],A.prototype,"id",void 0);var n=q(1171),Q=q(1539);class Y{set areUpdatesFrozen(R){R?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new n.f(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,R||(R=H.e.LastCreatedScene),this._scene=R,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const R=this._scene.getEngine().getCaps();this._canUseTextureForTargets=R.canUseGLVertexID&&R.textureFloat&&R.maxVertexTextureImageUnits>0&&R.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(R){this._numMaxInfluencers!==R&&(this._numMaxInfluencers=R,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(R){this._useTextureToStoreTargets=R}get isUsingTextureForTargets(){var R;return Y.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(R=this._scene)&&void 0!==R&&R.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(R){return this._activeTargets.data[R]}getTarget(R){return this._targets[R]}getTargetByName(R){for(const N of this._targets)if(N.name===R)return N;return null}addTarget(R){this._targets.push(R),this._targetInfluenceChangedObservers.push(R.onInfluenceChanged.add((R=>{this._syncActiveTargets(R)}))),this._targetDataLayoutChangedObservers.push(R._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(R){const N=this._targets.indexOf(R);N>=0&&(this._targets.splice(N,1),R.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(N,1)[0]),R._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(N,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(R)}_bind(R){R.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),R.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),R.setTexture("morphTargets",this._targetStoreTexture),R.setInt("morphTargetCount",this.numInfluencers)}clone(){const R=new Y(this._scene);for(const N of this._targets)R.addTarget(N.clone());return R.enableNormalMorphing=this.enableNormalMorphing,R.enableTangentMorphing=this.enableTangentMorphing,R.enableUVMorphing=this.enableUVMorphing,R}serialize(){const R={};R.id=this.uniqueId,R.targets=[];for(const N of this._targets)R.targets.push(N.serialize());return R}_syncActiveTargets(R){if(this.areUpdatesFrozen)return;let N=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let q=-1;for(const w of this._targets){if(q++,0===w.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=Y.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(w),this._morphTargetTextureIndices[N]=q,this._tempInfluences[N++]=w.influence,this._supportsNormals=this._supportsNormals&&w.hasNormals,this._supportsTangents=this._supportsTangents&&w.hasTangents,this._supportsUVs=this._supportsUVs&&w.hasUVs;const R=w.getPositions();if(R){const N=R.length/3;if(0===this._vertexCount)this._vertexCount=N;else if(this._vertexCount!==N)return void W.e.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==N&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,N)),this._influences&&this._influences.length===N||(this._influences=new Float32Array(N));for(let w=0;w<N;w++)this._influences[w]=this._tempInfluences[w];R&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const R=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>R&&(this._textureHeight=Math.ceil(this._textureWidth/R),this._textureWidth=R);let N=!0;if(this._targetStoreTexture){const R=this._targetStoreTexture.getSize();R.width===this._textureWidth&&R.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(N=!1)}if(N){this._targetStoreTexture&&this._targetStoreTexture.dispose();const R=this._targets.length,N=new Float32Array(R*this._textureWidth*this._textureHeight*4);let q=0;for(let w=0;w<R;w++){const R=this._targets[w],u=R.getPositions(),M=R.getNormals(),v=R.getUVs(),G=R.getTangents();if(!u)return void(0===w&&W.e.Error("Invalid morph target. Target must have positions."));q=w*this._textureWidth*this._textureHeight*4;for(let w=0;w<this._vertexCount;w++)N[q]=u[3*w],N[q+1]=u[3*w+1],N[q+2]=u[3*w+2],q+=4,this._supportsNormals&&M&&(N[q]=M[3*w],N[q+1]=M[3*w+1],N[q+2]=M[3*w+2],q+=4),this._supportsUVs&&v&&(N[q]=v[2*w],N[q+1]=v[2*w+1],q+=4),this._supportsTangents&&G&&(N[q]=G[3*w],N[q+1]=G[3*w+1],N[q+2]=G[3*w+2],q+=4)}this._targetStoreTexture=Q.c.CreateRGBATexture(N,this._textureWidth,this._textureHeight,R,this._scene,!1,!1,1,1)}}for(const R of this._scene.meshes)R.morphTargetManager===this&&R._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const R=this._parentContainer.morphTargetManagers.indexOf(this);R>-1&&this._parentContainer.morphTargetManagers.splice(R,1),this._parentContainer=null}for(const R of this._targets)this._scene.stopAnimation(R)}}static Parse(R,N){const q=new Y(N);for(const w of R.targets)q.addTarget(A.Parse(w,N));return q}}Y.EnableTextureStorage=!0,Y.MaxActiveMorphTargetsInVertexAttributeMode=8;var T=q(12028),f=q(1015),c=q(1328);function b(R,N,q,w){return u.m.Sd(N,q).scaleInPlace(w)}class I{constructor(R,N,q,w){this.type=R,this.name=N,this.getValue=q,this.getStride=w}_buildAnimation(R,N,q){const w=new F.c(R,this.name,N,this.type);return w.setKeys(q),w}}class V extends I{buildAnimations(R,N,q,w,u){u(R._babylonTransformNode,this._buildAnimation(N,q,w))}}const t={translation:[new V(F.c.ANIMATIONTYPE_VECTOR3,"position",b,(()=>3))],rotation:[new V(F.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(R,N,q,w){return u.e.Sd(N,q).scaleInPlace(w)}),(()=>4))],scale:[new V(F.c.ANIMATIONTYPE_VECTOR3,"Fe",b,(()=>3))],weights:[new class extends I{buildAnimations(R,N,q,w,u){if(R._numMorphTargets)for(let M=0;M<R._numMorphTargets;M++){const v=new F.c(`${N}_${M}`,this.name,q,this.type);if(v.setKeys(w.map((R=>({frame:R.frame,inTangent:R.inTangent?R.inTangent[M]:void 0,value:R.value[M],outTangent:R.outTangent?R.outTangent[M]:void 0,interpolation:R.interpolation})))),R._primitiveBabylonMeshes)for(const N of R._primitiveBabylonMeshes)if(N.morphTargetManager){const R=N.morphTargetManager.getTarget(M),q=v.clone();R.animations.push(q),u(R,q)}}}}(F.c.ANIMATIONTYPE_FLOAT,"influence",(function(R,N,q,w){const u=new Array(R._numMorphTargets);for(let M=0;M<u.length;M++)u[M]=N[q++]*w;return u}),(R=>R._numMorphTargets))]},i=new Map,g=i;function U(R,N,q){B(R)&&W.e.Warn(`Extension with the name '${R}' already exists`),i.set(R,{isGLTFExtension:N,factory:q})}function B(R){return i.delete(R)}function l(){const R=R=>R&&"object"===typeof R;for(var N=arguments.length,q=new Array(N),w=0;w<N;w++)q[w]=arguments[w];return q.reduce(((N,q)=>(Object.keys(q).forEach((w=>{const u=N[w],M=q[w];Array.isArray(u)&&Array.isArray(M)?N[w]=u.concat(...M):R(u)&&R(M)?N[w]=l(u,M):N[w]=M})),N)),{})}class X{static Get(R,N,q){if(!N||void 0==q||!N[q])throw new Error(`${R}: Failed to find index (${q})`);return N[q]}static TryGet(R,N){return R&&void 0!=N&&R[N]?R[N]:null}static Assign(R){if(R)for(let N=0;N<R.length;N++)R[N].index=N}}class h{static RegisterExtension(R,N){U(R,!1,N)}static UnregisterExtension(R){return B(R)}get $i(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(R){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=R}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((R=>R.dispose&&R.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(R,N,q,w,u,M){let v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=N,this._assetContainer=q,this._loadData(w);let M=null;if(R){const N={};if(this._gltf.nodes)for(const R of this._gltf.nodes)R.name&&(N[R.name]=R.index);M=(R instanceof Array?R:[R]).map((R=>{const q=N[R];if(void 0===q)throw new Error(`Failed to find node '${R}'`);return q}))}return this._loadAsync(u,v,M,(()=>({meshes:this._getMeshes(),he:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(R,N,q,w){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=R,this._loadData(N),this._loadAsync(q,u,null,(()=>{})))))}_loadAsync(R,N,q,w){return Promise.resolve().then((async()=>{this._rootUrl=R,this._uniqueRootUrl=!R.startsWith("file:")&&N?R:`${R}${Date.now()}/`,this._fileName=N,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const u=`${T.j[T.j.LOADING]} => ${T.j[T.j.READY]}`,M=`${T.j[T.j.LOADING]} => ${T.j[T.j.COMPLETE]}`;this._parent._startPerformanceCounter(u),this._parent._startPerformanceCounter(M),this._parent._setState(T.j.LOADING),this._extensionsOnLoading();const G=new Array;if(!this.parent.loadOnlyMaterials)if(q)G.push(this.loadSceneAsync("/nodes",{nodes:q,index:-1}));else if(void 0!=this._gltf.Ke||this._gltf.scenes&&this._gltf.scenes[0]){const R=X.Get("/scene",this._gltf.scenes,this._gltf.Ke||0);G.push(this.loadSceneAsync(`/scenes/${R.index}`,R))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let R=0;R<this._gltf.materials.length;++R){const N=this._gltf.materials[R],q="/materials/"+R,w=e.e.TriangleFillMode;G.push(this._loadMaterialAsync(q,N,null,w,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&G.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&G.push(this._compileShadowGeneratorsAsync());return Promise.all(G).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Jg(!0),this._extensionsOnReady(),this._parent._setState(T.j.READY),this._startAnimations(),w()))).then((R=>(this._parent._endPerformanceCounter(u),v.i.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(M),this._parent._setState(T.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(R=>{this._parent.onErrorObservable.notifyObservers(R),this._parent.onErrorObservable.clear(),this.dispose()}))})),R)))})).catch((R=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(R),this._parent.onErrorObservable.clear(),this.dispose()),R}))}_loadData(R){if(this._gltf=R.json,this._setupData(),R.bin){const N=this._gltf.buffers;if(N&&N[0]&&!N[0].uri){const q=N[0];(q.byteLength<R.bin.byteLength-3||q.byteLength>R.bin.byteLength)&&W.e.Warn(`Binary buffer length (${q.byteLength}) from JSON does not match chunk length (${R.bin.byteLength})`),this._bin=R.bin}else W.e.Warn("Unexpected BIN chunk")}}_setupData(){if(X.Assign(this._gltf.accessors),X.Assign(this._gltf.animations),X.Assign(this._gltf.buffers),X.Assign(this._gltf.bufferViews),X.Assign(this._gltf.cameras),X.Assign(this._gltf.images),X.Assign(this._gltf.materials),X.Assign(this._gltf.meshes),X.Assign(this._gltf.nodes),X.Assign(this._gltf.samplers),X.Assign(this._gltf.scenes),X.Assign(this._gltf.skins),X.Assign(this._gltf.textures),this._gltf.nodes){const R={};for(const q of this._gltf.nodes)if(q.children)for(const N of q.children)R[N]=q.index;const N=this._createRootNode();for(const q of this._gltf.nodes){const w=R[q.index];q.parent=void 0===w?N:this._gltf.nodes[w]}}}async _loadExtensionsAsync(){const R=[];if(g.forEach(((N,q)=>{var w;!1===(null===(w=this.parent.extensionOptions[q])||void 0===w?void 0:w.enabled)?N.isGLTFExtension&&this.isExtensionUsed(q)&&W.e.Warn(`Extension ${q} is used but has been explicitly disabled.`):N.isGLTFExtension&&!this.isExtensionUsed(q)||R.push((async()=>{const R=await N.factory(this);return R.name!==q&&W.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${R.name} !== ${q}`),this._parent.onExtensionLoadedObservable.notifyObservers(R),R})())})),this._extensions.push(...await Promise.all(R)),this._extensions.sort(((R,N)=>(R.order||Number.MAX_VALUE)-(N.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const q of this._gltf.extensionsRequired){if(!this._extensions.some((R=>R.name===q&&R.enabled))){var N;if(!1===(null===(N=this.parent.extensionOptions[q])||void 0===N?void 0:N.enabled))throw new Error(`Required extension ${q} is disabled`);throw new Error(`Required extension ${q} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const R=new o.b("__root__",this._babylonScene);this._rootBabylonMesh=R,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Jg(!1);const N={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case T.f.AUTO:this._babylonScene.useRightHandedSystem||(N.rotation=[0,1,0,0],N.scale=[1,1,-1],h._LoadTransform(N,this._rootBabylonMesh));break;case T.f.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(R),N}loadSceneAsync(R,N){const q=this._extensionsLoadSceneAsync(R,N);if(q)return q;const w=new Array;if(this.logOpen(`${R} ${N.name||""}`),N.nodes)for(const u of N.nodes){const N=X.Get(`${R}/nodes/${u}`,this._gltf.nodes,u);w.push(this.loadNodeAsync(`/nodes/${N.index}`,N,(R=>{R.parent=this._rootBabylonMesh})))}for(const u of this._postSceneLoadActions)u();return w.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(w).then((()=>{}))}_forEachPrimitive(R,N){if(R._primitiveBabylonMeshes)for(const q of R._primitiveBabylonMeshes)N(q)}_getGeometries(){const R=[],N=this._gltf.nodes;if(N)for(const q of N)this._forEachPrimitive(q,(N=>{const q=N.te;q&&-1===R.indexOf(q)&&R.push(q)}));return R}_getMeshes(){const R=[];this._rootBabylonMesh instanceof m.e&&R.push(this._rootBabylonMesh);const N=this._gltf.nodes;if(N)for(const q of N)this._forEachPrimitive(q,(N=>{R.push(N)}));return R}_getTransformNodes(){const R=[],N=this._gltf.nodes;if(N)for(const q of N)q._babylonTransformNode&&"mb"===q._babylonTransformNode.getClassName()&&R.push(q._babylonTransformNode),q._babylonTransformNodeForSkin&&R.push(q._babylonTransformNodeForSkin);return R}_getSkeletons(){const R=[],N=this._gltf.skins;if(N)for(const q of N)q._data&&R.push(q._data.babylonSkeleton);return R}_getAnimationGroups(){const R=[],N=this._gltf.animations;if(N)for(const q of N)q._babylonAnimationGroup&&R.push(q._babylonAnimationGroup);return R}_startAnimations(){switch(this._parent.animationStartMode){case T.e.NONE:break;case T.e.FIRST:{const R=this._getAnimationGroups();0!==R.length&&R[0].start(!0);break}case T.e.ALL:{const R=this._getAnimationGroups();for(const N of R)N.start(!0);break}default:return void W.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const w=this._extensionsLoadNodeAsync(R,N,q);if(w)return w;if(N._babylonTransformNode)throw new Error(`${R}: Invalid recursive node hierarchy`);const u=new Array;this.logOpen(`${R} ${N.name||""}`);const M=w=>{if(h.AddPointerMetadata(w,R),h._LoadTransform(N,w),void 0!=N.camera){const q=X.Get(`${R}/camera`,this._gltf.cameras,N.camera);u.push(this.loadCameraAsync(`/cameras/${q.index}`,q,(R=>{R.parent=w})))}if(N.children)for(const q of N.children){const N=X.Get(`${R}/children/${q}`,this._gltf.nodes,q);u.push(this.loadNodeAsync(`/nodes/${N.index}`,N,(R=>{R.parent=w})))}q(w)},v=void 0!=N.mesh,G=this._parent.loadSkins&&void 0!=N.skin;if(!v||G){const R=N.name||`node${N.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new s.d(R,this._babylonScene);q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==N.mesh?N._babylonTransformNode=q:N._babylonTransformNodeForSkin=q,M(q)}if(v)if(G){const q=X.Get(`${R}/mesh`,this._gltf.meshes,N.mesh);u.push(this._loadMeshAsync(`/meshes/${q.index}`,N,q,(q=>{const w=N._babylonTransformNodeForSkin;q.metadata=l(w.metadata,q.metadata||{});const M=X.Get(`${R}/skin`,this._gltf.skins,N.skin);u.push(this._loadSkinAsync(`/skins/${M.index}`,N,M,(R=>{this._forEachPrimitive(N,(N=>{N.skeleton=R})),this._postSceneLoadActions.push((()=>{if(void 0!=M.skeleton){const R=X.Get(`/skins/${M.index}/skeleton`,this._gltf.nodes,M.skeleton).parent;N.index===R.index?q.parent=w.parent:q.parent=R._babylonTransformNode}else q.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:w,skinnedNode:q})}))})))})))}else{const q=X.Get(`${R}/mesh`,this._gltf.meshes,N.mesh);u.push(this._loadMeshAsync(`/meshes/${q.index}`,N,q,M))}return this.logClose(),Promise.all(u).then((()=>(this._forEachPrimitive(N,(R=>{R.te&&R.te.useBoundingInfoFromGeometry?R.Ea():R.refreshBoundingInfo(!0,!0)})),N._babylonTransformNode)))}_loadMeshAsync(R,N,q,w){const u=q.primitives;if(!u||!u.length)throw new Error(`${R}: Primitives are missing`);void 0==u[0].index&&X.Assign(u);const M=new Array;this.logOpen(`${R} ${q.name||""}`);const v=N.name||`node${N.index}`;if(1===u.length){const w=q.primitives[0];M.push(this._loadMeshPrimitiveAsync(`${R}/primitives/${w.index}`,v,N,q,w,(R=>{N._babylonTransformNode=R,N._primitiveBabylonMeshes=[R]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,N._babylonTransformNode=new s.d(v,this._babylonScene),N._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,N._primitiveBabylonMeshes=[];for(const w of u)M.push(this._loadMeshPrimitiveAsync(`${R}/primitives/${w.index}`,`${v}_primitive${w.index}`,N,q,w,(R=>{R.parent=N._babylonTransformNode,N._primitiveBabylonMeshes.push(R)})))}return w(N._babylonTransformNode),this.logClose(),Promise.all(M).then((()=>N._babylonTransformNode))}_loadMeshPrimitiveAsync(R,N,q,w,u,M){const v=this._extensionsLoadMeshPrimitiveAsync(R,N,q,w,u,M);if(v)return v;this.logOpen(`${R}`);const G=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==q.skin&&!w.primitives[0].targets;let J,y;if(G&&u._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,J=u._instanceData.babylonSourceMesh.pd(N),J._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y=u._instanceData.promise;else{const M=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new o.b(N,this._babylonScene);v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v.sideOrientation=this._babylonScene.useRightHandedSystem?e.e.CounterClockWiseSideOrientation:e.e.ClockWiseSideOrientation,this._createMorphTargets(R,q,w,u,v),M.push(this._loadVertexDataAsync(R,u,v).then((N=>this._loadMorphTargetsAsync(R,u,v,N).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,N.Ca(v),N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const a=h._GetDrawMode(R,u.mode);if(void 0==u.material){let R=this._defaultBabylonMaterialData[a];R||(R=this._createDefaultMaterial("__GLTFLoader._default",a),this._parent.onMaterialLoadedObservable.notifyObservers(R),this._defaultBabylonMaterialData[a]=R),v.material=R}else if(!this.parent.skipMaterials){const N=X.Get(`${R}/material`,this._gltf.materials,u.material);M.push(this._loadMaterialAsync(`/materials/${N.index}`,N,v,a,(R=>{v.material=R})))}y=Promise.all(M),G&&(u._instanceData={babylonSourceMesh:v,promise:y}),J=v}return h.AddPointerMetadata(J,R),this._parent.onMeshLoadedObservable.notifyObservers(J),M(J),this.logClose(),y.then((()=>J))}_loadVertexDataAsync(R,N,q){const w=this._extensionsLoadVertexDataAsync(R,N,q);if(w)return w;const M=N.attributes;if(!M)throw new Error(`${R}: Attributes are missing`);const v=new Array,G=new L.b(q.name,this._babylonScene);if(void 0==N.indices)q.isUnIndexed=!0;else{const q=X.Get(`${R}/indices`,this._gltf.accessors,N.indices);v.push(this._loadIndicesAccessorAsync(`/accessors/${q.index}`,q).then((R=>{G.setIndices(R)})))}const J=(N,w,J)=>{if(void 0==M[N])return;q._delayInfo=q._delayInfo||[],-1===q._delayInfo.indexOf(w)&&q._delayInfo.push(w);const y=X.Get(`${R}/attributes/${N}`,this._gltf.accessors,M[N]);v.push(this._loadVertexAccessorAsync(`/accessors/${y.index}`,y,w).then((R=>{if(R.getKind()===O.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!q.skeleton&&y.min&&y.max){const R=u.f.Od[0].Rd(...y.min),N=u.f.Od[1].Rd(...y.max);if(y.normalized&&5126!==y.componentType){let q=1;switch(y.componentType){case 5120:q=127;break;case 5121:q=255;break;case 5122:q=32767;break;case 5123:q=65535}const w=1/q;R.scaleInPlace(w),N.scaleInPlace(w)}G._boundingInfo=new c.b(R,N),G.useBoundingInfoFromGeometry=!0}G.setVerticesBuffer(R,y.count)}))),w==O.e.MatricesIndicesExtraKind&&(q.numBoneInfluencers=8),J&&J(y)};return J("POSITION",O.e.PositionKind),J("NORMAL",O.e.NormalKind),J("TANGENT",O.e.TangentKind),J("TEXCOORD_0",O.e.UVKind),J("TEXCOORD_1",O.e.UV2Kind),J("TEXCOORD_2",O.e.UV3Kind),J("TEXCOORD_3",O.e.UV4Kind),J("TEXCOORD_4",O.e.UV5Kind),J("TEXCOORD_5",O.e.UV6Kind),J("JOINTS_0",O.e.MatricesIndicesKind),J("WEIGHTS_0",O.e.MatricesWeightsKind),J("JOINTS_1",O.e.MatricesIndicesExtraKind),J("WEIGHTS_1",O.e.MatricesWeightsExtraKind),J("COLOR_0",O.e.ColorKind,(R=>{"VEC4"===R.type&&(q.hasVertexAlpha=!0)})),Promise.all(v).then((()=>G))}_createMorphTargets(R,N,q,w,u){if(!w.targets||!this._parent.loadMorphTargets)return;if(void 0==N._numMorphTargets)N._numMorphTargets=w.targets.length;else if(w.targets.length!==N._numMorphTargets)throw new Error(`${R}: Primitives do not have the same number of targets`);const M=q.extras?q.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,u.morphTargetManager=new Y(this._babylonScene),u.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u.morphTargetManager.areUpdatesFrozen=!0;for(let v=0;v<w.targets.length;v++){const R=N.weights?N.weights[v]:q.weights?q.weights[v]:0,w=M?M[v]:`morphTarget${v}`;u.morphTargetManager.addTarget(new A(w,R,u.va()))}}_loadMorphTargetsAsync(R,N,q,w){if(!N.targets||!this._parent.loadMorphTargets)return Promise.resolve();const u=new Array,M=q.morphTargetManager;for(let v=0;v<M.numTargets;v++){const q=M.getTarget(v);u.push(this._loadMorphTargetVertexDataAsync(`${R}/targets/${v}`,w,N.targets[v],q))}return Promise.all(u).then((()=>{M.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(R,N,q,w){const u=new Array,M=(w,M,v)=>{if(void 0==q[w])return;const G=N.getVertexBuffer(M);if(!G)return;const J=X.Get(`${R}/${w}`,this._gltf.accessors,q[w]);u.push(this._loadFloatAccessorAsync(`/accessors/${J.index}`,J).then((R=>{v(G,R)})))};return M("POSITION",O.e.PositionKind,((R,N)=>{const q=new Float32Array(N.length);R.forEach(N.length,((R,w)=>{q[w]=N[w]+R})),w.setPositions(q)})),M("NORMAL",O.e.NormalKind,((R,N)=>{const q=new Float32Array(N.length);R.forEach(q.length,((R,w)=>{q[w]=N[w]+R})),w.setNormals(q)})),M("TANGENT",O.e.TangentKind,((R,N)=>{const q=new Float32Array(N.length/3*4);let u=0;R.forEach(N.length/3*4,((R,w)=>{(w+1)%4!==0&&(q[u]=N[u]+R,u++)})),w.setTangents(q)})),Promise.all(u).then((()=>{}))}static _LoadTransform(R,N){if(void 0!=R.skin)return;let q=u.m.Zero(),w=u.e.Identity(),M=u.m.One();if(R.matrix){u.c.Sd(R.matrix).decompose(M,w,q)}else R.translation&&(q=u.m.Sd(R.translation)),R.rotation&&(w=u.e.Sd(R.rotation)),R.scale&&(M=u.m.Sd(R.scale));N.position=q,N.rotationQuaternion=w,N.Fe=M}_loadSkinAsync(R,N,q,w){if(!this._parent.loadSkins)return Promise.resolve();const u=this._extensionsLoadSkinAsync(R,N,q);if(u)return u;if(q._data)return w(q._data.babylonSkeleton),q._data.promise;const M=`skeleton${q.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new C(q.name||M,M,this._babylonScene);v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(R,q,v);const G=this._loadSkinInverseBindMatricesDataAsync(R,q).then((R=>{this._updateBoneMatrices(v,R)}));return q._data={babylonSkeleton:v,promise:G},w(v),G}_loadBones(R,N,q){if(void 0==N.skeleton||this._parent.alwaysComputeSkeletonRootNode){const q=this._findSkeletonRootNode(`${R}/joints`,N.joints);if(q)if(void 0===N.skeleton)N.skeleton=q.index;else{const w=(R,N)=>{for(;N.parent;N=N.parent)if(N.parent===R)return!0;return!1},u=X.Get(`${R}/skeleton`,this._gltf.nodes,N.skeleton);u===q||w(u,q)||(W.e.Warn(`${R}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),N.skeleton=q.index)}else W.e.Warn(`${R}: Failed to find common root`)}const w={};for(const u of N.joints){const M=X.Get(`${R}/joints/${u}`,this._gltf.nodes,u);this._loadBone(M,N,q,w)}}_findSkeletonRootNode(R,N){if(0===N.length)return null;const q={};for(const u of N){const N=[];let w=X.Get(`${R}/${u}`,this._gltf.nodes,u);for(;-1!==w.index;)N.unshift(w),w=w.parent;q[u]=N}let w=null;for(let u=0;;++u){let R=q[N[0]];if(u>=R.length)return w;const M=R[u];for(let v=1;v<N.length;++v)if(R=q[N[v]],u>=R.length||M!==R[u])return w;w=M}}_loadBone(R,N,q,w){R._isJoint=!0;let u=w[R.index];if(u)return u;let M=null;R.index!==N.skeleton&&(R.parent&&-1!==R.parent.index?M=this._loadBone(R.parent,N,q,w):void 0!==N.skeleton&&W.e.Warn(`/skins/${N.index}/skeleton: Skeleton node is not a common root`));const v=N.joints.indexOf(R.index);return u=new y.b(R.name||`joint${R.index}`,q,M,this._getNodeMatrix(R),null,null,v),w[R.index]=u,this._postSceneLoadActions.push((()=>{u.linkTransformNode(R._babylonTransformNode)})),u}_loadSkinInverseBindMatricesDataAsync(R,N){if(void 0==N.inverseBindMatrices)return Promise.resolve(null);const q=X.Get(`${R}/inverseBindMatrices`,this._gltf.accessors,N.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${q.index}`,q)}_updateBoneMatrices(R,N){for(const q of R.bones){const R=u.c.Identity(),w=q._index;N&&-1!==w&&(u.c.FromArrayToRef(N,16*w,R),R.invertToRef(R));const M=q.getParent();M&&R.multiplyToRef(M.getAbsoluteInverseBindMatrix(),R),q.ve(R,!1,!1),q._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(R){return R.matrix?u.c.Sd(R.matrix):u.c.Compose(R.scale?u.m.Sd(R.scale):u.m.One(),R.rotation?u.e.Sd(R.rotation):u.e.Identity(),R.translation?u.m.Sd(R.translation):u.m.Zero())}loadCameraAsync(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const w=this._extensionsLoadCameraAsync(R,N,q);if(w)return w;const M=new Array;this.logOpen(`${R} ${N.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const v=new J.e(N.name||`camera${N.index}`,u.m.Zero(),this._babylonScene,!1);switch(v._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,v.ignoreParentScaling=!0,N._babylonCamera=v,v.rotation.set(0,Math.PI,0),N.type){case"perspective":{const q=N.perspective;if(!q)throw new Error(`${R}: Camera perspective properties are missing`);v.fov=q.yfov,v.dj=q.znear,v.maxZ=q.zfar||0;break}case"orthographic":if(!N.orthographic)throw new Error(`${R}: Camera orthographic properties are missing`);v.mode=G.e.ORTHOGRAPHIC_CAMERA,v.orthoLeft=-N.orthographic.xmag,v.orthoRight=N.orthographic.xmag,v.orthoBottom=-N.orthographic.ymag,v.orthoTop=N.orthographic.ymag,v.dj=N.orthographic.znear,v.maxZ=N.orthographic.zfar;break;default:throw new Error(`${R}: Invalid camera type (${N.type})`)}return h.AddPointerMetadata(v,R),this._parent.onCameraLoadedObservable.notifyObservers(v),q(v),this.logClose(),Promise.all(M).then((()=>v))}_loadAnimationsAsync(){const R=this._gltf.animations;if(!R)return Promise.resolve();const N=new Array;for(let q=0;q<R.length;q++){const w=R[q];N.push(this.loadAnimationAsync(`/animations/${w.index}`,w).then((R=>{0===R.targetedAnimations.length&&R.dispose()})))}return Promise.all(N).then((()=>{}))}loadAnimationAsync(R,N){const w=this._extensionsLoadAnimationAsync(R,N);return w||q.e(43).then(q.bind(q,12639)).then((q=>{let{AnimationGroup:w}=q;this._babylonScene._blockEntityCollection=!!this._assetContainer;const u=new w(N.name||`animation${N.index}`,this._babylonScene);u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,N._babylonAnimationGroup=u;const M=new Array;X.Assign(N.channels),X.Assign(N.samplers);for(const v of N.channels)M.push(this._loadAnimationChannelAsync(`${R}/channels/${v.index}`,R,N,v,((R,N)=>{R.animations=R.animations||[],R.animations.push(N),u.addTargetedAnimation(N,R)})));return Promise.all(M).then((()=>(u.normalize(0),u)))}))}_loadAnimationChannelAsync(R,N,q,w,u){const M=this._extensionsLoadAnimationChannelAsync(R,N,q,w,u);if(M)return M;if(void 0==w.target.node)return Promise.resolve();const v=X.Get(`${R}/target/node`,this._gltf.nodes,w.target.node),G=w.target.path,J="weights"===G;if(J&&!v._numMorphTargets||!J&&!v._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!J&&!v._isJoint)return Promise.resolve();let y;switch(G){case"translation":y=t.translation;break;case"rotation":y=t.rotation;break;case"scale":y=t.scale;break;case"weights":y=t.weights;break;default:throw new Error(`${R}/target/path: Invalid value (${w.target.path})`)}const a={object:v,info:y};return this._loadAnimationChannelFromTargetInfoAsync(R,N,q,w,a,u)}_loadAnimationChannelFromTargetInfoAsync(R,N,q,w,u,M){const v=this.parent.targetFps,G=1/v,J=X.Get(`${R}/sampler`,q.samplers,w.sampler);return this._loadAnimationSamplerAsync(`${N}/samplers/${w.sampler}`,J).then((R=>{let N=0;const J=u.object,y=u.info;for(const u of y){const y=u.getStride(J),a=R.input,j=R.output,F=new Array(a.length);let S=0;switch(R.interpolation){case"STEP":for(let R=0;R<a.length;R++){const N=u.getValue(J,j,S,1);S+=y,F[R]={frame:a[R]*v,value:N,interpolation:1}}break;case"CUBICSPLINE":for(let R=0;R<a.length;R++){const N=u.getValue(J,j,S,G);S+=y;const q=u.getValue(J,j,S,1);S+=y;const w=u.getValue(J,j,S,G);S+=y,F[R]={frame:a[R]*v,inTangent:N,value:q,outTangent:w}}break;case"LINEAR":for(let R=0;R<a.length;R++){const N=u.getValue(J,j,S,1);S+=y,F[R]={frame:a[R]*v,value:N}}}if(S>0){const R=`${q.name||`animation${q.index}`}_channel${w.index}_${N}`;u.buildAnimations(J,R,v,F,((R,q)=>{++N,M(R,q)}))}}}))}_loadAnimationSamplerAsync(R,N){if(N._data)return N._data;const q=N.interpolation||"LINEAR";switch(q){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${R}/interpolation: Invalid value (${N.interpolation})`)}const w=X.Get(`${R}/input`,this._gltf.accessors,N.input),u=X.Get(`${R}/output`,this._gltf.accessors,N.output);return N._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${w.index}`,w),this._loadFloatAccessorAsync(`/accessors/${u.index}`,u)]).then((R=>{let[N,w]=R;return{input:N,interpolation:q,output:w}})),N._data}loadBufferAsync(R,N,q,w){const u=this._extensionsLoadBufferAsync(R,N,q,w);if(u)return u;if(!N._data)if(N.uri)N._data=this.loadUriAsync(`${R}/uri`,N,N.uri);else{if(!this._bin)throw new Error(`${R}: Uri is missing or the binary glTF is missing its binary chunk`);N._data=this._bin.readAsync(0,N.byteLength)}return N._data.then((N=>{try{return new Uint8Array(N.buffer,N.byteOffset+q,w)}catch(u){throw new Error(`${R}: ${u.message}`)}}))}loadBufferViewAsync(R,N){const q=this._extensionsLoadBufferViewAsync(R,N);if(q)return q;if(N._data)return N._data;const w=X.Get(`${R}/buffer`,this._gltf.buffers,N.buffer);return N._data=this.loadBufferAsync(`/buffers/${w.index}`,w,N.byteOffset||0,N.byteLength),N._data}_loadAccessorAsync(R,N,q){if(N._data)return N._data;const w=h._GetNumComponents(R,N.type),u=w*O.e.GetTypeByteLength(N.componentType),M=w*N.count;if(void 0==N.bufferView)N._data=Promise.resolve(new q(M));else{const v=X.Get(`${R}/bufferView`,this._gltf.bufferViews,N.bufferView);N._data=this.loadBufferViewAsync(`/bufferViews/${v.index}`,v).then((G=>{if(5126!==N.componentType||N.normalized||v.byteStride&&v.byteStride!==u){const R=new q(M);return O.e.ForEach(G,N.byteOffset||0,v.byteStride||u,w,N.componentType,R.length,N.normalized||!1,((N,q)=>{R[q]=N})),R}return h._GetTypedArray(R,N.componentType,G,N.byteOffset,M)}))}if(N.sparse){const M=N.sparse;N._data=N._data.then((v=>{const G=v,J=X.Get(`${R}/sparse/indices/bufferView`,this._gltf.bufferViews,M.indices.bufferView),y=X.Get(`${R}/sparse/values/bufferView`,this._gltf.bufferViews,M.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${J.index}`,J),this.loadBufferViewAsync(`/bufferViews/${y.index}`,y)]).then((v=>{let[J,y]=v;const a=h._GetTypedArray(`${R}/sparse/indices`,M.indices.componentType,J,M.indices.byteOffset,M.count),j=w*M.count;let F;if(5126!==N.componentType||N.normalized){const v=h._GetTypedArray(`${R}/sparse/values`,N.componentType,y,M.values.byteOffset,j);F=new q(j),O.e.ForEach(v,0,u,w,N.componentType,F.length,N.normalized||!1,((R,N)=>{F[N]=R}))}else F=h._GetTypedArray(`${R}/sparse/values`,N.componentType,y,M.values.byteOffset,j);let S=0;for(let R=0;R<a.length;R++){let N=a[R]*w;for(let R=0;R<w;R++)G[N++]=F[S++]}return G}))}))}return N._data}_loadFloatAccessorAsync(R,N){return this._loadAccessorAsync(R,N,Float32Array)}_loadIndicesAccessorAsync(R,N){if("SCALAR"!==N.type)throw new Error(`${R}/type: Invalid value ${N.type}`);if(5121!==N.componentType&&5123!==N.componentType&&5125!==N.componentType)throw new Error(`${R}/componentType: Invalid value ${N.componentType}`);if(N._data)return N._data;if(N.sparse){const q=h._GetTypedArrayConstructor(`${R}/componentType`,N.componentType);N._data=this._loadAccessorAsync(R,N,q)}else{const q=X.Get(`${R}/bufferView`,this._gltf.bufferViews,N.bufferView);N._data=this.loadBufferViewAsync(`/bufferViews/${q.index}`,q).then((q=>h._GetTypedArray(R,N.componentType,q,N.byteOffset,N.count)))}return N._data}_loadVertexBufferViewAsync(R){if(R._babylonBuffer)return R._babylonBuffer;const N=this._babylonScene.getEngine();return R._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${R.index}`,R).then((R=>new O.b(N,R,!1))),R._babylonBuffer}_loadVertexAccessorAsync(R,N,q){var w;if(null!==(w=N._babylonVertexBuffer)&&void 0!==w&&w[q])return N._babylonVertexBuffer[q];N._babylonVertexBuffer||(N._babylonVertexBuffer={});const u=this._babylonScene.getEngine();if(N.sparse||void 0==N.bufferView)N._babylonVertexBuffer[q]=this._loadFloatAccessorAsync(R,N).then((R=>new O.e(u,R,q,!1)));else{const w=X.Get(`${R}/bufferView`,this._gltf.bufferViews,N.bufferView);N._babylonVertexBuffer[q]=this._loadVertexBufferViewAsync(w).then((M=>{const v=h._GetNumComponents(R,N.type);return new O.e(u,M,q,!1,void 0,w.byteStride,void 0,N.byteOffset,v,N.componentType,N.normalized,!0,void 0,!0)}))}return N._babylonVertexBuffer[q]}_loadMaterialMetallicRoughnessPropertiesAsync(R,N,q){if(!(q instanceof E))throw new Error(`${R}: Material type not supported`);const w=new Array;return N&&(N.baseColorFactor?(q.albedoColor=M.c.Sd(N.baseColorFactor),q.alpha=N.baseColorFactor[3]):q.albedoColor=M.c.White(),q.metallic=void 0==N.metallicFactor?1:N.metallicFactor,q.roughness=void 0==N.roughnessFactor?1:N.roughnessFactor,N.baseColorTexture&&w.push(this.loadTextureInfoAsync(`${R}/baseColorTexture`,N.baseColorTexture,(R=>{R.name=`${q.name} (Base Color)`,q.albedoTexture=R}))),N.metallicRoughnessTexture&&(N.metallicRoughnessTexture.nonColorData=!0,w.push(this.loadTextureInfoAsync(`${R}/metallicRoughnessTexture`,N.metallicRoughnessTexture,(R=>{R.name=`${q.name} (Metallic Roughness)`,q.metallicTexture=R}))),q.useMetallnessFromMetallicTextureBlue=!0,q.useRoughnessFromMetallicTextureGreen=!0,q.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(w).then((()=>{}))}_loadMaterialAsync(R,N,q,w){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const M=this._extensionsLoadMaterialAsync(R,N,q,w,u);if(M)return M;N._data=N._data||{};let v=N._data[w];if(!v){this.logOpen(`${R} ${N.name||""}`);const q=this.createMaterial(R,N,w);v={babylonMaterial:q,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(R,N,q)},N._data[w]=v,h.AddPointerMetadata(q,R),this._parent.onMaterialLoadedObservable.notifyObservers(q),this.logClose()}return q&&(v.babylonMeshes.push(q),q.Zd.addOnce((()=>{const R=v.babylonMeshes.indexOf(q);-1!==R&&v.babylonMeshes.splice(R,1)}))),u(v.babylonMaterial),v.promise.then((()=>v.babylonMaterial))}_createDefaultMaterial(R,N){this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new E(R,this._babylonScene);return q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q.fillMode=N,q.enableSpecularAntiAliasing=!0,q.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,q.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,q.transparencyMode=E.PBRMATERIAL_OPAQUE,q.metallic=1,q.roughness=1,q}createMaterial(R,N,q){const w=this._extensionsCreateMaterial(R,N,q);if(w)return w;const u=N.name||`material${N.index}`;return this._createDefaultMaterial(u,q)}loadMaterialPropertiesAsync(R,N,q){const w=this._extensionsLoadMaterialPropertiesAsync(R,N,q);if(w)return w;const u=new Array;return u.push(this.loadMaterialBasePropertiesAsync(R,N,q)),N.pbrMetallicRoughness&&u.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${R}/pbrMetallicRoughness`,N.pbrMetallicRoughness,q)),this.loadMaterialAlphaProperties(R,N,q),Promise.all(u).then((()=>{}))}loadMaterialBasePropertiesAsync(R,N,q){if(!(q instanceof E))throw new Error(`${R}: Material type not supported`);const w=new Array;return q.emissiveColor=N.emissiveFactor?M.c.Sd(N.emissiveFactor):new M.c(0,0,0),N.doubleSided&&(q.re=!1,q.twoSidedLighting=!0),N.normalTexture&&(N.normalTexture.nonColorData=!0,w.push(this.loadTextureInfoAsync(`${R}/normalTexture`,N.normalTexture,(R=>{R.name=`${q.name} (Normal)`,q.bumpTexture=R}))),q.invertNormalMapX=!this._babylonScene.useRightHandedSystem,q.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=N.normalTexture.scale&&q.bumpTexture&&(q.bumpTexture.level=N.normalTexture.scale),q.forceIrradianceInFragment=!0),N.occlusionTexture&&(N.occlusionTexture.nonColorData=!0,w.push(this.loadTextureInfoAsync(`${R}/occlusionTexture`,N.occlusionTexture,(R=>{R.name=`${q.name} (Occlusion)`,q.ambientTexture=R}))),q.useAmbientInGrayScale=!0,void 0!=N.occlusionTexture.strength&&(q.ambientTextureStrength=N.occlusionTexture.strength)),N.emissiveTexture&&w.push(this.loadTextureInfoAsync(`${R}/emissiveTexture`,N.emissiveTexture,(R=>{R.name=`${q.name} (Emissive)`,q.emissiveTexture=R}))),Promise.all(w).then((()=>{}))}loadMaterialAlphaProperties(R,N,q){if(!(q instanceof E))throw new Error(`${R}: Material type not supported`);switch(N.alphaMode||"OPAQUE"){case"OPAQUE":q.transparencyMode=E.PBRMATERIAL_OPAQUE,q.alpha=1;break;case"MASK":q.transparencyMode=E.PBRMATERIAL_ALPHATEST,q.alphaCutOff=void 0==N.alphaCutoff?.5:N.alphaCutoff,q.albedoTexture&&(q.albedoTexture.ac=!0);break;case"BLEND":q.transparencyMode=E.PBRMATERIAL_ALPHABLEND,q.albedoTexture&&(q.albedoTexture.ac=!0,q.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${R}/alphaMode: Invalid value (${N.alphaMode})`)}}loadTextureInfoAsync(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const w=this._extensionsLoadTextureInfoAsync(R,N,q);if(w)return w;if(this.logOpen(`${R}`),N.texCoord>=6)throw new Error(`${R}/texCoord: Invalid value (${N.texCoord})`);const u=X.Get(`${R}/index`,this._gltf.textures,N.index);u._textureInfo=N;const M=this._loadTextureAsync(`/textures/${N.index}`,u,(w=>{w.coordinatesIndex=N.texCoord||0,h.AddPointerMetadata(w,R),this._parent.onTextureLoadedObservable.notifyObservers(w),q(w)}));return this.logClose(),M}_loadTextureAsync(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const w=this._extensionsLoadTextureAsync(R,N,q);if(w)return w;this.logOpen(`${R} ${N.name||""}`);const u=void 0==N.sampler?h.DefaultSampler:X.Get(`${R}/sampler`,this._gltf.samplers,N.sampler),M=X.Get(`${R}/source`,this._gltf.images,N.source),v=this._createTextureAsync(R,u,M,q,void 0,!N._textureInfo.nonColorData);return this.logClose(),v}_createTextureAsync(R,N,q){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},M=arguments.length>4?arguments[4]:void 0,v=arguments.length>5?arguments[5]:void 0;const G=this._loadSampler(`/samplers/${N.index}`,N),J=new Array,y=new w;this._babylonScene._blockEntityCollection=!!this._assetContainer;const a={noMipmap:G.noMipMaps,invertY:!1,samplingMode:G.samplingMode,X:()=>{this._disposed||y.resolve()},onError:(N,q)=>{this._disposed||y.reject(new Error(`${R}: ${q&&q.message?q.message:N||"Failed to load texture"}`))},mimeType:q.mimeType,loaderOptions:M,useSRGBBuffer:!!v&&this._parent.useSRGBBuffers},j=new P.e(null,this._babylonScene,a);return j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,J.push(y.promise),J.push(this.loadImageAsync(`/images/${q.index}`,q).then((R=>{const N=q.uri||`${this._fileName}#image${q.index}`,w=`data:${this._uniqueRootUrl}${N}`;j.updateURL(w,R);const u=j.getInternalTexture();u&&(u.label=q.name)}))),j.wrapU=G.wrapU,j.wrapV=G.wrapV,u(j),this._parent.useGltfTextureNames&&(j.name=q.name||q.uri||`image${q.index}`),Promise.all(J).then((()=>j))}_loadSampler(R,N){return N._data||(N._data={noMipMaps:9728===N.minFilter||9729===N.minFilter,samplingMode:h._GetTextureSamplingMode(R,N),wrapU:h._GetTextureWrapMode(`${R}/wrapS`,N.wrapS),wrapV:h._GetTextureWrapMode(`${R}/wrapT`,N.wrapT)}),N._data}loadImageAsync(R,N){if(!N._data){if(this.logOpen(`${R} ${N.name||""}`),N.uri)N._data=this.loadUriAsync(`${R}/uri`,N,N.uri);else{const q=X.Get(`${R}/bufferView`,this._gltf.bufferViews,N.bufferView);N._data=this.loadBufferViewAsync(`/bufferViews/${q.index}`,q)}this.logClose()}return N._data}loadUriAsync(R,N,q){const w=this._extensionsLoadUriAsync(R,N,q);if(w)return w;if(!h._ValidateUri(q))throw new Error(`${R}: '${q}' is invalid`);if((0,f.h)(q)){const N=new Uint8Array((0,f.c)(q));return this.log(`${R}: Decoded ${q.substring(0,64)}... (${N.length} bytes)`),Promise.resolve(N)}return this.log(`${R}: Loading ${q}`),this._parent.preprocessUrlAsync(this._rootUrl+q).then((N=>new Promise(((w,u)=>{this._parent._loadFile(this._babylonScene,N,(N=>{this._disposed||(this.log(`${R}: Loaded ${q} (${N.byteLength} bytes)`),w(new Uint8Array(N)))}),!0,(N=>{u(new f.k(`${R}: Failed to load '${q}'${N?": "+N.status+" "+N.statusText:""}`,N))}))}))))}static AddPointerMetadata(R,N){R.metadata=R.metadata||{};const q=R._internalMetadata=R._internalMetadata||{},w=q.$i=q.$i||{};(w.pointers=w.pointers||[]).push(N)}static _GetTextureWrapMode(R,N){switch(N=void 0==N?10497:N){case 33071:return P.e.CLAMP_ADDRESSMODE;case 33648:return P.e.MIRROR_ADDRESSMODE;case 10497:return P.e.WRAP_ADDRESSMODE;default:return W.e.Warn(`${R}: Invalid value (${N})`),P.e.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(R,N){const q=void 0==N.magFilter?9729:N.magFilter,w=void 0==N.minFilter?9987:N.minFilter;if(9729===q)switch(w){case 9728:return P.e.LINEAR_NEAREST;case 9729:return P.e.LINEAR_LINEAR;case 9984:return P.e.LINEAR_NEAREST_MIPNEAREST;case 9985:return P.e.LINEAR_LINEAR_MIPNEAREST;case 9986:return P.e.LINEAR_NEAREST_MIPLINEAR;case 9987:return P.e.LINEAR_LINEAR_MIPLINEAR;default:return W.e.Warn(`${R}/minFilter: Invalid value (${w})`),P.e.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==q&&W.e.Warn(`${R}/magFilter: Invalid value (${q})`),w){case 9728:return P.e.NEAREST_NEAREST;case 9729:return P.e.NEAREST_LINEAR;case 9984:return P.e.NEAREST_NEAREST_MIPNEAREST;case 9985:return P.e.NEAREST_LINEAR_MIPNEAREST;case 9986:return P.e.NEAREST_NEAREST_MIPLINEAR;case 9987:return P.e.NEAREST_LINEAR_MIPLINEAR;default:return W.e.Warn(`${R}/minFilter: Invalid value (${w})`),P.e.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(R,N){switch(N){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${R}: Invalid component type ${N}`)}}static _GetTypedArray(R,N,q,w,u){const M=q.buffer;w=q.byteOffset+(w||0);const v=h._GetTypedArrayConstructor(`${R}/componentType`,N),G=O.e.GetTypeByteLength(N);return w%G!==0?(W.e.Warn(`${R}: Copying buffer as byte offset (${w}) is not a multiple of component type byte length (${G})`),new v(M.slice(w,w+u*G),0)):new v(M,w,u)}static _GetNumComponents(R,N){switch(N){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${R}: Invalid type (${N})`)}static _ValidateUri(R){return v.i.IsBase64(R)||-1===R.indexOf("..")}static _GetDrawMode(R,N){switch(void 0==N&&(N=4),N){case 0:return e.e.PointListDrawMode;case 1:return e.e.LineListDrawMode;case 2:return e.e.LineLoopDrawMode;case 3:return e.e.LineStripDrawMode;case 4:return e.e.TriangleFillMode;case 5:return e.e.TriangleStripDrawMode;case 6:return e.e.TriangleFanDrawMode}throw new Error(`${R}: Invalid mesh primitive mode (${N})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const R=new Array;if(this._gltf.materials)for(const N of this._gltf.materials)if(N._data)for(const q in N._data){const w=N._data[q];for(const N of w.babylonMeshes){N.je(!0);const q=w.babylonMaterial;R.push(q.forceCompilationAsync(N)),R.push(q.forceCompilationAsync(N,{useInstances:!0})),this._parent.useClipPlane&&(R.push(q.forceCompilationAsync(N,{clipPlane:!0})),R.push(q.forceCompilationAsync(N,{clipPlane:!0,useInstances:!0})))}}return Promise.all(R).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const R=new Array,N=this._babylonScene.lights;for(const q of N){const N=q.getShadowGenerator();N&&R.push(N.forceCompilationAsync())}return Promise.all(R).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(R){for(const N of this._extensions)N.enabled&&R(N)}_applyExtensions(R,N,q){for(const w of this._extensions)if(w.enabled){const u=`${w.name}.${N}`,M=R;M._activeLoaderExtensionFunctions=M._activeLoaderExtensionFunctions||{};const v=M._activeLoaderExtensionFunctions;if(!v[u]){v[u]=!0;try{const R=q(w);if(R)return R}finally{delete v[u]}}}return null}_extensionsOnLoading(){this._forEachExtensions((R=>R.onLoading&&R.onLoading()))}_extensionsOnReady(){this._forEachExtensions((R=>R.onReady&&R.onReady()))}_extensionsLoadSceneAsync(R,N){return this._applyExtensions(N,"loadScene",(q=>q.loadSceneAsync&&q.loadSceneAsync(R,N)))}_extensionsLoadNodeAsync(R,N,q){return this._applyExtensions(N,"loadNode",(w=>w.loadNodeAsync&&w.loadNodeAsync(R,N,q)))}_extensionsLoadCameraAsync(R,N,q){return this._applyExtensions(N,"loadCamera",(w=>w.loadCameraAsync&&w.loadCameraAsync(R,N,q)))}_extensionsLoadVertexDataAsync(R,N,q){return this._applyExtensions(N,"loadVertexData",(w=>w._loadVertexDataAsync&&w._loadVertexDataAsync(R,N,q)))}_extensionsLoadMeshPrimitiveAsync(R,N,q,w,u,M){return this._applyExtensions(u,"loadMeshPrimitive",(v=>v._loadMeshPrimitiveAsync&&v._loadMeshPrimitiveAsync(R,N,q,w,u,M)))}_extensionsLoadMaterialAsync(R,N,q,w,u){return this._applyExtensions(N,"loadMaterial",(M=>M._loadMaterialAsync&&M._loadMaterialAsync(R,N,q,w,u)))}_extensionsCreateMaterial(R,N,q){return this._applyExtensions(N,"createMaterial",(w=>w.createMaterial&&w.createMaterial(R,N,q)))}_extensionsLoadMaterialPropertiesAsync(R,N,q){return this._applyExtensions(N,"loadMaterialProperties",(w=>w.loadMaterialPropertiesAsync&&w.loadMaterialPropertiesAsync(R,N,q)))}_extensionsLoadTextureInfoAsync(R,N,q){return this._applyExtensions(N,"loadTextureInfo",(w=>w.loadTextureInfoAsync&&w.loadTextureInfoAsync(R,N,q)))}_extensionsLoadTextureAsync(R,N,q){return this._applyExtensions(N,"loadTexture",(w=>w._loadTextureAsync&&w._loadTextureAsync(R,N,q)))}_extensionsLoadAnimationAsync(R,N){return this._applyExtensions(N,"loadAnimation",(q=>q.loadAnimationAsync&&q.loadAnimationAsync(R,N)))}_extensionsLoadAnimationChannelAsync(R,N,q,w,u){return this._applyExtensions(q,"loadAnimationChannel",(M=>M._loadAnimationChannelAsync&&M._loadAnimationChannelAsync(R,N,q,w,u)))}_extensionsLoadSkinAsync(R,N,q){return this._applyExtensions(q,"loadSkin",(w=>w._loadSkinAsync&&w._loadSkinAsync(R,N,q)))}_extensionsLoadUriAsync(R,N,q){return this._applyExtensions(N,"loadUri",(w=>w._loadUriAsync&&w._loadUriAsync(R,N,q)))}_extensionsLoadBufferViewAsync(R,N){return this._applyExtensions(N,"loadBufferView",(q=>q.loadBufferViewAsync&&q.loadBufferViewAsync(R,N)))}_extensionsLoadBufferAsync(R,N,q,w){return this._applyExtensions(N,"loadBuffer",(u=>u.loadBufferAsync&&u.loadBufferAsync(R,N,q,w)))}static LoadExtensionAsync(R,N,q,w){if(!N.extensions)return null;const u=N.extensions[q];return u?w(`${R}/extensions/${q}`,u):null}static LoadExtraAsync(R,N,q,w){if(!N.extras)return null;const u=N.extras[q];return u?w(`${R}/extras/${q}`,u):null}isExtensionUsed(R){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(R)}logOpen(R){this._parent._logOpen(R)}logClose(){this._parent._logClose()}log(R){this._parent._log(R)}startPerformanceCounter(R){this._parent._startPerformanceCounter(R)}endPerformanceCounter(R){this._parent._endPerformanceCounter(R)}}h.DefaultSampler={index:-1},T.c._CreateGLTF2Loader=R=>new h(R);var D=q(1450),p=q(10341),RR=q(12045);class NR extends RR.d{constructor(R,N,q){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,M=arguments.length>5&&void 0!==arguments[5]&&arguments[5],v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",R),this._texture=R.getEngine().createRawCubeTexture(N,q,w,u,M,v,G,J)}update(R,N,q,w){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,R,N,q,w,u)}updateRGBDAsync(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,p.h)(this._texture,R,N,q,w).then((()=>{}))}clone(){return x.e.Clone((()=>{const R=this.va(),N=this._texture,q=new NR(R,N._bufferViewArray,N.width,N.format,N.type,N.generateMipMaps,N.invertY,N.samplingMode,N._compression);return 13===N.source&&q.updateRGBDAsync(N._bufferViewArrayArray,N._sphericalPolynomial,N._lodGenerationScale,N._lodGenerationOffset),q}),this)}}const qR="EXT_lights_image_based";class wR{constructor(R){this.name=qR,this._loader=R,this.enabled=this._loader.isExtensionUsed(qR)}dispose(){this._loader=null,delete this._lights}onLoading(){const R=this._loader.$i.extensions;if(R&&R[this.name]){const N=R[this.name];this._lights=N.lights}}loadSceneAsync(R,N){return h.LoadExtensionAsync(R,N,this.name,((q,w)=>{this._loader._allMaterialsDirtyRequired=!0;const u=new Array;u.push(this._loader.loadSceneAsync(R,N)),this._loader.logOpen(`${q}`);const M=X.Get(`${q}/light`,this._lights,w.eb);return u.push(this._loadLightAsync(`/extensions/${this.name}/lights/${w.eb}`,M).then((R=>{this._loader.babylonScene.environmentTexture=R}))),this._loader.logClose(),Promise.all(u).then((()=>{}))}))}_loadLightAsync(R,N){if(!N._loaded){const q=new Array;this._loader.logOpen(`${R}`);const w=new Array(N.specularImages.length);for(let u=0;u<N.specularImages.length;u++){const M=N.specularImages[u];w[u]=new Array(M.length);for(let N=0;N<M.length;N++){const v=`${R}/specularImages/${u}/${N}`;this._loader.logOpen(`${v}`);const G=M[N],J=X.Get(v,this._loader.$i.images,G);q.push(this._loader.loadImageAsync(`/images/${G}`,J).then((R=>{w[u][N]=R}))),this._loader.logClose()}}this._loader.logClose(),N._loaded=Promise.all(q).then((()=>{const q=new NR(this._loader.babylonScene,null,N.specularImageSize);if(q.name=N.name||"environment",N._babylonTexture=q,void 0!=N.hj&&(q.level=N.hj),N.rotation){let R=u.e.Sd(N.rotation);this._loader.babylonScene.useRightHandedSystem||(R=u.e.Inverse(R)),u.c.FromQuaternionToRef(R,q.getReflectionTextureMatrix())}if(!N.irradianceCoefficients)throw new Error(`${R}: Irradiance coefficients are missing`);const M=D.d.Sd(N.irradianceCoefficients);M.scaleInPlace(N.hj),M.convertIrradianceToLambertianRadiance();const v=D.h.FromHarmonics(M),G=(w.length-1)/Math.log2(N.specularImageSize);return q.updateRGBDAsync(w,v,G)}))}return N._loaded.then((()=>N._babylonTexture))}}B(qR),U(qR,!0,(R=>new wR(R)));q(12053);const uR="EXT_mesh_gpu_instancing";class MR{constructor(R){this.name=uR,this._loader=R,this.enabled=this._loader.isExtensionUsed(uR)}dispose(){this._loader=null}loadNodeAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((R,w)=>{this._loader._disableInstancedMesh++;const M=this._loader.loadNodeAsync(`/nodes/${N.index}`,N,q);if(this._loader._disableInstancedMesh--,!N._primitiveBabylonMeshes)return M;const v=new Array;let G=0;const J=N=>{if(void 0==w.attributes[N])return void v.push(Promise.resolve(null));const q=X.Get(`${R}/attributes/${N}`,this._loader.$i.accessors,w.attributes[N]);if(v.push(this._loader._loadFloatAccessorAsync(`/accessors/${q.bufferView}`,q)),0===G)G=q.count;else if(G!==q.count)throw new Error(`${R}/attributes: Instance buffer accessors do not have the same count.`)};return J("TRANSLATION"),J("ROTATION"),J("SCALE"),M.then((R=>Promise.all(v).then((q=>{let[w,M,v]=q;const J=new Float32Array(16*G);u.f.Od[0].Rd(0,0,0),u.f.Quaternion[0].Rd(0,0,0,1),u.f.Od[1].Rd(1,1,1);for(let R=0;R<G;++R)w&&u.m.FromArrayToRef(w,3*R,u.f.Od[0]),M&&u.e.FromArrayToRef(M,4*R,u.f.Quaternion[0]),v&&u.m.FromArrayToRef(v,3*R,u.f.Od[1]),u.c.ComposeToRef(u.f.Od[1],u.f.Quaternion[0],u.f.Od[0],u.f.Matrix[0]),u.f.Matrix[0].copyToArray(J,16*R);for(const R of N._primitiveBabylonMeshes)R.Qj("matrix",J,16,!0);return R}))))}))}}B(uR),U(uR,!0,(R=>new MR(R)));class vR{static get Default(){return vR._Default||(vR._Default=new vR),vR._Default}constructor(){const R=vR.Configuration.decoder;this._decoderModulePromise=v.i.LoadBabylonScriptAsync(R.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(R,N,q,w,u){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const M=await MeshoptDecoder.decodeGltfBufferAsync(N,q,R,w,u);return MeshoptDecoder.useWorkers(0),M}))}}vR.Configuration={decoder:{url:`${v.i._DefaultCdnUrl}/meshopt_decoder.js`}},vR._Default=null;const GR="EXT_meshopt_compression";class JR{constructor(R){this.name=GR,this.enabled=R.isExtensionUsed(GR),this._loader=R}dispose(){this._loader=null}loadBufferViewAsync(R,N){return h.LoadExtensionAsync(R,N,this.name,((q,w)=>{const u=N;if(u._meshOptData)return u._meshOptData;const M=X.Get(`${R}/buffer`,this._loader.$i.buffers,w.buffer);return u._meshOptData=this._loader.loadBufferAsync(`/buffers/${M.index}`,M,w.byteOffset||0,w.byteLength).then((R=>vR.Default.decodeGltfBufferAsync(R,w.count,w.byteStride,w.mode,w.filter))),u._meshOptData}))}}B(GR),U(GR,!0,(R=>new JR(R)));const yR="EXT_texture_webp";class aR{constructor(R){this.name=yR,this._loader=R,this.enabled=R.isExtensionUsed(yR)}dispose(){this._loader=null}_loadTextureAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>{const M=void 0==N.sampler?h.DefaultSampler:X.Get(`${R}/sampler`,this._loader.$i.samplers,N.sampler),v=X.Get(`${w}/source`,this._loader.$i.images,u.source);return this._loader._createTextureAsync(R,M,v,(R=>{q(R)}),void 0,!N._textureInfo.nonColorData)}))}}B(yR),U(yR,!0,(R=>new aR(R)));const jR="EXT_texture_avif";class FR{constructor(R){this.name=jR,this._loader=R,this.enabled=R.isExtensionUsed(jR)}dispose(){this._loader=null}_loadTextureAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>{const M=void 0==N.sampler?h.DefaultSampler:X.Get(`${R}/sampler`,this._loader.$i.samplers,N.sampler),v=X.Get(`${w}/source`,this._loader.$i.images,u.source);return this._loader._createTextureAsync(R,M,v,(R=>{q(R)}),void 0,!N._textureInfo.nonColorData)}))}}B(jR),U(jR,!0,(R=>new FR(R)));var SR=q(12055);const HR="KHR_draco_mesh_compression";class WR{constructor(R){this.name=HR,this.useNormalizedFlagFromAccessor=!0,this._loader=R,this.enabled=SR.c.DecoderAvailable&&this._loader.isExtensionUsed(HR)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>{if(void 0!=N.mode&&4!==N.mode&&5!==N.mode)throw new Error(`${R}: Unsupported mode ${N.mode}`);const M={},v={},G=(R,w)=>{const G=u.attributes[R];if(void 0!=G&&(q._delayInfo=q._delayInfo||[],-1===q._delayInfo.indexOf(w)&&q._delayInfo.push(w),M[w]=G,this.useNormalizedFlagFromAccessor)){const q=X.TryGet(this._loader.$i.accessors,N.attributes[R]);q&&(v[w]=q.normalized||!1)}};G("POSITION",O.e.PositionKind),G("NORMAL",O.e.NormalKind),G("TANGENT",O.e.TangentKind),G("TEXCOORD_0",O.e.UVKind),G("TEXCOORD_1",O.e.UV2Kind),G("TEXCOORD_2",O.e.UV3Kind),G("TEXCOORD_3",O.e.UV4Kind),G("TEXCOORD_4",O.e.UV5Kind),G("TEXCOORD_5",O.e.UV6Kind),G("JOINTS_0",O.e.MatricesIndicesKind),G("WEIGHTS_0",O.e.MatricesWeightsKind),G("COLOR_0",O.e.ColorKind);const J=X.Get(w,this._loader.$i.bufferViews,u.bufferView);return J._dracoBabylonGeometry||(J._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${J.index}`,J).then((N=>(this.dracoCompression||SR.c.Default)._decodeMeshToGeometryForGltfAsync(q.name,this._loader.babylonScene,N,M,v).catch((N=>{throw new Error(`${R}: ${N.message}`)}))))),J._dracoBabylonGeometry}))}}B(HR),U(HR,!0,(R=>new WR(R)));var kR=q(12060),CR=q(11398),eR=q(12035),KR=q(12066);CR.d.AddNodeConstructor("Light_Type_0",((R,N)=>()=>new rR(R,u.m.Zero(),N)));class rR extends KR.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(R){this._shadowAngle=R,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(R){const N=this.needCube();if(this._direction=R,this.needCube()!==N&&this._shadowGenerators){const R=this._shadowGenerators.values();for(let N=R.next();!0!==N.done;N=R.next()){N.value.recreateShadowMap()}}}constructor(R,N,q){super(R,q),this._shadowAngle=Math.PI/2,this.position=N}getClassName(){return"PointLight"}getTypeID(){return eR.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(R){if(this.direction)return super.getShadowDirection(R);switch(R){case 0:return new u.m(1,0,0);case 1:return new u.m(-1,0,0);case 2:return new u.m(0,-1,0);case 3:return new u.m(0,1,0);case 4:return new u.m(0,0,1);case 5:return new u.m(0,0,-1)}return u.m.Zero()}_setDefaultShadowProjectionMatrix(R,N,q){const w=this.va().activeCamera;if(!w)return;const M=void 0!==this.shadowMinZ?this.shadowMinZ:w.dj,v=void 0!==this.shadowMaxZ?this.shadowMaxZ:w.maxZ,G=this.va().getEngine().useReverseDepthBuffer;u.c.PerspectiveFovLHToRef(this.shadowAngle,1,G?v:M,G?M:v,R,!0,this._scene.getEngine().isNDCHalfZRange,void 0,G)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(R,N){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,N):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,N),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,N),this}transferToNodeMaterialEffect(R,N){return this.computeTransformedInformation()?R.setFloat3(N,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):R.setFloat3(N,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(R,N){R["POINTLIGHT"+N]=!0}}(0,K.b)([(0,r.E)()],rR.prototype,"shadowAngle",null),(0,d.h)("BABYLON.PointLight",rR),CR.d.AddNodeConstructor("Light_Type_2",((R,N)=>()=>new ZR(R,u.m.Zero(),u.m.Zero(),0,0,N)));class ZR extends KR.d{get angle(){return this._angle}set angle(R){this._angle=R,this._cosHalfAngle=Math.cos(.5*R),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(R){this._innerAngle=R,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(R){this._shadowAngleScale=R,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(R){this._projectionTextureLightNear=R,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(R){this._projectionTextureLightFar=R,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(R){this._projectionTextureUpDirection=R,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(R){this._projectionTexture!==R&&(this._projectionTexture=R,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(ZR._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):ZR._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(R){return void 0!==R.onGeneratedObservable}static _IsTexture(R){return void 0!==R.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(R){this._projectionTextureProjectionLightMatrix=R,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(R,N,q,w,M,v){super(R,v),this._innerAngle=0,this._projectionTextureMatrix=u.c.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=u.m.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=u.m.Zero(),this._projectionTextureViewLightMatrix=u.c.Zero(),this._projectionTextureProjectionLightMatrix=u.c.Zero(),this._projectionTextureScalingMatrix=u.c.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=N,this.direction=q,this.angle=w,this.exponent=M}getClassName(){return"SpotLight"}getTypeID(){return eR.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(R){super._setDirection(R),this._projectionTextureViewLightDirty=!0}_setPosition(R){super._setPosition(R),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(R,N,q){const w=this.va().activeCamera;if(!w)return;this._shadowAngleScale=this._shadowAngleScale||1;const M=this._shadowAngleScale*this._angle,v=void 0!==this.shadowMinZ?this.shadowMinZ:w.dj,G=void 0!==this.shadowMaxZ?this.shadowMaxZ:w.maxZ,J=this.va().getEngine().useReverseDepthBuffer;u.c.PerspectiveFovLHToRef(M,1,J?G:v,J?v:G,R,!0,this._scene.getEngine().isNDCHalfZRange,void 0,J)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),u.c.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const R=this.projectionTextureLightFar,N=this.projectionTextureLightNear,q=R/(R-N),w=-q*N,M=1/Math.tan(this._angle/2);u.c.FromValuesToRef(M/1,0,0,0,0,M,0,0,0,0,q,1,0,0,w,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof P.e){const R=this._projectionTexture.uScale/2,N=this._projectionTexture.vScale/2;u.c.FromValuesToRef(R,0,0,0,0,N,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(R,N){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),R.setMatrix("textureProjectionMatrix"+N,this._projectionTextureMatrix),R.setTexture("projectionLightTexture"+N,this.projectionTexture)),this}transferToEffect(R,N){let q;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,N),q=u.m.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,N),q=u.m.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",q.x,q.y,q.z,this._cosHalfAngle,N),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,N),this}transferToNodeMaterialEffect(R,N){let q;return q=this.computeTransformedInformation()?u.m.Normalize(this.transformedDirection):u.m.Normalize(this.direction),this.va().useRightHandedSystem?R.setFloat3(N,-q.x,-q.y,-q.z):R.setFloat3(N,q.x,q.y,q.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(R){const N=this._scene.getEngine(),q=void 0!==this.shadowMinZ?this.shadowMinZ:R.dj;return N.useReverseDepthBuffer&&N.isNDCHalfZRange?q:this._scene.getEngine().isNDCHalfZRange?0:q}getDepthMaxZ(R){const N=this._scene.getEngine(),q=void 0!==this.shadowMaxZ?this.shadowMaxZ:R.maxZ;return N.useReverseDepthBuffer&&N.isNDCHalfZRange?0:q}prepareLightSpecificDefines(R,N){R["SPOTLIGHT"+N]=!0,R["PROJECTEDLIGHTTEXTURE"+N]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,K.b)([(0,r.E)()],ZR.prototype,"angle",null),(0,K.b)([(0,r.E)()],ZR.prototype,"innerAngle",null),(0,K.b)([(0,r.E)()],ZR.prototype,"shadowAngleScale",null),(0,K.b)([(0,r.E)()],ZR.prototype,"exponent",void 0),(0,K.b)([(0,r.E)()],ZR.prototype,"projectionTextureLightNear",null),(0,K.b)([(0,r.E)()],ZR.prototype,"projectionTextureLightFar",null),(0,K.b)([(0,r.E)()],ZR.prototype,"projectionTextureUpDirection",null),(0,K.b)([(0,r.y)("projectedLightTexture")],ZR.prototype,"_projectionTexture",void 0),(0,d.h)("BABYLON.SpotLight",ZR);const zR="KHR_lights_punctual";class dR{constructor(R){this.name=zR,this._loader=R,this.enabled=this._loader.isExtensionUsed(zR)}dispose(){this._loader=null,delete this._lights}onLoading(){const R=this._loader.$i.extensions;if(R&&R[this.name]){const N=R[this.name];this._lights=N.lights,X.Assign(this._lights)}}loadNodeAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,v)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(R,N,(R=>{let N;const G=X.Get(w,this._lights,v.eb),J=G.name||R.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,G.type){case"directional":{const R=new kR.b(J,u.m.Backward(),this._loader.babylonScene);R.position.Td(0),N=R;break}case"point":N=new rR(J,u.m.Zero(),this._loader.babylonScene);break;case"spot":{const R=new ZR(J,u.m.Zero(),u.m.Backward(),0,1,this._loader.babylonScene);R.angle=2*(G.spot&&G.spot.outerConeAngle||Math.PI/4),R.innerAngle=2*(G.spot&&G.spot.innerConeAngle||0),N=R;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${w}: Invalid light type (${G.type})`)}N._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,G._babylonLight=N,N.falloffType=eR.c.FALLOFF_GLTF,N.Rh=G.color?M.c.Sd(G.color):M.c.White(),N.hj=void 0==G.hj?1:G.hj,N.range=void 0==G.range?Number.MAX_VALUE:G.range,N.parent=R,this._loader._babylonLights.push(N),h.AddPointerMetadata(N,w),q(R)})))))}}B(zR),U(zR,!0,(R=>new dR(R)));const xR="KHR_materials_pbrSpecularGlossiness";class ER{constructor(R){this.name=xR,this.order=200,this._loader=R,this.enabled=this._loader.isExtensionUsed(xR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>{const M=new Array;return M.push(this._loader.loadMaterialBasePropertiesAsync(R,N,q)),M.push(this._loadSpecularGlossinessPropertiesAsync(w,u,q)),this._loader.loadMaterialAlphaProperties(R,N,q),Promise.all(M).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(R,N,q){if(!(q instanceof E))throw new Error(`${R}: Material type not supported`);const w=new Array;return q.metallic=null,q.roughness=null,N.diffuseFactor?(q.albedoColor=M.c.Sd(N.diffuseFactor),q.alpha=N.diffuseFactor[3]):q.albedoColor=M.c.White(),q.reflectivityColor=N.specularFactor?M.c.Sd(N.specularFactor):M.c.White(),q.microSurface=void 0==N.glossinessFactor?1:N.glossinessFactor,N.diffuseTexture&&w.push(this._loader.loadTextureInfoAsync(`${R}/diffuseTexture`,N.diffuseTexture,(R=>{R.name=`${q.name} (Diffuse)`,q.albedoTexture=R}))),N.specularGlossinessTexture&&(w.push(this._loader.loadTextureInfoAsync(`${R}/specularGlossinessTexture`,N.specularGlossinessTexture,(R=>{R.name=`${q.name} (Specular Glossiness)`,q.reflectivityTexture=R,q.reflectivityTexture.ac=!0}))),q.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(w).then((()=>{}))}}B(xR),U(xR,!0,(R=>new ER(R)));const PR="KHR_materials_unlit";class sR{constructor(R){this.name=PR,this.order=210,this._loader=R,this.enabled=this._loader.isExtensionUsed(PR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,(()=>this._loadUnlitPropertiesAsync(R,N,q)))}_loadUnlitPropertiesAsync(R,N,q){if(!(q instanceof E))throw new Error(`${R}: Material type not supported`);const w=new Array;q.unlit=!0;const u=N.pbrMetallicRoughness;return u&&(u.baseColorFactor?(q.albedoColor=M.c.Sd(u.baseColorFactor),q.alpha=u.baseColorFactor[3]):q.albedoColor=M.c.White(),u.baseColorTexture&&w.push(this._loader.loadTextureInfoAsync(`${R}/baseColorTexture`,u.baseColorTexture,(R=>{R.name=`${q.name} (Base Color)`,q.albedoTexture=R})))),N.doubleSided&&(q.re=!1,q.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(R,N,q),Promise.all(w).then((()=>{}))}}B(PR),U(PR,!0,(R=>new sR(R)));const OR="KHR_materials_clearcoat";class LR{constructor(R){this.name=OR,this.order=190,this._loader=R,this.enabled=this._loader.isExtensionUsed(OR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(R,N,q)),M.push(this._loadClearCoatPropertiesAsync(w,u,q)),Promise.all(M).then((()=>{}))}))}_loadClearCoatPropertiesAsync(R,N,q){if(!(q instanceof E))throw new Error(`${R}: Material type not supported`);const w=new Array;return q.clearCoat.isEnabled=!0,q.clearCoat.useRoughnessFromMainTexture=!1,q.clearCoat.remapF0OnInterfaceChange=!1,void 0!=N.clearcoatFactor?q.clearCoat.hj=N.clearcoatFactor:q.clearCoat.hj=0,N.clearcoatTexture&&w.push(this._loader.loadTextureInfoAsync(`${R}/clearcoatTexture`,N.clearcoatTexture,(R=>{R.name=`${q.name} (ClearCoat)`,q.clearCoat.texture=R}))),void 0!=N.clearcoatRoughnessFactor?q.clearCoat.roughness=N.clearcoatRoughnessFactor:q.clearCoat.roughness=0,N.clearcoatRoughnessTexture&&(N.clearcoatRoughnessTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${R}/clearcoatRoughnessTexture`,N.clearcoatRoughnessTexture,(R=>{R.name=`${q.name} (ClearCoat Roughness)`,q.clearCoat.textureRoughness=R})))),N.clearcoatNormalTexture&&(N.clearcoatNormalTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${R}/clearcoatNormalTexture`,N.clearcoatNormalTexture,(R=>{R.name=`${q.name} (ClearCoat Normal)`,q.clearCoat.bumpTexture=R}))),q.invertNormalMapX=!q.va().useRightHandedSystem,q.invertNormalMapY=q.va().useRightHandedSystem,void 0!=N.clearcoatNormalTexture.scale&&(q.clearCoat.bumpTexture.level=N.clearcoatNormalTexture.scale)),Promise.all(w).then((()=>{}))}}B(OR),U(OR,!0,(R=>new LR(R)));const mR="KHR_materials_iridescence";class oR{constructor(R){this.name=mR,this.order=195,this._loader=R,this.enabled=this._loader.isExtensionUsed(mR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(R,N,q)),M.push(this._loadIridescencePropertiesAsync(w,u,q)),Promise.all(M).then((()=>{}))}))}_loadIridescencePropertiesAsync(R,N,q){if(!(q instanceof E))throw new Error(`${R}: Material type not supported`);const w=new Array;return q.iridescence.isEnabled=!0,q.iridescence.hj=N.iridescenceFactor??0,q.iridescence.indexOfRefraction=N.iridescenceIor??N.iridescenceIOR??1.3,q.iridescence.minimumThickness=N.iridescenceThicknessMinimum??100,q.iridescence.maximumThickness=N.iridescenceThicknessMaximum??400,N.iridescenceTexture&&w.push(this._loader.loadTextureInfoAsync(`${R}/iridescenceTexture`,N.iridescenceTexture,(R=>{R.name=`${q.name} (Iridescence)`,q.iridescence.texture=R}))),N.iridescenceThicknessTexture&&w.push(this._loader.loadTextureInfoAsync(`${R}/iridescenceThicknessTexture`,N.iridescenceThicknessTexture,(R=>{R.name=`${q.name} (Iridescence Thickness)`,q.iridescence.thicknessTexture=R}))),Promise.all(w).then((()=>{}))}}B(mR),U(mR,!0,(R=>new oR(R)));const AR="KHR_materials_anisotropy";class nR{constructor(R){this.name=AR,this.order=195,this._loader=R,this.enabled=this._loader.isExtensionUsed(AR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(R,N,q)),M.push(this._loadIridescencePropertiesAsync(w,u,q)),Promise.all(M).then((()=>{}))}))}_loadIridescencePropertiesAsync(R,N,q){if(!(q instanceof E))throw new Error(`${R}: Material type not supported`);const w=new Array;return q.anisotropy.isEnabled=!0,q.anisotropy.hj=N.anisotropyStrength??0,q.anisotropy.angle=N.anisotropyRotation??0,N.anisotropyTexture&&(N.anisotropyTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${R}/anisotropyTexture`,N.anisotropyTexture,(R=>{R.name=`${q.name} (Anisotropy Intensity)`,q.anisotropy.texture=R})))),Promise.all(w).then((()=>{}))}}B(AR),U(AR,!0,(R=>new nR(R)));const QR="KHR_materials_emissive_strength";class YR{constructor(R){this.name=QR,this.order=170,this._loader=R,this.enabled=this._loader.isExtensionUsed(QR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>this._loader.loadMaterialPropertiesAsync(R,N,q).then((()=>{this._loadEmissiveProperties(w,u,q)}))))}_loadEmissiveProperties(R,N,q){if(!(q instanceof E))throw new Error(`${R}: Material type not supported`);void 0!==N.emissiveStrength&&(q.emissiveIntensity=N.emissiveStrength)}}B(QR),U(QR,!0,(R=>new YR(R)));const TR="KHR_materials_sheen";class fR{constructor(R){this.name=TR,this.order=190,this._loader=R,this.enabled=this._loader.isExtensionUsed(TR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(R,N,q)),M.push(this._loadSheenPropertiesAsync(w,u,q)),Promise.all(M).then((()=>{}))}))}_loadSheenPropertiesAsync(R,N,q){if(!(q instanceof E))throw new Error(`${R}: Material type not supported`);const w=new Array;return q.sheen.isEnabled=!0,q.sheen.hj=1,void 0!=N.sheenColorFactor?q.sheen.color=M.c.Sd(N.sheenColorFactor):q.sheen.color=M.c.Black(),N.sheenColorTexture&&w.push(this._loader.loadTextureInfoAsync(`${R}/sheenColorTexture`,N.sheenColorTexture,(R=>{R.name=`${q.name} (Sheen Color)`,q.sheen.texture=R}))),void 0!==N.sheenRoughnessFactor?q.sheen.roughness=N.sheenRoughnessFactor:q.sheen.roughness=0,N.sheenRoughnessTexture&&(N.sheenRoughnessTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${R}/sheenRoughnessTexture`,N.sheenRoughnessTexture,(R=>{R.name=`${q.name} (Sheen Roughness)`,q.sheen.textureRoughness=R})))),q.sheen.albedoScaling=!0,q.sheen.useRoughnessFromMainTexture=!1,Promise.all(w).then((()=>{}))}}B(TR),U(TR,!0,(R=>new fR(R)));const cR="KHR_materials_specular";class bR{constructor(R){this.name=cR,this.order=190,this._loader=R,this.enabled=this._loader.isExtensionUsed(cR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(R,N,q)),M.push(this._loadSpecularPropertiesAsync(w,u,q)),Promise.all(M).then((()=>{}))}))}_loadSpecularPropertiesAsync(R,N,q){if(!(q instanceof E))throw new Error(`${R}: Material type not supported`);const w=new Array;return void 0!==N.specularFactor&&(q.metallicF0Factor=N.specularFactor),void 0!==N.specularColorFactor&&(q.metallicReflectanceColor=M.c.Sd(N.specularColorFactor)),N.specularTexture&&(N.specularTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${R}/specularTexture`,N.specularTexture,(R=>{R.name=`${q.name} (Specular)`,q.metallicReflectanceTexture=R,q.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),N.specularColorTexture&&w.push(this._loader.loadTextureInfoAsync(`${R}/specularColorTexture`,N.specularColorTexture,(R=>{R.name=`${q.name} (Specular Color)`,q.reflectanceTexture=R}))),Promise.all(w).then((()=>{}))}}B(cR),U(cR,!0,(R=>new bR(R)));const IR="KHR_materials_ior";class VR{constructor(R){this.name=IR,this.order=180,this._loader=R,this.enabled=this._loader.isExtensionUsed(IR)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(R,N,q)),M.push(this._loadIorPropertiesAsync(w,u,q)),Promise.all(M).then((()=>{}))}))}_loadIorPropertiesAsync(R,N,q){if(!(q instanceof E))throw new Error(`${R}: Material type not supported`);return void 0!==N.ior?q.indexOfRefraction=N.ior:q.indexOfRefraction=VR._DEFAULT_IOR,Promise.resolve()}}VR._DEFAULT_IOR=1.5,B(IR),U(IR,!0,(R=>new VR(R)));const tR="KHR_materials_variants";class iR{constructor(R){this.name=tR,this._loader=R,this.enabled=this._loader.isExtensionUsed(tR)}dispose(){this._loader=null}static GetAvailableVariants(R){const N=this._GetExtensionMetadata(R);return N?Object.keys(N.variants):[]}getAvailableVariants(R){return iR.GetAvailableVariants(R)}static SelectVariant(R,N){const q=this._GetExtensionMetadata(R);if(!q)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${tR} extension`);const w=R=>{const N=q.variants[R];if(N)for(const q of N)q.mesh.material=q.material};if(N instanceof Array)for(const u of N)w(u);else w(N);q.lastSelected=N}selectVariant(R,N){iR.SelectVariant(R,N)}static Reset(R){const N=this._GetExtensionMetadata(R);if(!N)throw new Error(`Cannot reset on a glTF mesh that does not have the ${tR} extension`);for(const q of N.original)q.mesh.material=q.material;N.lastSelected=null}reset(R){iR.Reset(R)}static GetLastSelectedVariant(R){const N=this._GetExtensionMetadata(R);if(!N)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${tR} extension`);return N.lastSelected}getLastSelectedVariant(R){return iR.GetLastSelectedVariant(R)}static _GetExtensionMetadata(R){var N,q;return(null===R||void 0===R||null===(N=R._internalMetadata)||void 0===N||null===(q=N.$i)||void 0===q?void 0:q[tR])||null}onLoading(){const R=this._loader.$i.extensions;if(R&&R[this.name]){const N=R[this.name];this._variants=N.variants}}_loadMeshPrimitiveAsync(R,N,q,w,u,M){return h.LoadExtensionAsync(R,u,this.name,((v,G)=>{const J=new Array;return J.push(this._loader._loadMeshPrimitiveAsync(R,N,q,w,u,(N=>{if(M(N),N instanceof o.b){const q=h._GetDrawMode(R,u.mode),w=this._loader.rootBabylonMesh,M=w?w._internalMetadata=w._internalMetadata||{}:{},y=M.$i=M.$i||{},a=y[tR]=y[tR]||{lastSelected:null,original:[],variants:{}};a.original.push({mesh:N,material:N.material});for(let R=0;R<G.mappings.length;++R){const u=G.mappings[R],M=X.Get(`${v}/mappings/${R}/material`,this._loader.$i.materials,u.material);J.push(this._loader._loadMaterialAsync(`#/materials/${u.material}`,M,N,q,(R=>{for(let q=0;q<u.variants.length;++q){const M=u.variants[q],v=X.Get(`/extensions/${tR}/variants/${M}`,this._variants,M);a.variants[v.name]=a.variants[v.name]||[],a.variants[v.name].push({mesh:N,material:R}),N.onClonedObservable.add((R=>{const q=R;let u=null,M=q;do{if(M=M.parent,!M)return;u=iR._GetExtensionMetadata(M)}while(null===u);if(w&&u===iR._GetExtensionMetadata(w)){M._internalMetadata={};for(const R in w._internalMetadata)M._internalMetadata[R]=w._internalMetadata[R];M._internalMetadata.$i=[];for(const R in w._internalMetadata.$i)M._internalMetadata.$i[R]=w._internalMetadata.$i[R];M._internalMetadata.$i[tR]={lastSelected:null,original:[],variants:{}};for(const R of u.original)M._internalMetadata.$i[tR].original.push({mesh:R.mesh,material:R.material});for(const R in u.variants)if(Object.prototype.hasOwnProperty.call(u.variants,R)){M._internalMetadata.$i[tR].variants[R]=[];for(const N of u.variants[R])M._internalMetadata.$i[tR].variants[R].push({mesh:N.mesh,material:N.material})}u=M._internalMetadata.$i[tR]}for(const w of u.original)w.mesh===N&&(w.mesh=q);for(const w of u.variants[v.name])w.mesh===N&&(w.mesh=q)}))}})))}}}))),Promise.all(J).then((R=>{let[N]=R;return N}))}))}}B(tR),U(tR,!0,(R=>new iR(R)));var gR=q(1504);class UR{}UR.AUTOSAMPLERSUFFIX="Sampler",UR.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",UR.ALPHA_DISABLE=0,UR.ALPHA_ADD=1,UR.ALPHA_COMBINE=2,UR.ALPHA_SUBTRACT=3,UR.ALPHA_MULTIPLY=4,UR.ALPHA_MAXIMIZED=5,UR.ALPHA_ONEONE=6,UR.ALPHA_PREMULTIPLIED=7,UR.ALPHA_PREMULTIPLIED_PORTERDUFF=8,UR.ALPHA_INTERPOLATE=9,UR.ALPHA_SCREENMODE=10,UR.ALPHA_ONEONE_ONEONE=11,UR.ALPHA_ALPHATOCOLOR=12,UR.ALPHA_REVERSEONEMINUS=13,UR.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,UR.ALPHA_ONEONE_ONEZERO=15,UR.ALPHA_EXCLUSION=16,UR.ALPHA_LAYER_ACCUMULATE=17,UR.ALPHA_EQUATION_ADD=0,UR.ALPHA_EQUATION_SUBSTRACT=1,UR.ALPHA_EQUATION_REVERSE_SUBTRACT=2,UR.ALPHA_EQUATION_MAX=3,UR.ALPHA_EQUATION_MIN=4,UR.ALPHA_EQUATION_DARKEN=5,UR.DELAYLOADSTATE_NONE=0,UR.DELAYLOADSTATE_LOADED=1,UR.DELAYLOADSTATE_LOADING=2,UR.DELAYLOADSTATE_NOTLOADED=4,UR.NEVER=512,UR.ALWAYS=519,UR.LESS=513,UR.EQUAL=514,UR.LEQUAL=515,UR.GREATER=516,UR.GEQUAL=518,UR.NOTEQUAL=517,UR.KEEP=7680,UR.ZERO=0,UR.REPLACE=7681,UR.INCR=7682,UR.DECR=7683,UR.INVERT=5386,UR.INCR_WRAP=34055,UR.DECR_WRAP=34056,UR.TEXTURE_CLAMP_ADDRESSMODE=0,UR.TEXTURE_WRAP_ADDRESSMODE=1,UR.TEXTURE_MIRROR_ADDRESSMODE=2,UR.TEXTURE_CREATIONFLAG_STORAGE=1,UR.TEXTUREFORMAT_ALPHA=0,UR.TEXTUREFORMAT_LUMINANCE=1,UR.TEXTUREFORMAT_LUMINANCE_ALPHA=2,UR.TEXTUREFORMAT_RGB=4,UR.TEXTUREFORMAT_RGBA=5,UR.TEXTUREFORMAT_RED=6,UR.TEXTUREFORMAT_R=6,UR.TEXTUREFORMAT_RG=7,UR.TEXTUREFORMAT_RED_INTEGER=8,UR.TEXTUREFORMAT_R_INTEGER=8,UR.TEXTUREFORMAT_RG_INTEGER=9,UR.TEXTUREFORMAT_RGB_INTEGER=10,UR.TEXTUREFORMAT_RGBA_INTEGER=11,UR.TEXTUREFORMAT_BGRA=12,UR.TEXTUREFORMAT_DEPTH24_STENCIL8=13,UR.TEXTUREFORMAT_DEPTH32_FLOAT=14,UR.TEXTUREFORMAT_DEPTH16=15,UR.TEXTUREFORMAT_DEPTH24=16,UR.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,UR.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,UR.TEXTUREFORMAT_STENCIL8=19,UR.TEXTUREFORMAT_UNDEFINED=4294967295,UR.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,UR.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,UR.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,UR.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,UR.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,UR.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,UR.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,UR.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,UR.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,UR.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,UR.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,UR.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,UR.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,UR.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,UR.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,UR.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,UR.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,UR.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,UR.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,UR.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,UR.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,UR.TEXTURETYPE_UNSIGNED_BYTE=0,UR.TEXTURETYPE_UNSIGNED_INT=0,UR.TEXTURETYPE_FLOAT=1,UR.TEXTURETYPE_HALF_FLOAT=2,UR.TEXTURETYPE_BYTE=3,UR.TEXTURETYPE_SHORT=4,UR.TEXTURETYPE_UNSIGNED_SHORT=5,UR.TEXTURETYPE_INT=6,UR.TEXTURETYPE_UNSIGNED_INTEGER=7,UR.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,UR.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,UR.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,UR.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,UR.TEXTURETYPE_UNSIGNED_INT_24_8=12,UR.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,UR.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,UR.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,UR.TEXTURETYPE_UNDEFINED=16,UR.TEXTURE_2D=3553,UR.TEXTURE_2D_ARRAY=35866,UR.TEXTURE_CUBE_MAP=34067,UR.TEXTURE_CUBE_MAP_ARRAY=3735928559,UR.TEXTURE_3D=32879,UR.TEXTURE_NEAREST_SAMPLINGMODE=1,UR.TEXTURE_NEAREST_NEAREST=1,UR.TEXTURE_BILINEAR_SAMPLINGMODE=2,UR.TEXTURE_LINEAR_LINEAR=2,UR.TEXTURE_TRILINEAR_SAMPLINGMODE=3,UR.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,UR.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,UR.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,UR.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,UR.TEXTURE_NEAREST_LINEAR=7,UR.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,UR.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,UR.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,UR.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,UR.TEXTURE_LINEAR_NEAREST=12,UR.TEXTURE_EXPLICIT_MODE=0,UR.TEXTURE_SPHERICAL_MODE=1,UR.TEXTURE_PLANAR_MODE=2,UR.TEXTURE_CUBIC_MODE=3,UR.TEXTURE_PROJECTION_MODE=4,UR.TEXTURE_SKYBOX_MODE=5,UR.TEXTURE_INVCUBIC_MODE=6,UR.TEXTURE_EQUIRECTANGULAR_MODE=7,UR.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,UR.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,UR.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,UR.TEXTURE_FILTERING_QUALITY_HIGH=64,UR.TEXTURE_FILTERING_QUALITY_MEDIUM=16,UR.TEXTURE_FILTERING_QUALITY_LOW=8,UR.SCALEMODE_FLOOR=1,UR.SCALEMODE_NEAREST=2,UR.SCALEMODE_CEILING=3,UR.MATERIAL_TextureDirtyFlag=1,UR.MATERIAL_LightDirtyFlag=2,UR.MATERIAL_FresnelDirtyFlag=4,UR.MATERIAL_AttributesDirtyFlag=8,UR.MATERIAL_MiscDirtyFlag=16,UR.MATERIAL_PrePassDirtyFlag=32,UR.MATERIAL_AllDirtyFlag=63,UR.MATERIAL_TriangleFillMode=0,UR.MATERIAL_WireFrameFillMode=1,UR.MATERIAL_PointFillMode=2,UR.MATERIAL_PointListDrawMode=3,UR.MATERIAL_LineListDrawMode=4,UR.MATERIAL_LineLoopDrawMode=5,UR.MATERIAL_LineStripDrawMode=6,UR.MATERIAL_TriangleStripDrawMode=7,UR.MATERIAL_TriangleFanDrawMode=8,UR.MATERIAL_ClockWiseSideOrientation=0,UR.MATERIAL_CounterClockWiseSideOrientation=1,UR.ACTION_NothingTrigger=0,UR.ACTION_OnPickTrigger=1,UR.ACTION_OnLeftPickTrigger=2,UR.ACTION_OnRightPickTrigger=3,UR.ACTION_OnCenterPickTrigger=4,UR.ACTION_OnPickDownTrigger=5,UR.ACTION_OnDoublePickTrigger=6,UR.ACTION_OnPickUpTrigger=7,UR.ACTION_OnPickOutTrigger=16,UR.ACTION_OnLongPressTrigger=8,UR.ACTION_OnPointerOverTrigger=9,UR.ACTION_OnPointerOutTrigger=10,UR.ACTION_OnEveryFrameTrigger=11,UR.ACTION_OnIntersectionEnterTrigger=12,UR.ACTION_OnIntersectionExitTrigger=13,UR.ACTION_OnKeyDownTrigger=14,UR.ACTION_OnKeyUpTrigger=15,UR.PARTICLES_BILLBOARDMODE_Y=2,UR.PARTICLES_BILLBOARDMODE_ALL=7,UR.PARTICLES_BILLBOARDMODE_STRETCHED=8,UR.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,UR.MESHES_CULLINGSTRATEGY_STANDARD=0,UR.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,UR.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,UR.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,UR.SCENELOADER_NO_LOGGING=0,UR.SCENELOADER_MINIMAL_LOGGING=1,UR.SCENELOADER_SUMMARY_LOGGING=2,UR.SCENELOADER_DETAILED_LOGGING=3,UR.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,UR.PREPASS_POSITION_TEXTURE_TYPE=1,UR.PREPASS_VELOCITY_TEXTURE_TYPE=2,UR.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,UR.PREPASS_COLOR_TEXTURE_TYPE=4,UR.PREPASS_DEPTH_TEXTURE_TYPE=5,UR.PREPASS_NORMAL_TEXTURE_TYPE=6,UR.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,UR.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,UR.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,UR.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,UR.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,UR.PREPASS_ALBEDO_TEXTURE_TYPE=12,UR.BUFFER_CREATIONFLAG_READ=1,UR.BUFFER_CREATIONFLAG_WRITE=2,UR.BUFFER_CREATIONFLAG_READWRITE=3,UR.BUFFER_CREATIONFLAG_UNIFORM=4,UR.BUFFER_CREATIONFLAG_VERTEX=8,UR.BUFFER_CREATIONFLAG_INDEX=16,UR.BUFFER_CREATIONFLAG_STORAGE=32,UR.BUFFER_CREATIONFLAG_INDIRECT=64,UR.RENDERPASS_MAIN=0,UR.INPUT_ALT_KEY=18,UR.INPUT_CTRL_KEY=17,UR.INPUT_META_KEY1=91,UR.INPUT_META_KEY2=92,UR.INPUT_META_KEY3=93,UR.INPUT_SHIFT_KEY=16,UR.SNAPSHOTRENDERING_STANDARD=0,UR.SNAPSHOTRENDERING_FAST=1,UR.PERSPECTIVE_CAMERA=0,UR.ORTHOGRAPHIC_CAMERA=1,UR.FOVMODE_VERTICAL_FIXED=0,UR.FOVMODE_HORIZONTAL_FIXED=1,UR.RIG_MODE_NONE=0,UR.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,UR.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,UR.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,UR.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,UR.RIG_MODE_STEREOSCOPIC_INTERLACED=14,UR.RIG_MODE_VR=20,UR.RIG_MODE_CUSTOM=22,UR.MAX_SUPPORTED_UV_SETS=6,UR.GL_ALPHA_EQUATION_ADD=32774,UR.GL_ALPHA_EQUATION_MIN=32775,UR.GL_ALPHA_EQUATION_MAX=32776,UR.GL_ALPHA_EQUATION_SUBTRACT=32778,UR.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,UR.GL_ALPHA_FUNCTION_SRC=768,UR.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,UR.GL_ALPHA_FUNCTION_SRC_ALPHA=770,UR.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,UR.GL_ALPHA_FUNCTION_DST_ALPHA=772,UR.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,UR.GL_ALPHA_FUNCTION_DST_COLOR=774,UR.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,UR.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,UR.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,UR.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,UR.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,UR.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,UR.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,UR.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,UR.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,UR.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,UR.SnippetUrl="https://snippet.babylonjs.com",UR.FOGMODE_NONE=0,UR.FOGMODE_EXP=1,UR.FOGMODE_EXP2=2,UR.FOGMODE_LINEAR=3,UR.BYTE=5120,UR.UNSIGNED_BYTE=5121,UR.SHORT=5122,UR.UNSIGNED_SHORT=5123,UR.INT=5124,UR.UNSIGNED_INT=5125,UR.FLOAT=5126,UR.PositionKind="position",UR.NormalKind="ke",UR.TangentKind="tangent",UR.UVKind="uv",UR.UV2Kind="uv2",UR.UV3Kind="uv3",UR.UV4Kind="uv4",UR.UV5Kind="uv5",UR.UV6Kind="uv6",UR.ColorKind="color",UR.ColorInstanceKind="instanceColor",UR.MatricesIndicesKind="matricesIndices",UR.MatricesWeightsKind="matricesWeights",UR.MatricesIndicesExtraKind="matricesIndicesExtra",UR.MatricesWeightsExtraKind="matricesWeightsExtra";class BR{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:UR.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(R,N){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...BR._GetDefaultOptions(),...R},this._scene=N,this._scene._transmissionHelper=this,this.onErrorObservable=new a.c,this._scene.Zd.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(R){if(!Object.keys(R).filter((N=>this._options[N]!==R[N])).length)return;const N={...this._options,...R},q=this._options;this._options=N,N.renderSize===q.renderSize&&N.renderTargetTextureType===q.renderTargetTextureType&&N.generateMipmaps===q.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=N.samples,this._opaqueRenderTarget.lodGenerationScale=N.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=N.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(R){return!!R&&!!(R instanceof E&&R.subSurface.isRefractionEnabled)}_addMesh(R){this._materialObservers[R.uniqueId]=R.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),v.i.SetImmediate((()=>{this._shouldRenderAsTransmission(R.material)?(R.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(R)&&this._transparentMeshesCache.push(R)):-1===this._opaqueMeshesCache.indexOf(R)&&this._opaqueMeshesCache.push(R)}))}_removeMesh(R){R.onMaterialChangedObservable.remove(this._materialObservers[R.uniqueId]),delete this._materialObservers[R.uniqueId];let N=this._transparentMeshesCache.indexOf(R);-1!==N&&this._transparentMeshesCache.splice(N,1),N=this._opaqueMeshesCache.indexOf(R),-1!==N&&this._opaqueMeshesCache.splice(N,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(R){const N=this._transparentMeshesCache.indexOf(R),q=this._opaqueMeshesCache.indexOf(R);this._shouldRenderAsTransmission(R.material)?(R.material instanceof E&&(R.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==q?(this._opaqueMeshesCache.splice(q,1),this._transparentMeshesCache.push(R)):-1===N&&this._transparentMeshesCache.push(R)):-1!==N?(this._transparentMeshesCache.splice(N,1),this._opaqueMeshesCache.push(R)):-1===q&&this._opaqueMeshesCache.push(R)}_isRenderTargetValid(){var R;return null!==(null===(R=this._opaqueRenderTarget)||void 0===R?void 0:R.getInternalTexture())}_setupRenderTargets(){var R;let N,q;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new gR.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(R=this._options.clearColor)||void 0===R?void 0:R.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((R=>{q=this._scene.environmentIntensity,this._scene.environmentIntensity=1,N=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?R.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(R.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=q,this._scene.imageProcessingConfiguration._applyByPostProcess=N})),this._transparentMeshesCache.forEach((R=>{this._shouldRenderAsTransmission(R.material)&&(R.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const lR="KHR_materials_transmission";class XR{constructor(R){this.name=lR,this.order=175,this._loader=R,this.enabled=this._loader.isExtensionUsed(lR),this.enabled&&(R.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(R,N,q)),M.push(this._loadTransparentPropertiesAsync(w,N,q,u)),Promise.all(M).then((()=>{}))}))}_loadTransparentPropertiesAsync(R,N,q,w){if(!(q instanceof E))throw new Error(`${R}: Material type not supported`);const u=q;if(u.subSurface.isRefractionEnabled=!0,u.subSurface.volumeIndexOfRefraction=1,u.subSurface.useAlbedoToTintRefraction=!0,void 0===w.transmissionFactor)return u.subSurface.refractionIntensity=0,u.subSurface.isRefractionEnabled=!1,Promise.resolve();{var M;u.subSurface.refractionIntensity=w.transmissionFactor;const R=u.va();if(u.subSurface.refractionIntensity&&!R._transmissionHelper)new BR({},u.va());else if(u.subSurface.refractionIntensity&&(null===(M=R._transmissionHelper)||void 0===M||!M._isRenderTargetValid())){var v;null===(v=R._transmissionHelper)||void 0===v||v._setupRenderTargets()}}return u.subSurface.minimumThickness=0,u.subSurface.maximumThickness=0,w.transmissionTexture?(w.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${R}/transmissionTexture`,w.transmissionTexture,void 0).then((R=>{R.name=`${q.name} (Transmission)`,u.subSurface.refractionIntensityTexture=R,u.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}B(lR),U(lR,!0,(R=>new XR(R)));const hR="KHR_materials_diffuse_transmission";class DR{constructor(R){this.name=hR,this.order=174,this._loader=R,this.enabled=this._loader.isExtensionUsed(hR),this.enabled&&(R.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(R,N,q)),M.push(this._loadTranslucentPropertiesAsync(w,N,q,u)),Promise.all(M).then((()=>{}))}))}_loadTranslucentPropertiesAsync(R,N,q,w){if(!(q instanceof E))throw new Error(`${R}: Material type not supported`);const u=q;if(u.subSurface.isTranslucencyEnabled=!0,u.subSurface.volumeIndexOfRefraction=1,u.subSurface.minimumThickness=0,u.subSurface.maximumThickness=0,u.subSurface.useAlbedoToTintTranslucency=!1,void 0===w.diffuseTransmissionFactor)return u.subSurface.translucencyIntensity=0,u.subSurface.isTranslucencyEnabled=!1,Promise.resolve();u.subSurface.translucencyIntensity=w.diffuseTransmissionFactor;const v=new Array;return u.subSurface.useGltfStyleTextures=!0,w.diffuseTransmissionTexture&&(w.diffuseTransmissionTexture.nonColorData=!0,v.push(this._loader.loadTextureInfoAsync(`${R}/diffuseTransmissionTexture`,w.diffuseTransmissionTexture).then((R=>{R.name=`${q.name} (Diffuse Transmission)`,u.subSurface.translucencyIntensityTexture=R})))),void 0!==w.diffuseTransmissionColorFactor?u.subSurface.translucencyColor=M.c.Sd(w.diffuseTransmissionColorFactor):u.subSurface.translucencyColor=M.c.White(),w.diffuseTransmissionColorTexture&&v.push(this._loader.loadTextureInfoAsync(`${R}/diffuseTransmissionColorTexture`,w.diffuseTransmissionColorTexture).then((R=>{R.name=`${q.name} (Diffuse Transmission Color)`,u.subSurface.translucencyColorTexture=R}))),Promise.all(v).then((()=>{}))}}B(hR),U(hR,!0,(R=>new DR(R)));const pR="KHR_materials_volume";class RN{constructor(R){this.name=pR,this.order=173,this._loader=R,this.enabled=this._loader.isExtensionUsed(pR),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(R,N,q)),M.push(this._loadVolumePropertiesAsync(w,N,q,u)),Promise.all(M).then((()=>{}))}))}_loadVolumePropertiesAsync(R,N,q,w){if(!(q instanceof E))throw new Error(`${R}: Material type not supported`);if(!q.subSurface.isRefractionEnabled&&!q.subSurface.isTranslucencyEnabled||!w.thicknessFactor)return Promise.resolve();q.subSurface.volumeIndexOfRefraction=q.indexOfRefraction;const u=void 0!==w.attenuationDistance?w.attenuationDistance:Number.MAX_VALUE;return q.subSurface.tintColorAtDistance=u,void 0!==w.attenuationColor&&3==w.attenuationColor.length&&q.subSurface.tintColor.Rd(w.attenuationColor[0],w.attenuationColor[1],w.attenuationColor[2]),q.subSurface.minimumThickness=0,q.subSurface.maximumThickness=w.thicknessFactor,q.subSurface.useThicknessAsDepth=!0,w.thicknessTexture?(w.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${R}/thicknessTexture`,w.thicknessTexture).then((R=>{R.name=`${q.name} (Thickness)`,q.subSurface.thicknessTexture=R,q.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}B(pR),U(pR,!0,(R=>new RN(R)));const NN="KHR_materials_dispersion";class qN{constructor(R){this.name=NN,this.order=174,this._loader=R,this.enabled=this._loader.isExtensionUsed(NN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>{const M=new Array;return M.push(this._loader.loadMaterialPropertiesAsync(R,N,q)),M.push(this._loadDispersionPropertiesAsync(w,N,q,u)),Promise.all(M).then((()=>{}))}))}_loadDispersionPropertiesAsync(R,N,q,w){if(!(q instanceof E))throw new Error(`${R}: Material type not supported`);return q.subSurface.isRefractionEnabled&&w.dispersion?(q.subSurface.isDispersionEnabled=!0,q.subSurface.dispersion=w.dispersion,Promise.resolve()):Promise.resolve()}}B(NN),U(NN,!0,(R=>new qN(R)));const wN="KHR_mesh_quantization";class uN{constructor(R){this.name=wN,this.enabled=R.isExtensionUsed(wN)}dispose(){}}B(wN),U(wN,!0,(R=>new uN(R)));const MN="KHR_texture_basisu";class vN{constructor(R){this.name=MN,this._loader=R,this.enabled=R.isExtensionUsed(MN)}dispose(){this._loader=null}_loadTextureAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>{const M=void 0==N.sampler?h.DefaultSampler:X.Get(`${R}/sampler`,this._loader.$i.samplers,N.sampler),v=X.Get(`${w}/source`,this._loader.$i.images,u.source);return this._loader._createTextureAsync(R,M,v,(R=>{q(R)}),N._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!N._textureInfo.nonColorData)}))}}B(MN),U(MN,!0,(R=>new vN(R)));const GN="KHR_texture_transform";class JN{constructor(R){this.name=GN,this._loader=R,this.enabled=this._loader.isExtensionUsed(GN)}dispose(){this._loader=null}loadTextureInfoAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((w,u)=>this._loader.loadTextureInfoAsync(R,N,(R=>{if(!(R instanceof P.e))throw new Error(`${w}: Texture type not supported`);u.offset&&(R.uOffset=u.offset[0],R.vOffset=u.offset[1]),R.uRotationCenter=0,R.vRotationCenter=0,u.rotation&&(R.wAng=-u.rotation),u.scale&&(R.uScale=u.scale[0],R.vScale=u.scale[1]),void 0!=u.texCoord&&(R.coordinatesIndex=u.texCoord),q(R)}))))}}B(GN),U(GN,!0,(R=>new JN(R)));const yN="KHR_xmp_json_ld";class aN{constructor(R){this.name=yN,this.order=100,this._loader=R,this.enabled=this._loader.isExtensionUsed(yN)}dispose(){this._loader=null}onLoading(){var R,N,q;if(null===this._loader.rootBabylonMesh)return;const w=null===(R=this._loader.$i.extensions)||void 0===R?void 0:R.KHR_xmp_json_ld,u=null===(N=this._loader.$i.asset)||void 0===N||null===(q=N.extensions)||void 0===q?void 0:q.KHR_xmp_json_ld;if(w&&u){const R=+u.packet;w.packets&&R<w.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=w.packets[R])}}}function jN(R,N,q,w){return M.c.Sd(N,q).scale(w)}function FN(R,N,q,w){return N[q]*w}function SN(R,N,q,w){return-N[q]*w}function HN(R,N,q,w){return N[q+1]*w}function WN(R,N,q,w){return N[q]*w*2}function kN(R){return{scale:[new eN(F.c.ANIMATIONTYPE_FLOAT,`${R}.uScale`,FN,(()=>2)),new eN(F.c.ANIMATIONTYPE_FLOAT,`${R}.vScale`,HN,(()=>2))],offset:[new eN(F.c.ANIMATIONTYPE_FLOAT,`${R}.uOffset`,FN,(()=>2)),new eN(F.c.ANIMATIONTYPE_FLOAT,`${R}.vOffset`,HN,(()=>2))],rotation:[new eN(F.c.ANIMATIONTYPE_FLOAT,`${R}.wAng`,SN,(()=>1))]}}B(yN),U(yN,!0,(R=>new aN(R)));class CN extends I{buildAnimations(R,N,q,w,u){u(R._babylonCamera,this._buildAnimation(N,q,w))}}class eN extends I{buildAnimations(R,N,q,w,u){for(const M in R._data)u(R._data[M].babylonMaterial,this._buildAnimation(N,q,w))}}class KN extends I{buildAnimations(R,N,q,w,u){u(R._babylonLight,this._buildAnimation(N,q,w))}}const rN={__array__:{__target__:!0,...t}},ZN={__array__:{__target__:!0,orthographic:{xmag:[new CN(F.c.ANIMATIONTYPE_FLOAT,"orthoLeft",SN,(()=>1)),new CN(F.c.ANIMATIONTYPE_FLOAT,"orthoRight",HN,(()=>1))],ymag:[new CN(F.c.ANIMATIONTYPE_FLOAT,"orthoBottom",SN,(()=>1)),new CN(F.c.ANIMATIONTYPE_FLOAT,"orthoTop",HN,(()=>1))],zfar:[new CN(F.c.ANIMATIONTYPE_FLOAT,"maxZ",FN,(()=>1))],znear:[new CN(F.c.ANIMATIONTYPE_FLOAT,"dj",FN,(()=>1))]},perspective:{yfov:[new CN(F.c.ANIMATIONTYPE_FLOAT,"fov",FN,(()=>1))],zfar:[new CN(F.c.ANIMATIONTYPE_FLOAT,"maxZ",FN,(()=>1))],znear:[new CN(F.c.ANIMATIONTYPE_FLOAT,"dj",FN,(()=>1))]}}},zN={nodes:rN,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new eN(F.c.ANIMATIONTYPE_COLOR3,"albedoColor",jN,(()=>4)),new eN(F.c.ANIMATIONTYPE_FLOAT,"alpha",(function(R,N,q,w){return N[q+3]*w}),(()=>4))],metallicFactor:[new eN(F.c.ANIMATIONTYPE_FLOAT,"metallic",FN,(()=>1))],roughnessFactor:[new eN(F.c.ANIMATIONTYPE_FLOAT,"roughness",FN,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:kN("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:kN("metallicTexture")}}},emissiveFactor:[new eN(F.c.ANIMATIONTYPE_COLOR3,"emissiveColor",jN,(()=>3))],normalTexture:{scale:[new eN(F.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",FN,(()=>1))],extensions:{KHR_texture_transform:kN("bumpTexture")}},occlusionTexture:{strength:[new eN(F.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",FN,(()=>1))],extensions:{KHR_texture_transform:kN("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:kN("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new eN(F.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",FN,(()=>1))],anisotropyRotation:[new eN(F.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",FN,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:kN("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new eN(F.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",FN,(()=>1))],clearcoatRoughnessFactor:[new eN(F.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",FN,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:kN("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new eN(F.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",FN,(()=>1))],extensions:{KHR_texture_transform:kN("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:kN("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new eN(F.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",FN,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new eN(F.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",FN,(()=>1))]},KHR_materials_ior:{ior:[new eN(F.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",FN,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new eN(F.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",FN,(()=>1))],iridescenceIor:[new eN(F.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",FN,(()=>1))],iridescenceThicknessMinimum:[new eN(F.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",FN,(()=>1))],iridescenceThicknessMaximum:[new eN(F.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",FN,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:kN("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:kN("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new eN(F.c.ANIMATIONTYPE_COLOR3,"sheen.color",jN,(()=>3))],sheenRoughnessFactor:[new eN(F.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",FN,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:kN("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:kN("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new eN(F.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",FN,(()=>1))],specularColorFactor:[new eN(F.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",jN,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:kN("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:kN("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new eN(F.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",FN,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:kN("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new eN(F.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",jN,(()=>3))],attenuationDistance:[new eN(F.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",FN,(()=>1))],thicknessFactor:[new eN(F.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",FN,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:kN("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new eN(F.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",FN,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:kN("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new eN(F.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",jN,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:kN("subSurface.translucencyColorTexture")}}}}}},cameras:ZN,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new KN(F.c.ANIMATIONTYPE_COLOR3,"diffuse",jN,(()=>3))],hj:[new KN(F.c.ANIMATIONTYPE_FLOAT,"intensity",FN,(()=>1))],range:[new KN(F.c.ANIMATIONTYPE_FLOAT,"range",FN,(()=>1))],spot:{innerConeAngle:[new KN(F.c.ANIMATIONTYPE_FLOAT,"innerAngle",WN,(()=>1))],outerConeAngle:[new KN(F.c.ANIMATIONTYPE_FLOAT,"angle",WN,(()=>1))]}}}}}};class dN{constructor(R,N){this._gltf=R,this._infoTree=N}convert(R){let N,q=this._gltf,w=this._infoTree;if(!R.startsWith("/"))throw new Error("Path must start with a /");const u=R.split("/");u.shift();for(const M of u){if(w.__array__)w=w.__array__;else if(w=w[M],!w)throw new Error(`Path ${R} is invalid`);if(void 0===q)throw new Error(`Path ${R} is invalid`);q=q[M],w.__target__&&(N=q)}return{object:N,info:w}}}const xN="KHR_animation_pointer";class EN extends dN{constructor(R){super(R,zN)}}class PN{constructor(R){this.name=xN,this._loader=R,this._pathToObjectConverter=new EN(this._loader.$i)}get enabled(){return this._loader.isExtensionUsed(xN)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(R,N,q,w,u){var M;const v=null===(M=w.target.extensions)||void 0===M?void 0:M.KHR_animation_pointer;if(!v||!this._pathToObjectConverter)return null;"pointer"!==w.target.path&&W.e.Warn(`${R}/target/path: Value (${w.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=w.target.node&&W.e.Warn(`${R}/target/node: Value (${w.target.node}) must not be present when using the ${this.name} extension`);const G=`${R}/extensions/${this.name}`,J=v.pointer;if(!J)throw new Error(`${G}: Pointer is missing`);try{const M=this._pathToObjectConverter.convert(J);return this._loader._loadAnimationChannelFromTargetInfoAsync(R,N,q,w,M,u)}catch(y){return W.e.Warn(`${G}/pointer: Invalid pointer (${J}) skipped`),null}}}B(xN),U(xN,!0,(R=>new PN(R)));class sN{constructor(R,N,q){this.frame=R,this.action=N,this.onlyOnce=q,this.isDone=!1}_clone(){return new sN(this.frame,this.action,this.onlyOnce)}}var ON=q(1044),LN=q(1070);class mN{get loop(){return this._loop}set loop(R){R!==this._loop&&(this._loop=R,this.updateOptions({loop:R}))}get currentTime(){var R;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(R=LN.e.audioEngine)&&void 0!==R&&R.audioContext&&(this.isPlaying||this.isPaused)){const R=this.isPaused?0:LN.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+R}return 0}get spatialSound(){return this._spatialSound}set spatialSound(R){if(R==this._spatialSound)return;const N=this.isPlaying;this.pause(),R?(this._spatialSound=R,this._updateSpatialParameters()):this._disableSpatialSound(),N&&this.play()}constructor(R,N,q){var w;let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new a.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=u.m.Zero(),this._localDirection=new u.m(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=R,q=q||H.e.LastCreatedScene)if(this._scene=q,mN._SceneComponentInitialization(q),this._readyToPlayCallback=M,this._customAttenuationFunction=(R,N,q,w,u)=>N<q?R*(1-N/q):0,G&&(this.autoplay=G.autoplay||!1,this._loop=G.loop||!1,void 0!==G.volume&&(this._volume=G.volume),this._spatialSound=G.spatialSound??!1,this.maxDistance=G.maxDistance??100,this.useCustomAttenuation=G.useCustomAttenuation??!1,this.rolloffFactor=G.rolloffFactor||1,this.refDistance=G.refDistance||1,this.distanceModel=G.distanceModel||"linear",this._playbackRate=G.playbackRate||1,this._streaming=G.streaming??!1,this._length=G.length,this._offset=G.offset),null!==(w=LN.e.audioEngine)&&void 0!==w&&w.canUseWebAudio&&LN.e.audioEngine.audioContext){this._soundGain=LN.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let R=!0;if(N)try{"string"===typeof N?(this._urlType="String",this._url=N):N instanceof ArrayBuffer?this._urlType="ArrayBuffer":N instanceof HTMLMediaElement?this._urlType="MediaElement":N instanceof MediaStream?this._urlType="MediaStream":N instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(N)&&(this._urlType="Array");let q=[],w=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=LN.e.audioEngine.audioContext.createMediaElementSource(N),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=LN.e.audioEngine.audioContext.createMediaStreamSource(N),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":N.byteLength>0&&(w=!0,this._soundLoaded(N));break;case"AudioBuffer":this._audioBufferLoaded(N);break;case"String":q.push(N);case"Array":0===q.length&&(q=N);for(let R=0;R<q.length;R++){const N=q[R];if(w=G&&G.skipCodecCheck||-1!==N.indexOf(".mp3",N.length-4)&&LN.e.audioEngine.isMP3supported||-1!==N.indexOf(".ogg",N.length-4)&&LN.e.audioEngine.isOGGsupported||-1!==N.indexOf(".wav",N.length-4)||-1!==N.indexOf(".m4a",N.length-4)||-1!==N.indexOf(".mp4",N.length-4)||-1!==N.indexOf("blob:"),w){this._streaming?(this._htmlAudioElement=new Audio(N),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,v.i.SetCorsBehavior(N,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(N,(R=>{this._soundLoaded(R)}),void 0,!0,!0,(R=>{R&&W.e.Error("XHR "+R.status+" error on: "+N+"."),W.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:R=!1}R?w||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):W.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(J){W.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),LN.e.audioEngine&&!LN.e.audioEngine.WarnedWebAudioUnsupported&&(W.e.Error("Web Audio is not supported by your browser."),LN.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var R;null!==(R=LN.e.audioEngine)&&void 0!==R&&R.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(R){var N;null!==(N=LN.e.audioEngine)&&void 0!==N&&N.audioContext&&(this._audioBuffer=R,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(R){var N;null!==(N=LN.e.audioEngine)&&void 0!==N&&N.audioContext&&LN.e.audioEngine.audioContext.decodeAudioData(R,(R=>{this._audioBufferLoaded(R)}),(R=>{W.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+R)}))}setAudioBuffer(R){var N;null!==(N=LN.e.audioEngine)&&void 0!==N&&N.canUseWebAudio&&(this._audioBuffer=R,this._isReadyToPlay=!0)}updateOptions(R){R&&(this.loop=R.loop??this.loop,this.maxDistance=R.maxDistance??this.maxDistance,this.useCustomAttenuation=R.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=R.rolloffFactor??this.rolloffFactor,this.refDistance=R.refDistance??this.refDistance,this.distanceModel=R.distanceModel??this.distanceModel,this._playbackRate=R.playbackRate??this._playbackRate,this._length=R.length??void 0,this.spatialSound=R.spatialSound??this._spatialSound,this._setOffset(R.offset??void 0),this.setVolume(R.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var R;null!==(R=LN.e.audioEngine)&&void 0!==R&&R.canUseWebAudio&&LN.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??LN.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var R;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(R=this._soundPanner)||void 0===R||R.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var R;null!==(R=LN.e.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(R){var N;null!==(N=LN.e.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(R),this._isOutputConnected=!0)}setDirectionalCone(R,N,q){N<R?W.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=R,this._coneOuterAngle=N,this._coneOuterGain=q,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(R){if(R!=this._coneInnerAngle){var N;if(this._coneOuterAngle<R)return void W.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=R,null!==(N=LN.e.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(R){if(R!=this._coneOuterAngle){var N;if(R<this._coneInnerAngle)return void W.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=R,null!==(N=LN.e.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(R){var N;R.equals(this._position)||(this._position.p(R),null!==(N=LN.e.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(R){var N;this._localDirection=R,null!==(N=LN.e.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const R=this._connectedTransformNode.getWorldMatrix(),N=u.m.TransformNormal(this._localDirection,R);N.normalize(),this._soundPanner.orientationX.value=N.x,this._soundPanner.orientationY.value=N.y,this._soundPanner.orientationZ.value=N.z}updateDistanceFromListener(){var R;if(null!==(R=LN.e.audioEngine)&&void 0!==R&&R.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const R=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Vc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,R,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(R){this._customAttenuationFunction=R}play(R,N,q){var w;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(w=LN.e.audioEngine)&&void 0!==w&&w.audioContext)try{var u,M;this._clearTimeoutsAndObservers();let w=R?(null===(u=LN.e.audioEngine)||void 0===u?void 0:u.audioContext.currentTime)+R:null===(M=LN.e.audioEngine)||void 0===M?void 0:M.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=LN.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const R=()=>{var q;if(null!==(q=LN.e.audioEngine)&&void 0!==q&&q.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=N??0;const q=this._htmlAudioElement.play();void 0!==q&&q.catch((()=>{var N,q;(null===(N=LN.e.audioEngine)||void 0===N||N.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(q=LN.e.audioEngine)||void 0===q?void 0:q.onAudioUnlockedObservable.addOnce((()=>{R()})))}))}else{var w;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(w=LN.e.audioEngine)||void 0===w?void 0:w.onAudioUnlockedObservable.addOnce((()=>{R()}))}};R()}}else{var v;const u=()=>{var u;if(null!==(u=LN.e.audioEngine)&&void 0!==u&&u.audioContext){var M;if(q=q||this._length,void 0!==N&&this._setOffset(N),this._soundSource){const R=this._soundSource;R.onended=()=>{R.disconnect()}}if(this._soundSource=null===(M=LN.e.audioEngine)||void 0===M?void 0:M.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var v;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==N&&(this._soundSource.loopStart=N),void 0!==q&&(this._soundSource.loopEnd=(0|N)+q),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},w=R?(null===(v=LN.e.audioEngine)||void 0===v?void 0:v.audioContext.currentTime)+R:LN.e.audioEngine.audioContext.currentTime;const u=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(w,u,this.loop?void 0:q)}}};"suspended"===(null===(v=LN.e.audioEngine)||void 0===v?void 0:v.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var R;"suspended"===(null===(R=LN.e.audioEngine)||void 0===R?void 0:R.audioContext.state)?(LN.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=LN.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{u()})))):u()}),500):u()}this._startTime=w,this.isPlaying=!0,this.isPaused=!1}catch(G){W.e.Error("Error while trying to play audio: "+this.name+", "+G.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(R){var N;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var q;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(q=this._streamingSource)||void 0===q||q.disconnect();this.isPlaying=!1}else if(null!==(N=LN.e.audioEngine)&&void 0!==N&&N.audioContext&&this._soundSource){const N=R?LN.e.audioEngine.audioContext.currentTime+R:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(N)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var R;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var N;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(N=this._streamingSource)||void 0===N||N.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(R=LN.e.audioEngine)&&void 0!==R&&R.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=LN.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(R,N){var q;null!==(q=LN.e.audioEngine)&&void 0!==q&&q.canUseWebAudio&&this._soundGain&&(N&&LN.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(LN.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,LN.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(R,LN.e.audioEngine.audioContext.currentTime+N)):this._soundGain.gain.value=R),this._volume=R}setPlaybackRate(R){this._playbackRate=R,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(R){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=R,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=R=>this._onRegisterAfterWorldMatrixUpdate(R),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(R){var N;if(R.getBoundingInfo){const N=R.getBoundingInfo();this.setPosition(N.boundingSphere.centerWorld)}else this.setPosition(R.absolutePosition);null!==(N=LN.e.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const R=()=>{this._isReadyToPlay?(q._audioBuffer=this.getAudioBuffer(),q._isReadyToPlay=!0,q.autoplay&&q.play(0,this._offset,this._length)):setTimeout(R,300)},N={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},q=new mN(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,N);return this.useCustomAttenuation&&q.setAttenuationFunction(this._customAttenuationFunction),q.setPosition(this._position),q.setPlaybackRate(this._playbackRate),R(),q}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const R={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(R.connectedMeshId=this._connectedTransformNode.id),R.position=this._position.de(),R.refDistance=this.refDistance,R.distanceModel=this.distanceModel,R.isDirectional=this._isDirectional,R.localDirectionToMesh=this._localDirection.de(),R.coneInnerAngle=this._coneInnerAngle,R.coneOuterAngle=this._coneOuterAngle,R.coneOuterGain=this._coneOuterGain),R}static Parse(R,N,q,w){const M=R.name;let v;v=R.url?q+R.url:q+M;const G={autoplay:R.autoplay,loop:R.loop,volume:R.volume,spatialSound:R.spatialSound,maxDistance:R.maxDistance,rolloffFactor:R.rolloffFactor,refDistance:R.refDistance,distanceModel:R.distanceModel,playbackRate:R.playbackRate};let J;if(w){const R=()=>{w._isReadyToPlay?(J._audioBuffer=w.getAudioBuffer(),J._isReadyToPlay=!0,J.autoplay&&J.play(0,J._offset,J._length)):setTimeout(R,300)};J=new mN(M,new ArrayBuffer(0),N,null,G),R()}else J=new mN(M,v,N,(()=>{N.removePendingData(J)}),G),N.addPendingData(J);if(R.position){const N=u.m.Sd(R.position);J.setPosition(N)}if(R.isDirectional&&(J.setDirectionalCone(R.coneInnerAngle||360,R.coneOuterAngle||360,R.coneOuterGain||0),R.localDirectionToMesh)){const N=u.m.Sd(R.localDirectionToMesh);J.setLocalDirectionToMesh(N)}if(R.connectedMeshId){const q=N.getMeshById(R.connectedMeshId);q&&J.attachToMesh(q)}return R.metadata&&(J.metadata=R.metadata),J}_setOffset(R){this._offset!==R&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=R)}_clearTimeoutsAndObservers(){var R;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(R=LN.e.audioEngine)||void 0===R||R.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}mN._SceneComponentInitialization=R=>{throw(0,ON.c)("AudioSceneComponent")},(0,d.h)("BABYLON.Sound",mN);class oN{constructor(R,N,q){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],N.length!==q.length)throw new Error("Sounds length does not equal weights length");this.loop=R,this._weights=q;let w=0;for(const M of q)w+=M;const u=w>0?1/w:0;for(let M=0;M<this._weights.length;M++)this._weights[M]*=u;this._sounds=N;for(const M of this._sounds)M.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(R){if(R!==this._coneInnerAngle){if(this._coneOuterAngle<R)return void W.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=R;for(const N of this._sounds)N.directionalConeInnerAngle=R}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(R){if(R!==this._coneOuterAngle){if(R<this._coneInnerAngle)return void W.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=R;for(const N of this._sounds)N.directionalConeOuterAngle=R}}get volume(){return this._volume}set volume(R){if(R!==this._volume)for(const N of this._sounds)N.setVolume(R)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(R){if(!this.isPaused){this.stop();const R=Math.random();let N=0;for(let q=0;q<this._weights.length;q++)if(N+=this._weights[q],R<=N){this._currentIndex=q;break}}const N=this._sounds[this._currentIndex??0];N.isReady()?N.play(0,this.isPaused?void 0:R):N.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class AN{constructor(R){let N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(R=R||H.e.LastCreatedScene)&&(this._scene=R,this.soundCollection=[],this._options=N,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var R;null!==(R=LN.e.audioEngine)&&void 0!==R&&R.canUseWebAudio&&LN.e.audioEngine.audioContext&&(this._outputAudioNode=LN.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(LN.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(LN.e.audioEngine&&LN.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(R){var N;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(N=LN.e.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._outputAudioNode&&R.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==R.soundTrackId&&(-1===R.soundTrackId?this._scene.mainSoundTrack.removeSound(R):this._scene.soundTracks&&this._scene.soundTracks[R.soundTrackId].removeSound(R)),this.soundCollection.push(R),R.soundTrackId=this.id}removeSound(R){const N=this.soundCollection.indexOf(R);-1!==N&&this.soundCollection.splice(N,1)}setVolume(R){var N;null!==(N=LN.e.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=R)}switchPanningModelToHRTF(){var R;if(null!==(R=LN.e.audioEngine)&&void 0!==R&&R.canUseWebAudio)for(let N=0;N<this.soundCollection.length;N++)this.soundCollection[N].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var R;if(null!==(R=LN.e.audioEngine)&&void 0!==R&&R.canUseWebAudio)for(let N=0;N<this.soundCollection.length;N++)this.soundCollection[N].switchPanningModelToEqualPower()}connectToAnalyser(R){var N;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=R,null!==(N=LN.e.audioEngine)&&void 0!==N&&N.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,LN.e.audioEngine.masterGain))}}var nN=q(1255),QN=q(1174),YN=(q(1536),q(1097));(0,q(11549).g)(nN.b.NAME_AUDIO,((R,N,q,w)=>{let u,M=[];if(q.Ue=q.Ue||[],void 0!==R.Ue&&null!==R.Ue)for(let G=0,J=R.Ue.length;G<J;G++){var v;const J=R.Ue[G];null!==(v=LN.e.audioEngine)&&void 0!==v&&v.canUseWebAudio?(J.url||(J.url=J.name),M[J.url]?q.Ue.push(mN.Parse(J,N,w,M[J.url])):(u=mN.Parse(J,N,w),M[J.url]=u,q.Ue.push(u))):q.Ue.push(new mN(J.name,null,N))}M=[]})),Object.defineProperty(QN.e.prototype,"mainSoundTrack",{get:function(){let R=this._getComponent(nN.b.NAME_AUDIO);return R||(R=new TN(this),this.Te(R)),this._mainSoundTrack||(this._mainSoundTrack=new AN(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),QN.e.prototype.getSoundByName=function(R){let N;for(N=0;N<this.mainSoundTrack.soundCollection.length;N++)if(this.mainSoundTrack.soundCollection[N].name===R)return this.mainSoundTrack.soundCollection[N];if(this.soundTracks)for(let q=0;q<this.soundTracks.length;q++)for(N=0;N<this.soundTracks[q].soundCollection.length;N++)if(this.soundTracks[q].soundCollection[N].name===R)return this.soundTracks[q].soundCollection[N];return null},Object.defineProperty(QN.e.prototype,"audioEnabled",{get:function(){let R=this._getComponent(nN.b.NAME_AUDIO);return R||(R=new TN(this),this.Te(R)),R.audioEnabled},set:function(R){let N=this._getComponent(nN.b.NAME_AUDIO);N||(N=new TN(this),this.Te(N)),R?N.enableAudio():N.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(QN.e.prototype,"headphone",{get:function(){let R=this._getComponent(nN.b.NAME_AUDIO);return R||(R=new TN(this),this.Te(R)),R.headphone},set:function(R){let N=this._getComponent(nN.b.NAME_AUDIO);N||(N=new TN(this),this.Te(N)),R?N.switchAudioModeForHeadphones():N.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(QN.e.prototype,"audioListenerPositionProvider",{get:function(){let R=this._getComponent(nN.b.NAME_AUDIO);return R||(R=new TN(this),this.Te(R)),R.audioListenerPositionProvider},set:function(R){let N=this._getComponent(nN.b.NAME_AUDIO);if(N||(N=new TN(this),this.Te(N)),R&&"function"!==typeof R)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");N.audioListenerPositionProvider=R},enumerable:!0,configurable:!0}),Object.defineProperty(QN.e.prototype,"audioListenerRotationProvider",{get:function(){let R=this._getComponent(nN.b.NAME_AUDIO);return R||(R=new TN(this),this.Te(R)),R.audioListenerRotationProvider},set:function(R){let N=this._getComponent(nN.b.NAME_AUDIO);if(N||(N=new TN(this),this.Te(N)),R&&"function"!==typeof R)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");N.audioListenerRotationProvider=R},enumerable:!0,configurable:!0}),Object.defineProperty(QN.e.prototype,"audioPositioningRefreshRate",{get:function(){let R=this._getComponent(nN.b.NAME_AUDIO);return R||(R=new TN(this),this.Te(R)),R.audioPositioningRefreshRate},set:function(R){let N=this._getComponent(nN.b.NAME_AUDIO);N||(N=new TN(this),this.Te(N)),N.audioPositioningRefreshRate=R},enumerable:!0,configurable:!0});class TN{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(R){this.name=nN.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new u.m,this._cachedCameraPosition=new u.m,this._lastCheck=0,this._invertMatrixTemp=new u.c,this._cameraDirectionTemp=new u.m,(R=R||H.e.LastCreatedScene)&&(this.Ke=R,R.soundTracks=[],R.Ue=[])}register(){this.Ke._afterRenderStage.registerStep(nN.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(R){if(R.Ue=[],this.Ke.soundTracks)for(let N=0;N<this.Ke.soundTracks.length;N++){const q=this.Ke.soundTracks[N];for(let N=0;N<q.soundCollection.length;N++)R.Ue.push(q.soundCollection[N].serialize())}}addFromContainer(R){R.Ue&&R.Ue.forEach((R=>{R.play(),R.autoplay=!0,this.Ke.mainSoundTrack.addSound(R)}))}removeFromContainer(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];R.Ue&&R.Ue.forEach((R=>{R.stop(),R.autoplay=!1,this.Ke.mainSoundTrack.removeSound(R),N&&R.dispose()}))}dispose(){const R=this.Ke;if(R._mainSoundTrack&&R.mainSoundTrack.dispose(),R.soundTracks)for(let N=0;N<R.soundTracks.length;N++)R.soundTracks[N].dispose()}disableAudio(){const R=this.Ke;let N;for(this._audioEnabled=!1,LN.e.audioEngine&&LN.e.audioEngine.audioContext&&LN.e.audioEngine.audioContext.suspend(),N=0;N<R.mainSoundTrack.soundCollection.length;N++)R.mainSoundTrack.soundCollection[N].pause();if(R.soundTracks)for(N=0;N<R.soundTracks.length;N++)for(let q=0;q<R.soundTracks[N].soundCollection.length;q++)R.soundTracks[N].soundCollection[q].pause()}enableAudio(){const R=this.Ke;let N;for(this._audioEnabled=!0,LN.e.audioEngine&&LN.e.audioEngine.audioContext&&LN.e.audioEngine.audioContext.resume(),N=0;N<R.mainSoundTrack.soundCollection.length;N++)R.mainSoundTrack.soundCollection[N].isPaused&&R.mainSoundTrack.soundCollection[N].play();if(R.soundTracks)for(N=0;N<R.soundTracks.length;N++)for(let q=0;q<R.soundTracks[N].soundCollection.length;q++)R.soundTracks[N].soundCollection[q].isPaused&&R.soundTracks[N].soundCollection[q].play()}switchAudioModeForHeadphones(){const R=this.Ke;if(this._headphone=!0,R.mainSoundTrack.switchPanningModelToHRTF(),R.soundTracks)for(let N=0;N<R.soundTracks.length;N++)R.soundTracks[N].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const R=this.Ke;if(this._headphone=!1,R.mainSoundTrack.switchPanningModelToEqualPower(),R.soundTracks)for(let N=0;N<R.soundTracks.length;N++)R.soundTracks[N].switchPanningModelToEqualPower()}_afterRender(){const R=YN.b.Now;if(this._lastCheck&&R-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=R;const N=this.Ke;if(!this._audioEnabled||!N._mainSoundTrack||!N.soundTracks||0===N._mainSoundTrack.soundCollection.length&&1===N.soundTracks.length)return;const q=LN.e.audioEngine;if(q&&q.audioContext){let R,w=N.activeCamera;if(N.activeCameras&&N.activeCameras.length>0&&(w=N.activeCameras[0]),this.audioListenerPositionProvider){const R=this.audioListenerPositionProvider();q.audioContext.listener.setPosition(R.x||0,R.y||0,R.z||0)}else w?this._cachedCameraPosition.equals(w.globalPosition)||(this._cachedCameraPosition.p(w.globalPosition),q.audioContext.listener.setPosition(w.globalPosition.x,w.globalPosition.y,w.globalPosition.z)):q.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const R=this.audioListenerRotationProvider();q.audioContext.listener.setOrientation(R.x||0,R.y||0,R.z||0,0,1,0)}else w?(w.rigCameras&&w.rigCameras.length>0&&(w=w.rigCameras[0]),w.getViewMatrix().invertToRef(this._invertMatrixTemp),u.m.TransformNormalToRef(TN._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),q.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):q.audioContext.listener.setOrientation(0,0,0,0,1,0);for(R=0;R<N.mainSoundTrack.soundCollection.length;R++){const q=N.mainSoundTrack.soundCollection[R];q.useCustomAttenuation&&q.updateDistanceFromListener()}if(N.soundTracks)for(R=0;R<N.soundTracks.length;R++)for(let q=0;q<N.soundTracks[R].soundCollection.length;q++){const w=N.soundTracks[R].soundCollection[q];w.useCustomAttenuation&&w.updateDistanceFromListener()}}}}TN._CameraDirection=new u.m(0,0,-1),mN._SceneComponentInitialization=R=>{let N=R._getComponent(nN.b.NAME_AUDIO);N||(N=new TN(R),R.Te(N))};const fN="MSFT_audio_emitter";class cN{constructor(R){this.name=fN,this._loader=R,this.enabled=this._loader.isExtensionUsed(fN)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const R=this._loader.$i.extensions;if(R&&R[this.name]){const N=R[this.name];this._clips=N.clips,this._emitters=N.emitters,X.Assign(this._clips),X.Assign(this._emitters)}}loadSceneAsync(R,N){return h.LoadExtensionAsync(R,N,this.name,((q,w)=>{const u=new Array;u.push(this._loader.loadSceneAsync(R,N));for(const R of w.emitters){const N=X.Get(`${q}/emitters`,this._emitters,R);if(void 0!=N.refDistance||void 0!=N.maxDistance||void 0!=N.rolloffFactor||void 0!=N.distanceModel||void 0!=N.innerAngle||void 0!=N.outerAngle)throw new Error(`${q}: Direction or Distance properties are not allowed on emitters attached to a scene`);u.push(this._loadEmitterAsync(`${q}/emitters/${N.index}`,N))}return Promise.all(u).then((()=>{}))}))}loadNodeAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((R,w)=>{const M=new Array;return this._loader.loadNodeAsync(R,N,(N=>{for(const q of w.emitters){const w=X.Get(`${R}/emitters`,this._emitters,q);M.push(this._loadEmitterAsync(`${R}/emitters/${w.index}`,w).then((()=>{for(const R of w._babylonSounds)R.attachToMesh(N),void 0==w.innerAngle&&void 0==w.outerAngle||(R.setLocalDirectionToMesh(u.m.Forward()),R.setDirectionalCone(2*v.i.ToDegrees(void 0==w.innerAngle?Math.PI:w.innerAngle),2*v.i.ToDegrees(void 0==w.outerAngle?Math.PI:w.outerAngle),0))})))}q(N)})).then((R=>Promise.all(M).then((()=>R))))}))}loadAnimationAsync(R,N){return h.LoadExtensionAsync(R,N,this.name,((q,w)=>this._loader.loadAnimationAsync(R,N).then((u=>{const M=new Array;X.Assign(w.events);for(const v of w.events)M.push(this._loadAnimationEventAsync(`${q}/events/${v.index}`,R,N,v,u));return Promise.all(M).then((()=>u))}))))}_loadClipAsync(R,N){if(N._objectURL)return N._objectURL;let q;if(N.uri)q=this._loader.loadUriAsync(R,N,N.uri);else{const w=X.Get(`${R}/bufferView`,this._loader.$i.bufferViews,N.bufferView);q=this._loader.loadBufferViewAsync(`/bufferViews/${w.index}`,w)}return N._objectURL=q.then((R=>URL.createObjectURL(new Blob([R],{type:N.mimeType})))),N._objectURL}_loadEmitterAsync(R,N){if(N._babylonSounds=N._babylonSounds||[],!N._babylonData){const R=new Array,q=N.name||`emitter${N.index}`,w={loop:!1,autoplay:!1,volume:void 0==N.volume?1:N.volume};for(let M=0;M<N.clips.length;M++){const u=`/extensions/${this.name}/clips`,v=X.Get(u,this._clips,N.clips[M].clip);R.push(this._loadClipAsync(`${u}/${N.clips[M].clip}`,v).then((R=>{const u=N._babylonSounds[M]=new mN(q,R,this._loader.babylonScene,null,w);u.refDistance=N.refDistance||1,u.maxDistance=N.maxDistance||256,u.rolloffFactor=N.rolloffFactor||1,u.distanceModel=N.distanceModel||"exponential"})))}const u=Promise.all(R).then((()=>{const R=N.clips.map((R=>R.weight||1)),q=new oN(N.loop||!1,N._babylonSounds,R);N.innerAngle&&(q.directionalConeInnerAngle=2*v.i.ToDegrees(N.innerAngle)),N.outerAngle&&(q.directionalConeOuterAngle=2*v.i.ToDegrees(N.outerAngle)),N.volume&&(q.volume=N.volume),N._babylonData.sound=q}));N._babylonData={loaded:u}}return N._babylonData.loaded}_getEventAction(R,N,q,w,u){switch(q){case"play":return R=>{const q=(u||0)+(R-w);N.play(q)};case"stop":return()=>{N.stop()};case"pause":return()=>{N.pause()};default:throw new Error(`${R}: Unsupported action ${q}`)}}_loadAnimationEventAsync(R,N,q,w,u){if(0==u.targetedAnimations.length)return Promise.resolve();const M=u.targetedAnimations[0],v=w.k,G=X.Get(`/extensions/${this.name}/emitters`,this._emitters,v);return this._loadEmitterAsync(R,G).then((()=>{const N=G._babylonData.sound;if(N){const q=new sN(w.time,this._getEventAction(R,N,w.action,w.time,w.startOffset));M.animation.addEvent(q),u.onAnimationGroupEndObservable.add((()=>{N.stop()})),u.onAnimationGroupPauseObservable.add((()=>{N.pause()}))}}))}}B(fN),U(fN,!0,(R=>new cN(R)));const bN="MSFT_lod";class IN{constructor(R){var N;this.name=bN,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new a.c,this.onMaterialLODsLoadedObservable=new a.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=R,this.maxLODsToLoad=(null===(N=this._loader.parent.extensionOptions[bN])||void 0===N?void 0:N.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(bN)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let R=0;R<this._nodePromiseLODs.length;R++){const N=Promise.all(this._nodePromiseLODs[R]).then((()=>{0!==R&&(this._loader.endPerformanceCounter(`Node LOD ${R}`),this._loader.log(`Loaded node LOD ${R}`)),this.onNodeLODsLoadedObservable.notifyObservers(R),R!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${R+1}`),this._loadBufferLOD(this._nodeBufferLODs,R+1),this._nodeSignalLODs[R]&&this._nodeSignalLODs[R].resolve())}));this._loader._completePromises.push(N)}for(let R=0;R<this._materialPromiseLODs.length;R++){const N=Promise.all(this._materialPromiseLODs[R]).then((()=>{0!==R&&(this._loader.endPerformanceCounter(`Material LOD ${R}`),this._loader.log(`Loaded material LOD ${R}`)),this.onMaterialLODsLoadedObservable.notifyObservers(R),R!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${R+1}`),this._loadBufferLOD(this._materialBufferLODs,R+1),this._materialSignalLODs[R]&&this._materialSignalLODs[R].resolve())}));this._loader._completePromises.push(N)}}loadSceneAsync(R,N){const q=this._loader.loadSceneAsync(R,N);return this._loadBufferLOD(this._bufferLODs,0),q}loadNodeAsync(R,N,q){return h.LoadExtensionAsync(R,N,this.name,((R,u)=>{let M;const v=this._getLODs(R,N,this._loader.$i.nodes,u.ids);this._loader.logOpen(`${R}`);for(let N=0;N<v.length;N++){const R=v[N];0!==N&&(this._nodeIndexLOD=N,this._nodeSignalLODs[N]=this._nodeSignalLODs[N]||new w);const u=R=>{q(R),R.Jg(!1)},G=this._loader.loadNodeAsync(`/nodes/${R.index}`,R,u).then((R=>{if(0!==N){const R=v[N-1];R._babylonTransformNode&&(this._disposeTransformNode(R._babylonTransformNode),delete R._babylonTransformNode)}return R.Jg(!0),R}));this._nodePromiseLODs[N]=this._nodePromiseLODs[N]||[],0===N?M=G:(this._nodeIndexLOD=null,this._nodePromiseLODs[N].push(G))}return this._loader.logClose(),M}))}_loadMaterialAsync(R,N,q,w,u){return this._nodeIndexLOD?null:h.LoadExtensionAsync(R,N,this.name,((R,M)=>{let v;const G=this._getLODs(R,N,this._loader.$i.materials,M.ids);this._loader.logOpen(`${R}`);for(let N=0;N<G.length;N++){const R=G[N];0!==N&&(this._materialIndexLOD=N);const M=this._loader._loadMaterialAsync(`/materials/${R.index}`,R,q,w,(R=>{0===N&&u(R)})).then((R=>{if(0!==N){u(R);const q=G[N-1]._data;q[w]&&(this._disposeMaterials([q[w].babylonMaterial]),delete q[w])}return R}));this._materialPromiseLODs[N]=this._materialPromiseLODs[N]||[],0===N?v=M:(this._materialIndexLOD=null,this._materialPromiseLODs[N].push(M))}return this._loader.logClose(),v}))}_loadUriAsync(R,N,q){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const u=this._nodeIndexLOD-1;return this._nodeSignalLODs[u]=this._nodeSignalLODs[u]||new w,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(R,N,q)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const u=this._materialIndexLOD-1;return this._materialSignalLODs[u]=this._materialSignalLODs[u]||new w,this._materialSignalLODs[u].promise.then((()=>this._loader.loadUriAsync(R,N,q)))}return null}loadBufferAsync(R,N,q,u){if(this._loader.parent.useRangeRequests&&!N.uri){if(!this._loader.bin)throw new Error(`${R}: Uri is missing or the binary glTF is missing its binary chunk`);const N=(R,N)=>{const M=q,v=M+u-1;let G=R[N];return G?(G.start=Math.min(G.start,M),G.end=Math.max(G.end,v)):(G={start:M,end:v,loaded:new w},R[N]=G),G.loaded.promise.then((R=>new Uint8Array(R.buffer,R.byteOffset+q-G.start,u)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?N(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?N(this._materialBufferLODs,this._materialIndexLOD):N(this._bufferLODs,0)}return null}_loadBufferLOD(R,N){const q=R[N];q&&(this._loader.log(`Loading buffer range [${q.start}-${q.end}]`),this._loader.bin.readAsync(q.start,q.end-q.start+1).then((R=>{q.loaded.resolve(R)}),(R=>{q.loaded.reject(R)})))}_getLODs(R,N,q,w){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const u=[];for(let M=w.length-1;M>=0;M--)if(u.push(X.Get(`${R}/ids/${w[M]}`,q,w[M])),u.length===this.maxLODsToLoad)return u;return u.push(N),u}_disposeTransformNode(R){const N=[],q=R.material;q&&N.push(q);for(const u of R.getChildMeshes())u.material&&N.push(u.material);R.dispose();const w=N.filter((R=>this._loader.babylonScene.meshes.every((N=>N.material!=R))));this._disposeMaterials(w)}_disposeMaterials(R){const N={};for(const q of R){for(const R of q.getActiveTextures())N[R.uniqueId]=R;q.dispose()}for(const q in N)for(const R of this._loader.babylonScene.materials)R.hasTexture(N[q])&&delete N[q];for(const q in N)N[q].dispose()}}B(bN),U(bN,!0,(R=>new IN(R)));const VN="MSFT_minecraftMesh";class tN{constructor(R){this.name=VN,this._loader=R,this.enabled=this._loader.isExtensionUsed(VN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,N,q){return h.LoadExtraAsync(R,N,this.name,((w,u)=>{if(u){if(!(q instanceof E))throw new Error(`${w}: Material type not supported`);const u=this._loader.loadMaterialPropertiesAsync(R,N,q);return q.needAlphaBlending()&&(q.forceDepthWrite=!0,q.separateCullingPass=!0),q.re=q.forceDepthWrite,q.twoSidedLighting=!0,u}return null}))}}B(VN),U(VN,!0,(R=>new tN(R)));const iN="MSFT_sRGBFactors";class gN{constructor(R){this.name=iN,this._loader=R,this.enabled=this._loader.isExtensionUsed(iN)}dispose(){this._loader=null}loadMaterialPropertiesAsync(R,N,q){return h.LoadExtraAsync(R,N,this.name,((w,u)=>{if(u){if(!(q instanceof E))throw new Error(`${w}: Material type not supported`);const u=this._loader.loadMaterialPropertiesAsync(R,N,q),M=q.va().getEngine().useExactSrgbConversions;return q.albedoTexture||q.albedoColor.toLinearSpaceToRef(q.albedoColor,M),q.reflectivityTexture||q.reflectivityColor.toLinearSpaceToRef(q.reflectivityColor,M),u}return null}))}}B(iN),U(iN,!0,(R=>new gN(R)));var UN,BN=q(1013);!function(R){R[R.Input=0]="Input",R[R.Output=1]="Output"}(UN||(UN={}));class lN{constructor(R,N,q){this._ownerBlock=q,this._connectedPoint=[],this.uniqueId=(0,BN.d)(),this.connectedPointIds=[],this.name=R,this._connectionType=N}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(R){if(this._connectionType===R._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||R._isSingularConnection()&&R._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(R),R._connectedPoint.push(this)}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};R.uniqueId=this.uniqueId,R.name=this.name,R._connectionType=this._connectionType,R.connectedPointIds=[],R.className=this.getClassName();for(const N of this._connectedPoint)R.connectedPointIds.push(N.uniqueId)}getClassName(){return"FGConnection"}deserialize(R){this.uniqueId=R.uniqueId,this.name=R.name,this._connectionType=R._connectionType,this.connectedPointIds=R.connectedPointIds}static Parse(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},N=arguments.length>1?arguments[1]:void 0;const q=new(v.i.Instantiate(R.className))(R.name,R._connectionType,N);return q.deserialize(R),q}}class XN{constructor(R){this.value=this._toInt(R)}_toInt(R){return 0|R}add(R){return new XN(this.value+R.value)}Vc(R){return new XN(this.value-R.value)}multiply(R){return new XN(Math.imul(this.value,R.value))}divide(R){return new XN(this.value/R.value)}getClassName(){return XN.ClassName}equals(R){return this.value===R.value}static Parse(R){return new XN(R.value)}}XN.ClassName="FlowGraphInteger",(0,d.h)("FlowGraphInteger",XN);class hN{constructor(R,N){this.typeName=R,this.defaultValue=N}serialize(R){R.typeName=this.typeName,R.defaultValue=this.defaultValue}static Parse(R){return new hN(R.typeName,R.defaultValue)}}const DN=new hN("any",void 0),pN=(new hN("string",""),new hN("number",0)),Rq=new hN("boolean",!1),Nq=new hN("Vector2",u.j.Zero()),qq=new hN("Od",u.m.Zero()),wq=(new hN("Vector4",u.n.Zero()),new hN("Matrix",u.c.Identity())),uq=(new hN("Be",M.c.Black()),new hN("Ee",new M.d(0,0,0,0)),new hN("Quaternion",u.e.Identity()),new hN("FlowGraphInteger",new XN(0)));class Mq extends lN{constructor(R,N,q,w){super(R,N,q),this.richType=w}_isSingularConnection(){return 0===this.connectionType}setValue(R,N){N._setConnectionValue(this,R)}connectTo(R){super.connectTo(R)}_getValueOrDefault(R){return R._hasConnectionValue(this)?R._getConnectionValue(this):this.richType.defaultValue}getValue(R){return 1===this.connectionType?(R._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(R),this._getValueOrDefault(R)):this.isConnected()?this._connectedPoint[0].getValue(R):this._getValueOrDefault(R)}getClassName(){return"FGDataConnection"}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(R),R.richType={},this.richType.serialize(R.richType)}static Parse(R,N){const q=lN.Parse(R,N);return q.richType=hN.Parse(R.richType),q}}function vq(R){return"Mesh"===R||"AbstractMesh"===R||"GroundMesh"===R||"InstanceMesh"===R||"LinesMesh"===R||"GoldbergMesh"===R||"GreasedLineMesh"===R||"TrailMesh"===R}function Gq(R){return"Vector2"===R||"Od"===R||"Vector4"===R||"Quaternion"===R||"Be"===R||"Ee"===R}function Jq(R,N,q){var w;const u=(null===N||void 0===N||null===(w=N.getClassName)||void 0===w?void 0:w.call(N))??"";vq(u)?q[R]={name:N.name,className:u}:Gq(u)?q[R]={value:N.de(),className:u}:q[R]=N}function yq(R,N,q){const w=N[R];let v;const G=null===w||void 0===w?void 0:w.className;return v=vq(G)?q.getMeshByName(w.name):Gq(G)?function(R,N){if("Vector2"===R)return u.j.Sd(N);if("Od"===R)return u.m.Sd(N);if("Vector4"===R)return u.n.Sd(N);if("Quaternion"===R)return u.e.Sd(N);if("Be"===R)return new M.c(N[0],N[1],N[2]);if("Ee"===R)return new M.d(N[0],N[1],N[2],N[3]);throw new Error(`Unknown vector class name ${R}`)}(G,w.value):"Matrix"===G?u.c.Sd(w.value):G===XN.ClassName?XN.Parse(w):w&&void 0!==w.value?w.value:w,v}(0,d.h)("FGDataConnection",Mq);class aq{constructor(R){var N;this.config=R,this.uniqueId=(0,BN.d)(),this.name=(null===(N=this.config)||void 0===N?void 0:N.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(R){}registerDataInput(R,N){const q=new Mq(R,0,this,N);return this.dataInputs.push(q),q}registerDataOutput(R,N){const q=new Mq(R,1,this,N);return this.dataOutputs.push(q),q}getDataInput(R){return this.dataInputs.find((N=>N.name===R))}getDataOutput(R){return this.dataOutputs.find((N=>N.name===R))}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};R.uniqueId=this.uniqueId,R.config={},this.config&&(R.config.name=this.config.name),R.dataInputs=[],R.dataOutputs=[],R.className=this.getClassName();for(const N of this.dataInputs){const q={};N.serialize(q),R.dataInputs.push(q)}for(const N of this.dataOutputs){const q={};N.serialize(q),R.dataOutputs.push(q)}}getClassName(){return"FGBlock"}static Parse(R,N){const q=v.i.Instantiate(R.className),w={},u=N.valueParseFunction??yq;if(R.config)for(const v in R.config)w[v]=u(v,R.config,N.Ke);var M;("FGSetPropertyBlock"===(M=R.className)||"FGGetPropertyBlock"===M||"FGPlayAnimationBlock"===M||"FGMeshPickEventBlock"===M)&&(w.pathConverter=N.pathConverter);const G=new q(w);G.uniqueId=R.uniqueId;for(let v=0;v<R.dataInputs.length;v++){const N=G.getDataInput(R.dataInputs[v].name);if(!N)throw new Error("Could not find data input with name "+R.dataInputs[v].name+" in block "+R.className);N.deserialize(R.dataInputs[v])}for(let v=0;v<R.dataOutputs.length;v++){const N=G.getDataOutput(R.dataOutputs[v].name);if(!N)throw new Error("Could not find data output with name "+R.dataOutputs[v].name+" in block "+R.className);N.deserialize(R.dataOutputs[v])}return G.metadata=R.metadata,G.deserialize&&G.deserialize(R),G}}class jq extends lN{_isSingularConnection(){return 1===this.connectionType}_activateSignal(R){var N;0===this.connectionType?(R._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(R,this),R._increaseExecutionId()):null===(N=this._connectedPoint[0])||void 0===N||N._activateSignal(R)}}(0,d.h)("FlowGraphSignalConnection",jq);class Fq extends aq{constructor(R){super(R),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(R){const N=new jq(R,0,this);return this.signalInputs.push(N),N}_registerSignalOutput(R){const N=new jq(R,1,this);return this.signalOutputs.push(N),N}getSignalInput(R){return this.signalInputs.find((N=>N.name===R))}getSignalOutput(R){return this.signalOutputs.find((N=>N.name===R))}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(R),R.signalInputs=[],R.signalOutputs=[];for(const N of this.signalInputs){const q={};N.serialize(q),R.signalInputs.push(q)}for(const N of this.signalOutputs){const q={};N.serialize(q),R.signalOutputs.push(q)}}deserialize(R){for(let N=0;N<R.signalInputs.length;N++){const q=this.getSignalInput(R.signalInputs[N].name);if(!q)throw new Error("Could not find signal input with name "+R.signalInputs[N].name+" in block "+R.className);q.deserialize(R.signalInputs[N])}for(let N=0;N<R.signalOutputs.length;N++){const q=this.getSignalOutput(R.signalOutputs[N].name);if(!q)throw new Error("Could not find signal output with name "+R.signalOutputs[N].name+" in block "+R.className);q.deserialize(R.signalOutputs[N])}}getClassName(){return"FGExecutionBlock"}}class Sq extends Fq{constructor(R){super(R),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(R){this._preparePendingTasks(R),R._addPendingBlock(this)}}class Hq extends Sq{_execute(R){R._notifyExecuteNode(this),this.out._activateSignal(R)}}class Wq{constructor(R){this.uniqueId=(0,BN.d)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new a.c,this._configuration=R}hasVariable(R){return R in this._userVariables}setVariable(R,N){this._userVariables[R]=N}getVariable(R){return this._userVariables[R]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(R,N){return`${R.uniqueId}_${N}`}_setExecutionVariable(R,N,q){this._executionVariables[this._getUniqueIdPrefixedName(R,N)]=q}_getExecutionVariable(R,N,q){return this._hasExecutionVariable(R,N)?this._executionVariables[this._getUniqueIdPrefixedName(R,N)]:q}_deleteExecutionVariable(R,N){delete this._executionVariables[this._getUniqueIdPrefixedName(R,N)]}_hasExecutionVariable(R,N){return this._getUniqueIdPrefixedName(R,N)in this._executionVariables}_hasConnectionValue(R){return R.uniqueId in this._connectionValues}_setConnectionValue(R,N){this._connectionValues[R.uniqueId]=N}_getConnectionValue(R){return this._connectionValues[R.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(R){this._pendingBlocks.push(R)}_removePendingBlock(R){const N=this._pendingBlocks.indexOf(R);-1!==N&&this._pendingBlocks.splice(N,1)}_clearPendingBlocks(){for(const R of this._pendingBlocks)R._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(R){this.onNodeExecutedObservable.notifyObservers(R)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},N=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Jq;R.uniqueId=this.uniqueId,R._userVariables={};for(const q in this._userVariables)N(q,this._userVariables[q],R._userVariables);R._connectionValues={};for(const q in this._connectionValues)N(q,this._connectionValues[q],R._connectionValues)}getClassName(){return"FGContext"}static Parse(R,N){const q=N.graph.createContext(),w=N.valueParseFunction??yq;q.uniqueId=R.uniqueId;for(const u in R._userVariables){const N=w(u,R._userVariables,q._configuration.Ke);q._userVariables[u]=N}for(const u in R._connectionValues){const N=w(u,R._connectionValues,q._configuration.Ke);q._connectionValues[u]=N}return q}}(0,K.b)([(0,r.E)()],Wq.prototype,"uniqueId",void 0);var kq,Cq,eq=q(1259);function Kq(R,N){return!(!R.parent||R.parent!==N&&!Kq(R.parent,N))}class rq extends Hq{constructor(R){super(R),this.config=R}_getReferencedMesh(){const R=this.config.pathConverter.convert(this.config.path),N=R.info.getObject(R.object);if(!N||!(N instanceof m.e))throw new Error("Mesh pick event block requires a valid mesh");return N}_preparePendingTasks(R){let N=R._getExecutionVariable(this,"meshPickObserver");if(!N){const q=this._getReferencedMesh();R._setExecutionVariable(this,"mesh",q),N=q.va().onPointerObservable.add((N=>{var w,u,M;N.type===eq.d.POINTERPICK&&null!==(w=N.pickInfo)&&void 0!==w&&w.pickedMesh&&((null===(u=N.pickInfo)||void 0===u?void 0:u.pickedMesh)===q||Kq(null===(M=N.pickInfo)||void 0===M?void 0:M.pickedMesh,q))&&this._execute(R)}));const w=q.Zd.add((()=>this._onDispose));R._setExecutionVariable(this,"meshPickObserver",N),R._setExecutionVariable(this,"meshDisposeObserver",w)}}_onDispose(R){this._cancelPendingTasks(R),R._removePendingBlock(this)}_cancelPendingTasks(R){const N=R._getExecutionVariable(this,"mesh"),q=R._getExecutionVariable(this,"meshPickObserver"),w=R._getExecutionVariable(this,"meshDisposeObserver");N.va().onPointerObservable.remove(q),N.Zd.remove(w),R._deleteExecutionVariable(this,"mesh"),R._deleteExecutionVariable(this,"meshPickObserver"),R._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return rq.ClassName}serialize(R){super.serialize(R),R.config.path=this.config.path}}rq.ClassName="FGMeshPickEventBlock",(0,d.h)(rq.ClassName,rq),function(R){R[R.Stopped=0]="Stopped",R[R.Started=1]="Started"}(kq||(kq={}));class Zq{constructor(R){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=R.Ke,this._coordinator=R.coordinator,this._sceneDisposeObserver=this._scene.Zd.add((()=>this.dispose()))}createContext(){const R=new Wq({Ke:this._scene,coordinator:this._coordinator});return this._executionContexts.push(R),R}getContext(R){return this._executionContexts[R]}addEventBlock(R){this._eventBlocks.push(R)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const R of this._executionContexts){const N=this._getContextualOrder();for(const q of N)q._startPendingTasks(R)}}}_getContextualOrder(){const R=[];for(const N of this._eventBlocks)if(N.getClassName()===rq.ClassName){const q=N._getReferencedMesh();let w=0;for(;w<R.length;w++){const N=R[w]._getReferencedMesh();if(q&&N&&Kq(q,N))break}R.splice(w,0,N)}else R.push(N);return R}dispose(){if(0!==this.state){this.state=0;for(const R of this._executionContexts)R._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.Zd.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(R){const N=[],q=new Set;for(const w of this._eventBlocks)N.push(w),q.add(w.uniqueId);for(;N.length>0;){const w=N.pop();R(w);for(const R of w.dataInputs)for(const w of R._connectedPoint)q.has(w._ownerBlock.uniqueId)||(N.push(w._ownerBlock),q.add(w._ownerBlock.uniqueId));if(w instanceof Fq)for(const R of w.signalOutputs)for(const w of R._connectedPoint)q.has(w._ownerBlock.uniqueId)||(N.push(w._ownerBlock),q.add(w._ownerBlock.uniqueId))}}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},N=arguments.length>1?arguments[1]:void 0;R.allBlocks=[],this.visitAllBlocks((N=>{const q={};N.serialize(q),R.allBlocks.push(q)})),R.executionContexts=[];for(const q of this._executionContexts){const w={};q.serialize(w,N),R.executionContexts.push(w)}}static GetDataOutConnectionByUniqueId(R,N){for(const q of R)for(const R of q.dataOutputs)if(R.uniqueId===N)return R;throw new Error("Could not find data out connection with unique id "+N)}static GetSignalInConnectionByUniqueId(R,N){for(const q of R)if(q instanceof Fq)for(const R of q.signalInputs)if(R.uniqueId===N)return R;throw new Error("Could not find signal in connection with unique id "+N)}static Parse(R,N){const q=N.coordinator.createGraph(),w=[],u=N.valueParseFunction??yq;for(const M of R.allBlocks){const R=aq.Parse(M,{Ke:N.coordinator.config.Ke,pathConverter:N.pathConverter,valueParseFunction:u});w.push(R),R instanceof Hq&&q.addEventBlock(R)}for(const M of w){for(const R of M.dataInputs)for(const N of R.connectedPointIds){const q=Zq.GetDataOutConnectionByUniqueId(w,N);R.connectTo(q)}if(M instanceof Fq)for(const R of M.signalOutputs)for(const N of R.connectedPointIds){const q=Zq.GetSignalInConnectionByUniqueId(w,N);R.connectTo(q)}}for(const M of R.executionContexts)Wq.Parse(M,{graph:q,valueParseFunction:u});return q}}class zq{constructor(R){this.config=R,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Ke.Zd.add((()=>{this.dispose()}));(zq.SceneCoordinators.get(this.config.Ke)??[]).push(this)}createGraph(){const R=new Zq({Ke:this.config.Ke,coordinator:this});return this._flowGraphs.push(R),R}removeGraph(R){const N=this._flowGraphs.indexOf(R);-1!==N&&(R.dispose(),this._flowGraphs.splice(N,1))}start(){this._flowGraphs.forEach((R=>R.start()))}dispose(){this._flowGraphs.forEach((R=>R.dispose())),this._flowGraphs.length=0;const R=zq.SceneCoordinators.get(this.config.Ke)??[],N=R.indexOf(this);-1!==N&&R.splice(N,1)}serialize(R,N){R._flowGraphs=[],this._flowGraphs.forEach((q=>{const w={};q.serialize(w,N),R._flowGraphs.push(w)}))}static Parse(R,N){var q;const w=N.valueParseFunction??yq,u=new zq({Ke:N.Ke});return null===(q=R._flowGraphs)||void 0===q||q.forEach((R=>{Zq.Parse(R,{coordinator:u,valueParseFunction:w,pathConverter:N.pathConverter})})),u}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(R){let N=this._customEventsMap.get(R);return N||(N=new a.c,this._customEventsMap.set(R,N)),N}notifyCustomEvent(R,N){const q=this._customEventsMap.get(R);q&&q.notifyObservers(N)}}zq.SceneCoordinators=new Map;class dq extends Hq{_preparePendingTasks(R){if(!R._getExecutionVariable(this,"sceneReadyObserver")){const N=R.configuration.Ke.onReadyObservable.add((()=>{this._execute(R)}));R._setExecutionVariable(this,"sceneReadyObserver",N)}}_cancelPendingTasks(R){const N=R._getExecutionVariable(this,"sceneReadyObserver");R.configuration.Ke.onReadyObservable.remove(N),R._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return dq.ClassName}}dq.ClassName="FGSceneReadyEventBlock",(0,d.h)("FGSceneReadyEventBlock",dq);class xq extends Hq{_preparePendingTasks(R){if(!R._getExecutionVariable(this,"sceneBeforeRender")){const N=R.configuration.Ke.onBeforeRenderObservable.add((()=>{this._execute(R)}));R._setExecutionVariable(this,"sceneBeforeRender",N)}}_cancelPendingTasks(R){const N=R._getExecutionVariable(this,"sceneBeforeRender");R.configuration.Ke.onBeforeRenderObservable.remove(N),R._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return xq.ClassName}}xq.ClassName="FGSceneTickEventBlock",(0,d.h)(xq.ClassName,xq);class Eq extends Fq{constructor(R){super(R),this.out=this._registerSignalOutput("out")}}class Pq extends Eq{constructor(R){super(R),this.message=this.registerDataInput("message",DN)}_execute(R){const N=this.message.getValue(R);W.e.Log(N),this.out._activateSignal(R)}getClassName(){return Pq.ClassName}}Pq.ClassName="FGConsoleLogBlock",(0,d.h)(Pq.ClassName,Pq),function(R){R[R.INIT=0]="INIT",R[R.STARTED=1]="STARTED",R[R.ENDED=2]="ENDED"}(Cq||(Cq={}));class sq{constructor(R){this.onEachCountObservable=new a.c,this.onTimerAbortedObservable=new a.c,this.onTimerEndedObservable=new a.c,this.onStateChangedObservable=new a.c,this._observer=null,this._breakOnNextTick=!1,this._tick=R=>{const N=Date.now();this._timer=N-this._startTime;const q={startTime:this._startTime,currentTime:N,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:R},w=this._breakOnNextTick||this._breakCondition(q);w||this._timer>=this._timeToEnd?this._stop(q,w):this.onEachCountObservable.notifyObservers(q)},this._setState(0),this._contextObservable=R.contextObservable,this._observableParameters=R.observableParameters??{},this._breakCondition=R.breakCondition??(()=>!1),this._timeToEnd=R.timeout,R.onEnded&&this.onTimerEndedObservable.add(R.onEnded),R.ri&&this.onEachCountObservable.add(R.ri),R.onAborted&&this.onTimerAbortedObservable.add(R.onAborted)}set breakCondition(R){this._breakCondition=R}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=R,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(R){this._state=R,this.onStateChangedObservable.notifyObservers(this._state)}_stop(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),N?this.onTimerAbortedObservable.notifyObservers(R):this.onTimerEndedObservable.notifyObservers(R)}}class Oq extends Sq{constructor(R){super(R),this.timeout=this.registerDataInput("timeout",pN)}_preparePendingTasks(R){const N=this.timeout.getValue(R);if(void 0!==N&&N>=0){const q=R._getExecutionVariable(this,"runningTimers")||[],w=R.configuration.Ke,u=new sq({timeout:N,contextObservable:w.onBeforeRenderObservable,onEnded:()=>this._onEnded(u,R)});u.start(),q.push(u),R._setExecutionVariable(this,"runningTimers",q)}}_execute(R){this._startPendingTasks(R),this.out._activateSignal(R)}_onEnded(R,N){const q=N._getExecutionVariable(this,"runningTimers")||[],w=q.indexOf(R);-1!==w?q.splice(w,1):v.i.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),N._removePendingBlock(this),this.done._activateSignal(N)}_cancelPendingTasks(R){const N=R._getExecutionVariable(this,"runningTimers")||[];for(const q of N)q.dispose();R._deleteExecutionVariable(this,"runningTimers")}getClassName(){return Oq.ClassName}}Oq.ClassName="FGTimerBlock",(0,d.h)("FGTimerBlock",Oq);class Lq extends Eq{constructor(R){super(R),this.config=R;for(let N=0;N<this.config.eventData.length;N++){const R=this.config.eventData[N];this.registerDataInput(R,DN)}}_execute(R){const N=this.config.eventId,q=this.dataInputs.map((N=>N.getValue(R)));R.configuration.coordinator.notifyCustomEvent(N,q),this.out._activateSignal(R)}getClassName(){return Lq.ClassName}}Lq.ClassName="FGSendCustomEventBlock",(0,d.h)("FGSendCustomEventBlock",Lq);class mq extends Hq{constructor(R){super(R),this.config=R;for(let N=0;N<this.config.eventData.length;N++){const R=this.config.eventData[N];this.registerDataOutput(R,DN)}}_preparePendingTasks(R){const N=R.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=N.add((N=>{for(let q=0;q<N.length;q++)this.dataOutputs[q].setValue(N[q],R);this._execute(R)}))}_cancelPendingTasks(R){const N=R.configuration.coordinator.getCustomEventObservable(this.config.eventId);N?N.remove(this._eventObserver):v.i.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return mq.ClassName}serialize(R){super.serialize(R),R.eventId=this.config.eventId,R.eventData=this.config.eventData}}mq.ClassName="FGReceiveCustomEventBlock",(0,d.h)(mq.ClassName,mq);class oq extends Fq{constructor(R){super(R),this.config=R,this.outFlows=[];for(let N=0;N<this.config.numberOutputFlows;N++)this.outFlows.push(this._registerSignalOutput(`${N}`))}_execute(R){for(let N=0;N<this.config.numberOutputFlows;N++)this.outFlows[N]._activateSignal(R)}getClassName(){return oq.ClassName}}oq.ClassName="FGSequenceBlock",(0,d.h)(oq.ClassName,oq);const Aq=new RegExp(/\{(\w+)\}/g);class nq{constructor(R,N){this.path=R,this.ownerBlock=N,this.templatedInputs=[];let q=Aq.exec(R);for(;q;){const[,w]=q;this.templatedInputs.push(N.registerDataInput(w,uq)),q=Aq.exec(R)}}getAccessor(R,N){let q=this.path;for(const w of this.templatedInputs){const R=w.getValue(N).value;q=q.replace(`{${w.name}}`,R.toString())}return R.convert(q)}}class Qq extends aq{constructor(R){super(R),this.config=R,this.value=this.registerDataOutput("value",DN),this.templateComponent=new nq(R.path,this)}_updateOutputs(R){const N=this.templateComponent.getAccessor(this.config.pathConverter,R),q=N.info.get(N.object);this.value.setValue(q,R)}getClassName(){return Qq.ClassName}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(R),R.config.path=this.config.path}}Qq.ClassName="FGGetPropertyBlock",(0,d.h)(Qq.ClassName,Qq);class Yq extends Eq{constructor(R){super(R),this.config=R,this.a=this.registerDataInput("a",DN),this.templateComponent=new nq(R.path,this)}_execute(R){const N=this.a.getValue(R),q=this.templateComponent.getAccessor(this.config.pathConverter,R);q.info.set(N,q.object),this.out._activateSignal(R)}serialize(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(R),R.config.path=this.config.path}getClassName(){return Yq.ClassName}}Yq.ClassName="FGSetPropertyBlock",(0,d.h)("FGSetPropertyBlock",Yq);const Tq="cachedOperationValue",fq="cachedExecutionId";class cq extends aq{constructor(R,N){super(N),this.value=this.registerDataOutput("value",R)}_updateOutputs(R){const N=R._getExecutionVariable(this,fq),q=R._getExecutionVariable(this,Tq);if(void 0!==q&&N===R.executionId)this.value.setValue(q,R);else{const N=this._doOperation(R);R._setExecutionVariable(this,Tq,N),R._setExecutionVariable(this,fq,R.executionId),this.value.setValue(N,R)}}}class bq extends cq{constructor(R,N,q,w,u,M){super(q,M),this._operation=w,this._className=u,this.a=this.registerDataInput("a",R),this.b=this.registerDataInput("b",N)}_doOperation(R){return this._operation(this.a.getValue(R),this.b.getValue(R))}getClassName(){return this._className}}class Iq extends cq{constructor(R,N,q,w){super(R,w),this._operation=N,this._className=q}_doOperation(R){return this._operation()}getClassName(){return this._className}}class Vq extends cq{constructor(R,N,q,w,u){super(N,u),this._operation=q,this._className=w,this.a=this.registerDataInput("a",R)}_doOperation(R){return this._operation(this.a.getValue(R))}getClassName(){return this._className}}class tq extends cq{constructor(R,N,q,w,u,M,v){super(w,v),this._operation=u,this._className=M,this.a=this.registerDataInput("a",R),this.b=this.registerDataInput("b",N),this.c=this.registerDataInput("c",q)}_doOperation(R){return this._operation(this.a.getValue(R),this.b.getValue(R),this.c.getValue(R))}getClassName(){return this._className}}function iq(R){return R.getClassName?R.getClassName():""}function gq(R,N){return"Vector2"===R&&"Vector2"===N||"Od"===R&&"Od"===N||"Vector4"===R&&"Vector4"===N}function Uq(R,N){return"Matrix"===R&&"Matrix"===N}function Bq(R,N){return"FlowGraphInteger"===R&&"FlowGraphInteger"===N}class lq extends bq{constructor(R){super(DN,DN,DN,((R,N)=>this._polymorphicAdd(R,N)),lq.ClassName,R)}_polymorphicAdd(R,N){const q=iq(R),w=iq(N);return gq(q,w)||Uq(q,w)||Bq(q,w)?R.add(N):R+N}}lq.ClassName="FGAddBlock",(0,d.h)(lq.ClassName,lq);class Xq extends bq{constructor(R){super(DN,DN,DN,((R,N)=>this._polymorphicAdd(R,N)),Xq.ClassName,R)}_polymorphicAdd(R,N){const q=iq(R),w=iq(N);return gq(q,w)||Bq(q,w)?R.Vc(N):Uq(q,w)?R.add(N.scale(-1)):R-N}}Xq.ClassName="FGSubBlock",(0,d.h)(Xq.ClassName,Xq);class hq extends bq{constructor(R){super(DN,DN,DN,((R,N)=>this._polymorphicMultiply(R,N)),hq.ClassName,R)}_polymorphicMultiply(R,N){const q=iq(R),w=iq(N);return gq(q,w)||Bq(q,w)?R.multiply(N):Uq(q,w)?u.c.FromValues(R.m[0]*N.m[0],R.m[4]*N.m[4],R.m[8]*N.m[8],R.m[12]*N.m[12],R.m[1]*N.m[1],R.m[5]*N.m[5],R.m[9]*N.m[9],R.m[13]*N.m[13],R.m[2]*N.m[2],R.m[6]*N.m[6],R.m[10]*N.m[10],R.m[14]*N.m[14],R.m[3]*N.m[3],R.m[7]*N.m[7],R.m[11]*N.m[11],R.m[15]*N.m[15]):R*N}}hq.ClassName="FGMultiplyBlock",(0,d.h)(hq.ClassName,hq);class Dq extends bq{constructor(R){super(DN,DN,DN,((R,N)=>this._polymorphicDivide(R,N)),Dq.ClassName,R)}_polymorphicDivide(R,N){const q=iq(R),w=iq(N);return gq(q,w)||Bq(q,w)?R.divide(N):Uq(q,w)?u.c.FromValues(R.m[0]/N.m[0],R.m[4]/N.m[4],R.m[8]/N.m[8],R.m[12]/N.m[12],R.m[1]/N.m[1],R.m[5]/N.m[5],R.m[9]/N.m[9],R.m[13]/N.m[13],R.m[2]/N.m[2],R.m[6]/N.m[6],R.m[10]/N.m[10],R.m[14]/N.m[14],R.m[3]/N.m[3],R.m[7]/N.m[7],R.m[11]/N.m[11],R.m[15]/N.m[15]):R/N}}Dq.ClassName="FGDivideBlock",(0,d.h)(Dq.ClassName,Dq);class pq extends Iq{constructor(R){super(pN,(()=>Math.random()),pq.ClassName,R)}}pq.ClassName="FGRandomBlock",(0,d.h)(pq.ClassName,pq);class Rw extends bq{constructor(R){super(DN,DN,pN,((R,N)=>this._polymorphicDot(R,N)),Rw.ClassName,R)}_polymorphicDot(R,N){switch(iq(R)){case"Vector2":return u.j.Dot(R,N);case"Od":return u.m.Dot(R,N);case"Vector4":return u.n.Dot(R,N);default:throw new Error(`Cannot get dot product of ${R} and ${N}`)}}}Rw.ClassName="FGDotBlock",(0,d.h)(Rw.ClassName,Rw);class Nw extends Iq{constructor(R){super(pN,(()=>Math.E),Nw.ClassName,R)}}Nw.ClassName="FGEBlock",(0,d.h)(Nw.ClassName,Nw);class qw extends Iq{constructor(R){super(pN,(()=>Math.PI),qw.ClassName,R)}}qw.ClassName="FGPIBlock",(0,d.h)(qw.ClassName,qw);class ww extends Iq{constructor(R){super(pN,(()=>Number.POSITIVE_INFINITY),ww.ClassName,R)}}ww.ClassName="FGInfBlock",(0,d.h)(ww.ClassName,ww);class uw extends Iq{constructor(R){super(pN,(()=>Number.NaN),uw.ClassName,R)}}function Mw(R,N){switch(iq(R)){case"FlowGraphInteger":return new XN(N(R.value));case"Vector2":return new u.j(N(R.x),N(R.y));case"Od":return new u.m(N(R.x),N(R.y),N(R.z));case"Vector4":return new u.n(N(R.x),N(R.y),N(R.z),N(R.w));case"Matrix":return u.c.FromValues(N(R.m[0]),N(R.m[4]),N(R.m[8]),N(R.m[12]),N(R.m[1]),N(R.m[5]),N(R.m[9]),N(R.m[13]),N(R.m[2]),N(R.m[6]),N(R.m[10]),N(R.m[14]),N(R.m[3]),N(R.m[7]),N(R.m[11]),N(R.m[15]));default:return N(R)}}uw.ClassName="FGNaNBlock",(0,d.h)(uw.ClassName,uw);class vw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicAbs(R)),vw.ClassName,R)}_polymorphicAbs(R){return Mw(R,Math.abs)}}vw.ClassName="FGAbsBlock",(0,d.h)(vw.ClassName,vw);class Gw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicSign(R)),Gw.ClassName,R)}_polymorphicSign(R){return Mw(R,Math.sign)}}Gw.ClassName="FGSignBlock",(0,d.h)(Gw.ClassName,Gw);class Jw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicTrunc(R)),Jw.ClassName,R)}_polymorphicTrunc(R){return Mw(R,Math.trunc)}}Jw.ClassName="FGTruncBlock",(0,d.h)(Jw.ClassName,Jw);class yw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicFloor(R)),yw.ClassName,R)}_polymorphicFloor(R){return Mw(R,Math.floor)}}yw.ClassName="FGFloorBlock",(0,d.h)(yw.ClassName,yw);class aw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicCeiling(R)),aw.ClassName,R)}_polymorphicCeiling(R){return Mw(R,Math.ceil)}}aw.ClassName="FGCeilBlock",(0,d.h)(aw.ClassName,aw);class jw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicFract(R)),jw.ClassName,R)}_polymorphicFract(R){return Mw(R,(R=>R-Math.floor(R)))}}jw.ClassName="FGFractBlock",(0,d.h)(jw.ClassName,jw);class Fw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicNeg(R)),Fw.ClassName,R)}_polymorphicNeg(R){return Mw(R,(R=>-R))}}function Sw(R,N,q){switch(iq(R)){case"FlowGraphInteger":return new XN(q(R.value,N.value));case"Vector2":return new u.j(q(R.x,N.x),q(R.y,N.y));case"Od":return new u.m(q(R.x,N.x),q(R.y,N.y),q(R.z,N.z));case"Vector4":return new u.n(q(R.x,N.x),q(R.y,N.y),q(R.z,N.z),q(R.w,N.w));case"Matrix":return u.c.FromValues(q(R.m[0],N.m[0]),q(R.m[4],N.m[4]),q(R.m[8],N.m[8]),q(R.m[12],N.m[12]),q(R.m[1],N.m[1]),q(R.m[5],N.m[5]),q(R.m[9],N.m[9]),q(R.m[13],N.m[13]),q(R.m[2],N.m[2]),q(R.m[6],N.m[6]),q(R.m[10],N.m[10]),q(R.m[14],N.m[14]),q(R.m[3],N.m[3]),q(R.m[7],N.m[7]),q(R.m[11],N.m[11]),q(R.m[15],N.m[15]));default:return q(R,N)}}Fw.ClassName="FGNegBlock",(0,d.h)(Fw.ClassName,Fw);class Hw extends bq{constructor(R){super(DN,DN,DN,((R,N)=>this._polymorphicRemainder(R,N)),Hw.ClassName,R)}_polymorphicRemainder(R,N){return Sw(R,N,((R,N)=>R%N))}}Hw.ClassName="FGRemainderBlock",(0,d.h)(Hw.ClassName,Hw);class Ww extends bq{constructor(R){super(DN,DN,DN,((R,N)=>this._polymorphicMin(R,N)),Ww.ClassName,R)}_polymorphicMin(R,N){return Sw(R,N,Math.min)}}Ww.ClassName="FGMinBlock",(0,d.h)(Ww.ClassName,Ww);class kw extends bq{constructor(R){super(DN,DN,DN,((R,N)=>this._polymorphicMax(R,N)),kw.ClassName,R)}_polymorphicMax(R,N){return Sw(R,N,Math.max)}}function Cw(R,N,q){return Math.min(Math.max(R,Math.min(N,q)),Math.max(N,q))}function ew(R,N,q,w){switch(iq(R)){case"FlowGraphInteger":return new XN(w(R.value,N.value,q.value));case"Vector2":return new u.j(w(R.x,N.x,q.x),w(R.y,N.y,q.y));case"Od":return new u.m(w(R.x,N.x,q.x),w(R.y,N.y,q.y),w(R.z,N.z,q.z));case"Vector4":return new u.n(w(R.x,N.x,q.x),w(R.y,N.y,q.y),w(R.z,N.z,q.z),w(R.w,N.w,q.w));case"Matrix":return u.c.FromValues(w(R.m[0],N.m[0],q.m[0]),w(R.m[4],N.m[4],q.m[4]),w(R.m[8],N.m[8],q.m[8]),w(R.m[12],N.m[12],q.m[12]),w(R.m[1],N.m[1],q.m[1]),w(R.m[5],N.m[5],q.m[5]),w(R.m[9],N.m[9],q.m[9]),w(R.m[13],N.m[13],q.m[13]),w(R.m[2],N.m[2],q.m[2]),w(R.m[6],N.m[6],q.m[6]),w(R.m[10],N.m[10],q.m[10]),w(R.m[14],N.m[14],q.m[14]),w(R.m[3],N.m[3],q.m[3]),w(R.m[7],N.m[7],q.m[7]),w(R.m[11],N.m[11],q.m[11]),w(R.m[15],N.m[15],q.m[15]));default:return w(R,N,q)}}kw.ClassName="FGMaxBlock",(0,d.h)(kw.ClassName,kw);class Kw extends tq{constructor(R){super(DN,DN,DN,DN,((R,N,q)=>this._polymorphicClamp(R,N,q)),Kw.ClassName,R)}_polymorphicClamp(R,N,q){return ew(R,N,q,Cw)}}function rw(R){return Math.min(Math.max(R,0),1)}Kw.ClassName="FGClampBlock",(0,d.h)(Kw.ClassName,Kw);class Zw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicSaturate(R)),Zw.ClassName,R)}_polymorphicSaturate(R){return Mw(R,rw)}}Zw.ClassName="FGSaturateBlock",(0,d.h)(Zw.ClassName,Zw);class zw extends tq{constructor(R){super(DN,DN,DN,DN,((R,N,q)=>this._polymorphicInterpolate(R,N,q)),zw.ClassName,R)}_interpolate(R,N,q){return(1-q)*R+q*N}_polymorphicInterpolate(R,N,q){return ew(R,N,q,this._interpolate)}}zw.ClassName="FGInterpolateBlock",(0,d.h)(zw.ClassName,zw);class dw extends bq{constructor(R){super(DN,DN,Rq,((R,N)=>this._polymorphicEq(R,N)),dw.ClassName,R)}_polymorphicEq(R,N){const q=iq(R),w=iq(N);return gq(q,w)||Uq(q,w)||Bq(q,w)?R.equals(N):R===N}}function xw(R,N,q){const w=iq(R);if(w===iq(N)){if(""===w)return q(R,N);if("FlowGraphInteger"===w)return q(R.value,N.value);throw new Error(`Cannot compare ${R} and ${N}`)}throw new Error(`${R} and ${N} are of different types.`)}dw.ClassName="FGEqBlock",(0,d.h)(dw.ClassName,dw);class Ew extends bq{constructor(R){super(DN,DN,Rq,((R,N)=>this._polymorphicLessThan(R,N)),Ew.ClassName,R)}_polymorphicLessThan(R,N){return xw(R,N,((R,N)=>R<N))}}Ew.ClassName="FGLessThanBlock",(0,d.h)(Ew.ClassName,Ew);class Pw extends bq{constructor(R){super(DN,DN,Rq,((R,N)=>this._polymorphicLessThanOrEqual(R,N)),Pw.ClassName,R)}_polymorphicLessThanOrEqual(R,N){return xw(R,N,((R,N)=>R<=N))}}Pw.ClassName="FGLessThanOrEqualBlock";class sw extends bq{constructor(R){super(DN,DN,Rq,((R,N)=>this._polymorphicGreaterThan(R,N)),sw.ClassName,R)}_polymorphicGreaterThan(R,N){return xw(R,N,((R,N)=>R>N))}}sw.ClassName="FGGreaterThanBlock",(0,d.h)(sw.ClassName,sw);class Ow extends bq{constructor(R){super(DN,DN,Rq,((R,N)=>this._polymorphicGreaterThanOrEqual(R,N)),Ow.ClassName,R)}_polymorphicGreaterThanOrEqual(R,N){return xw(R,N,((R,N)=>R>=N))}}Ow.ClassName="FGGreaterThanOrEqualBlock",(0,d.h)(Ow.ClassName,Ow);class Lw extends Vq{constructor(R){super(DN,Rq,(R=>this._polymorphicIsNan(R)),Lw.ClassName,R)}_polymorphicIsNan(R){const N=iq(R);if(""===N)return isNaN(R);if("FlowGraphInteger"===N)return isNaN(R.value);throw new Error(`Cannot get NaN of ${R}`)}}Lw.ClassName="FGIsNanBlock",(0,d.h)(Lw.ClassName,Lw);class mw extends Vq{constructor(R){super(DN,Rq,(R=>this._polymorphicIsInf(R)),mw.ClassName,R)}_polymorphicIsInf(R){const N=iq(R);if(""===N)return!isFinite(R);if("FlowGraphInteger"===N)return!isFinite(R.value);throw new Error(`Cannot get isInf of ${R}`)}}mw.ClassName="FGIsInfBlock";class ow extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicDegToRad(R)),ow.ClassName,R)}_degToRad(R){return R*Math.PI/180}_polymorphicDegToRad(R){return Mw(R,this._degToRad)}}ow.ClassName="FGDegToRadBlock",(0,d.h)(ow.ClassName,ow);class Aw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicRadToDeg(R)),Aw.ClassName,R)}_radToDeg(R){return 180*R/Math.PI}_polymorphicRadToDeg(R){return Mw(R,this._radToDeg)}}Aw.ClassName="FGRadToDegBlock",(0,d.h)(Aw.ClassName,Aw);class nw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicSin(R)),nw.ClassName,R)}_polymorphicSin(R){return Mw(R,Math.sin)}}nw.ClassName="FGSinBlock",(0,d.h)(nw.ClassName,nw);class Qw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicCos(R)),Qw.ClassName,R)}_polymorphicCos(R){return Mw(R,Math.cos)}}Qw.ClassName="FGCosBlock",(0,d.h)(Qw.ClassName,Qw);class Yw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicTan(R)),Yw.ClassName,R)}_polymorphicTan(R){return Mw(R,Math.tan)}}Yw.ClassName="FGTanBlock",(0,d.h)(Yw.ClassName,Yw);class Tw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicAsin(R)),Tw.ClassName,R)}_polymorphicAsin(R){return Mw(R,Math.asin)}}Tw.ClassName="FGAsinBlock",(0,d.h)(Tw.ClassName,Tw);class fw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicAcos(R)),fw.ClassName,R)}_polymorphicAcos(R){return Mw(R,Math.acos)}}fw.ClassName="FGAcosBlock",(0,d.h)(fw.ClassName,fw);class cw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicAtan(R)),cw.ClassName,R)}_polymorphicAtan(R){return Mw(R,Math.atan)}}cw.ClassName="FGAtanBlock",(0,d.h)(cw.ClassName,cw);class bw extends bq{constructor(R){super(DN,DN,DN,((R,N)=>this._polymorphicAtan2(R,N)),bw.ClassName,R)}_polymorphicAtan2(R,N){return Sw(R,N,Math.atan2)}}bw.ClassName="FGAtan2Block",(0,d.h)(bw.ClassName,bw);class Iw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicSinh(R)),Iw.ClassName,R)}_polymorphicSinh(R){return Mw(R,Math.sinh)}}Iw.ClassName="FGSinhBlock",(0,d.h)(Iw.ClassName,Iw);class Vw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicCosh(R)),Vw.ClassName,R)}_polymorphicCosh(R){return Mw(R,Math.cosh)}}Vw.ClassName="FGCoshBlock",(0,d.h)(Vw.ClassName,Vw);class tw extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicTanh(R)),tw.ClassName,R)}_polymorphicTanh(R){return Mw(R,Math.tanh)}}tw.ClassName="FGTanhBlock",(0,d.h)(tw.ClassName,tw);class iw extends Vq{constructor(R){super(DN,pN,(R=>this._polymorphicAsinh(R)),iw.ClassName,R)}_polymorphicAsinh(R){return Mw(R,Math.asinh)}}iw.ClassName="FGAsinhBlock",(0,d.h)(iw.ClassName,iw);class gw extends Vq{constructor(R){super(DN,pN,(R=>this._polymorphicAcosh(R)),gw.ClassName,R)}_polymorphicAcosh(R){return Mw(R,Math.acosh)}}gw.ClassName="FGAcoshBlock",(0,d.h)(gw.ClassName,gw);class Uw extends Vq{constructor(R){super(DN,pN,(R=>this._polymorphicAtanh(R)),Uw.ClassName,R)}_polymorphicAtanh(R){return Mw(R,Math.atanh)}}Uw.ClassName="FGAtanhBlock",(0,d.h)(Uw.ClassName,Uw);class Bw extends Vq{constructor(R){super(DN,pN,(R=>this._polymorphicExp(R)),Bw.ClassName,R)}_polymorphicExp(R){return Mw(R,Math.exp)}}Bw.ClassName="FGExpBlock",(0,d.h)(Bw.ClassName,Bw);class lw extends Vq{constructor(R){super(DN,pN,(R=>this._polymorphicLog(R)),lw.ClassName,R)}_polymorphicLog(R){return Mw(R,Math.log)}}lw.ClassName="FGLogBlock",(0,d.h)(lw.ClassName,lw);class Xw extends Vq{constructor(R){super(DN,pN,(R=>this._polymorphicLog2(R)),Xw.ClassName,R)}_polymorphicLog2(R){return Mw(R,Math.log2)}}Xw.ClassName="FGLog2Block",(0,d.h)(Xw.ClassName,Xw);class hw extends Vq{constructor(R){super(DN,pN,(R=>this._polymorphicLog10(R)),hw.ClassName,R)}_polymorphicLog10(R){return Mw(R,Math.log10)}}hw.ClassName="FGLog10Block",(0,d.h)(hw.ClassName,hw);class Dw extends Vq{constructor(R){super(DN,pN,(R=>this._polymorphicSqrt(R)),Dw.ClassName,R)}_polymorphicSqrt(R){return Mw(R,Math.sqrt)}}Dw.ClassName="FGSqrtBlock",(0,d.h)(Dw.ClassName,Dw);class pw extends Vq{constructor(R){super(DN,pN,(R=>this._polymorphicCubeRoot(R)),pw.ClassName,R)}_polymorphicCubeRoot(R){return Mw(R,Math.cbrt)}}pw.ClassName="FGCubeRootBlock",(0,d.h)(pw.ClassName,pw);class Ru extends bq{constructor(R){super(DN,pN,pN,((R,N)=>this._polymorphicPow(R,N)),Ru.ClassName,R)}_polymorphicPow(R,N){return Sw(R,N,Math.pow)}}Ru.ClassName="FGPowBlock",(0,d.h)(Ru.ClassName,Ru);class Nu extends Vq{constructor(R){super(DN,pN,(R=>this._polymorphicLength(R)),Nu.ClassName,R)}_polymorphicLength(R){switch(iq(R)){case"Vector2":case"Od":case"Vector4":return R.length();default:throw new Error(`Cannot compute length of value ${R}`)}}}Nu.ClassName="FGLengthBlock",(0,d.h)(Nu.ClassName,Nu);class qu extends Vq{constructor(R){super(DN,DN,(R=>this._polymorphicNormalize(R)),qu.ClassName,R)}_polymorphicNormalize(R){switch(iq(R)){case"Vector2":case"Od":case"Vector4":return R.normalize();default:throw new Error(`Cannot normalize value ${R}`)}}}qu.ClassName="FGNormalizeBlock",(0,d.h)(qu.ClassName,qu);class wu extends bq{constructor(R){super(qq,qq,qq,((R,N)=>u.m.Cross(R,N)),wu.ClassName,R)}}wu.ClassName="FGCrossBlock",(0,d.h)(wu.ClassName,wu);class uu extends bq{constructor(R){super(Nq,pN,Nq,((R,N)=>u.j.Transform(R,u.c.RotationZ(N))),uu.ClassName,R)}}uu.ClassName="FGRotate2DBlock",(0,d.h)(uu.ClassName,uu);class Mu extends tq{constructor(R){super(qq,qq,pN,qq,((R,N,q)=>u.m.TransformCoordinates(R,u.c.RotationAxis(N,q))),Mu.ClassName,R)}}Mu.ClassName="FGRotate3DBlock",(0,d.h)(Mu.ClassName,Mu);class vu extends Vq{constructor(R){super(wq,wq,(R=>u.c.Transpose(R)),vu.ClassName,R)}}vu.ClassName="FGTransposeBlock",(0,d.h)(vu.ClassName,vu);class Gu extends Vq{constructor(R){super(wq,pN,(R=>R.determinant()),Gu.ClassName,R)}}Gu.ClassName="FGDeterminantBlock",(0,d.h)(Gu.ClassName,Gu);class Ju extends Vq{constructor(R){super(wq,wq,(R=>u.c.Invert(R)),Ju.ClassName,R)}}Ju.ClassName="FGInvertMatrixBlock",(0,d.h)(Ju.ClassName,Ju);class yu extends bq{constructor(R){super(wq,wq,wq,((R,N)=>N.multiply(R)),yu.ClassName,R)}}yu.ClassName="FGMatMulBlock",(0,d.h)(yu.ClassName,yu);class au extends Vq{constructor(R){super(uq,uq,(R=>new XN(~R.value)),au.ClassName,R)}}au.ClassName="FGBitwiseNotBlock",(0,d.h)(au.ClassName,au);class ju extends bq{constructor(R){super(uq,uq,uq,((R,N)=>new XN(R.value&N.value)),ju.ClassName,R)}}ju.ClassName="FGBitwiseAndBlock",(0,d.h)(ju.ClassName,ju);class Fu extends bq{constructor(R){super(uq,uq,uq,((R,N)=>new XN(R.value|N.value)),Fu.ClassName,R)}}Fu.ClassName="FGBitwiseOrBlock",(0,d.h)(Fu.ClassName,Fu);class Su extends bq{constructor(R){super(uq,uq,uq,((R,N)=>new XN(R.value^N.value)),Su.ClassName,R)}}Su.ClassName="FGBitwiseXorBlock",(0,d.h)(Su.ClassName,Su);class Hu extends bq{constructor(R){super(uq,uq,uq,((R,N)=>new XN(R.value<<N.value)),Hu.ClassName,R)}}Hu.ClassName="FGBitwiseLeftShiftBlock",(0,d.h)(Hu.ClassName,Hu);class Wu extends bq{constructor(R){super(uq,uq,uq,((R,N)=>new XN(R.value>>N.value)),Wu.ClassName,R)}}Wu.ClassName="FGBitwiseRightShiftBlock",(0,d.h)(Wu.ClassName,Wu);class ku extends Vq{constructor(R){super(uq,uq,(R=>new XN(Math.clz32(R.value))),ku.ClassName,R)}}ku.ClassName="FGCountLeadingZerosBlock",(0,d.h)(ku.ClassName,ku);class Cu extends Vq{constructor(R){super(uq,uq,(R=>new XN(R.value?31-Math.clz32(R.value&-R.value):32)),Cu.ClassName,R)}}Cu.ClassName="FGCountTrailingZerosBlock",(0,d.h)(Cu.ClassName,Cu);class eu extends Vq{constructor(R){super(uq,uq,(R=>new XN(function(R){let N=0;for(;R;)N+=1&R,R>>=1;return N}(R.value))),eu.ClassName,R)}}eu.ClassName="FGCountOneBitsBlock",(0,d.h)(eu.ClassName,eu);class Ku extends Eq{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new XN(0)};super(R),this.config=R,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",uq),this.value=this.registerDataOutput("value",uq)}_execute(R,N){if(N===this.reset)this.value.setValue(this.config.startIndex,R);else{const N=this.value.getValue(R);N.value<this.n.getValue(R).value&&(this.value.setValue(new XN(N.value+1),R),this.out._activateSignal(R))}}getClassName(){return Ku.ClassName}}Ku.ClassName="FGDoNBlock",(0,d.h)(Ku.ClassName,Ku);class ru extends aq{constructor(R){super(R),this.config=R,this.output=this.registerDataOutput(R.variableName,DN)}_updateOutputs(R){const N=this.config.variableName;R.hasVariable(N)&&this.output.setValue(R.getVariable(N),R)}getClassName(){return ru.ClassName}serialize(R){super.serialize(R),R.config.variableName=this.config.variableName}}ru.ClassName="FGGetVariableBlock",(0,d.h)(ru.ClassName,ru);class Zu extends Eq{constructor(R){super(R),this.config=R,this.input=this.registerDataInput(R.variableName,DN)}_execute(R){const N=this.config.variableName,q=this.input.getValue(R);R.setVariable(N,q),this.out._activateSignal(R)}getClassName(){return Zu.ClassName}}Zu.ClassName="FGSetVariableBlock",(0,d.h)(Zu.ClassName,Zu);class zu extends Eq{constructor(R){super(R),this.config=R,this.condition=this.registerDataInput("condition",Rq),this.loopBody=this._registerSignalOutput("loopBody")}_execute(R,N){var q;let w=this.condition.getValue(R);for(null!==(q=this.config)&&void 0!==q&&q.isDo&&!w&&this.loopBody._activateSignal(R);w;)this.loopBody._activateSignal(R),w=this.condition.getValue(R);this.out._activateSignal(R)}getClassName(){return zu.ClassName}serialize(R){var N;super.serialize(R),R.isDo=null===(N=this.config)||void 0===N?void 0:N.isDo}}zu.ClassName="FGWhileLoopBlock",(0,d.h)(zu.ClassName,zu);const du={"lifecycle/onStart":dq.ClassName,"lifecycle/onTick":xq.ClassName,log:Pq.ClassName,"flow/delay":Oq.ClassName,"customEvent/send":Lq.ClassName,"customEvent/receive":mq.ClassName,"flow/sequence":oq.ClassName,"world/get":Qq.ClassName,"world/set":Yq.ClassName,"flow/doN":Ku.ClassName,"variable/get":ru.ClassName,"variable/set":Zu.ClassName,"flow/whileLoop":zu.ClassName,"math/random":pq.ClassName,"math/e":Nw.ClassName,"math/pi":qw.ClassName,"math/inf":ww.ClassName,"math/nan":uw.ClassName,"math/abs":vw.ClassName,"math/sign":Gw.ClassName,"math/trunc":Jw.ClassName,"math/floor":yw.ClassName,"math/ceil":aw.ClassName,"math/fract":jw.ClassName,"math/neg":Fw.ClassName,"math/add":lq.ClassName,"math/sub":Xq.ClassName,"math/mul":hq.ClassName,"math/div":Dq.ClassName,"math/rem":Hw.ClassName,"math/min":Ww.ClassName,"math/max":kw.ClassName,"math/clamp":Kw.ClassName,"math/saturate":Zw.ClassName,"math/mix":zw.ClassName,"math/eq":dw.ClassName,"math/lt":Ew.ClassName,"math/le":Pw.ClassName,"math/gt":sw.ClassName,"math/ge":Ow.ClassName,"math/isnan":Lw.ClassName,"math/isinf":mw.ClassName,"math/rad":ow.ClassName,"math/deg":Aw.ClassName,"math/sin":nw.ClassName,"math/cos":Qw.ClassName,"math/tan":Yw.ClassName,"math/asin":Tw.ClassName,"math/acos":fw.ClassName,"math/atan":cw.ClassName,"math/atan2":bw.ClassName,"math/sinh":Iw.ClassName,"math/cosh":Vw.ClassName,"math/tanh":tw.ClassName,"math/asinh":iw.ClassName,"math/acosh":gw.ClassName,"math/atanh":Uw.ClassName,"math/exp":Bw.ClassName,"math/log":lw.ClassName,"math/log2":Xw.ClassName,"math/log10":hw.ClassName,"math/sqrt":Dw.ClassName,"math/cbrt":pw.ClassName,"math/pow":Ru.ClassName,"math/length":Nu.ClassName,"math/normalize":qu.ClassName,"math/dot":Rw.ClassName,"math/cross":wu.ClassName,"math/rotate2d":uu.ClassName,"math/rotate3d":Mu.ClassName,"math/transpose":vu.ClassName,"math/determinant":Gu.ClassName,"math/inverse":Ju.ClassName,"math/matmul":yu.ClassName,"math/not":au.ClassName,"math/and":ju.ClassName,"math/or":Fu.ClassName,"math/xor":Su.ClassName,"math/asr":Wu.ClassName,"math/lsl":Hu.ClassName,"math/clz":ku.ClassName,"math/ctz":Cu.ClassName,"math/popcnt":eu.ClassName},xu={float2:"Vector2",float3:"Od",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function Eu(R,N,q){if(void 0!==R.type){const w=N.types&&N.types[R.type];if(!w)throw new Error(`${q}: Unknown type: ${R.type}`);const u=w.signature;if(!u)throw new Error(`${q}: Type ${R.type} has no signature`);const M=xu[u];return{value:R.value,className:M}}return R.value}function Pu(R,N,q){const w=du[N.type];if(!w)throw new Error(`/extensions/KHR_interactivity/nodes/${R}: Unknown block type: ${N.type}`);const u=R.toString(),M=function(R,N,q){const w={},u=R.configuration??[];for(const M of u)if("customEvent"===M.id){const R=N.customEvents&&N.customEvents[M.value];if(!R)throw new Error(`/extensions/KHR_interactivity/nodes/${q}: Unknown custom event: ${M.value}`);w.eventId=R.id,w.eventData=R.values.map((R=>R.id))}else if("variable"===M.id){const R=N.variables&&N.variables[M.value];if(!R)throw new Error(`/extensions/KHR_interactivity/nodes/${q}: Unknown variable: ${M.value}`);w.variableName=R.id}else if("path"===M.id){const R=M.value;w.path=R}else w[M.id]=Eu(M,N,`/extensions/KHR_interactivity/nodes/${q}`);return w}(N,q,u);return{className:w,config:M,uniqueId:u,metadata:N.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class su extends dN{constructor(R){super(R,Lu)}}const Ou={__array__:{__target__:!0,translation:{type:"Od",get:R=>R._babylonTransformNode.position,set:(R,N)=>{N._babylonTransformNode.position=R},getObject:R=>R._babylonTransformNode}}},Lu={nodes:Ou},mu="KHR_interactivity";class ou{constructor(R){this._loader=R,this.name=mu,this.enabled=this._loader.isExtensionUsed(mu),this._pathConverter=new su(this._loader.$i)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var R;if(!this._loader.babylonScene||!this._pathConverter)return;const N=this._loader.babylonScene,q=function(R){const N={uniqueId:(0,BN.d)(),_userVariables:{},_connectionValues:{}},q=[N],w=[];for(let M=0;M<R.nodes.length;M++){const N=Pu(M,R.nodes[M],R);w.push(N)}for(let M=0;M<R.nodes.length;M++){const q=R.nodes[M],u=w[M],v=q.flows??[];for(const R of v){const N=R.id,q={uniqueId:(0,BN.d)(),name:N,_connectionType:1,connectedPointIds:[]};u.signalOutputs.push(q);const v=R.node,G=R.socket,J=w[v];if(!J)throw new Error(`/extensions/KHR_interactivity/nodes/${M}: Could not find node with id ${v} that connects its input with with node ${M}'s output ${N}`);let y=J.signalInputs.find((R=>R.name===G));y||(y={uniqueId:(0,BN.d)(),name:G,_connectionType:0,connectedPointIds:[]},J.signalInputs.push(y)),y.connectedPointIds.push(q.uniqueId),q.connectedPointIds.push(y.uniqueId)}const G=q.values??[];for(const J of G){const q=J.id,v={uniqueId:(0,BN.d)(),name:q,_connectionType:0,connectedPointIds:[]};if(u.dataInputs.push(v),void 0!==J.value){const q=Eu(J,R,`/extensions/KHR_interactivity/nodes/${M}`);N._connectionValues[v.uniqueId]=q}else{if(void 0===J.node||void 0===J.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${M}: Invalid socket ${q} in node ${M}`);{const R=J.node,N=J.socket,u=w[R];if(!u)throw new Error(`/extensions/KHR_interactivity/nodes/${M}: Could not find node with id ${R} that connects its output with node${M}'s input ${q}`);let G=u.dataOutputs.find((R=>R.name===N));G||(G={uniqueId:(0,BN.d)(),name:N,_connectionType:1,connectedPointIds:[]},u.dataOutputs.push(G)),v.connectedPointIds.push(G.uniqueId),G.connectedPointIds.push(v.uniqueId)}}}}const u=R.variables??[];for(let M=0;M<u.length;M++){const q=u[M],w=q.id;N._userVariables[w]=Eu(q,R,`/extensions/KHR_interactivity/variables/${M}`)}return{allBlocks:w,executionContexts:q}}(null===(R=this._loader.$i.extensions)||void 0===R?void 0:R.KHR_interactivity),w=new zq({Ke:N});Zq.Parse(q,{coordinator:w,pathConverter:this._pathConverter}),w.start()}}B(mu),U(mu,!0,(R=>new ou(R)));const Au="KHR_node_visibility";class nu{constructor(R){this.name=Au,this._loader=R,this.enabled=R.isExtensionUsed(Au)}async onReady(){var R;null===(R=this._loader.$i.nodes)||void 0===R||R.forEach((R=>{var N,q,w,u;(null===(N=R._primitiveBabylonMeshes)||void 0===N||N.forEach((R=>{R.inheritVisibility=!0})),null!==(q=R.extensions)&&void 0!==q&&q.KHR_node_visibility)&&(!1===(null===(w=R.extensions)||void 0===w?void 0:w.KHR_node_visibility.visible)&&(R._babylonTransformNode&&(R._babylonTransformNode.isVisible=!1),null===(u=R._primitiveBabylonMeshes)||void 0===u||u.forEach((R=>{R.isVisible=!1}))))}))}dispose(){this._loader=null}}B(Au),U(Au,!0,(R=>new nu(R)));const Qu="ExtrasAsMetadata";class Yu{_assignExtras(R,N){if(N.extras&&Object.keys(N.extras).length>0){const q=R.metadata=R.metadata||{};(q.$i=q.$i||{}).extras=N.extras}}constructor(R){this.name=Qu,this.enabled=!0,this._loader=R}dispose(){this._loader=null}loadNodeAsync(R,N,q){return this._loader.loadNodeAsync(R,N,(R=>{this._assignExtras(R,N),q(R)}))}loadCameraAsync(R,N,q){return this._loader.loadCameraAsync(R,N,(R=>{this._assignExtras(R,N),q(R)}))}createMaterial(R,N,q){const w=this._loader.createMaterial(R,N,q);return this._assignExtras(w,N),w}}B(Qu),U(Qu,!1,(R=>new Yu(R)))},12028:(R,N,q)=>{"use strict";q.d(N,{c:()=>m,e:()=>x,f:()=>d,j:()=>E});var w=q(959),u=q(1177),M=q(11487),v=q(11381),G=q(11420),J=q(11412),y=q(1056),a=q(997),j=q(12033),F=q(12035),S=q(11396);class H{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.he=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Ue=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(R){this._environmentTexture=R}getNodes(){let R=[];return R=R.concat(this.meshes),R=R.concat(this.lights),R=R.concat(this.cameras),R=R.concat(this.transformNodes),this.skeletons.forEach((N=>R=R.concat(N.bones))),R}}class W extends H{}class k{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((R=>{R.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((R=>{R.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((R=>{R.dispose()})),this.animationGroups.length=0}}class C extends H{constructor(R){super(),this._wasAddedToScene=!1,(R=R||a.e.LastCreatedScene)&&(this.Ke=R,this.proceduralTextures=[],R.Zd.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=R.getEngine().onContextRestoredObservable.add((()=>{for(const R of this.geometries)R._rebuild();for(const R of this.meshes)R._rebuild();for(const R of this.he)R.rebuild();for(const R of this.textures)R._rebuild()})))}_topologicalSort(R){const N=new Map;for(const v of R)N.set(v.uniqueId,v);const q={dependsOn:new Map,dependedBy:new Map};for(const v of R){const R=v.uniqueId;q.dependsOn.set(R,new Set),q.dependedBy.set(R,new Set)}for(const v of R){const R=v.uniqueId,w=q.dependsOn.get(R);if(v instanceof j.d){const u=v.sourceMesh;N.has(u.uniqueId)&&(w.add(u.uniqueId),q.dependedBy.get(u.uniqueId).add(R))}const u=q.dependedBy.get(R);for(const M of v.getDescendants()){const w=M.uniqueId;if(N.has(w)){u.add(w);q.dependsOn.get(w).add(R)}}}const w=[],u=[];for(const v of R){const R=v.uniqueId;0===q.dependsOn.get(R).size&&(u.push(v),N.delete(R))}const M=u;for(;M.length>0;){const R=M.shift();w.push(R);const u=q.dependedBy.get(R.uniqueId);for(const w of Array.from(u.values())){const u=q.dependsOn.get(w);u.delete(R.uniqueId),0===u.size&&N.get(w)&&(M.push(N.get(w)),N.delete(w))}}return N.size>0&&(y.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),N.forEach((R=>y.e.Error(R.name)))),w}_addNodeAndDescendantsToList(R,N,q,w){if(q&&(!w||w(q))&&!N.has(q.uniqueId)){R.push(q),N.add(q.uniqueId);for(const u of q.getDescendants(!0))this._addNodeAndDescendantsToList(R,N,u,w)}}_isNodeInContainer(R){return R instanceof J.e&&-1!==this.meshes.indexOf(R)||(R instanceof G.d&&-1!==this.transformNodes.indexOf(R)||(R instanceof F.c&&-1!==this.lights.indexOf(R)||R instanceof S.e&&-1!==this.cameras.indexOf(R)))}_isValidHierarchy(){for(const R of this.meshes)if(R.parent&&!this._isNodeInContainer(R.parent))return y.e.Warn(`Node ${R.name} has a parent that is not in the container.`),!1;for(const R of this.transformNodes)if(R.parent&&!this._isNodeInContainer(R.parent))return y.e.Warn(`Node ${R.name} has a parent that is not in the container.`),!1;for(const R of this.lights)if(R.parent&&!this._isNodeInContainer(R.parent))return y.e.Warn(`Node ${R.name} has a parent that is not in the container.`),!1;for(const R of this.cameras)if(R.parent&&!this._isNodeInContainer(R.parent))return y.e.Warn(`Node ${R.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(R){let N=arguments.length>1&&void 0!==arguments[1]&&arguments[1],q=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||u.i.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const w={},M={},G=new k,J=[],y=[],a={doNotInstantiate:!0,...q},j=[],F=new Set;for(const u of this.transformNodes)null===u.parent&&this._addNodeAndDescendantsToList(j,F,u,a.predicate);for(const u of this.meshes)null===u.parent&&this._addNodeAndDescendantsToList(j,F,u,a.predicate);const S=this._topologicalSort(j),H=(q,u)=>{if(((N,q)=>{if(w[N.uniqueId]=q.uniqueId,M[q.uniqueId]=q,R&&(q.name=R(N.name)),q instanceof v.b){const R=q;if(R.morphTargetManager){const q=N.morphTargetManager;R.morphTargetManager=q.clone();for(let N=0;N<q.numTargets;N++){const u=q.getTarget(N),v=R.morphTargetManager.getTarget(N);w[u.uniqueId]=v.uniqueId,M[v.uniqueId]=v}}}})(q,u),q.parent){const R=w[q.parent.uniqueId],N=M[R];u.parent=N||q.parent}if(u.position&&q.position&&u.position.p(q.position),u.rotationQuaternion&&q.rotationQuaternion&&u.rotationQuaternion.p(q.rotationQuaternion),u.rotation&&q.rotation&&u.rotation.p(q.rotation),u.Fe&&q.Fe&&u.Fe.p(q.Fe),u.material){const v=u;if(v.material)if(N){const N=q.material;if(-1===y.indexOf(N)){let q=N.clone(R?R(N.name):"Clone of "+N.name);if(y.push(N),w[N.uniqueId]=q.uniqueId,M[q.uniqueId]=q,"MultiMaterial"===N.getClassName()){const u=N;for(const N of u.Hg)N&&(q=N.clone(R?R(N.name):"Clone of "+N.name),y.push(N),w[N.uniqueId]=q.uniqueId,M[q.uniqueId]=q);u.Hg=u.Hg.map((R=>R&&M[w[R.uniqueId]]))}}"InstancedMesh"!==v.getClassName()&&(v.material=M[w[N.uniqueId]])}else"MultiMaterial"===v.material.getClassName()?-1===this.Ke.multiMaterials.indexOf(v.material)&&this.Ke.addMultiMaterial(v.material):-1===this.Ke.materials.indexOf(v.material)&&this.Ke.addMaterial(v.material)}null===u.parent&&G.rootNodes.push(u)};return S.forEach((R=>{if("InstancedMesh"===R.getClassName()){const N=R,q=N.sourceMesh,u=w[q.uniqueId],v=("number"===typeof u?M[u]:q).pd(N.name);H(N,v)}else{let N=!0;"mb"===R.getClassName()||"Node"===R.getClassName()||R.skeleton||!R.getTotalVertices||0===R.getTotalVertices()?N=!1:a.doNotInstantiate&&(N="function"===typeof a.doNotInstantiate?!a.doNotInstantiate(R):!a.doNotInstantiate);const q=N?R.pd(`instance of ${R.name}`):R.clone(`Clone of ${R.name}`,null,!0);if(!q)throw new Error(`Could not clone or instantiate node on Asset Container ${R.name}`);H(R,q)}})),this.skeletons.forEach((N=>{if(a.predicate&&!a.predicate(N))return;const q=N.clone(R?R(N.name):"Clone of "+N.name);for(const R of this.meshes)if(R.skeleton===N&&!R.isAnInstance){const N=M[w[R.uniqueId]];if(!N||N.isAnInstance)continue;if(N.skeleton=q,-1!==J.indexOf(q))continue;J.push(q);for(const R of q.bones)R._linkedTransformNode&&(R._linkedTransformNode=M[w[R._linkedTransformNode.uniqueId]])}G.skeletons.push(q)})),this.animationGroups.forEach((N=>{if(a.predicate&&!a.predicate(N))return;const q=N.clone(R?R(N.name):"Clone of "+N.name,(R=>M[w[R.uniqueId]]||R));G.animationGroups.push(q)})),G}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||u.i.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Ke.environmentTexture=this.environmentTexture);for(const R of this.Ke._serializableComponents)R.addFromContainer(this);this.Ke.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const N=[];this.cameras.forEach((q=>{R&&!R(q)||(this.Ke.addCamera(q),N.push(q))})),this.lights.forEach((q=>{R&&!R(q)||(this.Ke.addLight(q),N.push(q))})),this.meshes.forEach((q=>{R&&!R(q)||(this.Ke.We(q),N.push(q))})),this.skeletons.forEach((N=>{R&&!R(N)||this.Ke.addSkeleton(N)})),this.animations.forEach((N=>{R&&!R(N)||this.Ke.addAnimation(N)})),this.animationGroups.forEach((N=>{R&&!R(N)||this.Ke.addAnimationGroup(N)})),this.multiMaterials.forEach((N=>{R&&!R(N)||this.Ke.addMultiMaterial(N)})),this.materials.forEach((N=>{R&&!R(N)||this.Ke.addMaterial(N)})),this.morphTargetManagers.forEach((N=>{R&&!R(N)||this.Ke.addMorphTargetManager(N)})),this.geometries.forEach((N=>{R&&!R(N)||this.Ke.addGeometry(N)})),this.transformNodes.forEach((q=>{R&&!R(q)||(this.Ke.addTransformNode(q),N.push(q))})),this.actionManagers.forEach((N=>{R&&!R(N)||this.Ke.addActionManager(N)})),this.textures.forEach((N=>{R&&!R(N)||this.Ke.addTexture(N)})),this.reflectionProbes.forEach((N=>{R&&!R(N)||this.Ke.addReflectionProbe(N)}));for(const q of N)q.parent&&-1===this.Ke.getNodes().indexOf(q.parent)&&(q.setParent?q.setParent(null):q.parent=null)}removeAllFromScene(){this._isValidHierarchy()||u.i.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Ke.environmentTexture&&(this.Ke.environmentTexture=null);for(const R of this.Ke._serializableComponents)R.removeFromContainer(this)}removeFromScene(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((N=>{R&&!R(N)||this.Ke.removeCamera(N)})),this.lights.forEach((N=>{R&&!R(N)||this.Ke.removeLight(N)})),this.meshes.forEach((N=>{R&&!R(N)||this.Ke.Xe(N,!0)})),this.skeletons.forEach((N=>{R&&!R(N)||this.Ke.removeSkeleton(N)})),this.animations.forEach((N=>{R&&!R(N)||this.Ke.removeAnimation(N)})),this.animationGroups.forEach((N=>{R&&!R(N)||this.Ke.removeAnimationGroup(N)})),this.multiMaterials.forEach((N=>{R&&!R(N)||this.Ke.removeMultiMaterial(N)})),this.materials.forEach((N=>{R&&!R(N)||this.Ke.removeMaterial(N)})),this.morphTargetManagers.forEach((N=>{R&&!R(N)||this.Ke.removeMorphTargetManager(N)})),this.geometries.forEach((N=>{R&&!R(N)||this.Ke.removeGeometry(N)})),this.transformNodes.forEach((N=>{R&&!R(N)||this.Ke.removeTransformNode(N)})),this.actionManagers.forEach((N=>{R&&!R(N)||this.Ke.removeActionManager(N)})),this.textures.forEach((N=>{R&&!R(N)||this.Ke.removeTexture(N)})),this.reflectionProbes.forEach((N=>{R&&!R(N)||this.Ke.removeReflectionProbe(N)}))}dispose(){this.cameras.slice(0).forEach((R=>{R.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((R=>{R.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((R=>{R.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((R=>{R.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((R=>{R.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((R=>{R.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((R=>{R.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((R=>{R.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((R=>{R.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((R=>{R.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((R=>{R.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((R=>{R.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((R=>{R.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const R of this.Ke._serializableComponents)R.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Ke.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(R,N,q){if(R&&N)for(const w of R){let R=!0;if(q)for(const N of q)if(w===N){R=!1;break}R&&(N.push(w),w._parentContainer=this)}}moveAllFromScene(R){this._wasAddedToScene=!1,void 0===R&&(R=new W);for(const N in this)Object.prototype.hasOwnProperty.call(this,N)&&(this[N]=this[N]||("_environmentTexture"===N?null:[]),this._moveAssets(this.Ke[N],this[N],R[N]));this.environmentTexture=this.Ke.environmentTexture,this.removeAllFromScene()}createRootMesh(){const R=new v.b("assetContainerRootMesh",this.Ke);return this.meshes.forEach((N=>{N.parent||R.addChild(N)})),this.meshes.unshift(R),R}mergeAnimationsTo(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.e.LastCreatedScene,N=arguments.length>1?arguments[1]:void 0,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!R)return y.e.Error("No scene available to merge animations to"),[];const w=q||(N=>{let q=null;const w=N.animations.length?N.animations[0].targetProperty:"",u=N.name.split(".").join("").split("_primitive")[0];switch(w){case"position":case"rotationQuaternion":q=R.getTransformNodeByName(N.name)||R.getTransformNodeByName(u);break;case"influence":q=R.getMorphTargetByName(N.name)||R.getMorphTargetByName(u);break;default:q=R.getNodeByName(N.name)||R.getNodeByName(u)}return q});this.getNodes().forEach((R=>{const N=w(R);if(null!==N){for(const q of R.animations){const R=N.animations.filter((R=>R.targetProperty===q.targetProperty));for(const q of R){const R=N.animations.indexOf(q,0);R>-1&&N.animations.splice(R,1)}}N.animations=N.animations.concat(R.animations)}}));const u=[];return this.animationGroups.slice().forEach((R=>{u.push(R.clone(R.name,w)),R.animatables.forEach((R=>{R.stop()}))})),N.forEach((N=>{const q=w(N.target);q&&(R.beginAnimation(q,N.fromFrame,N.toFrame,N.loopAnimation,N.speedRatio,N.onAnimationEnd?N.onAnimationEnd:void 0,void 0,!0,void 0,N.onAnimationLoop?N.onAnimationLoop:void 0),R.stopAnimation(N.target))})),u}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((R=>{R.parent||-1!==this.rootNodes.indexOf(R)||this.rootNodes.push(R)})),this.transformNodes.forEach((R=>{R.parent||-1!==this.rootNodes.indexOf(R)||this.rootNodes.push(R)})),this.lights.forEach((R=>{R.parent||-1!==this.rootNodes.indexOf(R)||this.rootNodes.push(R)})),this.cameras.forEach((R=>{R.parent||-1!==this.rootNodes.indexOf(R)||this.rootNodes.push(R)}))}addAllAssetsToContainer(R){if(!R)return;const N=[],q=new Set;for(N.push(R);N.length>0;){const R=N.pop();if(R instanceof v.b?(R.te&&-1===this.geometries.indexOf(R.te)&&this.geometries.push(R.te),this.meshes.push(R)):R instanceof G.d?this.transformNodes.push(R):R instanceof F.c?this.lights.push(R):R instanceof S.e&&this.cameras.push(R),R instanceof J.e){if(R.material&&-1===this.materials.indexOf(R.material)){this.materials.push(R.material);for(const N of R.material.getActiveTextures())-1===this.textures.indexOf(N)&&this.textures.push(N)}R.skeleton&&-1===this.skeletons.indexOf(R.skeleton)&&this.skeletons.push(R.skeleton),R.morphTargetManager&&-1===this.morphTargetManagers.indexOf(R.morphTargetManager)&&this.morphTargetManagers.push(R.morphTargetManager)}for(const w of R.getChildren())q.has(w)||N.push(w);q.add(R)}this.populateRootNodes()}}var e=q(1033);class K{constructor(R){this.byteOffset=0,this.buffer=R}loadAsync(R){return this.buffer.readAsync(this.byteOffset,R).then((R=>{this._dataView=new DataView(R.buffer,R.byteOffset,R.byteLength),this._dataByteOffset=0}))}readUint32(){const R=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,R}readUint8Array(R){const N=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,R);return this._dataByteOffset+=R,this.byteOffset+=R,N}readString(R){return(0,e.j)(this.readUint8Array(R))}skipBytes(R){this._dataByteOffset+=R,this.byteOffset+=R}}var r=q(12041);const Z="Z2xURg",z={name:"$i",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:R=>-1!==R.indexOf("asset")&&-1!==R.indexOf("version")||R.startsWith("data:base64,"+Z)||R.startsWith("data:;base64,"+Z)||R.startsWith("data:application/octet-stream;base64,"+Z)||R.startsWith("data:model/gltf-binary;base64,"+Z)};var d,x,E,P=q(1015),s=q(1026);function O(R,N,q){try{return Promise.resolve(new Uint8Array(R,N,q))}catch(w){return Promise.reject(w)}}!function(R){R[R.AUTO=0]="AUTO",R[R.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(d||(d={})),function(R){R[R.NONE=0]="NONE",R[R.FIRST=1]="FIRST",R[R.ALL=2]="ALL"}(x||(x={})),function(R){R[R.LOADING=0]="LOADING",R[R.READY=1]="READY",R[R.COMPLETE=2]="COMPLETE"}(E||(E={}));class L{constructor(){this.coordinateSystemMode=d.AUTO,this.animationStartMode=x.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=R=>Promise.resolve(R),this.extensionOptions={}}p(R){R&&(this.onParsed=R.onParsed,this.coordinateSystemMode=R.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=R.animationStartMode??this.animationStartMode,this.loadNodeAnimations=R.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=R.loadSkins??this.loadSkins,this.loadMorphTargets=R.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=R.compileMaterials??this.compileMaterials,this.useClipPlane=R.useClipPlane??this.useClipPlane,this.compileShadowGenerators=R.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=R.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=R.useRangeRequests??this.useRangeRequests,this.createInstances=R.createInstances??this.createInstances,this.alwaysComputeBoundingBox=R.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=R.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=R.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=R.skipMaterials??this.skipMaterials,this.useSRGBBuffers=R.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=R.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=R.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=R.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=R.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=R.customRootNode,this.onMeshLoaded=R.onMeshLoaded,this.onSkinLoaded=R.onSkinLoaded,this.onTextureLoaded=R.onTextureLoaded,this.onMaterialLoaded=R.onMaterialLoaded,this.onCameraLoaded=R.onCameraLoaded,this.extensionOptions=R.extensionOptions??this.extensionOptions)}}class m extends L{constructor(R){super(),this.onParsedObservable=new w.c,this.onMeshLoadedObservable=new w.c,this.onSkinLoadedObservable=new w.c,this.onTextureLoadedObservable=new w.c,this.onMaterialLoadedObservable=new w.c,this.onCameraLoadedObservable=new w.c,this.onCompleteObservable=new w.c,this.onErrorObservable=new w.c,this.Zd=new w.c,this.onExtensionLoadedObservable=new w.c,this.validate=!1,this.onValidatedObservable=new w.c,this._loader=null,this._state=null,this._requests=new Array,this.name=z.name,this.extensions=z.extensions,this.onLoaderStateChangedObservable=new w.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(R)}set onParsed(R){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),R&&(this._onParsedObserver=this.onParsedObservable.add(R))}set onMeshLoaded(R){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),R&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(R))}set onSkinLoaded(R){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),R&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((N=>R(N.node,N.skinnedNode))))}set onTextureLoaded(R){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),R&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(R))}set onMaterialLoaded(R){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),R&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(R))}set onCameraLoaded(R){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),R&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(R))}set onComplete(R){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(R)}set onError(R){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(R)}set onDispose(R){this._onDisposeObserver&&this.Zd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Zd.add(R)}set onExtensionLoaded(R){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(R)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(R){this._loggingEnabled!==R&&(this._loggingEnabled=R,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(R){this._capturePerformanceCounters!==R&&(this._capturePerformanceCounters=R,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(R){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(R)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const R of this._requests)R.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=R=>Promise.resolve(R),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Zd.notifyObservers(void 0),this.Zd.clear()}loadFile(R,N,q,M,v,G,J,a){if(ArrayBuffer.isView(N))return this._loadBinary(R,N,q,M,J,a),null;this._progressCallback=v;const j=N.name||u.i.GetFilename(N);if(G){if(this.useRangeRequests){this.validate&&y.e.Warn("glTF validation is not supported when range requests are enabled");const q={abort:()=>{},onCompleteObservable:new w.c},u={readAsync:(q,w)=>new Promise(((u,M)=>{this._loadFile(R,N,(R=>{u(new Uint8Array(R))}),!0,(R=>{M(R)}),(R=>{R.setRequestHeader("Range",`bytes=${q}-${q+w-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new K(u)).then((R=>{q.onCompleteObservable.notifyObservers(q),M(R)}),J?R=>J(void 0,R):void 0),q}return this._loadFile(R,N,(N=>{this._validate(R,new Uint8Array(N,0,N.byteLength),q,j),this._unpackBinaryAsync(new K({readAsync:(R,q)=>O(N,R,q),byteLength:N.byteLength})).then((R=>{M(R)}),J?R=>J(void 0,R):void 0)}),!0,J)}return this._loadFile(R,N,(N=>{try{this._validate(R,N,q,j),M({json:this._parseJson(N)})}catch{J&&J()}}),!1,J)}_loadBinary(R,N,q,w,u,M){this._validate(R,new Uint8Array(N.buffer,N.byteOffset,N.byteLength),q,M),this._unpackBinaryAsync(new K({readAsync:(R,q)=>function(R,N,q){try{if(N<0||N>=R.byteLength)throw new RangeError("Offset is out of range.");if(N+q>R.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(R.buffer,R.byteOffset+N,q))}catch(w){return Promise.reject(w)}}(N,R,q),byteLength:N.byteLength})).then((R=>{w(R)}),u?R=>u(void 0,R):void 0)}importMeshAsync(R,N,q,w,u,M){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(q),this.onParsedObservable.clear(),this._log(`Loading ${M||""}`),this._loader=this._getLoader(q),this._loader.importMeshAsync(R,N,null,q,w,u,M))))}loadAsync(R,N,q,w,u){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(N),this.onParsedObservable.clear(),this._log(`Loading ${u||""}`),this._loader=this._getLoader(N),this._loader.loadAsync(R,N,q,w,u))))}loadAssetContainerAsync(R,N,q,w,u){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(N),this.onParsedObservable.clear(),this._log(`Loading ${u||""}`),this._loader=this._getLoader(N);const M=new C(R),v=[];this.onMaterialLoadedObservable.add((R=>{v.push(R)}));const G=[];this.onTextureLoadedObservable.add((R=>{G.push(R)}));const J=[];this.onCameraLoadedObservable.add((R=>{J.push(R)}));const y=[];return this.onMeshLoadedObservable.add((R=>{R.morphTargetManager&&y.push(R.morphTargetManager)})),this._loader.importMeshAsync(null,R,M,N,q,w,u).then((R=>(Array.prototype.push.apply(M.geometries,R.geometries),Array.prototype.push.apply(M.meshes,R.meshes),Array.prototype.push.apply(M.he,R.he),Array.prototype.push.apply(M.skeletons,R.skeletons),Array.prototype.push.apply(M.animationGroups,R.animationGroups),Array.prototype.push.apply(M.materials,v),Array.prototype.push.apply(M.textures,G),Array.prototype.push.apply(M.lights,R.lights),Array.prototype.push.apply(M.transformNodes,R.transformNodes),Array.prototype.push.apply(M.cameras,J),Array.prototype.push.apply(M.morphTargetManagers,y),M)))}))}canDirectLoad(R){return z.canDirectLoad(R)}directLoad(R,N){if(N.startsWith("base64,"+Z)||N.startsWith(";base64,"+Z)||N.startsWith("application/octet-stream;base64,"+Z)||N.startsWith("model/gltf-binary;base64,"+Z)){const q=(0,P.c)(N);return this._validate(R,new Uint8Array(q,0,q.byteLength)),this._unpackBinaryAsync(new K({readAsync:(R,N)=>O(q,R,N),byteLength:q.byteLength}))}return this._validate(R,N),Promise.resolve({json:this._parseJson(N)})}createPlugin(R){return new m(R[z.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((R,N)=>{this.onCompleteObservable.addOnce((()=>{R()})),this.onErrorObservable.addOnce((R=>{N(R)}))}))}_setState(R){this._state!==R&&(this._state=R,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(E[this._state]))}_loadFile(R,N,q,w,u,M){const v=R._loadFile(N,q,(R=>{this._onProgress(R,v)}),!0,w,u,M);return v.onCompleteObservable.add((()=>{v._lengthComputable=!0,v._total=v._loaded})),this._requests.push(v),v}_onProgress(R,N){if(!this._progressCallback)return;N._lengthComputable=R.lengthComputable,N._loaded=R.loaded,N._total=R.total;let q=!0,w=0,u=0;for(const M of this._requests){if(void 0===M._lengthComputable||void 0===M._loaded||void 0===M._total)return;q=q&&M._lengthComputable,w+=M._loaded,u+=M._total}this._progressCallback({lengthComputable:q,loaded:w,total:q?u:0})}_validate(R,N){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),r.d.ValidateAsync(N,q,w,(N=>this.preprocessUrlAsync(q+N).then((N=>R._loadFileAsync(N,void 0,!0,!0).then((R=>new Uint8Array(R,0,R.byteLength))))))).then((R=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(R),this.onValidatedObservable.clear()}),(R=>{this._endPerformanceCounter("Validate JSON"),u.i.Warn(`Failed to validate: ${R.message}`),this.onValidatedObservable.clear()})))}_getLoader(R){const N=R.json.asset||{};this._log(`Asset version: ${N.version}`),N.minVersion&&this._log(`Asset minimum version: ${N.minVersion}`),N.generator&&this._log(`Asset generator: ${N.generator}`);const q=m._parseVersion(N.version);if(!q)throw new Error("Invalid version: "+N.version);if(void 0!==N.minVersion){const R=m._parseVersion(N.minVersion);if(!R)throw new Error("Invalid minimum version: "+N.minVersion);if(m._compareVersion(R,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+N.minVersion)}const w={1:m._CreateGLTF1Loader,2:m._CreateGLTF2Loader}[q.major];if(!w)throw new Error("Unsupported version: "+N.version);return w(this)}_parseJson(R){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${R.length}`);const N=JSON.parse(R);return this._endPerformanceCounter("Parse JSON"),N}_unpackBinaryAsync(R){return this._startPerformanceCounter("Unpack Binary"),R.loadAsync(20).then((()=>{const N=R.readUint32();if(1179937895!==N)throw new s.h("Unexpected magic: "+N,s.d.GLTFLoaderUnexpectedMagicError);const q=R.readUint32();this.loggingEnabled&&this._log(`Binary version: ${q}`);const w=R.readUint32();let u;switch(this.useRangeRequests||w===R.buffer.byteLength||y.e.Warn(`Length in header does not match actual data length: ${w} != ${R.buffer.byteLength}`),q){case 1:u=this._unpackBinaryV1Async(R,w);break;case 2:u=this._unpackBinaryV2Async(R,w);break;default:throw new Error("Unsupported version: "+q)}return this._endPerformanceCounter("Unpack Binary"),u}))}_unpackBinaryV1Async(R,N){const q=R.readUint32(),w=R.readUint32();if(0!==w)throw new Error(`Unexpected content format: ${w}`);const u=N-R.byteOffset,M={json:this._parseJson(R.readString(q)),bin:null};if(0!==u){const N=R.byteOffset;M.bin={readAsync:(q,w)=>R.buffer.readAsync(N+q,w),byteLength:u}}return Promise.resolve(M)}_unpackBinaryV2Async(R,N){const q=1313821514,w=5130562,u=R.readUint32();if(R.readUint32()!==q)throw new Error("First chunk format is not JSON");return R.byteOffset+u===N?R.loadAsync(u).then((()=>({json:this._parseJson(R.readString(u)),bin:null}))):R.loadAsync(u+8).then((()=>{const M={json:this._parseJson(R.readString(u)),bin:null},v=()=>{const u=R.readUint32();switch(R.readUint32()){case q:throw new Error("Unexpected JSON chunk");case w:{const N=R.byteOffset;M.bin={readAsync:(q,w)=>R.buffer.readAsync(N+q,w),byteLength:u},R.skipBytes(u);break}default:R.skipBytes(u)}return R.byteOffset!==N?R.loadAsync(8).then(v):Promise.resolve(M)};return v()}))}static _parseVersion(R){if("1.0"===R||"1.0.1"===R)return{major:1,minor:0};const N=(R+"").match(/^(\d+)\.(\d+)/);return N?{major:parseInt(N[1]),minor:parseInt(N[2])}:null}static _compareVersion(R,N){return R.major>N.major?1:R.major<N.major?-1:R.minor>N.minor?1:R.minor<N.minor?-1:0}_logOpen(R){this._log(R),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(R){const N=m._logSpaces.substring(0,2*this._logIndentLevel);y.e.Log(`${N}${R}`)}_logDisabled(R){}_startPerformanceCounterEnabled(R){u.i.StartPerformanceCounter(R)}_startPerformanceCounterDisabled(R){}_endPerformanceCounterEnabled(R){u.i.EndPerformanceCounter(R)}_endPerformanceCounterDisabled(R){}}m.IncrementalLoading=!0,m.HomogeneousCoordinates=!1,m._logSpaces="                                ",(0,M.g)(new m)},12041:(R,N,q)=>{"use strict";q.d(N,{d:()=>v});var w=q(1177);function u(R,N,q,w){const u={externalResourceFunction:w};return q&&(u.uri="file:"===N?q:N+q),ArrayBuffer.isView(R)?GLTFValidator.validateBytes(R,u):GLTFValidator.validateString(R,u)}function M(){const R=[];onmessage=N=>{const q=N.data;switch(q.id){case"init":importScripts(q.url);break;case"validate":u(q.data,q.rootUrl,q.fileName,(N=>new Promise(((q,w)=>{const u=R.length;R.push({resolve:q,reject:w}),postMessage({id:"getExternalResource",index:u,uri:N})})))).then((R=>{postMessage({id:"validate.resolve",value:R})}),(R=>{postMessage({id:"validate.reject",reason:R})}));break;case"getExternalResource.resolve":R[q.index].resolve(q.value);break;case"getExternalResource.reject":R[q.index].reject(q.reason)}}}class v{static ValidateAsync(R,N,q,v){return"function"===typeof Worker?new Promise(((G,J)=>{const y=`${u}(${M})()`,a=URL.createObjectURL(new Blob([y],{type:"application/javascript"})),j=new Worker(a),F=R=>{j.removeEventListener("error",F),j.removeEventListener("message",S),J(R)},S=R=>{const N=R.data;switch(N.id){case"getExternalResource":v(N.uri).then((R=>{j.postMessage({id:"getExternalResource.resolve",index:N.index,value:R},[R.buffer])}),(R=>{j.postMessage({id:"getExternalResource.reject",index:N.index,reason:R})}));break;case"validate.resolve":j.removeEventListener("error",F),j.removeEventListener("message",S),G(N.value),j.terminate();break;case"validate.reject":j.removeEventListener("error",F),j.removeEventListener("message",S),J(N.reason),j.terminate()}};if(j.addEventListener("error",F),j.addEventListener("message",S),j.postMessage({id:"init",url:w.i.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(R)){const w=R.slice();j.postMessage({id:"validate",data:w,rootUrl:N,fileName:q},[w.buffer])}else j.postMessage({id:"validate",data:R,rootUrl:N,fileName:q})})):(this._LoadScriptPromise||(this._LoadScriptPromise=w.i.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>u(R,N,q,v))))}}v.Configuration={url:`${w.i._DefaultCdnUrl}/gltf_validator.js`}},12381:(R,N,q)=>{"use strict";q.d(N,{d:()=>d});var w=q(942),u=q(947),M=q(1128),v=q(966),G=q(1363),J=q(1367),y=q(1227),a=q(1174),j=q(982),F=q(1078);q(10942),q(10806),q(10944),q(10734),q(10949),q(10986),q(10991);const S="imageProcessingCompatibility",H="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";F.b.IncludesShadersStore[S]=H;const W="skyPixelShader",k="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";F.b.ShadersStore[W]=k;q(10774),q(10777),q(10852),q(10873),q(10859);const C="skyVertexShader",e="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";F.b.ShadersStore[C]=e;var K=q(1378),r=q(1357),Z=q(1353);class z extends G.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class d extends J.d{constructor(R,N){super(R,N),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new v.m(0,100,0),this.useSunPosition=!1,this.cameraOffset=v.m.Zero(),this.up=v.m.Up(),this.dithering=!1,this._cameraPosition=v.m.Zero(),this._skyOrientation=new v.e}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(R,N){const q=N._drawWrapper;if(this.isFrozen&&q.effect&&q._wasPreviouslyReady)return!0;N.materialDefines||(N.materialDefines=new z);const w=N.materialDefines,u=this.va();if(this._isReadyForSubMesh(N))return!0;if((0,Z.Q)(R,u,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,w),(0,Z.G)(R,w,!0,!1),w.IMAGEPROCESSINGPOSTPROCESS!==u.imageProcessingConfiguration.applyByPostProcess&&w.markAsMiscDirty(),w.DITHER!==this.dithering&&w.markAsMiscDirty(),w.isDirty){w.markAsProcessed(),u.resetCachedMaterial();const R=new K.b;w.FOG&&R.addFallback(1,"FOG"),w.IMAGEPROCESSINGPOSTPROCESS=u.imageProcessingConfiguration.applyByPostProcess,w.DITHER=this.dithering;const q=[y.e.PositionKind];w.VERTEXCOLOR&&q.push(y.e.ColorKind);const M="sky",v=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,r.c)(v);const G=w.toString();N.setEffect(u.getEngine().createEffect(M,q,v,[],G,R,this.onCompiled,this.onError),w,this._materialContext)}return!(!N.effect||!N.effect.isReady())&&(w._renderId=u.getRenderId(),q._wasPreviouslyReady=!0,!0)}bindForSubMesh(R,N,q){const w=this.va(),u=q.materialDefines;if(!u)return;const M=q.effect;if(!M)return;this._activeEffect=M,this.bindOnlyWorldMatrix(R),this._activeEffect.setMatrix("viewProjection",w.getTransformMatrix()),this._mustRebind(w,M,q)&&((0,r.d)(M,this,w),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,Z.m)(u,M,w)),w.fogEnabled&&N.applyFog&&w.fogMode!==a.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",w.getViewMatrix()),(0,Z.g)(w,N,this._activeEffect);const G=w.activeCamera;if(G){const R=G.getWorldMatrix();this._cameraPosition.x=R.m[12],this._cameraPosition.y=R.m[13],this._cameraPosition.z=R.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const R=Math.PI*(this.inclination-.5),N=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(N)*Math.cos(R),this.sunPosition.y=this.distance*Math.sin(-R),this.sunPosition.z=this.distance*Math.sin(N)*Math.cos(R),v.e.FromUnitVectorsToRef(v.m.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(N,this._activeEffect,q)}getAnimatables(){return[]}dispose(R){super.dispose(R)}clone(R){return M.e.Clone((()=>new d(R,this.va())),this)}serialize(){const R=super.serialize();return R.customType="BABYLON.SkyMaterial",R}getClassName(){return"SkyMaterial"}static Parse(R,N,q){return M.e.Parse((()=>new d(R.name,N)),R,N,q)}}(0,w.b)([(0,u.E)()],d.prototype,"luminance",void 0),(0,w.b)([(0,u.E)()],d.prototype,"turbidity",void 0),(0,w.b)([(0,u.E)()],d.prototype,"rayleigh",void 0),(0,w.b)([(0,u.E)()],d.prototype,"mieCoefficient",void 0),(0,w.b)([(0,u.E)()],d.prototype,"mieDirectionalG",void 0),(0,w.b)([(0,u.E)()],d.prototype,"distance",void 0),(0,w.b)([(0,u.E)()],d.prototype,"inclination",void 0),(0,w.b)([(0,u.E)()],d.prototype,"azimuth",void 0),(0,w.b)([(0,u.C)()],d.prototype,"sunPosition",void 0),(0,w.b)([(0,u.E)()],d.prototype,"useSunPosition",void 0),(0,w.b)([(0,u.C)()],d.prototype,"cameraOffset",void 0),(0,w.b)([(0,u.C)()],d.prototype,"up",void 0),(0,w.b)([(0,u.E)()],d.prototype,"dithering",void 0),(0,j.h)("BABYLON.SkyMaterial",d)},11116:(R,N,q)=>{"use strict";function w(R,N){N.headers=R.headers||{},N.statusMessage=R.statusText,N.statusCode=R.status,N.data=R.response}function u(R,N,q){return new Promise((function(u,M){q=q||{};var v,G,J,y=new XMLHttpRequest,a=q.body,j=q.headers||{};for(v in q.timeout&&(y.timeout=q.timeout),y.ontimeout=y.onerror=function(R){R.timeout="timeout"==R.type,M(R)},y.open(R,N.href||N),y.onload=function(){for(J=y.getAllResponseHeaders().trim().split(/[\r\n]+/),w(y,y);G=J.shift();)G=G.split(": "),y.headers[G.shift().toLowerCase()]=G.join(": ");if((G=y.headers["content-type"])&&~G.indexOf("application/json"))try{y.data=JSON.parse(y.data,q.reviver)}catch(R){return w(y,R),M(R)}(y.status>=400?M:u)(y)},typeof FormData<"u"&&a instanceof FormData||a&&"object"==typeof a&&(j["content-type"]="application/json",a=JSON.stringify(a)),y.withCredentials=!!q.withCredentials,j)y.setRequestHeader(v,j[v]);y.send(a)}))}q.r(N),q.d(N,{del:()=>J,get:()=>M,patch:()=>G,post:()=>v,put:()=>y,send:()=>u});var M=u.bind(u,"GET"),v=u.bind(u,"POST"),G=u.bind(u,"PATCH"),J=u.bind(u,"DELETE"),y=u.bind(u,"PUT")},12481:(R,N,q)=>{"use strict";q.d(N,{b:()=>j});const w=.5*(Math.sqrt(3)-1),u=(3-Math.sqrt(3))/6,M=1/3,v=1/6,G=(Math.sqrt(5)-1)/4,J=(5-Math.sqrt(5))/20,y=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),a=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const j=class{constructor(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const N="function"==typeof R?R:function(R){let N=0,q=0,w=0,u=1;const M=function(){let R=4022871197;return function(N){N=N.toString();for(let q=0;q<N.length;q++){R+=N.charCodeAt(q);let w=.02519603282416938*R;R=w>>>0,w-=R,w*=R,R=w>>>0,w-=R,R+=4294967296*w}return 2.3283064365386963e-10*(R>>>0)}}();N=M(" "),q=M(" "),w=M(" "),N-=M(R),N<0&&(N+=1);q-=M(R),q<0&&(q+=1);w-=M(R),w<0&&(w+=1);return function(){const R=2091639*N+2.3283064365386963e-10*u;return N=q,q=w,w=R-(u=0|R)}}(R);this.p=function(R){const N=new Uint8Array(256);for(let q=0;q<256;q++)N[q]=q;for(let q=0;q<255;q++){const w=q+~~(R()*(256-q)),u=N[q];N[q]=N[w],N[w]=u}return N}(N),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let q=0;q<512;q++)this.perm[q]=this.p[255&q],this.permMod12[q]=this.perm[q]%12}noise2D(R,N){const q=this.permMod12,M=this.perm;let v=0,G=0,J=0;const a=(R+N)*w,j=Math.floor(R+a),F=Math.floor(N+a),S=(j+F)*u,H=R-(j-S),W=N-(F-S);let k,C;H>W?(k=1,C=0):(k=0,C=1);const e=H-k+u,K=W-C+u,r=H-1+2*u,Z=W-1+2*u,z=255&j,d=255&F;let x=.5-H*H-W*W;if(x>=0){const R=3*q[z+M[d]];x*=x,v=x*x*(y[R]*H+y[R+1]*W)}let E=.5-e*e-K*K;if(E>=0){const R=3*q[z+k+M[d+C]];E*=E,G=E*E*(y[R]*e+y[R+1]*K)}let P=.5-r*r-Z*Z;if(P>=0){const R=3*q[z+1+M[d+1]];P*=P,J=P*P*(y[R]*r+y[R+1]*Z)}return 70*(v+G+J)}noise3D(R,N,q){const w=this.permMod12,u=this.perm;let G,J,a,j;const F=(R+N+q)*M,S=Math.floor(R+F),H=Math.floor(N+F),W=Math.floor(q+F),k=(S+H+W)*v,C=R-(S-k),e=N-(H-k),K=q-(W-k);let r,Z,z,d,x,E;C>=e?e>=K?(r=1,Z=0,z=0,d=1,x=1,E=0):C>=K?(r=1,Z=0,z=0,d=1,x=0,E=1):(r=0,Z=0,z=1,d=1,x=0,E=1):e<K?(r=0,Z=0,z=1,d=0,x=1,E=1):C<K?(r=0,Z=1,z=0,d=0,x=1,E=1):(r=0,Z=1,z=0,d=1,x=1,E=0);const P=C-r+v,s=e-Z+v,O=K-z+v,L=C-d+2*v,m=e-x+2*v,o=K-E+2*v,A=C-1+.5,n=e-1+.5,Q=K-1+.5,Y=255&S,T=255&H,f=255&W;let c=.6-C*C-e*e-K*K;if(c<0)G=0;else{const R=3*w[Y+u[T+u[f]]];c*=c,G=c*c*(y[R]*C+y[R+1]*e+y[R+2]*K)}let b=.6-P*P-s*s-O*O;if(b<0)J=0;else{const R=3*w[Y+r+u[T+Z+u[f+z]]];b*=b,J=b*b*(y[R]*P+y[R+1]*s+y[R+2]*O)}let I=.6-L*L-m*m-o*o;if(I<0)a=0;else{const R=3*w[Y+d+u[T+x+u[f+E]]];I*=I,a=I*I*(y[R]*L+y[R+1]*m+y[R+2]*o)}let V=.6-A*A-n*n-Q*Q;if(V<0)j=0;else{const R=3*w[Y+1+u[T+1+u[f+1]]];V*=V,j=V*V*(y[R]*A+y[R+1]*n+y[R+2]*Q)}return 32*(G+J+a+j)}noise4D(R,N,q,w){const u=this.perm;let M,v,y,j,F;const S=(R+N+q+w)*G,H=Math.floor(R+S),W=Math.floor(N+S),k=Math.floor(q+S),C=Math.floor(w+S),e=(H+W+k+C)*J,K=R-(H-e),r=N-(W-e),Z=q-(k-e),z=w-(C-e);let d=0,x=0,E=0,P=0;K>r?d++:x++,K>Z?d++:E++,K>z?d++:P++,r>Z?x++:E++,r>z?x++:P++,Z>z?E++:P++;const s=d>=3?1:0,O=x>=3?1:0,L=E>=3?1:0,m=P>=3?1:0,o=d>=2?1:0,A=x>=2?1:0,n=E>=2?1:0,Q=P>=2?1:0,Y=d>=1?1:0,T=x>=1?1:0,f=E>=1?1:0,c=P>=1?1:0,b=K-s+J,I=r-O+J,V=Z-L+J,t=z-m+J,i=K-o+2*J,g=r-A+2*J,U=Z-n+2*J,B=z-Q+2*J,l=K-Y+3*J,X=r-T+3*J,h=Z-f+3*J,D=z-c+3*J,p=K-1+4*J,RR=r-1+4*J,NR=Z-1+4*J,qR=z-1+4*J,wR=255&H,uR=255&W,MR=255&k,vR=255&C;let GR=.6-K*K-r*r-Z*Z-z*z;if(GR<0)M=0;else{const R=u[wR+u[uR+u[MR+u[vR]]]]%32*4;GR*=GR,M=GR*GR*(a[R]*K+a[R+1]*r+a[R+2]*Z+a[R+3]*z)}let JR=.6-b*b-I*I-V*V-t*t;if(JR<0)v=0;else{const R=u[wR+s+u[uR+O+u[MR+L+u[vR+m]]]]%32*4;JR*=JR,v=JR*JR*(a[R]*b+a[R+1]*I+a[R+2]*V+a[R+3]*t)}let yR=.6-i*i-g*g-U*U-B*B;if(yR<0)y=0;else{const R=u[wR+o+u[uR+A+u[MR+n+u[vR+Q]]]]%32*4;yR*=yR,y=yR*yR*(a[R]*i+a[R+1]*g+a[R+2]*U+a[R+3]*B)}let aR=.6-l*l-X*X-h*h-D*D;if(aR<0)j=0;else{const R=u[wR+Y+u[uR+T+u[MR+f+u[vR+c]]]]%32*4;aR*=aR,j=aR*aR*(a[R]*l+a[R+1]*X+a[R+2]*h+a[R+3]*D)}let jR=.6-p*p-RR*RR-NR*NR-qR*qR;if(jR<0)F=0;else{const R=u[wR+1+u[uR+1+u[MR+1+u[vR+1]]]]%32*4;jR*=jR,F=jR*jR*(a[R]*p+a[R+1]*RR+a[R+2]*NR+a[R+3]*qR)}return 27*(M+v+y+j+F)}}}}]);