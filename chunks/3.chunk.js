"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[3],{2042:(B,o,e)=>{e.d(o,{d:()=>w});var k=e(497),d=e(690),f=e(2033),J=e(2051),Z=e(2056),t=e(699),h=e(644),O=e(574),K=e(514);O.b.prototype.setDepthStencilTexture=function(B,o){this._engine.setDepthStencilTexture(this._samplers[B],this._uniforms[B],o,B)};class w extends f.d{get renderList(){return this._renderList}set renderList(B){this._renderList!==B&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),B&&(this._unObserveRenderList=(0,t.g)(B,this._renderListHasChanged)),this._renderList=B)}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(B){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(B)}set onBeforeRender(B){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(B)}set onAfterRender(B){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(B)}set onClear(B){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(B)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(B,o){let e;e=Array.isArray(B)?B:[B];for(let k=0;k<e.length;++k)for(let B=0;B<this._renderPassIds.length;++B)e[k].setMaterialForRenderPass(this._renderPassIds[B],void 0!==o?Array.isArray(o)?o[B]:o:void 0)}get isMulti(){var B;return(null===(B=this._renderTarget)||void 0===B?void 0:B.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(B){if(this._boundingBoxSize&&this._boundingBoxSize.equals(B))return;this._boundingBoxSize=B;const o=this.va();o&&o.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var B;return(null===(B=this._renderTarget)||void 0===B?void 0:B._depthStencilTexture)??null}constructor(B,o,e){let J,t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:f.d.TRILINEAR_SAMPLINGMODE,u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],L=arguments.length>9&&void 0!==arguments[9]&&arguments[9],H=arguments.length>10&&void 0!==arguments[10]&&arguments[10],n=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,W=arguments.length>12&&void 0!==arguments[12]&&arguments[12],R=arguments.length>13?arguments[13]:void 0,I=arguments.length>14?arguments[14]:void 0,T=arguments.length>15&&void 0!==arguments[15]&&arguments[15],s=arguments.length>16&&void 0!==arguments[16]&&arguments[16],V=!0;if("object"===typeof t){const B=t;t=!!B.generateMipMaps,h=B.doNotChangeAspectRatio??!0,O=B.type??0,K=!!B.isCube,w=B.samplingMode??f.d.TRILINEAR_SAMPLINGMODE,u=B.generateDepthBuffer??!0,L=!!B.generateStencilBuffer,H=!!B.isMulti,n=B.format??5,W=!!B.delayAllocation,R=B.samples,I=B.creationFlags,T=!!B.noColorAttachment,s=!!B.useSRGBBuffer,J=B.colorAttachment,V=B.gammaSpace??V}if(super(null,e,!t,void 0,w,void 0,void 0,void 0,void 0,n),this._unObserveRenderList=null,this._renderListHasChanged=(B,o)=>{const e=this._renderList?this._renderList.length:0;var k;(0===o&&e>0||0===e)&&(null===(k=this.va())||void 0===k||k.meshes.forEach((B=>{B._markSubMeshesAsLightDirty()})))},this.particleSystemList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new k.e,this.onAfterUnbindObservable=new k.e,this.onBeforeRenderObservable=new k.e,this.onAfterRenderObservable=new k.e,this.onClearObservable=new k.e,this.onResizeObservable=new k.e,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=d.o.Zero(),this._dumpToolsLoading=!1,!(e=this.va()))return;const Q=this.va().getEngine();this._gammaSpace=V,this._coordinatesMode=f.d.PROJECTION_MODE,this.renderList=[],this.name=B,this.isRenderTarget=!0,this._initialSizeParameter=o,this._renderPassIds=[],this._isCubeData=K,this._processSizeParameter(o),this.renderPassId=this._renderPassIds[0],this._resizeObserver=Q.onResizeObservable.add((()=>{})),this._generateMipMaps=!!t,this._doNotChangeAspectRatio=h,this._renderingManager=new Z.e(e),this._renderingManager._useSceneAutoClearSetup=!0,H||(this._renderTargetOptions={generateMipMaps:t,type:O,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:u,generateStencilBuffer:L,samples:R,creationFlags:I,noColorAttachment:T,useSRGBBuffer:s,colorAttachment:J,label:this.name},this.samplingMode===f.d.NEAREST_SAMPLINGMODE&&(this.wrapU=f.d.CLAMP_ADDRESSMODE,this.wrapV=f.d.CLAMP_ADDRESSMODE),W||(K?(this._renderTarget=e.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=f.d.INVCUBIC_MODE,this._textureMatrix=d.d.Identity()):this._renderTarget=e.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==R&&(this.samples=R)))}createDepthStencilTexture(){var B;let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],k=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,J=arguments.length>5?arguments[5]:void 0;null===(B=this._renderTarget)||void 0===B||B.createDepthStencilTexture(o,e,k,d,f,J)}_releaseRenderPassId(){if(this._scene){const B=this._scene.getEngine();for(let o=0;o<this._renderPassIds.length;++o)B.releaseRenderPassId(this._renderPassIds[o])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const B=this._scene.getEngine(),o=this._isCubeData?6:this.getRenderLayers()||1;for(let e=0;e<o;++e)this._renderPassIds[e]=B.createRenderPassId(`RenderTargetTexture - ${this.name}#${e}`)}_processSizeParameter(B){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(B.ratio){this._sizeRatio=B.ratio;const o=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(o.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(o.getRenderHeight(),this._sizeRatio)}}else this._size=B;o&&this._createRenderPassId()}get samples(){var B;return(null===(B=this._renderTarget)||void 0===B?void 0:B.samples)??this._samples}set samples(B){this._renderTarget&&(this._samples=this._renderTarget.setSamples(B))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(B){this._refreshRate=B,this.resetRefreshCounter()}addPostProcess(B){if(!this._postProcessManager){const B=this.va();if(!B)return;this._postProcessManager=new J.c(B),this._postProcesses=new Array}this._postProcesses.push(B),this._postProcesses[0].Al=!1}clearPostProcesses(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(B)for(const B of this._postProcesses)B.dispose();this._postProcesses=[]}}removePostProcess(B){if(!this._postProcesses)return;const o=this._postProcesses.indexOf(B);-1!==o&&(this._postProcesses.splice(o,1),this._postProcesses.length>0&&(this._postProcesses[0].Al=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const B=this._size.layers;if(B)return B;const o=this._size.depth;return o||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(B){const o=Math.max(1,this.getRenderSize()*B);this.resize(o)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(B){var o;const e=this.isCube;null===(o=this._renderTarget)||void 0===o||o.dispose(),this._renderTarget=null;const k=this.va();k&&(this._processSizeParameter(B,!1),this._renderTarget=e?k.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):k.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(B,o)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,e.e(9).then(e.bind(e,2181)).then((B=>this._dumpTools=B))),this._render(!1,!1,!0)}_render(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const k=this.va();if(!k)return e;const d=k.getEngine();if(void 0!==this.useCameraPostProcesses&&(B=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let B=0;B<this._waitingRenderList.length;B++){const o=this._waitingRenderList[B],e=k.getMeshById(o);e&&this.renderList.push(e)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const B=this.va();if(!B)return e;const o=B.meshes;for(let e=0;e<o.length;e++){const B=o[e];this.renderListPredicate(B)&&this.renderList.push(B)}}const f=d.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const J=this.activeCamera??k.activeCamera,Z=k.activeCamera;J&&(J!==k.activeCamera&&(k.setTransformMatrix(J.getViewMatrix(),J.getProjectionMatrix(!0)),k.activeCamera=J),d.setViewport(J.rigParent?J.rigParent.viewport:J.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let t=e;if(e){k.getViewMatrix()||k.updateTransformMatrix();const B=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let f=0;f<B&&t;f++){let B=null;const o=this.renderList?this.renderList:k.getActiveMeshes().data,J=this.renderList?this.renderList.length:k.getActiveMeshes().length;d.currentRenderPassId=this._renderPassIds[f],this.onBeforeRenderObservable.notifyObservers(f),this.getCustomRenderList&&(B=this.getCustomRenderList(f,o,J)),B||(B=o),this._doNotChangeAspectRatio||k.updateTransformMatrix(!0);for(let k=0;k<B.length&&t;++k){const o=B[k];if(o.isEnabled()&&!o.isBlocked&&o.isVisible&&o.ri)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(o,this.refreshRate,e)){t=!1;continue}}else if(!o.isReady(!0)){t=!1;continue}}this.onAfterRenderObservable.notifyObservers(f),(this.is2DArray||this.is3D||this.isCube)&&(k.incrementRenderId(),k.resetCachedMaterial())}const o=this.particleSystemList||k.ni;for(const e of o)e.isReady()||(t=!1)}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let h=0;h<6;h++)this._renderToTarget(h,B,o,void 0,J),k.incrementRenderId(),k.resetCachedMaterial();else this._renderToTarget(0,B,o,void 0,J);else for(let h=0;h<this.getRenderLayers();h++)this._renderToTarget(0,B,o,h,J),k.incrementRenderId(),k.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),d.currentRenderPassId=f,k.activeCamera=Z,Z&&(this.activeCamera&&this.activeCamera!==k.activeCamera&&k.setTransformMatrix(Z.getViewMatrix(),Z.getProjectionMatrix(!0)),d.setViewport(Z.viewport)),k.resetCachedMaterial(),t}_bestReflectionRenderTargetDimension(B,o){const e=B*o,k=(0,h.n)(e+16384/(128+e));return Math.min((0,h.c)(B),k)}_prepareRenderingManager(B,o,e,k){const d=this.va();if(!d)return;this._renderingManager.reset();const f=d.getRenderId();for(let Z=0;Z<o;Z++){const o=B[Z];if(o&&!o.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(o,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!o.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!o._internalAbstractMeshDataInfo._currentLODIsUpToDate&&e&&(o._internalAbstractMeshDataInfo._currentLOD=d.customLODSelector?d.customLODSelector(o,e):o.getLOD(e),o._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!o._internalAbstractMeshDataInfo._currentLOD)continue;let B,J=o._internalAbstractMeshDataInfo._currentLOD;if(J!==o&&0!==J.billboardMode&&J.oi(),J._preActivateForIntermediateRendering(f),B=!(!k||!e)&&0===(o.layerMask&e.layerMask),o.isEnabled()&&o.isVisible&&o.ri&&!B){if(J!==o&&J._activate(f,!0),o._activate(f,!0)&&o.ri.length){o.isAnInstance?o._internalAbstractMeshDataInfo._actAsRegularMesh&&(J=o):J._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,J._internalAbstractMeshDataInfo._isActiveIntermediate=!0,d._prepareSkeleton(J);for(let B=0;B<J.ri.length;B++){const o=J.ri[B];this._renderingManager.dispatch(o,J)}}o._postActivate()}}}const J=this.particleSystemList||d.ni;for(let Z=0;Z<J.length;Z++){const B=J[Z],o=B.j;B.isStarted()&&o&&(!o.position||o.isEnabled())&&this._renderingManager.dispatchParticles(B)}}_bindFrameBuffer(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=this.va();if(!e)return;const k=e.getEngine();this._renderTarget&&k.bindFramebuffer(this._renderTarget,this.isCube?B:void 0,void 0,void 0,this.ignoreCameraViewport,0,o)}_unbindFrameBuffer(B,o){this._renderTarget&&B.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(o)}))}_prepareFrame(B,o,e,k){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):k&&B.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(o,e)}_renderToTarget(B,o,e){var k,d;let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const Z=this.va();if(!Z)return;const t=Z.getEngine();this._prepareFrame(Z,B,f,o),null===(k=t._debugPushGroup)||void 0===k||k.call(t,`render to face #${B} layer #${f}`,2),this.is2DArray||this.is3D?(t.currentRenderPassId=this._renderPassIds[f],this.onBeforeRenderObservable.notifyObservers(f)):(t.currentRenderPassId=this._renderPassIds[B],this.onBeforeRenderObservable.notifyObservers(B));if(t.snapshotRendering&&1===t.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(t):this.skipInitialClear||t.clear(this.clearColor||Z.clearColor,!0,!0,!0);else{var h;let k=null;const d=this.renderList?this.renderList:Z.getActiveMeshes().data,O=this.renderList?this.renderList.length:Z.getActiveMeshes().length;this.getCustomRenderList&&(k=this.getCustomRenderList(this.is2DArray||this.is3D?f:B,d,O)),k?this._prepareRenderingManager(k,k.length,J,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(d,O,J,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),k=d);for(const o of Z._beforeRenderTargetClearStage)o.action(this,B,f);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(t):this.skipInitialClear||t.clear(this.clearColor||Z.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||Z.updateTransformMatrix(!0);for(const o of Z._beforeRenderTargetDrawStage)o.action(this,B,f);this._renderingManager.render(this.customRenderFunction,k,this.renderParticles,this.renderSprites);for(const o of Z._afterRenderTargetDrawStage)o.action(this,B,f);const w=(null===(h=this._texture)||void 0===h?void 0:h.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,B,this._postProcesses,this.ignoreCameraViewport):o&&Z.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,B);for(const o of Z._afterRenderTargetPostProcessStage)o.action(this,B,f);this._texture&&(this._texture.generateMipMaps=w),this._doNotChangeAspectRatio||Z.updateTransformMatrix(!0),e&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),t):K.d.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}null===(d=t._debugPopGroup)||void 0===d||d.call(t,2),this._unbindFrameBuffer(t,B),this._texture&&this.isCube&&5===B&&t.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(B){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(B,o,e,k)}setRenderingAutoClearDepthStencil(B,o){this._renderingManager.setRenderingAutoClearDepthStencil(B,o),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const B=this.getSize(),o=new w(this.name,B,this.va(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return o.zj=this.zj,o.level=this.level,o.coordinatesMode=this.coordinatesMode,this.renderList&&(o.renderList=this.renderList.slice(0)),o}serialize(){if(!this.name)return null;const B=super.serialize();if(B.renderTargetSize=this.getRenderSize(),B.renderList=[],this.renderList)for(let o=0;o<this.renderList.length;o++)B.renderList.push(this.renderList[o].id);return B}disposeFramebufferObjects(){var B;null===(B=this._renderTarget)||void 0===B||B.dispose(!0)}releaseInternalTexture(){var B;null===(B=this._renderTarget)||void 0===B||B.releaseTextures(),this._texture=null}dispose(){var B;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.va().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const o=this.va();if(!o)return;let e=o.customRenderTargets.indexOf(this);e>=0&&o.customRenderTargets.splice(e,1);for(const k of o.cameras)e=k.customRenderTargets.indexOf(this),e>=0&&k.customRenderTargets.splice(e,1);null===(B=this._renderTarget)||void 0===B||B.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===w.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=w.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}w.REFRESHRATE_RENDER_ONCE=0,w.REFRESHRATE_RENDER_ONEVERYFRAME=1,w.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,f.d._CreateRenderTargetTexture=(B,o,e,k,d)=>new w(B,o,e,k)},2072:(B,o,e)=>{e.d(o,{d:()=>h,g:()=>O});var k=e(744),d=e(726),f=e(497),J=e(574),Z=e(790);e(2081);const t={xa:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class h{constructor(B){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;this._fullscreenViewport=new d.b(0,0,1,1);const e=o.xa??t.xa,f=o.indices??t.indices;this.Fi=B,this._vertexBuffers={[k.e.PositionKind]:new k.e(B,e,k.e.PositionKind,!1,!1,2)},this._indexBuffer=B.createIndexBuffer(f),this._onContextRestoredObserver=B.onContextRestoredObservable.add((()=>{this._indexBuffer=B.createIndexBuffer(f);for(const B in this._vertexBuffers){this._vertexBuffers[B]._rebuild()}}))}setViewport(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.Fi.setViewport(B)}bindBuffers(B){this.Fi.bindBuffers(this._vertexBuffers,this._indexBuffer,B)}applyEffectWrapper(B){this.Fi.setState(!0),this.Fi.depthCullingState.depthTest=!1,this.Fi.stencilState.stencilTest=!1,this.Fi.enableEffect(B.drawWrapper),this.bindBuffers(B.effect),B.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.Fi.depthCullingState.depthTest,this._savedStateStencilTest=this.Fi.stencilState.stencilTest}restoreStates(){this.Fi.depthCullingState.depthTest=this._savedStateDepthTest,this.Fi.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.Fi.drawElementsType(0,0,6)}_isRenderTargetTexture(B){return void 0!==B.renderTarget}render(B){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!B.effect.isReady())return;this.saveStates(),this.setViewport();const e=null===o?null:this._isRenderTargetTexture(o)?o.renderTarget:o;e&&this.Fi.bindFramebuffer(e),this.applyEffectWrapper(B),this.draw(),e&&this.Fi.unBindFramebuffer(e),this.restoreStates()}dispose(){const B=this._vertexBuffers[k.e.PositionKind];B&&(B.dispose(),delete this._vertexBuffers[k.e.PositionKind]),this._indexBuffer&&this.Fi._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.Fi.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class O{static RegisterShaderCodeProcessing(B,o){o?O._CustomShaderCodeProcessing[B??""]=o:delete O._CustomShaderCodeProcessing[B??""]}static _GetShaderCodeProcessing(B){return O._CustomShaderCodeProcessing[B]??O._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(B){this.options.name=B}isReady(){var B;return(null===(B=this._drawWrapper.effect)||void 0===B?void 0:B.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(B){this._drawWrapper.effect=B}constructor(B){this.alphaMode=0,this.onEffectCreatedObservable=new f.e(void 0,!0),this.onApplyObservable=new f.e,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...B,name:B.name||"effectWrapper",Fi:B.Fi,uniforms:B.uniforms||B.uniformNames||[],uniformNames:void 0,samplers:B.samplers||B.samplerNames||[],samplerNames:void 0,attributeNames:B.attributeNames||["position"],uniformBuffers:B.uniformBuffers||[],defines:B.defines||"",useShaderStore:B.useShaderStore||!1,vertexUrl:B.vertexUrl||B.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:B.fragmentShader||"pass",indexParameters:B.indexParameters,blockCompilation:B.blockCompilation||!1,shaderLanguage:B.shaderLanguage||0,onCompiled:B.onCompiled||void 0,extraInitializations:B.extraInitializations||void 0,extraInitializationsAsync:B.extraInitializationsAsync||void 0,useAsPostProcess:B.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),B.vertexUrl||B.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.Fi.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new Z.e(this.options.Fi),this._webGPUReady=1===this.options.shaderLanguage;const o=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,o,this.options.extraInitializations)}_gatherImports(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(B&&this._webGPUReady?o.push(Promise.all([e.e(36).then(e.bind(e,12873))])):o.push(Promise.all([Promise.resolve().then(e.bind(e,2081))])))}_postConstructor(B){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,k=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,k&&this._importPromises.push(...k);const d=this.options.Fi.isWebGPU&&!O.ForceGLSL;this._gatherImports(d,this._importPromises),void 0!==e&&e(d,this._importPromises),d&&this._webGPUReady&&(this.options.shaderLanguage=1),B||this.updateEffect(o)}updateEffect(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0,Z=arguments.length>6?arguments[6]:void 0,t=arguments.length>7?arguments[7]:void 0;const h=O._GetShaderCodeProcessing(this.name);if(null!==h&&void 0!==h&&h.defineCustomBindings){var K,w;const k=(null===(K=o)||void 0===K?void 0:K.slice())??[];k.push(...this.options.uniforms);const d=(null===(w=e)||void 0===w?void 0:w.slice())??[];d.push(...this.options.samplers),B=h.defineCustomBindings(this.name,B,k,d),o=k,e=d}this.options.defines=B||"";const u=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let L;L=this.options.extraInitializationsAsync?async()=>{null===u||void 0===u||u(),await this.options.extraInitializationsAsync}:u,this.options.useShaderStore?this._drawWrapper.effect=this.options.Fi.createEffect({vertex:Z??this._shaderPath.vertex,fragment:t??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:o||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:e||this.options.samplers,defines:null!==B?B:"",fallbacks:null,onCompiled:d??this.options.onCompiled,onError:f??null,indexParameters:k||this.options.indexParameters,processCodeAfterIncludes:null!==h&&void 0!==h&&h.processCodeAfterIncludes?(B,o)=>h.processCodeAfterIncludes(this.name,B,o):null,processFinalCode:null!==h&&void 0!==h&&h.processFinalCode?(B,o)=>h.processFinalCode(this.name,B,o):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:L},this.options.Fi):this._drawWrapper.effect=new J.b(this._shaderPath,this.options.attributeNames,o||this.options.uniforms,e||this.options.samplerNames,this.options.Fi,B,void 0,d||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,L),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var B,o;this.options.useAsPostProcess&&(this.options.Fi.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(B=O._GetShaderCodeProcessing(this.name))||void 0===B||null===(o=B.bindCustomBindings)||void 0===o||o.call(B,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this.effect.dispose()}}O.ForceGLSL=!1,O._CustomShaderCodeProcessing={}},2e3:(B,o,e)=>{e.d(o,{c:()=>k.j});e(830),e(720),e(693),e(731),e(2003),e(735),e(2006);var k=e(690);e(726)},2003:(B,o,e)=>{e.d(o,{d:()=>Z,g:()=>O,j:()=>K});var k,d=e(701),f=e(690),J=e(693);!function(B){B[B.CW=0]="CW",B[B.CCW=1]="CCW"}(k||(k={}));class Z{static Interpolate(B,o,e,k,d){const f=1-3*k+3*o,J=3*k-6*o,Z=3*o;let t=B;for(let h=0;h<5;h++){const o=t*t;t-=(f*(o*t)+J*o+Z*t-B)*(1/(3*f*o+2*J*t+Z)),t=Math.min(1,Math.max(0,t))}return 3*Math.pow(1-t,2)*t*e+3*(1-t)*Math.pow(t,2)*d+Math.pow(t,3)}}class t{constructor(B){this._radians=B,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(B,o){const e=o.Ag(B),k=Math.atan2(e.y,e.x);return new t(k)}static BetweenTwoVectors(B,o){let e=B.lengthSquared()*o.lengthSquared();if(0===e)return new t(Math.PI/2);e=Math.sqrt(e);let k=B.dot(o)/e;k=(0,d.b)(k,-1,1);const f=Math.acos(k);return new t(f)}static FromRadians(B){return new t(B)}static FromDegrees(B){return new t(B*Math.PI/180)}}class h{constructor(B,o,e){this.startPoint=B,this.midPoint=o,this.endPoint=e;const k=Math.pow(o.x,2)+Math.pow(o.y,2),d=(Math.pow(B.x,2)+Math.pow(B.y,2)-k)/2,J=(k-Math.pow(e.x,2)-Math.pow(e.y,2))/2,Z=(B.x-o.x)*(o.y-e.y)-(o.x-e.x)*(B.y-o.y);this.centerPoint=new f.n((d*(o.y-e.y)-J*(B.y-o.y))/Z,((B.x-o.x)*J-(o.x-e.x)*d)/Z),this.radius=this.centerPoint.Ag(this.startPoint).length(),this.startAngle=t.BetweenTwoPoints(this.centerPoint,this.startPoint);const h=this.startAngle.degrees();let O=t.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),K=t.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();O-h>180&&(O-=360),O-h<-180&&(O+=360),K-O>180&&(K-=360),K-O<-180&&(K+=360),this.orientation=O-h<0?0:1,this.angle=t.FromDegrees(0===this.orientation?h-K:K-h)}}class O{constructor(B,o){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new f.n(B,o))}addLineTo(B,o){if(this.closed)return this;const e=new f.n(B,o),k=this._points[this._points.length-1];return this._points.push(e),this._length+=e.Ag(k).length(),this}addArcTo(B,o,e,k){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const J=this._points[this._points.length-1],Z=new f.n(B,o),t=new f.n(e,k),O=new h(J,Z,t);let K=O.angle.radians()/d;0===O.orientation&&(K*=-1);let w=O.startAngle.radians()+K;for(let f=0;f<d;f++){const B=Math.cos(w)*O.radius+O.centerPoint.x,o=Math.sin(w)*O.radius+O.centerPoint.y;this.addLineTo(B,o),w+=K}return this}addQuadraticCurveTo(B,o,e,k){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const f=(B,o,e,k)=>(1-B)*(1-B)*o+2*B*(1-B)*e+B*B*k,J=this._points[this._points.length-1];for(let Z=0;Z<=d;Z++){const t=Z/d,h=f(t,J.x,B,e),O=f(t,J.y,o,k);this.addLineTo(h,O)}return this}addBezierCurveTo(B,o,e,k,d,f){let J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const Z=(B,o,e,k,d)=>(1-B)*(1-B)*(1-B)*o+3*B*(1-B)*(1-B)*e+3*B*B*(1-B)*k+B*B*B*d,t=this._points[this._points.length-1];for(let h=0;h<=J;h++){const O=h/J,K=Z(O,t.x,B,e,d),w=Z(O,t.y,o,k,f);this.addLineTo(K,w)}return this}isPointInside(B){let o=!1;const e=this._points.length;for(let k=e-1,d=0;d<e;k=d++){let e=this._points[k],f=this._points[d],J=f.x-e.x,Z=f.y-e.y;if(Math.abs(Z)>Number.EPSILON){if(Z<0&&(e=this._points[d],J=-J,f=this._points[k],Z=-Z),B.y<e.y||B.y>f.y)continue;if(B.y===e.y&&B.x===e.x)return!0;{const k=Z*(B.x-e.x)-J*(B.y-e.y);if(0===k)return!0;if(k<0)continue;o=!o}}else{if(B.y!==e.y)continue;if(f.x<=B.x&&B.x<=e.x||e.x<=B.x&&B.x<=f.x)return!0}}return o}close(){return this.closed=!0,this}length(){let B=this._length;if(this.closed){const o=this._points[this._points.length-1];B+=this._points[0].Ag(o).length()}return B}area(){const B=this._points.length;let o=0;for(let e=B-1,k=0;k<B;e=k++)o+=this._points[e].x*this._points[k].y-this._points[k].x*this._points[e].y;return.5*o}getPoints(){return this._points}getPointAtLengthPosition(B){if(B<0||B>1)return f.n.Zero();const o=B*this.length();let e=0;for(let k=0;k<this._points.length;k++){const B=(k+1)%this._points.length,d=this._points[k],J=this._points[B].Ag(d),Z=J.length()+e;if(o>=e&&o<=Z){const B=J.normalize(),k=o-e;return new f.n(d.x+B.x*k,d.y+B.y*k)}e=Z}return f.n.Zero()}static StartingAt(B,o){return new O(B,o)}}class K{constructor(B){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=B,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:f.o.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:f.d.Identity()};for(let d=0;d<B.length;d++)this._curve[d]=B[d].clone();this._raw=e||!1,this._alignTangentsWithPath=k,this._compute(o,k)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(B){return this._updatePointAtData(B).point}getTangentAt(B){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(B,o),o?f.o.TransformCoordinates(f.o.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(B){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(B,o),o?f.o.TransformCoordinates(f.o.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(B){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(B,o),o?f.o.TransformCoordinates(f.o.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(B){return this.length()*B}getPreviousPointIndexAt(B){return this._updatePointAtData(B),this._pointAtData.previousPointArrayIndex}getSubPositionAt(B){return this._updatePointAtData(B),this._pointAtData.subPosition}getClosestPositionTo(B){let o=Number.MAX_VALUE,e=0;for(let k=0;k<this._curve.length-1;k++){const d=this._curve[k+0],J=this._curve[k+1].Ag(d).normalize(),Z=this._distances[k+1]-this._distances[k+0],t=Math.min(Math.max(f.o.Dot(J,B.Ag(d).normalize()),0)*f.o.Distance(d,B)/Z,1),h=f.o.Distance(d.add(J.scale(t*Z)),B);h<o&&(o=h,e=(this._distances[k+0]+Z*t)/this.length())}return e}slice(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(B<0&&(B=1- -1*B%1),o<0&&(o=1- -1*o%1),B>o){const e=B;B=o,o=e}const e=this.getCurve(),k=this.getPointAt(B);let d=this.getPreviousPointIndexAt(B);const f=this.getPointAt(o),J=this.getPreviousPointIndexAt(o)+1,Z=[];return 0!==B&&(d++,Z.push(k)),Z.push(...e.slice(d,J)),1===o&&1!==B||Z.push(f),new K(Z,this.getNormalAt(B),this._raw,this._alignTangentsWithPath)}update(B){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let k=0;k<B.length;k++)this._curve[k].x=B[k].x,this._curve[k].y=B[k].y,this._curve[k].z=B[k].z;return this._compute(o,e),this}_compute(B){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e=this._curve.length;if(e<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[e-1]=this._curve[e-1].Ag(this._curve[e-2]),this._raw||this._tangents[e-1].normalize();const k=this._tangents[0],d=this._normalVector(k,B);let J,Z,t,h,O;this._normals[0]=d,this._raw||this._normals[0].normalize(),this._binormals[0]=f.o.Cross(k,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let K=1;K<e;K++)J=this._getLastNonNullVector(K),K<e-1&&(Z=this._getFirstNonNullVector(K),this._tangents[K]=o?Z:J.add(Z),this._tangents[K].normalize()),this._distances[K]=this._distances[K-1]+this._curve[K].Ag(this._curve[K-1]).length(),t=this._tangents[K],O=this._binormals[K-1],this._normals[K]=f.o.Cross(O,t),this._raw||(0===this._normals[K].length()?(h=this._normals[K-1],this._normals[K]=h.clone()):this._normals[K].normalize()),this._binormals[K]=f.o.Cross(t,this._normals[K]),this._raw||this._binormals[K].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(B){let o=1,e=this._curve[B+o].Ag(this._curve[B]);for(;0===e.length()&&B+o+1<this._curve.length;)o++,e=this._curve[B+o].Ag(this._curve[B]);return e}_getLastNonNullVector(B){let o=1,e=this._curve[B].Ag(this._curve[B-o]);for(;0===e.length()&&B>o+1;)o++,e=this._curve[B].Ag(this._curve[B-o]);return e}_normalVector(B,o){let e,k=B.length();if(0===k&&(k=1),void 0===o||null===o){let o;o=(0,d.x)(Math.abs(B.y)/k,1,J.c)?(0,d.x)(Math.abs(B.x)/k,1,J.c)?(0,d.x)(Math.abs(B.z)/k,1,J.c)?f.o.Zero():new f.o(0,0,1):new f.o(1,0,0):new f.o(0,-1,0),e=f.o.Cross(B,o)}else e=f.o.Cross(B,o),f.o.CrossToRef(e,B,e);return e.normalize(),e}_updatePointAtData(B){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===B)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=B;const e=this.getPoints();if(B<=0)return this._setPointAtData(0,0,e[0],0,o);if(B>=1)return this._setPointAtData(1,1,e[e.length-1],e.length-1,o);let k,d=e[0],J=0;const Z=B*this.length();for(let t=1;t<e.length;t++){k=e[t];const h=f.o.Distance(d,k);if(J+=h,J===Z)return this._setPointAtData(B,1,k,t,o);if(J>Z){const e=(J-Z)/h,f=d.Ag(k),O=k.add(f.scaleInPlace(e));return this._setPointAtData(B,1-e,O,t-1,o)}d=k}return this._pointAtData}_setPointAtData(B,o,e,k,d){return this._pointAtData.point=e,this._pointAtData.position=B,this._pointAtData.subPosition=o,this._pointAtData.previousPointArrayIndex=k,this._pointAtData.interpolateReady=d,d&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=f.d.Identity();const B=this._pointAtData.previousPointArrayIndex;if(B!==this._tangents.length-1){const o=B+1,e=this._tangents[B].clone(),k=this._normals[B].clone(),d=this._binormals[B].clone(),J=this._tangents[o].clone(),Z=this._normals[o].clone(),t=this._binormals[o].clone(),h=f.f.RotationQuaternionFromAxis(k,d,e),O=f.f.RotationQuaternionFromAxis(Z,t,J);f.f.Slerp(h,O,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},1996:(B,o,e)=>{e.d(o,{d:()=>h,g:()=>O});var k=e(690),d=e(2e3);const f=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],J=[()=>1,B=>B.y,B=>B.z,B=>B.x,B=>B.x*B.y,B=>B.y*B.z,B=>3*B.z*B.z-1,B=>B.x*B.z,B=>B.x*B.x-B.y*B.y],Z=(B,o)=>f[B]*J[B](o),t=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class h{constructor(){this.preScaled=!1,this.l00=k.o.Zero(),this.l1_1=k.o.Zero(),this.l10=k.o.Zero(),this.l11=k.o.Zero(),this.l2_2=k.o.Zero(),this.l2_1=k.o.Zero(),this.l20=k.o.Zero(),this.l21=k.o.Zero(),this.l22=k.o.Zero()}addLight(B,o,e){d.c.Ni[0].set(o.r,o.g,o.b);const k=d.c.Ni[0],f=d.c.Ni[1];k.scaleToRef(e,f),f.scaleToRef(Z(0,B),d.c.Ni[2]),this.l00.addInPlace(d.c.Ni[2]),f.scaleToRef(Z(1,B),d.c.Ni[2]),this.l1_1.addInPlace(d.c.Ni[2]),f.scaleToRef(Z(2,B),d.c.Ni[2]),this.l10.addInPlace(d.c.Ni[2]),f.scaleToRef(Z(3,B),d.c.Ni[2]),this.l11.addInPlace(d.c.Ni[2]),f.scaleToRef(Z(4,B),d.c.Ni[2]),this.l2_2.addInPlace(d.c.Ni[2]),f.scaleToRef(Z(5,B),d.c.Ni[2]),this.l2_1.addInPlace(d.c.Ni[2]),f.scaleToRef(Z(6,B),d.c.Ni[2]),this.l20.addInPlace(d.c.Ni[2]),f.scaleToRef(Z(7,B),d.c.Ni[2]),this.l21.addInPlace(d.c.Ni[2]),f.scaleToRef(Z(8,B),d.c.Ni[2]),this.l22.addInPlace(d.c.Ni[2])}scaleInPlace(B){this.l00.scaleInPlace(B),this.l1_1.scaleInPlace(B),this.l10.scaleInPlace(B),this.l11.scaleInPlace(B),this.l2_2.scaleInPlace(B),this.l2_1.scaleInPlace(B),this.l20.scaleInPlace(B),this.l21.scaleInPlace(B),this.l22.scaleInPlace(B)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(t[0]),this.l1_1.scaleInPlace(t[1]),this.l10.scaleInPlace(t[2]),this.l11.scaleInPlace(t[3]),this.l2_2.scaleInPlace(t[4]),this.l2_1.scaleInPlace(t[5]),this.l20.scaleInPlace(t[6]),this.l21.scaleInPlace(t[7]),this.l22.scaleInPlace(t[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(f[0]),this.l1_1.scaleInPlace(f[1]),this.l10.scaleInPlace(f[2]),this.l11.scaleInPlace(f[3]),this.l2_2.scaleInPlace(f[4]),this.l2_1.scaleInPlace(f[5]),this.l20.scaleInPlace(f[6]),this.l21.scaleInPlace(f[7]),this.l22.scaleInPlace(f[8])}updateFromArray(B){return k.o.FromArrayToRef(B[0],0,this.l00),k.o.FromArrayToRef(B[1],0,this.l1_1),k.o.FromArrayToRef(B[2],0,this.l10),k.o.FromArrayToRef(B[3],0,this.l11),k.o.FromArrayToRef(B[4],0,this.l2_2),k.o.FromArrayToRef(B[5],0,this.l2_1),k.o.FromArrayToRef(B[6],0,this.l20),k.o.FromArrayToRef(B[7],0,this.l21),k.o.FromArrayToRef(B[8],0,this.l22),this}updateFromFloatsArray(B){return k.o.FromFloatsToRef(B[0],B[1],B[2],this.l00),k.o.FromFloatsToRef(B[3],B[4],B[5],this.l1_1),k.o.FromFloatsToRef(B[6],B[7],B[8],this.l10),k.o.FromFloatsToRef(B[9],B[10],B[11],this.l11),k.o.FromFloatsToRef(B[12],B[13],B[14],this.l2_2),k.o.FromFloatsToRef(B[15],B[16],B[17],this.l2_1),k.o.FromFloatsToRef(B[18],B[19],B[20],this.l20),k.o.FromFloatsToRef(B[21],B[22],B[23],this.l21),k.o.FromFloatsToRef(B[24],B[25],B[26],this.l22),this}static ui(B){return(new h).updateFromArray(B)}static FromPolynomial(B){const o=new h;return o.l00=B.xx.scale(.376127).add(B.yy.scale(.376127)).add(B.zz.scale(.376126)),o.l1_1=B.y.scale(.977204),o.l10=B.z.scale(.977204),o.l11=B.x.scale(.977204),o.l2_2=B.xy.scale(1.16538),o.l2_1=B.yz.scale(1.16538),o.l20=B.zz.scale(1.34567).Ag(B.xx.scale(.672834)).Ag(B.yy.scale(.672834)),o.l21=B.zx.scale(1.16538),o.l22=B.xx.scale(1.16538).Ag(B.yy.scale(1.16538)),o.l1_1.scaleInPlace(-1),o.l11.scaleInPlace(-1),o.l2_1.scaleInPlace(-1),o.l21.scaleInPlace(-1),o.scaleInPlace(Math.PI),o}}class O{constructor(){this.x=k.o.Zero(),this.y=k.o.Zero(),this.z=k.o.Zero(),this.xx=k.o.Zero(),this.yy=k.o.Zero(),this.zz=k.o.Zero(),this.xy=k.o.Zero(),this.yz=k.o.Zero(),this.zx=k.o.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=h.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(B){d.c.Ni[0].ji(B.r,B.g,B.b);const o=d.c.Ni[0];this.xx.addInPlace(o),this.yy.addInPlace(o),this.zz.addInPlace(o)}scaleInPlace(B){this.x.scaleInPlace(B),this.y.scaleInPlace(B),this.z.scaleInPlace(B),this.xx.scaleInPlace(B),this.yy.scaleInPlace(B),this.zz.scaleInPlace(B),this.yz.scaleInPlace(B),this.zx.scaleInPlace(B),this.xy.scaleInPlace(B)}updateFromHarmonics(B){return this._harmonics=B,this.x.p(B.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.p(B.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.p(B.l10),this.z.scaleInPlace(1.02333),this.xx.p(B.l00),d.c.Ni[0].p(B.l20).scaleInPlace(.247708),d.c.Ni[1].p(B.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).Mi(d.c.Ni[0]).addInPlace(d.c.Ni[1]),this.yy.p(B.l00),this.yy.scaleInPlace(.886277).Mi(d.c.Ni[0]).Mi(d.c.Ni[1]),this.zz.p(B.l00),d.c.Ni[0].p(B.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(d.c.Ni[0]),this.yz.p(B.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.p(B.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.p(B.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(B){return(new O).updateFromHarmonics(B)}static ui(B){const o=new O;return k.o.FromArrayToRef(B[0],0,o.x),k.o.FromArrayToRef(B[1],0,o.y),k.o.FromArrayToRef(B[2],0,o.z),k.o.FromArrayToRef(B[3],0,o.xx),k.o.FromArrayToRef(B[4],0,o.yy),k.o.FromArrayToRef(B[5],0,o.zz),k.o.FromArrayToRef(B[6],0,o.yz),k.o.FromArrayToRef(B[7],0,o.zx),k.o.FromArrayToRef(B[8],0,o.xy),o}}},2015:(B,o,e)=>{e.d(o,{c:()=>h});var k=e(690),d=e(701),f=e(1996),J=e(693),Z=e(720);class t{constructor(B,o,e,k){this.name=B,this.worldAxisForNormal=o,this.worldAxisForFileX=e,this.worldAxisForFileY=k}}class h{static ConvertCubeMapTextureToSphericalPolynomial(B){var o;if(!B.isCube)return null;null===(o=B.va())||void 0===o||o.getEngine().flushFramebuffer();const e=B.getSize().width,k=B.readPixels(0,void 0,void 0,!1),d=B.readPixels(1,void 0,void 0,!1);let f,J;B.isRenderTarget?(f=B.readPixels(3,void 0,void 0,!1),J=B.readPixels(2,void 0,void 0,!1)):(f=B.readPixels(2,void 0,void 0,!1),J=B.readPixels(3,void 0,void 0,!1));const Z=B.readPixels(4,void 0,void 0,!1),t=B.readPixels(5,void 0,void 0,!1),h=B.gammaSpace;let O=0;return 1!=B.textureType&&2!=B.textureType||(O=1),new Promise((B=>{Promise.all([d,k,f,J,Z,t]).then((o=>{let[k,d,f,J,Z,t]=o;const K={size:e,right:d,left:k,up:f,down:J,front:Z,back:t,format:5,type:O,gammaSpace:h};B(this.ConvertCubeMapToSphericalPolynomial(K))}))}))}static _AreaElement(B,o){return Math.atan2(B*o,Math.sqrt(B*B+o*o+1))}static ConvertCubeMapToSphericalPolynomial(B){const o=new f.d;let e=0;const k=2/B.size,t=k,h=.5*k,O=h-1;for(let f=0;f<6;f++){const K=this._FileFaces[f],w=B[K.name];let u=O;const L=5===B.format?4:3;for(let f=0;f<B.size;f++){let H=O;for(let t=0;t<B.size;t++){const O=K.worldAxisForFileX.scale(H).add(K.worldAxisForFileY.scale(u)).add(K.worldAxisForNormal);O.normalize();const n=this._AreaElement(H-h,u-h)-this._AreaElement(H-h,u+h)-this._AreaElement(H+h,u-h)+this._AreaElement(H+h,u+h);let W=w[f*B.size*L+t*L+0],R=w[f*B.size*L+t*L+1],I=w[f*B.size*L+t*L+2];isNaN(W)&&(W=0),isNaN(R)&&(R=0),isNaN(I)&&(I=0),0===B.type&&(W/=255,R/=255,I/=255),B.gammaSpace&&(W=Math.pow((0,d.b)(W),J.g),R=Math.pow((0,d.b)(R),J.g),I=Math.pow((0,d.b)(I),J.g));const T=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const B=Math.max(W,R,I);if(B>T){const o=T/B;W*=o,R*=o,I*=o}}else W=(0,d.b)(W,0,T),R=(0,d.b)(R,0,T),I=(0,d.b)(I,0,T);const s=new Z.b(W,R,I);o.addLight(O,s,n),e+=n,H+=k}u+=t}}const K=6*(4*Math.PI)/6/e;return o.scaleInPlace(K),o.convertIncidentRadianceToIrradiance(),o.convertIrradianceToLambertianRadiance(),f.g.FromHarmonics(o)}}h._FileFaces=[new t("right",new k.o(1,0,0),new k.o(0,0,-1),new k.o(0,-1,0)),new t("left",new k.o(-1,0,0),new k.o(0,0,1),new k.o(0,-1,0)),new t("up",new k.o(0,1,0),new k.o(1,0,0),new k.o(0,0,1)),new t("down",new k.o(0,-1,0),new k.o(1,0,0),new k.o(0,0,-1)),new t("front",new k.o(0,0,1),new k.o(1,0,0),new k.o(0,-1,0)),new t("back",new k.o(0,0,-1),new k.o(-1,0,0),new k.o(0,-1,0))],h.MAX_HDRI_VALUE=4096,h.PRESERVE_CLAMPED_COLORS=!1},2024:(B,o,e)=>{e.d(o,{c:()=>t,e:()=>w,f:()=>K});e(2033),e(2042);var k=e(2064),d=e(569),f=e(635),J=e(712);class Z extends k.e{getClassName(){return"PassPostProcess"}constructor(B,o){super(B,"pass",null,null,o,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(B,o){B?(this._webGPUReady=!0,o.push(Promise.all([e.e(32).then(e.bind(e,12848))]))):o.push(Promise.all([e.e(33).then(e.bind(e,12855))])),super._gatherImports(B,o)}static _Parse(B,o,e,k){return J.d.Parse((()=>new Z(B.name,B.options,o,B.renderTargetSamplingMode,B._engine,B.reusable)),B,e,k)}}(0,f.f)("BABYLON.PassPostProcess",Z);k.e;function t(B,o,e,d,f,J,Z,t){const h=o.getEngine();return o.isReady=!1,f=f??o.samplingMode,d=d??o.type,J=J??o.format,Z=Z??o.width,t=t??o.height,-1===d&&(d=0),new Promise((O=>{const K=new k.e("postprocess",B,null,null,1,null,f,h,!1,void 0,d,void 0,null,!1,J);K.externalTextureSamplerBinding=!0;const w=h.createRenderTargetTexture({width:Z,height:t},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:f,type:d,format:J});K.onEffectCreatedObservable.addOnce((B=>{B.executeWhenCompiled((()=>{K.onApply=B=>{B._bindTexture("textureSampler",o),B.setFloat2("scale",1,1)},e.postProcessManager.directRender([K],w,!0),h.restoreDefaultFramebuffer(),h._releaseTexture(o),K&&K.dispose(),w._swapAndDie(o),o.type=d,o.format=5,o.isReady=!0,O(o)}))}))}))}let h,O;function K(B){h||(h=new Float32Array(1),O=new Int32Array(h.buffer)),h[0]=B;const o=O[0];let e=o>>16&32768,k=o>>12&2047;const d=o>>23&255;return d<103?e:d>142?(e|=31744,e|=(255==d?0:1)&&8388607&o,e):d<113?(k|=2048,e|=(k>>114-d)+(k>>113-d&1),e):(e|=d-112<<10|k>>1,e+=1&k,e)}function w(B){const o=(32768&B)>>15,e=(31744&B)>>10,k=1023&B;return 0===e?(o?-1:1)*Math.pow(2,-14)*(k/Math.pow(2,10)):31==e?k?NaN:1/0*(o?-1:1):(o?-1:1)*Math.pow(2,e-15)*(1+k/Math.pow(2,10))}d.e._RescalePostProcessFactory=B=>new Z("rescale",1,null,2,B,!1,0)},2064:(B,o,e)=>{e.d(o,{e:()=>L});var k=e(665),d=e(681),f=e(497),J=e(690),Z=e(574),t=e(672),h=e(712),O=e(635),K=e(569),w=e(644),u=e(2072);K.e.prototype.setTextureFromPostProcess=function(B,o,e){var k;let d=null;o&&(o._forcedOutputTexture?d=o._forcedOutputTexture:o._textures.data[o._currentRenderTextureInd]&&(d=o._textures.data[o._currentRenderTextureInd])),this._bindTexture(B,(null===(k=d)||void 0===k?void 0:k.texture)??null,e)},K.e.prototype.setTextureFromPostProcessOutput=function(B,o,e){var k;this._bindTexture(B,(null===o||void 0===o||null===(k=o._outputTexture)||void 0===k?void 0:k.texture)??null,e)},Z.b.prototype.setTextureFromPostProcess=function(B,o){this._engine.setTextureFromPostProcess(this._samplers[B],o,B)},Z.b.prototype.setTextureFromPostProcessOutput=function(B,o){this._engine.setTextureFromPostProcessOutput(this._samplers[B],o,B)};class L{static get ForceGLSL(){return u.g.ForceGLSL}static set ForceGLSL(B){u.g.ForceGLSL=B}static RegisterShaderCodeProcessing(B,o){u.g.RegisterShaderCodeProcessing(B,o)}get name(){return this._effectWrapper.name}set name(B){this._effectWrapper.name=B}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(B){this._effectWrapper.alphaMode=B}get samples(){return this._samples}set samples(B){this._samples=Math.min(B,this._engine.getCaps().maxMSAASamples),this._textures.forEach((B=>{B.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(B){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),B&&(this._onActivateObserver=this.onActivateObservable.add(B))}set onSizeChanged(B){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(B)}set onApply(B){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(B)}set onBeforeRender(B){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(B)}set onAfterRender(B){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(B)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(B){this._forcedOutputTexture=B}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.ji(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(B,o,e,k,Z,t){var h;let O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,K=arguments.length>7?arguments[7]:void 0,w=arguments.length>8?arguments[8]:void 0,H=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,n=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,W=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",R=arguments.length>12?arguments[12]:void 0,I=arguments.length>13&&void 0!==arguments[13]&&arguments[13],T=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,s=arguments.length>15?arguments[15]:void 0,V=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.Al=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new d.g(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new J.n(1,1),this._texelSize=J.n.Zero(),this.onActivateObservable=new f.e,this.onSizeChangedObservable=new f.e,this.onApplyObservable=new f.e,this.onBeforeRenderObservable=new f.e,this.onAfterRenderObservable=new f.e;let Q,p=1,X=null;if(e&&!Array.isArray(e)){const B=e;e=B.uniforms??null,k=B.samplers??null,p=B.size??1,t=B.camera??null,O=B.samplingMode??1,K=B.Fi,w=B.reusable,H=Array.isArray(B.defines)?B.defines.join("\n"):B.defines??null,n=B.textureType??0,W=B.vertexUrl??"postprocess",R=B.indexParameters,I=B.blockCompilation??!1,T=B.textureFormat??5,s=B.shaderLanguage??0,X=B.uniformBuffers??null,V=B.extraInitializations,Q=B.effectWrapper}else Z&&(p="number"===typeof Z?Z:{width:Z.width,height:Z.height});const l=!!Q;if(this._effectWrapper=Q??new u.g({name:B,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:o,Fi:K||(null===(h=t)||void 0===h?void 0:h.va().getEngine()),uniforms:e,samplers:k,uniformBuffers:X,defines:H,vertexUrl:W,indexParameters:R,blockCompilation:I,shaderLanguage:s,extraInitializations:V}),this.name=B,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=t?(this._camera=t,this._scene=t.va(),t.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):K&&(this._engine=K,this._engine.postProcesses.push(this)),this._options=p,this.renderTargetSamplingMode=O||1,this._reusable=w||!1,this._textureType=n,this._textureFormat=T,this._shaderLanguage=s||0,this._samplers=k||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=o,this._vertexUrl=W,this._parameters=e||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=X||[],this._indexParameters=R,!l){this._webGPUReady=1===this._shaderLanguage;const B=[];this._gatherImports(this._engine.isWebGPU&&!L.ForceGLSL,B),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(I,H,V,B)}}_gatherImports(){let B=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?B.push(Promise.all([e.e(36).then(e.bind(e,12873))])):B.push(Promise.all([Promise.resolve().then(e.bind(e,2081))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(B){return this._disposeTextures(),this._shareOutputWithPostProcess=B,this}useOwnOutput(){0==this._textures.length&&(this._textures=new d.g(2)),this._shareOutputWithPostProcess=null}updateEffect(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0,J=arguments.length>6?arguments[6]:void 0,Z=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(B,o,e,k,d,f,J,Z),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(B,o){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let d=0;d<this._textureCache.length;d++)if(this._textureCache[d].texture.width===B.width&&this._textureCache[d].texture.height===B.height&&this._textureCache[d].postProcessChannel===e&&this._textureCache[d].texture._generateDepthBuffer===o.generateDepthBuffer&&this._textureCache[d].texture.samples===o.samples)return this._textureCache[d].texture;const k=this._engine.createRenderTargetTexture(B,o);return this._textureCache.push({texture:k,postProcessChannel:e,lastUsedRenderId:-1}),k}_flushTextureCache(){const B=this._renderId;for(let o=this._textureCache.length-1;o>=0;o--)if(B-this._textureCache[o].lastUsedRenderId>100){let B=!1;for(let e=0;e<this._textures.length;e++)if(this._textures.data[e]===this._textureCache[o].texture){B=!0;break}B||(this._textureCache[o].texture.dispose(),this._textureCache.splice(o,1))}}resize(B,o){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=B,this.height=o;let f=null;if(e)for(let t=0;t<e._postProcesses.length;t++)if(null!==e._postProcesses[t]){f=e._postProcesses[t];break}const J={width:this.width,height:this.height},Z={generateMipMaps:k,generateDepthBuffer:d||f===this,generateStencilBuffer:(d||f===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(J,Z,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(J,Z,1)),this._texelSize.ji(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let B;if(this._shareOutputWithPostProcess)B=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)B=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let o;B=this.inputTexture;for(let e=0;e<this._textureCache.length;e++)if(this._textureCache[e].texture===B){o=this._textureCache[e];break}o&&(o.lastUsedRenderId=this._renderId)}return B}activate(B){var o,e;let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0;const f=(B=B||this._camera).va(),J=f.getEngine(),Z=J.getCaps().maxTextureSize,t=(k?k.width:this._engine.getRenderWidth(!0))*this._options|0,h=(k?k.height:this._engine.getRenderHeight(!0))*this._options|0;let O=this._options.width||t,K=this._options.height||h;const u=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let L=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const B=J.currentViewport;B&&(O*=B.width,K*=B.height)}(u||this.alwaysForcePOT)&&(this._options.width||(O=J.needPOTTextures?(0,w.f)(O,Z,this.scaleMode):O),this._options.height||(K=J.needPOTTextures?(0,w.f)(K,Z,this.scaleMode):K)),this.width===O&&this.height===K&&(L=this._getTarget())||this.resize(O,K,B,u,d),this._textures.forEach((B=>{B.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(B,this.samples)})),this._flushTextureCache(),this._renderId++}return L||(L=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.ji(t/O,h/K),this._engine.bindFramebuffer(L,0,t,h,this.forceFullscreenViewport)):(this._scaleRatio.ji(1,1),this._engine.bindFramebuffer(L,0,void 0,void 0,this.forceFullscreenViewport)),null===(o=(e=this._engine)._debugInsertMarker)||void 0===o||o.call(e,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(B),this.Al&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:f.clearColor,f._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),L}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let B;var o;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),B=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(o=B)||void 0===o?void 0:o.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let B=this._textureCache.length-1;B>=0;B--)this._textureCache[B].texture.dispose();this._textureCache.length=0}setPrePassRenderer(B){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=B.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(B){let o;if(B=B||this._camera,this._disposeTextures(),this._scene&&(o=this._scene.postProcesses.indexOf(this),-1!==o&&this._scene.postProcesses.splice(o,1)),this._parentContainer){const B=this._parentContainer.postProcesses.indexOf(this);B>-1&&this._parentContainer.postProcesses.splice(B,1),this._parentContainer=null}if(o=this._engine.postProcesses.indexOf(this),-1!==o&&this._engine.postProcesses.splice(o,1),B){if(B.detachPostProcess(this),o=B._postProcesses.indexOf(this),0===o&&B._postProcesses.length>0){const B=this._camera._getFirstPostProcess();B&&B.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const B=h.d.Serialize(this),o=this.getCamera()||this._scene&&this._scene.activeCamera;return B.customType="BABYLON."+this.getClassName(),B.cameraId=o?o.id:null,B.reusable=this._reusable,B.textureType=this._textureType,B.fragmentUrl=this._fragmentUrl,B.parameters=this._parameters,B.samplers=this._samplers,B.uniformBuffers=this._uniformBuffers,B.options=this._options,B.defines=this._postProcessDefines,B.textureFormat=this._textureFormat,B.vertexUrl=this._vertexUrl,B.indexParameters=this._indexParameters,B}clone(){const B=this.serialize();B._engine=this._engine,B.cameraId=null;const o=L.Parse(B,this._scene,"");return o?(o.onActivateObservable=this.onActivateObservable.clone(),o.onSizeChangedObservable=this.onSizeChangedObservable.clone(),o.onApplyObservable=this.onApplyObservable.clone(),o.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),o.onAfterRenderObservable=this.onAfterRenderObservable.clone(),o._prePassEffectConfiguration=this._prePassEffectConfiguration,o):null}static Parse(B,o,e){const k=(0,O.b)(B.customType);if(!k||!k._Parse)return null;const d=o?o.getCameraById(B.cameraId):null;return k._Parse(B,d,o,e)}static _Parse(B,o,e,k){return h.d.Parse((()=>new L(B.name,B.fragmentUrl,B.parameters,B.samplers,B.options,o,B.renderTargetSamplingMode,B._engine,B.reusable,B.defines,B.textureType,B.vertexUrl,B.indexParameters,!1,B.textureFormat)),B,e,k)}}(0,k.b)([(0,t.C)()],L.prototype,"uniqueId",void 0),(0,k.b)([(0,t.C)()],L.prototype,"name",null),(0,k.b)([(0,t.C)()],L.prototype,"width",void 0),(0,k.b)([(0,t.C)()],L.prototype,"height",void 0),(0,k.b)([(0,t.C)()],L.prototype,"renderTargetSamplingMode",void 0),(0,k.b)([(0,t.o)()],L.prototype,"clearColor",void 0),(0,k.b)([(0,t.C)()],L.prototype,"Al",void 0),(0,k.b)([(0,t.C)()],L.prototype,"forceAutoClearInAlphaMode",void 0),(0,k.b)([(0,t.C)()],L.prototype,"alphaMode",null),(0,k.b)([(0,t.C)()],L.prototype,"alphaConstants",void 0),(0,k.b)([(0,t.C)()],L.prototype,"enablePixelPerfectMode",void 0),(0,k.b)([(0,t.C)()],L.prototype,"forceFullscreenViewport",void 0),(0,k.b)([(0,t.C)()],L.prototype,"scaleMode",void 0),(0,k.b)([(0,t.C)()],L.prototype,"alwaysForcePOT",void 0),(0,k.b)([(0,t.C)("samples")],L.prototype,"_samples",void 0),(0,k.b)([(0,t.C)()],L.prototype,"adaptScaleToCurrentViewport",void 0),(0,O.f)("BABYLON.PostProcess",L)},2051:(B,o,e)=>{e.d(o,{c:()=>f});var k=e(744),d=e(497);class f{constructor(B){this._vertexBuffers={},this.onBeforeRenderObservable=new d.e,this._scene=B}_prepareBuffers(){if(this._vertexBuffers[k.e.PositionKind])return;const B=[];B.push(1,1),B.push(-1,1),B.push(-1,-1),B.push(1,-1),this._vertexBuffers[k.e.PositionKind]=new k.e(this._scene.getEngine(),B,k.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const B=[];B.push(0),B.push(1),B.push(2),B.push(0),B.push(2),B.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(B)}_rebuild(){const B=this._vertexBuffers[k.e.PositionKind];B&&(B._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=this._scene.activeCamera;return!!e&&(o=o||e._postProcesses.filter((B=>null!=B)),!(!o||0===o.length||!this._scene.postProcessesEnabled)&&(o[0].activate(e,B,null!==o&&void 0!==o),!0))}directRender(B){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const J=this._scene.getEngine();for(let t=0;t<B.length;t++){var Z;if(t<B.length-1)B[t+1].activate(this._scene.activeCamera,null===o||void 0===o?void 0:o.texture);else o?J.bindFramebuffer(o,k,void 0,void 0,e,d):f||J.restoreDefaultFramebuffer(),null===(Z=J._debugInsertMarker)||void 0===Z||Z.call(J,`post process ${B[t].name} output`);const h=B[t],O=h.apply();O&&(h.onBeforeRenderObservable.notifyObservers(O),this._prepareBuffers(),J.bindBuffers(this._vertexBuffers,this._indexBuffer,O),J.drawElementsType(0,0,6),h.onAfterRenderObservable.notifyObservers(O))}J.setDepthBuffer(!0),J.setDepthWrite(!0)}_finalizeFrame(B,o,e,k){let d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const f=this._scene.activeCamera;if(!f)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(k=k||f._postProcesses.filter((B=>null!=B))).length||!this._scene.postProcessesEnabled)return;const J=this._scene.getEngine();for(let t=0,h=k.length;t<h;t++){const O=k[t];var Z;if(t<h-1)O._outputTexture=k[t+1].activate(f,null===o||void 0===o?void 0:o.texture);else o?(J.bindFramebuffer(o,e,void 0,void 0,d),O._outputTexture=o):(J.restoreDefaultFramebuffer(),O._outputTexture=null),null===(Z=J._debugInsertMarker)||void 0===Z||Z.call(J,`post process ${k[t].name} output`);if(B)break;const K=O.apply();K&&(O.onBeforeRenderObservable.notifyObservers(K),this._prepareBuffers(),J.bindBuffers(this._vertexBuffers,this._indexBuffer,K),J.drawElementsType(0,0,6),O.onAfterRenderObservable.notifyObservers(K))}J.setDepthBuffer(!0),J.setDepthWrite(!0),J.setAlphaMode(0)}dispose(){const B=this._vertexBuffers[k.e.PositionKind];B&&(B.dispose(),this._vertexBuffers[k.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},2056:(B,o,e)=>{e.d(o,{e:()=>Z});var k=e(681),d=e(690);class f{set opaqueSortCompareFn(B){this._opaqueSortCompareFn=B||f.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(B){this._alphaTestSortCompareFn=B||f.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(B){this._transparentSortCompareFn=B||f.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(B,o){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=B,this._opaqueSubMeshes=new k.g(256),this._transparentSubMeshes=new k.g(256),this._alphaTestSubMeshes=new k.g(256),this._depthOnlySubMeshes=new k.g(256),this._particleSystems=new k.g(256),this._spriteManagers=new k.g(256),this._empty=!0,this._edgesRenderers=new k.c(16),this._scene=o,this.opaqueSortCompareFn=e,this.alphaTestSortCompareFn=d,this.transparentSortCompareFn=f}render(B,o,e,k){if(B)return void B(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const d=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(d.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),d.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const f=d.getStencilBuffer();if(d.setStencilBuffer(!1),o&&this._renderSprites(),e&&this._renderParticles(k),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(d.setStencilBuffer(f),this._scene.useOrderIndependentTransparency){const B=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);B.length&&this._renderTransparent(B)}else this._renderTransparent(this._transparentSubMeshes);d.setAlphaMode(0)}if(d.setStencilBuffer(!1),this._edgesRenderers.length){for(let B=0;B<this._edgesRenderers.length;B++)this._edgesRenderers.data[B].render();d.setAlphaMode(0)}d.setStencilBuffer(f)}_renderOpaqueSorted(B){f._RenderSorted(B,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(B){f._RenderSorted(B,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(B){f._RenderSorted(B,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(B,o,e,k){let J,Z=0;const t=e?e.globalPosition:f._ZeroVector;if(k)for(;Z<B.length;Z++)J=B.data[Z],J._alphaIndex=J.getMesh().alphaIndex,J._distanceToCamera=d.o.Distance(J.getBoundingInfo().boundingSphere.centerWorld,t);const h=B.length===B.data.length?B.data:B.data.slice(0,B.length);o&&h.sort(o);const O=h[0].getMesh().va();for(Z=0;Z<h.length;Z++)if(J=h[Z],!O._activeMeshesFrozenButKeepClipping||J.isInFrustum(O._frustumPlanes)){if(k){const B=J.Ha();if(B&&B.needDepthPrePass){const o=B.va().getEngine();o.setColorWrite(!1),o.setAlphaMode(0),J.render(!1),o.setColorWrite(!0)}}J.render(k)}}static defaultTransparentSortCompare(B,o){return B._alphaIndex>o._alphaIndex?1:B._alphaIndex<o._alphaIndex?-1:f.backToFrontSortCompare(B,o)}static backToFrontSortCompare(B,o){return B._distanceToCamera<o._distanceToCamera?1:B._distanceToCamera>o._distanceToCamera?-1:0}static frontToBackSortCompare(B,o){return B._distanceToCamera<o._distanceToCamera?-1:B._distanceToCamera>o._distanceToCamera?1:0}static PainterSortCompare(B,o){const e=B.getMesh(),k=o.getMesh();return e.material&&k.material?e.material.uniqueId-k.material.uniqueId:e.uniqueId-k.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(B,o,e){void 0===o&&(o=B.getMesh()),void 0===e&&(e=B.Ha()),null!==e&&void 0!==e&&(e.needAlphaBlendingForMesh(o)?this._transparentSubMeshes.push(B):e.needAlphaTesting()?(e.needDepthPrePass&&this._depthOnlySubMeshes.push(B),this._alphaTestSubMeshes.push(B)):(e.needDepthPrePass&&this._depthOnlySubMeshes.push(B),this._opaqueSubMeshes.push(B)),o._renderingGroup=this,o._edgesRenderer&&o.isEnabled()&&o.isVisible&&o._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(o._edgesRenderer),this._empty=!1)}dispatchSprites(B){this._spriteManagers.push(B),this._empty=!1}dispatchParticles(B){this._particleSystems.push(B),this._empty=!1}_renderParticles(B){if(0===this._particleSystems.length)return;const o=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let e=0;e<this._particleSystems.length;e++){const k=this._particleSystems.data[e];if(0===(o&&o.layerMask&k.layerMask))continue;const d=k.j;d.position&&B&&-1===B.indexOf(d)||this._scene._activeParticles.addCount(k.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const B=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let o=0;o<this._spriteManagers.length;o++){const e=this._spriteManagers.data[o];0!==(B&&B.layerMask&e.layerMask)&&e.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}f._ZeroVector=d.o.Zero();class J{}class Z{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(B){B!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=B,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const B of this._scene.meshes)if(B.ri)for(const o of B.ri)o._wasDispatched=!1;if(this._scene.spriteManagers)for(const B of this._scene.spriteManagers)B._wasDispatched=!1;for(const B of this._scene.ni)B._wasDispatched=!1}constructor(B){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new J,this._maintainStateBetweenFrames=!1,this._scene=B;for(let o=Z.MIN_RENDERINGGROUPS;o<Z.MAX_RENDERINGGROUPS;o++)this._autoClearDepthStencil[o]={Al:!0,depth:!0,stencil:!0}}getRenderingGroup(B){const o=B||0;return this._prepareRenderingGroup(o),this._renderingGroups[o]}_clearDepthStencilBuffer(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,B,o),this._depthStencilBufferAlreadyCleaned=!0)}render(B,o,e,k){const d=this._renderingGroupInfo;if(d.ei=this._scene,d.camera=this._scene.activeCamera,this._scene.spriteManagers&&k)for(let f=0;f<this._scene.spriteManagers.length;f++){const B=this._scene.spriteManagers[f];this.dispatchSprites(B)}for(let f=Z.MIN_RENDERINGGROUPS;f<Z.MAX_RENDERINGGROUPS;f++){this._depthStencilBufferAlreadyCleaned=f===Z.MIN_RENDERINGGROUPS;const J=this._renderingGroups[f];if(!J||J._empty)continue;const t=1<<f;if(d.renderingGroupId=f,this._scene.onBeforeRenderingGroupObservable.notifyObservers(d,t),Z.AUTOCLEAR){const B=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(f):this._autoClearDepthStencil[f];B&&B.Al&&this._clearDepthStencilBuffer(B.depth,B.stencil)}for(const B of this._scene._beforeRenderingGroupDrawStage)B.action(f);J.render(B,k,e,o);for(const B of this._scene._afterRenderingGroupDrawStage)B.action(f);this._scene.onAfterRenderingGroupObservable.notifyObservers(d,t)}}reset(){if(!this.maintainStateBetweenFrames)for(let B=Z.MIN_RENDERINGGROUPS;B<Z.MAX_RENDERINGGROUPS;B++){const o=this._renderingGroups[B];o&&o.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let B=Z.MIN_RENDERINGGROUPS;B<Z.MAX_RENDERINGGROUPS;B++){const o=this._renderingGroups[B];o&&o.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let B=Z.MIN_RENDERINGGROUPS;B<Z.MAX_RENDERINGGROUPS;B++){const o=this._renderingGroups[B];o&&o.dispose()}}_prepareRenderingGroup(B){void 0===this._renderingGroups[B]&&(this._renderingGroups[B]=new f(B,this._scene,this._customOpaqueSortCompareFn[B],this._customAlphaTestSortCompareFn[B],this._customTransparentSortCompareFn[B]))}dispatchSprites(B){this.maintainStateBetweenFrames&&B._wasDispatched||(B._wasDispatched=!0,this.getRenderingGroup(B.renderingGroupId).dispatchSprites(B))}dispatchParticles(B){this.maintainStateBetweenFrames&&B._wasDispatched||(B._wasDispatched=!0,this.getRenderingGroup(B.renderingGroupId).dispatchParticles(B))}dispatch(B,o,e){void 0===o&&(o=B.getMesh()),this.maintainStateBetweenFrames&&B._wasDispatched||(B._wasDispatched=!0,this.getRenderingGroup(o.renderingGroupId).dispatch(B,o,e))}setRenderingOrder(B){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[B]=o,this._customAlphaTestSortCompareFn[B]=e,this._customTransparentSortCompareFn[B]=k,this._renderingGroups[B]){const o=this._renderingGroups[B];o.opaqueSortCompareFn=this._customOpaqueSortCompareFn[B],o.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[B],o.transparentSortCompareFn=this._customTransparentSortCompareFn[B]}}setRenderingAutoClearDepthStencil(B,o){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[B]={Al:o,depth:e,stencil:k}}getAutoClearDepthStencilSetup(B){return this._autoClearDepthStencil[B]}}Z.MAX_RENDERINGGROUPS=4,Z.MIN_RENDERINGGROUPS=0,Z.AUTOCLEAR=!0},2081:(B,o,e)=>{e.r(o),e.d(o,{postprocessVertexShader:()=>f});const k="postprocessVertexShader",d="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";e(581).b.ShadersStore[k]=d;const f={name:k,shader:d}}}]);