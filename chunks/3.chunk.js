"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[3],{2332:(f,z,w)=>{w.d(z,{d:()=>K});var S=w(527),C=w(720),E=w(2321),F=w(2336),J=w(2343),x=w(732),u=w(670),h=w(624),X=w(548);h.e.prototype.setDepthStencilTexture=function(f,z){this._engine.setDepthStencilTexture(this._samplers[f],this._uniforms[f],z,f)};class K extends E.b{get renderList(){return this._renderList}set renderList(f){this._renderList!==f&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),f&&(this._unObserveRenderList=(0,x.l)(f,this._renderListHasChanged)),this._renderList=f)}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(f){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(f)}set onBeforeRender(f){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(f)}set onAfterRender(f){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(f)}set onClear(f){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(f)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(f,z){let w;w=Array.isArray(f)?f:[f];for(let S=0;S<w.length;++S)for(let f=0;f<this._renderPassIds.length;++f)w[S].setMaterialForRenderPass(this._renderPassIds[f],void 0!==z?Array.isArray(z)?z[f]:z:void 0)}get isMulti(){var f;return(null===(f=this._renderTarget)||void 0===f?void 0:f.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(f){if(this._boundingBoxSize&&this._boundingBoxSize.equals(f))return;this._boundingBoxSize=f;const z=this.va();z&&z.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var f;return(null===(f=this._renderTarget)||void 0===f?void 0:f._depthStencilTexture)??null}constructor(f,z,w){let F,x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:E.b.TRILINEAR_SAMPLINGMODE,c=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],y=arguments.length>9&&void 0!==arguments[9]&&arguments[9],e=arguments.length>10&&void 0!==arguments[10]&&arguments[10],O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,d=arguments.length>12&&void 0!==arguments[12]&&arguments[12],B=arguments.length>13?arguments[13]:void 0,V=arguments.length>14?arguments[14]:void 0,W=arguments.length>15&&void 0!==arguments[15]&&arguments[15],T=arguments.length>16&&void 0!==arguments[16]&&arguments[16],v=!0;if("object"===typeof x){const f=x;x=!!f.generateMipMaps,u=f.doNotChangeAspectRatio??!0,h=f.type??0,X=!!f.isCube,K=f.samplingMode??E.b.TRILINEAR_SAMPLINGMODE,c=f.generateDepthBuffer??!0,y=!!f.generateStencilBuffer,e=!!f.isMulti,O=f.format??5,d=!!f.delayAllocation,B=f.samples,V=f.creationFlags,W=!!f.noColorAttachment,T=!!f.useSRGBBuffer,F=f.colorAttachment,v=f.gammaSpace??v}if(super(null,w,!x,void 0,K,void 0,void 0,void 0,void 0,O),this._unObserveRenderList=null,this._renderListHasChanged=(f,z)=>{const w=this._renderList?this._renderList.length:0;var S;(0===z&&w>0||0===w)&&(null===(S=this.va())||void 0===S||S.meshes.forEach((f=>{f._markSubMeshesAsLightDirty()})))},this.particleSystemList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new S.c,this.onAfterUnbindObservable=new S.c,this.onBeforeRenderObservable=new S.c,this.onAfterRenderObservable=new S.c,this.onClearObservable=new S.c,this.onResizeObservable=new S.c,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=C.n.Zero(),this._dumpToolsLoading=!1,!(w=this.va()))return;const D=this.va().getEngine();this._gammaSpace=v,this._coordinatesMode=E.b.PROJECTION_MODE,this.renderList=[],this.name=f,this.isRenderTarget=!0,this._initialSizeParameter=z,this._renderPassIds=[],this._isCubeData=X,this._processSizeParameter(z),this.renderPassId=this._renderPassIds[0],this._resizeObserver=D.onResizeObservable.add((()=>{})),this._generateMipMaps=!!x,this._doNotChangeAspectRatio=u,this._renderingManager=new J.d(w),this._renderingManager._useSceneAutoClearSetup=!0,e||(this._renderTargetOptions={generateMipMaps:x,type:h,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:c,generateStencilBuffer:y,samples:B,creationFlags:V,noColorAttachment:W,useSRGBBuffer:T,colorAttachment:F,label:this.name},this.samplingMode===E.b.NEAREST_SAMPLINGMODE&&(this.wrapU=E.b.CLAMP_ADDRESSMODE,this.wrapV=E.b.CLAMP_ADDRESSMODE),d||(X?(this._renderTarget=w.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=E.b.INVCUBIC_MODE,this._textureMatrix=C.b.Identity()):this._renderTarget=w.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==B&&(this.samples=B)))}createDepthStencilTexture(){var f;let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,w=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,F=arguments.length>5?arguments[5]:void 0;null===(f=this._renderTarget)||void 0===f||f.createDepthStencilTexture(z,w,S,C,E,F)}_releaseRenderPassId(){if(this._scene){const f=this._scene.getEngine();for(let z=0;z<this._renderPassIds.length;++z)f.releaseRenderPassId(this._renderPassIds[z])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const f=this._scene.getEngine(),z=this._isCubeData?6:this.getRenderLayers()||1;for(let w=0;w<z;++w)this._renderPassIds[w]=f.createRenderPassId(`RenderTargetTexture - ${this.name}#${w}`)}_processSizeParameter(f){let z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(f.ratio){this._sizeRatio=f.ratio;const z=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(z.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(z.getRenderHeight(),this._sizeRatio)}}else this._size=f;z&&this._createRenderPassId()}get samples(){var f;return(null===(f=this._renderTarget)||void 0===f?void 0:f.samples)??this._samples}set samples(f){this._renderTarget&&(this._samples=this._renderTarget.setSamples(f))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(f){this._refreshRate=f,this.resetRefreshCounter()}addPostProcess(f){if(!this._postProcessManager){const f=this.va();if(!f)return;this._postProcessManager=new F.d(f),this._postProcesses=new Array}this._postProcesses.push(f),this._postProcesses[0].xl=!1}clearPostProcesses(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(f)for(const f of this._postProcesses)f.dispose();this._postProcesses=[]}}removePostProcess(f){if(!this._postProcesses)return;const z=this._postProcesses.indexOf(f);-1!==z&&(this._postProcesses.splice(z,1),this._postProcesses.length>0&&(this._postProcesses[0].xl=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const f=this._size.layers;if(f)return f;const z=this._size.depth;return z||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(f){const z=Math.max(1,this.getRenderSize()*f);this.resize(z)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(f){var z;const w=this.isCube;null===(z=this._renderTarget)||void 0===z||z.dispose(),this._renderTarget=null;const S=this.va();S&&(this._processSizeParameter(f,!1),this._renderTarget=w?S.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):S.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(f,z)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,w.e(9).then(w.bind(w,2460)).then((f=>this._dumpTools=f))),this._render(!1,!1,!0)}_render(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],w=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=this.va();if(!S)return w;const C=S.getEngine();if(void 0!==this.useCameraPostProcesses&&(f=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let f=0;f<this._waitingRenderList.length;f++){const z=this._waitingRenderList[f],w=S.getMeshById(z);w&&this.renderList.push(w)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const f=this.va();if(!f)return w;const z=f.meshes;for(let w=0;w<z.length;w++){const f=z[w];this.renderListPredicate(f)&&this.renderList.push(f)}}const E=C.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const F=this.activeCamera??S.activeCamera,J=S.activeCamera;F&&(F!==S.activeCamera&&(S.setTransformMatrix(F.getViewMatrix(),F.getProjectionMatrix(!0)),S.activeCamera=F),C.setViewport(F.rigParent?F.rigParent.viewport:F.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let x=w;if(w){S.getViewMatrix()||S.updateTransformMatrix();const f=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let E=0;E<f&&x;E++){let f=null;const z=this.renderList?this.renderList:S.getActiveMeshes().data,F=this.renderList?this.renderList.length:S.getActiveMeshes().length;C.currentRenderPassId=this._renderPassIds[E],this.onBeforeRenderObservable.notifyObservers(E),this.getCustomRenderList&&(f=this.getCustomRenderList(E,z,F)),f||(f=z),this._doNotChangeAspectRatio||S.updateTransformMatrix(!0);for(let S=0;S<f.length&&x;++S){const z=f[S];if(z.isEnabled()&&!z.isBlocked&&z.isVisible&&z.pk)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(z,this.refreshRate,w)){x=!1;continue}}else if(!z.isReady(!0)){x=!1;continue}}this.onAfterRenderObservable.notifyObservers(E),(this.is2DArray||this.is3D||this.isCube)&&(S.incrementRenderId(),S.resetCachedMaterial())}const z=this.particleSystemList||S.zk;for(const w of z)w.isReady()||(x=!1)}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let u=0;u<6;u++)this._renderToTarget(u,f,z,void 0,F),S.incrementRenderId(),S.resetCachedMaterial();else this._renderToTarget(0,f,z,void 0,F);else for(let u=0;u<this.getRenderLayers();u++)this._renderToTarget(0,f,z,u,F),S.incrementRenderId(),S.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),C.currentRenderPassId=E,S.activeCamera=J,J&&(this.activeCamera&&this.activeCamera!==S.activeCamera&&S.setTransformMatrix(J.getViewMatrix(),J.getProjectionMatrix(!0)),C.setViewport(J.viewport)),S.resetCachedMaterial(),x}_bestReflectionRenderTargetDimension(f,z){const w=f*z,S=(0,u.p)(w+16384/(128+w));return Math.min((0,u.e)(f),S)}_prepareRenderingManager(f,z,w,S){const C=this.va();if(!C)return;this._renderingManager.reset();const E=C.getRenderId();for(let J=0;J<z;J++){const z=f[J];if(z&&!z.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(z,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!z.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!z._internalAbstractMeshDataInfo._currentLODIsUpToDate&&w&&(z._internalAbstractMeshDataInfo._currentLOD=C.customLODSelector?C.customLODSelector(z,w):z.getLOD(w),z._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!z._internalAbstractMeshDataInfo._currentLOD)continue;let f,F=z._internalAbstractMeshDataInfo._currentLOD;if(F!==z&&0!==F.billboardMode&&F.bk(),F._preActivateForIntermediateRendering(E),f=!(!S||!w)&&0===(z.layerMask&w.layerMask),z.isEnabled()&&z.isVisible&&z.pk&&!f){if(F!==z&&F._activate(E,!0),z._activate(E,!0)&&z.pk.length){z.isAnInstance?z._internalAbstractMeshDataInfo._actAsRegularMesh&&(F=z):F._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,F._internalAbstractMeshDataInfo._isActiveIntermediate=!0,C._prepareSkeleton(F);for(let f=0;f<F.pk.length;f++){const z=F.pk[f];this._renderingManager.dispatch(z,F)}}z._postActivate()}}}const F=this.particleSystemList||C.zk;for(let J=0;J<F.length;J++){const f=F[J],z=f.j;f.isStarted()&&z&&(!z.position||z.isEnabled())&&this._renderingManager.dispatchParticles(f)}}_bindFrameBuffer(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const w=this.va();if(!w)return;const S=w.getEngine();this._renderTarget&&S.bindFramebuffer(this._renderTarget,this.isCube?f:void 0,void 0,void 0,this.ignoreCameraViewport,0,z)}_unbindFrameBuffer(f,z){this._renderTarget&&f.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(z)}))}_prepareFrame(f,z,w,S){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):S&&f.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(z,w)}_renderToTarget(f,z,w){var S,C;let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const J=this.va();if(!J)return;const x=J.getEngine();this._prepareFrame(J,f,E,z),null===(S=x._debugPushGroup)||void 0===S||S.call(x,`render to face #${f} layer #${E}`,2),this.is2DArray||this.is3D?(x.currentRenderPassId=this._renderPassIds[E],this.onBeforeRenderObservable.notifyObservers(E)):(x.currentRenderPassId=this._renderPassIds[f],this.onBeforeRenderObservable.notifyObservers(f));if(x.snapshotRendering&&1===x.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(x):this.skipInitialClear||x.clear(this.clearColor||J.clearColor,!0,!0,!0);else{var u;let S=null;const C=this.renderList?this.renderList:J.getActiveMeshes().data,h=this.renderList?this.renderList.length:J.getActiveMeshes().length;this.getCustomRenderList&&(S=this.getCustomRenderList(this.is2DArray||this.is3D?E:f,C,h)),S?this._prepareRenderingManager(S,S.length,F,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(C,h,F,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),S=C);for(const z of J._beforeRenderTargetClearStage)z.action(this,f,E);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(x):this.skipInitialClear||x.clear(this.clearColor||J.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||J.updateTransformMatrix(!0);for(const z of J._beforeRenderTargetDrawStage)z.action(this,f,E);this._renderingManager.render(this.customRenderFunction,S,this.renderParticles,this.renderSprites);for(const z of J._afterRenderTargetDrawStage)z.action(this,f,E);const K=(null===(u=this._texture)||void 0===u?void 0:u.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,f,this._postProcesses,this.ignoreCameraViewport):z&&J.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,f);for(const z of J._afterRenderTargetPostProcessStage)z.action(this,f,E);this._texture&&(this._texture.generateMipMaps=K),this._doNotChangeAspectRatio||J.updateTransformMatrix(!0),w&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),x):X.b.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}null===(C=x._debugPopGroup)||void 0===C||C.call(x,2),this._unbindFrameBuffer(x,f),this._texture&&this.isCube&&5===f&&x.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(f,z,w,S)}setRenderingAutoClearDepthStencil(f,z){this._renderingManager.setRenderingAutoClearDepthStencil(f,z),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const f=this.getSize(),z=new K(this.name,f,this.va(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return z.xi=this.xi,z.level=this.level,z.coordinatesMode=this.coordinatesMode,this.renderList&&(z.renderList=this.renderList.slice(0)),z}serialize(){if(!this.name)return null;const f=super.serialize();if(f.renderTargetSize=this.getRenderSize(),f.renderList=[],this.renderList)for(let z=0;z<this.renderList.length;z++)f.renderList.push(this.renderList[z].id);return f}disposeFramebufferObjects(){var f;null===(f=this._renderTarget)||void 0===f||f.dispose(!0)}releaseInternalTexture(){var f;null===(f=this._renderTarget)||void 0===f||f.releaseTextures(),this._texture=null}dispose(){var f;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.va().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const z=this.va();if(!z)return;let w=z.customRenderTargets.indexOf(this);w>=0&&z.customRenderTargets.splice(w,1);for(const S of z.cameras)w=S.customRenderTargets.indexOf(this),w>=0&&S.customRenderTargets.splice(w,1);null===(f=this._renderTarget)||void 0===f||f.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===K.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=K.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}K.REFRESHRATE_RENDER_ONCE=0,K.REFRESHRATE_RENDER_ONEVERYFRAME=1,K.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,E.b._CreateRenderTargetTexture=(f,z,w,S,C)=>new K(f,z,w,S)},2348:(f,z,w)=>{w.d(z,{d:()=>u,g:()=>h});var S=w(789),C=w(767),E=w(527),F=w(624),J=w(831);w(2354);const x={xa:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class u{constructor(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x;this._fullscreenViewport=new C.c(0,0,1,1);const w=z.xa??x.xa,E=z.indices??x.indices;this.Wj=f,this._vertexBuffers={[S.f.PositionKind]:new S.f(f,w,S.f.PositionKind,!1,!1,2)},this._indexBuffer=f.createIndexBuffer(E),this._onContextRestoredObserver=f.onContextRestoredObservable.add((()=>{this._indexBuffer=f.createIndexBuffer(E);for(const f in this._vertexBuffers){this._vertexBuffers[f]._rebuild()}}))}setViewport(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.Wj.setViewport(f)}bindBuffers(f){this.Wj.bindBuffers(this._vertexBuffers,this._indexBuffer,f)}applyEffectWrapper(f){this.Wj.setState(!0),this.Wj.depthCullingState.depthTest=!1,this.Wj.stencilState.stencilTest=!1,this.Wj.enableEffect(f.drawWrapper),this.bindBuffers(f.effect),f.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.Wj.depthCullingState.depthTest,this._savedStateStencilTest=this.Wj.stencilState.stencilTest}restoreStates(){this.Wj.depthCullingState.depthTest=this._savedStateDepthTest,this.Wj.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.Wj.drawElementsType(0,0,6)}_isRenderTargetTexture(f){return void 0!==f.renderTarget}render(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!f.effect.isReady())return;this.saveStates(),this.setViewport();const w=null===z?null:this._isRenderTargetTexture(z)?z.renderTarget:z;w&&this.Wj.bindFramebuffer(w),this.applyEffectWrapper(f),this.draw(),w&&this.Wj.unBindFramebuffer(w),this.restoreStates()}dispose(){const f=this._vertexBuffers[S.f.PositionKind];f&&(f.dispose(),delete this._vertexBuffers[S.f.PositionKind]),this._indexBuffer&&this.Wj._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.Wj.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class h{static RegisterShaderCodeProcessing(f,z){z?h._CustomShaderCodeProcessing[f??""]=z:delete h._CustomShaderCodeProcessing[f??""]}static _GetShaderCodeProcessing(f){return h._CustomShaderCodeProcessing[f]??h._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(f){this.options.name=f}isReady(){var f;return(null===(f=this._drawWrapper.effect)||void 0===f?void 0:f.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(f){this._drawWrapper.effect=f}constructor(f){this.alphaMode=0,this.onEffectCreatedObservable=new E.c(void 0,!0),this.onApplyObservable=new E.c,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...f,name:f.name||"effectWrapper",Wj:f.Wj,uniforms:f.uniforms||f.uniformNames||[],uniformNames:void 0,samplers:f.samplers||f.samplerNames||[],samplerNames:void 0,attributeNames:f.attributeNames||["position"],uniformBuffers:f.uniformBuffers||[],defines:f.defines||"",useShaderStore:f.useShaderStore||!1,vertexUrl:f.vertexUrl||f.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:f.fragmentShader||"pass",indexParameters:f.indexParameters,blockCompilation:f.blockCompilation||!1,shaderLanguage:f.shaderLanguage||0,onCompiled:f.onCompiled||void 0,extraInitializations:f.extraInitializations||void 0,extraInitializationsAsync:f.extraInitializationsAsync||void 0,useAsPostProcess:f.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),f.vertexUrl||f.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.Wj.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new J.b(this.options.Wj),this._webGPUReady=1===this.options.shaderLanguage;const z=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,z,this.options.extraInitializations)}_gatherImports(){let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],z=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(f&&this._webGPUReady?z.push(Promise.all([w.e(36).then(w.bind(w,13168))])):z.push(Promise.all([Promise.resolve().then(w.bind(w,2354))])))}_postConstructor(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,S&&this._importPromises.push(...S);const C=this.options.Wj.isWebGPU&&!h.ForceGLSL;this._gatherImports(C,this._importPromises),void 0!==w&&w(C,this._importPromises),C&&this._webGPUReady&&(this.options.shaderLanguage=1),f||this.updateEffect(z)}updateEffect(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0,E=arguments.length>5?arguments[5]:void 0,J=arguments.length>6?arguments[6]:void 0,x=arguments.length>7?arguments[7]:void 0;const u=h._GetShaderCodeProcessing(this.name);if(null!==u&&void 0!==u&&u.defineCustomBindings){var X,K;const S=(null===(X=z)||void 0===X?void 0:X.slice())??[];S.push(...this.options.uniforms);const C=(null===(K=w)||void 0===K?void 0:K.slice())??[];C.push(...this.options.samplers),f=u.defineCustomBindings(this.name,f,S,C),z=S,w=C}this.options.defines=f||"";const c=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let y;y=this.options.extraInitializationsAsync?async()=>{null===c||void 0===c||c(),await this.options.extraInitializationsAsync}:c,this.options.useShaderStore?this._drawWrapper.effect=this.options.Wj.createEffect({vertex:J??this._shaderPath.vertex,fragment:x??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:z||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:w||this.options.samplers,defines:null!==f?f:"",fallbacks:null,onCompiled:C??this.options.onCompiled,onError:E??null,indexParameters:S||this.options.indexParameters,processCodeAfterIncludes:null!==u&&void 0!==u&&u.processCodeAfterIncludes?(f,z)=>u.processCodeAfterIncludes(this.name,f,z):null,processFinalCode:null!==u&&void 0!==u&&u.processFinalCode?(f,z)=>u.processFinalCode(this.name,f,z):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:y},this.options.Wj):this._drawWrapper.effect=new F.e(this._shaderPath,this.options.attributeNames,z||this.options.uniforms,w||this.options.samplerNames,this.options.Wj,f,void 0,C||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,y),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var f,z;this.options.useAsPostProcess&&(this.options.Wj.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(f=h._GetShaderCodeProcessing(this.name))||void 0===f||null===(z=f.bindCustomBindings)||void 0===z||z.call(f,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this.effect.dispose()}}h.ForceGLSL=!1,h._CustomShaderCodeProcessing={}},2295:(f,z,w)=>{w.d(z,{b:()=>S.j});w(876),w(762),w(726),w(776),w(2300),w(782),w(2302);var S=w(720);w(767)},2300:(f,z,w)=>{w.d(z,{e:()=>J,h:()=>h,l:()=>X});var S,C=w(741),E=w(720),F=w(726);!function(f){f[f.CW=0]="CW",f[f.CCW=1]="CCW"}(S||(S={}));class J{static Interpolate(f,z,w,S,C){const E=1-3*S+3*z,F=3*S-6*z,J=3*z;let x=f;for(let u=0;u<5;u++){const z=x*x;x-=(E*(z*x)+F*z+J*x-f)*(1/(3*E*z+2*F*x+J)),x=Math.min(1,Math.max(0,x))}return 3*Math.pow(1-x,2)*x*w+3*(1-x)*Math.pow(x,2)*C+Math.pow(x,3)}}class x{constructor(f){this._radians=f,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(f,z){const w=z.te(f),S=Math.atan2(w.y,w.x);return new x(S)}static BetweenTwoVectors(f,z){let w=f.lengthSquared()*z.lengthSquared();if(0===w)return new x(Math.PI/2);w=Math.sqrt(w);let S=f.dot(z)/w;S=(0,C.c)(S,-1,1);const E=Math.acos(S);return new x(E)}static FromRadians(f){return new x(f)}static FromDegrees(f){return new x(f*Math.PI/180)}}class u{constructor(f,z,w){this.startPoint=f,this.midPoint=z,this.endPoint=w;const S=Math.pow(z.x,2)+Math.pow(z.y,2),C=(Math.pow(f.x,2)+Math.pow(f.y,2)-S)/2,F=(S-Math.pow(w.x,2)-Math.pow(w.y,2))/2,J=(f.x-z.x)*(z.y-w.y)-(z.x-w.x)*(f.y-z.y);this.centerPoint=new E.l((C*(z.y-w.y)-F*(f.y-z.y))/J,((f.x-z.x)*F-(z.x-w.x)*C)/J),this.radius=this.centerPoint.te(this.startPoint).length(),this.startAngle=x.BetweenTwoPoints(this.centerPoint,this.startPoint);const u=this.startAngle.degrees();let h=x.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),X=x.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();h-u>180&&(h-=360),h-u<-180&&(h+=360),X-h>180&&(X-=360),X-h<-180&&(X+=360),this.orientation=h-u<0?0:1,this.angle=x.FromDegrees(0===this.orientation?u-X:X-u)}}class h{constructor(f,z){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new E.l(f,z))}addLineTo(f,z){if(this.closed)return this;const w=new E.l(f,z),S=this._points[this._points.length-1];return this._points.push(w),this._length+=w.te(S).length(),this}addArcTo(f,z,w,S){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const F=this._points[this._points.length-1],J=new E.l(f,z),x=new E.l(w,S),h=new u(F,J,x);let X=h.angle.radians()/C;0===h.orientation&&(X*=-1);let K=h.startAngle.radians()+X;for(let E=0;E<C;E++){const f=Math.cos(K)*h.radius+h.centerPoint.x,z=Math.sin(K)*h.radius+h.centerPoint.y;this.addLineTo(f,z),K+=X}return this}addQuadraticCurveTo(f,z,w,S){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const E=(f,z,w,S)=>(1-f)*(1-f)*z+2*f*(1-f)*w+f*f*S,F=this._points[this._points.length-1];for(let J=0;J<=C;J++){const x=J/C,u=E(x,F.x,f,w),h=E(x,F.y,z,S);this.addLineTo(u,h)}return this}addBezierCurveTo(f,z,w,S,C,E){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const J=(f,z,w,S,C)=>(1-f)*(1-f)*(1-f)*z+3*f*(1-f)*(1-f)*w+3*f*f*(1-f)*S+f*f*f*C,x=this._points[this._points.length-1];for(let u=0;u<=F;u++){const h=u/F,X=J(h,x.x,f,w,C),K=J(h,x.y,z,S,E);this.addLineTo(X,K)}return this}isPointInside(f){let z=!1;const w=this._points.length;for(let S=w-1,C=0;C<w;S=C++){let w=this._points[S],E=this._points[C],F=E.x-w.x,J=E.y-w.y;if(Math.abs(J)>Number.EPSILON){if(J<0&&(w=this._points[C],F=-F,E=this._points[S],J=-J),f.y<w.y||f.y>E.y)continue;if(f.y===w.y&&f.x===w.x)return!0;{const S=J*(f.x-w.x)-F*(f.y-w.y);if(0===S)return!0;if(S<0)continue;z=!z}}else{if(f.y!==w.y)continue;if(E.x<=f.x&&f.x<=w.x||w.x<=f.x&&f.x<=E.x)return!0}}return z}close(){return this.closed=!0,this}length(){let f=this._length;if(this.closed){const z=this._points[this._points.length-1];f+=this._points[0].te(z).length()}return f}area(){const f=this._points.length;let z=0;for(let w=f-1,S=0;S<f;w=S++)z+=this._points[w].x*this._points[S].y-this._points[S].x*this._points[w].y;return.5*z}getPoints(){return this._points}getPointAtLengthPosition(f){if(f<0||f>1)return E.l.Zero();const z=f*this.length();let w=0;for(let S=0;S<this._points.length;S++){const f=(S+1)%this._points.length,C=this._points[S],F=this._points[f].te(C),J=F.length()+w;if(z>=w&&z<=J){const f=F.normalize(),S=z-w;return new E.l(C.x+f.x*S,C.y+f.y*S)}w=J}return E.l.Zero()}static StartingAt(f,z){return new h(f,z)}}class X{constructor(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2?arguments[2]:void 0,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=f,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:E.n.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:E.b.Identity()};for(let C=0;C<f.length;C++)this._curve[C]=f[C].clone();this._raw=w||!1,this._alignTangentsWithPath=S,this._compute(z,S)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(f){return this._updatePointAtData(f).point}getTangentAt(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(f,z),z?E.n.TransformCoordinates(E.n.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(f,z),z?E.n.TransformCoordinates(E.n.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(f,z),z?E.n.TransformCoordinates(E.n.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(f){return this.length()*f}getPreviousPointIndexAt(f){return this._updatePointAtData(f),this._pointAtData.previousPointArrayIndex}getSubPositionAt(f){return this._updatePointAtData(f),this._pointAtData.subPosition}getClosestPositionTo(f){let z=Number.MAX_VALUE,w=0;for(let S=0;S<this._curve.length-1;S++){const C=this._curve[S+0],F=this._curve[S+1].te(C).normalize(),J=this._distances[S+1]-this._distances[S+0],x=Math.min(Math.max(E.n.Dot(F,f.te(C).normalize()),0)*E.n.Distance(C,f)/J,1),u=E.n.Distance(C.add(F.scale(x*J)),f);u<z&&(z=u,w=(this._distances[S+0]+J*x)/this.length())}return w}slice(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(f<0&&(f=1- -1*f%1),z<0&&(z=1- -1*z%1),f>z){const w=f;f=z,z=w}const w=this.getCurve(),S=this.getPointAt(f);let C=this.getPreviousPointIndexAt(f);const E=this.getPointAt(z),F=this.getPreviousPointIndexAt(z)+1,J=[];return 0!==f&&(C++,J.push(S)),J.push(...w.slice(C,F)),1===z&&1!==f||J.push(E),new X(J,this.getNormalAt(f),this._raw,this._alignTangentsWithPath)}update(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let S=0;S<f.length;S++)this._curve[S].x=f[S].x,this._curve[S].y=f[S].y,this._curve[S].z=f[S].z;return this._compute(z,w),this}_compute(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const w=this._curve.length;if(w<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[w-1]=this._curve[w-1].te(this._curve[w-2]),this._raw||this._tangents[w-1].normalize();const S=this._tangents[0],C=this._normalVector(S,f);let F,J,x,u,h;this._normals[0]=C,this._raw||this._normals[0].normalize(),this._binormals[0]=E.n.Cross(S,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let X=1;X<w;X++)F=this._getLastNonNullVector(X),X<w-1&&(J=this._getFirstNonNullVector(X),this._tangents[X]=z?J:F.add(J),this._tangents[X].normalize()),this._distances[X]=this._distances[X-1]+this._curve[X].te(this._curve[X-1]).length(),x=this._tangents[X],h=this._binormals[X-1],this._normals[X]=E.n.Cross(h,x),this._raw||(0===this._normals[X].length()?(u=this._normals[X-1],this._normals[X]=u.clone()):this._normals[X].normalize()),this._binormals[X]=E.n.Cross(x,this._normals[X]),this._raw||this._binormals[X].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(f){let z=1,w=this._curve[f+z].te(this._curve[f]);for(;0===w.length()&&f+z+1<this._curve.length;)z++,w=this._curve[f+z].te(this._curve[f]);return w}_getLastNonNullVector(f){let z=1,w=this._curve[f].te(this._curve[f-z]);for(;0===w.length()&&f>z+1;)z++,w=this._curve[f].te(this._curve[f-z]);return w}_normalVector(f,z){let w,S=f.length();if(0===S&&(S=1),void 0===z||null===z){let z;z=(0,C.t)(Math.abs(f.y)/S,1,F.e)?(0,C.t)(Math.abs(f.x)/S,1,F.e)?(0,C.t)(Math.abs(f.z)/S,1,F.e)?E.n.Zero():new E.n(0,0,1):new E.n(1,0,0):new E.n(0,-1,0),w=E.n.Cross(f,z)}else w=E.n.Cross(f,z),E.n.CrossToRef(w,f,w);return w.normalize(),w}_updatePointAtData(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===f)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=f;const w=this.getPoints();if(f<=0)return this._setPointAtData(0,0,w[0],0,z);if(f>=1)return this._setPointAtData(1,1,w[w.length-1],w.length-1,z);let S,C=w[0],F=0;const J=f*this.length();for(let x=1;x<w.length;x++){S=w[x];const u=E.n.Distance(C,S);if(F+=u,F===J)return this._setPointAtData(f,1,S,x,z);if(F>J){const w=(F-J)/u,E=C.te(S),h=S.add(E.scaleInPlace(w));return this._setPointAtData(f,1-w,h,x-1,z)}C=S}return this._pointAtData}_setPointAtData(f,z,w,S,C){return this._pointAtData.point=w,this._pointAtData.position=f,this._pointAtData.subPosition=z,this._pointAtData.previousPointArrayIndex=S,this._pointAtData.interpolateReady=C,C&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=E.b.Identity();const f=this._pointAtData.previousPointArrayIndex;if(f!==this._tangents.length-1){const z=f+1,w=this._tangents[f].clone(),S=this._normals[f].clone(),C=this._binormals[f].clone(),F=this._tangents[z].clone(),J=this._normals[z].clone(),x=this._binormals[z].clone(),u=E.f.RotationQuaternionFromAxis(S,C,w),h=E.f.RotationQuaternionFromAxis(J,x,F);E.f.Slerp(u,h,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},2292:(f,z,w)=>{w.d(z,{d:()=>u,e:()=>h});var S=w(720),C=w(2295);const E=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],F=[()=>1,f=>f.y,f=>f.z,f=>f.x,f=>f.x*f.y,f=>f.y*f.z,f=>3*f.z*f.z-1,f=>f.x*f.z,f=>f.x*f.x-f.y*f.y],J=(f,z)=>E[f]*F[f](z),x=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class u{constructor(){this.preScaled=!1,this.l00=S.n.Zero(),this.l1_1=S.n.Zero(),this.l10=S.n.Zero(),this.l11=S.n.Zero(),this.l2_2=S.n.Zero(),this.l2_1=S.n.Zero(),this.l20=S.n.Zero(),this.l21=S.n.Zero(),this.l22=S.n.Zero()}addLight(f,z,w){C.b.ek[0].set(z.r,z.g,z.b);const S=C.b.ek[0],E=C.b.ek[1];S.scaleToRef(w,E),E.scaleToRef(J(0,f),C.b.ek[2]),this.l00.addInPlace(C.b.ek[2]),E.scaleToRef(J(1,f),C.b.ek[2]),this.l1_1.addInPlace(C.b.ek[2]),E.scaleToRef(J(2,f),C.b.ek[2]),this.l10.addInPlace(C.b.ek[2]),E.scaleToRef(J(3,f),C.b.ek[2]),this.l11.addInPlace(C.b.ek[2]),E.scaleToRef(J(4,f),C.b.ek[2]),this.l2_2.addInPlace(C.b.ek[2]),E.scaleToRef(J(5,f),C.b.ek[2]),this.l2_1.addInPlace(C.b.ek[2]),E.scaleToRef(J(6,f),C.b.ek[2]),this.l20.addInPlace(C.b.ek[2]),E.scaleToRef(J(7,f),C.b.ek[2]),this.l21.addInPlace(C.b.ek[2]),E.scaleToRef(J(8,f),C.b.ek[2]),this.l22.addInPlace(C.b.ek[2])}scaleInPlace(f){this.l00.scaleInPlace(f),this.l1_1.scaleInPlace(f),this.l10.scaleInPlace(f),this.l11.scaleInPlace(f),this.l2_2.scaleInPlace(f),this.l2_1.scaleInPlace(f),this.l20.scaleInPlace(f),this.l21.scaleInPlace(f),this.l22.scaleInPlace(f)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(x[0]),this.l1_1.scaleInPlace(x[1]),this.l10.scaleInPlace(x[2]),this.l11.scaleInPlace(x[3]),this.l2_2.scaleInPlace(x[4]),this.l2_1.scaleInPlace(x[5]),this.l20.scaleInPlace(x[6]),this.l21.scaleInPlace(x[7]),this.l22.scaleInPlace(x[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(E[0]),this.l1_1.scaleInPlace(E[1]),this.l10.scaleInPlace(E[2]),this.l11.scaleInPlace(E[3]),this.l2_2.scaleInPlace(E[4]),this.l2_1.scaleInPlace(E[5]),this.l20.scaleInPlace(E[6]),this.l21.scaleInPlace(E[7]),this.l22.scaleInPlace(E[8])}updateFromArray(f){return S.n.FromArrayToRef(f[0],0,this.l00),S.n.FromArrayToRef(f[1],0,this.l1_1),S.n.FromArrayToRef(f[2],0,this.l10),S.n.FromArrayToRef(f[3],0,this.l11),S.n.FromArrayToRef(f[4],0,this.l2_2),S.n.FromArrayToRef(f[5],0,this.l2_1),S.n.FromArrayToRef(f[6],0,this.l20),S.n.FromArrayToRef(f[7],0,this.l21),S.n.FromArrayToRef(f[8],0,this.l22),this}updateFromFloatsArray(f){return S.n.FromFloatsToRef(f[0],f[1],f[2],this.l00),S.n.FromFloatsToRef(f[3],f[4],f[5],this.l1_1),S.n.FromFloatsToRef(f[6],f[7],f[8],this.l10),S.n.FromFloatsToRef(f[9],f[10],f[11],this.l11),S.n.FromFloatsToRef(f[12],f[13],f[14],this.l2_2),S.n.FromFloatsToRef(f[15],f[16],f[17],this.l2_1),S.n.FromFloatsToRef(f[18],f[19],f[20],this.l20),S.n.FromFloatsToRef(f[21],f[22],f[23],this.l21),S.n.FromFloatsToRef(f[24],f[25],f[26],this.l22),this}static ck(f){return(new u).updateFromArray(f)}static FromPolynomial(f){const z=new u;return z.l00=f.xx.scale(.376127).add(f.yy.scale(.376127)).add(f.zz.scale(.376126)),z.l1_1=f.y.scale(.977204),z.l10=f.z.scale(.977204),z.l11=f.x.scale(.977204),z.l2_2=f.xy.scale(1.16538),z.l2_1=f.yz.scale(1.16538),z.l20=f.zz.scale(1.34567).te(f.xx.scale(.672834)).te(f.yy.scale(.672834)),z.l21=f.zx.scale(1.16538),z.l22=f.xx.scale(1.16538).te(f.yy.scale(1.16538)),z.l1_1.scaleInPlace(-1),z.l11.scaleInPlace(-1),z.l2_1.scaleInPlace(-1),z.l21.scaleInPlace(-1),z.scaleInPlace(Math.PI),z}}class h{constructor(){this.x=S.n.Zero(),this.y=S.n.Zero(),this.z=S.n.Zero(),this.xx=S.n.Zero(),this.yy=S.n.Zero(),this.zz=S.n.Zero(),this.xy=S.n.Zero(),this.yz=S.n.Zero(),this.zx=S.n.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=u.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(f){C.b.ek[0].Gd(f.r,f.g,f.b);const z=C.b.ek[0];this.xx.addInPlace(z),this.yy.addInPlace(z),this.zz.addInPlace(z)}scaleInPlace(f){this.x.scaleInPlace(f),this.y.scaleInPlace(f),this.z.scaleInPlace(f),this.xx.scaleInPlace(f),this.yy.scaleInPlace(f),this.zz.scaleInPlace(f),this.yz.scaleInPlace(f),this.zx.scaleInPlace(f),this.xy.scaleInPlace(f)}updateFromHarmonics(f){return this._harmonics=f,this.x.p(f.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.p(f.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.p(f.l10),this.z.scaleInPlace(1.02333),this.xx.p(f.l00),C.b.ek[0].p(f.l20).scaleInPlace(.247708),C.b.ek[1].p(f.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).fk(C.b.ek[0]).addInPlace(C.b.ek[1]),this.yy.p(f.l00),this.yy.scaleInPlace(.886277).fk(C.b.ek[0]).fk(C.b.ek[1]),this.zz.p(f.l00),C.b.ek[0].p(f.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(C.b.ek[0]),this.yz.p(f.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.p(f.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.p(f.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(f){return(new h).updateFromHarmonics(f)}static ck(f){const z=new h;return S.n.FromArrayToRef(f[0],0,z.x),S.n.FromArrayToRef(f[1],0,z.y),S.n.FromArrayToRef(f[2],0,z.z),S.n.FromArrayToRef(f[3],0,z.xx),S.n.FromArrayToRef(f[4],0,z.yy),S.n.FromArrayToRef(f[5],0,z.zz),S.n.FromArrayToRef(f[6],0,z.yz),S.n.FromArrayToRef(f[7],0,z.zx),S.n.FromArrayToRef(f[8],0,z.xy),z}}},2312:(f,z,w)=>{w.d(z,{b:()=>u});var S=w(720),C=w(741),E=w(2292),F=w(726),J=w(762);class x{constructor(f,z,w,S){this.name=f,this.worldAxisForNormal=z,this.worldAxisForFileX=w,this.worldAxisForFileY=S}}class u{static ConvertCubeMapTextureToSphericalPolynomial(f){var z;if(!f.isCube)return null;null===(z=f.va())||void 0===z||z.getEngine().flushFramebuffer();const w=f.getSize().width,S=f.readPixels(0,void 0,void 0,!1),C=f.readPixels(1,void 0,void 0,!1);let E,F;f.isRenderTarget?(E=f.readPixels(3,void 0,void 0,!1),F=f.readPixels(2,void 0,void 0,!1)):(E=f.readPixels(2,void 0,void 0,!1),F=f.readPixels(3,void 0,void 0,!1));const J=f.readPixels(4,void 0,void 0,!1),x=f.readPixels(5,void 0,void 0,!1),u=f.gammaSpace;let h=0;return 1!=f.textureType&&2!=f.textureType||(h=1),new Promise((f=>{Promise.all([C,S,E,F,J,x]).then((z=>{let[S,C,E,F,J,x]=z;const X={size:w,right:C,left:S,up:E,down:F,front:J,back:x,format:5,type:h,gammaSpace:u};f(this.ConvertCubeMapToSphericalPolynomial(X))}))}))}static _AreaElement(f,z){return Math.atan2(f*z,Math.sqrt(f*f+z*z+1))}static ConvertCubeMapToSphericalPolynomial(f){const z=new E.d;let w=0;const S=2/f.size,x=S,u=.5*S,h=u-1;for(let E=0;E<6;E++){const X=this._FileFaces[E],K=f[X.name];let c=h;const y=5===f.format?4:3;for(let E=0;E<f.size;E++){let e=h;for(let x=0;x<f.size;x++){const h=X.worldAxisForFileX.scale(e).add(X.worldAxisForFileY.scale(c)).add(X.worldAxisForNormal);h.normalize();const O=this._AreaElement(e-u,c-u)-this._AreaElement(e-u,c+u)-this._AreaElement(e+u,c-u)+this._AreaElement(e+u,c+u);let d=K[E*f.size*y+x*y+0],B=K[E*f.size*y+x*y+1],V=K[E*f.size*y+x*y+2];isNaN(d)&&(d=0),isNaN(B)&&(B=0),isNaN(V)&&(V=0),0===f.type&&(d/=255,B/=255,V/=255),f.gammaSpace&&(d=Math.pow((0,C.c)(d),F.m),B=Math.pow((0,C.c)(B),F.m),V=Math.pow((0,C.c)(V),F.m));const W=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const f=Math.max(d,B,V);if(f>W){const z=W/f;d*=z,B*=z,V*=z}}else d=(0,C.c)(d,0,W),B=(0,C.c)(B,0,W),V=(0,C.c)(V,0,W);const T=new J.d(d,B,V);z.addLight(h,T,O),w+=O,e+=S}c+=x}}const X=6*(4*Math.PI)/6/w;return z.scaleInPlace(X),z.convertIncidentRadianceToIrradiance(),z.convertIrradianceToLambertianRadiance(),E.e.FromHarmonics(z)}}u._FileFaces=[new x("right",new S.n(1,0,0),new S.n(0,0,-1),new S.n(0,-1,0)),new x("left",new S.n(-1,0,0),new S.n(0,0,1),new S.n(0,-1,0)),new x("up",new S.n(0,1,0),new S.n(1,0,0),new S.n(0,0,1)),new x("down",new S.n(0,-1,0),new S.n(1,0,0),new S.n(0,0,-1)),new x("front",new S.n(0,0,1),new S.n(1,0,0),new S.n(0,-1,0)),new x("back",new S.n(0,0,-1),new S.n(-1,0,0),new S.n(0,-1,0))],u.MAX_HDRI_VALUE=4096,u.PRESERVE_CLAMPED_COLORS=!1},2315:(f,z,w)=>{w.d(z,{c:()=>x,d:()=>K,e:()=>X});w(2321),w(2332);var S=w(2345),C=w(616),E=w(665),F=w(753);class J extends S.d{getClassName(){return"PassPostProcess"}constructor(f,z){super(f,"pass",null,null,z,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(f,z){f?(this._webGPUReady=!0,z.push(Promise.all([w.e(32).then(w.bind(w,13153))]))):z.push(Promise.all([w.e(33).then(w.bind(w,13157))])),super._gatherImports(f,z)}static _Parse(f,z,w,S){return F.b.Parse((()=>new J(f.name,f.options,z,f.renderTargetSamplingMode,f._engine,f.reusable)),f,w,S)}}(0,E.f)("BABYLON.PassPostProcess",J);S.d;function x(f,z,w,C,E,F,J,x){const u=z.getEngine();return z.isReady=!1,E=E??z.samplingMode,C=C??z.type,F=F??z.format,J=J??z.width,x=x??z.height,-1===C&&(C=0),new Promise((h=>{const X=new S.d("postprocess",f,null,null,1,null,E,u,!1,void 0,C,void 0,null,!1,F);X.externalTextureSamplerBinding=!0;const K=u.createRenderTargetTexture({width:J,height:x},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:E,type:C,format:F});X.onEffectCreatedObservable.addOnce((f=>{f.executeWhenCompiled((()=>{X.onApply=f=>{f._bindTexture("textureSampler",z),f.setFloat2("scale",1,1)},w.postProcessManager.directRender([X],K,!0),u.restoreDefaultFramebuffer(),u._releaseTexture(z),X&&X.dispose(),K._swapAndDie(z),z.type=C,z.format=5,z.isReady=!0,h(z)}))}))}))}let u,h;function X(f){u||(u=new Float32Array(1),h=new Int32Array(u.buffer)),u[0]=f;const z=h[0];let w=z>>16&32768,S=z>>12&2047;const C=z>>23&255;return C<103?w:C>142?(w|=31744,w|=(255==C?0:1)&&8388607&z,w):C<113?(S|=2048,w|=(S>>114-C)+(S>>113-C&1),w):(w|=C-112<<10|S>>1,w+=1&S,w)}function K(f){const z=(32768&f)>>15,w=(31744&f)>>10,S=1023&f;return 0===w?(z?-1:1)*Math.pow(2,-14)*(S/Math.pow(2,10)):31==w?S?NaN:1/0*(z?-1:1):(z?-1:1)*Math.pow(2,w-15)*(1+S/Math.pow(2,10))}C.e._RescalePostProcessFactory=f=>new J("rescale",1,null,2,f,!1,0)},2345:(f,z,w)=>{w.d(z,{d:()=>y});var S=w(692),C=w(715),E=w(527),F=w(720),J=w(624),x=w(699),u=w(753),h=w(665),X=w(616),K=w(670),c=w(2348);X.e.prototype.setTextureFromPostProcess=function(f,z,w){var S;let C=null;z&&(z._forcedOutputTexture?C=z._forcedOutputTexture:z._textures.data[z._currentRenderTextureInd]&&(C=z._textures.data[z._currentRenderTextureInd])),this._bindTexture(f,(null===(S=C)||void 0===S?void 0:S.texture)??null,w)},X.e.prototype.setTextureFromPostProcessOutput=function(f,z,w){var S;this._bindTexture(f,(null===z||void 0===z||null===(S=z._outputTexture)||void 0===S?void 0:S.texture)??null,w)},J.e.prototype.setTextureFromPostProcess=function(f,z){this._engine.setTextureFromPostProcess(this._samplers[f],z,f)},J.e.prototype.setTextureFromPostProcessOutput=function(f,z){this._engine.setTextureFromPostProcessOutput(this._samplers[f],z,f)};class y{static get ForceGLSL(){return c.g.ForceGLSL}static set ForceGLSL(f){c.g.ForceGLSL=f}static RegisterShaderCodeProcessing(f,z){c.g.RegisterShaderCodeProcessing(f,z)}get name(){return this._effectWrapper.name}set name(f){this._effectWrapper.name=f}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(f){this._effectWrapper.alphaMode=f}get samples(){return this._samples}set samples(f){this._samples=Math.min(f,this._engine.getCaps().maxMSAASamples),this._textures.forEach((f=>{f.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(f){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),f&&(this._onActivateObserver=this.onActivateObservable.add(f))}set onSizeChanged(f){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(f)}set onApply(f){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(f)}set onBeforeRender(f){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(f)}set onAfterRender(f){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(f)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(f){this._forcedOutputTexture=f}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.Gd(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(f,z,w,S,J,x){var u;let h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,X=arguments.length>7?arguments[7]:void 0,K=arguments.length>8?arguments[8]:void 0,e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,O=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",B=arguments.length>12?arguments[12]:void 0,V=arguments.length>13&&void 0!==arguments[13]&&arguments[13],W=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,T=arguments.length>15?arguments[15]:void 0,v=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.xl=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new C.h(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new F.l(1,1),this._texelSize=F.l.Zero(),this.onActivateObservable=new E.c,this.onSizeChangedObservable=new E.c,this.onApplyObservable=new E.c,this.onBeforeRenderObservable=new E.c,this.onAfterRenderObservable=new E.c;let D,A=1,M=null;if(w&&!Array.isArray(w)){const f=w;w=f.uniforms??null,S=f.samplers??null,A=f.size??1,x=f.camera??null,h=f.samplingMode??1,X=f.Wj,K=f.reusable,e=Array.isArray(f.defines)?f.defines.join("\n"):f.defines??null,O=f.textureType??0,d=f.vertexUrl??"postprocess",B=f.indexParameters,V=f.blockCompilation??!1,W=f.textureFormat??5,T=f.shaderLanguage??0,M=f.uniformBuffers??null,v=f.extraInitializations,D=f.effectWrapper}else J&&(A="number"===typeof J?J:{width:J.width,height:J.height});const G=!!D;if(this._effectWrapper=D??new c.g({name:f,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:z,Wj:X||(null===(u=x)||void 0===u?void 0:u.va().getEngine()),uniforms:w,samplers:S,uniformBuffers:M,defines:e,vertexUrl:d,indexParameters:B,blockCompilation:V,shaderLanguage:T,extraInitializations:v}),this.name=f,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=x?(this._camera=x,this._scene=x.va(),x.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):X&&(this._engine=X,this._engine.postProcesses.push(this)),this._options=A,this.renderTargetSamplingMode=h||1,this._reusable=K||!1,this._textureType=O,this._textureFormat=W,this._shaderLanguage=T||0,this._samplers=S||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=z,this._vertexUrl=d,this._parameters=w||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=M||[],this._indexParameters=B,!G){this._webGPUReady=1===this._shaderLanguage;const f=[];this._gatherImports(this._engine.isWebGPU&&!y.ForceGLSL,f),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(V,e,v,f)}}_gatherImports(){let f=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?f.push(Promise.all([w.e(36).then(w.bind(w,13168))])):f.push(Promise.all([Promise.resolve().then(w.bind(w,2354))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(f){return this._disposeTextures(),this._shareOutputWithPostProcess=f,this}useOwnOutput(){0==this._textures.length&&(this._textures=new C.h(2)),this._shareOutputWithPostProcess=null}updateEffect(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0,E=arguments.length>5?arguments[5]:void 0,F=arguments.length>6?arguments[6]:void 0,J=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(f,z,w,S,C,E,F,J),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let C=0;C<this._textureCache.length;C++)if(this._textureCache[C].texture.width===f.width&&this._textureCache[C].texture.height===f.height&&this._textureCache[C].postProcessChannel===w&&this._textureCache[C].texture._generateDepthBuffer===z.generateDepthBuffer&&this._textureCache[C].texture.samples===z.samples)return this._textureCache[C].texture;const S=this._engine.createRenderTargetTexture(f,z);return this._textureCache.push({texture:S,postProcessChannel:w,lastUsedRenderId:-1}),S}_flushTextureCache(){const f=this._renderId;for(let z=this._textureCache.length-1;z>=0;z--)if(f-this._textureCache[z].lastUsedRenderId>100){let f=!1;for(let w=0;w<this._textures.length;w++)if(this._textures.data[w]===this._textureCache[z].texture){f=!0;break}f||(this._textureCache[z].texture.dispose(),this._textureCache.splice(z,1))}}resize(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=f,this.height=z;let E=null;if(w)for(let x=0;x<w._postProcesses.length;x++)if(null!==w._postProcesses[x]){E=w._postProcesses[x];break}const F={width:this.width,height:this.height},J={generateMipMaps:S,generateDepthBuffer:C||E===this,generateStencilBuffer:(C||E===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(F,J,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(F,J,1)),this._texelSize.Gd(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let f;if(this._shareOutputWithPostProcess)f=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)f=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let z;f=this.inputTexture;for(let w=0;w<this._textureCache.length;w++)if(this._textureCache[w].texture===f){z=this._textureCache[w];break}z&&(z.lastUsedRenderId=this._renderId)}return f}activate(f){var z,w;let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0;const E=(f=f||this._camera).va(),F=E.getEngine(),J=F.getCaps().maxTextureSize,x=(S?S.width:this._engine.getRenderWidth(!0))*this._options|0,u=(S?S.height:this._engine.getRenderHeight(!0))*this._options|0;let h=this._options.width||x,X=this._options.height||u;const c=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let y=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const f=F.currentViewport;f&&(h*=f.width,X*=f.height)}(c||this.alwaysForcePOT)&&(this._options.width||(h=F.needPOTTextures?(0,K.f)(h,J,this.scaleMode):h),this._options.height||(X=F.needPOTTextures?(0,K.f)(X,J,this.scaleMode):X)),this.width===h&&this.height===X&&(y=this._getTarget())||this.resize(h,X,f,c,C),this._textures.forEach((f=>{f.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(f,this.samples)})),this._flushTextureCache(),this._renderId++}return y||(y=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.Gd(x/h,u/X),this._engine.bindFramebuffer(y,0,x,u,this.forceFullscreenViewport)):(this._scaleRatio.Gd(1,1),this._engine.bindFramebuffer(y,0,void 0,void 0,this.forceFullscreenViewport)),null===(z=(w=this._engine)._debugInsertMarker)||void 0===z||z.call(w,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(f),this.xl&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:E.clearColor,E._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),y}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let f;var z;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),f=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(z=f)||void 0===z?void 0:z.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let f=this._textureCache.length-1;f>=0;f--)this._textureCache[f].texture.dispose();this._textureCache.length=0}setPrePassRenderer(f){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=f.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(f){let z;if(f=f||this._camera,this._disposeTextures(),this._scene&&(z=this._scene.postProcesses.indexOf(this),-1!==z&&this._scene.postProcesses.splice(z,1)),this._parentContainer){const f=this._parentContainer.postProcesses.indexOf(this);f>-1&&this._parentContainer.postProcesses.splice(f,1),this._parentContainer=null}if(z=this._engine.postProcesses.indexOf(this),-1!==z&&this._engine.postProcesses.splice(z,1),f){if(f.detachPostProcess(this),z=f._postProcesses.indexOf(this),0===z&&f._postProcesses.length>0){const f=this._camera._getFirstPostProcess();f&&f.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const f=u.b.Serialize(this),z=this.getCamera()||this._scene&&this._scene.activeCamera;return f.customType="BABYLON."+this.getClassName(),f.cameraId=z?z.id:null,f.reusable=this._reusable,f.textureType=this._textureType,f.fragmentUrl=this._fragmentUrl,f.parameters=this._parameters,f.samplers=this._samplers,f.uniformBuffers=this._uniformBuffers,f.options=this._options,f.defines=this._postProcessDefines,f.textureFormat=this._textureFormat,f.vertexUrl=this._vertexUrl,f.indexParameters=this._indexParameters,f}clone(){const f=this.serialize();f._engine=this._engine,f.cameraId=null;const z=y.Parse(f,this._scene,"");return z?(z.onActivateObservable=this.onActivateObservable.clone(),z.onSizeChangedObservable=this.onSizeChangedObservable.clone(),z.onApplyObservable=this.onApplyObservable.clone(),z.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),z.onAfterRenderObservable=this.onAfterRenderObservable.clone(),z._prePassEffectConfiguration=this._prePassEffectConfiguration,z):null}static Parse(f,z,w){const S=(0,h.b)(f.customType);if(!S||!S._Parse)return null;const C=z?z.getCameraById(f.cameraId):null;return S._Parse(f,C,z,w)}static _Parse(f,z,w,S){return u.b.Parse((()=>new y(f.name,f.fragmentUrl,f.parameters,f.samplers,f.options,z,f.renderTargetSamplingMode,f._engine,f.reusable,f.defines,f.textureType,f.vertexUrl,f.indexParameters,!1,f.textureFormat)),f,w,S)}}(0,S.b)([(0,x.O)()],y.prototype,"uniqueId",void 0),(0,S.b)([(0,x.O)()],y.prototype,"name",null),(0,S.b)([(0,x.O)()],y.prototype,"width",void 0),(0,S.b)([(0,x.O)()],y.prototype,"height",void 0),(0,S.b)([(0,x.O)()],y.prototype,"renderTargetSamplingMode",void 0),(0,S.b)([(0,x.r)()],y.prototype,"clearColor",void 0),(0,S.b)([(0,x.O)()],y.prototype,"xl",void 0),(0,S.b)([(0,x.O)()],y.prototype,"forceAutoClearInAlphaMode",void 0),(0,S.b)([(0,x.O)()],y.prototype,"alphaMode",null),(0,S.b)([(0,x.O)()],y.prototype,"alphaConstants",void 0),(0,S.b)([(0,x.O)()],y.prototype,"enablePixelPerfectMode",void 0),(0,S.b)([(0,x.O)()],y.prototype,"forceFullscreenViewport",void 0),(0,S.b)([(0,x.O)()],y.prototype,"scaleMode",void 0),(0,S.b)([(0,x.O)()],y.prototype,"alwaysForcePOT",void 0),(0,S.b)([(0,x.O)("samples")],y.prototype,"_samples",void 0),(0,S.b)([(0,x.O)()],y.prototype,"adaptScaleToCurrentViewport",void 0),(0,h.f)("BABYLON.PostProcess",y)},2336:(f,z,w)=>{w.d(z,{d:()=>E});var S=w(789),C=w(527);class E{constructor(f){this._vertexBuffers={},this.onBeforeRenderObservable=new C.c,this._scene=f}_prepareBuffers(){if(this._vertexBuffers[S.f.PositionKind])return;const f=[];f.push(1,1),f.push(-1,1),f.push(-1,-1),f.push(1,-1),this._vertexBuffers[S.f.PositionKind]=new S.f(this._scene.getEngine(),f,S.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const f=[];f.push(0),f.push(1),f.push(2),f.push(0),f.push(2),f.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(f)}_rebuild(){const f=this._vertexBuffers[S.f.PositionKind];f&&(f._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const w=this._scene.activeCamera;return!!w&&(z=z||w._postProcesses.filter((f=>null!=f)),!(!z||0===z.length||!this._scene.postProcessesEnabled)&&(z[0].activate(w,f,null!==z&&void 0!==z),!0))}directRender(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const F=this._scene.getEngine();for(let x=0;x<f.length;x++){var J;if(x<f.length-1)f[x+1].activate(this._scene.activeCamera,null===z||void 0===z?void 0:z.texture);else z?F.bindFramebuffer(z,S,void 0,void 0,w,C):E||F.restoreDefaultFramebuffer(),null===(J=F._debugInsertMarker)||void 0===J||J.call(F,`post process ${f[x].name} output`);const u=f[x],h=u.apply();h&&(u.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),F.bindBuffers(this._vertexBuffers,this._indexBuffer,h),F.drawElementsType(0,0,6),u.onAfterRenderObservable.notifyObservers(h))}F.setDepthBuffer(!0),F.setDepthWrite(!0)}_finalizeFrame(f,z,w,S){let C=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const E=this._scene.activeCamera;if(!E)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(S=S||E._postProcesses.filter((f=>null!=f))).length||!this._scene.postProcessesEnabled)return;const F=this._scene.getEngine();for(let x=0,u=S.length;x<u;x++){const h=S[x];var J;if(x<u-1)h._outputTexture=S[x+1].activate(E,null===z||void 0===z?void 0:z.texture);else z?(F.bindFramebuffer(z,w,void 0,void 0,C),h._outputTexture=z):(F.restoreDefaultFramebuffer(),h._outputTexture=null),null===(J=F._debugInsertMarker)||void 0===J||J.call(F,`post process ${S[x].name} output`);if(f)break;const X=h.apply();X&&(h.onBeforeRenderObservable.notifyObservers(X),this._prepareBuffers(),F.bindBuffers(this._vertexBuffers,this._indexBuffer,X),F.drawElementsType(0,0,6),h.onAfterRenderObservable.notifyObservers(X))}F.setDepthBuffer(!0),F.setDepthWrite(!0),F.setAlphaMode(0)}dispose(){const f=this._vertexBuffers[S.f.PositionKind];f&&(f.dispose(),this._vertexBuffers[S.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},2343:(f,z,w)=>{w.d(z,{d:()=>J});var S=w(715),C=w(720);class E{set opaqueSortCompareFn(f){this._opaqueSortCompareFn=f||E.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(f){this._alphaTestSortCompareFn=f||E.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(f){this._transparentSortCompareFn=f||E.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=f,this._opaqueSubMeshes=new S.h(256),this._transparentSubMeshes=new S.h(256),this._alphaTestSubMeshes=new S.h(256),this._depthOnlySubMeshes=new S.h(256),this._particleSystems=new S.h(256),this._spriteManagers=new S.h(256),this._empty=!0,this._edgesRenderers=new S.d(16),this._scene=z,this.opaqueSortCompareFn=w,this.alphaTestSortCompareFn=C,this.transparentSortCompareFn=E}render(f,z,w,S){if(f)return void f(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const C=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(C.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),C.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const E=C.getStencilBuffer();if(C.setStencilBuffer(!1),z&&this._renderSprites(),w&&this._renderParticles(S),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(C.setStencilBuffer(E),this._scene.useOrderIndependentTransparency){const f=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);f.length&&this._renderTransparent(f)}else this._renderTransparent(this._transparentSubMeshes);C.setAlphaMode(0)}if(C.setStencilBuffer(!1),this._edgesRenderers.length){for(let f=0;f<this._edgesRenderers.length;f++)this._edgesRenderers.data[f].render();C.setAlphaMode(0)}C.setStencilBuffer(E)}_renderOpaqueSorted(f){E._RenderSorted(f,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(f){E._RenderSorted(f,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(f){E._RenderSorted(f,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(f,z,w,S){let F,J=0;const x=w?w.globalPosition:E._ZeroVector;if(S)for(;J<f.length;J++)F=f.data[J],F._alphaIndex=F.getMesh().alphaIndex,F._distanceToCamera=C.n.Distance(F.getBoundingInfo().boundingSphere.centerWorld,x);const u=f.length===f.data.length?f.data:f.data.slice(0,f.length);z&&u.sort(z);const h=u[0].getMesh().va();for(J=0;J<u.length;J++)if(F=u[J],!h._activeMeshesFrozenButKeepClipping||F.isInFrustum(h._frustumPlanes)){if(S){const f=F.Ha();if(f&&f.needDepthPrePass){const z=f.va().getEngine();z.setColorWrite(!1),z.setAlphaMode(0),F.render(!1),z.setColorWrite(!0)}}F.render(S)}}static defaultTransparentSortCompare(f,z){return f._alphaIndex>z._alphaIndex?1:f._alphaIndex<z._alphaIndex?-1:E.backToFrontSortCompare(f,z)}static backToFrontSortCompare(f,z){return f._distanceToCamera<z._distanceToCamera?1:f._distanceToCamera>z._distanceToCamera?-1:0}static frontToBackSortCompare(f,z){return f._distanceToCamera<z._distanceToCamera?-1:f._distanceToCamera>z._distanceToCamera?1:0}static PainterSortCompare(f,z){const w=f.getMesh(),S=z.getMesh();return w.material&&S.material?w.material.uniqueId-S.material.uniqueId:w.uniqueId-S.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(f,z,w){void 0===z&&(z=f.getMesh()),void 0===w&&(w=f.Ha()),null!==w&&void 0!==w&&(w.needAlphaBlendingForMesh(z)?this._transparentSubMeshes.push(f):w.needAlphaTesting()?(w.needDepthPrePass&&this._depthOnlySubMeshes.push(f),this._alphaTestSubMeshes.push(f)):(w.needDepthPrePass&&this._depthOnlySubMeshes.push(f),this._opaqueSubMeshes.push(f)),z._renderingGroup=this,z._edgesRenderer&&z.isEnabled()&&z.isVisible&&z._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(z._edgesRenderer),this._empty=!1)}dispatchSprites(f){this._spriteManagers.push(f),this._empty=!1}dispatchParticles(f){this._particleSystems.push(f),this._empty=!1}_renderParticles(f){if(0===this._particleSystems.length)return;const z=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let w=0;w<this._particleSystems.length;w++){const S=this._particleSystems.data[w];if(0===(z&&z.layerMask&S.layerMask))continue;const C=S.j;C.position&&f&&-1===f.indexOf(C)||this._scene._activeParticles.addCount(S.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const f=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let z=0;z<this._spriteManagers.length;z++){const w=this._spriteManagers.data[z];0!==(f&&f.layerMask&w.layerMask)&&w.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}E._ZeroVector=C.n.Zero();class F{}class J{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(f){f!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=f,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const f of this._scene.meshes)if(f.pk)for(const z of f.pk)z._wasDispatched=!1;if(this._scene.spriteManagers)for(const f of this._scene.spriteManagers)f._wasDispatched=!1;for(const f of this._scene.zk)f._wasDispatched=!1}constructor(f){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new F,this._maintainStateBetweenFrames=!1,this._scene=f;for(let z=J.MIN_RENDERINGGROUPS;z<J.MAX_RENDERINGGROUPS;z++)this._autoClearDepthStencil[z]={xl:!0,depth:!0,stencil:!0}}getRenderingGroup(f){const z=f||0;return this._prepareRenderingGroup(z),this._renderingGroups[z]}_clearDepthStencilBuffer(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],z=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,f,z),this._depthStencilBufferAlreadyCleaned=!0)}render(f,z,w,S){const C=this._renderingGroupInfo;if(C.Rc=this._scene,C.camera=this._scene.activeCamera,this._scene.spriteManagers&&S)for(let E=0;E<this._scene.spriteManagers.length;E++){const f=this._scene.spriteManagers[E];this.dispatchSprites(f)}for(let E=J.MIN_RENDERINGGROUPS;E<J.MAX_RENDERINGGROUPS;E++){this._depthStencilBufferAlreadyCleaned=E===J.MIN_RENDERINGGROUPS;const F=this._renderingGroups[E];if(!F||F._empty)continue;const x=1<<E;if(C.renderingGroupId=E,this._scene.onBeforeRenderingGroupObservable.notifyObservers(C,x),J.AUTOCLEAR){const f=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(E):this._autoClearDepthStencil[E];f&&f.xl&&this._clearDepthStencilBuffer(f.depth,f.stencil)}for(const f of this._scene._beforeRenderingGroupDrawStage)f.action(E);F.render(f,S,w,z);for(const f of this._scene._afterRenderingGroupDrawStage)f.action(E);this._scene.onAfterRenderingGroupObservable.notifyObservers(C,x)}}reset(){if(!this.maintainStateBetweenFrames)for(let f=J.MIN_RENDERINGGROUPS;f<J.MAX_RENDERINGGROUPS;f++){const z=this._renderingGroups[f];z&&z.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let f=J.MIN_RENDERINGGROUPS;f<J.MAX_RENDERINGGROUPS;f++){const z=this._renderingGroups[f];z&&z.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let f=J.MIN_RENDERINGGROUPS;f<J.MAX_RENDERINGGROUPS;f++){const z=this._renderingGroups[f];z&&z.dispose()}}_prepareRenderingGroup(f){void 0===this._renderingGroups[f]&&(this._renderingGroups[f]=new E(f,this._scene,this._customOpaqueSortCompareFn[f],this._customAlphaTestSortCompareFn[f],this._customTransparentSortCompareFn[f]))}dispatchSprites(f){this.maintainStateBetweenFrames&&f._wasDispatched||(f._wasDispatched=!0,this.getRenderingGroup(f.renderingGroupId).dispatchSprites(f))}dispatchParticles(f){this.maintainStateBetweenFrames&&f._wasDispatched||(f._wasDispatched=!0,this.getRenderingGroup(f.renderingGroupId).dispatchParticles(f))}dispatch(f,z,w){void 0===z&&(z=f.getMesh()),this.maintainStateBetweenFrames&&f._wasDispatched||(f._wasDispatched=!0,this.getRenderingGroup(z.renderingGroupId).dispatch(f,z,w))}setRenderingOrder(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[f]=z,this._customAlphaTestSortCompareFn[f]=w,this._customTransparentSortCompareFn[f]=S,this._renderingGroups[f]){const z=this._renderingGroups[f];z.opaqueSortCompareFn=this._customOpaqueSortCompareFn[f],z.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[f],z.transparentSortCompareFn=this._customTransparentSortCompareFn[f]}}setRenderingAutoClearDepthStencil(f,z){let w=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[f]={xl:z,depth:w,stencil:S}}getAutoClearDepthStencilSetup(f){return this._autoClearDepthStencil[f]}}J.MAX_RENDERINGGROUPS=4,J.MIN_RENDERINGGROUPS=0,J.AUTOCLEAR=!0},2354:(f,z,w)=>{w.r(z),w.d(z,{postprocessVertexShader:()=>E});const S="postprocessVertexShader",C="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";w(628).d.ShadersStore[S]=C;const E={name:S,shader:C}}}]);