"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[8],{10218:(b,G,i)=>{i.r(G),i.d(G,{_HDRTextureLoader:()=>J});var g=i(1014);class c{static ConvertPanoramaToCubemap(b,G,i,g){let c=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!b)throw"ConvertPanoramaToCubemap: input cannot be null";if(b.length!=G*i*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(g,this.FACE_FRONT,b,G,i,c),back:this.CreateCubemapTexture(g,this.FACE_BACK,b,G,i,c),left:this.CreateCubemapTexture(g,this.FACE_LEFT,b,G,i,c),right:this.CreateCubemapTexture(g,this.FACE_RIGHT,b,G,i,c),up:this.CreateCubemapTexture(g,this.FACE_UP,b,G,i,c),down:this.CreateCubemapTexture(g,this.FACE_DOWN,b,G,i,c),size:g,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(b,G,i,g,c){let V=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const z=new ArrayBuffer(b*b*4*3),E=new Float32Array(z),Z=V?Math.max(1,Math.round(g/4/b)):1,Y=1/Z,J=Y*Y,q=G[1].ad(G[0]).scale(Y/b),o=G[3].ad(G[2]).scale(Y/b),s=1/b;let F=0;for(let l=0;l<b;l++)for(let V=0;V<Z;V++){let V=G[0],z=G[2];for(let G=0;G<b;G++)for(let Y=0;Y<Z;Y++){const Z=z.ad(V).scale(F).add(V);Z.normalize();const Y=this.CalcProjectionSpherical(Z,i,g,c);E[l*b*3+3*G+0]+=Y.r*J,E[l*b*3+3*G+1]+=Y.g*J,E[l*b*3+3*G+2]+=Y.b*J,V=V.add(q),z=z.add(o)}F+=s*Y}return E}static CalcProjectionSpherical(b,G,i,g){let c=Math.atan2(b.z,b.x);const V=Math.acos(b.y);for(;c<-Math.PI;)c+=2*Math.PI;for(;c>Math.PI;)c-=2*Math.PI;let z=c/Math.PI;const E=V/Math.PI;z=.5*z+.5;let Z=Math.round(z*i);Z<0?Z=0:Z>=i&&(Z=i-1);let Y=Math.round(E*g);Y<0?Y=0:Y>=g&&(Y=g-1);const J=g-Y-1;return{r:G[J*i*3+3*Z+0],g:G[J*i*3+3*Z+1],b:G[J*i*3+3*Z+2]}}}function V(b,G,i,g,c,V){c>0?(c=function(b,G){return G>1023?b*Math.pow(2,1023)*Math.pow(2,G-1023):G<-1074?b*Math.pow(2,-1074)*Math.pow(2,G+1074):b*Math.pow(2,G)}(1,c-136),b[V+0]=G*c,b[V+1]=i*c,b[V+2]=g*c):(b[V+0]=0,b[V+1]=0,b[V+2]=0)}function z(b,G){let i="",g="";for(let c=G;c<b.length-G&&(g=String.fromCharCode(b[c]),"\n"!=g);c++)i+=g;return i}function E(b){let G=0,i=0,g=z(b,0);if("#"!=g[0]||"?"!=g[1])throw"Bad HDR Format.";let c=!1,V=!1,E=0;do{E+=g.length+1,g=z(b,E),"FORMAT=32-bit_rle_rgbe"==g?V=!0:0==g.length&&(c=!0)}while(!c);if(!V)throw"HDR Bad header format, unsupported FORMAT";E+=g.length+1,g=z(b,E);const Z=/^-Y (.*) \+X (.*)$/g.exec(g);if(!Z||Z.length<3)throw"HDR Bad header format, no size";if(i=parseInt(Z[2]),G=parseInt(Z[1]),i<8||i>32767)throw"HDR Bad header format, unsupported size";return E+=g.length+1,{height:G,width:i,dataPosition:E}}function Z(b,G){return function(b,G){let i=G.height;const g=G.width;let c,z,E,Z,J,q=G.dataPosition,o=0,s=0,F=0;const l=new ArrayBuffer(4*g),v=new Uint8Array(l),u=new ArrayBuffer(G.width*G.height*4*3),W=new Float32Array(u);for(;i>0;){if(c=b[q++],z=b[q++],E=b[q++],Z=b[q++],2!=c||2!=z||128&E||G.width<8||G.width>32767)return Y(b,G);if((E<<8|Z)!=g)throw"HDR Bad header format, wrong scan line width";for(o=0,F=0;F<4;F++)for(s=(F+1)*g;o<s;)if(c=b[q++],z=b[q++],c>128){if(J=c-128,0==J||J>s-o)throw"HDR Bad Format, bad scanline data (run)";for(;J-- >0;)v[o++]=z}else{if(J=c,0==J||J>s-o)throw"HDR Bad Format, bad scanline data (non-run)";if(v[o++]=z,--J>0)for(let G=0;G<J;G++)v[o++]=b[q++]}for(F=0;F<g;F++)c=v[F],z=v[F+g],E=v[F+2*g],Z=v[F+3*g],V(W,c,z,E,Z,(G.height-i)*g*3+3*F);i--}return W}(b,G)}function Y(b,G){let i=G.height;const g=G.width;let c,z,E,Z,Y,J=G.dataPosition;const q=new ArrayBuffer(G.width*G.height*4*3),o=new Float32Array(q);for(;i>0;){for(Y=0;Y<G.width;Y++)c=b[J++],z=b[J++],E=b[J++],Z=b[J++],V(o,c,z,E,Z,(G.height-i)*g*3+3*Y);i--}return o}c.FACE_LEFT=[new g.l(-1,-1,-1),new g.l(1,-1,-1),new g.l(-1,1,-1),new g.l(1,1,-1)],c.FACE_RIGHT=[new g.l(1,-1,1),new g.l(-1,-1,1),new g.l(1,1,1),new g.l(-1,1,1)],c.FACE_FRONT=[new g.l(1,-1,-1),new g.l(1,-1,1),new g.l(1,1,-1),new g.l(1,1,1)],c.FACE_BACK=[new g.l(-1,-1,1),new g.l(-1,-1,-1),new g.l(-1,1,1),new g.l(-1,1,-1)],c.FACE_DOWN=[new g.l(1,1,-1),new g.l(1,1,1),new g.l(-1,1,-1),new g.l(-1,1,1)],c.FACE_UP=[new g.l(-1,-1,-1),new g.l(-1,-1,1),new g.l(1,-1,-1),new g.l(1,-1,1)];class J{constructor(){this.supportCascades=!1}loadCubeData(){throw".env not supported in Cube."}loadData(b,G,i){const g=new Uint8Array(b.buffer,b.byteOffset,b.byteLength),c=E(g),V=Z(g,c),z=c.width*c.height,Y=new Float32Array(4*z);for(let E=0;E<z;E+=1)Y[4*E]=V[3*E],Y[4*E+1]=V[3*E+1],Y[4*E+2]=V[3*E+2],Y[4*E+3]=1;i(c.width,c.height,G.generateMipMaps,!1,(()=>{const b=G.getEngine();G.type=1,G.format=5,G._gammaSpace=!1,b._uploadDataToTextureDirectly(G,Y)}))}}}}]);