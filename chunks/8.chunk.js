"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[8],{11034:(b,o,l)=>{l.r(o),l.d(o,{_HDRTextureLoader:()=>A});var g=l(1054);class I{static ConvertPanoramaToCubemap(b,o,l,g){let I=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!b)throw"ConvertPanoramaToCubemap: input cannot be null";if(b.length!=o*l*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(g,this.FACE_FRONT,b,o,l,I),back:this.CreateCubemapTexture(g,this.FACE_BACK,b,o,l,I),left:this.CreateCubemapTexture(g,this.FACE_LEFT,b,o,l,I),right:this.CreateCubemapTexture(g,this.FACE_RIGHT,b,o,l,I),up:this.CreateCubemapTexture(g,this.FACE_UP,b,o,l,I),down:this.CreateCubemapTexture(g,this.FACE_DOWN,b,o,l,I),size:g,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(b,o,l,g,I){let v=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const W=new ArrayBuffer(b*b*4*3),n=new Float32Array(W),T=v?Math.max(1,Math.round(g/4/b)):1,t=1/T,A=t*t,w=o[1].Ic(o[0]).scale(t/b),C=o[3].Ic(o[2]).scale(t/b),U=1/b;let m=0;for(let N=0;N<b;N++)for(let v=0;v<T;v++){let v=o[0],W=o[2];for(let o=0;o<b;o++)for(let t=0;t<T;t++){const T=W.Ic(v).scale(m).add(v);T.normalize();const t=this.CalcProjectionSpherical(T,l,g,I);n[N*b*3+3*o+0]+=t.r*A,n[N*b*3+3*o+1]+=t.g*A,n[N*b*3+3*o+2]+=t.b*A,v=v.add(w),W=W.add(C)}m+=U*t}return n}static CalcProjectionSpherical(b,o,l,g){let I=Math.atan2(b.z,b.x);const v=Math.acos(b.y);for(;I<-Math.PI;)I+=2*Math.PI;for(;I>Math.PI;)I-=2*Math.PI;let W=I/Math.PI;const n=v/Math.PI;W=.5*W+.5;let T=Math.round(W*l);T<0?T=0:T>=l&&(T=l-1);let t=Math.round(n*g);t<0?t=0:t>=g&&(t=g-1);const A=g-t-1;return{r:o[A*l*3+3*T+0],g:o[A*l*3+3*T+1],b:o[A*l*3+3*T+2]}}}function v(b,o,l,g,I,v){I>0?(I=function(b,o){return o>1023?b*Math.pow(2,1023)*Math.pow(2,o-1023):o<-1074?b*Math.pow(2,-1074)*Math.pow(2,o+1074):b*Math.pow(2,o)}(1,I-136),b[v+0]=o*I,b[v+1]=l*I,b[v+2]=g*I):(b[v+0]=0,b[v+1]=0,b[v+2]=0)}function W(b,o){let l="",g="";for(let I=o;I<b.length-o&&(g=String.fromCharCode(b[I]),"\n"!=g);I++)l+=g;return l}function n(b){let o=0,l=0,g=W(b,0);if("#"!=g[0]||"?"!=g[1])throw"Bad HDR Format.";let I=!1,v=!1,n=0;do{n+=g.length+1,g=W(b,n),"FORMAT=32-bit_rle_rgbe"==g?v=!0:0==g.length&&(I=!0)}while(!I);if(!v)throw"HDR Bad header format, unsupported FORMAT";n+=g.length+1,g=W(b,n);const T=/^-Y (.*) \+X (.*)$/g.exec(g);if(!T||T.length<3)throw"HDR Bad header format, no size";if(l=parseInt(T[2]),o=parseInt(T[1]),l<8||l>32767)throw"HDR Bad header format, unsupported size";return n+=g.length+1,{height:o,width:l,dataPosition:n}}function T(b,o){return function(b,o){let l=o.height;const g=o.width;let I,W,n,T,A,w=o.dataPosition,C=0,U=0,m=0;const N=new ArrayBuffer(4*g),x=new Uint8Array(N),k=new ArrayBuffer(o.width*o.height*4*3),D=new Float32Array(k);for(;l>0;){if(I=b[w++],W=b[w++],n=b[w++],T=b[w++],2!=I||2!=W||128&n||o.width<8||o.width>32767)return t(b,o);if((n<<8|T)!=g)throw"HDR Bad header format, wrong scan line width";for(C=0,m=0;m<4;m++)for(U=(m+1)*g;C<U;)if(I=b[w++],W=b[w++],I>128){if(A=I-128,0==A||A>U-C)throw"HDR Bad Format, bad scanline data (run)";for(;A-- >0;)x[C++]=W}else{if(A=I,0==A||A>U-C)throw"HDR Bad Format, bad scanline data (non-run)";if(x[C++]=W,--A>0)for(let o=0;o<A;o++)x[C++]=b[w++]}for(m=0;m<g;m++)I=x[m],W=x[m+g],n=x[m+2*g],T=x[m+3*g],v(D,I,W,n,T,(o.height-l)*g*3+3*m);l--}return D}(b,o)}function t(b,o){let l=o.height;const g=o.width;let I,W,n,T,t,A=o.dataPosition;const w=new ArrayBuffer(o.width*o.height*4*3),C=new Float32Array(w);for(;l>0;){for(t=0;t<o.width;t++)I=b[A++],W=b[A++],n=b[A++],T=b[A++],v(C,I,W,n,T,(o.height-l)*g*3+3*t);l--}return C}I.FACE_LEFT=[new g.l(-1,-1,-1),new g.l(1,-1,-1),new g.l(-1,1,-1),new g.l(1,1,-1)],I.FACE_RIGHT=[new g.l(1,-1,1),new g.l(-1,-1,1),new g.l(1,1,1),new g.l(-1,1,1)],I.FACE_FRONT=[new g.l(1,-1,-1),new g.l(1,-1,1),new g.l(1,1,-1),new g.l(1,1,1)],I.FACE_BACK=[new g.l(-1,-1,1),new g.l(-1,-1,-1),new g.l(-1,1,1),new g.l(-1,1,-1)],I.FACE_DOWN=[new g.l(1,1,-1),new g.l(1,1,1),new g.l(-1,1,-1),new g.l(-1,1,1)],I.FACE_UP=[new g.l(-1,-1,-1),new g.l(-1,-1,1),new g.l(1,-1,-1),new g.l(1,-1,1)];class A{constructor(){this.supportCascades=!1}loadCubeData(){throw".env not supported in Cube."}loadData(b,o,l){const g=new Uint8Array(b.buffer,b.byteOffset,b.byteLength),I=n(g),v=T(g,I),W=I.width*I.height,t=new Float32Array(4*W);for(let n=0;n<W;n+=1)t[4*n]=v[3*n],t[4*n+1]=v[3*n+1],t[4*n+2]=v[3*n+2],t[4*n+3]=1;l(I.width,I.height,o.generateMipMaps,!1,(()=>{const b=o.getEngine();o.type=1,o.format=5,o._gammaSpace=!1,b._uploadDataToTextureDirectly(o,t)}))}}}}]);