"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[20,21],{11727:(Z,x,F)=>{var u=F(11736),G=F(11201);G.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(G.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=u.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((Z=>{this._texture._sphericalPolynomial=Z,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(Z){this._texture&&(this._texture._sphericalPolynomial=Z)},enumerable:!0,configurable:!0})},11736:(Z,x,F)=>{F.d(x,{e:()=>t});var u=F(11179),G=F(11194),f=F(11399),Y=F(11188),j=F(11230);class d{constructor(Z,x,F,u){this.name=Z,this.worldAxisForNormal=x,this.worldAxisForFileX=F,this.worldAxisForFileY=u}}class t{static ConvertCubeMapTextureToSphericalPolynomial(Z){var x;if(!Z.isCube)return null;null===(x=Z.KZ())||void 0===x||x.getEngine().flushFramebuffer();const F=Z.getSize().width,u=Z.readPixels(0,void 0,void 0,!1),G=Z.readPixels(1,void 0,void 0,!1);let f,Y;Z.isRenderTarget?(f=Z.readPixels(3,void 0,void 0,!1),Y=Z.readPixels(2,void 0,void 0,!1)):(f=Z.readPixels(2,void 0,void 0,!1),Y=Z.readPixels(3,void 0,void 0,!1));const j=Z.readPixels(4,void 0,void 0,!1),d=Z.readPixels(5,void 0,void 0,!1),t=Z.gammaSpace;let o=0;return 1!=Z.textureType&&2!=Z.textureType||(o=1),new Promise((Z=>{Promise.all([G,u,f,Y,j,d]).then((x=>{let[u,G,f,Y,j,d]=x;const c={size:F,right:G,left:u,up:f,down:Y,front:j,back:d,format:5,type:o,gammaSpace:t};Z(this.ConvertCubeMapToSphericalPolynomial(c))}))}))}static _AreaElement(Z,x){return Math.atan2(Z*x,Math.sqrt(Z*Z+x*x+1))}static ConvertCubeMapToSphericalPolynomial(Z){const x=new f.e;let F=0;const u=2/Z.size,d=u,t=.5*u,o=t-1;for(let f=0;f<6;f++){const c=this._FileFaces[f],s=Z[c.name];let J=o;const p=5===Z.format?4:3;for(let f=0;f<Z.size;f++){let U=o;for(let d=0;d<Z.size;d++){const o=c.worldAxisForFileX.scale(U).add(c.worldAxisForFileY.scale(J)).add(c.worldAxisForNormal);o.normalize();const k=this._AreaElement(U-t,J-t)-this._AreaElement(U-t,J+t)-this._AreaElement(U+t,J-t)+this._AreaElement(U+t,J+t);let M=s[f*Z.size*p+d*p+0],m=s[f*Z.size*p+d*p+1],C=s[f*Z.size*p+d*p+2];isNaN(M)&&(M=0),isNaN(m)&&(m=0),isNaN(C)&&(C=0),0===Z.type&&(M/=255,m/=255,C/=255),Z.gammaSpace&&(M=Math.pow((0,G.Clamp)(M),Y.l),m=Math.pow((0,G.Clamp)(m),Y.l),C=Math.pow((0,G.Clamp)(C),Y.l));const L=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const Z=Math.max(M,m,C);if(Z>L){const x=L/Z;M*=x,m*=x,C*=x}}else M=(0,G.Clamp)(M,0,L),m=(0,G.Clamp)(m,0,L),C=(0,G.Clamp)(C,0,L);const H=new j.Lx(M,m,C);x.addLight(o,H,k),F+=k,U+=u}J+=d}}const c=6*(4*Math.PI)/6/F;return x.scaleInPlace(c),x.convertIncidentRadianceToIrradiance(),x.convertIrradianceToLambertianRadiance(),f.f.FromHarmonics(x)}}t._FileFaces=[new d("right",new u.kx(1,0,0),new u.kx(0,0,-1),new u.kx(0,-1,0)),new d("left",new u.kx(-1,0,0),new u.kx(0,0,1),new u.kx(0,-1,0)),new d("up",new u.kx(0,1,0),new u.kx(1,0,0),new u.kx(0,0,1)),new d("down",new u.kx(0,-1,0),new u.kx(1,0,0),new u.kx(0,0,-1)),new d("front",new u.kx(0,0,1),new u.kx(1,0,0),new u.kx(0,-1,0)),new d("back",new u.kx(0,0,-1),new u.kx(-1,0,0),new u.kx(0,-1,0))],t.MAX_HDRI_VALUE=4096,t.PRESERVE_CLAMPED_COLORS=!1},11433:(Z,x,F)=>{F.r(x),F.d(x,{Dispose:()=>s,DumpData:()=>c,DumpDataAsync:()=>o,DumpFramebuffer:()=>t,DumpTools:()=>J});var u=F(11292),G=F(10994),f=F(11194),Y=F(11037);let j,d=null;async function t(Z,x,F,u){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",f=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0;const j=await F.readPixels(0,0,Z,x);c(Z,x,new Uint8Array(j.buffer),u,G,f,!0,void 0,Y)}async function o(Z,x,F){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",G=arguments.length>4?arguments[4]:void 0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7?arguments[7]:void 0;return await new Promise((d=>{c(Z,x,F,(Z=>d(Z)),u,G,f,Y,j)}))}function c(Z,x,t,o){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",J=arguments.length>5?arguments[5]:void 0,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7],k=arguments.length>8?arguments[8]:void 0;(async function(){return d||(d=new Promise(((Z,x)=>{let G,f=null;const d={Kf:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(F.bind(F,11325)).then((t=>{let{ThinEngine:o}=t;const c=Y.c.Instances.length;try{G=new OffscreenCanvas(100,100),f=new o(G,!1,d)}catch(U){var J;c<Y.c.Instances.length&&(null===(J=Y.c.Instances.pop())||void 0===J||J.dispose()),G=document.createElement("canvas"),f=new o(G,!1,d)}Y.c.Instances.pop(),Y.c.OnEnginesDisposedObservable.add((Z=>{f&&Z!==f&&!f.J&&0===Y.c.Instances.length&&s()})),f.getCaps().parallelShaderCompile=void 0;const p=new u.c(f);F.e(52).then(F.bind(F,13746)).then((F=>{let{passPixelShader:Y}=F;if(!f)return void x("Engine is not defined");const d=new u.f({Ux:f,name:Y.name,fragmentShader:Y.shader,samplerNames:["textureSampler"]});j={canvas:G,Ux:f,renderer:p,wrapper:d},Z(j)}))})).catch(x)}))),await d})().then((F=>{if(F.Ux.setSize(Z,x,!0),t instanceof Float32Array){const Z=new Uint8Array(t.length);let x=t.length;for(;x--;){const F=t[x];Z[x]=Math.round(255*(0,f.Clamp)(F))}t=Z}const u=F.Ux.createRawTexture(t,Z,x,5,!1,!p,1);F.renderer.setViewport(),F.renderer.applyEffectWrapper(F.wrapper),F.wrapper.effect._bindTexture("textureSampler",u),F.renderer.draw(),U?G.Tools.ToBlob(F.canvas,(Z=>{const x=new FileReader;x.onload=Z=>{const x=Z.target.result;o&&o(x)},x.readAsArrayBuffer(Z)}),c,k):G.Tools.EncodeScreenshotCanvasData(F.canvas,o,c,J,k),u.dispose()}))}function s(){var Z;j?(j.wrapper.dispose(),j.renderer.dispose(),j.Ux.dispose()):null===(Z=d)||void 0===Z||Z.then((Z=>{Z.wrapper.dispose(),Z.renderer.dispose(),Z.Ux.dispose()}));d=null,j=null}const J={DumpData:c,DumpDataAsync:o,DumpFramebuffer:t,Dispose:s};G.Tools.DumpData=c,G.Tools.DumpDataAsync=o,G.Tools.DumpFramebuffer=t},11719:(Z,x,F)=>{F.d(x,{e:()=>f});var u=F(11289),G=F(11442);class f{static ExpandRGBDTexture(Z){const x=Z._texture;if(!x||!Z.isRGBD)return;const G=x.getEngine(),f=G.getCaps(),Y=x.isReady;let j=!1;f.textureHalfFloatRender&&f.textureHalfFloatLinearFiltering?(j=!0,x.type=2):f.textureFloatRender&&f.textureFloatLinearFiltering&&(j=!0,x.type=1),j&&(x.isReady=!1,x._isRGBD=!1,x.invertY=!1);const d=async()=>{const f=G.isWebGPU,Y=f?1:0;x.isReady=!1,f?await F.e(42).then(F.bind(F,14282)):await F.e(35).then(F.bind(F,14290));const j=new u.c("rgbdDecode","rgbdDecode",null,null,1,null,3,G,!1,void 0,x.type,void 0,null,!1,void 0,Y);j.externalTextureSamplerBinding=!0;const d=G.createRenderTargetTexture(x.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:x.samplingMode,type:x.type,format:5});j.onEffectCreatedObservable.addOnce((F=>{F.executeWhenCompiled((()=>{j.onApply=Z=>{Z._bindTexture("textureSampler",x),Z.setFloat2("scale",1,1)},Z.KZ().postProcessManager.directRender([j],d,!0),G.restoreDefaultFramebuffer(),G._releaseTexture(x),j&&j.dispose(),d._swapAndDie(x),x.isReady=!0}))}))};j&&(Y?d():Z.onLoadObservable.addOnce(d))}static async EncodeTextureToRGBD(Z,x){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return x.getEngine().isWebGPU?await F.e(43).then(F.bind(F,14303)):await F.e(36).then(F.bind(F,14298)),await(0,G.b)("rgbdEncode",Z,x,u,1,5)}}}}]);