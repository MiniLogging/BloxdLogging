"use strict";(self.ra6kpa9z1sg=self.ra6kpa9z1sg||[]).push([[20,21],{13293:(p,b,M)=>{var h=M(13302),Q=M(12798);Q.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(Q.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=h.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((p=>{this._texture._sphericalPolynomial=p,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(p){this._texture&&(this._texture._sphericalPolynomial=p)},enumerable:!0,configurable:!0})},13302:(p,b,M)=>{M.d(b,{c:()=>t});var h=M(12777),Q=M(12789),mp=M(12957),y=M(12779),P=M(12820);class w{constructor(p,b,M,h){this.name=p,this.worldAxisForNormal=b,this.worldAxisForFileX=M,this.worldAxisForFileY=h}}class t{static ConvertCubeMapTextureToSphericalPolynomial(p){var b;if(!p.isCube)return null;null===(b=p.upp())||void 0===b||b.getEngine().flushFramebuffer();const M=p.getSize().width,h=p.readPixels(0,void 0,void 0,!1),Q=p.readPixels(1,void 0,void 0,!1);let mp,y;p.isRenderTarget?(mp=p.readPixels(3,void 0,void 0,!1),y=p.readPixels(2,void 0,void 0,!1)):(mp=p.readPixels(2,void 0,void 0,!1),y=p.readPixels(3,void 0,void 0,!1));const P=p.readPixels(4,void 0,void 0,!1),w=p.readPixels(5,void 0,void 0,!1),t=p.gammaSpace;let z=0;return 1!=p.textureType&&2!=p.textureType||(z=1),new Promise((p=>{Promise.all([Q,h,mp,y,P,w]).then((b=>{let[h,Q,mp,y,P,w]=b;const x={size:M,right:Q,left:h,up:mp,down:y,front:P,back:w,format:5,type:z,gammaSpace:t};p(this.ConvertCubeMapToSphericalPolynomial(x))}))}))}static _AreaElement(p,b){return Math.atan2(p*b,Math.sqrt(p*p+b*b+1))}static ConvertCubeMapToSphericalPolynomial(p){const b=new mp.e;let M=0;const h=2/p.size,w=h,t=.5*h,z=t-1;for(let mp=0;mp<6;mp++){const x=this._FileFaces[mp],S=p[x.name];let X=z;const c=5===p.format?4:3;for(let mp=0;mp<p.size;mp++){let J=z;for(let w=0;w<p.size;w++){const z=x.worldAxisForFileX.scale(J).add(x.worldAxisForFileY.scale(X)).add(x.worldAxisForNormal);z.normalize();const g=this._AreaElement(J-t,X-t)-this._AreaElement(J-t,X+t)-this._AreaElement(J+t,X-t)+this._AreaElement(J+t,X+t);let f=S[mp*p.size*c+w*c+0],Y=S[mp*p.size*c+w*c+1],a=S[mp*p.size*c+w*c+2];isNaN(f)&&(f=0),isNaN(Y)&&(Y=0),isNaN(a)&&(a=0),0===p.type&&(f/=255,Y/=255,a/=255),p.gammaSpace&&(f=Math.pow((0,Q.Clamp)(f),y.m),Y=Math.pow((0,Q.Clamp)(Y),y.m),a=Math.pow((0,Q.Clamp)(a),y.m));const o=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const p=Math.max(f,Y,a);if(p>o){const b=o/p;f*=b,Y*=b,a*=b}}else f=(0,Q.Clamp)(f,0,o),Y=(0,Q.Clamp)(Y,0,o),a=(0,Q.Clamp)(a,0,o);const l=new P.wM(f,Y,a);b.addLight(z,l,g),M+=g,J+=h}X+=w}}const x=6*(4*Math.PI)/6/M;return b.scaleInPlace(x),b.convertIncidentRadianceToIrradiance(),b.convertIrradianceToLambertianRadiance(),mp.f.FromHarmonics(b)}}t._FileFaces=[new w("right",new h.QM(1,0,0),new h.QM(0,0,-1),new h.QM(0,-1,0)),new w("left",new h.QM(-1,0,0),new h.QM(0,0,1),new h.QM(0,-1,0)),new w("up",new h.QM(0,1,0),new h.QM(1,0,0),new h.QM(0,0,1)),new w("down",new h.QM(0,-1,0),new h.QM(1,0,0),new h.QM(0,0,-1)),new w("front",new h.QM(0,0,1),new h.QM(1,0,0),new h.QM(0,-1,0)),new w("back",new h.QM(0,0,-1),new h.QM(-1,0,0),new h.QM(0,-1,0))],t.MAX_HDRI_VALUE=4096,t.PRESERVE_CLAMPED_COLORS=!1},12997:(p,b,M)=>{M.r(b),M.d(b,{Dispose:()=>S,DumpData:()=>x,DumpDataAsync:()=>z,DumpFramebuffer:()=>t,DumpTools:()=>X});var h=M(12876),Q=M(12608),mp=M(12789),y=M(12652);let P,w=null;async function t(p,b,M,h){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",mp=arguments.length>5?arguments[5]:void 0,y=arguments.length>6?arguments[6]:void 0;const P=await M.readPixels(0,0,p,b);x(p,b,new Uint8Array(P.buffer),h,Q,mp,!0,void 0,y)}async function z(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",Q=arguments.length>4?arguments[4]:void 0,mp=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7?arguments[7]:void 0;return await new Promise((w=>{x(p,b,M,(p=>w(p)),h,Q,mp,y,P)}))}function x(p,b,t,z){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",X=arguments.length>5?arguments[5]:void 0,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]&&arguments[7],g=arguments.length>8?arguments[8]:void 0;(async function(){return w||(w=new Promise(((p,b)=>{let Q,mp=null;const w={Yb:!0,depth:!1,cb:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(M.bind(M,12905)).then((t=>{let{ThinEngine:z}=t;const x=y.c.Instances.length;try{Q=new OffscreenCanvas(100,100),mp=new z(Q,!1,w)}catch(J){var X;x<y.c.Instances.length&&(null===(X=y.c.Instances.pop())||void 0===X||X.dispose()),Q=document.createElement("canvas"),mp=new z(Q,!1,w)}y.c.Instances.pop(),y.c.OnEnginesDisposedObservable.add((p=>{mp&&p!==mp&&!mp.S&&0===y.c.Instances.length&&S()})),mp.getCaps().parallelShaderCompile=void 0;const c=new h.e(mp);M.e(52).then(M.bind(M,15268)).then((M=>{let{passPixelShader:y}=M;if(!mp)return void b("Engine is not defined");const w=new h.h({hM:mp,name:y.name,fragmentShader:y.shader,samplerNames:["textureSampler"]});P={canvas:Q,hM:mp,renderer:c,wrapper:w},p(P)}))})).catch(b)}))),await w})().then((M=>{if(M.hM.setSize(p,b,!0),t instanceof Float32Array){const p=new Uint8Array(t.length);let b=t.length;for(;b--;){const M=t[b];p[b]=Math.round(255*(0,mp.Clamp)(M))}t=p}const h=M.hM.createRawTexture(t,p,b,5,!1,!c,1);M.renderer.setViewport(),M.renderer.applyEffectWrapper(M.wrapper),M.wrapper.effect._bindTexture("textureSampler",h),M.renderer.draw(),J?Q.Tools.ToBlob(M.canvas,(p=>{const b=new FileReader;b.onload=p=>{const b=p.target.result;z&&z(b)},b.readAsArrayBuffer(p)}),x,g):Q.Tools.EncodeScreenshotCanvasData(M.canvas,z,x,X,g),h.dispose()}))}function S(){var p;P?(P.wrapper.dispose(),P.renderer.dispose(),P.hM.dispose()):null===(p=w)||void 0===p||p.then((p=>{p.wrapper.dispose(),p.renderer.dispose(),p.hM.dispose()}));w=null,P=null}const X={DumpData:x,DumpDataAsync:z,DumpFramebuffer:t,Dispose:S};Q.Tools.DumpData=x,Q.Tools.DumpDataAsync=z,Q.Tools.DumpFramebuffer=t},13282:(p,b,M)=>{M.d(b,{c:()=>mp});var h=M(12870),Q=M(13001);class mp{static ExpandRGBDTexture(p){const b=p._texture;if(!b||!p.isRGBD)return;const Q=b.getEngine(),mp=Q.getCaps(),y=b.isReady;let P=!1;mp.textureHalfFloatRender&&mp.textureHalfFloatLinearFiltering?(P=!0,b.type=2):mp.textureFloatRender&&mp.textureFloatLinearFiltering&&(P=!0,b.type=1),P&&(b.isReady=!1,b._isRGBD=!1,b.invertY=!1);const w=async()=>{const mp=Q.isWebGPU,y=mp?1:0;b.isReady=!1,mp?await M.e(42).then(M.bind(M,15819)):await M.e(35).then(M.bind(M,15828));const P=new h.d("rgbdDecode","rgbdDecode",null,null,1,null,3,Q,!1,void 0,b.type,void 0,null,!1,void 0,y);P.externalTextureSamplerBinding=!0;const w=Q.createRenderTargetTexture(b.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:b.samplingMode,type:b.type,format:5});P.onEffectCreatedObservable.addOnce((M=>{M.executeWhenCompiled((()=>{P.onApply=p=>{p._bindTexture("textureSampler",b),p.setFloat2("scale",1,1)},p.upp().postProcessManager.directRender([P],w,!0),Q.restoreDefaultFramebuffer(),Q._releaseTexture(b),P&&P.dispose(),w._swapAndDie(b),b.isReady=!0}))}))};P&&(y?w():p.onLoadObservable.addOnce(w))}static async EncodeTextureToRGBD(p,b){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return b.getEngine().isWebGPU?await M.e(43).then(M.bind(M,15837)):await M.e(36).then(M.bind(M,15830)),await(0,Q.b)("rgbdEncode",p,b,h,1,5)}}}}]);