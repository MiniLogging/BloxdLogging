"use strict";(self.wx5iyvo7rvn=self.wx5iyvo7rvn||[]).push([[20,21],{11630:(P,e,n)=>{var H=n(11635),S=n(11156);S.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(S.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=H.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((P=>{this._texture._sphericalPolynomial=P,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(P){this._texture&&(this._texture._sphericalPolynomial=P)},enumerable:!0,configurable:!0})},11635:(P,e,n)=>{n.d(e,{e:()=>C});var H=n(11133),S=n(11148),p=n(11338),k=n(11140),m=n(11183);class t{constructor(P,e,n,H){this.name=P,this.worldAxisForNormal=e,this.worldAxisForFileX=n,this.worldAxisForFileY=H}}class C{static ConvertCubeMapTextureToSphericalPolynomial(P){var e;if(!P.isCube)return null;null===(e=P.BP())||void 0===e||e.getEngine().flushFramebuffer();const n=P.getSize().width,H=P.readPixels(0,void 0,void 0,!1),S=P.readPixels(1,void 0,void 0,!1);let p,k;P.isRenderTarget?(p=P.readPixels(3,void 0,void 0,!1),k=P.readPixels(2,void 0,void 0,!1)):(p=P.readPixels(2,void 0,void 0,!1),k=P.readPixels(3,void 0,void 0,!1));const m=P.readPixels(4,void 0,void 0,!1),t=P.readPixels(5,void 0,void 0,!1),C=P.gammaSpace;let R=0;return 1!=P.textureType&&2!=P.textureType||(R=1),new Promise((P=>{Promise.all([S,H,p,k,m,t]).then((e=>{let[H,S,p,k,m,t]=e;const q={size:n,right:S,left:H,up:p,down:k,front:m,back:t,format:5,type:R,gammaSpace:C};P(this.ConvertCubeMapToSphericalPolynomial(q))}))}))}static _AreaElement(P,e){return Math.atan2(P*e,Math.sqrt(P*P+e*e+1))}static ConvertCubeMapToSphericalPolynomial(P){const e=new p.c;let n=0;const H=2/P.size,t=H,C=.5*H,R=C-1;for(let p=0;p<6;p++){const q=this._FileFaces[p],A=P[q.name];let F=R;const Y=5===P.format?4:3;for(let p=0;p<P.size;p++){let j=R;for(let t=0;t<P.size;t++){const R=q.worldAxisForFileX.scale(j).add(q.worldAxisForFileY.scale(F)).add(q.worldAxisForNormal);R.normalize();const z=this._AreaElement(j-C,F-C)-this._AreaElement(j-C,F+C)-this._AreaElement(j+C,F-C)+this._AreaElement(j+C,F+C);let w=A[p*P.size*Y+t*Y+0],J=A[p*P.size*Y+t*Y+1],I=A[p*P.size*Y+t*Y+2];isNaN(w)&&(w=0),isNaN(J)&&(J=0),isNaN(I)&&(I=0),0===P.type&&(w/=255,J/=255,I/=255),P.gammaSpace&&(w=Math.pow((0,S.Clamp)(w),k.i),J=Math.pow((0,S.Clamp)(J),k.i),I=Math.pow((0,S.Clamp)(I),k.i));const O=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const P=Math.max(w,J,I);if(P>O){const e=O/P;w*=e,J*=e,I*=e}}else w=(0,S.Clamp)(w,0,O),J=(0,S.Clamp)(J,0,O),I=(0,S.Clamp)(I,0,O);const V=new m.Ne(w,J,I);e.addLight(R,V,z),n+=z,j+=H}F+=t}}const q=6*(4*Math.PI)/6/n;return e.scaleInPlace(q),e.convertIncidentRadianceToIrradiance(),e.convertIrradianceToLambertianRadiance(),p.d.FromHarmonics(e)}}C._FileFaces=[new t("right",new H.Ie(1,0,0),new H.Ie(0,0,-1),new H.Ie(0,-1,0)),new t("left",new H.Ie(-1,0,0),new H.Ie(0,0,1),new H.Ie(0,-1,0)),new t("up",new H.Ie(0,1,0),new H.Ie(1,0,0),new H.Ie(0,0,1)),new t("down",new H.Ie(0,-1,0),new H.Ie(1,0,0),new H.Ie(0,0,-1)),new t("front",new H.Ie(0,0,1),new H.Ie(1,0,0),new H.Ie(0,-1,0)),new t("back",new H.Ie(0,0,-1),new H.Ie(-1,0,0),new H.Ie(0,-1,0))],C.MAX_HDRI_VALUE=4096,C.PRESERVE_CLAMPED_COLORS=!1},11360:(P,e,n)=>{n.r(e),n.d(e,{Dispose:()=>A,DumpData:()=>q,DumpDataAsync:()=>R,DumpFramebuffer:()=>C,DumpTools:()=>F});var H=n(11245),S=n(10972),p=n(11148),k=n(11017);let m,t=null;async function C(P,e,n,H){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",p=arguments.length>5?arguments[5]:void 0,k=arguments.length>6?arguments[6]:void 0;const m=await n.readPixels(0,0,P,e);q(P,e,new Uint8Array(m.buffer),H,S,p,!0,void 0,k)}async function R(P,e,n){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",S=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],m=arguments.length>7?arguments[7]:void 0;return await new Promise((t=>{q(P,e,n,(P=>t(P)),H,S,p,k,m)}))}function q(P,e,C,R){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",F=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7&&void 0!==arguments[7]&&arguments[7],z=arguments.length>8?arguments[8]:void 0;(async function(){return t||(t=new Promise(((P,e)=>{let S,p=null;const t={o:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(n.bind(n,11274)).then((C=>{let{ThinEngine:R}=C;const q=k.d.Instances.length;try{S=new OffscreenCanvas(100,100),p=new R(S,!1,t)}catch(j){var F;q<k.d.Instances.length&&(null===(F=k.d.Instances.pop())||void 0===F||F.dispose()),S=document.createElement("canvas"),p=new R(S,!1,t)}k.d.Instances.pop(),k.d.OnEnginesDisposedObservable.add((P=>{p&&P!==p&&!p.C&&0===k.d.Instances.length&&A()})),p.getCaps().parallelShaderCompile=void 0;const Y=new H.b(p);n.e(52).then(n.bind(n,13572)).then((n=>{let{passPixelShader:k}=n;if(!p)return void e("Engine is not defined");const t=new H.d({Je:p,name:k.name,fragmentShader:k.shader,samplerNames:["textureSampler"]});m={canvas:S,Je:p,renderer:Y,wrapper:t},P(m)}))})).catch(e)}))),await t})().then((n=>{if(n.Je.setSize(P,e,!0),C instanceof Float32Array){const P=new Uint8Array(C.length);let e=C.length;for(;e--;){const n=C[e];P[e]=Math.round(255*(0,p.Clamp)(n))}C=P}const H=n.Je.createRawTexture(C,P,e,5,!1,!Y,1);n.renderer.setViewport(),n.renderer.applyEffectWrapper(n.wrapper),n.wrapper.effect._bindTexture("textureSampler",H),n.renderer.draw(),j?S.Tools.ToBlob(n.canvas,(P=>{const e=new FileReader;e.onload=P=>{const e=P.target.result;R&&R(e)},e.readAsArrayBuffer(P)}),q,z):S.Tools.EncodeScreenshotCanvasData(n.canvas,R,q,F,z),H.dispose()}))}function A(){var P;m?(m.wrapper.dispose(),m.renderer.dispose(),m.Je.dispose()):null===(P=t)||void 0===P||P.then((P=>{P.wrapper.dispose(),P.renderer.dispose(),P.Je.dispose()}));t=null,m=null}const F={DumpData:q,DumpDataAsync:R,DumpFramebuffer:C,Dispose:A};S.Tools.DumpData=q,S.Tools.DumpDataAsync=R,S.Tools.DumpFramebuffer=C},11615:(P,e,n)=>{n.d(e,{e:()=>p});var H=n(11241),S=n(11364);class p{static ExpandRGBDTexture(P){const e=P._texture;if(!e||!P.isRGBD)return;const S=e.getEngine(),p=S.getCaps(),k=e.isReady;let m=!1;p.textureHalfFloatRender&&p.textureHalfFloatLinearFiltering?(m=!0,e.type=2):p.textureFloatRender&&p.textureFloatLinearFiltering&&(m=!0,e.type=1),m&&(e.isReady=!1,e._isRGBD=!1,e.invertY=!1);const t=async()=>{const p=S.isWebGPU,k=p?1:0;e.isReady=!1,p?await n.e(42).then(n.bind(n,14105)):await n.e(35).then(n.bind(n,14107));const m=new H.e("rgbdDecode","rgbdDecode",null,null,1,null,3,S,!1,void 0,e.type,void 0,null,!1,void 0,k);m.externalTextureSamplerBinding=!0;const t=S.createRenderTargetTexture(e.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:e.samplingMode,type:e.type,format:5});m.onEffectCreatedObservable.addOnce((n=>{n.executeWhenCompiled((()=>{m.onApply=P=>{P._bindTexture("textureSampler",e),P.setFloat2("scale",1,1)},P.BP().postProcessManager.directRender([m],t,!0),S.restoreDefaultFramebuffer(),S._releaseTexture(e),m&&m.dispose(),t._swapAndDie(e),e.isReady=!0}))}))};m&&(k?t():P.onLoadObservable.addOnce(t))}static async EncodeTextureToRGBD(P,e){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.getEngine().isWebGPU?await n.e(43).then(n.bind(n,14119)):await n.e(36).then(n.bind(n,14110)),await(0,S.b)("rgbdEncode",P,e,H,1,5)}}}}]);