"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[20,21],{11708:(o,H,n)=>{var E=n(11712),k=n(11213);k.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(k.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=E.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((o=>{this._texture._sphericalPolynomial=o,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(o){this._texture&&(this._texture._sphericalPolynomial=o)},enumerable:!0,configurable:!0})},11712:(o,H,n)=>{n.d(H,{b:()=>S});var E=n(11189),k=n(11205),g=n(11380),O=n(11196),Y=n(11238);class y{constructor(o,H,n,E){this.name=o,this.worldAxisForNormal=H,this.worldAxisForFileX=n,this.worldAxisForFileY=E}}class S{static ConvertCubeMapTextureToSphericalPolynomial(o){var H;if(!o.isCube)return null;null===(H=o.bo())||void 0===H||H.getEngine().flushFramebuffer();const n=o.getSize().width,E=o.readPixels(0,void 0,void 0,!1),k=o.readPixels(1,void 0,void 0,!1);let g,O;o.isRenderTarget?(g=o.readPixels(3,void 0,void 0,!1),O=o.readPixels(2,void 0,void 0,!1)):(g=o.readPixels(2,void 0,void 0,!1),O=o.readPixels(3,void 0,void 0,!1));const Y=o.readPixels(4,void 0,void 0,!1),y=o.readPixels(5,void 0,void 0,!1),S=o.gammaSpace;let G=0;return 1!=o.textureType&&2!=o.textureType||(G=1),new Promise((o=>{Promise.all([k,E,g,O,Y,y]).then((H=>{let[E,k,g,O,Y,y]=H;const c={size:n,right:k,left:E,up:g,down:O,front:Y,back:y,format:5,type:G,gammaSpace:S};o(this.ConvertCubeMapToSphericalPolynomial(c))}))}))}static _AreaElement(o,H){return Math.atan2(o*H,Math.sqrt(o*o+H*H+1))}static ConvertCubeMapToSphericalPolynomial(o){const H=new g.e;let n=0;const E=2/o.size,y=E,S=.5*E,G=S-1;for(let g=0;g<6;g++){const c=this._FileFaces[g],A=o[c.name];let l=G;const x=5===o.format?4:3;for(let g=0;g<o.size;g++){let z=G;for(let y=0;y<o.size;y++){const G=c.worldAxisForFileX.scale(z).add(c.worldAxisForFileY.scale(l)).add(c.worldAxisForNormal);G.normalize();const V=this._AreaElement(z-S,l-S)-this._AreaElement(z-S,l+S)-this._AreaElement(z+S,l-S)+this._AreaElement(z+S,l+S);let J=A[g*o.size*x+y*x+0],N=A[g*o.size*x+y*x+1],h=A[g*o.size*x+y*x+2];isNaN(J)&&(J=0),isNaN(N)&&(N=0),isNaN(h)&&(h=0),0===o.type&&(J/=255,N/=255,h/=255),o.gammaSpace&&(J=Math.pow((0,k.Clamp)(J),O.p),N=Math.pow((0,k.Clamp)(N),O.p),h=Math.pow((0,k.Clamp)(h),O.p));const Q=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const o=Math.max(J,N,h);if(o>Q){const H=Q/o;J*=H,N*=H,h*=H}}else J=(0,k.Clamp)(J,0,Q),N=(0,k.Clamp)(N,0,Q),h=(0,k.Clamp)(h,0,Q);const p=new Y.NH(J,N,h);H.addLight(G,p,V),n+=V,z+=E}l+=y}}const c=6*(4*Math.PI)/6/n;return H.scaleInPlace(c),H.convertIncidentRadianceToIrradiance(),H.convertIrradianceToLambertianRadiance(),g.f.FromHarmonics(H)}}S._FileFaces=[new y("right",new E.xH(1,0,0),new E.xH(0,0,-1),new E.xH(0,-1,0)),new y("left",new E.xH(-1,0,0),new E.xH(0,0,1),new E.xH(0,-1,0)),new y("up",new E.xH(0,1,0),new E.xH(1,0,0),new E.xH(0,0,1)),new y("down",new E.xH(0,-1,0),new E.xH(1,0,0),new E.xH(0,0,-1)),new y("front",new E.xH(0,0,1),new E.xH(1,0,0),new E.xH(0,-1,0)),new y("back",new E.xH(0,0,-1),new E.xH(-1,0,0),new E.xH(0,-1,0))],S.MAX_HDRI_VALUE=4096,S.PRESERVE_CLAMPED_COLORS=!1},11420:(o,H,n)=>{n.r(H),n.d(H,{Dispose:()=>A,DumpData:()=>c,DumpDataAsync:()=>G,DumpFramebuffer:()=>S,DumpTools:()=>l});var E=n(11297),k=n(11024),g=n(11205),O=n(11060);let Y,y=null;async function S(o,H,n,E){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",g=arguments.length>5?arguments[5]:void 0,O=arguments.length>6?arguments[6]:void 0;const Y=await n.readPixels(0,0,o,H);c(o,H,new Uint8Array(Y.buffer),E,k,g,!0,void 0,O)}async function G(o,H,n){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",k=arguments.length>4?arguments[4]:void 0,g=arguments.length>5&&void 0!==arguments[5]&&arguments[5],O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7?arguments[7]:void 0;return await new Promise((y=>{c(o,H,n,(o=>y(o)),E,k,g,O,Y)}))}function c(o,H,S,G){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",l=arguments.length>5?arguments[5]:void 0,x=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],V=arguments.length>8?arguments[8]:void 0;(async function(){return y||(y=new Promise(((o,H)=>{let k,g=null;const y={Ng:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(n.bind(n,11330)).then((S=>{let{ThinEngine:G}=S;const c=O.e.Instances.length;try{k=new OffscreenCanvas(100,100),g=new G(k,!1,y)}catch(z){var l;c<O.e.Instances.length&&(null===(l=O.e.Instances.pop())||void 0===l||l.dispose()),k=document.createElement("canvas"),g=new G(k,!1,y)}O.e.Instances.pop(),O.e.OnEnginesDisposedObservable.add((o=>{g&&o!==g&&!g.l&&0===O.e.Instances.length&&A()})),g.getCaps().parallelShaderCompile=void 0;const x=new E.d(g);n.e(52).then(n.bind(n,13724)).then((n=>{let{passPixelShader:O}=n;if(!g)return void H("Engine is not defined");const y=new E.f({lH:g,name:O.name,fragmentShader:O.shader,samplerNames:["textureSampler"]});Y={canvas:k,lH:g,renderer:x,wrapper:y},o(Y)}))})).catch(H)}))),await y})().then((n=>{if(n.lH.setSize(o,H,!0),S instanceof Float32Array){const o=new Uint8Array(S.length);let H=S.length;for(;H--;){const n=S[H];o[H]=Math.round(255*(0,g.Clamp)(n))}S=o}const E=n.lH.createRawTexture(S,o,H,5,!1,!x,1);n.renderer.setViewport(),n.renderer.applyEffectWrapper(n.wrapper),n.wrapper.effect._bindTexture("textureSampler",E),n.renderer.draw(),z?k.Tools.ToBlob(n.canvas,(o=>{const H=new FileReader;H.onload=o=>{const H=o.target.result;G&&G(H)},H.readAsArrayBuffer(o)}),c,V):k.Tools.EncodeScreenshotCanvasData(n.canvas,G,c,l,V),E.dispose()}))}function A(){var o;Y?(Y.wrapper.dispose(),Y.renderer.dispose(),Y.lH.dispose()):null===(o=y)||void 0===o||o.then((o=>{o.wrapper.dispose(),o.renderer.dispose(),o.lH.dispose()}));y=null,Y=null}const l={DumpData:c,DumpDataAsync:G,DumpFramebuffer:S,Dispose:A};k.Tools.DumpData=c,k.Tools.DumpDataAsync=G,k.Tools.DumpFramebuffer=S},11695:(o,H,n)=>{n.d(H,{e:()=>g});var E=n(11292),k=n(11422);class g{static ExpandRGBDTexture(o){const H=o._texture;if(!H||!o.isRGBD)return;const k=H.getEngine(),g=k.getCaps(),O=H.isReady;let Y=!1;g.textureHalfFloatRender&&g.textureHalfFloatLinearFiltering?(Y=!0,H.type=2):g.textureFloatRender&&g.textureFloatLinearFiltering&&(Y=!0,H.type=1),Y&&(H.isReady=!1,H._isRGBD=!1,H.invertY=!1);const y=async()=>{const g=k.isWebGPU,O=g?1:0;H.isReady=!1,g?await n.e(42).then(n.bind(n,14277)):await n.e(35).then(n.bind(n,14284));const Y=new E.e("rgbdDecode","rgbdDecode",null,null,1,null,3,k,!1,void 0,H.type,void 0,null,!1,void 0,O);Y.externalTextureSamplerBinding=!0;const y=k.createRenderTargetTexture(H.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:H.samplingMode,type:H.type,format:5});Y.onEffectCreatedObservable.addOnce((n=>{n.executeWhenCompiled((()=>{Y.onApply=o=>{o._bindTexture("textureSampler",H),o.setFloat2("scale",1,1)},o.bo().postProcessManager.directRender([Y],y,!0),k.restoreDefaultFramebuffer(),k._releaseTexture(H),Y&&Y.dispose(),y._swapAndDie(H),H.isReady=!0}))}))};Y&&(O?y():o.onLoadObservable.addOnce(y))}static async EncodeTextureToRGBD(o,H){let E=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return H.getEngine().isWebGPU?await n.e(43).then(n.bind(n,14295)):await n.e(36).then(n.bind(n,14291)),await(0,k.d)("rgbdEncode",o,H,E,1,5)}}}}]);