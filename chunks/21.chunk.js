"use strict";(self.uji65st81d=self.uji65st81d||[]).push([[20,21],{12907:(V,h,mV)=>{var t=mV(12915),L=mV(12438);L.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(L.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=t.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((V=>{this._texture._sphericalPolynomial=V,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(V){this._texture&&(this._texture._sphericalPolynomial=V)},enumerable:!0,configurable:!0})},12915:(V,h,mV)=>{mV.d(h,{c:()=>K});var t=mV(12422),L=mV(12435),N=mV(12597),A=mV(12425),k=mV(12453);class C{constructor(V,h,mV,t){this.name=V,this.worldAxisForNormal=h,this.worldAxisForFileX=mV,this.worldAxisForFileY=t}}class K{static ConvertCubeMapTextureToSphericalPolynomial(V){var h;if(!V.isCube)return null;null===(h=V.DV())||void 0===h||h.getEngine().flushFramebuffer();const mV=V.getSize().width,t=V.readPixels(0,void 0,void 0,!1),L=V.readPixels(1,void 0,void 0,!1);let N,A;V.isRenderTarget?(N=V.readPixels(3,void 0,void 0,!1),A=V.readPixels(2,void 0,void 0,!1)):(N=V.readPixels(2,void 0,void 0,!1),A=V.readPixels(3,void 0,void 0,!1));const k=V.readPixels(4,void 0,void 0,!1),C=V.readPixels(5,void 0,void 0,!1),K=V.gammaSpace;let o=0;return 1!=V.textureType&&2!=V.textureType||(o=1),new Promise((V=>{Promise.all([L,t,N,A,k,C]).then((h=>{let[t,L,N,A,k,C]=h;const n={size:mV,right:L,left:t,up:N,down:A,front:k,back:C,format:5,type:o,gammaSpace:K};V(this.ConvertCubeMapToSphericalPolynomial(n))}))}))}static _AreaElement(V,h){return Math.atan2(V*h,Math.sqrt(V*V+h*h+1))}static ConvertCubeMapToSphericalPolynomial(V){const h=new N.b;let mV=0;const t=2/V.size,C=t,K=.5*t,o=K-1;for(let N=0;N<6;N++){const n=this._FileFaces[N],q=V[n.name];let x=o;const R=5===V.format?4:3;for(let N=0;N<V.size;N++){let d=o;for(let C=0;C<V.size;C++){const o=n.worldAxisForFileX.scale(d).add(n.worldAxisForFileY.scale(x)).add(n.worldAxisForNormal);o.normalize();const s=this._AreaElement(d-K,x-K)-this._AreaElement(d-K,x+K)-this._AreaElement(d+K,x-K)+this._AreaElement(d+K,x+K);let M=q[N*V.size*R+C*R+0],c=q[N*V.size*R+C*R+1],z=q[N*V.size*R+C*R+2];isNaN(M)&&(M=0),isNaN(c)&&(c=0),isNaN(z)&&(z=0),0===V.type&&(M/=255,c/=255,z/=255),V.gammaSpace&&(M=Math.pow((0,L.Clamp)(M),A.j),c=Math.pow((0,L.Clamp)(c),A.j),z=Math.pow((0,L.Clamp)(z),A.j));const Q=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const V=Math.max(M,c,z);if(V>Q){const h=Q/V;M*=h,c*=h,z*=h}}else M=(0,L.Clamp)(M,0,Q),c=(0,L.Clamp)(c,0,Q),z=(0,L.Clamp)(z,0,Q);const J=new k.Jh(M,c,z);h.addLight(o,J,s),mV+=s,d+=t}x+=C}}const n=6*(4*Math.PI)/6/mV;return h.scaleInPlace(n),h.convertIncidentRadianceToIrradiance(),h.convertIrradianceToLambertianRadiance(),N.f.FromHarmonics(h)}}K._FileFaces=[new C("right",new t.sh(1,0,0),new t.sh(0,0,-1),new t.sh(0,-1,0)),new C("left",new t.sh(-1,0,0),new t.sh(0,0,1),new t.sh(0,-1,0)),new C("up",new t.sh(0,1,0),new t.sh(1,0,0),new t.sh(0,0,1)),new C("down",new t.sh(0,-1,0),new t.sh(1,0,0),new t.sh(0,0,-1)),new C("front",new t.sh(0,0,1),new t.sh(1,0,0),new t.sh(0,-1,0)),new C("back",new t.sh(0,0,-1),new t.sh(-1,0,0),new t.sh(0,-1,0))],K.MAX_HDRI_VALUE=4096,K.PRESERVE_CLAMPED_COLORS=!1},12625:(V,h,mV)=>{mV.r(h),mV.d(h,{Dispose:()=>q,DumpData:()=>n,DumpDataAsync:()=>o,DumpFramebuffer:()=>K,DumpTools:()=>x});var t=mV(12518),L=mV(12253),N=mV(12435),A=mV(12300);let k,C=null;async function K(V,h,mV,t){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",N=arguments.length>5?arguments[5]:void 0,A=arguments.length>6?arguments[6]:void 0;const k=await mV.readPixels(0,0,V,h);n(V,h,new Uint8Array(k.buffer),t,L,N,!0,void 0,A)}async function o(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",L=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7?arguments[7]:void 0;return await new Promise((C=>{n(V,h,mV,(V=>C(V)),t,L,N,A,k)}))}function n(V,h,K,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",x=arguments.length>5?arguments[5]:void 0,R=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7&&void 0!==arguments[7]&&arguments[7],s=arguments.length>8?arguments[8]:void 0;(async function(){return C||(C=new Promise(((V,h)=>{let L,N=null;const C={xk:!0,depth:!1,Ck:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(mV.bind(mV,12553)).then((K=>{let{ThinEngine:o}=K;const n=A.b.Instances.length;try{L=new OffscreenCanvas(100,100),N=new o(L,!1,C)}catch(d){var x;n<A.b.Instances.length&&(null===(x=A.b.Instances.pop())||void 0===x||x.dispose()),L=document.createElement("canvas"),N=new o(L,!1,C)}A.b.Instances.pop(),A.b.OnEnginesDisposedObservable.add((V=>{N&&V!==N&&!N.A&&0===A.b.Instances.length&&q()})),N.getCaps().parallelShaderCompile=void 0;const R=new t.e(N);mV.e(52).then(mV.bind(mV,14862)).then((mV=>{let{passPixelShader:A}=mV;if(!N)return void h("Engine is not defined");const C=new t.h({dh:N,name:A.name,fragmentShader:A.shader,samplerNames:["textureSampler"]});k={canvas:L,dh:N,renderer:R,wrapper:C},V(k)}))})).catch(h)}))),await C})().then((mV=>{if(mV.dh.setSize(V,h,!0),K instanceof Float32Array){const V=new Uint8Array(K.length);let h=K.length;for(;h--;){const mV=K[h];V[h]=Math.round(255*(0,N.Clamp)(mV))}K=V}const t=mV.dh.createRawTexture(K,V,h,5,!1,!R,1);mV.renderer.setViewport(),mV.renderer.applyEffectWrapper(mV.wrapper),mV.wrapper.effect._bindTexture("textureSampler",t),mV.renderer.draw(),d?L.Tools.ToBlob(mV.canvas,(V=>{const h=new FileReader;h.onload=V=>{const h=V.target.result;o&&o(h)},h.readAsArrayBuffer(V)}),n,s):L.Tools.EncodeScreenshotCanvasData(mV.canvas,o,n,x,s),t.dispose()}))}function q(){var V;k?(k.wrapper.dispose(),k.renderer.dispose(),k.dh.dispose()):null===(V=C)||void 0===V||V.then((V=>{V.wrapper.dispose(),V.renderer.dispose(),V.dh.dispose()}));C=null,k=null}const x={DumpData:n,DumpDataAsync:o,DumpFramebuffer:K,Dispose:q};L.Tools.DumpData=n,L.Tools.DumpDataAsync=o,L.Tools.DumpFramebuffer=K},12894:(V,h,mV)=>{mV.d(h,{b:()=>N});var t=mV(12516),L=mV(12632);class N{static ExpandRGBDTexture(V){const h=V._texture;if(!h||!V.isRGBD)return;const L=h.getEngine(),N=L.getCaps(),A=h.isReady;let k=!1;N.textureHalfFloatRender&&N.textureHalfFloatLinearFiltering?(k=!0,h.type=2):N.textureFloatRender&&N.textureFloatLinearFiltering&&(k=!0,h.type=1),k&&(h.isReady=!1,h._isRGBD=!1,h.invertY=!1);const C=async()=>{const N=L.isWebGPU,A=N?1:0;h.isReady=!1,N?await mV.e(42).then(mV.bind(mV,15426)):await mV.e(35).then(mV.bind(mV,15428));const k=new t.c("rgbdDecode","rgbdDecode",null,null,1,null,3,L,!1,void 0,h.type,void 0,null,!1,void 0,A);k.externalTextureSamplerBinding=!0;const C=L.createRenderTargetTexture(h.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:h.samplingMode,type:h.type,format:5});k.onEffectCreatedObservable.addOnce((mV=>{mV.executeWhenCompiled((()=>{k.onApply=V=>{V._bindTexture("textureSampler",h),V.setFloat2("scale",1,1)},V.DV().postProcessManager.directRender([k],C,!0),L.restoreDefaultFramebuffer(),L._releaseTexture(h),k&&k.dispose(),C._swapAndDie(h),h.isReady=!0}))}))};k&&(A?C():V.onLoadObservable.addOnce(C))}static async EncodeTextureToRGBD(V,h){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return h.getEngine().isWebGPU?await mV.e(43).then(mV.bind(mV,15438)):await mV.e(36).then(mV.bind(mV,15431)),await(0,L.d)("rgbdEncode",V,h,t,1,5)}}}}]);