"use strict";(self.n52dyox90qa=self.n52dyox90qa||[]).push([[20,21],{12328:(E,t,z)=>{var A=z(12333),X=z(11840);X.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(X.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=A.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((E=>{this._texture._sphericalPolynomial=E,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(E){this._texture&&(this._texture._sphericalPolynomial=E)},enumerable:!0,configurable:!0})},12333:(E,t,z)=>{z.d(t,{e:()=>Z});var A=z(11812),X=z(11834),R=z(11999),u=z(11817),p=z(11856);class C{constructor(E,t,z,A){this.name=E,this.worldAxisForNormal=t,this.worldAxisForFileX=z,this.worldAxisForFileY=A}}class Z{static ConvertCubeMapTextureToSphericalPolynomial(E){var t;if(!E.isCube)return null;null===(t=E.lE())||void 0===t||t.getEngine().flushFramebuffer();const z=E.getSize().width,A=E.readPixels(0,void 0,void 0,!1),X=E.readPixels(1,void 0,void 0,!1);let R,u;E.isRenderTarget?(R=E.readPixels(3,void 0,void 0,!1),u=E.readPixels(2,void 0,void 0,!1)):(R=E.readPixels(2,void 0,void 0,!1),u=E.readPixels(3,void 0,void 0,!1));const p=E.readPixels(4,void 0,void 0,!1),C=E.readPixels(5,void 0,void 0,!1),Z=E.gammaSpace;let H=0;return 1!=E.textureType&&2!=E.textureType||(H=1),new Promise((E=>{Promise.all([X,A,R,u,p,C]).then((t=>{let[A,X,R,u,p,C]=t;const h={size:z,right:X,left:A,up:R,down:u,front:p,back:C,format:5,type:H,gammaSpace:Z};E(this.ConvertCubeMapToSphericalPolynomial(h))}))}))}static _AreaElement(E,t){return Math.atan2(E*t,Math.sqrt(E*E+t*t+1))}static ConvertCubeMapToSphericalPolynomial(E){const t=new R.e;let z=0;const A=2/E.size,C=A,Z=.5*A,H=Z-1;for(let R=0;R<6;R++){const h=this._FileFaces[R],d=E[h.name];let y=H;const O=5===E.format?4:3;for(let R=0;R<E.size;R++){let c=H;for(let C=0;C<E.size;C++){const H=h.worldAxisForFileX.scale(c).add(h.worldAxisForFileY.scale(y)).add(h.worldAxisForNormal);H.normalize();const a=this._AreaElement(c-Z,y-Z)-this._AreaElement(c-Z,y+Z)-this._AreaElement(c+Z,y-Z)+this._AreaElement(c+Z,y+Z);let L=d[R*E.size*O+C*O+0],mE=d[R*E.size*O+C*O+1],W=d[R*E.size*O+C*O+2];isNaN(L)&&(L=0),isNaN(mE)&&(mE=0),isNaN(W)&&(W=0),0===E.type&&(L/=255,mE/=255,W/=255),E.gammaSpace&&(L=Math.pow((0,X.Clamp)(L),u.j),mE=Math.pow((0,X.Clamp)(mE),u.j),W=Math.pow((0,X.Clamp)(W),u.j));const I=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const E=Math.max(L,mE,W);if(E>I){const t=I/E;L*=t,mE*=t,W*=t}}else L=(0,X.Clamp)(L,0,I),mE=(0,X.Clamp)(mE,0,I),W=(0,X.Clamp)(W,0,I);const e=new p.Dt(L,mE,W);t.addLight(H,e,a),z+=a,c+=A}y+=C}}const h=6*(4*Math.PI)/6/z;return t.scaleInPlace(h),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),R.i.FromHarmonics(t)}}Z._FileFaces=[new C("right",new A.Lt(1,0,0),new A.Lt(0,0,-1),new A.Lt(0,-1,0)),new C("left",new A.Lt(-1,0,0),new A.Lt(0,0,1),new A.Lt(0,-1,0)),new C("up",new A.Lt(0,1,0),new A.Lt(1,0,0),new A.Lt(0,0,1)),new C("down",new A.Lt(0,-1,0),new A.Lt(1,0,0),new A.Lt(0,0,-1)),new C("front",new A.Lt(0,0,1),new A.Lt(1,0,0),new A.Lt(0,-1,0)),new C("back",new A.Lt(0,0,-1),new A.Lt(-1,0,0),new A.Lt(0,-1,0))],Z.MAX_HDRI_VALUE=4096,Z.PRESERVE_CLAMPED_COLORS=!1},12036:(E,t,z)=>{z.r(t),z.d(t,{Dispose:()=>d,DumpData:()=>h,DumpDataAsync:()=>H,DumpFramebuffer:()=>Z,DumpTools:()=>y});var A=z(11933),X=z(11630),R=z(11834),u=z(11667);let p,C=null;async function Z(E,t,z,A){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",R=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0;const p=await z.readPixels(0,0,E,t);h(E,t,new Uint8Array(p.buffer),A,X,R,!0,void 0,u)}async function H(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",X=arguments.length>4?arguments[4]:void 0,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7?arguments[7]:void 0;return await new Promise((C=>{h(E,t,z,(E=>C(E)),A,X,R,u,p)}))}function h(E,t,Z,H){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",y=arguments.length>5?arguments[5]:void 0,O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],a=arguments.length>8?arguments[8]:void 0;(async function(){return C||(C=new Promise(((E,t)=>{let X,R=null;const C={Ap:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(z.bind(z,11960)).then((Z=>{let{ThinEngine:H}=Z;const h=u.d.Instances.length;try{X=new OffscreenCanvas(100,100),R=new H(X,!1,C)}catch(c){var y;h<u.d.Instances.length&&(null===(y=u.d.Instances.pop())||void 0===y||y.dispose()),X=document.createElement("canvas"),R=new H(X,!1,C)}u.d.Instances.pop(),u.d.OnEnginesDisposedObservable.add((E=>{R&&E!==R&&!R.C&&0===u.d.Instances.length&&d()})),R.getCaps().parallelShaderCompile=void 0;const O=new A.d(R);z.e(52).then(z.bind(z,14245)).then((z=>{let{passPixelShader:u}=z;if(!R)return void t("Engine is not defined");const C=new A.h({ct:R,name:u.name,fragmentShader:u.shader,samplerNames:["textureSampler"]});p={canvas:X,ct:R,renderer:O,wrapper:C},E(p)}))})).catch(t)}))),await C})().then((z=>{if(z.ct.setSize(E,t,!0),Z instanceof Float32Array){const E=new Uint8Array(Z.length);let t=Z.length;for(;t--;){const z=Z[t];E[t]=Math.round(255*(0,R.Clamp)(z))}Z=E}const A=z.ct.createRawTexture(Z,E,t,5,!1,!O,1);z.renderer.setViewport(),z.renderer.applyEffectWrapper(z.wrapper),z.wrapper.effect._bindTexture("textureSampler",A),z.renderer.draw(),c?X.Tools.ToBlob(z.canvas,(E=>{const t=new FileReader;t.onload=E=>{const t=E.target.result;H&&H(t)},t.readAsArrayBuffer(E)}),h,a):X.Tools.EncodeScreenshotCanvasData(z.canvas,H,h,y,a),A.dispose()}))}function d(){var E;p?(p.wrapper.dispose(),p.renderer.dispose(),p.ct.dispose()):null===(E=C)||void 0===E||E.then((E=>{E.wrapper.dispose(),E.renderer.dispose(),E.ct.dispose()}));C=null,p=null}const y={DumpData:h,DumpDataAsync:H,DumpFramebuffer:Z,Dispose:d};X.Tools.DumpData=h,X.Tools.DumpDataAsync=H,X.Tools.DumpFramebuffer=Z},12316:(E,t,z)=>{z.d(t,{d:()=>R});var A=z(11929),X=z(12044);class R{static ExpandRGBDTexture(E){const t=E._texture;if(!t||!E.isRGBD)return;const X=t.getEngine(),R=X.getCaps(),u=t.isReady;let p=!1;R.textureHalfFloatRender&&R.textureHalfFloatLinearFiltering?(p=!0,t.type=2):R.textureFloatRender&&R.textureFloatLinearFiltering&&(p=!0,t.type=1),p&&(t.isReady=!1,t._isRGBD=!1,t.invertY=!1);const C=async()=>{const R=X.isWebGPU,u=R?1:0;t.isReady=!1,R?await z.e(42).then(z.bind(z,14775)):await z.e(35).then(z.bind(z,14783));const p=new A.b("rgbdDecode","rgbdDecode",null,null,1,null,3,X,!1,void 0,t.type,void 0,null,!1,void 0,u);p.externalTextureSamplerBinding=!0;const C=X.createRenderTargetTexture(t.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:t.samplingMode,type:t.type,format:5});p.onEffectCreatedObservable.addOnce((z=>{z.executeWhenCompiled((()=>{p.onApply=E=>{E._bindTexture("textureSampler",t),E.setFloat2("scale",1,1)},E.lE().postProcessManager.directRender([p],C,!0),X.restoreDefaultFramebuffer(),X._releaseTexture(t),p&&p.dispose(),C._swapAndDie(t),t.isReady=!0}))}))};p&&(u?C():E.onLoadObservable.addOnce(C))}static async EncodeTextureToRGBD(E,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t.getEngine().isWebGPU?await z.e(43).then(z.bind(z,14800)):await z.e(36).then(z.bind(z,14792)),await(0,X.c)("rgbdEncode",E,t,A,1,5)}}}}]);