"use strict";(self.b15p7b72fr8=self.b15p7b72fr8||[]).push([[20,21],{13113:(s,k,h)=>{var A=h(13121),g=h(12614);g.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(g.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=A.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((s=>{this._texture._sphericalPolynomial=s,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(s){this._texture&&(this._texture._sphericalPolynomial=s)},enumerable:!0,configurable:!0})},13121:(s,k,h)=>{h.d(k,{d:()=>O});var A=h(12590),g=h(12607),ms=h(12788),i=h(12598),K=h(12636);class H{constructor(s,k,h,A){this.name=s,this.worldAxisForNormal=k,this.worldAxisForFileX=h,this.worldAxisForFileY=A}}class O{static ConvertCubeMapTextureToSphericalPolynomial(s){var k;if(!s.isCube)return null;null===(k=s.Is())||void 0===k||k.getEngine().flushFramebuffer();const h=s.getSize().width,A=s.readPixels(0,void 0,void 0,!1),g=s.readPixels(1,void 0,void 0,!1);let ms,i;s.isRenderTarget?(ms=s.readPixels(3,void 0,void 0,!1),i=s.readPixels(2,void 0,void 0,!1)):(ms=s.readPixels(2,void 0,void 0,!1),i=s.readPixels(3,void 0,void 0,!1));const K=s.readPixels(4,void 0,void 0,!1),H=s.readPixels(5,void 0,void 0,!1),O=s.gammaSpace;let c=0;return 1!=s.textureType&&2!=s.textureType||(c=1),new Promise((s=>{Promise.all([g,A,ms,i,K,H]).then((k=>{let[A,g,ms,i,K,H]=k;const S={size:h,right:g,left:A,up:ms,down:i,front:K,back:H,format:5,type:c,gammaSpace:O};s(this.ConvertCubeMapToSphericalPolynomial(S))}))}))}static _AreaElement(s,k){return Math.atan2(s*k,Math.sqrt(s*s+k*k+1))}static ConvertCubeMapToSphericalPolynomial(s){const k=new ms.c;let h=0;const A=2/s.size,H=A,O=.5*A,c=O-1;for(let ms=0;ms<6;ms++){const S=this._FileFaces[ms],a=s[S.name];let r=c;const d=5===s.format?4:3;for(let ms=0;ms<s.size;ms++){let E=c;for(let H=0;H<s.size;H++){const c=S.worldAxisForFileX.scale(E).add(S.worldAxisForFileY.scale(r)).add(S.worldAxisForNormal);c.normalize();const j=this._AreaElement(E-O,r-O)-this._AreaElement(E-O,r+O)-this._AreaElement(E+O,r-O)+this._AreaElement(E+O,r+O);let P=a[ms*s.size*d+H*d+0],R=a[ms*s.size*d+H*d+1],D=a[ms*s.size*d+H*d+2];isNaN(P)&&(P=0),isNaN(R)&&(R=0),isNaN(D)&&(D=0),0===s.type&&(P/=255,R/=255,D/=255),s.gammaSpace&&(P=Math.pow((0,g.Clamp)(P),i.j),R=Math.pow((0,g.Clamp)(R),i.j),D=Math.pow((0,g.Clamp)(D),i.j));const w=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const s=Math.max(P,R,D);if(s>w){const k=w/s;P*=k,R*=k,D*=k}}else P=(0,g.Clamp)(P,0,w),R=(0,g.Clamp)(R,0,w),D=(0,g.Clamp)(D,0,w);const B=new K.Bk(P,R,D);k.addLight(c,B,j),h+=j,E+=A}r+=H}}const S=6*(4*Math.PI)/6/h;return k.scaleInPlace(S),k.convertIncidentRadianceToIrradiance(),k.convertIrradianceToLambertianRadiance(),ms.f.FromHarmonics(k)}}O._FileFaces=[new H("right",new A.Pk(1,0,0),new A.Pk(0,0,-1),new A.Pk(0,-1,0)),new H("left",new A.Pk(-1,0,0),new A.Pk(0,0,1),new A.Pk(0,-1,0)),new H("up",new A.Pk(0,1,0),new A.Pk(1,0,0),new A.Pk(0,0,1)),new H("down",new A.Pk(0,-1,0),new A.Pk(1,0,0),new A.Pk(0,0,-1)),new H("front",new A.Pk(0,0,1),new A.Pk(1,0,0),new A.Pk(0,-1,0)),new H("back",new A.Pk(0,0,-1),new A.Pk(-1,0,0),new A.Pk(0,-1,0))],O.MAX_HDRI_VALUE=4096,O.PRESERVE_CLAMPED_COLORS=!1},12817:(s,k,h)=>{h.r(k),h.d(k,{Dispose:()=>a,DumpData:()=>S,DumpDataAsync:()=>c,DumpFramebuffer:()=>O,DumpTools:()=>r});var A=h(12703),g=h(12402),ms=h(12607),i=h(12445);let K,H=null;async function O(s,k,h,A){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",ms=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0;const K=await h.readPixels(0,0,s,k);S(s,k,new Uint8Array(K.buffer),A,g,ms,!0,void 0,i)}async function c(s,k,h){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",g=arguments.length>4?arguments[4]:void 0,ms=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7?arguments[7]:void 0;return await new Promise((H=>{S(s,k,h,(s=>H(s)),A,g,ms,i,K)}))}function S(s,k,O,c){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",r=arguments.length>5?arguments[5]:void 0,d=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]&&arguments[7],j=arguments.length>8?arguments[8]:void 0;(async function(){return H||(H=new Promise(((s,k)=>{let g,ms=null;const H={qh:!0,depth:!1,Bh:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(h.bind(h,12727)).then((O=>{let{ThinEngine:c}=O;const S=i.b.Instances.length;try{g=new OffscreenCanvas(100,100),ms=new c(g,!1,H)}catch(E){var r;S<i.b.Instances.length&&(null===(r=i.b.Instances.pop())||void 0===r||r.dispose()),g=document.createElement("canvas"),ms=new c(g,!1,H)}i.b.Instances.pop(),i.b.OnEnginesDisposedObservable.add((s=>{ms&&s!==ms&&!ms.P&&0===i.b.Instances.length&&a()})),ms.getCaps().parallelShaderCompile=void 0;const d=new A.b(ms);h.e(52).then(h.bind(h,15084)).then((h=>{let{passPixelShader:i}=h;if(!ms)return void k("Engine is not defined");const H=new A.f({jk:ms,name:i.name,fragmentShader:i.shader,samplerNames:["textureSampler"]});K={canvas:g,jk:ms,renderer:d,wrapper:H},s(K)}))})).catch(k)}))),await H})().then((h=>{if(h.jk.setSize(s,k,!0),O instanceof Float32Array){const s=new Uint8Array(O.length);let k=O.length;for(;k--;){const h=O[k];s[k]=Math.round(255*(0,ms.Clamp)(h))}O=s}const A=h.jk.createRawTexture(O,s,k,5,!1,!d,1);h.renderer.setViewport(),h.renderer.applyEffectWrapper(h.wrapper),h.wrapper.effect._bindTexture("textureSampler",A),h.renderer.draw(),E?g.Tools.ToBlob(h.canvas,(s=>{const k=new FileReader;k.onload=s=>{const k=s.target.result;c&&c(k)},k.readAsArrayBuffer(s)}),S,j):g.Tools.EncodeScreenshotCanvasData(h.canvas,c,S,r,j),A.dispose()}))}function a(){var s;K?(K.wrapper.dispose(),K.renderer.dispose(),K.jk.dispose()):null===(s=H)||void 0===s||s.then((s=>{s.wrapper.dispose(),s.renderer.dispose(),s.jk.dispose()}));H=null,K=null}const r={DumpData:S,DumpDataAsync:c,DumpFramebuffer:O,Dispose:a};g.Tools.DumpData=S,g.Tools.DumpDataAsync=c,g.Tools.DumpFramebuffer=O},13103:(s,k,h)=>{h.d(k,{e:()=>ms});var A=h(12697),g=h(12823);class ms{static ExpandRGBDTexture(s){const k=s._texture;if(!k||!s.isRGBD)return;const g=k.getEngine(),ms=g.getCaps(),i=k.isReady;let K=!1;ms.textureHalfFloatRender&&ms.textureHalfFloatLinearFiltering?(K=!0,k.type=2):ms.textureFloatRender&&ms.textureFloatLinearFiltering&&(K=!0,k.type=1),K&&(k.isReady=!1,k._isRGBD=!1,k.invertY=!1);const H=async()=>{const ms=g.isWebGPU,i=ms?1:0;k.isReady=!1,ms?await h.e(42).then(h.bind(h,15647)):await h.e(35).then(h.bind(h,15656));const K=new A.e("rgbdDecode","rgbdDecode",null,null,1,null,3,g,!1,void 0,k.type,void 0,null,!1,void 0,i);K.externalTextureSamplerBinding=!0;const H=g.createRenderTargetTexture(k.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:k.samplingMode,type:k.type,format:5});K.onEffectCreatedObservable.addOnce((h=>{h.executeWhenCompiled((()=>{K.onApply=s=>{s._bindTexture("textureSampler",k),s.setFloat2("scale",1,1)},s.Is().postProcessManager.directRender([K],H,!0),g.restoreDefaultFramebuffer(),g._releaseTexture(k),K&&K.dispose(),H._swapAndDie(k),k.isReady=!0}))}))};K&&(i?H():s.onLoadObservable.addOnce(H))}static async EncodeTextureToRGBD(s,k){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return k.getEngine().isWebGPU?await h.e(43).then(h.bind(h,15667)):await h.e(36).then(h.bind(h,15660)),await(0,g.e)("rgbdEncode",s,k,A,1,5)}}}}]);