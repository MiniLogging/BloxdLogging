"use strict";(self["9x1utqq1axc"]=self["9x1utqq1axc"]||[]).push([[20,21],{12830:(y,c,A)=>{var l=A(12839),w=A(12348);w.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(w.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=l.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((y=>{this._texture._sphericalPolynomial=y,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(y){this._texture&&(this._texture._sphericalPolynomial=y)},enumerable:!0,configurable:!0})},12839:(y,c,A)=>{A.d(c,{b:()=>I});var l=A(12325),w=A(12340),N=A(12511),p=A(12330),W=A(12375);class h{constructor(y,c,A,l){this.name=y,this.worldAxisForNormal=c,this.worldAxisForFileX=A,this.worldAxisForFileY=l}}class I{static ConvertCubeMapTextureToSphericalPolynomial(y){var c;if(!y.isCube)return null;null===(c=y.mc())||void 0===c||c.getEngine().flushFramebuffer();const A=y.getSize().width,l=y.readPixels(0,void 0,void 0,!1),w=y.readPixels(1,void 0,void 0,!1);let N,p;y.isRenderTarget?(N=y.readPixels(3,void 0,void 0,!1),p=y.readPixels(2,void 0,void 0,!1)):(N=y.readPixels(2,void 0,void 0,!1),p=y.readPixels(3,void 0,void 0,!1));const W=y.readPixels(4,void 0,void 0,!1),h=y.readPixels(5,void 0,void 0,!1),I=y.gammaSpace;let q=0;return 1!=y.textureType&&2!=y.textureType||(q=1),new Promise((y=>{Promise.all([w,l,N,p,W,h]).then((c=>{let[l,w,N,p,W,h]=c;const o={size:A,right:w,left:l,up:N,down:p,front:W,back:h,format:5,type:q,gammaSpace:I};y(this.ConvertCubeMapToSphericalPolynomial(o))}))}))}static _AreaElement(y,c){return Math.atan2(y*c,Math.sqrt(y*y+c*c+1))}static ConvertCubeMapToSphericalPolynomial(y){const c=new N.d;let A=0;const l=2/y.size,h=l,I=.5*l,q=I-1;for(let N=0;N<6;N++){const o=this._FileFaces[N],O=y[o.name];let L=q;const i=5===y.format?4:3;for(let N=0;N<y.size;N++){let H=q;for(let h=0;h<y.size;h++){const q=o.worldAxisForFileX.scale(H).add(o.worldAxisForFileY.scale(L)).add(o.worldAxisForNormal);q.normalize();const P=this._AreaElement(H-I,L-I)-this._AreaElement(H-I,L+I)-this._AreaElement(H+I,L-I)+this._AreaElement(H+I,L+I);let D=O[N*y.size*i+h*i+0],t=O[N*y.size*i+h*i+1],s=O[N*y.size*i+h*i+2];isNaN(D)&&(D=0),isNaN(t)&&(t=0),isNaN(s)&&(s=0),0===y.type&&(D/=255,t/=255,s/=255),y.gammaSpace&&(D=Math.pow((0,w.Clamp)(D),p.j),t=Math.pow((0,w.Clamp)(t),p.j),s=Math.pow((0,w.Clamp)(s),p.j));const B=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const y=Math.max(D,t,s);if(y>B){const c=B/y;D*=c,t*=c,s*=c}}else D=(0,w.Clamp)(D,0,B),t=(0,w.Clamp)(t,0,B),s=(0,w.Clamp)(s,0,B);const X=new W.dc(D,t,s);c.addLight(q,X,P),A+=P,H+=l}L+=h}}const o=6*(4*Math.PI)/6/A;return c.scaleInPlace(o),c.convertIncidentRadianceToIrradiance(),c.convertIrradianceToLambertianRadiance(),N.e.FromHarmonics(c)}}I._FileFaces=[new h("right",new l.gc(1,0,0),new l.gc(0,0,-1),new l.gc(0,-1,0)),new h("left",new l.gc(-1,0,0),new l.gc(0,0,1),new l.gc(0,-1,0)),new h("up",new l.gc(0,1,0),new l.gc(1,0,0),new l.gc(0,0,1)),new h("down",new l.gc(0,-1,0),new l.gc(1,0,0),new l.gc(0,0,-1)),new h("front",new l.gc(0,0,1),new l.gc(1,0,0),new l.gc(0,-1,0)),new h("back",new l.gc(0,0,-1),new l.gc(-1,0,0),new l.gc(0,-1,0))],I.MAX_HDRI_VALUE=4096,I.PRESERVE_CLAMPED_COLORS=!1},12545:(y,c,A)=>{A.r(c),A.d(c,{Dispose:()=>O,DumpData:()=>o,DumpDataAsync:()=>q,DumpFramebuffer:()=>I,DumpTools:()=>L});var l=A(12433),w=A(12144),N=A(12340),p=A(12184);let W,h=null;async function I(y,c,A,l){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",N=arguments.length>5?arguments[5]:void 0,p=arguments.length>6?arguments[6]:void 0;const W=await A.readPixels(0,0,y,c);o(y,c,new Uint8Array(W.buffer),l,w,N,!0,void 0,p)}async function q(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",w=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7?arguments[7]:void 0;return await new Promise((h=>{o(y,c,A,(y=>h(y)),l,w,N,p,W)}))}function o(y,c,I,q){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",L=arguments.length>5?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7&&void 0!==arguments[7]&&arguments[7],P=arguments.length>8?arguments[8]:void 0;(async function(){return h||(h=new Promise(((y,c)=>{let w,N=null;const h={o:!0,depth:!1,Sc:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(A.bind(A,12458)).then((I=>{let{ThinEngine:q}=I;const o=p.c.Instances.length;try{w=new OffscreenCanvas(100,100),N=new q(w,!1,h)}catch(H){var L;o<p.c.Instances.length&&(null===(L=p.c.Instances.pop())||void 0===L||L.dispose()),w=document.createElement("canvas"),N=new q(w,!1,h)}p.c.Instances.pop(),p.c.OnEnginesDisposedObservable.add((y=>{N&&y!==N&&!N.I&&0===p.c.Instances.length&&O()})),N.getCaps().parallelShaderCompile=void 0;const i=new l.d(N);A.e(52).then(A.bind(A,14801)).then((A=>{let{passPixelShader:p}=A;if(!N)return void c("Engine is not defined");const h=new l.h({Uc:N,name:p.name,fragmentShader:p.shader,samplerNames:["textureSampler"]});W={canvas:w,Uc:N,renderer:i,wrapper:h},y(W)}))})).catch(c)}))),await h})().then((A=>{if(A.Uc.setSize(y,c,!0),I instanceof Float32Array){const y=new Uint8Array(I.length);let c=I.length;for(;c--;){const A=I[c];y[c]=Math.round(255*(0,N.Clamp)(A))}I=y}const l=A.Uc.createRawTexture(I,y,c,5,!1,!i,1);A.renderer.setViewport(),A.renderer.applyEffectWrapper(A.wrapper),A.wrapper.effect._bindTexture("textureSampler",l),A.renderer.draw(),H?w.Tools.ToBlob(A.canvas,(y=>{const c=new FileReader;c.onload=y=>{const c=y.target.result;q&&q(c)},c.readAsArrayBuffer(y)}),o,P):w.Tools.EncodeScreenshotCanvasData(A.canvas,q,o,L,P),l.dispose()}))}function O(){var y;W?(W.wrapper.dispose(),W.renderer.dispose(),W.Uc.dispose()):null===(y=h)||void 0===y||y.then((y=>{y.wrapper.dispose(),y.renderer.dispose(),y.Uc.dispose()}));h=null,W=null}const L={DumpData:o,DumpDataAsync:q,DumpFramebuffer:I,Dispose:O};w.Tools.DumpData=o,w.Tools.DumpDataAsync=q,w.Tools.DumpFramebuffer=I},12820:(y,c,A)=>{A.d(c,{e:()=>N});var l=A(12427),w=A(12547);class N{static ExpandRGBDTexture(y){const c=y._texture;if(!c||!y.isRGBD)return;const w=c.getEngine(),N=w.getCaps(),p=c.isReady;let W=!1;N.textureHalfFloatRender&&N.textureHalfFloatLinearFiltering?(W=!0,c.type=2):N.textureFloatRender&&N.textureFloatLinearFiltering&&(W=!0,c.type=1),W&&(c.isReady=!1,c._isRGBD=!1,c.invertY=!1);const h=async()=>{const N=w.isWebGPU,p=N?1:0;c.isReady=!1,N?await A.e(42).then(A.bind(A,15318)):await A.e(35).then(A.bind(A,15327));const W=new l.c("rgbdDecode","rgbdDecode",null,null,1,null,3,w,!1,void 0,c.type,void 0,null,!1,void 0,p);W.externalTextureSamplerBinding=!0;const h=w.createRenderTargetTexture(c.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:c.samplingMode,type:c.type,format:5});W.onEffectCreatedObservable.addOnce((A=>{A.executeWhenCompiled((()=>{W.onApply=y=>{y._bindTexture("textureSampler",c),y.setFloat2("scale",1,1)},y.mc().postProcessManager.directRender([W],h,!0),w.restoreDefaultFramebuffer(),w._releaseTexture(c),W&&W.dispose(),h._swapAndDie(c),c.isReady=!0}))}))};W&&(p?h():y.onLoadObservable.addOnce(h))}static async EncodeTextureToRGBD(y,c){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return c.getEngine().isWebGPU?await A.e(43).then(A.bind(A,15339)):await A.e(36).then(A.bind(A,15332)),await(0,w.d)("rgbdEncode",y,c,l,1,5)}}}}]);