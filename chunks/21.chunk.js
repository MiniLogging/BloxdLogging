"use strict";(self.isj1uwvwrek=self.isj1uwvwrek||[]).push([[20,21],{13484:(I,x,L)=>{var F=L(13487),X=L(13004);X.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(X.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=F.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((I=>{this._texture._sphericalPolynomial=I,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(I){this._texture&&(this._texture._sphericalPolynomial=I)},enumerable:!0,configurable:!0})},13487:(I,x,L)=>{L.d(x,{e:()=>l});var F=L(12983),X=L(13001),G=L(13171),Y=L(12989),p=L(13020);class B{constructor(I,x,L,F){this.name=I,this.worldAxisForNormal=x,this.worldAxisForFileX=L,this.worldAxisForFileY=F}}class l{static ConvertCubeMapTextureToSphericalPolynomial(I){var x;if(!I.isCube)return null;null===(x=I.tI())||void 0===x||x.getEngine().flushFramebuffer();const L=I.getSize().width,F=I.readPixels(0,void 0,void 0,!1),X=I.readPixels(1,void 0,void 0,!1);let G,Y;I.isRenderTarget?(G=I.readPixels(3,void 0,void 0,!1),Y=I.readPixels(2,void 0,void 0,!1)):(G=I.readPixels(2,void 0,void 0,!1),Y=I.readPixels(3,void 0,void 0,!1));const p=I.readPixels(4,void 0,void 0,!1),B=I.readPixels(5,void 0,void 0,!1),l=I.gammaSpace;let W=0;return 1!=I.textureType&&2!=I.textureType||(W=1),new Promise((I=>{Promise.all([X,F,G,Y,p,B]).then((x=>{let[F,X,G,Y,p,B]=x;const Q={size:L,right:X,left:F,up:G,down:Y,front:p,back:B,format:5,type:W,gammaSpace:l};I(this.ConvertCubeMapToSphericalPolynomial(Q))}))}))}static _AreaElement(I,x){return Math.atan2(I*x,Math.sqrt(I*I+x*x+1))}static ConvertCubeMapToSphericalPolynomial(I){const x=new G.d;let L=0;const F=2/I.size,B=F,l=.5*F,W=l-1;for(let G=0;G<6;G++){const Q=this._FileFaces[G],e=I[Q.name];let g=W;const v=5===I.format?4:3;for(let G=0;G<I.size;G++){let z=W;for(let B=0;B<I.size;B++){const W=Q.worldAxisForFileX.scale(z).add(Q.worldAxisForFileY.scale(g)).add(Q.worldAxisForNormal);W.normalize();const H=this._AreaElement(z-l,g-l)-this._AreaElement(z-l,g+l)-this._AreaElement(z+l,g-l)+this._AreaElement(z+l,g+l);let s=e[G*I.size*v+B*v+0],U=e[G*I.size*v+B*v+1],q=e[G*I.size*v+B*v+2];isNaN(s)&&(s=0),isNaN(U)&&(U=0),isNaN(q)&&(q=0),0===I.type&&(s/=255,U/=255,q/=255),I.gammaSpace&&(s=Math.pow((0,X.Clamp)(s),Y.m),U=Math.pow((0,X.Clamp)(U),Y.m),q=Math.pow((0,X.Clamp)(q),Y.m));const y=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const I=Math.max(s,U,q);if(I>y){const x=y/I;s*=x,U*=x,q*=x}}else s=(0,X.Clamp)(s,0,y),U=(0,X.Clamp)(U,0,y),q=(0,X.Clamp)(q,0,y);const T=new p.Tx(s,U,q);x.addLight(W,T,H),L+=H,z+=F}g+=B}}const Q=6*(4*Math.PI)/6/L;return x.scaleInPlace(Q),x.convertIncidentRadianceToIrradiance(),x.convertIrradianceToLambertianRadiance(),G.g.FromHarmonics(x)}}l._FileFaces=[new B("right",new F.sx(1,0,0),new F.sx(0,0,-1),new F.sx(0,-1,0)),new B("left",new F.sx(-1,0,0),new F.sx(0,0,1),new F.sx(0,-1,0)),new B("up",new F.sx(0,1,0),new F.sx(1,0,0),new F.sx(0,0,1)),new B("down",new F.sx(0,-1,0),new F.sx(1,0,0),new F.sx(0,0,-1)),new B("front",new F.sx(0,0,1),new F.sx(1,0,0),new F.sx(0,-1,0)),new B("back",new F.sx(0,0,-1),new F.sx(-1,0,0),new F.sx(0,-1,0))],l.MAX_HDRI_VALUE=4096,l.PRESERVE_CLAMPED_COLORS=!1},13202:(I,x,L)=>{L.r(x),L.d(x,{Dispose:()=>e,DumpData:()=>Q,DumpDataAsync:()=>W,DumpFramebuffer:()=>l,DumpTools:()=>g});var F=L(13085),X=L(12791),G=L(13001),Y=L(12840);let p,B=null;async function l(I,x,L,F){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",G=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0;const p=await L.readPixels(0,0,I,x);Q(I,x,new Uint8Array(p.buffer),F,X,G,!0,void 0,Y)}async function W(I,x,L){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",X=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7?arguments[7]:void 0;return await new Promise((B=>{Q(I,x,L,(I=>B(I)),F,X,G,Y,p)}))}function Q(I,x,l,W){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",g=arguments.length>5?arguments[5]:void 0,v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],H=arguments.length>8?arguments[8]:void 0;(async function(){return B||(B=new Promise(((I,x)=>{let X,G=null;const B={ip:!0,depth:!1,op:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(L.bind(L,13116)).then((l=>{let{ThinEngine:W}=l;const Q=Y.e.Instances.length;try{X=new OffscreenCanvas(100,100),G=new W(X,!1,B)}catch(z){var g;Q<Y.e.Instances.length&&(null===(g=Y.e.Instances.pop())||void 0===g||g.dispose()),X=document.createElement("canvas"),G=new W(X,!1,B)}Y.e.Instances.pop(),Y.e.OnEnginesDisposedObservable.add((I=>{G&&I!==G&&!G.p&&0===Y.e.Instances.length&&e()})),G.getCaps().parallelShaderCompile=void 0;const v=new F.e(G);L.e(52).then(L.bind(L,15376)).then((L=>{let{passPixelShader:Y}=L;if(!G)return void x("Engine is not defined");const B=new F.i({Hx:G,name:Y.name,fragmentShader:Y.shader,samplerNames:["textureSampler"]});p={canvas:X,Hx:G,renderer:v,wrapper:B},I(p)}))})).catch(x)}))),await B})().then((L=>{if(L.Hx.setSize(I,x,!0),l instanceof Float32Array){const I=new Uint8Array(l.length);let x=l.length;for(;x--;){const L=l[x];I[x]=Math.round(255*(0,G.Clamp)(L))}l=I}const F=L.Hx.createRawTexture(l,I,x,5,!1,!v,1);L.renderer.setViewport(),L.renderer.applyEffectWrapper(L.wrapper),L.wrapper.effect._bindTexture("textureSampler",F),L.renderer.draw(),z?X.Tools.ToBlob(L.canvas,(I=>{const x=new FileReader;x.onload=I=>{const x=I.target.result;W&&W(x)},x.readAsArrayBuffer(I)}),Q,H):X.Tools.EncodeScreenshotCanvasData(L.canvas,W,Q,g,H),F.dispose()}))}function e(){var I;p?(p.wrapper.dispose(),p.renderer.dispose(),p.Hx.dispose()):null===(I=B)||void 0===I||I.then((I=>{I.wrapper.dispose(),I.renderer.dispose(),I.Hx.dispose()}));B=null,p=null}const g={DumpData:Q,DumpDataAsync:W,DumpFramebuffer:l,Dispose:e};X.Tools.DumpData=Q,X.Tools.DumpDataAsync=W,X.Tools.DumpFramebuffer=l},13476:(I,x,L)=>{L.d(x,{c:()=>G});var F=L(13081),X=L(13209);class G{static ExpandRGBDTexture(I){const x=I._texture;if(!x||!I.isRGBD)return;const X=x.getEngine(),G=X.getCaps(),Y=x.isReady;let p=!1;G.textureHalfFloatRender&&G.textureHalfFloatLinearFiltering?(p=!0,x.type=2):G.textureFloatRender&&G.textureFloatLinearFiltering&&(p=!0,x.type=1),p&&(x.isReady=!1,x._isRGBD=!1,x.invertY=!1);const B=async()=>{const G=X.isWebGPU,Y=G?1:0;x.isReady=!1,G?await L.e(42).then(L.bind(L,15907)):await L.e(35).then(L.bind(L,15913));const p=new F.d("rgbdDecode","rgbdDecode",null,null,1,null,3,X,!1,void 0,x.type,void 0,null,!1,void 0,Y);p.externalTextureSamplerBinding=!0;const B=X.createRenderTargetTexture(x.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:x.samplingMode,type:x.type,format:5});p.onEffectCreatedObservable.addOnce((L=>{L.executeWhenCompiled((()=>{p.onApply=I=>{I._bindTexture("textureSampler",x),I.setFloat2("scale",1,1)},I.tI().postProcessManager.directRender([p],B,!0),X.restoreDefaultFramebuffer(),X._releaseTexture(x),p&&p.dispose(),B._swapAndDie(x),x.isReady=!0}))}))};p&&(Y?B():I.onLoadObservable.addOnce(B))}static async EncodeTextureToRGBD(I,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return x.getEngine().isWebGPU?await L.e(43).then(L.bind(L,15920)):await L.e(36).then(L.bind(L,15918)),await(0,X.d)("rgbdEncode",I,x,F,1,5)}}}}]);