"use strict";(self.kdlk57exiqh=self.kdlk57exiqh||[]).push([[20,21],{12740:(i,x,e)=>{var j=e(12747),E=e(12272);E.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(E.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=j.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((i=>{this._texture._sphericalPolynomial=i,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(i){this._texture&&(this._texture._sphericalPolynomial=i)},enumerable:!0,configurable:!0})},12747:(i,x,e)=>{e.d(x,{b:()=>b});var j=e(12250),E=e(12264),a=e(12413),Y=e(12253),J=e(12286);class u{constructor(i,x,e,j){this.name=i,this.worldAxisForNormal=x,this.worldAxisForFileX=e,this.worldAxisForFileY=j}}class b{static ConvertCubeMapTextureToSphericalPolynomial(i){var x;if(!i.isCube)return null;null===(x=i.wi())||void 0===x||x.getEngine().flushFramebuffer();const e=i.getSize().width,j=i.readPixels(0,void 0,void 0,!1),E=i.readPixels(1,void 0,void 0,!1);let a,Y;i.isRenderTarget?(a=i.readPixels(3,void 0,void 0,!1),Y=i.readPixels(2,void 0,void 0,!1)):(a=i.readPixels(2,void 0,void 0,!1),Y=i.readPixels(3,void 0,void 0,!1));const J=i.readPixels(4,void 0,void 0,!1),u=i.readPixels(5,void 0,void 0,!1),b=i.gammaSpace;let g=0;return 1!=i.textureType&&2!=i.textureType||(g=1),new Promise((i=>{Promise.all([E,j,a,Y,J,u]).then((x=>{let[j,E,a,Y,J,u]=x;const A={size:e,right:E,left:j,up:a,down:Y,front:J,back:u,format:5,type:g,gammaSpace:b};i(this.ConvertCubeMapToSphericalPolynomial(A))}))}))}static _AreaElement(i,x){return Math.atan2(i*x,Math.sqrt(i*i+x*x+1))}static ConvertCubeMapToSphericalPolynomial(i){const x=new a.d;let e=0;const j=2/i.size,u=j,b=.5*j,g=b-1;for(let a=0;a<6;a++){const A=this._FileFaces[a],K=i[A.name];let L=g;const o=5===i.format?4:3;for(let a=0;a<i.size;a++){let M=g;for(let u=0;u<i.size;u++){const g=A.worldAxisForFileX.scale(M).add(A.worldAxisForFileY.scale(L)).add(A.worldAxisForNormal);g.normalize();const z=this._AreaElement(M-b,L-b)-this._AreaElement(M-b,L+b)-this._AreaElement(M+b,L-b)+this._AreaElement(M+b,L+b);let T=K[a*i.size*o+u*o+0],Q=K[a*i.size*o+u*o+1],t=K[a*i.size*o+u*o+2];isNaN(T)&&(T=0),isNaN(Q)&&(Q=0),isNaN(t)&&(t=0),0===i.type&&(T/=255,Q/=255,t/=255),i.gammaSpace&&(T=Math.pow((0,E.Clamp)(T),Y.m),Q=Math.pow((0,E.Clamp)(Q),Y.m),t=Math.pow((0,E.Clamp)(t),Y.m));const V=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const i=Math.max(T,Q,t);if(i>V){const x=V/i;T*=x,Q*=x,t*=x}}else T=(0,E.Clamp)(T,0,V),Q=(0,E.Clamp)(Q,0,V),t=(0,E.Clamp)(t,0,V);const S=new J.MJ(T,Q,t);x.addLight(g,S,z),e+=z,M+=j}L+=u}}const A=6*(4*Math.PI)/6/e;return x.scaleInPlace(A),x.convertIncidentRadianceToIrradiance(),x.convertIrradianceToLambertianRadiance(),a.g.FromHarmonics(x)}}b._FileFaces=[new u("right",new j.KJ(1,0,0),new j.KJ(0,0,-1),new j.KJ(0,-1,0)),new u("left",new j.KJ(-1,0,0),new j.KJ(0,0,1),new j.KJ(0,-1,0)),new u("up",new j.KJ(0,1,0),new j.KJ(1,0,0),new j.KJ(0,0,1)),new u("down",new j.KJ(0,-1,0),new j.KJ(1,0,0),new j.KJ(0,0,-1)),new u("front",new j.KJ(0,0,1),new j.KJ(1,0,0),new j.KJ(0,-1,0)),new u("back",new j.KJ(0,0,-1),new j.KJ(-1,0,0),new j.KJ(0,-1,0))],b.MAX_HDRI_VALUE=4096,b.PRESERVE_CLAMPED_COLORS=!1},12439:(i,x,e)=>{e.r(x),e.d(x,{Dispose:()=>K,DumpData:()=>A,DumpDataAsync:()=>g,DumpFramebuffer:()=>b,DumpTools:()=>L});var j=e(12346),E=e(12061),a=e(12264),Y=e(12108);let J,u=null;async function b(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",a=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0;const J=await e.readPixels(0,0,i,x);A(i,x,new Uint8Array(J.buffer),j,E,a,!0,void 0,Y)}async function g(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",E=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7?arguments[7]:void 0;return await new Promise((u=>{A(i,x,e,(i=>u(i)),j,E,a,Y,J)}))}function A(i,x,b,g){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",L=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],M=arguments.length>7&&void 0!==arguments[7]&&arguments[7],z=arguments.length>8?arguments[8]:void 0;(async function(){return u||(u=new Promise(((i,x)=>{let E,a=null;const u={o:!0,depth:!1,Ve:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(e.bind(e,12367)).then((b=>{let{ThinEngine:g}=b;const A=Y.e.Instances.length;try{E=new OffscreenCanvas(100,100),a=new g(E,!1,u)}catch(M){var L;A<Y.e.Instances.length&&(null===(L=Y.e.Instances.pop())||void 0===L||L.dispose()),E=document.createElement("canvas"),a=new g(E,!1,u)}Y.e.Instances.pop(),Y.e.OnEnginesDisposedObservable.add((i=>{a&&i!==a&&!a.M&&0===Y.e.Instances.length&&K()})),a.getCaps().parallelShaderCompile=void 0;const o=new j.c(a);e.e(52).then(e.bind(e,14656)).then((e=>{let{passPixelShader:Y}=e;if(!a)return void x("Engine is not defined");const u=new j.e({tx:a,name:Y.name,fragmentShader:Y.shader,samplerNames:["textureSampler"]});J={canvas:E,tx:a,renderer:o,wrapper:u},i(J)}))})).catch(x)}))),await u})().then((e=>{if(e.tx.setSize(i,x,!0),b instanceof Float32Array){const i=new Uint8Array(b.length);let x=b.length;for(;x--;){const e=b[x];i[x]=Math.round(255*(0,a.Clamp)(e))}b=i}const j=e.tx.createRawTexture(b,i,x,5,!1,!o,1);e.renderer.setViewport(),e.renderer.applyEffectWrapper(e.wrapper),e.wrapper.effect._bindTexture("textureSampler",j),e.renderer.draw(),M?E.Tools.ToBlob(e.canvas,(i=>{const x=new FileReader;x.onload=i=>{const x=i.target.result;g&&g(x)},x.readAsArrayBuffer(i)}),A,z):E.Tools.EncodeScreenshotCanvasData(e.canvas,g,A,L,z),j.dispose()}))}function K(){var i;J?(J.wrapper.dispose(),J.renderer.dispose(),J.tx.dispose()):null===(i=u)||void 0===i||i.then((i=>{i.wrapper.dispose(),i.renderer.dispose(),i.tx.dispose()}));u=null,J=null}const L={DumpData:A,DumpDataAsync:g,DumpFramebuffer:b,Dispose:K};E.Tools.DumpData=A,E.Tools.DumpDataAsync=g,E.Tools.DumpFramebuffer=b},12730:(i,x,e)=>{e.d(x,{d:()=>a});var j=e(12342),E=e(12442);class a{static ExpandRGBDTexture(i){const x=i._texture;if(!x||!i.isRGBD)return;const E=x.getEngine(),a=E.getCaps(),Y=x.isReady;let J=!1;a.textureHalfFloatRender&&a.textureHalfFloatLinearFiltering?(J=!0,x.type=2):a.textureFloatRender&&a.textureFloatLinearFiltering&&(J=!0,x.type=1),J&&(x.isReady=!1,x._isRGBD=!1,x.invertY=!1);const u=async()=>{const a=E.isWebGPU,Y=a?1:0;x.isReady=!1,a?await e.e(42).then(e.bind(e,15188)):await e.e(35).then(e.bind(e,15191));const J=new j.e("rgbdDecode","rgbdDecode",null,null,1,null,3,E,!1,void 0,x.type,void 0,null,!1,void 0,Y);J.externalTextureSamplerBinding=!0;const u=E.createRenderTargetTexture(x.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:x.samplingMode,type:x.type,format:5});J.onEffectCreatedObservable.addOnce((e=>{e.executeWhenCompiled((()=>{J.onApply=i=>{i._bindTexture("textureSampler",x),i.setFloat2("scale",1,1)},i.wi().postProcessManager.directRender([J],u,!0),E.restoreDefaultFramebuffer(),E._releaseTexture(x),J&&J.dispose(),u._swapAndDie(x),x.isReady=!0}))}))};J&&(Y?u():i.onLoadObservable.addOnce(u))}static async EncodeTextureToRGBD(i,x){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return x.getEngine().isWebGPU?await e.e(43).then(e.bind(e,15206)):await e.e(36).then(e.bind(e,15199)),await(0,E.b)("rgbdEncode",i,x,j,1,5)}}}}]);