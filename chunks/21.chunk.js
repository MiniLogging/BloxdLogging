"use strict";(self["1xyrlsr8vb9"]=self["1xyrlsr8vb9"]||[]).push([[20,21],{12746:(I,O,C)=>{var j=C(12755),K=C(12284);K.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(K.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=j.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((I=>{this._texture._sphericalPolynomial=I,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(I){this._texture&&(this._texture._sphericalPolynomial=I)},enumerable:!0,configurable:!0})},12755:(I,O,C)=>{C.d(O,{b:()=>p});var j=C(12272),K=C(12282),i=C(12447),y=C(12274),S=C(12307);class U{constructor(I,O,C,j){this.name=I,this.worldAxisForNormal=O,this.worldAxisForFileX=C,this.worldAxisForFileY=j}}class p{static ConvertCubeMapTextureToSphericalPolynomial(I){var O;if(!I.isCube)return null;null===(O=I.nI())||void 0===O||O.getEngine().flushFramebuffer();const C=I.getSize().width,j=I.readPixels(0,void 0,void 0,!1),K=I.readPixels(1,void 0,void 0,!1);let i,y;I.isRenderTarget?(i=I.readPixels(3,void 0,void 0,!1),y=I.readPixels(2,void 0,void 0,!1)):(i=I.readPixels(2,void 0,void 0,!1),y=I.readPixels(3,void 0,void 0,!1));const S=I.readPixels(4,void 0,void 0,!1),U=I.readPixels(5,void 0,void 0,!1),p=I.gammaSpace;let N=0;return 1!=I.textureType&&2!=I.textureType||(N=1),new Promise((I=>{Promise.all([K,j,i,y,S,U]).then((O=>{let[j,K,i,y,S,U]=O;const Q={size:C,right:K,left:j,up:i,down:y,front:S,back:U,format:5,type:N,gammaSpace:p};I(this.ConvertCubeMapToSphericalPolynomial(Q))}))}))}static _AreaElement(I,O){return Math.atan2(I*O,Math.sqrt(I*I+O*O+1))}static ConvertCubeMapToSphericalPolynomial(I){const O=new i.b;let C=0;const j=2/I.size,U=j,p=.5*j,N=p-1;for(let i=0;i<6;i++){const Q=this._FileFaces[i],s=I[Q.name];let Z=N;const q=5===I.format?4:3;for(let i=0;i<I.size;i++){let mI=N;for(let U=0;U<I.size;U++){const N=Q.worldAxisForFileX.scale(mI).add(Q.worldAxisForFileY.scale(Z)).add(Q.worldAxisForNormal);N.normalize();const E=this._AreaElement(mI-p,Z-p)-this._AreaElement(mI-p,Z+p)-this._AreaElement(mI+p,Z-p)+this._AreaElement(mI+p,Z+p);let h=s[i*I.size*q+U*q+0],r=s[i*I.size*q+U*q+1],W=s[i*I.size*q+U*q+2];isNaN(h)&&(h=0),isNaN(r)&&(r=0),isNaN(W)&&(W=0),0===I.type&&(h/=255,r/=255,W/=255),I.gammaSpace&&(h=Math.pow((0,K.Clamp)(h),y.j),r=Math.pow((0,K.Clamp)(r),y.j),W=Math.pow((0,K.Clamp)(W),y.j));const Y=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const I=Math.max(h,r,W);if(I>Y){const O=Y/I;h*=O,r*=O,W*=O}}else h=(0,K.Clamp)(h,0,Y),r=(0,K.Clamp)(r,0,Y),W=(0,K.Clamp)(W,0,Y);const o=new S.WO(h,r,W);O.addLight(N,o,E),C+=E,mI+=j}Z+=U}}const Q=6*(4*Math.PI)/6/C;return O.scaleInPlace(Q),O.convertIncidentRadianceToIrradiance(),O.convertIrradianceToLambertianRadiance(),i.f.FromHarmonics(O)}}p._FileFaces=[new U("right",new j.mC(1,0,0),new j.mC(0,0,-1),new j.mC(0,-1,0)),new U("left",new j.mC(-1,0,0),new j.mC(0,0,1),new j.mC(0,-1,0)),new U("up",new j.mC(0,1,0),new j.mC(1,0,0),new j.mC(0,0,1)),new U("down",new j.mC(0,-1,0),new j.mC(1,0,0),new j.mC(0,0,-1)),new U("front",new j.mC(0,0,1),new j.mC(1,0,0),new j.mC(0,-1,0)),new U("back",new j.mC(0,0,-1),new j.mC(-1,0,0),new j.mC(0,-1,0))],p.MAX_HDRI_VALUE=4096,p.PRESERVE_CLAMPED_COLORS=!1},12468:(I,O,C)=>{C.r(O),C.d(O,{Dispose:()=>s,DumpData:()=>Q,DumpDataAsync:()=>N,DumpFramebuffer:()=>p,DumpTools:()=>Z});var j=C(12370),K=C(12083),i=C(12282),y=C(12132);let S,U=null;async function p(I,O,C,j){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",i=arguments.length>5?arguments[5]:void 0,y=arguments.length>6?arguments[6]:void 0;const S=await C.readPixels(0,0,I,O);Q(I,O,new Uint8Array(S.buffer),j,K,i,!0,void 0,y)}async function N(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",K=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7?arguments[7]:void 0;return await new Promise((U=>{Q(I,O,C,(I=>U(I)),j,K,i,y,S)}))}function Q(I,O,p,N){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Z=arguments.length>5?arguments[5]:void 0,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],mI=arguments.length>7&&void 0!==arguments[7]&&arguments[7],E=arguments.length>8?arguments[8]:void 0;(async function(){return U||(U=new Promise(((I,O)=>{let K,i=null;const U={QS:!0,depth:!1,SS:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(C.bind(C,12398)).then((p=>{let{ThinEngine:N}=p;const Q=y.e.Instances.length;try{K=new OffscreenCanvas(100,100),i=new N(K,!1,U)}catch(mI){var Z;Q<y.e.Instances.length&&(null===(Z=y.e.Instances.pop())||void 0===Z||Z.dispose()),K=document.createElement("canvas"),i=new N(K,!1,U)}y.e.Instances.pop(),y.e.OnEnginesDisposedObservable.add((I=>{i&&I!==i&&!i.p&&0===y.e.Instances.length&&s()})),i.getCaps().parallelShaderCompile=void 0;const q=new j.b(i);C.e(52).then(C.bind(C,14669)).then((C=>{let{passPixelShader:y}=C;if(!i)return void O("Engine is not defined");const U=new j.c({qO:i,name:y.name,fragmentShader:y.shader,samplerNames:["textureSampler"]});S={canvas:K,qO:i,renderer:q,wrapper:U},I(S)}))})).catch(O)}))),await U})().then((C=>{if(C.qO.setSize(I,O,!0),p instanceof Float32Array){const I=new Uint8Array(p.length);let O=p.length;for(;O--;){const C=p[O];I[O]=Math.round(255*(0,i.Clamp)(C))}p=I}const j=C.qO.createRawTexture(p,I,O,5,!1,!q,1);C.renderer.setViewport(),C.renderer.applyEffectWrapper(C.wrapper),C.wrapper.effect._bindTexture("textureSampler",j),C.renderer.draw(),mI?K.Tools.ToBlob(C.canvas,(I=>{const O=new FileReader;O.onload=I=>{const O=I.target.result;N&&N(O)},O.readAsArrayBuffer(I)}),Q,E):K.Tools.EncodeScreenshotCanvasData(C.canvas,N,Q,Z,E),j.dispose()}))}function s(){var I;S?(S.wrapper.dispose(),S.renderer.dispose(),S.qO.dispose()):null===(I=U)||void 0===I||I.then((I=>{I.wrapper.dispose(),I.renderer.dispose(),I.qO.dispose()}));U=null,S=null}const Z={DumpData:Q,DumpDataAsync:N,DumpFramebuffer:p,Dispose:s};K.Tools.DumpData=Q,K.Tools.DumpDataAsync=N,K.Tools.DumpFramebuffer=p},12734:(I,O,C)=>{C.d(O,{d:()=>i});var j=C(12363),K=C(12476);class i{static ExpandRGBDTexture(I){const O=I._texture;if(!O||!I.isRGBD)return;const K=O.getEngine(),i=K.getCaps(),y=O.isReady;let S=!1;i.textureHalfFloatRender&&i.textureHalfFloatLinearFiltering?(S=!0,O.type=2):i.textureFloatRender&&i.textureFloatLinearFiltering&&(S=!0,O.type=1),S&&(O.isReady=!1,O._isRGBD=!1,O.invertY=!1);const U=async()=>{const i=K.isWebGPU,y=i?1:0;O.isReady=!1,i?await C.e(42).then(C.bind(C,15187)):await C.e(35).then(C.bind(C,15193));const S=new j.c("rgbdDecode","rgbdDecode",null,null,1,null,3,K,!1,void 0,O.type,void 0,null,!1,void 0,y);S.externalTextureSamplerBinding=!0;const U=K.createRenderTargetTexture(O.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:O.samplingMode,type:O.type,format:5});S.onEffectCreatedObservable.addOnce((C=>{C.executeWhenCompiled((()=>{S.onApply=I=>{I._bindTexture("textureSampler",O),I.setFloat2("scale",1,1)},I.nI().postProcessManager.directRender([S],U,!0),K.restoreDefaultFramebuffer(),K._releaseTexture(O),S&&S.dispose(),U._swapAndDie(O),O.isReady=!0}))}))};S&&(y?U():I.onLoadObservable.addOnce(U))}static async EncodeTextureToRGBD(I,O){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return O.getEngine().isWebGPU?await C.e(43).then(C.bind(C,15210)):await C.e(36).then(C.bind(C,15201)),await(0,K.d)("rgbdEncode",I,O,j,1,5)}}}}]);