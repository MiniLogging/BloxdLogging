"use strict";(self.ipz2em9uj1g=self.ipz2em9uj1g||[]).push([[20,21],{13051:(r,O,W)=>{var q=W(13054),Q=W(12604);Q.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(Q.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=q.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((r=>{this._texture._sphericalPolynomial=r,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(r){this._texture&&(this._texture._sphericalPolynomial=r)},enumerable:!0,configurable:!0})},13054:(r,O,W)=>{W.d(O,{b:()=>mr});var q=W(12591),Q=W(12602),C=W(12768),T=W(12595),h=W(12631);class J{constructor(r,O,W,q){this.name=r,this.worldAxisForNormal=O,this.worldAxisForFileX=W,this.worldAxisForFileY=q}}class mr{static ConvertCubeMapTextureToSphericalPolynomial(r){var O;if(!r.isCube)return null;null===(O=r.Dr())||void 0===O||O.getEngine().flushFramebuffer();const W=r.getSize().width,q=r.readPixels(0,void 0,void 0,!1),Q=r.readPixels(1,void 0,void 0,!1);let C,T;r.isRenderTarget?(C=r.readPixels(3,void 0,void 0,!1),T=r.readPixels(2,void 0,void 0,!1)):(C=r.readPixels(2,void 0,void 0,!1),T=r.readPixels(3,void 0,void 0,!1));const h=r.readPixels(4,void 0,void 0,!1),J=r.readPixels(5,void 0,void 0,!1),mr=r.gammaSpace;let d=0;return 1!=r.textureType&&2!=r.textureType||(d=1),new Promise((r=>{Promise.all([Q,q,C,T,h,J]).then((O=>{let[q,Q,C,T,h,J]=O;const v={size:W,right:Q,left:q,up:C,down:T,front:h,back:J,format:5,type:d,gammaSpace:mr};r(this.ConvertCubeMapToSphericalPolynomial(v))}))}))}static _AreaElement(r,O){return Math.atan2(r*O,Math.sqrt(r*r+O*O+1))}static ConvertCubeMapToSphericalPolynomial(r){const O=new C.e;let W=0;const q=2/r.size,J=q,mr=.5*q,d=mr-1;for(let C=0;C<6;C++){const v=this._FileFaces[C],g=r[v.name];let K=d;const U=5===r.format?4:3;for(let C=0;C<r.size;C++){let P=d;for(let J=0;J<r.size;J++){const d=v.worldAxisForFileX.scale(P).add(v.worldAxisForFileY.scale(K)).add(v.worldAxisForNormal);d.normalize();const b=this._AreaElement(P-mr,K-mr)-this._AreaElement(P-mr,K+mr)-this._AreaElement(P+mr,K-mr)+this._AreaElement(P+mr,K+mr);let e=g[C*r.size*U+J*U+0],Y=g[C*r.size*U+J*U+1],G=g[C*r.size*U+J*U+2];isNaN(e)&&(e=0),isNaN(Y)&&(Y=0),isNaN(G)&&(G=0),0===r.type&&(e/=255,Y/=255,G/=255),r.gammaSpace&&(e=Math.pow((0,Q.Clamp)(e),T.i),Y=Math.pow((0,Q.Clamp)(Y),T.i),G=Math.pow((0,Q.Clamp)(G),T.i));const X=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const r=Math.max(e,Y,G);if(r>X){const O=X/r;e*=O,Y*=O,G*=O}}else e=(0,Q.Clamp)(e,0,X),Y=(0,Q.Clamp)(Y,0,X),G=(0,Q.Clamp)(G,0,X);const S=new h.SO(e,Y,G);O.addLight(d,S,b),W+=b,P+=q}K+=J}}const v=6*(4*Math.PI)/6/W;return O.scaleInPlace(v),O.convertIncidentRadianceToIrradiance(),O.convertIrradianceToLambertianRadiance(),C.g.FromHarmonics(O)}}mr._FileFaces=[new J("right",new q.eO(1,0,0),new q.eO(0,0,-1),new q.eO(0,-1,0)),new J("left",new q.eO(-1,0,0),new q.eO(0,0,1),new q.eO(0,-1,0)),new J("up",new q.eO(0,1,0),new q.eO(1,0,0),new q.eO(0,0,1)),new J("down",new q.eO(0,-1,0),new q.eO(1,0,0),new q.eO(0,0,-1)),new J("front",new q.eO(0,0,1),new q.eO(1,0,0),new q.eO(0,-1,0)),new J("back",new q.eO(0,0,-1),new q.eO(-1,0,0),new q.eO(0,-1,0))],mr.MAX_HDRI_VALUE=4096,mr.PRESERVE_CLAMPED_COLORS=!1},12791:(r,O,W)=>{W.r(O),W.d(O,{Dispose:()=>g,DumpData:()=>v,DumpDataAsync:()=>d,DumpFramebuffer:()=>mr,DumpTools:()=>K});var q=W(12691),Q=W(12428),C=W(12602),T=W(12484);let h,J=null;async function mr(r,O,W,q){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",C=arguments.length>5?arguments[5]:void 0,T=arguments.length>6?arguments[6]:void 0;const h=await W.readPixels(0,0,r,O);v(r,O,new Uint8Array(h.buffer),q,Q,C,!0,void 0,T)}async function d(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",Q=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7?arguments[7]:void 0;return await new Promise((J=>{v(r,O,W,(r=>J(r)),q,Q,C,T,h)}))}function v(r,O,mr,d){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",K=arguments.length>5?arguments[5]:void 0,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7&&void 0!==arguments[7]&&arguments[7],b=arguments.length>8?arguments[8]:void 0;(async function(){return J||(J=new Promise(((r,O)=>{let Q,C=null;const J={Ph:!0,depth:!1,dh:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(W.bind(W,12718)).then((mr=>{let{ThinEngine:d}=mr;const v=T.d.Instances.length;try{Q=new OffscreenCanvas(100,100),C=new d(Q,!1,J)}catch(P){var K;v<T.d.Instances.length&&(null===(K=T.d.Instances.pop())||void 0===K||K.dispose()),Q=document.createElement("canvas"),C=new d(Q,!1,J)}T.d.Instances.pop(),T.d.OnEnginesDisposedObservable.add((r=>{C&&r!==C&&!C.J&&0===T.d.Instances.length&&g()})),C.getCaps().parallelShaderCompile=void 0;const U=new q.e(C);W.e(52).then(W.bind(W,15104)).then((W=>{let{passPixelShader:T}=W;if(!C)return void O("Engine is not defined");const J=new q.g({bO:C,name:T.name,fragmentShader:T.shader,samplerNames:["textureSampler"]});h={canvas:Q,bO:C,renderer:U,wrapper:J},r(h)}))})).catch(O)}))),await J})().then((W=>{if(W.bO.setSize(r,O,!0),mr instanceof Float32Array){const r=new Uint8Array(mr.length);let O=mr.length;for(;O--;){const W=mr[O];r[O]=Math.round(255*(0,C.Clamp)(W))}mr=r}const q=W.bO.createRawTexture(mr,r,O,5,!1,!U,1);W.renderer.setViewport(),W.renderer.applyEffectWrapper(W.wrapper),W.wrapper.effect._bindTexture("textureSampler",q),W.renderer.draw(),P?Q.Tools.ToBlob(W.canvas,(r=>{const O=new FileReader;O.onload=r=>{const O=r.target.result;d&&d(O)},O.readAsArrayBuffer(r)}),v,b):Q.Tools.EncodeScreenshotCanvasData(W.canvas,d,v,K,b),q.dispose()}))}function g(){var r;h?(h.wrapper.dispose(),h.renderer.dispose(),h.bO.dispose()):null===(r=J)||void 0===r||r.then((r=>{r.wrapper.dispose(),r.renderer.dispose(),r.bO.dispose()}));J=null,h=null}const K={DumpData:v,DumpDataAsync:d,DumpFramebuffer:mr,Dispose:g};Q.Tools.DumpData=v,Q.Tools.DumpDataAsync=d,Q.Tools.DumpFramebuffer=mr},13041:(r,O,W)=>{W.d(O,{c:()=>C});var q=W(12686),Q=W(12796);class C{static ExpandRGBDTexture(r){const O=r._texture;if(!O||!r.isRGBD)return;const Q=O.getEngine(),C=Q.getCaps(),T=O.isReady;let h=!1;C.textureHalfFloatRender&&C.textureHalfFloatLinearFiltering?(h=!0,O.type=2):C.textureFloatRender&&C.textureFloatLinearFiltering&&(h=!0,O.type=1),h&&(O.isReady=!1,O._isRGBD=!1,O.invertY=!1);const J=async()=>{const C=Q.isWebGPU,T=C?1:0;O.isReady=!1,C?await W.e(42).then(W.bind(W,15682)):await W.e(35).then(W.bind(W,15686));const h=new q.d("rgbdDecode","rgbdDecode",null,null,1,null,3,Q,!1,void 0,O.type,void 0,null,!1,void 0,T);h.externalTextureSamplerBinding=!0;const J=Q.createRenderTargetTexture(O.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:O.samplingMode,type:O.type,format:5});h.onEffectCreatedObservable.addOnce((W=>{W.executeWhenCompiled((()=>{h.onApply=r=>{r._bindTexture("textureSampler",O),r.setFloat2("scale",1,1)},r.Dr().postProcessManager.directRender([h],J,!0),Q.restoreDefaultFramebuffer(),Q._releaseTexture(O),h&&h.dispose(),J._swapAndDie(O),O.isReady=!0}))}))};h&&(T?J():r.onLoadObservable.addOnce(J))}static async EncodeTextureToRGBD(r,O){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return O.getEngine().isWebGPU?await W.e(43).then(W.bind(W,15693)):await W.e(36).then(W.bind(W,15688)),await(0,Q.b)("rgbdEncode",r,O,q,1,5)}}}}]);