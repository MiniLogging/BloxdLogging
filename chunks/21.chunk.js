"use strict";(self.r00gjvkwa6=self.r00gjvkwa6||[]).push([[20,21],{11820:(H,O,S)=>{var t=S(11824),q=S(11322);q.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(q.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=t.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((H=>{this._texture._sphericalPolynomial=H,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(H){this._texture&&(this._texture._sphericalPolynomial=H)},enumerable:!0,configurable:!0})},11824:(H,O,S)=>{S.d(O,{d:()=>w});var t=S(11301),q=S(11317),p=S(11509),G=S(11307),U=S(11355);class V{constructor(H,O,S,t){this.name=H,this.worldAxisForNormal=O,this.worldAxisForFileX=S,this.worldAxisForFileY=t}}class w{static ConvertCubeMapTextureToSphericalPolynomial(H){var O;if(!H.isCube)return null;null===(O=H.YH())||void 0===O||O.getEngine().flushFramebuffer();const S=H.getSize().width,t=H.readPixels(0,void 0,void 0,!1),q=H.readPixels(1,void 0,void 0,!1);let p,G;H.isRenderTarget?(p=H.readPixels(3,void 0,void 0,!1),G=H.readPixels(2,void 0,void 0,!1)):(p=H.readPixels(2,void 0,void 0,!1),G=H.readPixels(3,void 0,void 0,!1));const U=H.readPixels(4,void 0,void 0,!1),V=H.readPixels(5,void 0,void 0,!1),w=H.gammaSpace;let o=0;return 1!=H.textureType&&2!=H.textureType||(o=1),new Promise((H=>{Promise.all([q,t,p,G,U,V]).then((O=>{let[t,q,p,G,U,V]=O;const h={size:S,right:q,left:t,up:p,down:G,front:U,back:V,format:5,type:o,gammaSpace:w};H(this.ConvertCubeMapToSphericalPolynomial(h))}))}))}static _AreaElement(H,O){return Math.atan2(H*O,Math.sqrt(H*H+O*O+1))}static ConvertCubeMapToSphericalPolynomial(H){const O=new p.d;let S=0;const t=2/H.size,V=t,w=.5*t,o=w-1;for(let p=0;p<6;p++){const h=this._FileFaces[p],a=H[h.name];let j=o;const e=5===H.format?4:3;for(let p=0;p<H.size;p++){let X=o;for(let V=0;V<H.size;V++){const o=h.worldAxisForFileX.scale(X).add(h.worldAxisForFileY.scale(j)).add(h.worldAxisForNormal);o.normalize();const E=this._AreaElement(X-w,j-w)-this._AreaElement(X-w,j+w)-this._AreaElement(X+w,j-w)+this._AreaElement(X+w,j+w);let y=a[p*H.size*e+V*e+0],T=a[p*H.size*e+V*e+1],K=a[p*H.size*e+V*e+2];isNaN(y)&&(y=0),isNaN(T)&&(T=0),isNaN(K)&&(K=0),0===H.type&&(y/=255,T/=255,K/=255),H.gammaSpace&&(y=Math.pow((0,q.Clamp)(y),G.i),T=Math.pow((0,q.Clamp)(T),G.i),K=Math.pow((0,q.Clamp)(K),G.i));const b=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const H=Math.max(y,T,K);if(H>b){const O=b/H;y*=O,T*=O,K*=O}}else y=(0,q.Clamp)(y,0,b),T=(0,q.Clamp)(T,0,b),K=(0,q.Clamp)(K,0,b);const D=new U.TO(y,T,K);O.addLight(o,D,E),S+=E,X+=t}j+=V}}const h=6*(4*Math.PI)/6/S;return O.scaleInPlace(h),O.convertIncidentRadianceToIrradiance(),O.convertIrradianceToLambertianRadiance(),p.h.FromHarmonics(O)}}w._FileFaces=[new V("right",new t.eO(1,0,0),new t.eO(0,0,-1),new t.eO(0,-1,0)),new V("left",new t.eO(-1,0,0),new t.eO(0,0,1),new t.eO(0,-1,0)),new V("up",new t.eO(0,1,0),new t.eO(1,0,0),new t.eO(0,0,1)),new V("down",new t.eO(0,-1,0),new t.eO(1,0,0),new t.eO(0,0,-1)),new V("front",new t.eO(0,0,1),new t.eO(1,0,0),new t.eO(0,-1,0)),new V("back",new t.eO(0,0,-1),new t.eO(-1,0,0),new t.eO(0,-1,0))],w.MAX_HDRI_VALUE=4096,w.PRESERVE_CLAMPED_COLORS=!1},11532:(H,O,S)=>{S.r(O),S.d(O,{Dispose:()=>a,DumpData:()=>h,DumpDataAsync:()=>o,DumpFramebuffer:()=>w,DumpTools:()=>j});var t=S(11416),q=S(11131),p=S(11317),G=S(11180);let U,V=null;async function w(H,O,S,t){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",p=arguments.length>5?arguments[5]:void 0,G=arguments.length>6?arguments[6]:void 0;const U=await S.readPixels(0,0,H,O);h(H,O,new Uint8Array(U.buffer),t,q,p,!0,void 0,G)}async function o(H,O,S){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",q=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7?arguments[7]:void 0;return await new Promise((V=>{h(H,O,S,(H=>V(H)),t,q,p,G,U)}))}function h(H,O,w,o){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",j=arguments.length>5?arguments[5]:void 0,e=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]&&arguments[7],E=arguments.length>8?arguments[8]:void 0;(async function(){return V||(V=new Promise(((H,O)=>{let q,p=null;const V={SU:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(S.bind(S,11442)).then((w=>{let{ThinEngine:o}=w;const h=G.c.Instances.length;try{q=new OffscreenCanvas(100,100),p=new o(q,!1,V)}catch(X){var j;h<G.c.Instances.length&&(null===(j=G.c.Instances.pop())||void 0===j||j.dispose()),q=document.createElement("canvas"),p=new o(q,!1,V)}G.c.Instances.pop(),G.c.OnEnginesDisposedObservable.add((H=>{p&&H!==p&&!p.G&&0===G.c.Instances.length&&a()})),p.getCaps().parallelShaderCompile=void 0;const e=new t.e(p);S.e(52).then(S.bind(S,13786)).then((S=>{let{passPixelShader:G}=S;if(!p)return void O("Engine is not defined");const V=new t.h({jO:p,name:G.name,fragmentShader:G.shader,samplerNames:["textureSampler"]});U={canvas:q,jO:p,renderer:e,wrapper:V},H(U)}))})).catch(O)}))),await V})().then((S=>{if(S.jO.setSize(H,O,!0),w instanceof Float32Array){const H=new Uint8Array(w.length);let O=w.length;for(;O--;){const S=w[O];H[O]=Math.round(255*(0,p.Clamp)(S))}w=H}const t=S.jO.createRawTexture(w,H,O,5,!1,!e,1);S.renderer.setViewport(),S.renderer.applyEffectWrapper(S.wrapper),S.wrapper.effect._bindTexture("textureSampler",t),S.renderer.draw(),X?q.Tools.ToBlob(S.canvas,(H=>{const O=new FileReader;O.onload=H=>{const O=H.target.result;o&&o(O)},O.readAsArrayBuffer(H)}),h,E):q.Tools.EncodeScreenshotCanvasData(S.canvas,o,h,j,E),t.dispose()}))}function a(){var H;U?(U.wrapper.dispose(),U.renderer.dispose(),U.jO.dispose()):null===(H=V)||void 0===H||H.then((H=>{H.wrapper.dispose(),H.renderer.dispose(),H.jO.dispose()}));V=null,U=null}const j={DumpData:h,DumpDataAsync:o,DumpFramebuffer:w,Dispose:a};q.Tools.DumpData=h,q.Tools.DumpDataAsync=o,q.Tools.DumpFramebuffer=w},11809:(H,O,S)=>{S.d(O,{e:()=>p});var t=S(11407),q=S(11534);class p{static ExpandRGBDTexture(H){const O=H._texture;if(!O||!H.isRGBD)return;const q=O.getEngine(),p=q.getCaps(),G=O.isReady;let U=!1;p.textureHalfFloatRender&&p.textureHalfFloatLinearFiltering?(U=!0,O.type=2):p.textureFloatRender&&p.textureFloatLinearFiltering&&(U=!0,O.type=1),U&&(O.isReady=!1,O._isRGBD=!1,O.invertY=!1);const V=async()=>{const p=q.isWebGPU,G=p?1:0;O.isReady=!1,p?await S.e(42).then(S.bind(S,14333)):await S.e(35).then(S.bind(S,14335));const U=new t.e("rgbdDecode","rgbdDecode",null,null,1,null,3,q,!1,void 0,O.type,void 0,null,!1,void 0,G);U.externalTextureSamplerBinding=!0;const V=q.createRenderTargetTexture(O.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:O.samplingMode,type:O.type,format:5});U.onEffectCreatedObservable.addOnce((S=>{S.executeWhenCompiled((()=>{U.onApply=H=>{H._bindTexture("textureSampler",O),H.setFloat2("scale",1,1)},H.YH().postProcessManager.directRender([U],V,!0),q.restoreDefaultFramebuffer(),q._releaseTexture(O),U&&U.dispose(),V._swapAndDie(O),O.isReady=!0}))}))};U&&(G?V():H.onLoadObservable.addOnce(V))}static async EncodeTextureToRGBD(H,O){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return O.getEngine().isWebGPU?await S.e(43).then(S.bind(S,14341)):await S.e(36).then(S.bind(S,14337)),await(0,q.d)("rgbdEncode",H,O,t,1,5)}}}}]);