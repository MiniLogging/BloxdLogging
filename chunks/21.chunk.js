"use strict";(self["9d4d30r2sf"]=self["9d4d30r2sf"]||[]).push([[20,21],{13027:(o,v,V)=>{var g=V(13031),E=V(12518);E.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(E.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=g.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((o=>{this._texture._sphericalPolynomial=o,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(o){this._texture&&(this._texture._sphericalPolynomial=o)},enumerable:!0,configurable:!0})},13031:(o,v,V)=>{V.d(v,{b:()=>O});var g=V(12488),E=V(12511),I=V(12692),Q=V(12497),U=V(12547);class n{constructor(o,v,V,g){this.name=o,this.worldAxisForNormal=v,this.worldAxisForFileX=V,this.worldAxisForFileY=g}}class O{static ConvertCubeMapTextureToSphericalPolynomial(o){var v;if(!o.isCube)return null;null===(v=o.Fo())||void 0===v||v.getEngine().flushFramebuffer();const V=o.getSize().width,g=o.readPixels(0,void 0,void 0,!1),E=o.readPixels(1,void 0,void 0,!1);let I,Q;o.isRenderTarget?(I=o.readPixels(3,void 0,void 0,!1),Q=o.readPixels(2,void 0,void 0,!1)):(I=o.readPixels(2,void 0,void 0,!1),Q=o.readPixels(3,void 0,void 0,!1));const U=o.readPixels(4,void 0,void 0,!1),n=o.readPixels(5,void 0,void 0,!1),O=o.gammaSpace;let h=0;return 1!=o.textureType&&2!=o.textureType||(h=1),new Promise((o=>{Promise.all([E,g,I,Q,U,n]).then((v=>{let[g,E,I,Q,U,n]=v;const x={size:V,right:E,left:g,up:I,down:Q,front:U,back:n,format:5,type:h,gammaSpace:O};o(this.ConvertCubeMapToSphericalPolynomial(x))}))}))}static _AreaElement(o,v){return Math.atan2(o*v,Math.sqrt(o*o+v*v+1))}static ConvertCubeMapToSphericalPolynomial(o){const v=new I.b;let V=0;const g=2/o.size,n=g,O=.5*g,h=O-1;for(let I=0;I<6;I++){const x=this._FileFaces[I],f=o[x.name];let l=h;const S=5===o.format?4:3;for(let I=0;I<o.size;I++){let T=h;for(let n=0;n<o.size;n++){const h=x.worldAxisForFileX.scale(T).add(x.worldAxisForFileY.scale(l)).add(x.worldAxisForNormal);h.normalize();const c=this._AreaElement(T-O,l-O)-this._AreaElement(T-O,l+O)-this._AreaElement(T+O,l-O)+this._AreaElement(T+O,l+O);let R=f[I*o.size*S+n*S+0],j=f[I*o.size*S+n*S+1],t=f[I*o.size*S+n*S+2];isNaN(R)&&(R=0),isNaN(j)&&(j=0),isNaN(t)&&(t=0),0===o.type&&(R/=255,j/=255,t/=255),o.gammaSpace&&(R=Math.pow((0,E.Clamp)(R),Q.k),j=Math.pow((0,E.Clamp)(j),Q.k),t=Math.pow((0,E.Clamp)(t),Q.k));const s=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const o=Math.max(R,j,t);if(o>s){const v=s/o;R*=v,j*=v,t*=v}}else R=(0,E.Clamp)(R,0,s),j=(0,E.Clamp)(j,0,s),t=(0,E.Clamp)(t,0,s);const L=new U.Lv(R,j,t);v.addLight(h,L,c),V+=c,T+=g}l+=n}}const x=6*(4*Math.PI)/6/V;return v.scaleInPlace(x),v.convertIncidentRadianceToIrradiance(),v.convertIrradianceToLambertianRadiance(),I.c.FromHarmonics(v)}}O._FileFaces=[new n("right",new g.cv(1,0,0),new g.cv(0,0,-1),new g.cv(0,-1,0)),new n("left",new g.cv(-1,0,0),new g.cv(0,0,1),new g.cv(0,-1,0)),new n("up",new g.cv(0,1,0),new g.cv(1,0,0),new g.cv(0,0,1)),new n("down",new g.cv(0,-1,0),new g.cv(1,0,0),new g.cv(0,0,-1)),new n("front",new g.cv(0,0,1),new g.cv(1,0,0),new g.cv(0,-1,0)),new n("back",new g.cv(0,0,-1),new g.cv(-1,0,0),new g.cv(0,-1,0))],O.MAX_HDRI_VALUE=4096,O.PRESERVE_CLAMPED_COLORS=!1},12728:(o,v,V)=>{V.r(v),V.d(v,{Dispose:()=>f,DumpData:()=>x,DumpDataAsync:()=>h,DumpFramebuffer:()=>O,DumpTools:()=>l});var g=V(12604),E=V(12291),I=V(12511),Q=V(12339);let U,n=null;async function O(o,v,V,g){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",I=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6?arguments[6]:void 0;const U=await V.readPixels(0,0,o,v);x(o,v,new Uint8Array(U.buffer),g,E,I,!0,void 0,Q)}async function h(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",E=arguments.length>4?arguments[4]:void 0,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7?arguments[7]:void 0;return await new Promise((n=>{x(o,v,V,(o=>n(o)),g,E,I,Q,U)}))}function x(o,v,O,h){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",l=arguments.length>5?arguments[5]:void 0,S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],T=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8?arguments[8]:void 0;(async function(){return n||(n=new Promise(((o,v)=>{let E,I=null;const n={o:!0,depth:!1,Rg:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(V.bind(V,12628)).then((O=>{let{ThinEngine:h}=O;const x=Q.d.Instances.length;try{E=new OffscreenCanvas(100,100),I=new h(E,!1,n)}catch(T){var l;x<Q.d.Instances.length&&(null===(l=Q.d.Instances.pop())||void 0===l||l.dispose()),E=document.createElement("canvas"),I=new h(E,!1,n)}Q.d.Instances.pop(),Q.d.OnEnginesDisposedObservable.add((o=>{I&&o!==I&&!I.l&&0===Q.d.Instances.length&&f()})),I.getCaps().parallelShaderCompile=void 0;const S=new g.b(I);V.e(52).then(V.bind(V,15012)).then((V=>{let{passPixelShader:Q}=V;if(!I)return void v("Engine is not defined");const n=new g.e({Tv:I,name:Q.name,fragmentShader:Q.shader,samplerNames:["textureSampler"]});U={canvas:E,Tv:I,renderer:S,wrapper:n},o(U)}))})).catch(v)}))),await n})().then((V=>{if(V.Tv.setSize(o,v,!0),O instanceof Float32Array){const o=new Uint8Array(O.length);let v=O.length;for(;v--;){const V=O[v];o[v]=Math.round(255*(0,I.Clamp)(V))}O=o}const g=V.Tv.createRawTexture(O,o,v,5,!1,!S,1);V.renderer.setViewport(),V.renderer.applyEffectWrapper(V.wrapper),V.wrapper.effect._bindTexture("textureSampler",g),V.renderer.draw(),T?E.Tools.ToBlob(V.canvas,(o=>{const v=new FileReader;v.onload=o=>{const v=o.target.result;h&&h(v)},v.readAsArrayBuffer(o)}),x,c):E.Tools.EncodeScreenshotCanvasData(V.canvas,h,x,l,c),g.dispose()}))}function f(){var o;U?(U.wrapper.dispose(),U.renderer.dispose(),U.Tv.dispose()):null===(o=n)||void 0===o||o.then((o=>{o.wrapper.dispose(),o.renderer.dispose(),o.Tv.dispose()}));n=null,U=null}const l={DumpData:x,DumpDataAsync:h,DumpFramebuffer:O,Dispose:f};E.Tools.DumpData=x,E.Tools.DumpDataAsync=h,E.Tools.DumpFramebuffer=O},13018:(o,v,V)=>{V.d(v,{b:()=>I});var g=V(12597),E=V(12737);class I{static ExpandRGBDTexture(o){const v=o._texture;if(!v||!o.isRGBD)return;const E=v.getEngine(),I=E.getCaps(),Q=v.isReady;let U=!1;I.textureHalfFloatRender&&I.textureHalfFloatLinearFiltering?(U=!0,v.type=2):I.textureFloatRender&&I.textureFloatLinearFiltering&&(U=!0,v.type=1),U&&(v.isReady=!1,v._isRGBD=!1,v.invertY=!1);const n=async()=>{const I=E.isWebGPU,Q=I?1:0;v.isReady=!1,I?await V.e(42).then(V.bind(V,15548)):await V.e(35).then(V.bind(V,15555));const U=new g.b("rgbdDecode","rgbdDecode",null,null,1,null,3,E,!1,void 0,v.type,void 0,null,!1,void 0,Q);U.externalTextureSamplerBinding=!0;const n=E.createRenderTargetTexture(v.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:v.samplingMode,type:v.type,format:5});U.onEffectCreatedObservable.addOnce((V=>{V.executeWhenCompiled((()=>{U.onApply=o=>{o._bindTexture("textureSampler",v),o.setFloat2("scale",1,1)},o.Fo().postProcessManager.directRender([U],n,!0),E.restoreDefaultFramebuffer(),E._releaseTexture(v),U&&U.dispose(),n._swapAndDie(v),v.isReady=!0}))}))};U&&(Q?n():o.onLoadObservable.addOnce(n))}static async EncodeTextureToRGBD(o,v){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return v.getEngine().isWebGPU?await V.e(43).then(V.bind(V,15565)):await V.e(36).then(V.bind(V,15557)),await(0,E.c)("rgbdEncode",o,v,g,1,5)}}}}]);