"use strict";(self.rsqbdnwe5e=self.rsqbdnwe5e||[]).push([[20,21],{12899:(N,p,T)=>{var A=T(12906),a=T(12398);a.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(a.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=A.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((N=>{this._texture._sphericalPolynomial=N,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(N){this._texture&&(this._texture._sphericalPolynomial=N)},enumerable:!0,configurable:!0})},12906:(N,p,T)=>{T.d(p,{b:()=>e});var A=T(12371),a=T(12390),C=T(12564),U=T(12376),X=T(12421);class y{constructor(N,p,T,A){this.name=N,this.worldAxisForNormal=p,this.worldAxisForFileX=T,this.worldAxisForFileY=A}}class e{static ConvertCubeMapTextureToSphericalPolynomial(N){var p;if(!N.isCube)return null;null===(p=N.KN())||void 0===p||p.getEngine().flushFramebuffer();const T=N.getSize().width,A=N.readPixels(0,void 0,void 0,!1),a=N.readPixels(1,void 0,void 0,!1);let C,U;N.isRenderTarget?(C=N.readPixels(3,void 0,void 0,!1),U=N.readPixels(2,void 0,void 0,!1)):(C=N.readPixels(2,void 0,void 0,!1),U=N.readPixels(3,void 0,void 0,!1));const X=N.readPixels(4,void 0,void 0,!1),y=N.readPixels(5,void 0,void 0,!1),e=N.gammaSpace;let H=0;return 1!=N.textureType&&2!=N.textureType||(H=1),new Promise((N=>{Promise.all([a,A,C,U,X,y]).then((p=>{let[A,a,C,U,X,y]=p;const M={size:T,right:a,left:A,up:C,down:U,front:X,back:y,format:5,type:H,gammaSpace:e};N(this.ConvertCubeMapToSphericalPolynomial(M))}))}))}static _AreaElement(N,p){return Math.atan2(N*p,Math.sqrt(N*N+p*p+1))}static ConvertCubeMapToSphericalPolynomial(N){const p=new C.d;let T=0;const A=2/N.size,y=A,e=.5*A,H=e-1;for(let C=0;C<6;C++){const M=this._FileFaces[C],b=N[M.name];let l=H;const k=5===N.format?4:3;for(let C=0;C<N.size;C++){let x=H;for(let y=0;y<N.size;y++){const H=M.worldAxisForFileX.scale(x).add(M.worldAxisForFileY.scale(l)).add(M.worldAxisForNormal);H.normalize();const I=this._AreaElement(x-e,l-e)-this._AreaElement(x-e,l+e)-this._AreaElement(x+e,l-e)+this._AreaElement(x+e,l+e);let L=b[C*N.size*k+y*k+0],n=b[C*N.size*k+y*k+1],w=b[C*N.size*k+y*k+2];isNaN(L)&&(L=0),isNaN(n)&&(n=0),isNaN(w)&&(w=0),0===N.type&&(L/=255,n/=255,w/=255),N.gammaSpace&&(L=Math.pow((0,a.Clamp)(L),U.k),n=Math.pow((0,a.Clamp)(n),U.k),w=Math.pow((0,a.Clamp)(w),U.k));const g=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const N=Math.max(L,n,w);if(N>g){const p=g/N;L*=p,n*=p,w*=p}}else L=(0,a.Clamp)(L,0,g),n=(0,a.Clamp)(n,0,g),w=(0,a.Clamp)(w,0,g);const P=new X.wp(L,n,w);p.addLight(H,P,I),T+=I,x+=A}l+=y}}const M=6*(4*Math.PI)/6/T;return p.scaleInPlace(M),p.convertIncidentRadianceToIrradiance(),p.convertIrradianceToLambertianRadiance(),C.f.FromHarmonics(p)}}e._FileFaces=[new y("right",new A.xp(1,0,0),new A.xp(0,0,-1),new A.xp(0,-1,0)),new y("left",new A.xp(-1,0,0),new A.xp(0,0,1),new A.xp(0,-1,0)),new y("up",new A.xp(0,1,0),new A.xp(1,0,0),new A.xp(0,0,1)),new y("down",new A.xp(0,-1,0),new A.xp(1,0,0),new A.xp(0,0,-1)),new y("front",new A.xp(0,0,1),new A.xp(1,0,0),new A.xp(0,-1,0)),new y("back",new A.xp(0,0,-1),new A.xp(-1,0,0),new A.xp(0,-1,0))],e.MAX_HDRI_VALUE=4096,e.PRESERVE_CLAMPED_COLORS=!1},12606:(N,p,T)=>{T.r(p),T.d(p,{Dispose:()=>b,DumpData:()=>M,DumpDataAsync:()=>H,DumpFramebuffer:()=>e,DumpTools:()=>l});var A=T(12480),a=T(12190),C=T(12390),U=T(12231);let X,y=null;async function e(N,p,T,A){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",C=arguments.length>5?arguments[5]:void 0,U=arguments.length>6?arguments[6]:void 0;const X=await T.readPixels(0,0,N,p);M(N,p,new Uint8Array(X.buffer),A,a,C,!0,void 0,U)}async function H(N,p,T){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",a=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7?arguments[7]:void 0;return await new Promise((y=>{M(N,p,T,(N=>y(N)),A,a,C,U,X)}))}function M(N,p,e,H){let M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",l=arguments.length>5?arguments[5]:void 0,k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7&&void 0!==arguments[7]&&arguments[7],I=arguments.length>8?arguments[8]:void 0;(async function(){return y||(y=new Promise(((N,p)=>{let a,C=null;const y={AX:!0,depth:!1,sU:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(T.bind(T,12511)).then((e=>{let{ThinEngine:H}=e;const M=U.b.Instances.length;try{a=new OffscreenCanvas(100,100),C=new H(a,!1,y)}catch(x){var l;M<U.b.Instances.length&&(null===(l=U.b.Instances.pop())||void 0===l||l.dispose()),a=document.createElement("canvas"),C=new H(a,!1,y)}U.b.Instances.pop(),U.b.OnEnginesDisposedObservable.add((N=>{C&&N!==C&&!C.X&&0===U.b.Instances.length&&b()})),C.getCaps().parallelShaderCompile=void 0;const k=new A.c(C);T.e(52).then(T.bind(T,14826)).then((T=>{let{passPixelShader:U}=T;if(!C)return void p("Engine is not defined");const y=new A.e({kp:C,name:U.name,fragmentShader:U.shader,samplerNames:["textureSampler"]});X={canvas:a,kp:C,renderer:k,wrapper:y},N(X)}))})).catch(p)}))),await y})().then((T=>{if(T.kp.setSize(N,p,!0),e instanceof Float32Array){const N=new Uint8Array(e.length);let p=e.length;for(;p--;){const T=e[p];N[p]=Math.round(255*(0,C.Clamp)(T))}e=N}const A=T.kp.createRawTexture(e,N,p,5,!1,!k,1);T.renderer.setViewport(),T.renderer.applyEffectWrapper(T.wrapper),T.wrapper.effect._bindTexture("textureSampler",A),T.renderer.draw(),x?a.Tools.ToBlob(T.canvas,(N=>{const p=new FileReader;p.onload=N=>{const p=N.target.result;H&&H(p)},p.readAsArrayBuffer(N)}),M,I):a.Tools.EncodeScreenshotCanvasData(T.canvas,H,M,l,I),A.dispose()}))}function b(){var N;X?(X.wrapper.dispose(),X.renderer.dispose(),X.kp.dispose()):null===(N=y)||void 0===N||N.then((N=>{N.wrapper.dispose(),N.renderer.dispose(),N.kp.dispose()}));y=null,X=null}const l={DumpData:M,DumpDataAsync:H,DumpFramebuffer:e,Dispose:b};a.Tools.DumpData=M,a.Tools.DumpDataAsync=H,a.Tools.DumpFramebuffer=e},12890:(N,p,T)=>{T.d(p,{d:()=>C});var A=T(12477),a=T(12608);class C{static ExpandRGBDTexture(N){const p=N._texture;if(!p||!N.isRGBD)return;const a=p.getEngine(),C=a.getCaps(),U=p.isReady;let X=!1;C.textureHalfFloatRender&&C.textureHalfFloatLinearFiltering?(X=!0,p.type=2):C.textureFloatRender&&C.textureFloatLinearFiltering&&(X=!0,p.type=1),X&&(p.isReady=!1,p._isRGBD=!1,p.invertY=!1);const y=async()=>{const C=a.isWebGPU,U=C?1:0;p.isReady=!1,C?await T.e(42).then(T.bind(T,15352)):await T.e(35).then(T.bind(T,15355));const X=new A.d("rgbdDecode","rgbdDecode",null,null,1,null,3,a,!1,void 0,p.type,void 0,null,!1,void 0,U);X.externalTextureSamplerBinding=!0;const y=a.createRenderTargetTexture(p.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:p.samplingMode,type:p.type,format:5});X.onEffectCreatedObservable.addOnce((T=>{T.executeWhenCompiled((()=>{X.onApply=N=>{N._bindTexture("textureSampler",p),N.setFloat2("scale",1,1)},N.KN().postProcessManager.directRender([X],y,!0),a.restoreDefaultFramebuffer(),a._releaseTexture(p),X&&X.dispose(),y._swapAndDie(p),p.isReady=!0}))}))};X&&(U?y():N.onLoadObservable.addOnce(y))}static async EncodeTextureToRGBD(N,p){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return p.getEngine().isWebGPU?await T.e(43).then(T.bind(T,15366)):await T.e(36).then(T.bind(T,15363)),await(0,a.b)("rgbdEncode",N,p,A,1,5)}}}}]);