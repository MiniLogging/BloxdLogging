"use strict";(self.ex92n20nlz8=self.ex92n20nlz8||[]).push([[20,21],{13089:(I,g,b)=>{var e=b(13095),c=b(12614);c.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(c.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=e.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((I=>{this._texture._sphericalPolynomial=I,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(I){this._texture&&(this._texture._sphericalPolynomial=I)},enumerable:!0,configurable:!0})},13095:(I,g,b)=>{b.d(g,{b:()=>n});var e=b(12590),c=b(12610),z=b(12769),M=b(12597),J=b(12637);class o{constructor(I,g,b,e){this.name=I,this.worldAxisForNormal=g,this.worldAxisForFileX=b,this.worldAxisForFileY=e}}class n{static ConvertCubeMapTextureToSphericalPolynomial(I){var g;if(!I.isCube)return null;null===(g=I.EI())||void 0===g||g.getEngine().flushFramebuffer();const b=I.getSize().width,e=I.readPixels(0,void 0,void 0,!1),c=I.readPixels(1,void 0,void 0,!1);let z,M;I.isRenderTarget?(z=I.readPixels(3,void 0,void 0,!1),M=I.readPixels(2,void 0,void 0,!1)):(z=I.readPixels(2,void 0,void 0,!1),M=I.readPixels(3,void 0,void 0,!1));const J=I.readPixels(4,void 0,void 0,!1),o=I.readPixels(5,void 0,void 0,!1),n=I.gammaSpace;let G=0;return 1!=I.textureType&&2!=I.textureType||(G=1),new Promise((I=>{Promise.all([c,e,z,M,J,o]).then((g=>{let[e,c,z,M,J,o]=g;const D={size:b,right:c,left:e,up:z,down:M,front:J,back:o,format:5,type:G,gammaSpace:n};I(this.ConvertCubeMapToSphericalPolynomial(D))}))}))}static _AreaElement(I,g){return Math.atan2(I*g,Math.sqrt(I*I+g*g+1))}static ConvertCubeMapToSphericalPolynomial(I){const g=new z.e;let b=0;const e=2/I.size,o=e,n=.5*e,G=n-1;for(let z=0;z<6;z++){const D=this._FileFaces[z],p=I[D.name];let x=G;const Z=5===I.format?4:3;for(let z=0;z<I.size;z++){let k=G;for(let o=0;o<I.size;o++){const G=D.worldAxisForFileX.scale(k).add(D.worldAxisForFileY.scale(x)).add(D.worldAxisForNormal);G.normalize();const S=this._AreaElement(k-n,x-n)-this._AreaElement(k-n,x+n)-this._AreaElement(k+n,x-n)+this._AreaElement(k+n,x+n);let f=p[z*I.size*Z+o*Z+0],V=p[z*I.size*Z+o*Z+1],a=p[z*I.size*Z+o*Z+2];isNaN(f)&&(f=0),isNaN(V)&&(V=0),isNaN(a)&&(a=0),0===I.type&&(f/=255,V/=255,a/=255),I.gammaSpace&&(f=Math.pow((0,c.Clamp)(f),M.l),V=Math.pow((0,c.Clamp)(V),M.l),a=Math.pow((0,c.Clamp)(a),M.l));const v=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const I=Math.max(f,V,a);if(I>v){const g=v/I;f*=g,V*=g,a*=g}}else f=(0,c.Clamp)(f,0,v),V=(0,c.Clamp)(V,0,v),a=(0,c.Clamp)(a,0,v);const X=new J.Eg(f,V,a);g.addLight(G,X,S),b+=S,k+=e}x+=o}}const D=6*(4*Math.PI)/6/b;return g.scaleInPlace(D),g.convertIncidentRadianceToIrradiance(),g.convertIrradianceToLambertianRadiance(),z.f.FromHarmonics(g)}}n._FileFaces=[new o("right",new e.Vg(1,0,0),new e.Vg(0,0,-1),new e.Vg(0,-1,0)),new o("left",new e.Vg(-1,0,0),new e.Vg(0,0,1),new e.Vg(0,-1,0)),new o("up",new e.Vg(0,1,0),new e.Vg(1,0,0),new e.Vg(0,0,1)),new o("down",new e.Vg(0,-1,0),new e.Vg(1,0,0),new e.Vg(0,0,-1)),new o("front",new e.Vg(0,0,1),new e.Vg(1,0,0),new e.Vg(0,-1,0)),new o("back",new e.Vg(0,0,-1),new e.Vg(-1,0,0),new e.Vg(0,-1,0))],n.MAX_HDRI_VALUE=4096,n.PRESERVE_CLAMPED_COLORS=!1},12796:(I,g,b)=>{b.r(g),b.d(g,{Dispose:()=>p,DumpData:()=>D,DumpDataAsync:()=>G,DumpFramebuffer:()=>n,DumpTools:()=>x});var e=b(12697),c=b(12409),z=b(12610),M=b(12449);let J,o=null;async function n(I,g,b,e){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",z=arguments.length>5?arguments[5]:void 0,M=arguments.length>6?arguments[6]:void 0;const J=await b.readPixels(0,0,I,g);D(I,g,new Uint8Array(J.buffer),e,c,z,!0,void 0,M)}async function G(I,g,b){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",c=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],M=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7?arguments[7]:void 0;return await new Promise((o=>{D(I,g,b,(I=>o(I)),e,c,z,M,J)}))}function D(I,g,n,G){let D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",x=arguments.length>5?arguments[5]:void 0,Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7&&void 0!==arguments[7]&&arguments[7],S=arguments.length>8?arguments[8]:void 0;(async function(){return o||(o=new Promise(((I,g)=>{let c,z=null;const o={o:!0,depth:!1,ig:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(b.bind(b,12726)).then((n=>{let{ThinEngine:G}=n;const D=M.b.Instances.length;try{c=new OffscreenCanvas(100,100),z=new G(c,!1,o)}catch(k){var x;D<M.b.Instances.length&&(null===(x=M.b.Instances.pop())||void 0===x||x.dispose()),c=document.createElement("canvas"),z=new G(c,!1,o)}M.b.Instances.pop(),M.b.OnEnginesDisposedObservable.add((I=>{z&&I!==z&&!z.Z&&0===M.b.Instances.length&&p()})),z.getCaps().parallelShaderCompile=void 0;const Z=new e.d(z);b.e(52).then(b.bind(b,15040)).then((b=>{let{passPixelShader:M}=b;if(!z)return void g("Engine is not defined");const o=new e.g({kg:z,name:M.name,fragmentShader:M.shader,samplerNames:["textureSampler"]});J={canvas:c,kg:z,renderer:Z,wrapper:o},I(J)}))})).catch(g)}))),await o})().then((b=>{if(b.kg.setSize(I,g,!0),n instanceof Float32Array){const I=new Uint8Array(n.length);let g=n.length;for(;g--;){const b=n[g];I[g]=Math.round(255*(0,z.Clamp)(b))}n=I}const e=b.kg.createRawTexture(n,I,g,5,!1,!Z,1);b.renderer.setViewport(),b.renderer.applyEffectWrapper(b.wrapper),b.wrapper.effect._bindTexture("textureSampler",e),b.renderer.draw(),k?c.Tools.ToBlob(b.canvas,(I=>{const g=new FileReader;g.onload=I=>{const g=I.target.result;G&&G(g)},g.readAsArrayBuffer(I)}),D,S):c.Tools.EncodeScreenshotCanvasData(b.canvas,G,D,x,S),e.dispose()}))}function p(){var I;J?(J.wrapper.dispose(),J.renderer.dispose(),J.kg.dispose()):null===(I=o)||void 0===I||I.then((I=>{I.wrapper.dispose(),I.renderer.dispose(),I.kg.dispose()}));o=null,J=null}const x={DumpData:D,DumpDataAsync:G,DumpFramebuffer:n,Dispose:p};c.Tools.DumpData=D,c.Tools.DumpDataAsync=G,c.Tools.DumpFramebuffer=n},13081:(I,g,b)=>{b.d(g,{d:()=>z});var e=b(12690),c=b(12803);class z{static ExpandRGBDTexture(I){const g=I._texture;if(!g||!I.isRGBD)return;const c=g.getEngine(),z=c.getCaps(),M=g.isReady;let J=!1;z.textureHalfFloatRender&&z.textureHalfFloatLinearFiltering?(J=!0,g.type=2):z.textureFloatRender&&z.textureFloatLinearFiltering&&(J=!0,g.type=1),J&&(g.isReady=!1,g._isRGBD=!1,g.invertY=!1);const o=async()=>{const z=c.isWebGPU,M=z?1:0;g.isReady=!1,z?await b.e(42).then(b.bind(b,15551)):await b.e(35).then(b.bind(b,15558));const J=new e.d("rgbdDecode","rgbdDecode",null,null,1,null,3,c,!1,void 0,g.type,void 0,null,!1,void 0,M);J.externalTextureSamplerBinding=!0;const o=c.createRenderTargetTexture(g.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:g.samplingMode,type:g.type,format:5});J.onEffectCreatedObservable.addOnce((b=>{b.executeWhenCompiled((()=>{J.onApply=I=>{I._bindTexture("textureSampler",g),I.setFloat2("scale",1,1)},I.EI().postProcessManager.directRender([J],o,!0),c.restoreDefaultFramebuffer(),c._releaseTexture(g),J&&J.dispose(),o._swapAndDie(g),g.isReady=!0}))}))};J&&(M?o():I.onLoadObservable.addOnce(o))}static async EncodeTextureToRGBD(I,g){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return g.getEngine().isWebGPU?await b.e(43).then(b.bind(b,15574)):await b.e(36).then(b.bind(b,15567)),await(0,c.c)("rgbdEncode",I,g,e,1,5)}}}}]);