"use strict";(self.wj3aziuz228=self.wj3aziuz228||[]).push([[20,21],{12974:(u,R,I)=>{var B=I(12979),U=I(12499);U.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(U.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=B.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((u=>{this._texture._sphericalPolynomial=u,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(u){this._texture&&(this._texture._sphericalPolynomial=u)},enumerable:!0,configurable:!0})},12979:(u,R,I)=>{I.d(R,{d:()=>t});var B=I(12481),U=I(12491),K=I(12654),C=I(12485),D=I(12518);class s{constructor(u,R,I,B){this.name=u,this.worldAxisForNormal=R,this.worldAxisForFileX=I,this.worldAxisForFileY=B}}class t{static ConvertCubeMapTextureToSphericalPolynomial(u){var R;if(!u.isCube)return null;null===(R=u.eu())||void 0===R||R.getEngine().flushFramebuffer();const I=u.getSize().width,B=u.readPixels(0,void 0,void 0,!1),U=u.readPixels(1,void 0,void 0,!1);let K,C;u.isRenderTarget?(K=u.readPixels(3,void 0,void 0,!1),C=u.readPixels(2,void 0,void 0,!1)):(K=u.readPixels(2,void 0,void 0,!1),C=u.readPixels(3,void 0,void 0,!1));const D=u.readPixels(4,void 0,void 0,!1),s=u.readPixels(5,void 0,void 0,!1),t=u.gammaSpace;let G=0;return 1!=u.textureType&&2!=u.textureType||(G=1),new Promise((u=>{Promise.all([U,B,K,C,D,s]).then((R=>{let[B,U,K,C,D,s]=R;const S={size:I,right:U,left:B,up:K,down:C,front:D,back:s,format:5,type:G,gammaSpace:t};u(this.ConvertCubeMapToSphericalPolynomial(S))}))}))}static _AreaElement(u,R){return Math.atan2(u*R,Math.sqrt(u*u+R*R+1))}static ConvertCubeMapToSphericalPolynomial(u){const R=new K.d;let I=0;const B=2/u.size,s=B,t=.5*B,G=t-1;for(let K=0;K<6;K++){const S=this._FileFaces[K],b=u[S.name];let r=G;const P=5===u.format?4:3;for(let K=0;K<u.size;K++){let X=G;for(let s=0;s<u.size;s++){const G=S.worldAxisForFileX.scale(X).add(S.worldAxisForFileY.scale(r)).add(S.worldAxisForNormal);G.normalize();const E=this._AreaElement(X-t,r-t)-this._AreaElement(X-t,r+t)-this._AreaElement(X+t,r-t)+this._AreaElement(X+t,r+t);let z=b[K*u.size*P+s*P+0],f=b[K*u.size*P+s*P+1],T=b[K*u.size*P+s*P+2];isNaN(z)&&(z=0),isNaN(f)&&(f=0),isNaN(T)&&(T=0),0===u.type&&(z/=255,f/=255,T/=255),u.gammaSpace&&(z=Math.pow((0,U.Clamp)(z),C.l),f=Math.pow((0,U.Clamp)(f),C.l),T=Math.pow((0,U.Clamp)(T),C.l));const Q=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const u=Math.max(z,f,T);if(u>Q){const R=Q/u;z*=R,f*=R,T*=R}}else z=(0,U.Clamp)(z,0,Q),f=(0,U.Clamp)(f,0,Q),T=(0,U.Clamp)(T,0,Q);const V=new D.fR(z,f,T);R.addLight(G,V,E),I+=E,X+=B}r+=s}}const S=6*(4*Math.PI)/6/I;return R.scaleInPlace(S),R.convertIncidentRadianceToIrradiance(),R.convertIrradianceToLambertianRadiance(),K.g.FromHarmonics(R)}}t._FileFaces=[new s("right",new B.PR(1,0,0),new B.PR(0,0,-1),new B.PR(0,-1,0)),new s("left",new B.PR(-1,0,0),new B.PR(0,0,1),new B.PR(0,-1,0)),new s("up",new B.PR(0,1,0),new B.PR(1,0,0),new B.PR(0,0,1)),new s("down",new B.PR(0,-1,0),new B.PR(1,0,0),new B.PR(0,0,-1)),new s("front",new B.PR(0,0,1),new B.PR(1,0,0),new B.PR(0,-1,0)),new s("back",new B.PR(0,0,-1),new B.PR(-1,0,0),new B.PR(0,-1,0))],t.MAX_HDRI_VALUE=4096,t.PRESERVE_CLAMPED_COLORS=!1},12689:(u,R,I)=>{I.r(R),I.d(R,{Dispose:()=>b,DumpData:()=>S,DumpDataAsync:()=>G,DumpFramebuffer:()=>t,DumpTools:()=>r});var B=I(12581),U=I(12294),K=I(12491),C=I(12346);let D,s=null;async function t(u,R,I,B){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",K=arguments.length>5?arguments[5]:void 0,C=arguments.length>6?arguments[6]:void 0;const D=await I.readPixels(0,0,u,R);S(u,R,new Uint8Array(D.buffer),B,U,K,!0,void 0,C)}async function G(u,R,I){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",U=arguments.length>4?arguments[4]:void 0,K=arguments.length>5&&void 0!==arguments[5]&&arguments[5],C=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7?arguments[7]:void 0;return await new Promise((s=>{S(u,R,I,(u=>s(u)),B,U,K,C,D)}))}function S(u,R,t,G){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",r=arguments.length>5?arguments[5]:void 0,P=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]&&arguments[7],E=arguments.length>8?arguments[8]:void 0;(async function(){return s||(s=new Promise(((u,R)=>{let U,K=null;const s={KD:!0,depth:!1,RD:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(I.bind(I,12599)).then((t=>{let{ThinEngine:G}=t;const S=C.e.Instances.length;try{U=new OffscreenCanvas(100,100),K=new G(U,!1,s)}catch(X){var r;S<C.e.Instances.length&&(null===(r=C.e.Instances.pop())||void 0===r||r.dispose()),U=document.createElement("canvas"),K=new G(U,!1,s)}C.e.Instances.pop(),C.e.OnEnginesDisposedObservable.add((u=>{K&&u!==K&&!K.C&&0===C.e.Instances.length&&b()})),K.getCaps().parallelShaderCompile=void 0;const P=new B.b(K);I.e(52).then(I.bind(I,14949)).then((I=>{let{passPixelShader:C}=I;if(!K)return void R("Engine is not defined");const s=new B.c({rR:K,name:C.name,fragmentShader:C.shader,samplerNames:["textureSampler"]});D={canvas:U,rR:K,renderer:P,wrapper:s},u(D)}))})).catch(R)}))),await s})().then((I=>{if(I.rR.setSize(u,R,!0),t instanceof Float32Array){const u=new Uint8Array(t.length);let R=t.length;for(;R--;){const I=t[R];u[R]=Math.round(255*(0,K.Clamp)(I))}t=u}const B=I.rR.createRawTexture(t,u,R,5,!1,!P,1);I.renderer.setViewport(),I.renderer.applyEffectWrapper(I.wrapper),I.wrapper.effect._bindTexture("textureSampler",B),I.renderer.draw(),X?U.Tools.ToBlob(I.canvas,(u=>{const R=new FileReader;R.onload=u=>{const R=u.target.result;G&&G(R)},R.readAsArrayBuffer(u)}),S,E):U.Tools.EncodeScreenshotCanvasData(I.canvas,G,S,r,E),B.dispose()}))}function b(){var u;D?(D.wrapper.dispose(),D.renderer.dispose(),D.rR.dispose()):null===(u=s)||void 0===u||u.then((u=>{u.wrapper.dispose(),u.renderer.dispose(),u.rR.dispose()}));s=null,D=null}const r={DumpData:S,DumpDataAsync:G,DumpFramebuffer:t,Dispose:b};U.Tools.DumpData=S,U.Tools.DumpDataAsync=G,U.Tools.DumpFramebuffer=t},12964:(u,R,I)=>{I.d(R,{d:()=>K});var B=I(12575),U=I(12693);class K{static ExpandRGBDTexture(u){const R=u._texture;if(!R||!u.isRGBD)return;const U=R.getEngine(),K=U.getCaps(),C=R.isReady;let D=!1;K.textureHalfFloatRender&&K.textureHalfFloatLinearFiltering?(D=!0,R.type=2):K.textureFloatRender&&K.textureFloatLinearFiltering&&(D=!0,R.type=1),D&&(R.isReady=!1,R._isRGBD=!1,R.invertY=!1);const s=async()=>{const K=U.isWebGPU,C=K?1:0;R.isReady=!1,K?await I.e(42).then(I.bind(I,15488)):await I.e(35).then(I.bind(I,15492));const D=new B.e("rgbdDecode","rgbdDecode",null,null,1,null,3,U,!1,void 0,R.type,void 0,null,!1,void 0,C);D.externalTextureSamplerBinding=!0;const s=U.createRenderTargetTexture(R.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:R.samplingMode,type:R.type,format:5});D.onEffectCreatedObservable.addOnce((I=>{I.executeWhenCompiled((()=>{D.onApply=u=>{u._bindTexture("textureSampler",R),u.setFloat2("scale",1,1)},u.eu().postProcessManager.directRender([D],s,!0),U.restoreDefaultFramebuffer(),U._releaseTexture(R),D&&D.dispose(),s._swapAndDie(R),R.isReady=!0}))}))};D&&(C?s():u.onLoadObservable.addOnce(s))}static async EncodeTextureToRGBD(u,R){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return R.getEngine().isWebGPU?await I.e(43).then(I.bind(I,15503)):await I.e(36).then(I.bind(I,15499)),await(0,U.d)("rgbdEncode",u,R,B,1,5)}}}}]);