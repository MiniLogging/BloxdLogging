"use strict";(self.a14qw1h7fq=self.a14qw1h7fq||[]).push([[20,21],{11704:(R,J,B)=>{var Q=B(11711),h=B(11209);h.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(h.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=Q.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((R=>{this._texture._sphericalPolynomial=R,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(R){this._texture&&(this._texture._sphericalPolynomial=R)},enumerable:!0,configurable:!0})},11711:(R,J,B)=>{B.d(J,{d:()=>e});var Q=B(11186),h=B(11201),y=B(11370),N=B(11189),r=B(11224);class q{constructor(R,J,B,Q){this.name=R,this.worldAxisForNormal=J,this.worldAxisForFileX=B,this.worldAxisForFileY=Q}}class e{static ConvertCubeMapTextureToSphericalPolynomial(R){var J;if(!R.isCube)return null;null===(J=R.IR())||void 0===J||J.getEngine().flushFramebuffer();const B=R.getSize().width,Q=R.readPixels(0,void 0,void 0,!1),h=R.readPixels(1,void 0,void 0,!1);let y,N;R.isRenderTarget?(y=R.readPixels(3,void 0,void 0,!1),N=R.readPixels(2,void 0,void 0,!1)):(y=R.readPixels(2,void 0,void 0,!1),N=R.readPixels(3,void 0,void 0,!1));const r=R.readPixels(4,void 0,void 0,!1),q=R.readPixels(5,void 0,void 0,!1),e=R.gammaSpace;let D=0;return 1!=R.textureType&&2!=R.textureType||(D=1),new Promise((R=>{Promise.all([h,Q,y,N,r,q]).then((J=>{let[Q,h,y,N,r,q]=J;const l={size:B,right:h,left:Q,up:y,down:N,front:r,back:q,format:5,type:D,gammaSpace:e};R(this.ConvertCubeMapToSphericalPolynomial(l))}))}))}static _AreaElement(R,J){return Math.atan2(R*J,Math.sqrt(R*R+J*J+1))}static ConvertCubeMapToSphericalPolynomial(R){const J=new y.b;let B=0;const Q=2/R.size,q=Q,e=.5*Q,D=e-1;for(let y=0;y<6;y++){const l=this._FileFaces[y],E=R[l.name];let O=D;const n=5===R.format?4:3;for(let y=0;y<R.size;y++){let P=D;for(let q=0;q<R.size;q++){const D=l.worldAxisForFileX.scale(P).add(l.worldAxisForFileY.scale(O)).add(l.worldAxisForNormal);D.normalize();const A=this._AreaElement(P-e,O-e)-this._AreaElement(P-e,O+e)-this._AreaElement(P+e,O-e)+this._AreaElement(P+e,O+e);let u=E[y*R.size*n+q*n+0],S=E[y*R.size*n+q*n+1],f=E[y*R.size*n+q*n+2];isNaN(u)&&(u=0),isNaN(S)&&(S=0),isNaN(f)&&(f=0),0===R.type&&(u/=255,S/=255,f/=255),R.gammaSpace&&(u=Math.pow((0,h.Clamp)(u),N.i),S=Math.pow((0,h.Clamp)(S),N.i),f=Math.pow((0,h.Clamp)(f),N.i));const a=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const R=Math.max(u,S,f);if(R>a){const J=a/R;u*=J,S*=J,f*=J}}else u=(0,h.Clamp)(u,0,a),S=(0,h.Clamp)(S,0,a),f=(0,h.Clamp)(f,0,a);const s=new r.SJ(u,S,f);J.addLight(D,s,A),B+=A,P+=Q}O+=q}}const l=6*(4*Math.PI)/6/B;return J.scaleInPlace(l),J.convertIncidentRadianceToIrradiance(),J.convertIrradianceToLambertianRadiance(),y.d.FromHarmonics(J)}}e._FileFaces=[new q("right",new Q.nJ(1,0,0),new Q.nJ(0,0,-1),new Q.nJ(0,-1,0)),new q("left",new Q.nJ(-1,0,0),new Q.nJ(0,0,1),new Q.nJ(0,-1,0)),new q("up",new Q.nJ(0,1,0),new Q.nJ(1,0,0),new Q.nJ(0,0,1)),new q("down",new Q.nJ(0,-1,0),new Q.nJ(1,0,0),new Q.nJ(0,0,-1)),new q("front",new Q.nJ(0,0,1),new Q.nJ(1,0,0),new Q.nJ(0,-1,0)),new q("back",new Q.nJ(0,0,-1),new Q.nJ(-1,0,0),new Q.nJ(0,-1,0))],e.MAX_HDRI_VALUE=4096,e.PRESERVE_CLAMPED_COLORS=!1},11402:(R,J,B)=>{B.r(J),B.d(J,{Dispose:()=>E,DumpData:()=>l,DumpDataAsync:()=>D,DumpFramebuffer:()=>e,DumpTools:()=>O});var Q=B(11294),h=B(11030),y=B(11201),N=B(11065);let r,q=null;async function e(R,J,B,Q){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",y=arguments.length>5?arguments[5]:void 0,N=arguments.length>6?arguments[6]:void 0;const r=await B.readPixels(0,0,R,J);l(R,J,new Uint8Array(r.buffer),Q,h,y,!0,void 0,N)}async function D(R,J,B){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",h=arguments.length>4?arguments[4]:void 0,y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],N=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7?arguments[7]:void 0;return await new Promise((q=>{l(R,J,B,(R=>q(R)),Q,h,y,N,r)}))}function l(R,J,e,D){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",O=arguments.length>5?arguments[5]:void 0,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7&&void 0!==arguments[7]&&arguments[7],A=arguments.length>8?arguments[8]:void 0;(async function(){return q||(q=new Promise(((R,J)=>{let h,y=null;const q={kh:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(B.bind(B,11317)).then((e=>{let{ThinEngine:D}=e;const l=N.e.Instances.length;try{h=new OffscreenCanvas(100,100),y=new D(h,!1,q)}catch(P){var O;l<N.e.Instances.length&&(null===(O=N.e.Instances.pop())||void 0===O||O.dispose()),h=document.createElement("canvas"),y=new D(h,!1,q)}N.e.Instances.pop(),N.e.OnEnginesDisposedObservable.add((R=>{y&&R!==y&&!y.D&&0===N.e.Instances.length&&E()})),y.getCaps().parallelShaderCompile=void 0;const n=new Q.e(y);B.e(52).then(B.bind(B,13677)).then((B=>{let{passPixelShader:N}=B;if(!y)return void J("Engine is not defined");const q=new Q.f({OJ:y,name:N.name,fragmentShader:N.shader,samplerNames:["textureSampler"]});r={canvas:h,OJ:y,renderer:n,wrapper:q},R(r)}))})).catch(J)}))),await q})().then((B=>{if(B.OJ.setSize(R,J,!0),e instanceof Float32Array){const R=new Uint8Array(e.length);let J=e.length;for(;J--;){const B=e[J];R[J]=Math.round(255*(0,y.Clamp)(B))}e=R}const Q=B.OJ.createRawTexture(e,R,J,5,!1,!n,1);B.renderer.setViewport(),B.renderer.applyEffectWrapper(B.wrapper),B.wrapper.effect._bindTexture("textureSampler",Q),B.renderer.draw(),P?h.Tools.ToBlob(B.canvas,(R=>{const J=new FileReader;J.onload=R=>{const J=R.target.result;D&&D(J)},J.readAsArrayBuffer(R)}),l,A):h.Tools.EncodeScreenshotCanvasData(B.canvas,D,l,O,A),Q.dispose()}))}function E(){var R;r?(r.wrapper.dispose(),r.renderer.dispose(),r.OJ.dispose()):null===(R=q)||void 0===R||R.then((R=>{R.wrapper.dispose(),R.renderer.dispose(),R.OJ.dispose()}));q=null,r=null}const O={DumpData:l,DumpDataAsync:D,DumpFramebuffer:e,Dispose:E};h.Tools.DumpData=l,h.Tools.DumpDataAsync=D,h.Tools.DumpFramebuffer=e},11694:(R,J,B)=>{B.d(J,{e:()=>y});var Q=B(11291),h=B(11408);class y{static ExpandRGBDTexture(R){const J=R._texture;if(!J||!R.isRGBD)return;const h=J.getEngine(),y=h.getCaps(),N=J.isReady;let r=!1;y.textureHalfFloatRender&&y.textureHalfFloatLinearFiltering?(r=!0,J.type=2):y.textureFloatRender&&y.textureFloatLinearFiltering&&(r=!0,J.type=1),r&&(J.isReady=!1,J._isRGBD=!1,J.invertY=!1);const q=async()=>{const y=h.isWebGPU,N=y?1:0;J.isReady=!1,y?await B.e(42).then(B.bind(B,14216)):await B.e(35).then(B.bind(B,14219));const r=new Q.d("rgbdDecode","rgbdDecode",null,null,1,null,3,h,!1,void 0,J.type,void 0,null,!1,void 0,N);r.externalTextureSamplerBinding=!0;const q=h.createRenderTargetTexture(J.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:J.samplingMode,type:J.type,format:5});r.onEffectCreatedObservable.addOnce((B=>{B.executeWhenCompiled((()=>{r.onApply=R=>{R._bindTexture("textureSampler",J),R.setFloat2("scale",1,1)},R.IR().postProcessManager.directRender([r],q,!0),h.restoreDefaultFramebuffer(),h._releaseTexture(J),r&&r.dispose(),q._swapAndDie(J),J.isReady=!0}))}))};r&&(N?q():R.onLoadObservable.addOnce(q))}static async EncodeTextureToRGBD(R,J){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return J.getEngine().isWebGPU?await B.e(43).then(B.bind(B,14223)):await B.e(36).then(B.bind(B,14221)),await(0,h.e)("rgbdEncode",R,J,Q,1,5)}}}}]);