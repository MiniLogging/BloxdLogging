"use strict";(self.agop5zpabxv=self.agop5zpabxv||[]).push([[20,21],{12848:(H,u,J)=>{var O=J(12850),U=J(12358);U.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(U.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=O.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((H=>{this._texture._sphericalPolynomial=H,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(H){this._texture&&(this._texture._sphericalPolynomial=H)},enumerable:!0,configurable:!0})},12850:(H,u,J)=>{J.d(u,{b:()=>b});var O=J(12338),U=J(12349),h=J(12512),w=J(12343),g=J(12379);class B{constructor(H,u,J,O){this.name=H,this.worldAxisForNormal=u,this.worldAxisForFileX=J,this.worldAxisForFileY=O}}class b{static ConvertCubeMapTextureToSphericalPolynomial(H){var u;if(!H.isCube)return null;null===(u=H.ZH())||void 0===u||u.getEngine().flushFramebuffer();const J=H.getSize().width,O=H.readPixels(0,void 0,void 0,!1),U=H.readPixels(1,void 0,void 0,!1);let h,w;H.isRenderTarget?(h=H.readPixels(3,void 0,void 0,!1),w=H.readPixels(2,void 0,void 0,!1)):(h=H.readPixels(2,void 0,void 0,!1),w=H.readPixels(3,void 0,void 0,!1));const g=H.readPixels(4,void 0,void 0,!1),B=H.readPixels(5,void 0,void 0,!1),b=H.gammaSpace;let d=0;return 1!=H.textureType&&2!=H.textureType||(d=1),new Promise((H=>{Promise.all([U,O,h,w,g,B]).then((u=>{let[O,U,h,w,g,B]=u;const G={size:J,right:U,left:O,up:h,down:w,front:g,back:B,format:5,type:d,gammaSpace:b};H(this.ConvertCubeMapToSphericalPolynomial(G))}))}))}static _AreaElement(H,u){return Math.atan2(H*u,Math.sqrt(H*H+u*u+1))}static ConvertCubeMapToSphericalPolynomial(H){const u=new h.b;let J=0;const O=2/H.size,B=O,b=.5*O,d=b-1;for(let h=0;h<6;h++){const G=this._FileFaces[h],P=H[G.name];let mH=d;const l=5===H.format?4:3;for(let h=0;h<H.size;h++){let r=d;for(let B=0;B<H.size;B++){const d=G.worldAxisForFileX.scale(r).add(G.worldAxisForFileY.scale(mH)).add(G.worldAxisForNormal);d.normalize();const p=this._AreaElement(r-b,mH-b)-this._AreaElement(r-b,mH+b)-this._AreaElement(r+b,mH-b)+this._AreaElement(r+b,mH+b);let a=P[h*H.size*l+B*l+0],k=P[h*H.size*l+B*l+1],C=P[h*H.size*l+B*l+2];isNaN(a)&&(a=0),isNaN(k)&&(k=0),isNaN(C)&&(C=0),0===H.type&&(a/=255,k/=255,C/=255),H.gammaSpace&&(a=Math.pow((0,U.Clamp)(a),w.n),k=Math.pow((0,U.Clamp)(k),w.n),C=Math.pow((0,U.Clamp)(C),w.n));const j=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const H=Math.max(a,k,C);if(H>j){const u=j/H;a*=u,k*=u,C*=u}}else a=(0,U.Clamp)(a,0,j),k=(0,U.Clamp)(k,0,j),C=(0,U.Clamp)(C,0,j);const M=new g.ku(a,k,C);u.addLight(d,M,p),J+=p,r+=O}mH+=B}}const G=6*(4*Math.PI)/6/J;return u.scaleInPlace(G),u.convertIncidentRadianceToIrradiance(),u.convertIrradianceToLambertianRadiance(),h.e.FromHarmonics(u)}}b._FileFaces=[new B("right",new O.lu(1,0,0),new O.lu(0,0,-1),new O.lu(0,-1,0)),new B("left",new O.lu(-1,0,0),new O.lu(0,0,1),new O.lu(0,-1,0)),new B("up",new O.lu(0,1,0),new O.lu(1,0,0),new O.lu(0,0,1)),new B("down",new O.lu(0,-1,0),new O.lu(1,0,0),new O.lu(0,0,-1)),new B("front",new O.lu(0,0,1),new O.lu(1,0,0),new O.lu(0,-1,0)),new B("back",new O.lu(0,0,-1),new O.lu(-1,0,0),new O.lu(0,-1,0))],b.MAX_HDRI_VALUE=4096,b.PRESERVE_CLAMPED_COLORS=!1},12546:(H,u,J)=>{J.r(u),J.d(u,{Dispose:()=>P,DumpData:()=>G,DumpDataAsync:()=>d,DumpFramebuffer:()=>b,DumpTools:()=>mH});var O=J(12439),U=J(12171),h=J(12349),w=J(12203);let g,B=null;async function b(H,u,J,O){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",h=arguments.length>5?arguments[5]:void 0,w=arguments.length>6?arguments[6]:void 0;const g=await J.readPixels(0,0,H,u);G(H,u,new Uint8Array(g.buffer),O,U,h,!0,void 0,w)}async function d(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",U=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7?arguments[7]:void 0;return await new Promise((B=>{G(H,u,J,(H=>B(H)),O,U,h,w,g)}))}function G(H,u,b,d){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",mH=arguments.length>5?arguments[5]:void 0,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7&&void 0!==arguments[7]&&arguments[7],p=arguments.length>8?arguments[8]:void 0;(async function(){return B||(B=new Promise(((H,u)=>{let U,h=null;const B={Nh:!0,depth:!1,Rh:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(J.bind(J,12457)).then((b=>{let{ThinEngine:d}=b;const G=w.e.Instances.length;try{U=new OffscreenCanvas(100,100),h=new d(U,!1,B)}catch(r){var mH;G<w.e.Instances.length&&(null===(mH=w.e.Instances.pop())||void 0===mH||mH.dispose()),U=document.createElement("canvas"),h=new d(U,!1,B)}w.e.Instances.pop(),w.e.OnEnginesDisposedObservable.add((H=>{h&&H!==h&&!h.B&&0===w.e.Instances.length&&P()})),h.getCaps().parallelShaderCompile=void 0;const l=new O.e(h);J.e(52).then(J.bind(J,14792)).then((J=>{let{passPixelShader:w}=J;if(!h)return void u("Engine is not defined");const B=new O.g({mJ:h,name:w.name,fragmentShader:w.shader,samplerNames:["textureSampler"]});g={canvas:U,mJ:h,renderer:l,wrapper:B},H(g)}))})).catch(u)}))),await B})().then((J=>{if(J.mJ.setSize(H,u,!0),b instanceof Float32Array){const H=new Uint8Array(b.length);let u=b.length;for(;u--;){const J=b[u];H[u]=Math.round(255*(0,h.Clamp)(J))}b=H}const O=J.mJ.createRawTexture(b,H,u,5,!1,!l,1);J.renderer.setViewport(),J.renderer.applyEffectWrapper(J.wrapper),J.wrapper.effect._bindTexture("textureSampler",O),J.renderer.draw(),r?U.Tools.ToBlob(J.canvas,(H=>{const u=new FileReader;u.onload=H=>{const u=H.target.result;d&&d(u)},u.readAsArrayBuffer(H)}),G,p):U.Tools.EncodeScreenshotCanvasData(J.canvas,d,G,mH,p),O.dispose()}))}function P(){var H;g?(g.wrapper.dispose(),g.renderer.dispose(),g.mJ.dispose()):null===(H=B)||void 0===H||H.then((H=>{H.wrapper.dispose(),H.renderer.dispose(),H.mJ.dispose()}));B=null,g=null}const mH={DumpData:G,DumpDataAsync:d,DumpFramebuffer:b,Dispose:P};U.Tools.DumpData=G,U.Tools.DumpDataAsync=d,U.Tools.DumpFramebuffer=b},12831:(H,u,J)=>{J.d(u,{b:()=>h});var O=J(12434),U=J(12555);class h{static ExpandRGBDTexture(H){const u=H._texture;if(!u||!H.isRGBD)return;const U=u.getEngine(),h=U.getCaps(),w=u.isReady;let g=!1;h.textureHalfFloatRender&&h.textureHalfFloatLinearFiltering?(g=!0,u.type=2):h.textureFloatRender&&h.textureFloatLinearFiltering&&(g=!0,u.type=1),g&&(u.isReady=!1,u._isRGBD=!1,u.invertY=!1);const B=async()=>{const h=U.isWebGPU,w=h?1:0;u.isReady=!1,h?await J.e(42).then(J.bind(J,15327)):await J.e(35).then(J.bind(J,15334));const g=new O.e("rgbdDecode","rgbdDecode",null,null,1,null,3,U,!1,void 0,u.type,void 0,null,!1,void 0,w);g.externalTextureSamplerBinding=!0;const B=U.createRenderTargetTexture(u.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:u.samplingMode,type:u.type,format:5});g.onEffectCreatedObservable.addOnce((J=>{J.executeWhenCompiled((()=>{g.onApply=H=>{H._bindTexture("textureSampler",u),H.setFloat2("scale",1,1)},H.ZH().postProcessManager.directRender([g],B,!0),U.restoreDefaultFramebuffer(),U._releaseTexture(u),g&&g.dispose(),B._swapAndDie(u),u.isReady=!0}))}))};g&&(w?B():H.onLoadObservable.addOnce(B))}static async EncodeTextureToRGBD(H,u){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return u.getEngine().isWebGPU?await J.e(43).then(J.bind(J,15343)):await J.e(36).then(J.bind(J,15339)),await(0,U.e)("rgbdEncode",H,u,O,1,5)}}}}]);