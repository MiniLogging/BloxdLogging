"use strict";(self.pp3k1ov3ibi=self.pp3k1ov3ibi||[]).push([[20,21],{12880:(M,Z,P)=>{var x=P(12888),c=P(12390);c.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(c.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=x.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((M=>{this._texture._sphericalPolynomial=M,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(M){this._texture&&(this._texture._sphericalPolynomial=M)},enumerable:!0,configurable:!0})},12888:(M,Z,P)=>{P.d(Z,{e:()=>K});var x=P(12373),c=P(12387),w=P(12549),v=P(12377),G=P(12406);class mM{constructor(M,Z,P,x){this.name=M,this.worldAxisForNormal=Z,this.worldAxisForFileX=P,this.worldAxisForFileY=x}}class K{static ConvertCubeMapTextureToSphericalPolynomial(M){var Z;if(!M.isCube)return null;null===(Z=M.DM())||void 0===Z||Z.getEngine().flushFramebuffer();const P=M.getSize().width,x=M.readPixels(0,void 0,void 0,!1),c=M.readPixels(1,void 0,void 0,!1);let w,v;M.isRenderTarget?(w=M.readPixels(3,void 0,void 0,!1),v=M.readPixels(2,void 0,void 0,!1)):(w=M.readPixels(2,void 0,void 0,!1),v=M.readPixels(3,void 0,void 0,!1));const G=M.readPixels(4,void 0,void 0,!1),mM=M.readPixels(5,void 0,void 0,!1),K=M.gammaSpace;let d=0;return 1!=M.textureType&&2!=M.textureType||(d=1),new Promise((M=>{Promise.all([c,x,w,v,G,mM]).then((Z=>{let[x,c,w,v,G,mM]=Z;const O={size:P,right:c,left:x,up:w,down:v,front:G,back:mM,format:5,type:d,gammaSpace:K};M(this.ConvertCubeMapToSphericalPolynomial(O))}))}))}static _AreaElement(M,Z){return Math.atan2(M*Z,Math.sqrt(M*M+Z*Z+1))}static ConvertCubeMapToSphericalPolynomial(M){const Z=new w.d;let P=0;const x=2/M.size,mM=x,K=.5*x,d=K-1;for(let w=0;w<6;w++){const O=this._FileFaces[w],H=M[O.name];let j=d;const B=5===M.format?4:3;for(let w=0;w<M.size;w++){let U=d;for(let mM=0;mM<M.size;mM++){const d=O.worldAxisForFileX.scale(U).add(O.worldAxisForFileY.scale(j)).add(O.worldAxisForNormal);d.normalize();const n=this._AreaElement(U-K,j-K)-this._AreaElement(U-K,j+K)-this._AreaElement(U+K,j-K)+this._AreaElement(U+K,j+K);let L=H[w*M.size*B+mM*B+0],u=H[w*M.size*B+mM*B+1],N=H[w*M.size*B+mM*B+2];isNaN(L)&&(L=0),isNaN(u)&&(u=0),isNaN(N)&&(N=0),0===M.type&&(L/=255,u/=255,N/=255),M.gammaSpace&&(L=Math.pow((0,c.Clamp)(L),v.g),u=Math.pow((0,c.Clamp)(u),v.g),N=Math.pow((0,c.Clamp)(N),v.g));const J=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const M=Math.max(L,u,N);if(M>J){const Z=J/M;L*=Z,u*=Z,N*=Z}}else L=(0,c.Clamp)(L,0,J),u=(0,c.Clamp)(u,0,J),N=(0,c.Clamp)(N,0,J);const t=new G.uZ(L,u,N);Z.addLight(d,t,n),P+=n,U+=x}j+=mM}}const O=6*(4*Math.PI)/6/P;return Z.scaleInPlace(O),Z.convertIncidentRadianceToIrradiance(),Z.convertIrradianceToLambertianRadiance(),w.h.FromHarmonics(Z)}}K._FileFaces=[new mM("right",new x.BZ(1,0,0),new x.BZ(0,0,-1),new x.BZ(0,-1,0)),new mM("left",new x.BZ(-1,0,0),new x.BZ(0,0,1),new x.BZ(0,-1,0)),new mM("up",new x.BZ(0,1,0),new x.BZ(1,0,0),new x.BZ(0,0,1)),new mM("down",new x.BZ(0,-1,0),new x.BZ(1,0,0),new x.BZ(0,0,-1)),new mM("front",new x.BZ(0,0,1),new x.BZ(1,0,0),new x.BZ(0,-1,0)),new mM("back",new x.BZ(0,0,-1),new x.BZ(-1,0,0),new x.BZ(0,-1,0))],K.MAX_HDRI_VALUE=4096,K.PRESERVE_CLAMPED_COLORS=!1},12579:(M,Z,P)=>{P.r(Z),P.d(Z,{Dispose:()=>H,DumpData:()=>O,DumpDataAsync:()=>d,DumpFramebuffer:()=>K,DumpTools:()=>j});var x=P(12464),c=P(12175),w=P(12387),v=P(12225);let G,mM=null;async function K(M,Z,P,x){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",w=arguments.length>5?arguments[5]:void 0,v=arguments.length>6?arguments[6]:void 0;const G=await P.readPixels(0,0,M,Z);O(M,Z,new Uint8Array(G.buffer),x,c,w,!0,void 0,v)}async function d(M,Z,P){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",c=arguments.length>4?arguments[4]:void 0,w=arguments.length>5&&void 0!==arguments[5]&&arguments[5],v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7?arguments[7]:void 0;return await new Promise((mM=>{O(M,Z,P,(M=>mM(M)),x,c,w,v,G)}))}function O(M,Z,K,d){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",j=arguments.length>5?arguments[5]:void 0,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7],n=arguments.length>8?arguments[8]:void 0;(async function(){return mM||(mM=new Promise(((M,Z)=>{let c,w=null;const mM={o:!0,depth:!1,Kc:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(P.bind(P,12490)).then((K=>{let{ThinEngine:d}=K;const O=v.b.Instances.length;try{c=new OffscreenCanvas(100,100),w=new d(c,!1,mM)}catch(U){var j;O<v.b.Instances.length&&(null===(j=v.b.Instances.pop())||void 0===j||j.dispose()),c=document.createElement("canvas"),w=new d(c,!1,mM)}v.b.Instances.pop(),v.b.OnEnginesDisposedObservable.add((M=>{w&&M!==w&&!w.K&&0===v.b.Instances.length&&H()})),w.getCaps().parallelShaderCompile=void 0;const B=new x.d(w);P.e(52).then(P.bind(P,14881)).then((P=>{let{passPixelShader:v}=P;if(!w)return void Z("Engine is not defined");const mM=new x.f({jZ:w,name:v.name,fragmentShader:v.shader,samplerNames:["textureSampler"]});G={canvas:c,jZ:w,renderer:B,wrapper:mM},M(G)}))})).catch(Z)}))),await mM})().then((P=>{if(P.jZ.setSize(M,Z,!0),K instanceof Float32Array){const M=new Uint8Array(K.length);let Z=K.length;for(;Z--;){const P=K[Z];M[Z]=Math.round(255*(0,w.Clamp)(P))}K=M}const x=P.jZ.createRawTexture(K,M,Z,5,!1,!B,1);P.renderer.setViewport(),P.renderer.applyEffectWrapper(P.wrapper),P.wrapper.effect._bindTexture("textureSampler",x),P.renderer.draw(),U?c.Tools.ToBlob(P.canvas,(M=>{const Z=new FileReader;Z.onload=M=>{const Z=M.target.result;d&&d(Z)},Z.readAsArrayBuffer(M)}),O,n):c.Tools.EncodeScreenshotCanvasData(P.canvas,d,O,j,n),x.dispose()}))}function H(){var M;G?(G.wrapper.dispose(),G.renderer.dispose(),G.jZ.dispose()):null===(M=mM)||void 0===M||M.then((M=>{M.wrapper.dispose(),M.renderer.dispose(),M.jZ.dispose()}));mM=null,G=null}const j={DumpData:O,DumpDataAsync:d,DumpFramebuffer:K,Dispose:H};c.Tools.DumpData=O,c.Tools.DumpDataAsync=d,c.Tools.DumpFramebuffer=K},12868:(M,Z,P)=>{P.d(Z,{c:()=>w});var x=P(12462),c=P(12581);class w{static ExpandRGBDTexture(M){const Z=M._texture;if(!Z||!M.isRGBD)return;const c=Z.getEngine(),w=c.getCaps(),v=Z.isReady;let G=!1;w.textureHalfFloatRender&&w.textureHalfFloatLinearFiltering?(G=!0,Z.type=2):w.textureFloatRender&&w.textureFloatLinearFiltering&&(G=!0,Z.type=1),G&&(Z.isReady=!1,Z._isRGBD=!1,Z.invertY=!1);const mM=async()=>{const w=c.isWebGPU,v=w?1:0;Z.isReady=!1,w?await P.e(42).then(P.bind(P,15415)):await P.e(35).then(P.bind(P,15423));const G=new x.e("rgbdDecode","rgbdDecode",null,null,1,null,3,c,!1,void 0,Z.type,void 0,null,!1,void 0,v);G.externalTextureSamplerBinding=!0;const mM=c.createRenderTargetTexture(Z.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:Z.samplingMode,type:Z.type,format:5});G.onEffectCreatedObservable.addOnce((P=>{P.executeWhenCompiled((()=>{G.onApply=M=>{M._bindTexture("textureSampler",Z),M.setFloat2("scale",1,1)},M.DM().postProcessManager.directRender([G],mM,!0),c.restoreDefaultFramebuffer(),c._releaseTexture(Z),G&&G.dispose(),mM._swapAndDie(Z),Z.isReady=!0}))}))};G&&(v?mM():M.onLoadObservable.addOnce(mM))}static async EncodeTextureToRGBD(M,Z){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Z.getEngine().isWebGPU?await P.e(43).then(P.bind(P,15428)):await P.e(36).then(P.bind(P,15426)),await(0,c.c)("rgbdEncode",M,Z,x,1,5)}}}}]);