"use strict";(self.vfdo5lmva5i=self.vfdo5lmva5i||[]).push([[20,21],{12232:(w,o,H)=>{var h=H(12239),E=H(11734);E.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(E.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=h.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((w=>{this._texture._sphericalPolynomial=w,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(w){this._texture&&(this._texture._sphericalPolynomial=w)},enumerable:!0,configurable:!0})},12239:(w,o,H)=>{H.d(o,{b:()=>L});var h=H(11720),E=H(11729),e=H(11902),D=H(11722),t=H(11757);class X{constructor(w,o,H,h){this.name=w,this.worldAxisForNormal=o,this.worldAxisForFileX=H,this.worldAxisForFileY=h}}class L{static ConvertCubeMapTextureToSphericalPolynomial(w){var o;if(!w.isCube)return null;null===(o=w.Ow())||void 0===o||o.getEngine().flushFramebuffer();const H=w.getSize().width,h=w.readPixels(0,void 0,void 0,!1),E=w.readPixels(1,void 0,void 0,!1);let e,D;w.isRenderTarget?(e=w.readPixels(3,void 0,void 0,!1),D=w.readPixels(2,void 0,void 0,!1)):(e=w.readPixels(2,void 0,void 0,!1),D=w.readPixels(3,void 0,void 0,!1));const t=w.readPixels(4,void 0,void 0,!1),X=w.readPixels(5,void 0,void 0,!1),L=w.gammaSpace;let A=0;return 1!=w.textureType&&2!=w.textureType||(A=1),new Promise((w=>{Promise.all([E,h,e,D,t,X]).then((o=>{let[h,E,e,D,t,X]=o;const y={size:H,right:E,left:h,up:e,down:D,front:t,back:X,format:5,type:A,gammaSpace:L};w(this.ConvertCubeMapToSphericalPolynomial(y))}))}))}static _AreaElement(w,o){return Math.atan2(w*o,Math.sqrt(w*w+o*o+1))}static ConvertCubeMapToSphericalPolynomial(w){const o=new e.d;let H=0;const h=2/w.size,X=h,L=.5*h,A=L-1;for(let e=0;e<6;e++){const y=this._FileFaces[e],z=w[y.name];let C=A;const Q=5===w.format?4:3;for(let e=0;e<w.size;e++){let M=A;for(let X=0;X<w.size;X++){const A=y.worldAxisForFileX.scale(M).add(y.worldAxisForFileY.scale(C)).add(y.worldAxisForNormal);A.normalize();const i=this._AreaElement(M-L,C-L)-this._AreaElement(M-L,C+L)-this._AreaElement(M+L,C-L)+this._AreaElement(M+L,C+L);let s=z[e*w.size*Q+X*Q+0],V=z[e*w.size*Q+X*Q+1],r=z[e*w.size*Q+X*Q+2];isNaN(s)&&(s=0),isNaN(V)&&(V=0),isNaN(r)&&(r=0),0===w.type&&(s/=255,V/=255,r/=255),w.gammaSpace&&(s=Math.pow((0,E.Clamp)(s),D.g),V=Math.pow((0,E.Clamp)(V),D.g),r=Math.pow((0,E.Clamp)(r),D.g));const k=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const w=Math.max(s,V,r);if(w>k){const o=k/w;s*=o,V*=o,r*=o}}else s=(0,E.Clamp)(s,0,k),V=(0,E.Clamp)(V,0,k),r=(0,E.Clamp)(r,0,k);const P=new t.ko(s,V,r);o.addLight(A,P,i),H+=i,M+=h}C+=X}}const y=6*(4*Math.PI)/6/H;return o.scaleInPlace(y),o.convertIncidentRadianceToIrradiance(),o.convertIrradianceToLambertianRadiance(),e.h.FromHarmonics(o)}}L._FileFaces=[new X("right",new h.io(1,0,0),new h.io(0,0,-1),new h.io(0,-1,0)),new X("left",new h.io(-1,0,0),new h.io(0,0,1),new h.io(0,-1,0)),new X("up",new h.io(0,1,0),new h.io(1,0,0),new h.io(0,0,1)),new X("down",new h.io(0,-1,0),new h.io(1,0,0),new h.io(0,0,-1)),new X("front",new h.io(0,0,1),new h.io(1,0,0),new h.io(0,-1,0)),new X("back",new h.io(0,0,-1),new h.io(-1,0,0),new h.io(0,-1,0))],L.MAX_HDRI_VALUE=4096,L.PRESERVE_CLAMPED_COLORS=!1},11936:(w,o,H)=>{H.r(o),H.d(o,{Dispose:()=>z,DumpData:()=>y,DumpDataAsync:()=>A,DumpFramebuffer:()=>L,DumpTools:()=>C});var h=H(11817),E=H(11531),e=H(11729),D=H(11571);let t,X=null;async function L(w,o,H,h){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",e=arguments.length>5?arguments[5]:void 0,D=arguments.length>6?arguments[6]:void 0;const t=await H.readPixels(0,0,w,o);y(w,o,new Uint8Array(t.buffer),h,E,e,!0,void 0,D)}async function A(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",E=arguments.length>4?arguments[4]:void 0,e=arguments.length>5&&void 0!==arguments[5]&&arguments[5],D=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7?arguments[7]:void 0;return await new Promise((X=>{y(w,o,H,(w=>X(w)),h,E,e,D,t)}))}function y(w,o,L,A){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",C=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],M=arguments.length>7&&void 0!==arguments[7]&&arguments[7],i=arguments.length>8?arguments[8]:void 0;(async function(){return X||(X=new Promise(((w,o)=>{let E,e=null;const X={Ee:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(H.bind(H,11841)).then((L=>{let{ThinEngine:A}=L;const y=D.e.Instances.length;try{E=new OffscreenCanvas(100,100),e=new A(E,!1,X)}catch(M){var C;y<D.e.Instances.length&&(null===(C=D.e.Instances.pop())||void 0===C||C.dispose()),E=document.createElement("canvas"),e=new A(E,!1,X)}D.e.Instances.pop(),D.e.OnEnginesDisposedObservable.add((w=>{e&&w!==e&&!e.A&&0===D.e.Instances.length&&z()})),e.getCaps().parallelShaderCompile=void 0;const Q=new h.c(e);H.e(52).then(H.bind(H,14283)).then((H=>{let{passPixelShader:D}=H;if(!e)return void o("Engine is not defined");const X=new h.d({Mo:e,name:D.name,fragmentShader:D.shader,samplerNames:["textureSampler"]});t={canvas:E,Mo:e,renderer:Q,wrapper:X},w(t)}))})).catch(o)}))),await X})().then((H=>{if(H.Mo.setSize(w,o,!0),L instanceof Float32Array){const w=new Uint8Array(L.length);let o=L.length;for(;o--;){const H=L[o];w[o]=Math.round(255*(0,e.Clamp)(H))}L=w}const h=H.Mo.createRawTexture(L,w,o,5,!1,!Q,1);H.renderer.setViewport(),H.renderer.applyEffectWrapper(H.wrapper),H.wrapper.effect._bindTexture("textureSampler",h),H.renderer.draw(),M?E.Tools.ToBlob(H.canvas,(w=>{const o=new FileReader;o.onload=w=>{const o=w.target.result;A&&A(o)},o.readAsArrayBuffer(w)}),y,i):E.Tools.EncodeScreenshotCanvasData(H.canvas,A,y,C,i),h.dispose()}))}function z(){var w;t?(t.wrapper.dispose(),t.renderer.dispose(),t.Mo.dispose()):null===(w=X)||void 0===w||w.then((w=>{w.wrapper.dispose(),w.renderer.dispose(),w.Mo.dispose()}));X=null,t=null}const C={DumpData:y,DumpDataAsync:A,DumpFramebuffer:L,Dispose:z};E.Tools.DumpData=y,E.Tools.DumpDataAsync=A,E.Tools.DumpFramebuffer=L},12217:(w,o,H)=>{H.d(o,{b:()=>e});var h=H(11813),E=H(11945);class e{static ExpandRGBDTexture(w){const o=w._texture;if(!o||!w.isRGBD)return;const E=o.getEngine(),e=E.getCaps(),D=o.isReady;let t=!1;e.textureHalfFloatRender&&e.textureHalfFloatLinearFiltering?(t=!0,o.type=2):e.textureFloatRender&&e.textureFloatLinearFiltering&&(t=!0,o.type=1),t&&(o.isReady=!1,o._isRGBD=!1,o.invertY=!1);const X=async()=>{const e=E.isWebGPU,D=e?1:0;o.isReady=!1,e?await H.e(42).then(H.bind(H,14860)):await H.e(35).then(H.bind(H,14864));const t=new h.e("rgbdDecode","rgbdDecode",null,null,1,null,3,E,!1,void 0,o.type,void 0,null,!1,void 0,D);t.externalTextureSamplerBinding=!0;const X=E.createRenderTargetTexture(o.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:o.samplingMode,type:o.type,format:5});t.onEffectCreatedObservable.addOnce((H=>{H.executeWhenCompiled((()=>{t.onApply=w=>{w._bindTexture("textureSampler",o),w.setFloat2("scale",1,1)},w.Ow().postProcessManager.directRender([t],X,!0),E.restoreDefaultFramebuffer(),E._releaseTexture(o),t&&t.dispose(),X._swapAndDie(o),o.isReady=!0}))}))};t&&(D?X():w.onLoadObservable.addOnce(X))}static async EncodeTextureToRGBD(w,o){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return o.getEngine().isWebGPU?await H.e(43).then(H.bind(H,14874)):await H.e(36).then(H.bind(H,14866)),await(0,E.d)("rgbdEncode",w,o,h,1,5)}}}}]);