"use strict";(self.h6ljd275xwr=self.h6ljd275xwr||[]).push([[20,21],{11873:(n,y,H)=>{var o=H(11882),G=H(11309);G.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(G.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=o.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((n=>{this._texture._sphericalPolynomial=n,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(n){this._texture&&(this._texture._sphericalPolynomial=n)},enumerable:!0,configurable:!0})},11882:(n,y,H)=>{H.d(y,{b:()=>V});var o=H(11288),G=H(11303),h=H(11500),k=H(11297),i=H(11335);class B{constructor(n,y,H,o){this.name=n,this.worldAxisForNormal=y,this.worldAxisForFileX=H,this.worldAxisForFileY=o}}class V{static ConvertCubeMapTextureToSphericalPolynomial(n){var y;if(!n.isCube)return null;null===(y=n.pn())||void 0===y||y.getEngine().flushFramebuffer();const H=n.getSize().width,o=n.readPixels(0,void 0,void 0,!1),G=n.readPixels(1,void 0,void 0,!1);let h,k;n.isRenderTarget?(h=n.readPixels(3,void 0,void 0,!1),k=n.readPixels(2,void 0,void 0,!1)):(h=n.readPixels(2,void 0,void 0,!1),k=n.readPixels(3,void 0,void 0,!1));const i=n.readPixels(4,void 0,void 0,!1),B=n.readPixels(5,void 0,void 0,!1),V=n.gammaSpace;let q=0;return 1!=n.textureType&&2!=n.textureType||(q=1),new Promise((n=>{Promise.all([G,o,h,k,i,B]).then((y=>{let[o,G,h,k,i,B]=y;const b={size:H,right:G,left:o,up:h,down:k,front:i,back:B,format:5,type:q,gammaSpace:V};n(this.ConvertCubeMapToSphericalPolynomial(b))}))}))}static _AreaElement(n,y){return Math.atan2(n*y,Math.sqrt(n*n+y*y+1))}static ConvertCubeMapToSphericalPolynomial(n){const y=new h.b;let H=0;const o=2/n.size,B=o,V=.5*o,q=V-1;for(let h=0;h<6;h++){const b=this._FileFaces[h],A=n[b.name];let U=q;const T=5===n.format?4:3;for(let h=0;h<n.size;h++){let W=q;for(let B=0;B<n.size;B++){const q=b.worldAxisForFileX.scale(W).add(b.worldAxisForFileY.scale(U)).add(b.worldAxisForNormal);q.normalize();const z=this._AreaElement(W-V,U-V)-this._AreaElement(W-V,U+V)-this._AreaElement(W+V,U-V)+this._AreaElement(W+V,U+V);let Q=A[h*n.size*T+B*T+0],l=A[h*n.size*T+B*T+1],v=A[h*n.size*T+B*T+2];isNaN(Q)&&(Q=0),isNaN(l)&&(l=0),isNaN(v)&&(v=0),0===n.type&&(Q/=255,l/=255,v/=255),n.gammaSpace&&(Q=Math.pow((0,G.Clamp)(Q),k.n),l=Math.pow((0,G.Clamp)(l),k.n),v=Math.pow((0,G.Clamp)(v),k.n));const F=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const n=Math.max(Q,l,v);if(n>F){const y=F/n;Q*=y,l*=y,v*=y}}else Q=(0,G.Clamp)(Q,0,F),l=(0,G.Clamp)(l,0,F),v=(0,G.Clamp)(v,0,F);const g=new i.Fy(Q,l,v);y.addLight(q,g,z),H+=z,W+=o}U+=B}}const b=6*(4*Math.PI)/6/H;return y.scaleInPlace(b),y.convertIncidentRadianceToIrradiance(),y.convertIrradianceToLambertianRadiance(),h.f.FromHarmonics(y)}}V._FileFaces=[new B("right",new o.zy(1,0,0),new o.zy(0,0,-1),new o.zy(0,-1,0)),new B("left",new o.zy(-1,0,0),new o.zy(0,0,1),new o.zy(0,-1,0)),new B("up",new o.zy(0,1,0),new o.zy(1,0,0),new o.zy(0,0,1)),new B("down",new o.zy(0,-1,0),new o.zy(1,0,0),new o.zy(0,0,-1)),new B("front",new o.zy(0,0,1),new o.zy(1,0,0),new o.zy(0,-1,0)),new B("back",new o.zy(0,0,-1),new o.zy(-1,0,0),new o.zy(0,-1,0))],V.MAX_HDRI_VALUE=4096,V.PRESERVE_CLAMPED_COLORS=!1},11542:(n,y,H)=>{H.r(y),H.d(y,{Dispose:()=>A,DumpData:()=>b,DumpDataAsync:()=>q,DumpFramebuffer:()=>V,DumpTools:()=>U});var o=H(11408),G=H(11094),h=H(11303),k=H(11149);let i,B=null;async function V(n,y,H,o){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",h=arguments.length>5?arguments[5]:void 0,k=arguments.length>6?arguments[6]:void 0;const i=await H.readPixels(0,0,n,y);b(n,y,new Uint8Array(i.buffer),o,G,h,!0,void 0,k)}async function q(n,y,H){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",G=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7?arguments[7]:void 0;return await new Promise((B=>{b(n,y,H,(n=>B(n)),o,G,h,k,i)}))}function b(n,y,V,q){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",U=arguments.length>5?arguments[5]:void 0,T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7&&void 0!==arguments[7]&&arguments[7],z=arguments.length>8?arguments[8]:void 0;(async function(){return B||(B=new Promise(((n,y)=>{let G,h=null;const B={o:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(H.bind(H,11446)).then((V=>{let{ThinEngine:q}=V;const b=k.c.Instances.length;try{G=new OffscreenCanvas(100,100),h=new q(G,!1,B)}catch(W){var U;b<k.c.Instances.length&&(null===(U=k.c.Instances.pop())||void 0===U||U.dispose()),G=document.createElement("canvas"),h=new q(G,!1,B)}k.c.Instances.pop(),k.c.OnEnginesDisposedObservable.add((n=>{h&&n!==h&&!h.A&&0===k.c.Instances.length&&A()})),h.getCaps().parallelShaderCompile=void 0;const T=new o.e(h);H.e(52).then(H.bind(H,13884)).then((H=>{let{passPixelShader:k}=H;if(!h)return void y("Engine is not defined");const B=new o.g({Wy:h,name:k.name,fragmentShader:k.shader,samplerNames:["textureSampler"]});i={canvas:G,Wy:h,renderer:T,wrapper:B},n(i)}))})).catch(y)}))),await B})().then((H=>{if(H.Wy.setSize(n,y,!0),V instanceof Float32Array){const n=new Uint8Array(V.length);let y=V.length;for(;y--;){const H=V[y];n[y]=Math.round(255*(0,h.Clamp)(H))}V=n}const o=H.Wy.createRawTexture(V,n,y,5,!1,!T,1);H.renderer.setViewport(),H.renderer.applyEffectWrapper(H.wrapper),H.wrapper.effect._bindTexture("textureSampler",o),H.renderer.draw(),W?G.Tools.ToBlob(H.canvas,(n=>{const y=new FileReader;y.onload=n=>{const y=n.target.result;q&&q(y)},y.readAsArrayBuffer(n)}),b,z):G.Tools.EncodeScreenshotCanvasData(H.canvas,q,b,U,z),o.dispose()}))}function A(){var n;i?(i.wrapper.dispose(),i.renderer.dispose(),i.Wy.dispose()):null===(n=B)||void 0===n||n.then((n=>{n.wrapper.dispose(),n.renderer.dispose(),n.Wy.dispose()}));B=null,i=null}const U={DumpData:b,DumpDataAsync:q,DumpFramebuffer:V,Dispose:A};G.Tools.DumpData=b,G.Tools.DumpDataAsync=q,G.Tools.DumpFramebuffer=V},11862:(n,y,H)=>{H.d(y,{e:()=>h});var o=H(11399),G=H(11547);class h{static ExpandRGBDTexture(n){const y=n._texture;if(!y||!n.isRGBD)return;const G=y.getEngine(),h=G.getCaps(),k=y.isReady;let i=!1;h.textureHalfFloatRender&&h.textureHalfFloatLinearFiltering?(i=!0,y.type=2):h.textureFloatRender&&h.textureFloatLinearFiltering&&(i=!0,y.type=1),i&&(y.isReady=!1,y._isRGBD=!1,y.invertY=!1);const B=async()=>{const h=G.isWebGPU,k=h?1:0;y.isReady=!1,h?await H.e(42).then(H.bind(H,14426)):await H.e(35).then(H.bind(H,14433));const i=new o.e("rgbdDecode","rgbdDecode",null,null,1,null,3,G,!1,void 0,y.type,void 0,null,!1,void 0,k);i.externalTextureSamplerBinding=!0;const B=G.createRenderTargetTexture(y.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:y.samplingMode,type:y.type,format:5});i.onEffectCreatedObservable.addOnce((H=>{H.executeWhenCompiled((()=>{i.onApply=n=>{n._bindTexture("textureSampler",y),n.setFloat2("scale",1,1)},n.pn().postProcessManager.directRender([i],B,!0),G.restoreDefaultFramebuffer(),G._releaseTexture(y),i&&i.dispose(),B._swapAndDie(y),y.isReady=!0}))}))};i&&(k?B():n.onLoadObservable.addOnce(B))}static async EncodeTextureToRGBD(n,y){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return y.getEngine().isWebGPU?await H.e(43).then(H.bind(H,14448)):await H.e(36).then(H.bind(H,14440)),await(0,G.d)("rgbdEncode",n,y,o,1,5)}}}}]);