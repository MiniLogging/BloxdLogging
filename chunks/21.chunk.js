"use strict";(self.hbnkweqmycf=self.hbnkweqmycf||[]).push([[20,21],{12138:(F,P,f)=>{var c=f(12145),N=f(11666);N.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(N.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=c.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((F=>{this._texture._sphericalPolynomial=F,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(F){this._texture&&(this._texture._sphericalPolynomial=F)},enumerable:!0,configurable:!0})},12145:(F,P,f)=>{f.d(P,{c:()=>j});var c=f(11639),N=f(11664),q=f(11801),H=f(11648),A=f(11690);class o{constructor(F,P,f,c){this.name=F,this.worldAxisForNormal=P,this.worldAxisForFileX=f,this.worldAxisForFileY=c}}class j{static ConvertCubeMapTextureToSphericalPolynomial(F){var P;if(!F.isCube)return null;null===(P=F.OF())||void 0===P||P.getEngine().flushFramebuffer();const f=F.getSize().width,c=F.readPixels(0,void 0,void 0,!1),N=F.readPixels(1,void 0,void 0,!1);let q,H;F.isRenderTarget?(q=F.readPixels(3,void 0,void 0,!1),H=F.readPixels(2,void 0,void 0,!1)):(q=F.readPixels(2,void 0,void 0,!1),H=F.readPixels(3,void 0,void 0,!1));const A=F.readPixels(4,void 0,void 0,!1),o=F.readPixels(5,void 0,void 0,!1),j=F.gammaSpace;let i=0;return 1!=F.textureType&&2!=F.textureType||(i=1),new Promise((F=>{Promise.all([N,c,q,H,A,o]).then((P=>{let[c,N,q,H,A,o]=P;const u={size:f,right:N,left:c,up:q,down:H,front:A,back:o,format:5,type:i,gammaSpace:j};F(this.ConvertCubeMapToSphericalPolynomial(u))}))}))}static _AreaElement(F,P){return Math.atan2(F*P,Math.sqrt(F*F+P*P+1))}static ConvertCubeMapToSphericalPolynomial(F){const P=new q.e;let f=0;const c=2/F.size,o=c,j=.5*c,i=j-1;for(let q=0;q<6;q++){const u=this._FileFaces[q],T=F[u.name];let Y=i;const t=5===F.format?4:3;for(let q=0;q<F.size;q++){let C=i;for(let o=0;o<F.size;o++){const i=u.worldAxisForFileX.scale(C).add(u.worldAxisForFileY.scale(Y)).add(u.worldAxisForNormal);i.normalize();const L=this._AreaElement(C-j,Y-j)-this._AreaElement(C-j,Y+j)-this._AreaElement(C+j,Y-j)+this._AreaElement(C+j,Y+j);let J=T[q*F.size*t+o*t+0],B=T[q*F.size*t+o*t+1],z=T[q*F.size*t+o*t+2];isNaN(J)&&(J=0),isNaN(B)&&(B=0),isNaN(z)&&(z=0),0===F.type&&(J/=255,B/=255,z/=255),F.gammaSpace&&(J=Math.pow((0,N.Clamp)(J),H.l),B=Math.pow((0,N.Clamp)(B),H.l),z=Math.pow((0,N.Clamp)(z),H.l));const Z=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const F=Math.max(J,B,z);if(F>Z){const P=Z/F;J*=P,B*=P,z*=P}}else J=(0,N.Clamp)(J,0,Z),B=(0,N.Clamp)(B,0,Z),z=(0,N.Clamp)(z,0,Z);const R=new A.BP(J,B,z);P.addLight(i,R,L),f+=L,C+=c}Y+=o}}const u=6*(4*Math.PI)/6/f;return P.scaleInPlace(u),P.convertIncidentRadianceToIrradiance(),P.convertIrradianceToLambertianRadiance(),q.h.FromHarmonics(P)}}j._FileFaces=[new o("right",new c.tP(1,0,0),new c.tP(0,0,-1),new c.tP(0,-1,0)),new o("left",new c.tP(-1,0,0),new c.tP(0,0,1),new c.tP(0,-1,0)),new o("up",new c.tP(0,1,0),new c.tP(1,0,0),new c.tP(0,0,1)),new o("down",new c.tP(0,-1,0),new c.tP(1,0,0),new c.tP(0,0,-1)),new o("front",new c.tP(0,0,1),new c.tP(1,0,0),new c.tP(0,-1,0)),new o("back",new c.tP(0,0,-1),new c.tP(-1,0,0),new c.tP(0,-1,0))],j.MAX_HDRI_VALUE=4096,j.PRESERVE_CLAMPED_COLORS=!1},11835:(F,P,f)=>{f.r(P),f.d(P,{Dispose:()=>T,DumpData:()=>u,DumpDataAsync:()=>i,DumpFramebuffer:()=>j,DumpTools:()=>Y});var c=f(11730),N=f(11462),q=f(11664),H=f(11501);let A,o=null;async function j(F,P,f,c){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",q=arguments.length>5?arguments[5]:void 0,H=arguments.length>6?arguments[6]:void 0;const A=await f.readPixels(0,0,F,P);u(F,P,new Uint8Array(A.buffer),c,N,q,!0,void 0,H)}async function i(F,P,f){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",N=arguments.length>4?arguments[4]:void 0,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7?arguments[7]:void 0;return await new Promise((o=>{u(F,P,f,(F=>o(F)),c,N,q,H,A)}))}function u(F,P,j,i){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Y=arguments.length>5?arguments[5]:void 0,t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]&&arguments[7],L=arguments.length>8?arguments[8]:void 0;(async function(){return o||(o=new Promise(((F,P)=>{let N,q=null;const o={If:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(f.bind(f,11752)).then((j=>{let{ThinEngine:i}=j;const u=H.b.Instances.length;try{N=new OffscreenCanvas(100,100),q=new i(N,!1,o)}catch(C){var Y;u<H.b.Instances.length&&(null===(Y=H.b.Instances.pop())||void 0===Y||Y.dispose()),N=document.createElement("canvas"),q=new i(N,!1,o)}H.b.Instances.pop(),H.b.OnEnginesDisposedObservable.add((F=>{q&&F!==q&&!q.u&&0===H.b.Instances.length&&T()})),q.getCaps().parallelShaderCompile=void 0;const t=new c.b(q);f.e(52).then(f.bind(f,14082)).then((f=>{let{passPixelShader:H}=f;if(!q)return void P("Engine is not defined");const o=new c.f({YP:q,name:H.name,fragmentShader:H.shader,samplerNames:["textureSampler"]});A={canvas:N,YP:q,renderer:t,wrapper:o},F(A)}))})).catch(P)}))),await o})().then((f=>{if(f.YP.setSize(F,P,!0),j instanceof Float32Array){const F=new Uint8Array(j.length);let P=j.length;for(;P--;){const f=j[P];F[P]=Math.round(255*(0,q.Clamp)(f))}j=F}const c=f.YP.createRawTexture(j,F,P,5,!1,!t,1);f.renderer.setViewport(),f.renderer.applyEffectWrapper(f.wrapper),f.wrapper.effect._bindTexture("textureSampler",c),f.renderer.draw(),C?N.Tools.ToBlob(f.canvas,(F=>{const P=new FileReader;P.onload=F=>{const P=F.target.result;i&&i(P)},P.readAsArrayBuffer(F)}),u,L):N.Tools.EncodeScreenshotCanvasData(f.canvas,i,u,Y,L),c.dispose()}))}function T(){var F;A?(A.wrapper.dispose(),A.renderer.dispose(),A.YP.dispose()):null===(F=o)||void 0===F||F.then((F=>{F.wrapper.dispose(),F.renderer.dispose(),F.YP.dispose()}));o=null,A=null}const Y={DumpData:u,DumpDataAsync:i,DumpFramebuffer:j,Dispose:T};N.Tools.DumpData=u,N.Tools.DumpDataAsync=i,N.Tools.DumpFramebuffer=j},12127:(F,P,f)=>{f.d(P,{e:()=>q});var c=f(11728),N=f(11841);class q{static ExpandRGBDTexture(F){const P=F._texture;if(!P||!F.isRGBD)return;const N=P.getEngine(),q=N.getCaps(),H=P.isReady;let A=!1;q.textureHalfFloatRender&&q.textureHalfFloatLinearFiltering?(A=!0,P.type=2):q.textureFloatRender&&q.textureFloatLinearFiltering&&(A=!0,P.type=1),A&&(P.isReady=!1,P._isRGBD=!1,P.invertY=!1);const o=async()=>{const q=N.isWebGPU,H=q?1:0;P.isReady=!1,q?await f.e(42).then(f.bind(f,14651)):await f.e(35).then(f.bind(f,14660));const A=new c.b("rgbdDecode","rgbdDecode",null,null,1,null,3,N,!1,void 0,P.type,void 0,null,!1,void 0,H);A.externalTextureSamplerBinding=!0;const o=N.createRenderTargetTexture(P.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:P.samplingMode,type:P.type,format:5});A.onEffectCreatedObservable.addOnce((f=>{f.executeWhenCompiled((()=>{A.onApply=F=>{F._bindTexture("textureSampler",P),F.setFloat2("scale",1,1)},F.OF().postProcessManager.directRender([A],o,!0),N.restoreDefaultFramebuffer(),N._releaseTexture(P),A&&A.dispose(),o._swapAndDie(P),P.isReady=!0}))}))};A&&(H?o():F.onLoadObservable.addOnce(o))}static async EncodeTextureToRGBD(F,P){let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return P.getEngine().isWebGPU?await f.e(43).then(f.bind(f,14673)):await f.e(36).then(f.bind(f,14668)),await(0,N.d)("rgbdEncode",F,P,c,1,5)}}}}]);