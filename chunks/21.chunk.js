"use strict";(self["6xhfpmwgjr5"]=self["6xhfpmwgjr5"]||[]).push([[20,21],{12891:(P,a,R)=>{var S=R(12900),A=R(12434);A.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(A.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=S.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((P=>{this._texture._sphericalPolynomial=P,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(P){this._texture&&(this._texture._sphericalPolynomial=P)},enumerable:!0,configurable:!0})},12900:(P,a,R)=>{R.d(a,{b:()=>Q});var S=R(12415),A=R(12430),Z=R(12591),p=R(12418),j=R(12456);class U{constructor(P,a,R,S){this.name=P,this.worldAxisForNormal=a,this.worldAxisForFileX=R,this.worldAxisForFileY=S}}class Q{static ConvertCubeMapTextureToSphericalPolynomial(P){var a;if(!P.isCube)return null;null===(a=P.GP())||void 0===a||a.getEngine().flushFramebuffer();const R=P.getSize().width,S=P.readPixels(0,void 0,void 0,!1),A=P.readPixels(1,void 0,void 0,!1);let Z,p;P.isRenderTarget?(Z=P.readPixels(3,void 0,void 0,!1),p=P.readPixels(2,void 0,void 0,!1)):(Z=P.readPixels(2,void 0,void 0,!1),p=P.readPixels(3,void 0,void 0,!1));const j=P.readPixels(4,void 0,void 0,!1),U=P.readPixels(5,void 0,void 0,!1),Q=P.gammaSpace;let h=0;return 1!=P.textureType&&2!=P.textureType||(h=1),new Promise((P=>{Promise.all([A,S,Z,p,j,U]).then((a=>{let[S,A,Z,p,j,U]=a;const l={size:R,right:A,left:S,up:Z,down:p,front:j,back:U,format:5,type:h,gammaSpace:Q};P(this.ConvertCubeMapToSphericalPolynomial(l))}))}))}static _AreaElement(P,a){return Math.atan2(P*a,Math.sqrt(P*P+a*a+1))}static ConvertCubeMapToSphericalPolynomial(P){const a=new Z.e;let R=0;const S=2/P.size,U=S,Q=.5*S,h=Q-1;for(let Z=0;Z<6;Z++){const l=this._FileFaces[Z],V=P[l.name];let f=h;const O=5===P.format?4:3;for(let Z=0;Z<P.size;Z++){let q=h;for(let U=0;U<P.size;U++){const h=l.worldAxisForFileX.scale(q).add(l.worldAxisForFileY.scale(f)).add(l.worldAxisForNormal);h.normalize();const y=this._AreaElement(q-Q,f-Q)-this._AreaElement(q-Q,f+Q)-this._AreaElement(q+Q,f-Q)+this._AreaElement(q+Q,f+Q);let t=V[Z*P.size*O+U*O+0],W=V[Z*P.size*O+U*O+1],k=V[Z*P.size*O+U*O+2];isNaN(t)&&(t=0),isNaN(W)&&(W=0),isNaN(k)&&(k=0),0===P.type&&(t/=255,W/=255,k/=255),P.gammaSpace&&(t=Math.pow((0,A.Clamp)(t),p.m),W=Math.pow((0,A.Clamp)(W),p.m),k=Math.pow((0,A.Clamp)(k),p.m));const x=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const P=Math.max(t,W,k);if(P>x){const a=x/P;t*=a,W*=a,k*=a}}else t=(0,A.Clamp)(t,0,x),W=(0,A.Clamp)(W,0,x),k=(0,A.Clamp)(k,0,x);const s=new j.Wa(t,W,k);a.addLight(h,s,y),R+=y,q+=S}f+=U}}const l=6*(4*Math.PI)/6/R;return a.scaleInPlace(l),a.convertIncidentRadianceToIrradiance(),a.convertIrradianceToLambertianRadiance(),Z.f.FromHarmonics(a)}}Q._FileFaces=[new U("right",new S.Oa(1,0,0),new S.Oa(0,0,-1),new S.Oa(0,-1,0)),new U("left",new S.Oa(-1,0,0),new S.Oa(0,0,1),new S.Oa(0,-1,0)),new U("up",new S.Oa(0,1,0),new S.Oa(1,0,0),new S.Oa(0,0,1)),new U("down",new S.Oa(0,-1,0),new S.Oa(1,0,0),new S.Oa(0,0,-1)),new U("front",new S.Oa(0,0,1),new S.Oa(1,0,0),new S.Oa(0,-1,0)),new U("back",new S.Oa(0,0,-1),new S.Oa(-1,0,0),new S.Oa(0,-1,0))],Q.MAX_HDRI_VALUE=4096,Q.PRESERVE_CLAMPED_COLORS=!1},12621:(P,a,R)=>{R.r(a),R.d(a,{Dispose:()=>V,DumpData:()=>l,DumpDataAsync:()=>h,DumpFramebuffer:()=>Q,DumpTools:()=>f});var S=R(12525),A=R(12225),Z=R(12430),p=R(12277);let j,U=null;async function Q(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Z=arguments.length>5?arguments[5]:void 0,p=arguments.length>6?arguments[6]:void 0;const j=await R.readPixels(0,0,P,a);l(P,a,new Uint8Array(j.buffer),S,A,Z,!0,void 0,p)}async function h(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",A=arguments.length>4?arguments[4]:void 0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7?arguments[7]:void 0;return await new Promise((U=>{l(P,a,R,(P=>U(P)),S,A,Z,p,j)}))}function l(P,a,Q,h){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",f=arguments.length>5?arguments[5]:void 0,O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],y=arguments.length>8?arguments[8]:void 0;(async function(){return U||(U=new Promise(((P,a)=>{let A,Z=null;const U={Sj:!0,depth:!1,gp:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(R.bind(R,12559)).then((Q=>{let{ThinEngine:h}=Q;const l=p.e.Instances.length;try{A=new OffscreenCanvas(100,100),Z=new h(A,!1,U)}catch(q){var f;l<p.e.Instances.length&&(null===(f=p.e.Instances.pop())||void 0===f||f.dispose()),A=document.createElement("canvas"),Z=new h(A,!1,U)}p.e.Instances.pop(),p.e.OnEnginesDisposedObservable.add((P=>{Z&&P!==Z&&!Z.U&&0===p.e.Instances.length&&V()})),Z.getCaps().parallelShaderCompile=void 0;const O=new S.b(Z);R.e(52).then(R.bind(R,15748)).then((R=>{let{passPixelShader:p}=R;if(!Z)return void a("Engine is not defined");const U=new S.e({fa:Z,name:p.name,fragmentShader:p.shader,samplerNames:["textureSampler"]});j={canvas:A,fa:Z,renderer:O,wrapper:U},P(j)}))})).catch(a)}))),await U})().then((R=>{if(R.fa.setSize(P,a,!0),Q instanceof Float32Array){const P=new Uint8Array(Q.length);let a=Q.length;for(;a--;){const R=Q[a];P[a]=Math.round(255*(0,Z.Clamp)(R))}Q=P}const S=R.fa.createRawTexture(Q,P,a,5,!1,!O,1);R.renderer.setViewport(),R.renderer.applyEffectWrapper(R.wrapper),R.wrapper.effect._bindTexture("textureSampler",S),R.renderer.draw(),q?A.Tools.ToBlob(R.canvas,(P=>{const a=new FileReader;a.onload=P=>{const a=P.target.result;h&&h(a)},a.readAsArrayBuffer(P)}),l,y):A.Tools.EncodeScreenshotCanvasData(R.canvas,h,l,f,y),S.dispose()}))}function V(){var P;j?(j.wrapper.dispose(),j.renderer.dispose(),j.fa.dispose()):null===(P=U)||void 0===P||P.then((P=>{P.wrapper.dispose(),P.renderer.dispose(),P.fa.dispose()}));U=null,j=null}const f={DumpData:l,DumpDataAsync:h,DumpFramebuffer:Q,Dispose:V};A.Tools.DumpData=l,A.Tools.DumpDataAsync=h,A.Tools.DumpFramebuffer=Q},12877:(P,a,R)=>{R.d(a,{d:()=>Z});var S=R(12519),A=R(12626);class Z{static ExpandRGBDTexture(P){const a=P._texture;if(!a||!P.isRGBD)return;const A=a.getEngine(),Z=A.getCaps(),p=a.isReady;let j=!1;Z.textureHalfFloatRender&&Z.textureHalfFloatLinearFiltering?(j=!0,a.type=2):Z.textureFloatRender&&Z.textureFloatLinearFiltering&&(j=!0,a.type=1),j&&(a.isReady=!1,a._isRGBD=!1,a.invertY=!1);const U=async()=>{const Z=A.isWebGPU,p=Z?1:0;a.isReady=!1,Z?await R.e(42).then(R.bind(R,16302)):await R.e(35).then(R.bind(R,16310));const j=new S.d("rgbdDecode","rgbdDecode",null,null,1,null,3,A,!1,void 0,a.type,void 0,null,!1,void 0,p);j.externalTextureSamplerBinding=!0;const U=A.createRenderTargetTexture(a.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:a.samplingMode,type:a.type,format:5});j.onEffectCreatedObservable.addOnce((R=>{R.executeWhenCompiled((()=>{j.onApply=P=>{P._bindTexture("textureSampler",a),P.setFloat2("scale",1,1)},P.GP().postProcessManager.directRender([j],U,!0),A.restoreDefaultFramebuffer(),A._releaseTexture(a),j&&j.dispose(),U._swapAndDie(a),a.isReady=!0}))}))};j&&(p?U():P.onLoadObservable.addOnce(U))}static async EncodeTextureToRGBD(P,a){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return a.getEngine().isWebGPU?await R.e(43).then(R.bind(R,16316)):await R.e(36).then(R.bind(R,16314)),await(0,A.c)("rgbdEncode",P,a,S,1,5)}}}}]);