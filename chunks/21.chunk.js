"use strict";(self.i6szn8jgzh=self.i6szn8jgzh||[]).push([[20,21],{12290:(b,n,i)=>{var e=i(12298),V=i(11803);V.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(V.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=e.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((b=>{this._texture._sphericalPolynomial=b,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(b){this._texture&&(this._texture._sphericalPolynomial=b)},enumerable:!0,configurable:!0})},12298:(b,n,i)=>{i.d(n,{b:()=>B});var e=i(11778),V=i(11796),Q=i(11960),U=i(11786),Y=i(11822);class L{constructor(b,n,i,e){this.name=b,this.worldAxisForNormal=n,this.worldAxisForFileX=i,this.worldAxisForFileY=e}}class B{static ConvertCubeMapTextureToSphericalPolynomial(b){var n;if(!b.isCube)return null;null===(n=b.ab())||void 0===n||n.getEngine().flushFramebuffer();const i=b.getSize().width,e=b.readPixels(0,void 0,void 0,!1),V=b.readPixels(1,void 0,void 0,!1);let Q,U;b.isRenderTarget?(Q=b.readPixels(3,void 0,void 0,!1),U=b.readPixels(2,void 0,void 0,!1)):(Q=b.readPixels(2,void 0,void 0,!1),U=b.readPixels(3,void 0,void 0,!1));const Y=b.readPixels(4,void 0,void 0,!1),L=b.readPixels(5,void 0,void 0,!1),B=b.gammaSpace;let mb=0;return 1!=b.textureType&&2!=b.textureType||(mb=1),new Promise((b=>{Promise.all([V,e,Q,U,Y,L]).then((n=>{let[e,V,Q,U,Y,L]=n;const N={size:i,right:V,left:e,up:Q,down:U,front:Y,back:L,format:5,type:mb,gammaSpace:B};b(this.ConvertCubeMapToSphericalPolynomial(N))}))}))}static _AreaElement(b,n){return Math.atan2(b*n,Math.sqrt(b*b+n*n+1))}static ConvertCubeMapToSphericalPolynomial(b){const n=new Q.e;let i=0;const e=2/b.size,L=e,B=.5*e,mb=B-1;for(let Q=0;Q<6;Q++){const N=this._FileFaces[Q],Z=b[N.name];let T=mb;const z=5===b.format?4:3;for(let Q=0;Q<b.size;Q++){let K=mb;for(let L=0;L<b.size;L++){const mb=N.worldAxisForFileX.scale(K).add(N.worldAxisForFileY.scale(T)).add(N.worldAxisForNormal);mb.normalize();const I=this._AreaElement(K-B,T-B)-this._AreaElement(K-B,T+B)-this._AreaElement(K+B,T-B)+this._AreaElement(K+B,T+B);let O=Z[Q*b.size*z+L*z+0],u=Z[Q*b.size*z+L*z+1],d=Z[Q*b.size*z+L*z+2];isNaN(O)&&(O=0),isNaN(u)&&(u=0),isNaN(d)&&(d=0),0===b.type&&(O/=255,u/=255,d/=255),b.gammaSpace&&(O=Math.pow((0,V.Clamp)(O),U.j),u=Math.pow((0,V.Clamp)(u),U.j),d=Math.pow((0,V.Clamp)(d),U.j));const G=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const b=Math.max(O,u,d);if(b>G){const n=G/b;O*=n,u*=n,d*=n}}else O=(0,V.Clamp)(O,0,G),u=(0,V.Clamp)(u,0,G),d=(0,V.Clamp)(d,0,G);const o=new Y.Mn(O,u,d);n.addLight(mb,o,I),i+=I,K+=e}T+=L}}const N=6*(4*Math.PI)/6/i;return n.scaleInPlace(N),n.convertIncidentRadianceToIrradiance(),n.convertIrradianceToLambertianRadiance(),Q.h.FromHarmonics(n)}}B._FileFaces=[new L("right",new e.On(1,0,0),new e.On(0,0,-1),new e.On(0,-1,0)),new L("left",new e.On(-1,0,0),new e.On(0,0,1),new e.On(0,-1,0)),new L("up",new e.On(0,1,0),new e.On(1,0,0),new e.On(0,0,1)),new L("down",new e.On(0,-1,0),new e.On(1,0,0),new e.On(0,0,-1)),new L("front",new e.On(0,0,1),new e.On(1,0,0),new e.On(0,-1,0)),new L("back",new e.On(0,0,-1),new e.On(-1,0,0),new e.On(0,-1,0))],B.MAX_HDRI_VALUE=4096,B.PRESERVE_CLAMPED_COLORS=!1},11989:(b,n,i)=>{i.r(n),i.d(n,{Dispose:()=>Z,DumpData:()=>N,DumpDataAsync:()=>mb,DumpFramebuffer:()=>B,DumpTools:()=>T});var e=i(11872),V=i(11605),Q=i(11796),U=i(11646);let Y,L=null;async function B(b,n,i,e){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Q=arguments.length>5?arguments[5]:void 0,U=arguments.length>6?arguments[6]:void 0;const Y=await i.readPixels(0,0,b,n);N(b,n,new Uint8Array(Y.buffer),e,V,Q,!0,void 0,U)}async function mb(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",V=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7?arguments[7]:void 0;return await new Promise((L=>{N(b,n,i,(b=>L(b)),e,V,Q,U,Y)}))}function N(b,n,B,mb){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",T=arguments.length>5?arguments[5]:void 0,z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7&&void 0!==arguments[7]&&arguments[7],I=arguments.length>8?arguments[8]:void 0;(async function(){return L||(L=new Promise(((b,n)=>{let V,Q=null;const L={de:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(i.bind(i,11898)).then((B=>{let{ThinEngine:mb}=B;const N=U.d.Instances.length;try{V=new OffscreenCanvas(100,100),Q=new mb(V,!1,L)}catch(K){var T;N<U.d.Instances.length&&(null===(T=U.d.Instances.pop())||void 0===T||T.dispose()),V=document.createElement("canvas"),Q=new mb(V,!1,L)}U.d.Instances.pop(),U.d.OnEnginesDisposedObservable.add((b=>{Q&&b!==Q&&!Q.N&&0===U.d.Instances.length&&Z()})),Q.getCaps().parallelShaderCompile=void 0;const z=new e.c(Q);i.e(52).then(i.bind(i,14339)).then((i=>{let{passPixelShader:U}=i;if(!Q)return void n("Engine is not defined");const L=new e.f({In:Q,name:U.name,fragmentShader:U.shader,samplerNames:["textureSampler"]});Y={canvas:V,In:Q,renderer:z,wrapper:L},b(Y)}))})).catch(n)}))),await L})().then((i=>{if(i.In.setSize(b,n,!0),B instanceof Float32Array){const b=new Uint8Array(B.length);let n=B.length;for(;n--;){const i=B[n];b[n]=Math.round(255*(0,Q.Clamp)(i))}B=b}const e=i.In.createRawTexture(B,b,n,5,!1,!z,1);i.renderer.setViewport(),i.renderer.applyEffectWrapper(i.wrapper),i.wrapper.effect._bindTexture("textureSampler",e),i.renderer.draw(),K?V.Tools.ToBlob(i.canvas,(b=>{const n=new FileReader;n.onload=b=>{const n=b.target.result;mb&&mb(n)},n.readAsArrayBuffer(b)}),N,I):V.Tools.EncodeScreenshotCanvasData(i.canvas,mb,N,T,I),e.dispose()}))}function Z(){var b;Y?(Y.wrapper.dispose(),Y.renderer.dispose(),Y.In.dispose()):null===(b=L)||void 0===b||b.then((b=>{b.wrapper.dispose(),b.renderer.dispose(),b.In.dispose()}));L=null,Y=null}const T={DumpData:N,DumpDataAsync:mb,DumpFramebuffer:B,Dispose:Z};V.Tools.DumpData=N,V.Tools.DumpDataAsync=mb,V.Tools.DumpFramebuffer=B},12278:(b,n,i)=>{i.d(n,{c:()=>Q});var e=i(11868),V=i(11994);class Q{static ExpandRGBDTexture(b){const n=b._texture;if(!n||!b.isRGBD)return;const V=n.getEngine(),Q=V.getCaps(),U=n.isReady;let Y=!1;Q.textureHalfFloatRender&&Q.textureHalfFloatLinearFiltering?(Y=!0,n.type=2):Q.textureFloatRender&&Q.textureFloatLinearFiltering&&(Y=!0,n.type=1),Y&&(n.isReady=!1,n._isRGBD=!1,n.invertY=!1);const L=async()=>{const Q=V.isWebGPU,U=Q?1:0;n.isReady=!1,Q?await i.e(42).then(i.bind(i,14918)):await i.e(35).then(i.bind(i,14922));const Y=new e.d("rgbdDecode","rgbdDecode",null,null,1,null,3,V,!1,void 0,n.type,void 0,null,!1,void 0,U);Y.externalTextureSamplerBinding=!0;const L=V.createRenderTargetTexture(n.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:n.samplingMode,type:n.type,format:5});Y.onEffectCreatedObservable.addOnce((i=>{i.executeWhenCompiled((()=>{Y.onApply=b=>{b._bindTexture("textureSampler",n),b.setFloat2("scale",1,1)},b.ab().postProcessManager.directRender([Y],L,!0),V.restoreDefaultFramebuffer(),V._releaseTexture(n),Y&&Y.dispose(),L._swapAndDie(n),n.isReady=!0}))}))};Y&&(U?L():b.onLoadObservable.addOnce(L))}static async EncodeTextureToRGBD(b,n){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n.getEngine().isWebGPU?await i.e(43).then(i.bind(i,14934)):await i.e(36).then(i.bind(i,14927)),await(0,V.c)("rgbdEncode",b,n,e,1,5)}}}}]);