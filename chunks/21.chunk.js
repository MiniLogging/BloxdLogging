"use strict";(self.ynu1yiqvs98=self.ynu1yiqvs98||[]).push([[20,21],{11624:(I,E,j)=>{var e=j(11632),w=j(11139);w.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(w.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=e.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((I=>{this._texture._sphericalPolynomial=I,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(I){this._texture&&(this._texture._sphericalPolynomial=I)},enumerable:!0,configurable:!0})},11632:(I,E,j)=>{j.d(E,{c:()=>R});var e=j(11117),w=j(11136),z=j(11307),h=j(11120),t=j(11165);class U{constructor(I,E,j,e){this.name=I,this.worldAxisForNormal=E,this.worldAxisForFileX=j,this.worldAxisForFileY=e}}class R{static ConvertCubeMapTextureToSphericalPolynomial(I){var E;if(!I.isCube)return null;null===(E=I.GI())||void 0===E||E.getEngine().flushFramebuffer();const j=I.getSize().width,e=I.readPixels(0,void 0,void 0,!1),w=I.readPixels(1,void 0,void 0,!1);let z,h;I.isRenderTarget?(z=I.readPixels(3,void 0,void 0,!1),h=I.readPixels(2,void 0,void 0,!1)):(z=I.readPixels(2,void 0,void 0,!1),h=I.readPixels(3,void 0,void 0,!1));const t=I.readPixels(4,void 0,void 0,!1),U=I.readPixels(5,void 0,void 0,!1),R=I.gammaSpace;let P=0;return 1!=I.textureType&&2!=I.textureType||(P=1),new Promise((I=>{Promise.all([w,e,z,h,t,U]).then((E=>{let[e,w,z,h,t,U]=E;const o={size:j,right:w,left:e,up:z,down:h,front:t,back:U,format:5,type:P,gammaSpace:R};I(this.ConvertCubeMapToSphericalPolynomial(o))}))}))}static _AreaElement(I,E){return Math.atan2(I*E,Math.sqrt(I*I+E*E+1))}static ConvertCubeMapToSphericalPolynomial(I){const E=new z.b;let j=0;const e=2/I.size,U=e,R=.5*e,P=R-1;for(let z=0;z<6;z++){const o=this._FileFaces[z],Z=I[o.name];let c=P;const K=5===I.format?4:3;for(let z=0;z<I.size;z++){let L=P;for(let U=0;U<I.size;U++){const P=o.worldAxisForFileX.scale(L).add(o.worldAxisForFileY.scale(c)).add(o.worldAxisForNormal);P.normalize();const F=this._AreaElement(L-R,c-R)-this._AreaElement(L-R,c+R)-this._AreaElement(L+R,c-R)+this._AreaElement(L+R,c+R);let C=Z[z*I.size*K+U*K+0],X=Z[z*I.size*K+U*K+1],q=Z[z*I.size*K+U*K+2];isNaN(C)&&(C=0),isNaN(X)&&(X=0),isNaN(q)&&(q=0),0===I.type&&(C/=255,X/=255,q/=255),I.gammaSpace&&(C=Math.pow((0,w.Clamp)(C),h.l),X=Math.pow((0,w.Clamp)(X),h.l),q=Math.pow((0,w.Clamp)(q),h.l));const x=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const I=Math.max(C,X,q);if(I>x){const E=x/I;C*=E,X*=E,q*=E}}else C=(0,w.Clamp)(C,0,x),X=(0,w.Clamp)(X,0,x),q=(0,w.Clamp)(q,0,x);const u=new t.qE(C,X,q);E.addLight(P,u,F),j+=F,L+=e}c+=U}}const o=6*(4*Math.PI)/6/j;return E.scaleInPlace(o),E.convertIncidentRadianceToIrradiance(),E.convertIrradianceToLambertianRadiance(),z.d.FromHarmonics(E)}}R._FileFaces=[new U("right",new e.LE(1,0,0),new e.LE(0,0,-1),new e.LE(0,-1,0)),new U("left",new e.LE(-1,0,0),new e.LE(0,0,1),new e.LE(0,-1,0)),new U("up",new e.LE(0,1,0),new e.LE(1,0,0),new e.LE(0,0,1)),new U("down",new e.LE(0,-1,0),new e.LE(1,0,0),new e.LE(0,0,-1)),new U("front",new e.LE(0,0,1),new e.LE(1,0,0),new e.LE(0,-1,0)),new U("back",new e.LE(0,0,-1),new e.LE(-1,0,0),new e.LE(0,-1,0))],R.MAX_HDRI_VALUE=4096,R.PRESERVE_CLAMPED_COLORS=!1},11345:(I,E,j)=>{j.r(E),j.d(E,{Dispose:()=>Z,DumpData:()=>o,DumpDataAsync:()=>P,DumpFramebuffer:()=>R,DumpTools:()=>c});var e=j(11230),w=j(10953),z=j(11136),h=j(10993);let t,U=null;async function R(I,E,j,e){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",z=arguments.length>5?arguments[5]:void 0,h=arguments.length>6?arguments[6]:void 0;const t=await j.readPixels(0,0,I,E);o(I,E,new Uint8Array(t.buffer),e,w,z,!0,void 0,h)}async function P(I,E,j){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",w=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7?arguments[7]:void 0;return await new Promise((U=>{o(I,E,j,(I=>U(I)),e,w,z,h,t)}))}function o(I,E,R,P){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",c=arguments.length>5?arguments[5]:void 0,K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],L=arguments.length>7&&void 0!==arguments[7]&&arguments[7],F=arguments.length>8?arguments[8]:void 0;(async function(){return U||(U=new Promise(((I,E)=>{let w,z=null;const U={ae:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(j.bind(j,11257)).then((R=>{let{ThinEngine:P}=R;const o=h.d.Instances.length;try{w=new OffscreenCanvas(100,100),z=new P(w,!1,U)}catch(L){var c;o<h.d.Instances.length&&(null===(c=h.d.Instances.pop())||void 0===c||c.dispose()),w=document.createElement("canvas"),z=new P(w,!1,U)}h.d.Instances.pop(),h.d.OnEnginesDisposedObservable.add((I=>{z&&I!==z&&!z.Z&&0===h.d.Instances.length&&Z()})),z.getCaps().parallelShaderCompile=void 0;const K=new e.b(z);j.e(52).then(j.bind(j,13603)).then((j=>{let{passPixelShader:h}=j;if(!z)return void E("Engine is not defined");const U=new e.e({KE:z,name:h.name,fragmentShader:h.shader,samplerNames:["textureSampler"]});t={canvas:w,KE:z,renderer:K,wrapper:U},I(t)}))})).catch(E)}))),await U})().then((j=>{if(j.KE.setSize(I,E,!0),R instanceof Float32Array){const I=new Uint8Array(R.length);let E=R.length;for(;E--;){const j=R[E];I[E]=Math.round(255*(0,z.Clamp)(j))}R=I}const e=j.KE.createRawTexture(R,I,E,5,!1,!K,1);j.renderer.setViewport(),j.renderer.applyEffectWrapper(j.wrapper),j.wrapper.effect._bindTexture("textureSampler",e),j.renderer.draw(),L?w.Tools.ToBlob(j.canvas,(I=>{const E=new FileReader;E.onload=I=>{const E=I.target.result;P&&P(E)},E.readAsArrayBuffer(I)}),o,F):w.Tools.EncodeScreenshotCanvasData(j.canvas,P,o,c,F),e.dispose()}))}function Z(){var I;t?(t.wrapper.dispose(),t.renderer.dispose(),t.KE.dispose()):null===(I=U)||void 0===I||I.then((I=>{I.wrapper.dispose(),I.renderer.dispose(),I.KE.dispose()}));U=null,t=null}const c={DumpData:o,DumpDataAsync:P,DumpFramebuffer:R,Dispose:Z};w.Tools.DumpData=o,w.Tools.DumpDataAsync=P,w.Tools.DumpFramebuffer=R},11613:(I,E,j)=>{j.d(E,{b:()=>z});var e=j(11227),w=j(11348);class z{static ExpandRGBDTexture(I){const E=I._texture;if(!E||!I.isRGBD)return;const w=E.getEngine(),z=w.getCaps(),h=E.isReady;let t=!1;z.textureHalfFloatRender&&z.textureHalfFloatLinearFiltering?(t=!0,E.type=2):z.textureFloatRender&&z.textureFloatLinearFiltering&&(t=!0,E.type=1),t&&(E.isReady=!1,E._isRGBD=!1,E.invertY=!1);const U=async()=>{const z=w.isWebGPU,h=z?1:0;E.isReady=!1,z?await j.e(42).then(j.bind(j,14163)):await j.e(35).then(j.bind(j,14172));const t=new e.c("rgbdDecode","rgbdDecode",null,null,1,null,3,w,!1,void 0,E.type,void 0,null,!1,void 0,h);t.externalTextureSamplerBinding=!0;const U=w.createRenderTargetTexture(E.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:E.samplingMode,type:E.type,format:5});t.onEffectCreatedObservable.addOnce((j=>{j.executeWhenCompiled((()=>{t.onApply=I=>{I._bindTexture("textureSampler",E),I.setFloat2("scale",1,1)},I.GI().postProcessManager.directRender([t],U,!0),w.restoreDefaultFramebuffer(),w._releaseTexture(E),t&&t.dispose(),U._swapAndDie(E),E.isReady=!0}))}))};t&&(h?U():I.onLoadObservable.addOnce(U))}static async EncodeTextureToRGBD(I,E){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return E.getEngine().isWebGPU?await j.e(43).then(j.bind(j,14181)):await j.e(36).then(j.bind(j,14174)),await(0,w.c)("rgbdEncode",I,E,e,1,5)}}}}]);