"use strict";(self.rvold1i0ywi=self.rvold1i0ywi||[]).push([[20,21],{11803:(F,b,Q)=>{var C=Q(11805),z=Q(11332);z.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(z.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=C.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((F=>{this._texture._sphericalPolynomial=F,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(F){this._texture&&(this._texture._sphericalPolynomial=F)},enumerable:!0,configurable:!0})},11805:(F,b,Q)=>{Q.d(b,{e:()=>q});var C=Q(11309),z=Q(11329),t=Q(11505),g=Q(11318),W=Q(11359);class Z{constructor(F,b,Q,C){this.name=F,this.worldAxisForNormal=b,this.worldAxisForFileX=Q,this.worldAxisForFileY=C}}class q{static ConvertCubeMapTextureToSphericalPolynomial(F){var b;if(!F.isCube)return null;null===(b=F.RF())||void 0===b||b.getEngine().flushFramebuffer();const Q=F.getSize().width,C=F.readPixels(0,void 0,void 0,!1),z=F.readPixels(1,void 0,void 0,!1);let t,g;F.isRenderTarget?(t=F.readPixels(3,void 0,void 0,!1),g=F.readPixels(2,void 0,void 0,!1)):(t=F.readPixels(2,void 0,void 0,!1),g=F.readPixels(3,void 0,void 0,!1));const W=F.readPixels(4,void 0,void 0,!1),Z=F.readPixels(5,void 0,void 0,!1),q=F.gammaSpace;let G=0;return 1!=F.textureType&&2!=F.textureType||(G=1),new Promise((F=>{Promise.all([z,C,t,g,W,Z]).then((b=>{let[C,z,t,g,W,Z]=b;const K={size:Q,right:z,left:C,up:t,down:g,front:W,back:Z,format:5,type:G,gammaSpace:q};F(this.ConvertCubeMapToSphericalPolynomial(K))}))}))}static _AreaElement(F,b){return Math.atan2(F*b,Math.sqrt(F*F+b*b+1))}static ConvertCubeMapToSphericalPolynomial(F){const b=new t.c;let Q=0;const C=2/F.size,Z=C,q=.5*C,G=q-1;for(let t=0;t<6;t++){const K=this._FileFaces[t],e=F[K.name];let N=G;const y=5===F.format?4:3;for(let t=0;t<F.size;t++){let E=G;for(let Z=0;Z<F.size;Z++){const G=K.worldAxisForFileX.scale(E).add(K.worldAxisForFileY.scale(N)).add(K.worldAxisForNormal);G.normalize();const c=this._AreaElement(E-q,N-q)-this._AreaElement(E-q,N+q)-this._AreaElement(E+q,N-q)+this._AreaElement(E+q,N+q);let X=e[t*F.size*y+Z*y+0],L=e[t*F.size*y+Z*y+1],i=e[t*F.size*y+Z*y+2];isNaN(X)&&(X=0),isNaN(L)&&(L=0),isNaN(i)&&(i=0),0===F.type&&(X/=255,L/=255,i/=255),F.gammaSpace&&(X=Math.pow((0,z.Clamp)(X),g.j),L=Math.pow((0,z.Clamp)(L),g.j),i=Math.pow((0,z.Clamp)(i),g.j));const f=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const F=Math.max(X,L,i);if(F>f){const b=f/F;X*=b,L*=b,i*=b}}else X=(0,z.Clamp)(X,0,f),L=(0,z.Clamp)(L,0,f),i=(0,z.Clamp)(i,0,f);const k=new W.GQ(X,L,i);b.addLight(G,k,c),Q+=c,E+=C}N+=Z}}const K=6*(4*Math.PI)/6/Q;return b.scaleInPlace(K),b.convertIncidentRadianceToIrradiance(),b.convertIrradianceToLambertianRadiance(),t.e.FromHarmonics(b)}}q._FileFaces=[new Z("right",new C.gQ(1,0,0),new C.gQ(0,0,-1),new C.gQ(0,-1,0)),new Z("left",new C.gQ(-1,0,0),new C.gQ(0,0,1),new C.gQ(0,-1,0)),new Z("up",new C.gQ(0,1,0),new C.gQ(1,0,0),new C.gQ(0,0,1)),new Z("down",new C.gQ(0,-1,0),new C.gQ(1,0,0),new C.gQ(0,0,-1)),new Z("front",new C.gQ(0,0,1),new C.gQ(1,0,0),new C.gQ(0,-1,0)),new Z("back",new C.gQ(0,0,-1),new C.gQ(-1,0,0),new C.gQ(0,-1,0))],q.MAX_HDRI_VALUE=4096,q.PRESERVE_CLAMPED_COLORS=!1},11526:(F,b,Q)=>{Q.r(b),Q.d(b,{Dispose:()=>e,DumpData:()=>K,DumpDataAsync:()=>G,DumpFramebuffer:()=>q,DumpTools:()=>N});var C=Q(11410),z=Q(11128),t=Q(11329),g=Q(11161);let W,Z=null;async function q(F,b,Q,C){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",t=arguments.length>5?arguments[5]:void 0,g=arguments.length>6?arguments[6]:void 0;const W=await Q.readPixels(0,0,F,b);K(F,b,new Uint8Array(W.buffer),C,z,t,!0,void 0,g)}async function G(F,b,Q){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",z=arguments.length>4?arguments[4]:void 0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7?arguments[7]:void 0;return await new Promise((Z=>{K(F,b,Q,(F=>Z(F)),C,z,t,g,W)}))}function K(F,b,q,G){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",N=arguments.length>5?arguments[5]:void 0,y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8?arguments[8]:void 0;(async function(){return Z||(Z=new Promise(((F,b)=>{let z,t=null;const Z={Eb:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(Q.bind(Q,11446)).then((q=>{let{ThinEngine:G}=q;const K=g.d.Instances.length;try{z=new OffscreenCanvas(100,100),t=new G(z,!1,Z)}catch(E){var N;K<g.d.Instances.length&&(null===(N=g.d.Instances.pop())||void 0===N||N.dispose()),z=document.createElement("canvas"),t=new G(z,!1,Z)}g.d.Instances.pop(),g.d.OnEnginesDisposedObservable.add((F=>{t&&F!==t&&!t.G&&0===g.d.Instances.length&&e()})),t.getCaps().parallelShaderCompile=void 0;const y=new C.e(t);Q.e(52).then(Q.bind(Q,13733)).then((Q=>{let{passPixelShader:g}=Q;if(!t)return void b("Engine is not defined");const Z=new C.i({tQ:t,name:g.name,fragmentShader:g.shader,samplerNames:["textureSampler"]});W={canvas:z,tQ:t,renderer:y,wrapper:Z},F(W)}))})).catch(b)}))),await Z})().then((Q=>{if(Q.tQ.setSize(F,b,!0),q instanceof Float32Array){const F=new Uint8Array(q.length);let b=q.length;for(;b--;){const Q=q[b];F[b]=Math.round(255*(0,t.Clamp)(Q))}q=F}const C=Q.tQ.createRawTexture(q,F,b,5,!1,!y,1);Q.renderer.setViewport(),Q.renderer.applyEffectWrapper(Q.wrapper),Q.wrapper.effect._bindTexture("textureSampler",C),Q.renderer.draw(),E?z.Tools.ToBlob(Q.canvas,(F=>{const b=new FileReader;b.onload=F=>{const b=F.target.result;G&&G(b)},b.readAsArrayBuffer(F)}),K,c):z.Tools.EncodeScreenshotCanvasData(Q.canvas,G,K,N,c),C.dispose()}))}function e(){var F;W?(W.wrapper.dispose(),W.renderer.dispose(),W.tQ.dispose()):null===(F=Z)||void 0===F||F.then((F=>{F.wrapper.dispose(),F.renderer.dispose(),F.tQ.dispose()}));Z=null,W=null}const N={DumpData:K,DumpDataAsync:G,DumpFramebuffer:q,Dispose:e};z.Tools.DumpData=K,z.Tools.DumpDataAsync=G,z.Tools.DumpFramebuffer=q},11796:(F,b,Q)=>{Q.d(b,{e:()=>t});var C=Q(11401),z=Q(11529);class t{static ExpandRGBDTexture(F){const b=F._texture;if(!b||!F.isRGBD)return;const z=b.getEngine(),t=z.getCaps(),g=b.isReady;let W=!1;t.textureHalfFloatRender&&t.textureHalfFloatLinearFiltering?(W=!0,b.type=2):t.textureFloatRender&&t.textureFloatLinearFiltering&&(W=!0,b.type=1),W&&(b.isReady=!1,b._isRGBD=!1,b.invertY=!1);const Z=async()=>{const t=z.isWebGPU,g=t?1:0;b.isReady=!1,t?await Q.e(42).then(Q.bind(Q,14292)):await Q.e(35).then(Q.bind(Q,14298));const W=new C.b("rgbdDecode","rgbdDecode",null,null,1,null,3,z,!1,void 0,b.type,void 0,null,!1,void 0,g);W.externalTextureSamplerBinding=!0;const Z=z.createRenderTargetTexture(b.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:b.samplingMode,type:b.type,format:5});W.onEffectCreatedObservable.addOnce((Q=>{Q.executeWhenCompiled((()=>{W.onApply=F=>{F._bindTexture("textureSampler",b),F.setFloat2("scale",1,1)},F.RF().postProcessManager.directRender([W],Z,!0),z.restoreDefaultFramebuffer(),z._releaseTexture(b),W&&W.dispose(),Z._swapAndDie(b),b.isReady=!0}))}))};W&&(g?Z():F.onLoadObservable.addOnce(Z))}static async EncodeTextureToRGBD(F,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return b.getEngine().isWebGPU?await Q.e(43).then(Q.bind(Q,14309)):await Q.e(36).then(Q.bind(Q,14301)),await(0,z.c)("rgbdEncode",F,b,C,1,5)}}}}]);