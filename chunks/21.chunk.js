"use strict";(self.bjbkv7h3qsd=self.bjbkv7h3qsd||[]).push([[20,21],{11702:(G,A,j)=>{var u=j(11705),k=j(11240);k.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(k.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=u.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((G=>{this._texture._sphericalPolynomial=G,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(G){this._texture&&(this._texture._sphericalPolynomial=G)},enumerable:!0,configurable:!0})},11705:(G,A,j)=>{j.d(A,{c:()=>d});var u=j(11218),k=j(11237),B=j(11402),x=j(11222),s=j(11262);class O{constructor(G,A,j,u){this.name=G,this.worldAxisForNormal=A,this.worldAxisForFileX=j,this.worldAxisForFileY=u}}class d{static ConvertCubeMapTextureToSphericalPolynomial(G){var A;if(!G.isCube)return null;null===(A=G.gG())||void 0===A||A.getEngine().flushFramebuffer();const j=G.getSize().width,u=G.readPixels(0,void 0,void 0,!1),k=G.readPixels(1,void 0,void 0,!1);let B,x;G.isRenderTarget?(B=G.readPixels(3,void 0,void 0,!1),x=G.readPixels(2,void 0,void 0,!1)):(B=G.readPixels(2,void 0,void 0,!1),x=G.readPixels(3,void 0,void 0,!1));const s=G.readPixels(4,void 0,void 0,!1),O=G.readPixels(5,void 0,void 0,!1),d=G.gammaSpace;let h=0;return 1!=G.textureType&&2!=G.textureType||(h=1),new Promise((G=>{Promise.all([k,u,B,x,s,O]).then((A=>{let[u,k,B,x,s,O]=A;const H={size:j,right:k,left:u,up:B,down:x,front:s,back:O,format:5,type:h,gammaSpace:d};G(this.ConvertCubeMapToSphericalPolynomial(H))}))}))}static _AreaElement(G,A){return Math.atan2(G*A,Math.sqrt(G*G+A*A+1))}static ConvertCubeMapToSphericalPolynomial(G){const A=new B.e;let j=0;const u=2/G.size,O=u,d=.5*u,h=d-1;for(let B=0;B<6;B++){const H=this._FileFaces[B],F=G[H.name];let R=h;const U=5===G.format?4:3;for(let B=0;B<G.size;B++){let S=h;for(let O=0;O<G.size;O++){const h=H.worldAxisForFileX.scale(S).add(H.worldAxisForFileY.scale(R)).add(H.worldAxisForNormal);h.normalize();const C=this._AreaElement(S-d,R-d)-this._AreaElement(S-d,R+d)-this._AreaElement(S+d,R-d)+this._AreaElement(S+d,R+d);let t=F[B*G.size*U+O*U+0],Y=F[B*G.size*U+O*U+1],n=F[B*G.size*U+O*U+2];isNaN(t)&&(t=0),isNaN(Y)&&(Y=0),isNaN(n)&&(n=0),0===G.type&&(t/=255,Y/=255,n/=255),G.gammaSpace&&(t=Math.pow((0,k.Clamp)(t),x.j),Y=Math.pow((0,k.Clamp)(Y),x.j),n=Math.pow((0,k.Clamp)(n),x.j));const Q=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const G=Math.max(t,Y,n);if(G>Q){const A=Q/G;t*=A,Y*=A,n*=A}}else t=(0,k.Clamp)(t,0,Q),Y=(0,k.Clamp)(Y,0,Q),n=(0,k.Clamp)(n,0,Q);const X=new s.nA(t,Y,n);A.addLight(h,X,C),j+=C,S+=u}R+=O}}const H=6*(4*Math.PI)/6/j;return A.scaleInPlace(H),A.convertIncidentRadianceToIrradiance(),A.convertIrradianceToLambertianRadiance(),B.h.FromHarmonics(A)}}d._FileFaces=[new O("right",new u.SA(1,0,0),new u.SA(0,0,-1),new u.SA(0,-1,0)),new O("left",new u.SA(-1,0,0),new u.SA(0,0,1),new u.SA(0,-1,0)),new O("up",new u.SA(0,1,0),new u.SA(1,0,0),new u.SA(0,0,1)),new O("down",new u.SA(0,-1,0),new u.SA(1,0,0),new u.SA(0,0,-1)),new O("front",new u.SA(0,0,1),new u.SA(1,0,0),new u.SA(0,-1,0)),new O("back",new u.SA(0,0,-1),new u.SA(-1,0,0),new u.SA(0,-1,0))],d.MAX_HDRI_VALUE=4096,d.PRESERVE_CLAMPED_COLORS=!1},11441:(G,A,j)=>{j.r(A),j.d(A,{Dispose:()=>F,DumpData:()=>H,DumpDataAsync:()=>h,DumpFramebuffer:()=>d,DumpTools:()=>R});var u=j(11318),k=j(11043),B=j(11237),x=j(11085);let s,O=null;async function d(G,A,j,u){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",B=arguments.length>5?arguments[5]:void 0,x=arguments.length>6?arguments[6]:void 0;const s=await j.readPixels(0,0,G,A);H(G,A,new Uint8Array(s.buffer),u,k,B,!0,void 0,x)}async function h(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",k=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],x=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7?arguments[7]:void 0;return await new Promise((O=>{H(G,A,j,(G=>O(G)),u,k,B,x,s)}))}function H(G,A,d,h){let H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",R=arguments.length>5?arguments[5]:void 0,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]&&arguments[7],C=arguments.length>8?arguments[8]:void 0;(async function(){return O||(O=new Promise(((G,A)=>{let k,B=null;const O={o:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(j.bind(j,11352)).then((d=>{let{ThinEngine:h}=d;const H=x.d.Instances.length;try{k=new OffscreenCanvas(100,100),B=new h(k,!1,O)}catch(S){var R;H<x.d.Instances.length&&(null===(R=x.d.Instances.pop())||void 0===R||R.dispose()),k=document.createElement("canvas"),B=new h(k,!1,O)}x.d.Instances.pop(),x.d.OnEnginesDisposedObservable.add((G=>{B&&G!==B&&!B.H&&0===x.d.Instances.length&&F()})),B.getCaps().parallelShaderCompile=void 0;const U=new u.e(B);j.e(52).then(j.bind(j,13681)).then((j=>{let{passPixelShader:x}=j;if(!B)return void A("Engine is not defined");const O=new u.i({UA:B,name:x.name,fragmentShader:x.shader,samplerNames:["textureSampler"]});s={canvas:k,UA:B,renderer:U,wrapper:O},G(s)}))})).catch(A)}))),await O})().then((j=>{if(j.UA.setSize(G,A,!0),d instanceof Float32Array){const G=new Uint8Array(d.length);let A=d.length;for(;A--;){const j=d[A];G[A]=Math.round(255*(0,B.Clamp)(j))}d=G}const u=j.UA.createRawTexture(d,G,A,5,!1,!U,1);j.renderer.setViewport(),j.renderer.applyEffectWrapper(j.wrapper),j.wrapper.effect._bindTexture("textureSampler",u),j.renderer.draw(),S?k.Tools.ToBlob(j.canvas,(G=>{const A=new FileReader;A.onload=G=>{const A=G.target.result;h&&h(A)},A.readAsArrayBuffer(G)}),H,C):k.Tools.EncodeScreenshotCanvasData(j.canvas,h,H,R,C),u.dispose()}))}function F(){var G;s?(s.wrapper.dispose(),s.renderer.dispose(),s.UA.dispose()):null===(G=O)||void 0===G||G.then((G=>{G.wrapper.dispose(),G.renderer.dispose(),G.UA.dispose()}));O=null,s=null}const R={DumpData:H,DumpDataAsync:h,DumpFramebuffer:d,Dispose:F};k.Tools.DumpData=H,k.Tools.DumpDataAsync=h,k.Tools.DumpFramebuffer=d},11688:(G,A,j)=>{j.d(A,{e:()=>B});var u=j(11313),k=j(11447);class B{static ExpandRGBDTexture(G){const A=G._texture;if(!A||!G.isRGBD)return;const k=A.getEngine(),B=k.getCaps(),x=A.isReady;let s=!1;B.textureHalfFloatRender&&B.textureHalfFloatLinearFiltering?(s=!0,A.type=2):B.textureFloatRender&&B.textureFloatLinearFiltering&&(s=!0,A.type=1),s&&(A.isReady=!1,A._isRGBD=!1,A.invertY=!1);const O=async()=>{const B=k.isWebGPU,x=B?1:0;A.isReady=!1,B?await j.e(42).then(j.bind(j,14247)):await j.e(35).then(j.bind(j,14249));const s=new u.e("rgbdDecode","rgbdDecode",null,null,1,null,3,k,!1,void 0,A.type,void 0,null,!1,void 0,x);s.externalTextureSamplerBinding=!0;const O=k.createRenderTargetTexture(A.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:A.samplingMode,type:A.type,format:5});s.onEffectCreatedObservable.addOnce((j=>{j.executeWhenCompiled((()=>{s.onApply=G=>{G._bindTexture("textureSampler",A),G.setFloat2("scale",1,1)},G.gG().postProcessManager.directRender([s],O,!0),k.restoreDefaultFramebuffer(),k._releaseTexture(A),s&&s.dispose(),O._swapAndDie(A),A.isReady=!0}))}))};s&&(x?O():G.onLoadObservable.addOnce(O))}static async EncodeTextureToRGBD(G,A){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return A.getEngine().isWebGPU?await j.e(43).then(j.bind(j,14260)):await j.e(36).then(j.bind(j,14255)),await(0,k.c)("rgbdEncode",G,A,u,1,5)}}}}]);