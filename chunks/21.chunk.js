"use strict";(self["3b8bnhi4gzj"]=self["3b8bnhi4gzj"]||[]).push([[20,21],{12254:(Z,h,V)=>{var v=V(12260),A=V(11754);A.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(A.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=v.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((Z=>{this._texture._sphericalPolynomial=Z,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(Z){this._texture&&(this._texture._sphericalPolynomial=Z)},enumerable:!0,configurable:!0})},12260:(Z,h,V)=>{V.d(h,{c:()=>n});var v=V(11729),A=V(11748),H=V(11925),K=V(11737),d=V(11781);class a{constructor(Z,h,V,v){this.name=Z,this.worldAxisForNormal=h,this.worldAxisForFileX=V,this.worldAxisForFileY=v}}class n{static ConvertCubeMapTextureToSphericalPolynomial(Z){var h;if(!Z.isCube)return null;null===(h=Z.CZ())||void 0===h||h.getEngine().flushFramebuffer();const V=Z.getSize().width,v=Z.readPixels(0,void 0,void 0,!1),A=Z.readPixels(1,void 0,void 0,!1);let H,K;Z.isRenderTarget?(H=Z.readPixels(3,void 0,void 0,!1),K=Z.readPixels(2,void 0,void 0,!1)):(H=Z.readPixels(2,void 0,void 0,!1),K=Z.readPixels(3,void 0,void 0,!1));const d=Z.readPixels(4,void 0,void 0,!1),a=Z.readPixels(5,void 0,void 0,!1),n=Z.gammaSpace;let x=0;return 1!=Z.textureType&&2!=Z.textureType||(x=1),new Promise((Z=>{Promise.all([A,v,H,K,d,a]).then((h=>{let[v,A,H,K,d,a]=h;const N={size:V,right:A,left:v,up:H,down:K,front:d,back:a,format:5,type:x,gammaSpace:n};Z(this.ConvertCubeMapToSphericalPolynomial(N))}))}))}static _AreaElement(Z,h){return Math.atan2(Z*h,Math.sqrt(Z*Z+h*h+1))}static ConvertCubeMapToSphericalPolynomial(Z){const h=new H.d;let V=0;const v=2/Z.size,a=v,n=.5*v,x=n-1;for(let H=0;H<6;H++){const N=this._FileFaces[H],D=Z[N.name];let k=x;const u=5===Z.format?4:3;for(let H=0;H<Z.size;H++){let F=x;for(let a=0;a<Z.size;a++){const x=N.worldAxisForFileX.scale(F).add(N.worldAxisForFileY.scale(k)).add(N.worldAxisForNormal);x.normalize();const b=this._AreaElement(F-n,k-n)-this._AreaElement(F-n,k+n)-this._AreaElement(F+n,k-n)+this._AreaElement(F+n,k+n);let o=D[H*Z.size*u+a*u+0],q=D[H*Z.size*u+a*u+1],X=D[H*Z.size*u+a*u+2];isNaN(o)&&(o=0),isNaN(q)&&(q=0),isNaN(X)&&(X=0),0===Z.type&&(o/=255,q/=255,X/=255),Z.gammaSpace&&(o=Math.pow((0,A.Clamp)(o),K.k),q=Math.pow((0,A.Clamp)(q),K.k),X=Math.pow((0,A.Clamp)(X),K.k));const E=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const Z=Math.max(o,q,X);if(Z>E){const h=E/Z;o*=h,q*=h,X*=h}}else o=(0,A.Clamp)(o,0,E),q=(0,A.Clamp)(q,0,E),X=(0,A.Clamp)(X,0,E);const j=new d.Ih(o,q,X);h.addLight(x,j,b),V+=b,F+=v}k+=a}}const N=6*(4*Math.PI)/6/V;return h.scaleInPlace(N),h.convertIncidentRadianceToIrradiance(),h.convertIrradianceToLambertianRadiance(),H.g.FromHarmonics(h)}}n._FileFaces=[new a("right",new v.Ch(1,0,0),new v.Ch(0,0,-1),new v.Ch(0,-1,0)),new a("left",new v.Ch(-1,0,0),new v.Ch(0,0,1),new v.Ch(0,-1,0)),new a("up",new v.Ch(0,1,0),new v.Ch(1,0,0),new v.Ch(0,0,1)),new a("down",new v.Ch(0,-1,0),new v.Ch(1,0,0),new v.Ch(0,0,-1)),new a("front",new v.Ch(0,0,1),new v.Ch(1,0,0),new v.Ch(0,-1,0)),new a("back",new v.Ch(0,0,-1),new v.Ch(-1,0,0),new v.Ch(0,-1,0))],n.MAX_HDRI_VALUE=4096,n.PRESERVE_CLAMPED_COLORS=!1},11971:(Z,h,V)=>{V.r(h),V.d(h,{Dispose:()=>D,DumpData:()=>N,DumpDataAsync:()=>x,DumpFramebuffer:()=>n,DumpTools:()=>k});var v=V(11850),A=V(11564),H=V(11748),K=V(11599);let d,a=null;async function n(Z,h,V,v){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",H=arguments.length>5?arguments[5]:void 0,K=arguments.length>6?arguments[6]:void 0;const d=await V.readPixels(0,0,Z,h);N(Z,h,new Uint8Array(d.buffer),v,A,H,!0,void 0,K)}async function x(Z,h,V){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",A=arguments.length>4?arguments[4]:void 0,H=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7?arguments[7]:void 0;return await new Promise((a=>{N(Z,h,V,(Z=>a(Z)),v,A,H,K,d)}))}function N(Z,h,n,x){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",k=arguments.length>5?arguments[5]:void 0,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]&&arguments[7],b=arguments.length>8?arguments[8]:void 0;(async function(){return a||(a=new Promise(((Z,h)=>{let A,H=null;const a={o:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(V.bind(V,11872)).then((n=>{let{ThinEngine:x}=n;const N=K.b.Instances.length;try{A=new OffscreenCanvas(100,100),H=new x(A,!1,a)}catch(F){var k;N<K.b.Instances.length&&(null===(k=K.b.Instances.pop())||void 0===k||k.dispose()),A=document.createElement("canvas"),H=new x(A,!1,a)}K.b.Instances.pop(),K.b.OnEnginesDisposedObservable.add((Z=>{H&&Z!==H&&!H.K&&0===K.b.Instances.length&&D()})),H.getCaps().parallelShaderCompile=void 0;const u=new v.e(H);V.e(52).then(V.bind(V,14279)).then((V=>{let{passPixelShader:K}=V;if(!H)return void h("Engine is not defined");const a=new v.g({Ph:H,name:K.name,fragmentShader:K.shader,samplerNames:["textureSampler"]});d={canvas:A,Ph:H,renderer:u,wrapper:a},Z(d)}))})).catch(h)}))),await a})().then((V=>{if(V.Ph.setSize(Z,h,!0),n instanceof Float32Array){const Z=new Uint8Array(n.length);let h=n.length;for(;h--;){const V=n[h];Z[h]=Math.round(255*(0,H.Clamp)(V))}n=Z}const v=V.Ph.createRawTexture(n,Z,h,5,!1,!u,1);V.renderer.setViewport(),V.renderer.applyEffectWrapper(V.wrapper),V.wrapper.effect._bindTexture("textureSampler",v),V.renderer.draw(),F?A.Tools.ToBlob(V.canvas,(Z=>{const h=new FileReader;h.onload=Z=>{const h=Z.target.result;x&&x(h)},h.readAsArrayBuffer(Z)}),N,b):A.Tools.EncodeScreenshotCanvasData(V.canvas,x,N,k,b),v.dispose()}))}function D(){var Z;d?(d.wrapper.dispose(),d.renderer.dispose(),d.Ph.dispose()):null===(Z=a)||void 0===Z||Z.then((Z=>{Z.wrapper.dispose(),Z.renderer.dispose(),Z.Ph.dispose()}));a=null,d=null}const k={DumpData:N,DumpDataAsync:x,DumpFramebuffer:n,Dispose:D};A.Tools.DumpData=N,A.Tools.DumpDataAsync=x,A.Tools.DumpFramebuffer=n},12243:(Z,h,V)=>{V.d(h,{d:()=>H});var v=V(11842),A=V(11975);class H{static ExpandRGBDTexture(Z){const h=Z._texture;if(!h||!Z.isRGBD)return;const A=h.getEngine(),H=A.getCaps(),K=h.isReady;let d=!1;H.textureHalfFloatRender&&H.textureHalfFloatLinearFiltering?(d=!0,h.type=2):H.textureFloatRender&&H.textureFloatLinearFiltering&&(d=!0,h.type=1),d&&(h.isReady=!1,h._isRGBD=!1,h.invertY=!1);const a=async()=>{const H=A.isWebGPU,K=H?1:0;h.isReady=!1,H?await V.e(42).then(V.bind(V,14817)):await V.e(35).then(V.bind(V,14826));const d=new v.d("rgbdDecode","rgbdDecode",null,null,1,null,3,A,!1,void 0,h.type,void 0,null,!1,void 0,K);d.externalTextureSamplerBinding=!0;const a=A.createRenderTargetTexture(h.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:h.samplingMode,type:h.type,format:5});d.onEffectCreatedObservable.addOnce((V=>{V.executeWhenCompiled((()=>{d.onApply=Z=>{Z._bindTexture("textureSampler",h),Z.setFloat2("scale",1,1)},Z.CZ().postProcessManager.directRender([d],a,!0),A.restoreDefaultFramebuffer(),A._releaseTexture(h),d&&d.dispose(),a._swapAndDie(h),h.isReady=!0}))}))};d&&(K?a():Z.onLoadObservable.addOnce(a))}static async EncodeTextureToRGBD(Z,h){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return h.getEngine().isWebGPU?await V.e(43).then(V.bind(V,14840)):await V.e(36).then(V.bind(V,14834)),await(0,A.b)("rgbdEncode",Z,h,v,1,5)}}}}]);