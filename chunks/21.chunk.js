"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[20,21],{11622:(q,S,b)=>{var z=b(11625),C=b(11128);C.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(C.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=z.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((q=>{this._texture._sphericalPolynomial=q,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(q){this._texture&&(this._texture._sphericalPolynomial=q)},enumerable:!0,configurable:!0})},11625:(q,S,b)=>{b.d(S,{d:()=>I});var z=b(11103),C=b(11121),v=b(11291),U=b(11109),g=b(11150);class r{constructor(q,S,b,z){this.name=q,this.worldAxisForNormal=S,this.worldAxisForFileX=b,this.worldAxisForFileY=z}}class I{static ConvertCubeMapTextureToSphericalPolynomial(q){var S;if(!q.isCube)return null;null===(S=q.Tq())||void 0===S||S.getEngine().flushFramebuffer();const b=q.getSize().width,z=q.readPixels(0,void 0,void 0,!1),C=q.readPixels(1,void 0,void 0,!1);let v,U;q.isRenderTarget?(v=q.readPixels(3,void 0,void 0,!1),U=q.readPixels(2,void 0,void 0,!1)):(v=q.readPixels(2,void 0,void 0,!1),U=q.readPixels(3,void 0,void 0,!1));const g=q.readPixels(4,void 0,void 0,!1),r=q.readPixels(5,void 0,void 0,!1),I=q.gammaSpace;let V=0;return 1!=q.textureType&&2!=q.textureType||(V=1),new Promise((q=>{Promise.all([C,z,v,U,g,r]).then((S=>{let[z,C,v,U,g,r]=S;const l={size:b,right:C,left:z,up:v,down:U,front:g,back:r,format:5,type:V,gammaSpace:I};q(this.ConvertCubeMapToSphericalPolynomial(l))}))}))}static _AreaElement(q,S){return Math.atan2(q*S,Math.sqrt(q*q+S*S+1))}static ConvertCubeMapToSphericalPolynomial(q){const S=new v.b;let b=0;const z=2/q.size,r=z,I=.5*z,V=I-1;for(let v=0;v<6;v++){const l=this._FileFaces[v],y=q[l.name];let R=V;const G=5===q.format?4:3;for(let v=0;v<q.size;v++){let Z=V;for(let r=0;r<q.size;r++){const V=l.worldAxisForFileX.scale(Z).add(l.worldAxisForFileY.scale(R)).add(l.worldAxisForNormal);V.normalize();const H=this._AreaElement(Z-I,R-I)-this._AreaElement(Z-I,R+I)-this._AreaElement(Z+I,R-I)+this._AreaElement(Z+I,R+I);let Q=y[v*q.size*G+r*G+0],k=y[v*q.size*G+r*G+1],W=y[v*q.size*G+r*G+2];isNaN(Q)&&(Q=0),isNaN(k)&&(k=0),isNaN(W)&&(W=0),0===q.type&&(Q/=255,k/=255,W/=255),q.gammaSpace&&(Q=Math.pow((0,C.Clamp)(Q),U.j),k=Math.pow((0,C.Clamp)(k),U.j),W=Math.pow((0,C.Clamp)(W),U.j));const N=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const q=Math.max(Q,k,W);if(q>N){const S=N/q;Q*=S,k*=S,W*=S}}else Q=(0,C.Clamp)(Q,0,N),k=(0,C.Clamp)(k,0,N),W=(0,C.Clamp)(W,0,N);const u=new g.HS(Q,k,W);S.addLight(V,u,H),b+=H,Z+=z}R+=r}}const l=6*(4*Math.PI)/6/b;return S.scaleInPlace(l),S.convertIncidentRadianceToIrradiance(),S.convertIrradianceToLambertianRadiance(),v.c.FromHarmonics(S)}}I._FileFaces=[new r("right",new z.yS(1,0,0),new z.yS(0,0,-1),new z.yS(0,-1,0)),new r("left",new z.yS(-1,0,0),new z.yS(0,0,1),new z.yS(0,-1,0)),new r("up",new z.yS(0,1,0),new z.yS(1,0,0),new z.yS(0,0,1)),new r("down",new z.yS(0,-1,0),new z.yS(1,0,0),new z.yS(0,0,-1)),new r("front",new z.yS(0,0,1),new z.yS(1,0,0),new z.yS(0,-1,0)),new r("back",new z.yS(0,0,-1),new z.yS(-1,0,0),new z.yS(0,-1,0))],I.MAX_HDRI_VALUE=4096,I.PRESERVE_CLAMPED_COLORS=!1},11325:(q,S,b)=>{b.r(S),b.d(S,{Dispose:()=>y,DumpData:()=>l,DumpDataAsync:()=>V,DumpFramebuffer:()=>I,DumpTools:()=>R});var z=b(11208),C=b(10921),v=b(11121),U=b(10975);let g,r=null;async function I(q,S,b,z){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",v=arguments.length>5?arguments[5]:void 0,U=arguments.length>6?arguments[6]:void 0;const g=await b.readPixels(0,0,q,S);l(q,S,new Uint8Array(g.buffer),z,C,v,!0,void 0,U)}async function V(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",C=arguments.length>4?arguments[4]:void 0,v=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7?arguments[7]:void 0;return await new Promise((r=>{l(q,S,b,(q=>r(q)),z,C,v,U,g)}))}function l(q,S,I,V){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",R=arguments.length>5?arguments[5]:void 0,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],H=arguments.length>8?arguments[8]:void 0;(async function(){return r||(r=new Promise(((q,S)=>{let C,v=null;const r={yb:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(b.bind(b,11239)).then((I=>{let{ThinEngine:V}=I;const l=U.b.Instances.length;try{C=new OffscreenCanvas(100,100),v=new V(C,!1,r)}catch(Z){var R;l<U.b.Instances.length&&(null===(R=U.b.Instances.pop())||void 0===R||R.dispose()),C=document.createElement("canvas"),v=new V(C,!1,r)}U.b.Instances.pop(),U.b.OnEnginesDisposedObservable.add((q=>{v&&q!==v&&!v.V&&0===U.b.Instances.length&&y()})),v.getCaps().parallelShaderCompile=void 0;const G=new z.c(v);b.e(52).then(b.bind(b,13605)).then((b=>{let{passPixelShader:U}=b;if(!v)return void S("Engine is not defined");const r=new z.e({lS:v,name:U.name,fragmentShader:U.shader,samplerNames:["textureSampler"]});g={canvas:C,lS:v,renderer:G,wrapper:r},q(g)}))})).catch(S)}))),await r})().then((b=>{if(b.lS.setSize(q,S,!0),I instanceof Float32Array){const q=new Uint8Array(I.length);let S=I.length;for(;S--;){const b=I[S];q[S]=Math.round(255*(0,v.Clamp)(b))}I=q}const z=b.lS.createRawTexture(I,q,S,5,!1,!G,1);b.renderer.setViewport(),b.renderer.applyEffectWrapper(b.wrapper),b.wrapper.effect._bindTexture("textureSampler",z),b.renderer.draw(),Z?C.Tools.ToBlob(b.canvas,(q=>{const S=new FileReader;S.onload=q=>{const S=q.target.result;V&&V(S)},S.readAsArrayBuffer(q)}),l,H):C.Tools.EncodeScreenshotCanvasData(b.canvas,V,l,R,H),z.dispose()}))}function y(){var q;g?(g.wrapper.dispose(),g.renderer.dispose(),g.lS.dispose()):null===(q=r)||void 0===q||q.then((q=>{q.wrapper.dispose(),q.renderer.dispose(),q.lS.dispose()}));r=null,g=null}const R={DumpData:l,DumpDataAsync:V,DumpFramebuffer:I,Dispose:y};C.Tools.DumpData=l,C.Tools.DumpDataAsync=V,C.Tools.DumpFramebuffer=I},11607:(q,S,b)=>{b.d(S,{e:()=>v});var z=b(11206),C=b(11329);class v{static ExpandRGBDTexture(q){const S=q._texture;if(!S||!q.isRGBD)return;const C=S.getEngine(),v=C.getCaps(),U=S.isReady;let g=!1;v.textureHalfFloatRender&&v.textureHalfFloatLinearFiltering?(g=!0,S.type=2):v.textureFloatRender&&v.textureFloatLinearFiltering&&(g=!0,S.type=1),g&&(S.isReady=!1,S._isRGBD=!1,S.invertY=!1);const r=async()=>{const v=C.isWebGPU,U=v?1:0;S.isReady=!1,v?await b.e(42).then(b.bind(b,14152)):await b.e(35).then(b.bind(b,14154));const g=new z.d("rgbdDecode","rgbdDecode",null,null,1,null,3,C,!1,void 0,S.type,void 0,null,!1,void 0,U);g.externalTextureSamplerBinding=!0;const r=C.createRenderTargetTexture(S.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:S.samplingMode,type:S.type,format:5});g.onEffectCreatedObservable.addOnce((b=>{b.executeWhenCompiled((()=>{g.onApply=q=>{q._bindTexture("textureSampler",S),q.setFloat2("scale",1,1)},q.Tq().postProcessManager.directRender([g],r,!0),C.restoreDefaultFramebuffer(),C._releaseTexture(S),g&&g.dispose(),r._swapAndDie(S),S.isReady=!0}))}))};g&&(U?r():q.onLoadObservable.addOnce(r))}static async EncodeTextureToRGBD(q,S){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return S.getEngine().isWebGPU?await b.e(43).then(b.bind(b,14164)):await b.e(36).then(b.bind(b,14160)),await(0,C.b)("rgbdEncode",q,S,z,1,5)}}}}]);