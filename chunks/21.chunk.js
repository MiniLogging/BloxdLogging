"use strict";(self.fwuvyyymhp8=self.fwuvyyymhp8||[]).push([[20,21],{12866:(N,U,V)=>{var A=V(12871),t=V(12402);t.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(t.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=A.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((N=>{this._texture._sphericalPolynomial=N,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(N){this._texture&&(this._texture._sphericalPolynomial=N)},enumerable:!0,configurable:!0})},12871:(N,U,V)=>{V.d(U,{d:()=>S});var A=V(12383),t=V(12395),n=V(12559),q=V(12389),i=V(12426);class z{constructor(N,U,V,A){this.name=N,this.worldAxisForNormal=U,this.worldAxisForFileX=V,this.worldAxisForFileY=A}}class S{static ConvertCubeMapTextureToSphericalPolynomial(N){var U;if(!N.isCube)return null;null===(U=N.YN())||void 0===U||U.getEngine().flushFramebuffer();const V=N.getSize().width,A=N.readPixels(0,void 0,void 0,!1),t=N.readPixels(1,void 0,void 0,!1);let n,q;N.isRenderTarget?(n=N.readPixels(3,void 0,void 0,!1),q=N.readPixels(2,void 0,void 0,!1)):(n=N.readPixels(2,void 0,void 0,!1),q=N.readPixels(3,void 0,void 0,!1));const i=N.readPixels(4,void 0,void 0,!1),z=N.readPixels(5,void 0,void 0,!1),S=N.gammaSpace;let E=0;return 1!=N.textureType&&2!=N.textureType||(E=1),new Promise((N=>{Promise.all([t,A,n,q,i,z]).then((U=>{let[A,t,n,q,i,z]=U;const p={size:V,right:t,left:A,up:n,down:q,front:i,back:z,format:5,type:E,gammaSpace:S};N(this.ConvertCubeMapToSphericalPolynomial(p))}))}))}static _AreaElement(N,U){return Math.atan2(N*U,Math.sqrt(N*N+U*U+1))}static ConvertCubeMapToSphericalPolynomial(N){const U=new n.c;let V=0;const A=2/N.size,z=A,S=.5*A,E=S-1;for(let n=0;n<6;n++){const p=this._FileFaces[n],k=N[p.name];let B=E;const C=5===N.format?4:3;for(let n=0;n<N.size;n++){let x=E;for(let z=0;z<N.size;z++){const E=p.worldAxisForFileX.scale(x).add(p.worldAxisForFileY.scale(B)).add(p.worldAxisForNormal);E.normalize();const J=this._AreaElement(x-S,B-S)-this._AreaElement(x-S,B+S)-this._AreaElement(x+S,B-S)+this._AreaElement(x+S,B+S);let d=k[n*N.size*C+z*C+0],r=k[n*N.size*C+z*C+1],v=k[n*N.size*C+z*C+2];isNaN(d)&&(d=0),isNaN(r)&&(r=0),isNaN(v)&&(v=0),0===N.type&&(d/=255,r/=255,v/=255),N.gammaSpace&&(d=Math.pow((0,t.Clamp)(d),q.n),r=Math.pow((0,t.Clamp)(r),q.n),v=Math.pow((0,t.Clamp)(v),q.n));const h=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const N=Math.max(d,r,v);if(N>h){const U=h/N;d*=U,r*=U,v*=U}}else d=(0,t.Clamp)(d,0,h),r=(0,t.Clamp)(r,0,h),v=(0,t.Clamp)(v,0,h);const c=new i.rU(d,r,v);U.addLight(E,c,J),V+=J,x+=A}B+=z}}const p=6*(4*Math.PI)/6/V;return U.scaleInPlace(p),U.convertIncidentRadianceToIrradiance(),U.convertIrradianceToLambertianRadiance(),n.d.FromHarmonics(U)}}S._FileFaces=[new z("right",new A.CU(1,0,0),new A.CU(0,0,-1),new A.CU(0,-1,0)),new z("left",new A.CU(-1,0,0),new A.CU(0,0,1),new A.CU(0,-1,0)),new z("up",new A.CU(0,1,0),new A.CU(1,0,0),new A.CU(0,0,1)),new z("down",new A.CU(0,-1,0),new A.CU(1,0,0),new A.CU(0,0,-1)),new z("front",new A.CU(0,0,1),new A.CU(1,0,0),new A.CU(0,-1,0)),new z("back",new A.CU(0,0,-1),new A.CU(-1,0,0),new A.CU(0,-1,0))],S.MAX_HDRI_VALUE=4096,S.PRESERVE_CLAMPED_COLORS=!1},12584:(N,U,V)=>{V.r(U),V.d(U,{Dispose:()=>k,DumpData:()=>p,DumpDataAsync:()=>E,DumpFramebuffer:()=>S,DumpTools:()=>B});var A=V(12491),t=V(12179),n=V(12395),q=V(12223);let i,z=null;async function S(N,U,V,A){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",n=arguments.length>5?arguments[5]:void 0,q=arguments.length>6?arguments[6]:void 0;const i=await V.readPixels(0,0,N,U);p(N,U,new Uint8Array(i.buffer),A,t,n,!0,void 0,q)}async function E(N,U,V){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",t=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7?arguments[7]:void 0;return await new Promise((z=>{p(N,U,V,(N=>z(N)),A,t,n,q,i)}))}function p(N,U,S,E){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",B=arguments.length>5?arguments[5]:void 0,C=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7&&void 0!==arguments[7]&&arguments[7],J=arguments.length>8?arguments[8]:void 0;(async function(){return z||(z=new Promise(((N,U)=>{let t,n=null;const z={zi:!0,depth:!1,ti:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(V.bind(V,12514)).then((S=>{let{ThinEngine:E}=S;const p=q.e.Instances.length;try{t=new OffscreenCanvas(100,100),n=new E(t,!1,z)}catch(x){var B;p<q.e.Instances.length&&(null===(B=q.e.Instances.pop())||void 0===B||B.dispose()),t=document.createElement("canvas"),n=new E(t,!1,z)}q.e.Instances.pop(),q.e.OnEnginesDisposedObservable.add((N=>{n&&N!==n&&!n.S&&0===q.e.Instances.length&&k()})),n.getCaps().parallelShaderCompile=void 0;const C=new A.d(n);V.e(52).then(V.bind(V,14841)).then((V=>{let{passPixelShader:q}=V;if(!n)return void U("Engine is not defined");const z=new A.f({BU:n,name:q.name,fragmentShader:q.shader,samplerNames:["textureSampler"]});i={canvas:t,BU:n,renderer:C,wrapper:z},N(i)}))})).catch(U)}))),await z})().then((V=>{if(V.BU.setSize(N,U,!0),S instanceof Float32Array){const N=new Uint8Array(S.length);let U=S.length;for(;U--;){const V=S[U];N[U]=Math.round(255*(0,n.Clamp)(V))}S=N}const A=V.BU.createRawTexture(S,N,U,5,!1,!C,1);V.renderer.setViewport(),V.renderer.applyEffectWrapper(V.wrapper),V.wrapper.effect._bindTexture("textureSampler",A),V.renderer.draw(),x?t.Tools.ToBlob(V.canvas,(N=>{const U=new FileReader;U.onload=N=>{const U=N.target.result;E&&E(U)},U.readAsArrayBuffer(N)}),p,J):t.Tools.EncodeScreenshotCanvasData(V.canvas,E,p,B,J),A.dispose()}))}function k(){var N;i?(i.wrapper.dispose(),i.renderer.dispose(),i.BU.dispose()):null===(N=z)||void 0===N||N.then((N=>{N.wrapper.dispose(),N.renderer.dispose(),N.BU.dispose()}));z=null,i=null}const B={DumpData:p,DumpDataAsync:E,DumpFramebuffer:S,Dispose:k};t.Tools.DumpData=p,t.Tools.DumpDataAsync=E,t.Tools.DumpFramebuffer=S},12850:(N,U,V)=>{V.d(U,{d:()=>n});var A=V(12485),t=V(12593);class n{static ExpandRGBDTexture(N){const U=N._texture;if(!U||!N.isRGBD)return;const t=U.getEngine(),n=t.getCaps(),q=U.isReady;let i=!1;n.textureHalfFloatRender&&n.textureHalfFloatLinearFiltering?(i=!0,U.type=2):n.textureFloatRender&&n.textureFloatLinearFiltering&&(i=!0,U.type=1),i&&(U.isReady=!1,U._isRGBD=!1,U.invertY=!1);const z=async()=>{const n=t.isWebGPU,q=n?1:0;U.isReady=!1,n?await V.e(42).then(V.bind(V,15405)):await V.e(35).then(V.bind(V,15410));const i=new A.c("rgbdDecode","rgbdDecode",null,null,1,null,3,t,!1,void 0,U.type,void 0,null,!1,void 0,q);i.externalTextureSamplerBinding=!0;const z=t.createRenderTargetTexture(U.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:U.samplingMode,type:U.type,format:5});i.onEffectCreatedObservable.addOnce((V=>{V.executeWhenCompiled((()=>{i.onApply=N=>{N._bindTexture("textureSampler",U),N.setFloat2("scale",1,1)},N.YN().postProcessManager.directRender([i],z,!0),t.restoreDefaultFramebuffer(),t._releaseTexture(U),i&&i.dispose(),z._swapAndDie(U),U.isReady=!0}))}))};i&&(q?z():N.onLoadObservable.addOnce(z))}static async EncodeTextureToRGBD(N,U){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return U.getEngine().isWebGPU?await V.e(43).then(V.bind(V,15420)):await V.e(36).then(V.bind(V,15417)),await(0,t.b)("rgbdEncode",N,U,A,1,5)}}}}]);