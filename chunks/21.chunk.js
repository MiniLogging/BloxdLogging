"use strict";(self.qcdfysujsyf=self.qcdfysujsyf||[]).push([[20,21],{13219:(K,A,T)=>{var G=T(13222),B=T(12722);B.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(B.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=G.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((K=>{this._texture._sphericalPolynomial=K,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(K){this._texture&&(this._texture._sphericalPolynomial=K)},enumerable:!0,configurable:!0})},13222:(K,A,T)=>{T.d(A,{e:()=>Q});var G=T(12700),B=T(12716),L=T(12883),f=T(12706),O=T(12743);class C{constructor(K,A,T,G){this.name=K,this.worldAxisForNormal=A,this.worldAxisForFileX=T,this.worldAxisForFileY=G}}class Q{static ConvertCubeMapTextureToSphericalPolynomial(K){var A;if(!K.isCube)return null;null===(A=K.SK())||void 0===A||A.getEngine().flushFramebuffer();const T=K.getSize().width,G=K.readPixels(0,void 0,void 0,!1),B=K.readPixels(1,void 0,void 0,!1);let L,f;K.isRenderTarget?(L=K.readPixels(3,void 0,void 0,!1),f=K.readPixels(2,void 0,void 0,!1)):(L=K.readPixels(2,void 0,void 0,!1),f=K.readPixels(3,void 0,void 0,!1));const O=K.readPixels(4,void 0,void 0,!1),C=K.readPixels(5,void 0,void 0,!1),Q=K.gammaSpace;let Y=0;return 1!=K.textureType&&2!=K.textureType||(Y=1),new Promise((K=>{Promise.all([B,G,L,f,O,C]).then((A=>{let[G,B,L,f,O,C]=A;const Z={size:T,right:B,left:G,up:L,down:f,front:O,back:C,format:5,type:Y,gammaSpace:Q};K(this.ConvertCubeMapToSphericalPolynomial(Z))}))}))}static _AreaElement(K,A){return Math.atan2(K*A,Math.sqrt(K*K+A*A+1))}static ConvertCubeMapToSphericalPolynomial(K){const A=new L.e;let T=0;const G=2/K.size,C=G,Q=.5*G,Y=Q-1;for(let L=0;L<6;L++){const Z=this._FileFaces[L],x=K[Z.name];let J=Y;const b=5===K.format?4:3;for(let L=0;L<K.size;L++){let P=Y;for(let C=0;C<K.size;C++){const Y=Z.worldAxisForFileX.scale(P).add(Z.worldAxisForFileY.scale(J)).add(Z.worldAxisForNormal);Y.normalize();const F=this._AreaElement(P-Q,J-Q)-this._AreaElement(P-Q,J+Q)-this._AreaElement(P+Q,J-Q)+this._AreaElement(P+Q,J+Q);let d=x[L*K.size*b+C*b+0],N=x[L*K.size*b+C*b+1],D=x[L*K.size*b+C*b+2];isNaN(d)&&(d=0),isNaN(N)&&(N=0),isNaN(D)&&(D=0),0===K.type&&(d/=255,N/=255,D/=255),K.gammaSpace&&(d=Math.pow((0,B.Clamp)(d),f.k),N=Math.pow((0,B.Clamp)(N),f.k),D=Math.pow((0,B.Clamp)(D),f.k));const mK=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const K=Math.max(d,N,D);if(K>mK){const A=mK/K;d*=A,N*=A,D*=A}}else d=(0,B.Clamp)(d,0,mK),N=(0,B.Clamp)(N,0,mK),D=(0,B.Clamp)(D,0,mK);const U=new O.DA(d,N,D);A.addLight(Y,U,F),T+=F,P+=G}J+=C}}const Z=6*(4*Math.PI)/6/T;return A.scaleInPlace(Z),A.convertIncidentRadianceToIrradiance(),A.convertIrradianceToLambertianRadiance(),L.g.FromHarmonics(A)}}Q._FileFaces=[new C("right",new G.PA(1,0,0),new G.PA(0,0,-1),new G.PA(0,-1,0)),new C("left",new G.PA(-1,0,0),new G.PA(0,0,1),new G.PA(0,-1,0)),new C("up",new G.PA(0,1,0),new G.PA(1,0,0),new G.PA(0,0,1)),new C("down",new G.PA(0,-1,0),new G.PA(1,0,0),new G.PA(0,0,-1)),new C("front",new G.PA(0,0,1),new G.PA(1,0,0),new G.PA(0,-1,0)),new C("back",new G.PA(0,0,-1),new G.PA(-1,0,0),new G.PA(0,-1,0))],Q.MAX_HDRI_VALUE=4096,Q.PRESERVE_CLAMPED_COLORS=!1},12915:(K,A,T)=>{T.r(A),T.d(A,{Dispose:()=>x,DumpData:()=>Z,DumpDataAsync:()=>Y,DumpFramebuffer:()=>Q,DumpTools:()=>J});var G=T(12794),B=T(12526),L=T(12716),f=T(12565);let O,C=null;async function Q(K,A,T,G){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",L=arguments.length>5?arguments[5]:void 0,f=arguments.length>6?arguments[6]:void 0;const O=await T.readPixels(0,0,K,A);Z(K,A,new Uint8Array(O.buffer),G,B,L,!0,void 0,f)}async function Y(K,A,T){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",B=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7?arguments[7]:void 0;return await new Promise((C=>{Z(K,A,T,(K=>C(K)),G,B,L,f,O)}))}function Z(K,A,Q,Y){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",J=arguments.length>5?arguments[5]:void 0,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7&&void 0!==arguments[7]&&arguments[7],F=arguments.length>8?arguments[8]:void 0;(async function(){return C||(C=new Promise(((K,A)=>{let B,L=null;const C={cf:!0,depth:!1,df:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(T.bind(T,12832)).then((Q=>{let{ThinEngine:Y}=Q;const Z=f.b.Instances.length;try{B=new OffscreenCanvas(100,100),L=new Y(B,!1,C)}catch(P){var J;Z<f.b.Instances.length&&(null===(J=f.b.Instances.pop())||void 0===J||J.dispose()),B=document.createElement("canvas"),L=new Y(B,!1,C)}f.b.Instances.pop(),f.b.OnEnginesDisposedObservable.add((K=>{L&&K!==L&&!L.O&&0===f.b.Instances.length&&x()})),L.getCaps().parallelShaderCompile=void 0;const b=new G.e(L);T.e(52).then(T.bind(T,15178)).then((T=>{let{passPixelShader:f}=T;if(!L)return void A("Engine is not defined");const C=new G.g({bA:L,name:f.name,fragmentShader:f.shader,samplerNames:["textureSampler"]});O={canvas:B,bA:L,renderer:b,wrapper:C},K(O)}))})).catch(A)}))),await C})().then((T=>{if(T.bA.setSize(K,A,!0),Q instanceof Float32Array){const K=new Uint8Array(Q.length);let A=Q.length;for(;A--;){const T=Q[A];K[A]=Math.round(255*(0,L.Clamp)(T))}Q=K}const G=T.bA.createRawTexture(Q,K,A,5,!1,!b,1);T.renderer.setViewport(),T.renderer.applyEffectWrapper(T.wrapper),T.wrapper.effect._bindTexture("textureSampler",G),T.renderer.draw(),P?B.Tools.ToBlob(T.canvas,(K=>{const A=new FileReader;A.onload=K=>{const A=K.target.result;Y&&Y(A)},A.readAsArrayBuffer(K)}),Z,F):B.Tools.EncodeScreenshotCanvasData(T.canvas,Y,Z,J,F),G.dispose()}))}function x(){var K;O?(O.wrapper.dispose(),O.renderer.dispose(),O.bA.dispose()):null===(K=C)||void 0===K||K.then((K=>{K.wrapper.dispose(),K.renderer.dispose(),K.bA.dispose()}));C=null,O=null}const J={DumpData:Z,DumpDataAsync:Y,DumpFramebuffer:Q,Dispose:x};B.Tools.DumpData=Z,B.Tools.DumpDataAsync=Y,B.Tools.DumpFramebuffer=Q},13206:(K,A,T)=>{T.d(A,{c:()=>L});var G=T(12788),B=T(12920);class L{static ExpandRGBDTexture(K){const A=K._texture;if(!A||!K.isRGBD)return;const B=A.getEngine(),L=B.getCaps(),f=A.isReady;let O=!1;L.textureHalfFloatRender&&L.textureHalfFloatLinearFiltering?(O=!0,A.type=2):L.textureFloatRender&&L.textureFloatLinearFiltering&&(O=!0,A.type=1),O&&(A.isReady=!1,A._isRGBD=!1,A.invertY=!1);const C=async()=>{const L=B.isWebGPU,f=L?1:0;A.isReady=!1,L?await T.e(42).then(T.bind(T,15705)):await T.e(35).then(T.bind(T,15708));const O=new G.d("rgbdDecode","rgbdDecode",null,null,1,null,3,B,!1,void 0,A.type,void 0,null,!1,void 0,f);O.externalTextureSamplerBinding=!0;const C=B.createRenderTargetTexture(A.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:A.samplingMode,type:A.type,format:5});O.onEffectCreatedObservable.addOnce((T=>{T.executeWhenCompiled((()=>{O.onApply=K=>{K._bindTexture("textureSampler",A),K.setFloat2("scale",1,1)},K.SK().postProcessManager.directRender([O],C,!0),B.restoreDefaultFramebuffer(),B._releaseTexture(A),O&&O.dispose(),C._swapAndDie(A),A.isReady=!0}))}))};O&&(f?C():K.onLoadObservable.addOnce(C))}static async EncodeTextureToRGBD(K,A){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return A.getEngine().isWebGPU?await T.e(43).then(T.bind(T,15718)):await T.e(36).then(T.bind(T,15714)),await(0,B.d)("rgbdEncode",K,A,G,1,5)}}}}]);