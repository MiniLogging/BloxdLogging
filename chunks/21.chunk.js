"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[20,21],{11697:(B,I,C)=>{var M=C(11703),x=C(11217);x.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(x.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=M.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((B=>{this._texture._sphericalPolynomial=B,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(B){this._texture&&(this._texture._sphericalPolynomial=B)},enumerable:!0,configurable:!0})},11703:(B,I,C)=>{C.d(I,{e:()=>g});var M=C(11194),x=C(11212),y=C(11383),f=C(11197),L=C(11239);class e{constructor(B,I,C,M){this.name=B,this.worldAxisForNormal=I,this.worldAxisForFileX=C,this.worldAxisForFileY=M}}class g{static ConvertCubeMapTextureToSphericalPolynomial(B){var I;if(!B.isCube)return null;null===(I=B.rB())||void 0===I||I.getEngine().flushFramebuffer();const C=B.getSize().width,M=B.readPixels(0,void 0,void 0,!1),x=B.readPixels(1,void 0,void 0,!1);let y,f;B.isRenderTarget?(y=B.readPixels(3,void 0,void 0,!1),f=B.readPixels(2,void 0,void 0,!1)):(y=B.readPixels(2,void 0,void 0,!1),f=B.readPixels(3,void 0,void 0,!1));const L=B.readPixels(4,void 0,void 0,!1),e=B.readPixels(5,void 0,void 0,!1),g=B.gammaSpace;let N=0;return 1!=B.textureType&&2!=B.textureType||(N=1),new Promise((B=>{Promise.all([x,M,y,f,L,e]).then((I=>{let[M,x,y,f,L,e]=I;const R={size:C,right:x,left:M,up:y,down:f,front:L,back:e,format:5,type:N,gammaSpace:g};B(this.ConvertCubeMapToSphericalPolynomial(R))}))}))}static _AreaElement(B,I){return Math.atan2(B*I,Math.sqrt(B*B+I*I+1))}static ConvertCubeMapToSphericalPolynomial(B){const I=new y.c;let C=0;const M=2/B.size,e=M,g=.5*M,N=g-1;for(let y=0;y<6;y++){const R=this._FileFaces[y],H=B[R.name];let F=N;const k=5===B.format?4:3;for(let y=0;y<B.size;y++){let q=N;for(let e=0;e<B.size;e++){const N=R.worldAxisForFileX.scale(q).add(R.worldAxisForFileY.scale(F)).add(R.worldAxisForNormal);N.normalize();const S=this._AreaElement(q-g,F-g)-this._AreaElement(q-g,F+g)-this._AreaElement(q+g,F-g)+this._AreaElement(q+g,F+g);let o=H[y*B.size*k+e*k+0],U=H[y*B.size*k+e*k+1],G=H[y*B.size*k+e*k+2];isNaN(o)&&(o=0),isNaN(U)&&(U=0),isNaN(G)&&(G=0),0===B.type&&(o/=255,U/=255,G/=255),B.gammaSpace&&(o=Math.pow((0,x.Clamp)(o),f.i),U=Math.pow((0,x.Clamp)(U),f.i),G=Math.pow((0,x.Clamp)(G),f.i));const V=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const B=Math.max(o,U,G);if(B>V){const I=V/B;o*=I,U*=I,G*=I}}else o=(0,x.Clamp)(o,0,V),U=(0,x.Clamp)(U,0,V),G=(0,x.Clamp)(G,0,V);const c=new L.SI(o,U,G);I.addLight(N,c,S),C+=S,q+=M}F+=e}}const R=6*(4*Math.PI)/6/C;return I.scaleInPlace(R),I.convertIncidentRadianceToIrradiance(),I.convertIrradianceToLambertianRadiance(),y.f.FromHarmonics(I)}}g._FileFaces=[new e("right",new M.HI(1,0,0),new M.HI(0,0,-1),new M.HI(0,-1,0)),new e("left",new M.HI(-1,0,0),new M.HI(0,0,1),new M.HI(0,-1,0)),new e("up",new M.HI(0,1,0),new M.HI(1,0,0),new M.HI(0,0,1)),new e("down",new M.HI(0,-1,0),new M.HI(1,0,0),new M.HI(0,0,-1)),new e("front",new M.HI(0,0,1),new M.HI(1,0,0),new M.HI(0,-1,0)),new e("back",new M.HI(0,0,-1),new M.HI(-1,0,0),new M.HI(0,-1,0))],g.MAX_HDRI_VALUE=4096,g.PRESERVE_CLAMPED_COLORS=!1},11423:(B,I,C)=>{C.r(I),C.d(I,{Dispose:()=>H,DumpData:()=>R,DumpDataAsync:()=>N,DumpFramebuffer:()=>g,DumpTools:()=>F});var M=C(11300),x=C(11018),y=C(11212),f=C(11056);let L,e=null;async function g(B,I,C,M){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",y=arguments.length>5?arguments[5]:void 0,f=arguments.length>6?arguments[6]:void 0;const L=await C.readPixels(0,0,B,I);R(B,I,new Uint8Array(L.buffer),M,x,y,!0,void 0,f)}async function N(B,I,C){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",x=arguments.length>4?arguments[4]:void 0,y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],L=arguments.length>7?arguments[7]:void 0;return await new Promise((e=>{R(B,I,C,(B=>e(B)),M,x,y,f,L)}))}function R(B,I,g,N){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",F=arguments.length>5?arguments[5]:void 0,k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],S=arguments.length>8?arguments[8]:void 0;(async function(){return e||(e=new Promise(((B,I)=>{let x,y=null;const e={Uf:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(C.bind(C,11332)).then((g=>{let{ThinEngine:N}=g;const R=f.c.Instances.length;try{x=new OffscreenCanvas(100,100),y=new N(x,!1,e)}catch(q){var F;R<f.c.Instances.length&&(null===(F=f.c.Instances.pop())||void 0===F||F.dispose()),x=document.createElement("canvas"),y=new N(x,!1,e)}f.c.Instances.pop(),f.c.OnEnginesDisposedObservable.add((B=>{y&&B!==y&&!y.R&&0===f.c.Instances.length&&H()})),y.getCaps().parallelShaderCompile=void 0;const k=new M.e(y);C.e(52).then(C.bind(C,13679)).then((C=>{let{passPixelShader:f}=C;if(!y)return void I("Engine is not defined");const e=new M.f({RI:y,name:f.name,fragmentShader:f.shader,samplerNames:["textureSampler"]});L={canvas:x,RI:y,renderer:k,wrapper:e},B(L)}))})).catch(I)}))),await e})().then((C=>{if(C.RI.setSize(B,I,!0),g instanceof Float32Array){const B=new Uint8Array(g.length);let I=g.length;for(;I--;){const C=g[I];B[I]=Math.round(255*(0,y.Clamp)(C))}g=B}const M=C.RI.createRawTexture(g,B,I,5,!1,!k,1);C.renderer.setViewport(),C.renderer.applyEffectWrapper(C.wrapper),C.wrapper.effect._bindTexture("textureSampler",M),C.renderer.draw(),q?x.Tools.ToBlob(C.canvas,(B=>{const I=new FileReader;I.onload=B=>{const I=B.target.result;N&&N(I)},I.readAsArrayBuffer(B)}),R,S):x.Tools.EncodeScreenshotCanvasData(C.canvas,N,R,F,S),M.dispose()}))}function H(){var B;L?(L.wrapper.dispose(),L.renderer.dispose(),L.RI.dispose()):null===(B=e)||void 0===B||B.then((B=>{B.wrapper.dispose(),B.renderer.dispose(),B.RI.dispose()}));e=null,L=null}const F={DumpData:R,DumpDataAsync:N,DumpFramebuffer:g,Dispose:H};x.Tools.DumpData=R,x.Tools.DumpDataAsync=N,x.Tools.DumpFramebuffer=g},11686:(B,I,C)=>{C.d(I,{b:()=>y});var M=C(11294),x=C(11426);class y{static ExpandRGBDTexture(B){const I=B._texture;if(!I||!B.isRGBD)return;const x=I.getEngine(),y=x.getCaps(),f=I.isReady;let L=!1;y.textureHalfFloatRender&&y.textureHalfFloatLinearFiltering?(L=!0,I.type=2):y.textureFloatRender&&y.textureFloatLinearFiltering&&(L=!0,I.type=1),L&&(I.isReady=!1,I._isRGBD=!1,I.invertY=!1);const e=async()=>{const y=x.isWebGPU,f=y?1:0;I.isReady=!1,y?await C.e(42).then(C.bind(C,14191)):await C.e(35).then(C.bind(C,14198));const L=new M.d("rgbdDecode","rgbdDecode",null,null,1,null,3,x,!1,void 0,I.type,void 0,null,!1,void 0,f);L.externalTextureSamplerBinding=!0;const e=x.createRenderTargetTexture(I.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:I.samplingMode,type:I.type,format:5});L.onEffectCreatedObservable.addOnce((C=>{C.executeWhenCompiled((()=>{L.onApply=B=>{B._bindTexture("textureSampler",I),B.setFloat2("scale",1,1)},B.rB().postProcessManager.directRender([L],e,!0),x.restoreDefaultFramebuffer(),x._releaseTexture(I),L&&L.dispose(),e._swapAndDie(I),I.isReady=!0}))}))};L&&(f?e():B.onLoadObservable.addOnce(e))}static async EncodeTextureToRGBD(B,I){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return I.getEngine().isWebGPU?await C.e(43).then(C.bind(C,14210)):await C.e(36).then(C.bind(C,14202)),await(0,x.e)("rgbdEncode",B,I,M,1,5)}}}}]);