"use strict";(self.qbp2s7qydk=self.qbp2s7qydk||[]).push([[20,21],{13489:(M,A,O)=>{var S=O(13497),z=O(12986);z.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(z.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=S.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((M=>{this._texture._sphericalPolynomial=M,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(M){this._texture&&(this._texture._sphericalPolynomial=M)},enumerable:!0,configurable:!0})},13497:(M,A,O)=>{O.d(A,{d:()=>B});var S=O(12970),z=O(12980),Q=O(13177),X=O(12974),c=O(13010);class j{constructor(M,A,O,S){this.name=M,this.worldAxisForNormal=A,this.worldAxisForFileX=O,this.worldAxisForFileY=S}}class B{static ConvertCubeMapTextureToSphericalPolynomial(M){var A;if(!M.isCube)return null;null===(A=M.HM())||void 0===A||A.getEngine().flushFramebuffer();const O=M.getSize().width,S=M.readPixels(0,void 0,void 0,!1),z=M.readPixels(1,void 0,void 0,!1);let Q,X;M.isRenderTarget?(Q=M.readPixels(3,void 0,void 0,!1),X=M.readPixels(2,void 0,void 0,!1)):(Q=M.readPixels(2,void 0,void 0,!1),X=M.readPixels(3,void 0,void 0,!1));const c=M.readPixels(4,void 0,void 0,!1),j=M.readPixels(5,void 0,void 0,!1),B=M.gammaSpace;let g=0;return 1!=M.textureType&&2!=M.textureType||(g=1),new Promise((M=>{Promise.all([z,S,Q,X,c,j]).then((A=>{let[S,z,Q,X,c,j]=A;const e={size:O,right:z,left:S,up:Q,down:X,front:c,back:j,format:5,type:g,gammaSpace:B};M(this.ConvertCubeMapToSphericalPolynomial(e))}))}))}static _AreaElement(M,A){return Math.atan2(M*A,Math.sqrt(M*M+A*A+1))}static ConvertCubeMapToSphericalPolynomial(M){const A=new Q.e;let O=0;const S=2/M.size,j=S,B=.5*S,g=B-1;for(let Q=0;Q<6;Q++){const e=this._FileFaces[Q],T=M[e.name];let J=g;const K=5===M.format?4:3;for(let Q=0;Q<M.size;Q++){let G=g;for(let j=0;j<M.size;j++){const g=e.worldAxisForFileX.scale(G).add(e.worldAxisForFileY.scale(J)).add(e.worldAxisForNormal);g.normalize();const d=this._AreaElement(G-B,J-B)-this._AreaElement(G-B,J+B)-this._AreaElement(G+B,J-B)+this._AreaElement(G+B,J+B);let w=T[Q*M.size*K+j*K+0],I=T[Q*M.size*K+j*K+1],b=T[Q*M.size*K+j*K+2];isNaN(w)&&(w=0),isNaN(I)&&(I=0),isNaN(b)&&(b=0),0===M.type&&(w/=255,I/=255,b/=255),M.gammaSpace&&(w=Math.pow((0,z.Clamp)(w),X.n),I=Math.pow((0,z.Clamp)(I),X.n),b=Math.pow((0,z.Clamp)(b),X.n));const s=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const M=Math.max(w,I,b);if(M>s){const A=s/M;w*=A,I*=A,b*=A}}else w=(0,z.Clamp)(w,0,s),I=(0,z.Clamp)(I,0,s),b=(0,z.Clamp)(b,0,s);const Y=new c.bA(w,I,b);A.addLight(g,Y,d),O+=d,G+=S}J+=j}}const e=6*(4*Math.PI)/6/O;return A.scaleInPlace(e),A.convertIncidentRadianceToIrradiance(),A.convertIrradianceToLambertianRadiance(),Q.g.FromHarmonics(A)}}B._FileFaces=[new j("right",new S.GA(1,0,0),new S.GA(0,0,-1),new S.GA(0,-1,0)),new j("left",new S.GA(-1,0,0),new S.GA(0,0,1),new S.GA(0,-1,0)),new j("up",new S.GA(0,1,0),new S.GA(1,0,0),new S.GA(0,0,1)),new j("down",new S.GA(0,-1,0),new S.GA(1,0,0),new S.GA(0,0,-1)),new j("front",new S.GA(0,0,1),new S.GA(1,0,0),new S.GA(0,-1,0)),new j("back",new S.GA(0,0,-1),new S.GA(-1,0,0),new S.GA(0,-1,0))],B.MAX_HDRI_VALUE=4096,B.PRESERVE_CLAMPED_COLORS=!1},13196:(M,A,O)=>{O.r(A),O.d(A,{Dispose:()=>T,DumpData:()=>e,DumpDataAsync:()=>g,DumpFramebuffer:()=>B,DumpTools:()=>J});var S=O(13090),z=O(12768),Q=O(12980),X=O(12811);let c,j=null;async function B(M,A,O,S){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Q=arguments.length>5?arguments[5]:void 0,X=arguments.length>6?arguments[6]:void 0;const c=await O.readPixels(0,0,M,A);e(M,A,new Uint8Array(c.buffer),S,z,Q,!0,void 0,X)}async function g(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",z=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7?arguments[7]:void 0;return await new Promise((j=>{e(M,A,O,(M=>j(M)),S,z,Q,X,c)}))}function e(M,A,B,g){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",J=arguments.length>5?arguments[5]:void 0,K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7&&void 0!==arguments[7]&&arguments[7],d=arguments.length>8?arguments[8]:void 0;(async function(){return j||(j=new Promise(((M,A)=>{let z,Q=null;const j={cc:!0,depth:!1,Sc:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(O.bind(O,13119)).then((B=>{let{ThinEngine:g}=B;const e=X.d.Instances.length;try{z=new OffscreenCanvas(100,100),Q=new g(z,!1,j)}catch(G){var J;e<X.d.Instances.length&&(null===(J=X.d.Instances.pop())||void 0===J||J.dispose()),z=document.createElement("canvas"),Q=new g(z,!1,j)}X.d.Instances.pop(),X.d.OnEnginesDisposedObservable.add((M=>{Q&&M!==Q&&!Q.T&&0===X.d.Instances.length&&T()})),Q.getCaps().parallelShaderCompile=void 0;const K=new S.b(Q);O.e(52).then(O.bind(O,15129)).then((O=>{let{passPixelShader:X}=O;if(!Q)return void A("Engine is not defined");const j=new S.c({KA:Q,name:X.name,fragmentShader:X.shader,samplerNames:["textureSampler"]});c={canvas:z,KA:Q,renderer:K,wrapper:j},M(c)}))})).catch(A)}))),await j})().then((O=>{if(O.KA.setSize(M,A,!0),B instanceof Float32Array){const M=new Uint8Array(B.length);let A=B.length;for(;A--;){const O=B[A];M[A]=Math.round(255*(0,Q.Clamp)(O))}B=M}const S=O.KA.createRawTexture(B,M,A,5,!1,!K,1);O.renderer.setViewport(),O.renderer.applyEffectWrapper(O.wrapper),O.wrapper.effect._bindTexture("textureSampler",S),O.renderer.draw(),G?z.Tools.ToBlob(O.canvas,(M=>{const A=new FileReader;A.onload=M=>{const A=M.target.result;g&&g(A)},A.readAsArrayBuffer(M)}),e,d):z.Tools.EncodeScreenshotCanvasData(O.canvas,g,e,J,d),S.dispose()}))}function T(){var M;c?(c.wrapper.dispose(),c.renderer.dispose(),c.KA.dispose()):null===(M=j)||void 0===M||M.then((M=>{M.wrapper.dispose(),M.renderer.dispose(),M.KA.dispose()}));j=null,c=null}const J={DumpData:e,DumpDataAsync:g,DumpFramebuffer:B,Dispose:T};z.Tools.DumpData=e,z.Tools.DumpDataAsync=g,z.Tools.DumpFramebuffer=B},13480:(M,A,O)=>{O.d(A,{b:()=>Q});var S=O(13084),z=O(13203);class Q{static ExpandRGBDTexture(M){const A=M._texture;if(!A||!M.isRGBD)return;const z=A.getEngine(),Q=z.getCaps(),X=A.isReady;let c=!1;Q.textureHalfFloatRender&&Q.textureHalfFloatLinearFiltering?(c=!0,A.type=2):Q.textureFloatRender&&Q.textureFloatLinearFiltering&&(c=!0,A.type=1),c&&(A.isReady=!1,A._isRGBD=!1,A.invertY=!1);const j=async()=>{const Q=z.isWebGPU,X=Q?1:0;A.isReady=!1,Q?await O.e(42).then(O.bind(O,15634)):await O.e(35).then(O.bind(O,15638));const c=new S.c("rgbdDecode","rgbdDecode",null,null,1,null,3,z,!1,void 0,A.type,void 0,null,!1,void 0,X);c.externalTextureSamplerBinding=!0;const j=z.createRenderTargetTexture(A.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:A.samplingMode,type:A.type,format:5});c.onEffectCreatedObservable.addOnce((O=>{O.executeWhenCompiled((()=>{c.onApply=M=>{M._bindTexture("textureSampler",A),M.setFloat2("scale",1,1)},M.HM().postProcessManager.directRender([c],j,!0),z.restoreDefaultFramebuffer(),z._releaseTexture(A),c&&c.dispose(),j._swapAndDie(A),A.isReady=!0}))}))};c&&(X?j():M.onLoadObservable.addOnce(j))}static async EncodeTextureToRGBD(M,A){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return A.getEngine().isWebGPU?await O.e(43).then(O.bind(O,15652)):await O.e(36).then(O.bind(O,15646)),await(0,z.d)("rgbdEncode",M,A,S,1,5)}}}}]);