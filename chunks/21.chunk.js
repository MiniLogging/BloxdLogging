"use strict";(self.hmihoa2fs98=self.hmihoa2fs98||[]).push([[20,21],{12193:(b,d,P)=>{var G=P(12198),W=P(11707);W.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(W.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=G.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((b=>{this._texture._sphericalPolynomial=b,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(b){this._texture&&(this._texture._sphericalPolynomial=b)},enumerable:!0,configurable:!0})},12198:(b,d,P)=>{P.d(d,{e:()=>L});var G=P(11681),W=P(11700),i=P(11858),q=P(11688),C=P(11725);class J{constructor(b,d,P,G){this.name=b,this.worldAxisForNormal=d,this.worldAxisForFileX=P,this.worldAxisForFileY=G}}class L{static ConvertCubeMapTextureToSphericalPolynomial(b){var d;if(!b.isCube)return null;null===(d=b.Xb())||void 0===d||d.getEngine().flushFramebuffer();const P=b.getSize().width,G=b.readPixels(0,void 0,void 0,!1),W=b.readPixels(1,void 0,void 0,!1);let i,q;b.isRenderTarget?(i=b.readPixels(3,void 0,void 0,!1),q=b.readPixels(2,void 0,void 0,!1)):(i=b.readPixels(2,void 0,void 0,!1),q=b.readPixels(3,void 0,void 0,!1));const C=b.readPixels(4,void 0,void 0,!1),J=b.readPixels(5,void 0,void 0,!1),L=b.gammaSpace;let x=0;return 1!=b.textureType&&2!=b.textureType||(x=1),new Promise((b=>{Promise.all([W,G,i,q,C,J]).then((d=>{let[G,W,i,q,C,J]=d;const Y={size:P,right:W,left:G,up:i,down:q,front:C,back:J,format:5,type:x,gammaSpace:L};b(this.ConvertCubeMapToSphericalPolynomial(Y))}))}))}static _AreaElement(b,d){return Math.atan2(b*d,Math.sqrt(b*b+d*d+1))}static ConvertCubeMapToSphericalPolynomial(b){const d=new i.c;let P=0;const G=2/b.size,J=G,L=.5*G,x=L-1;for(let i=0;i<6;i++){const Y=this._FileFaces[i],s=b[Y.name];let E=x;const w=5===b.format?4:3;for(let i=0;i<b.size;i++){let t=x;for(let J=0;J<b.size;J++){const x=Y.worldAxisForFileX.scale(t).add(Y.worldAxisForFileY.scale(E)).add(Y.worldAxisForNormal);x.normalize();const r=this._AreaElement(t-L,E-L)-this._AreaElement(t-L,E+L)-this._AreaElement(t+L,E-L)+this._AreaElement(t+L,E+L);let B=s[i*b.size*w+J*w+0],n=s[i*b.size*w+J*w+1],Z=s[i*b.size*w+J*w+2];isNaN(B)&&(B=0),isNaN(n)&&(n=0),isNaN(Z)&&(Z=0),0===b.type&&(B/=255,n/=255,Z/=255),b.gammaSpace&&(B=Math.pow((0,W.Clamp)(B),q.j),n=Math.pow((0,W.Clamp)(n),q.j),Z=Math.pow((0,W.Clamp)(Z),q.j));const o=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const b=Math.max(B,n,Z);if(b>o){const d=o/b;B*=d,n*=d,Z*=d}}else B=(0,W.Clamp)(B,0,o),n=(0,W.Clamp)(n,0,o),Z=(0,W.Clamp)(Z,0,o);const A=new C.Nd(B,n,Z);d.addLight(x,A,r),P+=r,t+=G}E+=J}}const Y=6*(4*Math.PI)/6/P;return d.scaleInPlace(Y),d.convertIncidentRadianceToIrradiance(),d.convertIrradianceToLambertianRadiance(),i.g.FromHarmonics(d)}}L._FileFaces=[new J("right",new G.ed(1,0,0),new G.ed(0,0,-1),new G.ed(0,-1,0)),new J("left",new G.ed(-1,0,0),new G.ed(0,0,1),new G.ed(0,-1,0)),new J("up",new G.ed(0,1,0),new G.ed(1,0,0),new G.ed(0,0,1)),new J("down",new G.ed(0,-1,0),new G.ed(1,0,0),new G.ed(0,0,-1)),new J("front",new G.ed(0,0,1),new G.ed(1,0,0),new G.ed(0,-1,0)),new J("back",new G.ed(0,0,-1),new G.ed(-1,0,0),new G.ed(0,-1,0))],L.MAX_HDRI_VALUE=4096,L.PRESERVE_CLAMPED_COLORS=!1},11890:(b,d,P)=>{P.r(d),P.d(d,{Dispose:()=>s,DumpData:()=>Y,DumpDataAsync:()=>x,DumpFramebuffer:()=>L,DumpTools:()=>E});var G=P(11787),W=P(11484),i=P(11700),q=P(11535);let C,J=null;async function L(b,d,P,G){let W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",i=arguments.length>5?arguments[5]:void 0,q=arguments.length>6?arguments[6]:void 0;const C=await P.readPixels(0,0,b,d);Y(b,d,new Uint8Array(C.buffer),G,W,i,!0,void 0,q)}async function x(b,d,P){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",W=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7?arguments[7]:void 0;return await new Promise((J=>{Y(b,d,P,(b=>J(b)),G,W,i,q,C)}))}function Y(b,d,L,x){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",E=arguments.length>5?arguments[5]:void 0,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7&&void 0!==arguments[7]&&arguments[7],r=arguments.length>8?arguments[8]:void 0;(async function(){return J||(J=new Promise(((b,d)=>{let W,i=null;const J={Ud:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(P.bind(P,11815)).then((L=>{let{ThinEngine:x}=L;const Y=q.e.Instances.length;try{W=new OffscreenCanvas(100,100),i=new x(W,!1,J)}catch(t){var E;Y<q.e.Instances.length&&(null===(E=q.e.Instances.pop())||void 0===E||E.dispose()),W=document.createElement("canvas"),i=new x(W,!1,J)}q.e.Instances.pop(),q.e.OnEnginesDisposedObservable.add((b=>{i&&b!==i&&!i.L&&0===q.e.Instances.length&&s()})),i.getCaps().parallelShaderCompile=void 0;const w=new G.c(i);P.e(52).then(P.bind(P,14136)).then((P=>{let{passPixelShader:q}=P;if(!i)return void d("Engine is not defined");const J=new G.f({Md:i,name:q.name,fragmentShader:q.shader,samplerNames:["textureSampler"]});C={canvas:W,Md:i,renderer:w,wrapper:J},b(C)}))})).catch(d)}))),await J})().then((P=>{if(P.Md.setSize(b,d,!0),L instanceof Float32Array){const b=new Uint8Array(L.length);let d=L.length;for(;d--;){const P=L[d];b[d]=Math.round(255*(0,i.Clamp)(P))}L=b}const G=P.Md.createRawTexture(L,b,d,5,!1,!w,1);P.renderer.setViewport(),P.renderer.applyEffectWrapper(P.wrapper),P.wrapper.effect._bindTexture("textureSampler",G),P.renderer.draw(),t?W.Tools.ToBlob(P.canvas,(b=>{const d=new FileReader;d.onload=b=>{const d=b.target.result;x&&x(d)},d.readAsArrayBuffer(b)}),Y,r):W.Tools.EncodeScreenshotCanvasData(P.canvas,x,Y,E,r),G.dispose()}))}function s(){var b;C?(C.wrapper.dispose(),C.renderer.dispose(),C.Md.dispose()):null===(b=J)||void 0===b||b.then((b=>{b.wrapper.dispose(),b.renderer.dispose(),b.Md.dispose()}));J=null,C=null}const E={DumpData:Y,DumpDataAsync:x,DumpFramebuffer:L,Dispose:s};W.Tools.DumpData=Y,W.Tools.DumpDataAsync=x,W.Tools.DumpFramebuffer=L},12184:(b,d,P)=>{P.d(d,{b:()=>i});var G=P(11784),W=P(11898);class i{static ExpandRGBDTexture(b){const d=b._texture;if(!d||!b.isRGBD)return;const W=d.getEngine(),i=W.getCaps(),q=d.isReady;let C=!1;i.textureHalfFloatRender&&i.textureHalfFloatLinearFiltering?(C=!0,d.type=2):i.textureFloatRender&&i.textureFloatLinearFiltering&&(C=!0,d.type=1),C&&(d.isReady=!1,d._isRGBD=!1,d.invertY=!1);const J=async()=>{const i=W.isWebGPU,q=i?1:0;d.isReady=!1,i?await P.e(42).then(P.bind(P,14705)):await P.e(35).then(P.bind(P,14708));const C=new G.e("rgbdDecode","rgbdDecode",null,null,1,null,3,W,!1,void 0,d.type,void 0,null,!1,void 0,q);C.externalTextureSamplerBinding=!0;const J=W.createRenderTargetTexture(d.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:d.samplingMode,type:d.type,format:5});C.onEffectCreatedObservable.addOnce((P=>{P.executeWhenCompiled((()=>{C.onApply=b=>{b._bindTexture("textureSampler",d),b.setFloat2("scale",1,1)},b.Xb().postProcessManager.directRender([C],J,!0),W.restoreDefaultFramebuffer(),W._releaseTexture(d),C&&C.dispose(),J._swapAndDie(d),d.isReady=!0}))}))};C&&(q?J():b.onLoadObservable.addOnce(J))}static async EncodeTextureToRGBD(b,d){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return d.getEngine().isWebGPU?await P.e(43).then(P.bind(P,14723)):await P.e(36).then(P.bind(P,14715)),await(0,W.b)("rgbdEncode",b,d,G,1,5)}}}}]);