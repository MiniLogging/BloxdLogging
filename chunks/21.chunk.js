"use strict";(self.zjjkhojdx1=self.zjjkhojdx1||[]).push([[20,21],{11772:(k,h,o)=>{var x=o(11780),I=o(11266);I.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(I.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=x.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((k=>{this._texture._sphericalPolynomial=k,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(k){this._texture&&(this._texture._sphericalPolynomial=k)},enumerable:!0,configurable:!0})},11780:(k,h,o)=>{o.d(h,{d:()=>l});var x=o(11239),I=o(11260),q=o(11428),Y=o(11248),J=o(11281);class G{constructor(k,h,o,x){this.name=k,this.worldAxisForNormal=h,this.worldAxisForFileX=o,this.worldAxisForFileY=x}}class l{static ConvertCubeMapTextureToSphericalPolynomial(k){var h;if(!k.isCube)return null;null===(h=k.ik())||void 0===h||h.getEngine().flushFramebuffer();const o=k.getSize().width,x=k.readPixels(0,void 0,void 0,!1),I=k.readPixels(1,void 0,void 0,!1);let q,Y;k.isRenderTarget?(q=k.readPixels(3,void 0,void 0,!1),Y=k.readPixels(2,void 0,void 0,!1)):(q=k.readPixels(2,void 0,void 0,!1),Y=k.readPixels(3,void 0,void 0,!1));const J=k.readPixels(4,void 0,void 0,!1),G=k.readPixels(5,void 0,void 0,!1),l=k.gammaSpace;let A=0;return 1!=k.textureType&&2!=k.textureType||(A=1),new Promise((k=>{Promise.all([I,x,q,Y,J,G]).then((h=>{let[x,I,q,Y,J,G]=h;const K={size:o,right:I,left:x,up:q,down:Y,front:J,back:G,format:5,type:A,gammaSpace:l};k(this.ConvertCubeMapToSphericalPolynomial(K))}))}))}static _AreaElement(k,h){return Math.atan2(k*h,Math.sqrt(k*k+h*h+1))}static ConvertCubeMapToSphericalPolynomial(k){const h=new q.b;let o=0;const x=2/k.size,G=x,l=.5*x,A=l-1;for(let q=0;q<6;q++){const K=this._FileFaces[q],a=k[K.name];let N=A;const X=5===k.format?4:3;for(let q=0;q<k.size;q++){let c=A;for(let G=0;G<k.size;G++){const A=K.worldAxisForFileX.scale(c).add(K.worldAxisForFileY.scale(N)).add(K.worldAxisForNormal);A.normalize();const W=this._AreaElement(c-l,N-l)-this._AreaElement(c-l,N+l)-this._AreaElement(c+l,N-l)+this._AreaElement(c+l,N+l);let f=a[q*k.size*X+G*X+0],M=a[q*k.size*X+G*X+1],T=a[q*k.size*X+G*X+2];isNaN(f)&&(f=0),isNaN(M)&&(M=0),isNaN(T)&&(T=0),0===k.type&&(f/=255,M/=255,T/=255),k.gammaSpace&&(f=Math.pow((0,I.Clamp)(f),Y.i),M=Math.pow((0,I.Clamp)(M),Y.i),T=Math.pow((0,I.Clamp)(T),Y.i));const j=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const k=Math.max(f,M,T);if(k>j){const h=j/k;f*=h,M*=h,T*=h}}else f=(0,I.Clamp)(f,0,j),M=(0,I.Clamp)(M,0,j),T=(0,I.Clamp)(T,0,j);const d=new J.Zh(f,M,T);h.addLight(A,d,W),o+=W,c+=x}N+=G}}const K=6*(4*Math.PI)/6/o;return h.scaleInPlace(K),h.convertIncidentRadianceToIrradiance(),h.convertIrradianceToLambertianRadiance(),q.e.FromHarmonics(h)}}l._FileFaces=[new G("right",new x.Vh(1,0,0),new x.Vh(0,0,-1),new x.Vh(0,-1,0)),new G("left",new x.Vh(-1,0,0),new x.Vh(0,0,1),new x.Vh(0,-1,0)),new G("up",new x.Vh(0,1,0),new x.Vh(1,0,0),new x.Vh(0,0,1)),new G("down",new x.Vh(0,-1,0),new x.Vh(1,0,0),new x.Vh(0,0,-1)),new G("front",new x.Vh(0,0,1),new x.Vh(1,0,0),new x.Vh(0,-1,0)),new G("back",new x.Vh(0,0,-1),new x.Vh(-1,0,0),new x.Vh(0,-1,0))],l.MAX_HDRI_VALUE=4096,l.PRESERVE_CLAMPED_COLORS=!1},11456:(k,h,o)=>{o.r(h),o.d(h,{Dispose:()=>a,DumpData:()=>K,DumpDataAsync:()=>A,DumpFramebuffer:()=>l,DumpTools:()=>N});var x=o(11339),I=o(11078),q=o(11260),Y=o(11120);let J,G=null;async function l(k,h,o,x){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",q=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0;const J=await o.readPixels(0,0,k,h);K(k,h,new Uint8Array(J.buffer),x,I,q,!0,void 0,Y)}async function A(k,h,o){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",I=arguments.length>4?arguments[4]:void 0,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7?arguments[7]:void 0;return await new Promise((G=>{K(k,h,o,(k=>G(k)),x,I,q,Y,J)}))}function K(k,h,l,A){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",N=arguments.length>5?arguments[5]:void 0,X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],W=arguments.length>8?arguments[8]:void 0;(async function(){return G||(G=new Promise(((k,h)=>{let I,q=null;const G={nh:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(o.bind(o,11372)).then((l=>{let{ThinEngine:A}=l;const K=Y.b.Instances.length;try{I=new OffscreenCanvas(100,100),q=new A(I,!1,G)}catch(c){var N;K<Y.b.Instances.length&&(null===(N=Y.b.Instances.pop())||void 0===N||N.dispose()),I=document.createElement("canvas"),q=new A(I,!1,G)}Y.b.Instances.pop(),Y.b.OnEnginesDisposedObservable.add((k=>{q&&k!==q&&!q.l&&0===Y.b.Instances.length&&a()})),q.getCaps().parallelShaderCompile=void 0;const X=new x.c(q);o.e(52).then(o.bind(o,13693)).then((o=>{let{passPixelShader:Y}=o;if(!q)return void h("Engine is not defined");const G=new x.e({bh:q,name:Y.name,fragmentShader:Y.shader,samplerNames:["textureSampler"]});J={canvas:I,bh:q,renderer:X,wrapper:G},k(J)}))})).catch(h)}))),await G})().then((o=>{if(o.bh.setSize(k,h,!0),l instanceof Float32Array){const k=new Uint8Array(l.length);let h=l.length;for(;h--;){const o=l[h];k[h]=Math.round(255*(0,q.Clamp)(o))}l=k}const x=o.bh.createRawTexture(l,k,h,5,!1,!X,1);o.renderer.setViewport(),o.renderer.applyEffectWrapper(o.wrapper),o.wrapper.effect._bindTexture("textureSampler",x),o.renderer.draw(),c?I.Tools.ToBlob(o.canvas,(k=>{const h=new FileReader;h.onload=k=>{const h=k.target.result;A&&A(h)},h.readAsArrayBuffer(k)}),K,W):I.Tools.EncodeScreenshotCanvasData(o.canvas,A,K,N,W),x.dispose()}))}function a(){var k;J?(J.wrapper.dispose(),J.renderer.dispose(),J.bh.dispose()):null===(k=G)||void 0===k||k.then((k=>{k.wrapper.dispose(),k.renderer.dispose(),k.bh.dispose()}));G=null,J=null}const N={DumpData:K,DumpDataAsync:A,DumpFramebuffer:l,Dispose:a};I.Tools.DumpData=K,I.Tools.DumpDataAsync=A,I.Tools.DumpFramebuffer=l},11759:(k,h,o)=>{o.d(h,{d:()=>q});var x=o(11335),I=o(11461);class q{static ExpandRGBDTexture(k){const h=k._texture;if(!h||!k.isRGBD)return;const I=h.getEngine(),q=I.getCaps(),Y=h.isReady;let J=!1;q.textureHalfFloatRender&&q.textureHalfFloatLinearFiltering?(J=!0,h.type=2):q.textureFloatRender&&q.textureFloatLinearFiltering&&(J=!0,h.type=1),J&&(h.isReady=!1,h._isRGBD=!1,h.invertY=!1);const G=async()=>{const q=I.isWebGPU,Y=q?1:0;h.isReady=!1,q?await o.e(42).then(o.bind(o,14240)):await o.e(35).then(o.bind(o,14242));const J=new x.b("rgbdDecode","rgbdDecode",null,null,1,null,3,I,!1,void 0,h.type,void 0,null,!1,void 0,Y);J.externalTextureSamplerBinding=!0;const G=I.createRenderTargetTexture(h.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:h.samplingMode,type:h.type,format:5});J.onEffectCreatedObservable.addOnce((o=>{o.executeWhenCompiled((()=>{J.onApply=k=>{k._bindTexture("textureSampler",h),k.setFloat2("scale",1,1)},k.ik().postProcessManager.directRender([J],G,!0),I.restoreDefaultFramebuffer(),I._releaseTexture(h),J&&J.dispose(),G._swapAndDie(h),h.isReady=!0}))}))};J&&(Y?G():k.onLoadObservable.addOnce(G))}static async EncodeTextureToRGBD(k,h){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return h.getEngine().isWebGPU?await o.e(43).then(o.bind(o,14256)):await o.e(36).then(o.bind(o,14247)),await(0,I.d)("rgbdEncode",k,h,x,1,5)}}}}]);