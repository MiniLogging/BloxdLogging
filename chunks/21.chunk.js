"use strict";(self["269hv5nclphh"]=self["269hv5nclphh"]||[]).push([[20,21],{12893:(E,H,d)=>{var n=d(12902),Z=d(12414);Z.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(Z.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=n.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((E=>{this._texture._sphericalPolynomial=E,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(E){this._texture&&(this._texture._sphericalPolynomial=E)},enumerable:!0,configurable:!0})},12902:(E,H,d)=>{d.d(H,{d:()=>t});var n=d(12384),Z=d(12406),I=d(12582),g=d(12391),l=d(12437);class r{constructor(E,H,d,n){this.name=E,this.worldAxisForNormal=H,this.worldAxisForFileX=d,this.worldAxisForFileY=n}}class t{static ConvertCubeMapTextureToSphericalPolynomial(E){var H;if(!E.isCube)return null;null===(H=E.fE())||void 0===H||H.getEngine().flushFramebuffer();const d=E.getSize().width,n=E.readPixels(0,void 0,void 0,!1),Z=E.readPixels(1,void 0,void 0,!1);let I,g;E.isRenderTarget?(I=E.readPixels(3,void 0,void 0,!1),g=E.readPixels(2,void 0,void 0,!1)):(I=E.readPixels(2,void 0,void 0,!1),g=E.readPixels(3,void 0,void 0,!1));const l=E.readPixels(4,void 0,void 0,!1),r=E.readPixels(5,void 0,void 0,!1),t=E.gammaSpace;let S=0;return 1!=E.textureType&&2!=E.textureType||(S=1),new Promise((E=>{Promise.all([Z,n,I,g,l,r]).then((H=>{let[n,Z,I,g,l,r]=H;const M={size:d,right:Z,left:n,up:I,down:g,front:l,back:r,format:5,type:S,gammaSpace:t};E(this.ConvertCubeMapToSphericalPolynomial(M))}))}))}static _AreaElement(E,H){return Math.atan2(E*H,Math.sqrt(E*E+H*H+1))}static ConvertCubeMapToSphericalPolynomial(E){const H=new I.b;let d=0;const n=2/E.size,r=n,t=.5*n,S=t-1;for(let I=0;I<6;I++){const M=this._FileFaces[I],V=E[M.name];let C=S;const w=5===E.format?4:3;for(let I=0;I<E.size;I++){let R=S;for(let r=0;r<E.size;r++){const S=M.worldAxisForFileX.scale(R).add(M.worldAxisForFileY.scale(C)).add(M.worldAxisForNormal);S.normalize();const Q=this._AreaElement(R-t,C-t)-this._AreaElement(R-t,C+t)-this._AreaElement(R+t,C-t)+this._AreaElement(R+t,C+t);let L=V[I*E.size*w+r*w+0],D=V[I*E.size*w+r*w+1],e=V[I*E.size*w+r*w+2];isNaN(L)&&(L=0),isNaN(D)&&(D=0),isNaN(e)&&(e=0),0===E.type&&(L/=255,D/=255,e/=255),E.gammaSpace&&(L=Math.pow((0,Z.Clamp)(L),g.n),D=Math.pow((0,Z.Clamp)(D),g.n),e=Math.pow((0,Z.Clamp)(e),g.n));const s=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const E=Math.max(L,D,e);if(E>s){const H=s/E;L*=H,D*=H,e*=H}}else L=(0,Z.Clamp)(L,0,s),D=(0,Z.Clamp)(D,0,s),e=(0,Z.Clamp)(e,0,s);const i=new l.DH(L,D,e);H.addLight(S,i,Q),d+=Q,R+=n}C+=r}}const M=6*(4*Math.PI)/6/d;return H.scaleInPlace(M),H.convertIncidentRadianceToIrradiance(),H.convertIrradianceToLambertianRadiance(),I.e.FromHarmonics(H)}}t._FileFaces=[new r("right",new n.wH(1,0,0),new n.wH(0,0,-1),new n.wH(0,-1,0)),new r("left",new n.wH(-1,0,0),new n.wH(0,0,1),new n.wH(0,-1,0)),new r("up",new n.wH(0,1,0),new n.wH(1,0,0),new n.wH(0,0,1)),new r("down",new n.wH(0,-1,0),new n.wH(1,0,0),new n.wH(0,0,-1)),new r("front",new n.wH(0,0,1),new n.wH(1,0,0),new n.wH(0,-1,0)),new r("back",new n.wH(0,0,-1),new n.wH(-1,0,0),new n.wH(0,-1,0))],t.MAX_HDRI_VALUE=4096,t.PRESERVE_CLAMPED_COLORS=!1},12614:(E,H,d)=>{d.r(H),d.d(H,{Dispose:()=>V,DumpData:()=>M,DumpDataAsync:()=>S,DumpFramebuffer:()=>t,DumpTools:()=>C});var n=d(12509),Z=d(12228),I=d(12406),g=d(12268);let l,r=null;async function t(E,H,d,n){let Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",I=arguments.length>5?arguments[5]:void 0,g=arguments.length>6?arguments[6]:void 0;const l=await d.readPixels(0,0,E,H);M(E,H,new Uint8Array(l.buffer),n,Z,I,!0,void 0,g)}async function S(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",Z=arguments.length>4?arguments[4]:void 0,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7?arguments[7]:void 0;return await new Promise((r=>{M(E,H,d,(E=>r(E)),n,Z,I,g,l)}))}function M(E,H,t,S){let M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",C=arguments.length>5?arguments[5]:void 0,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],R=arguments.length>7&&void 0!==arguments[7]&&arguments[7],Q=arguments.length>8?arguments[8]:void 0;(async function(){return r||(r=new Promise(((E,H)=>{let Z,I=null;const r={Ud:!0,depth:!1,ed:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(d.bind(d,12524)).then((t=>{let{ThinEngine:S}=t;const M=g.b.Instances.length;try{Z=new OffscreenCanvas(100,100),I=new S(Z,!1,r)}catch(R){var C;M<g.b.Instances.length&&(null===(C=g.b.Instances.pop())||void 0===C||C.dispose()),Z=document.createElement("canvas"),I=new S(Z,!1,r)}g.b.Instances.pop(),g.b.OnEnginesDisposedObservable.add((E=>{I&&E!==I&&!I.M&&0===g.b.Instances.length&&V()})),I.getCaps().parallelShaderCompile=void 0;const w=new n.e(I);d.e(52).then(d.bind(d,14888)).then((d=>{let{passPixelShader:g}=d;if(!I)return void H("Engine is not defined");const r=new n.g({CH:I,name:g.name,fragmentShader:g.shader,samplerNames:["textureSampler"]});l={canvas:Z,CH:I,renderer:w,wrapper:r},E(l)}))})).catch(H)}))),await r})().then((d=>{if(d.CH.setSize(E,H,!0),t instanceof Float32Array){const E=new Uint8Array(t.length);let H=t.length;for(;H--;){const d=t[H];E[H]=Math.round(255*(0,I.Clamp)(d))}t=E}const n=d.CH.createRawTexture(t,E,H,5,!1,!w,1);d.renderer.setViewport(),d.renderer.applyEffectWrapper(d.wrapper),d.wrapper.effect._bindTexture("textureSampler",n),d.renderer.draw(),R?Z.Tools.ToBlob(d.canvas,(E=>{const H=new FileReader;H.onload=E=>{const H=E.target.result;S&&S(H)},H.readAsArrayBuffer(E)}),M,Q):Z.Tools.EncodeScreenshotCanvasData(d.canvas,S,M,C,Q),n.dispose()}))}function V(){var E;l?(l.wrapper.dispose(),l.renderer.dispose(),l.CH.dispose()):null===(E=r)||void 0===E||E.then((E=>{E.wrapper.dispose(),E.renderer.dispose(),E.CH.dispose()}));r=null,l=null}const C={DumpData:M,DumpDataAsync:S,DumpFramebuffer:t,Dispose:V};Z.Tools.DumpData=M,Z.Tools.DumpDataAsync=S,Z.Tools.DumpFramebuffer=t},12887:(E,H,d)=>{d.d(H,{e:()=>I});var n=d(12500),Z=d(12622);class I{static ExpandRGBDTexture(E){const H=E._texture;if(!H||!E.isRGBD)return;const Z=H.getEngine(),I=Z.getCaps(),g=H.isReady;let l=!1;I.textureHalfFloatRender&&I.textureHalfFloatLinearFiltering?(l=!0,H.type=2):I.textureFloatRender&&I.textureFloatLinearFiltering&&(l=!0,H.type=1),l&&(H.isReady=!1,H._isRGBD=!1,H.invertY=!1);const r=async()=>{const I=Z.isWebGPU,g=I?1:0;H.isReady=!1,I?await d.e(42).then(d.bind(d,15430)):await d.e(35).then(d.bind(d,15439));const l=new n.c("rgbdDecode","rgbdDecode",null,null,1,null,3,Z,!1,void 0,H.type,void 0,null,!1,void 0,g);l.externalTextureSamplerBinding=!0;const r=Z.createRenderTargetTexture(H.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:H.samplingMode,type:H.type,format:5});l.onEffectCreatedObservable.addOnce((d=>{d.executeWhenCompiled((()=>{l.onApply=E=>{E._bindTexture("textureSampler",H),E.setFloat2("scale",1,1)},E.fE().postProcessManager.directRender([l],r,!0),Z.restoreDefaultFramebuffer(),Z._releaseTexture(H),l&&l.dispose(),r._swapAndDie(H),H.isReady=!0}))}))};l&&(g?r():E.onLoadObservable.addOnce(r))}static async EncodeTextureToRGBD(E,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return H.getEngine().isWebGPU?await d.e(43).then(d.bind(d,15451)):await d.e(36).then(d.bind(d,15446)),await(0,Z.e)("rgbdEncode",E,H,n,1,5)}}}}]);