"use strict";(self.fkqm0epoq5=self.fkqm0epoq5||[]).push([[20,21],{12236:(D,l,G)=>{var V=G(12238),N=G(11732);N.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(N.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=V.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((D=>{this._texture._sphericalPolynomial=D,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(D){this._texture&&(this._texture._sphericalPolynomial=D)},enumerable:!0,configurable:!0})},12238:(D,l,G)=>{G.d(l,{e:()=>R});var V=G(11710),N=G(11728),M=G(11904),b=G(11713),X=G(11755);class t{constructor(D,l,G,V){this.name=D,this.worldAxisForNormal=l,this.worldAxisForFileX=G,this.worldAxisForFileY=V}}class R{static ConvertCubeMapTextureToSphericalPolynomial(D){var l;if(!D.isCube)return null;null===(l=D.uD())||void 0===l||l.getEngine().flushFramebuffer();const G=D.getSize().width,V=D.readPixels(0,void 0,void 0,!1),N=D.readPixels(1,void 0,void 0,!1);let M,b;D.isRenderTarget?(M=D.readPixels(3,void 0,void 0,!1),b=D.readPixels(2,void 0,void 0,!1)):(M=D.readPixels(2,void 0,void 0,!1),b=D.readPixels(3,void 0,void 0,!1));const X=D.readPixels(4,void 0,void 0,!1),t=D.readPixels(5,void 0,void 0,!1),R=D.gammaSpace;let n=0;return 1!=D.textureType&&2!=D.textureType||(n=1),new Promise((D=>{Promise.all([N,V,M,b,X,t]).then((l=>{let[V,N,M,b,X,t]=l;const g={size:G,right:N,left:V,up:M,down:b,front:X,back:t,format:5,type:n,gammaSpace:R};D(this.ConvertCubeMapToSphericalPolynomial(g))}))}))}static _AreaElement(D,l){return Math.atan2(D*l,Math.sqrt(D*D+l*l+1))}static ConvertCubeMapToSphericalPolynomial(D){const l=new M.e;let G=0;const V=2/D.size,t=V,R=.5*V,n=R-1;for(let M=0;M<6;M++){const g=this._FileFaces[M],j=D[g.name];let e=n;const K=5===D.format?4:3;for(let M=0;M<D.size;M++){let F=n;for(let t=0;t<D.size;t++){const n=g.worldAxisForFileX.scale(F).add(g.worldAxisForFileY.scale(e)).add(g.worldAxisForNormal);n.normalize();const d=this._AreaElement(F-R,e-R)-this._AreaElement(F-R,e+R)-this._AreaElement(F+R,e-R)+this._AreaElement(F+R,e+R);let H=j[M*D.size*K+t*K+0],h=j[M*D.size*K+t*K+1],x=j[M*D.size*K+t*K+2];isNaN(H)&&(H=0),isNaN(h)&&(h=0),isNaN(x)&&(x=0),0===D.type&&(H/=255,h/=255,x/=255),D.gammaSpace&&(H=Math.pow((0,N.Clamp)(H),b.k),h=Math.pow((0,N.Clamp)(h),b.k),x=Math.pow((0,N.Clamp)(x),b.k));const r=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const D=Math.max(H,h,x);if(D>r){const l=r/D;H*=l,h*=l,x*=l}}else H=(0,N.Clamp)(H,0,r),h=(0,N.Clamp)(h,0,r),x=(0,N.Clamp)(x,0,r);const o=new X.hl(H,h,x);l.addLight(n,o,d),G+=d,F+=V}e+=t}}const g=6*(4*Math.PI)/6/G;return l.scaleInPlace(g),l.convertIncidentRadianceToIrradiance(),l.convertIrradianceToLambertianRadiance(),M.h.FromHarmonics(l)}}R._FileFaces=[new t("right",new V.Kl(1,0,0),new V.Kl(0,0,-1),new V.Kl(0,-1,0)),new t("left",new V.Kl(-1,0,0),new V.Kl(0,0,1),new V.Kl(0,-1,0)),new t("up",new V.Kl(0,1,0),new V.Kl(1,0,0),new V.Kl(0,0,1)),new t("down",new V.Kl(0,-1,0),new V.Kl(1,0,0),new V.Kl(0,0,-1)),new t("front",new V.Kl(0,0,1),new V.Kl(1,0,0),new V.Kl(0,-1,0)),new t("back",new V.Kl(0,0,-1),new V.Kl(-1,0,0),new V.Kl(0,-1,0))],R.MAX_HDRI_VALUE=4096,R.PRESERVE_CLAMPED_COLORS=!1},11940:(D,l,G)=>{G.r(l),G.d(l,{Dispose:()=>j,DumpData:()=>g,DumpDataAsync:()=>n,DumpFramebuffer:()=>R,DumpTools:()=>e});var V=G(11822),N=G(11530),M=G(11728),b=G(11571);let X,t=null;async function R(D,l,G,V){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",M=arguments.length>5?arguments[5]:void 0,b=arguments.length>6?arguments[6]:void 0;const X=await G.readPixels(0,0,D,l);g(D,l,new Uint8Array(X.buffer),V,N,M,!0,void 0,b)}async function n(D,l,G){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",N=arguments.length>4?arguments[4]:void 0,M=arguments.length>5&&void 0!==arguments[5]&&arguments[5],b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7?arguments[7]:void 0;return await new Promise((t=>{g(D,l,G,(D=>t(D)),V,N,M,b,X)}))}function g(D,l,R,n){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",e=arguments.length>5?arguments[5]:void 0,K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]&&arguments[7],d=arguments.length>8?arguments[8]:void 0;(async function(){return t||(t=new Promise(((D,l)=>{let N,M=null;const t={Xb:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(G.bind(G,11851)).then((R=>{let{ThinEngine:n}=R;const g=b.d.Instances.length;try{N=new OffscreenCanvas(100,100),M=new n(N,!1,t)}catch(F){var e;g<b.d.Instances.length&&(null===(e=b.d.Instances.pop())||void 0===e||e.dispose()),N=document.createElement("canvas"),M=new n(N,!1,t)}b.d.Instances.pop(),b.d.OnEnginesDisposedObservable.add((D=>{M&&D!==M&&!M.X&&0===b.d.Instances.length&&j()})),M.getCaps().parallelShaderCompile=void 0;const K=new V.b(M);G.e(52).then(G.bind(G,14169)).then((G=>{let{passPixelShader:b}=G;if(!M)return void l("Engine is not defined");const t=new V.e({el:M,name:b.name,fragmentShader:b.shader,samplerNames:["textureSampler"]});X={canvas:N,el:M,renderer:K,wrapper:t},D(X)}))})).catch(l)}))),await t})().then((G=>{if(G.el.setSize(D,l,!0),R instanceof Float32Array){const D=new Uint8Array(R.length);let l=R.length;for(;l--;){const G=R[l];D[l]=Math.round(255*(0,M.Clamp)(G))}R=D}const V=G.el.createRawTexture(R,D,l,5,!1,!K,1);G.renderer.setViewport(),G.renderer.applyEffectWrapper(G.wrapper),G.wrapper.effect._bindTexture("textureSampler",V),G.renderer.draw(),F?N.Tools.ToBlob(G.canvas,(D=>{const l=new FileReader;l.onload=D=>{const l=D.target.result;n&&n(l)},l.readAsArrayBuffer(D)}),g,d):N.Tools.EncodeScreenshotCanvasData(G.canvas,n,g,e,d),V.dispose()}))}function j(){var D;X?(X.wrapper.dispose(),X.renderer.dispose(),X.el.dispose()):null===(D=t)||void 0===D||D.then((D=>{D.wrapper.dispose(),D.renderer.dispose(),D.el.dispose()}));t=null,X=null}const e={DumpData:g,DumpDataAsync:n,DumpFramebuffer:R,Dispose:j};N.Tools.DumpData=g,N.Tools.DumpDataAsync=n,N.Tools.DumpFramebuffer=R},12223:(D,l,G)=>{G.d(l,{d:()=>M});var V=G(11820),N=G(11948);class M{static ExpandRGBDTexture(D){const l=D._texture;if(!l||!D.isRGBD)return;const N=l.getEngine(),M=N.getCaps(),b=l.isReady;let X=!1;M.textureHalfFloatRender&&M.textureHalfFloatLinearFiltering?(X=!0,l.type=2):M.textureFloatRender&&M.textureFloatLinearFiltering&&(X=!0,l.type=1),X&&(l.isReady=!1,l._isRGBD=!1,l.invertY=!1);const t=async()=>{const M=N.isWebGPU,b=M?1:0;l.isReady=!1,M?await G.e(42).then(G.bind(G,14680)):await G.e(35).then(G.bind(G,14687));const X=new V.c("rgbdDecode","rgbdDecode",null,null,1,null,3,N,!1,void 0,l.type,void 0,null,!1,void 0,b);X.externalTextureSamplerBinding=!0;const t=N.createRenderTargetTexture(l.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:l.samplingMode,type:l.type,format:5});X.onEffectCreatedObservable.addOnce((G=>{G.executeWhenCompiled((()=>{X.onApply=D=>{D._bindTexture("textureSampler",l),D.setFloat2("scale",1,1)},D.uD().postProcessManager.directRender([X],t,!0),N.restoreDefaultFramebuffer(),N._releaseTexture(l),X&&X.dispose(),t._swapAndDie(l),l.isReady=!0}))}))};X&&(b?t():D.onLoadObservable.addOnce(t))}static async EncodeTextureToRGBD(D,l){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return l.getEngine().isWebGPU?await G.e(43).then(G.bind(G,14701)):await G.e(36).then(G.bind(G,14696)),await(0,N.e)("rgbdEncode",D,l,V,1,5)}}}}]);