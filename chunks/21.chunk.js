"use strict";(self["686i8587bmi"]=self["686i8587bmi"]||[]).push([[20,21],{13287:(h,d,T)=>{var Y=T(13293),y=T(12791);y.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(y.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=Y.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((h=>{this._texture._sphericalPolynomial=h,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(h){this._texture&&(this._texture._sphericalPolynomial=h)},enumerable:!0,configurable:!0})},13293:(h,d,T)=>{T.d(d,{e:()=>U});var Y=T(12765),y=T(12787),C=T(12939),n=T(12772),X=T(12812);class F{constructor(h,d,T,Y){this.name=h,this.worldAxisForNormal=d,this.worldAxisForFileX=T,this.worldAxisForFileY=Y}}class U{static ConvertCubeMapTextureToSphericalPolynomial(h){var d;if(!h.isCube)return null;null===(d=h.Eh())||void 0===d||d.getEngine().flushFramebuffer();const T=h.getSize().width,Y=h.readPixels(0,void 0,void 0,!1),y=h.readPixels(1,void 0,void 0,!1);let C,n;h.isRenderTarget?(C=h.readPixels(3,void 0,void 0,!1),n=h.readPixels(2,void 0,void 0,!1)):(C=h.readPixels(2,void 0,void 0,!1),n=h.readPixels(3,void 0,void 0,!1));const X=h.readPixels(4,void 0,void 0,!1),F=h.readPixels(5,void 0,void 0,!1),U=h.gammaSpace;let Z=0;return 1!=h.textureType&&2!=h.textureType||(Z=1),new Promise((h=>{Promise.all([y,Y,C,n,X,F]).then((d=>{let[Y,y,C,n,X,F]=d;const S={size:T,right:y,left:Y,up:C,down:n,front:X,back:F,format:5,type:Z,gammaSpace:U};h(this.ConvertCubeMapToSphericalPolynomial(S))}))}))}static _AreaElement(h,d){return Math.atan2(h*d,Math.sqrt(h*h+d*d+1))}static ConvertCubeMapToSphericalPolynomial(h){const d=new C.d;let T=0;const Y=2/h.size,F=Y,U=.5*Y,Z=U-1;for(let C=0;C<6;C++){const S=this._FileFaces[C],r=h[S.name];let c=Z;const O=5===h.format?4:3;for(let C=0;C<h.size;C++){let f=Z;for(let F=0;F<h.size;F++){const Z=S.worldAxisForFileX.scale(f).add(S.worldAxisForFileY.scale(c)).add(S.worldAxisForNormal);Z.normalize();const J=this._AreaElement(f-U,c-U)-this._AreaElement(f-U,c+U)-this._AreaElement(f+U,c-U)+this._AreaElement(f+U,c+U);let W=r[C*h.size*O+F*O+0],L=r[C*h.size*O+F*O+1],D=r[C*h.size*O+F*O+2];isNaN(W)&&(W=0),isNaN(L)&&(L=0),isNaN(D)&&(D=0),0===h.type&&(W/=255,L/=255,D/=255),h.gammaSpace&&(W=Math.pow((0,y.Clamp)(W),n.l),L=Math.pow((0,y.Clamp)(L),n.l),D=Math.pow((0,y.Clamp)(D),n.l));const V=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const h=Math.max(W,L,D);if(h>V){const d=V/h;W*=d,L*=d,D*=d}}else W=(0,y.Clamp)(W,0,V),L=(0,y.Clamp)(L,0,V),D=(0,y.Clamp)(D,0,V);const i=new X.ed(W,L,D);d.addLight(Z,i,J),T+=J,f+=Y}c+=F}}const S=6*(4*Math.PI)/6/T;return d.scaleInPlace(S),d.convertIncidentRadianceToIrradiance(),d.convertIrradianceToLambertianRadiance(),C.g.FromHarmonics(d)}}U._FileFaces=[new F("right",new Y.pd(1,0,0),new Y.pd(0,0,-1),new Y.pd(0,-1,0)),new F("left",new Y.pd(-1,0,0),new Y.pd(0,0,1),new Y.pd(0,-1,0)),new F("up",new Y.pd(0,1,0),new Y.pd(1,0,0),new Y.pd(0,0,1)),new F("down",new Y.pd(0,-1,0),new Y.pd(1,0,0),new Y.pd(0,0,-1)),new F("front",new Y.pd(0,0,1),new Y.pd(1,0,0),new Y.pd(0,-1,0)),new F("back",new Y.pd(0,0,-1),new Y.pd(-1,0,0),new Y.pd(0,-1,0))],U.MAX_HDRI_VALUE=4096,U.PRESERVE_CLAMPED_COLORS=!1},12972:(h,d,T)=>{T.r(d),T.d(d,{Dispose:()=>r,DumpData:()=>S,DumpDataAsync:()=>Z,DumpFramebuffer:()=>U,DumpTools:()=>c});var Y=T(12867),y=T(12574),C=T(12787),n=T(12625);let X,F=null;async function U(h,d,T,Y){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",C=arguments.length>5?arguments[5]:void 0,n=arguments.length>6?arguments[6]:void 0;const X=await T.readPixels(0,0,h,d);S(h,d,new Uint8Array(X.buffer),Y,y,C,!0,void 0,n)}async function Z(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",y=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7?arguments[7]:void 0;return await new Promise((F=>{S(h,d,T,(h=>F(h)),Y,y,C,n,X)}))}function S(h,d,U,Z){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",c=arguments.length>5?arguments[5]:void 0,O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],f=arguments.length>7&&void 0!==arguments[7]&&arguments[7],J=arguments.length>8?arguments[8]:void 0;(async function(){return F||(F=new Promise(((h,d)=>{let y,C=null;const F={o:!0,depth:!1,xd:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(T.bind(T,12890)).then((U=>{let{ThinEngine:Z}=U;const S=n.d.Instances.length;try{y=new OffscreenCanvas(100,100),C=new Z(y,!1,F)}catch(f){var c;S<n.d.Instances.length&&(null===(c=n.d.Instances.pop())||void 0===c||c.dispose()),y=document.createElement("canvas"),C=new Z(y,!1,F)}n.d.Instances.pop(),n.d.OnEnginesDisposedObservable.add((h=>{C&&h!==C&&!C.U&&0===n.d.Instances.length&&r()})),C.getCaps().parallelShaderCompile=void 0;const O=new Y.d(C);T.e(52).then(T.bind(T,15286)).then((T=>{let{passPixelShader:n}=T;if(!C)return void d("Engine is not defined");const F=new Y.h({Hd:C,name:n.name,fragmentShader:n.shader,samplerNames:["textureSampler"]});X={canvas:y,Hd:C,renderer:O,wrapper:F},h(X)}))})).catch(d)}))),await F})().then((T=>{if(T.Hd.setSize(h,d,!0),U instanceof Float32Array){const h=new Uint8Array(U.length);let d=U.length;for(;d--;){const T=U[d];h[d]=Math.round(255*(0,C.Clamp)(T))}U=h}const Y=T.Hd.createRawTexture(U,h,d,5,!1,!O,1);T.renderer.setViewport(),T.renderer.applyEffectWrapper(T.wrapper),T.wrapper.effect._bindTexture("textureSampler",Y),T.renderer.draw(),f?y.Tools.ToBlob(T.canvas,(h=>{const d=new FileReader;d.onload=h=>{const d=h.target.result;Z&&Z(d)},d.readAsArrayBuffer(h)}),S,J):y.Tools.EncodeScreenshotCanvasData(T.canvas,Z,S,c,J),Y.dispose()}))}function r(){var h;X?(X.wrapper.dispose(),X.renderer.dispose(),X.Hd.dispose()):null===(h=F)||void 0===h||h.then((h=>{h.wrapper.dispose(),h.renderer.dispose(),h.Hd.dispose()}));F=null,X=null}const c={DumpData:S,DumpDataAsync:Z,DumpFramebuffer:U,Dispose:r};y.Tools.DumpData=S,y.Tools.DumpDataAsync=Z,y.Tools.DumpFramebuffer=U},13277:(h,d,T)=>{T.d(d,{e:()=>C});var Y=T(12864),y=T(12979);class C{static ExpandRGBDTexture(h){const d=h._texture;if(!d||!h.isRGBD)return;const y=d.getEngine(),C=y.getCaps(),n=d.isReady;let X=!1;C.textureHalfFloatRender&&C.textureHalfFloatLinearFiltering?(X=!0,d.type=2):C.textureFloatRender&&C.textureFloatLinearFiltering&&(X=!0,d.type=1),X&&(d.isReady=!1,d._isRGBD=!1,d.invertY=!1);const F=async()=>{const C=y.isWebGPU,n=C?1:0;d.isReady=!1,C?await T.e(42).then(T.bind(T,15882)):await T.e(35).then(T.bind(T,15890));const X=new Y.b("rgbdDecode","rgbdDecode",null,null,1,null,3,y,!1,void 0,d.type,void 0,null,!1,void 0,n);X.externalTextureSamplerBinding=!0;const F=y.createRenderTargetTexture(d.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:d.samplingMode,type:d.type,format:5});X.onEffectCreatedObservable.addOnce((T=>{T.executeWhenCompiled((()=>{X.onApply=h=>{h._bindTexture("textureSampler",d),h.setFloat2("scale",1,1)},h.Eh().postProcessManager.directRender([X],F,!0),y.restoreDefaultFramebuffer(),y._releaseTexture(d),X&&X.dispose(),F._swapAndDie(d),d.isReady=!0}))}))};X&&(n?F():h.onLoadObservable.addOnce(F))}static async EncodeTextureToRGBD(h,d){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return d.getEngine().isWebGPU?await T.e(43).then(T.bind(T,15898)):await T.e(36).then(T.bind(T,15894)),await(0,y.c)("rgbdEncode",h,d,Y,1,5)}}}}]);