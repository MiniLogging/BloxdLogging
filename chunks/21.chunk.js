"use strict";(self.wy695la1oic=self.wy695la1oic||[]).push([[20,21],{11877:(S,v,D)=>{var z=D(11881),e=D(11400);e.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(e.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=z.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((S=>{this._texture._sphericalPolynomial=S,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(S){this._texture&&(this._texture._sphericalPolynomial=S)},enumerable:!0,configurable:!0})},11881:(S,v,D)=>{D.d(v,{d:()=>E});var z=D(11371),e=D(11393),N=D(11573),m=D(11377),B=D(11425);class g{constructor(S,v,D,z){this.name=S,this.worldAxisForNormal=v,this.worldAxisForFileX=D,this.worldAxisForFileY=z}}class E{static ConvertCubeMapTextureToSphericalPolynomial(S){var v;if(!S.isCube)return null;null===(v=S.xS())||void 0===v||v.getEngine().flushFramebuffer();const D=S.getSize().width,z=S.readPixels(0,void 0,void 0,!1),e=S.readPixels(1,void 0,void 0,!1);let N,m;S.isRenderTarget?(N=S.readPixels(3,void 0,void 0,!1),m=S.readPixels(2,void 0,void 0,!1)):(N=S.readPixels(2,void 0,void 0,!1),m=S.readPixels(3,void 0,void 0,!1));const B=S.readPixels(4,void 0,void 0,!1),g=S.readPixels(5,void 0,void 0,!1),E=S.gammaSpace;let h=0;return 1!=S.textureType&&2!=S.textureType||(h=1),new Promise((S=>{Promise.all([e,z,N,m,B,g]).then((v=>{let[z,e,N,m,B,g]=v;const A={size:D,right:e,left:z,up:N,down:m,front:B,back:g,format:5,type:h,gammaSpace:E};S(this.ConvertCubeMapToSphericalPolynomial(A))}))}))}static _AreaElement(S,v){return Math.atan2(S*v,Math.sqrt(S*S+v*v+1))}static ConvertCubeMapToSphericalPolynomial(S){const v=new N.d;let D=0;const z=2/S.size,g=z,E=.5*z,h=E-1;for(let N=0;N<6;N++){const A=this._FileFaces[N],w=S[A.name];let n=h;const R=5===S.format?4:3;for(let N=0;N<S.size;N++){let O=h;for(let g=0;g<S.size;g++){const h=A.worldAxisForFileX.scale(O).add(A.worldAxisForFileY.scale(n)).add(A.worldAxisForNormal);h.normalize();const I=this._AreaElement(O-E,n-E)-this._AreaElement(O-E,n+E)-this._AreaElement(O+E,n-E)+this._AreaElement(O+E,n+E);let K=w[N*S.size*R+g*R+0],q=w[N*S.size*R+g*R+1],u=w[N*S.size*R+g*R+2];isNaN(K)&&(K=0),isNaN(q)&&(q=0),isNaN(u)&&(u=0),0===S.type&&(K/=255,q/=255,u/=255),S.gammaSpace&&(K=Math.pow((0,e.Clamp)(K),m.m),q=Math.pow((0,e.Clamp)(q),m.m),u=Math.pow((0,e.Clamp)(u),m.m));const s=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const S=Math.max(K,q,u);if(S>s){const v=s/S;K*=v,q*=v,u*=v}}else K=(0,e.Clamp)(K,0,s),q=(0,e.Clamp)(q,0,s),u=(0,e.Clamp)(u,0,s);const r=new B.qv(K,q,u);v.addLight(h,r,I),D+=I,O+=z}n+=g}}const A=6*(4*Math.PI)/6/D;return v.scaleInPlace(A),v.convertIncidentRadianceToIrradiance(),v.convertIrradianceToLambertianRadiance(),N.g.FromHarmonics(v)}}E._FileFaces=[new g("right",new z.Rv(1,0,0),new z.Rv(0,0,-1),new z.Rv(0,-1,0)),new g("left",new z.Rv(-1,0,0),new z.Rv(0,0,1),new z.Rv(0,-1,0)),new g("up",new z.Rv(0,1,0),new z.Rv(1,0,0),new z.Rv(0,0,1)),new g("down",new z.Rv(0,-1,0),new z.Rv(1,0,0),new z.Rv(0,0,-1)),new g("front",new z.Rv(0,0,1),new z.Rv(1,0,0),new z.Rv(0,-1,0)),new g("back",new z.Rv(0,0,-1),new z.Rv(-1,0,0),new z.Rv(0,-1,0))],E.MAX_HDRI_VALUE=4096,E.PRESERVE_CLAMPED_COLORS=!1},11605:(S,v,D)=>{D.r(v),D.d(v,{Dispose:()=>w,DumpData:()=>A,DumpDataAsync:()=>h,DumpFramebuffer:()=>E,DumpTools:()=>n});var z=D(11488),e=D(11175),N=D(11393),m=D(11222);let B,g=null;async function E(S,v,D,z){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",N=arguments.length>5?arguments[5]:void 0,m=arguments.length>6?arguments[6]:void 0;const B=await D.readPixels(0,0,S,v);A(S,v,new Uint8Array(B.buffer),z,e,N,!0,void 0,m)}async function h(S,v,D){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",e=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7?arguments[7]:void 0;return await new Promise((g=>{A(S,v,D,(S=>g(S)),z,e,N,m,B)}))}function A(S,v,E,h){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",n=arguments.length>5?arguments[5]:void 0,R=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]&&arguments[7],I=arguments.length>8?arguments[8]:void 0;(async function(){return g||(g=new Promise(((S,v)=>{let e,N=null;const g={Be:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(D.bind(D,11510)).then((E=>{let{ThinEngine:h}=E;const A=m.c.Instances.length;try{e=new OffscreenCanvas(100,100),N=new h(e,!1,g)}catch(O){var n;A<m.c.Instances.length&&(null===(n=m.c.Instances.pop())||void 0===n||n.dispose()),e=document.createElement("canvas"),N=new h(e,!1,g)}m.c.Instances.pop(),m.c.OnEnginesDisposedObservable.add((S=>{N&&S!==N&&!N.h&&0===m.c.Instances.length&&w()})),N.getCaps().parallelShaderCompile=void 0;const R=new z.e(N);D.e(52).then(D.bind(D,13893)).then((D=>{let{passPixelShader:m}=D;if(!N)return void v("Engine is not defined");const g=new z.h({nv:N,name:m.name,fragmentShader:m.shader,samplerNames:["textureSampler"]});B={canvas:e,nv:N,renderer:R,wrapper:g},S(B)}))})).catch(v)}))),await g})().then((D=>{if(D.nv.setSize(S,v,!0),E instanceof Float32Array){const S=new Uint8Array(E.length);let v=E.length;for(;v--;){const D=E[v];S[v]=Math.round(255*(0,N.Clamp)(D))}E=S}const z=D.nv.createRawTexture(E,S,v,5,!1,!R,1);D.renderer.setViewport(),D.renderer.applyEffectWrapper(D.wrapper),D.wrapper.effect._bindTexture("textureSampler",z),D.renderer.draw(),O?e.Tools.ToBlob(D.canvas,(S=>{const v=new FileReader;v.onload=S=>{const v=S.target.result;h&&h(v)},v.readAsArrayBuffer(S)}),A,I):e.Tools.EncodeScreenshotCanvasData(D.canvas,h,A,n,I),z.dispose()}))}function w(){var S;B?(B.wrapper.dispose(),B.renderer.dispose(),B.nv.dispose()):null===(S=g)||void 0===S||S.then((S=>{S.wrapper.dispose(),S.renderer.dispose(),S.nv.dispose()}));g=null,B=null}const n={DumpData:A,DumpDataAsync:h,DumpFramebuffer:E,Dispose:w};e.Tools.DumpData=A,e.Tools.DumpDataAsync=h,e.Tools.DumpFramebuffer=E},11864:(S,v,D)=>{D.d(v,{e:()=>N});var z=D(11485),e=D(11607);class N{static ExpandRGBDTexture(S){const v=S._texture;if(!v||!S.isRGBD)return;const e=v.getEngine(),N=e.getCaps(),m=v.isReady;let B=!1;N.textureHalfFloatRender&&N.textureHalfFloatLinearFiltering?(B=!0,v.type=2):N.textureFloatRender&&N.textureFloatLinearFiltering&&(B=!0,v.type=1),B&&(v.isReady=!1,v._isRGBD=!1,v.invertY=!1);const g=async()=>{const N=e.isWebGPU,m=N?1:0;v.isReady=!1,N?await D.e(42).then(D.bind(D,14435)):await D.e(35).then(D.bind(D,14441));const B=new z.e("rgbdDecode","rgbdDecode",null,null,1,null,3,e,!1,void 0,v.type,void 0,null,!1,void 0,m);B.externalTextureSamplerBinding=!0;const g=e.createRenderTargetTexture(v.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:v.samplingMode,type:v.type,format:5});B.onEffectCreatedObservable.addOnce((D=>{D.executeWhenCompiled((()=>{B.onApply=S=>{S._bindTexture("textureSampler",v),S.setFloat2("scale",1,1)},S.xS().postProcessManager.directRender([B],g,!0),e.restoreDefaultFramebuffer(),e._releaseTexture(v),B&&B.dispose(),g._swapAndDie(v),v.isReady=!0}))}))};B&&(m?g():S.onLoadObservable.addOnce(g))}static async EncodeTextureToRGBD(S,v){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return v.getEngine().isWebGPU?await D.e(43).then(D.bind(D,14458)):await D.e(36).then(D.bind(D,14450)),await(0,e.e)("rgbdEncode",S,v,z,1,5)}}}}]);