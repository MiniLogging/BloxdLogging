"use strict";(self.hwpa2z1pqte=self.hwpa2z1pqte||[]).push([[20,21],{13389:(h,R,l)=>{var j=l(13393),a=l(12925);a.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(a.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=j.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((h=>{this._texture._sphericalPolynomial=h,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(h){this._texture&&(this._texture._sphericalPolynomial=h)},enumerable:!0,configurable:!0})},13393:(h,R,l)=>{l.d(R,{b:()=>mh});var j=l(12900),a=l(12917),D=l(13075),U=l(12902),F=l(12952);class w{constructor(h,R,l,j){this.name=h,this.worldAxisForNormal=R,this.worldAxisForFileX=l,this.worldAxisForFileY=j}}class mh{static ConvertCubeMapTextureToSphericalPolynomial(h){var R;if(!h.isCube)return null;null===(R=h.yh())||void 0===R||R.getEngine().flushFramebuffer();const l=h.getSize().width,j=h.readPixels(0,void 0,void 0,!1),a=h.readPixels(1,void 0,void 0,!1);let D,U;h.isRenderTarget?(D=h.readPixels(3,void 0,void 0,!1),U=h.readPixels(2,void 0,void 0,!1)):(D=h.readPixels(2,void 0,void 0,!1),U=h.readPixels(3,void 0,void 0,!1));const F=h.readPixels(4,void 0,void 0,!1),w=h.readPixels(5,void 0,void 0,!1),mh=h.gammaSpace;let u=0;return 1!=h.textureType&&2!=h.textureType||(u=1),new Promise((h=>{Promise.all([a,j,D,U,F,w]).then((R=>{let[j,a,D,U,F,w]=R;const c={size:l,right:a,left:j,up:D,down:U,front:F,back:w,format:5,type:u,gammaSpace:mh};h(this.ConvertCubeMapToSphericalPolynomial(c))}))}))}static _AreaElement(h,R){return Math.atan2(h*R,Math.sqrt(h*h+R*R+1))}static ConvertCubeMapToSphericalPolynomial(h){const R=new D.b;let l=0;const j=2/h.size,w=j,mh=.5*j,u=mh-1;for(let D=0;D<6;D++){const c=this._FileFaces[D],J=h[c.name];let q=u;const Q=5===h.format?4:3;for(let D=0;D<h.size;D++){let Y=u;for(let w=0;w<h.size;w++){const u=c.worldAxisForFileX.scale(Y).add(c.worldAxisForFileY.scale(q)).add(c.worldAxisForNormal);u.normalize();const s=this._AreaElement(Y-mh,q-mh)-this._AreaElement(Y-mh,q+mh)-this._AreaElement(Y+mh,q-mh)+this._AreaElement(Y+mh,q+mh);let t=J[D*h.size*Q+w*Q+0],f=J[D*h.size*Q+w*Q+1],T=J[D*h.size*Q+w*Q+2];isNaN(t)&&(t=0),isNaN(f)&&(f=0),isNaN(T)&&(T=0),0===h.type&&(t/=255,f/=255,T/=255),h.gammaSpace&&(t=Math.pow((0,a.Clamp)(t),U.j),f=Math.pow((0,a.Clamp)(f),U.j),T=Math.pow((0,a.Clamp)(T),U.j));const E=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const h=Math.max(t,f,T);if(h>E){const R=E/h;t*=R,f*=R,T*=R}}else t=(0,a.Clamp)(t,0,E),f=(0,a.Clamp)(f,0,E),T=(0,a.Clamp)(T,0,E);const x=new F.xR(t,f,T);R.addLight(u,x,s),l+=s,Y+=j}q+=w}}const c=6*(4*Math.PI)/6/l;return R.scaleInPlace(c),R.convertIncidentRadianceToIrradiance(),R.convertIrradianceToLambertianRadiance(),D.f.FromHarmonics(R)}}mh._FileFaces=[new w("right",new j.tR(1,0,0),new j.tR(0,0,-1),new j.tR(0,-1,0)),new w("left",new j.tR(-1,0,0),new j.tR(0,0,1),new j.tR(0,-1,0)),new w("up",new j.tR(0,1,0),new j.tR(1,0,0),new j.tR(0,0,1)),new w("down",new j.tR(0,-1,0),new j.tR(1,0,0),new j.tR(0,0,-1)),new w("front",new j.tR(0,0,1),new j.tR(1,0,0),new j.tR(0,-1,0)),new w("back",new j.tR(0,0,-1),new j.tR(-1,0,0),new j.tR(0,-1,0))],mh.MAX_HDRI_VALUE=4096,mh.PRESERVE_CLAMPED_COLORS=!1},13110:(h,R,l)=>{l.r(R),l.d(R,{Dispose:()=>J,DumpData:()=>c,DumpDataAsync:()=>u,DumpFramebuffer:()=>mh,DumpTools:()=>q});var j=l(13005),a=l(12689),D=l(12917),U=l(12749);let F,w=null;async function mh(h,R,l,j){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",D=arguments.length>5?arguments[5]:void 0,U=arguments.length>6?arguments[6]:void 0;const F=await l.readPixels(0,0,h,R);c(h,R,new Uint8Array(F.buffer),j,a,D,!0,void 0,U)}async function u(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",a=arguments.length>4?arguments[4]:void 0,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7?arguments[7]:void 0;return await new Promise((w=>{c(h,R,l,(h=>w(h)),j,a,D,U,F)}))}function c(h,R,mh,u){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",q=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7&&void 0!==arguments[7]&&arguments[7],s=arguments.length>8?arguments[8]:void 0;(async function(){return w||(w=new Promise(((h,R)=>{let a,D=null;const w={o:!0,depth:!1,uF:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(l.bind(l,13026)).then((mh=>{let{ThinEngine:u}=mh;const c=U.b.Instances.length;try{a=new OffscreenCanvas(100,100),D=new u(a,!1,w)}catch(Y){var q;c<U.b.Instances.length&&(null===(q=U.b.Instances.pop())||void 0===q||q.dispose()),a=document.createElement("canvas"),D=new u(a,!1,w)}U.b.Instances.pop(),U.b.OnEnginesDisposedObservable.add((h=>{D&&h!==D&&!D.mh&&0===U.b.Instances.length&&J()})),D.getCaps().parallelShaderCompile=void 0;const Q=new j.c(D);l.e(52).then(l.bind(l,15412)).then((l=>{let{passPixelShader:U}=l;if(!D)return void R("Engine is not defined");const w=new j.g({sR:D,name:U.name,fragmentShader:U.shader,samplerNames:["textureSampler"]});F={canvas:a,sR:D,renderer:Q,wrapper:w},h(F)}))})).catch(R)}))),await w})().then((l=>{if(l.sR.setSize(h,R,!0),mh instanceof Float32Array){const h=new Uint8Array(mh.length);let R=mh.length;for(;R--;){const l=mh[R];h[R]=Math.round(255*(0,D.Clamp)(l))}mh=h}const j=l.sR.createRawTexture(mh,h,R,5,!1,!Q,1);l.renderer.setViewport(),l.renderer.applyEffectWrapper(l.wrapper),l.wrapper.effect._bindTexture("textureSampler",j),l.renderer.draw(),Y?a.Tools.ToBlob(l.canvas,(h=>{const R=new FileReader;R.onload=h=>{const R=h.target.result;u&&u(R)},R.readAsArrayBuffer(h)}),c,s):a.Tools.EncodeScreenshotCanvasData(l.canvas,u,c,q,s),j.dispose()}))}function J(){var h;F?(F.wrapper.dispose(),F.renderer.dispose(),F.sR.dispose()):null===(h=w)||void 0===h||h.then((h=>{h.wrapper.dispose(),h.renderer.dispose(),h.sR.dispose()}));w=null,F=null}const q={DumpData:c,DumpDataAsync:u,DumpFramebuffer:mh,Dispose:J};a.Tools.DumpData=c,a.Tools.DumpDataAsync=u,a.Tools.DumpFramebuffer=mh},13376:(h,R,l)=>{l.d(R,{e:()=>D});var j=l(13002),a=l(13112);class D{static ExpandRGBDTexture(h){const R=h._texture;if(!R||!h.isRGBD)return;const a=R.getEngine(),D=a.getCaps(),U=R.isReady;let F=!1;D.textureHalfFloatRender&&D.textureHalfFloatLinearFiltering?(F=!0,R.type=2):D.textureFloatRender&&D.textureFloatLinearFiltering&&(F=!0,R.type=1),F&&(R.isReady=!1,R._isRGBD=!1,R.invertY=!1);const w=async()=>{const D=a.isWebGPU,U=D?1:0;R.isReady=!1,D?await l.e(42).then(l.bind(l,15964)):await l.e(35).then(l.bind(l,15971));const F=new j.e("rgbdDecode","rgbdDecode",null,null,1,null,3,a,!1,void 0,R.type,void 0,null,!1,void 0,U);F.externalTextureSamplerBinding=!0;const w=a.createRenderTargetTexture(R.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:R.samplingMode,type:R.type,format:5});F.onEffectCreatedObservable.addOnce((l=>{l.executeWhenCompiled((()=>{F.onApply=h=>{h._bindTexture("textureSampler",R),h.setFloat2("scale",1,1)},h.yh().postProcessManager.directRender([F],w,!0),a.restoreDefaultFramebuffer(),a._releaseTexture(R),F&&F.dispose(),w._swapAndDie(R),R.isReady=!0}))}))};F&&(U?w():h.onLoadObservable.addOnce(w))}static async EncodeTextureToRGBD(h,R){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return R.getEngine().isWebGPU?await l.e(43).then(l.bind(l,15981)):await l.e(36).then(l.bind(l,15979)),await(0,a.b)("rgbdEncode",h,R,j,1,5)}}}}]);