"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[20,21],{11644:(g,w,q)=>{var R=q(11650),o=q(11204);o.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(o.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=R.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((g=>{this._texture._sphericalPolynomial=g,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(g){this._texture&&(this._texture._sphericalPolynomial=g)},enumerable:!0,configurable:!0})},11650:(g,w,q)=>{q.d(w,{c:()=>z});var R=q(11180),o=q(11195),r=q(11345),S=q(11188),i=q(11235);class T{constructor(g,w,q,R){this.name=g,this.worldAxisForNormal=w,this.worldAxisForFileX=q,this.worldAxisForFileY=R}}class z{static ConvertCubeMapTextureToSphericalPolynomial(g){var w;if(!g.isCube)return null;null===(w=g.Ng())||void 0===w||w.getEngine().flushFramebuffer();const q=g.getSize().width,R=g.readPixels(0,void 0,void 0,!1),o=g.readPixels(1,void 0,void 0,!1);let r,S;g.isRenderTarget?(r=g.readPixels(3,void 0,void 0,!1),S=g.readPixels(2,void 0,void 0,!1)):(r=g.readPixels(2,void 0,void 0,!1),S=g.readPixels(3,void 0,void 0,!1));const i=g.readPixels(4,void 0,void 0,!1),T=g.readPixels(5,void 0,void 0,!1),z=g.gammaSpace;let t=0;return 1!=g.textureType&&2!=g.textureType||(t=1),new Promise((g=>{Promise.all([o,R,r,S,i,T]).then((w=>{let[R,o,r,S,i,T]=w;const m={size:q,right:o,left:R,up:r,down:S,front:i,back:T,format:5,type:t,gammaSpace:z};g(this.ConvertCubeMapToSphericalPolynomial(m))}))}))}static _AreaElement(g,w){return Math.atan2(g*w,Math.sqrt(g*g+w*w+1))}static ConvertCubeMapToSphericalPolynomial(g){const w=new r.e;let q=0;const R=2/g.size,T=R,z=.5*R,t=z-1;for(let r=0;r<6;r++){const m=this._FileFaces[r],e=g[m.name];let y=t;const L=5===g.format?4:3;for(let r=0;r<g.size;r++){let A=t;for(let T=0;T<g.size;T++){const t=m.worldAxisForFileX.scale(A).add(m.worldAxisForFileY.scale(y)).add(m.worldAxisForNormal);t.normalize();const l=this._AreaElement(A-z,y-z)-this._AreaElement(A-z,y+z)-this._AreaElement(A+z,y-z)+this._AreaElement(A+z,y+z);let J=e[r*g.size*L+T*L+0],x=e[r*g.size*L+T*L+1],G=e[r*g.size*L+T*L+2];isNaN(J)&&(J=0),isNaN(x)&&(x=0),isNaN(G)&&(G=0),0===g.type&&(J/=255,x/=255,G/=255),g.gammaSpace&&(J=Math.pow((0,o.Clamp)(J),S.h),x=Math.pow((0,o.Clamp)(x),S.h),G=Math.pow((0,o.Clamp)(G),S.h));const d=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const g=Math.max(J,x,G);if(g>d){const w=d/g;J*=w,x*=w,G*=w}}else J=(0,o.Clamp)(J,0,d),x=(0,o.Clamp)(x,0,d),G=(0,o.Clamp)(G,0,d);const D=new i.Jw(J,x,G);w.addLight(t,D,l),q+=l,A+=R}y+=T}}const m=6*(4*Math.PI)/6/q;return w.scaleInPlace(m),w.convertIncidentRadianceToIrradiance(),w.convertIrradianceToLambertianRadiance(),r.h.FromHarmonics(w)}}z._FileFaces=[new T("right",new R.ew(1,0,0),new R.ew(0,0,-1),new R.ew(0,-1,0)),new T("left",new R.ew(-1,0,0),new R.ew(0,0,1),new R.ew(0,-1,0)),new T("up",new R.ew(0,1,0),new R.ew(1,0,0),new R.ew(0,0,1)),new T("down",new R.ew(0,-1,0),new R.ew(1,0,0),new R.ew(0,0,-1)),new T("front",new R.ew(0,0,1),new R.ew(1,0,0),new R.ew(0,-1,0)),new T("back",new R.ew(0,0,-1),new R.ew(-1,0,0),new R.ew(0,-1,0))],z.MAX_HDRI_VALUE=4096,z.PRESERVE_CLAMPED_COLORS=!1},11381:(g,w,q)=>{q.r(w),q.d(w,{Dispose:()=>e,DumpData:()=>m,DumpDataAsync:()=>t,DumpFramebuffer:()=>z,DumpTools:()=>y});var R=q(11276),o=q(10991),r=q(11195),S=q(11034);let i,T=null;async function z(g,w,q,R){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",r=arguments.length>5?arguments[5]:void 0,S=arguments.length>6?arguments[6]:void 0;const i=await q.readPixels(0,0,g,w);m(g,w,new Uint8Array(i.buffer),R,o,r,!0,void 0,S)}async function t(g,w,q){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",o=arguments.length>4?arguments[4]:void 0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7?arguments[7]:void 0;return await new Promise((T=>{m(g,w,q,(g=>T(g)),R,o,r,S,i)}))}function m(g,w,z,t){let m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",y=arguments.length>5?arguments[5]:void 0,L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8?arguments[8]:void 0;(async function(){return T||(T=new Promise(((g,w)=>{let o,r=null;const T={kS:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(q.bind(q,11294)).then((z=>{let{ThinEngine:t}=z;const m=S.c.Instances.length;try{o=new OffscreenCanvas(100,100),r=new t(o,!1,T)}catch(A){var y;m<S.c.Instances.length&&(null===(y=S.c.Instances.pop())||void 0===y||y.dispose()),o=document.createElement("canvas"),r=new t(o,!1,T)}S.c.Instances.pop(),S.c.OnEnginesDisposedObservable.add((g=>{r&&g!==r&&!r.L&&0===S.c.Instances.length&&e()})),r.getCaps().parallelShaderCompile=void 0;const L=new R.b(r);q.e(52).then(q.bind(q,13605)).then((q=>{let{passPixelShader:S}=q;if(!r)return void w("Engine is not defined");const T=new R.d({mw:r,name:S.name,fragmentShader:S.shader,samplerNames:["textureSampler"]});i={canvas:o,mw:r,renderer:L,wrapper:T},g(i)}))})).catch(w)}))),await T})().then((q=>{if(q.mw.setSize(g,w,!0),z instanceof Float32Array){const g=new Uint8Array(z.length);let w=z.length;for(;w--;){const q=z[w];g[w]=Math.round(255*(0,r.Clamp)(q))}z=g}const R=q.mw.createRawTexture(z,g,w,5,!1,!L,1);q.renderer.setViewport(),q.renderer.applyEffectWrapper(q.wrapper),q.wrapper.effect._bindTexture("textureSampler",R),q.renderer.draw(),A?o.Tools.ToBlob(q.canvas,(g=>{const w=new FileReader;w.onload=g=>{const w=g.target.result;t&&t(w)},w.readAsArrayBuffer(g)}),m,l):o.Tools.EncodeScreenshotCanvasData(q.canvas,t,m,y,l),R.dispose()}))}function e(){var g;i?(i.wrapper.dispose(),i.renderer.dispose(),i.mw.dispose()):null===(g=T)||void 0===g||g.then((g=>{g.wrapper.dispose(),g.renderer.dispose(),g.mw.dispose()}));T=null,i=null}const y={DumpData:m,DumpDataAsync:t,DumpFramebuffer:z,Dispose:e};o.Tools.DumpData=m,o.Tools.DumpDataAsync=t,o.Tools.DumpFramebuffer=z},11630:(g,w,q)=>{q.d(w,{d:()=>r});var R=q(11272),o=q(11383);class r{static ExpandRGBDTexture(g){const w=g._texture;if(!w||!g.isRGBD)return;const o=w.getEngine(),r=o.getCaps(),S=w.isReady;let i=!1;r.textureHalfFloatRender&&r.textureHalfFloatLinearFiltering?(i=!0,w.type=2):r.textureFloatRender&&r.textureFloatLinearFiltering&&(i=!0,w.type=1),i&&(w.isReady=!1,w._isRGBD=!1,w.invertY=!1);const T=async()=>{const r=o.isWebGPU,S=r?1:0;w.isReady=!1,r?await q.e(42).then(q.bind(q,14136)):await q.e(35).then(q.bind(q,14145));const i=new R.c("rgbdDecode","rgbdDecode",null,null,1,null,3,o,!1,void 0,w.type,void 0,null,!1,void 0,S);i.externalTextureSamplerBinding=!0;const T=o.createRenderTargetTexture(w.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:w.samplingMode,type:w.type,format:5});i.onEffectCreatedObservable.addOnce((q=>{q.executeWhenCompiled((()=>{i.onApply=g=>{g._bindTexture("textureSampler",w),g.setFloat2("scale",1,1)},g.Ng().postProcessManager.directRender([i],T,!0),o.restoreDefaultFramebuffer(),o._releaseTexture(w),i&&i.dispose(),T._swapAndDie(w),w.isReady=!0}))}))};i&&(S?T():g.onLoadObservable.addOnce(T))}static async EncodeTextureToRGBD(g,w){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return w.getEngine().isWebGPU?await q.e(43).then(q.bind(q,14161)):await q.e(36).then(q.bind(q,14153)),await(0,o.b)("rgbdEncode",g,w,R,1,5)}}}}]);