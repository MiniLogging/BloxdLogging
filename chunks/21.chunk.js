"use strict";(self.nyfa010khv=self.nyfa010khv||[]).push([[20,21],{12634:(L,r,p)=>{var J=p(12639),i=p(12156);i.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(i.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=J.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((L=>{this._texture._sphericalPolynomial=L,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(L){this._texture&&(this._texture._sphericalPolynomial=L)},enumerable:!0,configurable:!0})},12639:(L,r,p)=>{p.d(r,{b:()=>C});var J=p(12136),i=p(12154),n=p(12299),j=p(12140),z=p(12170);class G{constructor(L,r,p,J){this.name=L,this.worldAxisForNormal=r,this.worldAxisForFileX=p,this.worldAxisForFileY=J}}class C{static ConvertCubeMapTextureToSphericalPolynomial(L){var r;if(!L.isCube)return null;null===(r=L.FL())||void 0===r||r.getEngine().flushFramebuffer();const p=L.getSize().width,J=L.readPixels(0,void 0,void 0,!1),i=L.readPixels(1,void 0,void 0,!1);let n,j;L.isRenderTarget?(n=L.readPixels(3,void 0,void 0,!1),j=L.readPixels(2,void 0,void 0,!1)):(n=L.readPixels(2,void 0,void 0,!1),j=L.readPixels(3,void 0,void 0,!1));const z=L.readPixels(4,void 0,void 0,!1),G=L.readPixels(5,void 0,void 0,!1),C=L.gammaSpace;let t=0;return 1!=L.textureType&&2!=L.textureType||(t=1),new Promise((L=>{Promise.all([i,J,n,j,z,G]).then((r=>{let[J,i,n,j,z,G]=r;const E={size:p,right:i,left:J,up:n,down:j,front:z,back:G,format:5,type:t,gammaSpace:C};L(this.ConvertCubeMapToSphericalPolynomial(E))}))}))}static _AreaElement(L,r){return Math.atan2(L*r,Math.sqrt(L*L+r*r+1))}static ConvertCubeMapToSphericalPolynomial(L){const r=new n.d;let p=0;const J=2/L.size,G=J,C=.5*J,t=C-1;for(let n=0;n<6;n++){const E=this._FileFaces[n],x=L[E.name];let w=t;const g=5===L.format?4:3;for(let n=0;n<L.size;n++){let b=t;for(let G=0;G<L.size;G++){const t=E.worldAxisForFileX.scale(b).add(E.worldAxisForFileY.scale(w)).add(E.worldAxisForNormal);t.normalize();const c=this._AreaElement(b-C,w-C)-this._AreaElement(b-C,w+C)-this._AreaElement(b+C,w-C)+this._AreaElement(b+C,w+C);let P=x[n*L.size*g+G*g+0],O=x[n*L.size*g+G*g+1],h=x[n*L.size*g+G*g+2];isNaN(P)&&(P=0),isNaN(O)&&(O=0),isNaN(h)&&(h=0),0===L.type&&(P/=255,O/=255,h/=255),L.gammaSpace&&(P=Math.pow((0,i.Clamp)(P),j.i),O=Math.pow((0,i.Clamp)(O),j.i),h=Math.pow((0,i.Clamp)(h),j.i));const U=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const L=Math.max(P,O,h);if(L>U){const r=U/L;P*=r,O*=r,h*=r}}else P=(0,i.Clamp)(P,0,U),O=(0,i.Clamp)(O,0,U),h=(0,i.Clamp)(h,0,U);const W=new z.Wr(P,O,h);r.addLight(t,W,c),p+=c,b+=J}w+=G}}const E=6*(4*Math.PI)/6/p;return r.scaleInPlace(E),r.convertIncidentRadianceToIrradiance(),r.convertIrradianceToLambertianRadiance(),n.h.FromHarmonics(r)}}C._FileFaces=[new G("right",new J.cr(1,0,0),new J.cr(0,0,-1),new J.cr(0,-1,0)),new G("left",new J.cr(-1,0,0),new J.cr(0,0,1),new J.cr(0,-1,0)),new G("up",new J.cr(0,1,0),new J.cr(1,0,0),new J.cr(0,0,1)),new G("down",new J.cr(0,-1,0),new J.cr(1,0,0),new J.cr(0,0,-1)),new G("front",new J.cr(0,0,1),new J.cr(1,0,0),new J.cr(0,-1,0)),new G("back",new J.cr(0,0,-1),new J.cr(-1,0,0),new J.cr(0,-1,0))],C.MAX_HDRI_VALUE=4096,C.PRESERVE_CLAMPED_COLORS=!1},12336:(L,r,p)=>{p.r(r),p.d(r,{Dispose:()=>x,DumpData:()=>E,DumpDataAsync:()=>t,DumpFramebuffer:()=>C,DumpTools:()=>w});var J=p(12235),i=p(11957),n=p(12154),j=p(12009);let z,G=null;async function C(L,r,p,J){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",n=arguments.length>5?arguments[5]:void 0,j=arguments.length>6?arguments[6]:void 0;const z=await p.readPixels(0,0,L,r);E(L,r,new Uint8Array(z.buffer),J,i,n,!0,void 0,j)}async function t(L,r,p){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",i=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7?arguments[7]:void 0;return await new Promise((G=>{E(L,r,p,(L=>G(L)),J,i,n,j,z)}))}function E(L,r,C,t){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",w=arguments.length>5?arguments[5]:void 0,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8?arguments[8]:void 0;(async function(){return G||(G=new Promise(((L,r)=>{let i,n=null;const G={oi:!0,depth:!1,ti:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(p.bind(p,12257)).then((C=>{let{ThinEngine:t}=C;const E=j.c.Instances.length;try{i=new OffscreenCanvas(100,100),n=new t(i,!1,G)}catch(b){var w;E<j.c.Instances.length&&(null===(w=j.c.Instances.pop())||void 0===w||w.dispose()),i=document.createElement("canvas"),n=new t(i,!1,G)}j.c.Instances.pop(),j.c.OnEnginesDisposedObservable.add((L=>{n&&L!==n&&!n.P&&0===j.c.Instances.length&&x()})),n.getCaps().parallelShaderCompile=void 0;const g=new J.e(n);p.e(52).then(p.bind(p,14636)).then((p=>{let{passPixelShader:j}=p;if(!n)return void r("Engine is not defined");const G=new J.g({gr:n,name:j.name,fragmentShader:j.shader,samplerNames:["textureSampler"]});z={canvas:i,gr:n,renderer:g,wrapper:G},L(z)}))})).catch(r)}))),await G})().then((p=>{if(p.gr.setSize(L,r,!0),C instanceof Float32Array){const L=new Uint8Array(C.length);let r=C.length;for(;r--;){const p=C[r];L[r]=Math.round(255*(0,n.Clamp)(p))}C=L}const J=p.gr.createRawTexture(C,L,r,5,!1,!g,1);p.renderer.setViewport(),p.renderer.applyEffectWrapper(p.wrapper),p.wrapper.effect._bindTexture("textureSampler",J),p.renderer.draw(),b?i.Tools.ToBlob(p.canvas,(L=>{const r=new FileReader;r.onload=L=>{const r=L.target.result;t&&t(r)},r.readAsArrayBuffer(L)}),E,c):i.Tools.EncodeScreenshotCanvasData(p.canvas,t,E,w,c),J.dispose()}))}function x(){var L;z?(z.wrapper.dispose(),z.renderer.dispose(),z.gr.dispose()):null===(L=G)||void 0===L||L.then((L=>{L.wrapper.dispose(),L.renderer.dispose(),L.gr.dispose()}));G=null,z=null}const w={DumpData:E,DumpDataAsync:t,DumpFramebuffer:C,Dispose:x};i.Tools.DumpData=E,i.Tools.DumpDataAsync=t,i.Tools.DumpFramebuffer=C},12625:(L,r,p)=>{p.d(r,{c:()=>n});var J=p(12228),i=p(12343);class n{static ExpandRGBDTexture(L){const r=L._texture;if(!r||!L.isRGBD)return;const i=r.getEngine(),n=i.getCaps(),j=r.isReady;let z=!1;n.textureHalfFloatRender&&n.textureHalfFloatLinearFiltering?(z=!0,r.type=2):n.textureFloatRender&&n.textureFloatLinearFiltering&&(z=!0,r.type=1),z&&(r.isReady=!1,r._isRGBD=!1,r.invertY=!1);const G=async()=>{const n=i.isWebGPU,j=n?1:0;r.isReady=!1,n?await p.e(42).then(p.bind(p,15142)):await p.e(35).then(p.bind(p,15149));const z=new J.d("rgbdDecode","rgbdDecode",null,null,1,null,3,i,!1,void 0,r.type,void 0,null,!1,void 0,j);z.externalTextureSamplerBinding=!0;const G=i.createRenderTargetTexture(r.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:r.samplingMode,type:r.type,format:5});z.onEffectCreatedObservable.addOnce((p=>{p.executeWhenCompiled((()=>{z.onApply=L=>{L._bindTexture("textureSampler",r),L.setFloat2("scale",1,1)},L.FL().postProcessManager.directRender([z],G,!0),i.restoreDefaultFramebuffer(),i._releaseTexture(r),z&&z.dispose(),G._swapAndDie(r),r.isReady=!0}))}))};z&&(j?G():L.onLoadObservable.addOnce(G))}static async EncodeTextureToRGBD(L,r){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return r.getEngine().isWebGPU?await p.e(43).then(p.bind(p,15162)):await p.e(36).then(p.bind(p,15153)),await(0,i.d)("rgbdEncode",L,r,J,1,5)}}}}]);