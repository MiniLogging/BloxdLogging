"use strict";(self.n4ygn1cq9vg=self.n4ygn1cq9vg||[]).push([[20,21],{12934:(e,d,v)=>{var P=v(12941),p=v(12446);p.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(p.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=P.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((e=>{this._texture._sphericalPolynomial=e,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0})},12941:(e,d,v)=>{v.d(d,{d:()=>W});var P=v(12420),p=v(12440),L=v(12609),B=v(12429),X=v(12463);class z{constructor(e,d,v,P){this.name=e,this.worldAxisForNormal=d,this.worldAxisForFileX=v,this.worldAxisForFileY=P}}class W{static ConvertCubeMapTextureToSphericalPolynomial(e){var d;if(!e.isCube)return null;null===(d=e.Ae())||void 0===d||d.getEngine().flushFramebuffer();const v=e.getSize().width,P=e.readPixels(0,void 0,void 0,!1),p=e.readPixels(1,void 0,void 0,!1);let L,B;e.isRenderTarget?(L=e.readPixels(3,void 0,void 0,!1),B=e.readPixels(2,void 0,void 0,!1)):(L=e.readPixels(2,void 0,void 0,!1),B=e.readPixels(3,void 0,void 0,!1));const X=e.readPixels(4,void 0,void 0,!1),z=e.readPixels(5,void 0,void 0,!1),W=e.gammaSpace;let V=0;return 1!=e.textureType&&2!=e.textureType||(V=1),new Promise((e=>{Promise.all([p,P,L,B,X,z]).then((d=>{let[P,p,L,B,X,z]=d;const k={size:v,right:p,left:P,up:L,down:B,front:X,back:z,format:5,type:V,gammaSpace:W};e(this.ConvertCubeMapToSphericalPolynomial(k))}))}))}static _AreaElement(e,d){return Math.atan2(e*d,Math.sqrt(e*e+d*d+1))}static ConvertCubeMapToSphericalPolynomial(e){const d=new L.c;let v=0;const P=2/e.size,z=P,W=.5*P,V=W-1;for(let L=0;L<6;L++){const k=this._FileFaces[L],g=e[k.name];let F=V;const w=5===e.format?4:3;for(let L=0;L<e.size;L++){let G=V;for(let z=0;z<e.size;z++){const V=k.worldAxisForFileX.scale(G).add(k.worldAxisForFileY.scale(F)).add(k.worldAxisForNormal);V.normalize();const U=this._AreaElement(G-W,F-W)-this._AreaElement(G-W,F+W)-this._AreaElement(G+W,F-W)+this._AreaElement(G+W,F+W);let D=g[L*e.size*w+z*w+0],C=g[L*e.size*w+z*w+1],q=g[L*e.size*w+z*w+2];isNaN(D)&&(D=0),isNaN(C)&&(C=0),isNaN(q)&&(q=0),0===e.type&&(D/=255,C/=255,q/=255),e.gammaSpace&&(D=Math.pow((0,p.Clamp)(D),B.p),C=Math.pow((0,p.Clamp)(C),B.p),q=Math.pow((0,p.Clamp)(q),B.p));const h=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const e=Math.max(D,C,q);if(e>h){const d=h/e;D*=d,C*=d,q*=d}}else D=(0,p.Clamp)(D,0,h),C=(0,p.Clamp)(C,0,h),q=(0,p.Clamp)(q,0,h);const l=new X.Kd(D,C,q);d.addLight(V,l,U),v+=U,G+=P}F+=z}}const k=6*(4*Math.PI)/6/v;return d.scaleInPlace(k),d.convertIncidentRadianceToIrradiance(),d.convertIrradianceToLambertianRadiance(),L.f.FromHarmonics(d)}}W._FileFaces=[new z("right",new P.mv(1,0,0),new P.mv(0,0,-1),new P.mv(0,-1,0)),new z("left",new P.mv(-1,0,0),new P.mv(0,0,1),new P.mv(0,-1,0)),new z("up",new P.mv(0,1,0),new P.mv(1,0,0),new P.mv(0,0,1)),new z("down",new P.mv(0,-1,0),new P.mv(1,0,0),new P.mv(0,0,-1)),new z("front",new P.mv(0,0,1),new P.mv(1,0,0),new P.mv(0,-1,0)),new z("back",new P.mv(0,0,-1),new P.mv(-1,0,0),new P.mv(0,-1,0))],W.MAX_HDRI_VALUE=4096,W.PRESERVE_CLAMPED_COLORS=!1},12639:(e,d,v)=>{v.r(d),v.d(d,{Dispose:()=>g,DumpData:()=>k,DumpDataAsync:()=>V,DumpFramebuffer:()=>W,DumpTools:()=>F});var P=v(12523),p=v(12240),L=v(12440),B=v(12281);let X,z=null;async function W(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",L=arguments.length>5?arguments[5]:void 0,B=arguments.length>6?arguments[6]:void 0;const X=await v.readPixels(0,0,e,d);k(e,d,new Uint8Array(X.buffer),P,p,L,!0,void 0,B)}async function V(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",p=arguments.length>4?arguments[4]:void 0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7?arguments[7]:void 0;return await new Promise((z=>{k(e,d,v,(e=>z(e)),P,p,L,B,X)}))}function k(e,d,W,V){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",F=arguments.length>5?arguments[5]:void 0,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7&&void 0!==arguments[7]&&arguments[7],U=arguments.length>8?arguments[8]:void 0;(async function(){return z||(z=new Promise(((e,d)=>{let p,L=null;const z={Td:!0,depth:!1,hd:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(v.bind(v,12553)).then((W=>{let{ThinEngine:V}=W;const k=B.c.Instances.length;try{p=new OffscreenCanvas(100,100),L=new V(p,!1,z)}catch(G){var F;k<B.c.Instances.length&&(null===(F=B.c.Instances.pop())||void 0===F||F.dispose()),p=document.createElement("canvas"),L=new V(p,!1,z)}B.c.Instances.pop(),B.c.OnEnginesDisposedObservable.add((e=>{L&&e!==L&&!L.W&&0===B.c.Instances.length&&g()})),L.getCaps().parallelShaderCompile=void 0;const w=new P.c(L);v.e(52).then(v.bind(v,14925)).then((v=>{let{passPixelShader:B}=v;if(!L)return void d("Engine is not defined");const z=new P.f({Ad:L,name:B.name,fragmentShader:B.shader,samplerNames:["textureSampler"]});X={canvas:p,Ad:L,renderer:w,wrapper:z},e(X)}))})).catch(d)}))),await z})().then((v=>{if(v.Ad.setSize(e,d,!0),W instanceof Float32Array){const e=new Uint8Array(W.length);let d=W.length;for(;d--;){const v=W[d];e[d]=Math.round(255*(0,L.Clamp)(v))}W=e}const P=v.Ad.createRawTexture(W,e,d,5,!1,!w,1);v.renderer.setViewport(),v.renderer.applyEffectWrapper(v.wrapper),v.wrapper.effect._bindTexture("textureSampler",P),v.renderer.draw(),G?p.Tools.ToBlob(v.canvas,(e=>{const d=new FileReader;d.onload=e=>{const d=e.target.result;V&&V(d)},d.readAsArrayBuffer(e)}),k,U):p.Tools.EncodeScreenshotCanvasData(v.canvas,V,k,F,U),P.dispose()}))}function g(){var e;X?(X.wrapper.dispose(),X.renderer.dispose(),X.Ad.dispose()):null===(e=z)||void 0===e||e.then((e=>{e.wrapper.dispose(),e.renderer.dispose(),e.Ad.dispose()}));z=null,X=null}const F={DumpData:k,DumpDataAsync:V,DumpFramebuffer:W,Dispose:g};p.Tools.DumpData=k,p.Tools.DumpDataAsync=V,p.Tools.DumpFramebuffer=W},12925:(e,d,v)=>{v.d(d,{c:()=>L});var P=v(12514),p=v(12643);class L{static ExpandRGBDTexture(e){const d=e._texture;if(!d||!e.isRGBD)return;const p=d.getEngine(),L=p.getCaps(),B=d.isReady;let X=!1;L.textureHalfFloatRender&&L.textureHalfFloatLinearFiltering?(X=!0,d.type=2):L.textureFloatRender&&L.textureFloatLinearFiltering&&(X=!0,d.type=1),X&&(d.isReady=!1,d._isRGBD=!1,d.invertY=!1);const z=async()=>{const L=p.isWebGPU,B=L?1:0;d.isReady=!1,L?await v.e(42).then(v.bind(v,15460)):await v.e(35).then(v.bind(v,15469));const X=new P.b("rgbdDecode","rgbdDecode",null,null,1,null,3,p,!1,void 0,d.type,void 0,null,!1,void 0,B);X.externalTextureSamplerBinding=!0;const z=p.createRenderTargetTexture(d.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:d.samplingMode,type:d.type,format:5});X.onEffectCreatedObservable.addOnce((v=>{v.executeWhenCompiled((()=>{X.onApply=e=>{e._bindTexture("textureSampler",d),e.setFloat2("scale",1,1)},e.Ae().postProcessManager.directRender([X],z,!0),p.restoreDefaultFramebuffer(),p._releaseTexture(d),X&&X.dispose(),z._swapAndDie(d),d.isReady=!0}))}))};X&&(B?z():e.onLoadObservable.addOnce(z))}static async EncodeTextureToRGBD(e,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return d.getEngine().isWebGPU?await v.e(43).then(v.bind(v,15479)):await v.e(36).then(v.bind(v,15472)),await(0,p.c)("rgbdEncode",e,d,P,1,5)}}}}]);