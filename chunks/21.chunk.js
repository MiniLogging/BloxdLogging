"use strict";(self.ozi0exxand9=self.ozi0exxand9||[]).push([[20,21],{11908:(f,v,Z)=>{var V=Z(11916),h=Z(11446);h.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(h.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=V.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((f=>{this._texture._sphericalPolynomial=f,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(f){this._texture&&(this._texture._sphericalPolynomial=f)},enumerable:!0,configurable:!0})},11916:(f,v,Z)=>{Z.d(v,{d:()=>H});var V=Z(11421),h=Z(11440),J=Z(11599),l=Z(11428),e=Z(11472);class C{constructor(f,v,Z,V){this.name=f,this.worldAxisForNormal=v,this.worldAxisForFileX=Z,this.worldAxisForFileY=V}}class H{static ConvertCubeMapTextureToSphericalPolynomial(f){var v;if(!f.isCube)return null;null===(v=f.Yf())||void 0===v||v.getEngine().flushFramebuffer();const Z=f.getSize().width,V=f.readPixels(0,void 0,void 0,!1),h=f.readPixels(1,void 0,void 0,!1);let J,l;f.isRenderTarget?(J=f.readPixels(3,void 0,void 0,!1),l=f.readPixels(2,void 0,void 0,!1)):(J=f.readPixels(2,void 0,void 0,!1),l=f.readPixels(3,void 0,void 0,!1));const e=f.readPixels(4,void 0,void 0,!1),C=f.readPixels(5,void 0,void 0,!1),H=f.gammaSpace;let O=0;return 1!=f.textureType&&2!=f.textureType||(O=1),new Promise((f=>{Promise.all([h,V,J,l,e,C]).then((v=>{let[V,h,J,l,e,C]=v;const u={size:Z,right:h,left:V,up:J,down:l,front:e,back:C,format:5,type:O,gammaSpace:H};f(this.ConvertCubeMapToSphericalPolynomial(u))}))}))}static _AreaElement(f,v){return Math.atan2(f*v,Math.sqrt(f*f+v*v+1))}static ConvertCubeMapToSphericalPolynomial(f){const v=new J.c;let Z=0;const V=2/f.size,C=V,H=.5*V,O=H-1;for(let J=0;J<6;J++){const u=this._FileFaces[J],W=f[u.name];let a=O;const b=5===f.format?4:3;for(let J=0;J<f.size;J++){let X=O;for(let C=0;C<f.size;C++){const O=u.worldAxisForFileX.scale(X).add(u.worldAxisForFileY.scale(a)).add(u.worldAxisForNormal);O.normalize();const F=this._AreaElement(X-H,a-H)-this._AreaElement(X-H,a+H)-this._AreaElement(X+H,a-H)+this._AreaElement(X+H,a+H);let U=W[J*f.size*b+C*b+0],K=W[J*f.size*b+C*b+1],M=W[J*f.size*b+C*b+2];isNaN(U)&&(U=0),isNaN(K)&&(K=0),isNaN(M)&&(M=0),0===f.type&&(U/=255,K/=255,M/=255),f.gammaSpace&&(U=Math.pow((0,h.Clamp)(U),l.h),K=Math.pow((0,h.Clamp)(K),l.h),M=Math.pow((0,h.Clamp)(M),l.h));const A=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const f=Math.max(U,K,M);if(f>A){const v=A/f;U*=v,K*=v,M*=v}}else U=(0,h.Clamp)(U,0,A),K=(0,h.Clamp)(K,0,A),M=(0,h.Clamp)(M,0,A);const s=new e.Mv(U,K,M);v.addLight(O,s,F),Z+=F,X+=V}a+=C}}const u=6*(4*Math.PI)/6/Z;return v.scaleInPlace(u),v.convertIncidentRadianceToIrradiance(),v.convertIrradianceToLambertianRadiance(),J.g.FromHarmonics(v)}}H._FileFaces=[new C("right",new V.Xv(1,0,0),new V.Xv(0,0,-1),new V.Xv(0,-1,0)),new C("left",new V.Xv(-1,0,0),new V.Xv(0,0,1),new V.Xv(0,-1,0)),new C("up",new V.Xv(0,1,0),new V.Xv(1,0,0),new V.Xv(0,0,1)),new C("down",new V.Xv(0,-1,0),new V.Xv(1,0,0),new V.Xv(0,0,-1)),new C("front",new V.Xv(0,0,1),new V.Xv(1,0,0),new V.Xv(0,-1,0)),new C("back",new V.Xv(0,0,-1),new V.Xv(-1,0,0),new V.Xv(0,-1,0))],H.MAX_HDRI_VALUE=4096,H.PRESERVE_CLAMPED_COLORS=!1},11621:(f,v,Z)=>{Z.r(v),Z.d(v,{Dispose:()=>W,DumpData:()=>u,DumpDataAsync:()=>O,DumpFramebuffer:()=>H,DumpTools:()=>a});var V=Z(11525),h=Z(11230),J=Z(11440),l=Z(11281);let e,C=null;async function H(f,v,Z,V){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",J=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0;const e=await Z.readPixels(0,0,f,v);u(f,v,new Uint8Array(e.buffer),V,h,J,!0,void 0,l)}async function O(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",h=arguments.length>4?arguments[4]:void 0,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],e=arguments.length>7?arguments[7]:void 0;return await new Promise((C=>{u(f,v,Z,(f=>C(f)),V,h,J,l,e)}))}function u(f,v,H,O){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",a=arguments.length>5?arguments[5]:void 0,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]&&arguments[7],F=arguments.length>8?arguments[8]:void 0;(async function(){return C||(C=new Promise(((f,v)=>{let h,J=null;const C={o:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(Z.bind(Z,11551)).then((H=>{let{ThinEngine:O}=H;const u=l.c.Instances.length;try{h=new OffscreenCanvas(100,100),J=new O(h,!1,C)}catch(X){var a;u<l.c.Instances.length&&(null===(a=l.c.Instances.pop())||void 0===a||a.dispose()),h=document.createElement("canvas"),J=new O(h,!1,C)}l.c.Instances.pop(),l.c.OnEnginesDisposedObservable.add((f=>{J&&f!==J&&!J.C&&0===l.c.Instances.length&&W()})),J.getCaps().parallelShaderCompile=void 0;const b=new V.e(J);Z.e(52).then(Z.bind(Z,13866)).then((Z=>{let{passPixelShader:l}=Z;if(!J)return void v("Engine is not defined");const C=new V.h({bv:J,name:l.name,fragmentShader:l.shader,samplerNames:["textureSampler"]});e={canvas:h,bv:J,renderer:b,wrapper:C},f(e)}))})).catch(v)}))),await C})().then((Z=>{if(Z.bv.setSize(f,v,!0),H instanceof Float32Array){const f=new Uint8Array(H.length);let v=H.length;for(;v--;){const Z=H[v];f[v]=Math.round(255*(0,J.Clamp)(Z))}H=f}const V=Z.bv.createRawTexture(H,f,v,5,!1,!b,1);Z.renderer.setViewport(),Z.renderer.applyEffectWrapper(Z.wrapper),Z.wrapper.effect._bindTexture("textureSampler",V),Z.renderer.draw(),X?h.Tools.ToBlob(Z.canvas,(f=>{const v=new FileReader;v.onload=f=>{const v=f.target.result;O&&O(v)},v.readAsArrayBuffer(f)}),u,F):h.Tools.EncodeScreenshotCanvasData(Z.canvas,O,u,a,F),V.dispose()}))}function W(){var f;e?(e.wrapper.dispose(),e.renderer.dispose(),e.bv.dispose()):null===(f=C)||void 0===f||f.then((f=>{f.wrapper.dispose(),f.renderer.dispose(),f.bv.dispose()}));C=null,e=null}const a={DumpData:u,DumpDataAsync:O,DumpFramebuffer:H,Dispose:W};h.Tools.DumpData=u,h.Tools.DumpDataAsync=O,h.Tools.DumpFramebuffer=H},11903:(f,v,Z)=>{Z.d(v,{b:()=>J});var V=Z(11516),h=Z(11628);class J{static ExpandRGBDTexture(f){const v=f._texture;if(!v||!f.isRGBD)return;const h=v.getEngine(),J=h.getCaps(),l=v.isReady;let e=!1;J.textureHalfFloatRender&&J.textureHalfFloatLinearFiltering?(e=!0,v.type=2):J.textureFloatRender&&J.textureFloatLinearFiltering&&(e=!0,v.type=1),e&&(v.isReady=!1,v._isRGBD=!1,v.invertY=!1);const C=async()=>{const J=h.isWebGPU,l=J?1:0;v.isReady=!1,J?await Z.e(42).then(Z.bind(Z,14383)):await Z.e(35).then(Z.bind(Z,14389));const e=new V.d("rgbdDecode","rgbdDecode",null,null,1,null,3,h,!1,void 0,v.type,void 0,null,!1,void 0,l);e.externalTextureSamplerBinding=!0;const C=h.createRenderTargetTexture(v.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:v.samplingMode,type:v.type,format:5});e.onEffectCreatedObservable.addOnce((Z=>{Z.executeWhenCompiled((()=>{e.onApply=f=>{f._bindTexture("textureSampler",v),f.setFloat2("scale",1,1)},f.Yf().postProcessManager.directRender([e],C,!0),h.restoreDefaultFramebuffer(),h._releaseTexture(v),e&&e.dispose(),C._swapAndDie(v),v.isReady=!0}))}))};e&&(l?C():f.onLoadObservable.addOnce(C))}static async EncodeTextureToRGBD(f,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return v.getEngine().isWebGPU?await Z.e(43).then(Z.bind(Z,14397)):await Z.e(36).then(Z.bind(Z,14393)),await(0,h.e)("rgbdEncode",f,v,V,1,5)}}}}]);