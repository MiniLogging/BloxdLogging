"use strict";(self.v2pspxy442l=self.v2pspxy442l||[]).push([[20,21],{12942:(l,a,N)=>{var U=N(12946),c=N(12467);c.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(c.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=U.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((l=>{this._texture._sphericalPolynomial=l,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(l){this._texture&&(this._texture._sphericalPolynomial=l)},enumerable:!0,configurable:!0})},12946:(l,a,N)=>{N.d(a,{b:()=>T});var U=N(12447),c=N(12461),K=N(12623),Z=N(12452),w=N(12479);class S{constructor(l,a,N,U){this.name=l,this.worldAxisForNormal=a,this.worldAxisForFileX=N,this.worldAxisForFileY=U}}class T{static ConvertCubeMapTextureToSphericalPolynomial(l){var a;if(!l.isCube)return null;null===(a=l.bl())||void 0===a||a.getEngine().flushFramebuffer();const N=l.getSize().width,U=l.readPixels(0,void 0,void 0,!1),c=l.readPixels(1,void 0,void 0,!1);let K,Z;l.isRenderTarget?(K=l.readPixels(3,void 0,void 0,!1),Z=l.readPixels(2,void 0,void 0,!1)):(K=l.readPixels(2,void 0,void 0,!1),Z=l.readPixels(3,void 0,void 0,!1));const w=l.readPixels(4,void 0,void 0,!1),S=l.readPixels(5,void 0,void 0,!1),T=l.gammaSpace;let J=0;return 1!=l.textureType&&2!=l.textureType||(J=1),new Promise((l=>{Promise.all([c,U,K,Z,w,S]).then((a=>{let[U,c,K,Z,w,S]=a;const n={size:N,right:c,left:U,up:K,down:Z,front:w,back:S,format:5,type:J,gammaSpace:T};l(this.ConvertCubeMapToSphericalPolynomial(n))}))}))}static _AreaElement(l,a){return Math.atan2(l*a,Math.sqrt(l*l+a*a+1))}static ConvertCubeMapToSphericalPolynomial(l){const a=new K.c;let N=0;const U=2/l.size,S=U,T=.5*U,J=T-1;for(let K=0;K<6;K++){const n=this._FileFaces[K],y=l[n.name];let H=J;const u=5===l.format?4:3;for(let K=0;K<l.size;K++){let W=J;for(let S=0;S<l.size;S++){const J=n.worldAxisForFileX.scale(W).add(n.worldAxisForFileY.scale(H)).add(n.worldAxisForNormal);J.normalize();const B=this._AreaElement(W-T,H-T)-this._AreaElement(W-T,H+T)-this._AreaElement(W+T,H-T)+this._AreaElement(W+T,H+T);let Y=y[K*l.size*u+S*u+0],C=y[K*l.size*u+S*u+1],M=y[K*l.size*u+S*u+2];isNaN(Y)&&(Y=0),isNaN(C)&&(C=0),isNaN(M)&&(M=0),0===l.type&&(Y/=255,C/=255,M/=255),l.gammaSpace&&(Y=Math.pow((0,c.Clamp)(Y),Z.k),C=Math.pow((0,c.Clamp)(C),Z.k),M=Math.pow((0,c.Clamp)(M),Z.k));const A=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const l=Math.max(Y,C,M);if(l>A){const a=A/l;Y*=a,C*=a,M*=a}}else Y=(0,c.Clamp)(Y,0,A),C=(0,c.Clamp)(C,0,A),M=(0,c.Clamp)(M,0,A);const E=new w.Ca(Y,C,M);a.addLight(J,E,B),N+=B,W+=U}H+=S}}const n=6*(4*Math.PI)/6/N;return a.scaleInPlace(n),a.convertIncidentRadianceToIrradiance(),a.convertIrradianceToLambertianRadiance(),K.g.FromHarmonics(a)}}T._FileFaces=[new S("right",new U.ua(1,0,0),new U.ua(0,0,-1),new U.ua(0,-1,0)),new S("left",new U.ua(-1,0,0),new U.ua(0,0,1),new U.ua(0,-1,0)),new S("up",new U.ua(0,1,0),new U.ua(1,0,0),new U.ua(0,0,1)),new S("down",new U.ua(0,-1,0),new U.ua(1,0,0),new U.ua(0,0,-1)),new S("front",new U.ua(0,0,1),new U.ua(1,0,0),new U.ua(0,-1,0)),new S("back",new U.ua(0,0,-1),new U.ua(-1,0,0),new U.ua(0,-1,0))],T.MAX_HDRI_VALUE=4096,T.PRESERVE_CLAMPED_COLORS=!1},12664:(l,a,N)=>{N.r(a),N.d(a,{Dispose:()=>y,DumpData:()=>n,DumpDataAsync:()=>J,DumpFramebuffer:()=>T,DumpTools:()=>H});var U=N(12538),c=N(12254),K=N(12461),Z=N(12296);let w,S=null;async function T(l,a,N,U){let c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",K=arguments.length>5?arguments[5]:void 0,Z=arguments.length>6?arguments[6]:void 0;const w=await N.readPixels(0,0,l,a);n(l,a,new Uint8Array(w.buffer),U,c,K,!0,void 0,Z)}async function J(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",c=arguments.length>4?arguments[4]:void 0,K=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7?arguments[7]:void 0;return await new Promise((S=>{n(l,a,N,(l=>S(l)),U,c,K,Z,w)}))}function n(l,a,T,J){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",H=arguments.length>5?arguments[5]:void 0,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7&&void 0!==arguments[7]&&arguments[7],B=arguments.length>8?arguments[8]:void 0;(async function(){return S||(S=new Promise(((l,a)=>{let c,K=null;const S={o:!0,depth:!1,Jc:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(N.bind(N,12566)).then((T=>{let{ThinEngine:J}=T;const n=Z.e.Instances.length;try{c=new OffscreenCanvas(100,100),K=new J(c,!1,S)}catch(W){var H;n<Z.e.Instances.length&&(null===(H=Z.e.Instances.pop())||void 0===H||H.dispose()),c=document.createElement("canvas"),K=new J(c,!1,S)}Z.e.Instances.pop(),Z.e.OnEnginesDisposedObservable.add((l=>{K&&l!==K&&!K.T&&0===Z.e.Instances.length&&y()})),K.getCaps().parallelShaderCompile=void 0;const u=new U.e(K);N.e(52).then(N.bind(N,14917)).then((N=>{let{passPixelShader:Z}=N;if(!K)return void a("Engine is not defined");const S=new U.i({Ha:K,name:Z.name,fragmentShader:Z.shader,samplerNames:["textureSampler"]});w={canvas:c,Ha:K,renderer:u,wrapper:S},l(w)}))})).catch(a)}))),await S})().then((N=>{if(N.Ha.setSize(l,a,!0),T instanceof Float32Array){const l=new Uint8Array(T.length);let a=T.length;for(;a--;){const N=T[a];l[a]=Math.round(255*(0,K.Clamp)(N))}T=l}const U=N.Ha.createRawTexture(T,l,a,5,!1,!u,1);N.renderer.setViewport(),N.renderer.applyEffectWrapper(N.wrapper),N.wrapper.effect._bindTexture("textureSampler",U),N.renderer.draw(),W?c.Tools.ToBlob(N.canvas,(l=>{const a=new FileReader;a.onload=l=>{const a=l.target.result;J&&J(a)},a.readAsArrayBuffer(l)}),n,B):c.Tools.EncodeScreenshotCanvasData(N.canvas,J,n,H,B),U.dispose()}))}function y(){var l;w?(w.wrapper.dispose(),w.renderer.dispose(),w.Ha.dispose()):null===(l=S)||void 0===l||l.then((l=>{l.wrapper.dispose(),l.renderer.dispose(),l.Ha.dispose()}));S=null,w=null}const H={DumpData:n,DumpDataAsync:J,DumpFramebuffer:T,Dispose:y};c.Tools.DumpData=n,c.Tools.DumpDataAsync=J,c.Tools.DumpFramebuffer=T},12930:(l,a,N)=>{N.d(a,{c:()=>K});var U=N(12536),c=N(12668);class K{static ExpandRGBDTexture(l){const a=l._texture;if(!a||!l.isRGBD)return;const c=a.getEngine(),K=c.getCaps(),Z=a.isReady;let w=!1;K.textureHalfFloatRender&&K.textureHalfFloatLinearFiltering?(w=!0,a.type=2):K.textureFloatRender&&K.textureFloatLinearFiltering&&(w=!0,a.type=1),w&&(a.isReady=!1,a._isRGBD=!1,a.invertY=!1);const S=async()=>{const K=c.isWebGPU,Z=K?1:0;a.isReady=!1,K?await N.e(42).then(N.bind(N,15463)):await N.e(35).then(N.bind(N,15469));const w=new U.c("rgbdDecode","rgbdDecode",null,null,1,null,3,c,!1,void 0,a.type,void 0,null,!1,void 0,Z);w.externalTextureSamplerBinding=!0;const S=c.createRenderTargetTexture(a.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:a.samplingMode,type:a.type,format:5});w.onEffectCreatedObservable.addOnce((N=>{N.executeWhenCompiled((()=>{w.onApply=l=>{l._bindTexture("textureSampler",a),l.setFloat2("scale",1,1)},l.bl().postProcessManager.directRender([w],S,!0),c.restoreDefaultFramebuffer(),c._releaseTexture(a),w&&w.dispose(),S._swapAndDie(a),a.isReady=!0}))}))};w&&(Z?S():l.onLoadObservable.addOnce(S))}static async EncodeTextureToRGBD(l,a){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return a.getEngine().isWebGPU?await N.e(43).then(N.bind(N,15474)):await N.e(36).then(N.bind(N,15472)),await(0,c.d)("rgbdEncode",l,a,U,1,5)}}}}]);