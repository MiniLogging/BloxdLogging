"use strict";(self.irtrrknfyfo=self.irtrrknfyfo||[]).push([[20,21],{11898:(B,E,v)=>{var z=v(11901),o=v(11401);o.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(o.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=z.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((B=>{this._texture._sphericalPolynomial=B,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(B){this._texture&&(this._texture._sphericalPolynomial=B)},enumerable:!0,configurable:!0})},11901:(B,E,v)=>{v.d(E,{d:()=>D});var z=v(11380),o=v(11394),q=v(11552),c=v(11382),S=v(11417);class x{constructor(B,E,v,z){this.name=B,this.worldAxisForNormal=E,this.worldAxisForFileX=v,this.worldAxisForFileY=z}}class D{static ConvertCubeMapTextureToSphericalPolynomial(B){var E;if(!B.isCube)return null;null===(E=B.rB())||void 0===E||E.getEngine().flushFramebuffer();const v=B.getSize().width,z=B.readPixels(0,void 0,void 0,!1),o=B.readPixels(1,void 0,void 0,!1);let q,c;B.isRenderTarget?(q=B.readPixels(3,void 0,void 0,!1),c=B.readPixels(2,void 0,void 0,!1)):(q=B.readPixels(2,void 0,void 0,!1),c=B.readPixels(3,void 0,void 0,!1));const S=B.readPixels(4,void 0,void 0,!1),x=B.readPixels(5,void 0,void 0,!1),D=B.gammaSpace;let h=0;return 1!=B.textureType&&2!=B.textureType||(h=1),new Promise((B=>{Promise.all([o,z,q,c,S,x]).then((E=>{let[z,o,q,c,S,x]=E;const y={size:v,right:o,left:z,up:q,down:c,front:S,back:x,format:5,type:h,gammaSpace:D};B(this.ConvertCubeMapToSphericalPolynomial(y))}))}))}static _AreaElement(B,E){return Math.atan2(B*E,Math.sqrt(B*B+E*E+1))}static ConvertCubeMapToSphericalPolynomial(B){const E=new q.d;let v=0;const z=2/B.size,x=z,D=.5*z,h=D-1;for(let q=0;q<6;q++){const y=this._FileFaces[q],Q=B[y.name];let P=h;const G=5===B.format?4:3;for(let q=0;q<B.size;q++){let Y=h;for(let x=0;x<B.size;x++){const h=y.worldAxisForFileX.scale(Y).add(y.worldAxisForFileY.scale(P)).add(y.worldAxisForNormal);h.normalize();const a=this._AreaElement(Y-D,P-D)-this._AreaElement(Y-D,P+D)-this._AreaElement(Y+D,P-D)+this._AreaElement(Y+D,P+D);let m=Q[q*B.size*G+x*G+0],g=Q[q*B.size*G+x*G+1],V=Q[q*B.size*G+x*G+2];isNaN(m)&&(m=0),isNaN(g)&&(g=0),isNaN(V)&&(V=0),0===B.type&&(m/=255,g/=255,V/=255),B.gammaSpace&&(m=Math.pow((0,o.Clamp)(m),c.j),g=Math.pow((0,o.Clamp)(g),c.j),V=Math.pow((0,o.Clamp)(V),c.j));const T=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const B=Math.max(m,g,V);if(B>T){const E=T/B;m*=E,g*=E,V*=E}}else m=(0,o.Clamp)(m,0,T),g=(0,o.Clamp)(g,0,T),V=(0,o.Clamp)(V,0,T);const N=new S.gE(m,g,V);E.addLight(h,N,a),v+=a,Y+=z}P+=x}}const y=6*(4*Math.PI)/6/v;return E.scaleInPlace(y),E.convertIncidentRadianceToIrradiance(),E.convertIrradianceToLambertianRadiance(),q.g.FromHarmonics(E)}}D._FileFaces=[new x("right",new z.GE(1,0,0),new z.GE(0,0,-1),new z.GE(0,-1,0)),new x("left",new z.GE(-1,0,0),new z.GE(0,0,1),new z.GE(0,-1,0)),new x("up",new z.GE(0,1,0),new z.GE(1,0,0),new z.GE(0,0,1)),new x("down",new z.GE(0,-1,0),new z.GE(1,0,0),new z.GE(0,0,-1)),new x("front",new z.GE(0,0,1),new z.GE(1,0,0),new z.GE(0,-1,0)),new x("back",new z.GE(0,0,-1),new z.GE(-1,0,0),new z.GE(0,-1,0))],D.MAX_HDRI_VALUE=4096,D.PRESERVE_CLAMPED_COLORS=!1},11589:(B,E,v)=>{v.r(E),v.d(E,{Dispose:()=>Q,DumpData:()=>y,DumpDataAsync:()=>h,DumpFramebuffer:()=>D,DumpTools:()=>P});var z=v(11471),o=v(11193),q=v(11394),c=v(11242);let S,x=null;async function D(B,E,v,z){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",q=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0;const S=await v.readPixels(0,0,B,E);y(B,E,new Uint8Array(S.buffer),z,o,q,!0,void 0,c)}async function h(B,E,v){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",o=arguments.length>4?arguments[4]:void 0,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7?arguments[7]:void 0;return await new Promise((x=>{y(B,E,v,(B=>x(B)),z,o,q,c,S)}))}function y(B,E,D,h){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",P=arguments.length>5?arguments[5]:void 0,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7&&void 0!==arguments[7]&&arguments[7],a=arguments.length>8?arguments[8]:void 0;(async function(){return x||(x=new Promise(((B,E)=>{let o,q=null;const x={zc:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(v.bind(v,11494)).then((D=>{let{ThinEngine:h}=D;const y=c.b.Instances.length;try{o=new OffscreenCanvas(100,100),q=new h(o,!1,x)}catch(Y){var P;y<c.b.Instances.length&&(null===(P=c.b.Instances.pop())||void 0===P||P.dispose()),o=document.createElement("canvas"),q=new h(o,!1,x)}c.b.Instances.pop(),c.b.OnEnginesDisposedObservable.add((B=>{q&&B!==q&&!q.P&&0===c.b.Instances.length&&Q()})),q.getCaps().parallelShaderCompile=void 0;const G=new z.e(q);v.e(52).then(v.bind(v,13842)).then((v=>{let{passPixelShader:c}=v;if(!q)return void E("Engine is not defined");const x=new z.f({PE:q,name:c.name,fragmentShader:c.shader,samplerNames:["textureSampler"]});S={canvas:o,PE:q,renderer:G,wrapper:x},B(S)}))})).catch(E)}))),await x})().then((v=>{if(v.PE.setSize(B,E,!0),D instanceof Float32Array){const B=new Uint8Array(D.length);let E=D.length;for(;E--;){const v=D[E];B[E]=Math.round(255*(0,q.Clamp)(v))}D=B}const z=v.PE.createRawTexture(D,B,E,5,!1,!G,1);v.renderer.setViewport(),v.renderer.applyEffectWrapper(v.wrapper),v.wrapper.effect._bindTexture("textureSampler",z),v.renderer.draw(),Y?o.Tools.ToBlob(v.canvas,(B=>{const E=new FileReader;E.onload=B=>{const E=B.target.result;h&&h(E)},E.readAsArrayBuffer(B)}),y,a):o.Tools.EncodeScreenshotCanvasData(v.canvas,h,y,P,a),z.dispose()}))}function Q(){var B;S?(S.wrapper.dispose(),S.renderer.dispose(),S.PE.dispose()):null===(B=x)||void 0===B||B.then((B=>{B.wrapper.dispose(),B.renderer.dispose(),B.PE.dispose()}));x=null,S=null}const P={DumpData:y,DumpDataAsync:h,DumpFramebuffer:D,Dispose:Q};o.Tools.DumpData=y,o.Tools.DumpDataAsync=h,o.Tools.DumpFramebuffer=D},11888:(B,E,v)=>{v.d(E,{c:()=>q});var z=v(11463),o=v(11594);class q{static ExpandRGBDTexture(B){const E=B._texture;if(!E||!B.isRGBD)return;const o=E.getEngine(),q=o.getCaps(),c=E.isReady;let S=!1;q.textureHalfFloatRender&&q.textureHalfFloatLinearFiltering?(S=!0,E.type=2):q.textureFloatRender&&q.textureFloatLinearFiltering&&(S=!0,E.type=1),S&&(E.isReady=!1,E._isRGBD=!1,E.invertY=!1);const x=async()=>{const q=o.isWebGPU,c=q?1:0;E.isReady=!1,q?await v.e(42).then(v.bind(v,14375)):await v.e(35).then(v.bind(v,14379));const S=new z.c("rgbdDecode","rgbdDecode",null,null,1,null,3,o,!1,void 0,E.type,void 0,null,!1,void 0,c);S.externalTextureSamplerBinding=!0;const x=o.createRenderTargetTexture(E.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:E.samplingMode,type:E.type,format:5});S.onEffectCreatedObservable.addOnce((v=>{v.executeWhenCompiled((()=>{S.onApply=B=>{B._bindTexture("textureSampler",E),B.setFloat2("scale",1,1)},B.rB().postProcessManager.directRender([S],x,!0),o.restoreDefaultFramebuffer(),o._releaseTexture(E),S&&S.dispose(),x._swapAndDie(E),E.isReady=!0}))}))};S&&(c?x():B.onLoadObservable.addOnce(x))}static async EncodeTextureToRGBD(B,E){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return E.getEngine().isWebGPU?await v.e(43).then(v.bind(v,14393)):await v.e(36).then(v.bind(v,14386)),await(0,o.d)("rgbdEncode",B,E,z,1,5)}}}}]);