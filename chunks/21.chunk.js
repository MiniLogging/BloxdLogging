"use strict";(self["80dd64vgxnn"]=self["80dd64vgxnn"]||[]).push([[20,21],{13220:(mm,o,u)=>{var f=u(13225),B=u(12760);B.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(B.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=f.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((mm=>{this._texture._sphericalPolynomial=mm,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(mm){this._texture&&(this._texture._sphericalPolynomial=mm)},enumerable:!0,configurable:!0})},13225:(mm,o,u)=>{u.d(o,{b:()=>K});var f=u(12740),B=u(12752),O=u(12912),r=u(12746),w=u(12780);class p{constructor(mm,o,u,f){this.name=mm,this.worldAxisForNormal=o,this.worldAxisForFileX=u,this.worldAxisForFileY=f}}class K{static ConvertCubeMapTextureToSphericalPolynomial(mm){var o;if(!mm.isCube)return null;null===(o=mm.Pm())||void 0===o||o.getEngine().flushFramebuffer();const u=mm.getSize().width,f=mm.readPixels(0,void 0,void 0,!1),B=mm.readPixels(1,void 0,void 0,!1);let O,r;mm.isRenderTarget?(O=mm.readPixels(3,void 0,void 0,!1),r=mm.readPixels(2,void 0,void 0,!1)):(O=mm.readPixels(2,void 0,void 0,!1),r=mm.readPixels(3,void 0,void 0,!1));const w=mm.readPixels(4,void 0,void 0,!1),p=mm.readPixels(5,void 0,void 0,!1),K=mm.gammaSpace;let z=0;return 1!=mm.textureType&&2!=mm.textureType||(z=1),new Promise((mm=>{Promise.all([B,f,O,r,w,p]).then((o=>{let[f,B,O,r,w,p]=o;const Y={size:u,right:B,left:f,up:O,down:r,front:w,back:p,format:5,type:z,gammaSpace:K};mm(this.ConvertCubeMapToSphericalPolynomial(Y))}))}))}static _AreaElement(mm,o){return Math.atan2(mm*o,Math.sqrt(mm*mm+o*o+1))}static ConvertCubeMapToSphericalPolynomial(mm){const o=new O.b;let u=0;const f=2/mm.size,p=f,K=.5*f,z=K-1;for(let O=0;O<6;O++){const Y=this._FileFaces[O],q=mm[Y.name];let x=z;const H=5===mm.format?4:3;for(let O=0;O<mm.size;O++){let E=z;for(let p=0;p<mm.size;p++){const z=Y.worldAxisForFileX.scale(E).add(Y.worldAxisForFileY.scale(x)).add(Y.worldAxisForNormal);z.normalize();const M=this._AreaElement(E-K,x-K)-this._AreaElement(E-K,x+K)-this._AreaElement(E+K,x-K)+this._AreaElement(E+K,x+K);let l=q[O*mm.size*H+p*H+0],t=q[O*mm.size*H+p*H+1],Q=q[O*mm.size*H+p*H+2];isNaN(l)&&(l=0),isNaN(t)&&(t=0),isNaN(Q)&&(Q=0),0===mm.type&&(l/=255,t/=255,Q/=255),mm.gammaSpace&&(l=Math.pow((0,B.Clamp)(l),r.l),t=Math.pow((0,B.Clamp)(t),r.l),Q=Math.pow((0,B.Clamp)(Q),r.l));const b=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const mm=Math.max(l,t,Q);if(mm>b){const o=b/mm;l*=o,t*=o,Q*=o}}else l=(0,B.Clamp)(l,0,b),t=(0,B.Clamp)(t,0,b),Q=(0,B.Clamp)(Q,0,b);const J=new w.No(l,t,Q);o.addLight(z,J,M),u+=M,E+=f}x+=p}}const Y=6*(4*Math.PI)/6/u;return o.scaleInPlace(Y),o.convertIncidentRadianceToIrradiance(),o.convertIrradianceToLambertianRadiance(),O.c.FromHarmonics(o)}}K._FileFaces=[new p("right",new f.lo(1,0,0),new f.lo(0,0,-1),new f.lo(0,-1,0)),new p("left",new f.lo(-1,0,0),new f.lo(0,0,1),new f.lo(0,-1,0)),new p("up",new f.lo(0,1,0),new f.lo(1,0,0),new f.lo(0,0,1)),new p("down",new f.lo(0,-1,0),new f.lo(1,0,0),new f.lo(0,0,-1)),new p("front",new f.lo(0,0,1),new f.lo(1,0,0),new f.lo(0,-1,0)),new p("back",new f.lo(0,0,-1),new f.lo(-1,0,0),new f.lo(0,-1,0))],K.MAX_HDRI_VALUE=4096,K.PRESERVE_CLAMPED_COLORS=!1},12946:(mm,o,u)=>{u.r(o),u.d(o,{Dispose:()=>q,DumpData:()=>Y,DumpDataAsync:()=>z,DumpFramebuffer:()=>K,DumpTools:()=>x});var f=u(12845),B=u(12549),O=u(12752),r=u(12596);let w,p=null;async function K(mm,o,u,f){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",O=arguments.length>5?arguments[5]:void 0,r=arguments.length>6?arguments[6]:void 0;const w=await u.readPixels(0,0,mm,o);Y(mm,o,new Uint8Array(w.buffer),f,B,O,!0,void 0,r)}async function z(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",B=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7?arguments[7]:void 0;return await new Promise((p=>{Y(mm,o,u,(mm=>p(mm)),f,B,O,r,w)}))}function Y(mm,o,K,z){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",x=arguments.length>5?arguments[5]:void 0,H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]&&arguments[7],M=arguments.length>8?arguments[8]:void 0;(async function(){return p||(p=new Promise(((mm,o)=>{let B,O=null;const p={Xf:!0,depth:!1,Nf:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(u.bind(u,12865)).then((K=>{let{ThinEngine:z}=K;const Y=r.d.Instances.length;try{B=new OffscreenCanvas(100,100),O=new z(B,!1,p)}catch(E){var x;Y<r.d.Instances.length&&(null===(x=r.d.Instances.pop())||void 0===x||x.dispose()),B=document.createElement("canvas"),O=new z(B,!1,p)}r.d.Instances.pop(),r.d.OnEnginesDisposedObservable.add((mm=>{O&&mm!==O&&!O.q&&0===r.d.Instances.length&&q()})),O.getCaps().parallelShaderCompile=void 0;const H=new f.e(O);u.e(52).then(u.bind(u,15103)).then((u=>{let{passPixelShader:r}=u;if(!O)return void o("Engine is not defined");const p=new f.i({Mo:O,name:r.name,fragmentShader:r.shader,samplerNames:["textureSampler"]});w={canvas:B,Mo:O,renderer:H,wrapper:p},mm(w)}))})).catch(o)}))),await p})().then((u=>{if(u.Mo.setSize(mm,o,!0),K instanceof Float32Array){const mm=new Uint8Array(K.length);let o=K.length;for(;o--;){const u=K[o];mm[o]=Math.round(255*(0,O.Clamp)(u))}K=mm}const f=u.Mo.createRawTexture(K,mm,o,5,!1,!H,1);u.renderer.setViewport(),u.renderer.applyEffectWrapper(u.wrapper),u.wrapper.effect._bindTexture("textureSampler",f),u.renderer.draw(),E?B.Tools.ToBlob(u.canvas,(mm=>{const o=new FileReader;o.onload=mm=>{const o=mm.target.result;z&&z(o)},o.readAsArrayBuffer(mm)}),Y,M):B.Tools.EncodeScreenshotCanvasData(u.canvas,z,Y,x,M),f.dispose()}))}function q(){var mm;w?(w.wrapper.dispose(),w.renderer.dispose(),w.Mo.dispose()):null===(mm=p)||void 0===mm||mm.then((mm=>{mm.wrapper.dispose(),mm.renderer.dispose(),mm.Mo.dispose()}));p=null,w=null}const x={DumpData:Y,DumpDataAsync:z,DumpFramebuffer:K,Dispose:q};B.Tools.DumpData=Y,B.Tools.DumpDataAsync=z,B.Tools.DumpFramebuffer=K},13205:(mm,o,u)=>{u.d(o,{e:()=>O});var f=u(12839),B=u(12952);class O{static ExpandRGBDTexture(mm){const o=mm._texture;if(!o||!mm.isRGBD)return;const B=o.getEngine(),O=B.getCaps(),r=o.isReady;let w=!1;O.textureHalfFloatRender&&O.textureHalfFloatLinearFiltering?(w=!0,o.type=2):O.textureFloatRender&&O.textureFloatLinearFiltering&&(w=!0,o.type=1),w&&(o.isReady=!1,o._isRGBD=!1,o.invertY=!1);const p=async()=>{const O=B.isWebGPU,r=O?1:0;o.isReady=!1,O?await u.e(42).then(u.bind(u,15641)):await u.e(35).then(u.bind(u,15646));const w=new f.d("rgbdDecode","rgbdDecode",null,null,1,null,3,B,!1,void 0,o.type,void 0,null,!1,void 0,r);w.externalTextureSamplerBinding=!0;const p=B.createRenderTargetTexture(o.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:o.samplingMode,type:o.type,format:5});w.onEffectCreatedObservable.addOnce((u=>{u.executeWhenCompiled((()=>{w.onApply=mm=>{mm._bindTexture("textureSampler",o),mm.setFloat2("scale",1,1)},mm.Pm().postProcessManager.directRender([w],p,!0),B.restoreDefaultFramebuffer(),B._releaseTexture(o),w&&w.dispose(),p._swapAndDie(o),o.isReady=!0}))}))};w&&(r?p():mm.onLoadObservable.addOnce(p))}static async EncodeTextureToRGBD(mm,o){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return o.getEngine().isWebGPU?await u.e(43).then(u.bind(u,15655)):await u.e(36).then(u.bind(u,15653)),await(0,B.c)("rgbdEncode",mm,o,f,1,5)}}}}]);