"use strict";(self["1kjc9ee3uyt"]=self["1kjc9ee3uyt"]||[]).push([[20,21],{12172:(w,E,G)=>{var P=G(12177),h=G(11695);h.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(h.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=P.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((w=>{this._texture._sphericalPolynomial=w,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(w){this._texture&&(this._texture._sphericalPolynomial=w)},enumerable:!0,configurable:!0})},12177:(w,E,G)=>{G.d(E,{e:()=>l});var P=G(11679),h=G(11689),B=G(11863),y=G(11681),x=G(11716);class U{constructor(w,E,G,P){this.name=w,this.worldAxisForNormal=E,this.worldAxisForFileX=G,this.worldAxisForFileY=P}}class l{static ConvertCubeMapTextureToSphericalPolynomial(w){var E;if(!w.isCube)return null;null===(E=w.Ww())||void 0===E||E.getEngine().flushFramebuffer();const G=w.getSize().width,P=w.readPixels(0,void 0,void 0,!1),h=w.readPixels(1,void 0,void 0,!1);let B,y;w.isRenderTarget?(B=w.readPixels(3,void 0,void 0,!1),y=w.readPixels(2,void 0,void 0,!1)):(B=w.readPixels(2,void 0,void 0,!1),y=w.readPixels(3,void 0,void 0,!1));const x=w.readPixels(4,void 0,void 0,!1),U=w.readPixels(5,void 0,void 0,!1),l=w.gammaSpace;let i=0;return 1!=w.textureType&&2!=w.textureType||(i=1),new Promise((w=>{Promise.all([h,P,B,y,x,U]).then((E=>{let[P,h,B,y,x,U]=E;const O={size:G,right:h,left:P,up:B,down:y,front:x,back:U,format:5,type:i,gammaSpace:l};w(this.ConvertCubeMapToSphericalPolynomial(O))}))}))}static _AreaElement(w,E){return Math.atan2(w*E,Math.sqrt(w*w+E*E+1))}static ConvertCubeMapToSphericalPolynomial(w){const E=new B.c;let G=0;const P=2/w.size,U=P,l=.5*P,i=l-1;for(let B=0;B<6;B++){const O=this._FileFaces[B],u=w[O.name];let V=i;const a=5===w.format?4:3;for(let B=0;B<w.size;B++){let Q=i;for(let U=0;U<w.size;U++){const i=O.worldAxisForFileX.scale(Q).add(O.worldAxisForFileY.scale(V)).add(O.worldAxisForNormal);i.normalize();const c=this._AreaElement(Q-l,V-l)-this._AreaElement(Q-l,V+l)-this._AreaElement(Q+l,V-l)+this._AreaElement(Q+l,V+l);let Z=u[B*w.size*a+U*a+0],J=u[B*w.size*a+U*a+1],d=u[B*w.size*a+U*a+2];isNaN(Z)&&(Z=0),isNaN(J)&&(J=0),isNaN(d)&&(d=0),0===w.type&&(Z/=255,J/=255,d/=255),w.gammaSpace&&(Z=Math.pow((0,h.Clamp)(Z),y.l),J=Math.pow((0,h.Clamp)(J),y.l),d=Math.pow((0,h.Clamp)(d),y.l));const K=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const w=Math.max(Z,J,d);if(w>K){const E=K/w;Z*=E,J*=E,d*=E}}else Z=(0,h.Clamp)(Z,0,K),J=(0,h.Clamp)(J,0,K),d=(0,h.Clamp)(d,0,K);const t=new x.dE(Z,J,d);E.addLight(i,t,c),G+=c,Q+=P}V+=U}}const O=6*(4*Math.PI)/6/G;return E.scaleInPlace(O),E.convertIncidentRadianceToIrradiance(),E.convertIrradianceToLambertianRadiance(),B.d.FromHarmonics(E)}}l._FileFaces=[new U("right",new P.QE(1,0,0),new P.QE(0,0,-1),new P.QE(0,-1,0)),new U("left",new P.QE(-1,0,0),new P.QE(0,0,1),new P.QE(0,-1,0)),new U("up",new P.QE(0,1,0),new P.QE(1,0,0),new P.QE(0,0,1)),new U("down",new P.QE(0,-1,0),new P.QE(1,0,0),new P.QE(0,0,-1)),new U("front",new P.QE(0,0,1),new P.QE(1,0,0),new P.QE(0,-1,0)),new U("back",new P.QE(0,0,-1),new P.QE(-1,0,0),new P.QE(0,-1,0))],l.MAX_HDRI_VALUE=4096,l.PRESERVE_CLAMPED_COLORS=!1},11886:(w,E,G)=>{G.r(E),G.d(E,{Dispose:()=>u,DumpData:()=>O,DumpDataAsync:()=>i,DumpFramebuffer:()=>l,DumpTools:()=>V});var P=G(11776),h=G(11498),B=G(11689),y=G(11543);let x,U=null;async function l(w,E,G,P){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",B=arguments.length>5?arguments[5]:void 0,y=arguments.length>6?arguments[6]:void 0;const x=await G.readPixels(0,0,w,E);O(w,E,new Uint8Array(x.buffer),P,h,B,!0,void 0,y)}async function i(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",h=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7?arguments[7]:void 0;return await new Promise((U=>{O(w,E,G,(w=>U(w)),P,h,B,y,x)}))}function O(w,E,l,i){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",V=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8?arguments[8]:void 0;(async function(){return U||(U=new Promise(((w,E)=>{let h,B=null;const U={o:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(G.bind(G,11806)).then((l=>{let{ThinEngine:i}=l;const O=y.e.Instances.length;try{h=new OffscreenCanvas(100,100),B=new i(h,!1,U)}catch(Q){var V;O<y.e.Instances.length&&(null===(V=y.e.Instances.pop())||void 0===V||V.dispose()),h=document.createElement("canvas"),B=new i(h,!1,U)}y.e.Instances.pop(),y.e.OnEnginesDisposedObservable.add((w=>{B&&w!==B&&!B.O&&0===y.e.Instances.length&&u()})),B.getCaps().parallelShaderCompile=void 0;const a=new P.d(B);G.e(52).then(G.bind(G,14044)).then((G=>{let{passPixelShader:y}=G;if(!B)return void E("Engine is not defined");const U=new P.f({aE:B,name:y.name,fragmentShader:y.shader,samplerNames:["textureSampler"]});x={canvas:h,aE:B,renderer:a,wrapper:U},w(x)}))})).catch(E)}))),await U})().then((G=>{if(G.aE.setSize(w,E,!0),l instanceof Float32Array){const w=new Uint8Array(l.length);let E=l.length;for(;E--;){const G=l[E];w[E]=Math.round(255*(0,B.Clamp)(G))}l=w}const P=G.aE.createRawTexture(l,w,E,5,!1,!a,1);G.renderer.setViewport(),G.renderer.applyEffectWrapper(G.wrapper),G.wrapper.effect._bindTexture("textureSampler",P),G.renderer.draw(),Q?h.Tools.ToBlob(G.canvas,(w=>{const E=new FileReader;E.onload=w=>{const E=w.target.result;i&&i(E)},E.readAsArrayBuffer(w)}),O,c):h.Tools.EncodeScreenshotCanvasData(G.canvas,i,O,V,c),P.dispose()}))}function u(){var w;x?(x.wrapper.dispose(),x.renderer.dispose(),x.aE.dispose()):null===(w=U)||void 0===w||w.then((w=>{w.wrapper.dispose(),w.renderer.dispose(),w.aE.dispose()}));U=null,x=null}const V={DumpData:O,DumpDataAsync:i,DumpFramebuffer:l,Dispose:u};h.Tools.DumpData=O,h.Tools.DumpDataAsync=i,h.Tools.DumpFramebuffer=l},12157:(w,E,G)=>{G.d(E,{b:()=>B});var P=G(11774),h=G(11890);class B{static ExpandRGBDTexture(w){const E=w._texture;if(!E||!w.isRGBD)return;const h=E.getEngine(),B=h.getCaps(),y=E.isReady;let x=!1;B.textureHalfFloatRender&&B.textureHalfFloatLinearFiltering?(x=!0,E.type=2):B.textureFloatRender&&B.textureFloatLinearFiltering&&(x=!0,E.type=1),x&&(E.isReady=!1,E._isRGBD=!1,E.invertY=!1);const U=async()=>{const B=h.isWebGPU,y=B?1:0;E.isReady=!1,B?await G.e(42).then(G.bind(G,14579)):await G.e(35).then(G.bind(G,14586));const x=new P.e("rgbdDecode","rgbdDecode",null,null,1,null,3,h,!1,void 0,E.type,void 0,null,!1,void 0,y);x.externalTextureSamplerBinding=!0;const U=h.createRenderTargetTexture(E.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:E.samplingMode,type:E.type,format:5});x.onEffectCreatedObservable.addOnce((G=>{G.executeWhenCompiled((()=>{x.onApply=w=>{w._bindTexture("textureSampler",E),w.setFloat2("scale",1,1)},w.Ww().postProcessManager.directRender([x],U,!0),h.restoreDefaultFramebuffer(),h._releaseTexture(E),x&&x.dispose(),U._swapAndDie(E),E.isReady=!0}))}))};x&&(y?U():w.onLoadObservable.addOnce(U))}static async EncodeTextureToRGBD(w,E){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return E.getEngine().isWebGPU?await G.e(43).then(G.bind(G,14602)):await G.e(36).then(G.bind(G,14593)),await(0,h.e)("rgbdEncode",w,E,P,1,5)}}}}]);