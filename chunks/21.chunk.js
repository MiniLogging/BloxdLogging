"use strict";(self["7c63p8lin4r"]=self["7c63p8lin4r"]||[]).push([[20,21],{13393:(z,u,U)=>{var J=U(13397),v=U(12940);v.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(v.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=J.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((z=>{this._texture._sphericalPolynomial=z,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(z){this._texture&&(this._texture._sphericalPolynomial=z)},enumerable:!0,configurable:!0})},13397:(z,u,U)=>{U.d(u,{c:()=>R});var J=U(12914),v=U(12935),f=U(13116),g=U(12917),w=U(12967);class P{constructor(z,u,U,J){this.name=z,this.worldAxisForNormal=u,this.worldAxisForFileX=U,this.worldAxisForFileY=J}}class R{static ConvertCubeMapTextureToSphericalPolynomial(z){var u;if(!z.isCube)return null;null===(u=z.Vz())||void 0===u||u.getEngine().flushFramebuffer();const U=z.getSize().width,J=z.readPixels(0,void 0,void 0,!1),v=z.readPixels(1,void 0,void 0,!1);let f,g;z.isRenderTarget?(f=z.readPixels(3,void 0,void 0,!1),g=z.readPixels(2,void 0,void 0,!1)):(f=z.readPixels(2,void 0,void 0,!1),g=z.readPixels(3,void 0,void 0,!1));const w=z.readPixels(4,void 0,void 0,!1),P=z.readPixels(5,void 0,void 0,!1),R=z.gammaSpace;let S=0;return 1!=z.textureType&&2!=z.textureType||(S=1),new Promise((z=>{Promise.all([v,J,f,g,w,P]).then((u=>{let[J,v,f,g,w,P]=u;const d={size:U,right:v,left:J,up:f,down:g,front:w,back:P,format:5,type:S,gammaSpace:R};z(this.ConvertCubeMapToSphericalPolynomial(d))}))}))}static _AreaElement(z,u){return Math.atan2(z*u,Math.sqrt(z*z+u*u+1))}static ConvertCubeMapToSphericalPolynomial(z){const u=new f.c;let U=0;const J=2/z.size,P=J,R=.5*J,S=R-1;for(let f=0;f<6;f++){const d=this._FileFaces[f],mz=z[d.name];let Z=S;const A=5===z.format?4:3;for(let f=0;f<z.size;f++){let E=S;for(let P=0;P<z.size;P++){const S=d.worldAxisForFileX.scale(E).add(d.worldAxisForFileY.scale(Z)).add(d.worldAxisForNormal);S.normalize();const C=this._AreaElement(E-R,Z-R)-this._AreaElement(E-R,Z+R)-this._AreaElement(E+R,Z-R)+this._AreaElement(E+R,Z+R);let r=mz[f*z.size*A+P*A+0],M=mz[f*z.size*A+P*A+1],T=mz[f*z.size*A+P*A+2];isNaN(r)&&(r=0),isNaN(M)&&(M=0),isNaN(T)&&(T=0),0===z.type&&(r/=255,M/=255,T/=255),z.gammaSpace&&(r=Math.pow((0,v.Clamp)(r),g.l),M=Math.pow((0,v.Clamp)(M),g.l),T=Math.pow((0,v.Clamp)(T),g.l));const X=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const z=Math.max(r,M,T);if(z>X){const u=X/z;r*=u,M*=u,T*=u}}else r=(0,v.Clamp)(r,0,X),M=(0,v.Clamp)(M,0,X),T=(0,v.Clamp)(T,0,X);const h=new w.Tu(r,M,T);u.addLight(S,h,C),U+=C,E+=J}Z+=P}}const d=6*(4*Math.PI)/6/U;return u.scaleInPlace(d),u.convertIncidentRadianceToIrradiance(),u.convertIrradianceToLambertianRadiance(),f.f.FromHarmonics(u)}}R._FileFaces=[new P("right",new J.Eu(1,0,0),new J.Eu(0,0,-1),new J.Eu(0,-1,0)),new P("left",new J.Eu(-1,0,0),new J.Eu(0,0,1),new J.Eu(0,-1,0)),new P("up",new J.Eu(0,1,0),new J.Eu(1,0,0),new J.Eu(0,0,1)),new P("down",new J.Eu(0,-1,0),new J.Eu(1,0,0),new J.Eu(0,0,-1)),new P("front",new J.Eu(0,0,1),new J.Eu(1,0,0),new J.Eu(0,-1,0)),new P("back",new J.Eu(0,0,-1),new J.Eu(-1,0,0),new J.Eu(0,-1,0))],R.MAX_HDRI_VALUE=4096,R.PRESERVE_CLAMPED_COLORS=!1},13144:(z,u,U)=>{U.r(u),U.d(u,{Dispose:()=>mz,DumpData:()=>d,DumpDataAsync:()=>S,DumpFramebuffer:()=>R,DumpTools:()=>Z});var J=U(13023),v=U(12748),f=U(12935),g=U(12797);let w,P=null;async function R(z,u,U,J){let v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",f=arguments.length>5?arguments[5]:void 0,g=arguments.length>6?arguments[6]:void 0;const w=await U.readPixels(0,0,z,u);d(z,u,new Uint8Array(w.buffer),J,v,f,!0,void 0,g)}async function S(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",v=arguments.length>4?arguments[4]:void 0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7?arguments[7]:void 0;return await new Promise((P=>{d(z,u,U,(z=>P(z)),J,v,f,g,w)}))}function d(z,u,R,S){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Z=arguments.length>5?arguments[5]:void 0,A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]&&arguments[7],C=arguments.length>8?arguments[8]:void 0;(async function(){return P||(P=new Promise(((z,u)=>{let v,f=null;const P={Yf:!0,depth:!1,tf:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(U.bind(U,13054)).then((R=>{let{ThinEngine:S}=R;const d=g.e.Instances.length;try{v=new OffscreenCanvas(100,100),f=new S(v,!1,P)}catch(E){var Z;d<g.e.Instances.length&&(null===(Z=g.e.Instances.pop())||void 0===Z||Z.dispose()),v=document.createElement("canvas"),f=new S(v,!1,P)}g.e.Instances.pop(),g.e.OnEnginesDisposedObservable.add((z=>{f&&z!==f&&!f.S&&0===g.e.Instances.length&&mz()})),f.getCaps().parallelShaderCompile=void 0;const A=new J.b(f);U.e(52).then(U.bind(U,15034)).then((U=>{let{passPixelShader:g}=U;if(!f)return void u("Engine is not defined");const P=new J.e({Au:f,name:g.name,fragmentShader:g.shader,samplerNames:["textureSampler"]});w={canvas:v,Au:f,renderer:A,wrapper:P},z(w)}))})).catch(u)}))),await P})().then((U=>{if(U.Au.setSize(z,u,!0),R instanceof Float32Array){const z=new Uint8Array(R.length);let u=R.length;for(;u--;){const U=R[u];z[u]=Math.round(255*(0,f.Clamp)(U))}R=z}const J=U.Au.createRawTexture(R,z,u,5,!1,!A,1);U.renderer.setViewport(),U.renderer.applyEffectWrapper(U.wrapper),U.wrapper.effect._bindTexture("textureSampler",J),U.renderer.draw(),E?v.Tools.ToBlob(U.canvas,(z=>{const u=new FileReader;u.onload=z=>{const u=z.target.result;S&&S(u)},u.readAsArrayBuffer(z)}),d,C):v.Tools.EncodeScreenshotCanvasData(U.canvas,S,d,Z,C),J.dispose()}))}function mz(){var z;w?(w.wrapper.dispose(),w.renderer.dispose(),w.Au.dispose()):null===(z=P)||void 0===z||z.then((z=>{z.wrapper.dispose(),z.renderer.dispose(),z.Au.dispose()}));P=null,w=null}const Z={DumpData:d,DumpDataAsync:S,DumpFramebuffer:R,Dispose:mz};v.Tools.DumpData=d,v.Tools.DumpDataAsync=S,v.Tools.DumpFramebuffer=R},13385:(z,u,U)=>{U.d(u,{c:()=>f});var J=U(13017),v=U(13148);class f{static ExpandRGBDTexture(z){const u=z._texture;if(!u||!z.isRGBD)return;const v=u.getEngine(),f=v.getCaps(),g=u.isReady;let w=!1;f.textureHalfFloatRender&&f.textureHalfFloatLinearFiltering?(w=!0,u.type=2):f.textureFloatRender&&f.textureFloatLinearFiltering&&(w=!0,u.type=1),w&&(u.isReady=!1,u._isRGBD=!1,u.invertY=!1);const P=async()=>{const f=v.isWebGPU,g=f?1:0;u.isReady=!1,f?await U.e(42).then(U.bind(U,15536)):await U.e(35).then(U.bind(U,15540));const w=new J.c("rgbdDecode","rgbdDecode",null,null,1,null,3,v,!1,void 0,u.type,void 0,null,!1,void 0,g);w.externalTextureSamplerBinding=!0;const P=v.createRenderTargetTexture(u.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:u.samplingMode,type:u.type,format:5});w.onEffectCreatedObservable.addOnce((U=>{U.executeWhenCompiled((()=>{w.onApply=z=>{z._bindTexture("textureSampler",u),z.setFloat2("scale",1,1)},z.Vz().postProcessManager.directRender([w],P,!0),v.restoreDefaultFramebuffer(),v._releaseTexture(u),w&&w.dispose(),P._swapAndDie(u),u.isReady=!0}))}))};w&&(g?P():z.onLoadObservable.addOnce(P))}static async EncodeTextureToRGBD(z,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return u.getEngine().isWebGPU?await U.e(43).then(U.bind(U,15553)):await U.e(36).then(U.bind(U,15548)),await(0,v.b)("rgbdEncode",z,u,J,1,5)}}}}]);