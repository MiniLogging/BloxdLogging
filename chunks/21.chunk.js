"use strict";(self.vb3rpbgyozo=self.vb3rpbgyozo||[]).push([[20,21],{13237:(q,I,l)=>{var w=l(13245),t=l(12765);t.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(t.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=w.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((q=>{this._texture._sphericalPolynomial=q,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(q){this._texture&&(this._texture._sphericalPolynomial=q)},enumerable:!0,configurable:!0})},13245:(q,I,l)=>{l.d(I,{b:()=>s});var w=l(12747),t=l(12761),O=l(12939),c=l(12752),a=l(12789);class F{constructor(q,I,l,w){this.name=q,this.worldAxisForNormal=I,this.worldAxisForFileX=l,this.worldAxisForFileY=w}}class s{static ConvertCubeMapTextureToSphericalPolynomial(q){var I;if(!q.isCube)return null;null===(I=q.Wq())||void 0===I||I.getEngine().flushFramebuffer();const l=q.getSize().width,w=q.readPixels(0,void 0,void 0,!1),t=q.readPixels(1,void 0,void 0,!1);let O,c;q.isRenderTarget?(O=q.readPixels(3,void 0,void 0,!1),c=q.readPixels(2,void 0,void 0,!1)):(O=q.readPixels(2,void 0,void 0,!1),c=q.readPixels(3,void 0,void 0,!1));const a=q.readPixels(4,void 0,void 0,!1),F=q.readPixels(5,void 0,void 0,!1),s=q.gammaSpace;let Z=0;return 1!=q.textureType&&2!=q.textureType||(Z=1),new Promise((q=>{Promise.all([t,w,O,c,a,F]).then((I=>{let[w,t,O,c,a,F]=I;const r={size:l,right:t,left:w,up:O,down:c,front:a,back:F,format:5,type:Z,gammaSpace:s};q(this.ConvertCubeMapToSphericalPolynomial(r))}))}))}static _AreaElement(q,I){return Math.atan2(q*I,Math.sqrt(q*q+I*I+1))}static ConvertCubeMapToSphericalPolynomial(q){const I=new O.d;let l=0;const w=2/q.size,F=w,s=.5*w,Z=s-1;for(let O=0;O<6;O++){const r=this._FileFaces[O],x=q[r.name];let o=Z;const d=5===q.format?4:3;for(let O=0;O<q.size;O++){let T=Z;for(let F=0;F<q.size;F++){const Z=r.worldAxisForFileX.scale(T).add(r.worldAxisForFileY.scale(o)).add(r.worldAxisForNormal);Z.normalize();const V=this._AreaElement(T-s,o-s)-this._AreaElement(T-s,o+s)-this._AreaElement(T+s,o-s)+this._AreaElement(T+s,o+s);let U=x[O*q.size*d+F*d+0],B=x[O*q.size*d+F*d+1],v=x[O*q.size*d+F*d+2];isNaN(U)&&(U=0),isNaN(B)&&(B=0),isNaN(v)&&(v=0),0===q.type&&(U/=255,B/=255,v/=255),q.gammaSpace&&(U=Math.pow((0,t.Clamp)(U),c.m),B=Math.pow((0,t.Clamp)(B),c.m),v=Math.pow((0,t.Clamp)(v),c.m));const k=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const q=Math.max(U,B,v);if(q>k){const I=k/q;U*=I,B*=I,v*=I}}else U=(0,t.Clamp)(U,0,k),B=(0,t.Clamp)(B,0,k),v=(0,t.Clamp)(v,0,k);const C=new a.BI(U,B,v);I.addLight(Z,C,V),l+=V,T+=w}o+=F}}const r=6*(4*Math.PI)/6/l;return I.scaleInPlace(r),I.convertIncidentRadianceToIrradiance(),I.convertIrradianceToLambertianRadiance(),O.e.FromHarmonics(I)}}s._FileFaces=[new F("right",new w.dI(1,0,0),new w.dI(0,0,-1),new w.dI(0,-1,0)),new F("left",new w.dI(-1,0,0),new w.dI(0,0,1),new w.dI(0,-1,0)),new F("up",new w.dI(0,1,0),new w.dI(1,0,0),new w.dI(0,0,1)),new F("down",new w.dI(0,-1,0),new w.dI(1,0,0),new w.dI(0,0,-1)),new F("front",new w.dI(0,0,1),new w.dI(1,0,0),new w.dI(0,-1,0)),new F("back",new w.dI(0,0,-1),new w.dI(-1,0,0),new w.dI(0,-1,0))],s.MAX_HDRI_VALUE=4096,s.PRESERVE_CLAMPED_COLORS=!1},12972:(q,I,l)=>{l.r(I),l.d(I,{Dispose:()=>x,DumpData:()=>r,DumpDataAsync:()=>Z,DumpFramebuffer:()=>s,DumpTools:()=>o});var w=l(12851),t=l(12564),O=l(12761),c=l(12612);let a,F=null;async function s(q,I,l,w){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",O=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0;const a=await l.readPixels(0,0,q,I);r(q,I,new Uint8Array(a.buffer),w,t,O,!0,void 0,c)}async function Z(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",t=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7?arguments[7]:void 0;return await new Promise((F=>{r(q,I,l,(q=>F(q)),w,t,O,c,a)}))}function r(q,I,s,Z){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",o=arguments.length>5?arguments[5]:void 0,d=arguments.length>6&&void 0!==arguments[6]&&arguments[6],T=arguments.length>7&&void 0!==arguments[7]&&arguments[7],V=arguments.length>8?arguments[8]:void 0;(async function(){return F||(F=new Promise(((q,I)=>{let t,O=null;const F={oc:!0,depth:!1,cc:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(l.bind(l,12877)).then((s=>{let{ThinEngine:Z}=s;const r=c.e.Instances.length;try{t=new OffscreenCanvas(100,100),O=new Z(t,!1,F)}catch(T){var o;r<c.e.Instances.length&&(null===(o=c.e.Instances.pop())||void 0===o||o.dispose()),t=document.createElement("canvas"),O=new Z(t,!1,F)}c.e.Instances.pop(),c.e.OnEnginesDisposedObservable.add((q=>{O&&q!==O&&!O.Z&&0===c.e.Instances.length&&x()})),O.getCaps().parallelShaderCompile=void 0;const d=new w.b(O);l.e(52).then(l.bind(l,15229)).then((l=>{let{passPixelShader:c}=l;if(!O)return void I("Engine is not defined");const F=new w.f({oI:O,name:c.name,fragmentShader:c.shader,samplerNames:["textureSampler"]});a={canvas:t,oI:O,renderer:d,wrapper:F},q(a)}))})).catch(I)}))),await F})().then((l=>{if(l.oI.setSize(q,I,!0),s instanceof Float32Array){const q=new Uint8Array(s.length);let I=s.length;for(;I--;){const l=s[I];q[I]=Math.round(255*(0,O.Clamp)(l))}s=q}const w=l.oI.createRawTexture(s,q,I,5,!1,!d,1);l.renderer.setViewport(),l.renderer.applyEffectWrapper(l.wrapper),l.wrapper.effect._bindTexture("textureSampler",w),l.renderer.draw(),T?t.Tools.ToBlob(l.canvas,(q=>{const I=new FileReader;I.onload=q=>{const I=q.target.result;Z&&Z(I)},I.readAsArrayBuffer(q)}),r,V):t.Tools.EncodeScreenshotCanvasData(l.canvas,Z,r,o,V),w.dispose()}))}function x(){var q;a?(a.wrapper.dispose(),a.renderer.dispose(),a.oI.dispose()):null===(q=F)||void 0===q||q.then((q=>{q.wrapper.dispose(),q.renderer.dispose(),q.oI.dispose()}));F=null,a=null}const o={DumpData:r,DumpDataAsync:Z,DumpFramebuffer:s,Dispose:x};t.Tools.DumpData=r,t.Tools.DumpDataAsync=Z,t.Tools.DumpFramebuffer=s},13229:(q,I,l)=>{l.d(I,{c:()=>O});var w=l(12847),t=l(12975);class O{static ExpandRGBDTexture(q){const I=q._texture;if(!I||!q.isRGBD)return;const t=I.getEngine(),O=t.getCaps(),c=I.isReady;let a=!1;O.textureHalfFloatRender&&O.textureHalfFloatLinearFiltering?(a=!0,I.type=2):O.textureFloatRender&&O.textureFloatLinearFiltering&&(a=!0,I.type=1),a&&(I.isReady=!1,I._isRGBD=!1,I.invertY=!1);const F=async()=>{const O=t.isWebGPU,c=O?1:0;I.isReady=!1,O?await l.e(42).then(l.bind(l,15799)):await l.e(35).then(l.bind(l,15804));const a=new w.d("rgbdDecode","rgbdDecode",null,null,1,null,3,t,!1,void 0,I.type,void 0,null,!1,void 0,c);a.externalTextureSamplerBinding=!0;const F=t.createRenderTargetTexture(I.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:I.samplingMode,type:I.type,format:5});a.onEffectCreatedObservable.addOnce((l=>{l.executeWhenCompiled((()=>{a.onApply=q=>{q._bindTexture("textureSampler",I),q.setFloat2("scale",1,1)},q.Wq().postProcessManager.directRender([a],F,!0),t.restoreDefaultFramebuffer(),t._releaseTexture(I),a&&a.dispose(),F._swapAndDie(I),I.isReady=!0}))}))};a&&(c?F():q.onLoadObservable.addOnce(F))}static async EncodeTextureToRGBD(q,I){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return I.getEngine().isWebGPU?await l.e(43).then(l.bind(l,15815)):await l.e(36).then(l.bind(l,15807)),await(0,t.b)("rgbdEncode",q,I,w,1,5)}}}}]);