"use strict";(self.zcqpiao938m=self.zcqpiao938m||[]).push([[20,21],{12348:(C,U,K)=>{var m=K(12354),O=K(11854);O.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(O.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=m.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((C=>{this._texture._sphericalPolynomial=C,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(C){this._texture&&(this._texture._sphericalPolynomial=C)},enumerable:!0,configurable:!0})},12354:(C,U,K)=>{K.d(U,{e:()=>z});var m=K(11827),O=K(11846),X=K(12018),A=K(11835),e=K(11879);class t{constructor(C,U,K,m){this.name=C,this.worldAxisForNormal=U,this.worldAxisForFileX=K,this.worldAxisForFileY=m}}class z{static ConvertCubeMapTextureToSphericalPolynomial(C){var U;if(!C.isCube)return null;null===(U=C.dC())||void 0===U||U.getEngine().flushFramebuffer();const K=C.getSize().width,m=C.readPixels(0,void 0,void 0,!1),O=C.readPixels(1,void 0,void 0,!1);let X,A;C.isRenderTarget?(X=C.readPixels(3,void 0,void 0,!1),A=C.readPixels(2,void 0,void 0,!1)):(X=C.readPixels(2,void 0,void 0,!1),A=C.readPixels(3,void 0,void 0,!1));const e=C.readPixels(4,void 0,void 0,!1),t=C.readPixels(5,void 0,void 0,!1),z=C.gammaSpace;let j=0;return 1!=C.textureType&&2!=C.textureType||(j=1),new Promise((C=>{Promise.all([O,m,X,A,e,t]).then((U=>{let[m,O,X,A,e,t]=U;const p={size:K,right:O,left:m,up:X,down:A,front:e,back:t,format:5,type:j,gammaSpace:z};C(this.ConvertCubeMapToSphericalPolynomial(p))}))}))}static _AreaElement(C,U){return Math.atan2(C*U,Math.sqrt(C*C+U*U+1))}static ConvertCubeMapToSphericalPolynomial(C){const U=new X.d;let K=0;const m=2/C.size,t=m,z=.5*m,j=z-1;for(let X=0;X<6;X++){const p=this._FileFaces[X],E=C[p.name];let u=j;const b=5===C.format?4:3;for(let X=0;X<C.size;X++){let v=j;for(let t=0;t<C.size;t++){const j=p.worldAxisForFileX.scale(v).add(p.worldAxisForFileY.scale(u)).add(p.worldAxisForNormal);j.normalize();const Q=this._AreaElement(v-z,u-z)-this._AreaElement(v-z,u+z)-this._AreaElement(v+z,u-z)+this._AreaElement(v+z,u+z);let V=E[X*C.size*b+t*b+0],f=E[X*C.size*b+t*b+1],F=E[X*C.size*b+t*b+2];isNaN(V)&&(V=0),isNaN(f)&&(f=0),isNaN(F)&&(F=0),0===C.type&&(V/=255,f/=255,F/=255),C.gammaSpace&&(V=Math.pow((0,O.Clamp)(V),A.j),f=Math.pow((0,O.Clamp)(f),A.j),F=Math.pow((0,O.Clamp)(F),A.j));const Z=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const C=Math.max(V,f,F);if(C>Z){const U=Z/C;V*=U,f*=U,F*=U}}else V=(0,O.Clamp)(V,0,Z),f=(0,O.Clamp)(f,0,Z),F=(0,O.Clamp)(F,0,Z);const P=new e.fU(V,f,F);U.addLight(j,P,Q),K+=Q,v+=m}u+=t}}const p=6*(4*Math.PI)/6/K;return U.scaleInPlace(p),U.convertIncidentRadianceToIrradiance(),U.convertIrradianceToLambertianRadiance(),X.g.FromHarmonics(U)}}z._FileFaces=[new t("right",new m.bU(1,0,0),new m.bU(0,0,-1),new m.bU(0,-1,0)),new t("left",new m.bU(-1,0,0),new m.bU(0,0,1),new m.bU(0,-1,0)),new t("up",new m.bU(0,1,0),new m.bU(1,0,0),new m.bU(0,0,1)),new t("down",new m.bU(0,-1,0),new m.bU(1,0,0),new m.bU(0,0,-1)),new t("front",new m.bU(0,0,1),new m.bU(1,0,0),new m.bU(0,-1,0)),new t("back",new m.bU(0,0,-1),new m.bU(-1,0,0),new m.bU(0,-1,0))],z.MAX_HDRI_VALUE=4096,z.PRESERVE_CLAMPED_COLORS=!1},12061:(C,U,K)=>{K.r(U),K.d(U,{Dispose:()=>E,DumpData:()=>p,DumpDataAsync:()=>j,DumpFramebuffer:()=>z,DumpTools:()=>u});var m=K(11941),O=K(11660),X=K(11846),A=K(11703);let e,t=null;async function z(C,U,K,m){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",X=arguments.length>5?arguments[5]:void 0,A=arguments.length>6?arguments[6]:void 0;const e=await K.readPixels(0,0,C,U);p(C,U,new Uint8Array(e.buffer),m,O,X,!0,void 0,A)}async function j(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",O=arguments.length>4?arguments[4]:void 0,X=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],e=arguments.length>7?arguments[7]:void 0;return await new Promise((t=>{p(C,U,K,(C=>t(C)),m,O,X,A,e)}))}function p(C,U,z,j){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",u=arguments.length>5?arguments[5]:void 0,b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],v=arguments.length>7&&void 0!==arguments[7]&&arguments[7],Q=arguments.length>8?arguments[8]:void 0;(async function(){return t||(t=new Promise(((C,U)=>{let O,X=null;const t={Ue:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(K.bind(K,11962)).then((z=>{let{ThinEngine:j}=z;const p=A.c.Instances.length;try{O=new OffscreenCanvas(100,100),X=new j(O,!1,t)}catch(v){var u;p<A.c.Instances.length&&(null===(u=A.c.Instances.pop())||void 0===u||u.dispose()),O=document.createElement("canvas"),X=new j(O,!1,t)}A.c.Instances.pop(),A.c.OnEnginesDisposedObservable.add((C=>{X&&C!==X&&!X.A&&0===A.c.Instances.length&&E()})),X.getCaps().parallelShaderCompile=void 0;const b=new m.c(X);K.e(52).then(K.bind(K,14289)).then((K=>{let{passPixelShader:A}=K;if(!X)return void U("Engine is not defined");const t=new m.e({uU:X,name:A.name,fragmentShader:A.shader,samplerNames:["textureSampler"]});e={canvas:O,uU:X,renderer:b,wrapper:t},C(e)}))})).catch(U)}))),await t})().then((K=>{if(K.uU.setSize(C,U,!0),z instanceof Float32Array){const C=new Uint8Array(z.length);let U=z.length;for(;U--;){const K=z[U];C[U]=Math.round(255*(0,X.Clamp)(K))}z=C}const m=K.uU.createRawTexture(z,C,U,5,!1,!b,1);K.renderer.setViewport(),K.renderer.applyEffectWrapper(K.wrapper),K.wrapper.effect._bindTexture("textureSampler",m),K.renderer.draw(),v?O.Tools.ToBlob(K.canvas,(C=>{const U=new FileReader;U.onload=C=>{const U=C.target.result;j&&j(U)},U.readAsArrayBuffer(C)}),p,Q):O.Tools.EncodeScreenshotCanvasData(K.canvas,j,p,u,Q),m.dispose()}))}function E(){var C;e?(e.wrapper.dispose(),e.renderer.dispose(),e.uU.dispose()):null===(C=t)||void 0===C||C.then((C=>{C.wrapper.dispose(),C.renderer.dispose(),C.uU.dispose()}));t=null,e=null}const u={DumpData:p,DumpDataAsync:j,DumpFramebuffer:z,Dispose:E};O.Tools.DumpData=p,O.Tools.DumpDataAsync=j,O.Tools.DumpFramebuffer=z},12339:(C,U,K)=>{K.d(U,{b:()=>X});var m=K(11932),O=K(12067);class X{static ExpandRGBDTexture(C){const U=C._texture;if(!U||!C.isRGBD)return;const O=U.getEngine(),X=O.getCaps(),A=U.isReady;let e=!1;X.textureHalfFloatRender&&X.textureHalfFloatLinearFiltering?(e=!0,U.type=2):X.textureFloatRender&&X.textureFloatLinearFiltering&&(e=!0,U.type=1),e&&(U.isReady=!1,U._isRGBD=!1,U.invertY=!1);const t=async()=>{const X=O.isWebGPU,A=X?1:0;U.isReady=!1,X?await K.e(42).then(K.bind(K,14830)):await K.e(35).then(K.bind(K,14838));const e=new m.b("rgbdDecode","rgbdDecode",null,null,1,null,3,O,!1,void 0,U.type,void 0,null,!1,void 0,A);e.externalTextureSamplerBinding=!0;const t=O.createRenderTargetTexture(U.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:U.samplingMode,type:U.type,format:5});e.onEffectCreatedObservable.addOnce((K=>{K.executeWhenCompiled((()=>{e.onApply=C=>{C._bindTexture("textureSampler",U),C.setFloat2("scale",1,1)},C.dC().postProcessManager.directRender([e],t,!0),O.restoreDefaultFramebuffer(),O._releaseTexture(U),e&&e.dispose(),t._swapAndDie(U),U.isReady=!0}))}))};e&&(A?t():C.onLoadObservable.addOnce(t))}static async EncodeTextureToRGBD(C,U){let m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return U.getEngine().isWebGPU?await K.e(43).then(K.bind(K,14849)):await K.e(36).then(K.bind(K,14844)),await(0,O.c)("rgbdEncode",C,U,m,1,5)}}}}]);