"use strict";(self.uw9p3pwwsje=self.uw9p3pwwsje||[]).push([[20,21],{13364:(D,h,o)=>{var H=o(13370),g=o(12849);g.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(g.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=H.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((D=>{this._texture._sphericalPolynomial=D,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(D){this._texture&&(this._texture._sphericalPolynomial=D)},enumerable:!0,configurable:!0})},13370:(D,h,o)=>{o.d(h,{b:()=>S});var H=o(12831),g=o(12842),j=o(13016),M=o(12833),R=o(12870);class t{constructor(D,h,o,H){this.name=D,this.worldAxisForNormal=h,this.worldAxisForFileX=o,this.worldAxisForFileY=H}}class S{static ConvertCubeMapTextureToSphericalPolynomial(D){var h;if(!D.isCube)return null;null===(h=D.GD())||void 0===h||h.getEngine().flushFramebuffer();const o=D.getSize().width,H=D.readPixels(0,void 0,void 0,!1),g=D.readPixels(1,void 0,void 0,!1);let j,M;D.isRenderTarget?(j=D.readPixels(3,void 0,void 0,!1),M=D.readPixels(2,void 0,void 0,!1)):(j=D.readPixels(2,void 0,void 0,!1),M=D.readPixels(3,void 0,void 0,!1));const R=D.readPixels(4,void 0,void 0,!1),t=D.readPixels(5,void 0,void 0,!1),S=D.gammaSpace;let k=0;return 1!=D.textureType&&2!=D.textureType||(k=1),new Promise((D=>{Promise.all([g,H,j,M,R,t]).then((h=>{let[H,g,j,M,R,t]=h;const K={size:o,right:g,left:H,up:j,down:M,front:R,back:t,format:5,type:k,gammaSpace:S};D(this.ConvertCubeMapToSphericalPolynomial(K))}))}))}static _AreaElement(D,h){return Math.atan2(D*h,Math.sqrt(D*D+h*h+1))}static ConvertCubeMapToSphericalPolynomial(D){const h=new j.c;let o=0;const H=2/D.size,t=H,S=.5*H,k=S-1;for(let j=0;j<6;j++){const K=this._FileFaces[j],Q=D[K.name];let v=k;const r=5===D.format?4:3;for(let j=0;j<D.size;j++){let B=k;for(let t=0;t<D.size;t++){const k=K.worldAxisForFileX.scale(B).add(K.worldAxisForFileY.scale(v)).add(K.worldAxisForNormal);k.normalize();const s=this._AreaElement(B-S,v-S)-this._AreaElement(B-S,v+S)-this._AreaElement(B+S,v-S)+this._AreaElement(B+S,v+S);let U=Q[j*D.size*r+t*r+0],q=Q[j*D.size*r+t*r+1],c=Q[j*D.size*r+t*r+2];isNaN(U)&&(U=0),isNaN(q)&&(q=0),isNaN(c)&&(c=0),0===D.type&&(U/=255,q/=255,c/=255),D.gammaSpace&&(U=Math.pow((0,g.Clamp)(U),M.l),q=Math.pow((0,g.Clamp)(q),M.l),c=Math.pow((0,g.Clamp)(c),M.l));const y=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const D=Math.max(U,q,c);if(D>y){const h=y/D;U*=h,q*=h,c*=h}}else U=(0,g.Clamp)(U,0,y),q=(0,g.Clamp)(q,0,y),c=(0,g.Clamp)(c,0,y);const b=new R.mo(U,q,c);h.addLight(k,b,s),o+=s,B+=H}v+=t}}const K=6*(4*Math.PI)/6/o;return h.scaleInPlace(K),h.convertIncidentRadianceToIrradiance(),h.convertIrradianceToLambertianRadiance(),j.g.FromHarmonics(h)}}S._FileFaces=[new t("right",new H.Gh(1,0,0),new H.Gh(0,0,-1),new H.Gh(0,-1,0)),new t("left",new H.Gh(-1,0,0),new H.Gh(0,0,1),new H.Gh(0,-1,0)),new t("up",new H.Gh(0,1,0),new H.Gh(1,0,0),new H.Gh(0,0,1)),new t("down",new H.Gh(0,-1,0),new H.Gh(1,0,0),new H.Gh(0,0,-1)),new t("front",new H.Gh(0,0,1),new H.Gh(1,0,0),new H.Gh(0,-1,0)),new t("back",new H.Gh(0,0,-1),new H.Gh(-1,0,0),new H.Gh(0,-1,0))],S.MAX_HDRI_VALUE=4096,S.PRESERVE_CLAMPED_COLORS=!1},13046:(D,h,o)=>{o.r(h),o.d(h,{Dispose:()=>Q,DumpData:()=>K,DumpDataAsync:()=>k,DumpFramebuffer:()=>S,DumpTools:()=>v});var H=o(12930),g=o(12642),j=o(12842),M=o(12683);let R,t=null;async function S(D,h,o,H){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",j=arguments.length>5?arguments[5]:void 0,M=arguments.length>6?arguments[6]:void 0;const R=await o.readPixels(0,0,D,h);K(D,h,new Uint8Array(R.buffer),H,g,j,!0,void 0,M)}async function k(D,h,o){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",g=arguments.length>4?arguments[4]:void 0,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5],M=arguments.length>6&&void 0!==arguments[6]&&arguments[6],R=arguments.length>7?arguments[7]:void 0;return await new Promise((t=>{K(D,h,o,(D=>t(D)),H,g,j,M,R)}))}function K(D,h,S,k){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",v=arguments.length>5?arguments[5]:void 0,r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7&&void 0!==arguments[7]&&arguments[7],s=arguments.length>8?arguments[8]:void 0;(async function(){return t||(t=new Promise(((D,h)=>{let g,j=null;const t={ph:!0,depth:!1,Oh:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(o.bind(o,12962)).then((S=>{let{ThinEngine:k}=S;const K=M.d.Instances.length;try{g=new OffscreenCanvas(100,100),j=new k(g,!1,t)}catch(B){var v;K<M.d.Instances.length&&(null===(v=M.d.Instances.pop())||void 0===v||v.dispose()),g=document.createElement("canvas"),j=new k(g,!1,t)}M.d.Instances.pop(),M.d.OnEnginesDisposedObservable.add((D=>{j&&D!==j&&!j.S&&0===M.d.Instances.length&&Q()})),j.getCaps().parallelShaderCompile=void 0;const r=new H.b(j);o.e(52).then(o.bind(o,15193)).then((o=>{let{passPixelShader:M}=o;if(!j)return void h("Engine is not defined");const t=new H.c({bh:j,name:M.name,fragmentShader:M.shader,samplerNames:["textureSampler"]});R={canvas:g,bh:j,renderer:r,wrapper:t},D(R)}))})).catch(h)}))),await t})().then((o=>{if(o.bh.setSize(D,h,!0),S instanceof Float32Array){const D=new Uint8Array(S.length);let h=S.length;for(;h--;){const o=S[h];D[h]=Math.round(255*(0,j.Clamp)(o))}S=D}const H=o.bh.createRawTexture(S,D,h,5,!1,!r,1);o.renderer.setViewport(),o.renderer.applyEffectWrapper(o.wrapper),o.wrapper.effect._bindTexture("textureSampler",H),o.renderer.draw(),B?g.Tools.ToBlob(o.canvas,(D=>{const h=new FileReader;h.onload=D=>{const h=D.target.result;k&&k(h)},h.readAsArrayBuffer(D)}),K,s):g.Tools.EncodeScreenshotCanvasData(o.canvas,k,K,v,s),H.dispose()}))}function Q(){var D;R?(R.wrapper.dispose(),R.renderer.dispose(),R.bh.dispose()):null===(D=t)||void 0===D||D.then((D=>{D.wrapper.dispose(),D.renderer.dispose(),D.bh.dispose()}));t=null,R=null}const v={DumpData:K,DumpDataAsync:k,DumpFramebuffer:S,Dispose:Q};g.Tools.DumpData=K,g.Tools.DumpDataAsync=k,g.Tools.DumpFramebuffer=S},13347:(D,h,o)=>{o.d(h,{c:()=>j});var H=o(12923),g=o(13053);class j{static ExpandRGBDTexture(D){const h=D._texture;if(!h||!D.isRGBD)return;const g=h.getEngine(),j=g.getCaps(),M=h.isReady;let R=!1;j.textureHalfFloatRender&&j.textureHalfFloatLinearFiltering?(R=!0,h.type=2):j.textureFloatRender&&j.textureFloatLinearFiltering&&(R=!0,h.type=1),R&&(h.isReady=!1,h._isRGBD=!1,h.invertY=!1);const t=async()=>{const j=g.isWebGPU,M=j?1:0;h.isReady=!1,j?await o.e(42).then(o.bind(o,15723)):await o.e(35).then(o.bind(o,15730));const R=new H.e("rgbdDecode","rgbdDecode",null,null,1,null,3,g,!1,void 0,h.type,void 0,null,!1,void 0,M);R.externalTextureSamplerBinding=!0;const t=g.createRenderTargetTexture(h.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:h.samplingMode,type:h.type,format:5});R.onEffectCreatedObservable.addOnce((o=>{o.executeWhenCompiled((()=>{R.onApply=D=>{D._bindTexture("textureSampler",h),D.setFloat2("scale",1,1)},D.GD().postProcessManager.directRender([R],t,!0),g.restoreDefaultFramebuffer(),g._releaseTexture(h),R&&R.dispose(),t._swapAndDie(h),h.isReady=!0}))}))};R&&(M?t():D.onLoadObservable.addOnce(t))}static async EncodeTextureToRGBD(D,h){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return h.getEngine().isWebGPU?await o.e(43).then(o.bind(o,15740)):await o.e(36).then(o.bind(o,15732)),await(0,g.d)("rgbdEncode",D,h,H,1,5)}}}}]);