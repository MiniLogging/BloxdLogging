"use strict";(self.bbj0x35f849=self.bbj0x35f849||[]).push([[20,21],{11636:(N,q,C)=>{var d=C(11643),U=C(11149);U.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(U.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=d.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((N=>{this._texture._sphericalPolynomial=N,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(N){this._texture&&(this._texture._sphericalPolynomial=N)},enumerable:!0,configurable:!0})},11643:(N,q,C)=>{C.d(q,{e:()=>A});var d=C(11122),U=C(11142),W=C(11316),a=C(11129),F=C(11167);class w{constructor(N,q,C,d){this.name=N,this.worldAxisForNormal=q,this.worldAxisForFileX=C,this.worldAxisForFileY=d}}class A{static ConvertCubeMapTextureToSphericalPolynomial(N){var q;if(!N.isCube)return null;null===(q=N.lN())||void 0===q||q.getEngine().flushFramebuffer();const C=N.getSize().width,d=N.readPixels(0,void 0,void 0,!1),U=N.readPixels(1,void 0,void 0,!1);let W,a;N.isRenderTarget?(W=N.readPixels(3,void 0,void 0,!1),a=N.readPixels(2,void 0,void 0,!1)):(W=N.readPixels(2,void 0,void 0,!1),a=N.readPixels(3,void 0,void 0,!1));const F=N.readPixels(4,void 0,void 0,!1),w=N.readPixels(5,void 0,void 0,!1),A=N.gammaSpace;let n=0;return 1!=N.textureType&&2!=N.textureType||(n=1),new Promise((N=>{Promise.all([U,d,W,a,F,w]).then((q=>{let[d,U,W,a,F,w]=q;const t={size:C,right:U,left:d,up:W,down:a,front:F,back:w,format:5,type:n,gammaSpace:A};N(this.ConvertCubeMapToSphericalPolynomial(t))}))}))}static _AreaElement(N,q){return Math.atan2(N*q,Math.sqrt(N*N+q*q+1))}static ConvertCubeMapToSphericalPolynomial(N){const q=new W.c;let C=0;const d=2/N.size,w=d,A=.5*d,n=A-1;for(let W=0;W<6;W++){const t=this._FileFaces[W],V=N[t.name];let Z=n;const J=5===N.format?4:3;for(let W=0;W<N.size;W++){let Q=n;for(let w=0;w<N.size;w++){const n=t.worldAxisForFileX.scale(Q).add(t.worldAxisForFileY.scale(Z)).add(t.worldAxisForNormal);n.normalize();const v=this._AreaElement(Q-A,Z-A)-this._AreaElement(Q-A,Z+A)-this._AreaElement(Q+A,Z-A)+this._AreaElement(Q+A,Z+A);let r=V[W*N.size*J+w*J+0],O=V[W*N.size*J+w*J+1],K=V[W*N.size*J+w*J+2];isNaN(r)&&(r=0),isNaN(O)&&(O=0),isNaN(K)&&(K=0),0===N.type&&(r/=255,O/=255,K/=255),N.gammaSpace&&(r=Math.pow((0,U.Clamp)(r),a.m),O=Math.pow((0,U.Clamp)(O),a.m),K=Math.pow((0,U.Clamp)(K),a.m));const i=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const N=Math.max(r,O,K);if(N>i){const q=i/N;r*=q,O*=q,K*=q}}else r=(0,U.Clamp)(r,0,i),O=(0,U.Clamp)(O,0,i),K=(0,U.Clamp)(K,0,i);const I=new F.Oq(r,O,K);q.addLight(n,I,v),C+=v,Q+=d}Z+=w}}const t=6*(4*Math.PI)/6/C;return q.scaleInPlace(t),q.convertIncidentRadianceToIrradiance(),q.convertIrradianceToLambertianRadiance(),W.g.FromHarmonics(q)}}A._FileFaces=[new w("right",new d.Jq(1,0,0),new d.Jq(0,0,-1),new d.Jq(0,-1,0)),new w("left",new d.Jq(-1,0,0),new d.Jq(0,0,1),new d.Jq(0,-1,0)),new w("up",new d.Jq(0,1,0),new d.Jq(1,0,0),new d.Jq(0,0,1)),new w("down",new d.Jq(0,-1,0),new d.Jq(1,0,0),new d.Jq(0,0,-1)),new w("front",new d.Jq(0,0,1),new d.Jq(1,0,0),new d.Jq(0,-1,0)),new w("back",new d.Jq(0,0,-1),new d.Jq(-1,0,0),new d.Jq(0,-1,0))],A.MAX_HDRI_VALUE=4096,A.PRESERVE_CLAMPED_COLORS=!1},11354:(N,q,C)=>{C.r(q),C.d(q,{Dispose:()=>V,DumpData:()=>t,DumpDataAsync:()=>n,DumpFramebuffer:()=>A,DumpTools:()=>Z});var d=C(11234),U=C(10945),W=C(11142),a=C(10995);let F,w=null;async function A(N,q,C,d){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",W=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0;const F=await C.readPixels(0,0,N,q);t(N,q,new Uint8Array(F.buffer),d,U,W,!0,void 0,a)}async function n(N,q,C){let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",U=arguments.length>4?arguments[4]:void 0,W=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7?arguments[7]:void 0;return await new Promise((w=>{t(N,q,C,(N=>w(N)),d,U,W,a,F)}))}function t(N,q,A,n){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Z=arguments.length>5?arguments[5]:void 0,J=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7&&void 0!==arguments[7]&&arguments[7],v=arguments.length>8?arguments[8]:void 0;(async function(){return w||(w=new Promise(((N,q)=>{let U,W=null;const w={o:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(C.bind(C,11266)).then((A=>{let{ThinEngine:n}=A;const t=a.e.Instances.length;try{U=new OffscreenCanvas(100,100),W=new n(U,!1,w)}catch(Q){var Z;t<a.e.Instances.length&&(null===(Z=a.e.Instances.pop())||void 0===Z||Z.dispose()),U=document.createElement("canvas"),W=new n(U,!1,w)}a.e.Instances.pop(),a.e.OnEnginesDisposedObservable.add((N=>{W&&N!==W&&!W.A&&0===a.e.Instances.length&&V()})),W.getCaps().parallelShaderCompile=void 0;const J=new d.c(W);C.e(52).then(C.bind(C,13585)).then((C=>{let{passPixelShader:a}=C;if(!W)return void q("Engine is not defined");const w=new d.d({Zq:W,name:a.name,fragmentShader:a.shader,samplerNames:["textureSampler"]});F={canvas:U,Zq:W,renderer:J,wrapper:w},N(F)}))})).catch(q)}))),await w})().then((C=>{if(C.Zq.setSize(N,q,!0),A instanceof Float32Array){const N=new Uint8Array(A.length);let q=A.length;for(;q--;){const C=A[q];N[q]=Math.round(255*(0,W.Clamp)(C))}A=N}const d=C.Zq.createRawTexture(A,N,q,5,!1,!J,1);C.renderer.setViewport(),C.renderer.applyEffectWrapper(C.wrapper),C.wrapper.effect._bindTexture("textureSampler",d),C.renderer.draw(),Q?U.Tools.ToBlob(C.canvas,(N=>{const q=new FileReader;q.onload=N=>{const q=N.target.result;n&&n(q)},q.readAsArrayBuffer(N)}),t,v):U.Tools.EncodeScreenshotCanvasData(C.canvas,n,t,Z,v),d.dispose()}))}function V(){var N;F?(F.wrapper.dispose(),F.renderer.dispose(),F.Zq.dispose()):null===(N=w)||void 0===N||N.then((N=>{N.wrapper.dispose(),N.renderer.dispose(),N.Zq.dispose()}));w=null,F=null}const Z={DumpData:t,DumpDataAsync:n,DumpFramebuffer:A,Dispose:V};U.Tools.DumpData=t,U.Tools.DumpDataAsync=n,U.Tools.DumpFramebuffer=A},11629:(N,q,C)=>{C.d(q,{d:()=>W});var d=C(11228),U=C(11356);class W{static ExpandRGBDTexture(N){const q=N._texture;if(!q||!N.isRGBD)return;const U=q.getEngine(),W=U.getCaps(),a=q.isReady;let F=!1;W.textureHalfFloatRender&&W.textureHalfFloatLinearFiltering?(F=!0,q.type=2):W.textureFloatRender&&W.textureFloatLinearFiltering&&(F=!0,q.type=1),F&&(q.isReady=!1,q._isRGBD=!1,q.invertY=!1);const w=async()=>{const W=U.isWebGPU,a=W?1:0;q.isReady=!1,W?await C.e(42).then(C.bind(C,14132)):await C.e(35).then(C.bind(C,14141));const F=new d.b("rgbdDecode","rgbdDecode",null,null,1,null,3,U,!1,void 0,q.type,void 0,null,!1,void 0,a);F.externalTextureSamplerBinding=!0;const w=U.createRenderTargetTexture(q.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:q.samplingMode,type:q.type,format:5});F.onEffectCreatedObservable.addOnce((C=>{C.executeWhenCompiled((()=>{F.onApply=N=>{N._bindTexture("textureSampler",q),N.setFloat2("scale",1,1)},N.lN().postProcessManager.directRender([F],w,!0),U.restoreDefaultFramebuffer(),U._releaseTexture(q),F&&F.dispose(),w._swapAndDie(q),q.isReady=!0}))}))};F&&(a?w():N.onLoadObservable.addOnce(w))}static async EncodeTextureToRGBD(N,q){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return q.getEngine().isWebGPU?await C.e(43).then(C.bind(C,14151)):await C.e(36).then(C.bind(C,14143)),await(0,U.b)("rgbdEncode",N,q,d,1,5)}}}}]);