"use strict";(self["9jl1vn4ei5r"]=self["9jl1vn4ei5r"]||[]).push([[20,21],{12329:(M,p,b)=>{var Q=b(12335),q=b(11809);q.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(q.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=Q.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((M=>{this._texture._sphericalPolynomial=M,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(M){this._texture&&(this._texture._sphericalPolynomial=M)},enumerable:!0,configurable:!0})},12335:(M,p,b)=>{b.d(p,{c:()=>O});var Q=b(11796),q=b(11806),B=b(11976),k=b(11798),u=b(11833);class T{constructor(M,p,b,Q){this.name=M,this.worldAxisForNormal=p,this.worldAxisForFileX=b,this.worldAxisForFileY=Q}}class O{static ConvertCubeMapTextureToSphericalPolynomial(M){var p;if(!M.isCube)return null;null===(p=M.RM())||void 0===p||p.getEngine().flushFramebuffer();const b=M.getSize().width,Q=M.readPixels(0,void 0,void 0,!1),q=M.readPixels(1,void 0,void 0,!1);let B,k;M.isRenderTarget?(B=M.readPixels(3,void 0,void 0,!1),k=M.readPixels(2,void 0,void 0,!1)):(B=M.readPixels(2,void 0,void 0,!1),k=M.readPixels(3,void 0,void 0,!1));const u=M.readPixels(4,void 0,void 0,!1),T=M.readPixels(5,void 0,void 0,!1),O=M.gammaSpace;let H=0;return 1!=M.textureType&&2!=M.textureType||(H=1),new Promise((M=>{Promise.all([q,Q,B,k,u,T]).then((p=>{let[Q,q,B,k,u,T]=p;const F={size:b,right:q,left:Q,up:B,down:k,front:u,back:T,format:5,type:H,gammaSpace:O};M(this.ConvertCubeMapToSphericalPolynomial(F))}))}))}static _AreaElement(M,p){return Math.atan2(M*p,Math.sqrt(M*M+p*p+1))}static ConvertCubeMapToSphericalPolynomial(M){const p=new B.e;let b=0;const Q=2/M.size,T=Q,O=.5*Q,H=O-1;for(let B=0;B<6;B++){const F=this._FileFaces[B],o=M[F.name];let W=H;const i=5===M.format?4:3;for(let B=0;B<M.size;B++){let A=H;for(let T=0;T<M.size;T++){const H=F.worldAxisForFileX.scale(A).add(F.worldAxisForFileY.scale(W)).add(F.worldAxisForNormal);H.normalize();const j=this._AreaElement(A-O,W-O)-this._AreaElement(A-O,W+O)-this._AreaElement(A+O,W-O)+this._AreaElement(A+O,W+O);let K=o[B*M.size*i+T*i+0],D=o[B*M.size*i+T*i+1],a=o[B*M.size*i+T*i+2];isNaN(K)&&(K=0),isNaN(D)&&(D=0),isNaN(a)&&(a=0),0===M.type&&(K/=255,D/=255,a/=255),M.gammaSpace&&(K=Math.pow((0,q.Clamp)(K),k.l),D=Math.pow((0,q.Clamp)(D),k.l),a=Math.pow((0,q.Clamp)(a),k.l));const s=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const M=Math.max(K,D,a);if(M>s){const p=s/M;K*=p,D*=p,a*=p}}else K=(0,q.Clamp)(K,0,s),D=(0,q.Clamp)(D,0,s),a=(0,q.Clamp)(a,0,s);const S=new u.ap(K,D,a);p.addLight(H,S,j),b+=j,A+=Q}W+=T}}const F=6*(4*Math.PI)/6/b;return p.scaleInPlace(F),p.convertIncidentRadianceToIrradiance(),p.convertIrradianceToLambertianRadiance(),B.f.FromHarmonics(p)}}O._FileFaces=[new T("right",new Q.Ap(1,0,0),new Q.Ap(0,0,-1),new Q.Ap(0,-1,0)),new T("left",new Q.Ap(-1,0,0),new Q.Ap(0,0,1),new Q.Ap(0,-1,0)),new T("up",new Q.Ap(0,1,0),new Q.Ap(1,0,0),new Q.Ap(0,0,1)),new T("down",new Q.Ap(0,-1,0),new Q.Ap(1,0,0),new Q.Ap(0,0,-1)),new T("front",new Q.Ap(0,0,1),new Q.Ap(1,0,0),new Q.Ap(0,-1,0)),new T("back",new Q.Ap(0,0,-1),new Q.Ap(-1,0,0),new Q.Ap(0,-1,0))],O.MAX_HDRI_VALUE=4096,O.PRESERVE_CLAMPED_COLORS=!1},12016:(M,p,b)=>{b.r(p),b.d(p,{Dispose:()=>o,DumpData:()=>F,DumpDataAsync:()=>H,DumpFramebuffer:()=>O,DumpTools:()=>W});var Q=b(11888),q=b(11621),B=b(11806),k=b(11664);let u,T=null;async function O(M,p,b,Q){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",B=arguments.length>5?arguments[5]:void 0,k=arguments.length>6?arguments[6]:void 0;const u=await b.readPixels(0,0,M,p);F(M,p,new Uint8Array(u.buffer),Q,q,B,!0,void 0,k)}async function H(M,p,b){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",q=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7?arguments[7]:void 0;return await new Promise((T=>{F(M,p,b,(M=>T(M)),Q,q,B,k,u)}))}function F(M,p,O,H){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",W=arguments.length>5?arguments[5]:void 0,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],A=arguments.length>7&&void 0!==arguments[7]&&arguments[7],j=arguments.length>8?arguments[8]:void 0;(async function(){return T||(T=new Promise(((M,p)=>{let q,B=null;const T={kb:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(b.bind(b,11919)).then((O=>{let{ThinEngine:H}=O;const F=k.c.Instances.length;try{q=new OffscreenCanvas(100,100),B=new H(q,!1,T)}catch(A){var W;F<k.c.Instances.length&&(null===(W=k.c.Instances.pop())||void 0===W||W.dispose()),q=document.createElement("canvas"),B=new H(q,!1,T)}k.c.Instances.pop(),k.c.OnEnginesDisposedObservable.add((M=>{B&&M!==B&&!B.O&&0===k.c.Instances.length&&o()})),B.getCaps().parallelShaderCompile=void 0;const i=new Q.e(B);b.e(52).then(b.bind(b,14201)).then((b=>{let{passPixelShader:k}=b;if(!B)return void p("Engine is not defined");const T=new Q.g({Wp:B,name:k.name,fragmentShader:k.shader,samplerNames:["textureSampler"]});u={canvas:q,Wp:B,renderer:i,wrapper:T},M(u)}))})).catch(p)}))),await T})().then((b=>{if(b.Wp.setSize(M,p,!0),O instanceof Float32Array){const M=new Uint8Array(O.length);let p=O.length;for(;p--;){const b=O[p];M[p]=Math.round(255*(0,B.Clamp)(b))}O=M}const Q=b.Wp.createRawTexture(O,M,p,5,!1,!i,1);b.renderer.setViewport(),b.renderer.applyEffectWrapper(b.wrapper),b.wrapper.effect._bindTexture("textureSampler",Q),b.renderer.draw(),A?q.Tools.ToBlob(b.canvas,(M=>{const p=new FileReader;p.onload=M=>{const p=M.target.result;H&&H(p)},p.readAsArrayBuffer(M)}),F,j):q.Tools.EncodeScreenshotCanvasData(b.canvas,H,F,W,j),Q.dispose()}))}function o(){var M;u?(u.wrapper.dispose(),u.renderer.dispose(),u.Wp.dispose()):null===(M=T)||void 0===M||M.then((M=>{M.wrapper.dispose(),M.renderer.dispose(),M.Wp.dispose()}));T=null,u=null}const W={DumpData:F,DumpDataAsync:H,DumpFramebuffer:O,Dispose:o};q.Tools.DumpData=F,q.Tools.DumpDataAsync=H,q.Tools.DumpFramebuffer=O},12316:(M,p,b)=>{b.d(p,{d:()=>B});var Q=b(11882),q=b(12022);class B{static ExpandRGBDTexture(M){const p=M._texture;if(!p||!M.isRGBD)return;const q=p.getEngine(),B=q.getCaps(),k=p.isReady;let u=!1;B.textureHalfFloatRender&&B.textureHalfFloatLinearFiltering?(u=!0,p.type=2):B.textureFloatRender&&B.textureFloatLinearFiltering&&(u=!0,p.type=1),u&&(p.isReady=!1,p._isRGBD=!1,p.invertY=!1);const T=async()=>{const B=q.isWebGPU,k=B?1:0;p.isReady=!1,B?await b.e(42).then(b.bind(b,14783)):await b.e(35).then(b.bind(b,14792));const u=new Q.b("rgbdDecode","rgbdDecode",null,null,1,null,3,q,!1,void 0,p.type,void 0,null,!1,void 0,k);u.externalTextureSamplerBinding=!0;const T=q.createRenderTargetTexture(p.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:p.samplingMode,type:p.type,format:5});u.onEffectCreatedObservable.addOnce((b=>{b.executeWhenCompiled((()=>{u.onApply=M=>{M._bindTexture("textureSampler",p),M.setFloat2("scale",1,1)},M.RM().postProcessManager.directRender([u],T,!0),q.restoreDefaultFramebuffer(),q._releaseTexture(p),u&&u.dispose(),T._swapAndDie(p),p.isReady=!0}))}))};u&&(k?T():M.onLoadObservable.addOnce(T))}static async EncodeTextureToRGBD(M,p){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return p.getEngine().isWebGPU?await b.e(43).then(b.bind(b,14807)):await b.e(36).then(b.bind(b,14801)),await(0,q.e)("rgbdEncode",M,p,Q,1,5)}}}}]);