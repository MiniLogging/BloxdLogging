"use strict";(self.mo7o6813fhb=self.mo7o6813fhb||[]).push([[20,21],{12941:(t,U,y)=>{var I=y(12950),r=y(12413);r.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(r.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=I.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((t=>{this._texture._sphericalPolynomial=t,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(t){this._texture&&(this._texture._sphericalPolynomial=t)},enumerable:!0,configurable:!0})},12950:(t,U,y)=>{y.d(U,{e:()=>G});var I=y(12386),r=y(12404),Y=y(12597),mt=y(12392),X=y(12442);class P{constructor(t,U,y,I){this.name=t,this.worldAxisForNormal=U,this.worldAxisForFileX=y,this.worldAxisForFileY=I}}class G{static ConvertCubeMapTextureToSphericalPolynomial(t){var U;if(!t.isCube)return null;null===(U=t.St())||void 0===U||U.getEngine().flushFramebuffer();const y=t.getSize().width,I=t.readPixels(0,void 0,void 0,!1),r=t.readPixels(1,void 0,void 0,!1);let Y,mt;t.isRenderTarget?(Y=t.readPixels(3,void 0,void 0,!1),mt=t.readPixels(2,void 0,void 0,!1)):(Y=t.readPixels(2,void 0,void 0,!1),mt=t.readPixels(3,void 0,void 0,!1));const X=t.readPixels(4,void 0,void 0,!1),P=t.readPixels(5,void 0,void 0,!1),G=t.gammaSpace;let M=0;return 1!=t.textureType&&2!=t.textureType||(M=1),new Promise((t=>{Promise.all([r,I,Y,mt,X,P]).then((U=>{let[I,r,Y,mt,X,P]=U;const L={size:y,right:r,left:I,up:Y,down:mt,front:X,back:P,format:5,type:M,gammaSpace:G};t(this.ConvertCubeMapToSphericalPolynomial(L))}))}))}static _AreaElement(t,U){return Math.atan2(t*U,Math.sqrt(t*t+U*U+1))}static ConvertCubeMapToSphericalPolynomial(t){const U=new Y.b;let y=0;const I=2/t.size,P=I,G=.5*I,M=G-1;for(let Y=0;Y<6;Y++){const L=this._FileFaces[Y],h=t[L.name];let Q=M;const F=5===t.format?4:3;for(let Y=0;Y<t.size;Y++){let E=M;for(let P=0;P<t.size;P++){const M=L.worldAxisForFileX.scale(E).add(L.worldAxisForFileY.scale(Q)).add(L.worldAxisForNormal);M.normalize();const w=this._AreaElement(E-G,Q-G)-this._AreaElement(E-G,Q+G)-this._AreaElement(E+G,Q-G)+this._AreaElement(E+G,Q+G);let D=h[Y*t.size*F+P*F+0],l=h[Y*t.size*F+P*F+1],g=h[Y*t.size*F+P*F+2];isNaN(D)&&(D=0),isNaN(l)&&(l=0),isNaN(g)&&(g=0),0===t.type&&(D/=255,l/=255,g/=255),t.gammaSpace&&(D=Math.pow((0,r.Clamp)(D),mt.g),l=Math.pow((0,r.Clamp)(l),mt.g),g=Math.pow((0,r.Clamp)(g),mt.g));const B=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const t=Math.max(D,l,g);if(t>B){const U=B/t;D*=U,l*=U,g*=U}}else D=(0,r.Clamp)(D,0,B),l=(0,r.Clamp)(l,0,B),g=(0,r.Clamp)(g,0,B);const b=new X.bU(D,l,g);U.addLight(M,b,w),y+=w,E+=I}Q+=P}}const L=6*(4*Math.PI)/6/y;return U.scaleInPlace(L),U.convertIncidentRadianceToIrradiance(),U.convertIrradianceToLambertianRadiance(),Y.e.FromHarmonics(U)}}G._FileFaces=[new P("right",new I.DU(1,0,0),new I.DU(0,0,-1),new I.DU(0,-1,0)),new P("left",new I.DU(-1,0,0),new I.DU(0,0,1),new I.DU(0,-1,0)),new P("up",new I.DU(0,1,0),new I.DU(1,0,0),new I.DU(0,0,1)),new P("down",new I.DU(0,-1,0),new I.DU(1,0,0),new I.DU(0,0,-1)),new P("front",new I.DU(0,0,1),new I.DU(1,0,0),new I.DU(0,-1,0)),new P("back",new I.DU(0,0,-1),new I.DU(-1,0,0),new I.DU(0,-1,0))],G.MAX_HDRI_VALUE=4096,G.PRESERVE_CLAMPED_COLORS=!1},12635:(t,U,y)=>{y.r(U),y.d(U,{Dispose:()=>h,DumpData:()=>L,DumpDataAsync:()=>M,DumpFramebuffer:()=>G,DumpTools:()=>Q});var I=y(12505),r=y(12198),Y=y(12404),mt=y(12250);let X,P=null;async function G(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Y=arguments.length>5?arguments[5]:void 0,mt=arguments.length>6?arguments[6]:void 0;const X=await y.readPixels(0,0,t,U);L(t,U,new Uint8Array(X.buffer),I,r,Y,!0,void 0,mt)}async function M(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",r=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],mt=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7?arguments[7]:void 0;return await new Promise((P=>{L(t,U,y,(t=>P(t)),I,r,Y,mt,X)}))}function L(t,U,G,M){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Q=arguments.length>5?arguments[5]:void 0,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]&&arguments[7],w=arguments.length>8?arguments[8]:void 0;(async function(){return P||(P=new Promise(((t,U)=>{let r,Y=null;const P={o:!0,depth:!1,EX:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(y.bind(y,12543)).then((G=>{let{ThinEngine:M}=G;const L=mt.d.Instances.length;try{r=new OffscreenCanvas(100,100),Y=new M(r,!1,P)}catch(E){var Q;L<mt.d.Instances.length&&(null===(Q=mt.d.Instances.pop())||void 0===Q||Q.dispose()),r=document.createElement("canvas"),Y=new M(r,!1,P)}mt.d.Instances.pop(),mt.d.OnEnginesDisposedObservable.add((t=>{Y&&t!==Y&&!Y.G&&0===mt.d.Instances.length&&h()})),Y.getCaps().parallelShaderCompile=void 0;const F=new I.c(Y);y.e(52).then(y.bind(y,14647)).then((y=>{let{passPixelShader:mt}=y;if(!Y)return void U("Engine is not defined");const P=new I.f({wU:Y,name:mt.name,fragmentShader:mt.shader,samplerNames:["textureSampler"]});X={canvas:r,wU:Y,renderer:F,wrapper:P},t(X)}))})).catch(U)}))),await P})().then((y=>{if(y.wU.setSize(t,U,!0),G instanceof Float32Array){const t=new Uint8Array(G.length);let U=G.length;for(;U--;){const y=G[U];t[U]=Math.round(255*(0,Y.Clamp)(y))}G=t}const I=y.wU.createRawTexture(G,t,U,5,!1,!F,1);y.renderer.setViewport(),y.renderer.applyEffectWrapper(y.wrapper),y.wrapper.effect._bindTexture("textureSampler",I),y.renderer.draw(),E?r.Tools.ToBlob(y.canvas,(t=>{const U=new FileReader;U.onload=t=>{const U=t.target.result;M&&M(U)},U.readAsArrayBuffer(t)}),L,w):r.Tools.EncodeScreenshotCanvasData(y.canvas,M,L,Q,w),I.dispose()}))}function h(){var t;X?(X.wrapper.dispose(),X.renderer.dispose(),X.wU.dispose()):null===(t=P)||void 0===t||t.then((t=>{t.wrapper.dispose(),t.renderer.dispose(),t.wU.dispose()}));P=null,X=null}const Q={DumpData:L,DumpDataAsync:M,DumpFramebuffer:G,Dispose:h};r.Tools.DumpData=L,r.Tools.DumpDataAsync=M,r.Tools.DumpFramebuffer=G},12925:(t,U,y)=>{y.d(U,{c:()=>Y});var I=y(12501),r=y(12640);class Y{static ExpandRGBDTexture(t){const U=t._texture;if(!U||!t.isRGBD)return;const r=U.getEngine(),Y=r.getCaps(),mt=U.isReady;let X=!1;Y.textureHalfFloatRender&&Y.textureHalfFloatLinearFiltering?(X=!0,U.type=2):Y.textureFloatRender&&Y.textureFloatLinearFiltering&&(X=!0,U.type=1),X&&(U.isReady=!1,U._isRGBD=!1,U.invertY=!1);const P=async()=>{const Y=r.isWebGPU,mt=Y?1:0;U.isReady=!1,Y?await y.e(42).then(y.bind(y,15189)):await y.e(35).then(y.bind(y,15194));const X=new I.e("rgbdDecode","rgbdDecode",null,null,1,null,3,r,!1,void 0,U.type,void 0,null,!1,void 0,mt);X.externalTextureSamplerBinding=!0;const P=r.createRenderTargetTexture(U.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:U.samplingMode,type:U.type,format:5});X.onEffectCreatedObservable.addOnce((y=>{y.executeWhenCompiled((()=>{X.onApply=t=>{t._bindTexture("textureSampler",U),t.setFloat2("scale",1,1)},t.St().postProcessManager.directRender([X],P,!0),r.restoreDefaultFramebuffer(),r._releaseTexture(U),X&&X.dispose(),P._swapAndDie(U),U.isReady=!0}))}))};X&&(mt?P():t.onLoadObservable.addOnce(P))}static async EncodeTextureToRGBD(t,U){let I=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return U.getEngine().isWebGPU?await y.e(43).then(y.bind(y,15206)):await y.e(36).then(y.bind(y,15198)),await(0,r.c)("rgbdEncode",t,U,I,1,5)}}}}]);