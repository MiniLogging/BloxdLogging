"use strict";(self.dwifukwnts=self.dwifukwnts||[]).push([[20,21],{12138:(U,X,b)=>{var F=b(12140),E=b(11612);E.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(E.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=F.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((U=>{this._texture._sphericalPolynomial=U,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(U){this._texture&&(this._texture._sphericalPolynomial=U)},enumerable:!0,configurable:!0})},12140:(U,X,b)=>{b.d(X,{d:()=>p});var F=b(11593),E=b(11608),w=b(11774),Q=b(11597),z=b(11636);class q{constructor(U,X,b,F){this.name=U,this.worldAxisForNormal=X,this.worldAxisForFileX=b,this.worldAxisForFileY=F}}class p{static ConvertCubeMapTextureToSphericalPolynomial(U){var X;if(!U.isCube)return null;null===(X=U.fU())||void 0===X||X.getEngine().flushFramebuffer();const b=U.getSize().width,F=U.readPixels(0,void 0,void 0,!1),E=U.readPixels(1,void 0,void 0,!1);let w,Q;U.isRenderTarget?(w=U.readPixels(3,void 0,void 0,!1),Q=U.readPixels(2,void 0,void 0,!1)):(w=U.readPixels(2,void 0,void 0,!1),Q=U.readPixels(3,void 0,void 0,!1));const z=U.readPixels(4,void 0,void 0,!1),q=U.readPixels(5,void 0,void 0,!1),p=U.gammaSpace;let S=0;return 1!=U.textureType&&2!=U.textureType||(S=1),new Promise((U=>{Promise.all([E,F,w,Q,z,q]).then((X=>{let[F,E,w,Q,z,q]=X;const R={size:b,right:E,left:F,up:w,down:Q,front:z,back:q,format:5,type:S,gammaSpace:p};U(this.ConvertCubeMapToSphericalPolynomial(R))}))}))}static _AreaElement(U,X){return Math.atan2(U*X,Math.sqrt(U*U+X*X+1))}static ConvertCubeMapToSphericalPolynomial(U){const X=new w.b;let b=0;const F=2/U.size,q=F,p=.5*F,S=p-1;for(let w=0;w<6;w++){const R=this._FileFaces[w],n=U[R.name];let a=S;const J=5===U.format?4:3;for(let w=0;w<U.size;w++){let m=S;for(let q=0;q<U.size;q++){const S=R.worldAxisForFileX.scale(m).add(R.worldAxisForFileY.scale(a)).add(R.worldAxisForNormal);S.normalize();const x=this._AreaElement(m-p,a-p)-this._AreaElement(m-p,a+p)-this._AreaElement(m+p,a-p)+this._AreaElement(m+p,a+p);let I=n[w*U.size*J+q*J+0],O=n[w*U.size*J+q*J+1],N=n[w*U.size*J+q*J+2];isNaN(I)&&(I=0),isNaN(O)&&(O=0),isNaN(N)&&(N=0),0===U.type&&(I/=255,O/=255,N/=255),U.gammaSpace&&(I=Math.pow((0,E.Clamp)(I),Q.k),O=Math.pow((0,E.Clamp)(O),Q.k),N=Math.pow((0,E.Clamp)(N),Q.k));const u=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const U=Math.max(I,O,N);if(U>u){const X=u/U;I*=X,O*=X,N*=X}}else I=(0,E.Clamp)(I,0,u),O=(0,E.Clamp)(O,0,u),N=(0,E.Clamp)(N,0,u);const i=new z.NX(I,O,N);X.addLight(S,i,x),b+=x,m+=F}a+=q}}const R=6*(4*Math.PI)/6/b;return X.scaleInPlace(R),X.convertIncidentRadianceToIrradiance(),X.convertIrradianceToLambertianRadiance(),w.f.FromHarmonics(X)}}p._FileFaces=[new q("right",new F.JX(1,0,0),new F.JX(0,0,-1),new F.JX(0,-1,0)),new q("left",new F.JX(-1,0,0),new F.JX(0,0,1),new F.JX(0,-1,0)),new q("up",new F.JX(0,1,0),new F.JX(1,0,0),new F.JX(0,0,1)),new q("down",new F.JX(0,-1,0),new F.JX(1,0,0),new F.JX(0,0,-1)),new q("front",new F.JX(0,0,1),new F.JX(1,0,0),new F.JX(0,-1,0)),new q("back",new F.JX(0,0,-1),new F.JX(-1,0,0),new F.JX(0,-1,0))],p.MAX_HDRI_VALUE=4096,p.PRESERVE_CLAMPED_COLORS=!1},11815:(U,X,b)=>{b.r(X),b.d(X,{Dispose:()=>n,DumpData:()=>R,DumpDataAsync:()=>S,DumpFramebuffer:()=>p,DumpTools:()=>a});var F=b(11697),E=b(11385),w=b(11608),Q=b(11442);let z,q=null;async function p(U,X,b,F){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",w=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6?arguments[6]:void 0;const z=await b.readPixels(0,0,U,X);R(U,X,new Uint8Array(z.buffer),F,E,w,!0,void 0,Q)}async function S(U,X,b){let F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",E=arguments.length>4?arguments[4]:void 0,w=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7?arguments[7]:void 0;return await new Promise((q=>{R(U,X,b,(U=>q(U)),F,E,w,Q,z)}))}function R(U,X,p,S){let R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",a=arguments.length>5?arguments[5]:void 0,J=arguments.length>6&&void 0!==arguments[6]&&arguments[6],m=arguments.length>7&&void 0!==arguments[7]&&arguments[7],x=arguments.length>8?arguments[8]:void 0;(async function(){return q||(q=new Promise(((U,X)=>{let E,w=null;const q={Rb:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(b.bind(b,11726)).then((p=>{let{ThinEngine:S}=p;const R=Q.c.Instances.length;try{E=new OffscreenCanvas(100,100),w=new S(E,!1,q)}catch(m){var a;R<Q.c.Instances.length&&(null===(a=Q.c.Instances.pop())||void 0===a||a.dispose()),E=document.createElement("canvas"),w=new S(E,!1,q)}Q.c.Instances.pop(),Q.c.OnEnginesDisposedObservable.add((U=>{w&&U!==w&&!w.R&&0===Q.c.Instances.length&&n()})),w.getCaps().parallelShaderCompile=void 0;const J=new F.d(w);b.e(52).then(b.bind(b,14069)).then((b=>{let{passPixelShader:Q}=b;if(!w)return void X("Engine is not defined");const q=new F.f({aX:w,name:Q.name,fragmentShader:Q.shader,samplerNames:["textureSampler"]});z={canvas:E,aX:w,renderer:J,wrapper:q},U(z)}))})).catch(X)}))),await q})().then((b=>{if(b.aX.setSize(U,X,!0),p instanceof Float32Array){const U=new Uint8Array(p.length);let X=p.length;for(;X--;){const b=p[X];U[X]=Math.round(255*(0,w.Clamp)(b))}p=U}const F=b.aX.createRawTexture(p,U,X,5,!1,!J,1);b.renderer.setViewport(),b.renderer.applyEffectWrapper(b.wrapper),b.wrapper.effect._bindTexture("textureSampler",F),b.renderer.draw(),m?E.Tools.ToBlob(b.canvas,(U=>{const X=new FileReader;X.onload=U=>{const X=U.target.result;S&&S(X)},X.readAsArrayBuffer(U)}),R,x):E.Tools.EncodeScreenshotCanvasData(b.canvas,S,R,a,x),F.dispose()}))}function n(){var U;z?(z.wrapper.dispose(),z.renderer.dispose(),z.aX.dispose()):null===(U=q)||void 0===U||U.then((U=>{U.wrapper.dispose(),U.renderer.dispose(),U.aX.dispose()}));q=null,z=null}const a={DumpData:R,DumpDataAsync:S,DumpFramebuffer:p,Dispose:n};E.Tools.DumpData=R,E.Tools.DumpDataAsync=S,E.Tools.DumpFramebuffer=p},12128:(U,X,b)=>{b.d(X,{d:()=>w});var F=b(11688),E=b(11821);class w{static ExpandRGBDTexture(U){const X=U._texture;if(!X||!U.isRGBD)return;const E=X.getEngine(),w=E.getCaps(),Q=X.isReady;let z=!1;w.textureHalfFloatRender&&w.textureHalfFloatLinearFiltering?(z=!0,X.type=2):w.textureFloatRender&&w.textureFloatLinearFiltering&&(z=!0,X.type=1),z&&(X.isReady=!1,X._isRGBD=!1,X.invertY=!1);const q=async()=>{const w=E.isWebGPU,Q=w?1:0;X.isReady=!1,w?await b.e(42).then(b.bind(b,14658)):await b.e(35).then(b.bind(b,14660));const z=new F.b("rgbdDecode","rgbdDecode",null,null,1,null,3,E,!1,void 0,X.type,void 0,null,!1,void 0,Q);z.externalTextureSamplerBinding=!0;const q=E.createRenderTargetTexture(X.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:X.samplingMode,type:X.type,format:5});z.onEffectCreatedObservable.addOnce((b=>{b.executeWhenCompiled((()=>{z.onApply=U=>{U._bindTexture("textureSampler",X),U.setFloat2("scale",1,1)},U.fU().postProcessManager.directRender([z],q,!0),E.restoreDefaultFramebuffer(),E._releaseTexture(X),z&&z.dispose(),q._swapAndDie(X),X.isReady=!0}))}))};z&&(Q?q():U.onLoadObservable.addOnce(q))}static async EncodeTextureToRGBD(U,X){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return X.getEngine().isWebGPU?await b.e(43).then(b.bind(b,14670)):await b.e(36).then(b.bind(b,14664)),await(0,E.e)("rgbdEncode",U,X,F,1,5)}}}}]);