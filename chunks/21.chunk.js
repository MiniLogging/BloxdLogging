"use strict";(self.k9ivgwsw3f=self.k9ivgwsw3f||[]).push([[20,21],{13337:(Y,b,C)=>{var R=C(13345),q=C(12860);q.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(q.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=R.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((Y=>{this._texture._sphericalPolynomial=Y,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(Y){this._texture&&(this._texture._sphericalPolynomial=Y)},enumerable:!0,configurable:!0})},13345:(Y,b,C)=>{C.d(b,{c:()=>r});var R=C(12831),q=C(12852),A=C(13015),E=C(12837),B=C(12880);class g{constructor(Y,b,C,R){this.name=Y,this.worldAxisForNormal=b,this.worldAxisForFileX=C,this.worldAxisForFileY=R}}class r{static ConvertCubeMapTextureToSphericalPolynomial(Y){var b;if(!Y.isCube)return null;null===(b=Y.uY())||void 0===b||b.getEngine().flushFramebuffer();const C=Y.getSize().width,R=Y.readPixels(0,void 0,void 0,!1),q=Y.readPixels(1,void 0,void 0,!1);let A,E;Y.isRenderTarget?(A=Y.readPixels(3,void 0,void 0,!1),E=Y.readPixels(2,void 0,void 0,!1)):(A=Y.readPixels(2,void 0,void 0,!1),E=Y.readPixels(3,void 0,void 0,!1));const B=Y.readPixels(4,void 0,void 0,!1),g=Y.readPixels(5,void 0,void 0,!1),r=Y.gammaSpace;let O=0;return 1!=Y.textureType&&2!=Y.textureType||(O=1),new Promise((Y=>{Promise.all([q,R,A,E,B,g]).then((b=>{let[R,q,A,E,B,g]=b;const F={size:C,right:q,left:R,up:A,down:E,front:B,back:g,format:5,type:O,gammaSpace:r};Y(this.ConvertCubeMapToSphericalPolynomial(F))}))}))}static _AreaElement(Y,b){return Math.atan2(Y*b,Math.sqrt(Y*Y+b*b+1))}static ConvertCubeMapToSphericalPolynomial(Y){const b=new A.c;let C=0;const R=2/Y.size,g=R,r=.5*R,O=r-1;for(let A=0;A<6;A++){const F=this._FileFaces[A],y=Y[F.name];let S=O;const n=5===Y.format?4:3;for(let A=0;A<Y.size;A++){let t=O;for(let g=0;g<Y.size;g++){const O=F.worldAxisForFileX.scale(t).add(F.worldAxisForFileY.scale(S)).add(F.worldAxisForNormal);O.normalize();const I=this._AreaElement(t-r,S-r)-this._AreaElement(t-r,S+r)-this._AreaElement(t+r,S-r)+this._AreaElement(t+r,S+r);let w=y[A*Y.size*n+g*n+0],Q=y[A*Y.size*n+g*n+1],N=y[A*Y.size*n+g*n+2];isNaN(w)&&(w=0),isNaN(Q)&&(Q=0),isNaN(N)&&(N=0),0===Y.type&&(w/=255,Q/=255,N/=255),Y.gammaSpace&&(w=Math.pow((0,q.Clamp)(w),E.n),Q=Math.pow((0,q.Clamp)(Q),E.n),N=Math.pow((0,q.Clamp)(N),E.n));const p=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const Y=Math.max(w,Q,N);if(Y>p){const b=p/Y;w*=b,Q*=b,N*=b}}else w=(0,q.Clamp)(w,0,p),Q=(0,q.Clamp)(Q,0,p),N=(0,q.Clamp)(N,0,p);const mY=new B.rC(w,Q,N);b.addLight(O,mY,I),C+=I,t+=R}S+=g}}const F=6*(4*Math.PI)/6/C;return b.scaleInPlace(F),b.convertIncidentRadianceToIrradiance(),b.convertIrradianceToLambertianRadiance(),A.g.FromHarmonics(b)}}r._FileFaces=[new g("right",new R.AC(1,0,0),new R.AC(0,0,-1),new R.AC(0,-1,0)),new g("left",new R.AC(-1,0,0),new R.AC(0,0,1),new R.AC(0,-1,0)),new g("up",new R.AC(0,1,0),new R.AC(1,0,0),new R.AC(0,0,1)),new g("down",new R.AC(0,-1,0),new R.AC(1,0,0),new R.AC(0,0,-1)),new g("front",new R.AC(0,0,1),new R.AC(1,0,0),new R.AC(0,-1,0)),new g("back",new R.AC(0,0,-1),new R.AC(-1,0,0),new R.AC(0,-1,0))],r.MAX_HDRI_VALUE=4096,r.PRESERVE_CLAMPED_COLORS=!1},13053:(Y,b,C)=>{C.r(b),C.d(b,{Dispose:()=>y,DumpData:()=>F,DumpDataAsync:()=>O,DumpFramebuffer:()=>r,DumpTools:()=>S});var R=C(12929),q=C(12645),A=C(12852),E=C(12702);let B,g=null;async function r(Y,b,C,R){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",A=arguments.length>5?arguments[5]:void 0,E=arguments.length>6?arguments[6]:void 0;const B=await C.readPixels(0,0,Y,b);F(Y,b,new Uint8Array(B.buffer),R,q,A,!0,void 0,E)}async function O(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",q=arguments.length>4?arguments[4]:void 0,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7?arguments[7]:void 0;return await new Promise((g=>{F(Y,b,C,(Y=>g(Y)),R,q,A,E,B)}))}function F(Y,b,r,O){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",S=arguments.length>5?arguments[5]:void 0,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7&&void 0!==arguments[7]&&arguments[7],I=arguments.length>8?arguments[8]:void 0;(async function(){return g||(g=new Promise(((Y,b)=>{let q,A=null;const g={pb:!0,depth:!1,nb:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(C.bind(C,12963)).then((r=>{let{ThinEngine:O}=r;const F=E.d.Instances.length;try{q=new OffscreenCanvas(100,100),A=new O(q,!1,g)}catch(t){var S;F<E.d.Instances.length&&(null===(S=E.d.Instances.pop())||void 0===S||S.dispose()),q=document.createElement("canvas"),A=new O(q,!1,g)}E.d.Instances.pop(),E.d.OnEnginesDisposedObservable.add((Y=>{A&&Y!==A&&!A.O&&0===E.d.Instances.length&&y()})),A.getCaps().parallelShaderCompile=void 0;const n=new R.e(A);C.e(52).then(C.bind(C,15407)).then((C=>{let{passPixelShader:E}=C;if(!A)return void b("Engine is not defined");const g=new R.h({qC:A,name:E.name,fragmentShader:E.shader,samplerNames:["textureSampler"]});B={canvas:q,qC:A,renderer:n,wrapper:g},Y(B)}))})).catch(b)}))),await g})().then((C=>{if(C.qC.setSize(Y,b,!0),r instanceof Float32Array){const Y=new Uint8Array(r.length);let b=r.length;for(;b--;){const C=r[b];Y[b]=Math.round(255*(0,A.Clamp)(C))}r=Y}const R=C.qC.createRawTexture(r,Y,b,5,!1,!n,1);C.renderer.setViewport(),C.renderer.applyEffectWrapper(C.wrapper),C.wrapper.effect._bindTexture("textureSampler",R),C.renderer.draw(),t?q.Tools.ToBlob(C.canvas,(Y=>{const b=new FileReader;b.onload=Y=>{const b=Y.target.result;O&&O(b)},b.readAsArrayBuffer(Y)}),F,I):q.Tools.EncodeScreenshotCanvasData(C.canvas,O,F,S,I),R.dispose()}))}function y(){var Y;B?(B.wrapper.dispose(),B.renderer.dispose(),B.qC.dispose()):null===(Y=g)||void 0===Y||Y.then((Y=>{Y.wrapper.dispose(),Y.renderer.dispose(),Y.qC.dispose()}));g=null,B=null}const S={DumpData:F,DumpDataAsync:O,DumpFramebuffer:r,Dispose:y};q.Tools.DumpData=F,q.Tools.DumpDataAsync=O,q.Tools.DumpFramebuffer=r},13325:(Y,b,C)=>{C.d(b,{e:()=>A});var R=C(12924),q=C(13062);class A{static ExpandRGBDTexture(Y){const b=Y._texture;if(!b||!Y.isRGBD)return;const q=b.getEngine(),A=q.getCaps(),E=b.isReady;let B=!1;A.textureHalfFloatRender&&A.textureHalfFloatLinearFiltering?(B=!0,b.type=2):A.textureFloatRender&&A.textureFloatLinearFiltering&&(B=!0,b.type=1),B&&(b.isReady=!1,b._isRGBD=!1,b.invertY=!1);const g=async()=>{const A=q.isWebGPU,E=A?1:0;b.isReady=!1,A?await C.e(42).then(C.bind(C,15924)):await C.e(35).then(C.bind(C,15927));const B=new R.b("rgbdDecode","rgbdDecode",null,null,1,null,3,q,!1,void 0,b.type,void 0,null,!1,void 0,E);B.externalTextureSamplerBinding=!0;const g=q.createRenderTargetTexture(b.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:b.samplingMode,type:b.type,format:5});B.onEffectCreatedObservable.addOnce((C=>{C.executeWhenCompiled((()=>{B.onApply=Y=>{Y._bindTexture("textureSampler",b),Y.setFloat2("scale",1,1)},Y.uY().postProcessManager.directRender([B],g,!0),q.restoreDefaultFramebuffer(),q._releaseTexture(b),B&&B.dispose(),g._swapAndDie(b),b.isReady=!0}))}))};B&&(E?g():Y.onLoadObservable.addOnce(g))}static async EncodeTextureToRGBD(Y,b){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return b.getEngine().isWebGPU?await C.e(43).then(C.bind(C,15941)):await C.e(36).then(C.bind(C,15933)),await(0,q.e)("rgbdEncode",Y,b,R,1,5)}}}}]);