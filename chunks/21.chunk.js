"use strict";(self["3nlrbof8msu"]=self["3nlrbof8msu"]||[]).push([[20,21],{13245:(t,b,Z)=>{var J=Z(13253),S=Z(12748);S.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(S.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=J.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((t=>{this._texture._sphericalPolynomial=t,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(t){this._texture&&(this._texture._sphericalPolynomial=t)},enumerable:!0,configurable:!0})},13253:(t,b,Z)=>{Z.d(b,{e:()=>Y});var J=Z(12735),S=Z(12745),P=Z(12923),v=Z(12737),h=Z(12775);class C{constructor(t,b,Z,J){this.name=t,this.worldAxisForNormal=b,this.worldAxisForFileX=Z,this.worldAxisForFileY=J}}class Y{static ConvertCubeMapTextureToSphericalPolynomial(t){var b;if(!t.isCube)return null;null===(b=t.et())||void 0===b||b.getEngine().flushFramebuffer();const Z=t.getSize().width,J=t.readPixels(0,void 0,void 0,!1),S=t.readPixels(1,void 0,void 0,!1);let P,v;t.isRenderTarget?(P=t.readPixels(3,void 0,void 0,!1),v=t.readPixels(2,void 0,void 0,!1)):(P=t.readPixels(2,void 0,void 0,!1),v=t.readPixels(3,void 0,void 0,!1));const h=t.readPixels(4,void 0,void 0,!1),C=t.readPixels(5,void 0,void 0,!1),Y=t.gammaSpace;let g=0;return 1!=t.textureType&&2!=t.textureType||(g=1),new Promise((t=>{Promise.all([S,J,P,v,h,C]).then((b=>{let[J,S,P,v,h,C]=b;const I={size:Z,right:S,left:J,up:P,down:v,front:h,back:C,format:5,type:g,gammaSpace:Y};t(this.ConvertCubeMapToSphericalPolynomial(I))}))}))}static _AreaElement(t,b){return Math.atan2(t*b,Math.sqrt(t*t+b*b+1))}static ConvertCubeMapToSphericalPolynomial(t){const b=new P.e;let Z=0;const J=2/t.size,C=J,Y=.5*J,g=Y-1;for(let P=0;P<6;P++){const I=this._FileFaces[P],r=t[I.name];let M=g;const T=5===t.format?4:3;for(let P=0;P<t.size;P++){let a=g;for(let C=0;C<t.size;C++){const g=I.worldAxisForFileX.scale(a).add(I.worldAxisForFileY.scale(M)).add(I.worldAxisForNormal);g.normalize();const k=this._AreaElement(a-Y,M-Y)-this._AreaElement(a-Y,M+Y)-this._AreaElement(a+Y,M-Y)+this._AreaElement(a+Y,M+Y);let u=r[P*t.size*T+C*T+0],l=r[P*t.size*T+C*T+1],U=r[P*t.size*T+C*T+2];isNaN(u)&&(u=0),isNaN(l)&&(l=0),isNaN(U)&&(U=0),0===t.type&&(u/=255,l/=255,U/=255),t.gammaSpace&&(u=Math.pow((0,S.Clamp)(u),v.m),l=Math.pow((0,S.Clamp)(l),v.m),U=Math.pow((0,S.Clamp)(U),v.m));const E=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const t=Math.max(u,l,U);if(t>E){const b=E/t;u*=b,l*=b,U*=b}}else u=(0,S.Clamp)(u,0,E),l=(0,S.Clamp)(l,0,E),U=(0,S.Clamp)(U,0,E);const c=new h.hZ(u,l,U);b.addLight(g,c,k),Z+=k,a+=J}M+=C}}const I=6*(4*Math.PI)/6/Z;return b.scaleInPlace(I),b.convertIncidentRadianceToIrradiance(),b.convertIrradianceToLambertianRadiance(),P.f.FromHarmonics(b)}}Y._FileFaces=[new C("right",new J.JZ(1,0,0),new J.JZ(0,0,-1),new J.JZ(0,-1,0)),new C("left",new J.JZ(-1,0,0),new J.JZ(0,0,1),new J.JZ(0,-1,0)),new C("up",new J.JZ(0,1,0),new J.JZ(1,0,0),new J.JZ(0,0,1)),new C("down",new J.JZ(0,-1,0),new J.JZ(1,0,0),new J.JZ(0,0,-1)),new C("front",new J.JZ(0,0,1),new J.JZ(1,0,0),new J.JZ(0,-1,0)),new C("back",new J.JZ(0,0,-1),new J.JZ(-1,0,0),new J.JZ(0,-1,0))],Y.MAX_HDRI_VALUE=4096,Y.PRESERVE_CLAMPED_COLORS=!1},12955:(t,b,Z)=>{Z.r(b),Z.d(b,{Dispose:()=>r,DumpData:()=>I,DumpDataAsync:()=>g,DumpFramebuffer:()=>Y,DumpTools:()=>M});var J=Z(12838),S=Z(12549),P=Z(12745),v=Z(12585);let h,C=null;async function Y(t,b,Z,J){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",P=arguments.length>5?arguments[5]:void 0,v=arguments.length>6?arguments[6]:void 0;const h=await Z.readPixels(0,0,t,b);I(t,b,new Uint8Array(h.buffer),J,S,P,!0,void 0,v)}async function g(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",S=arguments.length>4?arguments[4]:void 0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7?arguments[7]:void 0;return await new Promise((C=>{I(t,b,Z,(t=>C(t)),J,S,P,v,h)}))}function I(t,b,Y,g){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",M=arguments.length>5?arguments[5]:void 0,T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],k=arguments.length>8?arguments[8]:void 0;(async function(){return C||(C=new Promise(((t,b)=>{let S,P=null;const C={o:!0,depth:!1,Ub:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(Z.bind(Z,12866)).then((Y=>{let{ThinEngine:g}=Y;const I=v.e.Instances.length;try{S=new OffscreenCanvas(100,100),P=new g(S,!1,C)}catch(a){var M;I<v.e.Instances.length&&(null===(M=v.e.Instances.pop())||void 0===M||M.dispose()),S=document.createElement("canvas"),P=new g(S,!1,C)}v.e.Instances.pop(),v.e.OnEnginesDisposedObservable.add((t=>{P&&t!==P&&!P.h&&0===v.e.Instances.length&&r()})),P.getCaps().parallelShaderCompile=void 0;const T=new J.b(P);Z.e(52).then(Z.bind(Z,15205)).then((Z=>{let{passPixelShader:v}=Z;if(!P)return void b("Engine is not defined");const C=new J.d({ZZ:P,name:v.name,fragmentShader:v.shader,samplerNames:["textureSampler"]});h={canvas:S,ZZ:P,renderer:T,wrapper:C},t(h)}))})).catch(b)}))),await C})().then((Z=>{if(Z.ZZ.setSize(t,b,!0),Y instanceof Float32Array){const t=new Uint8Array(Y.length);let b=Y.length;for(;b--;){const Z=Y[b];t[b]=Math.round(255*(0,P.Clamp)(Z))}Y=t}const J=Z.ZZ.createRawTexture(Y,t,b,5,!1,!T,1);Z.renderer.setViewport(),Z.renderer.applyEffectWrapper(Z.wrapper),Z.wrapper.effect._bindTexture("textureSampler",J),Z.renderer.draw(),a?S.Tools.ToBlob(Z.canvas,(t=>{const b=new FileReader;b.onload=t=>{const b=t.target.result;g&&g(b)},b.readAsArrayBuffer(t)}),I,k):S.Tools.EncodeScreenshotCanvasData(Z.canvas,g,I,M,k),J.dispose()}))}function r(){var t;h?(h.wrapper.dispose(),h.renderer.dispose(),h.ZZ.dispose()):null===(t=C)||void 0===t||t.then((t=>{t.wrapper.dispose(),t.renderer.dispose(),t.ZZ.dispose()}));C=null,h=null}const M={DumpData:I,DumpDataAsync:g,DumpFramebuffer:Y,Dispose:r};S.Tools.DumpData=I,S.Tools.DumpDataAsync=g,S.Tools.DumpFramebuffer=Y},13234:(t,b,Z)=>{Z.d(b,{c:()=>P});var J=Z(12829),S=Z(12964);class P{static ExpandRGBDTexture(t){const b=t._texture;if(!b||!t.isRGBD)return;const S=b.getEngine(),P=S.getCaps(),v=b.isReady;let h=!1;P.textureHalfFloatRender&&P.textureHalfFloatLinearFiltering?(h=!0,b.type=2):P.textureFloatRender&&P.textureFloatLinearFiltering&&(h=!0,b.type=1),h&&(b.isReady=!1,b._isRGBD=!1,b.invertY=!1);const C=async()=>{const P=S.isWebGPU,v=P?1:0;b.isReady=!1,P?await Z.e(42).then(Z.bind(Z,15773)):await Z.e(35).then(Z.bind(Z,15780));const h=new J.c("rgbdDecode","rgbdDecode",null,null,1,null,3,S,!1,void 0,b.type,void 0,null,!1,void 0,v);h.externalTextureSamplerBinding=!0;const C=S.createRenderTargetTexture(b.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:b.samplingMode,type:b.type,format:5});h.onEffectCreatedObservable.addOnce((Z=>{Z.executeWhenCompiled((()=>{h.onApply=t=>{t._bindTexture("textureSampler",b),t.setFloat2("scale",1,1)},t.et().postProcessManager.directRender([h],C,!0),S.restoreDefaultFramebuffer(),S._releaseTexture(b),h&&h.dispose(),C._swapAndDie(b),b.isReady=!0}))}))};h&&(v?C():t.onLoadObservable.addOnce(C))}static async EncodeTextureToRGBD(t,b){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return b.getEngine().isWebGPU?await Z.e(43).then(Z.bind(Z,15794)):await Z.e(36).then(Z.bind(Z,15785)),await(0,S.c)("rgbdEncode",t,b,J,1,5)}}}}]);