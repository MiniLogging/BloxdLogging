"use strict";(self.xeuzlpp225k=self.xeuzlpp225k||[]).push([[20,21],{11789:(k,Q,i)=>{var Z=i(11797),U=i(11320);U.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(U.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=Z.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((k=>{this._texture._sphericalPolynomial=k,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(k){this._texture&&(this._texture._sphericalPolynomial=k)},enumerable:!0,configurable:!0})},11797:(k,Q,i)=>{i.d(Q,{c:()=>O});var Z=i(11298),U=i(11311),C=i(11481),B=i(11304),o=i(11348);class m{constructor(k,Q,i,Z){this.name=k,this.worldAxisForNormal=Q,this.worldAxisForFileX=i,this.worldAxisForFileY=Z}}class O{static ConvertCubeMapTextureToSphericalPolynomial(k){var Q;if(!k.isCube)return null;null===(Q=k.sk())||void 0===Q||Q.getEngine().flushFramebuffer();const i=k.getSize().width,Z=k.readPixels(0,void 0,void 0,!1),U=k.readPixels(1,void 0,void 0,!1);let C,B;k.isRenderTarget?(C=k.readPixels(3,void 0,void 0,!1),B=k.readPixels(2,void 0,void 0,!1)):(C=k.readPixels(2,void 0,void 0,!1),B=k.readPixels(3,void 0,void 0,!1));const o=k.readPixels(4,void 0,void 0,!1),m=k.readPixels(5,void 0,void 0,!1),O=k.gammaSpace;let J=0;return 1!=k.textureType&&2!=k.textureType||(J=1),new Promise((k=>{Promise.all([U,Z,C,B,o,m]).then((Q=>{let[Z,U,C,B,o,m]=Q;const G={size:i,right:U,left:Z,up:C,down:B,front:o,back:m,format:5,type:J,gammaSpace:O};k(this.ConvertCubeMapToSphericalPolynomial(G))}))}))}static _AreaElement(k,Q){return Math.atan2(k*Q,Math.sqrt(k*k+Q*Q+1))}static ConvertCubeMapToSphericalPolynomial(k){const Q=new C.d;let i=0;const Z=2/k.size,m=Z,O=.5*Z,J=O-1;for(let C=0;C<6;C++){const G=this._FileFaces[C],H=k[G.name];let e=J;const F=5===k.format?4:3;for(let C=0;C<k.size;C++){let z=J;for(let m=0;m<k.size;m++){const J=G.worldAxisForFileX.scale(z).add(G.worldAxisForFileY.scale(e)).add(G.worldAxisForNormal);J.normalize();const E=this._AreaElement(z-O,e-O)-this._AreaElement(z-O,e+O)-this._AreaElement(z+O,e-O)+this._AreaElement(z+O,e+O);let l=H[C*k.size*F+m*F+0],h=H[C*k.size*F+m*F+1],c=H[C*k.size*F+m*F+2];isNaN(l)&&(l=0),isNaN(h)&&(h=0),isNaN(c)&&(c=0),0===k.type&&(l/=255,h/=255,c/=255),k.gammaSpace&&(l=Math.pow((0,U.Clamp)(l),B.m),h=Math.pow((0,U.Clamp)(h),B.m),c=Math.pow((0,U.Clamp)(c),B.m));const f=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const k=Math.max(l,h,c);if(k>f){const Q=f/k;l*=Q,h*=Q,c*=Q}}else l=(0,U.Clamp)(l,0,f),h=(0,U.Clamp)(h,0,f),c=(0,U.Clamp)(c,0,f);const Y=new o.cQ(l,h,c);Q.addLight(J,Y,E),i+=E,z+=Z}e+=m}}const G=6*(4*Math.PI)/6/i;return Q.scaleInPlace(G),Q.convertIncidentRadianceToIrradiance(),Q.convertIrradianceToLambertianRadiance(),C.h.FromHarmonics(Q)}}O._FileFaces=[new m("right",new Z.zQ(1,0,0),new Z.zQ(0,0,-1),new Z.zQ(0,-1,0)),new m("left",new Z.zQ(-1,0,0),new Z.zQ(0,0,1),new Z.zQ(0,-1,0)),new m("up",new Z.zQ(0,1,0),new Z.zQ(1,0,0),new Z.zQ(0,0,1)),new m("down",new Z.zQ(0,-1,0),new Z.zQ(1,0,0),new Z.zQ(0,0,-1)),new m("front",new Z.zQ(0,0,1),new Z.zQ(1,0,0),new Z.zQ(0,-1,0)),new m("back",new Z.zQ(0,0,-1),new Z.zQ(-1,0,0),new Z.zQ(0,-1,0))],O.MAX_HDRI_VALUE=4096,O.PRESERVE_CLAMPED_COLORS=!1},11522:(k,Q,i)=>{i.r(Q),i.d(Q,{Dispose:()=>H,DumpData:()=>G,DumpDataAsync:()=>J,DumpFramebuffer:()=>O,DumpTools:()=>e});var Z=i(11406),U=i(11119),C=i(11311),B=i(11157);let o,m=null;async function O(k,Q,i,Z){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",C=arguments.length>5?arguments[5]:void 0,B=arguments.length>6?arguments[6]:void 0;const o=await i.readPixels(0,0,k,Q);G(k,Q,new Uint8Array(o.buffer),Z,U,C,!0,void 0,B)}async function J(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",U=arguments.length>4?arguments[4]:void 0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7?arguments[7]:void 0;return await new Promise((m=>{G(k,Q,i,(k=>m(k)),Z,U,C,B,o)}))}function G(k,Q,O,J){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",e=arguments.length>5?arguments[5]:void 0,F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],E=arguments.length>8?arguments[8]:void 0;(async function(){return m||(m=new Promise(((k,Q)=>{let U,C=null;const m={ko:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(i.bind(i,11434)).then((O=>{let{ThinEngine:J}=O;const G=B.b.Instances.length;try{U=new OffscreenCanvas(100,100),C=new J(U,!1,m)}catch(z){var e;G<B.b.Instances.length&&(null===(e=B.b.Instances.pop())||void 0===e||e.dispose()),U=document.createElement("canvas"),C=new J(U,!1,m)}B.b.Instances.pop(),B.b.OnEnginesDisposedObservable.add((k=>{C&&k!==C&&!C.J&&0===B.b.Instances.length&&H()})),C.getCaps().parallelShaderCompile=void 0;const F=new Z.d(C);i.e(52).then(i.bind(i,13852)).then((i=>{let{passPixelShader:B}=i;if(!C)return void Q("Engine is not defined");const m=new Z.g({FQ:C,name:B.name,fragmentShader:B.shader,samplerNames:["textureSampler"]});o={canvas:U,FQ:C,renderer:F,wrapper:m},k(o)}))})).catch(Q)}))),await m})().then((i=>{if(i.FQ.setSize(k,Q,!0),O instanceof Float32Array){const k=new Uint8Array(O.length);let Q=O.length;for(;Q--;){const i=O[Q];k[Q]=Math.round(255*(0,C.Clamp)(i))}O=k}const Z=i.FQ.createRawTexture(O,k,Q,5,!1,!F,1);i.renderer.setViewport(),i.renderer.applyEffectWrapper(i.wrapper),i.wrapper.effect._bindTexture("textureSampler",Z),i.renderer.draw(),z?U.Tools.ToBlob(i.canvas,(k=>{const Q=new FileReader;Q.onload=k=>{const Q=k.target.result;J&&J(Q)},Q.readAsArrayBuffer(k)}),G,E):U.Tools.EncodeScreenshotCanvasData(i.canvas,J,G,e,E),Z.dispose()}))}function H(){var k;o?(o.wrapper.dispose(),o.renderer.dispose(),o.FQ.dispose()):null===(k=m)||void 0===k||k.then((k=>{k.wrapper.dispose(),k.renderer.dispose(),k.FQ.dispose()}));m=null,o=null}const e={DumpData:G,DumpDataAsync:J,DumpFramebuffer:O,Dispose:H};U.Tools.DumpData=G,U.Tools.DumpDataAsync=J,U.Tools.DumpFramebuffer=O},11781:(k,Q,i)=>{i.d(Q,{c:()=>C});var Z=i(11400),U=i(11529);class C{static ExpandRGBDTexture(k){const Q=k._texture;if(!Q||!k.isRGBD)return;const U=Q.getEngine(),C=U.getCaps(),B=Q.isReady;let o=!1;C.textureHalfFloatRender&&C.textureHalfFloatLinearFiltering?(o=!0,Q.type=2):C.textureFloatRender&&C.textureFloatLinearFiltering&&(o=!0,Q.type=1),o&&(Q.isReady=!1,Q._isRGBD=!1,Q.invertY=!1);const m=async()=>{const C=U.isWebGPU,B=C?1:0;Q.isReady=!1,C?await i.e(42).then(i.bind(i,14358)):await i.e(35).then(i.bind(i,14365));const o=new Z.c("rgbdDecode","rgbdDecode",null,null,1,null,3,U,!1,void 0,Q.type,void 0,null,!1,void 0,B);o.externalTextureSamplerBinding=!0;const m=U.createRenderTargetTexture(Q.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:Q.samplingMode,type:Q.type,format:5});o.onEffectCreatedObservable.addOnce((i=>{i.executeWhenCompiled((()=>{o.onApply=k=>{k._bindTexture("textureSampler",Q),k.setFloat2("scale",1,1)},k.sk().postProcessManager.directRender([o],m,!0),U.restoreDefaultFramebuffer(),U._releaseTexture(Q),o&&o.dispose(),m._swapAndDie(Q),Q.isReady=!0}))}))};o&&(B?m():k.onLoadObservable.addOnce(m))}static async EncodeTextureToRGBD(k,Q){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Q.getEngine().isWebGPU?await i.e(43).then(i.bind(i,14378)):await i.e(36).then(i.bind(i,14373)),await(0,U.d)("rgbdEncode",k,Q,Z,1,5)}}}}]);