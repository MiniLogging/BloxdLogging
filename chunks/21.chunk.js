"use strict";(self.jr1pmf6bwuf=self.jr1pmf6bwuf||[]).push([[20,21],{13386:(Y,c,h)=>{var C=h(13388),E=h(12890);E.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(E.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=C.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((Y=>{this._texture._sphericalPolynomial=Y,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(Y){this._texture&&(this._texture._sphericalPolynomial=Y)},enumerable:!0,configurable:!0})},13388:(Y,c,h)=>{h.d(c,{e:()=>w});var C=h(12869),E=h(12883),N=h(13068),Q=h(12874),b=h(12920);class H{constructor(Y,c,h,C){this.name=Y,this.worldAxisForNormal=c,this.worldAxisForFileX=h,this.worldAxisForFileY=C}}class w{static ConvertCubeMapTextureToSphericalPolynomial(Y){var c;if(!Y.isCube)return null;null===(c=Y.ZY())||void 0===c||c.getEngine().flushFramebuffer();const h=Y.getSize().width,C=Y.readPixels(0,void 0,void 0,!1),E=Y.readPixels(1,void 0,void 0,!1);let N,Q;Y.isRenderTarget?(N=Y.readPixels(3,void 0,void 0,!1),Q=Y.readPixels(2,void 0,void 0,!1)):(N=Y.readPixels(2,void 0,void 0,!1),Q=Y.readPixels(3,void 0,void 0,!1));const b=Y.readPixels(4,void 0,void 0,!1),H=Y.readPixels(5,void 0,void 0,!1),w=Y.gammaSpace;let W=0;return 1!=Y.textureType&&2!=Y.textureType||(W=1),new Promise((Y=>{Promise.all([E,C,N,Q,b,H]).then((c=>{let[C,E,N,Q,b,H]=c;const q={size:h,right:E,left:C,up:N,down:Q,front:b,back:H,format:5,type:W,gammaSpace:w};Y(this.ConvertCubeMapToSphericalPolynomial(q))}))}))}static _AreaElement(Y,c){return Math.atan2(Y*c,Math.sqrt(Y*Y+c*c+1))}static ConvertCubeMapToSphericalPolynomial(Y){const c=new N.e;let h=0;const C=2/Y.size,H=C,w=.5*C,W=w-1;for(let N=0;N<6;N++){const q=this._FileFaces[N],k=Y[q.name];let M=W;const p=5===Y.format?4:3;for(let N=0;N<Y.size;N++){let P=W;for(let H=0;H<Y.size;H++){const W=q.worldAxisForFileX.scale(P).add(q.worldAxisForFileY.scale(M)).add(q.worldAxisForNormal);W.normalize();const y=this._AreaElement(P-w,M-w)-this._AreaElement(P-w,M+w)-this._AreaElement(P+w,M-w)+this._AreaElement(P+w,M+w);let d=k[N*Y.size*p+H*p+0],D=k[N*Y.size*p+H*p+1],T=k[N*Y.size*p+H*p+2];isNaN(d)&&(d=0),isNaN(D)&&(D=0),isNaN(T)&&(T=0),0===Y.type&&(d/=255,D/=255,T/=255),Y.gammaSpace&&(d=Math.pow((0,E.Clamp)(d),Q.l),D=Math.pow((0,E.Clamp)(D),Q.l),T=Math.pow((0,E.Clamp)(T),Q.l));const e=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const Y=Math.max(d,D,T);if(Y>e){const c=e/Y;d*=c,D*=c,T*=c}}else d=(0,E.Clamp)(d,0,e),D=(0,E.Clamp)(D,0,e),T=(0,E.Clamp)(T,0,e);const r=new b.ph(d,D,T);c.addLight(W,r,y),h+=y,P+=C}M+=H}}const q=6*(4*Math.PI)/6/h;return c.scaleInPlace(q),c.convertIncidentRadianceToIrradiance(),c.convertIrradianceToLambertianRadiance(),N.f.FromHarmonics(c)}}w._FileFaces=[new H("right",new C.bh(1,0,0),new C.bh(0,0,-1),new C.bh(0,-1,0)),new H("left",new C.bh(-1,0,0),new C.bh(0,0,1),new C.bh(0,-1,0)),new H("up",new C.bh(0,1,0),new C.bh(1,0,0),new C.bh(0,0,1)),new H("down",new C.bh(0,-1,0),new C.bh(1,0,0),new C.bh(0,0,-1)),new H("front",new C.bh(0,0,1),new C.bh(1,0,0),new C.bh(0,-1,0)),new H("back",new C.bh(0,0,-1),new C.bh(-1,0,0),new C.bh(0,-1,0))],w.MAX_HDRI_VALUE=4096,w.PRESERVE_CLAMPED_COLORS=!1},13097:(Y,c,h)=>{h.r(c),h.d(c,{Dispose:()=>k,DumpData:()=>q,DumpDataAsync:()=>W,DumpFramebuffer:()=>w,DumpTools:()=>M});var C=h(12986),E=h(12687),N=h(12883),Q=h(12722);let b,H=null;async function w(Y,c,h,C){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",N=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6?arguments[6]:void 0;const b=await h.readPixels(0,0,Y,c);q(Y,c,new Uint8Array(b.buffer),C,E,N,!0,void 0,Q)}async function W(Y,c,h){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",E=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7?arguments[7]:void 0;return await new Promise((H=>{q(Y,c,h,(Y=>H(Y)),C,E,N,Q,b)}))}function q(Y,c,w,W){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",M=arguments.length>5?arguments[5]:void 0,p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7&&void 0!==arguments[7]&&arguments[7],y=arguments.length>8?arguments[8]:void 0;(async function(){return H||(H=new Promise(((Y,c)=>{let E,N=null;const H={Tc:!0,depth:!1,Pc:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(h.bind(h,13010)).then((w=>{let{ThinEngine:W}=w;const q=Q.d.Instances.length;try{E=new OffscreenCanvas(100,100),N=new W(E,!1,H)}catch(P){var M;q<Q.d.Instances.length&&(null===(M=Q.d.Instances.pop())||void 0===M||M.dispose()),E=document.createElement("canvas"),N=new W(E,!1,H)}Q.d.Instances.pop(),Q.d.OnEnginesDisposedObservable.add((Y=>{N&&Y!==N&&!N.q&&0===Q.d.Instances.length&&k()})),N.getCaps().parallelShaderCompile=void 0;const p=new C.b(N);h.e(52).then(h.bind(h,15450)).then((h=>{let{passPixelShader:Q}=h;if(!N)return void c("Engine is not defined");const H=new C.f({Qh:N,name:Q.name,fragmentShader:Q.shader,samplerNames:["textureSampler"]});b={canvas:E,Qh:N,renderer:p,wrapper:H},Y(b)}))})).catch(c)}))),await H})().then((h=>{if(h.Qh.setSize(Y,c,!0),w instanceof Float32Array){const Y=new Uint8Array(w.length);let c=w.length;for(;c--;){const h=w[c];Y[c]=Math.round(255*(0,N.Clamp)(h))}w=Y}const C=h.Qh.createRawTexture(w,Y,c,5,!1,!p,1);h.renderer.setViewport(),h.renderer.applyEffectWrapper(h.wrapper),h.wrapper.effect._bindTexture("textureSampler",C),h.renderer.draw(),P?E.Tools.ToBlob(h.canvas,(Y=>{const c=new FileReader;c.onload=Y=>{const c=Y.target.result;W&&W(c)},c.readAsArrayBuffer(Y)}),q,y):E.Tools.EncodeScreenshotCanvasData(h.canvas,W,q,M,y),C.dispose()}))}function k(){var Y;b?(b.wrapper.dispose(),b.renderer.dispose(),b.Qh.dispose()):null===(Y=H)||void 0===Y||Y.then((Y=>{Y.wrapper.dispose(),Y.renderer.dispose(),Y.Qh.dispose()}));H=null,b=null}const M={DumpData:q,DumpDataAsync:W,DumpFramebuffer:w,Dispose:k};E.Tools.DumpData=q,E.Tools.DumpDataAsync=W,E.Tools.DumpFramebuffer=w},13370:(Y,c,h)=>{h.d(c,{d:()=>N});var C=h(12980),E=h(13102);class N{static ExpandRGBDTexture(Y){const c=Y._texture;if(!c||!Y.isRGBD)return;const E=c.getEngine(),N=E.getCaps(),Q=c.isReady;let b=!1;N.textureHalfFloatRender&&N.textureHalfFloatLinearFiltering?(b=!0,c.type=2):N.textureFloatRender&&N.textureFloatLinearFiltering&&(b=!0,c.type=1),b&&(c.isReady=!1,c._isRGBD=!1,c.invertY=!1);const H=async()=>{const N=E.isWebGPU,Q=N?1:0;c.isReady=!1,N?await h.e(42).then(h.bind(h,16020)):await h.e(35).then(h.bind(h,16025));const b=new C.c("rgbdDecode","rgbdDecode",null,null,1,null,3,E,!1,void 0,c.type,void 0,null,!1,void 0,Q);b.externalTextureSamplerBinding=!0;const H=E.createRenderTargetTexture(c.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:c.samplingMode,type:c.type,format:5});b.onEffectCreatedObservable.addOnce((h=>{h.executeWhenCompiled((()=>{b.onApply=Y=>{Y._bindTexture("textureSampler",c),Y.setFloat2("scale",1,1)},Y.ZY().postProcessManager.directRender([b],H,!0),E.restoreDefaultFramebuffer(),E._releaseTexture(c),b&&b.dispose(),H._swapAndDie(c),c.isReady=!0}))}))};b&&(Q?H():Y.onLoadObservable.addOnce(H))}static async EncodeTextureToRGBD(Y,c){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return c.getEngine().isWebGPU?await h.e(43).then(h.bind(h,16031)):await h.e(36).then(h.bind(h,16029)),await(0,E.e)("rgbdEncode",Y,c,C,1,5)}}}}]);