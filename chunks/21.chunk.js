"use strict";(self.ufnpnb83drd=self.ufnpnb83drd||[]).push([[20,21],{12844:(E,U,g)=>{var N=g(12847),L=g(12355);L.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(L.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=N.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((E=>{this._texture._sphericalPolynomial=E,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(E){this._texture&&(this._texture._sphericalPolynomial=E)},enumerable:!0,configurable:!0})},12847:(E,U,g)=>{g.d(U,{d:()=>C});var N=g(12334),L=g(12353),D=g(12527),S=g(12336),u=g(12379);class s{constructor(E,U,g,N){this.name=E,this.worldAxisForNormal=U,this.worldAxisForFileX=g,this.worldAxisForFileY=N}}class C{static ConvertCubeMapTextureToSphericalPolynomial(E){var U;if(!E.isCube)return null;null===(U=E.tE())||void 0===U||U.getEngine().flushFramebuffer();const g=E.getSize().width,N=E.readPixels(0,void 0,void 0,!1),L=E.readPixels(1,void 0,void 0,!1);let D,S;E.isRenderTarget?(D=E.readPixels(3,void 0,void 0,!1),S=E.readPixels(2,void 0,void 0,!1)):(D=E.readPixels(2,void 0,void 0,!1),S=E.readPixels(3,void 0,void 0,!1));const u=E.readPixels(4,void 0,void 0,!1),s=E.readPixels(5,void 0,void 0,!1),C=E.gammaSpace;let B=0;return 1!=E.textureType&&2!=E.textureType||(B=1),new Promise((E=>{Promise.all([L,N,D,S,u,s]).then((U=>{let[N,L,D,S,u,s]=U;const P={size:g,right:L,left:N,up:D,down:S,front:u,back:s,format:5,type:B,gammaSpace:C};E(this.ConvertCubeMapToSphericalPolynomial(P))}))}))}static _AreaElement(E,U){return Math.atan2(E*U,Math.sqrt(E*E+U*U+1))}static ConvertCubeMapToSphericalPolynomial(E){const U=new D.c;let g=0;const N=2/E.size,s=N,C=.5*N,B=C-1;for(let D=0;D<6;D++){const P=this._FileFaces[D],F=E[P.name];let f=B;const d=5===E.format?4:3;for(let D=0;D<E.size;D++){let I=B;for(let s=0;s<E.size;s++){const B=P.worldAxisForFileX.scale(I).add(P.worldAxisForFileY.scale(f)).add(P.worldAxisForNormal);B.normalize();const y=this._AreaElement(I-C,f-C)-this._AreaElement(I-C,f+C)-this._AreaElement(I+C,f-C)+this._AreaElement(I+C,f+C);let h=F[D*E.size*d+s*d+0],V=F[D*E.size*d+s*d+1],e=F[D*E.size*d+s*d+2];isNaN(h)&&(h=0),isNaN(V)&&(V=0),isNaN(e)&&(e=0),0===E.type&&(h/=255,V/=255,e/=255),E.gammaSpace&&(h=Math.pow((0,L.Clamp)(h),S.i),V=Math.pow((0,L.Clamp)(V),S.i),e=Math.pow((0,L.Clamp)(e),S.i));const x=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const E=Math.max(h,V,e);if(E>x){const U=x/E;h*=U,V*=U,e*=U}}else h=(0,L.Clamp)(h,0,x),V=(0,L.Clamp)(V,0,x),e=(0,L.Clamp)(e,0,x);const l=new u.VU(h,V,e);U.addLight(B,l,y),g+=y,I+=N}f+=s}}const P=6*(4*Math.PI)/6/g;return U.scaleInPlace(P),U.convertIncidentRadianceToIrradiance(),U.convertIrradianceToLambertianRadiance(),D.f.FromHarmonics(U)}}C._FileFaces=[new s("right",new N.dU(1,0,0),new N.dU(0,0,-1),new N.dU(0,-1,0)),new s("left",new N.dU(-1,0,0),new N.dU(0,0,1),new N.dU(0,-1,0)),new s("up",new N.dU(0,1,0),new N.dU(1,0,0),new N.dU(0,0,1)),new s("down",new N.dU(0,-1,0),new N.dU(1,0,0),new N.dU(0,0,-1)),new s("front",new N.dU(0,0,1),new N.dU(1,0,0),new N.dU(0,-1,0)),new s("back",new N.dU(0,0,-1),new N.dU(-1,0,0),new N.dU(0,-1,0))],C.MAX_HDRI_VALUE=4096,C.PRESERVE_CLAMPED_COLORS=!1},12554:(E,U,g)=>{g.r(U),g.d(U,{Dispose:()=>F,DumpData:()=>P,DumpDataAsync:()=>B,DumpFramebuffer:()=>C,DumpTools:()=>f});var N=g(12433),L=g(12165),D=g(12353),S=g(12205);let u,s=null;async function C(E,U,g,N){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",D=arguments.length>5?arguments[5]:void 0,S=arguments.length>6?arguments[6]:void 0;const u=await g.readPixels(0,0,E,U);P(E,U,new Uint8Array(u.buffer),N,L,D,!0,void 0,S)}async function B(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",L=arguments.length>4?arguments[4]:void 0,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7?arguments[7]:void 0;return await new Promise((s=>{P(E,U,g,(E=>s(E)),N,L,D,S,u)}))}function P(E,U,C,B){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",f=arguments.length>5?arguments[5]:void 0,d=arguments.length>6&&void 0!==arguments[6]&&arguments[6],I=arguments.length>7&&void 0!==arguments[7]&&arguments[7],y=arguments.length>8?arguments[8]:void 0;(async function(){return s||(s=new Promise(((E,U)=>{let L,D=null;const s={ag:!0,depth:!1,Vg:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(g.bind(g,12471)).then((C=>{let{ThinEngine:B}=C;const P=S.b.Instances.length;try{L=new OffscreenCanvas(100,100),D=new B(L,!1,s)}catch(I){var f;P<S.b.Instances.length&&(null===(f=S.b.Instances.pop())||void 0===f||f.dispose()),L=document.createElement("canvas"),D=new B(L,!1,s)}S.b.Instances.pop(),S.b.OnEnginesDisposedObservable.add((E=>{D&&E!==D&&!D.C&&0===S.b.Instances.length&&F()})),D.getCaps().parallelShaderCompile=void 0;const d=new N.c(D);g.e(52).then(g.bind(g,14865)).then((g=>{let{passPixelShader:S}=g;if(!D)return void U("Engine is not defined");const s=new N.e({fU:D,name:S.name,fragmentShader:S.shader,samplerNames:["textureSampler"]});u={canvas:L,fU:D,renderer:d,wrapper:s},E(u)}))})).catch(U)}))),await s})().then((g=>{if(g.fU.setSize(E,U,!0),C instanceof Float32Array){const E=new Uint8Array(C.length);let U=C.length;for(;U--;){const g=C[U];E[U]=Math.round(255*(0,D.Clamp)(g))}C=E}const N=g.fU.createRawTexture(C,E,U,5,!1,!d,1);g.renderer.setViewport(),g.renderer.applyEffectWrapper(g.wrapper),g.wrapper.effect._bindTexture("textureSampler",N),g.renderer.draw(),I?L.Tools.ToBlob(g.canvas,(E=>{const U=new FileReader;U.onload=E=>{const U=E.target.result;B&&B(U)},U.readAsArrayBuffer(E)}),P,y):L.Tools.EncodeScreenshotCanvasData(g.canvas,B,P,f,y),N.dispose()}))}function F(){var E;u?(u.wrapper.dispose(),u.renderer.dispose(),u.fU.dispose()):null===(E=s)||void 0===E||E.then((E=>{E.wrapper.dispose(),E.renderer.dispose(),E.fU.dispose()}));s=null,u=null}const f={DumpData:P,DumpDataAsync:B,DumpFramebuffer:C,Dispose:F};L.Tools.DumpData=P,L.Tools.DumpDataAsync=B,L.Tools.DumpFramebuffer=C},12834:(E,U,g)=>{g.d(U,{c:()=>D});var N=g(12430),L=g(12557);class D{static ExpandRGBDTexture(E){const U=E._texture;if(!U||!E.isRGBD)return;const L=U.getEngine(),D=L.getCaps(),S=U.isReady;let u=!1;D.textureHalfFloatRender&&D.textureHalfFloatLinearFiltering?(u=!0,U.type=2):D.textureFloatRender&&D.textureFloatLinearFiltering&&(u=!0,U.type=1),u&&(U.isReady=!1,U._isRGBD=!1,U.invertY=!1);const s=async()=>{const D=L.isWebGPU,S=D?1:0;U.isReady=!1,D?await g.e(42).then(g.bind(g,15402)):await g.e(35).then(g.bind(g,15411));const u=new N.e("rgbdDecode","rgbdDecode",null,null,1,null,3,L,!1,void 0,U.type,void 0,null,!1,void 0,S);u.externalTextureSamplerBinding=!0;const s=L.createRenderTargetTexture(U.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:U.samplingMode,type:U.type,format:5});u.onEffectCreatedObservable.addOnce((g=>{g.executeWhenCompiled((()=>{u.onApply=E=>{E._bindTexture("textureSampler",U),E.setFloat2("scale",1,1)},E.tE().postProcessManager.directRender([u],s,!0),L.restoreDefaultFramebuffer(),L._releaseTexture(U),u&&u.dispose(),s._swapAndDie(U),U.isReady=!0}))}))};u&&(S?s():E.onLoadObservable.addOnce(s))}static async EncodeTextureToRGBD(E,U){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return U.getEngine().isWebGPU?await g.e(43).then(g.bind(g,15425)):await g.e(36).then(g.bind(g,15417)),await(0,L.b)("rgbdEncode",E,U,N,1,5)}}}}]);