"use strict";(self.fyqbdzs5tyo=self.fyqbdzs5tyo||[]).push([[20,21],{11777:(V,I,A)=>{var B=A(11786),F=A(11251);F.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(F.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=B.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((V=>{this._texture._sphericalPolynomial=V,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(V){this._texture&&(this._texture._sphericalPolynomial=V)},enumerable:!0,configurable:!0})},11786:(V,I,A)=>{A.d(I,{d:()=>b});var B=A(11231),F=A(11249),E=A(11416),Y=A(11237),H=A(11276);class c{constructor(V,I,A,B){this.name=V,this.worldAxisForNormal=I,this.worldAxisForFileX=A,this.worldAxisForFileY=B}}class b{static ConvertCubeMapTextureToSphericalPolynomial(V){var I;if(!V.isCube)return null;null===(I=V.sV())||void 0===I||I.getEngine().flushFramebuffer();const A=V.getSize().width,B=V.readPixels(0,void 0,void 0,!1),F=V.readPixels(1,void 0,void 0,!1);let E,Y;V.isRenderTarget?(E=V.readPixels(3,void 0,void 0,!1),Y=V.readPixels(2,void 0,void 0,!1)):(E=V.readPixels(2,void 0,void 0,!1),Y=V.readPixels(3,void 0,void 0,!1));const H=V.readPixels(4,void 0,void 0,!1),c=V.readPixels(5,void 0,void 0,!1),b=V.gammaSpace;let X=0;return 1!=V.textureType&&2!=V.textureType||(X=1),new Promise((V=>{Promise.all([F,B,E,Y,H,c]).then((I=>{let[B,F,E,Y,H,c]=I;const P={size:A,right:F,left:B,up:E,down:Y,front:H,back:c,format:5,type:X,gammaSpace:b};V(this.ConvertCubeMapToSphericalPolynomial(P))}))}))}static _AreaElement(V,I){return Math.atan2(V*I,Math.sqrt(V*V+I*I+1))}static ConvertCubeMapToSphericalPolynomial(V){const I=new E.e;let A=0;const B=2/V.size,c=B,b=.5*B,X=b-1;for(let E=0;E<6;E++){const P=this._FileFaces[E],J=V[P.name];let G=X;const w=5===V.format?4:3;for(let E=0;E<V.size;E++){let t=X;for(let c=0;c<V.size;c++){const X=P.worldAxisForFileX.scale(t).add(P.worldAxisForFileY.scale(G)).add(P.worldAxisForNormal);X.normalize();const u=this._AreaElement(t-b,G-b)-this._AreaElement(t-b,G+b)-this._AreaElement(t+b,G-b)+this._AreaElement(t+b,G+b);let W=J[E*V.size*w+c*w+0],g=J[E*V.size*w+c*w+1],o=J[E*V.size*w+c*w+2];isNaN(W)&&(W=0),isNaN(g)&&(g=0),isNaN(o)&&(o=0),0===V.type&&(W/=255,g/=255,o/=255),V.gammaSpace&&(W=Math.pow((0,F.Clamp)(W),Y.j),g=Math.pow((0,F.Clamp)(g),Y.j),o=Math.pow((0,F.Clamp)(o),Y.j));const L=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const V=Math.max(W,g,o);if(V>L){const I=L/V;W*=I,g*=I,o*=I}}else W=(0,F.Clamp)(W,0,L),g=(0,F.Clamp)(g,0,L),o=(0,F.Clamp)(o,0,L);const z=new H.oI(W,g,o);I.addLight(X,z,u),A+=u,t+=B}G+=c}}const P=6*(4*Math.PI)/6/A;return I.scaleInPlace(P),I.convertIncidentRadianceToIrradiance(),I.convertIrradianceToLambertianRadiance(),E.h.FromHarmonics(I)}}b._FileFaces=[new c("right",new B.tI(1,0,0),new B.tI(0,0,-1),new B.tI(0,-1,0)),new c("left",new B.tI(-1,0,0),new B.tI(0,0,1),new B.tI(0,-1,0)),new c("up",new B.tI(0,1,0),new B.tI(1,0,0),new B.tI(0,0,1)),new c("down",new B.tI(0,-1,0),new B.tI(1,0,0),new B.tI(0,0,-1)),new c("front",new B.tI(0,0,1),new B.tI(1,0,0),new B.tI(0,-1,0)),new c("back",new B.tI(0,0,-1),new B.tI(-1,0,0),new B.tI(0,-1,0))],b.MAX_HDRI_VALUE=4096,b.PRESERVE_CLAMPED_COLORS=!1},11454:(V,I,A)=>{A.r(I),A.d(I,{Dispose:()=>J,DumpData:()=>P,DumpDataAsync:()=>X,DumpFramebuffer:()=>b,DumpTools:()=>G});var B=A(11330),F=A(11052),E=A(11249),Y=A(11097);let H,c=null;async function b(V,I,A,B){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",E=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0;const H=await A.readPixels(0,0,V,I);P(V,I,new Uint8Array(H.buffer),B,F,E,!0,void 0,Y)}async function X(V,I,A){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",F=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7?arguments[7]:void 0;return await new Promise((c=>{P(V,I,A,(V=>c(V)),B,F,E,Y,H)}))}function P(V,I,b,X){let P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",G=arguments.length>5?arguments[5]:void 0,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8?arguments[8]:void 0;(async function(){return c||(c=new Promise(((V,I)=>{let F,E=null;const c={o:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(A.bind(A,11363)).then((b=>{let{ThinEngine:X}=b;const P=Y.e.Instances.length;try{F=new OffscreenCanvas(100,100),E=new X(F,!1,c)}catch(t){var G;P<Y.e.Instances.length&&(null===(G=Y.e.Instances.pop())||void 0===G||G.dispose()),F=document.createElement("canvas"),E=new X(F,!1,c)}Y.e.Instances.pop(),Y.e.OnEnginesDisposedObservable.add((V=>{E&&V!==E&&!E.H&&0===Y.e.Instances.length&&J()})),E.getCaps().parallelShaderCompile=void 0;const w=new B.e(E);A.e(52).then(A.bind(A,13683)).then((A=>{let{passPixelShader:Y}=A;if(!E)return void I("Engine is not defined");const c=new B.f({wI:E,name:Y.name,fragmentShader:Y.shader,samplerNames:["textureSampler"]});H={canvas:F,wI:E,renderer:w,wrapper:c},V(H)}))})).catch(I)}))),await c})().then((A=>{if(A.wI.setSize(V,I,!0),b instanceof Float32Array){const V=new Uint8Array(b.length);let I=b.length;for(;I--;){const A=b[I];V[I]=Math.round(255*(0,E.Clamp)(A))}b=V}const B=A.wI.createRawTexture(b,V,I,5,!1,!w,1);A.renderer.setViewport(),A.renderer.applyEffectWrapper(A.wrapper),A.wrapper.effect._bindTexture("textureSampler",B),A.renderer.draw(),t?F.Tools.ToBlob(A.canvas,(V=>{const I=new FileReader;I.onload=V=>{const I=V.target.result;X&&X(I)},I.readAsArrayBuffer(V)}),P,u):F.Tools.EncodeScreenshotCanvasData(A.canvas,X,P,G,u),B.dispose()}))}function J(){var V;H?(H.wrapper.dispose(),H.renderer.dispose(),H.wI.dispose()):null===(V=c)||void 0===V||V.then((V=>{V.wrapper.dispose(),V.renderer.dispose(),V.wI.dispose()}));c=null,H=null}const G={DumpData:P,DumpDataAsync:X,DumpFramebuffer:b,Dispose:J};F.Tools.DumpData=P,F.Tools.DumpDataAsync=X,F.Tools.DumpFramebuffer=b},11770:(V,I,A)=>{A.d(I,{e:()=>E});var B=A(11325),F=A(11461);class E{static ExpandRGBDTexture(V){const I=V._texture;if(!I||!V.isRGBD)return;const F=I.getEngine(),E=F.getCaps(),Y=I.isReady;let H=!1;E.textureHalfFloatRender&&E.textureHalfFloatLinearFiltering?(H=!0,I.type=2):E.textureFloatRender&&E.textureFloatLinearFiltering&&(H=!0,I.type=1),H&&(I.isReady=!1,I._isRGBD=!1,I.invertY=!1);const c=async()=>{const E=F.isWebGPU,Y=E?1:0;I.isReady=!1,E?await A.e(42).then(A.bind(A,14170)):await A.e(35).then(A.bind(A,14176));const H=new B.d("rgbdDecode","rgbdDecode",null,null,1,null,3,F,!1,void 0,I.type,void 0,null,!1,void 0,Y);H.externalTextureSamplerBinding=!0;const c=F.createRenderTargetTexture(I.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:I.samplingMode,type:I.type,format:5});H.onEffectCreatedObservable.addOnce((A=>{A.executeWhenCompiled((()=>{H.onApply=V=>{V._bindTexture("textureSampler",I),V.setFloat2("scale",1,1)},V.sV().postProcessManager.directRender([H],c,!0),F.restoreDefaultFramebuffer(),F._releaseTexture(I),H&&H.dispose(),c._swapAndDie(I),I.isReady=!0}))}))};H&&(Y?c():V.onLoadObservable.addOnce(c))}static async EncodeTextureToRGBD(V,I){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return I.getEngine().isWebGPU?await A.e(43).then(A.bind(A,14185)):await A.e(36).then(A.bind(A,14181)),await(0,F.d)("rgbdEncode",V,I,B,1,5)}}}}]);