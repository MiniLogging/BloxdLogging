"use strict";(self.z22hkk7o33f=self.z22hkk7o33f||[]).push([[20,21],{13381:(U,G,C)=>{var L=C(13390),X=C(12913);X.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(X.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=L.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((U=>{this._texture._sphericalPolynomial=U,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(U){this._texture&&(this._texture._sphericalPolynomial=U)},enumerable:!0,configurable:!0})},13390:(U,G,C)=>{C.d(G,{c:()=>P});var L=C(12896),X=C(12911),l=C(13064),t=C(12898),E=C(12934);class K{constructor(U,G,C,L){this.name=U,this.worldAxisForNormal=G,this.worldAxisForFileX=C,this.worldAxisForFileY=L}}class P{static ConvertCubeMapTextureToSphericalPolynomial(U){var G;if(!U.isCube)return null;null===(G=U.wU())||void 0===G||G.getEngine().flushFramebuffer();const C=U.getSize().width,L=U.readPixels(0,void 0,void 0,!1),X=U.readPixels(1,void 0,void 0,!1);let l,t;U.isRenderTarget?(l=U.readPixels(3,void 0,void 0,!1),t=U.readPixels(2,void 0,void 0,!1)):(l=U.readPixels(2,void 0,void 0,!1),t=U.readPixels(3,void 0,void 0,!1));const E=U.readPixels(4,void 0,void 0,!1),K=U.readPixels(5,void 0,void 0,!1),P=U.gammaSpace;let O=0;return 1!=U.textureType&&2!=U.textureType||(O=1),new Promise((U=>{Promise.all([X,L,l,t,E,K]).then((G=>{let[L,X,l,t,E,K]=G;const T={size:C,right:X,left:L,up:l,down:t,front:E,back:K,format:5,type:O,gammaSpace:P};U(this.ConvertCubeMapToSphericalPolynomial(T))}))}))}static _AreaElement(U,G){return Math.atan2(U*G,Math.sqrt(U*U+G*G+1))}static ConvertCubeMapToSphericalPolynomial(U){const G=new l.c;let C=0;const L=2/U.size,K=L,P=.5*L,O=P-1;for(let l=0;l<6;l++){const T=this._FileFaces[l],D=U[T.name];let y=O;const V=5===U.format?4:3;for(let l=0;l<U.size;l++){let p=O;for(let K=0;K<U.size;K++){const O=T.worldAxisForFileX.scale(p).add(T.worldAxisForFileY.scale(y)).add(T.worldAxisForNormal);O.normalize();const I=this._AreaElement(p-P,y-P)-this._AreaElement(p-P,y+P)-this._AreaElement(p+P,y-P)+this._AreaElement(p+P,y+P);let H=D[l*U.size*V+K*V+0],x=D[l*U.size*V+K*V+1],h=D[l*U.size*V+K*V+2];isNaN(H)&&(H=0),isNaN(x)&&(x=0),isNaN(h)&&(h=0),0===U.type&&(H/=255,x/=255,h/=255),U.gammaSpace&&(H=Math.pow((0,X.Clamp)(H),t.l),x=Math.pow((0,X.Clamp)(x),t.l),h=Math.pow((0,X.Clamp)(h),t.l));const N=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const U=Math.max(H,x,h);if(U>N){const G=N/U;H*=G,x*=G,h*=G}}else H=(0,X.Clamp)(H,0,N),x=(0,X.Clamp)(x,0,N),h=(0,X.Clamp)(h,0,N);const b=new E.hG(H,x,h);G.addLight(O,b,I),C+=I,p+=L}y+=K}}const T=6*(4*Math.PI)/6/C;return G.scaleInPlace(T),G.convertIncidentRadianceToIrradiance(),G.convertIrradianceToLambertianRadiance(),l.g.FromHarmonics(G)}}P._FileFaces=[new K("right",new L.pG(1,0,0),new L.pG(0,0,-1),new L.pG(0,-1,0)),new K("left",new L.pG(-1,0,0),new L.pG(0,0,1),new L.pG(0,-1,0)),new K("up",new L.pG(0,1,0),new L.pG(1,0,0),new L.pG(0,0,1)),new K("down",new L.pG(0,-1,0),new L.pG(1,0,0),new L.pG(0,0,-1)),new K("front",new L.pG(0,0,1),new L.pG(1,0,0),new L.pG(0,-1,0)),new K("back",new L.pG(0,0,-1),new L.pG(-1,0,0),new L.pG(0,-1,0))],P.MAX_HDRI_VALUE=4096,P.PRESERVE_CLAMPED_COLORS=!1},13089:(U,G,C)=>{C.r(G),C.d(G,{Dispose:()=>D,DumpData:()=>T,DumpDataAsync:()=>O,DumpFramebuffer:()=>P,DumpTools:()=>y});var L=C(12989),X=C(12718),l=C(12911),t=C(12763);let E,K=null;async function P(U,G,C,L){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",l=arguments.length>5?arguments[5]:void 0,t=arguments.length>6?arguments[6]:void 0;const E=await C.readPixels(0,0,U,G);T(U,G,new Uint8Array(E.buffer),L,X,l,!0,void 0,t)}async function O(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",X=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7?arguments[7]:void 0;return await new Promise((K=>{T(U,G,C,(U=>K(U)),L,X,l,t,E)}))}function T(U,G,P,O){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",y=arguments.length>5?arguments[5]:void 0,V=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7&&void 0!==arguments[7]&&arguments[7],I=arguments.length>8?arguments[8]:void 0;(async function(){return K||(K=new Promise(((U,G)=>{let X,l=null;const K={BE:!0,depth:!1,kE:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(C.bind(C,13016)).then((P=>{let{ThinEngine:O}=P;const T=t.d.Instances.length;try{X=new OffscreenCanvas(100,100),l=new O(X,!1,K)}catch(p){var y;T<t.d.Instances.length&&(null===(y=t.d.Instances.pop())||void 0===y||y.dispose()),X=document.createElement("canvas"),l=new O(X,!1,K)}t.d.Instances.pop(),t.d.OnEnginesDisposedObservable.add((U=>{l&&U!==l&&!l.t&&0===t.d.Instances.length&&D()})),l.getCaps().parallelShaderCompile=void 0;const V=new L.e(l);C.e(52).then(C.bind(C,14949)).then((C=>{let{passPixelShader:t}=C;if(!l)return void G("Engine is not defined");const K=new L.h({VG:l,name:t.name,fragmentShader:t.shader,samplerNames:["textureSampler"]});E={canvas:X,VG:l,renderer:V,wrapper:K},U(E)}))})).catch(G)}))),await K})().then((C=>{if(C.VG.setSize(U,G,!0),P instanceof Float32Array){const U=new Uint8Array(P.length);let G=P.length;for(;G--;){const C=P[G];U[G]=Math.round(255*(0,l.Clamp)(C))}P=U}const L=C.VG.createRawTexture(P,U,G,5,!1,!V,1);C.renderer.setViewport(),C.renderer.applyEffectWrapper(C.wrapper),C.wrapper.effect._bindTexture("textureSampler",L),C.renderer.draw(),p?X.Tools.ToBlob(C.canvas,(U=>{const G=new FileReader;G.onload=U=>{const G=U.target.result;O&&O(G)},G.readAsArrayBuffer(U)}),T,I):X.Tools.EncodeScreenshotCanvasData(C.canvas,O,T,y,I),L.dispose()}))}function D(){var U;E?(E.wrapper.dispose(),E.renderer.dispose(),E.VG.dispose()):null===(U=K)||void 0===U||U.then((U=>{U.wrapper.dispose(),U.renderer.dispose(),U.VG.dispose()}));K=null,E=null}const y={DumpData:T,DumpDataAsync:O,DumpFramebuffer:P,Dispose:D};X.Tools.DumpData=T,X.Tools.DumpDataAsync=O,X.Tools.DumpFramebuffer=P},13367:(U,G,C)=>{C.d(G,{b:()=>l});var L=C(12985),X=C(13092);class l{static ExpandRGBDTexture(U){const G=U._texture;if(!G||!U.isRGBD)return;const X=G.getEngine(),l=X.getCaps(),t=G.isReady;let E=!1;l.textureHalfFloatRender&&l.textureHalfFloatLinearFiltering?(E=!0,G.type=2):l.textureFloatRender&&l.textureFloatLinearFiltering&&(E=!0,G.type=1),E&&(G.isReady=!1,G._isRGBD=!1,G.invertY=!1);const K=async()=>{const l=X.isWebGPU,t=l?1:0;G.isReady=!1,l?await C.e(42).then(C.bind(C,15469)):await C.e(35).then(C.bind(C,15473));const E=new L.e("rgbdDecode","rgbdDecode",null,null,1,null,3,X,!1,void 0,G.type,void 0,null,!1,void 0,t);E.externalTextureSamplerBinding=!0;const K=X.createRenderTargetTexture(G.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:G.samplingMode,type:G.type,format:5});E.onEffectCreatedObservable.addOnce((C=>{C.executeWhenCompiled((()=>{E.onApply=U=>{U._bindTexture("textureSampler",G),U.setFloat2("scale",1,1)},U.wU().postProcessManager.directRender([E],K,!0),X.restoreDefaultFramebuffer(),X._releaseTexture(G),E&&E.dispose(),K._swapAndDie(G),G.isReady=!0}))}))};E&&(t?K():U.onLoadObservable.addOnce(K))}static async EncodeTextureToRGBD(U,G){let L=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return G.getEngine().isWebGPU?await C.e(43).then(C.bind(C,15484)):await C.e(36).then(C.bind(C,15477)),await(0,X.c)("rgbdEncode",U,G,L,1,5)}}}}]);