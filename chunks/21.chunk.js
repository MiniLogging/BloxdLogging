"use strict";(self.zy41qorie9=self.zy41qorie9||[]).push([[20,21],{12935:(Z,l,C)=>{var B=C(12940),x=C(12463);x.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(x.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=B.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((Z=>{this._texture._sphericalPolynomial=Z,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(Z){this._texture&&(this._texture._sphericalPolynomial=Z)},enumerable:!0,configurable:!0})},12940:(Z,l,C)=>{C.d(l,{c:()=>J});var B=C(12442),x=C(12460),b=C(12652),K=C(12451),f=C(12494);class W{constructor(Z,l,C,B){this.name=Z,this.worldAxisForNormal=l,this.worldAxisForFileX=C,this.worldAxisForFileY=B}}class J{static ConvertCubeMapTextureToSphericalPolynomial(Z){var l;if(!Z.isCube)return null;null===(l=Z.cZ())||void 0===l||l.getEngine().flushFramebuffer();const C=Z.getSize().width,B=Z.readPixels(0,void 0,void 0,!1),x=Z.readPixels(1,void 0,void 0,!1);let b,K;Z.isRenderTarget?(b=Z.readPixels(3,void 0,void 0,!1),K=Z.readPixels(2,void 0,void 0,!1)):(b=Z.readPixels(2,void 0,void 0,!1),K=Z.readPixels(3,void 0,void 0,!1));const f=Z.readPixels(4,void 0,void 0,!1),W=Z.readPixels(5,void 0,void 0,!1),J=Z.gammaSpace;let d=0;return 1!=Z.textureType&&2!=Z.textureType||(d=1),new Promise((Z=>{Promise.all([x,B,b,K,f,W]).then((l=>{let[B,x,b,K,f,W]=l;const E={size:C,right:x,left:B,up:b,down:K,front:f,back:W,format:5,type:d,gammaSpace:J};Z(this.ConvertCubeMapToSphericalPolynomial(E))}))}))}static _AreaElement(Z,l){return Math.atan2(Z*l,Math.sqrt(Z*Z+l*l+1))}static ConvertCubeMapToSphericalPolynomial(Z){const l=new b.d;let C=0;const B=2/Z.size,W=B,J=.5*B,d=J-1;for(let b=0;b<6;b++){const E=this._FileFaces[b],G=Z[E.name];let a=d;const q=5===Z.format?4:3;for(let b=0;b<Z.size;b++){let z=d;for(let W=0;W<Z.size;W++){const d=E.worldAxisForFileX.scale(z).add(E.worldAxisForFileY.scale(a)).add(E.worldAxisForNormal);d.normalize();const Y=this._AreaElement(z-J,a-J)-this._AreaElement(z-J,a+J)-this._AreaElement(z+J,a-J)+this._AreaElement(z+J,a+J);let P=G[b*Z.size*q+W*q+0],S=G[b*Z.size*q+W*q+1],i=G[b*Z.size*q+W*q+2];isNaN(P)&&(P=0),isNaN(S)&&(S=0),isNaN(i)&&(i=0),0===Z.type&&(P/=255,S/=255,i/=255),Z.gammaSpace&&(P=Math.pow((0,x.Clamp)(P),K.j),S=Math.pow((0,x.Clamp)(S),K.j),i=Math.pow((0,x.Clamp)(i),K.j));const s=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const Z=Math.max(P,S,i);if(Z>s){const l=s/Z;P*=l,S*=l,i*=l}}else P=(0,x.Clamp)(P,0,s),S=(0,x.Clamp)(S,0,s),i=(0,x.Clamp)(i,0,s);const F=new f.Sl(P,S,i);l.addLight(d,F,Y),C+=Y,z+=B}a+=W}}const E=6*(4*Math.PI)/6/C;return l.scaleInPlace(E),l.convertIncidentRadianceToIrradiance(),l.convertIrradianceToLambertianRadiance(),b.g.FromHarmonics(l)}}J._FileFaces=[new W("right",new B.ql(1,0,0),new B.ql(0,0,-1),new B.ql(0,-1,0)),new W("left",new B.ql(-1,0,0),new B.ql(0,0,1),new B.ql(0,-1,0)),new W("up",new B.ql(0,1,0),new B.ql(1,0,0),new B.ql(0,0,1)),new W("down",new B.ql(0,-1,0),new B.ql(1,0,0),new B.ql(0,0,-1)),new W("front",new B.ql(0,0,1),new B.ql(1,0,0),new B.ql(0,-1,0)),new W("back",new B.ql(0,0,-1),new B.ql(-1,0,0),new B.ql(0,-1,0))],J.MAX_HDRI_VALUE=4096,J.PRESERVE_CLAMPED_COLORS=!1},12689:(Z,l,C)=>{C.r(l),C.d(l,{Dispose:()=>G,DumpData:()=>E,DumpDataAsync:()=>d,DumpFramebuffer:()=>J,DumpTools:()=>a});var B=C(12568),x=C(12248),b=C(12460),K=C(12295);let f,W=null;async function J(Z,l,C,B){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",b=arguments.length>5?arguments[5]:void 0,K=arguments.length>6?arguments[6]:void 0;const f=await C.readPixels(0,0,Z,l);E(Z,l,new Uint8Array(f.buffer),B,x,b,!0,void 0,K)}async function d(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",x=arguments.length>4?arguments[4]:void 0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],f=arguments.length>7?arguments[7]:void 0;return await new Promise((W=>{E(Z,l,C,(Z=>W(Z)),B,x,b,K,f)}))}function E(Z,l,J,d){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",a=arguments.length>5?arguments[5]:void 0,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],Y=arguments.length>8?arguments[8]:void 0;(async function(){return W||(W=new Promise(((Z,l)=>{let x,b=null;const W={Gb:!0,depth:!1,bb:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(C.bind(C,12596)).then((J=>{let{ThinEngine:d}=J;const E=K.b.Instances.length;try{x=new OffscreenCanvas(100,100),b=new d(x,!1,W)}catch(z){var a;E<K.b.Instances.length&&(null===(a=K.b.Instances.pop())||void 0===a||a.dispose()),x=document.createElement("canvas"),b=new d(x,!1,W)}K.b.Instances.pop(),K.b.OnEnginesDisposedObservable.add((Z=>{b&&Z!==b&&!b.J&&0===K.b.Instances.length&&G()})),b.getCaps().parallelShaderCompile=void 0;const q=new B.e(b);C.e(52).then(C.bind(C,14623)).then((C=>{let{passPixelShader:K}=C;if(!b)return void l("Engine is not defined");const W=new B.i({al:b,name:K.name,fragmentShader:K.shader,samplerNames:["textureSampler"]});f={canvas:x,al:b,renderer:q,wrapper:W},Z(f)}))})).catch(l)}))),await W})().then((C=>{if(C.al.setSize(Z,l,!0),J instanceof Float32Array){const Z=new Uint8Array(J.length);let l=J.length;for(;l--;){const C=J[l];Z[l]=Math.round(255*(0,b.Clamp)(C))}J=Z}const B=C.al.createRawTexture(J,Z,l,5,!1,!q,1);C.renderer.setViewport(),C.renderer.applyEffectWrapper(C.wrapper),C.wrapper.effect._bindTexture("textureSampler",B),C.renderer.draw(),z?x.Tools.ToBlob(C.canvas,(Z=>{const l=new FileReader;l.onload=Z=>{const l=Z.target.result;d&&d(l)},l.readAsArrayBuffer(Z)}),E,Y):x.Tools.EncodeScreenshotCanvasData(C.canvas,d,E,a,Y),B.dispose()}))}function G(){var Z;f?(f.wrapper.dispose(),f.renderer.dispose(),f.al.dispose()):null===(Z=W)||void 0===Z||Z.then((Z=>{Z.wrapper.dispose(),Z.renderer.dispose(),Z.al.dispose()}));W=null,f=null}const a={DumpData:E,DumpDataAsync:d,DumpFramebuffer:J,Dispose:G};x.Tools.DumpData=E,x.Tools.DumpDataAsync=d,x.Tools.DumpFramebuffer=J},12921:(Z,l,C)=>{C.d(l,{e:()=>b});var B=C(12565),x=C(12693);class b{static ExpandRGBDTexture(Z){const l=Z._texture;if(!l||!Z.isRGBD)return;const x=l.getEngine(),b=x.getCaps(),K=l.isReady;let f=!1;b.textureHalfFloatRender&&b.textureHalfFloatLinearFiltering?(f=!0,l.type=2):b.textureFloatRender&&b.textureFloatLinearFiltering&&(f=!0,l.type=1),f&&(l.isReady=!1,l._isRGBD=!1,l.invertY=!1);const W=async()=>{const b=x.isWebGPU,K=b?1:0;l.isReady=!1,b?await C.e(42).then(C.bind(C,15166)):await C.e(35).then(C.bind(C,15175));const f=new B.b("rgbdDecode","rgbdDecode",null,null,1,null,3,x,!1,void 0,l.type,void 0,null,!1,void 0,K);f.externalTextureSamplerBinding=!0;const W=x.createRenderTargetTexture(l.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:l.samplingMode,type:l.type,format:5});f.onEffectCreatedObservable.addOnce((C=>{C.executeWhenCompiled((()=>{f.onApply=Z=>{Z._bindTexture("textureSampler",l),Z.setFloat2("scale",1,1)},Z.cZ().postProcessManager.directRender([f],W,!0),x.restoreDefaultFramebuffer(),x._releaseTexture(l),f&&f.dispose(),W._swapAndDie(l),l.isReady=!0}))}))};f&&(K?W():Z.onLoadObservable.addOnce(W))}static async EncodeTextureToRGBD(Z,l){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return l.getEngine().isWebGPU?await C.e(43).then(C.bind(C,15183)):await C.e(36).then(C.bind(C,15178)),await(0,x.b)("rgbdEncode",Z,l,B,1,5)}}}}]);