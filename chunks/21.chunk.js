"use strict";(self["3gghkoft8x"]=self["3gghkoft8x"]||[]).push([[20,21],{12821:(y,S,I)=>{var V=I(12829),i=I(12340);i.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(i.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=V.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((y=>{this._texture._sphericalPolynomial=y,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(y){this._texture&&(this._texture._sphericalPolynomial=y)},enumerable:!0,configurable:!0})},12829:(y,S,I)=>{I.d(S,{e:()=>J});var V=I(12321),i=I(12338),A=I(12511),B=I(12325),d=I(12362);class F{constructor(y,S,I,V){this.name=y,this.worldAxisForNormal=S,this.worldAxisForFileX=I,this.worldAxisForFileY=V}}class J{static ConvertCubeMapTextureToSphericalPolynomial(y){var S;if(!y.isCube)return null;null===(S=y.Ey())||void 0===S||S.getEngine().flushFramebuffer();const I=y.getSize().width,V=y.readPixels(0,void 0,void 0,!1),i=y.readPixels(1,void 0,void 0,!1);let A,B;y.isRenderTarget?(A=y.readPixels(3,void 0,void 0,!1),B=y.readPixels(2,void 0,void 0,!1)):(A=y.readPixels(2,void 0,void 0,!1),B=y.readPixels(3,void 0,void 0,!1));const d=y.readPixels(4,void 0,void 0,!1),F=y.readPixels(5,void 0,void 0,!1),J=y.gammaSpace;let u=0;return 1!=y.textureType&&2!=y.textureType||(u=1),new Promise((y=>{Promise.all([i,V,A,B,d,F]).then((S=>{let[V,i,A,B,d,F]=S;const K={size:I,right:i,left:V,up:A,down:B,front:d,back:F,format:5,type:u,gammaSpace:J};y(this.ConvertCubeMapToSphericalPolynomial(K))}))}))}static _AreaElement(y,S){return Math.atan2(y*S,Math.sqrt(y*y+S*S+1))}static ConvertCubeMapToSphericalPolynomial(y){const S=new A.e;let I=0;const V=2/y.size,F=V,J=.5*V,u=J-1;for(let A=0;A<6;A++){const K=this._FileFaces[A],G=y[K.name];let p=u;const L=5===y.format?4:3;for(let A=0;A<y.size;A++){let T=u;for(let F=0;F<y.size;F++){const u=K.worldAxisForFileX.scale(T).add(K.worldAxisForFileY.scale(p)).add(K.worldAxisForNormal);u.normalize();const l=this._AreaElement(T-J,p-J)-this._AreaElement(T-J,p+J)-this._AreaElement(T+J,p-J)+this._AreaElement(T+J,p+J);let j=G[A*y.size*L+F*L+0],s=G[A*y.size*L+F*L+1],O=G[A*y.size*L+F*L+2];isNaN(j)&&(j=0),isNaN(s)&&(s=0),isNaN(O)&&(O=0),0===y.type&&(j/=255,s/=255,O/=255),y.gammaSpace&&(j=Math.pow((0,i.Clamp)(j),B.h),s=Math.pow((0,i.Clamp)(s),B.h),O=Math.pow((0,i.Clamp)(O),B.h));const f=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const y=Math.max(j,s,O);if(y>f){const S=f/y;j*=S,s*=S,O*=S}}else j=(0,i.Clamp)(j,0,f),s=(0,i.Clamp)(s,0,f),O=(0,i.Clamp)(O,0,f);const my=new d.DS(j,s,O);S.addLight(u,my,l),I+=l,T+=V}p+=F}}const K=6*(4*Math.PI)/6/I;return S.scaleInPlace(K),S.convertIncidentRadianceToIrradiance(),S.convertIrradianceToLambertianRadiance(),A.h.FromHarmonics(S)}}J._FileFaces=[new F("right",new V.OS(1,0,0),new V.OS(0,0,-1),new V.OS(0,-1,0)),new F("left",new V.OS(-1,0,0),new V.OS(0,0,1),new V.OS(0,-1,0)),new F("up",new V.OS(0,1,0),new V.OS(1,0,0),new V.OS(0,0,1)),new F("down",new V.OS(0,-1,0),new V.OS(1,0,0),new V.OS(0,0,-1)),new F("front",new V.OS(0,0,1),new V.OS(1,0,0),new V.OS(0,-1,0)),new F("back",new V.OS(0,0,-1),new V.OS(-1,0,0),new V.OS(0,-1,0))],J.MAX_HDRI_VALUE=4096,J.PRESERVE_CLAMPED_COLORS=!1},12544:(y,S,I)=>{I.r(S),I.d(S,{Dispose:()=>G,DumpData:()=>K,DumpDataAsync:()=>u,DumpFramebuffer:()=>J,DumpTools:()=>p});var V=I(12425),i=I(12128),A=I(12338),B=I(12185);let d,F=null;async function J(y,S,I,V){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",A=arguments.length>5?arguments[5]:void 0,B=arguments.length>6?arguments[6]:void 0;const d=await I.readPixels(0,0,y,S);K(y,S,new Uint8Array(d.buffer),V,i,A,!0,void 0,B)}async function u(y,S,I){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",i=arguments.length>4?arguments[4]:void 0,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7?arguments[7]:void 0;return await new Promise((F=>{K(y,S,I,(y=>F(y)),V,i,A,B,d)}))}function K(y,S,J,u){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",p=arguments.length>5?arguments[5]:void 0,L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],T=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8?arguments[8]:void 0;(async function(){return F||(F=new Promise(((y,S)=>{let i,A=null;const F={ei:!0,depth:!1,gi:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(I.bind(I,12459)).then((J=>{let{ThinEngine:u}=J;const K=B.e.Instances.length;try{i=new OffscreenCanvas(100,100),A=new u(i,!1,F)}catch(T){var p;K<B.e.Instances.length&&(null===(p=B.e.Instances.pop())||void 0===p||p.dispose()),i=document.createElement("canvas"),A=new u(i,!1,F)}B.e.Instances.pop(),B.e.OnEnginesDisposedObservable.add((y=>{A&&y!==A&&!A.J&&0===B.e.Instances.length&&G()})),A.getCaps().parallelShaderCompile=void 0;const L=new V.e(A);I.e(52).then(I.bind(I,14815)).then((I=>{let{passPixelShader:B}=I;if(!A)return void S("Engine is not defined");const F=new V.i({sS:A,name:B.name,fragmentShader:B.shader,samplerNames:["textureSampler"]});d={canvas:i,sS:A,renderer:L,wrapper:F},y(d)}))})).catch(S)}))),await F})().then((I=>{if(I.sS.setSize(y,S,!0),J instanceof Float32Array){const y=new Uint8Array(J.length);let S=J.length;for(;S--;){const I=J[S];y[S]=Math.round(255*(0,A.Clamp)(I))}J=y}const V=I.sS.createRawTexture(J,y,S,5,!1,!L,1);I.renderer.setViewport(),I.renderer.applyEffectWrapper(I.wrapper),I.wrapper.effect._bindTexture("textureSampler",V),I.renderer.draw(),T?i.Tools.ToBlob(I.canvas,(y=>{const S=new FileReader;S.onload=y=>{const S=y.target.result;u&&u(S)},S.readAsArrayBuffer(y)}),K,l):i.Tools.EncodeScreenshotCanvasData(I.canvas,u,K,p,l),V.dispose()}))}function G(){var y;d?(d.wrapper.dispose(),d.renderer.dispose(),d.sS.dispose()):null===(y=F)||void 0===y||y.then((y=>{y.wrapper.dispose(),y.renderer.dispose(),y.sS.dispose()}));F=null,d=null}const p={DumpData:K,DumpDataAsync:u,DumpFramebuffer:J,Dispose:G};i.Tools.DumpData=K,i.Tools.DumpDataAsync=u,i.Tools.DumpFramebuffer=J},12811:(y,S,I)=>{I.d(S,{e:()=>A});var V=I(12421),i=I(12550);class A{static ExpandRGBDTexture(y){const S=y._texture;if(!S||!y.isRGBD)return;const i=S.getEngine(),A=i.getCaps(),B=S.isReady;let d=!1;A.textureHalfFloatRender&&A.textureHalfFloatLinearFiltering?(d=!0,S.type=2):A.textureFloatRender&&A.textureFloatLinearFiltering&&(d=!0,S.type=1),d&&(S.isReady=!1,S._isRGBD=!1,S.invertY=!1);const F=async()=>{const A=i.isWebGPU,B=A?1:0;S.isReady=!1,A?await I.e(42).then(I.bind(I,15349)):await I.e(35).then(I.bind(I,15353));const d=new V.c("rgbdDecode","rgbdDecode",null,null,1,null,3,i,!1,void 0,S.type,void 0,null,!1,void 0,B);d.externalTextureSamplerBinding=!0;const F=i.createRenderTargetTexture(S.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:S.samplingMode,type:S.type,format:5});d.onEffectCreatedObservable.addOnce((I=>{I.executeWhenCompiled((()=>{d.onApply=y=>{y._bindTexture("textureSampler",S),y.setFloat2("scale",1,1)},y.Ey().postProcessManager.directRender([d],F,!0),i.restoreDefaultFramebuffer(),i._releaseTexture(S),d&&d.dispose(),F._swapAndDie(S),S.isReady=!0}))}))};d&&(B?F():y.onLoadObservable.addOnce(F))}static async EncodeTextureToRGBD(y,S){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return S.getEngine().isWebGPU?await I.e(43).then(I.bind(I,15370)):await I.e(36).then(I.bind(I,15362)),await(0,i.d)("rgbdEncode",y,S,V,1,5)}}}}]);