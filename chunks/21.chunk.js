"use strict";(self.u4k1rqylno=self.u4k1rqylno||[]).push([[20,21],{12226:(e,E,H)=>{var N=H(12231),u=H(11765);u.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(u.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=N.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((e=>{this._texture._sphericalPolynomial=e,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0})},12231:(e,E,H)=>{H.d(E,{e:()=>A});var N=H(11738),u=H(11756),z=H(11924),P=H(11746),M=H(11789);class D{constructor(e,E,H,N){this.name=e,this.worldAxisForNormal=E,this.worldAxisForFileX=H,this.worldAxisForFileY=N}}class A{static ConvertCubeMapTextureToSphericalPolynomial(e){var E;if(!e.isCube)return null;null===(E=e.fe())||void 0===E||E.getEngine().flushFramebuffer();const H=e.getSize().width,N=e.readPixels(0,void 0,void 0,!1),u=e.readPixels(1,void 0,void 0,!1);let z,P;e.isRenderTarget?(z=e.readPixels(3,void 0,void 0,!1),P=e.readPixels(2,void 0,void 0,!1)):(z=e.readPixels(2,void 0,void 0,!1),P=e.readPixels(3,void 0,void 0,!1));const M=e.readPixels(4,void 0,void 0,!1),D=e.readPixels(5,void 0,void 0,!1),A=e.gammaSpace;let C=0;return 1!=e.textureType&&2!=e.textureType||(C=1),new Promise((e=>{Promise.all([u,N,z,P,M,D]).then((E=>{let[N,u,z,P,M,D]=E;const i={size:H,right:u,left:N,up:z,down:P,front:M,back:D,format:5,type:C,gammaSpace:A};e(this.ConvertCubeMapToSphericalPolynomial(i))}))}))}static _AreaElement(e,E){return Math.atan2(e*E,Math.sqrt(e*e+E*E+1))}static ConvertCubeMapToSphericalPolynomial(e){const E=new z.b;let H=0;const N=2/e.size,D=N,A=.5*N,C=A-1;for(let z=0;z<6;z++){const i=this._FileFaces[z],V=e[i.name];let U=C;const j=5===e.format?4:3;for(let z=0;z<e.size;z++){let F=C;for(let D=0;D<e.size;D++){const C=i.worldAxisForFileX.scale(F).add(i.worldAxisForFileY.scale(U)).add(i.worldAxisForNormal);C.normalize();const h=this._AreaElement(F-A,U-A)-this._AreaElement(F-A,U+A)-this._AreaElement(F+A,U-A)+this._AreaElement(F+A,U+A);let S=V[z*e.size*j+D*j+0],X=V[z*e.size*j+D*j+1],a=V[z*e.size*j+D*j+2];isNaN(S)&&(S=0),isNaN(X)&&(X=0),isNaN(a)&&(a=0),0===e.type&&(S/=255,X/=255,a/=255),e.gammaSpace&&(S=Math.pow((0,u.Clamp)(S),P.j),X=Math.pow((0,u.Clamp)(X),P.j),a=Math.pow((0,u.Clamp)(a),P.j));const W=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const e=Math.max(S,X,a);if(e>W){const E=W/e;S*=E,X*=E,a*=E}}else S=(0,u.Clamp)(S,0,W),X=(0,u.Clamp)(X,0,W),a=(0,u.Clamp)(a,0,W);const r=new M.XE(S,X,a);E.addLight(C,r,h),H+=h,F+=N}U+=D}}const i=6*(4*Math.PI)/6/H;return E.scaleInPlace(i),E.convertIncidentRadianceToIrradiance(),E.convertIrradianceToLambertianRadiance(),z.f.FromHarmonics(E)}}A._FileFaces=[new D("right",new N.jE(1,0,0),new N.jE(0,0,-1),new N.jE(0,-1,0)),new D("left",new N.jE(-1,0,0),new N.jE(0,0,1),new N.jE(0,-1,0)),new D("up",new N.jE(0,1,0),new N.jE(1,0,0),new N.jE(0,0,1)),new D("down",new N.jE(0,-1,0),new N.jE(1,0,0),new N.jE(0,0,-1)),new D("front",new N.jE(0,0,1),new N.jE(1,0,0),new N.jE(0,-1,0)),new D("back",new N.jE(0,0,-1),new N.jE(-1,0,0),new N.jE(0,-1,0))],A.MAX_HDRI_VALUE=4096,A.PRESERVE_CLAMPED_COLORS=!1},11946:(e,E,H)=>{H.r(E),H.d(E,{Dispose:()=>V,DumpData:()=>i,DumpDataAsync:()=>C,DumpFramebuffer:()=>A,DumpTools:()=>U});var N=H(11842),u=H(11532),z=H(11756),P=H(11579);let M,D=null;async function A(e,E,H,N){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",z=arguments.length>5?arguments[5]:void 0,P=arguments.length>6?arguments[6]:void 0;const M=await H.readPixels(0,0,e,E);i(e,E,new Uint8Array(M.buffer),N,u,z,!0,void 0,P)}async function C(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",u=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],P=arguments.length>6&&void 0!==arguments[6]&&arguments[6],M=arguments.length>7?arguments[7]:void 0;return await new Promise((D=>{i(e,E,H,(e=>D(e)),N,u,z,P,M)}))}function i(e,E,A,C){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",U=arguments.length>5?arguments[5]:void 0,j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]&&arguments[7],h=arguments.length>8?arguments[8]:void 0;(async function(){return D||(D=new Promise(((e,E)=>{let u,z=null;const D={EM:!0,depth:!1,nP:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(H.bind(H,11868)).then((A=>{let{ThinEngine:C}=A;const i=P.d.Instances.length;try{u=new OffscreenCanvas(100,100),z=new C(u,!1,D)}catch(F){var U;i<P.d.Instances.length&&(null===(U=P.d.Instances.pop())||void 0===U||U.dispose()),u=document.createElement("canvas"),z=new C(u,!1,D)}P.d.Instances.pop(),P.d.OnEnginesDisposedObservable.add((e=>{z&&e!==z&&!z.A&&0===P.d.Instances.length&&V()})),z.getCaps().parallelShaderCompile=void 0;const j=new N.e(z);H.e(52).then(H.bind(H,14168)).then((H=>{let{passPixelShader:P}=H;if(!z)return void E("Engine is not defined");const D=new N.f({UE:z,name:P.name,fragmentShader:P.shader,samplerNames:["textureSampler"]});M={canvas:u,UE:z,renderer:j,wrapper:D},e(M)}))})).catch(E)}))),await D})().then((H=>{if(H.UE.setSize(e,E,!0),A instanceof Float32Array){const e=new Uint8Array(A.length);let E=A.length;for(;E--;){const H=A[E];e[E]=Math.round(255*(0,z.Clamp)(H))}A=e}const N=H.UE.createRawTexture(A,e,E,5,!1,!j,1);H.renderer.setViewport(),H.renderer.applyEffectWrapper(H.wrapper),H.wrapper.effect._bindTexture("textureSampler",N),H.renderer.draw(),F?u.Tools.ToBlob(H.canvas,(e=>{const E=new FileReader;E.onload=e=>{const E=e.target.result;C&&C(E)},E.readAsArrayBuffer(e)}),i,h):u.Tools.EncodeScreenshotCanvasData(H.canvas,C,i,U,h),N.dispose()}))}function V(){var e;M?(M.wrapper.dispose(),M.renderer.dispose(),M.UE.dispose()):null===(e=D)||void 0===e||e.then((e=>{e.wrapper.dispose(),e.renderer.dispose(),e.UE.dispose()}));D=null,M=null}const U={DumpData:i,DumpDataAsync:C,DumpFramebuffer:A,Dispose:V};u.Tools.DumpData=i,u.Tools.DumpDataAsync=C,u.Tools.DumpFramebuffer=A},12219:(e,E,H)=>{H.d(E,{c:()=>z});var N=H(11840),u=H(11952);class z{static ExpandRGBDTexture(e){const E=e._texture;if(!E||!e.isRGBD)return;const u=E.getEngine(),z=u.getCaps(),P=E.isReady;let M=!1;z.textureHalfFloatRender&&z.textureHalfFloatLinearFiltering?(M=!0,E.type=2):z.textureFloatRender&&z.textureFloatLinearFiltering&&(M=!0,E.type=1),M&&(E.isReady=!1,E._isRGBD=!1,E.invertY=!1);const D=async()=>{const z=u.isWebGPU,P=z?1:0;E.isReady=!1,z?await H.e(42).then(H.bind(H,14721)):await H.e(35).then(H.bind(H,14724));const M=new N.c("rgbdDecode","rgbdDecode",null,null,1,null,3,u,!1,void 0,E.type,void 0,null,!1,void 0,P);M.externalTextureSamplerBinding=!0;const D=u.createRenderTargetTexture(E.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:E.samplingMode,type:E.type,format:5});M.onEffectCreatedObservable.addOnce((H=>{H.executeWhenCompiled((()=>{M.onApply=e=>{e._bindTexture("textureSampler",E),e.setFloat2("scale",1,1)},e.fe().postProcessManager.directRender([M],D,!0),u.restoreDefaultFramebuffer(),u._releaseTexture(E),M&&M.dispose(),D._swapAndDie(E),E.isReady=!0}))}))};M&&(P?D():e.onLoadObservable.addOnce(D))}static async EncodeTextureToRGBD(e,E){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return E.getEngine().isWebGPU?await H.e(43).then(H.bind(H,14734)):await H.e(36).then(H.bind(H,14727)),await(0,u.e)("rgbdEncode",e,E,N,1,5)}}}}]);