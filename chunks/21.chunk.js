"use strict";(self["5dou0t7wntc"]=self["5dou0t7wntc"]||[]).push([[20,21],{12254:(K,O,F)=>{var f=F(12257),r=F(11742);r.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(r.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=f.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((K=>{this._texture._sphericalPolynomial=K,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(K){this._texture&&(this._texture._sphericalPolynomial=K)},enumerable:!0,configurable:!0})},12257:(K,O,F)=>{F.d(O,{d:()=>E});var f=F(11713),r=F(11734),l=F(11924),q=F(11721),J=F(11764);class c{constructor(K,O,F,f){this.name=K,this.worldAxisForNormal=O,this.worldAxisForFileX=F,this.worldAxisForFileY=f}}class E{static ConvertCubeMapTextureToSphericalPolynomial(K){var O;if(!K.isCube)return null;null===(O=K.HK())||void 0===O||O.getEngine().flushFramebuffer();const F=K.getSize().width,f=K.readPixels(0,void 0,void 0,!1),r=K.readPixels(1,void 0,void 0,!1);let l,q;K.isRenderTarget?(l=K.readPixels(3,void 0,void 0,!1),q=K.readPixels(2,void 0,void 0,!1)):(l=K.readPixels(2,void 0,void 0,!1),q=K.readPixels(3,void 0,void 0,!1));const J=K.readPixels(4,void 0,void 0,!1),c=K.readPixels(5,void 0,void 0,!1),E=K.gammaSpace;let M=0;return 1!=K.textureType&&2!=K.textureType||(M=1),new Promise((K=>{Promise.all([r,f,l,q,J,c]).then((O=>{let[f,r,l,q,J,c]=O;const t={size:F,right:r,left:f,up:l,down:q,front:J,back:c,format:5,type:M,gammaSpace:E};K(this.ConvertCubeMapToSphericalPolynomial(t))}))}))}static _AreaElement(K,O){return Math.atan2(K*O,Math.sqrt(K*K+O*O+1))}static ConvertCubeMapToSphericalPolynomial(K){const O=new l.b;let F=0;const f=2/K.size,c=f,E=.5*f,M=E-1;for(let l=0;l<6;l++){const t=this._FileFaces[l],j=K[t.name];let X=M;const u=5===K.format?4:3;for(let l=0;l<K.size;l++){let T=M;for(let c=0;c<K.size;c++){const M=t.worldAxisForFileX.scale(T).add(t.worldAxisForFileY.scale(X)).add(t.worldAxisForNormal);M.normalize();const o=this._AreaElement(T-E,X-E)-this._AreaElement(T-E,X+E)-this._AreaElement(T+E,X-E)+this._AreaElement(T+E,X+E);let k=j[l*K.size*u+c*u+0],N=j[l*K.size*u+c*u+1],Z=j[l*K.size*u+c*u+2];isNaN(k)&&(k=0),isNaN(N)&&(N=0),isNaN(Z)&&(Z=0),0===K.type&&(k/=255,N/=255,Z/=255),K.gammaSpace&&(k=Math.pow((0,r.Clamp)(k),q.o),N=Math.pow((0,r.Clamp)(N),q.o),Z=Math.pow((0,r.Clamp)(Z),q.o));const L=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const K=Math.max(k,N,Z);if(K>L){const O=L/K;k*=O,N*=O,Z*=O}}else k=(0,r.Clamp)(k,0,L),N=(0,r.Clamp)(N,0,L),Z=(0,r.Clamp)(Z,0,L);const d=new J.ZO(k,N,Z);O.addLight(M,d,o),F+=o,T+=f}X+=c}}const t=6*(4*Math.PI)/6/F;return O.scaleInPlace(t),O.convertIncidentRadianceToIrradiance(),O.convertIrradianceToLambertianRadiance(),l.e.FromHarmonics(O)}}E._FileFaces=[new c("right",new f.TO(1,0,0),new f.TO(0,0,-1),new f.TO(0,-1,0)),new c("left",new f.TO(-1,0,0),new f.TO(0,0,1),new f.TO(0,-1,0)),new c("up",new f.TO(0,1,0),new f.TO(1,0,0),new f.TO(0,0,1)),new c("down",new f.TO(0,-1,0),new f.TO(1,0,0),new f.TO(0,0,-1)),new c("front",new f.TO(0,0,1),new f.TO(1,0,0),new f.TO(0,-1,0)),new c("back",new f.TO(0,0,-1),new f.TO(-1,0,0),new f.TO(0,-1,0))],E.MAX_HDRI_VALUE=4096,E.PRESERVE_CLAMPED_COLORS=!1},11951:(K,O,F)=>{F.r(O),F.d(O,{Dispose:()=>j,DumpData:()=>t,DumpDataAsync:()=>M,DumpFramebuffer:()=>E,DumpTools:()=>X});var f=F(11831),r=F(11517),l=F(11734),q=F(11559);let J,c=null;async function E(K,O,F,f){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",l=arguments.length>5?arguments[5]:void 0,q=arguments.length>6?arguments[6]:void 0;const J=await F.readPixels(0,0,K,O);t(K,O,new Uint8Array(J.buffer),f,r,l,!0,void 0,q)}async function M(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",r=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7?arguments[7]:void 0;return await new Promise((c=>{t(K,O,F,(K=>c(K)),f,r,l,q,J)}))}function t(K,O,E,M){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",X=arguments.length>5?arguments[5]:void 0,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],T=arguments.length>7&&void 0!==arguments[7]&&arguments[7],o=arguments.length>8?arguments[8]:void 0;(async function(){return c||(c=new Promise(((K,O)=>{let r,l=null;const c={vf:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(F.bind(F,11861)).then((E=>{let{ThinEngine:M}=E;const t=q.e.Instances.length;try{r=new OffscreenCanvas(100,100),l=new M(r,!1,c)}catch(T){var X;t<q.e.Instances.length&&(null===(X=q.e.Instances.pop())||void 0===X||X.dispose()),r=document.createElement("canvas"),l=new M(r,!1,c)}q.e.Instances.pop(),q.e.OnEnginesDisposedObservable.add((K=>{l&&K!==l&&!l.M&&0===q.e.Instances.length&&j()})),l.getCaps().parallelShaderCompile=void 0;const u=new f.c(l);F.e(52).then(F.bind(F,14215)).then((F=>{let{passPixelShader:q}=F;if(!l)return void O("Engine is not defined");const c=new f.e({uO:l,name:q.name,fragmentShader:q.shader,samplerNames:["textureSampler"]});J={canvas:r,uO:l,renderer:u,wrapper:c},K(J)}))})).catch(O)}))),await c})().then((F=>{if(F.uO.setSize(K,O,!0),E instanceof Float32Array){const K=new Uint8Array(E.length);let O=E.length;for(;O--;){const F=E[O];K[O]=Math.round(255*(0,l.Clamp)(F))}E=K}const f=F.uO.createRawTexture(E,K,O,5,!1,!u,1);F.renderer.setViewport(),F.renderer.applyEffectWrapper(F.wrapper),F.wrapper.effect._bindTexture("textureSampler",f),F.renderer.draw(),T?r.Tools.ToBlob(F.canvas,(K=>{const O=new FileReader;O.onload=K=>{const O=K.target.result;M&&M(O)},O.readAsArrayBuffer(K)}),t,o):r.Tools.EncodeScreenshotCanvasData(F.canvas,M,t,X,o),f.dispose()}))}function j(){var K;J?(J.wrapper.dispose(),J.renderer.dispose(),J.uO.dispose()):null===(K=c)||void 0===K||K.then((K=>{K.wrapper.dispose(),K.renderer.dispose(),K.uO.dispose()}));c=null,J=null}const X={DumpData:t,DumpDataAsync:M,DumpFramebuffer:E,Dispose:j};r.Tools.DumpData=t,r.Tools.DumpDataAsync=M,r.Tools.DumpFramebuffer=E},12246:(K,O,F)=>{F.d(O,{d:()=>l});var f=F(11825),r=F(11959);class l{static ExpandRGBDTexture(K){const O=K._texture;if(!O||!K.isRGBD)return;const r=O.getEngine(),l=r.getCaps(),q=O.isReady;let J=!1;l.textureHalfFloatRender&&l.textureHalfFloatLinearFiltering?(J=!0,O.type=2):l.textureFloatRender&&l.textureFloatLinearFiltering&&(J=!0,O.type=1),J&&(O.isReady=!1,O._isRGBD=!1,O.invertY=!1);const c=async()=>{const l=r.isWebGPU,q=l?1:0;O.isReady=!1,l?await F.e(42).then(F.bind(F,14765)):await F.e(35).then(F.bind(F,14774));const J=new f.e("rgbdDecode","rgbdDecode",null,null,1,null,3,r,!1,void 0,O.type,void 0,null,!1,void 0,q);J.externalTextureSamplerBinding=!0;const c=r.createRenderTargetTexture(O.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:O.samplingMode,type:O.type,format:5});J.onEffectCreatedObservable.addOnce((F=>{F.executeWhenCompiled((()=>{J.onApply=K=>{K._bindTexture("textureSampler",O),K.setFloat2("scale",1,1)},K.HK().postProcessManager.directRender([J],c,!0),r.restoreDefaultFramebuffer(),r._releaseTexture(O),J&&J.dispose(),c._swapAndDie(O),O.isReady=!0}))}))};J&&(q?c():K.onLoadObservable.addOnce(c))}static async EncodeTextureToRGBD(K,O){let f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return O.getEngine().isWebGPU?await F.e(43).then(F.bind(F,14784)):await F.e(36).then(F.bind(F,14780)),await(0,r.b)("rgbdEncode",K,O,f,1,5)}}}}]);