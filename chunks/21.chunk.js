"use strict";(self.fjf2z1c8il8=self.fjf2z1c8il8||[]).push([[20,21],{12986:(g,i,a)=>{var n=a(12989),L=a(12475);L.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(L.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=n.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((g=>{this._texture._sphericalPolynomial=g,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(g){this._texture&&(this._texture._sphericalPolynomial=g)},enumerable:!0,configurable:!0})},12989:(g,i,a)=>{a.d(i,{c:()=>N});var n=a(12452),L=a(12466),d=a(12648),b=a(12454),k=a(12496);class e{constructor(g,i,a,n){this.name=g,this.worldAxisForNormal=i,this.worldAxisForFileX=a,this.worldAxisForFileY=n}}class N{static ConvertCubeMapTextureToSphericalPolynomial(g){var i;if(!g.isCube)return null;null===(i=g.Pg())||void 0===i||i.getEngine().flushFramebuffer();const a=g.getSize().width,n=g.readPixels(0,void 0,void 0,!1),L=g.readPixels(1,void 0,void 0,!1);let d,b;g.isRenderTarget?(d=g.readPixels(3,void 0,void 0,!1),b=g.readPixels(2,void 0,void 0,!1)):(d=g.readPixels(2,void 0,void 0,!1),b=g.readPixels(3,void 0,void 0,!1));const k=g.readPixels(4,void 0,void 0,!1),e=g.readPixels(5,void 0,void 0,!1),N=g.gammaSpace;let F=0;return 1!=g.textureType&&2!=g.textureType||(F=1),new Promise((g=>{Promise.all([L,n,d,b,k,e]).then((i=>{let[n,L,d,b,k,e]=i;const I={size:a,right:L,left:n,up:d,down:b,front:k,back:e,format:5,type:F,gammaSpace:N};g(this.ConvertCubeMapToSphericalPolynomial(I))}))}))}static _AreaElement(g,i){return Math.atan2(g*i,Math.sqrt(g*g+i*i+1))}static ConvertCubeMapToSphericalPolynomial(g){const i=new d.b;let a=0;const n=2/g.size,e=n,N=.5*n,F=N-1;for(let d=0;d<6;d++){const I=this._FileFaces[d],j=g[I.name];let y=F;const B=5===g.format?4:3;for(let d=0;d<g.size;d++){let c=F;for(let e=0;e<g.size;e++){const F=I.worldAxisForFileX.scale(c).add(I.worldAxisForFileY.scale(y)).add(I.worldAxisForNormal);F.normalize();const D=this._AreaElement(c-N,y-N)-this._AreaElement(c-N,y+N)-this._AreaElement(c+N,y-N)+this._AreaElement(c+N,y+N);let p=j[d*g.size*B+e*B+0],R=j[d*g.size*B+e*B+1],x=j[d*g.size*B+e*B+2];isNaN(p)&&(p=0),isNaN(R)&&(R=0),isNaN(x)&&(x=0),0===g.type&&(p/=255,R/=255,x/=255),g.gammaSpace&&(p=Math.pow((0,L.Clamp)(p),b.l),R=Math.pow((0,L.Clamp)(R),b.l),x=Math.pow((0,L.Clamp)(x),b.l));const E=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const g=Math.max(p,R,x);if(g>E){const i=E/g;p*=i,R*=i,x*=i}}else p=(0,L.Clamp)(p,0,E),R=(0,L.Clamp)(R,0,E),x=(0,L.Clamp)(x,0,E);const X=new k.Ri(p,R,x);i.addLight(F,X,D),a+=D,c+=n}y+=e}}const I=6*(4*Math.PI)/6/a;return i.scaleInPlace(I),i.convertIncidentRadianceToIrradiance(),i.convertIrradianceToLambertianRadiance(),d.c.FromHarmonics(i)}}N._FileFaces=[new e("right",new n.Bi(1,0,0),new n.Bi(0,0,-1),new n.Bi(0,-1,0)),new e("left",new n.Bi(-1,0,0),new n.Bi(0,0,1),new n.Bi(0,-1,0)),new e("up",new n.Bi(0,1,0),new n.Bi(1,0,0),new n.Bi(0,0,1)),new e("down",new n.Bi(0,-1,0),new n.Bi(1,0,0),new n.Bi(0,0,-1)),new e("front",new n.Bi(0,0,1),new n.Bi(1,0,0),new n.Bi(0,-1,0)),new e("back",new n.Bi(0,0,-1),new n.Bi(-1,0,0),new n.Bi(0,-1,0))],N.MAX_HDRI_VALUE=4096,N.PRESERVE_CLAMPED_COLORS=!1},12681:(g,i,a)=>{a.r(i),a.d(i,{Dispose:()=>j,DumpData:()=>I,DumpDataAsync:()=>F,DumpFramebuffer:()=>N,DumpTools:()=>y});var n=a(12550),L=a(12277),d=a(12466),b=a(12316);let k,e=null;async function N(g,i,a,n){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",d=arguments.length>5?arguments[5]:void 0,b=arguments.length>6?arguments[6]:void 0;const k=await a.readPixels(0,0,g,i);I(g,i,new Uint8Array(k.buffer),n,L,d,!0,void 0,b)}async function F(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",L=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7?arguments[7]:void 0;return await new Promise((e=>{I(g,i,a,(g=>e(g)),n,L,d,b,k)}))}function I(g,i,N,F){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",y=arguments.length>5?arguments[5]:void 0,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],D=arguments.length>8?arguments[8]:void 0;(async function(){return e||(e=new Promise(((g,i)=>{let L,d=null;const e={vd:!0,depth:!1,bd:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(a.bind(a,12578)).then((N=>{let{ThinEngine:F}=N;const I=b.c.Instances.length;try{L=new OffscreenCanvas(100,100),d=new F(L,!1,e)}catch(c){var y;I<b.c.Instances.length&&(null===(y=b.c.Instances.pop())||void 0===y||y.dispose()),L=document.createElement("canvas"),d=new F(L,!1,e)}b.c.Instances.pop(),b.c.OnEnginesDisposedObservable.add((g=>{d&&g!==d&&!d.p&&0===b.c.Instances.length&&j()})),d.getCaps().parallelShaderCompile=void 0;const B=new n.e(d);a.e(52).then(a.bind(a,15022)).then((a=>{let{passPixelShader:b}=a;if(!d)return void i("Engine is not defined");const e=new n.f({yi:d,name:b.name,fragmentShader:b.shader,samplerNames:["textureSampler"]});k={canvas:L,yi:d,renderer:B,wrapper:e},g(k)}))})).catch(i)}))),await e})().then((a=>{if(a.yi.setSize(g,i,!0),N instanceof Float32Array){const g=new Uint8Array(N.length);let i=N.length;for(;i--;){const a=N[i];g[i]=Math.round(255*(0,d.Clamp)(a))}N=g}const n=a.yi.createRawTexture(N,g,i,5,!1,!B,1);a.renderer.setViewport(),a.renderer.applyEffectWrapper(a.wrapper),a.wrapper.effect._bindTexture("textureSampler",n),a.renderer.draw(),c?L.Tools.ToBlob(a.canvas,(g=>{const i=new FileReader;i.onload=g=>{const i=g.target.result;F&&F(i)},i.readAsArrayBuffer(g)}),I,D):L.Tools.EncodeScreenshotCanvasData(a.canvas,F,I,y,D),n.dispose()}))}function j(){var g;k?(k.wrapper.dispose(),k.renderer.dispose(),k.yi.dispose()):null===(g=e)||void 0===g||g.then((g=>{g.wrapper.dispose(),g.renderer.dispose(),g.yi.dispose()}));e=null,k=null}const y={DumpData:I,DumpDataAsync:F,DumpFramebuffer:N,Dispose:j};L.Tools.DumpData=I,L.Tools.DumpDataAsync=F,L.Tools.DumpFramebuffer=N},12974:(g,i,a)=>{a.d(i,{c:()=>d});var n=a(12548),L=a(12684);class d{static ExpandRGBDTexture(g){const i=g._texture;if(!i||!g.isRGBD)return;const L=i.getEngine(),d=L.getCaps(),b=i.isReady;let k=!1;d.textureHalfFloatRender&&d.textureHalfFloatLinearFiltering?(k=!0,i.type=2):d.textureFloatRender&&d.textureFloatLinearFiltering&&(k=!0,i.type=1),k&&(i.isReady=!1,i._isRGBD=!1,i.invertY=!1);const e=async()=>{const d=L.isWebGPU,b=d?1:0;i.isReady=!1,d?await a.e(42).then(a.bind(a,15573)):await a.e(35).then(a.bind(a,15577));const k=new n.e("rgbdDecode","rgbdDecode",null,null,1,null,3,L,!1,void 0,i.type,void 0,null,!1,void 0,b);k.externalTextureSamplerBinding=!0;const e=L.createRenderTargetTexture(i.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:i.samplingMode,type:i.type,format:5});k.onEffectCreatedObservable.addOnce((a=>{a.executeWhenCompiled((()=>{k.onApply=g=>{g._bindTexture("textureSampler",i),g.setFloat2("scale",1,1)},g.Pg().postProcessManager.directRender([k],e,!0),L.restoreDefaultFramebuffer(),L._releaseTexture(i),k&&k.dispose(),e._swapAndDie(i),i.isReady=!0}))}))};k&&(b?e():g.onLoadObservable.addOnce(e))}static async EncodeTextureToRGBD(g,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return i.getEngine().isWebGPU?await a.e(43).then(a.bind(a,15588)):await a.e(36).then(a.bind(a,15586)),await(0,L.d)("rgbdEncode",g,i,n,1,5)}}}}]);