"use strict";(self["9s4i8ue3jq"]=self["9s4i8ue3jq"]||[]).push([[20,21],{13305:(a,c,o)=>{var s=o(13313),q=o(12833);q.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(q.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=s.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((a=>{this._texture._sphericalPolynomial=a,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(a){this._texture&&(this._texture._sphericalPolynomial=a)},enumerable:!0,configurable:!0})},13313:(a,c,o)=>{o.d(c,{e:()=>T});var s=o(12810),q=o(12824),t=o(12993),i=o(12812),p=o(12858);class G{constructor(a,c,o,s){this.name=a,this.worldAxisForNormal=c,this.worldAxisForFileX=o,this.worldAxisForFileY=s}}class T{static ConvertCubeMapTextureToSphericalPolynomial(a){var c;if(!a.isCube)return null;null===(c=a.Za())||void 0===c||c.getEngine().flushFramebuffer();const o=a.getSize().width,s=a.readPixels(0,void 0,void 0,!1),q=a.readPixels(1,void 0,void 0,!1);let t,i;a.isRenderTarget?(t=a.readPixels(3,void 0,void 0,!1),i=a.readPixels(2,void 0,void 0,!1)):(t=a.readPixels(2,void 0,void 0,!1),i=a.readPixels(3,void 0,void 0,!1));const p=a.readPixels(4,void 0,void 0,!1),G=a.readPixels(5,void 0,void 0,!1),T=a.gammaSpace;let C=0;return 1!=a.textureType&&2!=a.textureType||(C=1),new Promise((a=>{Promise.all([q,s,t,i,p,G]).then((c=>{let[s,q,t,i,p,G]=c;const j={size:o,right:q,left:s,up:t,down:i,front:p,back:G,format:5,type:C,gammaSpace:T};a(this.ConvertCubeMapToSphericalPolynomial(j))}))}))}static _AreaElement(a,c){return Math.atan2(a*c,Math.sqrt(a*a+c*c+1))}static ConvertCubeMapToSphericalPolynomial(a){const c=new t.d;let o=0;const s=2/a.size,G=s,T=.5*s,C=T-1;for(let t=0;t<6;t++){const j=this._FileFaces[t],L=a[j.name];let e=C;const g=5===a.format?4:3;for(let t=0;t<a.size;t++){let M=C;for(let G=0;G<a.size;G++){const C=j.worldAxisForFileX.scale(M).add(j.worldAxisForFileY.scale(e)).add(j.worldAxisForNormal);C.normalize();const N=this._AreaElement(M-T,e-T)-this._AreaElement(M-T,e+T)-this._AreaElement(M+T,e-T)+this._AreaElement(M+T,e+T);let y=L[t*a.size*g+G*g+0],k=L[t*a.size*g+G*g+1],n=L[t*a.size*g+G*g+2];isNaN(y)&&(y=0),isNaN(k)&&(k=0),isNaN(n)&&(n=0),0===a.type&&(y/=255,k/=255,n/=255),a.gammaSpace&&(y=Math.pow((0,q.Clamp)(y),i.i),k=Math.pow((0,q.Clamp)(k),i.i),n=Math.pow((0,q.Clamp)(n),i.i));const f=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const a=Math.max(y,k,n);if(a>f){const c=f/a;y*=c,k*=c,n*=c}}else y=(0,q.Clamp)(y,0,f),k=(0,q.Clamp)(k,0,f),n=(0,q.Clamp)(n,0,f);const J=new p.oo(y,k,n);c.addLight(C,J,N),o+=N,M+=s}e+=G}}const j=6*(4*Math.PI)/6/o;return c.scaleInPlace(j),c.convertIncidentRadianceToIrradiance(),c.convertIrradianceToLambertianRadiance(),t.e.FromHarmonics(c)}}T._FileFaces=[new G("right",new s.Hc(1,0,0),new s.Hc(0,0,-1),new s.Hc(0,-1,0)),new G("left",new s.Hc(-1,0,0),new s.Hc(0,0,1),new s.Hc(0,-1,0)),new G("up",new s.Hc(0,1,0),new s.Hc(1,0,0),new s.Hc(0,0,1)),new G("down",new s.Hc(0,-1,0),new s.Hc(1,0,0),new s.Hc(0,0,-1)),new G("front",new s.Hc(0,0,1),new s.Hc(1,0,0),new s.Hc(0,-1,0)),new G("back",new s.Hc(0,0,-1),new s.Hc(-1,0,0),new s.Hc(0,-1,0))],T.MAX_HDRI_VALUE=4096,T.PRESERVE_CLAMPED_COLORS=!1},13027:(a,c,o)=>{o.r(c),o.d(c,{Dispose:()=>L,DumpData:()=>j,DumpDataAsync:()=>C,DumpFramebuffer:()=>T,DumpTools:()=>e});var s=o(12910),q=o(12637),t=o(12824),i=o(12680);let p,G=null;async function T(a,c,o,s){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",t=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0;const p=await o.readPixels(0,0,a,c);j(a,c,new Uint8Array(p.buffer),s,q,t,!0,void 0,i)}async function C(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",q=arguments.length>4?arguments[4]:void 0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7?arguments[7]:void 0;return await new Promise((G=>{j(a,c,o,(a=>G(a)),s,q,t,i,p)}))}function j(a,c,T,C){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",e=arguments.length>5?arguments[5]:void 0,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],M=arguments.length>7&&void 0!==arguments[7]&&arguments[7],N=arguments.length>8?arguments[8]:void 0;(async function(){return G||(G=new Promise(((a,c)=>{let q,t=null;const G={fc:!0,depth:!1,Nc:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(o.bind(o,12945)).then((T=>{let{ThinEngine:C}=T;const j=i.b.Instances.length;try{q=new OffscreenCanvas(100,100),t=new C(q,!1,G)}catch(M){var e;j<i.b.Instances.length&&(null===(e=i.b.Instances.pop())||void 0===e||e.dispose()),q=document.createElement("canvas"),t=new C(q,!1,G)}i.b.Instances.pop(),i.b.OnEnginesDisposedObservable.add((a=>{t&&a!==t&&!t.L&&0===i.b.Instances.length&&L()})),t.getCaps().parallelShaderCompile=void 0;const g=new s.d(t);o.e(52).then(o.bind(o,15260)).then((o=>{let{passPixelShader:i}=o;if(!t)return void c("Engine is not defined");const G=new s.h({mo:t,name:i.name,fragmentShader:i.shader,samplerNames:["textureSampler"]});p={canvas:q,mo:t,renderer:g,wrapper:G},a(p)}))})).catch(c)}))),await G})().then((o=>{if(o.mo.setSize(a,c,!0),T instanceof Float32Array){const a=new Uint8Array(T.length);let c=T.length;for(;c--;){const o=T[c];a[c]=Math.round(255*(0,t.Clamp)(o))}T=a}const s=o.mo.createRawTexture(T,a,c,5,!1,!g,1);o.renderer.setViewport(),o.renderer.applyEffectWrapper(o.wrapper),o.wrapper.effect._bindTexture("textureSampler",s),o.renderer.draw(),M?q.Tools.ToBlob(o.canvas,(a=>{const c=new FileReader;c.onload=a=>{const c=a.target.result;C&&C(c)},c.readAsArrayBuffer(a)}),j,N):q.Tools.EncodeScreenshotCanvasData(o.canvas,C,j,e,N),s.dispose()}))}function L(){var a;p?(p.wrapper.dispose(),p.renderer.dispose(),p.mo.dispose()):null===(a=G)||void 0===a||a.then((a=>{a.wrapper.dispose(),a.renderer.dispose(),a.mo.dispose()}));G=null,p=null}const e={DumpData:j,DumpDataAsync:C,DumpFramebuffer:T,Dispose:L};q.Tools.DumpData=j,q.Tools.DumpDataAsync=C,q.Tools.DumpFramebuffer=T},13293:(a,c,o)=>{o.d(c,{d:()=>t});var s=o(12904),q=o(13035);class t{static ExpandRGBDTexture(a){const c=a._texture;if(!c||!a.isRGBD)return;const q=c.getEngine(),t=q.getCaps(),i=c.isReady;let p=!1;t.textureHalfFloatRender&&t.textureHalfFloatLinearFiltering?(p=!0,c.type=2):t.textureFloatRender&&t.textureFloatLinearFiltering&&(p=!0,c.type=1),p&&(c.isReady=!1,c._isRGBD=!1,c.invertY=!1);const G=async()=>{const t=q.isWebGPU,i=t?1:0;c.isReady=!1,t?await o.e(42).then(o.bind(o,15810)):await o.e(35).then(o.bind(o,15812));const p=new s.c("rgbdDecode","rgbdDecode",null,null,1,null,3,q,!1,void 0,c.type,void 0,null,!1,void 0,i);p.externalTextureSamplerBinding=!0;const G=q.createRenderTargetTexture(c.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:c.samplingMode,type:c.type,format:5});p.onEffectCreatedObservable.addOnce((o=>{o.executeWhenCompiled((()=>{p.onApply=a=>{a._bindTexture("textureSampler",c),a.setFloat2("scale",1,1)},a.Za().postProcessManager.directRender([p],G,!0),q.restoreDefaultFramebuffer(),q._releaseTexture(c),p&&p.dispose(),G._swapAndDie(c),c.isReady=!0}))}))};p&&(i?G():a.onLoadObservable.addOnce(G))}static async EncodeTextureToRGBD(a,c){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return c.getEngine().isWebGPU?await o.e(43).then(o.bind(o,15828)):await o.e(36).then(o.bind(o,15820)),await(0,q.c)("rgbdEncode",a,c,s,1,5)}}}}]);