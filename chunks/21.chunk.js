"use strict";(self.lfntwv94xlc=self.lfntwv94xlc||[]).push([[20,21],{11822:(m,S,h)=>{var l=h(11829),M=h(11368);M.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(M.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=l.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((m=>{this._texture._sphericalPolynomial=m,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(m){this._texture&&(this._texture._sphericalPolynomial=m)},enumerable:!0,configurable:!0})},11829:(m,S,h)=>{h.d(S,{b:()=>Y});var l=h(11347),M=h(11359),O=h(11520),u=h(11350),b=h(11387);class q{constructor(m,S,h,l){this.name=m,this.worldAxisForNormal=S,this.worldAxisForFileX=h,this.worldAxisForFileY=l}}class Y{static ConvertCubeMapTextureToSphericalPolynomial(m){var S;if(!m.isCube)return null;null===(S=m.sm())||void 0===S||S.getEngine().flushFramebuffer();const h=m.getSize().width,l=m.readPixels(0,void 0,void 0,!1),M=m.readPixels(1,void 0,void 0,!1);let O,u;m.isRenderTarget?(O=m.readPixels(3,void 0,void 0,!1),u=m.readPixels(2,void 0,void 0,!1)):(O=m.readPixels(2,void 0,void 0,!1),u=m.readPixels(3,void 0,void 0,!1));const b=m.readPixels(4,void 0,void 0,!1),q=m.readPixels(5,void 0,void 0,!1),Y=m.gammaSpace;let V=0;return 1!=m.textureType&&2!=m.textureType||(V=1),new Promise((m=>{Promise.all([M,l,O,u,b,q]).then((S=>{let[l,M,O,u,b,q]=S;const I={size:h,right:M,left:l,up:O,down:u,front:b,back:q,format:5,type:V,gammaSpace:Y};m(this.ConvertCubeMapToSphericalPolynomial(I))}))}))}static _AreaElement(m,S){return Math.atan2(m*S,Math.sqrt(m*m+S*S+1))}static ConvertCubeMapToSphericalPolynomial(m){const S=new O.e;let h=0;const l=2/m.size,q=l,Y=.5*l,V=Y-1;for(let O=0;O<6;O++){const I=this._FileFaces[O],Z=m[I.name];let C=V;const B=5===m.format?4:3;for(let O=0;O<m.size;O++){let D=V;for(let q=0;q<m.size;q++){const V=I.worldAxisForFileX.scale(D).add(I.worldAxisForFileY.scale(C)).add(I.worldAxisForNormal);V.normalize();const E=this._AreaElement(D-Y,C-Y)-this._AreaElement(D-Y,C+Y)-this._AreaElement(D+Y,C-Y)+this._AreaElement(D+Y,C+Y);let n=Z[O*m.size*B+q*B+0],L=Z[O*m.size*B+q*B+1],U=Z[O*m.size*B+q*B+2];isNaN(n)&&(n=0),isNaN(L)&&(L=0),isNaN(U)&&(U=0),0===m.type&&(n/=255,L/=255,U/=255),m.gammaSpace&&(n=Math.pow((0,M.Clamp)(n),u.h),L=Math.pow((0,M.Clamp)(L),u.h),U=Math.pow((0,M.Clamp)(U),u.h));const H=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const m=Math.max(n,L,U);if(m>H){const S=H/m;n*=S,L*=S,U*=S}}else n=(0,M.Clamp)(n,0,H),L=(0,M.Clamp)(L,0,H),U=(0,M.Clamp)(U,0,H);const R=new b.RS(n,L,U);S.addLight(V,R,E),h+=E,D+=l}C+=q}}const I=6*(4*Math.PI)/6/h;return S.scaleInPlace(I),S.convertIncidentRadianceToIrradiance(),S.convertIrradianceToLambertianRadiance(),O.i.FromHarmonics(S)}}Y._FileFaces=[new q("right",new l.nS(1,0,0),new l.nS(0,0,-1),new l.nS(0,-1,0)),new q("left",new l.nS(-1,0,0),new l.nS(0,0,1),new l.nS(0,-1,0)),new q("up",new l.nS(0,1,0),new l.nS(1,0,0),new l.nS(0,0,1)),new q("down",new l.nS(0,-1,0),new l.nS(1,0,0),new l.nS(0,0,-1)),new q("front",new l.nS(0,0,1),new l.nS(1,0,0),new l.nS(0,-1,0)),new q("back",new l.nS(0,0,-1),new l.nS(-1,0,0),new l.nS(0,-1,0))],Y.MAX_HDRI_VALUE=4096,Y.PRESERVE_CLAMPED_COLORS=!1},11550:(m,S,h)=>{h.r(S),h.d(S,{Dispose:()=>Z,DumpData:()=>I,DumpDataAsync:()=>V,DumpFramebuffer:()=>Y,DumpTools:()=>C});var l=h(11446),M=h(11156),O=h(11359),u=h(11196);let b,q=null;async function Y(m,S,h,l){let M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",O=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0;const b=await h.readPixels(0,0,m,S);I(m,S,new Uint8Array(b.buffer),l,M,O,!0,void 0,u)}async function V(m,S,h){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",M=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7?arguments[7]:void 0;return await new Promise((q=>{I(m,S,h,(m=>q(m)),l,M,O,u,b)}))}function I(m,S,Y,V){let I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",C=arguments.length>5?arguments[5]:void 0,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7&&void 0!==arguments[7]&&arguments[7],E=arguments.length>8?arguments[8]:void 0;(async function(){return q||(q=new Promise(((m,S)=>{let M,O=null;const q={o:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(h.bind(h,11463)).then((Y=>{let{ThinEngine:V}=Y;const I=u.d.Instances.length;try{M=new OffscreenCanvas(100,100),O=new V(M,!1,q)}catch(D){var C;I<u.d.Instances.length&&(null===(C=u.d.Instances.pop())||void 0===C||C.dispose()),M=document.createElement("canvas"),O=new V(M,!1,q)}u.d.Instances.pop(),u.d.OnEnginesDisposedObservable.add((m=>{O&&m!==O&&!O.u&&0===u.d.Instances.length&&Z()})),O.getCaps().parallelShaderCompile=void 0;const B=new l.b(O);h.e(52).then(h.bind(h,13867)).then((h=>{let{passPixelShader:u}=h;if(!O)return void S("Engine is not defined");const q=new l.d({ES:O,name:u.name,fragmentShader:u.shader,samplerNames:["textureSampler"]});b={canvas:M,ES:O,renderer:B,wrapper:q},m(b)}))})).catch(S)}))),await q})().then((h=>{if(h.ES.setSize(m,S,!0),Y instanceof Float32Array){const m=new Uint8Array(Y.length);let S=Y.length;for(;S--;){const h=Y[S];m[S]=Math.round(255*(0,O.Clamp)(h))}Y=m}const l=h.ES.createRawTexture(Y,m,S,5,!1,!B,1);h.renderer.setViewport(),h.renderer.applyEffectWrapper(h.wrapper),h.wrapper.effect._bindTexture("textureSampler",l),h.renderer.draw(),D?M.Tools.ToBlob(h.canvas,(m=>{const S=new FileReader;S.onload=m=>{const S=m.target.result;V&&V(S)},S.readAsArrayBuffer(m)}),I,E):M.Tools.EncodeScreenshotCanvasData(h.canvas,V,I,C,E),l.dispose()}))}function Z(){var m;b?(b.wrapper.dispose(),b.renderer.dispose(),b.ES.dispose()):null===(m=q)||void 0===m||m.then((m=>{m.wrapper.dispose(),m.renderer.dispose(),m.ES.dispose()}));q=null,b=null}const C={DumpData:I,DumpDataAsync:V,DumpFramebuffer:Y,Dispose:Z};M.Tools.DumpData=I,M.Tools.DumpDataAsync=V,M.Tools.DumpFramebuffer=Y},11811:(m,S,h)=>{h.d(S,{b:()=>O});var l=h(11441),M=h(11556);class O{static ExpandRGBDTexture(m){const S=m._texture;if(!S||!m.isRGBD)return;const M=S.getEngine(),O=M.getCaps(),u=S.isReady;let b=!1;O.textureHalfFloatRender&&O.textureHalfFloatLinearFiltering?(b=!0,S.type=2):O.textureFloatRender&&O.textureFloatLinearFiltering&&(b=!0,S.type=1),b&&(S.isReady=!1,S._isRGBD=!1,S.invertY=!1);const q=async()=>{const O=M.isWebGPU,u=O?1:0;S.isReady=!1,O?await h.e(42).then(h.bind(h,14415)):await h.e(35).then(h.bind(h,14424));const b=new l.e("rgbdDecode","rgbdDecode",null,null,1,null,3,M,!1,void 0,S.type,void 0,null,!1,void 0,u);b.externalTextureSamplerBinding=!0;const q=M.createRenderTargetTexture(S.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:S.samplingMode,type:S.type,format:5});b.onEffectCreatedObservable.addOnce((h=>{h.executeWhenCompiled((()=>{b.onApply=m=>{m._bindTexture("textureSampler",S),m.setFloat2("scale",1,1)},m.sm().postProcessManager.directRender([b],q,!0),M.restoreDefaultFramebuffer(),M._releaseTexture(S),b&&b.dispose(),q._swapAndDie(S),S.isReady=!0}))}))};b&&(u?q():m.onLoadObservable.addOnce(q))}static async EncodeTextureToRGBD(m,S){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return S.getEngine().isWebGPU?await h.e(43).then(h.bind(h,14433)):await h.e(36).then(h.bind(h,14427)),await(0,M.e)("rgbdEncode",m,S,l,1,5)}}}}]);