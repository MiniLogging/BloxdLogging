"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[20,21],{11717:(P,f,Y)=>{var C=Y(11723),q=Y(11203);q.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(q.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=C.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((P=>{this._texture._sphericalPolynomial=P,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(P){this._texture&&(this._texture._sphericalPolynomial=P)},enumerable:!0,configurable:!0})},11723:(P,f,Y)=>{Y.d(f,{b:()=>d});var C=Y(11179),q=Y(11198),m=Y(11377),L=Y(11187),o=Y(11228);class w{constructor(P,f,Y,C){this.name=P,this.worldAxisForNormal=f,this.worldAxisForFileX=Y,this.worldAxisForFileY=C}}class d{static ConvertCubeMapTextureToSphericalPolynomial(P){var f;if(!P.isCube)return null;null===(f=P.vP())||void 0===f||f.getEngine().flushFramebuffer();const Y=P.getSize().width,C=P.readPixels(0,void 0,void 0,!1),q=P.readPixels(1,void 0,void 0,!1);let m,L;P.isRenderTarget?(m=P.readPixels(3,void 0,void 0,!1),L=P.readPixels(2,void 0,void 0,!1)):(m=P.readPixels(2,void 0,void 0,!1),L=P.readPixels(3,void 0,void 0,!1));const o=P.readPixels(4,void 0,void 0,!1),w=P.readPixels(5,void 0,void 0,!1),d=P.gammaSpace;let R=0;return 1!=P.textureType&&2!=P.textureType||(R=1),new Promise((P=>{Promise.all([q,C,m,L,o,w]).then((f=>{let[C,q,m,L,o,w]=f;const y={size:Y,right:q,left:C,up:m,down:L,front:o,back:w,format:5,type:R,gammaSpace:d};P(this.ConvertCubeMapToSphericalPolynomial(y))}))}))}static _AreaElement(P,f){return Math.atan2(P*f,Math.sqrt(P*P+f*f+1))}static ConvertCubeMapToSphericalPolynomial(P){const f=new m.e;let Y=0;const C=2/P.size,w=C,d=.5*C,R=d-1;for(let m=0;m<6;m++){const y=this._FileFaces[m],r=P[y.name];let i=R;const u=5===P.format?4:3;for(let m=0;m<P.size;m++){let g=R;for(let w=0;w<P.size;w++){const R=y.worldAxisForFileX.scale(g).add(y.worldAxisForFileY.scale(i)).add(y.worldAxisForNormal);R.normalize();const S=this._AreaElement(g-d,i-d)-this._AreaElement(g-d,i+d)-this._AreaElement(g+d,i-d)+this._AreaElement(g+d,i+d);let K=r[m*P.size*u+w*u+0],M=r[m*P.size*u+w*u+1],V=r[m*P.size*u+w*u+2];isNaN(K)&&(K=0),isNaN(M)&&(M=0),isNaN(V)&&(V=0),0===P.type&&(K/=255,M/=255,V/=255),P.gammaSpace&&(K=Math.pow((0,q.Clamp)(K),L.k),M=Math.pow((0,q.Clamp)(M),L.k),V=Math.pow((0,q.Clamp)(V),L.k));const O=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const P=Math.max(K,M,V);if(P>O){const f=O/P;K*=f,M*=f,V*=f}}else K=(0,q.Clamp)(K,0,O),M=(0,q.Clamp)(M,0,O),V=(0,q.Clamp)(V,0,O);const n=new o.Df(K,M,V);f.addLight(R,n,S),Y+=S,g+=C}i+=w}}const y=6*(4*Math.PI)/6/Y;return f.scaleInPlace(y),f.convertIncidentRadianceToIrradiance(),f.convertIrradianceToLambertianRadiance(),m.f.FromHarmonics(f)}}d._FileFaces=[new w("right",new C.Of(1,0,0),new C.Of(0,0,-1),new C.Of(0,-1,0)),new w("left",new C.Of(-1,0,0),new C.Of(0,0,1),new C.Of(0,-1,0)),new w("up",new C.Of(0,1,0),new C.Of(1,0,0),new C.Of(0,0,1)),new w("down",new C.Of(0,-1,0),new C.Of(1,0,0),new C.Of(0,0,-1)),new w("front",new C.Of(0,0,1),new C.Of(1,0,0),new C.Of(0,-1,0)),new w("back",new C.Of(0,0,-1),new C.Of(-1,0,0),new C.Of(0,-1,0))],d.MAX_HDRI_VALUE=4096,d.PRESERVE_CLAMPED_COLORS=!1},11413:(P,f,Y)=>{Y.r(f),Y.d(f,{Dispose:()=>r,DumpData:()=>y,DumpDataAsync:()=>R,DumpFramebuffer:()=>d,DumpTools:()=>i});var C=Y(11286),q=Y(11014),m=Y(11198),L=Y(11052);let o,w=null;async function d(P,f,Y,C){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",m=arguments.length>5?arguments[5]:void 0,L=arguments.length>6?arguments[6]:void 0;const o=await Y.readPixels(0,0,P,f);y(P,f,new Uint8Array(o.buffer),C,q,m,!0,void 0,L)}async function R(P,f,Y){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",q=arguments.length>4?arguments[4]:void 0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7?arguments[7]:void 0;return await new Promise((w=>{y(P,f,Y,(P=>w(P)),C,q,m,L,o)}))}function y(P,f,d,R){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",i=arguments.length>5?arguments[5]:void 0,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7&&void 0!==arguments[7]&&arguments[7],S=arguments.length>8?arguments[8]:void 0;(async function(){return w||(w=new Promise(((P,f)=>{let q,m=null;const w={o:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(Y.bind(Y,11322)).then((d=>{let{ThinEngine:R}=d;const y=L.e.Instances.length;try{q=new OffscreenCanvas(100,100),m=new R(q,!1,w)}catch(g){var i;y<L.e.Instances.length&&(null===(i=L.e.Instances.pop())||void 0===i||i.dispose()),q=document.createElement("canvas"),m=new R(q,!1,w)}L.e.Instances.pop(),L.e.OnEnginesDisposedObservable.add((P=>{m&&P!==m&&!m.R&&0===L.e.Instances.length&&r()})),m.getCaps().parallelShaderCompile=void 0;const u=new C.e(m);Y.e(52).then(Y.bind(Y,13705)).then((Y=>{let{passPixelShader:L}=Y;if(!m)return void f("Engine is not defined");const w=new C.i({Kf:m,name:L.name,fragmentShader:L.shader,samplerNames:["textureSampler"]});o={canvas:q,Kf:m,renderer:u,wrapper:w},P(o)}))})).catch(f)}))),await w})().then((Y=>{if(Y.Kf.setSize(P,f,!0),d instanceof Float32Array){const P=new Uint8Array(d.length);let f=d.length;for(;f--;){const Y=d[f];P[f]=Math.round(255*(0,m.Clamp)(Y))}d=P}const C=Y.Kf.createRawTexture(d,P,f,5,!1,!u,1);Y.renderer.setViewport(),Y.renderer.applyEffectWrapper(Y.wrapper),Y.wrapper.effect._bindTexture("textureSampler",C),Y.renderer.draw(),g?q.Tools.ToBlob(Y.canvas,(P=>{const f=new FileReader;f.onload=P=>{const f=P.target.result;R&&R(f)},f.readAsArrayBuffer(P)}),y,S):q.Tools.EncodeScreenshotCanvasData(Y.canvas,R,y,i,S),C.dispose()}))}function r(){var P;o?(o.wrapper.dispose(),o.renderer.dispose(),o.Kf.dispose()):null===(P=w)||void 0===P||P.then((P=>{P.wrapper.dispose(),P.renderer.dispose(),P.Kf.dispose()}));w=null,o=null}const i={DumpData:y,DumpDataAsync:R,DumpFramebuffer:d,Dispose:r};q.Tools.DumpData=y,q.Tools.DumpDataAsync=R,q.Tools.DumpFramebuffer=d},11705:(P,f,Y)=>{Y.d(f,{b:()=>m});var C=Y(11283),q=Y(11421);class m{static ExpandRGBDTexture(P){const f=P._texture;if(!f||!P.isRGBD)return;const q=f.getEngine(),m=q.getCaps(),L=f.isReady;let o=!1;m.textureHalfFloatRender&&m.textureHalfFloatLinearFiltering?(o=!0,f.type=2):m.textureFloatRender&&m.textureFloatLinearFiltering&&(o=!0,f.type=1),o&&(f.isReady=!1,f._isRGBD=!1,f.invertY=!1);const w=async()=>{const m=q.isWebGPU,L=m?1:0;f.isReady=!1,m?await Y.e(42).then(Y.bind(Y,14218)):await Y.e(35).then(Y.bind(Y,14220));const o=new C.c("rgbdDecode","rgbdDecode",null,null,1,null,3,q,!1,void 0,f.type,void 0,null,!1,void 0,L);o.externalTextureSamplerBinding=!0;const w=q.createRenderTargetTexture(f.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:f.samplingMode,type:f.type,format:5});o.onEffectCreatedObservable.addOnce((Y=>{Y.executeWhenCompiled((()=>{o.onApply=P=>{P._bindTexture("textureSampler",f),P.setFloat2("scale",1,1)},P.vP().postProcessManager.directRender([o],w,!0),q.restoreDefaultFramebuffer(),q._releaseTexture(f),o&&o.dispose(),w._swapAndDie(f),f.isReady=!0}))}))};o&&(L?w():P.onLoadObservable.addOnce(w))}static async EncodeTextureToRGBD(P,f){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return f.getEngine().isWebGPU?await Y.e(43).then(Y.bind(Y,14233)):await Y.e(36).then(Y.bind(Y,14227)),await(0,q.b)("rgbdEncode",P,f,C,1,5)}}}}]);