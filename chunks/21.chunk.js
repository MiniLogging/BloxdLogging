"use strict";(self.c2c3ycupenc=self.c2c3ycupenc||[]).push([[20,21],{12191:(c,r,D)=>{var W=D(12197),B=D(11705);B.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(B.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=W.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((c=>{this._texture._sphericalPolynomial=c,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(c){this._texture&&(this._texture._sphericalPolynomial=c)},enumerable:!0,configurable:!0})},12197:(c,r,D)=>{D.d(r,{d:()=>x});var W=D(11683),B=D(11696),t=D(11868),u=D(11687),a=D(11722);class H{constructor(c,r,D,W){this.name=c,this.worldAxisForNormal=r,this.worldAxisForFileX=D,this.worldAxisForFileY=W}}class x{static ConvertCubeMapTextureToSphericalPolynomial(c){var r;if(!c.isCube)return null;null===(r=c.yc())||void 0===r||r.getEngine().flushFramebuffer();const D=c.getSize().width,W=c.readPixels(0,void 0,void 0,!1),B=c.readPixels(1,void 0,void 0,!1);let t,u;c.isRenderTarget?(t=c.readPixels(3,void 0,void 0,!1),u=c.readPixels(2,void 0,void 0,!1)):(t=c.readPixels(2,void 0,void 0,!1),u=c.readPixels(3,void 0,void 0,!1));const a=c.readPixels(4,void 0,void 0,!1),H=c.readPixels(5,void 0,void 0,!1),x=c.gammaSpace;let M=0;return 1!=c.textureType&&2!=c.textureType||(M=1),new Promise((c=>{Promise.all([B,W,t,u,a,H]).then((r=>{let[W,B,t,u,a,H]=r;const E={size:D,right:B,left:W,up:t,down:u,front:a,back:H,format:5,type:M,gammaSpace:x};c(this.ConvertCubeMapToSphericalPolynomial(E))}))}))}static _AreaElement(c,r){return Math.atan2(c*r,Math.sqrt(c*c+r*r+1))}static ConvertCubeMapToSphericalPolynomial(c){const r=new t.c;let D=0;const W=2/c.size,H=W,x=.5*W,M=x-1;for(let t=0;t<6;t++){const E=this._FileFaces[t],m=c[E.name];let Y=M;const v=5===c.format?4:3;for(let t=0;t<c.size;t++){let k=M;for(let H=0;H<c.size;H++){const M=E.worldAxisForFileX.scale(k).add(E.worldAxisForFileY.scale(Y)).add(E.worldAxisForNormal);M.normalize();const w=this._AreaElement(k-x,Y-x)-this._AreaElement(k-x,Y+x)-this._AreaElement(k+x,Y-x)+this._AreaElement(k+x,Y+x);let Z=m[t*c.size*v+H*v+0],J=m[t*c.size*v+H*v+1],q=m[t*c.size*v+H*v+2];isNaN(Z)&&(Z=0),isNaN(J)&&(J=0),isNaN(q)&&(q=0),0===c.type&&(Z/=255,J/=255,q/=255),c.gammaSpace&&(Z=Math.pow((0,B.Clamp)(Z),u.k),J=Math.pow((0,B.Clamp)(J),u.k),q=Math.pow((0,B.Clamp)(q),u.k));const j=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const c=Math.max(Z,J,q);if(c>j){const r=j/c;Z*=r,J*=r,q*=r}}else Z=(0,B.Clamp)(Z,0,j),J=(0,B.Clamp)(J,0,j),q=(0,B.Clamp)(q,0,j);const X=new a.Xr(Z,J,q);r.addLight(M,X,w),D+=w,k+=W}Y+=H}}const E=6*(4*Math.PI)/6/D;return r.scaleInPlace(E),r.convertIncidentRadianceToIrradiance(),r.convertIrradianceToLambertianRadiance(),t.e.FromHarmonics(r)}}x._FileFaces=[new H("right",new W.Zr(1,0,0),new W.Zr(0,0,-1),new W.Zr(0,-1,0)),new H("left",new W.Zr(-1,0,0),new W.Zr(0,0,1),new W.Zr(0,-1,0)),new H("up",new W.Zr(0,1,0),new W.Zr(1,0,0),new W.Zr(0,0,1)),new H("down",new W.Zr(0,-1,0),new W.Zr(1,0,0),new W.Zr(0,0,-1)),new H("front",new W.Zr(0,0,1),new W.Zr(1,0,0),new W.Zr(0,-1,0)),new H("back",new W.Zr(0,0,-1),new W.Zr(-1,0,0),new W.Zr(0,-1,0))],x.MAX_HDRI_VALUE=4096,x.PRESERVE_CLAMPED_COLORS=!1},11905:(c,r,D)=>{D.r(r),D.d(r,{Dispose:()=>m,DumpData:()=>E,DumpDataAsync:()=>M,DumpFramebuffer:()=>x,DumpTools:()=>Y});var W=D(11771),B=D(11487),t=D(11696),u=D(11538);let a,H=null;async function x(c,r,D,W){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",t=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0;const a=await D.readPixels(0,0,c,r);E(c,r,new Uint8Array(a.buffer),W,B,t,!0,void 0,u)}async function M(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",B=arguments.length>4?arguments[4]:void 0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7?arguments[7]:void 0;return await new Promise((H=>{E(c,r,D,(c=>H(c)),W,B,t,u,a)}))}function E(c,r,x,M){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Y=arguments.length>5?arguments[5]:void 0,v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7&&void 0!==arguments[7]&&arguments[7],w=arguments.length>8?arguments[8]:void 0;(async function(){return H||(H=new Promise(((c,r)=>{let B,t=null;const H={aa:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(D.bind(D,11797)).then((x=>{let{ThinEngine:M}=x;const E=u.c.Instances.length;try{B=new OffscreenCanvas(100,100),t=new M(B,!1,H)}catch(k){var Y;E<u.c.Instances.length&&(null===(Y=u.c.Instances.pop())||void 0===Y||Y.dispose()),B=document.createElement("canvas"),t=new M(B,!1,H)}u.c.Instances.pop(),u.c.OnEnginesDisposedObservable.add((c=>{t&&c!==t&&!t.M&&0===u.c.Instances.length&&m()})),t.getCaps().parallelShaderCompile=void 0;const v=new W.d(t);D.e(52).then(D.bind(D,14155)).then((D=>{let{passPixelShader:u}=D;if(!t)return void r("Engine is not defined");const H=new W.e({wr:t,name:u.name,fragmentShader:u.shader,samplerNames:["textureSampler"]});a={canvas:B,wr:t,renderer:v,wrapper:H},c(a)}))})).catch(r)}))),await H})().then((D=>{if(D.wr.setSize(c,r,!0),x instanceof Float32Array){const c=new Uint8Array(x.length);let r=x.length;for(;r--;){const D=x[r];c[r]=Math.round(255*(0,t.Clamp)(D))}x=c}const W=D.wr.createRawTexture(x,c,r,5,!1,!v,1);D.renderer.setViewport(),D.renderer.applyEffectWrapper(D.wrapper),D.wrapper.effect._bindTexture("textureSampler",W),D.renderer.draw(),k?B.Tools.ToBlob(D.canvas,(c=>{const r=new FileReader;r.onload=c=>{const r=c.target.result;M&&M(r)},r.readAsArrayBuffer(c)}),E,w):B.Tools.EncodeScreenshotCanvasData(D.canvas,M,E,Y,w),W.dispose()}))}function m(){var c;a?(a.wrapper.dispose(),a.renderer.dispose(),a.wr.dispose()):null===(c=H)||void 0===c||c.then((c=>{c.wrapper.dispose(),c.renderer.dispose(),c.wr.dispose()}));H=null,a=null}const Y={DumpData:E,DumpDataAsync:M,DumpFramebuffer:x,Dispose:m};B.Tools.DumpData=E,B.Tools.DumpDataAsync=M,B.Tools.DumpFramebuffer=x},12183:(c,r,D)=>{D.d(r,{e:()=>t});var W=D(11768),B=D(11907);class t{static ExpandRGBDTexture(c){const r=c._texture;if(!r||!c.isRGBD)return;const B=r.getEngine(),t=B.getCaps(),u=r.isReady;let a=!1;t.textureHalfFloatRender&&t.textureHalfFloatLinearFiltering?(a=!0,r.type=2):t.textureFloatRender&&t.textureFloatLinearFiltering&&(a=!0,r.type=1),a&&(r.isReady=!1,r._isRGBD=!1,r.invertY=!1);const H=async()=>{const t=B.isWebGPU,u=t?1:0;r.isReady=!1,t?await D.e(42).then(D.bind(D,14735)):await D.e(35).then(D.bind(D,14739));const a=new W.e("rgbdDecode","rgbdDecode",null,null,1,null,3,B,!1,void 0,r.type,void 0,null,!1,void 0,u);a.externalTextureSamplerBinding=!0;const H=B.createRenderTargetTexture(r.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:r.samplingMode,type:r.type,format:5});a.onEffectCreatedObservable.addOnce((D=>{D.executeWhenCompiled((()=>{a.onApply=c=>{c._bindTexture("textureSampler",r),c.setFloat2("scale",1,1)},c.yc().postProcessManager.directRender([a],H,!0),B.restoreDefaultFramebuffer(),B._releaseTexture(r),a&&a.dispose(),H._swapAndDie(r),r.isReady=!0}))}))};a&&(u?H():c.onLoadObservable.addOnce(H))}static async EncodeTextureToRGBD(c,r){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return r.getEngine().isWebGPU?await D.e(43).then(D.bind(D,14752)):await D.e(36).then(D.bind(D,14745)),await(0,B.e)("rgbdEncode",c,r,W,1,5)}}}}]);