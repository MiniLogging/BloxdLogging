"use strict";(self["2fwzcez286e"]=self["2fwzcez286e"]||[]).push([[20,21],{13480:(B,u,F)=>{var Z=F(13485),V=F(13002);V.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(V.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=Z.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((B=>{this._texture._sphericalPolynomial=B,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(B){this._texture&&(this._texture._sphericalPolynomial=B)},enumerable:!0,configurable:!0})},13485:(B,u,F)=>{F.d(u,{d:()=>s});var Z=F(12979),V=F(12994),p=F(13172),G=F(12982),R=F(13023);class e{constructor(B,u,F,Z){this.name=B,this.worldAxisForNormal=u,this.worldAxisForFileX=F,this.worldAxisForFileY=Z}}class s{static ConvertCubeMapTextureToSphericalPolynomial(B){var u;if(!B.isCube)return null;null===(u=B.yB())||void 0===u||u.getEngine().flushFramebuffer();const F=B.getSize().width,Z=B.readPixels(0,void 0,void 0,!1),V=B.readPixels(1,void 0,void 0,!1);let p,G;B.isRenderTarget?(p=B.readPixels(3,void 0,void 0,!1),G=B.readPixels(2,void 0,void 0,!1)):(p=B.readPixels(2,void 0,void 0,!1),G=B.readPixels(3,void 0,void 0,!1));const R=B.readPixels(4,void 0,void 0,!1),e=B.readPixels(5,void 0,void 0,!1),s=B.gammaSpace;let Y=0;return 1!=B.textureType&&2!=B.textureType||(Y=1),new Promise((B=>{Promise.all([V,Z,p,G,R,e]).then((u=>{let[Z,V,p,G,R,e]=u;const Q={size:F,right:V,left:Z,up:p,down:G,front:R,back:e,format:5,type:Y,gammaSpace:s};B(this.ConvertCubeMapToSphericalPolynomial(Q))}))}))}static _AreaElement(B,u){return Math.atan2(B*u,Math.sqrt(B*B+u*u+1))}static ConvertCubeMapToSphericalPolynomial(B){const u=new p.c;let F=0;const Z=2/B.size,e=Z,s=.5*Z,Y=s-1;for(let p=0;p<6;p++){const Q=this._FileFaces[p],t=B[Q.name];let v=Y;const D=5===B.format?4:3;for(let p=0;p<B.size;p++){let L=Y;for(let e=0;e<B.size;e++){const Y=Q.worldAxisForFileX.scale(L).add(Q.worldAxisForFileY.scale(v)).add(Q.worldAxisForNormal);Y.normalize();const q=this._AreaElement(L-s,v-s)-this._AreaElement(L-s,v+s)-this._AreaElement(L+s,v-s)+this._AreaElement(L+s,v+s);let W=t[p*B.size*D+e*D+0],X=t[p*B.size*D+e*D+1],f=t[p*B.size*D+e*D+2];isNaN(W)&&(W=0),isNaN(X)&&(X=0),isNaN(f)&&(f=0),0===B.type&&(W/=255,X/=255,f/=255),B.gammaSpace&&(W=Math.pow((0,V.Clamp)(W),G.m),X=Math.pow((0,V.Clamp)(X),G.m),f=Math.pow((0,V.Clamp)(f),G.m));const C=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const B=Math.max(W,X,f);if(B>C){const u=C/B;W*=u,X*=u,f*=u}}else W=(0,V.Clamp)(W,0,C),X=(0,V.Clamp)(X,0,C),f=(0,V.Clamp)(f,0,C);const x=new R.Xu(W,X,f);u.addLight(Y,x,q),F+=q,L+=Z}v+=e}}const Q=6*(4*Math.PI)/6/F;return u.scaleInPlace(Q),u.convertIncidentRadianceToIrradiance(),u.convertIrradianceToLambertianRadiance(),p.g.FromHarmonics(u)}}s._FileFaces=[new e("right",new Z.Du(1,0,0),new Z.Du(0,0,-1),new Z.Du(0,-1,0)),new e("left",new Z.Du(-1,0,0),new Z.Du(0,0,1),new Z.Du(0,-1,0)),new e("up",new Z.Du(0,1,0),new Z.Du(1,0,0),new Z.Du(0,0,1)),new e("down",new Z.Du(0,-1,0),new Z.Du(1,0,0),new Z.Du(0,0,-1)),new e("front",new Z.Du(0,0,1),new Z.Du(1,0,0),new Z.Du(0,-1,0)),new e("back",new Z.Du(0,0,-1),new Z.Du(-1,0,0),new Z.Du(0,-1,0))],s.MAX_HDRI_VALUE=4096,s.PRESERVE_CLAMPED_COLORS=!1},13206:(B,u,F)=>{F.r(u),F.d(u,{Dispose:()=>t,DumpData:()=>Q,DumpDataAsync:()=>Y,DumpFramebuffer:()=>s,DumpTools:()=>v});var Z=F(13084),V=F(12802),p=F(12994),G=F(12855);let R,e=null;async function s(B,u,F,Z){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",p=arguments.length>5?arguments[5]:void 0,G=arguments.length>6?arguments[6]:void 0;const R=await F.readPixels(0,0,B,u);Q(B,u,new Uint8Array(R.buffer),Z,V,p,!0,void 0,G)}async function Y(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",V=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],R=arguments.length>7?arguments[7]:void 0;return await new Promise((e=>{Q(B,u,F,(B=>e(B)),Z,V,p,G,R)}))}function Q(B,u,s,Y){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",v=arguments.length>5?arguments[5]:void 0,D=arguments.length>6&&void 0!==arguments[6]&&arguments[6],L=arguments.length>7&&void 0!==arguments[7]&&arguments[7],q=arguments.length>8?arguments[8]:void 0;(async function(){return e||(e=new Promise(((B,u)=>{let V,p=null;const e={QR:!0,depth:!1,RR:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(F.bind(F,13112)).then((s=>{let{ThinEngine:Y}=s;const Q=G.b.Instances.length;try{V=new OffscreenCanvas(100,100),p=new Y(V,!1,e)}catch(L){var v;Q<G.b.Instances.length&&(null===(v=G.b.Instances.pop())||void 0===v||v.dispose()),V=document.createElement("canvas"),p=new Y(V,!1,e)}G.b.Instances.pop(),G.b.OnEnginesDisposedObservable.add((B=>{p&&B!==p&&!p.G&&0===G.b.Instances.length&&t()})),p.getCaps().parallelShaderCompile=void 0;const D=new Z.c(p);F.e(52).then(F.bind(F,15516)).then((F=>{let{passPixelShader:G}=F;if(!p)return void u("Engine is not defined");const e=new Z.g({vu:p,name:G.name,fragmentShader:G.shader,samplerNames:["textureSampler"]});R={canvas:V,vu:p,renderer:D,wrapper:e},B(R)}))})).catch(u)}))),await e})().then((F=>{if(F.vu.setSize(B,u,!0),s instanceof Float32Array){const B=new Uint8Array(s.length);let u=s.length;for(;u--;){const F=s[u];B[u]=Math.round(255*(0,p.Clamp)(F))}s=B}const Z=F.vu.createRawTexture(s,B,u,5,!1,!D,1);F.renderer.setViewport(),F.renderer.applyEffectWrapper(F.wrapper),F.wrapper.effect._bindTexture("textureSampler",Z),F.renderer.draw(),L?V.Tools.ToBlob(F.canvas,(B=>{const u=new FileReader;u.onload=B=>{const u=B.target.result;Y&&Y(u)},u.readAsArrayBuffer(B)}),Q,q):V.Tools.EncodeScreenshotCanvasData(F.canvas,Y,Q,v,q),Z.dispose()}))}function t(){var B;R?(R.wrapper.dispose(),R.renderer.dispose(),R.vu.dispose()):null===(B=e)||void 0===B||B.then((B=>{B.wrapper.dispose(),B.renderer.dispose(),B.vu.dispose()}));e=null,R=null}const v={DumpData:Q,DumpDataAsync:Y,DumpFramebuffer:s,Dispose:t};V.Tools.DumpData=Q,V.Tools.DumpDataAsync=Y,V.Tools.DumpFramebuffer=s},13469:(B,u,F)=>{F.d(u,{c:()=>p});var Z=F(13080),V=F(13215);class p{static ExpandRGBDTexture(B){const u=B._texture;if(!u||!B.isRGBD)return;const V=u.getEngine(),p=V.getCaps(),G=u.isReady;let R=!1;p.textureHalfFloatRender&&p.textureHalfFloatLinearFiltering?(R=!0,u.type=2):p.textureFloatRender&&p.textureFloatLinearFiltering&&(R=!0,u.type=1),R&&(u.isReady=!1,u._isRGBD=!1,u.invertY=!1);const e=async()=>{const p=V.isWebGPU,G=p?1:0;u.isReady=!1,p?await F.e(42).then(F.bind(F,16052)):await F.e(35).then(F.bind(F,16060));const R=new Z.c("rgbdDecode","rgbdDecode",null,null,1,null,3,V,!1,void 0,u.type,void 0,null,!1,void 0,G);R.externalTextureSamplerBinding=!0;const e=V.createRenderTargetTexture(u.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:u.samplingMode,type:u.type,format:5});R.onEffectCreatedObservable.addOnce((F=>{F.executeWhenCompiled((()=>{R.onApply=B=>{B._bindTexture("textureSampler",u),B.setFloat2("scale",1,1)},B.yB().postProcessManager.directRender([R],e,!0),V.restoreDefaultFramebuffer(),V._releaseTexture(u),R&&R.dispose(),e._swapAndDie(u),u.isReady=!0}))}))};R&&(G?e():B.onLoadObservable.addOnce(e))}static async EncodeTextureToRGBD(B,u){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return u.getEngine().isWebGPU?await F.e(43).then(F.bind(F,16072)):await F.e(36).then(F.bind(F,16068)),await(0,V.d)("rgbdEncode",B,u,Z,1,5)}}}}]);