"use strict";(self.h66iwo8dvgq=self.h66iwo8dvgq||[]).push([[20,21],{12375:(b,X,P)=>{var Q=P(12383),S=P(11846);S.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(S.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=Q.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((b=>{this._texture._sphericalPolynomial=b,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(b){this._texture&&(this._texture._sphericalPolynomial=b)},enumerable:!0,configurable:!0})},12383:(b,X,P)=>{P.d(X,{e:()=>w});var Q=P(11834),S=P(11844),d=P(12032),N=P(11836),a=P(11878);class u{constructor(b,X,P,Q){this.name=b,this.worldAxisForNormal=X,this.worldAxisForFileX=P,this.worldAxisForFileY=Q}}class w{static ConvertCubeMapTextureToSphericalPolynomial(b){var X;if(!b.isCube)return null;null===(X=b.Ab())||void 0===X||X.getEngine().flushFramebuffer();const P=b.getSize().width,Q=b.readPixels(0,void 0,void 0,!1),S=b.readPixels(1,void 0,void 0,!1);let d,N;b.isRenderTarget?(d=b.readPixels(3,void 0,void 0,!1),N=b.readPixels(2,void 0,void 0,!1)):(d=b.readPixels(2,void 0,void 0,!1),N=b.readPixels(3,void 0,void 0,!1));const a=b.readPixels(4,void 0,void 0,!1),u=b.readPixels(5,void 0,void 0,!1),w=b.gammaSpace;let f=0;return 1!=b.textureType&&2!=b.textureType||(f=1),new Promise((b=>{Promise.all([S,Q,d,N,a,u]).then((X=>{let[Q,S,d,N,a,u]=X;const O={size:P,right:S,left:Q,up:d,down:N,front:a,back:u,format:5,type:f,gammaSpace:w};b(this.ConvertCubeMapToSphericalPolynomial(O))}))}))}static _AreaElement(b,X){return Math.atan2(b*X,Math.sqrt(b*b+X*X+1))}static ConvertCubeMapToSphericalPolynomial(b){const X=new d.c;let P=0;const Q=2/b.size,u=Q,w=.5*Q,f=w-1;for(let d=0;d<6;d++){const O=this._FileFaces[d],e=b[O.name];let Y=f;const D=5===b.format?4:3;for(let d=0;d<b.size;d++){let E=f;for(let u=0;u<b.size;u++){const f=O.worldAxisForFileX.scale(E).add(O.worldAxisForFileY.scale(Y)).add(O.worldAxisForNormal);f.normalize();const t=this._AreaElement(E-w,Y-w)-this._AreaElement(E-w,Y+w)-this._AreaElement(E+w,Y-w)+this._AreaElement(E+w,Y+w);let B=e[d*b.size*D+u*D+0],W=e[d*b.size*D+u*D+1],n=e[d*b.size*D+u*D+2];isNaN(B)&&(B=0),isNaN(W)&&(W=0),isNaN(n)&&(n=0),0===b.type&&(B/=255,W/=255,n/=255),b.gammaSpace&&(B=Math.pow((0,S.Clamp)(B),N.k),W=Math.pow((0,S.Clamp)(W),N.k),n=Math.pow((0,S.Clamp)(n),N.k));const y=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const b=Math.max(B,W,n);if(b>y){const X=y/b;B*=X,W*=X,n*=X}}else B=(0,S.Clamp)(B,0,y),W=(0,S.Clamp)(W,0,y),n=(0,S.Clamp)(n,0,y);const h=new a.yX(B,W,n);X.addLight(f,h,t),P+=t,E+=Q}Y+=u}}const O=6*(4*Math.PI)/6/P;return X.scaleInPlace(O),X.convertIncidentRadianceToIrradiance(),X.convertIrradianceToLambertianRadiance(),d.d.FromHarmonics(X)}}w._FileFaces=[new u("right",new Q.tX(1,0,0),new Q.tX(0,0,-1),new Q.tX(0,-1,0)),new u("left",new Q.tX(-1,0,0),new Q.tX(0,0,1),new Q.tX(0,-1,0)),new u("up",new Q.tX(0,1,0),new Q.tX(1,0,0),new Q.tX(0,0,1)),new u("down",new Q.tX(0,-1,0),new Q.tX(1,0,0),new Q.tX(0,0,-1)),new u("front",new Q.tX(0,0,1),new Q.tX(1,0,0),new Q.tX(0,-1,0)),new u("back",new Q.tX(0,0,-1),new Q.tX(-1,0,0),new Q.tX(0,-1,0))],w.MAX_HDRI_VALUE=4096,w.PRESERVE_CLAMPED_COLORS=!1},12072:(b,X,P)=>{P.r(X),P.d(X,{Dispose:()=>e,DumpData:()=>O,DumpDataAsync:()=>f,DumpFramebuffer:()=>w,DumpTools:()=>Y});var Q=P(11944),S=P(11689),d=P(11844),N=P(11732);let a,u=null;async function w(b,X,P,Q){let S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",d=arguments.length>5?arguments[5]:void 0,N=arguments.length>6?arguments[6]:void 0;const a=await P.readPixels(0,0,b,X);O(b,X,new Uint8Array(a.buffer),Q,S,d,!0,void 0,N)}async function f(b,X,P){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",S=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],N=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7?arguments[7]:void 0;return await new Promise((u=>{O(b,X,P,(b=>u(b)),Q,S,d,N,a)}))}function O(b,X,w,f){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",Y=arguments.length>5?arguments[5]:void 0,D=arguments.length>6&&void 0!==arguments[6]&&arguments[6],E=arguments.length>7&&void 0!==arguments[7]&&arguments[7],t=arguments.length>8?arguments[8]:void 0;(async function(){return u||(u=new Promise(((b,X)=>{let S,d=null;const u={Dd:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(P.bind(P,11976)).then((w=>{let{ThinEngine:f}=w;const O=N.e.Instances.length;try{S=new OffscreenCanvas(100,100),d=new f(S,!1,u)}catch(E){var Y;O<N.e.Instances.length&&(null===(Y=N.e.Instances.pop())||void 0===Y||Y.dispose()),S=document.createElement("canvas"),d=new f(S,!1,u)}N.e.Instances.pop(),N.e.OnEnginesDisposedObservable.add((b=>{d&&b!==d&&!d.Y&&0===N.e.Instances.length&&e()})),d.getCaps().parallelShaderCompile=void 0;const D=new Q.d(d);P.e(52).then(P.bind(P,14404)).then((P=>{let{passPixelShader:N}=P;if(!d)return void X("Engine is not defined");const u=new Q.h({EX:d,name:N.name,fragmentShader:N.shader,samplerNames:["textureSampler"]});a={canvas:S,EX:d,renderer:D,wrapper:u},b(a)}))})).catch(X)}))),await u})().then((P=>{if(P.EX.setSize(b,X,!0),w instanceof Float32Array){const b=new Uint8Array(w.length);let X=w.length;for(;X--;){const P=w[X];b[X]=Math.round(255*(0,d.Clamp)(P))}w=b}const Q=P.EX.createRawTexture(w,b,X,5,!1,!D,1);P.renderer.setViewport(),P.renderer.applyEffectWrapper(P.wrapper),P.wrapper.effect._bindTexture("textureSampler",Q),P.renderer.draw(),E?S.Tools.ToBlob(P.canvas,(b=>{const X=new FileReader;X.onload=b=>{const X=b.target.result;f&&f(X)},X.readAsArrayBuffer(b)}),O,t):S.Tools.EncodeScreenshotCanvasData(P.canvas,f,O,Y,t),Q.dispose()}))}function e(){var b;a?(a.wrapper.dispose(),a.renderer.dispose(),a.EX.dispose()):null===(b=u)||void 0===b||b.then((b=>{b.wrapper.dispose(),b.renderer.dispose(),b.EX.dispose()}));u=null,a=null}const Y={DumpData:O,DumpDataAsync:f,DumpFramebuffer:w,Dispose:e};S.Tools.DumpData=O,S.Tools.DumpDataAsync=f,S.Tools.DumpFramebuffer=w},12363:(b,X,P)=>{P.d(X,{c:()=>d});var Q=P(11936),S=P(12081);class d{static ExpandRGBDTexture(b){const X=b._texture;if(!X||!b.isRGBD)return;const S=X.getEngine(),d=S.getCaps(),N=X.isReady;let a=!1;d.textureHalfFloatRender&&d.textureHalfFloatLinearFiltering?(a=!0,X.type=2):d.textureFloatRender&&d.textureFloatLinearFiltering&&(a=!0,X.type=1),a&&(X.isReady=!1,X._isRGBD=!1,X.invertY=!1);const u=async()=>{const d=S.isWebGPU,N=d?1:0;X.isReady=!1,d?await P.e(42).then(P.bind(P,14980)):await P.e(35).then(P.bind(P,14988));const a=new Q.b("rgbdDecode","rgbdDecode",null,null,1,null,3,S,!1,void 0,X.type,void 0,null,!1,void 0,N);a.externalTextureSamplerBinding=!0;const u=S.createRenderTargetTexture(X.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:X.samplingMode,type:X.type,format:5});a.onEffectCreatedObservable.addOnce((P=>{P.executeWhenCompiled((()=>{a.onApply=b=>{b._bindTexture("textureSampler",X),b.setFloat2("scale",1,1)},b.Ab().postProcessManager.directRender([a],u,!0),S.restoreDefaultFramebuffer(),S._releaseTexture(X),a&&a.dispose(),u._swapAndDie(X),X.isReady=!0}))}))};a&&(N?u():b.onLoadObservable.addOnce(u))}static async EncodeTextureToRGBD(b,X){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return X.getEngine().isWebGPU?await P.e(43).then(P.bind(P,15006)):await P.e(36).then(P.bind(P,14997)),await(0,S.e)("rgbdEncode",b,X,Q,1,5)}}}}]);