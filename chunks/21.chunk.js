"use strict";(self.gpkvekif0vo=self.gpkvekif0vo||[]).push([[20,21],{12910:(a,O,i)=>{var H=i(12913),b=i(12417);b.c.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(b.c.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=H.e.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((a=>{this._texture._sphericalPolynomial=a,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(a){this._texture&&(this._texture._sphericalPolynomial=a)},enumerable:!0,configurable:!0})},12913:(a,O,i)=>{i.d(O,{e:()=>I});var H=i(12395),b=i(12412),G=i(12593),q=i(12397),Q=i(12436);class k{constructor(a,O,i,H){this.name=a,this.worldAxisForNormal=O,this.worldAxisForFileX=i,this.worldAxisForFileY=H}}class I{static ConvertCubeMapTextureToSphericalPolynomial(a){var O;if(!a.isCube)return null;null===(O=a.Ua())||void 0===O||O.getEngine().flushFramebuffer();const i=a.getSize().width,H=a.readPixels(0,void 0,void 0,!1),b=a.readPixels(1,void 0,void 0,!1);let G,q;a.isRenderTarget?(G=a.readPixels(3,void 0,void 0,!1),q=a.readPixels(2,void 0,void 0,!1)):(G=a.readPixels(2,void 0,void 0,!1),q=a.readPixels(3,void 0,void 0,!1));const Q=a.readPixels(4,void 0,void 0,!1),k=a.readPixels(5,void 0,void 0,!1),I=a.gammaSpace;let P=0;return 1!=a.textureType&&2!=a.textureType||(P=1),new Promise((a=>{Promise.all([b,H,G,q,Q,k]).then((O=>{let[H,b,G,q,Q,k]=O;const e={size:i,right:b,left:H,up:G,down:q,front:Q,back:k,format:5,type:P,gammaSpace:I};a(this.ConvertCubeMapToSphericalPolynomial(e))}))}))}static _AreaElement(a,O){return Math.atan2(a*O,Math.sqrt(a*a+O*O+1))}static ConvertCubeMapToSphericalPolynomial(a){const O=new G.b;let i=0;const H=2/a.size,k=H,I=.5*H,P=I-1;for(let G=0;G<6;G++){const e=this._FileFaces[G],h=a[e.name];let j=P;const Z=5===a.format?4:3;for(let G=0;G<a.size;G++){let F=P;for(let k=0;k<a.size;k++){const P=e.worldAxisForFileX.scale(F).add(e.worldAxisForFileY.scale(j)).add(e.worldAxisForNormal);P.normalize();const r=this._AreaElement(F-I,j-I)-this._AreaElement(F-I,j+I)-this._AreaElement(F+I,j-I)+this._AreaElement(F+I,j+I);let J=h[G*a.size*Z+k*Z+0],ma=h[G*a.size*Z+k*Z+1],M=h[G*a.size*Z+k*Z+2];isNaN(J)&&(J=0),isNaN(ma)&&(ma=0),isNaN(M)&&(M=0),0===a.type&&(J/=255,ma/=255,M/=255),a.gammaSpace&&(J=Math.pow((0,b.Clamp)(J),q.i),ma=Math.pow((0,b.Clamp)(ma),q.i),M=Math.pow((0,b.Clamp)(M),q.i));const C=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const a=Math.max(J,ma,M);if(a>C){const O=C/a;J*=O,ma*=O,M*=O}}else J=(0,b.Clamp)(J,0,C),ma=(0,b.Clamp)(ma,0,C),M=(0,b.Clamp)(M,0,C);const n=new Q.mi(J,ma,M);O.addLight(P,n,r),i+=r,F+=H}j+=k}}const e=6*(4*Math.PI)/6/i;return O.scaleInPlace(e),O.convertIncidentRadianceToIrradiance(),O.convertIrradianceToLambertianRadiance(),G.d.FromHarmonics(O)}}I._FileFaces=[new k("right",new H.ZO(1,0,0),new H.ZO(0,0,-1),new H.ZO(0,-1,0)),new k("left",new H.ZO(-1,0,0),new H.ZO(0,0,1),new H.ZO(0,-1,0)),new k("up",new H.ZO(0,1,0),new H.ZO(1,0,0),new H.ZO(0,0,1)),new k("down",new H.ZO(0,-1,0),new H.ZO(1,0,0),new H.ZO(0,0,-1)),new k("front",new H.ZO(0,0,1),new H.ZO(1,0,0),new H.ZO(0,-1,0)),new k("back",new H.ZO(0,0,-1),new H.ZO(-1,0,0),new H.ZO(0,-1,0))],I.MAX_HDRI_VALUE=4096,I.PRESERVE_CLAMPED_COLORS=!1},12631:(a,O,i)=>{i.r(O),i.d(O,{Dispose:()=>h,DumpData:()=>e,DumpDataAsync:()=>P,DumpFramebuffer:()=>I,DumpTools:()=>j});var H=i(12505),b=i(12184),G=i(12412),q=i(12236);let Q,k=null;async function I(a,O,i,H){let b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",G=arguments.length>5?arguments[5]:void 0,q=arguments.length>6?arguments[6]:void 0;const Q=await i.readPixels(0,0,a,O);e(a,O,new Uint8Array(Q.buffer),H,b,G,!0,void 0,q)}async function P(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",b=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Q=arguments.length>7?arguments[7]:void 0;return await new Promise((k=>{e(a,O,i,(a=>k(a)),H,b,G,q,Q)}))}function e(a,O,I,P){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",j=arguments.length>5?arguments[5]:void 0,Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]&&arguments[7],r=arguments.length>8?arguments[8]:void 0;(async function(){return k||(k=new Promise(((a,O)=>{let b,G=null;const k={rb:!0,depth:!1,hb:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(i.bind(i,12537)).then((I=>{let{ThinEngine:P}=I;const e=q.b.Instances.length;try{b=new OffscreenCanvas(100,100),G=new P(b,!1,k)}catch(F){var j;e<q.b.Instances.length&&(null===(j=q.b.Instances.pop())||void 0===j||j.dispose()),b=document.createElement("canvas"),G=new P(b,!1,k)}q.b.Instances.pop(),q.b.OnEnginesDisposedObservable.add((a=>{G&&a!==G&&!G.h&&0===q.b.Instances.length&&h()})),G.getCaps().parallelShaderCompile=void 0;const Z=new H.b(G);i.e(52).then(i.bind(i,14893)).then((i=>{let{passPixelShader:q}=i;if(!G)return void O("Engine is not defined");const k=new H.e({jO:G,name:q.name,fragmentShader:q.shader,samplerNames:["textureSampler"]});Q={canvas:b,jO:G,renderer:Z,wrapper:k},a(Q)}))})).catch(O)}))),await k})().then((i=>{if(i.jO.setSize(a,O,!0),I instanceof Float32Array){const a=new Uint8Array(I.length);let O=I.length;for(;O--;){const i=I[O];a[O]=Math.round(255*(0,G.Clamp)(i))}I=a}const H=i.jO.createRawTexture(I,a,O,5,!1,!Z,1);i.renderer.setViewport(),i.renderer.applyEffectWrapper(i.wrapper),i.wrapper.effect._bindTexture("textureSampler",H),i.renderer.draw(),F?b.Tools.ToBlob(i.canvas,(a=>{const O=new FileReader;O.onload=a=>{const O=a.target.result;P&&P(O)},O.readAsArrayBuffer(a)}),e,r):b.Tools.EncodeScreenshotCanvasData(i.canvas,P,e,j,r),H.dispose()}))}function h(){var a;Q?(Q.wrapper.dispose(),Q.renderer.dispose(),Q.jO.dispose()):null===(a=k)||void 0===a||a.then((a=>{a.wrapper.dispose(),a.renderer.dispose(),a.jO.dispose()}));k=null,Q=null}const j={DumpData:e,DumpDataAsync:P,DumpFramebuffer:I,Dispose:h};b.Tools.DumpData=e,b.Tools.DumpDataAsync=P,b.Tools.DumpFramebuffer=I},12895:(a,O,i)=>{i.d(O,{b:()=>G});var H=i(12496),b=i(12638);class G{static ExpandRGBDTexture(a){const O=a._texture;if(!O||!a.isRGBD)return;const b=O.getEngine(),G=b.getCaps(),q=O.isReady;let Q=!1;G.textureHalfFloatRender&&G.textureHalfFloatLinearFiltering?(Q=!0,O.type=2):G.textureFloatRender&&G.textureFloatLinearFiltering&&(Q=!0,O.type=1),Q&&(O.isReady=!1,O._isRGBD=!1,O.invertY=!1);const k=async()=>{const G=b.isWebGPU,q=G?1:0;O.isReady=!1,G?await i.e(42).then(i.bind(i,15439)):await i.e(35).then(i.bind(i,15443));const Q=new H.e("rgbdDecode","rgbdDecode",null,null,1,null,3,b,!1,void 0,O.type,void 0,null,!1,void 0,q);Q.externalTextureSamplerBinding=!0;const k=b.createRenderTargetTexture(O.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:O.samplingMode,type:O.type,format:5});Q.onEffectCreatedObservable.addOnce((i=>{i.executeWhenCompiled((()=>{Q.onApply=a=>{a._bindTexture("textureSampler",O),a.setFloat2("scale",1,1)},a.Ua().postProcessManager.directRender([Q],k,!0),b.restoreDefaultFramebuffer(),b._releaseTexture(O),Q&&Q.dispose(),k._swapAndDie(O),O.isReady=!0}))}))};Q&&(q?k():a.onLoadObservable.addOnce(k))}static async EncodeTextureToRGBD(a,O){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return O.getEngine().isWebGPU?await i.e(43).then(i.bind(i,15451)):await i.e(36).then(i.bind(i,15446)),await(0,b.b)("rgbdEncode",a,O,H,1,5)}}}}]);