"use strict";(self.g111kvdsqxc=self.g111kvdsqxc||[]).push([[20,21],{11800:(K,H,M)=>{var q=M(11802),w=M(11309);w.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(w.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=q.b.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((K=>{this._texture._sphericalPolynomial=K,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(K){this._texture&&(this._texture._sphericalPolynomial=K)},enumerable:!0,configurable:!0})},11802:(K,H,M)=>{M.d(H,{b:()=>I});var q=M(11290),w=M(11307),u=M(11472),y=M(11297),h=M(11329);class W{constructor(K,H,M,q){this.name=K,this.worldAxisForNormal=H,this.worldAxisForFileX=M,this.worldAxisForFileY=q}}class I{static ConvertCubeMapTextureToSphericalPolynomial(K){var H;if(!K.isCube)return null;null===(H=K.sK())||void 0===H||H.getEngine().flushFramebuffer();const M=K.getSize().width,q=K.readPixels(0,void 0,void 0,!1),w=K.readPixels(1,void 0,void 0,!1);let u,y;K.isRenderTarget?(u=K.readPixels(3,void 0,void 0,!1),y=K.readPixels(2,void 0,void 0,!1)):(u=K.readPixels(2,void 0,void 0,!1),y=K.readPixels(3,void 0,void 0,!1));const h=K.readPixels(4,void 0,void 0,!1),W=K.readPixels(5,void 0,void 0,!1),I=K.gammaSpace;let f=0;return 1!=K.textureType&&2!=K.textureType||(f=1),new Promise((K=>{Promise.all([w,q,u,y,h,W]).then((H=>{let[q,w,u,y,h,W]=H;const z={size:M,right:w,left:q,up:u,down:y,front:h,back:W,format:5,type:f,gammaSpace:I};K(this.ConvertCubeMapToSphericalPolynomial(z))}))}))}static _AreaElement(K,H){return Math.atan2(K*H,Math.sqrt(K*K+H*H+1))}static ConvertCubeMapToSphericalPolynomial(K){const H=new u.d;let M=0;const q=2/K.size,W=q,I=.5*q,f=I-1;for(let u=0;u<6;u++){const z=this._FileFaces[u],G=K[z.name];let a=f;const v=5===K.format?4:3;for(let u=0;u<K.size;u++){let O=f;for(let W=0;W<K.size;W++){const f=z.worldAxisForFileX.scale(O).add(z.worldAxisForFileY.scale(a)).add(z.worldAxisForNormal);f.normalize();const L=this._AreaElement(O-I,a-I)-this._AreaElement(O-I,a+I)-this._AreaElement(O+I,a-I)+this._AreaElement(O+I,a+I);let S=G[u*K.size*v+W*v+0],B=G[u*K.size*v+W*v+1],C=G[u*K.size*v+W*v+2];isNaN(S)&&(S=0),isNaN(B)&&(B=0),isNaN(C)&&(C=0),0===K.type&&(S/=255,B/=255,C/=255),K.gammaSpace&&(S=Math.pow((0,w.Clamp)(S),y.l),B=Math.pow((0,w.Clamp)(B),y.l),C=Math.pow((0,w.Clamp)(C),y.l));const i=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const K=Math.max(S,B,C);if(K>i){const H=i/K;S*=H,B*=H,C*=H}}else S=(0,w.Clamp)(S,0,i),B=(0,w.Clamp)(B,0,i),C=(0,w.Clamp)(C,0,i);const Z=new h.CH(S,B,C);H.addLight(f,Z,L),M+=L,O+=q}a+=W}}const z=6*(4*Math.PI)/6/M;return H.scaleInPlace(z),H.convertIncidentRadianceToIrradiance(),H.convertIrradianceToLambertianRadiance(),u.e.FromHarmonics(H)}}I._FileFaces=[new W("right",new q.OH(1,0,0),new q.OH(0,0,-1),new q.OH(0,-1,0)),new W("left",new q.OH(-1,0,0),new q.OH(0,0,1),new q.OH(0,-1,0)),new W("up",new q.OH(0,1,0),new q.OH(1,0,0),new q.OH(0,0,1)),new W("down",new q.OH(0,-1,0),new q.OH(1,0,0),new q.OH(0,0,-1)),new W("front",new q.OH(0,0,1),new q.OH(1,0,0),new q.OH(0,-1,0)),new W("back",new q.OH(0,0,-1),new q.OH(-1,0,0),new q.OH(0,-1,0))],I.MAX_HDRI_VALUE=4096,I.PRESERVE_CLAMPED_COLORS=!1},11502:(K,H,M)=>{M.r(H),M.d(H,{Dispose:()=>G,DumpData:()=>z,DumpDataAsync:()=>f,DumpFramebuffer:()=>I,DumpTools:()=>a});var q=M(11399),w=M(11100),u=M(11307),y=M(11143);let h,W=null;async function I(K,H,M,q){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",u=arguments.length>5?arguments[5]:void 0,y=arguments.length>6?arguments[6]:void 0;const h=await M.readPixels(0,0,K,H);z(K,H,new Uint8Array(h.buffer),q,w,u,!0,void 0,y)}async function f(K,H,M){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",w=arguments.length>4?arguments[4]:void 0,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7?arguments[7]:void 0;return await new Promise((W=>{z(K,H,M,(K=>W(K)),q,w,u,y,h)}))}function z(K,H,I,f){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",a=arguments.length>5?arguments[5]:void 0,v=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7&&void 0!==arguments[7]&&arguments[7],L=arguments.length>8?arguments[8]:void 0;(async function(){return W||(W=new Promise(((K,H)=>{let w,u=null;const W={o:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(M.bind(M,11415)).then((I=>{let{ThinEngine:f}=I;const z=y.b.Instances.length;try{w=new OffscreenCanvas(100,100),u=new f(w,!1,W)}catch(O){var a;z<y.b.Instances.length&&(null===(a=y.b.Instances.pop())||void 0===a||a.dispose()),w=document.createElement("canvas"),u=new f(w,!1,W)}y.b.Instances.pop(),y.b.OnEnginesDisposedObservable.add((K=>{u&&K!==u&&!u.W&&0===y.b.Instances.length&&G()})),u.getCaps().parallelShaderCompile=void 0;const v=new q.e(u);M.e(52).then(M.bind(M,13758)).then((M=>{let{passPixelShader:y}=M;if(!u)return void H("Engine is not defined");const W=new q.g({vH:u,name:y.name,fragmentShader:y.shader,samplerNames:["textureSampler"]});h={canvas:w,vH:u,renderer:v,wrapper:W},K(h)}))})).catch(H)}))),await W})().then((M=>{if(M.vH.setSize(K,H,!0),I instanceof Float32Array){const K=new Uint8Array(I.length);let H=I.length;for(;H--;){const M=I[H];K[H]=Math.round(255*(0,u.Clamp)(M))}I=K}const q=M.vH.createRawTexture(I,K,H,5,!1,!v,1);M.renderer.setViewport(),M.renderer.applyEffectWrapper(M.wrapper),M.wrapper.effect._bindTexture("textureSampler",q),M.renderer.draw(),O?w.Tools.ToBlob(M.canvas,(K=>{const H=new FileReader;H.onload=K=>{const H=K.target.result;f&&f(H)},H.readAsArrayBuffer(K)}),z,L):w.Tools.EncodeScreenshotCanvasData(M.canvas,f,z,a,L),q.dispose()}))}function G(){var K;h?(h.wrapper.dispose(),h.renderer.dispose(),h.vH.dispose()):null===(K=W)||void 0===K||K.then((K=>{K.wrapper.dispose(),K.renderer.dispose(),K.vH.dispose()}));W=null,h=null}const a={DumpData:z,DumpDataAsync:f,DumpFramebuffer:I,Dispose:G};w.Tools.DumpData=z,w.Tools.DumpDataAsync=f,w.Tools.DumpFramebuffer=I},11790:(K,H,M)=>{M.d(H,{c:()=>u});var q=M(11393),w=M(11507);class u{static ExpandRGBDTexture(K){const H=K._texture;if(!H||!K.isRGBD)return;const w=H.getEngine(),u=w.getCaps(),y=H.isReady;let h=!1;u.textureHalfFloatRender&&u.textureHalfFloatLinearFiltering?(h=!0,H.type=2):u.textureFloatRender&&u.textureFloatLinearFiltering&&(h=!0,H.type=1),h&&(H.isReady=!1,H._isRGBD=!1,H.invertY=!1);const W=async()=>{const u=w.isWebGPU,y=u?1:0;H.isReady=!1,u?await M.e(42).then(M.bind(M,14281)):await M.e(35).then(M.bind(M,14286));const h=new q.d("rgbdDecode","rgbdDecode",null,null,1,null,3,w,!1,void 0,H.type,void 0,null,!1,void 0,y);h.externalTextureSamplerBinding=!0;const W=w.createRenderTargetTexture(H.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:H.samplingMode,type:H.type,format:5});h.onEffectCreatedObservable.addOnce((M=>{M.executeWhenCompiled((()=>{h.onApply=K=>{K._bindTexture("textureSampler",H),K.setFloat2("scale",1,1)},K.sK().postProcessManager.directRender([h],W,!0),w.restoreDefaultFramebuffer(),w._releaseTexture(H),h&&h.dispose(),W._swapAndDie(H),H.isReady=!0}))}))};h&&(y?W():K.onLoadObservable.addOnce(W))}static async EncodeTextureToRGBD(K,H){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return H.getEngine().isWebGPU?await M.e(43).then(M.bind(M,14295)):await M.e(36).then(M.bind(M,14292)),await(0,w.c)("rgbdEncode",K,H,q,1,5)}}}}]);