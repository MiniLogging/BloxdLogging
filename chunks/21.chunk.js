"use strict";(self.yg1iw12lizp=self.yg1iw12lizp||[]).push([[20,21],{13122:(L,U,x)=>{var mL=x(13131),p=x(12613);p.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(p.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=mL.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((L=>{this._texture._sphericalPolynomial=L,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(L){this._texture&&(this._texture._sphericalPolynomial=L)},enumerable:!0,configurable:!0})},13131:(L,U,x)=>{x.d(U,{c:()=>A});var mL=x(12589),p=x(12610),G=x(12773),F=x(12598),a=x(12637);class o{constructor(L,U,x,mL){this.name=L,this.worldAxisForNormal=U,this.worldAxisForFileX=x,this.worldAxisForFileY=mL}}class A{static ConvertCubeMapTextureToSphericalPolynomial(L){var U;if(!L.isCube)return null;null===(U=L.PL())||void 0===U||U.getEngine().flushFramebuffer();const x=L.getSize().width,mL=L.readPixels(0,void 0,void 0,!1),p=L.readPixels(1,void 0,void 0,!1);let G,F;L.isRenderTarget?(G=L.readPixels(3,void 0,void 0,!1),F=L.readPixels(2,void 0,void 0,!1)):(G=L.readPixels(2,void 0,void 0,!1),F=L.readPixels(3,void 0,void 0,!1));const a=L.readPixels(4,void 0,void 0,!1),o=L.readPixels(5,void 0,void 0,!1),A=L.gammaSpace;let r=0;return 1!=L.textureType&&2!=L.textureType||(r=1),new Promise((L=>{Promise.all([p,mL,G,F,a,o]).then((U=>{let[mL,p,G,F,a,o]=U;const h={size:x,right:p,left:mL,up:G,down:F,front:a,back:o,format:5,type:r,gammaSpace:A};L(this.ConvertCubeMapToSphericalPolynomial(h))}))}))}static _AreaElement(L,U){return Math.atan2(L*U,Math.sqrt(L*L+U*U+1))}static ConvertCubeMapToSphericalPolynomial(L){const U=new G.b;let x=0;const mL=2/L.size,o=mL,A=.5*mL,r=A-1;for(let G=0;G<6;G++){const h=this._FileFaces[G],b=L[h.name];let E=r;const Y=5===L.format?4:3;for(let G=0;G<L.size;G++){let S=r;for(let o=0;o<L.size;o++){const r=h.worldAxisForFileX.scale(S).add(h.worldAxisForFileY.scale(E)).add(h.worldAxisForNormal);r.normalize();const V=this._AreaElement(S-A,E-A)-this._AreaElement(S-A,E+A)-this._AreaElement(S+A,E-A)+this._AreaElement(S+A,E+A);let H=b[G*L.size*Y+o*Y+0],Q=b[G*L.size*Y+o*Y+1],q=b[G*L.size*Y+o*Y+2];isNaN(H)&&(H=0),isNaN(Q)&&(Q=0),isNaN(q)&&(q=0),0===L.type&&(H/=255,Q/=255,q/=255),L.gammaSpace&&(H=Math.pow((0,p.Clamp)(H),F.g),Q=Math.pow((0,p.Clamp)(Q),F.g),q=Math.pow((0,p.Clamp)(q),F.g));const f=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const L=Math.max(H,Q,q);if(L>f){const U=f/L;H*=U,Q*=U,q*=U}}else H=(0,p.Clamp)(H,0,f),Q=(0,p.Clamp)(Q,0,f),q=(0,p.Clamp)(q,0,f);const v=new a.QU(H,Q,q);U.addLight(r,v,V),x+=V,S+=mL}E+=o}}const h=6*(4*Math.PI)/6/x;return U.scaleInPlace(h),U.convertIncidentRadianceToIrradiance(),U.convertIrradianceToLambertianRadiance(),G.d.FromHarmonics(U)}}A._FileFaces=[new o("right",new mL.YU(1,0,0),new mL.YU(0,0,-1),new mL.YU(0,-1,0)),new o("left",new mL.YU(-1,0,0),new mL.YU(0,0,1),new mL.YU(0,-1,0)),new o("up",new mL.YU(0,1,0),new mL.YU(1,0,0),new mL.YU(0,0,1)),new o("down",new mL.YU(0,-1,0),new mL.YU(1,0,0),new mL.YU(0,0,-1)),new o("front",new mL.YU(0,0,1),new mL.YU(1,0,0),new mL.YU(0,-1,0)),new o("back",new mL.YU(0,0,-1),new mL.YU(-1,0,0),new mL.YU(0,-1,0))],A.MAX_HDRI_VALUE=4096,A.PRESERVE_CLAMPED_COLORS=!1},12803:(L,U,x)=>{x.r(U),x.d(U,{Dispose:()=>b,DumpData:()=>h,DumpDataAsync:()=>r,DumpFramebuffer:()=>A,DumpTools:()=>E});var mL=x(12695),p=x(12382),G=x(12610),F=x(12440);let a,o=null;async function A(L,U,x,mL){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",G=arguments.length>5?arguments[5]:void 0,F=arguments.length>6?arguments[6]:void 0;const a=await x.readPixels(0,0,L,U);h(L,U,new Uint8Array(a.buffer),mL,p,G,!0,void 0,F)}async function r(L,U,x){let mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",p=arguments.length>4?arguments[4]:void 0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7?arguments[7]:void 0;return await new Promise((o=>{h(L,U,x,(L=>o(L)),mL,p,G,F,a)}))}function h(L,U,A,r){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",E=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7&&void 0!==arguments[7]&&arguments[7],V=arguments.length>8?arguments[8]:void 0;(async function(){return o||(o=new Promise(((L,U)=>{let p,G=null;const o={Ea:!0,depth:!1,Aa:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(x.bind(x,12723)).then((A=>{let{ThinEngine:r}=A;const h=F.c.Instances.length;try{p=new OffscreenCanvas(100,100),G=new r(p,!1,o)}catch(S){var E;h<F.c.Instances.length&&(null===(E=F.c.Instances.pop())||void 0===E||E.dispose()),p=document.createElement("canvas"),G=new r(p,!1,o)}F.c.Instances.pop(),F.c.OnEnginesDisposedObservable.add((L=>{G&&L!==G&&!G.A&&0===F.c.Instances.length&&b()})),G.getCaps().parallelShaderCompile=void 0;const Y=new mL.b(G);x.e(52).then(x.bind(x,15108)).then((x=>{let{passPixelShader:F}=x;if(!G)return void U("Engine is not defined");const o=new mL.e({EU:G,name:F.name,fragmentShader:F.shader,samplerNames:["textureSampler"]});a={canvas:p,EU:G,renderer:Y,wrapper:o},L(a)}))})).catch(U)}))),await o})().then((x=>{if(x.EU.setSize(L,U,!0),A instanceof Float32Array){const L=new Uint8Array(A.length);let U=A.length;for(;U--;){const x=A[U];L[U]=Math.round(255*(0,G.Clamp)(x))}A=L}const mL=x.EU.createRawTexture(A,L,U,5,!1,!Y,1);x.renderer.setViewport(),x.renderer.applyEffectWrapper(x.wrapper),x.wrapper.effect._bindTexture("textureSampler",mL),x.renderer.draw(),S?p.Tools.ToBlob(x.canvas,(L=>{const U=new FileReader;U.onload=L=>{const U=L.target.result;r&&r(U)},U.readAsArrayBuffer(L)}),h,V):p.Tools.EncodeScreenshotCanvasData(x.canvas,r,h,E,V),mL.dispose()}))}function b(){var L;a?(a.wrapper.dispose(),a.renderer.dispose(),a.EU.dispose()):null===(L=o)||void 0===L||L.then((L=>{L.wrapper.dispose(),L.renderer.dispose(),L.EU.dispose()}));o=null,a=null}const E={DumpData:h,DumpDataAsync:r,DumpFramebuffer:A,Dispose:b};p.Tools.DumpData=h,p.Tools.DumpDataAsync=r,p.Tools.DumpFramebuffer=A},13110:(L,U,x)=>{x.d(U,{d:()=>G});var mL=x(12686),p=x(12810);class G{static ExpandRGBDTexture(L){const U=L._texture;if(!U||!L.isRGBD)return;const p=U.getEngine(),G=p.getCaps(),F=U.isReady;let a=!1;G.textureHalfFloatRender&&G.textureHalfFloatLinearFiltering?(a=!0,U.type=2):G.textureFloatRender&&G.textureFloatLinearFiltering&&(a=!0,U.type=1),a&&(U.isReady=!1,U._isRGBD=!1,U.invertY=!1);const o=async()=>{const G=p.isWebGPU,F=G?1:0;U.isReady=!1,G?await x.e(42).then(x.bind(x,15668)):await x.e(35).then(x.bind(x,15673));const a=new mL.e("rgbdDecode","rgbdDecode",null,null,1,null,3,p,!1,void 0,U.type,void 0,null,!1,void 0,F);a.externalTextureSamplerBinding=!0;const o=p.createRenderTargetTexture(U.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:U.samplingMode,type:U.type,format:5});a.onEffectCreatedObservable.addOnce((x=>{x.executeWhenCompiled((()=>{a.onApply=L=>{L._bindTexture("textureSampler",U),L.setFloat2("scale",1,1)},L.PL().postProcessManager.directRender([a],o,!0),p.restoreDefaultFramebuffer(),p._releaseTexture(U),a&&a.dispose(),o._swapAndDie(U),U.isReady=!0}))}))};a&&(F?o():L.onLoadObservable.addOnce(o))}static async EncodeTextureToRGBD(L,U){let mL=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return U.getEngine().isWebGPU?await x.e(43).then(x.bind(x,15684)):await x.e(36).then(x.bind(x,15677)),await(0,p.e)("rgbdEncode",L,U,mL,1,5)}}}}]);