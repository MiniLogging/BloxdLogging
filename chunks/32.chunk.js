/*! For license information please see jlq0um.32.6d65ba4d.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[32],{13224:(o,H,n)=>{"use strict";var E=n(13232),k=n(13236),g=n(13242);n.g.__TYPEDARRAY_POOL||(n.g.__TYPEDARRAY_POOL={UINT8:k([32,0]),UINT16:k([32,0]),UINT32:k([32,0]),INT8:k([32,0]),INT16:k([32,0]),INT32:k([32,0]),FLOAT:k([32,0]),DOUBLE:k([32,0]),DATA:k([32,0]),UINT8C:k([32,0]),BUFFER:k([32,0])});var O="undefined"!==typeof Uint8ClampedArray,Y=n.g.__TYPEDARRAY_POOL;Y.UINT8C||(Y.UINT8C=k([32,0])),Y.BUFFER||(Y.BUFFER=k([32,0]));var y=Y.DATA,S=Y.BUFFER;function G(o){if(o){var H=o.length||o.byteLength,n=E.log2(H);y[n].push(o)}}function c(o){o=E.nextPow2(o);var H=E.log2(o),n=y[H];return n.length>0?n.pop():new ArrayBuffer(o)}function A(o){return new Uint8Array(c(o),0,o)}function l(o){return new Uint16Array(c(2*o),0,o)}function x(o){return new Uint32Array(c(4*o),0,o)}function z(o){return new Int8Array(c(o),0,o)}function V(o){return new Int16Array(c(2*o),0,o)}function J(o){return new Int32Array(c(4*o),0,o)}function N(o){return new Float32Array(c(4*o),0,o)}function h(o){return new Float64Array(c(8*o),0,o)}function Q(o){return O?new Uint8ClampedArray(c(o),0,o):A(o)}function p(o){return new DataView(c(o),0,o)}H.free=function(o){if(g(o))S[E.log2(o.length)].push(o);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(o)&&(o=o.buffer),!o)return;var H=o.length||o.byteLength,n=0|E.log2(H);y[n].push(o)}},H.freeUint8=H.freeUint16=H.freeUint32=H.freeInt8=H.freeInt16=H.freeInt32=H.freeFloat32=H.freeFloat=H.freeFloat64=H.freeDouble=H.freeUint8Clamped=H.freeDataView=function(o){G(o.buffer)},H.freeArrayBuffer=G,H.freeBuffer=function(o){S[E.log2(o.length)].push(o)},H.malloc=function(o,H){if(void 0===H||"arraybuffer"===H)return c(o);switch(H){case"uint8":return A(o);case"uint16":return l(o);case"uint32":return x(o);case"int8":return z(o);case"int16":return V(o);case"int32":return J(o);case"float":case"float32":return N(o);case"double":case"float64":return h(o);case"uint8_clamped":return Q(o);case"buffer":throw"Buffer not supported";case"data":case"dataview":return p(o);default:return null}return null},H.mallocArrayBuffer=c,H.mallocUint8=A,H.mallocUint16=l,H.mallocUint32=x,H.mallocInt8=z,H.mallocInt16=V,H.mallocInt32=J,H.mallocFloat32=H.mallocFloat=N,H.mallocFloat64=H.mallocDouble=h,H.mallocUint8Clamped=Q,H.mallocDataView=p,H.clearCache=function(){for(var o=0;o<32;++o)Y.UINT8[o].length=0,Y.UINT16[o].length=0,Y.UINT32[o].length=0,Y.INT8[o].length=0,Y.INT16[o].length=0,Y.INT32[o].length=0,Y.FLOAT[o].length=0,Y.DOUBLE[o].length=0,Y.UINT8C[o].length=0,y[o].length=0,S[o].length=0}},13329:(o,H,n)=>{o.exports=k;var E=n(12018);function k(o,H){if(!(this instanceof k))return new k(o,H);var n=E.create();E.add(n,o,H),this.base=E.min(E.create(),o,n),this.CS=E.clone(H),this.max=E.max(E.create(),o,n),this.mag=E.length(this.CS)}var g=k.prototype;g.width=function(){return this.CS[0]},g.height=function(){return this.CS[1]},g.depth=function(){return this.CS[2]},g.x0=function(){return this.base[0]},g.y0=function(){return this.base[1]},g.z0=function(){return this.base[2]},g.x1=function(){return this.max[0]},g.y1=function(){return this.max[1]},g.z1=function(){return this.max[2]},g.translate=function(o){return E.add(this.max,this.max,o),E.add(this.base,this.base,o),this},g.setPosition=function(o){return E.add(this.max,o,this.CS),E.j(this.base,o),this},g.expand=function(o){var H=E.create(),n=E.create();return E.max(H,o.max,this.max),E.min(n,o.base,this.base),E.zH(H,H,n),new k(n,H)},g.intersects=function(o){return!(o.base[0]>this.max[0])&&(!(o.base[1]>this.max[1])&&(!(o.base[2]>this.max[2])&&(!(o.max[0]<this.base[0])&&(!(o.max[1]<this.base[1])&&!(o.max[2]<this.base[2])))))},g.touches=function(o){var H=this.union(o);return null!==H&&(0==H.width()||0==H.height()||0==H.depth())},g.union=function(o){if(!this.intersects(o))return null;var H=Math.max(o.base[0],this.base[0]),n=Math.max(o.base[1],this.base[1]),E=Math.max(o.base[2],this.base[2]);return new k([H,n,E],[Math.min(o.max[0],this.max[0])-H,Math.min(o.max[1],this.max[1])-n,Math.min(o.max[2],this.max[2])-E])}},13232:(o,H)=>{"use strict";function n(o){var H=32;return(o&=-o)&&H--,65535&o&&(H-=16),16711935&o&&(H-=8),252645135&o&&(H-=4),858993459&o&&(H-=2),1431655765&o&&(H-=1),H}H.INT_BITS=32,H.INT_MAX=2147483647,H.INT_MIN=-1<<31,H.sign=function(o){return(o>0)-(o<0)},H.abs=function(o){var H=o>>31;return(o^H)-H},H.min=function(o,H){return H^(o^H)&-(o<H)},H.max=function(o,H){return o^(o^H)&-(o<H)},H.isPow2=function(o){return!(o&o-1)&&!!o},H.log2=function(o){var H,n;return H=(o>65535)<<4,H|=n=((o>>>=H)>255)<<3,H|=n=((o>>>=n)>15)<<2,(H|=n=((o>>>=n)>3)<<1)|(o>>>=n)>>1},H.log10=function(o){return o>=1e9?9:o>=1e8?8:o>=1e7?7:o>=1e6?6:o>=1e5?5:o>=1e4?4:o>=1e3?3:o>=100?2:o>=10?1:0},H.popCount=function(o){return 16843009*((o=(858993459&(o-=o>>>1&1431655765))+(o>>>2&858993459))+(o>>>4)&252645135)>>>24},H.countTrailingZeros=n,H.nextPow2=function(o){return o+=0===o,--o,o|=o>>>1,o|=o>>>2,o|=o>>>4,o|=o>>>8,(o|=o>>>16)+1},H.prevPow2=function(o){return o|=o>>>1,o|=o>>>2,o|=o>>>4,o|=o>>>8,(o|=o>>>16)-(o>>>1)},H.parity=function(o){return o^=o>>>16,o^=o>>>8,o^=o>>>4,27030>>>(o&=15)&1};var E=new Array(256);!function(o){for(var H=0;H<256;++H){var n=H,E=H,k=7;for(n>>>=1;n;n>>>=1)E<<=1,E|=1&n,--k;o[H]=E<<k&255}}(E),H.reverse=function(o){return E[255&o]<<24|E[o>>>8&255]<<16|E[o>>>16&255]<<8|E[o>>>24&255]},H.interleave2=function(o,H){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o&=65535)|o<<8))|o<<4))|o<<2))|o<<1))|(H=1431655765&((H=858993459&((H=252645135&((H=16711935&((H&=65535)|H<<8))|H<<4))|H<<2))|H<<1))<<1},H.deinterleave2=function(o,H){return(o=65535&((o=16711935&((o=252645135&((o=858993459&((o=o>>>H&1431655765)|o>>>1))|o>>>2))|o>>>4))|o>>>16))<<16>>16},H.interleave3=function(o,H,n){return o=1227133513&((o=3272356035&((o=251719695&((o=4278190335&((o&=1023)|o<<16))|o<<8))|o<<4))|o<<2),(o|=(H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},H.deinterleave3=function(o,H){return(o=1023&((o=4278190335&((o=251719695&((o=3272356035&((o=o>>>H&1227133513)|o>>>2))|o>>>4))|o>>>8))|o>>>16))<<22>>22},H.nextCombination=function(o){var H=o|o-1;return H+1|(~H&-~H)-1>>>n(o)+1}},13219:(o,H,n)=>{"use strict";o.exports=function(o,H,n){switch(arguments.length){case 1:return E=[],S(k=o,k,G,!0),E;case 2:return"function"===typeof H?S(o,o,H,!0):function(o,H){return E=[],S(o,H,G,!1),E}(o,H);case 3:return S(o,H,n,!1);default:throw new Error("box-intersect: Invalid arguments")}var k};var E,k=n(13224),g=n(13246),O=n(13254);function Y(o,H){for(var n=0;n<o;++n)if(!(H[n]<=H[n+o]))return!0;return!1}function y(o,H,n,E){for(var k=0,g=0,O=0,y=o.length;O<y;++O){var S=o[O];if(!Y(H,S)){for(var G=0;G<2*H;++G)n[k++]=S[G];E[g++]=O}}return g}function S(o,H,n,E){var Y=o.length,S=H.length;if(!(Y<=0||S<=0)){var G=o[0].length>>>1;if(!(G<=0)){var c,A=k.mallocDouble(2*G*Y),l=k.mallocInt32(Y);if((Y=y(o,G,A,l))>0){if(1===G&&E)g.init(Y),c=g.sweepComplete(G,n,0,Y,A,l,0,Y,A,l);else{var x=k.mallocDouble(2*G*S),z=k.mallocInt32(S);(S=y(H,G,x,z))>0&&(g.init(Y+S),c=1===G?g.sweepBipartite(G,n,0,Y,A,l,0,S,x,z):O(G,n,E,Y,A,l,S,x,z),k.free(x),k.free(z))}k.free(A),k.free(l)}return c}}}function G(o,H){E.push([o,H])}},13258:(o,H)=>{"use strict";var n="d",E="ax",k="fp",g="es",O="rs",Y="re",y="rb",S="bs",G="be",c="bb",A=[n,E,"vv",O,Y,y,"ri",S,G,c,"bi"];function l(o){var H="bruteForce"+(o?"Full":"Partial"),E=[],O=A.slice();o||O.splice(3,0,k);var Y=["function "+H+"("+O.join()+"){"];function y(H,k){var O=function(o,H,E){var k="bruteForce"+(o?"Red":"Blue")+(H?"Flip":"")+(E?"Full":""),O=["function ",k,"(",A.join(),"){","var ",g,"=2*",n,";"],Y="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",y="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(E?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return o?O.push(Y,"Q",":",y):O.push(y,"Q",":",Y),E?O.push("if(y1<x0||x1<y0)continue;"):H?O.push("if(y0<=x0||x1<y0)continue;"):O.push("if(y0<x0||x1<y0)continue;"),O.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),H?O.push("yi,xi"):O.push("xi,yi"),O.push(");if(rv!==void 0)return rv;}}}"),{name:k,code:O.join("")}}(H,k,o);E.push(O.code),Y.push("return "+O.name+"("+A.join()+");")}Y.push("if(re-rs>be-bs){"),o?(y(!0,!1),Y.push("}else{"),y(!1,!1)):(Y.push("if(fp){"),y(!0,!0),Y.push("}else{"),y(!0,!1),Y.push("}}else{if(fp){"),y(!1,!0),Y.push("}else{"),y(!1,!1),Y.push("}")),Y.push("}}return "+H);var S=E.join("")+Y.join("");return new Function(S)()}H.partial=l(!1),H.full=l(!0)},13254:(o,H,n)=>{"use strict";o.exports=function(o,H,n,g,G,Z,M,K,f){!function(o,H){var n=8*k.log2(H+1)*(o+1)|0,g=k.nextPow2(Q*n);j.length<g&&(E.free(j),j=E.mallocInt32(g));var O=k.nextPow2(p*n);m.length<O&&(E.free(m),m=E.mallocDouble(O))}(o,g+M);var B,q=0,D=2*o;P(q++,0,0,g,0,M,n?16:0,-1/0,1/0),n||P(q++,0,0,M,0,g,1,-1/0,1/0);for(;q>0;){var T=(q-=1)*Q,a=j[T],F=j[T+1],C=j[T+2],t=j[T+3],X=j[T+4],s=j[T+5],U=q*p,I=m[U],v=m[U+1],w=1&s,r=!!(16&s),u=G,d=Z,R=K,W=f;if(w&&(u=K,d=f,R=G,W=Z),!(2&s&&F>=(C=V(o,a,F,C,u,d,v)))&&!(4&s&&(F=J(o,a,F,C,u,d,I))>=C)){var i=C-F,L=X-t;if(r){if(o*i*(i+L)<l){if(void 0!==(B=y.scanComplete(o,a,H,F,C,u,d,t,X,R,W)))return B;continue}}else{if(o*Math.min(i,L)<c){if(void 0!==(B=O(o,a,H,w,F,C,u,d,t,X,R,W)))return B;continue}if(o*i*L<A){if(void 0!==(B=y.scanBipartite(o,a,H,w,F,C,u,d,t,X,R,W)))return B;continue}}var oo=x(o,a,F,C,u,d,I,v);if(F<oo)if(o*(oo-F)<c){if(void 0!==(B=Y(o,a+1,H,F,oo,u,d,t,X,R,W)))return B}else if(a===o-2){if(void 0!==(B=w?y.sweepBipartite(o,H,t,X,R,W,F,oo,u,d):y.sweepBipartite(o,H,F,oo,u,d,t,X,R,W)))return B}else P(q++,a+1,F,oo,t,X,w,-1/0,1/0),P(q++,a+1,t,X,F,oo,1^w,-1/0,1/0);if(oo<C){var Ho=S(o,a,t,X,R,W),no=R[D*Ho+a],Eo=z(o,a,Ho,X,R,W,no);if(Eo<X&&P(q++,a,oo,C,Eo,X,(4|w)+(r?16:0),no,v),t<Ho&&P(q++,a,oo,C,t,Ho,(2|w)+(r?16:0),I,no),Ho+1===Eo){if(void 0!==(B=r?e(o,a,H,oo,C,u,d,Ho,R,W[Ho]):b(o,a,H,w,oo,C,u,d,Ho,R,W[Ho])))return B}else if(Ho<Eo){var ko;if(r){if(oo<(ko=N(o,a,oo,C,u,d,no))){var go=z(o,a,oo,ko,u,d,no);if(a===o-2){if(oo<go&&void 0!==(B=y.sweepComplete(o,H,oo,go,u,d,Ho,Eo,R,W)))return B;if(go<ko&&void 0!==(B=y.sweepBipartite(o,H,go,ko,u,d,Ho,Eo,R,W)))return B}else oo<go&&P(q++,a+1,oo,go,Ho,Eo,16,-1/0,1/0),go<ko&&(P(q++,a+1,go,ko,Ho,Eo,0,-1/0,1/0),P(q++,a+1,Ho,Eo,go,ko,1,-1/0,1/0))}}else oo<(ko=w?h(o,a,oo,C,u,d,no):N(o,a,oo,C,u,d,no))&&(a===o-2?B=w?y.sweepBipartite(o,H,Ho,Eo,R,W,oo,ko,u,d):y.sweepBipartite(o,H,oo,ko,u,d,Ho,Eo,R,W):(P(q++,a+1,oo,ko,Ho,Eo,w,-1/0,1/0),P(q++,a+1,Ho,Eo,oo,ko,1^w,-1/0,1/0)))}}}}};var E=n(13224),k=n(13232),g=n(13258),O=g.partial,Y=g.full,y=n(13246),S=n(13265),G=n(13269),c=128,A=1<<22,l=1<<22,x=G("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),z=G("lo===p0",["p0"]),V=G("lo<p0",["p0"]),J=G("hi<=p0",["p0"]),N=G("lo<=p0&&p0<=hi",["p0"]),h=G("lo<p0&&p0<=hi",["p0"]),Q=6,p=2,j=E.mallocInt32(1024),m=E.mallocDouble(1024);function P(o,H,n,E,k,g,O,Y,y){var S=Q*o;j[S]=H,j[S+1]=n,j[S+2]=E,j[S+3]=k,j[S+4]=g,j[S+5]=O;var G=p*o;m[G]=Y,m[G+1]=y}function b(o,H,n,E,k,g,O,Y,y,S,G){var c=2*o,A=y*c,l=S[A+H];o:for(var x=k,z=k*c;x<g;++x,z+=c){var V=O[z+H],J=O[z+H+o];if(!(l<V||J<l)&&(!E||l!==V)){for(var N,h=Y[x],Q=H+1;Q<o;++Q){V=O[z+Q],J=O[z+Q+o];var p=S[A+Q],j=S[A+Q+o];if(J<p||j<V)continue o}if(void 0!==(N=E?n(G,h):n(h,G)))return N}}}function e(o,H,n,E,k,g,O,Y,y,S){var G=2*o,c=Y*G,A=y[c+H];o:for(var l=E,x=E*G;l<k;++l,x+=G){var z=O[l];if(z!==S){var V=g[x+H],J=g[x+H+o];if(!(A<V||J<A)){for(var N=H+1;N<o;++N){V=g[x+N],J=g[x+N+o];var h=y[c+N],Q=y[c+N+o];if(J<h||Q<V)continue o}var p=n(z,S);if(void 0!==p)return p}}}}},13265:(o,H,n)=>{"use strict";o.exports=function(o,H,n,O,Y,y){if(O<=n+1)return n;var S=n,G=O,c=O+n>>>1,A=2*o,l=c,x=Y[A*c+H];for(;S<G;){if(G-S<k){g(o,H,S,G,Y,y),x=Y[A*c+H];break}var z=G-S,V=Math.random()*z+S|0,J=Y[A*V+H],N=Math.random()*z+S|0,h=Y[A*N+H],Q=Math.random()*z+S|0,p=Y[A*Q+H];J<=h?p>=h?(l=N,x=h):J>=p?(l=V,x=J):(l=Q,x=p):h>=p?(l=N,x=h):p>=J?(l=V,x=J):(l=Q,x=p);for(var j=A*(G-1),m=A*l,P=0;P<A;++P,++j,++m){var b=Y[j];Y[j]=Y[m],Y[m]=b}var e=y[G-1];y[G-1]=y[l],y[l]=e;for(j=A*(G-1),m=A*(l=E(o,H,S,G-1,Y,y,x)),P=0;P<A;++P,++j,++m){b=Y[j];Y[j]=Y[m],Y[m]=b}e=y[G-1];if(y[G-1]=y[l],y[l]=e,c<l){for(G=l-1;S<G&&Y[A*(G-1)+H]===x;)G-=1;G+=1}else{if(!(l<c))break;for(S=l+1;S<G&&Y[A*S+H]===x;)S+=1}}return E(o,H,n,c,Y,y,Y[A*c+H])};var E=n(13269)("lo<p0",["p0"]),k=8;function g(o,H,n,E,k,g){for(var O=2*o,Y=O*(n+1)+H,y=n+1;y<E;++y,Y+=O)for(var S=k[Y],G=y,c=O*(y-1);G>n&&k[c+H]>S;--G,c-=O){for(var A=c,l=c+O,x=0;x<O;++x,++A,++l){var z=k[A];k[A]=k[l],k[l]=z}var V=g[G];g[G]=g[G-1],g[G-1]=V}}},13269:o=>{"use strict";o.exports=function(o,n){var E="abcdef".split("").concat(n),k=[];o.indexOf("lo")>=0&&k.push("lo=e[k+n]");o.indexOf("hi")>=0&&k.push("hi=e[k+o]");return E.push(H.replace("_",k.join()).replace("$",o)),Function.apply(void 0,E)};var H="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13252:o=>{"use strict";o.exports=function(o,E){E<=4*H?n(0,E-1,o):S(0,E-1,o)};var H=32;function n(o,H,n){for(var E=2*(o+1),k=o+1;k<=H;++k){for(var g=n[E++],O=n[E++],Y=k,y=E-2;Y-- >o;){var S=n[y-2],G=n[y-1];if(S<g)break;if(S===g&&G<O)break;n[y]=S,n[y+1]=G,y-=2}n[y]=g,n[y+1]=O}}function E(o,H,n){H*=2;var E=n[o*=2],k=n[o+1];n[o]=n[H],n[o+1]=n[H+1],n[H]=E,n[H+1]=k}function k(o,H,n){H*=2,n[o*=2]=n[H],n[o+1]=n[H+1]}function g(o,H,n,E){H*=2,n*=2;var k=E[o*=2],g=E[o+1];E[o]=E[H],E[o+1]=E[H+1],E[H]=E[n],E[H+1]=E[n+1],E[n]=k,E[n+1]=g}function O(o,H,n,E,k){H*=2,k[o*=2]=k[H],k[H]=n,k[o+1]=k[H+1],k[H+1]=E}function Y(o,H,n){H*=2;var E=n[o*=2],k=n[H];return!(E<k)&&(E!==k||n[o+1]>n[H+1])}function y(o,H,n,E){var k=E[o*=2];return k<H||k===H&&E[o+1]<n}function S(o,G,c){var A=(G-o+1)/6|0,l=o+A,x=G-A,z=o+G>>1,V=z-A,J=z+A,N=l,h=V,Q=z,p=J,j=x,m=o+1,P=G-1,b=0;Y(N,h,c)&&(b=N,N=h,h=b),Y(p,j,c)&&(b=p,p=j,j=b),Y(N,Q,c)&&(b=N,N=Q,Q=b),Y(h,Q,c)&&(b=h,h=Q,Q=b),Y(N,p,c)&&(b=N,N=p,p=b),Y(Q,p,c)&&(b=Q,Q=p,p=b),Y(h,j,c)&&(b=h,h=j,j=b),Y(h,Q,c)&&(b=h,h=Q,Q=b),Y(p,j,c)&&(b=p,p=j,j=b);for(var e=c[2*h],Z=c[2*h+1],M=c[2*p],K=c[2*p+1],f=2*N,B=2*Q,q=2*j,D=2*l,T=2*z,a=2*x,F=0;F<2;++F){var C=c[f+F],t=c[B+F],X=c[q+F];c[D+F]=C,c[T+F]=t,c[a+F]=X}k(V,o,c),k(J,G,c);for(var s=m;s<=P;++s)if(y(s,e,Z,c))s!==m&&E(s,m,c),++m;else if(!y(s,M,K,c))for(;;){if(y(P,M,K,c)){y(P,e,Z,c)?(g(s,m,P,c),++m,--P):(E(s,P,c),--P);break}if(--P<s)break}O(o,m-1,e,Z,c),O(G,P+1,M,K,c),m-2-o<=H?n(o,m-2,c):S(o,m-2,c),G-(P+2)<=H?n(P+2,G,c):S(P+2,G,c),P-m<=H?n(m,P,c):S(m,P,c)}},13246:(o,H,n)=>{"use strict";o.exports={init:function(o){var H=k.nextPow2(o);y.length<H&&(E.free(y),y=E.mallocInt32(H));S.length<H&&(E.free(S),S=E.mallocInt32(H));G.length<H&&(E.free(G),G=E.mallocInt32(H));c.length<H&&(E.free(c),c=E.mallocInt32(H));A.length<H&&(E.free(A),A=E.mallocInt32(H));l.length<H&&(E.free(l),l=E.mallocInt32(H));var n=8*H;x.length<n&&(E.free(x),x=E.mallocDouble(n))},sweepBipartite:function(o,H,n,E,k,Y,A,l,J,N){for(var h=0,Q=2*o,p=o-1,j=Q-1,m=n;m<E;++m){var P=Y[m],b=Q*m;x[h++]=k[b+p],x[h++]=-(P+1),x[h++]=k[b+j],x[h++]=P}for(m=A;m<l;++m){P=N[m]+O;var e=Q*m;x[h++]=J[e+p],x[h++]=-P,x[h++]=J[e+j],x[h++]=P}var Z=h>>>1;g(x,Z);var M=0,K=0;for(m=0;m<Z;++m){var f=0|x[2*m+1];if(f>=O)z(G,c,K--,f=f-O|0);else if(f>=0)z(y,S,M--,f);else if(f<=-O){f=-f-O|0;for(var B=0;B<M;++B){if(void 0!==(q=H(y[B],f)))return q}V(G,c,K++,f)}else{f=-f-1|0;for(B=0;B<K;++B){var q;if(void 0!==(q=H(f,G[B])))return q}V(y,S,M++,f)}}},sweepComplete:function(o,H,n,E,k,O,Y,J,N,h){for(var Q=0,p=2*o,j=o-1,m=p-1,P=n;P<E;++P){var b=O[P]+1<<1,e=p*P;x[Q++]=k[e+j],x[Q++]=-b,x[Q++]=k[e+m],x[Q++]=b}for(P=Y;P<J;++P){b=h[P]+1<<1;var Z=p*P;x[Q++]=N[Z+j],x[Q++]=1|-b,x[Q++]=N[Z+m],x[Q++]=1|b}var M=Q>>>1;g(x,M);var K=0,f=0,B=0;for(P=0;P<M;++P){var q=0|x[2*P+1],D=1&q;if(P<M-1&&q>>1===x[2*P+3]>>1&&(D=2,P+=1),q<0){for(var T=-(q>>1)-1,a=0;a<B;++a){if(void 0!==(F=H(A[a],T)))return F}if(0!==D)for(a=0;a<K;++a){if(void 0!==(F=H(y[a],T)))return F}if(1!==D)for(a=0;a<f;++a){var F;if(void 0!==(F=H(G[a],T)))return F}0===D?V(y,S,K++,T):1===D?V(G,c,f++,T):2===D&&V(A,l,B++,T)}else{T=(q>>1)-1;0===D?z(y,S,K--,T):1===D?z(G,c,f--,T):2===D&&z(A,l,B--,T)}}},scanBipartite:function(o,H,n,E,k,Y,G,c,A,l,J,N){var h=0,Q=2*o,p=H,j=H+o,m=1,P=1;E?P=O:m=O;for(var b=k;b<Y;++b){var e=b+m,Z=Q*b;x[h++]=G[Z+p],x[h++]=-e,x[h++]=G[Z+j],x[h++]=e}for(b=A;b<l;++b){e=b+P;var M=Q*b;x[h++]=J[M+p],x[h++]=-e}var K=h>>>1;g(x,K);var f=0;for(b=0;b<K;++b){var B=0|x[2*b+1];if(B<0){var q=!1;if((e=-B)>=O?(q=!E,e-=O):(q=!!E,e-=1),q)V(y,S,f++,e);else{var D=N[e],T=Q*e,a=J[T+H+1],F=J[T+H+1+o];o:for(var C=0;C<f;++C){var t=y[C],X=Q*t;if(!(F<G[X+H+1]||G[X+H+1+o]<a)){for(var s=H+2;s<o;++s)if(J[T+s+o]<G[X+s]||G[X+s+o]<J[T+s])continue o;var U,I=c[t];if(void 0!==(U=E?n(D,I):n(I,D)))return U}}}}else z(y,S,f--,B-m)}},scanComplete:function(o,H,n,E,k,Y,S,G,c,A,l){for(var z=0,V=2*o,J=H,N=H+o,h=E;h<k;++h){var Q=h+O,p=V*h;x[z++]=Y[p+J],x[z++]=-Q,x[z++]=Y[p+N],x[z++]=Q}for(h=G;h<c;++h){Q=h+1;var j=V*h;x[z++]=A[j+J],x[z++]=-Q}var m=z>>>1;g(x,m);var P=0;for(h=0;h<m;++h){var b=0|x[2*h+1];if(b<0){if((Q=-b)>=O)y[P++]=Q-O;else{var e=l[Q-=1],Z=V*Q,M=A[Z+H+1],K=A[Z+H+1+o];o:for(var f=0;f<P;++f){var B=y[f],q=S[B];if(q===e)break;var D=V*B;if(!(K<Y[D+H+1]||Y[D+H+1+o]<M)){for(var T=H+2;T<o;++T)if(A[Z+T+o]<Y[D+T]||Y[D+T+o]<A[Z+T])continue o;var a=n(q,e);if(void 0!==a)return a}}}}else{for(Q=b-O,f=P-1;f>=0;--f)if(y[f]===Q){for(T=f+1;T<P;++T)y[T-1]=y[T];break}--P}}}};var E=n(13224),k=n(13232),g=n(13252),O=1<<28,Y=1024,y=E.mallocInt32(Y),S=E.mallocInt32(Y),G=E.mallocInt32(Y),c=E.mallocInt32(Y),A=E.mallocInt32(Y),l=E.mallocInt32(Y),x=E.mallocDouble(8192);function z(o,H,n,E){var k=H[E],g=o[n-1];o[k]=g,H[g]=k}function V(o,H,n,E){o[n]=E,H[E]=n}},13236:o=>{"use strict";function H(o,n,E){var k=0|o[E];if(k<=0)return[];var g,O=new Array(k);if(E===o.length-1)for(g=0;g<k;++g)O[g]=n;else for(g=0;g<k;++g)O[g]=H(o,n,E+1);return O}o.exports=function(o,n){switch("undefined"===typeof n&&(n=0),typeof o){case"number":if(o>0)return function(o,H){var n,E;for(n=new Array(o),E=0;E<o;++E)n[E]=H;return n}(0|o,n);break;case"object":if("number"===typeof o.length)return H(o,n,0)}return[]}},13190:(o,H,n)=>{o.exports=function(){var o=this;this.components={},this.comps=this.components;var H=this.components,n=1,k={},g=[],O=[],Y={timeout:!1,removals:[],multiComps:[]};function y(o,n){var E=H[n],g=k[n],O=g.hash[o];O&&(g.remove(o),E.ln&&(E.multi?(O.forEach((H=>{H&&E.ln(o,H)})),O.length=0):E.ln(o,O)),Y.removals.push(g),S())}function S(){Y.timeout||(Y.timeout=!0,setTimeout(G,1))}function G(){Y.timeout=!1,c()}function c(){Y.multiComps.length&&function(o){for(var H=0;H<o.length;H++){var{entID:n,data:E}=o[H],k=E.hash[n];if(k){for(var g=0;g<k.length;g++)k[g]||(k.splice(g,1),g--);0===k.length&&(E.remove(n),Y.removals.push(E))}}o.length=0}(Y.multiComps),Y.removals.length&&function(o){for(var H=0;H<o.length;H++){o[H].flush()}o.length=0}(Y.removals)}this.LG=k,this._systems=g,this._renderSystems=O,this.sS=function(H){var E=n++;return Array.isArray(H)&&H.forEach((H=>o.Py(E,H))),E},this.deleteEntity=function(H){return Object.keys(k).forEach((o=>{k[o].hash[H]&&y(H,o)})),o},this.EG=function(o){if(!o)throw new Error("Missing component definition");var n=o.name;if(!n)throw new Error("Component definition must have a name property.");if("string"!==typeof n)throw new Error("Component name must be a string.");if(""===n)throw new Error("Component name must be a non-empty string.");if(k[n])throw new Error(`Component ${n} already exists.`);var Y={};return Y.name=n,Y.multi=!!o.multi,Y.order=isNaN(o.order)?99:o.order,Y.stateConstructor=o.stateConstructor||null,Y.state=o.state||{},Y.PY=o.PY||null,Y.ln=o.ln||null,Y.system=o.system||null,Y.qY=o.qY||null,H[n]=Y,k[n]=new E,k[n]._pendingMultiCleanup=!1,k[n]._multiCleanupIDs=Y.multi?[]:null,Y.system&&(g.push(n),g.sort(((o,n)=>H[o].order-H[n].order))),Y.qY&&(O.push(n),O.sort(((o,n)=>H[o].order-H[n].order))),n},this.overwriteComponent=function(o,n){var E=H[o];if(!E)throw new Error(`Unknown component: ${o}`);if(!n)throw new Error("Missing component definition");if(E.name!==n.name)throw new Error("Overwriting component must use the same name property.");var Y={};Y.name=o,Y.multi=!!n.multi,Y.order=isNaN(n.order)?99:n.order,Y.state=n.state||{},Y.PY=n.PY||null,Y.ln=n.ln||null,Y.system=n.system||null,Y.qY=n.qY||null,H[o]=Y,k[o]._pendingMultiCleanup=!1,k[o]._multiCleanupIDs=Y.multi?[]:null;var y=g.indexOf(o);Y.system&&y<0&&g.push(o),!Y.system&&y>=0&&g.splice(y,1),g.sort(((o,n)=>H[o].order-H[n].order));var S=O.indexOf(o);Y.qY&&S<0&&O.push(o),!Y.qY&&S>=0&&O.splice(S,1),O.sort(((o,n)=>H[o].order-H[n].order));var G=Y.state;return this.PS(o).forEach((o=>{for(var H in G)H in o||(o[H]=G[H]);Y.PY&&Y.PY(o.fY,o)})),o},this.deleteComponent=function(n){var E=k[n];if(!E)throw new Error(`Unknown component: ${n}`);E.flush(),E.list.forEach((o=>{o&&y(o.fY||o[0].fY,n)}));var Y=g.indexOf(n),S=O.indexOf(n);return Y>-1&&g.splice(Y,1),S>-1&&O.splice(S,1),k[n].dispose(),delete k[n],delete H[n],o},this.Py=function(o,n,E){var g,O=H[n],Y=k[n];if(!Y)throw new Error(`Unknown component: ${n}.`);if(Y.hash[o]&&!O.multi)throw new Error(`Entity ${o} already has component: ${n}.`);if(O.stateConstructor){if(!(g=new O.stateConstructor).hasOwnProperty("fY"))throw new Error(`Component ${O.name} stateConstructor type does not have property __id`)}else g=Object.assign({},{fY:o},O.state,E);if(g.fY=o,O.multi){var y=Y.hash[o];y||(y=[],Y.add(o,y)),y.push(g)}else Y.add(o,g);return O.PY&&O.PY(o,g),this},this.Fy=function(o,H){var n=k[H];if(!n)throw new Error(`Unknown component: ${H}.`);return!!n.hash[o]},this.My=function(H,n){if(!k[n])throw new Error(`Unknown component: ${n}.`);return y(H,n),o},this.getState=function(o,H){var n=k[H];if(!n)throw new Error(`Unknown component: ${H}.`);return n.hash[o]},this.PS=function(o){var H=k[o];if(!H)throw new Error(`Unknown component: ${o}.`);return c(),H.list},this.el=function(o){if(!k[o])throw new Error(`Unknown component: ${o}.`);var H=k[o].hash;return o=>H[o]},this.Kl=function(o){if(!k[o])throw new Error(`Unknown component: ${o}.`);var H=k[o].hash;return o=>!!H[o]},this.GY=function(n){c();for(var E=0;E<g.length;E++){var O=g[E],Y=H[O],y=k[O];Y.system(n,y.list),c()}return o},this.render=function(n){c();for(var E=0;E<O.length;E++){var g=O[E],Y=H[g],y=k[g];Y.qY(n,y.list),c()}return o},this.removeMultiComponent=function(n,E,g){var O=H[E],y=k[E];if(!y)throw new Error(`Unknown component: ${E}.`);if(!O.multi)throw new Error("removeMultiComponent called on non-multi component");return function(o,H,n,E){var k=n.hash[o];if(k){var g=k[E];g&&(k[E]=null,H.ln&&H.ln(o,g),Y.multiComps.push({entID:o,data:n}),S())}}(n,O,y,g),o}};var E=n(13192)},13192:o=>{function H(o,H){var n=o._map[H];if(delete o.hash[H],delete o._map[H],n===o.list.length-1)o.list.pop();else{var E=o.list.pop();if(o.list[n]=E,null===E||null===E[0]){var k=o.list.length;for(var g in o._map)if(o._map[g]===k)return void(o._map[g]=n)}else{var O=E.fY||E[0].fY;o._map[O]=n}}}o.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(o,H){if("number"===typeof this._map[o]){var n=this._map[o];this.hash[o]=H,this.list[n]=H}else this._map[o]=this.list.length,this.hash[o]=H,this.list.push(H)}remove(o){var H=this._map[o];this.hash[o]=null,this.list[H]=null,this._pendingRemovals.push(o)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var o=0;o<this._pendingRemovals.length;o++){var n=this._pendingRemovals[o];null===this.hash[n]&&H(this,n)}this._pendingRemovals.length=0}}},13137:o=>{"use strict";var H,n="object"===typeof Reflect?Reflect:null,E=function(o,H,n){return Function.prototype.apply.call(o,H,n)};H=n&&"function"===typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(o){return Object.getOwnPropertyNames(o).concat(Object.getOwnPropertySymbols(o))}:function(o){return Object.getOwnPropertyNames(o)};var k=Number.isNaN||function(o){return o!==o};function g(){g.init.call(this)}o.exports=g,o.exports.once=function(o,H){return new Promise((function(n,E){function k(n){o.removeListener(H,g),E(n)}function g(){"function"===typeof o.removeListener&&o.removeListener("error",k),n([].slice.call(arguments))}z(o,H,g,{once:!0}),"error"!==H&&function(o,H,n){"function"===typeof o.on&&z(o,"error",H,n)}(o,k,{once:!0})}))},g.EventEmitter=g,g.prototype._events=void 0,g.prototype._eventsCount=0,g.prototype._maxListeners=void 0;var O=10;function Y(o){if("function"!==typeof o)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof o)}function y(o){return void 0===o._maxListeners?g.defaultMaxListeners:o._maxListeners}function S(o,H,n,E){var k,g,O,S;if(Y(n),void 0===(g=o._events)?(g=o._events=Object.create(null),o._eventsCount=0):(void 0!==g.newListener&&(o.emit("newListener",H,n.listener?n.listener:n),g=o._events),O=g[H]),void 0===O)O=g[H]=n,++o._eventsCount;else if("function"===typeof O?O=g[H]=E?[n,O]:[O,n]:E?O.unshift(n):O.push(n),(k=y(o))>0&&O.length>k&&!O.warned){O.warned=!0;var G=new Error("Possible EventEmitter memory leak detected. "+O.length+" "+String(H)+" listeners added. Use emitter.setMaxListeners() to increase limit");G.name="MaxListenersExceededWarning",G.i=o,G.type=H,G.count=O.length,S=G,console&&console.warn&&console.warn(S)}return o}function G(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function c(o,H,n){var E={fired:!1,wrapFn:void 0,target:o,type:H,listener:n},k=G.bind(E);return k.listener=n,E.wrapFn=k,k}function A(o,H,n){var E=o._events;if(void 0===E)return[];var k=E[H];return void 0===k?[]:"function"===typeof k?n?[k.listener||k]:[k]:n?function(o){for(var H=new Array(o.length),n=0;n<H.length;++n)H[n]=o[n].listener||o[n];return H}(k):x(k,k.length)}function l(o){var H=this._events;if(void 0!==H){var n=H[o];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function x(o,H){for(var n=new Array(H),E=0;E<H;++E)n[E]=o[E];return n}function z(o,H,n,E){if("function"===typeof o.on)E.once?o.once(H,n):o.on(H,n);else{if("function"!==typeof o.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof o);o.addEventListener(H,(function k(g){E.once&&o.removeEventListener(H,k),n(g)}))}}Object.defineProperty(g,"defaultMaxListeners",{enumerable:!0,get:function(){return O},set:function(o){if("number"!==typeof o||o<0||k(o))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+o+".");O=o}}),g.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},g.prototype.setMaxListeners=function(o){if("number"!==typeof o||o<0||k(o))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+o+".");return this._maxListeners=o,this},g.prototype.getMaxListeners=function(){return y(this)},g.prototype.emit=function(o){for(var H=[],n=1;n<arguments.length;n++)H.push(arguments[n]);var k="error"===o,g=this._events;if(void 0!==g)k=k&&void 0===g.error;else if(!k)return!1;if(k){var O;if(H.length>0&&(O=H[0]),O instanceof Error)throw O;var Y=new Error("Unhandled error."+(O?" ("+O.message+")":""));throw Y.context=O,Y}var y=g[o];if(void 0===y)return!1;if("function"===typeof y)E(y,this,H);else{var S=y.length,G=x(y,S);for(n=0;n<S;++n)E(G[n],this,H)}return!0},g.prototype.addListener=function(o,H){return S(this,o,H,!1)},g.prototype.on=g.prototype.addListener,g.prototype.prependListener=function(o,H){return S(this,o,H,!0)},g.prototype.once=function(o,H){return Y(H),this.on(o,c(this,o,H)),this},g.prototype.prependOnceListener=function(o,H){return Y(H),this.prependListener(o,c(this,o,H)),this},g.prototype.removeListener=function(o,H){var n,E,k,g,O;if(Y(H),void 0===(E=this._events))return this;if(void 0===(n=E[o]))return this;if(n===H||n.listener===H)0===--this._eventsCount?this._events=Object.create(null):(delete E[o],E.removeListener&&this.emit("removeListener",o,n.listener||H));else if("function"!==typeof n){for(k=-1,g=n.length-1;g>=0;g--)if(n[g]===H||n[g].listener===H){O=n[g].listener,k=g;break}if(k<0)return this;0===k?n.shift():function(o,H){for(;H+1<o.length;H++)o[H]=o[H+1];o.pop()}(n,k),1===n.length&&(E[o]=n[0]),void 0!==E.removeListener&&this.emit("removeListener",o,O||H)}return this},g.prototype.off=g.prototype.removeListener,g.prototype.removeAllListeners=function(o){var H,n,E;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[o]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[o]),this;if(0===arguments.length){var k,g=Object.keys(n);for(E=0;E<g.length;++E)"removeListener"!==(k=g[E])&&this.removeAllListeners(k);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(H=n[o]))this.removeListener(o,H);else if(void 0!==H)for(E=H.length-1;E>=0;E--)this.removeListener(o,H[E]);return this},g.prototype.listeners=function(o){return A(this,o,!0)},g.prototype.rawListeners=function(o){return A(this,o,!1)},g.listenerCount=function(o,H){return"function"===typeof o.listenerCount?o.listenerCount(H):l.call(o,H)},g.prototype.listenerCount=l,g.prototype.eventNames=function(){return this._eventsCount>0?H(this._events):[]}},13451:o=>{"use strict";o.exports=function(o,H,n,E,k,g){var O=+H[0],Y=+H[1],y=+H[2],S=+n[0],G=+n[1],c=+n[2],A=Math.sqrt(S*S+G*G+c*c);if(0===A)throw new Error("Can't raycast along a zero vector");return function(o,H,n,E,k,g,O,Y,y,S){for(var G=0,c=Math.floor,A=0|c(H),l=0|c(n),x=0|c(E),z=k>0?1:-1,V=g>0?1:-1,J=O>0?1:-1,N=Math.abs(1/k),h=Math.abs(1/g),Q=Math.abs(1/O),p=N<1/0?N*(z>0?A+1-H:H-A):1/0,j=h<1/0?h*(V>0?l+1-n:n-l):1/0,m=Q<1/0?Q*(J>0?x+1-E:E-x):1/0,P=-1;G<=Y;){var b=o(A,l,x);if(b)return y&&(y[0]=H+G*k,y[1]=n+G*g,y[2]=E+G*O),S&&(S[0]=S[1]=S[2]=0,0===P&&(S[0]=-z),1===P&&(S[1]=-V),2===P&&(S[2]=-J)),b;p<j?p<m?(A+=z,G=p,p+=N,P=0):(x+=J,G=m,m+=Q,P=2):j<m?(l+=V,G=j,j+=h,P=1):(x+=J,G=m,m+=Q,P=2)}return y&&(y[0]=H+G*k,y[1]=n+G*g,y[2]=E+G*O),S&&(S[0]=S[1]=S[2]=0),0}(o,O,Y,y,S/=A,G/=A,c/=A,E="undefined"===typeof E?64:+E,k,g)}},13485:(o,H,n)=>{"use strict";n.d(H,{d:()=>g});var E=n(13137);function k(){this.ZA=!1,this.stopPropagation=!1,this.MA=!1,this.disabled=!1}class g{constructor(o,H){this.version="0.7.0";var n=Object.assign({},new k,H||{});this.element=o||document,this.ZA=!!n.ZA,this.stopPropagation=!!n.stopPropagation,this.MA=!!n.MA,this.disabled=!!n.disabled,this.filterEvents=(o,H)=>!0,this.down=new E.EventEmitter,this.up=new E.EventEmitter,this.state={},this.NS={dx:0,dy:0,Jl:0,JS:0,Nl:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?Y(this):document.addEventListener("DOMContentLoaded",(o=>{Y(this)}),{once:!0})}bind(o){for(var H=arguments.length,n=new Array(H>1?H-1:0),E=1;E<H;E++)n[E-1]=arguments[E];n.forEach((H=>{var n=this._keyBindmap[H]||[];n.includes(o)||(n.push(o),this._keyBindmap[H]=n)})),this.state[o]=!!this.state[o],this.pressCount[o]=this.pressCount[o]||0,this.releaseCount[o]=this.releaseCount[o]||0}unbind(o){for(var H in this._keyBindmap){var n=this._keyBindmap[H],E=n.indexOf(o);E>-1&&n.splice(E,1)}}getBindings(){var o={};for(var H in this._keyBindmap){this._keyBindmap[H].forEach((n=>{o[n]=o[n]||[],o[n].push(H)}))}return o}GY(){O(this.NS),O(this.pressCount),O(this.releaseCount)}}function O(o){for(var H in o)o[H]=0}function Y(o){window.addEventListener("keydown",x.bind(null,o,!0),!1),window.addEventListener("keyup",x.bind(null,o,!1),!1);var H={passive:!0};o.element.addEventListener("touchstart",c.bind(void 0,o),{passive:!1}),o.element.addEventListener("touchend",l.bind(void 0,o),H),o.element.addEventListener("mousedown",z.bind(null,o,!0),H),window.document.addEventListener("mouseup",z.bind(null,o,!1),H),o.element.addEventListener("touchmove",V.bind(null,o),H),o.element.addEventListener("mousemove",V.bind(null,o),H),window.PointerEvent,o.element.addEventListener("wheel",J.bind(null,o),H),o.element.addEventListener("contextmenu",N.bind(null,o),!1),window.addEventListener("blur",h.bind(null,o),!1)}var y=0,S=0,G=null;function c(o,H){H.preventDefault(),A(H)}function A(o){let H=!1;for(let n=0;n<o.touches.length;++n)if(o.touches[n].identifier===G){H=!0;break}if(!H){const H=o.changedTouches[0];y=H.clientX,S=H.clientY,G=H.identifier}}function l(o,H){for(var n=H.changedTouches,E=0;E<n.length;++E)n[E].identifier===G&&(G=null)}function x(o,H,n){Q(n.code,H,o,n)}function z(o,H,n){if("pointerId"in n)if(H){if(null!==o._touches.currID)return;o._touches.currID=n.pointerId}else{if(o._touches.currID!==n.pointerId)return;o._touches.currID=null}return Q("Mouse"+("button"in n?n.button+1:1),H,o,n),!1}function V(o,H){var n=H.movementX||H.mozMovementX||0,E=H.movementY||H.mozMovementY||0;if(H.touches&&0===(n|E)){var k=function(o){A(o);for(let H=0;H<o.changedTouches.length;++H)if(o.changedTouches[H].identifier==G){const n=o.changedTouches[H],E=[n.clientX-y,n.clientY-S];return y=n.clientX,S=n.clientY,E}return console.error(`Did not find touch id ${G}`),[0,0]}(H);n=k[0],E=k[1]}o.NS.dx+=n,o.NS.dy+=E}function J(o,H){var n=1;switch(H.deltaMode){case 0:n=1;break;case 1:n=12;break;case 2:n=o.element.clientHeight||window.innerHeight}o.NS.Jl+=(H.deltaX||0)*n,o.NS.JS+=(H.deltaY||0)*n,o.NS.Nl+=(H.deltaZ||0)*n}function N(o,H){if(!o.MA)return H.preventDefault(),!1}function h(o){for(var H in o._keyStates)o._keyStates[H]&&(/^Mouse\d/.test(H)||Q(H,!1,o,{code:H,note:"fo6ls7u5k5",preventDefault:()=>{},stopPropagation:()=>{}}))}function Q(o,H,n,E){var k=n._keyBindmap[o];k&&(p(n._keyStates[o],H)&&(n._keyStates[o]=H,k.forEach((o=>{(!n.filterEvents||n.filterEvents(E,o))&&function(o,H,n,E){var k=H?n.pressCount:n.releaseCount;k[o]=(k[o]||0)+1;var g=n._bindPressCount[o]||0;(g+=H?1:-1)<0&&(g=0);n._bindPressCount[o]=g;var O=n.state[o];if(p(O,g)){n.state[o]=g>0;var Y=H?n.down:n.up;n.disabled||Y.emit(o,E)}}(o,H,n,E)}))),"button"in E||(n.ZA&&!E.defaultPrevented&&E.preventDefault(),n.stopPropagation&&E.stopPropagation()))}function p(o,H){return o?!H:H}},12083:o=>{o.exports=function(o,H,n){return o[0]=H[0]+n[0],o[1]=H[1]+n[1],o[2]=H[2]+n[2],o}},12043:(o,H,n)=>{o.exports=function(o,H){var n=E(o[0],o[1],o[2]),O=E(H[0],H[1],H[2]);k(n,n),k(O,O);var Y=g(n,O);return Y>1?0:Math.acos(Y)};var E=n(12046),k=n(12051),g=n(12060)},12140:o=>{o.exports=function(o,H){return o[0]=Math.ceil(H[0]),o[1]=Math.ceil(H[1]),o[2]=Math.ceil(H[2]),o}},12035:o=>{o.exports=function(o){var H=new Float32Array(3);return H[0]=o[0],H[1]=o[1],H[2]=o[2],H}},12068:o=>{o.exports=function(o,H){return o[0]=H[0],o[1]=H[1],o[2]=H[2],o}},12029:o=>{o.exports=function(){var o=new Float32Array(3);return o[0]=0,o[1]=0,o[2]=0,o}},12224:o=>{o.exports=function(o,H,n){var E=H[0],k=H[1],g=H[2],O=n[0],Y=n[1],y=n[2];return o[0]=k*y-g*Y,o[1]=g*O-E*y,o[2]=E*Y-k*O,o}},12165:(o,H,n)=>{o.exports=n(12162)},12162:o=>{o.exports=function(o,H){var n=H[0]-o[0],E=H[1]-o[1],k=H[2]-o[2];return Math.sqrt(n*n+E*E+k*k)}},12124:(o,H,n)=>{o.exports=n(12120)},12120:o=>{o.exports=function(o,H,n){return o[0]=H[0]/n[0],o[1]=H[1]/n[1],o[2]=H[2]/n[2],o}},12060:o=>{o.exports=function(o,H){return o[0]*H[0]+o[1]*H[1]+o[2]*H[2]}},12026:o=>{o.exports=1e-6},12077:(o,H,n)=>{o.exports=function(o,H){var n=o[0],k=o[1],g=o[2],O=H[0],Y=H[1],y=H[2];return Math.abs(n-O)<=E*Math.max(1,Math.abs(n),Math.abs(O))&&Math.abs(k-Y)<=E*Math.max(1,Math.abs(k),Math.abs(Y))&&Math.abs(g-y)<=E*Math.max(1,Math.abs(g),Math.abs(y))};var E=n(12026)},12080:o=>{o.exports=function(o,H){return o[0]===H[0]&&o[1]===H[1]&&o[2]===H[2]}},12134:o=>{o.exports=function(o,H){return o[0]=Math.floor(H[0]),o[1]=Math.floor(H[1]),o[2]=Math.floor(H[2]),o}},12272:(o,H,n)=>{o.exports=function(o,H,n,k,g,O){var Y,y;H||(H=3);n||(n=0);y=k?Math.min(k*H+n,o.length):o.length;for(Y=n;Y<y;Y+=H)E[0]=o[Y],E[1]=o[Y+1],E[2]=o[Y+2],g(E,E,O),o[Y]=E[0],o[Y+1]=E[1],o[Y+2]=E[2];return o};var E=n(12029)()},12046:o=>{o.exports=function(o,H,n){var E=new Float32Array(3);return E[0]=o,E[1]=H,E[2]=n,E}},12018:(o,H,n)=>{o.exports={EPSILON:n(12026),create:n(12029),clone:n(12035),angle:n(12043),nY:n(12046),j:n(12068),set:n(12071),equals:n(12077),exactEquals:n(12080),add:n(12083),zH:n(12092),sub:n(12101),multiply:n(12109),mul:n(12117),divide:n(12120),div:n(12124),min:n(12129),max:n(12131),floor:n(12134),ceil:n(12140),round:n(12147),scale:n(12152),EY:n(12156),distance:n(12162),k:n(12165),squaredDistance:n(12171),sqrDist:n(12180),length:n(12189),len:n(12194),squaredLength:n(12200),kY:n(12203),negate:n(12209),inverse:n(12217),normalize:n(12051),dot:n(12060),cross:n(12224),LO:n(12233),random:n(12236),transformMat4:n(12240),transformMat3:n(12248),transformQuat:n(12252),gY:n(12258),OY:n(12265),YY:n(12267),forEach:n(12272)}},12217:o=>{o.exports=function(o,H){return o[0]=1/H[0],o[1]=1/H[1],o[2]=1/H[2],o}},12194:(o,H,n)=>{o.exports=n(12189)},12189:o=>{o.exports=function(o){var H=o[0],n=o[1],E=o[2];return Math.sqrt(H*H+n*n+E*E)}},12233:o=>{o.exports=function(o,H,n,E){var k=H[0],g=H[1],O=H[2];return o[0]=k+E*(n[0]-k),o[1]=g+E*(n[1]-g),o[2]=O+E*(n[2]-O),o}},12131:o=>{o.exports=function(o,H,n){return o[0]=Math.max(H[0],n[0]),o[1]=Math.max(H[1],n[1]),o[2]=Math.max(H[2],n[2]),o}},12129:o=>{o.exports=function(o,H,n){return o[0]=Math.min(H[0],n[0]),o[1]=Math.min(H[1],n[1]),o[2]=Math.min(H[2],n[2]),o}},12117:(o,H,n)=>{o.exports=n(12109)},12109:o=>{o.exports=function(o,H,n){return o[0]=H[0]*n[0],o[1]=H[1]*n[1],o[2]=H[2]*n[2],o}},12209:o=>{o.exports=function(o,H){return o[0]=-H[0],o[1]=-H[1],o[2]=-H[2],o}},12051:o=>{o.exports=function(o,H){var n=H[0],E=H[1],k=H[2],g=n*n+E*E+k*k;g>0&&(g=1/Math.sqrt(g),o[0]=H[0]*g,o[1]=H[1]*g,o[2]=H[2]*g);return o}},12236:o=>{o.exports=function(o,H){H=H||1;var n=2*Math.random()*Math.PI,E=2*Math.random()-1,k=Math.sqrt(1-E*E)*H;return o[0]=Math.cos(n)*k,o[1]=Math.sin(n)*k,o[2]=E*H,o}},12258:o=>{o.exports=function(o,H,n,E){var k=n[1],g=n[2],O=H[1]-k,Y=H[2]-g,y=Math.sin(E),S=Math.cos(E);return o[0]=H[0],o[1]=k+O*S-Y*y,o[2]=g+O*y+Y*S,o}},12265:o=>{o.exports=function(o,H,n,E){var k=n[0],g=n[2],O=H[0]-k,Y=H[2]-g,y=Math.sin(E),S=Math.cos(E);return o[0]=k+Y*y+O*S,o[1]=H[1],o[2]=g+Y*S-O*y,o}},12267:o=>{o.exports=function(o,H,n,E){var k=n[0],g=n[1],O=H[0]-k,Y=H[1]-g,y=Math.sin(E),S=Math.cos(E);return o[0]=k+O*S-Y*y,o[1]=g+O*y+Y*S,o[2]=H[2],o}},12147:o=>{o.exports=function(o,H){return o[0]=Math.round(H[0]),o[1]=Math.round(H[1]),o[2]=Math.round(H[2]),o}},12152:o=>{o.exports=function(o,H,n){return o[0]=H[0]*n,o[1]=H[1]*n,o[2]=H[2]*n,o}},12156:o=>{o.exports=function(o,H,n,E){return o[0]=H[0]+n[0]*E,o[1]=H[1]+n[1]*E,o[2]=H[2]+n[2]*E,o}},12071:o=>{o.exports=function(o,H,n,E){return o[0]=H,o[1]=n,o[2]=E,o}},12180:(o,H,n)=>{o.exports=n(12171)},12203:(o,H,n)=>{o.exports=n(12200)},12171:o=>{o.exports=function(o,H){var n=H[0]-o[0],E=H[1]-o[1],k=H[2]-o[2];return n*n+E*E+k*k}},12200:o=>{o.exports=function(o){var H=o[0],n=o[1],E=o[2];return H*H+n*n+E*E}},12101:(o,H,n)=>{o.exports=n(12092)},12092:o=>{o.exports=function(o,H,n){return o[0]=H[0]-n[0],o[1]=H[1]-n[1],o[2]=H[2]-n[2],o}},12248:o=>{o.exports=function(o,H,n){var E=H[0],k=H[1],g=H[2];return o[0]=E*n[0]+k*n[3]+g*n[6],o[1]=E*n[1]+k*n[4]+g*n[7],o[2]=E*n[2]+k*n[5]+g*n[8],o}},12240:o=>{o.exports=function(o,H,n){var E=H[0],k=H[1],g=H[2],O=n[3]*E+n[7]*k+n[11]*g+n[15];return O=O||1,o[0]=(n[0]*E+n[4]*k+n[8]*g+n[12])/O,o[1]=(n[1]*E+n[5]*k+n[9]*g+n[13])/O,o[2]=(n[2]*E+n[6]*k+n[10]*g+n[14])/O,o}},12252:o=>{o.exports=function(o,H,n){var E=H[0],k=H[1],g=H[2],O=n[0],Y=n[1],y=n[2],S=n[3],G=S*E+Y*g-y*k,c=S*k+y*E-O*g,A=S*g+O*k-Y*E,l=-O*E-Y*k-y*g;return o[0]=G*S+l*-O+c*-y-A*-Y,o[1]=c*S+l*-Y+A*-O-G*-y,o[2]=A*S+l*-y+G*-Y-c*-O,o}},13169:o=>{"use strict";o.exports=function(o){for(var H=new Array(o),n=0;n<o;++n)H[n]=n;return H}},13242:o=>{o.exports=function(o){return null!=o&&null!=o.constructor&&"function"===typeof o.constructor.isBuffer&&o.constructor.isBuffer(o)}},13453:(o,H,n)=>{"use strict";n.d(H,{b:()=>E});class E{constructor(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.mG=!1,this.PG=!1,this.pG=30,this.jG=0,this.qG=!1,this.fullscreen=!1,this.eG=function(o){},this.ZG=function(){},this.fG=function(){},this.en=function(){},this.MG=function(o){},this.onFullscreenChanged=function(o){},S((()=>{!function(o,H){o._nowObject=performance||Date,o._lastTick=0,o._renderAccum=0,o._rt=0,o._frameCB=Y.bind(null,o),requestAnimationFrame(o._frameCB),H>0&&(o._intervalCB=O.bind(null,o),o._interval=setInterval(o._intervalCB,Math.max(H,1e3/o.pG/2)))}(this,H),function(o,H){if(!H)return;var n=!1,E=!1;document.addEventListener("pointerlockchange",(E=>{n=document.pointerLockElement===H,o.MG(n)})),document.addEventListener("fullscreenchange",(n=>{E=document.fullscreenElement===H,o.onFullscreenChanged(E)})),Object.defineProperty(o,"qG",{get:()=>n,set:o=>{o&&!n?y(H):n&&!o&&function(o){o.exitPointerLock&&o.exitPointerLock()}(document)}}),Object.defineProperty(o,"fullscreen",{get:()=>E,set:o=>{o&&!E?H.requestFullscreen():E&&!o&&document.exitFullscreen()}}),H.addEventListener("click",(k=>{o.mG&&!n&&y(H),o.PG&&!E&&H.requestFullscreen()}));var k=()=>o.en();if(window.ResizeObserver){new ResizeObserver(k).observe(H)}else window.addEventListener("resize",k)}(this,o),this.fG()}))}}var k=3,g=20;function O(o){for(var H=1e3/o.pG,n=o._nowObject.now()+g,E=0;o._nowObject.now()>=o._lastTick+H&&o._nowObject.now()<n&&++E<=k;)o.eG(H),o._lastTick+=H;var O=5*(H+5),Y=o._nowObject.now();if(Y-o._lastTick>O)for(;Y>=o._lastTick+H;)o._lastTick+=H}function Y(o){requestAnimationFrame(o._frameCB),O(o);var H=o._nowObject.now(),n=H-o._rt;if(o._rt=H,o.jG>0){o._renderAccum+=n;var E=1e3/o.jG;if(o._renderAccum<E)return;o._renderAccum=Math.min(o._renderAccum-E,E)}var k=1e3/o.pG,g=(H-o._lastTick)/k;o.ZG(n,g,k)}function y(o){o.requestPointerLock&&o.requestPointerLock()}var S=o=>{if("loading"===document.readyState){var H=()=>{document.removeEventListener("readystatechange",H),o()};document.addEventListener("readystatechange",H)}else setTimeout(o,1)}},13161:(o,H,n)=>{var E=n(13169),k=n(13175),g="undefined"!==typeof Float64Array;function O(o,H){return o[0]-H[0]}function Y(){var o,H=this.stride,n=new Array(H.length);for(o=0;o<n.length;++o)n[o]=[Math.abs(H[o]),o];n.sort(O);var E=new Array(n.length);for(o=0;o<E.length;++o)E[o]=n[o][1];return E}function y(o,H){var n=["View",H,"d",o].join("");H<0&&(n="View_Nil"+o);var k="generic"===o;if(-1===H){var g="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+o+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(g)()}if(0===H){g="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+o+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(k?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(k?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",g)(S[o][0])}g=["'use strict'"];var O=E(H),y=O.map((function(o){return"i"+o})),G="this.offset+"+O.map((function(o){return"this.stride["+o+"]*i"+o})).join("+"),c=O.map((function(o){return"b"+o})).join(","),A=O.map((function(o){return"c"+o})).join(",");g.push("function "+n+"(a,"+c+","+A+",d){this.data=a","this.shape=["+c+"]","this.stride=["+A+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+o+"'","proto.dimension="+H),g.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+O.map((function(o){return"this.shape["+o+"]"})).join("*"),"}})"),1===H?g.push("proto.order=[0]"):(g.push("Object.defineProperty(proto,'order',{get:"),H<4?(g.push("function "+n+"_order(){"),2===H?g.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===H&&g.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):g.push("ORDER})")),g.push("proto.set=function "+n+"_set("+y.join(",")+",v){"),k?g.push("return this.data.set("+G+",v)}"):g.push("return this.data["+G+"]=v}"),g.push("proto.get=function "+n+"_get("+y.join(",")+"){"),k?g.push("return this.data.get("+G+")}"):g.push("return this.data["+G+"]}"),g.push("proto.index=function "+n+"_index(",y.join(),"){return "+G+"}"),g.push("proto.hi=function "+n+"_hi("+y.join(",")+"){return new "+n+"(this.data,"+O.map((function(o){return["(typeof i",o,"!=='number'||i",o,"<0)?this.shape[",o,"]:i",o,"|0"].join("")})).join(",")+","+O.map((function(o){return"this.stride["+o+"]"})).join(",")+",this.offset)}");var l=O.map((function(o){return"a"+o+"=this.shape["+o+"]"})),x=O.map((function(o){return"c"+o+"=this.stride["+o+"]"}));g.push("proto.lo=function "+n+"_lo("+y.join(",")+"){var b=this.offset,d=0,"+l.join(",")+","+x.join(","));for(var z=0;z<H;++z)g.push("if(typeof i"+z+"==='number'&&i"+z+">=0){d=i"+z+"|0;b+=c"+z+"*d;a"+z+"-=d}");g.push("return new "+n+"(this.data,"+O.map((function(o){return"a"+o})).join(",")+","+O.map((function(o){return"c"+o})).join(",")+",b)}"),g.push("proto.step=function "+n+"_step("+y.join(",")+"){var "+O.map((function(o){return"a"+o+"=this.shape["+o+"]"})).join(",")+","+O.map((function(o){return"b"+o+"=this.stride["+o+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(z=0;z<H;++z)g.push("if(typeof i"+z+"==='number'){d=i"+z+"|0;if(d<0){c+=b"+z+"*(a"+z+"-1);a"+z+"=ceil(-a"+z+"/d)}else{a"+z+"=ceil(a"+z+"/d)}b"+z+"*=d}");g.push("return new "+n+"(this.data,"+O.map((function(o){return"a"+o})).join(",")+","+O.map((function(o){return"b"+o})).join(",")+",c)}");var V=new Array(H),J=new Array(H);for(z=0;z<H;++z)V[z]="a[i"+z+"]",J[z]="b[i"+z+"]";g.push("proto.transpose=function "+n+"_transpose("+y+"){"+y.map((function(o,H){return o+"=("+o+"===undefined?"+H+":"+o+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+V.join(",")+","+J.join(",")+",this.offset)}"),g.push("proto.pick=function "+n+"_pick("+y+"){var a=[],b=[],c=this.offset");for(z=0;z<H;++z)g.push("if(typeof i"+z+"==='number'&&i"+z+">=0){c=(c+this.stride["+z+"]*i"+z+")|0}else{a.push(this.shape["+z+"]);b.push(this.stride["+z+"])}");return g.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),g.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+O.map((function(o){return"shape["+o+"]"})).join(",")+","+O.map((function(o){return"stride["+o+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",g.join("\n"))(S[o],Y)}var S={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};o.exports=function(o,H,n,E){if(void 0===o)return(0,S.array[0])([]);"number"===typeof o&&(o=[o]),void 0===H&&(H=[o.length]);var O=H.length;if(void 0===n){n=new Array(O);for(var Y=O-1,G=1;Y>=0;--Y)n[Y]=G,G*=H[Y]}if(void 0===E){E=0;for(Y=0;Y<O;++Y)n[Y]<0&&(E-=(H[Y]-1)*n[Y])}for(var c=function(o){if(k(o))return"buffer";if(g)switch(Object.prototype.toString.call(o)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(o)?"array":"generic"}(o),A=S[c];A.length<=O+1;)A.push(y(c,A.length-1));return(0,A[O+1])(o,H,n,E)}},13175:o=>{function H(o){return!!o.constructor&&"function"===typeof o.constructor.isBuffer&&o.constructor.isBuffer(o)}o.exports=function(o){return null!=o&&(H(o)||function(o){return"function"===typeof o.readFloatLE&&"function"===typeof o.slice&&H(o.slice(0,0))}(o)||!!o._isBuffer)}},13338:o=>{"use strict";var H=[],n=[],E=[],k=[],g=[],O=[],Y=[],y=[],S=[],G=[],c=[],A=[];o.exports=function(o,l,x,z,V,J){for(var N=Y,h=S,Q=G,p=A,j=0;j<3;j++)N[j]=+x[j],Q[j]=+l.max[j],h[j]=+l.base[j];J||(J=1e-10);var m=function(o,Y,S,G,A,l){var x=H,z=n,V=E,J=k,N=g,h=O,Q=y,p=Math.floor,j=0,m=0,P=0,b=0,e=0;if(Z(),0===P)return 0;for(b=f();m<=P;){if(M(b)&&K())return j;b=f()}for(j+=P,e=0;e<3;e++)G[e]+=S[e],A[e]+=S[e];return j;function Z(){if(m=0,0!==(P=Math.sqrt(S[0]*S[0]+S[1]*S[1]+S[2]*S[2])))for(var o=0;o<3;o++){var H=S[o]>=0;J[o]=H?1:-1;var n=H?A[o]:G[o];x[o]=H?G[o]:A[o],z[o]=B(n,J[o]),V[o]=q(x[o],J[o]),Q[o]=S[o]/P,N[o]=Math.abs(1/Q[o]);var E=H?z[o]+1-n:n-z[o];h[o]=N[o]<1/0?N[o]*E:1/0}}function M(H){for(var n=J[0],E=0===H?z[0]:V[0],k=z[0]+n,g=J[1],O=1===H?z[1]:V[1],Y=z[1]+g,y=J[2],S=2===H?z[2]:V[2],G=z[2]+y,c=E;c!=k;c+=n)for(var A=O;A!=Y;A+=g)for(var l=S;l!=G;l+=y)if(o(c,A,l))return!0;return!1}function K(){j+=m;var o=J[b],H=m/P,n=c;for(e=0;e<3;e++){var E=S[e]*H;G[e]+=E,A[e]+=E,n[e]=S[e]-E}if(o>0?A[b]=Math.round(A[b]):G[b]=Math.round(G[b]),Y(j,b,o,n))return!0;for(e=0;e<3;e++)S[e]=n[e];return Z(),0===P}function f(){var o=h[0]<h[1]?h[0]<h[2]?0:2:h[1]<h[2]?1:2,H=h[o]-m;for(m=h[o],z[o]+=J[o],h[o]+=N[o],e=0;e<3;e++)x[e]+=H*Q[e],V[e]=q(x[e],J[e]);return o}function B(o,H){return p(o-H*l)}function q(o,H){return p(o+H*l)}}(o,z,N,h,Q,J);if(!V){for(j=0;j<3;j++)p[j]=x[j]>0?Q[j]-l.max[j]:h[j]-l.base[j];l.translate(p)}return m}},13487:(o,H,n)=>{"use strict";n.d(H,{d:()=>c});var E=n(13329),k=n(12018);class g{constructor(o,H,n,g,O,Y,y){this.mS=new E(o.base,o.CS),this.HE=H,this.friction=n,this.restitution=g,this.wO=O,this.Cl=Y,this.rO=!!y,this.FS=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Kx=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.HS=k.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=k.create(),this._impulses=k.create(),this._sleepFrameCount=10}loadFromCopy(o){k.j(this.mS.base,o.mS.base),k.j(this.mS.CS,o.mS.CS),k.j(this.mS.max,o.mS.max),this.mS.mag=o.mS.mag,this.HE=o.HE,this.friction=o.friction,this.restitution=o.restitution,this.wO=o.wO,this.Cl=o.Cl,this.rO=o.rO,this.FS=o.FS,this.fluidDrag=o.fluidDrag,this.Kx=o.Kx,this.preventFallOffEdge=o.preventFallOffEdge,this.rolledBackLastTick=o.rolledBackLastTick,k.j(this.HS,o.HS),k.j(this.resting,o.resting),this.inFluid=o.inFluid,this._ratioInFluid=o._ratioInFluid,k.j(this._forces,o._forces),k.j(this._impulses,o._impulses),this._sleepFrameCount=o._sleepFrameCount}setPosition(o){O(o),k.zH(o,o,this.mS.base),this.mS.translate(o),this.kS()}og(){return k.clone(this.mS.base)}applyForce(o){O(o),k.add(this._forces,this._forces,o),this.kS()}applyImpulse(o){O(o),k.add(this._impulses,this._impulses,o),this.kS()}kS(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var O=o=>{};var Y=n(13329),y=n(12018),S=n(13338);function G(){this.FS=.1,this.fluidDrag=.4,this.iO=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function c(o,H,n){o=Object.assign(new G,o),this.gravity=o.gravity||[0,-10,0],this.FS=o.FS||.1,this.iO=o.iO||2,this.fluidDrag=o.fluidDrag||.4,this.minBounceImpulse=o.minBounceImpulse,this.bodies=[],this.Yl=o.Yl,this.testSolid=H,this.testFluid=n}c.prototype.wl=function(o,H,n,E,k,O){o=o||new Y([0,0,0],[1,1,1]),"undefined"==typeof H&&(H=1),"undefined"==typeof n&&(n=1),"undefined"==typeof E&&(E=0),"undefined"==typeof k&&(k=1);var y=new g(o,H,n,E,k,O);return this.bodies.push(y),y},c.prototype.ul=function(o){var H=this.bodies.indexOf(o);H<0||(this.bodies.splice(H,1),o.mS=o.Cl=null)};var A=y.create(),l=y.create(),x=y.create(),z=y.create(),V=y.create(),J=y.create(),N=y.create(),h=new Y([0,0,0],[1,1,1]),Q=new g(h,1,1,0,1,(()=>{}),!1);function p(o,H,n){return H=n,H*=1-(1-o.ratioInFluid)**2}c.prototype.GY=function(o){o/=1e3;var H=C(0,y.squaredLength(this.gravity));this.bodies.forEach((n=>function(o,H,n,E){y.j(V,H.resting),o.Yl&&Q.loadFromCopy(H);if(H.HE<=0)return y.set(H.HS,0,0,0),y.set(H._forces,0,0,0),void y.set(H._impulses,0,0,0);var k=E||0===H.wO;if(function(o,H,n,E){if(H._sleepFrameCount>0)return!1;if(E)return!0;var k=!1,g=.5*n*n*H.wO;return y.scale(F,o.gravity,g),S(o.testSolid,H.mS,F,(function(){return k=!0,!0}),!0),k}(o,H,n,k))return;H._sleepFrameCount--,function(o,H){var n=H.mS,E=Math.floor(n.base[0]),k=Math.floor(n.base[2]),g=Math.floor(n.base[1]),O=Math.floor(n.max[1]);if(!o.testFluid(E,g,k))return H.inFluid=!1,void(H.ratioInFluid=0);var Y=1,S=g+1;for(;S<=O&&o.testFluid(E,S,k);)Y++,S++;var G=(g+Y-n.base[1])/n.CS[1];G>1&&(G=1);var c=n.CS[0]*n.CS[1]*n.CS[2]*G,A=m;y.scale(A,o.gravity,-o.iO*c*H.wO),H.applyForce(A),H.inFluid=!0,H.ratioInFluid=G}(o,H),X(H._forces),X(H._impulses),X(H.HS),X(H.resting),y.scale(A,H._forces,1/H.HE),y.EY(A,A,o.gravity,H.wO),y.scale(l,H._impulses,1/H.HE),y.EY(l,l,A,n),y.add(H.HS,H.HS,l),H.friction&&(P(o,0,H,l,n),P(o,1,H,l,n),P(o,2,H,l,n));var g=H.fluidDrag>=0?H.fluidDrag:o.fluidDrag,O=H.FS>=0?H.FS:o.FS,Y=O,G=O;H.inFluid&&(Y=p(H,Y,H.fluidDragHoriz>=0?H.fluidDragHoriz:g),G=p(H,G,H.fluidDragVert>=0?H.fluidDragVert:g));Y=Math.max(1-Y*n/H.HE,0),G=Math.max(1-G*n/H.HE,0),y.set(j,Y,G,Y),y.multiply(H.HS,H.HS,j),y.scale(x,H.HS,n),y.set(H._forces,0,0,0),y.set(H._impulses,0,0,0),H.rO&&t(Z,H.mS);y.j(J,x),y.set(N,0,0,0),H.preventFallOffEdge&&function(o,H,n,E){if(!H.resting[1]||n[1]>0)return;var k=D;t(k,H.mS);for(var g=0;g<3;g+=2){y.set(q,0,0,0),q[g]=n[g];var O=!0;(O=(O=(O=(O=O&&!a(o,k.base[0]+q[0]+1e-5,k.base[1],k.base[2]+q[2]+1e-5))&&!a(o,k.max[0]+q[0]-1e-5,k.base[1],k.base[2]+q[2]+1e-5))&&!a(o,k.base[0]+q[0]+1e-5,k.base[1],k.max[2]+q[2]-1e-5))&&!a(o,k.max[0]+q[0]-1e-5,k.base[1],k.max[2]+q[2]-1e-5))?(E[g]=n[g]>0?1:-1,n[g]=0):0===g&&(y.set(T,n[0],0,0),e(o,k,T,E,H.slideOnCollision))}}(o,H,x,N);e(o,H.mS,x,H.resting,H.slideOnCollision),H.rO&&function(o,H,n,E){if(H.resting[1]>=0&&!H.inFluid)return;var k=0!==H.resting[0],g=0!==H.resting[2];if(!k&&!g)return;var O=Math.abs(E[0]/E[2]),Y=4;if(!k&&O>Y)return;if(!g&&O<1/Y)return;y.add(K,n.base,E);var G=o.testSolid;S(G,n,E,(function(o,H,n,E){if(1!==H)return!0;E[H]=0}));var c=n.base[1],A=H.inFluid?1.951:1.001,l=Math.floor(c+A)-c;y.set(f,0,l,0);var x=!1;if(S(G,n,f,(function(o,H,n,E){return x=!0,!0})),x)return;y.zH(B,K,n.base),B[1]=0,e(o,n,B,M,!0);var z=C(n.base[0],K[0]),V=C(n.base[2],K[2]);if(k&&!z&&(!V||!g))return;if(g&&(!z||!k)&&!V)return;var J=!0;if(J=J&&!a(o,n.base[0]+1e-5,n.base[1],n.base[2]+1e-5),J=J&&!a(o,n.max[0]-1e-5,n.base[1],n.base[2]+1e-5),J=J&&!a(o,n.base[0]+1e-5,n.base[1],n.max[2]-1e-5),J=J&&!a(o,n.max[0]-1e-5,n.base[1],n.max[2]-1e-5),J)return;t(H.mS,n),H.resting[0]=M[0],H.resting[2]=M[2],H.Kx&&H.Kx()}(o,H,Z,J);for(var c=0;c<3;++c)H.resting[c]=H.resting[c]||N[c],z[c]=0,H.resting[c]&&(V[c]||(z[c]=-H.HS[c]),H.HS[c]=0);var h=y.length(z);h>.001&&(y.scale(z,z,H.HE),H.Cl&&H.Cl(z),H.restitution>0&&h>o.minBounceImpulse&&(y.scale(z,z,H.restitution),H.applyImpulse(z)));var b=y.squaredLength(H.HS);b>1e-5&&H.kS();o.Yl&&o.Yl(H)?(H.loadFromCopy(Q),H.rolledBackLastTick=!0):H.rolledBackLastTick=!1}(this,n,o,H)))};var j=y.create([0,0,0]);var m=y.create();function P(o,H,n,E,k){var g=n.resting[H],O=E[H];if(!n.alwaysApplyHorizFriction||1!==H){if(0===g)return;if(g*O<=0)return}y.j(b,n.HS),b[H]=0;var Y=y.length(b);if(!C(Y,0)){var S=Math.abs(n.friction*o.gravity[H]*k),G=Y>S?(Y-S)/Y:0;n.HS[(H+1)%3]*=G,n.HS[(H+2)%3]*=G}}var b=y.create();function e(o,H,n,E,k){return y.set(E,0,0,0),S(o.testSolid,H,n,(function(o,H,n,g){E[H]=n,g[H]=0,k||(g[0]=0,g[1]=0,g[2]=0)}))}var Z=new Y([],[]),M=y.create(),K=y.create(),f=y.create(),B=y.create();var q=y.create(),D=new Y([],[]),T=y.create();function a(o,H,n,E){return o.testSolid(Math.floor(H),Math.floor(n-1),Math.floor(E))}var F=y.create();function C(o,H){return Math.abs(o-H)<1e-5}function t(o,H){for(var n=0;n<3;n++)o.base[n]=H.base[n],o.max[n]=H.max[n],o.CS[n]=H.CS[n]}var X=function(o){}},11890:function(o,H){!function(o){"use strict";var H=function(o,n){return H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,H){o.__proto__=H}||function(o,H){for(var n in H)Object.prototype.hasOwnProperty.call(H,n)&&(o[n]=H[n])},H(o,n)};function n(o,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function E(){this.constructor=o}H(o,n),o.prototype=null===n?Object.create(n):(E.prototype=n.prototype,new E)}function E(o,H,n,E){var k,g=arguments.length,O=g<3?H:null===E?E=Object.getOwnPropertyDescriptor(H,n):E;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)O=Reflect.decorate(o,H,n,E);else for(var Y=o.length-1;Y>=0;Y--)(k=o[Y])&&(O=(g<3?k(O):g>3?k(H,n,O):k(H,n))||O);return g>3&&O&&Object.defineProperty(H,n,O),O}function k(o,H,n){if(n||2===arguments.length)for(var E,k=0,g=H.length;k<g;k++)!E&&k in H||(E||(E=Array.prototype.slice.call(H,0,k)),E[k]=H[k]);return o.concat(E||Array.prototype.slice.call(H))}var g,O=255,Y=213;o.OPERATION=void 0,(g=o.OPERATION||(o.OPERATION={}))[g.ADD=128]="ADD",g[g.REPLACE=0]="REPLACE",g[g.DELETE=64]="DELETE",g[g.DELETE_AND_ADD=192]="DELETE_AND_ADD",g[g.TOUCH=1]="TOUCH",g[g.CLEAR=10]="CLEAR";var y=function(){function H(o,H,n){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=o,this.setParent(H,n)}return H.prototype.setParent=function(o,H,n){var E=this;if(this.indexes||(this.indexes=this.ref instanceof Bo?this.ref._definition.indexes:{}),this.parent=o,this.parentIndex=n,H)if(this.root=H,this.ref instanceof Bo){var k=this.ref._definition;for(var g in k.schema){var O=this.ref[g];if(O&&O.$changes){var Y=k.indexes[g];O.$changes.setParent(this.ref,H,Y)}}}else"object"===typeof this.ref&&this.ref.forEach((function(o,H){if(o instanceof Bo){var n=o.$changes,k=E.ref.$changes.indexes[H];n.setParent(E.ref,E.root,k)}}))},H.prototype.operation=function(o){this.changes.set(--this.currentCustomOperation,o)},H.prototype.change=function(H,n){void 0===n&&(n=o.OPERATION.ADD);var E="number"===typeof H?H:this.indexes[H];this.assertValidIndex(E,H);var k=this.changes.get(E);k&&k.op!==o.OPERATION.DELETE&&k.op!==o.OPERATION.TOUCH||this.changes.set(E,{op:k&&k.op===o.OPERATION.DELETE?o.OPERATION.DELETE_AND_ADD:n,index:E}),this.allChanges.add(E),this.changed=!0,this.touchParents()},H.prototype.touch=function(H){var n="number"===typeof H?H:this.indexes[H];this.assertValidIndex(n,H),this.changes.has(n)||this.changes.set(n,{op:o.OPERATION.TOUCH,index:n}),this.allChanges.add(n),this.touchParents()},H.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},H.prototype.getType=function(o){if(this.ref._definition)return(H=this.ref._definition).schema[H.fieldsByIndex[o]];var H,n=(H=this.parent._definition).schema[H.fieldsByIndex[this.parentIndex]];return Object.values(n)[0]},H.prototype.getChildrenFilter=function(){var o=this.parent._definition.childFilters;return o&&o[this.parentIndex]},H.prototype.getValue=function(o){return this.ref.getByIndex(o)},H.prototype.delete=function(H){var n="number"===typeof H?H:this.indexes[H];if(void 0!==n){var E=this.getValue(n);this.changes.set(n,{op:o.OPERATION.DELETE,index:n}),this.allChanges.delete(n),delete this.caches[n],E&&E.$changes&&(E.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(H," (").concat(n,")"))},H.prototype.discard=function(H,n){var E=this;void 0===H&&(H=!1),void 0===n&&(n=!1),this.ref instanceof Bo||this.changes.forEach((function(H){if(H.op===o.OPERATION.DELETE){var n=E.ref.getIndex(H.index);delete E.indexes[n]}})),this.changes.clear(),this.changed=H,n&&this.allChanges.clear(),this.currentCustomOperation=0},H.prototype.discardAll=function(){var o=this;this.changes.forEach((function(H){var n=o.getValue(H.index);n&&n.$changes&&n.$changes.discardAll()})),this.discard()},H.prototype.cache=function(o,H){this.caches[o]=H},H.prototype.clone=function(){return new H(this.ref,this.parent,this.root)},H.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},H.prototype.assertValidIndex=function(o,H){if(void 0===o)throw new Error('ChangeTree: missing index for field "'.concat(H,'"'))},H}();function S(o,H,n,E){return o[H]||(o[H]=[]),o[H].push(n),null===E||void 0===E||E.forEach((function(o,H){return n(o,H)})),function(){return c(o[H],o[H].indexOf(n))}}function G(H){var n=this,E="string"!==typeof this.$changes.getType();this.$items.forEach((function(k,g){H.push({refId:n.$changes.refId,op:o.OPERATION.DELETE,field:g,value:void 0,previousValue:k}),E&&n.$changes.root.removeRef(k.$changes.refId)}))}function c(o,H){if(-1===H||H>=o.length)return!1;for(var n=o.length-1,E=H;E<n;E++)o[E]=o[E+1];return o.length=n,!0}var A=function(o,H){var n=o.toString(),E=H.toString();return n<E?-1:n>E?1:0};function l(o){return o.$proxy=!0,o=new Proxy(o,{get:function(o,H){return"symbol"===typeof H||isNaN(H)?o[H]:o.at(H)},set:function(o,H,n){if("symbol"===typeof H||isNaN(H))o[H]=n;else{var E=Array.from(o.$items.keys()),k=parseInt(E[H]||H);void 0===n||null===n?o.deleteAt(k):o.setAt(k,n)}return!0},deleteProperty:function(o,H){return"number"===typeof H?o.deleteAt(H):delete o[H],!0}})}var x=function(){function H(){for(var o=[],H=0;H<arguments.length;H++)o[H]=arguments[H];this.$changes=new y(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,o)}return H.prototype.PY=function(H,n){return void 0===n&&(n=!0),S(this.$callbacks||(this.$callbacks=[]),o.OPERATION.ADD,H,n?this.$items:void 0)},H.prototype.ln=function(H){return S(this.$callbacks||(this.$callbacks=[]),o.OPERATION.DELETE,H)},H.prototype.onChange=function(H){return S(this.$callbacks||(this.$callbacks=[]),o.OPERATION.REPLACE,H)},H.is=function(o){return Array.isArray(o)||void 0!==o.array},Object.defineProperty(H.prototype,"length",{get:function(){return this.$items.size},set:function(o){0===o?this.clear():this.splice(o,this.length-o)},enumerable:!1,configurable:!0}),H.prototype.push=function(){for(var o,H=this,n=[],E=0;E<arguments.length;E++)n[E]=arguments[E];return n.forEach((function(n){o=H.$refId++,H.setAt(o,n)})),o},H.prototype.pop=function(){var o=Array.from(this.$indexes.values()).pop();if(void 0!==o){this.$changes.delete(o),this.$indexes.delete(o);var H=this.$items.get(o);return this.$items.delete(o),H}},H.prototype.at=function(o){var H=Array.from(this.$items.keys())[o];return this.$items.get(H)},H.prototype.setAt=function(H,n){var E,k;if(void 0!==n&&null!==n){if(this.$items.get(H)!==n){void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,H);var g=null!==(k=null===(E=this.$changes.indexes[H])||void 0===E?void 0:E.op)&&void 0!==k?k:o.OPERATION.ADD;this.$changes.indexes[H]=H,this.$indexes.set(H,H),this.$items.set(H,n),this.$changes.change(H,g)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},H.prototype.deleteAt=function(o){var H=Array.from(this.$items.keys())[o];return void 0!==H&&this.$deleteAt(H)},H.prototype.$deleteAt=function(o){return this.$changes.delete(o),this.$indexes.delete(o),this.$items.delete(o)},H.prototype.clear=function(H){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),H&&G.call(this,H),this.$items.clear(),this.$changes.operation({index:0,op:o.OPERATION.CLEAR}),this.$changes.touchParents()},H.prototype.concat=function(){for(var o,n=[],E=0;E<arguments.length;E++)n[E]=arguments[E];return new(H.bind.apply(H,k([void 0],(o=Array.from(this.$items.values())).concat.apply(o,n),!1)))},H.prototype.join=function(o){return Array.from(this.$items.values()).join(o)},H.prototype.reverse=function(){var o=this,H=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(n,E){o.setAt(H[E],n)})),this},H.prototype.shift=function(){var o=Array.from(this.$items.keys()).shift();if(void 0!==o){var H=this.$items.get(o);return this.$deleteAt(o),H}},H.prototype.slice=function(o,n){var E=new H;return E.push.apply(E,Array.from(this.$items.values()).slice(o,n)),E},H.prototype.sort=function(o){var H=this;void 0===o&&(o=A);var n=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(o).forEach((function(o,E){H.setAt(n[E],o)})),this},H.prototype.splice=function(o,H){void 0===H&&(H=this.length-o);for(var n=Array.from(this.$items.keys()),E=[],k=o;k<o+H;k++)E.push(this.$items.get(n[k])),this.$deleteAt(n[k]);return E},H.prototype.unshift=function(){for(var o=this,H=[],n=0;n<arguments.length;n++)H[n]=arguments[n];var E=this.length,k=H.length,g=Array.from(this.$items.values());return H.forEach((function(H,n){o.setAt(n,H)})),g.forEach((function(H,n){o.setAt(k+n,H)})),E+k},H.prototype.indexOf=function(o,H){return Array.from(this.$items.values()).indexOf(o,H)},H.prototype.lastIndexOf=function(o,H){return void 0===H&&(H=this.length-1),Array.from(this.$items.values()).lastIndexOf(o,H)},H.prototype.every=function(o,H){return Array.from(this.$items.values()).every(o,H)},H.prototype.some=function(o,H){return Array.from(this.$items.values()).some(o,H)},H.prototype.forEach=function(o,H){Array.from(this.$items.values()).forEach(o,H)},H.prototype.map=function(o,H){return Array.from(this.$items.values()).map(o,H)},H.prototype.filter=function(o,H){return Array.from(this.$items.values()).filter(o,H)},H.prototype.reduce=function(o,H){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},H.prototype.reduceRight=function(o,H){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},H.prototype.find=function(o,H){return Array.from(this.$items.values()).find(o,H)},H.prototype.findIndex=function(o,H){return Array.from(this.$items.values()).findIndex(o,H)},H.prototype.fill=function(o,H,n){throw new Error("ArraySchema#fill() not implemented")},H.prototype.copyWithin=function(o,H,n){throw new Error("ArraySchema#copyWithin() not implemented")},H.prototype.toString=function(){return this.$items.toString()},H.prototype.toLocaleString=function(){return this.$items.toLocaleString()},H.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(H,Symbol.species,{get:function(){return H},enumerable:!1,configurable:!0}),H.prototype.entries=function(){return this.$items.entries()},H.prototype.keys=function(){return this.$items.keys()},H.prototype.values=function(){return this.$items.values()},H.prototype.includes=function(o,H){return Array.from(this.$items.values()).includes(o,H)},H.prototype.flatMap=function(o,H){throw new Error("ArraySchema#flatMap() is not supported.")},H.prototype.flat=function(o){throw new Error("ArraySchema#flat() is not supported.")},H.prototype.findLast=function(){var o=Array.from(this.$items.values());return o.findLast.apply(o,arguments)},H.prototype.findLastIndex=function(){var o=Array.from(this.$items.values());return o.findLastIndex.apply(o,arguments)},H.prototype.setIndex=function(o,H){this.$indexes.set(o,H)},H.prototype.getIndex=function(o){return this.$indexes.get(o)},H.prototype.getByIndex=function(o){return this.$items.get(this.$indexes.get(o))},H.prototype.deleteByIndex=function(o){var H=this.$indexes.get(o);this.$items.delete(H),this.$indexes.delete(o)},H.prototype.toArray=function(){return Array.from(this.$items.values())},H.prototype.toJSON=function(){return this.toArray().map((function(o){return"function"===typeof o.toJSON?o.toJSON():o}))},H.prototype.clone=function(o){return o?new(H.bind.apply(H,k([void 0],Array.from(this.$items.values()),!1))):new(H.bind.apply(H,k([void 0],this.map((function(o){return o.$changes?o.clone():o})),!1)))},H}();function z(o){return o.$proxy=!0,o=new Proxy(o,{get:function(o,H){return"symbol"!==typeof H&&"undefined"===typeof o[H]?o.get(H):o[H]},set:function(o,H,n){return"symbol"!==typeof H&&-1===H.indexOf("$")&&"PY"!==H&&"ln"!==H&&"onChange"!==H?o.set(H,n):o[H]=n,!0},deleteProperty:function(o,H){return o.delete(H),!0}})}var V=function(){function H(o){var n=this;if(this.$changes=new y(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,o)if(o instanceof Map||o instanceof H)o.forEach((function(o,H){return n.set(H,o)}));else for(var E in o)this.set(E,o[E])}return H.prototype.PY=function(H,n){return void 0===n&&(n=!0),S(this.$callbacks||(this.$callbacks=[]),o.OPERATION.ADD,H,n?this.$items:void 0)},H.prototype.ln=function(H){return S(this.$callbacks||(this.$callbacks=[]),o.OPERATION.DELETE,H)},H.prototype.onChange=function(H){return S(this.$callbacks||(this.$callbacks=[]),o.OPERATION.REPLACE,H)},H.is=function(o){return void 0!==o.map},H.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(H.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(H,Symbol.species,{get:function(){return H},enumerable:!1,configurable:!0}),H.prototype.set=function(H,n){if(void 0===n||null===n)throw new Error("MapSchema#set('".concat(H,"', ").concat(n,"): trying to set ").concat(n," value on '").concat(H,"'."));H=H.toString();var E="undefined"!==typeof this.$changes.indexes[H],k=E?this.$changes.indexes[H]:this.$refId++,g=E?o.OPERATION.REPLACE:o.OPERATION.ADD,O=void 0!==n.$changes;if(O&&n.$changes.setParent(this,this.$changes.root,k),E){if(!O&&this.$items.get(H)===n)return;O&&this.$items.get(H)!==n&&(g=o.OPERATION.ADD)}else this.$changes.indexes[H]=k,this.$indexes.set(k,H);return this.$items.set(H,n),this.$changes.change(H,g),this},H.prototype.get=function(o){return this.$items.get(o)},H.prototype.delete=function(o){return this.$changes.delete(o),this.$items.delete(o)},H.prototype.clear=function(H){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),H&&G.call(this,H),this.$items.clear(),this.$changes.operation({index:0,op:o.OPERATION.CLEAR}),this.$changes.touchParents()},H.prototype.has=function(o){return this.$items.has(o)},H.prototype.forEach=function(o){this.$items.forEach(o)},H.prototype.entries=function(){return this.$items.entries()},H.prototype.keys=function(){return this.$items.keys()},H.prototype.values=function(){return this.$items.values()},Object.defineProperty(H.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),H.prototype.setIndex=function(o,H){this.$indexes.set(o,H)},H.prototype.getIndex=function(o){return this.$indexes.get(o)},H.prototype.getByIndex=function(o){return this.$items.get(this.$indexes.get(o))},H.prototype.deleteByIndex=function(o){var H=this.$indexes.get(o);this.$items.delete(H),this.$indexes.delete(o)},H.prototype.toJSON=function(){var o={};return this.forEach((function(H,n){o[n]="function"===typeof H.toJSON?H.toJSON():H})),o},H.prototype.clone=function(o){var n;return o?n=Object.assign(new H,this):(n=new H,this.forEach((function(o,H){o.$changes?n.set(H,o.clone()):n.set(H,o)}))),n},H}(),J={};function N(o,H){J[o]=H}function h(o){return J[o]}var Q=function(){function o(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return o.create=function(H){var n=new o;return n.schema=Object.assign({},H&&H.schema||{}),n.indexes=Object.assign({},H&&H.indexes||{}),n.fieldsByIndex=Object.assign({},H&&H.fieldsByIndex||{}),n.descriptors=Object.assign({},H&&H.descriptors||{}),n.deprecated=Object.assign({},H&&H.deprecated||{}),n},o.prototype.addField=function(o,H){var n=this.getNextFieldIndex();this.fieldsByIndex[n]=o,this.indexes[o]=n,this.schema[o]=Array.isArray(H)?{array:H[0]}:H},o.prototype.hasField=function(o){return void 0!==this.indexes[o]},o.prototype.addFilter=function(o,H){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[o]]=H,this.indexesWithFilters.push(this.indexes[o]),!0},o.prototype.addChildrenFilter=function(o,H){var n=this.indexes[o],E=this.schema[o];if(h(Object.keys(E)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[n]=H,!0;console.warn("@filterChildren: field '".concat(o,"' can't have children. Ignoring filter."))},o.prototype.getChildrenFilter=function(o){return this.childFilters&&this.childFilters[this.indexes[o]]},o.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},o}();function p(o){return o._context&&o._context.useFilters}var j=function(){function o(){this.types={},this.schemas=new Map,this.useFilters=!1}return o.prototype.has=function(o){return this.schemas.has(o)},o.prototype.get=function(o){return this.types[o]},o.prototype.add=function(o,H){void 0===H&&(H=this.schemas.size),o._definition=Q.create(o._definition),o._typeid=H,this.types[H]=o,this.schemas.set(o,H)},o.create=function(H){return void 0===H&&(H={}),function(n){return H.context||(H.context=new o),P(n,H)}},o}(),m=new j;function P(o,H){return void 0===H&&(H={}),function(n,E){var g=H.context||m,O=n.constructor;if(O._context=g,!o)throw new Error("".concat(O.name,': @type() reference provided for "').concat(E,"\" is undefined. Make sure you don't have any circular dependencies."));g.has(O)||g.add(O);var Y=O._definition;if(Y.addField(E,o),Y.descriptors[E]){if(Y.deprecated[E])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(E,"' definition on '").concat(O.name,"'.\nCheck @type() annotation"))}catch(J){var y=J.stack.split("\n")[4].trim();throw new Error("".concat(J.message," ").concat(y))}}var S=x.is(o),G=!S&&V.is(o);if("string"!==typeof o&&!Bo.is(o)){var c=Object.values(o)[0];"string"===typeof c||g.has(c)||g.add(c)}if(H.manual)Y.descriptors[E]={enumerable:!0,configurable:!0,writable:!0};else{var A="_".concat(E);Y.descriptors[A]={enumerable:!1,configurable:!1,writable:!0},Y.descriptors[E]={get:function(){return this[A]},set:function(o){o!==this[A]&&(void 0!==o&&null!==o?(!S||o instanceof x||(o=new(x.bind.apply(x,k([void 0],o,!1)))),!G||o instanceof V||(o=new V(o)),void 0===o.$proxy&&(G?o=z(o):S&&(o=l(o))),this.$changes.change(E),o.$changes&&o.$changes.setParent(this,this.$changes.root,this._definition.indexes[E])):this[A]&&this.$changes.delete(E),this[A]=o)},enumerable:!0,configurable:!0}}}}function b(o){return function(H,n){var E=H.constructor;E._definition.addFilter(n,o)&&(E._context.useFilters=!0)}}function e(o){return function(H,n){var E=H.constructor;E._definition.addChildrenFilter(n,o)&&(E._context.useFilters=!0)}}function Z(o){return void 0===o&&(o=!0),function(H,n){var E=H.constructor._definition;E.deprecated[n]=!0,o&&(E.descriptors[n]={get:function(){throw new Error("".concat(n," is deprecated."))},set:function(o){},enumerable:!1,configurable:!0})}}function M(o,H,n){for(var E in void 0===n&&(n={}),n.context||(n.context=o._context||n.context||m),H)P(H[E],n)(o.prototype,E);return o}function K(o){for(var H=0,n=0,E=0,k=o.length;E<k;E++)(H=o.charCodeAt(E))<128?n+=1:H<2048?n+=2:H<55296||H>=57344?n+=3:(E++,n+=4);return n}function f(o,H,n){for(var E=0,k=0,g=n.length;k<g;k++)(E=n.charCodeAt(k))<128?o[H++]=E:E<2048?(o[H++]=192|E>>6,o[H++]=128|63&E):E<55296||E>=57344?(o[H++]=224|E>>12,o[H++]=128|E>>6&63,o[H++]=128|63&E):(k++,E=65536+((1023&E)<<10|1023&n.charCodeAt(k)),o[H++]=240|E>>18,o[H++]=128|E>>12&63,o[H++]=128|E>>6&63,o[H++]=128|63&E)}function B(o,H){o.push(255&H)}function q(o,H){o.push(255&H)}function D(o,H){o.push(255&H),o.push(H>>8&255)}function T(o,H){o.push(255&H),o.push(H>>8&255)}function a(o,H){o.push(255&H),o.push(H>>8&255),o.push(H>>16&255),o.push(H>>24&255)}function F(o,H){var n=H>>24,E=H>>16,k=H>>8,g=H;o.push(255&g),o.push(255&k),o.push(255&E),o.push(255&n)}function C(o,H){var n=Math.floor(H/Math.pow(2,32));F(o,H>>>0),F(o,n)}function t(o,H){var n=H/Math.pow(2,32)|0;F(o,H>>>0),F(o,n)}function X(o,H){w(o,H)}function s(o,H){r(o,H)}var U=new Int32Array(2),I=new Float32Array(U.buffer),v=new Float64Array(U.buffer);function w(o,H){I[0]=H,a(o,U[0])}function r(o,H){v[0]=H,a(o,U[0]),a(o,U[1])}function u(o,H){return q(o,H?1:0)}function d(o,H){H||(H="");var n=K(H),E=0;if(n<32)o.push(160|n),E=1;else if(n<256)o.push(217),q(o,n),E=2;else if(n<65536)o.push(218),T(o,n),E=3;else{if(!(n<4294967296))throw new Error("String too long");o.push(219),F(o,n),E=5}return f(o,o.length,H),E+n}function R(o,H){return isNaN(H)?R(o,0):isFinite(H)?H!==(0|H)?(o.push(203),r(o,H),9):H>=0?H<128?(q(o,H),1):H<256?(o.push(204),q(o,H),2):H<65536?(o.push(205),T(o,H),3):H<4294967296?(o.push(206),F(o,H),5):(o.push(207),t(o,H),9):H>=-32?(o.push(224|H+32),1):H>=-128?(o.push(208),B(o,H),2):H>=-32768?(o.push(209),D(o,H),3):H>=-2147483648?(o.push(210),a(o,H),5):(o.push(211),C(o,H),9):R(o,H>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var W=Object.freeze({__proto__:null,utf8Write:f,int8:B,uint8:q,int16:D,uint16:T,int32:a,uint32:F,int64:C,uint64:t,float32:X,float64:s,writeFloat32:w,writeFloat64:r,boolean:u,string:d,number:R});function i(o,H,n){for(var E="",k=0,g=H,O=H+n;g<O;g++){var Y=o[g];0!==(128&Y)?192!==(224&Y)?224!==(240&Y)?240!==(248&Y)?console.error("Invalid byte "+Y.toString(16)):(k=(7&Y)<<18|(63&o[++g])<<12|(63&o[++g])<<6|63&o[++g])>=65536?(k-=65536,E+=String.fromCharCode(55296+(k>>>10),56320+(1023&k))):E+=String.fromCharCode(k):E+=String.fromCharCode((15&Y)<<12|(63&o[++g])<<6|63&o[++g]):E+=String.fromCharCode((31&Y)<<6|63&o[++g]):E+=String.fromCharCode(Y)}return E}function L(o,H){return oo(o,H)<<24>>24}function oo(o,H){return o[H.offset++]}function Ho(o,H){return no(o,H)<<16>>16}function no(o,H){return o[H.offset++]|o[H.offset++]<<8}function Eo(o,H){return o[H.offset++]|o[H.offset++]<<8|o[H.offset++]<<16|o[H.offset++]<<24}function ko(o,H){return Eo(o,H)>>>0}function go(o,H){return Ao(o,H)}function Oo(o,H){return lo(o,H)}function Yo(o,H){var n=ko(o,H);return Eo(o,H)*Math.pow(2,32)+n}function yo(o,H){var n=ko(o,H);return ko(o,H)*Math.pow(2,32)+n}var So=new Int32Array(2),Go=new Float32Array(So.buffer),co=new Float64Array(So.buffer);function Ao(o,H){return So[0]=Eo(o,H),Go[0]}function lo(o,H){return So[0]=Eo(o,H),So[1]=Eo(o,H),co[0]}function xo(o,H){return oo(o,H)>0}function zo(o,H){var n,E=o[H.offset++];E<192?n=31&E:217===E?n=oo(o,H):218===E?n=no(o,H):219===E&&(n=ko(o,H));var k=i(o,H.offset,n);return H.offset+=n,k}function Vo(o,H){var n=o[H.offset];return n<192&&n>160||217===n||218===n||219===n}function Jo(o,H){var n=o[H.offset++];return n<128?n:202===n?Ao(o,H):203===n?lo(o,H):204===n?oo(o,H):205===n?no(o,H):206===n?ko(o,H):207===n?yo(o,H):208===n?L(o,H):209===n?Ho(o,H):210===n?Eo(o,H):211===n?Yo(o,H):n>223?-1*(255-n+1):void 0}function No(o,H){var n=o[H.offset];return n<128||n>=202&&n<=211}function ho(o,H){return o[H.offset]<160}function Qo(o,H){return o[H.offset-1]===O&&(o[H.offset]<128||o[H.offset]>=202&&o[H.offset]<=211)}var po=Object.freeze({__proto__:null,int8:L,uint8:oo,int16:Ho,uint16:no,int32:Eo,uint32:ko,float32:go,float64:Oo,int64:Yo,uint64:yo,readFloat32:Ao,readFloat64:lo,boolean:xo,string:zo,stringCheck:Vo,number:Jo,numberCheck:No,arrayCheck:ho,switchStructureCheck:Qo}),jo=function(){function H(o){var H=this;this.$changes=new y(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,o&&o.forEach((function(o){return H.add(o)}))}return H.prototype.PY=function(H,n){return void 0===n&&(n=!0),S(this.$callbacks||(this.$callbacks=[]),o.OPERATION.ADD,H,n?this.$items:void 0)},H.prototype.ln=function(H){return S(this.$callbacks||(this.$callbacks=[]),o.OPERATION.DELETE,H)},H.prototype.onChange=function(H){return S(this.$callbacks||(this.$callbacks=[]),o.OPERATION.REPLACE,H)},H.is=function(o){return void 0!==o.collection},H.prototype.add=function(o){var H=this.$refId++;return void 0!==o.$changes&&o.$changes.setParent(this,this.$changes.root,H),this.$changes.indexes[H]=H,this.$indexes.set(H,H),this.$items.set(H,o),this.$changes.change(H),H},H.prototype.at=function(o){var H=Array.from(this.$items.keys())[o];return this.$items.get(H)},H.prototype.entries=function(){return this.$items.entries()},H.prototype.delete=function(o){for(var H,n,E=this.$items.entries();(n=E.next())&&!n.done;)if(o===n.value[1]){H=n.value[0];break}return void 0!==H&&(this.$changes.delete(H),this.$indexes.delete(H),this.$items.delete(H))},H.prototype.clear=function(H){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),H&&G.call(this,H),this.$items.clear(),this.$changes.operation({index:0,op:o.OPERATION.CLEAR}),this.$changes.touchParents()},H.prototype.has=function(o){return Array.from(this.$items.values()).some((function(H){return H===o}))},H.prototype.forEach=function(o){var H=this;this.$items.forEach((function(n,E,k){return o(n,E,H)}))},H.prototype.values=function(){return this.$items.values()},Object.defineProperty(H.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),H.prototype.setIndex=function(o,H){this.$indexes.set(o,H)},H.prototype.getIndex=function(o){return this.$indexes.get(o)},H.prototype.getByIndex=function(o){return this.$items.get(this.$indexes.get(o))},H.prototype.deleteByIndex=function(o){var H=this.$indexes.get(o);this.$items.delete(H),this.$indexes.delete(o)},H.prototype.toArray=function(){return Array.from(this.$items.values())},H.prototype.toJSON=function(){var o=[];return this.forEach((function(H,n){o.push("function"===typeof H.toJSON?H.toJSON():H)})),o},H.prototype.clone=function(o){var n;return o?n=Object.assign(new H,this):(n=new H,this.forEach((function(o){o.$changes?n.add(o.clone()):n.add(o)}))),n},H}(),mo=function(){function H(o){var H=this;this.$changes=new y(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,o&&o.forEach((function(o){return H.add(o)}))}return H.prototype.PY=function(H,n){return void 0===n&&(n=!0),S(this.$callbacks||(this.$callbacks=[]),o.OPERATION.ADD,H,n?this.$items:void 0)},H.prototype.ln=function(H){return S(this.$callbacks||(this.$callbacks=[]),o.OPERATION.DELETE,H)},H.prototype.onChange=function(H){return S(this.$callbacks||(this.$callbacks=[]),o.OPERATION.REPLACE,H)},H.is=function(o){return void 0!==o.set},H.prototype.add=function(H){var n,E;if(this.has(H))return!1;var k=this.$refId++;void 0!==H.$changes&&H.$changes.setParent(this,this.$changes.root,k);var g=null!==(E=null===(n=this.$changes.indexes[k])||void 0===n?void 0:n.op)&&void 0!==E?E:o.OPERATION.ADD;return this.$changes.indexes[k]=k,this.$indexes.set(k,k),this.$items.set(k,H),this.$changes.change(k,g),k},H.prototype.entries=function(){return this.$items.entries()},H.prototype.delete=function(o){for(var H,n,E=this.$items.entries();(n=E.next())&&!n.done;)if(o===n.value[1]){H=n.value[0];break}return void 0!==H&&(this.$changes.delete(H),this.$indexes.delete(H),this.$items.delete(H))},H.prototype.clear=function(H){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),H&&G.call(this,H),this.$items.clear(),this.$changes.operation({index:0,op:o.OPERATION.CLEAR}),this.$changes.touchParents()},H.prototype.has=function(o){for(var H,n=this.$items.values(),E=!1;(H=n.next())&&!H.done;)if(o===H.value){E=!0;break}return E},H.prototype.forEach=function(o){var H=this;this.$items.forEach((function(n,E,k){return o(n,E,H)}))},H.prototype.values=function(){return this.$items.values()},Object.defineProperty(H.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),H.prototype.setIndex=function(o,H){this.$indexes.set(o,H)},H.prototype.getIndex=function(o){return this.$indexes.get(o)},H.prototype.getByIndex=function(o){return this.$items.get(this.$indexes.get(o))},H.prototype.deleteByIndex=function(o){var H=this.$indexes.get(o);this.$items.delete(H),this.$indexes.delete(o)},H.prototype.toArray=function(){return Array.from(this.$items.values())},H.prototype.toJSON=function(){var o=[];return this.forEach((function(H,n){o.push("function"===typeof H.toJSON?H.toJSON():H)})),o},H.prototype.clone=function(o){var n;return o?n=Object.assign(new H,this):(n=new H,this.forEach((function(o){o.$changes?n.add(o.clone()):n.add(o)}))),n},H}(),Po=function(){function o(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return o.prototype.addRefId=function(o){this.refIds.has(o)||(this.refIds.add(o),this.containerIndexes.set(o,new Set))},o.get=function(H){return void 0===H.$filterState&&(H.$filterState=new o),H.$filterState},o}(),bo=function(){function o(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return o.prototype.getNextUniqueId=function(){return this.nextUniqueId++},o.prototype.addRef=function(o,H,n){void 0===n&&(n=!0),this.refs.set(o,H),n&&(this.refCounts[o]=(this.refCounts[o]||0)+1)},o.prototype.removeRef=function(o){this.refCounts[o]=this.refCounts[o]-1,this.deletedRefs.add(o)},o.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},o.prototype.garbageCollectDeletedRefs=function(){var o=this;this.deletedRefs.forEach((function(H){if(!(o.refCounts[H]>0)){var n=o.refs.get(H);if(n instanceof Bo)for(var E in n._definition.schema)"string"!==typeof n._definition.schema[E]&&n[E]&&n[E].$changes&&o.removeRef(n[E].$changes.refId);else{var k=n.$changes.parent._definition,g=k.schema[k.fieldsByIndex[n.$changes.parentIndex]];"function"===typeof Object.values(g)[0]&&Array.from(n.values()).forEach((function(H){return o.removeRef(H.$changes.refId)}))}o.refs.delete(H),delete o.refCounts[H]}})),this.deletedRefs.clear()},o}(),eo=function(o){function H(){return null!==o&&o.apply(this,arguments)||this}return n(H,o),H}(Error);function Zo(o,H,n,E){var k,g=!1;switch(H){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":k="number",isNaN(o)&&console.log('trying to encode "NaN" in '.concat(n.constructor.name,"#").concat(E));break;case"string":k="string",g=!0;break;case"boolean":return}if(typeof o!==k&&(!g||g&&null!==o)){var O="'".concat(JSON.stringify(o),"'").concat(o&&o.constructor&&" (".concat(o.constructor.name,")")||"");throw new eo("a '".concat(k,"' was expected, but ").concat(O," was provided in ").concat(n.constructor.name,"#").concat(E))}}function Mo(o,H,n,E){if(!(o instanceof H))throw new eo("a '".concat(H.name,"' was expected, but '").concat(o.constructor.name,"' was provided in ").concat(n.constructor.name,"#").concat(E))}function Ko(o,H,n,E,k){Zo(n,o,E,k);var g=W[o];if(!g)throw new eo("a '".concat(o,"' was expected, but ").concat(n," was provided in ").concat(E.constructor.name,"#").concat(k));g(H,n)}function fo(o,H,n){return po[o](H,n)}var Bo=function(){function H(){for(var o=[],H=0;H<arguments.length;H++)o[H]=arguments[H];Object.defineProperties(this,{$changes:{value:new y(this,void 0,new bo),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var n=this._definition.descriptors;n&&Object.defineProperties(this,n),o[0]&&this.assign(o[0])}return H.onError=function(o){console.error(o)},H.is=function(o){return o._definition&&void 0!==o._definition.schema},H.prototype.onChange=function(H){return S(this.$callbacks||(this.$callbacks=[]),o.OPERATION.REPLACE,H)},H.prototype.ln=function(H){return S(this.$callbacks||(this.$callbacks=[]),o.OPERATION.DELETE,H)},H.prototype.assign=function(o){return Object.assign(this,o),this},Object.defineProperty(H.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),H.prototype.setDirty=function(o,H){this.$changes.change(o,H)},H.prototype.listen=function(o,H,n){var E=this;return void 0===n&&(n=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[o]||(this.$callbacks[o]=[]),this.$callbacks[o].push(H),n&&void 0!==this[o]&&H(this[o],void 0),function(){return c(E.$callbacks[o],E.$callbacks[o].indexOf(H))}},H.prototype.decode=function(n,E,k){var g;void 0===E&&(E={offset:0}),void 0===k&&(k=this);var Y=[],y=this.$changes.root,S=n.length,G=0;for(y.refs.set(G,this);E.offset<S;){var c=n[E.offset++];if(c!=O){var A=k.$changes,l=void 0!==k._definition,z=l?c>>6<<6:c;if(z!==o.OPERATION.CLEAR){var J=l?c%(z||255):Jo(n,E),N=l?k._definition.fieldsByIndex[J]:"",Q=A.getType(J),p=void 0,j=void 0,m=void 0;if(l?j=k["_".concat(N)]:(j=k.getByIndex(J),(z&o.OPERATION.ADD)===o.OPERATION.ADD?(m=k instanceof V?zo(n,E):J,k.setIndex(J,m)):m=k.getIndex(J)),(z&o.OPERATION.DELETE)===o.OPERATION.DELETE&&(z!==o.OPERATION.DELETE_AND_ADD&&k.deleteByIndex(J),j&&j.$changes&&y.removeRef(j.$changes.refId),p=null),void 0!==N){if(z===o.OPERATION.DELETE);else if(H.is(Q)){var P=Jo(n,E);if(p=y.refs.get(P),z!==o.OPERATION.REPLACE){var b=this.getSchemaType(n,E,Q);p||((p=this.createTypeInstance(b)).$changes.refId=P,j&&(p.$callbacks=j.$callbacks,j.$changes.refId&&P!==j.$changes.refId&&y.removeRef(j.$changes.refId))),y.addRef(P,p,p!==j)}}else if("string"===typeof Q)p=fo(Q,n,E);else{var e=h(Object.keys(Q)[0]),Z=Jo(n,E),M=y.refs.has(Z)?j||y.refs.get(Z):new e.constructor;if((p=M.clone(!0)).$changes.refId=Z,j&&(p.$callbacks=j.$callbacks,j.$changes.refId&&Z!==j.$changes.refId)){y.removeRef(j.$changes.refId);for(var K=j.entries(),f=void 0;(f=K.next())&&!f.done;){var B=(g=f.value)[0],q=g[1];Y.push({refId:Z,op:o.OPERATION.DELETE,field:B,value:void 0,previousValue:q})}}y.addRef(Z,p,M!==j)}if(null!==p&&void 0!==p)if(p.$changes&&p.$changes.setParent(A.ref,A.root,J),k instanceof H)k[N]=p;else if(k instanceof V)B=m,k.$items.set(B,p),k.$changes.allChanges.add(J);else if(k instanceof x)k.setAt(J,p);else if(k instanceof jo){var D=k.add(p);k.setIndex(J,D)}else k instanceof mo&&!1!==(D=k.add(p))&&k.setIndex(J,D);j!==p&&Y.push({refId:G,op:z,field:N,dynamicIndex:m,value:p,previousValue:j})}else{console.warn("@colyseus/schema: definition mismatch");for(var T={offset:E.offset};E.offset<S&&(!Qo(n,E)||(T.offset=E.offset+1,!y.refs.has(Jo(n,T))));)E.offset++}}else k.clear(Y)}else{G=Jo(n,E);var a=y.refs.get(G);if(!a)throw new Error('"refId" not found: '.concat(G));k=a}}return this._triggerChanges(Y),y.garbageCollectDeletedRefs(),Y},H.prototype.encode=function(n,E,k){void 0===n&&(n=!1),void 0===E&&(E=[]),void 0===k&&(k=!1);for(var g=this.$changes,Y=new WeakSet,y=[g],S=1,G=0;G<S;G++){var c=y[G],A=c.ref,l=A instanceof H;c.ensureRefId(),Y.add(c),c!==g&&(c.changed||n)&&(q(E,O),R(E,c.refId));for(var x=n?Array.from(c.allChanges):Array.from(c.changes.values()),z=0,J=x.length;z<J;z++){var N=n?{op:o.OPERATION.ADD,index:x[z]}:x[z],Q=N.index,p=l?A._definition.fieldsByIndex&&A._definition.fieldsByIndex[Q]:Q,j=E.length;if(N.op!==o.OPERATION.TOUCH)if(l)q(E,Q|N.op);else{if(q(E,N.op),N.op===o.OPERATION.CLEAR)continue;R(E,Q)}if(l||(N.op&o.OPERATION.ADD)!=o.OPERATION.ADD||A instanceof V&&d(E,c.ref.$indexes.get(Q)),N.op!==o.OPERATION.DELETE){var m=c.getType(Q),P=c.getValue(Q);if(P&&P.$changes&&!Y.has(P.$changes)&&(y.push(P.$changes),P.$changes.ensureRefId(),S++),N.op!==o.OPERATION.TOUCH){if(H.is(m))Mo(P,m,A,p),R(E,P.$changes.refId),(N.op&o.OPERATION.ADD)===o.OPERATION.ADD&&this.tryEncodeTypeId(E,m,P.constructor);else if("string"===typeof m)Ko(m,E,P,A,p);else{var b=h(Object.keys(m)[0]);Mo(A["_".concat(p)],b.constructor,A,p),R(E,P.$changes.refId)}k&&c.cache(Q,E.slice(j))}}}n||k||c.discard()}return E},H.prototype.encodeAll=function(o){return this.encode(!0,[],o)},H.prototype.applyFilters=function(n,E){var k,g;void 0===E&&(E=!1);for(var Y=this,y=new Set,S=Po.get(n),G=[this.$changes],c=1,A=[],l=function(l){var x=G[l];if(y.has(x.refId))return"continue";var z=x.ref,J=z instanceof H;q(A,O),R(A,x.refId);var N=S.refIds.has(x),h=E||!N;S.addRefId(x);var Q=S.containerIndexes.get(x),p=h?Array.from(x.allChanges):Array.from(x.changes.values());!E&&J&&z._definition.indexesWithFilters&&z._definition.indexesWithFilters.forEach((function(H){!Q.has(H)&&x.allChanges.has(H)&&(h?p.push(H):p.push({op:o.OPERATION.ADD,index:H}))}));for(var j=0,m=p.length;j<m;j++){var P=h?{op:o.OPERATION.ADD,index:p[j]}:p[j];if(P.op!==o.OPERATION.CLEAR){var b=P.index;if(P.op!==o.OPERATION.DELETE){var e=x.getValue(b),Z=x.getType(b);if(J){if((M=z._definition.filters&&z._definition.filters[b])&&!M.call(z,n,e,Y)){e&&e.$changes&&y.add(e.$changes.refId);continue}}else{var M,K=x.parent;if((M=x.getChildrenFilter())&&!M.call(K,n,z.$indexes.get(b),e,Y)){e&&e.$changes&&y.add(e.$changes.refId);continue}}if(e.$changes&&(G.push(e.$changes),c++),P.op!==o.OPERATION.TOUCH)if(P.op===o.OPERATION.ADD||J)A.push.apply(A,null!==(k=x.caches[b])&&void 0!==k?k:[]),Q.add(b);else if(Q.has(b))A.push.apply(A,null!==(g=x.caches[b])&&void 0!==g?g:[]);else{if(Q.add(b),q(A,o.OPERATION.ADD),R(A,b),z instanceof V){var f=x.ref.$indexes.get(b);d(A,f)}e.$changes?R(A,e.$changes.refId):W[Z](A,e)}else e.$changes&&!J&&(q(A,o.OPERATION.ADD),R(A,b),z instanceof V&&(f=x.ref.$indexes.get(b),d(A,f)),R(A,e.$changes.refId))}else J?q(A,P.op|b):(q(A,P.op),R(A,b))}else q(A,P.op)}},x=0;x<c;x++)l(x);return A},H.prototype.clone=function(){var o,H=new this.constructor,n=this._definition.schema;for(var E in n)"object"===typeof this[E]&&"function"===typeof(null===(o=this[E])||void 0===o?void 0:o.clone)?H[E]=this[E].clone():H[E]=this[E];return H},H.prototype.toJSON=function(){var o=this._definition.schema,H=this._definition.deprecated,n={};for(var E in o)H[E]||null===this[E]||"undefined"===typeof this[E]||(n[E]="function"===typeof this[E].toJSON?this[E].toJSON():this["_".concat(E)]);return n},H.prototype.discardAllChanges=function(){this.$changes.discardAll()},H.prototype.getByIndex=function(o){return this[this._definition.fieldsByIndex[o]]},H.prototype.deleteByIndex=function(o){this[this._definition.fieldsByIndex[o]]=void 0},H.prototype.tryEncodeTypeId=function(o,H,n){H._typeid!==n._typeid&&(q(o,Y),R(o,n._typeid))},H.prototype.getSchemaType=function(o,H,n){var E;return o[H.offset]===Y&&(H.offset++,E=this.constructor._context.get(Jo(o,H))),E||n},H.prototype.createTypeInstance=function(o){var H=new o;return H.$changes.root=this.$changes.root,H},H.prototype._triggerChanges=function(n){for(var E,k,g,O,Y,y,S,G,c,A=new Set,l=this.$changes.root.refs,x=function(x){var z=n[x],V=z.refId,J=l.get(V),N=J.$callbacks;if((z.op&o.OPERATION.DELETE)===o.OPERATION.DELETE&&z.previousValue instanceof H&&(null===(k=null===(E=z.previousValue.$callbacks)||void 0===E?void 0:E[o.OPERATION.DELETE])||void 0===k||k.forEach((function(o){return o()}))),!N)return"continue";if(J instanceof H){if(!A.has(V))try{null===(g=null===N||void 0===N?void 0:N[o.OPERATION.REPLACE])||void 0===g||g.forEach((function(o){return o()}))}catch(h){H.onError(h)}try{N.hasOwnProperty(z.field)&&(null===(O=N[z.field])||void 0===O||O.forEach((function(o){return o(z.value,z.previousValue)})))}catch(h){H.onError(h)}}else z.op===o.OPERATION.ADD&&void 0===z.previousValue?null===(Y=N[o.OPERATION.ADD])||void 0===Y||Y.forEach((function(o){var H;return o(z.value,null!==(H=z.dynamicIndex)&&void 0!==H?H:z.field)})):z.op===o.OPERATION.DELETE?void 0!==z.previousValue&&(null===(y=N[o.OPERATION.DELETE])||void 0===y||y.forEach((function(o){var H;return o(z.previousValue,null!==(H=z.dynamicIndex)&&void 0!==H?H:z.field)}))):z.op===o.OPERATION.DELETE_AND_ADD&&(void 0!==z.previousValue&&(null===(S=N[o.OPERATION.DELETE])||void 0===S||S.forEach((function(o){var H;return o(z.previousValue,null!==(H=z.dynamicIndex)&&void 0!==H?H:z.field)}))),null===(G=N[o.OPERATION.ADD])||void 0===G||G.forEach((function(o){var H;return o(z.value,null!==(H=z.dynamicIndex)&&void 0!==H?H:z.field)}))),z.value!==z.previousValue&&(null===(c=N[o.OPERATION.REPLACE])||void 0===c||c.forEach((function(o){var H;return o(z.value,null!==(H=z.dynamicIndex)&&void 0!==H?H:z.field)})));A.add(V)},z=0;z<n.length;z++)x(z)},H._definition=Q.create(),H}();function qo(o){for(var H=[o.$changes],n=1,E={},k=E,g=function(o){var n=H[o];n.changes.forEach((function(o){var H=n.ref,E=o.index,g=H._definition?H._definition.fieldsByIndex[E]:H.$indexes.get(E);k[g]=n.getValue(E)}))},O=0;O<n;O++)g(O);return E}var Do={context:new j},To=function(o){function H(){return null!==o&&o.apply(this,arguments)||this}return n(H,o),E([P("string",Do)],H.prototype,"name",void 0),E([P("string",Do)],H.prototype,"type",void 0),E([P("number",Do)],H.prototype,"referencedType",void 0),H}(Bo),ao=function(o){function H(){var H=null!==o&&o.apply(this,arguments)||this;return H.fields=new x,H}return n(H,o),E([P("number",Do)],H.prototype,"id",void 0),E([P([To],Do)],H.prototype,"fields",void 0),H}(Bo),Fo=function(o){function H(){var H=null!==o&&o.apply(this,arguments)||this;return H.types=new x,H}return n(H,o),H.encode=function(o){var n=o.constructor,E=new H;E.rootType=n._typeid;var k=function(o,H){for(var n in H){var k=new To;k.name=n;var g=void 0;if("string"===typeof H[n])g=H[n];else{var O=H[n],Y=void 0;Bo.is(O)?(g="ref",Y=H[n]):"string"===typeof O[g=Object.keys(O)[0]]?g+=":"+O[g]:Y=O[g],k.referencedType=Y?Y._typeid:-1}k.type=g,o.fields.push(k)}E.types.push(o)},g=n._context.types;for(var O in g){var Y=new ao;Y.id=Number(O),k(Y,g[O]._definition.schema)}return E.encodeAll()},H.decode=function(o,E){var k=new j,g=new H;g.decode(o,E);var O=g.types.reduce((function(o,H){var E=function(o){function H(){return null!==o&&o.apply(this,arguments)||this}return n(H,o),H}(Bo),g=H.id;return o[g]=E,k.add(E,g),o}),{});g.types.forEach((function(o){var H=O[o.id];o.fields.forEach((function(o){var n;if(void 0!==o.referencedType){var E=o.type,g=O[o.referencedType];if(!g){var Y=o.type.split(":");E=Y[0],g=Y[1]}"ref"===E?P(g,{context:k})(H.prototype,o.name):P(((n={})[E]=g,n),{context:k})(H.prototype,o.name)}else P(o.type,{context:k})(H.prototype,o.name)}))}));var Y=O[g.rootType],y=new Y;for(var S in Y._definition.schema){var G=Y._definition.schema[S];"string"!==typeof G&&(y[S]="function"===typeof G?new G:new(h(Object.keys(G)[0]).constructor))}return y},E([P([ao],Do)],H.prototype,"types",void 0),E([P("number",Do)],H.prototype,"rootType",void 0),H}(Bo);N("map",{constructor:V}),N("array",{constructor:x}),N("set",{constructor:mo}),N("collection",{constructor:jo}),o.ArraySchema=x,o.CollectionSchema=jo,o.Context=j,o.MapSchema=V,o.Reflection=Fo,o.ReflectionField=To,o.ReflectionType=ao,o.Schema=Bo,o.SchemaDefinition=Q,o.SetSchema=mo,o.decode=po,o.defineTypes=M,o.deprecated=Z,o.dumpChanges=qo,o.encode=W,o.filter=b,o.filterChildren=e,o.hasFilter=p,o.registerType=N,o.type=P,Object.defineProperty(o,"__esModule",{value:!0})}(H)},13367:o=>{"use strict";o.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13360:(o,H,n)=>{var E=n(13367),k=n(13369),g=Object.hasOwnProperty,O=Object.create(null);for(var Y in E)g.call(E,Y)&&(O[E[Y]]=Y);var y=o.exports={to:{},get:{}};function S(o,H,n){return Math.min(Math.max(H,o),n)}function G(o){var H=Math.round(o).toString(16).toUpperCase();return H.length<2?"0"+H:H}y.get=function(o){var H,n;switch(o.substring(0,3).toLowerCase()){case"hsl":H=y.get.hsl(o),n="hsl";break;case"hwb":H=y.get.hwb(o),n="hwb";break;default:H=y.get.rgb(o),n="rgb"}return H?{model:n,value:H}:null},y.get.rgb=function(o){if(!o)return null;var H,n,k,O=[0,0,0,1];if(H=o.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(k=H[2],H=H[1],n=0;n<3;n++){var Y=2*n;O[n]=parseInt(H.slice(Y,Y+2),16)}k&&(O[3]=parseInt(k,16)/255)}else if(H=o.match(/^#([a-f0-9]{3,4})$/i)){for(k=(H=H[1])[3],n=0;n<3;n++)O[n]=parseInt(H[n]+H[n],16);k&&(O[3]=parseInt(k+k,16)/255)}else if(H=o.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(n=0;n<3;n++)O[n]=parseInt(H[n+1],0);H[4]&&(H[5]?O[3]=.01*parseFloat(H[4]):O[3]=parseFloat(H[4]))}else{if(!(H=o.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(H=o.match(/^(\w+)$/))?"transparent"===H[1]?[0,0,0,0]:g.call(E,H[1])?((O=E[H[1]])[3]=1,O):null:null;for(n=0;n<3;n++)O[n]=Math.round(2.55*parseFloat(H[n+1]));H[4]&&(H[5]?O[3]=.01*parseFloat(H[4]):O[3]=parseFloat(H[4]))}for(n=0;n<3;n++)O[n]=S(O[n],0,255);return O[3]=S(O[3],0,1),O},y.get.hsl=function(o){if(!o)return null;var H=o.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(H){var n=parseFloat(H[4]);return[(parseFloat(H[1])%360+360)%360,S(parseFloat(H[2]),0,100),S(parseFloat(H[3]),0,100),S(isNaN(n)?1:n,0,1)]}return null},y.get.hwb=function(o){if(!o)return null;var H=o.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(H){var n=parseFloat(H[4]);return[(parseFloat(H[1])%360+360)%360,S(parseFloat(H[2]),0,100),S(parseFloat(H[3]),0,100),S(isNaN(n)?1:n,0,1)]}return null},y.to.hex=function(){var o=k(arguments);return"#"+G(o[0])+G(o[1])+G(o[2])+(o[3]<1?G(Math.round(255*o[3])):"")},y.to.rgb=function(){var o=k(arguments);return o.length<4||1===o[3]?"rgb("+Math.round(o[0])+", "+Math.round(o[1])+", "+Math.round(o[2])+")":"rgba("+Math.round(o[0])+", "+Math.round(o[1])+", "+Math.round(o[2])+", "+o[3]+")"},y.to.rgb.percent=function(){var o=k(arguments),H=Math.round(o[0]/255*100),n=Math.round(o[1]/255*100),E=Math.round(o[2]/255*100);return o.length<4||1===o[3]?"rgb("+H+"%, "+n+"%, "+E+"%)":"rgba("+H+"%, "+n+"%, "+E+"%, "+o[3]+")"},y.to.hsl=function(){var o=k(arguments);return o.length<4||1===o[3]?"hsl("+o[0]+", "+o[1]+"%, "+o[2]+"%)":"hsla("+o[0]+", "+o[1]+"%, "+o[2]+"%, "+o[3]+")"},y.to.hwb=function(){var o=k(arguments),H="";return o.length>=4&&1!==o[3]&&(H=", "+o[3]),"hwb("+o[0]+", "+o[1]+"%, "+o[2]+"%"+H+")"},y.to.keyword=function(o){return O[o.slice(0,3)]}},13357:(o,H,n)=>{const E=n(13360),k=n(13380),g=["keyword","gray","hex"],O={};for(const l of Object.keys(k))O[[...k[l].labels].sort().join("")]=l;const Y={};function y(o,H){if(!(this instanceof y))return new y(o,H);if(H&&H in g&&(H=null),H&&!(H in k))throw new Error("Unknown model: "+H);let n,S;if(null==o)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(o instanceof y)this.model=o.model,this.color=[...o.color],this.valpha=o.valpha;else if("string"===typeof o){const H=E.get(o);if(null===H)throw new Error("Unable to parse color from string: "+o);this.model=H.model,S=k[this.model].channels,this.color=H.value.slice(0,S),this.valpha="number"===typeof H.value[S]?H.value[S]:1}else if(o.length>0){this.model=H||"rgb",S=k[this.model].channels;const n=Array.prototype.slice.call(o,0,S);this.color=A(n,S),this.valpha="number"===typeof o[S]?o[S]:1}else if("number"===typeof o)this.model="rgb",this.color=[o>>16&255,o>>8&255,255&o],this.valpha=1;else{this.valpha=1;const H=Object.keys(o);"alpha"in o&&(H.splice(H.indexOf("alpha"),1),this.valpha="number"===typeof o.alpha?o.alpha:0);const E=H.sort().join("");if(!(E in O))throw new Error("Unable to parse color from object: "+JSON.stringify(o));this.model=O[E];const{labels:g}=k[this.model],Y=[];for(n=0;n<g.length;n++)Y.push(o[g[n]]);this.color=A(Y)}if(Y[this.model])for(S=k[this.model].channels,n=0;n<S;n++){const o=Y[this.model][n];o&&(this.color[n]=o(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}y.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(o){let H=this.model in E.to?this:this.rgb();H=H.round("number"===typeof o?o:1);const n=1===H.valpha?H.color:[...H.color,this.valpha];return E.to[H.model](n)},percentString(o){const H=this.rgb().round("number"===typeof o?o:1),n=1===H.valpha?H.color:[...H.color,this.valpha];return E.to.rgb.percent(n)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const o={},{channels:H}=k[this.model],{labels:n}=k[this.model];for(let E=0;E<H;E++)o[n[E]]=this.color[E];return 1!==this.valpha&&(o.alpha=this.valpha),o},unitArray(){const o=this.rgb().color;return o[0]/=255,o[1]/=255,o[2]/=255,1!==this.valpha&&o.push(this.valpha),o},unitObject(){const o=this.rgb().object();return o.r/=255,o.g/=255,o.b/=255,1!==this.valpha&&(o.alpha=this.valpha),o},round(o){return o=Math.max(o||0,0),new y([...this.color.map(S(o)),this.valpha],this.model)},alpha(o){return void 0!==o?new y([...this.color,Math.max(0,Math.min(1,o))],this.model):this.valpha},red:G("rgb",0,c(255)),green:G("rgb",1,c(255)),blue:G("rgb",2,c(255)),hue:G(["hsl","hsv","hsl","hwb","hcg"],0,(o=>(o%360+360)%360)),saturationl:G("hsl",1,c(100)),lightness:G("hsl",2,c(100)),saturationv:G("hsv",1,c(100)),value:G("hsv",2,c(100)),chroma:G("hcg",1,c(100)),gray:G("hcg",2,c(100)),white:G("hwb",1,c(100)),wblack:G("hwb",2,c(100)),cyan:G("cmyk",0,c(100)),magenta:G("cmyk",1,c(100)),yellow:G("cmyk",2,c(100)),black:G("cmyk",3,c(100)),x:G("xyz",0,c(95.047)),y:G("xyz",1,c(100)),z:G("xyz",2,c(108.833)),l:G("lab",0,c(100)),a:G("lab",1),b:G("lab",2),keyword(o){return void 0!==o?new y(o):k[this.model].keyword(this.color)},hex(o){return void 0!==o?new y(o):E.to.hex(this.rgb().round().color)},hexa(o){if(void 0!==o)return new y(o);const H=this.rgb().round().color;let n=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===n.length&&(n="0"+n),E.to.hex(H)+n},rgbNumber(){const o=this.rgb().color;return(255&o[0])<<16|(255&o[1])<<8|255&o[2]},luminosity(){const o=this.rgb().color,H=[];for(const[n,E]of o.entries()){const o=E/255;H[n]=o<=.04045?o/12.92:((o+.055)/1.055)**2.4}return.2126*H[0]+.7152*H[1]+.0722*H[2]},contrast(o){const H=this.luminosity(),n=o.luminosity();return H>n?(H+.05)/(n+.05):(n+.05)/(H+.05)},level(o){const H=this.contrast(o);return H>=7?"AAA":H>=4.5?"AA":""},isDark(){const o=this.rgb().color;return(2126*o[0]+7152*o[1]+722*o[2])/1e4<128},isLight(){return!this.isDark()},negate(){const o=this.rgb();for(let H=0;H<3;H++)o.color[H]=255-o.color[H];return o},lighten(o){const H=this.hsl();return H.color[2]+=H.color[2]*o,H},darken(o){const H=this.hsl();return H.color[2]-=H.color[2]*o,H},saturate(o){const H=this.hsl();return H.color[1]+=H.color[1]*o,H},desaturate(o){const H=this.hsl();return H.color[1]-=H.color[1]*o,H},whiten(o){const H=this.hwb();return H.color[1]+=H.color[1]*o,H},blacken(o){const H=this.hwb();return H.color[2]+=H.color[2]*o,H},grayscale(){const o=this.rgb().color,H=.3*o[0]+.59*o[1]+.11*o[2];return y.rgb(H,H,H)},fade(o){return this.alpha(this.valpha-this.valpha*o)},opaquer(o){return this.alpha(this.valpha+this.valpha*o)},rotate(o){const H=this.hsl();let n=H.color[0];return n=(n+o)%360,n=n<0?360+n:n,H.color[0]=n,H},mix(o,H){if(!o||!o.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof o);const n=o.rgb(),E=this.rgb(),k=void 0===H?.5:H,g=2*k-1,O=n.alpha()-E.alpha(),Y=((g*O===-1?g:(g+O)/(1+g*O))+1)/2,S=1-Y;return y.rgb(Y*n.red()+S*E.red(),Y*n.green()+S*E.green(),Y*n.blue()+S*E.blue(),n.alpha()*k+E.alpha()*(1-k))}};for(const l of Object.keys(k)){if(g.includes(l))continue;const{channels:o}=k[l];y.prototype[l]=function(){if(this.model===l)return new y(this);for(var o=arguments.length,H=new Array(o),n=0;n<o;n++)H[n]=arguments[n];return H.length>0?new y(H,l):new y([...(E=k[this.model][l].raw(this.color),Array.isArray(E)?E:[E]),this.valpha],l);var E},y[l]=function(){for(var H=arguments.length,n=new Array(H),E=0;E<H;E++)n[E]=arguments[E];let k=n[0];return"number"===typeof k&&(k=A(n,o)),new y(k,l)}}function S(o){return function(H){return function(o,H){return Number(o.toFixed(H))}(H,o)}}function G(o,H,n){o=Array.isArray(o)?o:[o];for(const E of o)(Y[E]||(Y[E]=[]))[H]=n;return o=o[0],function(E){let k;return void 0!==E?(n&&(E=n(E)),k=this[o](),k.color[H]=E,k):(k=this[o]().color[H],n&&(k=n(k)),k)}}function c(o){return function(H){return Math.max(0,Math.min(o,H))}}function A(o,H){for(let n=0;n<H;n++)"number"!==typeof o[n]&&(o[n]=0);return o}o.exports=y},13389:(o,H,n)=>{const E=n(13394),k={};for(const O of Object.keys(E))k[E[O]]=O;const g={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};o.exports=g;for(const O of Object.keys(g)){if(!("channels"in g[O]))throw new Error("missing channels property: "+O);if(!("labels"in g[O]))throw new Error("missing channel labels property: "+O);if(g[O].labels.length!==g[O].channels)throw new Error("channel and label counts mismatch: "+O);const{channels:o,labels:H}=g[O];delete g[O].channels,delete g[O].labels,Object.defineProperty(g[O],"channels",{value:o}),Object.defineProperty(g[O],"labels",{value:H})}g.rgb.hsl=function(o){const H=o[0]/255,n=o[1]/255,E=o[2]/255,k=Math.min(H,n,E),g=Math.max(H,n,E),O=g-k;let Y,y;g===k?Y=0:H===g?Y=(n-E)/O:n===g?Y=2+(E-H)/O:E===g&&(Y=4+(H-n)/O),Y=Math.min(60*Y,360),Y<0&&(Y+=360);const S=(k+g)/2;return y=g===k?0:S<=.5?O/(g+k):O/(2-g-k),[Y,100*y,100*S]},g.rgb.hsv=function(o){let H,n,E,k,g;const O=o[0]/255,Y=o[1]/255,y=o[2]/255,S=Math.max(O,Y,y),G=S-Math.min(O,Y,y),c=function(o){return(S-o)/6/G+.5};return 0===G?(k=0,g=0):(g=G/S,H=c(O),n=c(Y),E=c(y),O===S?k=E-n:Y===S?k=1/3+H-E:y===S&&(k=2/3+n-H),k<0?k+=1:k>1&&(k-=1)),[360*k,100*g,100*S]},g.rgb.hwb=function(o){const H=o[0],n=o[1];let E=o[2];const k=g.rgb.hsl(o)[0],O=1/255*Math.min(H,Math.min(n,E));return E=1-1/255*Math.max(H,Math.max(n,E)),[k,100*O,100*E]},g.rgb.cmyk=function(o){const H=o[0]/255,n=o[1]/255,E=o[2]/255,k=Math.min(1-H,1-n,1-E);return[100*((1-H-k)/(1-k)||0),100*((1-n-k)/(1-k)||0),100*((1-E-k)/(1-k)||0),100*k]},g.rgb.keyword=function(o){const H=k[o];if(H)return H;let n,g=1/0;for(const k of Object.keys(E)){const H=E[k],y=(Y=H,((O=o)[0]-Y[0])**2+(O[1]-Y[1])**2+(O[2]-Y[2])**2);y<g&&(g=y,n=k)}var O,Y;return n},g.keyword.rgb=function(o){return E[o]},g.rgb.xyz=function(o){let H=o[0]/255,n=o[1]/255,E=o[2]/255;H=H>.04045?((H+.055)/1.055)**2.4:H/12.92,n=n>.04045?((n+.055)/1.055)**2.4:n/12.92,E=E>.04045?((E+.055)/1.055)**2.4:E/12.92;return[100*(.4124*H+.3576*n+.1805*E),100*(.2126*H+.7152*n+.0722*E),100*(.0193*H+.1192*n+.9505*E)]},g.rgb.lab=function(o){const H=g.rgb.xyz(o);let n=H[0],E=H[1],k=H[2];n/=95.047,E/=100,k/=108.883,n=n>.008856?n**(1/3):7.787*n+16/116,E=E>.008856?E**(1/3):7.787*E+16/116,k=k>.008856?k**(1/3):7.787*k+16/116;return[116*E-16,500*(n-E),200*(E-k)]},g.hsl.rgb=function(o){const H=o[0]/360,n=o[1]/100,E=o[2]/100;let k,g,O;if(0===n)return O=255*E,[O,O,O];k=E<.5?E*(1+n):E+n-E*n;const Y=2*E-k,y=[0,0,0];for(let S=0;S<3;S++)g=H+1/3*-(S-1),g<0&&g++,g>1&&g--,O=6*g<1?Y+6*(k-Y)*g:2*g<1?k:3*g<2?Y+(k-Y)*(2/3-g)*6:Y,y[S]=255*O;return y},g.hsl.hsv=function(o){const H=o[0];let n=o[1]/100,E=o[2]/100,k=n;const g=Math.max(E,.01);E*=2,n*=E<=1?E:2-E,k*=g<=1?g:2-g;return[H,100*(0===E?2*k/(g+k):2*n/(E+n)),100*((E+n)/2)]},g.hsv.rgb=function(o){const H=o[0]/60,n=o[1]/100;let E=o[2]/100;const k=Math.floor(H)%6,g=H-Math.floor(H),O=255*E*(1-n),Y=255*E*(1-n*g),y=255*E*(1-n*(1-g));switch(E*=255,k){case 0:return[E,y,O];case 1:return[Y,E,O];case 2:return[O,E,y];case 3:return[O,Y,E];case 4:return[y,O,E];case 5:return[E,O,Y]}},g.hsv.hsl=function(o){const H=o[0],n=o[1]/100,E=o[2]/100,k=Math.max(E,.01);let g,O;O=(2-n)*E;const Y=(2-n)*k;return g=n*k,g/=Y<=1?Y:2-Y,g=g||0,O/=2,[H,100*g,100*O]},g.hwb.rgb=function(o){const H=o[0]/360;let n=o[1]/100,E=o[2]/100;const k=n+E;let g;k>1&&(n/=k,E/=k);const O=Math.floor(6*H),Y=1-E;g=6*H-O,0!==(1&O)&&(g=1-g);const y=n+g*(Y-n);let S,G,c;switch(O){default:case 6:case 0:S=Y,G=y,c=n;break;case 1:S=y,G=Y,c=n;break;case 2:S=n,G=Y,c=y;break;case 3:S=n,G=y,c=Y;break;case 4:S=y,G=n,c=Y;break;case 5:S=Y,G=n,c=y}return[255*S,255*G,255*c]},g.cmyk.rgb=function(o){const H=o[0]/100,n=o[1]/100,E=o[2]/100,k=o[3]/100;return[255*(1-Math.min(1,H*(1-k)+k)),255*(1-Math.min(1,n*(1-k)+k)),255*(1-Math.min(1,E*(1-k)+k))]},g.xyz.rgb=function(o){const H=o[0]/100,n=o[1]/100,E=o[2]/100;let k,g,O;return k=3.2406*H+-1.5372*n+-.4986*E,g=-.9689*H+1.8758*n+.0415*E,O=.0557*H+-.204*n+1.057*E,k=k>.0031308?1.055*k**(1/2.4)-.055:12.92*k,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,O=O>.0031308?1.055*O**(1/2.4)-.055:12.92*O,k=Math.min(Math.max(0,k),1),g=Math.min(Math.max(0,g),1),O=Math.min(Math.max(0,O),1),[255*k,255*g,255*O]},g.xyz.lab=function(o){let H=o[0],n=o[1],E=o[2];H/=95.047,n/=100,E/=108.883,H=H>.008856?H**(1/3):7.787*H+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,E=E>.008856?E**(1/3):7.787*E+16/116;return[116*n-16,500*(H-n),200*(n-E)]},g.lab.xyz=function(o){let H,n,E;n=(o[0]+16)/116,H=o[1]/500+n,E=n-o[2]/200;const k=n**3,g=H**3,O=E**3;return n=k>.008856?k:(n-16/116)/7.787,H=g>.008856?g:(H-16/116)/7.787,E=O>.008856?O:(E-16/116)/7.787,H*=95.047,n*=100,E*=108.883,[H,n,E]},g.lab.lch=function(o){const H=o[0],n=o[1],E=o[2];let k;k=360*Math.atan2(E,n)/2/Math.PI,k<0&&(k+=360);return[H,Math.sqrt(n*n+E*E),k]},g.lch.lab=function(o){const H=o[0],n=o[1],E=o[2]/360*2*Math.PI;return[H,n*Math.cos(E),n*Math.sin(E)]},g.rgb.ansi16=function(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[n,E,k]=o;let O=null===H?g.rgb.hsv(o)[2]:H;if(O=Math.round(O/50),0===O)return 30;let Y=30+(Math.round(k/255)<<2|Math.round(E/255)<<1|Math.round(n/255));return 2===O&&(Y+=60),Y},g.hsv.ansi16=function(o){return g.rgb.ansi16(g.hsv.rgb(o),o[2])},g.rgb.ansi256=function(o){const H=o[0],n=o[1],E=o[2];if(H===n&&n===E)return H<8?16:H>248?231:Math.round((H-8)/247*24)+232;return 16+36*Math.round(H/255*5)+6*Math.round(n/255*5)+Math.round(E/255*5)},g.ansi16.rgb=function(o){let H=o%10;if(0===H||7===H)return o>50&&(H+=3.5),H=H/10.5*255,[H,H,H];const n=.5*(1+~~(o>50));return[(1&H)*n*255,(H>>1&1)*n*255,(H>>2&1)*n*255]},g.ansi256.rgb=function(o){if(o>=232){const H=10*(o-232)+8;return[H,H,H]}let H;o-=16;return[Math.floor(o/36)/5*255,Math.floor((H=o%36)/6)/5*255,H%6/5*255]},g.rgb.hex=function(o){const H=(((255&Math.round(o[0]))<<16)+((255&Math.round(o[1]))<<8)+(255&Math.round(o[2]))).toString(16).toUpperCase();return"000000".substring(H.length)+H},g.hex.rgb=function(o){const H=o.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!H)return[0,0,0];let n=H[0];3===H[0].length&&(n=n.split("").map((o=>o+o)).join(""));const E=parseInt(n,16);return[E>>16&255,E>>8&255,255&E]},g.rgb.hcg=function(o){const H=o[0]/255,n=o[1]/255,E=o[2]/255,k=Math.max(Math.max(H,n),E),g=Math.min(Math.min(H,n),E),O=k-g;let Y,y;return Y=O<1?g/(1-O):0,y=O<=0?0:k===H?(n-E)/O%6:k===n?2+(E-H)/O:4+(H-n)/O,y/=6,y%=1,[360*y,100*O,100*Y]},g.hsl.hcg=function(o){const H=o[1]/100,n=o[2]/100,E=n<.5?2*H*n:2*H*(1-n);let k=0;return E<1&&(k=(n-.5*E)/(1-E)),[o[0],100*E,100*k]},g.hsv.hcg=function(o){const H=o[1]/100,n=o[2]/100,E=H*n;let k=0;return E<1&&(k=(n-E)/(1-E)),[o[0],100*E,100*k]},g.hcg.rgb=function(o){const H=o[0]/360,n=o[1]/100,E=o[2]/100;if(0===n)return[255*E,255*E,255*E];const k=[0,0,0],g=H%1*6,O=g%1,Y=1-O;let y=0;switch(Math.floor(g)){case 0:k[0]=1,k[1]=O,k[2]=0;break;case 1:k[0]=Y,k[1]=1,k[2]=0;break;case 2:k[0]=0,k[1]=1,k[2]=O;break;case 3:k[0]=0,k[1]=Y,k[2]=1;break;case 4:k[0]=O,k[1]=0,k[2]=1;break;default:k[0]=1,k[1]=0,k[2]=Y}return y=(1-n)*E,[255*(n*k[0]+y),255*(n*k[1]+y),255*(n*k[2]+y)]},g.hcg.hsv=function(o){const H=o[1]/100,n=H+o[2]/100*(1-H);let E=0;return n>0&&(E=H/n),[o[0],100*E,100*n]},g.hcg.hsl=function(o){const H=o[1]/100,n=o[2]/100*(1-H)+.5*H;let E=0;return n>0&&n<.5?E=H/(2*n):n>=.5&&n<1&&(E=H/(2*(1-n))),[o[0],100*E,100*n]},g.hcg.hwb=function(o){const H=o[1]/100,n=H+o[2]/100*(1-H);return[o[0],100*(n-H),100*(1-n)]},g.hwb.hcg=function(o){const H=o[1]/100,n=1-o[2]/100,E=n-H;let k=0;return E<1&&(k=(n-E)/(1-E)),[o[0],100*E,100*k]},g.apple.rgb=function(o){return[o[0]/65535*255,o[1]/65535*255,o[2]/65535*255]},g.rgb.apple=function(o){return[o[0]/255*65535,o[1]/255*65535,o[2]/255*65535]},g.gray.rgb=function(o){return[o[0]/100*255,o[0]/100*255,o[0]/100*255]},g.gray.hsl=function(o){return[0,0,o[0]]},g.gray.hsv=g.gray.hsl,g.gray.hwb=function(o){return[0,100,o[0]]},g.gray.cmyk=function(o){return[0,0,0,o[0]]},g.gray.lab=function(o){return[o[0],0,0]},g.gray.hex=function(o){const H=255&Math.round(o[0]/100*255),n=((H<<16)+(H<<8)+H).toString(16).toUpperCase();return"000000".substring(n.length)+n},g.rgb.gray=function(o){return[(o[0]+o[1]+o[2])/3/255*100]}},13380:(o,H,n)=>{const E=n(13389),k=n(13401),g={};Object.keys(E).forEach((o=>{g[o]={},Object.defineProperty(g[o],"channels",{value:E[o].channels}),Object.defineProperty(g[o],"labels",{value:E[o].labels});const H=k(o);Object.keys(H).forEach((n=>{const E=H[n];g[o][n]=function(o){const H=function(){for(var H=arguments.length,n=new Array(H),E=0;E<H;E++)n[E]=arguments[E];const k=n[0];if(void 0===k||null===k)return k;k.length>1&&(n=k);const g=o(n);if("object"===typeof g)for(let o=g.length,O=0;O<o;O++)g[O]=Math.round(g[O]);return g};return"conversion"in o&&(H.conversion=o.conversion),H}(E),g[o][n].raw=function(o){const H=function(){for(var H=arguments.length,n=new Array(H),E=0;E<H;E++)n[E]=arguments[E];const k=n[0];return void 0===k||null===k?k:(k.length>1&&(n=k),o(n))};return"conversion"in o&&(H.conversion=o.conversion),H}(E)}))})),o.exports=g},13401:(o,H,n)=>{const E=n(13389);function k(o){const H=function(){const o={},H=Object.keys(E);for(let n=H.length,E=0;E<n;E++)o[H[E]]={distance:-1,parent:null};return o}(),n=[o];for(H[o].distance=0;n.length;){const o=n.pop(),k=Object.keys(E[o]);for(let E=k.length,g=0;g<E;g++){const E=k[g],O=H[E];-1===O.distance&&(O.distance=H[o].distance+1,O.parent=o,n.unshift(E))}}return H}function g(o,H){return function(n){return H(o(n))}}function O(o,H){const n=[H[o].parent,o];let k=E[H[o].parent][o],O=H[o].parent;for(;H[O].parent;)n.unshift(H[O].parent),k=g(E[H[O].parent][O],k),O=H[O].parent;return k.conversion=n,k}o.exports=function(o){const H=k(o),n={},E=Object.keys(H);for(let k=E.length,g=0;g<k;g++){const o=E[g];null!==H[o].parent&&(n[o]=O(o,H))}return n}},13394:o=>{"use strict";o.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11893:function(o,H,n){"use strict";var E=this&&this.__createBinding||(Object.create?function(o,H,n,E){void 0===E&&(E=n);var k=Object.getOwnPropertyDescriptor(H,n);k&&!("get"in k?!H.__esModule:k.writable||k.configurable)||(k={enumerable:!0,get:function(){return H[n]}}),Object.defineProperty(o,E,k)}:function(o,H,n,E){void 0===E&&(E=n),o[E]=H[n]}),k=this&&this.__setModuleDefault||(Object.create?function(o,H){Object.defineProperty(o,"default",{enumerable:!0,value:H})}:function(o,H){o.default=H}),g=this&&this.__importStar||function(o){if(o&&o.__esModule)return o;var H={};if(null!=o)for(var n in o)"default"!==n&&Object.prototype.hasOwnProperty.call(o,n)&&E(H,o,n);return k(H,o),H},O=this&&this.__awaiter||function(o,H,n,E){return new(n||(n=Promise))((function(k,g){function O(o){try{y(E.next(o))}catch(H){g(H)}}function Y(o){try{y(E.throw(o))}catch(H){g(H)}}function y(o){var H;o.done?k(o.value):(H=o.value,H instanceof n?H:new n((function(o){o(H)}))).then(O,Y)}y((E=E.apply(o,H||[])).next())}))};Object.defineProperty(H,"__esModule",{value:!0}),H.Auth=H.Platform=void 0;const Y=g(n(11827)),y=n(11901),S="colyseus-auth-token";!function(o){o.ios="ios",o.android="android"}(H.Platform||(H.Platform={}));H.Auth=class{constructor(o){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=o.replace("ws","http"),(0,y.getItem)(S,(o=>this.token=o))}get hasToken(){return!!this.token}login(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return O(this,void 0,void 0,(function*(){const H=Object.assign({},o);this.hasToken&&(H.token=this.token);const n=yield this.request("post","/auth",H);this.token=n.token,(0,y.setItem)(S,this.token);for(let o in n)this.hasOwnProperty(o)&&(this[o]=n[o]);return this.registerPingService(),this}))}save(){return O(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return O(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return O(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return O(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(o){return O(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:o})}))}acceptFriendRequest(o){return O(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:o})}))}declineFriendRequest(o){return O(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:o})}))}blockUser(o){return O(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:o})}))}unblockUser(o){return O(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:o})}))}request(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},E=arguments.length>3?arguments[3]:void 0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return O(this,void 0,void 0,(function*(){k.Accept="application/json",this.hasToken&&(k.Authorization="Bearer "+this.token);const g=[];for(const o in n)g.push(`${o}=${n[o]}`);const O=g.length>0?`?${g.join("&")}`:"",y={headers:k};return E&&(y.body=E),(yield Y[o](`${this.endpoint}${H}${O}`,y)).data}))}logout(){this.token=void 0,(0,y.removeItem)(S),this.unregisterPingService()}registerPingService(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),o)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11825:function(o,H,n){"use strict";var E,k=this&&this.__awaiter||function(o,H,n,E){return new(n||(n=Promise))((function(k,g){function O(o){try{y(E.next(o))}catch(H){g(H)}}function Y(o){try{y(E.throw(o))}catch(H){g(H)}}function y(o){var H;o.done?k(o.value):(H=o.value,H instanceof n?H:new n((function(o){o(H)}))).then(O,Y)}y((E=E.apply(o,H||[])).next())}))};Object.defineProperty(H,"__esModule",{value:!0}),H.Client=H.MatchMakeError=void 0;const g=n(11827),O=n(11831),Y=n(11834);class y extends Error{constructor(o,H){super(o),this.code=H,Object.setPrototypeOf(this,y.prototype)}}H.MatchMakeError=y;const S="undefined"!==typeof window&&"undefined"!==typeof(null===(E=null===window||void 0===window?void 0:window.location)||void 0===E?void 0:E.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";H.Client=class{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S;if("string"===typeof o){const H=new URL(o),n="https:"===H.protocol||"wss:"===H.protocol,E=Number(H.port||(n?443:80));this.settings={hostname:H.hostname,pathname:"/"!==H.pathname?H.pathname:"",port:E,secure:n}}else void 0===o.port&&(o.port=o.secure?443:80),void 0===o.pathname&&(o.pathname=""),this.settings=o}joinOrCreate(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",o,H,n)}))}create(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",o,H,n)}))}join(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",o,H,n)}))}joinById(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",o,H,n)}))}reconnect(o,H){return k(this,void 0,void 0,(function*(){if("string"===typeof o&&"string"===typeof H)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[n,E]=o.split(":");return yield this.createMatchMakeRequest("reconnect",n,{reconnectionToken:E},H)}))}getAvailableRooms(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return k(this,void 0,void 0,(function*(){return(yield(0,g.get)(this.getHttpEndpoint(`${o}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(o,H,n){return k(this,void 0,void 0,(function*(){const E=this.createRoom(o.room.name,H);E.roomId=o.room.roomId,E.sessionId=o.sessionId;const g={sessionId:E.sessionId};o.reconnectionToken&&(g.reconnectionToken=o.reconnectionToken);const Y=n||E;return E.connect(this.buildEndpoint(o.room,g),o.devMode&&(()=>k(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${E.roomId}'...`);let n=0;const g=()=>k(this,void 0,void 0,(function*(){n++;try{yield this.consumeSeatReservation(o,H,Y),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${E.roomId}'`)}catch(k){n<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${n} out of 8)`),setTimeout(g,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(g,2e3)}))),Y),new Promise(((o,H)=>{const n=(o,n)=>H(new O.ServerError(o,n));Y.onError.once(n),Y.onJoin.once((()=>{Y.onError.remove(n),o(Y)}))}))}))}createMatchMakeRequest(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},E=arguments.length>3?arguments[3]:void 0,O=arguments.length>4?arguments[4]:void 0;return k(this,void 0,void 0,(function*(){const k=(yield(0,g.post)(this.getHttpEndpoint(`${o}/${H}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})).data;if(k.error)throw new y(k.error,k.code);return"reconnect"===o&&(k.reconnectionToken=n.reconnectionToken),yield this.consumeSeatReservation(k,E,O)}))}createRoom(o,H){return new Y.Room(o,H)}buildEndpoint(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=[];for(const k in H)H.hasOwnProperty(k)&&n.push(`${k}=${H[k]}`);let E=this.settings.secure?"wss://":"ws://";return o.publicAddress?E+=`${o.publicAddress}`:E+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${E}/${o.processId}/${o.roomId}?${n.join("&")}`}getHttpEndpoint(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${o}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11848:(o,H,n)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Connection=void 0;const E=n(11852);H.Connection=class{constructor(){this.events={},this.transport=new E.WebSocketTransport(this.events)}send(o){this.transport.send(o)}connect(o){this.transport.connect(o)}close(o,H){this.transport.close(o,H)}get isOpen(){return this.transport.isOpen}}},11865:(o,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.utf8Length=H.utf8Read=H.ErrorCode=H.Protocol=void 0,function(o){o[o.HANDSHAKE=9]="HANDSHAKE",o[o.JOIN_ROOM=10]="JOIN_ROOM",o[o.ERROR=11]="ERROR",o[o.LEAVE_ROOM=12]="LEAVE_ROOM",o[o.ROOM_DATA=13]="ROOM_DATA",o[o.ROOM_STATE=14]="ROOM_STATE",o[o.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",o[o.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",o[o.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(H.Protocol||(H.Protocol={})),function(o){o[o.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",o[o.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",o[o.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",o[o.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",o[o.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",o[o.AUTH_FAILED=4215]="AUTH_FAILED",o[o.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(H.ErrorCode||(H.ErrorCode={})),H.utf8Read=function(o,H){const n=o[H++];for(var E="",k=0,g=H,O=H+n;g<O;g++){var Y=o[g];if(0!==(128&Y))if(192!==(224&Y))if(224!==(240&Y)){if(240!==(248&Y))throw new Error("Invalid byte "+Y.toString(16));(k=(7&Y)<<18|(63&o[++g])<<12|(63&o[++g])<<6|63&o[++g])>=65536?(k-=65536,E+=String.fromCharCode(55296+(k>>>10),56320+(1023&k))):E+=String.fromCharCode(k)}else E+=String.fromCharCode((15&Y)<<12|(63&o[++g])<<6|63&o[++g]);else E+=String.fromCharCode((31&Y)<<6|63&o[++g]);else E+=String.fromCharCode(Y)}return E},H.utf8Length=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",H=0,n=0;for(let E=0,k=o.length;E<k;E++)H=o.charCodeAt(E),H<128?n+=1:H<2048?n+=2:H<55296||H>=57344?n+=3:(E++,n+=4);return n+1}},11834:function(o,H,n){"use strict";var E=this&&this.__createBinding||(Object.create?function(o,H,n,E){void 0===E&&(E=n);var k=Object.getOwnPropertyDescriptor(H,n);k&&!("get"in k?!H.__esModule:k.writable||k.configurable)||(k={enumerable:!0,get:function(){return H[n]}}),Object.defineProperty(o,E,k)}:function(o,H,n,E){void 0===E&&(E=n),o[E]=H[n]}),k=this&&this.__setModuleDefault||(Object.create?function(o,H){Object.defineProperty(o,"default",{enumerable:!0,value:H})}:function(o,H){o.default=H}),g=this&&this.__importStar||function(o){if(o&&o.__esModule)return o;var H={};if(null!=o)for(var n in o)"default"!==n&&Object.prototype.hasOwnProperty.call(o,n)&&E(H,o,n);return k(H,o),H};Object.defineProperty(H,"__esModule",{value:!0}),H.Room=void 0;const O=g(n(11843)),Y=n(11848),y=n(11865),S=n(11872),G=n(11874),c=n(11883),A=n(11890),l=n(11831);class x{constructor(o,H){this.onStateChange=(0,c.createSignal)(),this.onError=(0,c.createSignal)(),this.onLeave=(0,c.createSignal)(),this.onJoin=(0,c.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,G.createNanoEvents)(),this.roomId=null,this.name=o,H&&(this.serializer=new((0,S.getSerializer)("schema")),this.rootSchema=H,this.serializer.state=new H),this.onError(((o,H)=>{var n;return null===(n=console.warn)||void 0===n?void 0:n.call(console,`colyseus.js - onError => (${o}) ${H}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const E=new Y.Connection;n.connection=E,E.events.onmessage=x.prototype.onMessageCallback.bind(n),E.events.onclose=function(o){var E;if(!n.hasJoined)return null===(E=console.warn)||void 0===E||E.call(console,`Room connection was closed unexpectedly (${o.code}): ${o.reason}`),void n.onError.invoke(o.code,o.reason);o.code===l.CloseCode.DEVMODE_RESTART&&H?H():(n.onLeave.invoke(o.code),n.destroy())},E.events.onerror=function(o){var H;null===(H=console.warn)||void 0===H||H.call(console,`Room, onError (${o.code}): ${o.reason}`),n.onError.invoke(o.code,o.reason)},E.connect(o)}leave(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((H=>{this.onLeave((o=>H(o))),this.connection?o?this.connection.send([y.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(l.CloseCode.CONSENTED)}))}onMessage(o,H){return this.onMessageHandlers.on(this.getMessageHandlerKey(o),H)}send(o,H){const n=[y.Protocol.ROOM_DATA];let E;if("string"===typeof o?A.encode.string(n,o):A.encode.number(n,o),void 0!==H){const o=O.encode(H);E=new Uint8Array(n.length+o.byteLength),E.set(new Uint8Array(n),0),E.set(new Uint8Array(o),n.length)}else E=new Uint8Array(n);this.connection.send(E.buffer)}sendBytes(o,H){const n=[y.Protocol.ROOM_DATA_BYTES];let E;"string"===typeof o?A.encode.string(n,o):A.encode.number(n,o),E=new Uint8Array(n.length+(H.byteLength||H.length)),E.set(new Uint8Array(n),0),E.set(new Uint8Array(H),n.length),this.connection.send(E.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(o){const H=Array.from(new Uint8Array(o.data)),n=H[0];if(n===y.Protocol.JOIN_ROOM){let o=1;const n=(0,y.utf8Read)(H,o);if(o+=(0,y.utf8Length)(n),this.serializerId=(0,y.utf8Read)(H,o),o+=(0,y.utf8Length)(this.serializerId),!this.serializer){const o=(0,S.getSerializer)(this.serializerId);this.serializer=new o}H.length>o&&this.serializer.handshake&&this.serializer.handshake(H,{offset:o}),this.reconnectionToken=`${this.roomId}:${n}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([y.Protocol.JOIN_ROOM])}else if(n===y.Protocol.ERROR){const o={offset:1},n=A.decode.number(H,o),E=A.decode.string(H,o);this.onError.invoke(n,E)}else if(n===y.Protocol.LEAVE_ROOM)this.leave();else if(n===y.Protocol.ROOM_DATA_SCHEMA){const o={offset:1},n=this.serializer.getState().constructor._context.get(A.decode.number(H,o)),E=new n;E.decode(H,o),this.dispatchMessage(n,E)}else if(n===y.Protocol.ROOM_STATE)H.shift(),this.setState(H);else if(n===y.Protocol.ROOM_STATE_PATCH)H.shift(),this.patch(H);else if(n===y.Protocol.ROOM_DATA){const n={offset:1},E=A.decode.stringCheck(H,n)?A.decode.string(H,n):A.decode.number(H,n),k=H.length>n.offset?O.decode(o.data,n.offset):void 0;this.dispatchMessage(E,k)}else if(n===y.Protocol.ROOM_DATA_BYTES){const o={offset:1},n=A.decode.stringCheck(H,o)?A.decode.string(H,o):A.decode.number(H,o);this.dispatchMessage(n,new Uint8Array(H.slice(o.offset)))}}setState(o){this.serializer.setState(o),this.onStateChange.invoke(this.serializer.getState())}patch(o){this.serializer.patch(o),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(o,H){var n;const E=this.getMessageHandlerKey(o);this.onMessageHandlers.events[E]?this.onMessageHandlers.emit(E,H):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",o,H):null===(n=console.warn)||void 0===n||n.call(console,`colyseus.js: onMessage() not registered for type '${o}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(o){switch(typeof o){case"function":return`$${o._typeid}`;case"string":return o;case"number":return`i${o}`;default:throw new Error("invalid message type.")}}}H.Room=x},11901:(o,H)=>{"use strict";let n;function E(){return n||(n="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(o,H){this.cache[o]=H},getItem:function(o){this.cache[o]},removeItem:function(o){delete this.cache[o]}}),n}Object.defineProperty(H,"__esModule",{value:!0}),H.getItem=H.removeItem=H.setItem=void 0,H.setItem=function(o,H){E().setItem(o,H)},H.removeItem=function(o){E().removeItem(o)},H.getItem=function(o,H){const n=E().getItem(o);"undefined"!==typeof Promise&&n instanceof Promise?n.then((o=>H(o))):H(n)}},11874:(o,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.createNanoEvents=void 0;H.createNanoEvents=()=>({emit(o){let H=this.events[o]||[];for(var n=arguments.length,E=new Array(n>1?n-1:0),k=1;k<n;k++)E[k-1]=arguments[k];for(let g=0,O=H.length;g<O;g++)H[g](...E)},events:{},on(o,H){var n;return(null===(n=this.events[o])||void 0===n?void 0:n.push(H))||(this.events[o]=[H]),()=>{var n;this.events[o]=null===(n=this.events[o])||void 0===n?void 0:n.filter((o=>H!==o))}}})},11883:(o,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.createSignal=H.EventEmitter=void 0;class n{constructor(){this.handlers=[]}register(o){return this.handlers.push(o),this}invoke(){for(var o=arguments.length,H=new Array(o),n=0;n<o;n++)H[n]=arguments[n];this.handlers.forEach((o=>o.apply(this,H)))}invokeAsync(){for(var o=arguments.length,H=new Array(o),n=0;n<o;n++)H[n]=arguments[n];return Promise.all(this.handlers.map((o=>o.apply(this,H))))}remove(o){const H=this.handlers.indexOf(o);this.handlers[H]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}H.EventEmitter=n,H.createSignal=function(){const o=new n;function H(H){return o.register(H,null===this)}return H.once=H=>{const n=function(){for(var E=arguments.length,k=new Array(E),g=0;g<E;g++)k[g]=arguments[g];H.apply(this,k),o.remove(n)};o.register(n)},H.remove=H=>o.remove(H),H.invoke=function(){return o.invoke(...arguments)},H.invokeAsync=function(){return o.invokeAsync(...arguments)},H.clear=()=>o.clear(),H}},11831:(o,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.ServerError=H.CloseCode=void 0,function(o){o[o.CONSENTED=4e3]="CONSENTED",o[o.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(H.CloseCode||(H.CloseCode={}));class n extends Error{constructor(o,H){super(H),this.name="ServerError",this.code=o}}H.ServerError=n},11807:(o,H,n)=>{"use strict";H.b=void 0,n(11816);var E=n(11825);Object.defineProperty(H,"b",{enumerable:!0,get:function(){return E.Client}});var k=n(11865);var g=n(11834);var O=n(11893);const Y=n(11910);const y=n(11913),S=n(11872);(0,S.registerSerializer)("schema",Y.SchemaSerializer),(0,S.registerSerializer)("none",y.NoneSerializer)},11816:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=o=>null!==o&&"object"===typeof o&&o.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11843:(o,H)=>{"use strict";function n(o,H){if(this._offset=H,o instanceof ArrayBuffer)this._buffer=o,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(o))throw new Error("Invalid argument");this._buffer=o.buffer,this._view=new DataView(this._buffer,o.byteOffset,o.byteLength)}}Object.defineProperty(H,"__esModule",{value:!0}),H.decode=H.encode=void 0,n.prototype._array=function(o){for(var H=new Array(o),n=0;n<o;n++)H[n]=this._parse();return H},n.prototype._map=function(o){for(var H={},n=0;n<o;n++)H[this._parse()]=this._parse();return H},n.prototype._str=function(o){var H=function(o,H,n){for(var E="",k=0,g=H,O=H+n;g<O;g++){var Y=o.getUint8(g);if(0!==(128&Y))if(192!==(224&Y))if(224!==(240&Y)){if(240!==(248&Y))throw new Error("Invalid byte "+Y.toString(16));(k=(7&Y)<<18|(63&o.getUint8(++g))<<12|(63&o.getUint8(++g))<<6|63&o.getUint8(++g))>=65536?(k-=65536,E+=String.fromCharCode(55296+(k>>>10),56320+(1023&k))):E+=String.fromCharCode(k)}else E+=String.fromCharCode((15&Y)<<12|(63&o.getUint8(++g))<<6|63&o.getUint8(++g));else E+=String.fromCharCode((31&Y)<<6|63&o.getUint8(++g));else E+=String.fromCharCode(Y)}return E}(this._view,this._offset,o);return this._offset+=o,H},n.prototype._bin=function(o){var H=this._buffer.slice(this._offset,this._offset+o);return this._offset+=o,H},n.prototype._parse=function(){var o,H=this._view.getUint8(this._offset++),n=0,E=0,k=0,g=0;if(H<192)return H<128?H:H<144?this._map(15&H):H<160?this._array(15&H):this._str(31&H);if(H>223)return-1*(255-H+1);switch(H){case 192:return null;case 194:return!1;case 195:return!0;case 196:return n=this._view.getUint8(this._offset),this._offset+=1,this._bin(n);case 197:return n=this._view.getUint16(this._offset),this._offset+=2,this._bin(n);case 198:return n=this._view.getUint32(this._offset),this._offset+=4,this._bin(n);case 199:if(n=this._view.getUint8(this._offset),E=this._view.getInt8(this._offset+1),this._offset+=2,-1===E){var O=this._view.getUint32(this._offset);return k=this._view.getInt32(this._offset+4),g=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*k+g)+O/1e6)}return[E,this._bin(n)];case 200:return n=this._view.getUint16(this._offset),E=this._view.getInt8(this._offset+2),this._offset+=3,[E,this._bin(n)];case 201:return n=this._view.getUint32(this._offset),E=this._view.getInt8(this._offset+4),this._offset+=5,[E,this._bin(n)];case 202:return o=this._view.getFloat32(this._offset),this._offset+=4,o;case 203:return o=this._view.getFloat64(this._offset),this._offset+=8,o;case 204:return o=this._view.getUint8(this._offset),this._offset+=1,o;case 205:return o=this._view.getUint16(this._offset),this._offset+=2,o;case 206:return o=this._view.getUint32(this._offset),this._offset+=4,o;case 207:return k=this._view.getUint32(this._offset)*Math.pow(2,32),g=this._view.getUint32(this._offset+4),this._offset+=8,k+g;case 208:return o=this._view.getInt8(this._offset),this._offset+=1,o;case 209:return o=this._view.getInt16(this._offset),this._offset+=2,o;case 210:return o=this._view.getInt32(this._offset),this._offset+=4,o;case 211:return k=this._view.getInt32(this._offset)*Math.pow(2,32),g=this._view.getUint32(this._offset+4),this._offset+=8,k+g;case 212:return E=this._view.getInt8(this._offset),this._offset+=1,0===E?void(this._offset+=1):[E,this._bin(1)];case 213:return E=this._view.getInt8(this._offset),this._offset+=1,[E,this._bin(2)];case 214:return E=this._view.getInt8(this._offset),this._offset+=1,-1===E?(o=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*o)):[E,this._bin(4)];case 215:return E=this._view.getInt8(this._offset),this._offset+=1,0===E?(k=this._view.getInt32(this._offset)*Math.pow(2,32),g=this._view.getUint32(this._offset+4),this._offset+=8,new Date(k+g)):-1===E?(k=this._view.getUint32(this._offset),g=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&k)+g)+(k>>>2)/1e6)):[E,this._bin(8)];case 216:return E=this._view.getInt8(this._offset),this._offset+=1,[E,this._bin(16)];case 217:return n=this._view.getUint8(this._offset),this._offset+=1,this._str(n);case 218:return n=this._view.getUint16(this._offset),this._offset+=2,this._str(n);case 219:return n=this._view.getUint32(this._offset),this._offset+=4,this._str(n);case 220:return n=this._view.getUint16(this._offset),this._offset+=2,this._array(n);case 221:return n=this._view.getUint32(this._offset),this._offset+=4,this._array(n);case 222:return n=this._view.getUint16(this._offset),this._offset+=2,this._map(n);case 223:return n=this._view.getUint32(this._offset),this._offset+=4,this._map(n)}throw new Error("Could not parse")},H.decode=function(o){var H=new n(o,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),E=H._parse();if(H._offset!==o.byteLength)throw new Error(o.byteLength-H._offset+" trailing bytes");return E};function E(o,H,n){for(var E=0,k=0,g=n.length;k<g;k++)(E=n.charCodeAt(k))<128?o.setUint8(H++,E):E<2048?(o.setUint8(H++,192|E>>6),o.setUint8(H++,128|63&E)):E<55296||E>=57344?(o.setUint8(H++,224|E>>12),o.setUint8(H++,128|E>>6&63),o.setUint8(H++,128|63&E)):(k++,E=65536+((1023&E)<<10|1023&n.charCodeAt(k)),o.setUint8(H++,240|E>>18),o.setUint8(H++,128|E>>12&63),o.setUint8(H++,128|E>>6&63),o.setUint8(H++,128|63&E))}function k(o,H,n){var E=typeof n,g=0,O=0,Y=0,y=0,S=0,G=0;if("string"===E){if(S=function(o){for(var H=0,n=0,E=0,k=o.length;E<k;E++)(H=o.charCodeAt(E))<128?n+=1:H<2048?n+=2:H<55296||H>=57344?n+=3:(E++,n+=4);return n}(n),S<32)o.push(160|S),G=1;else if(S<256)o.push(217,S),G=2;else if(S<65536)o.push(218,S>>8,S),G=3;else{if(!(S<4294967296))throw new Error("String too long");o.push(219,S>>24,S>>16,S>>8,S),G=5}return H.push({_str:n,_length:S,_offset:o.length}),G+S}if("number"===E)return Math.floor(n)===n&&isFinite(n)?n>=0?n<128?(o.push(n),1):n<256?(o.push(204,n),2):n<65536?(o.push(205,n>>8,n),3):n<4294967296?(o.push(206,n>>24,n>>16,n>>8,n),5):(Y=n/Math.pow(2,32)|0,y=n>>>0,o.push(207,Y>>24,Y>>16,Y>>8,Y,y>>24,y>>16,y>>8,y),9):n>=-32?(o.push(n),1):n>=-128?(o.push(208,n),2):n>=-32768?(o.push(209,n>>8,n),3):n>=-2147483648?(o.push(210,n>>24,n>>16,n>>8,n),5):(Y=Math.floor(n/Math.pow(2,32)),y=n>>>0,o.push(211,Y>>24,Y>>16,Y>>8,Y,y>>24,y>>16,y>>8,y),9):(o.push(203),H.push({_float:n,_length:8,_offset:o.length}),9);if("object"===E){if(null===n)return o.push(192),1;if(Array.isArray(n)){if((S=n.length)<16)o.push(144|S),G=1;else if(S<65536)o.push(220,S>>8,S),G=3;else{if(!(S<4294967296))throw new Error("Array too large");o.push(221,S>>24,S>>16,S>>8,S),G=5}for(g=0;g<S;g++)G+=k(o,H,n[g]);return G}if(n instanceof Date){var c=n.getTime(),A=Math.floor(c/1e3),l=1e6*(c-1e3*A);return A>=0&&l>=0&&A<=17179869183?0===l&&A<=4294967295?(o.push(214,255,A>>24,A>>16,A>>8,A),6):(Y=A/4294967296,y=4294967295&A,o.push(215,255,l>>22,l>>14,l>>6,Y,y>>24,y>>16,y>>8,y),10):(Y=Math.floor(A/4294967296),y=A>>>0,o.push(199,12,255,l>>24,l>>16,l>>8,l,Y>>24,Y>>16,Y>>8,Y,y>>24,y>>16,y>>8,y),15)}if(n instanceof ArrayBuffer){if((S=n.byteLength)<256)o.push(196,S),G=2;else if(S<65536)o.push(197,S>>8,S),G=3;else{if(!(S<4294967296))throw new Error("Buffer too large");o.push(198,S>>24,S>>16,S>>8,S),G=5}return H.push({_bin:n,_length:S,_offset:o.length}),G+S}if("function"===typeof n.toJSON)return k(o,H,n.toJSON());var x=[],z="",V=Object.keys(n);for(g=0,O=V.length;g<O;g++)void 0!==n[z=V[g]]&&"function"!==typeof n[z]&&x.push(z);if((S=x.length)<16)o.push(128|S),G=1;else if(S<65536)o.push(222,S>>8,S),G=3;else{if(!(S<4294967296))throw new Error("Object too large");o.push(223,S>>24,S>>16,S>>8,S),G=5}for(g=0;g<S;g++)G+=k(o,H,z=x[g]),G+=k(o,H,n[z]);return G}if("boolean"===E)return o.push(n?195:194),1;if("undefined"===E)return o.push(192),1;if("function"===typeof n.toJSON)return k(o,H,n.toJSON());throw new Error("Could not encode")}H.encode=function(o){var H=[],n=[],g=k(H,n,o),O=new ArrayBuffer(g),Y=new DataView(O),y=0,S=0,G=-1;n.length>0&&(G=n[0]._offset);for(var c,A=0,l=0,x=0,z=H.length;x<z;x++)if(Y.setUint8(S+x,H[x]),x+1===G){if(A=(c=n[y])._length,l=S+G,c._bin)for(var V=new Uint8Array(c._bin),J=0;J<A;J++)Y.setUint8(l+J,V[J]);else c._str?E(Y,l,c._str):void 0!==c._float&&Y.setFloat64(l,c._float);S+=A,n[++y]&&(G=n[y]._offset)}return O}},11913:(o,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.NoneSerializer=void 0;H.NoneSerializer=class{setState(o){}getState(){return null}patch(o){}teardown(){}handshake(o){}}},11910:(o,H,n)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.SchemaSerializer=void 0;const E=n(11890);H.SchemaSerializer=class{setState(o){return this.state.decode(o)}getState(){return this.state}patch(o){return this.state.decode(o)}teardown(){var o,H;null===(H=null===(o=this.state)||void 0===o?void 0:o.$changes)||void 0===H||H.root.clearRefs()}handshake(o,H){if(this.state){(new E.Reflection).decode(o,H)}else this.state=E.Reflection.decode(o,H)}}},11872:(o,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.getSerializer=H.registerSerializer=void 0;const n={};H.registerSerializer=function(o,H){n[o]=H},H.getSerializer=function(o){const H=n[o];if(!H)throw new Error("missing serializer: "+o);return H}},11852:function(o,H,n){"use strict";var E=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(H,"__esModule",{value:!0}),H.WebSocketTransport=void 0;const k=E(n(11860)),g=globalThis.WebSocket||k.default;H.WebSocketTransport=class{constructor(o){this.events=o}send(o){o instanceof ArrayBuffer?this.ws.send(o):Array.isArray(o)&&this.ws.send(new Uint8Array(o).buffer)}connect(o){this.ws=new g(o,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(o,H){this.ws.close(o,H)}get isOpen(){return this.ws.readyState===g.OPEN}}},11860:o=>{"use strict";o.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12309:o=>{"use strict";o.exports=function(o){for(var H=new Array(o),n=0;n<o;++n)H[n]=n;return H}},12317:o=>{function H(o){return!!o.constructor&&"function"===typeof o.constructor.isBuffer&&o.constructor.isBuffer(o)}o.exports=function(o){return null!=o&&(H(o)||function(o){return"function"===typeof o.readFloatLE&&"function"===typeof o.slice&&H(o.slice(0,0))}(o)||!!o._isBuffer)}},12303:(o,H,n)=>{var E=n(12309),k=n(12317),g="undefined"!==typeof Float64Array;function O(o,H){return o[0]-H[0]}function Y(){var o,H=this.stride,n=new Array(H.length);for(o=0;o<n.length;++o)n[o]=[Math.abs(H[o]),o];n.sort(O);var E=new Array(n.length);for(o=0;o<E.length;++o)E[o]=n[o][1];return E}function y(o,H){var n=["View",H,"d",o].join("");H<0&&(n="View_Nil"+o);var k="generic"===o;if(-1===H){var g="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+o+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(g)()}if(0===H){g="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+o+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(k?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(k?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",g)(S[o][0])}g=["'use strict'"];var O=E(H),y=O.map((function(o){return"i"+o})),G="this.offset+"+O.map((function(o){return"this.stride["+o+"]*i"+o})).join("+"),c=O.map((function(o){return"b"+o})).join(","),A=O.map((function(o){return"c"+o})).join(",");g.push("function "+n+"(a,"+c+","+A+",d){this.data=a","this.shape=["+c+"]","this.stride=["+A+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+o+"'","proto.dimension="+H),g.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+O.map((function(o){return"this.shape["+o+"]"})).join("*"),"}})"),1===H?g.push("proto.order=[0]"):(g.push("Object.defineProperty(proto,'order',{get:"),H<4?(g.push("function "+n+"_order(){"),2===H?g.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===H&&g.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):g.push("ORDER})")),g.push("proto.set=function "+n+"_set("+y.join(",")+",v){"),k?g.push("return this.data.set("+G+",v)}"):g.push("return this.data["+G+"]=v}"),g.push("proto.get=function "+n+"_get("+y.join(",")+"){"),k?g.push("return this.data.get("+G+")}"):g.push("return this.data["+G+"]}"),g.push("proto.index=function "+n+"_index(",y.join(),"){return "+G+"}"),g.push("proto.hi=function "+n+"_hi("+y.join(",")+"){return new "+n+"(this.data,"+O.map((function(o){return["(typeof i",o,"!=='number'||i",o,"<0)?this.shape[",o,"]:i",o,"|0"].join("")})).join(",")+","+O.map((function(o){return"this.stride["+o+"]"})).join(",")+",this.offset)}");var l=O.map((function(o){return"a"+o+"=this.shape["+o+"]"})),x=O.map((function(o){return"c"+o+"=this.stride["+o+"]"}));g.push("proto.lo=function "+n+"_lo("+y.join(",")+"){var b=this.offset,d=0,"+l.join(",")+","+x.join(","));for(var z=0;z<H;++z)g.push("if(typeof i"+z+"==='number'&&i"+z+">=0){d=i"+z+"|0;b+=c"+z+"*d;a"+z+"-=d}");g.push("return new "+n+"(this.data,"+O.map((function(o){return"a"+o})).join(",")+","+O.map((function(o){return"c"+o})).join(",")+",b)}"),g.push("proto.step=function "+n+"_step("+y.join(",")+"){var "+O.map((function(o){return"a"+o+"=this.shape["+o+"]"})).join(",")+","+O.map((function(o){return"b"+o+"=this.stride["+o+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(z=0;z<H;++z)g.push("if(typeof i"+z+"==='number'){d=i"+z+"|0;if(d<0){c+=b"+z+"*(a"+z+"-1);a"+z+"=ceil(-a"+z+"/d)}else{a"+z+"=ceil(a"+z+"/d)}b"+z+"*=d}");g.push("return new "+n+"(this.data,"+O.map((function(o){return"a"+o})).join(",")+","+O.map((function(o){return"b"+o})).join(",")+",c)}");var V=new Array(H),J=new Array(H);for(z=0;z<H;++z)V[z]="a[i"+z+"]",J[z]="b[i"+z+"]";g.push("proto.transpose=function "+n+"_transpose("+y+"){"+y.map((function(o,H){return o+"=("+o+"===undefined?"+H+":"+o+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+V.join(",")+","+J.join(",")+",this.offset)}"),g.push("proto.pick=function "+n+"_pick("+y+"){var a=[],b=[],c=this.offset");for(z=0;z<H;++z)g.push("if(typeof i"+z+"==='number'&&i"+z+">=0){c=(c+this.stride["+z+"]*i"+z+")|0}else{a.push(this.shape["+z+"]);b.push(this.stride["+z+"])}");return g.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),g.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+O.map((function(o){return"shape["+o+"]"})).join(",")+","+O.map((function(o){return"stride["+o+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",g.join("\n"))(S[o],Y)}var S={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};o.exports=function(o,H,n,E){if(void 0===o)return(0,S.array[0])([]);"number"===typeof o&&(o=[o]),void 0===H&&(H=[o.length]);var O=H.length;if(void 0===n){n=new Array(O);for(var Y=O-1,G=1;Y>=0;--Y)n[Y]=G,G*=H[Y]}if(void 0===E){E=0;for(Y=0;Y<O;++Y)n[Y]<0&&(E-=(H[Y]-1)*n[Y])}for(var c=function(o){if(k(o))return"buffer";if(g)switch(Object.prototype.toString.call(o)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(o)?"array":"generic"}(o),A=S[c];A.length<=O+1;)A.push(y(c,A.length-1));return(0,A[O+1])(o,H,n,E)}},13348:o=>{var H;self,H=()=>(()=>{"use strict";var o={d:(H,n)=>{for(var E in n)o.o(n,E)&&!o.o(H,E)&&Object.defineProperty(H,E,{enumerable:!0,get:n[E]})},o:(o,H)=>Object.prototype.hasOwnProperty.call(o,H)},H={};o.d(H,{default:()=>q});var n,E=function(o,H){var n=H.x-o.x,E=H.y-o.y;return Math.sqrt(n*n+E*E)},k=function(o){return o*(Math.PI/180)},g=new Map,O=function(o){g.has(o)&&clearTimeout(g.get(o)),g.set(o,setTimeout(o,100))},Y=function(o,H,n){for(var E,k=H.split(/[ ,]+/g),g=0;g<k.length;g+=1)E=k[g],o.addEventListener?o.addEventListener(E,n,!1):o.attachEvent&&o.attachEvent(E,n)},y=function(o,H,n){for(var E,k=H.split(/[ ,]+/g),g=0;g<k.length;g+=1)E=k[g],o.removeEventListener?o.removeEventListener(E,n):o.detachEvent&&o.detachEvent(E,n)},S=function(o){return o.preventDefault(),o.type.match(/^touch/)?o.changedTouches:o},G=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},c=function(o,H){H.top||H.right||H.bottom||H.left?(o.style.top=H.top,o.style.right=H.right,o.style.bottom=H.bottom,o.style.left=H.left):(o.style.left=H.x+"px",o.style.top=H.y+"px")},A=function(o,H,n){var E=l(o);for(var k in E)if(E.hasOwnProperty(k))if("string"==typeof H)E[k]=H+" "+n;else{for(var g="",O=0,Y=H.length;O<Y;O+=1)g+=H[O]+" "+n+", ";E[k]=g.slice(0,-2)}return E},l=function(o){var H={};return H[o]="",["webkit","Moz","o"].forEach((function(n){H[n+o.charAt(0).toUpperCase()+o.slice(1)]=""})),H},x=function(o,H){for(var n in H)H.hasOwnProperty(n)&&(o[n]=H[n]);return o},z=function(o,H){if(o.length)for(var n=0,E=o.length;n<E;n+=1)H(o[n]);else H(o)},V="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,J=window.matchMedia("(any-hover: none)").matches,N=!!("ontouchstart"in window),h=!!window.PointerEvent,Q=!!window.MSPointerEvent,p={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},j={start:"mousedown",move:"mousemove",end:"mouseup"},m={};function P(){}V&&!J?n=p:h?n={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:Q?n={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:N?(n=p,m=j):n=j,P.prototype.on=function(o,H){var n,E=this,k=o.split(/[ ,]+/g);E._handlers_=E._handlers_||{};for(var g=0;g<k.length;g+=1)n=k[g],E._handlers_[n]=E._handlers_[n]||[],E._handlers_[n].push(H);return E},P.prototype.off=function(o,H){var n=this;return n._handlers_=n._handlers_||{},void 0===o?n._handlers_={}:void 0===H?n._handlers_[o]=null:n._handlers_[o]&&n._handlers_[o].indexOf(H)>=0&&n._handlers_[o].splice(n._handlers_[o].indexOf(H),1),n},P.prototype.trigger=function(o,H){var n,E=this,k=o.split(/[ ,]+/g);E._handlers_=E._handlers_||{};for(var g=0;g<k.length;g+=1)n=k[g],E._handlers_[n]&&E._handlers_[n].length&&E._handlers_[n].forEach((function(o){o.call(E,{type:n,target:E},H)}))},P.prototype.config=function(o){var H=this;H.options=H.defaults||{},o&&(H.options=function(o,H){var n={};for(var E in o)o.hasOwnProperty(E)&&H.hasOwnProperty(E)?n[E]=H[E]:o.hasOwnProperty(E)&&(n[E]=o[E]);return n}(H.options,o))},P.prototype.bindEvt=function(o,H){var E=this;return E._domHandlers_=E._domHandlers_||{},E._domHandlers_[H]=function(){"function"==typeof E["on"+H]?E["on"+H].apply(E,arguments):console.warn('[WARNING] : Missing "on'+H+'" handler.')},Y(o,n[H],E._domHandlers_[H]),m[H]&&Y(o,m[H],E._domHandlers_[H]),E},P.prototype.unbindEvt=function(o,H){var E=this;return E._domHandlers_=E._domHandlers_||{},y(o,n[H],E._domHandlers_[H]),m[H]&&y(o,m[H],E._domHandlers_[H]),delete E._domHandlers_[H],this};const b=P;function e(o,H){return this.identifier=H.identifier,this.position=H.position,this.frontPosition=H.frontPosition,this.collection=o,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(H),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=e.id,e.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}e.prototype=new b,e.constructor=e,e.id=0,e.prototype.buildEl=function(o){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},e.prototype.stylize=function(){if(this.options.dataOnly)return this;var o=this.options.fadeTime+"ms",H=function(){var o=l("borderRadius");for(var H in o)o.hasOwnProperty(H)&&(o[H]="50%");return o}(),n=A("transition","opacity",o),E={};return E.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},E.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},E.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},x(E.el,n),"circle"===this.options.shape&&x(E.back,H),x(E.front,H),this.applyStyles(E),this},e.prototype.applyStyles=function(o){for(var H in this.ui)if(this.ui.hasOwnProperty(H))for(var n in o[H])this.ui[H].style[n]=o[H][n];return this},e.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},e.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},e.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},e.prototype.show=function(o){var H=this;return H.options.dataOnly||(clearTimeout(H.removeTimeout),clearTimeout(H.showTimeout),clearTimeout(H.restTimeout),H.addToDom(),H.restCallback(),setTimeout((function(){H.ui.el.style.opacity=1}),0),H.showTimeout=setTimeout((function(){H.trigger("shown",H.instance),"function"==typeof o&&o.call(this)}),H.options.fadeTime)),H},e.prototype.hide=function(o){var H=this;if(H.options.dataOnly)return H;if(H.ui.el.style.opacity=H.options.restOpacity,clearTimeout(H.removeTimeout),clearTimeout(H.showTimeout),clearTimeout(H.restTimeout),H.removeTimeout=setTimeout((function(){var n="dynamic"===H.options.mode?"none":"block";H.ui.el.style.display=n,"function"==typeof o&&o.call(H),H.trigger("hidden",H.instance)}),H.options.fadeTime),H.options.restJoystick){var n=H.options.restJoystick,E={};E.x=!0===n||!1!==n.x?0:H.instance.frontPosition.x,E.y=!0===n||!1!==n.y?0:H.instance.frontPosition.y,H.setPosition(o,E)}return H},e.prototype.setPosition=function(o,H){var n=this;n.frontPosition={x:H.x,y:H.y};var E=n.options.fadeTime+"ms",k={};k.front=A("transition",["transform"],E);var g={front:{}};g.front={transform:"translate("+n.frontPosition.x+"px,"+n.frontPosition.y+"px)"},n.applyStyles(k),n.applyStyles(g),n.restTimeout=setTimeout((function(){"function"==typeof o&&o.call(n),n.restCallback()}),n.options.fadeTime)},e.prototype.restCallback=function(){var o=this,H={};H.front=A("transition","none",""),o.applyStyles(H),o.trigger("rested",o.instance)},e.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},e.prototype.computeDirection=function(o){var H,n,E,k=o.angle.radian,g=Math.PI/4,O=Math.PI/2;if(k>g&&k<3*g&&!o.lockX?H="up":k>-g&&k<=g&&!o.lockY?H="left":k>3*-g&&k<=-g&&!o.lockX?H="down":o.lockY||(H="right"),o.lockY||(n=k>-O&&k<O?"left":"right"),o.lockX||(E=k>0?"up":"down"),o.force>this.options.threshold){var Y,y={};for(Y in this.direction)this.direction.hasOwnProperty(Y)&&(y[Y]=this.direction[Y]);var S={};for(Y in this.direction={x:n,y:E,angle:H},o.direction=this.direction,y)y[Y]===this.direction[Y]&&(S[Y]=!0);if(S.x&&S.y&&S.angle)return o;S.x&&S.y||this.trigger("plain",o),S.x||this.trigger("plain:"+n,o),S.y||this.trigger("plain:"+E,o),S.angle||this.trigger("dir dir:"+H,o)}else this.resetDirection();return o};const Z=e;function M(o,H){var n=this;n.nipples=[],n.idles=[],n.actives=[],n.ids=[],n.pressureIntervals={},n.manager=o,n.id=M.id,M.id+=1,n.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},n.config(H),"static"!==n.options.mode&&"semi"!==n.options.mode||(n.options.multitouch=!1),n.options.multitouch||(n.options.maxNumberOfNipples=1);var E=getComputedStyle(n.options.zone.parentElement);return E&&"flex"===E.display&&(n.parentIsFlex=!0),n.updateBox(),n.prepareNipples(),n.KA(),n.begin(),n.nipples}M.prototype=new b,M.constructor=M,M.id=0,M.prototype.prepareNipples=function(){var o=this,H=o.nipples;H.on=o.on.bind(o),H.off=o.off.bind(o),H.options=o.options,H.destroy=o.destroy.bind(o),H.ids=o.ids,H.id=o.id,H.processOnMove=o.processOnMove.bind(o),H.processOnEnd=o.processOnEnd.bind(o),H.get=function(o){if(void 0===o)return H[0];for(var n=0,E=H.length;n<E;n+=1)if(H[n].identifier===o)return H[n];return!1}},M.prototype.KA=function(){var o=this;o.bindEvt(o.options.zone,"start"),o.options.zone.style.touchAction="none",o.options.zone.style.msTouchAction="none"},M.prototype.begin=function(){var o=this,H=o.options;if("static"===H.mode){var n=o.createNipple(H.position,o.manager.getIdentifier());n.add(),o.idles.push(n)}},M.prototype.createNipple=function(o,H){var n=this,E=n.manager.scroll,k={},g=n.options,O=n.parentIsFlex?E.x:E.x+n.box.left,Y=n.parentIsFlex?E.y:E.y+n.box.top;if(o.x&&o.y)k={x:o.x-O,y:o.y-Y};else if(o.top||o.right||o.bottom||o.left){var y=document.createElement("DIV");y.style.display="hidden",y.style.top=o.top,y.style.right=o.right,y.style.bottom=o.bottom,y.style.left=o.left,y.style.position="absolute",g.zone.appendChild(y);var S=y.getBoundingClientRect();g.zone.removeChild(y),k=o,o={x:S.left+E.x,y:S.top+E.y}}var G=new Z(n,{color:g.color,size:g.size,threshold:g.threshold,fadeTime:g.fadeTime,dataOnly:g.dataOnly,restJoystick:g.restJoystick,restOpacity:g.restOpacity,mode:g.mode,identifier:H,position:o,zone:g.zone,frontPosition:{x:0,y:0},shape:g.shape});return g.dataOnly||(c(G.ui.el,k),c(G.ui.front,G.frontPosition)),n.nipples.push(G),n.trigger("added "+G.identifier+":added",G),n.manager.trigger("added "+G.identifier+":added",G),n.bindNipple(G),G},M.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},M.prototype.bindNipple=function(o){var H,n=this,E=function(o,E){H=o.type+" "+E.id+":"+o.type,n.trigger(H,E)};o.on("destroyed",n.onDestroyed.bind(n)),o.on("shown hidden rested dir plain",E),o.on("dir:up dir:right dir:down dir:left",E),o.on("plain:up plain:right plain:down plain:left",E)},M.prototype.pressureFn=function(o,H,n){var E=this,k=0;clearInterval(E.pressureIntervals[n]),E.pressureIntervals[n]=setInterval(function(){var n=o.force||o.pressure||o.webkitForce||0;n!==k&&(H.trigger("pressure",n),E.trigger("pressure "+H.identifier+":pressure",n),k=n)}.bind(E),100)},M.prototype.onstart=function(o){var H=this,n=H.options,E=o;return o=S(o),H.updateBox(),z(o,(function(k){H.actives.length<n.maxNumberOfNipples?H.processOnStart(k):E.type.match(/^touch/)&&(Object.keys(H.manager.ids).forEach((function(n){if(Object.values(E.touches).findIndex((function(o){return o.identifier===n}))<0){var k=[o[0]];k.identifier=n,H.processOnEnd(k)}})),H.actives.length<n.maxNumberOfNipples&&H.processOnStart(k))})),H.manager.bindDocument(),!1},M.prototype.processOnStart=function(o){var H,n=this,k=n.options,g=n.manager.getIdentifier(o),O=o.force||o.pressure||o.webkitForce||0,Y={x:o.pageX,y:o.pageY},y=n.getOrCreate(g,Y);y.identifier!==g&&n.manager.removeIdentifier(y.identifier),y.identifier=g;var S=function(H){H.trigger("start",H),n.trigger("start "+H.id+":start",H),H.show(),O>0&&n.pressureFn(o,H,H.identifier),n.processOnMove(o)};if((H=n.idles.indexOf(y))>=0&&n.idles.splice(H,1),n.actives.push(y),n.ids.push(y.identifier),"semi"!==k.mode)S(y);else{if(!(E(Y,y.position)<=k.catchDistance))return y.destroy(),void n.processOnStart(o);S(y)}return y},M.prototype.getOrCreate=function(o,H){var n,E=this,k=E.options;return/(semi|static)/.test(k.mode)?(n=E.idles[0])?(E.idles.splice(0,1),n):"semi"===k.mode?E.createNipple(H,o):(console.warn("Coudln't find the needed nipple."),!1):n=E.createNipple(H,o)},M.prototype.processOnMove=function(o){var H=this,n=H.options,g=H.manager.getIdentifier(o),O=H.nipples.get(g),Y=H.manager.scroll;if(function(o){return isNaN(o.buttons)?0!==o.pressure:0!==o.buttons}(o)){if(!O)return console.error("Found zombie joystick with ID "+g),void H.manager.removeIdentifier(g);if(n.dynamicPage){var y=O.el.getBoundingClientRect();O.position={x:Y.x+y.left,y:Y.y+y.top}}O.identifier=g;var S=O.options.size/2,G={x:o.pageX,y:o.pageY};n.lockX&&(G.y=O.position.y),n.lockY&&(G.x=O.position.x);var c,A,l,x,z,V,J,N,h,Q,p=E(G,O.position),j=(c=G,l=(A=O.position).x-c.x,x=A.y-c.y,function(o){return o*(180/Math.PI)}(Math.atan2(x,l))),m=k(j),P=p/S,b={distance:p,position:G};if("circle"===O.options.shape?(z=Math.min(p,S),J=O.position,N=z,Q={x:0,y:0},h=k(h=j),Q.x=J.x-N*Math.cos(h),Q.y=J.y-N*Math.sin(h),V=Q):(V=function(o,H,n){return{x:Math.min(Math.max(o.x,H.x-n),H.x+n),y:Math.min(Math.max(o.y,H.y-n),H.y+n)}}(G,O.position,S),z=E(V,O.position)),n.follow){if(p>S){var e=G.x-V.x,Z=G.y-V.y;O.position.x+=e,O.position.y+=Z,O.el.style.top=O.position.y-(H.box.top+Y.y)+"px",O.el.style.left=O.position.x-(H.box.left+Y.x)+"px",p=E(G,O.position)}}else G=V,p=z;var M=G.x-O.position.x,K=G.y-O.position.y;O.frontPosition={x:M,y:K},n.dataOnly||(O.ui.front.style.transform="translate("+M+"px,"+K+"px)");var f={identifier:O.identifier,position:G,force:P,pressure:o.force||o.pressure||o.webkitForce||0,distance:p,angle:{radian:m,degree:j},vector:{x:M/S,y:-K/S},raw:b,instance:O,lockX:n.lockX,lockY:n.lockY};(f=O.computeDirection(f)).angle={radian:k(180-j),degree:180-j},O.trigger("move",f),H.trigger("move "+O.id+":move",f)}else this.processOnEnd(o)},M.prototype.processOnEnd=function(o){var H=this,n=H.options,E=H.manager.getIdentifier(o),k=H.nipples.get(E),g=H.manager.removeIdentifier(k.identifier);k&&(n.dataOnly||k.hide((function(){"dynamic"===n.mode&&(k.trigger("removed",k),H.trigger("removed "+k.id+":removed",k),H.manager.trigger("removed "+k.id+":removed",k),k.destroy())})),clearInterval(H.pressureIntervals[k.identifier]),k.resetDirection(),k.trigger("end",k),H.trigger("end "+k.id+":end",k),H.ids.indexOf(k.identifier)>=0&&H.ids.splice(H.ids.indexOf(k.identifier),1),H.actives.indexOf(k)>=0&&H.actives.splice(H.actives.indexOf(k),1),/(semi|static)/.test(n.mode)?H.idles.push(k):H.nipples.indexOf(k)>=0&&H.nipples.splice(H.nipples.indexOf(k),1),H.manager.unbindDocument(),/(semi|static)/.test(n.mode)&&(H.manager.ids[g.id]=g.identifier))},M.prototype.onDestroyed=function(o,H){var n=this;n.nipples.indexOf(H)>=0&&n.nipples.splice(n.nipples.indexOf(H),1),n.actives.indexOf(H)>=0&&n.actives.splice(n.actives.indexOf(H),1),n.idles.indexOf(H)>=0&&n.idles.splice(n.idles.indexOf(H),1),n.ids.indexOf(H.identifier)>=0&&n.ids.splice(n.ids.indexOf(H.identifier),1),n.manager.removeIdentifier(H.identifier),n.manager.unbindDocument()},M.prototype.destroy=function(){var o=this;for(var H in o.unbindEvt(o.options.zone,"start"),o.nipples.forEach((function(o){o.destroy()})),o.pressureIntervals)o.pressureIntervals.hasOwnProperty(H)&&clearInterval(o.pressureIntervals[H]);o.trigger("destroyed",o.nipples),o.manager.unbindDocument(),o.off()};const K=M;function f(o){var H=this;H.ids={},H.index=0,H.collections=[],H.scroll=G(),H.config(o),H.prepareCollections();var n=function(){var o;H.collections.forEach((function(n){n.forEach((function(n){o=n.el.getBoundingClientRect(),n.position={x:H.scroll.x+o.left,y:H.scroll.y+o.top}}))}))};Y(window,"resize",(function(){O(n)}));var E=function(){H.scroll=G()};return Y(window,"scroll",(function(){O(E)})),H.collections}f.prototype=new b,f.constructor=f,f.prototype.prepareCollections=function(){var o=this;o.collections.create=o.create.bind(o),o.collections.on=o.on.bind(o),o.collections.off=o.off.bind(o),o.collections.destroy=o.destroy.bind(o),o.collections.get=function(H){var n;return o.collections.every((function(o){return!(n=o.get(H))})),n}},f.prototype.create=function(o){return this.createCollection(o)},f.prototype.createCollection=function(o){var H=this,n=new K(H,o);return H.bindCollection(n),H.collections.push(n),n},f.prototype.bindCollection=function(o){var H,n=this,E=function(o,E){H=o.type+" "+E.id+":"+o.type,n.trigger(H,E)};o.on("destroyed",n.onDestroyed.bind(n)),o.on("shown hidden rested dir plain",E),o.on("dir:up dir:right dir:down dir:left",E),o.on("plain:up plain:right plain:down plain:left",E)},f.prototype.bindDocument=function(){var o=this;o.binded||(o.bindEvt(document,"move").bindEvt(document,"end"),o.binded=!0)},f.prototype.unbindDocument=function(o){var H=this;Object.keys(H.ids).length&&!0!==o||(H.unbindEvt(document,"move").unbindEvt(document,"end"),H.binded=!1)},f.prototype.getIdentifier=function(o){var H;return o?void 0===(H=void 0===o.identifier?o.pointerId:o.identifier)&&(H=this.latest||0):H=this.index,void 0===this.ids[H]&&(this.ids[H]=this.index,this.index+=1),this.latest=H,this.ids[H]},f.prototype.removeIdentifier=function(o){var H={};for(var n in this.ids)if(this.ids[n]===o){H.id=n,H.identifier=this.ids[n],delete this.ids[n];break}return H},f.prototype.onmove=function(o){return this.onAny("move",o),!1},f.prototype.onend=function(o){return this.onAny("end",o),!1},f.prototype.oncancel=function(o){return this.onAny("end",o),!1},f.prototype.onAny=function(o,H){var n,E=this,k="processOn"+o.charAt(0).toUpperCase()+o.slice(1);H=S(H);var g=function(o,H,n){n.ids.indexOf(H)>=0&&(n[k](o),o._found_=!0)};return z(H,(function(o){n=E.getIdentifier(o),z(E.collections,g.bind(null,o,n)),o._found_||E.removeIdentifier(n)})),!1},f.prototype.destroy=function(){var o=this;o.unbindDocument(!0),o.ids={},o.index=0,o.collections.forEach((function(o){o.destroy()})),o.off()},f.prototype.onDestroyed=function(o,H){var n=this;if(n.collections.indexOf(H)<0)return!1;n.collections.splice(n.collections.indexOf(H),1)};var B=new f;const q={create:function(o){return B.create(o)},factory:B};return H.default})(),o.exports=H()},12333:(o,H,n)=>{"use strict";const{Deflate:E,deflate:k,deflateRaw:g,gzip:O}=n(12341),{Inflate:Y,inflate:y,inflateRaw:S,ungzip:G}=n(12397),c=n(12375);o.exports.Deflate=E,o.exports.deflate=k,o.exports.deflateRaw=g,o.exports.gzip=O,o.exports.Inflate=Y,o.exports.inflate=y,o.exports.inflateRaw=S,o.exports.ungzip=G,o.exports.constants=c},12341:(o,H,n)=>{"use strict";const E=n(12344),k=n(12379),g=n(12388),O=n(12368),Y=n(12391),y=Object.prototype.toString,{Z_NO_FLUSH:S,Z_SYNC_FLUSH:G,Z_FULL_FLUSH:c,Z_FINISH:A,Z_OK:l,Z_STREAM_END:x,Z_DEFAULT_COMPRESSION:z,Z_DEFAULT_STRATEGY:V,Z_DEFLATED:J}=n(12375);function N(o){this.options=k.assign({level:z,method:J,so:16384,windowBits:15,memLevel:8,strategy:V},o||{});let H=this.options;H.raw&&H.windowBits>0?H.windowBits=-H.windowBits:H.gzip&&H.windowBits>0&&H.windowBits<16&&(H.windowBits+=16),this.err=0,this.SH="",this.ended=!1,this.chunks=[],this.strm=new Y,this.strm.avail_out=0;let n=E.deflateInit2(this.strm,H.level,H.method,H.windowBits,H.memLevel,H.strategy);if(n!==l)throw new Error(O[n]);if(H.header&&E.deflateSetHeader(this.strm,H.header),H.dictionary){let o;if(o="string"===typeof H.dictionary?g.string2buf(H.dictionary):"[object ArrayBuffer]"===y.call(H.dictionary)?new Uint8Array(H.dictionary):H.dictionary,n=E.deflateSetDictionary(this.strm,o),n!==l)throw new Error(O[n]);this._dict_set=!0}}function h(o,H){const n=new N(H);if(n.push(o,!0),n.err)throw n.SH||O[n.err];return n.result}N.prototype.push=function(o,H){const n=this.strm,k=this.options.so;let O,Y;if(this.ended)return!1;for(Y=H===~~H?H:!0===H?A:S,"string"===typeof o?n.input=g.string2buf(o):"[object ArrayBuffer]"===y.call(o)?n.input=new Uint8Array(o):n.input=o,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(k),n.next_out=0,n.avail_out=k),(Y===G||Y===c)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(O=E.deflate(n,Y),O===x)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),O=E.deflateEnd(this.strm),this.onEnd(O),this.ended=!0,O===l;if(0!==n.avail_out){if(Y>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},N.prototype.onData=function(o){this.chunks.push(o)},N.prototype.onEnd=function(o){o===l&&(this.result=k.flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.SH=this.strm.SH},o.exports.Deflate=N,o.exports.deflate=h,o.exports.deflateRaw=function(o,H){return(H=H||{}).raw=!0,h(o,H)},o.exports.gzip=function(o,H){return(H=H||{}).gzip=!0,h(o,H)},o.exports.constants=n(12375)},12397:(o,H,n)=>{"use strict";const E=n(12402),k=n(12379),g=n(12388),O=n(12368),Y=n(12391),y=n(12422),S=Object.prototype.toString,{Z_NO_FLUSH:G,Z_FINISH:c,Z_OK:A,Z_STREAM_END:l,Z_NEED_DICT:x,Z_STREAM_ERROR:z,Z_DATA_ERROR:V,Z_MEM_ERROR:J}=n(12375);function N(o){this.options=k.assign({so:65536,windowBits:15,to:""},o||{});const H=this.options;H.raw&&H.windowBits>=0&&H.windowBits<16&&(H.windowBits=-H.windowBits,0===H.windowBits&&(H.windowBits=-15)),!(H.windowBits>=0&&H.windowBits<16)||o&&o.windowBits||(H.windowBits+=32),H.windowBits>15&&H.windowBits<48&&0===(15&H.windowBits)&&(H.windowBits|=15),this.err=0,this.SH="",this.ended=!1,this.chunks=[],this.strm=new Y,this.strm.avail_out=0;let n=E.inflateInit2(this.strm,H.windowBits);if(n!==A)throw new Error(O[n]);if(this.header=new y,E.inflateGetHeader(this.strm,this.header),H.dictionary&&("string"===typeof H.dictionary?H.dictionary=g.string2buf(H.dictionary):"[object ArrayBuffer]"===S.call(H.dictionary)&&(H.dictionary=new Uint8Array(H.dictionary)),H.raw&&(n=E.inflateSetDictionary(this.strm,H.dictionary),n!==A)))throw new Error(O[n])}function h(o,H){const n=new N(H);if(n.push(o),n.err)throw n.SH||O[n.err];return n.result}N.prototype.push=function(o,H){const n=this.strm,k=this.options.so,O=this.options.dictionary;let Y,y,N;if(this.ended)return!1;for(y=H===~~H?H:!0===H?c:G,"[object ArrayBuffer]"===S.call(o)?n.input=new Uint8Array(o):n.input=o,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(k),n.next_out=0,n.avail_out=k),Y=E.inflate(n,y),Y===x&&O&&(Y=E.inflateSetDictionary(n,O),Y===A?Y=E.inflate(n,y):Y===V&&(Y=x));n.avail_in>0&&Y===l&&n.state.wrap>0&&0!==o[n.next_in];)E.inflateReset(n),Y=E.inflate(n,y);switch(Y){case z:case V:case x:case J:return this.onEnd(Y),this.ended=!0,!1}if(N=n.avail_out,n.next_out&&(0===n.avail_out||Y===l))if("string"===this.options.to){let o=g.utf8border(n.output,n.next_out),H=n.next_out-o,E=g.buf2string(n.output,o);n.next_out=H,n.avail_out=k-H,H&&n.output.set(n.output.subarray(o,o+H),0),this.onData(E)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(Y!==A||0!==N){if(Y===l)return Y=E.inflateEnd(this.strm),this.onEnd(Y),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},N.prototype.onData=function(o){this.chunks.push(o)},N.prototype.onEnd=function(o){o===A&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=k.flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.SH=this.strm.SH},o.exports.Inflate=N,o.exports.inflate=h,o.exports.inflateRaw=function(o,H){return(H=H||{}).raw=!0,h(o,H)},o.exports.ungzip=h,o.exports.constants=n(12375)},12379:o=>{"use strict";const H=(o,H)=>Object.prototype.hasOwnProperty.call(o,H);o.exports.assign=function(o){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const E=n.shift();if(E){if("object"!==typeof E)throw new TypeError(E+"must be non-object");for(const n in E)H(E,n)&&(o[n]=E[n])}}return o},o.exports.flattenChunks=o=>{let H=0;for(let E=0,k=o.length;E<k;E++)H+=o[E].length;const n=new Uint8Array(H);for(let E=0,k=0,g=o.length;E<g;E++){let H=o[E];n.set(H,k),k+=H.length}return n}},12388:o=>{"use strict";let H=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(E){H=!1}const n=new Uint8Array(256);for(let k=0;k<256;k++)n[k]=k>=252?6:k>=248?5:k>=240?4:k>=224?3:k>=192?2:1;n[254]=n[254]=1,o.exports.string2buf=o=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(o);let H,n,E,k,g,O=o.length,Y=0;for(k=0;k<O;k++)n=o.charCodeAt(k),55296===(64512&n)&&k+1<O&&(E=o.charCodeAt(k+1),56320===(64512&E)&&(n=65536+(n-55296<<10)+(E-56320),k++)),Y+=n<128?1:n<2048?2:n<65536?3:4;for(H=new Uint8Array(Y),g=0,k=0;g<Y;k++)n=o.charCodeAt(k),55296===(64512&n)&&k+1<O&&(E=o.charCodeAt(k+1),56320===(64512&E)&&(n=65536+(n-55296<<10)+(E-56320),k++)),n<128?H[g++]=n:n<2048?(H[g++]=192|n>>>6,H[g++]=128|63&n):n<65536?(H[g++]=224|n>>>12,H[g++]=128|n>>>6&63,H[g++]=128|63&n):(H[g++]=240|n>>>18,H[g++]=128|n>>>12&63,H[g++]=128|n>>>6&63,H[g++]=128|63&n);return H};o.exports.buf2string=(o,E)=>{const k=E||o.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(o.subarray(0,E));let g,O;const Y=new Array(2*k);for(O=0,g=0;g<k;){let H=o[g++];if(H<128){Y[O++]=H;continue}let E=n[H];if(E>4)Y[O++]=65533,g+=E-1;else{for(H&=2===E?31:3===E?15:7;E>1&&g<k;)H=H<<6|63&o[g++],E--;E>1?Y[O++]=65533:H<65536?Y[O++]=H:(H-=65536,Y[O++]=55296|H>>10&1023,Y[O++]=56320|1023&H)}}return((o,n)=>{if(n<65534&&o.subarray&&H)return String.fromCharCode.apply(null,o.length===n?o:o.subarray(0,n));let E="";for(let H=0;H<n;H++)E+=String.fromCharCode(o[H]);return E})(Y,O)},o.exports.utf8border=(o,H)=>{(H=H||o.length)>o.length&&(H=o.length);let E=H-1;for(;E>=0&&128===(192&o[E]);)E--;return E<0||0===E?H:E+n[o[E]]>H?E:H}},12358:o=>{"use strict";o.exports=(o,H,n,E)=>{let k=65535&o,g=o>>>16&65535,O=0;for(;0!==n;){O=n>2e3?2e3:n,n-=O;do{k=k+H[E++]|0,g=g+k|0}while(--O);k%=65521,g%=65521}return k|g<<16}},12375:o=>{"use strict";o.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12360:o=>{"use strict";const H=new Uint32Array((()=>{let o,H=[];for(var n=0;n<256;n++){o=n;for(var E=0;E<8;E++)o=1&o?3988292384^o>>>1:o>>>1;H[n]=o}return H})());o.exports=(o,n,E,k)=>{const g=H,O=k+E;o^=-1;for(let H=k;H<O;H++)o=o>>>8^g[255&(o^n[H])];return~o}},12344:(o,H,n)=>{"use strict";const{_tr_init:E,_tr_stored_block:k,_tr_flush_block:g,_tr_tally:O,_tr_align:Y}=n(12351),y=n(12358),S=n(12360),G=n(12368),{Z_NO_FLUSH:c,Z_PARTIAL_FLUSH:A,Z_FULL_FLUSH:l,Z_FINISH:x,Z_BLOCK:z,Z_OK:V,Z_STREAM_END:J,Z_STREAM_ERROR:N,Z_DATA_ERROR:h,Z_BUF_ERROR:Q,Z_DEFAULT_COMPRESSION:p,Z_FILTERED:j,Z_HUFFMAN_ONLY:m,Z_RLE:P,Z_FIXED:b,Z_DEFAULT_STRATEGY:e,Z_UNKNOWN:Z,Z_DEFLATED:M}=n(12375),K=258,f=262,B=103,q=113,D=666,T=(o,H)=>(o.SH=G[H],H),a=o=>(o<<1)-(o>4?9:0),F=o=>{let H=o.length;for(;--H>=0;)o[H]=0};let C=(o,H,n)=>(H<<o.hash_shift^n)&o.hash_mask;const t=o=>{const H=o.state;let n=H.pending;n>o.avail_out&&(n=o.avail_out),0!==n&&(o.output.set(H.pending_buf.subarray(H.pending_out,H.pending_out+n),o.next_out),o.next_out+=n,H.pending_out+=n,o.total_out+=n,o.avail_out-=n,H.pending-=n,0===H.pending&&(H.pending_out=0))},X=(o,H)=>{g(o,o.block_start>=0?o.block_start:-1,o.strstart-o.block_start,H),o.block_start=o.strstart,t(o.strm)},s=(o,H)=>{o.pending_buf[o.pending++]=H},U=(o,H)=>{o.pending_buf[o.pending++]=H>>>8&255,o.pending_buf[o.pending++]=255&H},I=(o,H,n,E)=>{let k=o.avail_in;return k>E&&(k=E),0===k?0:(o.avail_in-=k,H.set(o.input.subarray(o.next_in,o.next_in+k),n),1===o.state.wrap?o.adler=y(o.adler,H,k,n):2===o.state.wrap&&(o.adler=S(o.adler,H,k,n)),o.next_in+=k,o.total_in+=k,k)},v=(o,H)=>{let n,E,k=o.max_chain_length,g=o.strstart,O=o.prev_length,Y=o.nice_match;const y=o.strstart>o.w_size-f?o.strstart-(o.w_size-f):0,S=o.window,G=o.w_mask,c=o.prev,A=o.strstart+K;let l=S[g+O-1],x=S[g+O];o.prev_length>=o.good_match&&(k>>=2),Y>o.lookahead&&(Y=o.lookahead);do{if(n=H,S[n+O]===x&&S[n+O-1]===l&&S[n]===S[g]&&S[++n]===S[g+1]){g+=2,n++;do{}while(S[++g]===S[++n]&&S[++g]===S[++n]&&S[++g]===S[++n]&&S[++g]===S[++n]&&S[++g]===S[++n]&&S[++g]===S[++n]&&S[++g]===S[++n]&&S[++g]===S[++n]&&g<A);if(E=K-(A-g),g=A-K,E>O){if(o.match_start=H,O=E,E>=Y)break;l=S[g+O-1],x=S[g+O]}}}while((H=c[H&G])>y&&0!==--k);return O<=o.lookahead?O:o.lookahead},w=o=>{const H=o.w_size;let n,E,k,g,O;do{if(g=o.window_size-o.lookahead-o.strstart,o.strstart>=H+(H-f)){o.window.set(o.window.subarray(H,H+H),0),o.match_start-=H,o.strstart-=H,o.block_start-=H,E=o.hash_size,n=E;do{k=o.head[--n],o.head[n]=k>=H?k-H:0}while(--E);E=H,n=E;do{k=o.prev[--n],o.prev[n]=k>=H?k-H:0}while(--E);g+=H}if(0===o.strm.avail_in)break;if(E=I(o.strm,o.window,o.strstart+o.lookahead,g),o.lookahead+=E,o.lookahead+o.insert>=3)for(O=o.strstart-o.insert,o.ins_h=o.window[O],o.ins_h=C(o,o.ins_h,o.window[O+1]);o.insert&&(o.ins_h=C(o,o.ins_h,o.window[O+3-1]),o.prev[O&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=O,O++,o.insert--,!(o.lookahead+o.insert<3)););}while(o.lookahead<f&&0!==o.strm.avail_in)},r=(o,H)=>{let n,E;for(;;){if(o.lookahead<f){if(w(o),o.lookahead<f&&H===c)return 1;if(0===o.lookahead)break}if(n=0,o.lookahead>=3&&(o.ins_h=C(o,o.ins_h,o.window[o.strstart+3-1]),n=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),0!==n&&o.strstart-n<=o.w_size-f&&(o.match_length=v(o,n)),o.match_length>=3)if(E=O(o,o.strstart-o.match_start,o.match_length-3),o.lookahead-=o.match_length,o.match_length<=o.max_lazy_match&&o.lookahead>=3){o.match_length--;do{o.strstart++,o.ins_h=C(o,o.ins_h,o.window[o.strstart+3-1]),n=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart}while(0!==--o.match_length);o.strstart++}else o.strstart+=o.match_length,o.match_length=0,o.ins_h=o.window[o.strstart],o.ins_h=C(o,o.ins_h,o.window[o.strstart+1]);else E=O(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++;if(E&&(X(o,!1),0===o.strm.avail_out))return 1}return o.insert=o.strstart<2?o.strstart:2,H===x?(X(o,!0),0===o.strm.avail_out?3:4):o.last_lit&&(X(o,!1),0===o.strm.avail_out)?1:2},u=(o,H)=>{let n,E,k;for(;;){if(o.lookahead<f){if(w(o),o.lookahead<f&&H===c)return 1;if(0===o.lookahead)break}if(n=0,o.lookahead>=3&&(o.ins_h=C(o,o.ins_h,o.window[o.strstart+3-1]),n=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),o.prev_length=o.match_length,o.prev_match=o.match_start,o.match_length=2,0!==n&&o.prev_length<o.max_lazy_match&&o.strstart-n<=o.w_size-f&&(o.match_length=v(o,n),o.match_length<=5&&(o.strategy===j||3===o.match_length&&o.strstart-o.match_start>4096)&&(o.match_length=2)),o.prev_length>=3&&o.match_length<=o.prev_length){k=o.strstart+o.lookahead-3,E=O(o,o.strstart-1-o.prev_match,o.prev_length-3),o.lookahead-=o.prev_length-1,o.prev_length-=2;do{++o.strstart<=k&&(o.ins_h=C(o,o.ins_h,o.window[o.strstart+3-1]),n=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart)}while(0!==--o.prev_length);if(o.match_available=0,o.match_length=2,o.strstart++,E&&(X(o,!1),0===o.strm.avail_out))return 1}else if(o.match_available){if(E=O(o,0,o.window[o.strstart-1]),E&&X(o,!1),o.strstart++,o.lookahead--,0===o.strm.avail_out)return 1}else o.match_available=1,o.strstart++,o.lookahead--}return o.match_available&&(E=O(o,0,o.window[o.strstart-1]),o.match_available=0),o.insert=o.strstart<2?o.strstart:2,H===x?(X(o,!0),0===o.strm.avail_out?3:4):o.last_lit&&(X(o,!1),0===o.strm.avail_out)?1:2};function d(o,H,n,E,k){this.good_length=o,this.max_lazy=H,this.nice_length=n,this.max_chain=E,this.func=k}const R=[new d(0,0,0,0,((o,H)=>{let n=65535;for(n>o.pending_buf_size-5&&(n=o.pending_buf_size-5);;){if(o.lookahead<=1){if(w(o),0===o.lookahead&&H===c)return 1;if(0===o.lookahead)break}o.strstart+=o.lookahead,o.lookahead=0;const E=o.block_start+n;if((0===o.strstart||o.strstart>=E)&&(o.lookahead=o.strstart-E,o.strstart=E,X(o,!1),0===o.strm.avail_out))return 1;if(o.strstart-o.block_start>=o.w_size-f&&(X(o,!1),0===o.strm.avail_out))return 1}return o.insert=0,H===x?(X(o,!0),0===o.strm.avail_out?3:4):(o.strstart>o.block_start&&(X(o,!1),o.strm.avail_out),1)})),new d(4,4,8,4,r),new d(4,5,16,8,r),new d(4,6,32,32,r),new d(4,4,16,16,u),new d(8,16,32,32,u),new d(8,16,128,128,u),new d(8,32,128,256,u),new d(32,128,258,1024,u),new d(32,258,258,4096,u)];function W(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=M,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),F(this.dyn_ltree),F(this.dyn_dtree),F(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),F(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),F(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const i=o=>{if(!o||!o.state)return T(o,N);o.total_in=o.total_out=0,o.data_type=Z;const H=o.state;return H.pending=0,H.pending_out=0,H.wrap<0&&(H.wrap=-H.wrap),H.status=H.wrap?42:q,o.adler=2===H.wrap?0:1,H.last_flush=c,E(H),V},L=o=>{const H=i(o);var n;return H===V&&((n=o.state).window_size=2*n.w_size,F(n.head),n.max_lazy_match=R[n.level].max_lazy,n.good_match=R[n.level].good_length,n.nice_match=R[n.level].nice_length,n.max_chain_length=R[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),H},oo=(o,H,n,E,k,g)=>{if(!o)return N;let O=1;if(H===p&&(H=6),E<0?(O=0,E=-E):E>15&&(O=2,E-=16),k<1||k>9||n!==M||E<8||E>15||H<0||H>9||g<0||g>b)return T(o,N);8===E&&(E=9);const Y=new W;return o.state=Y,Y.strm=o,Y.wrap=O,Y.gzhead=null,Y.w_bits=E,Y.w_size=1<<Y.w_bits,Y.w_mask=Y.w_size-1,Y.hash_bits=k+7,Y.hash_size=1<<Y.hash_bits,Y.hash_mask=Y.hash_size-1,Y.hash_shift=~~((Y.hash_bits+3-1)/3),Y.window=new Uint8Array(2*Y.w_size),Y.head=new Uint16Array(Y.hash_size),Y.prev=new Uint16Array(Y.w_size),Y.lit_bufsize=1<<k+6,Y.pending_buf_size=4*Y.lit_bufsize,Y.pending_buf=new Uint8Array(Y.pending_buf_size),Y.d_buf=1*Y.lit_bufsize,Y.l_buf=3*Y.lit_bufsize,Y.level=H,Y.strategy=g,Y.method=n,L(o)};o.exports.deflateInit=(o,H)=>oo(o,H,M,15,8,e),o.exports.deflateInit2=oo,o.exports.deflateReset=L,o.exports.deflateResetKeep=i,o.exports.deflateSetHeader=(o,H)=>o&&o.state?2!==o.state.wrap?N:(o.state.gzhead=H,V):N,o.exports.deflate=(o,H)=>{let n,E;if(!o||!o.state||H>z||H<0)return o?T(o,N):N;const g=o.state;if(!o.output||!o.input&&0!==o.avail_in||g.status===D&&H!==x)return T(o,0===o.avail_out?Q:N);g.strm=o;const y=g.last_flush;if(g.last_flush=H,42===g.status)if(2===g.wrap)o.adler=0,s(g,31),s(g,139),s(g,8),g.gzhead?(s(g,(g.gzhead.text?1:0)+(g.gzhead.hcrc?2:0)+(g.gzhead.extra?4:0)+(g.gzhead.name?8:0)+(g.gzhead.comment?16:0)),s(g,255&g.gzhead.time),s(g,g.gzhead.time>>8&255),s(g,g.gzhead.time>>16&255),s(g,g.gzhead.time>>24&255),s(g,9===g.level?2:g.strategy>=m||g.level<2?4:0),s(g,255&g.gzhead.os),g.gzhead.extra&&g.gzhead.extra.length&&(s(g,255&g.gzhead.extra.length),s(g,g.gzhead.extra.length>>8&255)),g.gzhead.hcrc&&(o.adler=S(o.adler,g.pending_buf,g.pending,0)),g.gzindex=0,g.status=69):(s(g,0),s(g,0),s(g,0),s(g,0),s(g,0),s(g,9===g.level?2:g.strategy>=m||g.level<2?4:0),s(g,3),g.status=q);else{let H=M+(g.w_bits-8<<4)<<8,n=-1;n=g.strategy>=m||g.level<2?0:g.level<6?1:6===g.level?2:3,H|=n<<6,0!==g.strstart&&(H|=32),H+=31-H%31,g.status=q,U(g,H),0!==g.strstart&&(U(g,o.adler>>>16),U(g,65535&o.adler)),o.adler=1}if(69===g.status)if(g.gzhead.extra){for(n=g.pending;g.gzindex<(65535&g.gzhead.extra.length)&&(g.pending!==g.pending_buf_size||(g.gzhead.hcrc&&g.pending>n&&(o.adler=S(o.adler,g.pending_buf,g.pending-n,n)),t(o),n=g.pending,g.pending!==g.pending_buf_size));)s(g,255&g.gzhead.extra[g.gzindex]),g.gzindex++;g.gzhead.hcrc&&g.pending>n&&(o.adler=S(o.adler,g.pending_buf,g.pending-n,n)),g.gzindex===g.gzhead.extra.length&&(g.gzindex=0,g.status=73)}else g.status=73;if(73===g.status)if(g.gzhead.name){n=g.pending;do{if(g.pending===g.pending_buf_size&&(g.gzhead.hcrc&&g.pending>n&&(o.adler=S(o.adler,g.pending_buf,g.pending-n,n)),t(o),n=g.pending,g.pending===g.pending_buf_size)){E=1;break}E=g.gzindex<g.gzhead.name.length?255&g.gzhead.name.charCodeAt(g.gzindex++):0,s(g,E)}while(0!==E);g.gzhead.hcrc&&g.pending>n&&(o.adler=S(o.adler,g.pending_buf,g.pending-n,n)),0===E&&(g.gzindex=0,g.status=91)}else g.status=91;if(91===g.status)if(g.gzhead.comment){n=g.pending;do{if(g.pending===g.pending_buf_size&&(g.gzhead.hcrc&&g.pending>n&&(o.adler=S(o.adler,g.pending_buf,g.pending-n,n)),t(o),n=g.pending,g.pending===g.pending_buf_size)){E=1;break}E=g.gzindex<g.gzhead.comment.length?255&g.gzhead.comment.charCodeAt(g.gzindex++):0,s(g,E)}while(0!==E);g.gzhead.hcrc&&g.pending>n&&(o.adler=S(o.adler,g.pending_buf,g.pending-n,n)),0===E&&(g.status=B)}else g.status=B;if(g.status===B&&(g.gzhead.hcrc?(g.pending+2>g.pending_buf_size&&t(o),g.pending+2<=g.pending_buf_size&&(s(g,255&o.adler),s(g,o.adler>>8&255),o.adler=0,g.status=q)):g.status=q),0!==g.pending){if(t(o),0===o.avail_out)return g.last_flush=-1,V}else if(0===o.avail_in&&a(H)<=a(y)&&H!==x)return T(o,Q);if(g.status===D&&0!==o.avail_in)return T(o,Q);if(0!==o.avail_in||0!==g.lookahead||H!==c&&g.status!==D){let n=g.strategy===m?((o,H)=>{let n;for(;;){if(0===o.lookahead&&(w(o),0===o.lookahead)){if(H===c)return 1;break}if(o.match_length=0,n=O(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++,n&&(X(o,!1),0===o.strm.avail_out))return 1}return o.insert=0,H===x?(X(o,!0),0===o.strm.avail_out?3:4):o.last_lit&&(X(o,!1),0===o.strm.avail_out)?1:2})(g,H):g.strategy===P?((o,H)=>{let n,E,k,g;const Y=o.window;for(;;){if(o.lookahead<=K){if(w(o),o.lookahead<=K&&H===c)return 1;if(0===o.lookahead)break}if(o.match_length=0,o.lookahead>=3&&o.strstart>0&&(k=o.strstart-1,E=Y[k],E===Y[++k]&&E===Y[++k]&&E===Y[++k])){g=o.strstart+K;do{}while(E===Y[++k]&&E===Y[++k]&&E===Y[++k]&&E===Y[++k]&&E===Y[++k]&&E===Y[++k]&&E===Y[++k]&&E===Y[++k]&&k<g);o.match_length=K-(g-k),o.match_length>o.lookahead&&(o.match_length=o.lookahead)}if(o.match_length>=3?(n=O(o,1,o.match_length-3),o.lookahead-=o.match_length,o.strstart+=o.match_length,o.match_length=0):(n=O(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++),n&&(X(o,!1),0===o.strm.avail_out))return 1}return o.insert=0,H===x?(X(o,!0),0===o.strm.avail_out?3:4):o.last_lit&&(X(o,!1),0===o.strm.avail_out)?1:2})(g,H):R[g.level].func(g,H);if(3!==n&&4!==n||(g.status=D),1===n||3===n)return 0===o.avail_out&&(g.last_flush=-1),V;if(2===n&&(H===A?Y(g):H!==z&&(k(g,0,0,!1),H===l&&(F(g.head),0===g.lookahead&&(g.strstart=0,g.block_start=0,g.insert=0))),t(o),0===o.avail_out))return g.last_flush=-1,V}return H!==x?V:g.wrap<=0?J:(2===g.wrap?(s(g,255&o.adler),s(g,o.adler>>8&255),s(g,o.adler>>16&255),s(g,o.adler>>24&255),s(g,255&o.total_in),s(g,o.total_in>>8&255),s(g,o.total_in>>16&255),s(g,o.total_in>>24&255)):(U(g,o.adler>>>16),U(g,65535&o.adler)),t(o),g.wrap>0&&(g.wrap=-g.wrap),0!==g.pending?V:J)},o.exports.deflateEnd=o=>{if(!o||!o.state)return N;const H=o.state.status;return 42!==H&&69!==H&&73!==H&&91!==H&&H!==B&&H!==q&&H!==D?T(o,N):(o.state=null,H===q?T(o,h):V)},o.exports.deflateSetDictionary=(o,H)=>{let n=H.length;if(!o||!o.state)return N;const E=o.state,k=E.wrap;if(2===k||1===k&&42!==E.status||E.lookahead)return N;if(1===k&&(o.adler=y(o.adler,H,n,0)),E.wrap=0,n>=E.w_size){0===k&&(F(E.head),E.strstart=0,E.block_start=0,E.insert=0);let o=new Uint8Array(E.w_size);o.set(H.subarray(n-E.w_size,n),0),H=o,n=E.w_size}const g=o.avail_in,O=o.next_in,Y=o.input;for(o.avail_in=n,o.next_in=0,o.input=H,w(E);E.lookahead>=3;){let o=E.strstart,H=E.lookahead-2;do{E.ins_h=C(E,E.ins_h,E.window[o+3-1]),E.prev[o&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=o,o++}while(--H);E.strstart=o,E.lookahead=2,w(E)}return E.strstart+=E.lookahead,E.block_start=E.strstart,E.insert=E.lookahead,E.lookahead=0,E.match_length=E.prev_length=2,E.match_available=0,o.next_in=O,o.input=Y,o.avail_in=g,E.wrap=k,V},o.exports.deflateInfo="pako deflate (from Nodeca project)"},12422:o=>{"use strict";o.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12411:o=>{"use strict";o.exports=function(o,H){let n,E,k,g,O,Y,y,S,G,c,A,l,x,z,V,J,N,h,Q,p,j,m,P,b;const e=o.state;n=o.next_in,P=o.input,E=n+(o.avail_in-5),k=o.next_out,b=o.output,g=k-(H-o.avail_out),O=k+(o.avail_out-257),Y=e.dmax,y=e.wsize,S=e.whave,G=e.wnext,c=e.window,A=e.hold,l=e.bits,x=e.lencode,z=e.distcode,V=(1<<e.lenbits)-1,J=(1<<e.distbits)-1;o:do{l<15&&(A+=P[n++]<<l,l+=8,A+=P[n++]<<l,l+=8),N=x[A&V];H:for(;;){if(h=N>>>24,A>>>=h,l-=h,h=N>>>16&255,0===h)b[k++]=65535&N;else{if(!(16&h)){if(0===(64&h)){N=x[(65535&N)+(A&(1<<h)-1)];continue H}if(32&h){e.mode=12;break o}o.SH="invalid literal/length code",e.mode=30;break o}Q=65535&N,h&=15,h&&(l<h&&(A+=P[n++]<<l,l+=8),Q+=A&(1<<h)-1,A>>>=h,l-=h),l<15&&(A+=P[n++]<<l,l+=8,A+=P[n++]<<l,l+=8),N=z[A&J];n:for(;;){if(h=N>>>24,A>>>=h,l-=h,h=N>>>16&255,!(16&h)){if(0===(64&h)){N=z[(65535&N)+(A&(1<<h)-1)];continue n}o.SH="invalid distance code",e.mode=30;break o}if(p=65535&N,h&=15,l<h&&(A+=P[n++]<<l,l+=8,l<h&&(A+=P[n++]<<l,l+=8)),p+=A&(1<<h)-1,p>Y){o.SH="invalid distance too far back",e.mode=30;break o}if(A>>>=h,l-=h,h=k-g,p>h){if(h=p-h,h>S&&e.sane){o.SH="invalid distance too far back",e.mode=30;break o}if(j=0,m=c,0===G){if(j+=y-h,h<Q){Q-=h;do{b[k++]=c[j++]}while(--h);j=k-p,m=b}}else if(G<h){if(j+=y+G-h,h-=G,h<Q){Q-=h;do{b[k++]=c[j++]}while(--h);if(j=0,G<Q){h=G,Q-=h;do{b[k++]=c[j++]}while(--h);j=k-p,m=b}}}else if(j+=G-h,h<Q){Q-=h;do{b[k++]=c[j++]}while(--h);j=k-p,m=b}for(;Q>2;)b[k++]=m[j++],b[k++]=m[j++],b[k++]=m[j++],Q-=3;Q&&(b[k++]=m[j++],Q>1&&(b[k++]=m[j++]))}else{j=k-p;do{b[k++]=b[j++],b[k++]=b[j++],b[k++]=b[j++],Q-=3}while(Q>2);Q&&(b[k++]=b[j++],Q>1&&(b[k++]=b[j++]))}break}}break}}while(n<E&&k<O);Q=l>>3,n-=Q,l-=Q<<3,A&=(1<<l)-1,o.next_in=n,o.next_out=k,o.avail_in=n<E?E-n+5:5-(n-E),o.avail_out=k<O?O-k+257:257-(k-O),e.hold=A,e.bits=l}},12402:(o,H,n)=>{"use strict";const E=n(12358),k=n(12360),g=n(12411),O=n(12418),{Z_FINISH:Y,Z_BLOCK:y,Z_TREES:S,Z_OK:G,Z_STREAM_END:c,Z_NEED_DICT:A,Z_STREAM_ERROR:l,Z_DATA_ERROR:x,Z_MEM_ERROR:z,Z_BUF_ERROR:V,Z_DEFLATED:J}=n(12375),N=12,h=30,Q=o=>(o>>>24&255)+(o>>>8&65280)+((65280&o)<<8)+((255&o)<<24);function p(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const j=o=>{if(!o||!o.state)return l;const H=o.state;return o.total_in=o.total_out=H.total=0,o.SH="",H.wrap&&(o.adler=1&H.wrap),H.mode=1,H.last=0,H.havedict=0,H.dmax=32768,H.head=null,H.hold=0,H.bits=0,H.lencode=H.lendyn=new Int32Array(852),H.distcode=H.distdyn=new Int32Array(592),H.sane=1,H.back=-1,G},m=o=>{if(!o||!o.state)return l;const H=o.state;return H.wsize=0,H.whave=0,H.wnext=0,j(o)},P=(o,H)=>{let n;if(!o||!o.state)return l;const E=o.state;return H<0?(n=0,H=-H):(n=1+(H>>4),H<48&&(H&=15)),H&&(H<8||H>15)?l:(null!==E.window&&E.wbits!==H&&(E.window=null),E.wrap=n,E.wbits=H,m(o))},b=(o,H)=>{if(!o)return l;const n=new p;o.state=n,n.window=null;const E=P(o,H);return E!==G&&(o.state=null),E};let e,Z,M=!0;const K=o=>{if(M){e=new Int32Array(512),Z=new Int32Array(32);let H=0;for(;H<144;)o.lens[H++]=8;for(;H<256;)o.lens[H++]=9;for(;H<280;)o.lens[H++]=7;for(;H<288;)o.lens[H++]=8;for(O(1,o.lens,0,288,e,0,o.work,{bits:9}),H=0;H<32;)o.lens[H++]=5;O(2,o.lens,0,32,Z,0,o.work,{bits:5}),M=!1}o.lencode=e,o.lenbits=9,o.distcode=Z,o.distbits=5},f=(o,H,n,E)=>{let k;const g=o.state;return null===g.window&&(g.wsize=1<<g.wbits,g.wnext=0,g.whave=0,g.window=new Uint8Array(g.wsize)),E>=g.wsize?(g.window.set(H.subarray(n-g.wsize,n),0),g.wnext=0,g.whave=g.wsize):(k=g.wsize-g.wnext,k>E&&(k=E),g.window.set(H.subarray(n-E,n-E+k),g.wnext),(E-=k)?(g.window.set(H.subarray(n-E,n),0),g.wnext=E,g.whave=g.wsize):(g.wnext+=k,g.wnext===g.wsize&&(g.wnext=0),g.whave<g.wsize&&(g.whave+=k))),0};o.exports.inflateReset=m,o.exports.inflateReset2=P,o.exports.inflateResetKeep=j,o.exports.inflateInit=o=>b(o,15),o.exports.inflateInit2=b,o.exports.inflate=(o,H)=>{let n,p,j,m,P,b,e,Z,M,B,q,D,T,a,F,C,t,X,s,U,I,v,w=0;const r=new Uint8Array(4);let u,d;const R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!o||!o.state||!o.output||!o.input&&0!==o.avail_in)return l;n=o.state,n.mode===N&&(n.mode=13),P=o.next_out,j=o.output,e=o.avail_out,m=o.next_in,p=o.input,b=o.avail_in,Z=n.hold,M=n.bits,B=b,q=e,v=G;o:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;M<16;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}if(2&n.wrap&&35615===Z){n.check=0,r[0]=255&Z,r[1]=Z>>>8&255,n.check=k(n.check,r,2,0),Z=0,M=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&Z)<<8)+(Z>>8))%31){o.SH="incorrect header check",n.mode=h;break}if((15&Z)!==J){o.SH="unknown compression method",n.mode=h;break}if(Z>>>=4,M-=4,I=8+(15&Z),0===n.wbits)n.wbits=I;else if(I>n.wbits){o.SH="invalid window size",n.mode=h;break}n.dmax=1<<n.wbits,o.adler=n.check=1,n.mode=512&Z?10:N,Z=0,M=0;break;case 2:for(;M<16;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}if(n.flags=Z,(255&n.flags)!==J){o.SH="unknown compression method",n.mode=h;break}if(57344&n.flags){o.SH="unknown header flags set",n.mode=h;break}n.head&&(n.head.text=Z>>8&1),512&n.flags&&(r[0]=255&Z,r[1]=Z>>>8&255,n.check=k(n.check,r,2,0)),Z=0,M=0,n.mode=3;case 3:for(;M<32;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}n.head&&(n.head.time=Z),512&n.flags&&(r[0]=255&Z,r[1]=Z>>>8&255,r[2]=Z>>>16&255,r[3]=Z>>>24&255,n.check=k(n.check,r,4,0)),Z=0,M=0,n.mode=4;case 4:for(;M<16;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}n.head&&(n.head.xflags=255&Z,n.head.os=Z>>8),512&n.flags&&(r[0]=255&Z,r[1]=Z>>>8&255,n.check=k(n.check,r,2,0)),Z=0,M=0,n.mode=5;case 5:if(1024&n.flags){for(;M<16;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}n.length=Z,n.head&&(n.head.extra_len=Z),512&n.flags&&(r[0]=255&Z,r[1]=Z>>>8&255,n.check=k(n.check,r,2,0)),Z=0,M=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(D=n.length,D>b&&(D=b),D&&(n.head&&(I=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(p.subarray(m,m+D),I)),512&n.flags&&(n.check=k(n.check,p,D,m)),b-=D,m+=D,n.length-=D),n.length))break o;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===b)break o;D=0;do{I=p[m+D++],n.head&&I&&n.length<65536&&(n.head.name+=String.fromCharCode(I))}while(I&&D<b);if(512&n.flags&&(n.check=k(n.check,p,D,m)),b-=D,m+=D,I)break o}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===b)break o;D=0;do{I=p[m+D++],n.head&&I&&n.length<65536&&(n.head.comment+=String.fromCharCode(I))}while(I&&D<b);if(512&n.flags&&(n.check=k(n.check,p,D,m)),b-=D,m+=D,I)break o}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;M<16;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}if(Z!==(65535&n.check)){o.SH="header crc mismatch",n.mode=h;break}Z=0,M=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),o.adler=n.check=0,n.mode=N;break;case 10:for(;M<32;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}o.adler=n.check=Q(Z),Z=0,M=0,n.mode=11;case 11:if(0===n.havedict)return o.next_out=P,o.avail_out=e,o.next_in=m,o.avail_in=b,n.hold=Z,n.bits=M,A;o.adler=n.check=1,n.mode=N;case N:if(H===y||H===S)break o;case 13:if(n.last){Z>>>=7&M,M-=7&M,n.mode=27;break}for(;M<3;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}switch(n.last=1&Z,Z>>>=1,M-=1,3&Z){case 0:n.mode=14;break;case 1:if(K(n),n.mode=20,H===S){Z>>>=2,M-=2;break o}break;case 2:n.mode=17;break;case 3:o.SH="invalid block type",n.mode=h}Z>>>=2,M-=2;break;case 14:for(Z>>>=7&M,M-=7&M;M<32;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}if((65535&Z)!==(Z>>>16^65535)){o.SH="invalid stored block lengths",n.mode=h;break}if(n.length=65535&Z,Z=0,M=0,n.mode=15,H===S)break o;case 15:n.mode=16;case 16:if(D=n.length,D){if(D>b&&(D=b),D>e&&(D=e),0===D)break o;j.set(p.subarray(m,m+D),P),b-=D,m+=D,e-=D,P+=D,n.length-=D;break}n.mode=N;break;case 17:for(;M<14;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}if(n.nlen=257+(31&Z),Z>>>=5,M-=5,n.ndist=1+(31&Z),Z>>>=5,M-=5,n.ncode=4+(15&Z),Z>>>=4,M-=4,n.nlen>286||n.ndist>30){o.SH="too many length or distance symbols",n.mode=h;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;M<3;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}n.lens[R[n.have++]]=7&Z,Z>>>=3,M-=3}for(;n.have<19;)n.lens[R[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,u={bits:n.lenbits},v=O(0,n.lens,0,19,n.lencode,0,n.work,u),n.lenbits=u.bits,v){o.SH="invalid code lengths set",n.mode=h;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;w=n.lencode[Z&(1<<n.lenbits)-1],F=w>>>24,C=w>>>16&255,t=65535&w,!(F<=M);){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}if(t<16)Z>>>=F,M-=F,n.lens[n.have++]=t;else{if(16===t){for(d=F+2;M<d;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}if(Z>>>=F,M-=F,0===n.have){o.SH="invalid bit length repeat",n.mode=h;break}I=n.lens[n.have-1],D=3+(3&Z),Z>>>=2,M-=2}else if(17===t){for(d=F+3;M<d;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}Z>>>=F,M-=F,I=0,D=3+(7&Z),Z>>>=3,M-=3}else{for(d=F+7;M<d;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}Z>>>=F,M-=F,I=0,D=11+(127&Z),Z>>>=7,M-=7}if(n.have+D>n.nlen+n.ndist){o.SH="invalid bit length repeat",n.mode=h;break}for(;D--;)n.lens[n.have++]=I}}if(n.mode===h)break;if(0===n.lens[256]){o.SH="invalid code -- missing end-of-block",n.mode=h;break}if(n.lenbits=9,u={bits:n.lenbits},v=O(1,n.lens,0,n.nlen,n.lencode,0,n.work,u),n.lenbits=u.bits,v){o.SH="invalid literal/lengths set",n.mode=h;break}if(n.distbits=6,n.distcode=n.distdyn,u={bits:n.distbits},v=O(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,u),n.distbits=u.bits,v){o.SH="invalid distances set",n.mode=h;break}if(n.mode=20,H===S)break o;case 20:n.mode=21;case 21:if(b>=6&&e>=258){o.next_out=P,o.avail_out=e,o.next_in=m,o.avail_in=b,n.hold=Z,n.bits=M,g(o,q),P=o.next_out,j=o.output,e=o.avail_out,m=o.next_in,p=o.input,b=o.avail_in,Z=n.hold,M=n.bits,n.mode===N&&(n.back=-1);break}for(n.back=0;w=n.lencode[Z&(1<<n.lenbits)-1],F=w>>>24,C=w>>>16&255,t=65535&w,!(F<=M);){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}if(C&&0===(240&C)){for(X=F,s=C,U=t;w=n.lencode[U+((Z&(1<<X+s)-1)>>X)],F=w>>>24,C=w>>>16&255,t=65535&w,!(X+F<=M);){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}Z>>>=X,M-=X,n.back+=X}if(Z>>>=F,M-=F,n.back+=F,n.length=t,0===C){n.mode=26;break}if(32&C){n.back=-1,n.mode=N;break}if(64&C){o.SH="invalid literal/length code",n.mode=h;break}n.extra=15&C,n.mode=22;case 22:if(n.extra){for(d=n.extra;M<d;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}n.length+=Z&(1<<n.extra)-1,Z>>>=n.extra,M-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;w=n.distcode[Z&(1<<n.distbits)-1],F=w>>>24,C=w>>>16&255,t=65535&w,!(F<=M);){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}if(0===(240&C)){for(X=F,s=C,U=t;w=n.distcode[U+((Z&(1<<X+s)-1)>>X)],F=w>>>24,C=w>>>16&255,t=65535&w,!(X+F<=M);){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}Z>>>=X,M-=X,n.back+=X}if(Z>>>=F,M-=F,n.back+=F,64&C){o.SH="invalid distance code",n.mode=h;break}n.offset=t,n.extra=15&C,n.mode=24;case 24:if(n.extra){for(d=n.extra;M<d;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}n.offset+=Z&(1<<n.extra)-1,Z>>>=n.extra,M-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){o.SH="invalid distance too far back",n.mode=h;break}n.mode=25;case 25:if(0===e)break o;if(D=q-e,n.offset>D){if(D=n.offset-D,D>n.whave&&n.sane){o.SH="invalid distance too far back",n.mode=h;break}D>n.wnext?(D-=n.wnext,T=n.wsize-D):T=n.wnext-D,D>n.length&&(D=n.length),a=n.window}else a=j,T=P-n.offset,D=n.length;D>e&&(D=e),e-=D,n.length-=D;do{j[P++]=a[T++]}while(--D);0===n.length&&(n.mode=21);break;case 26:if(0===e)break o;j[P++]=n.length,e--,n.mode=21;break;case 27:if(n.wrap){for(;M<32;){if(0===b)break o;b--,Z|=p[m++]<<M,M+=8}if(q-=e,o.total_out+=q,n.total+=q,q&&(o.adler=n.check=n.flags?k(n.check,j,q,P-q):E(n.check,j,q,P-q)),q=e,(n.flags?Z:Q(Z))!==n.check){o.SH="incorrect data check",n.mode=h;break}Z=0,M=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;M<32;){if(0===b)break o;b--,Z+=p[m++]<<M,M+=8}if(Z!==(4294967295&n.total)){o.SH="incorrect length check",n.mode=h;break}Z=0,M=0}n.mode=29;case 29:v=c;break o;case h:v=x;break o;case 31:return z;default:return l}return o.next_out=P,o.avail_out=e,o.next_in=m,o.avail_in=b,n.hold=Z,n.bits=M,(n.wsize||q!==o.avail_out&&n.mode<h&&(n.mode<27||H!==Y))&&f(o,o.output,o.next_out,q-o.avail_out)?(n.mode=31,z):(B-=o.avail_in,q-=o.avail_out,o.total_in+=B,o.total_out+=q,n.total+=q,n.wrap&&q&&(o.adler=n.check=n.flags?k(n.check,j,q,o.next_out-q):E(n.check,j,q,o.next_out-q)),o.data_type=n.bits+(n.last?64:0)+(n.mode===N?128:0)+(20===n.mode||15===n.mode?256:0),(0===B&&0===q||H===Y)&&v===G&&(v=V),v)},o.exports.inflateEnd=o=>{if(!o||!o.state)return l;let H=o.state;return H.window&&(H.window=null),o.state=null,G},o.exports.inflateGetHeader=(o,H)=>{if(!o||!o.state)return l;const n=o.state;return 0===(2&n.wrap)?l:(n.head=H,H.done=!1,G)},o.exports.inflateSetDictionary=(o,H)=>{const n=H.length;let k,g,O;return o&&o.state?(k=o.state,0!==k.wrap&&11!==k.mode?l:11===k.mode&&(g=1,g=E(g,H,n,0),g!==k.check)?x:(O=f(o,H,n,n),O?(k.mode=31,z):(k.havedict=1,G))):l},o.exports.inflateInfo="pako inflate (from Nodeca project)"},12418:o=>{"use strict";const H=15,n=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),E=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),k=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),g=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);o.exports=(o,O,Y,y,S,G,c,A)=>{const l=A.bits;let x,z,V,J,N,h,Q=0,p=0,j=0,m=0,P=0,b=0,e=0,Z=0,M=0,K=0,f=null,B=0;const q=new Uint16Array(16),D=new Uint16Array(16);let T,a,F,C=null,t=0;for(Q=0;Q<=H;Q++)q[Q]=0;for(p=0;p<y;p++)q[O[Y+p]]++;for(P=l,m=H;m>=1&&0===q[m];m--);if(P>m&&(P=m),0===m)return S[G++]=20971520,S[G++]=20971520,A.bits=1,0;for(j=1;j<m&&0===q[j];j++);for(P<j&&(P=j),Z=1,Q=1;Q<=H;Q++)if(Z<<=1,Z-=q[Q],Z<0)return-1;if(Z>0&&(0===o||1!==m))return-1;for(D[1]=0,Q=1;Q<H;Q++)D[Q+1]=D[Q]+q[Q];for(p=0;p<y;p++)0!==O[Y+p]&&(c[D[O[Y+p]]++]=p);if(0===o?(f=C=c,h=19):1===o?(f=n,B-=257,C=E,t-=257,h=256):(f=k,C=g,h=-1),K=0,p=0,Q=j,N=G,b=P,e=0,V=-1,M=1<<P,J=M-1,1===o&&M>852||2===o&&M>592)return 1;for(;;){T=Q-e,c[p]<h?(a=0,F=c[p]):c[p]>h?(a=C[t+c[p]],F=f[B+c[p]]):(a=96,F=0),x=1<<Q-e,z=1<<b,j=z;do{z-=x,S[N+(K>>e)+z]=T<<24|a<<16|F}while(0!==z);for(x=1<<Q-1;K&x;)x>>=1;if(0!==x?(K&=x-1,K+=x):K=0,p++,0===--q[Q]){if(Q===m)break;Q=O[Y+c[p]]}if(Q>P&&(K&J)!==V){for(0===e&&(e=P),N+=j,b=Q-e,Z=1<<b;b+e<m&&(Z-=q[b+e],!(Z<=0));)b++,Z<<=1;if(M+=1<<b,1===o&&M>852||2===o&&M>592)return 1;V=K&J,S[V]=P<<24|b<<16|N-G}}return 0!==K&&(S[N+K]=Q-e<<24|64<<16),A.bits=P,0}},12368:o=>{"use strict";o.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12351:o=>{"use strict";function H(o){let H=o.length;for(;--H>=0;)o[H]=0}const n=256,E=286,k=30,g=15,O=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Y=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),y=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),S=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),G=new Array(576);H(G);const c=new Array(60);H(c);const A=new Array(512);H(A);const l=new Array(256);H(l);const x=new Array(29);H(x);const z=new Array(k);function V(o,H,n,E,k){this.static_tree=o,this.extra_bits=H,this.extra_base=n,this.elems=E,this.max_length=k,this.has_stree=o&&o.length}let J,N,h;function Q(o,H){this.dyn_tree=o,this.max_code=0,this.stat_desc=H}H(z);const p=o=>o<256?A[o]:A[256+(o>>>7)],j=(o,H)=>{o.pending_buf[o.pending++]=255&H,o.pending_buf[o.pending++]=H>>>8&255},m=(o,H,n)=>{o.bi_valid>16-n?(o.bi_buf|=H<<o.bi_valid&65535,j(o,o.bi_buf),o.bi_buf=H>>16-o.bi_valid,o.bi_valid+=n-16):(o.bi_buf|=H<<o.bi_valid&65535,o.bi_valid+=n)},P=(o,H,n)=>{m(o,n[2*H],n[2*H+1])},b=(o,H)=>{let n=0;do{n|=1&o,o>>>=1,n<<=1}while(--H>0);return n>>>1},e=(o,H,n)=>{const E=new Array(16);let k,O,Y=0;for(k=1;k<=g;k++)E[k]=Y=Y+n[k-1]<<1;for(O=0;O<=H;O++){let H=o[2*O+1];0!==H&&(o[2*O]=b(E[H]++,H))}},Z=o=>{let H;for(H=0;H<E;H++)o.dyn_ltree[2*H]=0;for(H=0;H<k;H++)o.dyn_dtree[2*H]=0;for(H=0;H<19;H++)o.bl_tree[2*H]=0;o.dyn_ltree[512]=1,o.opt_len=o.static_len=0,o.last_lit=o.matches=0},M=o=>{o.bi_valid>8?j(o,o.bi_buf):o.bi_valid>0&&(o.pending_buf[o.pending++]=o.bi_buf),o.bi_buf=0,o.bi_valid=0},K=(o,H,n,E)=>{const k=2*H,g=2*n;return o[k]<o[g]||o[k]===o[g]&&E[H]<=E[n]},f=(o,H,n)=>{const E=o.heap[n];let k=n<<1;for(;k<=o.heap_len&&(k<o.heap_len&&K(H,o.heap[k+1],o.heap[k],o.depth)&&k++,!K(H,E,o.heap[k],o.depth));)o.heap[n]=o.heap[k],n=k,k<<=1;o.heap[n]=E},B=(o,H,E)=>{let k,g,y,S,G=0;if(0!==o.last_lit)do{k=o.pending_buf[o.d_buf+2*G]<<8|o.pending_buf[o.d_buf+2*G+1],g=o.pending_buf[o.l_buf+G],G++,0===k?P(o,g,H):(y=l[g],P(o,y+n+1,H),S=O[y],0!==S&&(g-=x[y],m(o,g,S)),k--,y=p(k),P(o,y,E),S=Y[y],0!==S&&(k-=z[y],m(o,k,S)))}while(G<o.last_lit);P(o,256,H)},q=(o,H)=>{const n=H.dyn_tree,E=H.stat_desc.static_tree,k=H.stat_desc.has_stree,O=H.stat_desc.elems;let Y,y,S,G=-1;for(o.heap_len=0,o.heap_max=573,Y=0;Y<O;Y++)0!==n[2*Y]?(o.heap[++o.heap_len]=G=Y,o.depth[Y]=0):n[2*Y+1]=0;for(;o.heap_len<2;)S=o.heap[++o.heap_len]=G<2?++G:0,n[2*S]=1,o.depth[S]=0,o.opt_len--,k&&(o.static_len-=E[2*S+1]);for(H.max_code=G,Y=o.heap_len>>1;Y>=1;Y--)f(o,n,Y);S=O;do{Y=o.heap[1],o.heap[1]=o.heap[o.heap_len--],f(o,n,1),y=o.heap[1],o.heap[--o.heap_max]=Y,o.heap[--o.heap_max]=y,n[2*S]=n[2*Y]+n[2*y],o.depth[S]=(o.depth[Y]>=o.depth[y]?o.depth[Y]:o.depth[y])+1,n[2*Y+1]=n[2*y+1]=S,o.heap[1]=S++,f(o,n,1)}while(o.heap_len>=2);o.heap[--o.heap_max]=o.heap[1],((o,H)=>{const n=H.dyn_tree,E=H.max_code,k=H.stat_desc.static_tree,O=H.stat_desc.has_stree,Y=H.stat_desc.extra_bits,y=H.stat_desc.extra_base,S=H.stat_desc.max_length;let G,c,A,l,x,z,V=0;for(l=0;l<=g;l++)o.bl_count[l]=0;for(n[2*o.heap[o.heap_max]+1]=0,G=o.heap_max+1;G<573;G++)c=o.heap[G],l=n[2*n[2*c+1]+1]+1,l>S&&(l=S,V++),n[2*c+1]=l,c>E||(o.bl_count[l]++,x=0,c>=y&&(x=Y[c-y]),z=n[2*c],o.opt_len+=z*(l+x),O&&(o.static_len+=z*(k[2*c+1]+x)));if(0!==V){do{for(l=S-1;0===o.bl_count[l];)l--;o.bl_count[l]--,o.bl_count[l+1]+=2,o.bl_count[S]--,V-=2}while(V>0);for(l=S;0!==l;l--)for(c=o.bl_count[l];0!==c;)A=o.heap[--G],A>E||(n[2*A+1]!==l&&(o.opt_len+=(l-n[2*A+1])*n[2*A],n[2*A+1]=l),c--)}})(o,H),e(n,G,o.bl_count)},D=(o,H,n)=>{let E,k,g=-1,O=H[1],Y=0,y=7,S=4;for(0===O&&(y=138,S=3),H[2*(n+1)+1]=65535,E=0;E<=n;E++)k=O,O=H[2*(E+1)+1],++Y<y&&k===O||(Y<S?o.bl_tree[2*k]+=Y:0!==k?(k!==g&&o.bl_tree[2*k]++,o.bl_tree[32]++):Y<=10?o.bl_tree[34]++:o.bl_tree[36]++,Y=0,g=k,0===O?(y=138,S=3):k===O?(y=6,S=3):(y=7,S=4))},T=(o,H,n)=>{let E,k,g=-1,O=H[1],Y=0,y=7,S=4;for(0===O&&(y=138,S=3),E=0;E<=n;E++)if(k=O,O=H[2*(E+1)+1],!(++Y<y&&k===O)){if(Y<S)do{P(o,k,o.bl_tree)}while(0!==--Y);else 0!==k?(k!==g&&(P(o,k,o.bl_tree),Y--),P(o,16,o.bl_tree),m(o,Y-3,2)):Y<=10?(P(o,17,o.bl_tree),m(o,Y-3,3)):(P(o,18,o.bl_tree),m(o,Y-11,7));Y=0,g=k,0===O?(y=138,S=3):k===O?(y=6,S=3):(y=7,S=4)}};let a=!1;const F=(o,H,n,E)=>{m(o,0+(E?1:0),3),((o,H,n,E)=>{M(o),E&&(j(o,n),j(o,~n)),o.pending_buf.set(o.window.subarray(H,H+n),o.pending),o.pending+=n})(o,H,n,!0)};o.exports._tr_init=o=>{a||((()=>{let o,H,n,S,Q;const p=new Array(16);for(n=0,S=0;S<28;S++)for(x[S]=n,o=0;o<1<<O[S];o++)l[n++]=S;for(l[n-1]=S,Q=0,S=0;S<16;S++)for(z[S]=Q,o=0;o<1<<Y[S];o++)A[Q++]=S;for(Q>>=7;S<k;S++)for(z[S]=Q<<7,o=0;o<1<<Y[S]-7;o++)A[256+Q++]=S;for(H=0;H<=g;H++)p[H]=0;for(o=0;o<=143;)G[2*o+1]=8,o++,p[8]++;for(;o<=255;)G[2*o+1]=9,o++,p[9]++;for(;o<=279;)G[2*o+1]=7,o++,p[7]++;for(;o<=287;)G[2*o+1]=8,o++,p[8]++;for(e(G,287,p),o=0;o<k;o++)c[2*o+1]=5,c[2*o]=b(o,5);J=new V(G,O,257,E,g),N=new V(c,Y,0,k,g),h=new V(new Array(0),y,0,19,7)})(),a=!0),o.l_desc=new Q(o.dyn_ltree,J),o.d_desc=new Q(o.dyn_dtree,N),o.bl_desc=new Q(o.bl_tree,h),o.bi_buf=0,o.bi_valid=0,Z(o)},o.exports._tr_stored_block=F,o.exports._tr_flush_block=(o,H,E,k)=>{let g,O,Y=0;o.level>0?(2===o.strm.data_type&&(o.strm.data_type=(o=>{let H,E=4093624447;for(H=0;H<=31;H++,E>>>=1)if(1&E&&0!==o.dyn_ltree[2*H])return 0;if(0!==o.dyn_ltree[18]||0!==o.dyn_ltree[20]||0!==o.dyn_ltree[26])return 1;for(H=32;H<n;H++)if(0!==o.dyn_ltree[2*H])return 1;return 0})(o)),q(o,o.l_desc),q(o,o.d_desc),Y=(o=>{let H;for(D(o,o.dyn_ltree,o.l_desc.max_code),D(o,o.dyn_dtree,o.d_desc.max_code),q(o,o.bl_desc),H=18;H>=3&&0===o.bl_tree[2*S[H]+1];H--);return o.opt_len+=3*(H+1)+5+5+4,H})(o),g=o.opt_len+3+7>>>3,O=o.static_len+3+7>>>3,O<=g&&(g=O)):g=O=E+5,E+4<=g&&-1!==H?F(o,H,E,k):4===o.strategy||O===g?(m(o,2+(k?1:0),3),B(o,G,c)):(m(o,4+(k?1:0),3),((o,H,n,E)=>{let k;for(m(o,H-257,5),m(o,n-1,5),m(o,E-4,4),k=0;k<E;k++)m(o,o.bl_tree[2*S[k]+1],3);T(o,o.dyn_ltree,H-1),T(o,o.dyn_dtree,n-1)})(o,o.l_desc.max_code+1,o.d_desc.max_code+1,Y+1),B(o,o.dyn_ltree,o.dyn_dtree)),Z(o),k&&M(o)},o.exports._tr_tally=(o,H,E)=>(o.pending_buf[o.d_buf+2*o.last_lit]=H>>>8&255,o.pending_buf[o.d_buf+2*o.last_lit+1]=255&H,o.pending_buf[o.l_buf+o.last_lit]=255&E,o.last_lit++,0===H?o.dyn_ltree[2*E]++:(o.matches++,H--,o.dyn_ltree[2*(l[E]+n+1)]++,o.dyn_dtree[2*p(H)]++),o.last_lit===o.lit_bufsize-1),o.exports._tr_align=o=>{m(o,2,3),P(o,256,G),(o=>{16===o.bi_valid?(j(o,o.bi_buf),o.bi_buf=0,o.bi_valid=0):o.bi_valid>=8&&(o.pending_buf[o.pending++]=255&o.bi_buf,o.bi_buf>>=8,o.bi_valid-=8)})(o)}},12391:o=>{"use strict";o.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.SH="",this.state=null,this.data_type=2,this.adler=0}},12005:o=>{function H(o,H,n){for(var E=o.length,k=-1/0,g=1/0,O=0;O<E;O++){var Y=(n[0][O]-o[O])/H[O],y=(n[1][O]-o[O])/H[O];if(Y>y){var S=Y;Y=y,y=S}if(y<k||Y>g)return 1/0;Y>k&&(k=Y),y<g&&(g=y)}return k>g?1/0:k}o.exports=function(o,n,E,k){var g=H(n,E,k);if(g===1/0)o=null;else{o=o||[];for(var O=0;O<n.length;O++)o[O]=n[O]+E[O]*g}return o},o.exports.distance=H},13426:(o,H,n)=>{"use strict";n.d(H,{e:()=>O});var E=n(27);const k=E.useLayoutEffect;const g=function(o){var H=(0,E.useRef)(o);return k((function(){H.current=o})),H};var O=function(o){var H=g(o);(0,E.OH)((function(){var o=function(o){var n;if(null!=H.current&&(n=H.current(o)),o.defaultPrevented&&(o.returnValue=""),"string"===typeof n)return o.returnValue=n,n};return window.addEventListener("beforeunload",o),function(){window.removeEventListener("beforeunload",o)}}),[])}},13369:(o,H,n)=>{"use strict";var E=n(13372),k=Array.prototype.concat,g=Array.prototype.slice,O=o.exports=function(o){for(var H=[],n=0,O=o.length;n<O;n++){var Y=o[n];E(Y)?H=k.call(H,g.call(Y)):H.push(Y)}return H};O.wrap=function(o){return function(){return o(O(arguments))}}},13372:o=>{o.exports=function(o){return!(!o||"string"===typeof o)&&(o instanceof Array||Array.isArray(o)||o.length>=0&&(o.splice instanceof Function||Object.getOwnPropertyDescriptor(o,o.length-1)&&"String"!==o.constructor.name))}},12290:(o,H,n)=>{var E=n(12298);function k(o){for(var H,n,k=0,g=o.length,O=0;O<o.length;){for(H=o[O],n=0;O<g&&o[O]===H;)++O,++n;k+=E.log2(n)/7|0,k+=E.log2(H>>>0)/7|0,k+=2}return k}H.size=k,H.encode=function(o,H){H||(H=new Uint8Array(k(o)));for(var n,E,g=0,O=H.length,Y=0;Y<o.length;){for(n=o[Y],E=0;Y<o.length&&o[Y]===n;)++Y,++E;for(;g<O&&E>=128;)H[g++]=128+(127&E),E>>>=7;if(g>=O)throw new Error("RLE buffer overflow");for(H[g++]=E,n>>>=0;g<O&&n>=128;)H[g++]=128+(127&n),n>>>=7;if(g>=O)throw new Error("RLE buffer overflow");H[g++]=n}return H},H.decode=function(o,H){for(var n,E,k,g,O=H.length,Y=o.length,y=0,S=0;S<Y;){for(n=0,E=0;S<Y&&o[S]>=128;)n+=(127&o[S++])<<E,E+=7;if(n+=o[S++]<<E,S>=Y)throw new Error("RLE buffer underrun");if(y+n>O)throw new Error("Chunk buffer overflow");for(k=0,E=0;S<Y&&o[S]>=128;)k+=(127&o[S++])<<E,E+=7;if(S>=Y)throw new Error("RLE buffer underrun");for(k+=o[S++]<<E,g=0;g<n;++g)H[y++]=k}return H}},12298:(o,H)=>{"use strict";function n(o){var H=32;return(o&=-o)&&H--,65535&o&&(H-=16),16711935&o&&(H-=8),252645135&o&&(H-=4),858993459&o&&(H-=2),1431655765&o&&(H-=1),H}H.INT_BITS=32,H.INT_MAX=2147483647,H.INT_MIN=-1<<31,H.sign=function(o){return(o>0)-(o<0)},H.abs=function(o){var H=o>>31;return(o^H)-H},H.min=function(o,H){return H^(o^H)&-(o<H)},H.max=function(o,H){return o^(o^H)&-(o<H)},H.isPow2=function(o){return!(o&o-1)&&!!o},H.log2=function(o){var H,n;return H=(o>65535)<<4,H|=n=((o>>>=H)>255)<<3,H|=n=((o>>>=n)>15)<<2,(H|=n=((o>>>=n)>3)<<1)|(o>>>=n)>>1},H.log10=function(o){return o>=1e9?9:o>=1e8?8:o>=1e7?7:o>=1e6?6:o>=1e5?5:o>=1e4?4:o>=1e3?3:o>=100?2:o>=10?1:0},H.popCount=function(o){return 16843009*((o=(858993459&(o-=o>>>1&1431655765))+(o>>>2&858993459))+(o>>>4)&252645135)>>>24},H.countTrailingZeros=n,H.nextPow2=function(o){return o+=0===o,--o,o|=o>>>1,o|=o>>>2,o|=o>>>4,o|=o>>>8,(o|=o>>>16)+1},H.prevPow2=function(o){return o|=o>>>1,o|=o>>>2,o|=o>>>4,o|=o>>>8,(o|=o>>>16)-(o>>>1)},H.parity=function(o){return o^=o>>>16,o^=o>>>8,o^=o>>>4,27030>>>(o&=15)&1};var E=new Array(256);!function(o){for(var H=0;H<256;++H){var n=H,E=H,k=7;for(n>>>=1;n;n>>>=1)E<<=1,E|=1&n,--k;o[H]=E<<k&255}}(E),H.reverse=function(o){return E[255&o]<<24|E[o>>>8&255]<<16|E[o>>>16&255]<<8|E[o>>>24&255]},H.interleave2=function(o,H){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o&=65535)|o<<8))|o<<4))|o<<2))|o<<1))|(H=1431655765&((H=858993459&((H=252645135&((H=16711935&((H&=65535)|H<<8))|H<<4))|H<<2))|H<<1))<<1},H.deinterleave2=function(o,H){return(o=65535&((o=16711935&((o=252645135&((o=858993459&((o=o>>>H&1431655765)|o>>>1))|o>>>2))|o>>>4))|o>>>16))<<16>>16},H.interleave3=function(o,H,n){return o=1227133513&((o=3272356035&((o=251719695&((o=4278190335&((o&=1023)|o<<16))|o<<8))|o<<4))|o<<2),(o|=(H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},H.deinterleave3=function(o,H){return(o=1023&((o=4278190335&((o=251719695&((o=3272356035&((o=o>>>H&1227133513)|o>>>2))|o>>>4))|o>>>8))|o>>>16))<<22>>22},H.nextCombination=function(o){var H=o|o-1;return H+1|(~H&-~H)-1>>>n(o)+1}},12324:o=>{"use strict";o.exports=function(o,H,n,E){var k=self||window;try{try{var g;try{g=new k.Blob([o])}catch(S){(g=new(k.BlobBuilder||k.WebKitBlobBuilder||k.MozBlobBuilder||k.MSBlobBuilder)).append(o),g=g.getBlob()}var O=k.URL||k.webkitURL,Y=O.createObjectURL(g),y=new k[H](Y,n);return O.revokeObjectURL(Y),y}catch(S){return new k[H]("data:application/javascript,".concat(encodeURIComponent(o)),n)}}catch(S){if(!E)throw Error("Inline worker is not supported");return new k[H](E,n)}}},11990:(o,H,n)=>{"use strict";function E(o,H,n,E,k){var g={};return Object.keys(E).forEach((function(o){g[o]=E[o]})),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=n.slice().reverse().reduce((function(n,E){return E(o,H,n)||n}),g),k&&void 0!==g.initializer&&(g.value=g.initializer?g.initializer.call(k):void 0,g.initializer=void 0),void 0===g.initializer&&(Object.defineProperty(o,H,g),g=null),g}n.d(H,{c:()=>E})},11986:(o,H,n)=>{"use strict";function E(o,H,n,E){n&&Object.defineProperty(o,H,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(E):void 0})}n.d(H,{c:()=>E})},13415:(o,H,n)=>{"use strict";n.d(H,{b:()=>O,c:()=>c,e:()=>Y,h:()=>g,i:()=>y,l:()=>k,p:()=>S,s:()=>G});var E=n(11410);class k{constructor(){this._easingMode=k.EASINGMODE_EASEIN}setEasingMode(o){const H=Math.min(Math.max(o,0),2);this._easingMode=H}getEasingMode(){return this._easingMode}easeInCore(o){throw new Error("You must implement this method")}ease(o){switch(this._easingMode){case k.EASINGMODE_EASEIN:return this.easeInCore(o);case k.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-o)}return o>=.5?.5*(1-this.easeInCore(2*(1-o)))+.5:.5*this.easeInCore(2*o)}}k.EASINGMODE_EASEIN=0,k.EASINGMODE_EASEOUT=1,k.EASINGMODE_EASEINOUT=2;class g extends k{easeInCore(o){return o=Math.max(0,Math.min(1,o)),1-Math.sqrt(1-o*o)}}class O extends k{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=o}easeInCore(o){const H=Math.max(0,this.amplitude);return Math.pow(o,3)-o*H*Math.sin(3.141592653589793*o)}}class Y extends k{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=o,this.bounciness=H}easeInCore(o){const H=Math.max(0,this.bounces);let n=this.bounciness;n<=1&&(n=1.001);const E=Math.pow(n,H),k=1-n,g=(1-E)/k+.5*E,O=o*g,Y=Math.log(-O*(1-n)+1)/Math.log(n),y=Math.floor(Y),S=y+1,G=(1-Math.pow(n,y))/(k*g),c=.5*(G+(1-Math.pow(n,S))/(k*g)),A=o-c,l=c-G;return-Math.pow(1/n,H-y)/(l*l)*(A-l)*(A+l)}}class y extends k{easeInCore(o){return o*o*o}}class S extends k{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=o,this.springiness=H}easeInCore(o){let H;const n=Math.max(0,this.oscillations),E=Math.max(0,this.springiness);return H=0==E?o:(Math.exp(E*o)-1)/(Math.exp(E)-1),H*Math.sin((6.283185307179586*n+1.5707963267948966)*o)}}class G extends k{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=o}easeInCore(o){return this.exponent<=0?o:(Math.exp(this.exponent*o)-1)/(Math.exp(this.exponent)-1)}}class c extends k{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=o,this.y1=H,this.x2=n,this.y2=E}easeInCore(o){return E.d.Interpolate(o,this.x1,this.y1,this.x2,this.y2)}}},12851:(o,H,n)=>{"use strict";n.d(H,{b:()=>O});var E=n(11189),k=n(11201),g=n(11623);class O extends g.b{get _matrix(){return this._compose(),this.wA}set _matrix(o){(o.updateFlag!==this.wA.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.wA.S(o),this._markAsDirtyAndDecompose())}constructor(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(o,H.bo(),!1),this.name=o,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=H,this.wA=(null===k||void 0===k?void 0:k.clone())??E.Matrix.Identity(),this._restMatrix=g??this.wA.clone(),this._bindMatrix=O??this.wA.clone(),this._index=Y,this._absoluteMatrix=new E.Matrix,this._absoluteBindMatrix=new E.Matrix,this._absoluteInverseBindMatrix=new E.Matrix,this._finalMatrix=new E.Matrix,H.bones.push(this),this.setParent(n,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(o){this.setParent(o)}setParent(o){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==o){if(this.parent){const o=this.parent.children.indexOf(this);-1!==o&&this.parent.children.splice(o,1)}this._parentNode=o,this.parent&&this.parent.children.push(this),H&&this._updateAbsoluteBindMatrices(),this.KS()}}getLocalMatrix(){return this._compose(),this.wA}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(o){this._restMatrix.S(o)}setRestPose(o){this.setRestMatrix(o)}getBindPose(){return this.getBindMatrix()}setBindMatrix(o){this.sg(o)}setBindPose(o){this.setBindMatrix(o)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const o=E.TmpVectors.xH[0],H=E.TmpVectors.Quaternion[0],n=E.TmpVectors.xH[1];this.getRestMatrix().decompose(o,H,n),this._linkedTransformNode.position.S(n),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??E.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.S(H),this._linkedTransformNode.cY.S(o)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(o){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=o,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.tY}set position(o){this._decompose(),this.tY.S(o),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(o){this.setRotation(o)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(o){this.setRotationQuaternion(o)}get cY(){return this.getScale()}set cY(o){this.setScale(o)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=E.xH.Zero(),this._localRotation=E.Quaternion.Zero(),this.tY=E.xH.Zero()),this.wA.decompose(this._localScaling,this._localRotation,this.tY))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,E.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.tY,this.wA)):this._needToCompose=!1)}sg(o){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.S(o),H&&this._updateAbsoluteBindMatrices(),n?this._matrix=o:this.KS()}_updateAbsoluteBindMatrices(o){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(o||(o=this._bindMatrix),this.parent?o.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.S(o),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),H)for(let n=0;n<this.children.length;n++)this.children[n]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}KS(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.KS(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.KS(),this._needToDecompose=!0}_updatePosition(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const g=this.getLocalMatrix();if(0==H)k?(g.addAtIndex(12,o.x),g.addAtIndex(13,o.y),g.addAtIndex(14,o.z)):g.setTranslationFromFloats(o.x,o.y,o.z);else{let H=null;n&&(H=n.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const Y=O._TmpMats[0],y=O._TmpVecs[0];this.parent?n&&H?(Y.S(this.parent.getAbsoluteMatrix()),Y.multiplyToRef(H,Y)):Y.S(this.parent.getAbsoluteMatrix()):E.Matrix.IdentityToRef(Y),k&&Y.setTranslationFromFloats(0,0,0),Y.invert(),E.xH.TransformCoordinatesToRef(o,Y,y),k?(g.addAtIndex(12,y.x),g.addAtIndex(13,y.y),g.addAtIndex(14,y.z)):g.setTranslationFromFloats(y.x,y.y,y.z)}this._markAsDirtyAndDecompose()}translate(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;this._updatePosition(o,H,n,!0)}setPosition(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;this._updatePosition(o,H,n,!1)}setAbsolutePosition(o,H){this.setPosition(o,1,H)}scale(o,H,n){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const g=this.getLocalMatrix(),Y=O._TmpMats[0];E.Matrix.ScalingToRef(o,H,n,Y),Y.multiplyToRef(g,g),Y.invert();for(const E of this.children){const k=E.getLocalMatrix();k.multiplyToRef(Y,k),k.multiplyAtIndex(12,o),k.multiplyAtIndex(13,H),k.multiplyAtIndex(14,n),E._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),k)for(const E of this.children)E.scale(o,H,n,k)}setScale(o){this._decompose(),this._localScaling.S(o),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(o){this._decompose(),o.S(this._localScaling)}setYawPitchRoll(o,H,n){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,g=arguments.length>4?arguments[4]:void 0;if(0===k){const Y=O._TmpQuat;return E.Quaternion.RotationYawPitchRollToRef(o,H,n,Y),void this.setRotationQuaternion(Y,k,g)}const Y=O._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(Y,g))return;const y=O._TmpMats[1];E.Matrix.RotationYawPitchRollToRef(o,H,n,y),Y.multiplyToRef(y,y),this._rotateWithMatrix(y,k,g)}rotate(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3?arguments[3]:void 0;const g=O._TmpMats[0];g.setTranslationFromFloats(0,0,0),E.Matrix.RotationAxisToRef(o,H,g),this._rotateWithMatrix(g,n,k)}setAxisAngle(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3?arguments[3]:void 0;if(0===n){const g=O._TmpQuat;return E.Quaternion.RotationAxisToRef(o,H,g),void this.setRotationQuaternion(g,n,k)}const g=O._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(g,k))return;const Y=O._TmpMats[1];E.Matrix.RotationAxisToRef(o,H,Y),g.multiplyToRef(Y,Y),this._rotateWithMatrix(Y,n,k)}setRotation(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(o.y,o.x,o.z,H,n)}setRotationQuaternion(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(0===H)return this._decompose(),this._localRotation.S(o),void this._markAsDirtyAndCompose();const k=O._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(k,n))return;const g=O._TmpMats[1];E.Matrix.FromQuaternionToRef(o,g),k.multiplyToRef(g,g),this._rotateWithMatrix(g,H,n)}setRotationMatrix(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(0===H){const k=O._TmpQuat;return E.Quaternion.FromRotationMatrixToRef(o,k),void this.setRotationQuaternion(k,H,n)}const k=O._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(k,n))return;const g=O._TmpMats[1];g.S(o),k.multiplyToRef(o,g),this._rotateWithMatrix(g,H,n)}_rotateWithMatrix(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const E=this.getLocalMatrix(),k=E.m[12],g=E.m[13],Y=E.m[14],y=this.getParent(),S=O._TmpMats[3],G=O._TmpMats[4];y&&1==H?(n?(S.S(n.getWorldMatrix()),y.getAbsoluteMatrix().multiplyToRef(S,S)):S.S(y.getAbsoluteMatrix()),G.S(S),G.invert(),E.multiplyToRef(S,E),E.multiplyToRef(o,E),E.multiplyToRef(G,E)):1==H&&n?(S.S(n.getWorldMatrix()),G.S(S),G.invert(),E.multiplyToRef(S,E),E.multiplyToRef(o,E),E.multiplyToRef(G,E)):E.multiplyToRef(o,E),E.setTranslationFromFloats(k,g,Y),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(o,H){const n=O._TmpMats[2];return o.S(this.getAbsoluteMatrix()),H?(o.multiplyToRef(H.getWorldMatrix(),o),E.Matrix.ScalingToRef(H.cY.x,H.cY.y,H.cY.z,n)):E.Matrix.IdentityToRef(n),o.invert(),!isNaN(o.m[0])&&(n.multiplyAtIndex(0,this._scalingDeterminant),o.multiplyToRef(n,o),!0)}og(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=E.xH.Zero();return this.getPositionToRef(o,H,n),n}getPositionToRef(){let o=arguments.length>1?arguments[1]:void 0,H=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const o=this.getLocalMatrix();H.x=o.m[12],H.y=o.m[13],H.z=o.m[14]}else{let n=null;o&&(n=o.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let E=O._TmpMats[0];o&&n?(E.S(this.getAbsoluteMatrix()),E.multiplyToRef(n,E)):E=this.getAbsoluteMatrix(),H.x=E.m[12],H.y=E.m[13],H.z=E.m[14]}}getAbsolutePosition(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const H=E.xH.Zero();return this.getPositionToRef(1,o,H),H}getAbsolutePositionToRef(o,H){this.getPositionToRef(1,o,H)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.wA.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.S(this.wA);const o=this._skeleton.getPoseMatrix();o&&this._absoluteMatrix.multiplyToRef(o,this._absoluteMatrix)}const o=this.children,H=o.length;for(let n=0;n<H;n++)o[n].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Vy(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=E.xH.Zero();return this.getDirectionToRef(o,H,n),n}getDirectionToRef(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,k=null;H&&(k=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const g=O._TmpMats[0];g.S(this.getAbsoluteMatrix()),H&&k&&g.multiplyToRef(k,g),E.xH.TransformNormalToRef(o,g,n),n.normalize()}getRotation(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=E.xH.Zero();return this.getRotationToRef(o,H,n),n}getRotationToRef(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;const E=O._TmpQuat;this.getRotationQuaternionToRef(o,H,E),E.toEulerAnglesToRef(n)}getRotationQuaternion(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=E.Quaternion.Identity();return this.getRotationQuaternionToRef(o,H,n),n}getRotationQuaternionToRef(){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),H.S(this._localRotation);else{const n=O._TmpMats[0],E=this.getAbsoluteMatrix();o?E.multiplyToRef(o.getWorldMatrix(),n):n.S(E),n.multiplyAtIndex(0,this._scalingDeterminant),n.multiplyAtIndex(1,this._scalingDeterminant),n.multiplyAtIndex(2,this._scalingDeterminant),n.decompose(void 0,H,void 0)}}getRotationMatrix(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1?arguments[1]:void 0;const n=E.Matrix.Identity();return this.getRotationMatrixToRef(o,H,n),n}getRotationMatrixToRef(){let o=arguments.length>1?arguments[1]:void 0,H=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(H);else{const n=O._TmpMats[0],E=this.getAbsoluteMatrix();o?E.multiplyToRef(o.getWorldMatrix(),n):n.S(E),n.multiplyAtIndex(0,this._scalingDeterminant),n.multiplyAtIndex(1,this._scalingDeterminant),n.multiplyAtIndex(2,this._scalingDeterminant),n.getRotationMatrixToRef(H)}}getAbsolutePositionFromLocal(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=E.xH.Zero();return this.getAbsolutePositionFromLocalToRef(o,H,n),n}getAbsolutePositionFromLocalToRef(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,k=null;H&&(k=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const g=O._TmpMats[0];g.S(this.getAbsoluteMatrix()),H&&k&&g.multiplyToRef(k,g),E.xH.TransformCoordinatesToRef(o,g,n)}getLocalPositionFromAbsolute(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=E.xH.Zero();return this.getLocalPositionFromAbsoluteToRef(o,H,n),n}getLocalPositionFromAbsoluteToRef(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,k=null;H&&(k=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const g=O._TmpMats[0];g.S(this.getAbsoluteMatrix()),H&&k&&g.multiplyToRef(k,g),g.invert(),E.xH.TransformCoordinatesToRef(o,g,n)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const o=this._skeleton.bones.indexOf(this);if(-1!==o&&this._skeleton.bones.splice(o,1),this._parentNode&&this._parentNode.children){const o=this._parentNode.children,H=o.indexOf(this);-1!==H&&o.splice(H,1)}super.dispose()}}O._TmpVecs=(0,k.b)(2,E.xH.Zero),O._TmpQuat=E.Quaternion.Identity(),O._TmpMats=(0,k.b)(5,E.Matrix.Identity)},13406:(o,H,n)=>{"use strict";n.d(H,{d:()=>q});var E=n(11170),k=n(11177),g=n(11026),O=n(11189),Y=n(11205),y=n(11623),S=n(11652),G=n(11483),c=n(11042),A=n(11196);class l{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(o){this._zoomStopsAnimation=o}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(o){this._idleRotationSpeed=o}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(o){this._idleRotationWaitTime=o}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(o){this._idleRotationSpinupTime=o}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(o){this._attachedCamera=o;const H=this._attachedCamera.bo();this._onPrePointerObservableObserver=H.onPrePointerObservable.add((o=>{o.type!==G.b.POINTERDOWN?o.type===G.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=o.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const o=c.b.Now;let H=0;null!=this._lastFrameTime&&(H=o-this._lastFrameTime),this._lastFrameTime=o,this._applyUserInteraction();const n=o-this._lastInteractionTime-this._idleRotationWaitTime,E=Math.max(Math.min(n/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*E,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(H/1e3))}))}detach(){if(!this._attachedCamera)return;const o=this._attachedCamera.bo();this._onPrePointerObservableObserver&&o.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(o){this._lastInteractionTime=o??c.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<A.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let o=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(o=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?o:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=c.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var x=n(13415),z=n(11717);class V{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(o){if(this._autoTransitionRange===o)return;this._autoTransitionRange=o;const H=this._attachedCamera;H&&(o?this._onMeshTargetChangedObserver=H.onMeshTargetChangedObservable.add((o=>{if(o&&(o.Ig(!0),o.getBoundingInfo)){const H=o.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*H,this.upperRadiusTransitionRange=.05*H}})):this._onMeshTargetChangedObserver&&H.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(o){this._attachedCamera=o,this._onAfterCheckInputsObserver=o.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(o){return!!this._attachedCamera&&(this._attachedCamera.radius===o&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(o){if(!this._attachedCamera)return;this._radiusBounceTransition||(V.EasingFunction.setEasingMode(V.EasingMode),this._radiusBounceTransition=z.b.CreateAnimation("radius",z.b.ANIMATIONTYPE_FLOAT,60,V.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const H=z.b.TransitionTo("radius",this._attachedCamera.radius+o,this._attachedCamera,this._attachedCamera.bo(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));H&&this._animatables.push(H)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}V.EasingFunction=new x.b(.3),V.EasingMode=x.l.EASINGMODE_EASEOUT;class J{constructor(){this.onTargetFramingAnimationEndObservable=new g.d,this._mode=J.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(o){this._mode=o}get mode(){return this._mode}set radiusScale(o){this._radiusScale=o}get radiusScale(){return this._radiusScale}set positionScale(o){this._positionScale=o}get positionScale(){return this._positionScale}set defaultElevation(o){this._defaultElevation=o}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(o){this._elevationReturnTime=o}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(o){this._elevationReturnWaitTime=o}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(o){this._zoomStopsAnimation=o}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(o){this._framingTime=o}get framingTime(){return this._framingTime}init(){}attach(o){this._attachedCamera=o;const H=this._attachedCamera.bo();J.EasingFunction.setEasingMode(J.EasingMode),this._onPrePointerObservableObserver=H.onPrePointerObservable.add((o=>{o.type!==G.b.POINTERDOWN?o.type===G.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=o.onMeshTargetChangedObservable.add((o=>{o&&o.getBoundingInfo&&this.zoomOnMesh(o,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=o.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const o=this._attachedCamera.bo();this._onPrePointerObservableObserver&&o.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(o){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o.Ig(!0);const E=o.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(E.minimumWorld,E.maximumWorld,H,n)}zoomOnMeshHierarchy(o){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o.Ig(!0);const E=o.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(E.min,E.max,H,n)}zoomOnMeshesHierarchy(o){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new O.xH(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),k=new O.xH(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let g=0;g<o.length;g++){const H=o[g].getHierarchyBoundingVectors(!0);O.xH.CheckExtends(H.min,E,k),O.xH.CheckExtends(H.max,E,k)}this.zoomOnBoundingInfo(E,k,H,n)}zoomOnBoundingInfo(o,H){let n,E=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const g=o.y,Y=g+(H.y-g)*this._positionScale,y=H.zH(o).scale(.5);if(!isFinite(Y))return!1;if(E)n=new O.xH(0,Y,0);else{const H=o.add(y);n=new O.xH(H.x,Y,H.z)}this._vectorTransition||(this._vectorTransition=z.b.CreateAnimation("target",z.b.ANIMATIONTYPE_VECTOR3,60,J.EasingFunction)),this._betaIsAnimating=!0;let S=z.b.TransitionTo("target",n,this._attachedCamera,this._attachedCamera.bo(),60,this._vectorTransition,this._framingTime);S&&this._animatables.push(S);let G=0;if(this._mode===J.FitFrustumSidesMode){const n=this._calculateLowerRadiusFromModelBoundingSphere(o,H);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=y.length()+this._attachedCamera.Cg),G=n}else this._mode===J.IgnoreBoundsSizeMode&&(G=this._calculateLowerRadiusFromModelBoundingSphere(o,H),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Cg));if(this.autoCorrectCameraLimitsAndSensibility){const n=H.zH(o).length();this._attachedCamera.panningSensibility=5e3/n,this._attachedCamera.wheelPrecision=100/G}return this._radiusTransition||(this._radiusTransition=z.b.CreateAnimation("radius",z.b.ANIMATIONTYPE_FLOAT,60,J.EasingFunction)),S=z.b.TransitionTo("radius",G,this._attachedCamera,this._attachedCamera.bo(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),k&&k(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),S&&this._animatables.push(S),!0}_calculateLowerRadiusFromModelBoundingSphere(o,H){const n=this._attachedCamera;if(!n)return 0;let E=n._calculateLowerRadiusFromModelBoundingSphere(o,H,this._radiusScale);return n.lowerRadiusLimit&&this._mode===J.IgnoreBoundsSizeMode&&(E=E<n.lowerRadiusLimit?n.lowerRadiusLimit:E),n.upperRadiusLimit&&(E=E>n.upperRadiusLimit?n.upperRadiusLimit:E),E}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const o=c.b.Now-this._lastInteractionTime,H=.5*Math.PI-this._defaultElevation,n=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>n&&o>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=z.b.CreateAnimation("beta",z.b.ANIMATIONTYPE_FLOAT,60,J.EasingFunction));const o=z.b.TransitionTo("beta",H,this._attachedCamera,this._attachedCamera.bo(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));o&&this._animatables.push(o)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=c.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}J.EasingFunction=new x.s,J.EasingMode=x.l.EASINGMODE_EASEINOUT,J.IgnoreBoundsSizeMode=0,J.FitFrustumSidesMode=1;var N=n(11659),h=n(11686),Q=n(12843),p=n(11024);class j{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(o){o=p.Tools.BackCompatCameraNoPreventDefault(arguments);const H=this.camera.getEngine(),n=H.getInputElement();let E=0,k=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=g=>{var O,Y;const y=g.event,S="touch"===y.pointerType;if(g.type!==G.b.POINTERMOVE&&-1===this.buttons.indexOf(y.button))return;const c=y.target;if(this._altKey=y.altKey,this._ctrlKey=y.ctrlKey,this._metaKey=y.metaKey,this._shiftKey=y.shiftKey,this._buttonsPressed=y.buttons,H.isPointerLock){const o=y.movementX,H=y.movementY;this.onTouch(null,o,H),this._pointA=null,this._pointB=null}else{if(g.type!==G.b.POINTERDOWN&&g.type!==G.b.POINTERDOUBLETAP&&S&&(null===(O=this._pointA)||void 0===O?void 0:O.pointerId)!==y.pointerId&&(null===(Y=this._pointB)||void 0===Y?void 0:Y.pointerId)!==y.pointerId)return;if(g.type!==G.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!S)if(g.type===G.b.POINTERDOUBLETAP)this.onDoubleTap(y.pointerType);else if(g.type!==G.b.POINTERUP||this._currentMousePointerIdDown!==y.pointerId&&!S){if(g.type===G.b.POINTERMOVE)if(o||y.preventDefault(),this._pointA&&null===this._pointB){const o=y.clientX-this._pointA.x,H=y.clientY-this._pointA.y;this._pointA.x=y.clientX,this._pointA.y=y.clientY,this.onTouch(this._pointA,o,H)}else if(this._pointA&&this._pointB){const o=this._pointA.pointerId===y.pointerId?this._pointA:this._pointB;o.x=y.clientX,o.y=y.clientY;const H=this._pointA.x-this._pointB.x,n=this._pointA.y-this._pointB.y,O=H*H+n*n,Y={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:y.pointerId,type:g.type};this.onMultiTouch(this._pointA,this._pointB,E,O,k,Y),k=Y,E=O}}else{try{null===c||void 0===c||c.releasePointerCapture(y.pointerId)}catch(A){}S||(this._pointB=null),H._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==y.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==y.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==E||k)&&(this.onMultiTouch(this._pointA,this._pointB,E,0,k,null),E=0,k=null),this._currentMousePointerIdDown=-1,this.onButtonUp(y),o||y.preventDefault()}else{try{null===c||void 0===c||c.setPointerCapture(y.pointerId)}catch(A){}if(null===this._pointA)this._pointA={x:y.clientX,y:y.clientY,pointerId:y.pointerId,type:y.pointerType};else{if(null!==this._pointB)return;this._pointB={x:y.clientX,y:y.clientY,pointerId:y.pointerId,type:y.pointerType}}-1!==this._currentMousePointerIdDown||S||(this._currentMousePointerIdDown=y.pointerId),this.onButtonDown(y),o||(y.preventDefault(),n&&n.focus())}}},this._observer=this.camera.bo()._inputManager._addCameraPointerObserver(this._pointerInput,G.b.POINTERDOWN|G.b.POINTERUP|G.b.POINTERMOVE|G.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,E=0,k=null,this.onLostFocus()},this._contextMenuBind=o=>this.onContextMenu(o),n&&n.addEventListener("contextmenu",this._contextMenuBind,!1);const g=this.camera.bo().getEngine().getHostWindow();g&&p.Tools.RegisterTopRootEvents(g,[{name:"blur",handler:this._onLostFocus}])}EA(){if(this._onLostFocus){const o=this.camera.bo().getEngine().getHostWindow();o&&p.Tools.UnregisterTopRootEvents(o,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.bo()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const o=this.camera.bo().getEngine().getInputElement();o&&o.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(o){}onTouch(o,H,n){}onMultiTouch(o,H,n,E,k,g){}onContextMenu(o){o.preventDefault()}onButtonDown(o){}onButtonUp(o){}onLostFocus(){}}(0,E.c)([(0,k.P)()],j.prototype,"buttons",void 0);class m extends j{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(o,H){if(0!==this.panningSensibility&&o&&H){const n=H.x-o.x,E=H.y-o.y;this.camera.inertialPanningX+=-n/this.panningSensibility,this.camera.inertialPanningY+=E/this.panningSensibility}}_computePinchZoom(o,H){const n=this.camera.radius||m.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=n*Math.sqrt(o)/Math.sqrt(H):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(H-o)*n*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(H-o)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(o,H,n){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-H/this.panningSensibility,this.camera.inertialPanningY+=n/this.panningSensibility):(this.camera.inertialAlphaOffset-=H/this.angularSensibilityX,this.camera.inertialBetaOffset-=n/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(o,H,n,E,k,g){0===n&&null===k||0===E&&null===g||(this.multiTouchPanAndZoom?(this._computePinchZoom(n,E),this._computeMultiTouchPanning(k,g)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(E)-Math.sqrt(n))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(n,E),this._isPinching=!0):this._computeMultiTouchPanning(k,g)):this.multiTouchPanning?this._computeMultiTouchPanning(k,g):this.pinchZoom&&this._computePinchZoom(n,E))}onButtonDown(o){this._isPanClick=o.button===this.camera._panningMouseButton}onButtonUp(o){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}m.MinimumRadiusForPinch=.001,(0,E.c)([(0,k.P)()],m.prototype,"buttons",void 0),(0,E.c)([(0,k.P)()],m.prototype,"angularSensibilityX",void 0),(0,E.c)([(0,k.P)()],m.prototype,"angularSensibilityY",void 0),(0,E.c)([(0,k.P)()],m.prototype,"pinchPrecision",void 0),(0,E.c)([(0,k.P)()],m.prototype,"pinchDeltaPercentage",void 0),(0,E.c)([(0,k.P)()],m.prototype,"useNaturalPinchZoom",void 0),(0,E.c)([(0,k.P)()],m.prototype,"pinchZoom",void 0),(0,E.c)([(0,k.P)()],m.prototype,"panningSensibility",void 0),(0,E.c)([(0,k.P)()],m.prototype,"multiTouchPanning",void 0),(0,E.c)([(0,k.P)()],m.prototype,"multiTouchPanAndZoom",void 0),Q.b.ArcRotateCameraPointersInput=m;var P=n(11491);class b{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(o){o=p.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.bo(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((H=>{const n=H.event;if(!n.metaKey)if(H.type===P.d.KEYDOWN){if(this._ctrlPressed=n.ctrlKey,this._altPressed=n.altKey,-1!==this.keysUp.indexOf(n.keyCode)||-1!==this.keysDown.indexOf(n.keyCode)||-1!==this.keysLeft.indexOf(n.keyCode)||-1!==this.keysRight.indexOf(n.keyCode)||-1!==this.keysReset.indexOf(n.keyCode)){-1===this._keys.indexOf(n.keyCode)&&this._keys.push(n.keyCode),n.preventDefault&&(o||n.preventDefault())}}else if(-1!==this.keysUp.indexOf(n.keyCode)||-1!==this.keysDown.indexOf(n.keyCode)||-1!==this.keysLeft.indexOf(n.keyCode)||-1!==this.keysRight.indexOf(n.keyCode)||-1!==this.keysReset.indexOf(n.keyCode)){const H=this._keys.indexOf(n.keyCode);H>=0&&this._keys.splice(H,1),n.preventDefault&&(o||n.preventDefault())}})))}EA(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const o=this.camera;for(let H=0;H<this._keys.length;H++){const n=this._keys[H];-1!==this.keysLeft.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?o.inertialPanningX-=1/this.panningSensibility:o.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?o.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?o.inertialRadiusOffset+=1/this.zoomingSensibility:o.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?o.inertialPanningX+=1/this.panningSensibility:o.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(n)?this._ctrlPressed&&this.camera._useCtrlForPanning?o.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?o.inertialRadiusOffset-=1/this.zoomingSensibility:o.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(n)&&o.useInputToRestoreState&&o.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,E.c)([(0,k.P)()],b.prototype,"keysUp",void 0),(0,E.c)([(0,k.P)()],b.prototype,"keysDown",void 0),(0,E.c)([(0,k.P)()],b.prototype,"keysLeft",void 0),(0,E.c)([(0,k.P)()],b.prototype,"keysRight",void 0),(0,E.c)([(0,k.P)()],b.prototype,"keysReset",void 0),(0,E.c)([(0,k.P)()],b.prototype,"panningSensibility",void 0),(0,E.c)([(0,k.P)()],b.prototype,"zoomingSensibility",void 0),(0,E.c)([(0,k.P)()],b.prototype,"useAltToZoom",void 0),(0,E.c)([(0,k.P)()],b.prototype,"angularSpeed",void 0),Q.b.ArcRotateCameraKeyboardMoveInput=b;var e=n(11242),Z=n(11493);class M{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new O.xH(0,0,0),this._globalOffset=new O.xH(0,0,0),this._inertialPanning=O.xH.Zero()}_computeDeltaFromMouseWheelLegacyEvent(o,H){let n=0;const E=.01*o*this.wheelDeltaPercentage*H;return n=o>0?E/(1+this.wheelDeltaPercentage):E*(1+this.wheelDeltaPercentage),n}attachControl(o){o=p.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=H=>{if(H.type!==G.b.POINTERWHEEL)return;const n=H.event;let E=0;const k=n.deltaMode===Z.b.DOM_DELTA_LINE?40:1,g=-n.deltaY*k;if(this.customComputeDeltaFromMouseWheel)E=this.customComputeDeltaFromMouseWheel(g,this,n);else if(this.wheelDeltaPercentage){if(E=this._computeDeltaFromMouseWheelLegacyEvent(g,this.camera.radius),E>0){let o=this.camera.radius,H=this.camera.inertialRadiusOffset+E;for(let n=0;n<20&&!(o<=H)&&!(Math.abs(H*this.camera.inertia)<.001);n++)o-=H,H*=this.camera.inertia;o=(0,Y.Clamp)(o,0,Number.MAX_VALUE),E=this._computeDeltaFromMouseWheelLegacyEvent(g,o)}}else E=g/(40*this.wheelPrecision);E&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(E)):this.camera.inertialRadiusOffset+=E),n.preventDefault&&(o||n.preventDefault())},this._observer=this.camera.bo()._inputManager._addCameraPointerObserver(this._wheel,G.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.AY(0)}EA(){this._observer&&(this.camera.bo()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const o=this.camera;0+o.inertialAlphaOffset+o.inertialBetaOffset+o.inertialRadiusOffset&&(this._updateHitPlane(),o.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(o.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const o=this.camera,H=o.target.zH(o.position);this._hitPlane=e.c.FromPositionAndNormal(o.target,H)}_getPosition(){const o=this.camera,H=o.bo(),n=H.createPickingRay(H.pointerX,H.pointerY,O.Matrix.Identity(),o,!1);0===o.targetScreenOffset.x&&0===o.targetScreenOffset.y||(this._viewOffset.set(o.targetScreenOffset.x,o.targetScreenOffset.y,0),o.getViewMatrix().invertToRef(o._cameraTransformMatrix),this._globalOffset=O.xH.TransformNormal(this._viewOffset,o._cameraTransformMatrix),n.origin.addInPlace(this._globalOffset));let E=0;return this._hitPlane&&(E=n.intersectsPlane(this._hitPlane)??0),n.origin.addInPlace(n.direction.scaleInPlace(E))}_zoomToMouse(o){const H=this.camera,n=1-H.inertia;if(H.lowerRadiusLimit){const E=H.lowerRadiusLimit??0;H.radius-(H.inertialRadiusOffset+o)/n<E&&(o=(H.radius-E)*n-H.inertialRadiusOffset)}if(H.upperRadiusLimit){const E=H.upperRadiusLimit??0;H.radius-(H.inertialRadiusOffset+o)/n>E&&(o=(H.radius-E)*n-H.inertialRadiusOffset)}const E=o/n/H.radius,k=this._getPosition(),g=O.TmpVectors.xH[6];k.subtractToRef(H.target,g),g.scaleInPlace(E),g.scaleInPlace(n),this._inertialPanning.addInPlace(g),H.inertialRadiusOffset+=o}_zeroIfClose(o){Math.abs(o.x)<A.e&&(o.x=0),Math.abs(o.y)<A.e&&(o.y=0),Math.abs(o.z)<A.e&&(o.z=0)}}(0,E.c)([(0,k.P)()],M.prototype,"wheelPrecision",void 0),(0,E.c)([(0,k.P)()],M.prototype,"zoomToMouseLocation",void 0),(0,E.c)([(0,k.P)()],M.prototype,"wheelDeltaPercentage",void 0),Q.b.ArcRotateCameraMouseWheelInput=M;class K extends Q.e{constructor(o){super(o)}addMouseWheel(){return this.add(new M),this}addPointers(){return this.add(new m),this}addKeyboard(){return this.add(new b),this}}var f=n(11140);function B(o,H){return isNaN(o)?H:o}y.b.AddNodeConstructor("ArcRotateCamera",((o,H)=>()=>new q(o,0,0,1,O.xH.Zero(),H)));class q extends h.b{get target(){return this._target}set target(o){this.setTarget(o)}get targetHost(){return this._targetHost}set targetHost(o){o&&this.setTarget(o)}getTarget(){return this.target}get position(){return this._position}set position(o){this.setPosition(o)}set upVector(o){this._upToYMatrix||(this._yToUpMatrix=new O.Matrix,this._upToYMatrix=new O.Matrix,this._upVector=O.xH.Zero()),o.normalize(),this._upVector.S(o),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){O.Matrix.RotationAlignToRef(O.xH.UpReadOnly,this._upVector,this._yToUpMatrix),O.Matrix.RotationAlignToRef(this._upVector,O.xH.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const o=this.inputs.attached.pointers;return o?o.angularSensibilityX:0}set angularSensibilityX(o){const H=this.inputs.attached.pointers;H&&(H.angularSensibilityX=o)}get angularSensibilityY(){const o=this.inputs.attached.pointers;return o?o.angularSensibilityY:0}set angularSensibilityY(o){const H=this.inputs.attached.pointers;H&&(H.angularSensibilityY=o)}get pinchPrecision(){const o=this.inputs.attached.pointers;return o?o.pinchPrecision:0}set pinchPrecision(o){const H=this.inputs.attached.pointers;H&&(H.pinchPrecision=o)}get pinchDeltaPercentage(){const o=this.inputs.attached.pointers;return o?o.pinchDeltaPercentage:0}set pinchDeltaPercentage(o){const H=this.inputs.attached.pointers;H&&(H.pinchDeltaPercentage=o)}get useNaturalPinchZoom(){const o=this.inputs.attached.pointers;return!!o&&o.useNaturalPinchZoom}set useNaturalPinchZoom(o){const H=this.inputs.attached.pointers;H&&(H.useNaturalPinchZoom=o)}get panningSensibility(){const o=this.inputs.attached.pointers;return o?o.panningSensibility:0}set panningSensibility(o){const H=this.inputs.attached.pointers;H&&(H.panningSensibility=o)}get keysUp(){const o=this.inputs.attached.keyboard;return o?o.keysUp:[]}set keysUp(o){const H=this.inputs.attached.keyboard;H&&(H.keysUp=o)}get keysDown(){const o=this.inputs.attached.keyboard;return o?o.keysDown:[]}set keysDown(o){const H=this.inputs.attached.keyboard;H&&(H.keysDown=o)}get keysLeft(){const o=this.inputs.attached.keyboard;return o?o.keysLeft:[]}set keysLeft(o){const H=this.inputs.attached.keyboard;H&&(H.keysLeft=o)}get keysRight(){const o=this.inputs.attached.keyboard;return o?o.keysRight:[]}set keysRight(o){const H=this.inputs.attached.keyboard;H&&(H.keysRight=o)}get wheelPrecision(){const o=this.inputs.attached.mousewheel;return o?o.wheelPrecision:0}set wheelPrecision(o){const H=this.inputs.attached.mousewheel;H&&(H.wheelPrecision=o)}get zoomToMouseLocation(){const o=this.inputs.attached.mousewheel;return!!o&&o.zoomToMouseLocation}set zoomToMouseLocation(o){const H=this.inputs.attached.mousewheel;H&&(H.zoomToMouseLocation=o)}get wheelDeltaPercentage(){const o=this.inputs.attached.mousewheel;return o?o.wheelDeltaPercentage:0}set wheelDeltaPercentage(o){const H=this.inputs.attached.mousewheel;H&&(H.wheelDeltaPercentage=o)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(o){o!==this.useBouncingBehavior&&(o?(this._bouncingBehavior=new V,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(o){o!==this.useFramingBehavior&&(o?(this._framingBehavior=new J,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(o){o!==this.useAutoRotationBehavior&&(o?(this._autoRotationBehavior=new l,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(o,H,n,E,k,Y){var y;let S=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(o,O.xH.Zero(),Y,S),y=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=O.xH.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=O.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new O.Matrix,this.panningAxis=new O.xH(1,1,0),this._transformedDirection=new O.xH,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new g.d,this.checkCollisions=!1,this.collisionRadius=new O.xH(.5,.5,.5),this._previousPosition=O.xH.Zero(),this._collisionVelocity=O.xH.Zero(),this._newPosition=O.xH.Zero(),this._computationVector=O.xH.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new O.xH(NaN,NaN,NaN),this._goalTargetScreenOffset=new O.Vector2(NaN,NaN),this._onCollisionPositionChange=function(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n?(y.setPosition(H),y.Cl&&y.Cl(n)):y._previousPosition.S(y._position);const E=Math.cos(y.alpha),k=Math.sin(y.alpha),g=Math.cos(y.beta);let O=Math.sin(y.beta);0===O&&(O=1e-4);const Y=y._getTargetPosition();y._computationVector.Wg(y.radius*E*O,y.radius*g,y.radius*k*O),Y.addToRef(y._computationVector,y._newPosition),y._position.S(y._newPosition);let S=y.upVector;y.allowUpsideDown&&y.beta<0&&(S=S.clone(),S=S.negate()),y._computeViewMatrix(y._position,Y,S),y._viewMatrix.addAtIndex(12,y.targetScreenOffset.x),y._viewMatrix.addAtIndex(13,y.targetScreenOffset.y),y._collisionTriggered=!1},this._target=O.xH.Zero(),k&&this.setTarget(k),this.alpha=H,this.beta=n,this.radius=E,this.getViewMatrix(),this.inputs=new K(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new O.xH(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=O.Vector2.Zero()}_updateCache(o){o||super._updateCache(),this._cache._target.S(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.S(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const o=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?o.addToRef(this._targetBoundingCenter,this._target):this._target.S(o)}const o=this._getLockedTargetPosition();return o||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>A.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,g=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=g?this._currentInterpolationFactor=g:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=B(o,this._goalAlpha),this._goalBeta=B(H,this._goalBeta),this._goalRadius=B(n,this._goalRadius),this._goalTarget.set(B(E.x,this._goalTarget.x),B(E.y,this._goalTarget.y),B(E.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(B(k.x,this._goalTargetScreenOffset.x),B(k.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,Y.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,Y.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,Y.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,Y.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(o,H){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const k=arguments;H=p.Tools.BackCompatCameraNoPreventDefault(k),this._useCtrlForPanning=n,this._panningMouseButton=E,"boolean"===typeof k[0]&&(k.length>1&&(this._useCtrlForPanning=k[1]),k.length>2&&(this._panningMouseButton=k[2])),this.inputs.attachElement(H),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}EA(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let o=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){o=!0;const H=this.invertRotation?-1:1,n=this._calculateHandednessMultiplier();let E=this.inertialAlphaOffset*n;this.beta<0&&(E*=-1),this.alpha+=E*H,this.beta+=this.inertialBetaOffset*H,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<A.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<A.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*A.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){o=!0;const H=new O.xH(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),H.multiplyInPlace(this.panningAxis),O.xH.TransformNormalToRef(H,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const o=this.upVector,H=O.xH.CrossToRef(this._transformedDirection,o,this._transformedDirection);O.xH.CrossToRef(o,H,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);O.xH.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.S(this._transformedDirection)}else{if(this.parent){const o=O.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(o),o.transposeToRef(o),O.xH.TransformCoordinatesToRef(this._transformedDirection,o,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*A.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*A.e&&(this.inertialPanningY=0)}if(o)this.stopInterpolation();else if(this._isInterpolating){let o=!1;const H=this._scene.getEngine().getDeltaTime()/1e3,n=1-Math.pow(2,-H/this._currentInterpolationFactor),E=B(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const H=O.TmpVectors.xH[0].set(B(this._goalTarget.x,this._target.x),B(this._goalTarget.y,this._target.y),B(this._goalTarget.z,this._target.z));O.xH.LerpToRef(this.target,H,n,this._target),10*O.xH.Distance(this.target,H)/E<A.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.S(H),this.setTarget(this.target,!1,!0,!0)):o=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const H=O.Quaternion.RotationAlphaBetaGammaToRef(B(this._goalAlpha,this.alpha),B(this._goalBeta,this.beta),0,O.TmpVectors.Quaternion[0]),E=O.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,O.TmpVectors.Quaternion[1]),k=O.Quaternion.SlerpToRef(E,H,n,O.TmpVectors.Quaternion[2]);k.normalize();const g=k.toAlphaBetaGammaToRef(O.TmpVectors.xH[0]);if(this.alpha=g.x,this.beta=g.y,k.isApprox(H,A.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const o=H.toAlphaBetaGammaToRef(O.TmpVectors.xH[0]);this.alpha=o.x,this.beta=o.y}else o=!0}if(isNaN(this._goalRadius)||(this.radius+=(E-this.radius)*n,Math.abs(E/this.radius-1)<A.e?(this._goalRadius=NaN,this.radius=E):o=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const H=O.TmpVectors.Vector2[0].set(B(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),B(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));O.Vector2.LerpToRef(this.targetScreenOffset,H,n,this.targetScreenOffset),O.Vector2.Distance(this.targetScreenOffset,H)<A.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.S(H)):o=!0}this._isInterpolating=o}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||O.xH.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const o=this.alpha;var H,n;this.alpha=function(o){let H=Math.PI/2;return 0===o.x&&0===o.z||(H=Math.acos(o.x/Math.sqrt(Math.pow(o.x,2)+Math.pow(o.z,2)))),o.z<0&&(H=2*Math.PI-H),H}(this._computationVector),this.beta=(H=this._computationVector.y,n=this.radius,Math.acos(H/n));const E=Math.round((o-this.alpha)/(2*Math.PI));this.alpha+=2*E*Math.PI,this._checkLimits()}setPosition(o){this._position.equals(o)||(this._position.S(o),this.rebuildAnglesAndRadius())}setTarget(o){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],E=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(E=this.overrideCloneAlphaBetaRadius??E,o.Ig)H&&o.getBoundingInfo?this._targetBoundingCenter=o.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,o.Ig(),this._targetHost=o,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const H=o,E=this._getTargetPosition();if(E&&!n&&E.equals(H))return;this._targetHost=null,this._target=H,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}E||this.rebuildAnglesAndRadius()}_getViewMatrix(){const o=Math.cos(this.alpha),H=Math.sin(this.alpha),n=Math.cos(this.beta);let E=Math.sin(this.beta);0===E&&(E=1e-4),0===this.radius&&(this.radius=1e-4);const k=this._getTargetPosition();if(this._computationVector.Wg(this.radius*o*E,this.radius*n,this.radius*H*E),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||O.xH.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),k.addToRef(this._computationVector,this._newPosition),this.bo().collisionsEnabled&&this.checkCollisions){const o=this.bo().collisionCoordinator;this._collider||(this._collider=o.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,o.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.S(this._newPosition);let o=this.upVector;this.allowUpsideDown&&E<0&&(o=o.negate()),this._computeViewMatrix(this._position,k,o),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.S(k),this._viewMatrix}zoomOn(o){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o=o||this.bo().meshes;const n=S.b.MinMax(o);let E=this._calculateLowerRadiusFromModelBoundingSphere(n.min,n.max);if(E=Math.max(Math.min(E,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=E*this.zoomOnFactor,this.mode===N.b.ORTHOGRAPHIC_CAMERA){const o=this.bo().getEngine().getAspectRatio(this),H=E*this.zoomOnFactor/2;this.orthoLeft=-H*o,this.orthoRight=H*o,this.orthoBottom=-H,this.orthoTop=H}this.focusOn({min:n.min,max:n.max,distance:E},H)}focusOn(o){let H,n,E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===o.min){const E=o||this.bo().meshes;H=S.b.MinMax(E),n=O.xH.Distance(H.min,H.max)}else{H=o,n=o.distance}this._target=S.b.Center(H),E||(this.maxZ=2*n)}createRigCamera(o,H){let n=0;switch(this.cameraRigMode){case N.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case N.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case N.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case N.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case N.b.RIG_MODE_VR:n=this._cameraRigParams.stereoHalfAngle*(0===H?1:-1);break;case N.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:n=this._cameraRigParams.stereoHalfAngle*(0===H?-1:1)}const E=new q(o,this.alpha+n,this.beta,this.radius,this._target,this.bo());return E._cameraRigParams={},E.isRigCamera=!0,E.rigParent=this,E.upVector=this.upVector,E.mode=this.mode,E.orthoLeft=this.orthoLeft,E.orthoRight=this.orthoRight,E.orthoBottom=this.orthoBottom,E.orthoTop=this.orthoTop,E}_updateRigCameras(){const o=this._rigCameras[0],H=this._rigCameras[1];switch(o.beta=H.beta=this.beta,this.cameraRigMode){case N.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case N.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case N.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case N.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case N.b.RIG_MODE_VR:o.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,H.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case N.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:o.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,H.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const E=O.xH.Distance(o,H),k=this.bo().getEngine().getAspectRatio(this),g=Math.tan(this.fov/2),Y=g*k,y=.5*E*n,S=y*Math.sqrt(1+1/(Y*Y)),G=y*Math.sqrt(1+1/(g*g));return Math.max(S,G)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,E.c)([(0,k.P)()],q.prototype,"alpha",void 0),(0,E.c)([(0,k.P)()],q.prototype,"beta",void 0),(0,E.c)([(0,k.P)()],q.prototype,"radius",void 0),(0,E.c)([(0,k.P)()],q.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,E.c)([(0,k.L)("target")],q.prototype,"_target",void 0),(0,E.c)([(0,k.A)("targetHost")],q.prototype,"_targetHost",void 0),(0,E.c)([(0,k.P)()],q.prototype,"inertialAlphaOffset",void 0),(0,E.c)([(0,k.P)()],q.prototype,"inertialBetaOffset",void 0),(0,E.c)([(0,k.P)()],q.prototype,"inertialRadiusOffset",void 0),(0,E.c)([(0,k.P)()],q.prototype,"lowerAlphaLimit",void 0),(0,E.c)([(0,k.P)()],q.prototype,"upperAlphaLimit",void 0),(0,E.c)([(0,k.P)()],q.prototype,"lowerBetaLimit",void 0),(0,E.c)([(0,k.P)()],q.prototype,"upperBetaLimit",void 0),(0,E.c)([(0,k.P)()],q.prototype,"lowerRadiusLimit",void 0),(0,E.c)([(0,k.P)()],q.prototype,"upperRadiusLimit",void 0),(0,E.c)([(0,k.P)()],q.prototype,"lowerTargetYLimit",void 0),(0,E.c)([(0,k.P)()],q.prototype,"inertialPanningX",void 0),(0,E.c)([(0,k.P)()],q.prototype,"inertialPanningY",void 0),(0,E.c)([(0,k.P)()],q.prototype,"pinchToPanMaxDistance",void 0),(0,E.c)([(0,k.P)()],q.prototype,"panningDistanceLimit",void 0),(0,E.c)([(0,k.L)()],q.prototype,"panningOriginTarget",void 0),(0,E.c)([(0,k.P)()],q.prototype,"panningInertia",void 0),(0,E.c)([(0,k.P)()],q.prototype,"zoomToMouseLocation",null),(0,E.c)([(0,k.P)()],q.prototype,"zoomOnFactor",void 0),(0,E.c)([(0,k.K)()],q.prototype,"targetScreenOffset",void 0),(0,E.c)([(0,k.P)()],q.prototype,"allowUpsideDown",void 0),(0,E.c)([(0,k.P)()],q.prototype,"useInputToRestoreState",void 0),(0,E.c)([(0,k.P)()],q.prototype,"restoreStateInterpolationFactor",void 0),(0,f.e)("BABYLON.ArcRotateCamera",q)},12843:(o,H,n)=>{"use strict";n.d(H,{b:()=>O,e:()=>Y});var E=n(11038),k=n(11224),g=n(11659),O={};class Y{constructor(o){this.attachedToElement=!1,this.attached={},this.camera=o,this.checkInputs=()=>{}}add(o){const H=o.getSimpleName();this.attached[H]?E.d.Warn("camera input of type "+H+" already exists on camera"):(this.attached[H]=o,o.camera=this.camera,o.checkInputs&&(this.checkInputs=this._addCheckInputs(o.checkInputs.bind(o))),this.attachedToElement&&o.attachControl(this.noPreventDefault))}remove(o){for(const H in this.attached){const n=this.attached[H];if(n===o)return n.EA(),n.camera=null,delete this.attached[H],void this.rebuildInputCheck()}}removeByType(o){for(const H in this.attached){const n=this.attached[H];n.getClassName()===o&&(n.EA(),n.camera=null,delete this.attached[H],this.rebuildInputCheck())}}_addCheckInputs(o){const H=this.checkInputs;return()=>{H(),o()}}attachInput(o){this.attachedToElement&&o.attachControl(this.noPreventDefault)}attachElement(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){o=!g.b.ForceAttachControlToAlwaysPreventDefault&&o,this.attachedToElement=!0,this.noPreventDefault=o;for(const H in this.attached)this.attached[H].attachControl(o)}}detachElement(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const H in this.attached)this.attached[H].EA(),o&&(this.attached[H].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const o in this.attached){const H=this.attached[o];H.checkInputs&&(this.checkInputs=this._addCheckInputs(H.checkInputs.bind(H)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(o){const H={};for(const n in this.attached){const o=this.attached[n],E=k.e.Serialize(o);H[o.getClassName()]=E}o.inputsmgr=H}parse(o){const H=o.inputsmgr;if(H){this.clear();for(const o in H){const n=O[o];if(n){const E=H[o],g=k.e.Parse((()=>new n),E,null);this.add(g)}}}else for(const n in this.attached){const H=O[this.attached[n].getClassName()];if(H){const E=k.e.Parse((()=>new H),o,null);this.remove(this.attached[n]),this.add(E)}}}}},12835:(o,H,n)=>{"use strict";n.d(H,{c:()=>j});var E=n(11170),k=n(11177),g=n(11189),O=n(11686),Y=n(12843),y=n(11491),S=n(11024);class G{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(o){o=S.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.bo(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((H=>{const n=H.event;if(!n.metaKey)if(H.type===y.d.KEYDOWN){if(-1!==this.keysUp.indexOf(n.keyCode)||-1!==this.keysDown.indexOf(n.keyCode)||-1!==this.keysLeft.indexOf(n.keyCode)||-1!==this.keysRight.indexOf(n.keyCode)||-1!==this.keysUpward.indexOf(n.keyCode)||-1!==this.keysDownward.indexOf(n.keyCode)||-1!==this.keysRotateLeft.indexOf(n.keyCode)||-1!==this.keysRotateRight.indexOf(n.keyCode)||-1!==this.keysRotateUp.indexOf(n.keyCode)||-1!==this.keysRotateDown.indexOf(n.keyCode)){-1===this._keys.indexOf(n.keyCode)&&this._keys.push(n.keyCode),o||n.preventDefault()}}else if(-1!==this.keysUp.indexOf(n.keyCode)||-1!==this.keysDown.indexOf(n.keyCode)||-1!==this.keysLeft.indexOf(n.keyCode)||-1!==this.keysRight.indexOf(n.keyCode)||-1!==this.keysUpward.indexOf(n.keyCode)||-1!==this.keysDownward.indexOf(n.keyCode)||-1!==this.keysRotateLeft.indexOf(n.keyCode)||-1!==this.keysRotateRight.indexOf(n.keyCode)||-1!==this.keysRotateUp.indexOf(n.keyCode)||-1!==this.keysRotateDown.indexOf(n.keyCode)){const H=this._keys.indexOf(n.keyCode);H>=0&&this._keys.splice(H,1),o||n.preventDefault()}})))}EA(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const o=this.camera;for(let H=0;H<this._keys.length;H++){const n=this._keys[H],E=o._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(n)?o._localDirection.Wg(-E,0,0):-1!==this.keysUp.indexOf(n)?o._localDirection.Wg(0,0,E):-1!==this.keysRight.indexOf(n)?o._localDirection.Wg(E,0,0):-1!==this.keysDown.indexOf(n)?o._localDirection.Wg(0,0,-E):-1!==this.keysUpward.indexOf(n)?o._localDirection.Wg(0,E,0):-1!==this.keysDownward.indexOf(n)?o._localDirection.Wg(0,-E,0):-1!==this.keysRotateLeft.indexOf(n)?(o._localDirection.Wg(0,0,0),o.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(n)?(o._localDirection.Wg(0,0,0),o.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(n)?(o._localDirection.Wg(0,0,0),o.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(n)&&(o._localDirection.Wg(0,0,0),o.cameraRotation.x+=this._getLocalRotation()),o.bo().useRightHandedSystem&&(o._localDirection.z*=-1),o.getViewMatrix().invertToRef(o._cameraTransformMatrix),g.xH.TransformNormalToRef(o._localDirection,o._cameraTransformMatrix,o._transformedDirection),o.cameraDirection.addInPlace(o._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const o=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*o}}(0,E.c)([(0,k.P)()],G.prototype,"keysUp",void 0),(0,E.c)([(0,k.P)()],G.prototype,"keysUpward",void 0),(0,E.c)([(0,k.P)()],G.prototype,"keysDown",void 0),(0,E.c)([(0,k.P)()],G.prototype,"keysDownward",void 0),(0,E.c)([(0,k.P)()],G.prototype,"keysLeft",void 0),(0,E.c)([(0,k.P)()],G.prototype,"keysRight",void 0),(0,E.c)([(0,k.P)()],G.prototype,"rotationSpeed",void 0),(0,E.c)([(0,k.P)()],G.prototype,"keysRotateLeft",void 0),(0,E.c)([(0,k.P)()],G.prototype,"keysRotateRight",void 0),(0,E.c)([(0,k.P)()],G.prototype,"keysRotateUp",void 0),(0,E.c)([(0,k.P)()],G.prototype,"keysRotateDown",void 0),Y.b.FreeCameraKeyboardMoveInput=G;var c=n(11026),A=n(11483);class l{constructor(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=o,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new c.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(o){o=S.Tools.BackCompatCameraNoPreventDefault(arguments);const H=this.camera.getEngine(),n=H.getInputElement();this._pointerInput||(this._pointerInput=E=>{const k=E.event,g="touch"===k.pointerType;if(!this.touchEnabled&&g)return;if(E.type!==A.b.POINTERMOVE&&-1===this.buttons.indexOf(k.button))return;const O=k.target;if(E.type===A.b.POINTERDOWN){if(g&&-1!==this._activePointerId||!g&&-1!==this._currentActiveButton)return;this._activePointerId=k.pointerId;try{null===O||void 0===O||O.setPointerCapture(k.pointerId)}catch(Y){}-1===this._currentActiveButton&&(this._currentActiveButton=k.button),this._previousPosition={x:k.clientX,y:k.clientY},o||(k.preventDefault(),n&&n.focus()),H.isPointerLock&&this._onMouseMove&&this._onMouseMove(E.event)}else if(E.type===A.b.POINTERUP){if(g&&this._activePointerId!==k.pointerId||!g&&this._currentActiveButton!==k.button)return;try{null===O||void 0===O||O.releasePointerCapture(k.pointerId)}catch(Y){}this._currentActiveButton=-1,this._previousPosition=null,o||k.preventDefault(),this._activePointerId=-1}else if(E.type===A.b.POINTERMOVE&&(this._activePointerId===k.pointerId||!g))if(H.isPointerLock&&this._onMouseMove)this._onMouseMove(E.event);else if(this._previousPosition){const H=this.camera._calculateHandednessMultiplier(),n=(k.clientX-this._previousPosition.x)*H,E=k.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=n/this.angularSensibility,this.camera.cameraRotation.x+=E/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:n,offsetY:E}),this._previousPosition={x:k.clientX,y:k.clientY},o||k.preventDefault()}}),this._onMouseMove=n=>{if(!H.isPointerLock)return;const E=this.camera._calculateHandednessMultiplier(),k=n.movementX*E;this.camera.cameraRotation.y+=k/this.angularSensibility;const g=n.movementY;this.camera.cameraRotation.x+=g/this.angularSensibility,this._previousPosition=null,o||n.preventDefault()},this._observer=this.camera.bo()._inputManager._addCameraPointerObserver(this._pointerInput,A.b.POINTERDOWN|A.b.POINTERUP|A.b.POINTERMOVE),n&&(this._contextMenuBind=o=>this.onContextMenu(o),n.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(o){o.preventDefault()}EA(){if(this._observer){if(this.camera.bo()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const o=this.camera.getEngine().getInputElement();o&&o.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,E.c)([(0,k.P)()],l.prototype,"buttons",void 0),(0,E.c)([(0,k.P)()],l.prototype,"angularSensibility",void 0),Y.b.FreeCameraMouseInput=l;var x,z=n(11493);class V{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new c.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(o){o=S.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=H=>{if(H.type!==A.b.POINTERWHEEL)return;const n=H.event,E=n.deltaMode===z.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*E*n.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*E*n.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*E*n.deltaZ/this._normalize,n.preventDefault&&(o||n.preventDefault())},this._observer=this.camera.bo()._inputManager._addCameraPointerObserver(this._wheel,A.b.POINTERWHEEL)}EA(){this._observer&&(this.camera.bo()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,E.c)([(0,k.P)()],V.prototype,"wheelPrecisionX",void 0),(0,E.c)([(0,k.P)()],V.prototype,"wheelPrecisionY",void 0),(0,E.c)([(0,k.P)()],V.prototype,"wheelPrecisionZ",void 0),function(o){o[o.MoveRelative=0]="MoveRelative",o[o.RotateRelative=1]="RotateRelative",o[o.MoveScene=2]="MoveScene"}(x||(x={}));class J extends V{constructor(){super(...arguments),this._moveRelative=g.xH.Zero(),this._rotateRelative=g.xH.Zero(),this._moveScene=g.xH.Zero(),this._wheelXAction=x.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=x.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(o){null===o&&this._wheelXAction!==x.MoveRelative||(this._wheelXAction=x.MoveRelative,this._wheelXActionCoordinate=o)}get wheelXMoveRelative(){return this._wheelXAction!==x.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(o){null===o&&this._wheelYAction!==x.MoveRelative||(this._wheelYAction=x.MoveRelative,this._wheelYActionCoordinate=o)}get wheelYMoveRelative(){return this._wheelYAction!==x.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(o){null===o&&this._wheelZAction!==x.MoveRelative||(this._wheelZAction=x.MoveRelative,this._wheelZActionCoordinate=o)}get wheelZMoveRelative(){return this._wheelZAction!==x.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(o){null===o&&this._wheelXAction!==x.RotateRelative||(this._wheelXAction=x.RotateRelative,this._wheelXActionCoordinate=o)}get wheelXRotateRelative(){return this._wheelXAction!==x.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(o){null===o&&this._wheelYAction!==x.RotateRelative||(this._wheelYAction=x.RotateRelative,this._wheelYActionCoordinate=o)}get wheelYRotateRelative(){return this._wheelYAction!==x.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(o){null===o&&this._wheelZAction!==x.RotateRelative||(this._wheelZAction=x.RotateRelative,this._wheelZActionCoordinate=o)}get wheelZRotateRelative(){return this._wheelZAction!==x.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(o){null===o&&this._wheelXAction!==x.MoveScene||(this._wheelXAction=x.MoveScene,this._wheelXActionCoordinate=o)}get wheelXMoveScene(){return this._wheelXAction!==x.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(o){null===o&&this._wheelYAction!==x.MoveScene||(this._wheelYAction=x.MoveScene,this._wheelYActionCoordinate=o)}get wheelYMoveScene(){return this._wheelYAction!==x.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(o){null===o&&this._wheelZAction!==x.MoveScene||(this._wheelZAction=x.MoveScene,this._wheelZActionCoordinate=o)}get wheelZMoveScene(){return this._wheelZAction!==x.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.AY(0),this._rotateRelative.AY(0),this._moveScene.AY(0),this._updateCamera(),this.camera.bo().useRightHandedSystem&&(this._moveRelative.z*=-1);const o=g.Matrix.Zero();this.camera.getViewMatrix().invertToRef(o);const H=g.xH.Zero();g.xH.TransformNormalToRef(this._moveRelative,o,H),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(H),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(o,H,n){if(0===o)return;if(null===H||null===n)return;let E=null;switch(H){case x.MoveRelative:E=this._moveRelative;break;case x.RotateRelative:E=this._rotateRelative;break;case x.MoveScene:E=this._moveScene}switch(n){case 0:E.set(o,0,0);break;case 1:E.set(0,o,0);break;case 2:E.set(0,0,o)}}}(0,E.c)([(0,k.P)()],J.prototype,"wheelXMoveRelative",null),(0,E.c)([(0,k.P)()],J.prototype,"wheelYMoveRelative",null),(0,E.c)([(0,k.P)()],J.prototype,"wheelZMoveRelative",null),(0,E.c)([(0,k.P)()],J.prototype,"wheelXRotateRelative",null),(0,E.c)([(0,k.P)()],J.prototype,"wheelYRotateRelative",null),(0,E.c)([(0,k.P)()],J.prototype,"wheelZRotateRelative",null),(0,E.c)([(0,k.P)()],J.prototype,"wheelXMoveScene",null),(0,E.c)([(0,k.P)()],J.prototype,"wheelYMoveScene",null),(0,E.c)([(0,k.P)()],J.prototype,"wheelZMoveScene",null),Y.b.FreeCameraMouseWheelInput=J;class N{constructor(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=o,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=S.Tools.IsSafari()}attachControl(o){o=S.Tools.BackCompatCameraNoPreventDefault(arguments);let H=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=n=>{const E=n.event,k="mouse"===E.pointerType||this._isSafari&&"undefined"===typeof E.pointerType;if(this.allowMouse||!k)if(n.type===A.b.POINTERDOWN){if(o||E.preventDefault(),this._pointerPressed.push(E.pointerId),1!==this._pointerPressed.length)return;H={x:E.clientX,y:E.clientY}}else if(n.type===A.b.POINTERUP){o||E.preventDefault();const n=this._pointerPressed.indexOf(E.pointerId);if(-1===n)return;if(this._pointerPressed.splice(n,1),0!=n)return;H=null,this._offsetX=null,this._offsetY=null}else if(n.type===A.b.POINTERMOVE){if(o||E.preventDefault(),!H)return;if(0!=this._pointerPressed.indexOf(E.pointerId))return;this._offsetX=E.clientX-H.x,this._offsetY=-(E.clientY-H.y)}}),this._observer=this.camera.bo()._inputManager._addCameraPointerObserver(this._pointerInput,A.b.POINTERDOWN|A.b.POINTERUP|A.b.POINTERMOVE),this._onLostFocus){const o=this.camera.getEngine().getInputElement();o&&o.addEventListener("blur",this._onLostFocus)}}EA(){if(this._pointerInput){if(this._observer&&(this.camera.bo()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const o=this.camera.getEngine().getInputElement();o&&o.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const o=this.camera,H=o._calculateHandednessMultiplier();o.cameraRotation.y=H*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)o.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const H=o._computeLocalCameraSpeed(),n=new g.xH(0,0,0!==this.touchMoveSensibility?H*this._offsetY/this.touchMoveSensibility:0);g.Matrix.RotationYawPitchRollToRef(o.rotation.y,o.rotation.x,0,o._cameraRotationMatrix),o.cameraDirection.addInPlace(g.xH.TransformCoordinates(n,o._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,E.c)([(0,k.P)()],N.prototype,"touchAngularSensibility",void 0),(0,E.c)([(0,k.P)()],N.prototype,"touchMoveSensibility",void 0),Y.b.FreeCameraTouchInput=N;class h extends Y.e{constructor(o){super(o),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new G),this}addMouse(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new l(o),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new J,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new N),this}clear(){super.clear(),this._mouseInput=null}}var Q=n(11140),p=n(11093);class j extends O.b{get angularSensibility(){const o=this.inputs.attached.mouse;return o?o.angularSensibility:0}set angularSensibility(o){const H=this.inputs.attached.mouse;H&&(H.angularSensibility=o)}get keysUp(){const o=this.inputs.attached.keyboard;return o?o.keysUp:[]}set keysUp(o){const H=this.inputs.attached.keyboard;H&&(H.keysUp=o)}get keysUpward(){const o=this.inputs.attached.keyboard;return o?o.keysUpward:[]}set keysUpward(o){const H=this.inputs.attached.keyboard;H&&(H.keysUpward=o)}get keysDown(){const o=this.inputs.attached.keyboard;return o?o.keysDown:[]}set keysDown(o){const H=this.inputs.attached.keyboard;H&&(H.keysDown=o)}get keysDownward(){const o=this.inputs.attached.keyboard;return o?o.keysDownward:[]}set keysDownward(o){const H=this.inputs.attached.keyboard;H&&(H.keysDownward=o)}get keysLeft(){const o=this.inputs.attached.keyboard;return o?o.keysLeft:[]}set keysLeft(o){const H=this.inputs.attached.keyboard;H&&(H.keysLeft=o)}get keysRight(){const o=this.inputs.attached.keyboard;return o?o.keysRight:[]}set keysRight(o){const H=this.inputs.attached.keyboard;H&&(H.keysRight=o)}get keysRotateLeft(){const o=this.inputs.attached.keyboard;return o?o.keysRotateLeft:[]}set keysRotateLeft(o){const H=this.inputs.attached.keyboard;H&&(H.keysRotateLeft=o)}get keysRotateRight(){const o=this.inputs.attached.keyboard;return o?o.keysRotateRight:[]}set keysRotateRight(o){const H=this.inputs.attached.keyboard;H&&(H.keysRotateRight=o)}get keysRotateUp(){const o=this.inputs.attached.keyboard;return o?o.keysRotateUp:[]}set keysRotateUp(o){const H=this.inputs.attached.keyboard;H&&(H.keysRotateUp=o)}get keysRotateDown(){const o=this.inputs.attached.keyboard;return o?o.keysRotateDown:[]}set keysRotateDown(o){const H=this.inputs.attached.keyboard;H&&(H.keysRotateDown=o)}constructor(o,H,n){var E;super(o,H,n,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),E=this,this.ellipsoid=new g.xH(.5,1,.5),this.ellipsoidOffset=new g.xH(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=g.xH.Zero(),this._diffPosition=g.xH.Zero(),this._newPosition=g.xH.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;E._newPosition.S(H),E._newPosition.subtractToRef(E._oldPosition,E._diffPosition),E._diffPosition.length()>p.e.CollisionsEpsilon&&(E.position.addToRef(E._diffPosition,E._deferredPositionUpdate),E._deferOnly?E._deferredUpdated=!0:E.position.S(E._deferredPositionUpdate),E.Cl&&n&&E.Cl(n))},this.inputs=new h(this),this.inputs.addKeyboard().addMouse()}attachControl(o,H){H=S.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(H)}EA(){this.inputs.detachElement(),this.cameraDirection=new g.xH(0,0,0),this.cameraRotation=new g.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(o){this._collisionMask=isNaN(o)?-1:o}_collideWithWorld(o){let H;H=this.parent?g.xH.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,H.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const n=this.bo().collisionCoordinator;this._collider||(this._collider=n.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let E=o;this.applyGravity&&(E=o.add(this.bo().gravity)),n.getNewPosition(this._oldPosition,E,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=g.xH.Zero(),this._transformedDirection=g.xH.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(o){this._needMoveForGravity=o}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.bo().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Hc"}}(0,E.c)([(0,k.L)()],j.prototype,"ellipsoid",void 0),(0,E.c)([(0,k.L)()],j.prototype,"ellipsoidOffset",void 0),(0,E.c)([(0,k.P)()],j.prototype,"checkCollisions",void 0),(0,E.c)([(0,k.P)()],j.prototype,"applyGravity",void 0),(0,Q.e)("BABYLON.FreeCamera",j)},13457:(o,H,n)=>{"use strict";n.d(H,{c:()=>g});var E=n(11289),k=n(13463);class g{constructor(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=n,this.aG=[],this._maxBlockCapacity=H||64,this._selectionContent=new E.b(1024),this._creationFunc=o}update(o,H,n){k.c._CreateBlocks(o,H,n,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}IS(o){for(let H=0;H<this.nG.length;H++){this.nG[H].addEntry(o)}}US(o){for(let H=0;H<this.nG.length;H++){this.nG[H].removeEntry(o)}}select(o,H){this._selectionContent.reset();for(let n=0;n<this.nG.length;n++){this.nG[n].select(o,this._selectionContent,H)}return H?this._selectionContent.concat(this.aG):this._selectionContent.concatWithNoDuplicate(this.aG),this._selectionContent}intersects(o,H,n){this._selectionContent.reset();for(let E=0;E<this.nG.length;E++){this.nG[E].intersects(o,H,this._selectionContent,n)}return n?this._selectionContent.concat(this.aG):this._selectionContent.concatWithNoDuplicate(this.aG),this._selectionContent}intersectsRay(o){this._selectionContent.reset();for(let H=0;H<this.nG.length;H++){this.nG[H].intersectsRay(o,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.aG),this._selectionContent}}g.CreationFuncForMeshes=(o,H)=>{const n=o.getBoundingInfo();!o.isBlocked&&n.boundingBox.intersectsMinMax(H.XG,H.sG)&&H.entries.push(o)},g.CreationFuncForSubMeshes=(o,H)=>{o.getBoundingInfo().boundingBox.intersectsMinMax(H.XG,H.sG)&&H.entries.push(o)}},13463:(o,H,n)=>{"use strict";n.d(H,{c:()=>g});var E=n(11189),k=n(11554);class g{constructor(o,H,n,E,k,g){this.entries=[],this.UG=new Array,this._capacity=n,this._depth=E,this._maxDepth=k,this._creationFunc=g,this._minPoint=o,this._maxPoint=H,this.UG.push(o.clone()),this.UG.push(H.clone()),this.UG.push(o.clone()),this.UG[2].x=H.x,this.UG.push(o.clone()),this.UG[3].y=H.y,this.UG.push(o.clone()),this.UG[4].z=H.z,this.UG.push(H.clone()),this.UG[5].z=o.z,this.UG.push(H.clone()),this.UG[6].x=o.x,this.UG.push(H.clone()),this.UG[7].y=o.y}get xn(){return this._capacity}get XG(){return this._minPoint}get sG(){return this._maxPoint}addEntry(o){if(this.nG)for(let H=0;H<this.nG.length;H++){this.nG[H].addEntry(o)}else this._creationFunc(o,this),this.entries.length>this.xn&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(o){if(this.nG){for(let H=0;H<this.nG.length;H++){this.nG[H].removeEntry(o)}return}const H=this.entries.indexOf(o);H>-1&&this.entries.splice(H,1)}addEntries(o){for(let H=0;H<o.length;H++){const n=o[H];this.addEntry(n)}}select(o,H,n){if(k.e.IsInFrustum(this.UG,o)){if(this.nG){for(let E=0;E<this.nG.length;E++){this.nG[E].select(o,H,n)}return}n?H.concat(this.entries):H.concatWithNoDuplicate(this.entries)}}intersects(o,H,n,E){if(k.e.IntersectsSphere(this._minPoint,this._maxPoint,o,H)){if(this.nG){for(let k=0;k<this.nG.length;k++){this.nG[k].intersects(o,H,n,E)}return}E?n.concat(this.entries):n.concatWithNoDuplicate(this.entries)}}intersectsRay(o,H){if(o.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.nG){for(let n=0;n<this.nG.length;n++){this.nG[n].intersectsRay(o,H)}return}H.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){g._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(o,H,n,k,O,Y,y,S){y.nG=new Array;const G=new E.xH((H.x-o.x)/2,(H.y-o.y)/2,(H.z-o.z)/2);for(let E=0;E<2;E++)for(let H=0;H<2;H++)for(let c=0;c<2;c++){const A=o.add(G.multiplyByFloats(E,H,c)),l=o.add(G.multiplyByFloats(E+1,H+1,c+1)),x=new g(A,l,k,O+1,Y,S);x.addEntries(n),y.nG.push(x)}}}},13470:(o,H,n)=>{"use strict";n.d(H,{b:()=>G});var E=n(11435),k=n(11189),g=n(11626),O=n(12613),Y=n(11475),y=n(13457),S=n(11060);E.c.prototype.createOrUpdateSelectionOctree=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=this._getComponent(Y.d.NAME_OCTREE);n||(n=new G(this),this.o(n)),this.DG||(this.DG=new y.c(y.c.CreationFuncForMeshes,o,H));const E=this.getWorldExtends();return this.DG.update(E.min,E.max,this.meshes),this.DG},Object.defineProperty(E.c.prototype,"selectionOctree",{get:function(){return this.DG},enumerable:!0,configurable:!0}),g.e.prototype.createOrUpdateSubmeshesOctree=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const n=this.bo();let E=n._getComponent(Y.d.NAME_OCTREE);E||(E=new G(n),n.o(E)),this._submeshesOctree||(this._submeshesOctree=new y.c(y.c.CreationFuncForSubMeshes,o,H)),this.Ig(!0);const k=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(k.minimumWorld,k.maximumWorld,this.jg),this._submeshesOctree};class G{constructor(o){this.name=Y.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new O.d(k.xH.Zero(),new k.xH(1,1,1)),(o=o||S.e.LastCreatedScene)&&(this.VH=o,this.VH.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.VH.getActiveSubMeshCandidates=o=>this.getActiveSubMeshCandidates(o),this.VH.getCollidingSubMeshCandidates=(o,H)=>this.getCollidingSubMeshCandidates(o,H),this.VH.getIntersectingSubMeshCandidates=(o,H)=>this.getIntersectingSubMeshCandidates(o,H))}register(){this.VH.onMeshRemovedObservable.add((o=>{const H=this.VH.selectionOctree;if(void 0!==H&&null!==H){const n=H.aG.indexOf(o);-1!==n&&H.aG.splice(n,1)}})),this.VH.onMeshImportedObservable.add((o=>{const H=this.VH.selectionOctree;void 0!==H&&null!==H&&H.IS(o)}))}getActiveMeshCandidates(){var o;return(null===(o=this.VH.DG)||void 0===o?void 0:o.select(this.VH.frustumPlanes))||this.VH._getDefaultMeshCandidates()}getActiveSubMeshCandidates(o){if(o._submeshesOctree&&o.useOctreeForRenderingSelection){return o._submeshesOctree.select(this.VH.frustumPlanes)}return this.VH._getDefaultSubMeshCandidates(o)}getIntersectingSubMeshCandidates(o,H){if(o._submeshesOctree&&o.useOctreeForPicking){O.d.TransformToRef(H,o.getWorldMatrix(),this._tempRay);return o._submeshesOctree.intersectsRay(this._tempRay)}return this.VH._getDefaultSubMeshCandidates(o)}getCollidingSubMeshCandidates(o,H){if(o._submeshesOctree&&o.useOctreeForCollisions){const n=H._velocityWorldLength+Math.max(H._radius.x,H._radius.y,H._radius.z);return o._submeshesOctree.intersects(H._basePointWorld,n)}return this.VH._getDefaultSubMeshCandidates(o)}rebuild(){}dispose(){}}},12613:(o,H,n)=>{"use strict";n.d(H,{d:()=>l});var E=n(11435),k=n(11659),g=n(11196),O=n(11189),Y=n(11201),y=n(11544),S=n(11466),G=n(11060),c=n(11502);const A={internalPickerForMesh:void 0};class l{constructor(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.e;this.origin=o,this.direction=H,this.length=n,this.epsilon=E}clone(){return new l(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const E=l._TmpVector3[0].Wg(o.x-n,o.y-n,o.z-n),k=l._TmpVector3[1].Wg(H.x+n,H.y+n,H.z+n);let g,O,Y,y,S=0,G=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<E.x||this.origin.x>k.x)return!1}else if(g=1/this.direction.x,O=(E.x-this.origin.x)*g,Y=(k.x-this.origin.x)*g,Y===-1/0&&(Y=1/0),O>Y&&(y=O,O=Y,Y=y),S=Math.max(O,S),G=Math.min(Y,G),S>G)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<E.y||this.origin.y>k.y)return!1}else if(g=1/this.direction.y,O=(E.y-this.origin.y)*g,Y=(k.y-this.origin.y)*g,Y===-1/0&&(Y=1/0),O>Y&&(y=O,O=Y,Y=y),S=Math.max(O,S),G=Math.min(Y,G),S>G)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<E.z||this.origin.z>k.z)return!1}else if(g=1/this.direction.z,O=(E.z-this.origin.z)*g,Y=(k.z-this.origin.z)*g,Y===-1/0&&(Y=1/0),O>Y&&(y=O,O=Y,Y=y),S=Math.max(O,S),G=Math.min(Y,G),S>G)return!1;return!0}intersectsBox(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(o.minimum,o.maximum,H)}intersectsSphere(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=o.center.x-this.origin.x,E=o.center.y-this.origin.y,k=o.center.z-this.origin.z,g=n*n+E*E+k*k,O=o.radius+H,Y=O*O;if(g<=Y)return!0;const y=n*this.direction.x+E*this.direction.y+k*this.direction.z;if(y<0)return!1;return g-y*y<=Y}intersectsTriangle(o,H,n){const E=l._TmpVector3[0],k=l._TmpVector3[1],g=l._TmpVector3[2],Y=l._TmpVector3[3],S=l._TmpVector3[4];H.subtractToRef(o,E),n.subtractToRef(o,k),O.xH.CrossToRef(this.direction,k,g);const G=O.xH.Dot(E,g);if(0===G)return null;const c=1/G;this.origin.subtractToRef(o,Y);const A=O.xH.Dot(Y,g)*c;if(A<-this.epsilon||A>1+this.epsilon)return null;O.xH.CrossToRef(Y,E,S);const x=O.xH.Dot(this.direction,S)*c;if(x<-this.epsilon||A+x>1+this.epsilon)return null;const z=O.xH.Dot(k,S)*c;return z>this.length?null:new y.c(1-A-x,A,z)}intersectsPlane(o){let H;const n=O.xH.Dot(o.normal,this.direction);if(Math.abs(n)<9.99999997475243e-7)return null;{const E=O.xH.Dot(o.normal,this.origin);return H=(-o.d-E)/n,H<0?H<-9.99999997475243e-7?null:0:H}}intersectsAxis(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(o){case"y":{const o=(this.origin.y-H)/this.direction.y;return o>0?null:new O.xH(this.origin.x+this.direction.x*-o,H,this.origin.z+this.direction.z*-o)}case"x":{const o=(this.origin.x-H)/this.direction.x;return o>0?null:new O.xH(H,this.origin.y+this.direction.y*-o,this.origin.z+this.direction.z*-o)}case"z":{const o=(this.origin.z-H)/this.direction.z;return o>0?null:new O.xH(this.origin.x+this.direction.x*-o,this.origin.y+this.direction.y*-o,H)}default:return null}}intersectsMesh(o,H,n){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,g=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Y=O.TmpVectors.Matrix[0];return o.getWorldMatrix().invertToRef(Y),this._tmpRay?l.TransformToRef(this,Y,this._tmpRay):this._tmpRay=l.Transform(this,Y),o.intersects(this._tmpRay,H,n,E,k,g)}intersectsMeshes(o,H,n){n?n.length=0:n=[];for(let E=0;E<o.length;E++){const k=this.intersectsMesh(o[E],H);k.hit&&n.push(k)}return n.sort(this._comparePickingInfo),n}_comparePickingInfo(o,H){return o.distance<H.distance?-1:o.distance>H.distance?1:0}intersectionSegment(o,H,n){const E=this.origin,k=O.TmpVectors.xH[0],g=O.TmpVectors.xH[1],Y=O.TmpVectors.xH[2],y=O.TmpVectors.xH[3];H.subtractToRef(o,k),this.direction.scaleToRef(l._Rayl,Y),E.addToRef(Y,g),o.subtractToRef(E,y);const S=O.xH.Dot(k,k),G=O.xH.Dot(k,Y),c=O.xH.Dot(Y,Y),A=O.xH.Dot(k,y),x=O.xH.Dot(Y,y),z=S*c-G*G;let V,J,N=z,h=z;z<l._Smallnum?(V=0,N=1,J=x,h=c):(V=G*x-c*A,J=S*x-G*A,V<0?(V=0,J=x,h=c):V>N&&(V=N,J=x+G,h=c)),J<0?(J=0,-A<0?V=0:-A>S?V=N:(V=-A,N=S)):J>h&&(J=h,-A+G<0?V=0:-A+G>S?V=N:(V=-A+G,N=S));const Q=Math.abs(V)<l._Smallnum?0:V/N,p=Math.abs(J)<l._Smallnum?0:J/h,j=O.TmpVectors.xH[4];Y.scaleToRef(p,j);const m=O.TmpVectors.xH[5];k.scaleToRef(Q,m),m.addInPlace(y);const P=O.TmpVectors.xH[6];m.subtractToRef(j,P);return p>0&&p<=this.length&&P.lengthSquared()<n*n?m.length():-1}update(o,H,n,E,k,g,Y){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){l._RayDistant||(l._RayDistant=l.Zero()),l._RayDistant.unprojectRayToRef(o,H,n,E,O.Matrix.IdentityReadOnly,g,Y);const y=O.TmpVectors.Matrix[0];k.invertToRef(y),l.TransformToRef(l._RayDistant,y,this)}else this.unprojectRayToRef(o,H,n,E,k,g,Y);return this}static Zero(){return new l(O.xH.Zero(),O.xH.Zero())}static CreateNew(o,H,n,E,k,g,O){return l.Zero().update(o,H,n,E,k,g,O)}static CreateNewFromTo(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O.Matrix.IdentityReadOnly;const E=new l(new O.xH(0,0,0),new O.xH(0,0,0));return l.CreateFromToToRef(o,H,E,n)}static CreateFromToToRef(o,H,n){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O.Matrix.IdentityReadOnly;n.origin.S(o);const k=H.subtractToRef(o,n.direction),g=Math.sqrt(k.x*k.x+k.y*k.y+k.z*k.z);return n.length=g,n.direction.normalize(),l.TransformToRef(n,E,n)}static Transform(o,H){const n=new l(new O.xH(0,0,0),new O.xH(0,0,0));return l.TransformToRef(o,H,n),n}static TransformToRef(o,H,n){O.xH.TransformCoordinatesToRef(o.origin,H,n.origin),O.xH.TransformNormalToRef(o.direction,H,n.direction),n.length=o.length,n.epsilon=o.epsilon;const E=n.direction,k=E.length();if(0!==k&&1!==k){const o=1/k;E.x*=o,E.y*=o,E.z*=o,n.length*=k}return n}unprojectRayToRef(o,H,n,E,k,g,Y){const y=O.TmpVectors.Matrix[0];k.multiplyToRef(g,y),y.multiplyToRef(Y,y),y.invert();const S=G.e.LastCreatedEngine,c=O.TmpVectors.xH[0];c.x=o/n*2-1,c.y=-(H/E*2-1),c.z=null!==S&&void 0!==S&&S.useReverseDepthBuffer?1:null!==S&&void 0!==S&&S.isNDCHalfZRange?0:-1;const A=O.TmpVectors.xH[1].Wg(c.x,c.y,1-1e-8),l=O.TmpVectors.xH[2],x=O.TmpVectors.xH[3];O.xH._UnprojectFromInvertedMatrixToRef(c,y,l),O.xH._UnprojectFromInvertedMatrixToRef(A,y,x),this.origin.S(l),x.subtractToRef(l,this.direction),this.direction.normalize()}}function x(o,H,n,E,k){let g=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const O=l.Zero();return z(o,H,n,E,O,k,g),O}function z(o,H,n,E,k,g){let Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],y=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const S=o.getEngine();if(!g&&!(g=o.activeCamera))return o;const G=g.viewport,c=S.getRenderHeight(),{x:A,y:l,width:x,height:z}=G.toGlobal(S.getRenderWidth(),c),V=1/S.getHardwareScalingLevel();return H=H*V-A,n=n*V-(c-l-z),k.update(H,n,x,z,E||O.Matrix.IdentityReadOnly,Y?O.Matrix.IdentityReadOnly:g.getViewMatrix(),g.getProjectionMatrix(),y),o}function V(o,H,n,E,k){if(!S.e)return o;const g=o.getEngine();if(!k&&!(k=o.activeCamera))throw new Error("Active camera not set");const Y=k.viewport,y=g.getRenderHeight(),{x:G,y:c,width:A,height:l}=Y.toGlobal(g.getRenderWidth(),y),x=O.Matrix.Identity(),z=1/g.getHardwareScalingLevel();return H=H*z-G,n=n*z-(y-c-l),E.update(H,n,A,l,x,x,k.getProjectionMatrix()),o}function J(o,H,n,E,k,g,O,Y){const y=H(E,n.enableDistantPicking),S=n.intersects(y,k,O,g,E,Y);return S&&S.hit?!k&&null!=o&&S.distance>=o.distance?null:S:null}function N(o,H,n,E,k,g){let Y=null;const y=!!(o.activeCameras&&o.activeCameras.length>1&&o.cameraToUseForPointers!==o.activeCamera),G=o.cameraToUseForPointers||o.activeCamera,c=A.internalPickerForMesh||J;for(let S=0;S<o.meshes.length;S++){const A=o.meshes[S];if(n){if(!n(A,-1))continue}else if(!A.isEnabled()||!A.isVisible||!A.ey)continue;const l=y&&A.isWorldMatrixCameraDependent(),x=A.Ig(l,G);if(A.hasThinInstances&&A.thinInstanceEnablePicking){const o=c(Y,H,A,x,!0,!0,g);if(o){if(k)return o;const y=O.TmpVectors.Matrix[1],S=A.thinInstanceGetWorldMatrices();for(let o=0;o<S.length;o++){if(n&&!n(A,o))continue;S[o].multiplyToRef(x,y);const O=c(Y,H,A,y,E,k,g,!0);if(O&&(Y=O,Y.thinInstanceIndex=o,E))return Y}}}else{const o=c(Y,H,A,x,E,k,g);if(o&&(Y=o,E))return Y}}return Y||new S.e}function h(o,H,n,E){if(!S.e)return null;const k=[],g=!!(o.activeCameras&&o.activeCameras.length>1&&o.cameraToUseForPointers!==o.activeCamera),Y=o.cameraToUseForPointers||o.activeCamera,y=A.internalPickerForMesh||J;for(let S=0;S<o.meshes.length;S++){const G=o.meshes[S];if(n){if(!n(G,-1))continue}else if(!G.isEnabled()||!G.isVisible||!G.ey)continue;const c=g&&G.isWorldMatrixCameraDependent(),A=G.Ig(c,Y);if(G.hasThinInstances&&G.thinInstanceEnablePicking){if(y(null,H,G,A,!0,!0,E)){const o=O.TmpVectors.Matrix[1],g=G.thinInstanceGetWorldMatrices();for(let O=0;O<g.length;O++){if(n&&!n(G,O))continue;g[O].multiplyToRef(A,o);const Y=y(null,H,G,o,!1,!1,E,!0);Y&&(Y.thinInstanceIndex=O,k.push(Y))}}}else{const o=y(null,H,G,A,!1,!1,E);o&&k.push(o)}}return k}function Q(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,E=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0;E||(E=o.getWorldMatrix()),H.length=n,k?H.origin.S(k):H.origin.S(o.position);const g=O.TmpVectors.xH[2];g.set(0,0,o._scene.useRightHandedSystem?-1:1);const Y=O.TmpVectors.xH[3];return O.xH.TransformNormalToRef(g,E,Y),O.xH.NormalizeToRef(Y,H.direction),H}var p,j;l._TmpVector3=(0,Y.b)(6,O.xH.Zero),l._RayDistant=l.Zero(),l._Smallnum=1e-8,l._Rayl=1e9,p=E.c,(j=k.b)&&(j.prototype.getForwardRay=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,H=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return Q(this,new l(O.xH.Zero(),O.xH.Zero(),o),o,H,n)},j.prototype.getForwardRayToRef=function(o){return Q(this,o,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),p&&(c.c._IsPickingAvailable=!0,p.prototype.createPickingRay=function(o,H,n,E){return x(this,o,H,n,E,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),E.c.prototype.createPickingRayToRef=function(o,H,n,E,k){return z(this,o,H,n,E,k,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},E.c.prototype.createPickingRayInCameraSpace=function(o,H,n){return function(o,H,n,E){const k=l.Zero();return V(o,H,n,k,E),k}(this,o,H,n)},E.c.prototype.createPickingRayInCameraSpaceToRef=function(o,H,n,E){return V(this,o,H,n,E)},E.c.prototype.pickWithBoundingInfo=function(o,H,n,E,k){return function(o,H,n,E,k,g){if(!S.e)return null;const Y=N(o,(E=>(o._tempPickingRay||(o._tempPickingRay=l.Zero()),z(o,H,n,E,o._tempPickingRay,g||null),o._tempPickingRay)),E,k,!0);return Y&&(Y.ray=x(o,H,n,O.Matrix.Identity(),g||null)),Y}(this,o,H,n,E,k)},E.c.prototype.cn=function(o,H,n,E,k,g){return function(o,H,n,E,k,g,Y){const y=N(o,((E,k)=>(o._tempPickingRay||(o._tempPickingRay=l.Zero()),z(o,H,n,E,o._tempPickingRay,g||null,!1,k),o._tempPickingRay)),E,k,!1,Y);return y&&(y.ray=x(o,H,n,O.Matrix.Identity(),g||null)),y}(this,o,H,n,E,k,g)},E.c.prototype.pickWithRay=function(o,H,n,E){return function(o,H,n,E,k){const g=N(o,(n=>(o._pickWithRayInverseMatrix||(o._pickWithRayInverseMatrix=O.Matrix.Identity()),n.invertToRef(o._pickWithRayInverseMatrix),o._cachedRayForTransform||(o._cachedRayForTransform=l.Zero()),l.TransformToRef(H,o._pickWithRayInverseMatrix,o._cachedRayForTransform),o._cachedRayForTransform)),n,E,!1,k);return g&&(g.ray=H),g}(this,o,H,n,E)},E.c.prototype.multiPick=function(o,H,n,E,k){return function(o,H,n,E,k,g){return h(o,(E=>x(o,H,n,E,k||null)),E,g)}(this,o,H,n,E,k)},E.c.prototype.multiPickWithRay=function(o,H,n){return function(o,H,n,E){return h(o,(n=>(o._pickWithRayInverseMatrix||(o._pickWithRayInverseMatrix=O.Matrix.Identity()),n.invertToRef(o._pickWithRayInverseMatrix),o._cachedRayForTransform||(o._cachedRayForTransform=l.Zero()),l.TransformToRef(H,o._pickWithRayInverseMatrix,o._cachedRayForTransform),o._cachedRayForTransform)),n,E)}(this,o,H,n)}},12905:(o,H,n)=>{"use strict";var E=n(11120),k=n(11038),g=n(11066),O=n(11149),Y=n(11093),y=n(11134);Y.e.prototype._partialLoadFile=function(o,H,n,E){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(o,(o=>{n[H]=o,n._internalCount++,6===n._internalCount&&E(n)}),void 0,void 0,!0,((o,H)=>{k&&o&&k(o.status+" "+o.statusText,H)}))},Y.e.prototype._cascadeLoadFiles=function(o,H,n){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const k=[];k._internalCount=0;for(let g=0;g<6;g++)this._partialLoadFile(n[g],g,k,H,E)},Y.e.prototype._cascadeLoadImgs=function(o,H,n,E){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5?arguments[5]:void 0;const O=[];O._internalCount=0;for(let Y=0;Y<6;Y++)this._partialLoadImg(E[Y],Y,O,o,H,n,k,g)},Y.e.prototype._partialLoadImg=function(o,H,n,E,k,Y){let y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7?arguments[7]:void 0;const G=(0,O.b)();(0,g.n)(o,(o=>{n[H]=o,n._internalCount++,E&&E.removePendingData(G),6===n._internalCount&&Y&&Y(k,n)}),((o,H)=>{E&&E.removePendingData(G),y&&y(o,H)}),E?E.offlineProvider:null,S),E&&E.addPendingData(G)},Y.e.prototype.createCubeTextureBase=function(o,H,n,g){let O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6?arguments[6]:void 0,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,c=arguments.length>8&&void 0!==arguments[8]&&arguments[8],A=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,x=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,z=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,V=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,J=arguments.length>14&&void 0!==arguments[14]&&arguments[14],N=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const h=x||new E.d(this,7);h.isCube=!0,h.url=o,h.generateMipMaps=!g,h._lodGenerationScale=A,h._lodGenerationOffset=l,h._useSRGBBuffer=!!J&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!g),h!==x&&(h.label=o.substring(0,60)),this._doNotHandleContextLost||(h._extension=G,h._files=n,h._buffer=N);const Q=o;this._transformTextureUrl&&!x&&(o=this._transformTextureUrl(o));const p=G??function(o){const H=o.split("?")[0],n=H.lastIndexOf(".");return n>-1?H.substring(n).toLowerCase():""}(o),j=(0,y.b)(p),m=(o,H)=>{h.dispose(),Y?Y(o,H):o&&k.d.Warn(o)},P=(E,Y)=>{o===Q?E&&m(E.status+" "+E.statusText,Y):(k.d.Warn(`Failed to load ${o}, falling back to the ${Q}`),this.createCubeTextureBase(Q,H,n,!!g,O,m,S,G,c,A,l,h,z,V,J,N))};if(j)j.then((E=>{const k=o=>{z&&z(h,o),E.loadCubeData(o,h,c,O,((o,H)=>{m(o,H)}))};N?k(N):n&&6===n.length?E.supportCascades?this._cascadeLoadFiles(H,(o=>k(o.map((o=>new Uint8Array(o))))),n,m):m("Textures type does not support cascades."):this._loadFile(o,(o=>k(new Uint8Array(o))),void 0,void 0,!0,P)}));else{if(!n||0===n.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(H,h,((o,H)=>{V&&V(o,H)}),n,m)}return this._internalTexturesCache.push(h),h}},13476:(o,H,n)=>{"use strict";n(11038);var E=n(11321);n(11120),n(11268),n(11115),n(11367),n(11336);E.e},12929:(o,H,n)=>{"use strict";n.d(H,{c:()=>k});var E=n(11140);class k{constructor(o){this.value=this._toInt(o)}_toInt(o){return 0|o}add(o){return new k(this.value+o.value)}zH(o){return new k(this.value-o.value)}multiply(o){return new k(Math.imul(this.value,o.value))}divide(o){return new k(this.value/o.value)}getClassName(){return k.ClassName}equals(o){return this.value===o.value}static FromValue(o){return new k(o)}toString(){return this.value.toString()}}k.ClassName="FlowGraphInteger",(0,E.e)("FlowGraphInteger",k)},12939:(o,H,n)=>{"use strict";n.d(H,{b:()=>k,e:()=>g});var E=n(11189);class k{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Sg=o}get m(){return this.Sg}transformVector(o){return this.transformVectorToRef(o,new E.Vector2)}transformVectorToRef(o,H){return H.x=o.x*this.Sg[0]+o.y*this.Sg[1],H.y=o.x*this.Sg[2]+o.y*this.Sg[3],H}bg(){return this.toArray()}toArray(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let H=0;H<4;H++)o[H]=this.Sg[H];return o}An(o){for(let H=0;H<4;H++)this.Sg[H]=o[H];return this}multiplyToRef(o,H){const n=o.Sg,E=this.Sg,k=H.Sg;return k[0]=n[0]*E[0]+n[1]*E[2],k[1]=n[0]*E[1]+n[1]*E[3],k[2]=n[2]*E[0]+n[3]*E[2],k[3]=n[2]*E[1]+n[3]*E[3],H}multiply(o){return this.multiplyToRef(o,new k)}divideToRef(o,H){const n=this.Sg,E=o.Sg,k=H.Sg;return k[0]=n[0]/E[0],k[1]=n[1]/E[1],k[2]=n[2]/E[2],k[3]=n[3]/E[3],H}divide(o){return this.divideToRef(o,new k)}addToRef(o,H){const n=this.Sg,E=o.m,k=H.m;return k[0]=n[0]+E[0],k[1]=n[1]+E[1],k[2]=n[2]+E[2],k[3]=n[3]+E[3],H}add(o){return this.addToRef(o,new k)}subtractToRef(o,H){const n=this.Sg,E=o.m,k=H.m;return k[0]=n[0]-E[0],k[1]=n[1]-E[1],k[2]=n[2]-E[2],k[3]=n[3]-E[3],H}zH(o){return this.subtractToRef(o,new k)}transpose(){const o=this.Sg;return new k([o[0],o[2],o[1],o[3]])}determinant(){const o=this.Sg;return o[0]*o[3]-o[1]*o[2]}inverse(){const o=this.determinant();if(0===o)throw new Error("Matrix is not invertible");const H=this.Sg,n=1/o;return new k([H[3]*n,-H[1]*n,-H[2]*n,H[0]*n])}equals(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.Sg,E=o.m;return 0===H?n[0]===E[0]&&n[1]===E[1]&&n[2]===E[2]&&n[3]===E[3]:Math.abs(n[0]-E[0])<H&&Math.abs(n[1]-E[1])<H&&Math.abs(n[2]-E[2])<H&&Math.abs(n[3]-E[3])<H}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Sg.join(", ")})`}}class g{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Sg=o}get m(){return this.Sg}transformVector(o){return this.transformVectorToRef(o,new E.xH)}transformVectorToRef(o,H){const n=this.Sg;return H.x=o.x*n[0]+o.y*n[1]+o.z*n[2],H.y=o.x*n[3]+o.y*n[4]+o.z*n[5],H.z=o.x*n[6]+o.y*n[7]+o.z*n[8],H}multiplyToRef(o,H){const n=o.Sg,E=this.Sg,k=H.m;return k[0]=n[0]*E[0]+n[1]*E[3]+n[2]*E[6],k[1]=n[0]*E[1]+n[1]*E[4]+n[2]*E[7],k[2]=n[0]*E[2]+n[1]*E[5]+n[2]*E[8],k[3]=n[3]*E[0]+n[4]*E[3]+n[5]*E[6],k[4]=n[3]*E[1]+n[4]*E[4]+n[5]*E[7],k[5]=n[3]*E[2]+n[4]*E[5]+n[5]*E[8],k[6]=n[6]*E[0]+n[7]*E[3]+n[8]*E[6],k[7]=n[6]*E[1]+n[7]*E[4]+n[8]*E[7],k[8]=n[6]*E[2]+n[7]*E[5]+n[8]*E[8],H}multiply(o){return this.multiplyToRef(o,new g)}divideToRef(o,H){const n=this.Sg,E=o.m,k=H.m;return k[0]=n[0]/E[0],k[1]=n[1]/E[1],k[2]=n[2]/E[2],k[3]=n[3]/E[3],k[4]=n[4]/E[4],k[5]=n[5]/E[5],k[6]=n[6]/E[6],k[7]=n[7]/E[7],k[8]=n[8]/E[8],H}divide(o){return this.divideToRef(o,new g)}addToRef(o,H){const n=this.Sg,E=o.m,k=H.m;return k[0]=n[0]+E[0],k[1]=n[1]+E[1],k[2]=n[2]+E[2],k[3]=n[3]+E[3],k[4]=n[4]+E[4],k[5]=n[5]+E[5],k[6]=n[6]+E[6],k[7]=n[7]+E[7],k[8]=n[8]+E[8],H}add(o){return this.addToRef(o,new g)}subtractToRef(o,H){const n=this.Sg,E=o.m,k=H.m;return k[0]=n[0]-E[0],k[1]=n[1]-E[1],k[2]=n[2]-E[2],k[3]=n[3]-E[3],k[4]=n[4]-E[4],k[5]=n[5]-E[5],k[6]=n[6]-E[6],k[7]=n[7]-E[7],k[8]=n[8]-E[8],H}zH(o){return this.subtractToRef(o,new g)}toArray(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let H=0;H<9;H++)o[H]=this.Sg[H];return o}bg(){return this.toArray()}An(o){for(let H=0;H<9;H++)this.Sg[H]=o[H];return this}transpose(){const o=this.Sg;return new g([o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]])}determinant(){const o=this.Sg;return o[0]*(o[4]*o[8]-o[5]*o[7])-o[1]*(o[3]*o[8]-o[5]*o[6])+o[2]*(o[3]*o[7]-o[4]*o[6])}inverse(){const o=this.determinant();if(0===o)throw new Error("Matrix is not invertible");const H=this.Sg,n=1/o;return new g([(H[4]*H[8]-H[5]*H[7])*n,(H[2]*H[7]-H[1]*H[8])*n,(H[1]*H[5]-H[2]*H[4])*n,(H[5]*H[6]-H[3]*H[8])*n,(H[0]*H[8]-H[2]*H[6])*n,(H[2]*H[3]-H[0]*H[5])*n,(H[3]*H[7]-H[4]*H[6])*n,(H[1]*H[6]-H[0]*H[7])*n,(H[0]*H[4]-H[1]*H[3])*n])}equals(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.Sg,E=o.m;return 0===H?n[0]===E[0]&&n[1]===E[1]&&n[2]===E[2]&&n[3]===E[3]&&n[4]===E[4]&&n[5]===E[5]&&n[6]===E[6]&&n[7]===E[7]&&n[8]===E[8]:Math.abs(n[0]-E[0])<H&&Math.abs(n[1]-E[1])<H&&Math.abs(n[2]-E[2])<H&&Math.abs(n[3]-E[3])<H&&Math.abs(n[4]-E[4])<H&&Math.abs(n[5]-E[5])<H&&Math.abs(n[6]-E[6])<H&&Math.abs(n[7]-E[7])<H&&Math.abs(n[8]-E[8])<H}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Sg.join(", ")})`}}},12944:(o,H,n)=>{"use strict";var E;function k(o,H,n,E){switch(H){case"Animation":return E?o.animations.find((o=>o.uniqueId===n))??null:o.animations[n]??null;case"AnimationGroup":return E?o.animationGroups.find((o=>o.uniqueId===n))??null:o.animationGroups[n]??null;case"Mesh":return E?o.meshes.find((o=>o.uniqueId===n))??null:o.meshes[n]??null;case"Material":return E?o.materials.find((o=>o.uniqueId===n))??null:o.materials[n]??null;case"iS":return E?o.cameras.find((o=>o.uniqueId===n))??null:o.cameras[n]??null;case"Light":return E?o.lights.find((o=>o.uniqueId===n))??null:o.lights[n]??null;default:return null}}n.d(H,{d:()=>k}),function(o){o.Animation="Animation",o.AnimationGroup="AnimationGroup",o.Mesh="Mesh",o.Material="Material",o.iS="iS",o.Light="Light"}(E||(E={}))},12974:(o,H,n)=>{"use strict";n.d(H,{e:()=>k});var E=n(12983);class k extends E.c{constructor(o,H){if(super(o),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),H)for(const n of H)this._eventsSignalOutputs[n]=this._registerSignalOutput(n+"Event")}_executeOnTick(o){}_startPendingTasks(o){o._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(o),this._resetAfterCanceled(o)),this._preparePendingTasks(o),o._addPendingBlock(this),this.out._activateSignal(o),o._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(o){o._deleteExecutionVariable(this,"_initialized"),o._removePendingBlock(this)}}},12956:(o,H,n)=>{"use strict";n.d(H,{c:()=>S});var E=n(11149),k=n(11140),g=n(12963),O=n(11026),Y=n(12926);class y extends g.c{constructor(o,H,n,E){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:E.defaultValue,g=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(o,H,n),this.richType=E,this._defaultValue=k,this._optional=g,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new O.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(o){this._isDisabled!==o&&(this._isDisabled=o,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(o,H){H._getConnectionValue(this)!==o&&(H._setConnectionValue(this,o),this.onValueChangedObservable.notifyObservers(o))}resetToDefaultValue(o){o._setConnectionValue(this,this._defaultValue)}connectTo(o){this._isDisabled||super.connectTo(o)}_getValueOrDefault(o){const H=o._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(H):H}getValue(o){if(1===this.connectionType){o._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(o);const H=this._getValueOrDefault(o);return this._lastValue=H,this.richType.typeTransformer?this.richType.typeTransformer(H):H}const H=this.isConnected()?this._connectedPoint[0].getValue(o):this._getValueOrDefault(o);return this._lastValue=H,this.richType.typeTransformer?this.richType.typeTransformer(H):H}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(o),o.richType={},this.richType.serialize(o.richType),o.optional=this._optional,(0,Y.g)("defaultValue",this._defaultValue,o)}}(0,k.e)("FlowGraphDataConnection",y);class S{constructor(o){var H;this.config=o,this.uniqueId=(0,E.b)(),this.name=(null===(H=this.config)||void 0===H?void 0:H.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(o){}registerDataInput(o,H,n){const E=new y(o,0,this,H,n);return this.dataInputs.push(E),E}registerDataOutput(o,H,n){const E=new y(o,1,this,H,n);return this.dataOutputs.push(E),E}getDataInput(o){return this.dataInputs.find((H=>H.name===o))}getDataOutput(o){return this.dataOutputs.find((H=>H.name===o))}serialize(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Y.g;if(o.uniqueId=this.uniqueId,o.config={},this.config){const n=this.config,E=Object.keys(n);for(const k of E)H(k,n[k],o.config)}o.dataInputs=[],o.dataOutputs=[],o.className=this.getClassName();for(const n of this.dataInputs){const H={};n.serialize(H),o.dataInputs.push(H)}for(const n of this.dataOutputs){const H={};n.serialize(H),o.dataOutputs.push(H)}}deserialize(o){}_log(o,H,n){var E;null===(E=o.logger)||void 0===E||E.addLogItem({action:H,payload:n,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12963:(o,H,n)=>{"use strict";n.d(H,{c:()=>g});var E,k=n(11149);!function(o){o[o.Input=0]="Input",o[o.Output=1]="Output"}(E||(E={}));class g{constructor(o,H,n){this._ownerBlock=n,this._connectedPoint=[],this.uniqueId=(0,k.b)(),this.connectedPointIds=[],this.name=o,this._connectionType=H}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(o){if(this._connectionType===o._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||o._isSingularConnection()&&o._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(o),o._connectedPoint.push(this)}disconnectFrom(o){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this._connectedPoint.indexOf(o),E=o._connectedPoint.indexOf(this);-1!==n&&-1!==E&&(H&&this._connectedPoint.splice(n,1),o._connectedPoint.splice(E,1))}disconnectFromAll(){for(const o of this._connectedPoint)this.disconnectFrom(o,!1);this._connectedPoint.length=0}dispose(){for(const o of this._connectedPoint)this.disconnectFrom(o)}serialize(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o.uniqueId=this.uniqueId,o.name=this.name,o._connectionType=this._connectionType,o.connectedPointIds=[],o.className=this.getClassName();for(const H of this._connectedPoint)o.connectedPointIds.push(H.uniqueId)}getClassName(){return"FGConnection"}deserialize(o){this.uniqueId=o.uniqueId,this.name=o.name,this._connectionType=o._connectionType,this.connectedPointIds=o.connectedPointIds}}},12921:(o,H,n)=>{"use strict";n.d(H,{e:()=>h});var E,k=n(11026),g=n(11170),O=n(11177),Y=n(11149),y=n(12926),S=n(12944),G=n(11038);!function(o){o.ExecuteBlock="ExecuteBlock",o.ExecuteEvent="ExecuteEvent",o.TriggerConnection="TriggerConnection",o.ContextVariableSet="ContextVariableSet",o.GlobalVariableSet="GlobalVariableSet",o.GlobalVariableDelete="GlobalVariableDelete",o.GlobalVariableGet="GlobalVariableGet",o.AddConnection="AddConnection",o.GetConnectionValue="GetConnectionValue",o.SetConnectionValue="SetConnectionValue",o.ActivateSignal="ActivateSignal",o.ContextVariableGet="ContextVariableGet"}(E||(E={}));class c{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(o){if(o.time||(o.time=Date.now()),this.log.push(o),this.logToConsole){var H;const n=null===(H=o.payload)||void 0===H?void 0:H.value;"object"===typeof n&&n.getClassName?G.d.Log(`[FGLog] ${o.className}:${o.uniqueId.split("-")[0]} ${o.action} - ${JSON.stringify(n.getClassName())}: ${n.toString()}`):G.d.Log(`[FGLog] ${o.className}:${o.uniqueId.split("-")[0]} ${o.action} - ${JSON.stringify(o.payload)}`)}}getItemsOfType(o){return this.log.filter((H=>H.action===o))}}class A{get enableLogging(){return this._enableLogging}set enableLogging(o){this._enableLogging!==o&&(this._enableLogging=o,this._enableLogging?(this.logger=new c,this.logger.logToConsole=!0):this.logger=null)}constructor(o){this.uniqueId=(0,Y.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new k.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=o,this.assetsContext=o.assetsContext??o.VH}hasVariable(o){return o in this._userVariables}setVariable(o,H){var n;this._userVariables[o]=H,null===(n=this.logger)||void 0===n||n.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:o,value:H}})}getAsset(o,H){return(0,S.d)(this.assetsContext,o,H)}getVariable(o){var H;return null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:o,value:this._userVariables[o]}}),this._userVariables[o]}get userVariables(){return this._userVariables}bo(){return this._configuration.VH}_getUniqueIdPrefixedName(o,H){return`${o.uniqueId}_${H}`}_getGlobalContextVariable(o,H){var n;return null===(n=this.logger)||void 0===n||n.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:o,defaultValue:H,possibleValue:this._globalContextVariables[o]}}),this._hasGlobalContextVariable(o)?this._globalContextVariables[o]:H}_setGlobalContextVariable(o,H){var n;null===(n=this.logger)||void 0===n||n.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:o,value:H}}),this._globalContextVariables[o]=H}_deleteGlobalContextVariable(o){var H;null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:o}}),delete this._globalContextVariables[o]}_hasGlobalContextVariable(o){return o in this._globalContextVariables}_setExecutionVariable(o,H,n){this._executionVariables[this._getUniqueIdPrefixedName(o,H)]=n}_getExecutionVariable(o,H,n){return this._hasExecutionVariable(o,H)?this._executionVariables[this._getUniqueIdPrefixedName(o,H)]:n}_deleteExecutionVariable(o,H){delete this._executionVariables[this._getUniqueIdPrefixedName(o,H)]}_hasExecutionVariable(o,H){return this._getUniqueIdPrefixedName(o,H)in this._executionVariables}_hasConnectionValue(o){return o.uniqueId in this._connectionValues}_setConnectionValue(o,H){var n;this._connectionValues[o.uniqueId]=H,null===(n=this.logger)||void 0===n||n.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:o.uniqueId,value:H}})}_setConnectionValueByKey(o,H){this._connectionValues[o]=H}_getConnectionValue(o){var H;return null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:o.uniqueId,value:this._connectionValues[o.uniqueId]}}),this._connectionValues[o.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(o){this._pendingBlocks.includes(o)||(this._pendingBlocks.push(o),this._pendingBlocks.sort(((o,H)=>o.priority-H.priority)))}_removePendingBlock(o){const H=this._pendingBlocks.indexOf(o);-1!==H&&this._pendingBlocks.splice(H,1)}_clearPendingBlocks(){for(const o of this._pendingBlocks)o._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(o){var H;this.onNodeExecutedObservable.notifyObservers(o),null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:o.getClassName(),uniqueId:o.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(o){this._setGlobalContextVariable("timeSinceStart",o.timeSinceStart),this._setGlobalContextVariable("deltaTime",o.deltaTime);for(const n of this._pendingBlocks){var H;null===(H=n._executeOnTick)||void 0===H||H.call(n,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.g;o.uniqueId=this.uniqueId,o._userVariables={};for(const E in this._userVariables)H(E,this._userVariables[E],o._userVariables);o._connectionValues={};for(const E in this._connectionValues)H(E,this._connectionValues[E],o._connectionValues);var n;this.assetsContext!==this.bo()&&(o._assetsContext={meshes:this.assetsContext.meshes.map((o=>o.id)),materials:this.assetsContext.materials.map((o=>o.id)),textures:this.assetsContext.textures.map((o=>o.name)),animations:this.assetsContext.animations.map((o=>o.name)),lights:this.assetsContext.lights.map((o=>o.id)),cameras:this.assetsContext.cameras.map((o=>o.id)),El:null===(n=this.assetsContext.El)||void 0===n?void 0:n.map((o=>o.name)),skeletons:this.assetsContext.skeletons.map((o=>o.id)),jA:this.assetsContext.jA.map((o=>o.name)),geometries:this.assetsContext.geometries.map((o=>o.id)),multiMaterials:this.assetsContext.multiMaterials.map((o=>o.id)),transformNodes:this.assetsContext.transformNodes.map((o=>o.id))})}getClassName(){return"FlowGraphContext"}}(0,g.c)([(0,O.P)()],A.prototype,"uniqueId",void 0);var l=n(12951),x=n(11483);class z{constructor(o){this.onEventTriggeredObservable=new k.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=o,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.yg.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const o=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:o}}),this._startingTime+=o})),this._meshPickedObserver=this._scene.onPointerObservable.add((o=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:o})}),x.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((o=>{const H=o.pointerId,n=o.mesh,E=this._pointerUnderMeshState[H];!E&&n?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:H,mesh:n}}):E&&!n?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:H,mesh:E}}):E&&n&&E!==n&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:H,mesh:E,over:n}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:H,mesh:n,out:E}})),this._pointerUnderMeshState[H]=n}),x.b.POINTERMOVE)}dispose(){var o,H,n,E,k;null===(o=this._sceneDisposeObserver)||void 0===o||o.remove(),null===(H=this._sceneReadyObserver)||void 0===H||H.remove(),null===(n=this._sceneOnBeforeRenderObserver)||void 0===n||n.remove(),null===(E=this._meshPickedObserver)||void 0===E||E.remove(),null===(k=this._meshUnderPointerObserver)||void 0===k||k.remove(),this.onEventTriggeredObservable.clear()}}var V,J=n(12970);!function(o){o[o.Stopped=0]="Stopped",o[o.Started=1]="Started"}(V||(V={}));class N{get state(){return this._state}set state(o){this._state=o,this.onStateChangedObservable.notifyObservers(o)}constructor(o){this.onStateChangedObservable=new k.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=o.VH,this._sceneEventCoordinator=new z(this._scene),this._coordinator=o.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((o=>{for(const H of this._executionContexts){const n=this._getContextualOrder(o.type,H);for(const E of n)if(!E._executeEvent(H,o.payload))break}switch(o.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const H of this._executionContexts)H._notifyOnTick(o.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const o=new A({VH:this._scene,coordinator:this._coordinator});return this._executionContexts.push(o),o}getContext(o){return this._executionContexts[o]}addEventBlock(o){if("PointerOver"!==o.type&&"PointerOut"!==o.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==o.type&&this._eventBlocks[o.type].push(o),1===this.state)for(const H of this._executionContexts)o._startPendingTasks(H);else this.onStateChangedObservable.addOnce((H=>{if(1===H)for(const n of this._executionContexts)o._startPendingTasks(n)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((o=>{1===o&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const o of this._executionContexts)for(const H in this._eventBlocks){const n=this._getContextualOrder(H,o);for(const H of n)H._startPendingTasks(o)}}_getContextualOrder(o,H){const n=this._eventBlocks[o].sort(((o,H)=>H.initPriority-o.initPriority));if("MeshPick"===o){const o=[];for(const E of n){const k=E.asset.getValue(H);let g=0;for(;g<n.length;g++){const o=n[g].asset.getValue(H);if(k&&o&&(0,J.m)(k,o))break}o.splice(g,0,E)}return o}return n}dispose(){var o;if(0!==this.state){this.state=0;for(const o of this._executionContexts)o._clearPendingBlocks();this._executionContexts.length=0;for(const o in this._eventBlocks)this._eventBlocks[o].length=0;null===(o=this._eventObserver)||void 0===o||o.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(o){const H=[],n=new Set;for(const E in this._eventBlocks)for(const o of this._eventBlocks[E])H.push(o),n.add(o.uniqueId);for(;H.length>0;){const E=H.pop();o(E);for(const o of E.dataInputs)for(const E of o._connectedPoint)n.has(E._ownerBlock.uniqueId)||(H.push(E._ownerBlock),n.add(E._ownerBlock.uniqueId));if(E instanceof l.b)for(const o of E.signalOutputs)for(const E of o._connectedPoint)n.has(E._ownerBlock.uniqueId)||(H.push(E._ownerBlock),n.add(E._ownerBlock.uniqueId))}}serialize(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},H=arguments.length>1?arguments[1]:void 0;o.allBlocks=[],this.visitAllBlocks((H=>{const n={};H.serialize(n),o.allBlocks.push(n)})),o.executionContexts=[];for(const n of this._executionContexts){const E={};n.serialize(E,H),o.executionContexts.push(E)}}}class h{constructor(o){this.config=o,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.VH.yg.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.VH.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const o=this._executeOnNextFrame.slice(0);if(o.length)for(const H of o){this.notifyCustomEvent(H.id,H.data,!1);const o=this._executeOnNextFrame.findIndex((o=>o.uniqueId===H.uniqueId));-1!==o&&this._executeOnNextFrame.splice(o,1)}}));(h.SceneCoordinators.get(this.config.VH)??[]).push(this)}createGraph(){const o=new N({VH:this.config.VH,coordinator:this});return this._flowGraphs.push(o),o}removeGraph(o){const H=this._flowGraphs.indexOf(o);-1!==H&&(o.dispose(),this._flowGraphs.splice(H,1))}start(){for(const o of this._flowGraphs)o.start()}dispose(){var o,H;for(const k of this._flowGraphs)k.dispose();this._flowGraphs.length=0,null===(o=this._disposeObserver)||void 0===o||o.remove(),null===(H=this._onBeforeRenderObserver)||void 0===H||H.remove();const n=h.SceneCoordinators.get(this.config.VH)??[],E=n.indexOf(this);-1!==E&&n.splice(E,1)}serialize(o,H){o._flowGraphs=[];for(const n of this._flowGraphs){const E={};n.serialize(E,H),o._flowGraphs.push(E)}o.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(o){let H=this._customEventsMap.get(o);return H||(H=new k.d,this._customEventsMap.set(o,H)),H}notifyCustomEvent(o,H){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:o,data:H,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(o)){const H=this._eventExecutionCounter.get(o);if(this._eventExecutionCounter.set(o,H+1),H>=h.MaxEventTypeExecutionPerFrame)return void(H===h.MaxEventTypeExecutionPerFrame&&G.d.Warn(`FlowGraphCoordinator: Too many executions of event "${o}".`))}else this._eventExecutionCounter.set(o,1);const n=this._customEventsMap.get(o);n&&n.notifyObservers(H)}}h.MaxEventsPerType=30,h.MaxEventTypeExecutionPerFrame=30,h.SceneCoordinators=new Map},12972:(o,H,n)=>{"use strict";n.d(H,{d:()=>k});var E=n(12974);class k extends E.e{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(o){o._notifyExecuteNode(this),this.done._activateSignal(o)}}},12951:(o,H,n)=>{"use strict";n.d(H,{b:()=>Y});var E=n(12956),k=n(12963),g=n(11140);class O extends k.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(o){super.connectTo(o),this._connectedPoint.sort(((o,H)=>H.priority-o.priority))}_activateSignal(o){var H;if(null===(H=o.logger)||void 0===H||H.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)o._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(o,this),o._increaseExecutionId();else for(const n of this._connectedPoint)n._activateSignal(o)}}(0,g.e)("FlowGraphSignalConnection",O);class Y extends E.c{constructor(o){super(o),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(o){const H=new O(o,0,this);return this.signalInputs.push(H),H}_registerSignalOutput(o){const H=new O(o,1,this);return this.signalOutputs.push(H),H}_unregisterSignalInput(o){const H=this.signalInputs.findIndex((H=>H.name===o));-1!==H&&(this.signalInputs[H].dispose(),this.signalInputs.splice(H,1))}_unregisterSignalOutput(o){const H=this.signalOutputs.findIndex((H=>H.name===o));-1!==H&&(this.signalOutputs[H].dispose(),this.signalOutputs.splice(H,1))}_reportError(o,H){this.error.payload="string"===typeof H?new Error(H):H,this.error._activateSignal(o)}getSignalInput(o){return this.signalInputs.find((H=>H.name===o))}getSignalOutput(o){return this.signalOutputs.find((H=>H.name===o))}serialize(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(o),o.signalInputs=[],o.signalOutputs=[];for(const H of this.signalInputs){const n={};H.serialize(n),o.signalInputs.push(n)}for(const H of this.signalOutputs){const n={};H.serialize(n),o.signalOutputs.push(n)}}deserialize(o){for(let H=0;H<o.signalInputs.length;H++){const n=this.getSignalInput(o.signalInputs[H].name);if(!n)throw new Error("Could not find signal input with name "+o.signalInputs[H].name+" in block "+o.className);n.deserialize(o.signalInputs[H])}for(let H=0;H<o.signalOutputs.length;H++){const n=this.getSignalOutput(o.signalOutputs[H].name);if(!n)throw new Error("Could not find signal output with name "+o.signalOutputs[H].name+" in block "+o.className);n.deserialize(o.signalOutputs[H])}}getClassName(){return"FlowGraphExecutionBlock"}}},12983:(o,H,n)=>{"use strict";n.d(H,{c:()=>k});var E=n(12951);class k extends E.b{constructor(o){super(o),this.out=this._registerSignalOutput("out")}}},12933:(o,H,n)=>{"use strict";n.d(H,{B:()=>x,C:()=>z,F:()=>b,H:()=>e,L:()=>P,N:()=>m,b:()=>S,d:()=>A,e:()=>j,i:()=>V,j:()=>J,n:()=>N,r:()=>c,u:()=>p,w:()=>G,y:()=>l});var E,k=n(11189),g=n(11238),O=n(12929),Y=n(12939);!function(o){o.Any="any",o.String="string",o.Number="number",o.Boolean="boolean",o.Object="object",o.Integer="FlowGraphInteger",o.Vector2="Vector2",o.xH="xH",o.Vector4="Vector4",o.Quaternion="Quaternion",o.Matrix="Matrix",o.Matrix2D="Matrix2D",o.Matrix3D="Matrix3D",o.NH="NH",o.dY="dY"}(E||(E={}));class y{constructor(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=o,this.defaultValue=H,this.animationType=n}serialize(o){o.typeName=this.typeName,o.defaultValue=this.defaultValue}}const S=new y("any",void 0),G=new y("string",""),c=new y("number",0,0),A=new y("boolean",!1),l=new y("Vector2",k.Vector2.Zero(),5),x=new y("xH",k.xH.Zero(),1),z=new y("Vector4",k.Vector4.Zero()),V=new y("Matrix",k.Matrix.Identity(),3),J=new y("Matrix2D",new Y.b),N=new y("Matrix3D",new Y.e),h=new y("NH",g.NH.Black(),4),Q=new y("dY",new g.d(0,0,0,0),7),p=new y("Quaternion",k.Quaternion.Identity(),2);p.typeTransformer=o=>{if(o.getClassName){if("Vector4"===o.getClassName())return k.Quaternion.Mg(o.bg());if("xH"===o.getClassName())return k.Quaternion.FromEulerVector(o);if("Matrix"===o.getClassName())return k.Quaternion.FromRotationMatrix(o)}return o};const j=new y("FlowGraphInteger",new O.c(0),0);function m(o){const H=o;switch(typeof o){case"string":return G;case"number":return c;case"boolean":return A;case"object":if(H.getClassName)switch(H.getClassName()){case"Vector2":return l;case"xH":return x;case"Vector4":return z;case"Matrix":return V;case"NH":return h;case"dY":return Q;case"Quaternion":return p;case"FlowGraphInteger":return j;case"Matrix2D":return J;case"Matrix3D":return N}return S;default:return S}}function P(o){switch(o){case"string":return G;case"number":return c;case"boolean":return A;case"Vector2":return l;case"xH":return x;case"Vector4":return z;case"Matrix":return V;case"NH":return h;case"dY":return Q;case"Quaternion":return p;case"FlowGraphInteger":return j;case"Matrix2D":return J;case"Matrix3D":return N;default:return S}}function b(o){switch(o){case"number":default:return 0;case"Vector2":return 5;case"xH":return 1;case"Matrix":return 3;case"NH":return 4;case"dY":return 7;case"Quaternion":return 2}}function e(o){switch(o){case 0:return c;case 5:return l;case 1:return x;case 3:return V;case 4:return h;case 7:return Q;case 2:return p;default:return S}}},12926:(o,H,n)=>{"use strict";n.d(H,{d:()=>G,g:()=>S,j:()=>c});var E=n(11238),k=n(11189),g=n(12929),O=n(12933),Y=n(12939);function y(o){return"Vector2"===o||"xH"===o||"Vector4"===o||"Quaternion"===o||"NH"===o||"dY"===o}function S(o,H,n){var E;const k=(null===H||void 0===H||null===(E=H.getClassName)||void 0===E?void 0:E.call(H))??"";if(y(k)||function(o){return"Matrix"===o||"Matrix2D"===o||"Matrix3D"===o}(k))n[o]={value:H.bg(),className:k};else if("FlowGraphInteger"===k)n[o]={value:H.value,className:k};else if(k&&(H.id||H.name))n[o]={id:H.id,name:H.name,className:k};else{if("object"===typeof H)throw new Error(`Could not serialize value ${H}`);n[o]=H}}function G(o,H,n,S){const c=H[o];let A;const l=(null===c||void 0===c?void 0:c.type)??(null===c||void 0===c?void 0:c.className);if(function(o){return"Mesh"===o||"AbstractMesh"===o||"GroundMesh"===o||"InstanceMesh"===o||"LinesMesh"===o||"GoldbergMesh"===o||"GreasedLineMesh"===o||"TrailMesh"===o}(l)){let o=S.meshes.filter((o=>c.id?o.id===c.id:o.name===c.name));0===o.length&&(o=S.transformNodes.filter((o=>c.id?o.id===c.id:o.name===c.name))),A=c.uniqueId?o.find((o=>o.uniqueId===c.uniqueId)):o[0]}else if(y(l))A=function(o,H){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===o)return k.Vector2.Mg(H);if("xH"===o)return n&&(H[2]*=-1),k.xH.Mg(H);if("Vector4"===o)return k.Vector4.Mg(H);if("Quaternion"===o)return n&&(H[2]*=-1,H[3]*=-1),k.Quaternion.Mg(H);if("NH"===o)return new E.NH(H[0],H[1],H[2]);if("dY"===o)return new E.d(H[0],H[1],H[2],H[3]);throw new Error(`Unknown vector class name ${o}`)}(l,c.value);else if(function(o){return"AnimationGroup"===o}(l)){const o=S.animationGroups.filter((o=>o.name===c.name));A=1===o.length?o[0]:o.find((o=>o.uniqueId===c.uniqueId))}else A="Matrix"===l?k.Matrix.Mg(c.value):"Matrix2D"===l?new Y.b(c.value):"Matrix3D"===l?new Y.e(c.value):"FlowGraphInteger"===l?g.c.FromValue(c.value):"number"===l||"string"===l||"boolean"===l?c.value[0]:c&&void 0!==c.value?c.value:Array.isArray(c)?c.reduce(((o,H)=>H.eventData?(o[H.id]={type:(0,O.L)(H.type)},"undefined"!==typeof H.value&&(o[H.id].value=G("value",H,n,S)),o):o),{}):c;return A}function c(o){return"FlowGraphJsonPointerParserBlock"===o}},12970:(o,H,n)=>{"use strict";function E(o,H){return!(!o.parent||o.parent!==H&&!E(o.parent,H))}function k(o){if(o.getClassName)return o.getClassName()}function g(o,H){return o===H&&("Vector2"===o||"xH"===o||"Vector4"===o||"Quaternion"===o)}function O(o,H){return o===H&&("Matrix"===o||"Matrix2D"===o||"Matrix3D"===o)}function Y(o,H){return"FlowGraphInteger"===o&&"FlowGraphInteger"===H}function y(o,H){const n="number"===typeof o||"number"===typeof(null===o||void 0===o?void 0:o.value);return n&&!H?!isNaN(S(o)):n}function S(o){return"number"===typeof o?o:o.value}n.d(H,{c:()=>Y,g:()=>O,h:()=>g,j:()=>k,m:()=>E,n:()=>S,o:()=>y})},12319:(o,H,n)=>{"use strict";n.r(H),n.d(H,{SceneInstrumentation:()=>g});var E=n(11024),k=n(11412);class g{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(o){o!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=o,o?(this._onBeforeActiveMeshesEvaluationObserver=this.VH.onBeforeActiveMeshesEvaluationObservable.add((()=>{E.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.VH.onAfterActiveMeshesEvaluationObservable.add((()=>{E.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.VH.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.VH.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(o){o!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=o,o?(this._onBeforeRenderTargetsRenderObserver=this.VH.onBeforeRenderTargetsRenderObservable.add((()=>{E.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.VH.onAfterRenderTargetsRenderObservable.add((()=>{E.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.VH.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.VH.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(o){o!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=o,o?(this._onBeforeParticlesRenderingObserver=this.VH.onBeforeParticlesRenderingObservable.add((()=>{E.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.VH.onAfterParticlesRenderingObservable.add((()=>{E.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.VH.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.VH.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(o){o!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=o,this.VH.spriteManagers&&(o?(this._onBeforeSpritesRenderingObserver=this.VH.onBeforeSpritesRenderingObservable.add((()=>{E.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.VH.onAfterSpritesRenderingObservable.add((()=>{E.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.VH.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.VH.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(o){o!==this._capturePhysicsTime&&this.VH.onBeforePhysicsObservable&&(this._capturePhysicsTime=o,o?(this._onBeforePhysicsObserver=this.VH.onBeforePhysicsObservable.add((()=>{E.Tools.StartPerformanceCounter("Ec"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.VH.onAfterPhysicsObservable.add((()=>{E.Tools.EndPerformanceCounter("Ec"),this._physicsTime.endMonitoring()}))):(this.VH.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.VH.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(o){o!==this._captureAnimationsTime&&(this._captureAnimationsTime=o,o?this._onAfterAnimationsObserver=this.VH.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.VH.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(o){this._captureFrameTime=o}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(o){this._captureInterFrameTime=o}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(o){o!==this._captureRenderTime&&(this._captureRenderTime=o,o?(this._onBeforeDrawPhaseObserver=this.VH.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),E.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.VH.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),E.Tools.EndPerformanceCounter("Main render")}))):(this.VH.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.VH.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(o){o!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=o,o?(this._onBeforeCameraRenderObserver=this.VH.onBeforeCameraRenderObservable.add((o=>{this._cameraRenderTime.beginMonitoring(),E.Tools.StartPerformanceCounter(`Rendering camera ${o.name}`)})),this._onAfterCameraRenderObserver=this.VH.onAfterCameraRenderObservable.add((o=>{this._cameraRenderTime.endMonitoring(!1),E.Tools.EndPerformanceCounter(`Rendering camera ${o.name}`)}))):(this.VH.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.VH.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.VH.getEngine()._drawCalls}constructor(o){this.VH=o,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new k.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new k.e,this._captureFrameTime=!1,this._frameTime=new k.e,this._captureRenderTime=!1,this._renderTime=new k.e,this._captureInterFrameTime=!1,this._interFrameTime=new k.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new k.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new k.e,this._capturePhysicsTime=!1,this._physicsTime=new k.e,this._captureAnimationsTime=!1,this._animationsTime=new k.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new k.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=o.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(E.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.VH.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=o.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(E.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.gg(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.gg(),this._captureParticlesRenderTime&&this._particlesRenderTime.gg(),this._captureSpritesRenderTime&&this._spritesRenderTime.gg(),this._captureRenderTime&&this._renderTime.gg(),this._captureCameraRenderTime&&this._cameraRenderTime.gg()}))}dispose(){this._disposed||(this.VH.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.VH.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.VH.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.VH.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.VH.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.VH.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.VH.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.VH.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.VH.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.VH.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.VH.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.VH.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.VH.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.VH.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.VH.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.VH.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.VH.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.VH=null,this._disposed=!0)}}},12916:(o,H,n)=>{"use strict";n.d(H,{b:()=>G});var E=n(11170),k=n(11177),g=n(11189),O=n(11623),Y=n(11738),y=n(11797),S=n(11140);O.b.AddNodeConstructor("Light_Type_1",((o,H)=>()=>new G(o,g.xH.Zero(),H)));class G extends y.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(o){this._shadowFrustumSize=o,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(o){this._shadowOrthoScale=o,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(o){this._orthoLeft=o}get orthoRight(){return this._orthoRight}set orthoRight(o){this._orthoRight=o}get orthoTop(){return this._orthoTop}set orthoTop(o){this._orthoTop=o}get orthoBottom(){return this._orthoBottom}set orthoBottom(o){this._orthoBottom=o}constructor(o,H,n){super(o,n),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=H.scale(-1),this.direction=H}getClassName(){return"kc"}getTypeID(){return Y.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(o,H,n){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(o):this._setDefaultAutoExtendShadowProjectionMatrix(o,H,n)}_setDefaultFixedFrustumShadowProjectionMatrix(o){const H=this.bo().activeCamera;H&&g.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:H.Cg,void 0!==this.shadowMaxZ?this.shadowMaxZ:H.maxZ,o,this.bo().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(o,H,n){const E=this.bo().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const o=g.xH.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let E=Number.MAX_VALUE,k=-Number.MAX_VALUE;for(let O=0;O<n.length;O++){const Y=n[O];if(!Y)continue;const y=Y.getBoundingInfo().boundingBox;for(let n=0;n<y.vectorsWorld.length;n++)g.xH.TransformCoordinatesToRef(y.vectorsWorld[n],H,o),o.x<this._orthoLeft&&(this._orthoLeft=o.x),o.y<this._orthoBottom&&(this._orthoBottom=o.y),o.x>this._orthoRight&&(this._orthoRight=o.x),o.y>this._orthoTop&&(this._orthoTop=o.y),this.autoCalcShadowZBounds&&(o.z<E&&(E=o.z),o.z>k&&(k=o.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=E,this._shadowMaxZ=k)}const k=this._orthoRight-this._orthoLeft,O=this._orthoTop-this._orthoBottom,Y=void 0!==this.shadowMinZ?this.shadowMinZ:(null===E||void 0===E?void 0:E.Cg)||0,y=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===E||void 0===E?void 0:E.maxZ)||1e4,S=this.bo().getEngine().useReverseDepthBuffer;g.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-k*this.shadowOrthoScale,this._orthoRight+k*this.shadowOrthoScale,this._orthoBottom-O*this.shadowOrthoScale,this._orthoTop+O*this.shadowOrthoScale,S?y:Y,S?Y:y,o,this.bo().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(o,H){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,H),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,H),this)}transferToNodeMaterialEffect(o,H){return this.computeTransformedInformation()?(o.setFloat3(H,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(o.setFloat3(H,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(o){const H=this._scene.getEngine();return!H.useReverseDepthBuffer&&H.isNDCHalfZRange?0:1}getDepthMaxZ(o){const H=this._scene.getEngine();return H.useReverseDepthBuffer&&H.isNDCHalfZRange?0:1}prepareLightSpecificDefines(o,H){o["DIRLIGHT"+H]=!0}}(0,E.c)([(0,k.P)()],G.prototype,"shadowFrustumSize",null),(0,E.c)([(0,k.P)()],G.prototype,"shadowOrthoScale",null),(0,E.c)([(0,k.P)()],G.prototype,"autoUpdateExtends",void 0),(0,E.c)([(0,k.P)()],G.prototype,"autoCalcShadowZBounds",void 0),(0,E.c)([(0,k.P)("orthoLeft")],G.prototype,"_orthoLeft",void 0),(0,E.c)([(0,k.P)("orthoRight")],G.prototype,"_orthoRight",void 0),(0,E.c)([(0,k.P)("orthoTop")],G.prototype,"_orthoTop",void 0),(0,E.c)([(0,k.P)("orthoBottom")],G.prototype,"_orthoBottom",void 0),(0,S.e)("BABYLON.DirectionalLight",G)},13419:(o,H,n)=>{"use strict";n.d(H,{c:()=>G});var E=n(11170),k=n(11177),g=n(11189),O=n(11238),Y=n(11623),y=n(11738),S=n(11140);Y.b.AddNodeConstructor("Light_Type_3",((o,H)=>()=>new G(o,g.xH.Zero(),H)));class G extends y.e{constructor(o,H,n){super(o,n),this.groundColor=new O.NH(0,0,0),this.direction=H||g.xH.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"gc"}setDirectionToTarget(o){return this.direction=g.xH.Normalize(o.zH(g.xH.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(o,H){const n=g.xH.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",n.x,n.y,n.z,0,H),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.zY),H),this}transferToNodeMaterialEffect(o,H){const n=g.xH.Normalize(this.direction);return o.setFloat3(H,n.x,n.y,n.z),this}Ig(){return this._worldMatrix||(this._worldMatrix=g.Matrix.Identity()),this._worldMatrix}getTypeID(){return y.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(o,H){o["HEMILIGHT"+H]=!0}}(0,E.c)([(0,k.n)()],G.prototype,"groundColor",void 0),(0,E.c)([(0,k.L)()],G.prototype,"direction",void 0),(0,S.e)("BABYLON.HemisphericLight",G)},12878:(o,H,n)=>{"use strict";n.d(H,{d:()=>c});var E=n(11170),k=n(11177),g=n(11189),O=n(11623),Y=n(11738),y=n(11797),S=n(11168),G=n(11140);O.b.AddNodeConstructor("Light_Type_2",((o,H)=>()=>new c(o,g.xH.Zero(),g.xH.Zero(),0,0,H)));class c extends y.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(o){this._iesProfileTexture!==o&&(this._iesProfileTexture=o,this._iesProfileTexture&&c._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(o){this._angle=o,this._cosHalfAngle=Math.cos(.5*o),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(o){this._innerAngle=o,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(o){this._shadowAngleScale=o,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(o){this._projectionTextureLightNear=o,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(o){this._projectionTextureLightFar=o,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(o){this._projectionTextureUpDirection=o,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(o){this._projectionTexture!==o&&(this._projectionTexture=o,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(c._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):c._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(o){return void 0!==o.onGeneratedObservable}static _IsTexture(o){return void 0!==o.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(o){this._projectionTextureProjectionLightMatrix=o,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(o,H,n,E,k,O){super(o,O),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=g.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=g.xH.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=g.xH.Zero(),this._projectionTextureViewLightMatrix=g.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=g.Matrix.Zero(),this._projectionTextureScalingMatrix=g.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=H,this.direction=n,this.angle=E,this.exponent=k}getClassName(){return"SpotLight"}getTypeID(){return Y.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(o){super._setDirection(o),this._projectionTextureViewLightDirty=!0}_setPosition(o){super._setPosition(o),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(o,H,n){const E=this.bo().activeCamera;if(!E)return;this._shadowAngleScale=this._shadowAngleScale||1;const k=this._shadowAngleScale*this._angle,O=void 0!==this.shadowMinZ?this.shadowMinZ:E.Cg,Y=void 0!==this.shadowMaxZ?this.shadowMaxZ:E.maxZ,y=this.bo().getEngine().useReverseDepthBuffer;g.Matrix.PerspectiveFovLHToRef(k,1,y?Y:O,y?O:Y,o,!0,this._scene.getEngine().isNDCHalfZRange,void 0,y)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),g.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const o=this.projectionTextureLightFar,H=this.projectionTextureLightNear,n=o/(o-H),E=-n*H,k=1/Math.tan(this._angle/2);g.Matrix.FromValuesToRef(k/1,0,0,0,0,k,0,0,0,0,n,1,0,0,E,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof S.c){const o=this._projectionTexture.uScale/2,H=this._projectionTexture.vScale/2;g.Matrix.FromValuesToRef(o,0,0,0,0,H,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(o,H){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),o.setMatrix("textureProjectionMatrix"+H,this._projectionTextureMatrix),o.setTexture("projectionLightTexture"+H,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&o.setTexture("iesLightTexture"+H,this._iesProfileTexture),this}transferToEffect(o,H){let n;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,H),n=g.xH.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,H),n=g.xH.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",n.x,n.y,n.z,this._cosHalfAngle,H),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,H),this}transferToNodeMaterialEffect(o,H){let n;return n=this.computeTransformedInformation()?g.xH.Normalize(this.transformedDirection):g.xH.Normalize(this.direction),this.bo().useRightHandedSystem?o.setFloat3(H,-n.x,-n.y,-n.z):o.setFloat3(H,n.x,n.y,n.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(o){const H=this._scene.getEngine(),n=void 0!==this.shadowMinZ?this.shadowMinZ:(null===o||void 0===o?void 0:o.Cg)??0;return H.useReverseDepthBuffer&&H.isNDCHalfZRange?n:this._scene.getEngine().isNDCHalfZRange?0:n}getDepthMaxZ(o){const H=this._scene.getEngine(),n=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===o||void 0===o?void 0:o.maxZ)??1e4;return H.useReverseDepthBuffer&&H.isNDCHalfZRange?0:n}prepareLightSpecificDefines(o,H){o["SPOTLIGHT"+H]=!0,o["PROJECTEDLIGHTTEXTURE"+H]=!(!this.projectionTexture||!this.projectionTexture.isReady()),o["IESLIGHTTEXTURE"+H]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,E.c)([(0,k.P)()],c.prototype,"angle",null),(0,E.c)([(0,k.P)()],c.prototype,"innerAngle",null),(0,E.c)([(0,k.P)()],c.prototype,"shadowAngleScale",null),(0,E.c)([(0,k.P)()],c.prototype,"exponent",void 0),(0,E.c)([(0,k.P)()],c.prototype,"projectionTextureLightNear",null),(0,E.c)([(0,k.P)()],c.prototype,"projectionTextureLightFar",null),(0,E.c)([(0,k.P)()],c.prototype,"projectionTextureUpDirection",null),(0,E.c)([(0,k.I)("projectedLightTexture")],c.prototype,"_projectionTexture",void 0),(0,G.e)("BABYLON.SpotLight",c)},12600:(o,H,n)=>{"use strict";n.d(H,{e:()=>O,i:()=>g,j:()=>Y});const E={},k={};function g(o,H){E[o]=H}function O(o,H){k[o]=H}function Y(o){return k[o]?k[o]:null}},12495:(o,H,n)=>{"use strict";n.d(H,{b:()=>m,c:()=>T});var E,k=n(11024),g=n(11026),O=n(11435),Y=n(11060),y=n(11038),S=n(11667),G=n(11066),c=n(11068),A=n(11149),l=n(11093),x=n(11057);!function(o){o[o.Clean=0]="Clean",o[o.Stop=1]="Stop",o[o.Sync=2]="Sync",o[o.NoSync=3]="NoSync"}(E||(E={}));const z=new g.d,V={};let J=!1;function N(){return V[".babylon"]}function h(o,H){const n=V[o];return n||(y.d.Warn("Unable to find a plugin to load "+o+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),H?N():void 0)}function Q(o,H,n){let E="Unable to load from "+(o.rawData?"binary data":o.url);return H?E+=`: ${H}`:n&&(E+=`: ${n}`),E}async function p(o,H,n,E,k,g,O,Y,y){var S;const c="data:"===(A=o.url).substring(0,5)?A.substring(5):null;var A;if(o.rawData&&!O)throw"When using ArrayBufferView to load data the file extension must be provided.";const J=c||O?"":function(o){const H=o.indexOf("?");-1!==H&&(o=o.substring(0,H));const n=o.lastIndexOf(".");return o.substring(n,o.length).toLowerCase()}(o.url);let Q=O?h(O,!0):c?function(o){for(const H in V){const n=V[H].plugin;if(n.canDirectLoad&&n.canDirectLoad(o))return V[H]}return N()}(o.url):h(J,!1);if(!Q&&J){if(o.url&&!o.url.startsWith("blob:")){const H=await async function(o,H){const n=H.method||"GET";return await new Promise(((E,k)=>{const g=new x.d;g.addEventListener("readystatechange",(()=>{if(4==g.readyState)if(200==g.status){const o={};if(H.responseHeaders)for(const n of H.responseHeaders)o[n]=g.getResponseHeader(n)||"";E({response:g.response,headerValues:o})}else k(`Unable to fetch data from ${o}. Error code: ${g.status}`)})),g.open(n,o),g.send()}))}(o.url,{method:"HEAD",responseHeaders:["Content-Type"]}),n=H.headerValues?H.headerValues["Content-Type"]:"";n&&(Q=function(o){for(const H in V){const n=V[H];if(n.mimeType===o)return n}}(n))}Q||(Q=N())}if(!Q)throw new Error(`No plugin or fallback for ${O??o.url}`);if(!1===(null===y||void 0===y||null===(S=y[Q.plugin.name])||void 0===S?void 0:S.enabled))throw new Error(`The '${Q.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(o.rawData&&!Q.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(o=>{if(Q.plugin.createPlugin){const H=Q.plugin.createPlugin(y??{});return H instanceof Promise?(H.then(o).catch((o=>{k("Error instantiating plugin.",o)})),null):(o(H),H)}return o(Q.plugin),Q.plugin})((y=>{var S;if(!y)throw`The loader plugin corresponding to the '${O}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(z.notifyObservers(y),c&&(y.canDirectLoad&&y.canDirectLoad(o.url)||!(0,G.i)(o.url))){if(y.directLoad){const o=y.directLoad(H,c);o instanceof Promise?o.then((o=>{n(y,o)})).catch((o=>{k("Error in directLoad of _loadData: "+o,o)})):n(y,o)}else n(y,c);return}const A=Q.isBinary,x=(o,E)=>{H.l?k("Scene has been disposed"):n(y,o,E)};let V=null,J=!1;null===(S=y.yg)||void 0===S||S.add((()=>{J=!0,V&&(V.abort(),V=null),g()}));const N=()=>{if(J)return;const n=(o,H)=>{k(null===o||void 0===o?void 0:o.statusText,H)};if(!y.loadFile&&o.rawData)throw"Plugin does not support loading ArrayBufferView.";V=y.loadFile?y.loadFile(H,o.rawData||o.file||o.url,o.rootUrl,x,E,A,n,Y):H._loadFile(o.file||o.url,x,E,!0,A,n)},h=H.getEngine();let p=h.enableOfflineSupport;if(p){let n=!1;for(const E of H.disableOfflineSupportExceptionRules)if(E.test(o.url)){n=!0;break}p=!n}p&&l.e.OfflineProviderFactory?H.offlineProvider=l.e.OfflineProviderFactory(o.url,N,h.disableManifestCheck):N()}))}function j(o,H){let n,E,g=null,O=null;if(H)if(H.name)n=`file:${H.name}`,E=H.name,g=H;else if(ArrayBuffer.isView(H))n="",E=(0,A.b)(),O=H;else if(H.startsWith("data:"))n=H,E="";else if(o){const g=H;if("/"===g.substring(0,1))return k.Tools.Error("Wrong sceneFilename parameter"),null;n=o+g,E=g}else n=H,E=k.Tools.GetFilename(H),o=k.Tools.GetFolderPath(H);else n=o,E=k.Tools.GetFilename(o),o=k.Tools.GetFolderPath(o);return{url:n,rootUrl:o,name:E,file:g,rawData:O}}function m(o){if("string"===typeof o.extensions){const H=o.extensions;V[H.toLowerCase()]={plugin:o,isBinary:!1}}else{const H=o.extensions,n=Object.keys(H);for(const E of n)V[E.toLowerCase()]={plugin:o,isBinary:H[E].isBinary,mimeType:H[E].mimeType}}}async function P(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Y.e.LastCreatedScene,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",A=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!E)return y.d.Error("No scene available to import mesh to"),null;const l=j(H,n);if(!l)return null;const x={};E.addPendingData(x);const z=()=>{E.removePendingData(x)},V=(o,H)=>{const n=Q(l,o,H);O?O(E,n,new c.l(n,c.i.SceneLoaderError,H)):y.d.Error(n),z()},J=g?o=>{try{g(o)}catch(H){V("Error in onProgress callback: "+H,H)}}:void 0,N=(o,H,n,g,O,Y,y,S)=>{if(E.importedMeshesFiles.push(l.url),k)try{k(o,H,n,g,O,Y,y,S)}catch(G){V("Error in onSuccess callback: "+G,G)}E.removePendingData(x)};return await p(l,E,((H,n,k)=>{if(H.rewriteRootURL&&(l.rootUrl=H.rewriteRootURL(l.rootUrl,k)),H.importMesh){const k=[],g=[],O=[];if(!H.importMesh(o,E,n,l.rootUrl,k,g,O,V))return;E.loadingPluginName=H.name,N(k,g,O,[],[],[],[],[])}else{H.importMeshAsync(o,E,n,l.rootUrl,J,l.name).then((o=>{E.loadingPluginName=H.name,N(o.meshes,o.jA,o.skeletons,o.animationGroups,o.transformNodes,o.geometries,o.lights,o.spriteManagers)})).catch((o=>{V(o.message,o)}))}}),J,V,z,S,G,A)}async function b(o,H,n,E,k,g,O,Y){return await new Promise(((y,S)=>{try{P(o,H,n,E,((o,H,n,E,k,g,O,Y)=>{y({meshes:o,jA:H,skeletons:n,animationGroups:E,transformNodes:k,geometries:g,lights:O,spriteManagers:Y})}),k,((o,H,n)=>{S(n||new Error(H))}),g,O,Y).catch(S)}catch(c){S(c)}}))}async function e(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.e.LastCreatedEngine,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};n?await M(o,H,new O.c(n),E,g,y,S,G,c):k.Tools.Error("No engine available")}async function Z(o,H,n,E,k,g,O){return await new Promise(((Y,y)=>{e(o,H,n,(o=>{Y(o)}),E,((o,H,n)=>{y(n||new Error(H))}),k,g,O)}))}async function M(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.e.LastCreatedScene,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!n)return y.d.Error("No scene available to append to"),null;const l=j(o,H);if(!l)return null;const x={};n.addPendingData(x);const z=()=>{n.removePendingData(x)};S.b.ShowLoadingScreen&&!J&&(J=!0,n.getEngine().displayLoadingUI(),n.executeWhenReady((()=>{n.getEngine().hideLoadingUI(),J=!1})));const V=(o,H)=>{const E=Q(l,o,H);g?g(n,E,new c.l(E,c.i.SceneLoaderError,H)):y.d.Error(E),z()},N=k?o=>{try{k(o)}catch(H){V("Error in onProgress callback",H)}}:void 0,h=()=>{if(E)try{E(n)}catch(o){V("Error in onSuccess callback",o)}n.removePendingData(x)};return await p(l,n,((o,H)=>{if(o.load){if(!o.load(n,H,l.rootUrl,V))return;n.loadingPluginName=o.name,h()}else{o.loadAsync(n,H,l.rootUrl,N,l.name).then((()=>{n.loadingPluginName=o.name,h()})).catch((o=>{V(o.message,o)}))}}),N,V,z,O,G,A)}async function K(o,H,n,E,k,g,O){return await new Promise(((Y,y)=>{try{M(o,H,n,(o=>{Y(o)}),E,((o,H,n)=>{y(n||new Error(H))}),k,g,O).catch(y)}catch(c){y(c)}}))}async function f(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.e.LastCreatedScene,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!n)return y.d.Error("No scene available to load asset container to"),null;const A=j(o,H);if(!A)return null;const l={};n.addPendingData(l);const x=()=>{n.removePendingData(l)},z=(o,H)=>{const E=Q(A,o,H);g?g(n,E,new c.l(E,c.i.SceneLoaderError,H)):y.d.Error(E),x()},V=k?o=>{try{k(o)}catch(H){z("Error in onProgress callback",H)}}:void 0,J=o=>{if(E)try{E(o)}catch(H){z("Error in onSuccess callback",H)}n.removePendingData(l)};return await p(A,n,((o,H)=>{if(o.loadAssetContainer){const E=o.loadAssetContainer(n,H,A.rootUrl,z);if(!E)return;E.populateRootNodes(),n.loadingPluginName=o.name,J(E)}else if(o.loadAssetContainerAsync){o.loadAssetContainerAsync(n,H,A.rootUrl,V,A.name).then((H=>{H.populateRootNodes(),n.loadingPluginName=o.name,J(H)})).catch((o=>{z(o.message,o)}))}else z("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),V,z,x,O,S,G)}async function B(o,H,n,E,k,g,O){return await new Promise(((Y,y)=>{try{f(o,H,n,(o=>{Y(o)}),E,((o,H,n)=>{y(n||new Error(H))}),k,g,O).catch(y)}catch(c){y(c)}}))}async function q(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.e.LastCreatedScene,E=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,A=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",l=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!n)return void y.d.Error("No scene available to load animations to");if(E){for(const E of n.animatables)E.reset();n.stopAllAnimations();const o=n.animationGroups.slice();for(const n of o)n.dispose();const H=n.getNodes();for(const n of H)n.animations&&(n.animations=[])}else switch(k){case 0:const o=n.animationGroups.slice();for(const H of o)H.dispose();break;case 1:for(const H of n.animationGroups)H.stop();break;case 2:for(const H of n.animationGroups)H.reset(),H.restart();break;case 3:break;default:return void y.d.Error("Unknown animation group loading mode value '"+k+"'")}const x=n.animatables.length;await f(o,H,n,(o=>{o.mergeAnimationsTo(n,n.animatables.slice(x),g),o.dispose(),n.onAnimationFileImportedObservable.notifyObservers(n),O&&O(n)}),S,G,c,A,l)}async function D(o,H,n,E,k,g,O,Y,y,S){return await new Promise(((G,A)=>{try{q(o,H,n,E,k,g,(o=>{G(o)}),O,((o,H,n)=>{A(n||new Error(H))}),Y,y,S).catch(A)}catch(c){A(c)}}))}class T{static get ForceFullSceneLoadingForIncremental(){return S.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(o){S.b.ForceFullSceneLoadingForIncremental=o}static get ShowLoadingScreen(){return S.b.ShowLoadingScreen}static set ShowLoadingScreen(o){S.b.ShowLoadingScreen=o}static get loggingLevel(){return S.b.loggingLevel}static set loggingLevel(o){S.b.loggingLevel=o}static get CleanBoneMatrixWeights(){return S.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(o){S.b.CleanBoneMatrixWeights=o}static GetDefaultPlugin(){return N()}static GetPluginForExtension(o){var H;return null===(H=h(o,!0))||void 0===H?void 0:H.plugin}static IsPluginForExtensionAvailable(o){return function(o){return!!V[o]}(o)}static RegisterPlugin(o){m(o)}static ImportMesh(o,H,n,E,k,g,O,y,S){P(o,H,n,E,k,g,O,y,S).catch((o=>null===O||void 0===O?void 0:O(Y.e.LastCreatedScene,null===o||void 0===o?void 0:o.message,o)))}static async ImportMeshAsync(o,H,n,E,k,g,O){return await b(o,H,n,E,k,g,O)}static Load(o,H,n,E,k,g,O,y){e(o,H,n,E,k,g,O,y).catch((o=>null===g||void 0===g?void 0:g(Y.e.LastCreatedScene,null===o||void 0===o?void 0:o.message,o)))}static async LoadAsync(o,H,n,E,k,g){return await Z(o,H,n,E,k,g)}static Append(o,H,n,E,k,g,O,y){M(o,H,n,E,k,g,O,y).catch((o=>null===g||void 0===g?void 0:g(n??Y.e.LastCreatedScene,null===o||void 0===o?void 0:o.message,o)))}static async AppendAsync(o,H,n,E,k,g){return await K(o,H,n,E,k,g)}static LoadAssetContainer(o,H,n,E,k,g,O,y){f(o,H,n,E,k,g,O,y).catch((o=>null===g||void 0===g?void 0:g(n??Y.e.LastCreatedScene,null===o||void 0===o?void 0:o.message,o)))}static async LoadAssetContainerAsync(o,H,n,E,k,g){return await B(o,H,n,E,k,g)}static ImportAnimations(o,H,n,E,k,g,O,y,S,G,c){q(o,H,n,E,k,g,O,y,S,G,c).catch((o=>null===S||void 0===S?void 0:S(n??Y.e.LastCreatedScene,null===o||void 0===o?void 0:o.message,o)))}static async ImportAnimationsAsync(o,H,n,E,k,g,O,Y,y,S,G){return await D(o,H,n,E,k,g,Y,S,G)}}T.NO_LOGGING=0,T.MINIMAL_LOGGING=1,T.SUMMARY_LOGGING=2,T.DETAILED_LOGGING=3,T.OnPluginActivatedObservable=z},12896:(o,H,n)=>{"use strict";n.d(H,{e:()=>A});var E=n(11170),k=n(11177),g=n(11024),O=n(11189),Y=n(11213),y=n(11168),S=n(11140),G=n(11026),c=n(11224);n(12905);class A extends Y.e{set boundingBoxSize(o){if(this._boundingBoxSize&&this._boundingBoxSize.equals(o))return;this._boundingBoxSize=o;const H=this.bo();H&&H.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(o){this._rotationY=o,this.setReflectionTextureMatrix(O.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(o,H,n){let E="";for(const k of o)E+=k;return new A(E,H,null,n,o)}static CreateFromPrefilteredData(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const k=H.useDelayedTextureLoading;H.useDelayedTextureLoading=!1;const g=new A(o,H,null,!1,null,null,null,void 0,!0,n,E);return H.useDelayedTextureLoading=k,g}constructor(o,H){var n;let E=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,A=arguments.length>8&&void 0!==arguments[8]&&arguments[8],l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,x=arguments.length>10&&void 0!==arguments[10]&&arguments[10],z=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,V=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,J=arguments.length>13?arguments[13]:void 0,N=arguments.length>14?arguments[14]:void 0;super(H),this.onLoadObservable=new G.d,this.boundingBoxPosition=O.xH.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new O.Matrix,this._buffer=null,this.name=o,this.url=o,this._noMipmap=k,this.fg=!1,this.isCube=!0,this._textureMatrix=O.Matrix.Identity(),this.coordinatesMode=y.c.CUBIC_MODE;let h=null,Q=null;null===E||Array.isArray(E)?(this._noMipmap=k,this._format=c,this._createPolynomials=x,h=E,this._loaderOptions=J,this._useSRGBBuffer=N,this._lodScale=z,this._lodOffset=V):(h=E.extensions??null,this._noMipmap=E.noMipmap??!1,g=E.files??null,Q=E.buffer??null,this._format=E.format??5,A=E.prefiltered??!1,l=E.forcedExtension??null,this._createPolynomials=E.createPolynomials??!1,this._lodScale=E.lodScale??.8,this._lodOffset=E.lodOffset??0,this._loaderOptions=E.loaderOptions,this._useSRGBBuffer=E.useSRGBBuffer,Y=E.R??null,S=E.onError??null),(o||g)&&this.updateURL(o,l,Y,A,S,h,null===(n=this.bo())||void 0===n?void 0:n.useDelayedTextureLoading,g,Q)}getClassName(){return"CubeTexture"}updateURL(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=o),this.url=o,H&&(this._forcedExtension=H);const S=o.lastIndexOf("."),G=H||(S>-1?o.substring(S).toLowerCase():""),c=0===G.indexOf(".dds"),A=0===G.indexOf(".env"),l=0===G.indexOf(".basis");if(A?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=E,E&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),Y)this._files=Y;else if(l||A||c||g||(g=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,g){for(let H=0;H<g.length;H++)this._files.push(o+g[H]);this._extensions=g}this._buffer=y,O?(this.delayLoadState=4,this._delayedOnLoad=n,this._delayedOnError=k):this._loadTexture(n,k)}delayLoad(o){4===this.delayLoadState&&(o&&(this._forcedExtension=o),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(o){var H,n;if(o.updateFlag===this._textureMatrix.updateFlag)return;o.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(n=this.bo())||void 0===n||n.markAllMaterialsAsDirty(1,(o=>-1!==o.getActiveTextures().indexOf(this))));if(this._textureMatrix=o,null===(H=this.bo())||void 0===H||!H.useRightHandedSystem)return;const E=O.TmpVectors.xH[0],k=O.TmpVectors.Quaternion[0],g=O.TmpVectors.xH[1];this._textureMatrix.decompose(E,k,g),k.z*=-1,k.w*=-1,O.Matrix.ComposeToRef(E,k,g,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var o;return null!==(o=this.bo())&&void 0!==o&&o.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this.bo(),E=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const k=()=>{var H;(this.onLoadObservable.notifyObservers(this),E)&&(E.dispose(),null===(H=this.bo())||void 0===H||H.markAllMaterialsAsDirty(1));o&&o()},O=(o,n)=>{this._loadingError=!0,this._errorObject={message:o,exception:n},H&&H(o,n),y.c.OnTextureLoadErrorObservable.notifyObservers(this)};var Y;this._texture?this._texture.isReady?g.Tools.SetImmediate((()=>k())):this._texture.onLoadedObservable.add((()=>k())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,n,this._lodScale,this._lodOffset,o,O,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,n,this._files,this._noMipmap,o,O,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(Y=this._texture)||void 0===Y||Y.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(o,H,n){const E=c.e.Parse((()=>{let E=!1;return o.prefiltered&&(E=o.prefiltered),new A(n+(o.url??o.name),H,o.extensions,!1,o.files||null,null,null,void 0,E,o.forcedExtension)}),o,H);if(o.boundingBoxPosition&&(E.boundingBoxPosition=O.xH.Mg(o.boundingBoxPosition)),o.boundingBoxSize&&(E.boundingBoxSize=O.xH.Mg(o.boundingBoxSize)),o.animations)for(let k=0;k<o.animations.length;k++){const H=o.animations[k],n=(0,S.b)("BABYLON.Animation");n&&E.animations.push(n.Parse(H))}return E}clone(){let o=0;const H=c.e.Clone((()=>{const H=new A(this.url,this.bo()||this._getEngine(),this._extensions,this._noMipmap,this._files);return o=H.uniqueId,H}),this);return H.uniqueId=o,H}}(0,E.c)([(0,k.P)()],A.prototype,"url",void 0),(0,E.c)([(0,k.L)()],A.prototype,"boundingBoxPosition",void 0),(0,E.c)([(0,k.L)()],A.prototype,"boundingBoxSize",null),(0,E.c)([(0,k.P)("rotationY")],A.prototype,"rotationY",null),(0,E.c)([(0,k.P)("files")],A.prototype,"_files",void 0),(0,E.c)([(0,k.P)("forcedExtension")],A.prototype,"_forcedExtension",void 0),(0,E.c)([(0,k.P)("extensions")],A.prototype,"_extensions",void 0),(0,E.c)([(0,k.y)("textureMatrix")],A.prototype,"_textureMatrix",void 0),(0,E.c)([(0,k.y)("textureMatrixRefraction")],A.prototype,"_textureMatrixRefraction",void 0),y.c._CubeTextureParser=A.Parse,(0,S.e)("BABYLON.CubeTexture",A)},13428:(o,H,n)=>{"use strict";n.d(H,{b:()=>y});var E=n(11038),k=n(11168),g=n(11158),O=n(11330),Y=n(11120);O.ThinEngine.prototype.createDynamicTexture=function(o,H,n,E){const k=new Y.d(this,4);return k.baseWidth=o,k.baseHeight=H,n&&(o=this.needPOTTextures?(0,g.d)(o,this._caps.maxTextureSize):o,H=this.needPOTTextures?(0,g.d)(H,this._caps.maxTextureSize):H),k.width=o,k.height=H,k.isReady=!1,k.generateMipMaps=n,k.samplingMode=E,this.updateTextureSamplingMode(E,k),this._internalTexturesCache.push(k),k},O.ThinEngine.prototype.updateDynamicTexture=function(o,H,n){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,g=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!o)return;const O=this._gl,Y=O.TEXTURE_2D,y=this._bindTextureDirectly(Y,o,!0,g);this._unpackFlipY(void 0===n?o.invertY:n),E&&O.pixelStorei(O.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const S=this._getWebGLTextureType(o.type),G=this._getInternalFormat(k||o.format),c=this._getRGBABufferInternalSizedFormat(o.type,G);O.texImage2D(Y,0,c,G,S,H),o.generateMipMaps&&O.generateMipmap(Y),y||this._bindTextureDirectly(Y,null),E&&O.pixelStorei(O.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),k&&(o.format=k),o._dynamicTextureSource=H,o._premulAlpha=E,o.invertY=n||!1,o.isReady=!0};class y extends k.c{constructor(o,H,n){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,Y=arguments.length>6?arguments[6]:void 0;const y=!n||n._isScene;super(null,y?n:null===n||void 0===n?void 0:n.VH,y?!E:n,Y,g,void 0,void 0,void 0,void 0,O),this.name=o,this.wrapU=k.c.CLAMP_ADDRESSMODE,this.wrapV=k.c.CLAMP_ADDRESSMODE,this._generateMipMaps=E;const S=this._getEngine();if(!S)return;if(H.getContext)this._canvas=H,this._ownCanvas=!1,this._texture=S.createDynamicTexture(this._canvas.width,this._canvas.height,E,g);else{this._canvas=S.createCanvas(1,1),this._ownCanvas=!0;const o=H;o.width||0===o.width?this._texture=S.createDynamicTexture(o.width,o.height,E,g):this._texture=S.createDynamicTexture(H,H,E,g)}const G=this.getSize();this._canvas.width!==G.width&&(this._canvas.width=G.width),this._canvas.height!==G.height&&(this._canvas.height=G.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(o){this._canvas.width=o.width,this._canvas.height=o.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(o.width,o.height,this._generateMipMaps,this.samplingMode)}scale(o){const H=this.getSize();H.width*=o,H.height*=o,this._recreate(H)}scaleTo(o,H){const n=this.getSize();n.width=o,n.height=H,this._recreate(n)}getContext(){return this._context}clear(o){const H=this.getSize();o&&(this._context.fillStyle=o),this._context.clearRect(0,0,H.width,H.height)}update(o){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===o||o,H,this._format||void 0,void 0,n)}drawText(o,H,n,E,k,g,O){let Y=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const y=this.getSize();if(g&&(this._context.fillStyle=g,this._context.fillRect(0,0,y.width,y.height)),this._context.font=E,null===H||void 0===H){const n=this._context.measureText(o);H=(y.width-n.width)/2}if(null===n||void 0===n){const o=parseInt(E.replace(/\D/g,""));n=y.height/2+o/3.65}this._context.fillStyle=k||"",this._context.fillText(o,H,n),Y&&this.update(O)}dispose(){var o,H;(super.dispose(),this._ownCanvas)&&(null===(o=this._canvas)||void 0===o||null===(H=o.remove)||void 0===H||H.call(o));this._canvas=null,this._context=null}clone(){const o=this.bo();if(!o)return this;const H=this.getSize(),n=new y(this.name,H,o,this._generateMipMaps);return n.fg=this.fg,n.level=this.level,n.wrapU=this.wrapU,n.wrapV=this.wrapV,n}serialize(){const o=this.bo();o&&!o.isReady()&&E.d.Warn("The scene must be ready before serializing the dynamic texture");const H=super.serialize();return y._IsCanvasElement(this._canvas)&&(H.base64String=this._canvas.toDataURL()),H.invertY=this._invertY,H.samplingMode=this.samplingMode,H}static _IsCanvasElement(o){return void 0!==o.toDataURL}_rebuild(){this.update()}}},12797:(o,H,n)=>{"use strict";n.d(H,{b:()=>k});var E=n(11168);class k extends E.c{get depth(){return this._depth}constructor(o,H,n,k,g,O){let Y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],y=arguments.length>7&&void 0!==arguments[7]&&arguments[7],S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:E.c.TRILINEAR_SAMPLINGMODE,G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,c=arguments.length>10?arguments[10]:void 0;super(null,O,!Y,y),this.format=g,this._texture=O.getEngine().createRawTexture2DArray(o,H,n,k,g,Y,y,S,null,G,c),this._depth=k,this.is2DArray=!0}update(o){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,o,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(o,H,n,E,g){return new k(o,H,n,E,5,g,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12620:(o,H,n)=>{"use strict";n.d(H,{e:()=>Y,g:()=>y,i:()=>g,l:()=>O});var E=n(11205),k=n(11189);function g(o,H){return`{X: ${o.x.toFixed(H)} Y: ${o.y.toFixed(H)}}`}function O(o,H){return`{X: ${o._x.toFixed(H)} Y: ${o._y.toFixed(H)} Z: ${o._z.toFixed(H)}}`}function Y(o,H){return 2*Math.acos((0,E.Clamp)(k.Quaternion.Dot(o,H)))}function y(o,H){const n=new k.Quaternion;return function(o,H,n){const g=k.xH.Cross(o,H),O=Math.acos((0,E.Clamp)(k.xH.Dot(o,H),-1,1));k.Quaternion.RotationAxisToRef(g,O,n)}(o,H,n),n}},12442:(o,H,n)=>{"use strict";n.d(H,{d:()=>S});var E=n(11189),k=n(11238),g=n(11652),O=n(11629),Y=n(11246);n(12444);function y(o){let H=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const n=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],g=[];let y=[];const S=o.width||o.size||1,G=o.height||o.size||1,c=o.depth||o.size||1,A=o.wrap||!1;let l=void 0===o.topBaseAt?1:o.topBaseAt,x=void 0===o.bottomBaseAt?0:o.bottomBaseAt;l=(l+4)%4,x=(x+4)%4;let z=[2,0,3,1][l],V=[2,0,1,3][x],J=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(A){H=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],J=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let o=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],n=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const E=[17,18,19,16],k=[22,23,20,21];for(;z>0;)o.unshift(o.pop()),E.unshift(E.pop()),z--;for(;V>0;)n.unshift(n.pop()),k.unshift(k.pop()),V--;o=o.flat(),n=n.flat(),J=J.concat(o).concat(n),H.push(E[0],E[2],E[3],E[0],E[1],E[2]),H.push(k[0],k[2],k[3],k[0],k[1],k[2])}const N=[S/2,G/2,c/2];y=J.reduce(((o,H,n)=>o.concat(H*N[n%3])),[]);const h=0===o.sideOrientation?0:o.sideOrientation||O.c.DEFAULTSIDE,Q=o.faceUV||new Array(6),p=o.faceColors,j=[];for(let O=0;O<6;O++)void 0===Q[O]&&(Q[O]=new E.Vector4(0,0,1,1)),p&&void 0===p[O]&&(p[O]=new k.d(1,1,1,1));for(let E=0;E<6;E++)if(g.push(Q[E].z,Y.d?1-Q[E].w:Q[E].w),g.push(Q[E].x,Y.d?1-Q[E].w:Q[E].w),g.push(Q[E].x,Y.d?1-Q[E].y:Q[E].y),g.push(Q[E].z,Y.d?1-Q[E].y:Q[E].y),p)for(let o=0;o<4;o++)j.push(p[E].r,p[E].g,p[E].b,p[E].a);O.c._ComputeSides(h,y,H,n,g,o.frontUVs,o.backUVs);const m=new O.c;if(m.indices=H,m.Zo=y,m.Mo=n,m.fo=g,p){const o=h===O.c.DOUBLESIDE?j.concat(j):j;m.Ko=o}return m}function S(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new g.b(o,n);H.sideOrientation=g.b._GetDefaultSideOrientation(H.sideOrientation),E._originalBuilderSideOrientation=H.sideOrientation;return y(H).qo(E,H.updatable),E}O.c.CreateBox=y,g.b.CreateBox=function(o,H){return S(o,{size:H,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12606:(o,H,n)=>{"use strict";n.d(H,{b:()=>Y});var E=n(11652),k=n(11629),g=n(11246);function O(o){const H=[],n=[],E=[],O=[],Y=o.radius||.5,y=o.tessellation||64,S=o.arc&&(o.arc<=0||o.arc>1)?1:o.arc||1,G=0===o.sideOrientation?0:o.sideOrientation||k.c.DEFAULTSIDE;H.push(0,0,0),O.push(.5,.5);const c=2*Math.PI*S,A=1===S?c/y:c/(y-1);let l=0;for(let k=0;k<y;k++){const o=Math.cos(l),n=Math.sin(l),E=(o+1)/2,k=(1-n)/2;H.push(Y*o,Y*n,0),O.push(E,g.d?1-k:k),l+=A}1===S&&(H.push(H[3],H[4],H[5]),O.push(O[2],g.d?1-O[3]:O[3]));const x=H.length/3;for(let k=1;k<x-1;k++)n.push(k+1,0,k);k.c.ComputeNormals(H,n,E),k.c._ComputeSides(G,H,n,E,O,o.frontUVs,o.backUVs);const z=new k.c;return z.indices=n,z.Zo=H,z.Mo=E,z.fo=O,z}function Y(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new E.b(o,n);H.sideOrientation=E.b._GetDefaultSideOrientation(H.sideOrientation),k._originalBuilderSideOrientation=H.sideOrientation;return O(H).qo(k,H.updatable),k}k.c.CreateDisc=O,E.b.CreateDisc=function(o,H,n){return Y(o,{radius:H,tessellation:n,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12444:(o,H,n)=>{"use strict";n.d(H,{e:()=>V,c:()=>N,i:()=>J});var E=n(11189),k=n(11238),g=n(11652),O=n(11629),Y=n(11259);g.b._GroundMeshParser=(o,H)=>y.Parse(o,H);class y extends g.b{constructor(o,H){super(o,H),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=o,this._subdivisionsY=o,this.subdivide(o);const n=this;n.createOrUpdateSubmeshesOctree&&n.createOrUpdateSubmeshesOctree(H)}getHeightAtCoordinates(o,H){const n=this.getWorldMatrix(),k=E.TmpVectors.Matrix[5];n.invertToRef(k);const g=E.TmpVectors.xH[8];if(E.xH.TransformCoordinatesFromFloatsToRef(o,0,H,k,g),o=g.x,H=g.z,o<this._minX||o>=this._maxX||H<=this._minZ||H>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const O=this._getFacetAt(o,H),Y=-(O.x*o+O.z*H+O.w)/O.y;return E.xH.TransformCoordinatesFromFloatsToRef(0,Y,0,n,g),g.y}getNormalAtCoordinates(o,H){const n=new E.xH(0,1,0);return this.getNormalAtCoordinatesToRef(o,H,n),n}getNormalAtCoordinatesToRef(o,H,n){const k=this.getWorldMatrix(),g=E.TmpVectors.Matrix[5];k.invertToRef(g);const O=E.TmpVectors.xH[8];if(E.xH.TransformCoordinatesFromFloatsToRef(o,0,H,g,O),o=O.x,H=O.z,o<this._minX||o>this._maxX||H<this._minZ||H>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Y=this._getFacetAt(o,H);return E.xH.TransformNormalFromFloatsToRef(Y.x,Y.y,Y.z,k,n),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(o,H){const n=Math.floor((o+this._maxX)*this._subdivisionsX/this._width),E=Math.floor(-(H+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),k=this._heightQuads[E*this._subdivisionsX+n];let g;return g=H<k.slope.x*o+k.slope.y?k.facet1:k.facet2,g}_initHeightQuads(){const o=this._subdivisionsX,H=this._subdivisionsY;this._heightQuads=[];for(let n=0;n<H;n++)for(let H=0;H<o;H++){const k={slope:E.Vector2.Zero(),facet1:new E.Vector4(0,0,0,0),facet2:new E.Vector4(0,0,0,0)};this._heightQuads[n*o+H]=k}return this}_computeHeightQuads(){const o=this.getVerticesData(Y.d.PositionKind);if(!o)return this;const H=E.TmpVectors.xH[3],n=E.TmpVectors.xH[2],k=E.TmpVectors.xH[1],g=E.TmpVectors.xH[0],O=E.TmpVectors.xH[4],y=E.TmpVectors.xH[5],S=E.TmpVectors.xH[6],G=E.TmpVectors.xH[7],c=E.TmpVectors.xH[8];let A=0,l=0,x=0,z=0,V=0,J=0,N=0;const h=this._subdivisionsX,Q=this._subdivisionsY;for(let Y=0;Y<Q;Y++)for(let Q=0;Q<h;Q++){A=3*Q,l=Y*(h+1)*3,x=(Y+1)*(h+1)*3,H.x=o[l+A],H.y=o[l+A+1],H.z=o[l+A+2],n.x=o[l+A+3],n.y=o[l+A+4],n.z=o[l+A+5],k.x=o[x+A],k.y=o[x+A+1],k.z=o[x+A+2],g.x=o[x+A+3],g.y=o[x+A+4],g.z=o[x+A+5],z=(g.z-H.z)/(g.x-H.x),V=H.z-z*H.x,n.subtractToRef(H,O),k.subtractToRef(H,y),g.subtractToRef(H,S),E.xH.CrossToRef(S,y,G),E.xH.CrossToRef(O,S,c),G.normalize(),c.normalize(),J=-(G.x*H.x+G.y*H.y+G.z*H.z),N=-(c.x*n.x+c.y*n.y+c.z*n.z);const p=this._heightQuads[Y*h+Q];p.slope.Wg(z,V),p.facet1.Wg(G.x,G.y,G.z,J),p.facet2.Wg(c.x,c.y,c.z,N)}return this}serialize(o){super.serialize(o),o.subdivisionsX=this._subdivisionsX,o.subdivisionsY=this._subdivisionsY,o.minX=this._minX,o.maxX=this._maxX,o.Cg=this._minZ,o.maxZ=this._maxZ,o.width=this._width,o.height=this._height}static Parse(o,H){const n=new y(o.name,H);return n._subdivisionsX=o.subdivisionsX||1,n._subdivisionsY=o.subdivisionsY||1,n._minX=o.minX,n._maxX=o.maxX,n._minZ=o.Cg,n._maxZ=o.maxZ,n._width=o.width,n._height=o.height,n}}var S=n(11024),G=n(11060),c=n(11196),A=n(11246);function l(o){const H=[],n=[],k=[],g=[];let Y,y;const S=o.width||o.size||1,G=o.height||o.size||1,c=0|(o.subdivisionsX||o.subdivisions||1),l=0|(o.subdivisionsY||o.subdivisions||1);for(Y=0;Y<=l;Y++)for(y=0;y<=c;y++){const o=new E.xH(y*S/c-S/2,0,(l-Y)*G/l-G/2),H=new E.xH(0,1,0);n.push(o.x,o.y,o.z),k.push(H.x,H.y,H.z),g.push(y/c,A.d?Y/l:1-Y/l)}for(Y=0;Y<l;Y++)for(y=0;y<c;y++)H.push(y+1+(Y+1)*(c+1)),H.push(y+1+Y*(c+1)),H.push(y+Y*(c+1)),H.push(y+(Y+1)*(c+1)),H.push(y+1+(Y+1)*(c+1)),H.push(y+Y*(c+1));const x=new O.c;return x.indices=H,x.Zo=n,x.Mo=k,x.fo=g,x}function x(o){const H=void 0!==o.xmin&&null!==o.xmin?o.xmin:-1,n=void 0!==o.zmin&&null!==o.zmin?o.zmin:-1,k=void 0!==o.xmax&&null!==o.xmax?o.xmax:1,g=void 0!==o.zmax&&null!==o.zmax?o.zmax:1,Y=o.subdivisions||{w:1,h:1},y=o.precision||{w:1,h:1},S=[],G=[],c=[],A=[];let l,x,z,V;Y.h=Y.h<1?1:Y.h,Y.w=Y.w<1?1:Y.w,y.w=y.w<1?1:y.w,y.h=y.h<1?1:y.h;const J=(k-H)/Y.w,N=(g-n)/Y.h;function h(o,H,n,k){const g=G.length/3,O=y.w+1;for(l=0;l<y.h;l++)for(x=0;x<y.w;x++){const o=[g+x+l*O,g+(x+1)+l*O,g+(x+1)+(l+1)*O,g+x+(l+1)*O];S.push(o[1]),S.push(o[2]),S.push(o[3]),S.push(o[0]),S.push(o[1]),S.push(o[3])}const Y=E.xH.Zero(),z=new E.xH(0,1,0);for(l=0;l<=y.h;l++)for(Y.z=l*(k-H)/y.h+H,x=0;x<=y.w;x++)Y.x=x*(n-o)/y.w+o,Y.y=0,G.push(Y.x,Y.y,Y.z),c.push(z.x,z.y,z.z),A.push(x/y.w,l/y.h)}for(z=0;z<Y.h;z++)for(V=0;V<Y.w;V++)h(H+V*J,n+z*N,H+(V+1)*J,n+(z+1)*N);const Q=new O.c;return Q.indices=S,Q.Zo=G,Q.Mo=c,Q.fo=A,Q}function z(o){const H=[],n=[],g=[],Y=[];let y,S;const G=o.colorFilter||new k.NH(.3,.59,.11),A=o.alphaFilter||0;let l=!1;if(o.minHeight>o.maxHeight){l=!0;const H=o.maxHeight;o.maxHeight=o.minHeight,o.minHeight=H}for(y=0;y<=o.subdivisions;y++)for(S=0;S<=o.subdivisions;S++){const H=new E.xH(S*o.width/o.subdivisions-o.width/2,0,(o.subdivisions-y)*o.height/o.subdivisions-o.height/2),k=4*(((H.x+o.width/2)/o.width*(o.bufferWidth-1)|0)+((1-(H.z+o.height/2)/o.height)*(o.bufferHeight-1)|0)*o.bufferWidth);let O=o.buffer[k]/255,x=o.buffer[k+1]/255,z=o.buffer[k+2]/255;const V=o.buffer[k+3]/255;l&&(O=1-O,x=1-x,z=1-z);const J=O*G.r+x*G.g+z*G.b;H.y=V>=A?o.minHeight+(o.maxHeight-o.minHeight)*J:o.minHeight-c.e,o.heightBuffer&&(o.heightBuffer[y*(o.subdivisions+1)+S]=H.y),n.push(H.x,H.y,H.z),g.push(0,0,0),Y.push(S/o.subdivisions,1-y/o.subdivisions)}for(y=0;y<o.subdivisions;y++)for(S=0;S<o.subdivisions;S++){const E=S+1+(y+1)*(o.subdivisions+1),k=S+1+y*(o.subdivisions+1),g=S+y*(o.subdivisions+1),O=S+(y+1)*(o.subdivisions+1),Y=n[3*E+1]>=o.minHeight,G=n[3*k+1]>=o.minHeight,c=n[3*g+1]>=o.minHeight;Y&&G&&c&&(H.push(E),H.push(k),H.push(g));n[3*O+1]>=o.minHeight&&Y&&c&&(H.push(O),H.push(E),H.push(g))}O.c.ComputeNormals(n,H,g);const x=new O.c;return x.indices=H,x.Zo=n,x.Mo=g,x.fo=Y,x}function V(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new y(o,arguments.length>2?arguments[2]:void 0);n._setReady(!1),n._subdivisionsX=H.subdivisionsX||H.subdivisions||1,n._subdivisionsY=H.subdivisionsY||H.subdivisions||1,n._width=H.width||1,n._height=H.height||1,n._maxX=n._width/2,n._maxZ=n._height/2,n._minX=-n._maxX,n._minZ=-n._maxZ;return l(H).qo(n,H.updatable),n._setReady(!0),n}function J(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new g.b(o,n);return x(H).qo(E,H.updatable),E}function N(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const g=n.width||10,O=n.height||10,Y=n.subdivisions||1,c=n.minHeight||0,A=n.maxHeight||1,l=n.colorFilter||new k.NH(.3,.59,.11),x=n.alphaFilter||0,V=n.updatable,J=n.onReady;E=E||G.e.LastCreatedScene;const N=new y(o,E);let h;N._subdivisionsX=Y,N._subdivisionsY=Y,N._width=g,N._height=O,N._maxX=N._width/2,N._maxZ=N._height/2,N._minX=-N._maxX,N._minZ=-N._maxZ,N._setReady(!1),n.passHeightBufferInCallback&&(h=new Float32Array((Y+1)*(Y+1)));const Q=(o,H,n)=>{z({width:g,height:O,subdivisions:Y,minHeight:c,maxHeight:A,colorFilter:l,buffer:o,bufferWidth:H,bufferHeight:n,alphaFilter:x,heightBuffer:h}).qo(N,V),J&&J(N,h),N._setReady(!0)};if("string"===typeof H){const o=o=>{var H;const n=o.width,k=o.height;if(E.l)return;const g=null===(H=E)||void 0===H?void 0:H.getEngine().resizeImageBitmap(o,n,k);Q(g,n,k)};S.Tools.LoadImage(H,o,n.onError?n.onError:()=>{},E.offlineProvider)}else Q(H.data,H.width,H.height);return N}O.c.CreateGround=l,O.c.CreateTiledGround=x,O.c.CreateGroundFromHeightMap=z,g.b.CreateGround=(o,H,n,E,k,g)=>V(o,{width:H,height:n,subdivisions:E,updatable:g},k),g.b.CreateTiledGround=(o,H,n,E,k,g,O,Y,y)=>J(o,{xmin:H,zmin:n,xmax:E,zmax:k,subdivisions:g,precision:O,updatable:y},Y),g.b.CreateGroundFromHeightMap=(o,H,n,E,k,g,O,Y,y,S,G)=>N(o,H,{width:n,height:E,subdivisions:k,minHeight:g,maxHeight:O,updatable:y,onReady:S,alphaFilter:G},Y)},13114:(o,H,n)=>{"use strict";n.d(H,{e:()=>l,f:()=>c,i:()=>A});var E=n(11189),k=n(11652),g=n(11629),O=n(11741),Y=n(11259),y=n(11038);function S(o){const H=[],n=[],E=o.lines,k=o.Ko,O=[];let Y=0;for(let g=0;g<E.length;g++){const o=E[g];for(let E=0;E<o.length;E++){const{x:y,y:S,z:G}=o[E];if(n.push(y,S,G),k){const o=k[g],{r:H,g:n,b:Y,a:y}=o[E];O.push(H,n,Y,y)}E>0&&(H.push(Y-1),H.push(Y)),Y++}}const y=new g.c;return y.indices=H,y.Zo=n,k&&(y.Ko=O),y}function G(o){const H=o.dashSize||3,n=o.gapSize||1,k=o.dashNb||200,O=o.points,Y=[],y=[],S=E.xH.Zero();let G=0,c=0,A=0,l=0,x=0,z=0,V=0;for(V=0;V<O.length-1;V++)O[V+1].subtractToRef(O[V],S),G+=S.length();for(A=G/k,l=H*A/(H+n),V=0;V<O.length-1;V++){O[V+1].subtractToRef(O[V],S),c=Math.floor(S.length()/A),S.normalize();for(let o=0;o<c;o++)x=A*o,Y.push(O[V].x+x*S.x,O[V].y+x*S.y,O[V].z+x*S.z),Y.push(O[V].x+(x+l)*S.x,O[V].y+(x+l)*S.y,O[V].z+(x+l)*S.z),y.push(z,z+1),z+=2}const J=new g.c;return J.Zo=Y,J.indices=y,J}function c(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=H.instance,k=H.lines,g=H.Ko;if(E){const o=E.getVerticesData(Y.d.PositionKind);let H,n;g&&(H=E.getVerticesData(Y.d.ColorKind));let O=0,y=0;for(let E=0;E<k.length;E++){const Y=k[E];for(let k=0;k<Y.length;k++)o[O]=Y[k].x,o[O+1]=Y[k].y,o[O+2]=Y[k].z,g&&H&&(n=g[E],H[y]=n[k].r,H[y+1]=n[k].g,H[y+2]=n[k].b,H[y+3]=n[k].a,y+=4),O+=3}return E.updateVerticesData(Y.d.PositionKind,o,!1,!1),g&&H&&E.updateVerticesData(Y.d.ColorKind,H,!1,!1),E.refreshBoundingInfo(),E}const y=!!g,G=new O.d(o,n,null,void 0,void 0,y,H.useVertexAlpha,H.material);return S(H).qo(G,H.updatable),G}function A(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=H.Ko?[H.Ko]:null;return c(o,{lines:[H.points],updatable:H.updatable,instance:H.instance,Ko:E,useVertexAlpha:H.useVertexAlpha,material:H.material},n)}function l(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=H.points,Y=H.instance,S=H.gapSize||1,c=H.dashSize||3;if(Y){const o=o=>{const H=E.xH.Zero(),n=o.length/6;let k=0,O=0,y=0,S=0,G=0,c=0,A=0,l=0;for(A=0;A<g.length-1;A++)g[A+1].subtractToRef(g[A],H),k+=H.length();y=k/n;const x=Y._creationDataStorage.dashSize;for(S=x*y/(x+Y._creationDataStorage.gapSize),A=0;A<g.length-1;A++)for(g[A+1].subtractToRef(g[A],H),O=Math.floor(H.length()/y),H.normalize(),l=0;l<O&&c<o.length;)G=y*l,o[c]=g[A].x+G*H.x,o[c+1]=g[A].y+G*H.y,o[c+2]=g[A].z+G*H.z,o[c+3]=g[A].x+(G+S)*H.x,o[c+4]=g[A].y+(G+S)*H.y,o[c+5]=g[A].z+(G+S)*H.z,c+=6,l++;for(;c<o.length;)o[c]=g[A].x,o[c+1]=g[A].y,o[c+2]=g[A].z,c+=3};return(H.dashNb||H.dashSize||H.gapSize||H.useVertexAlpha||H.material)&&y.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),Y.updateMeshPositions(o,!1),Y}const A=new O.d(o,n,null,void 0,void 0,void 0,H.useVertexAlpha,H.material);return G(H).qo(A,H.updatable),A._creationDataStorage=new k.c,A._creationDataStorage.dashSize=c,A._creationDataStorage.gapSize=S,A}g.c.CreateLineSystem=S,g.c.CreateDashedLines=G,k.b.yS=function(o,H){return A(o,{points:H,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},k.b.CreateDashedLines=function(o,H,n,E,k){return l(o,{points:H,dashSize:n,gapSize:E,dashNb:k,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12504:(o,H,n)=>{"use strict";n.d(H,{e:()=>Y,g:()=>y});var E=n(11652),k=n(11629),g=n(11246);function O(o){const H=[],n=[],E=[],O=[],Y=void 0!==o.width?o.width:void 0!==o.size?o.size:1,y=void 0!==o.height?o.height:void 0!==o.size?o.size:1,S=0===o.sideOrientation?0:o.sideOrientation||k.c.DEFAULTSIDE,G=Y/2,c=y/2;n.push(-G,-c,0),E.push(0,0,-1),O.push(0,g.d?1:0),n.push(G,-c,0),E.push(0,0,-1),O.push(1,g.d?1:0),n.push(G,c,0),E.push(0,0,-1),O.push(1,g.d?0:1),n.push(-G,c,0),E.push(0,0,-1),O.push(0,g.d?0:1),H.push(0),H.push(1),H.push(2),H.push(0),H.push(2),H.push(3),k.c._ComputeSides(S,n,H,E,O,o.frontUVs,o.backUVs);const A=new k.c;return A.indices=H,A.Zo=n,A.Mo=E,A.fo=O,A}function Y(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new E.b(o,n);H.sideOrientation=E.b._GetDefaultSideOrientation(H.sideOrientation),k._originalBuilderSideOrientation=H.sideOrientation;return O(H).qo(k,H.updatable),H.sourcePlane&&(k.translate(H.sourcePlane.normal,-H.sourcePlane.d),k.setDirection(H.sourcePlane.normal.scale(-1))),k}const y={GS:Y};k.c.GS=O,E.b.GS=(o,H,n,E,k)=>Y(o,{size:H,width:H,height:H,sideOrientation:k,updatable:E},n)},12595:(o,H,n)=>{"use strict";n.d(H,{b:()=>y});var E=n(11189),k=n(11652),g=n(11629),O=n(11246);function Y(o){const H=0|(o.segments||32),n=o.diameterX||o.diameter||1,k=o.diameterY||o.diameter||1,Y=o.diameterZ||o.diameter||1,y=o.arc&&(o.arc<=0||o.arc>1)?1:o.arc||1,S=o.slice&&o.slice<=0?1:o.slice||1,G=0===o.sideOrientation?0:o.sideOrientation||g.c.DEFAULTSIDE,c=!!o.dedupTopBottomIndices,A=new E.xH(n/2,k/2,Y/2),l=2+H,x=2*l,z=[],V=[],J=[],N=[];for(let g=0;g<=l;g++){const o=g/l,H=o*Math.PI*S;for(let n=0;n<=x;n++){const k=n/x,g=k*Math.PI*2*y,Y=E.Matrix.RotationZ(-H),S=E.Matrix.RotationY(g),G=E.xH.TransformCoordinates(E.xH.Up(),Y),c=E.xH.TransformCoordinates(G,S),l=c.multiply(A),z=c.divide(A).normalize();V.push(l.x,l.y,l.z),J.push(z.x,z.y,z.z),N.push(k,O.d?1-o:o)}if(g>0){const o=V.length/3;for(let H=o-2*(x+1);H+x+2<o;H++)c?(g>1&&(z.push(H),z.push(H+1),z.push(H+x+1)),(g<l||S<1)&&(z.push(H+x+1),z.push(H+1),z.push(H+x+2))):(z.push(H),z.push(H+1),z.push(H+x+1),z.push(H+x+1),z.push(H+1),z.push(H+x+2))}}g.c._ComputeSides(G,V,z,J,N,o.frontUVs,o.backUVs);const h=new g.c;return h.indices=z,h.Zo=V,h.Mo=J,h.fo=N,h}function y(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new k.b(o,n);H.sideOrientation=k.b._GetDefaultSideOrientation(H.sideOrientation),E._originalBuilderSideOrientation=H.sideOrientation;return Y(H).qo(E,H.updatable),E}g.c.CreateSphere=Y,k.b.CreateSphere=(o,H,n,E,k,g)=>y(o,{segments:H,diameterX:n,diameterY:n,diameterZ:n,sideOrientation:g,updatable:k},E)},13440:(o,H,n)=>{"use strict";n.d(H,{c:()=>Y});var E=n(11765),k=n(12912),g=n(11784),O=n(11629);class Y{static get Configuration(){return{get decoder(){return k.e.DefaultConfiguration},set decoder(o){k.e.DefaultConfiguration=o}}}static set Configuration(o){k.e.DefaultConfiguration=o.decoder}static get DecoderAvailable(){return(0,E.f)(k.e.DefaultConfiguration)}static get Default(){return Y._Default??(Y._Default=new Y),Y._Default}static ResetDefault(o){Y._Default&&(o||Y._Default.dispose(),Y._Default=null)}constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y.DefaultNumWorkers;const H="number"===typeof o?{...k.e.DefaultConfiguration,numWorkers:o}:{...k.e.DefaultConfiguration,...o};this._decoder=new k.e(H)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(o,H,n){return this._decoder.decodeMeshToMeshDataAsync(o,H,n)}async decodeMeshToGeometryAsync(o,H,n,E){return await this._decoder.decodeMeshToGeometryAsync(o,H,n,E)}async _decodeMeshToGeometryForGltfAsync(o,H,n,E,k,g){return await this._decoder._decodeMeshToGeometryForGltfAsync(o,H,n,E,k,g)}async decodeMeshAsync(o,H){const n=await this._decoder.decodeMeshToMeshDataAsync(o,H),E=new O.c;n.indices&&(E.indices=n.indices);for(const k of n.attributes){const o=g.c.GetFloatData(k.data,k.size,g.c.GetDataType(k.data),k.byteOffset,k.byteStride,k.normalized,n.totalVertices);E.set(o,k.kind)}return E}}Y.DefaultNumWorkers=(0,E.e)(),Y._Default=null},12912:(o,H,n)=>{"use strict";n.d(H,{e:()=>S});var E=n(11765),k=n(11024),g=n(11664),O=n(11784),Y=n(11038),y=n(11776);class S extends E.c{static get DefaultAvailable(){return(0,E.f)(S.DefaultConfiguration)}static get Default(){return S._Default??(S._Default=new S),S._Default}static ResetDefault(o){S._Default&&(o||S._Default.dispose(),S._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(o,H){return{module:await(H||DracoDecoderModule)({wasmBinary:o})}}_getWorkerContent(){return`${y.b}(${y.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.DefaultConfiguration)}decodeMeshToMeshDataAsync(o,H,n){const E=o instanceof ArrayBuffer?new Int8Array(o):new Int8Array(o.buffer,o.byteOffset,o.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async o=>await new Promise(((k,g)=>{o.push(((o,O)=>{let y=null;const S=[],G=H=>{o.removeEventListener("error",G),o.removeEventListener("message",c),g(H),O()},c=H=>{const E=H.data;switch(E.id){case"indices":y=E.data;break;case"attribute":S.push({kind:E.kind,data:E.data,size:E.size,byteOffset:E.byteOffset,byteStride:E.byteStride,normalized:(g=E.kind,A=E.normalized,n&&void 0!==n[g]?(A!==n[g]&&Y.d.Warn(`Normalized flag from Draco data (${A}) does not match normalized flag from glTF accessor (${n[g]}). Using flag from glTF accessor.`),n[g]):A)});break;case"decodeMeshDone":o.removeEventListener("error",G),o.removeEventListener("message",c),k({indices:y,attributes:S,totalVertices:E.totalVertices}),O()}var g,A};o.addEventListener("error",G),o.addEventListener("message",c);const A=E.slice();o.postMessage({id:"decodeMesh",dataView:A,attributes:H},[A.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((o=>{let n=null;const k=[],g=(0,y.b)(o.module,E,H,(o=>{n=o}),((o,H,n,E,g,O)=>{k.push({kind:o,data:H,size:n,byteOffset:E,byteStride:g,normalized:O})}));return{indices:n,attributes:k,totalVertices:g}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(o,H,n,E){const k=await this.decodeMeshToMeshDataAsync(n,E),Y=new g.b(o,H);k.indices&&Y.setIndices(k.indices);for(const g of k.attributes)Y.setVerticesBuffer(new O.c(H.getEngine(),g.data,g.kind,!1,void 0,g.byteStride,void 0,g.byteOffset,g.size,void 0,g.normalized,!0),k.totalVertices);return Y}async _decodeMeshToGeometryForGltfAsync(o,H,n,E,k,Y){const y=await this.decodeMeshToMeshDataAsync(n,E,k),S=new g.b(o,H);Y&&(S._boundingInfo=Y,S.useBoundingInfoFromGeometry=!0),y.indices&&S.setIndices(y.indices);for(const g of y.attributes)S.setVerticesBuffer(new O.c(H.getEngine(),g.data,g.kind,!1,void 0,g.byteStride,void 0,g.byteOffset,g.size,void 0,g.normalized,!0),y.totalVertices);return S}}S.DefaultConfiguration={wasmUrl:`${k.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${k.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${k.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},S._Default=null},13107:(o,H,n)=>{"use strict";n.d(H,{c:()=>Yo});var E=n(11189),k=n(11652),g=n(11259),O=n(11629),Y=n(11246);function y(o){let H=o.pathArray;const n=o.closeArray||!1,E=o.closePath||!1,k=o.invertUV||!1,y=Math.floor(H[0].length/2);let S=o.offset||y;S=S>y?y:Math.floor(S);const G=0===o.sideOrientation?0:o.sideOrientation||O.c.DEFAULTSIDE,c=o.fo,A=o.Ko,l=[],x=[],z=[],V=[],J=[],N=[],h=[],Q=[];let p;const j=[],m=[];let P,b,e;if(H.length<2){const o=[],n=[];for(b=0;b<H[0].length-S;b++)o.push(H[0][b]),n.push(H[0][b+S]);H=[o,n]}let Z=0;const M=E?1:0,K=n?1:0;let f,B,q,D,T,a;for(p=H[0].length,P=0;P<H.length+K;P++){for(h[P]=0,J[P]=[0],f=P===H.length?H[0]:H[P],B=f.length,p=p<B?p:B,e=0;e<B;)l.push(f[e].x,f[e].y,f[e].z),e>0&&(q=f[e].zH(f[e-1]).length(),D=q+h[P],J[P].push(D),h[P]=D),e++;E&&(e--,l.push(f[0].x,f[0].y,f[0].z),q=f[e].zH(f[0]).length(),D=q+h[P],J[P].push(D),h[P]=D),j[P]=B+M,m[P]=Z,Z+=B+M}let F,C,t=null,X=null;for(b=0;b<p+M;b++)for(Q[b]=0,N[b]=[0],P=0;P<H.length-1+K;P++)T=H[P],a=P===H.length-1?H[0]:H[P+1],b===p?(t=T[0],X=a[0]):(t=T[b],X=a[b]),q=X.zH(t).length(),D=q+Q[b],N[b].push(D),Q[b]=D;if(c)for(P=0;P<c.length;P++)V.push(c[P].x,Y.d?1-c[P].y:c[P].y);else for(P=0;P<H.length+K;P++)for(b=0;b<p+M;b++)F=0!=h[P]?J[P][b]/h[P]:0,C=0!=Q[b]?N[b][P]/Q[b]:0,k?V.push(C,F):V.push(F,Y.d?1-C:C);P=0;let s=0,U=j[P]-1,I=j[P+1]-1,v=U<I?U:I,w=m[1]-m[0];const r=j.length-1;for(;s<=v&&P<r;)x.push(s,s+w,s+1),x.push(s+w+1,s+1,s+w),s+=1,s===v&&(P++,w=m[P+1]-m[P],U=j[P]-1,I=j[P+1]-1,s=m[P],v=U<I?U+s:I+s);if(O.c.ComputeNormals(l,x,z),E){let o=0,n=0;for(P=0;P<H.length;P++){o=3*m[P],n=P+1<H.length?3*(m[P+1]-1):z.length-3,z[o]=.5*(z[o]+z[n]),z[o+1]=.5*(z[o+1]+z[n+1]),z[o+2]=.5*(z[o+2]+z[n+2]);const E=Math.sqrt(z[o]*z[o]+z[o+1]*z[o+1]+z[o+2]*z[o+2]);z[o]/=E,z[o+1]/=E,z[o+2]/=E,z[n]=z[o],z[n+1]=z[o+1],z[n+2]=z[o+2]}}if(n){let o=3*m[0],n=3*m[H.length];for(b=0;b<p+M;b++){z[o]=.5*(z[o]+z[n]),z[o+1]=.5*(z[o+1]+z[n+1]),z[o+2]=.5*(z[o+2]+z[n+2]);const H=Math.sqrt(z[o]*z[o]+z[o+1]*z[o+1]+z[o+2]*z[o+2]);z[o]/=H,z[o+1]/=H,z[o+2]/=H,z[n]=z[o],z[n+1]=z[o+1],z[n+2]=z[o+2],o+=3,n+=3}}O.c._ComputeSides(G,l,x,z,V,o.frontUVs,o.backUVs);let u=null;if(A){u=new Float32Array(4*A.length);for(let o=0;o<A.length;o++)u[4*o]=A[o].r,u[4*o+1]=A[o].g,u[4*o+2]=A[o].b,u[4*o+3]=A[o].a}const d=new O.c,R=new Float32Array(l),W=new Float32Array(z),i=new Float32Array(V);return d.indices=x,d.Zo=R,d.Mo=W,d.fo=i,u&&d.set(u,g.d.ColorKind),E&&(d._idx=m),d}function S(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const S=H.pathArray,G=H.closeArray,c=H.closePath,A=k.b._GetDefaultSideOrientation(H.sideOrientation),l=H.instance,x=H.updatable;if(l){const o=E.TmpVectors.xH[0].AY(Number.MAX_VALUE),n=E.TmpVectors.xH[1].AY(-Number.MAX_VALUE),y=H=>{let E=S[0].length;const g=l;let O=0;const Y=g._originalBuilderSideOrientation===k.b.DOUBLESIDE?2:1;for(let k=1;k<=Y;++k)for(let Y=0;Y<S.length;++Y){const k=S[Y],y=k.length;E=E<y?E:y;for(let g=0;g<E;++g){const E=k[g];H[O]=E.x,H[O+1]=E.y,H[O+2]=E.z,o.minimizeInPlaceFromFloats(E.x,E.y,E.z),n.maximizeInPlaceFromFloats(E.x,E.y,E.z),O+=3}if(g._creationDataStorage&&g._creationDataStorage.closePath){const o=k[0];H[O]=o.x,H[O+1]=o.y,H[O+2]=o.z,O+=3}}},G=l.getVerticesData(g.d.PositionKind);if(y(G),l.hasBoundingInfo?l.getBoundingInfo().reConstruct(o,n,l._worldMatrix):l.buildBoundingInfo(o,n,l._worldMatrix),l.updateVerticesData(g.d.PositionKind,G,!1,!1),H.Ko){const o=l.getVerticesData(g.d.ColorKind);for(let n=0,E=0;n<H.Ko.length;n++,E+=4){const k=H.Ko[n];o[E]=k.r,o[E+1]=k.g,o[E+2]=k.b,o[E+3]=k.a}l.updateVerticesData(g.d.ColorKind,o,!1,!1)}if(H.fo){const o=l.getVerticesData(g.d.UVKind);for(let n=0;n<H.fo.length;n++)o[2*n]=H.fo[n].x,o[2*n+1]=Y.d?1-H.fo[n].y:H.fo[n].y;l.updateVerticesData(g.d.UVKind,o,!1,!1)}if(!l.areNormalsFrozen||l.isFacetDataEnabled){const o=l.dg(),H=l.getVerticesData(g.d.NormalKind),n=l.isFacetDataEnabled?l.getFacetDataParameters():null;if(O.c.ComputeNormals(G,o,H,n),l._creationDataStorage&&l._creationDataStorage.closePath){let o=0,n=0;for(let E=0;E<S.length;E++)o=3*l._creationDataStorage.idx[E],n=E+1<S.length?3*(l._creationDataStorage.idx[E+1]-1):H.length-3,H[o]=.5*(H[o]+H[n]),H[o+1]=.5*(H[o+1]+H[n+1]),H[o+2]=.5*(H[o+2]+H[n+2]),H[n]=H[o],H[n+1]=H[o+1],H[n+2]=H[o+2]}l.areNormalsFrozen||l.updateVerticesData(g.d.NormalKind,H,!1,!1)}return l}{const E=new k.b(o,n);E._originalBuilderSideOrientation=A,E._creationDataStorage=new k.c;const g=y(H);return c&&(E._creationDataStorage.idx=g._idx),E._creationDataStorage.closePath=c,E._creationDataStorage.closeArray=G,g.qo(E,x),E}}O.c.CreateRibbon=y,k.b.CreateRibbon=function(o,H){return S(o,{pathArray:H,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var G=n(12606),c=n(12442),A=n(11238);function l(o){const H=o.pattern||k.b.NO_FLIP,n=o.tileWidth||o.tileSize||1,E=o.tileHeight||o.tileSize||1,g=o.alignHorizontal||0,Y=o.alignVertical||0,y=o.width||o.size||1,S=Math.floor(y/n);let G=y-S*n;const c=o.height||o.size||1,A=Math.floor(c/E);let l=c-A*E;const x=n*S/2,z=E*A/2;let V=0,J=0,N=0,h=0,Q=0,p=0;if(G>0||l>0){switch(N=-x,h=-z,Q=x,p=z,g){case k.b.CENTER:G/=2,N-=G,Q+=G;break;case k.b.LEFT:Q+=G,V=-G/2;break;case k.b.RIGHT:N-=G,V=G/2}switch(Y){case k.b.CENTER:l/=2,h-=l,p+=l;break;case k.b.BOTTOM:p+=l,J=-l/2;break;case k.b.TOP:h-=l,J=l/2}}const j=[],m=[],P=[];P[0]=[0,0,1,0,1,1,0,1],P[1]=[0,0,1,0,1,1,0,1],H!==k.b.ROTATE_TILE&&H!==k.b.ROTATE_ROW||(P[1]=[1,1,0,1,0,0,1,0]),H!==k.b.FLIP_TILE&&H!==k.b.FLIP_ROW||(P[1]=[1,0,0,0,0,1,1,1]),H!==k.b.FLIP_N_ROTATE_TILE&&H!==k.b.FLIP_N_ROTATE_ROW||(P[1]=[0,1,1,1,1,0,0,0]);let b=[];const e=[],Z=[];let M=0;for(let O=0;O<A;O++)for(let o=0;o<S;o++)j.push(o*n-x+V,O*E-z+J,0),j.push((o+1)*n-x+V,O*E-z+J,0),j.push((o+1)*n-x+V,(O+1)*E-z+J,0),j.push(o*n-x+V,(O+1)*E-z+J,0),Z.push(M,M+1,M+3,M+1,M+2,M+3),b=H===k.b.FLIP_TILE||H===k.b.ROTATE_TILE||H===k.b.FLIP_N_ROTATE_TILE?b.concat(P[(o%2+O%2)%2]):H===k.b.FLIP_ROW||H===k.b.ROTATE_ROW||H===k.b.FLIP_N_ROTATE_ROW?b.concat(P[O%2]):b.concat(P[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),M+=4;if(G>0||l>0){const o=l>0&&(Y===k.b.CENTER||Y===k.b.TOP),O=l>0&&(Y===k.b.CENTER||Y===k.b.BOTTOM),y=G>0&&(g===k.b.CENTER||g===k.b.RIGHT),c=G>0&&(g===k.b.CENTER||g===k.b.LEFT);let P,K,f,B,q=[];if(o&&y&&(j.push(N+V,h+J,0),j.push(-x+V,h+J,0),j.push(-x+V,h+l+J,0),j.push(N+V,h+l+J,0),Z.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,P=1-G/n,K=1-l/E,f=1,B=1,q=[P,K,f,K,f,B,P,B],H===k.b.ROTATE_ROW&&(q=[1-P,1-K,1-f,1-K,1-f,1-B,1-P,1-B]),H===k.b.FLIP_ROW&&(q=[1-P,K,1-f,K,1-f,B,1-P,B]),H===k.b.FLIP_N_ROTATE_ROW&&(q=[P,1-K,f,1-K,f,1-B,P,1-B]),b=b.concat(q),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),o&&c&&(j.push(x+V,h+J,0),j.push(Q+V,h+J,0),j.push(Q+V,h+l+J,0),j.push(x+V,h+l+J,0),Z.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,P=0,K=1-l/E,f=G/n,B=1,q=[P,K,f,K,f,B,P,B],(H===k.b.ROTATE_ROW||H===k.b.ROTATE_TILE&&S%2===0)&&(q=[1-P,1-K,1-f,1-K,1-f,1-B,1-P,1-B]),(H===k.b.FLIP_ROW||H===k.b.FLIP_TILE&&S%2===0)&&(q=[1-P,K,1-f,K,1-f,B,1-P,B]),(H===k.b.FLIP_N_ROTATE_ROW||H===k.b.FLIP_N_ROTATE_TILE&&S%2===0)&&(q=[P,1-K,f,1-K,f,1-B,P,1-B]),b=b.concat(q),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),O&&y&&(j.push(N+V,z+J,0),j.push(-x+V,z+J,0),j.push(-x+V,p+J,0),j.push(N+V,p+J,0),Z.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,P=1-G/n,K=0,f=1,B=l/E,q=[P,K,f,K,f,B,P,B],(H===k.b.ROTATE_ROW&&A%2===1||H===k.b.ROTATE_TILE&&A%1===0)&&(q=[1-P,1-K,1-f,1-K,1-f,1-B,1-P,1-B]),(H===k.b.FLIP_ROW&&A%2===1||H===k.b.FLIP_TILE&&A%2===0)&&(q=[1-P,K,1-f,K,1-f,B,1-P,B]),(H===k.b.FLIP_N_ROTATE_ROW&&A%2===1||H===k.b.FLIP_N_ROTATE_TILE&&A%2===0)&&(q=[P,1-K,f,1-K,f,1-B,P,1-B]),b=b.concat(q),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),O&&c&&(j.push(x+V,z+J,0),j.push(Q+V,z+J,0),j.push(Q+V,p+J,0),j.push(x+V,p+J,0),Z.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,P=0,K=0,f=G/n,B=l/E,q=[P,K,f,K,f,B,P,B],(H===k.b.ROTATE_ROW&&A%2===1||H===k.b.ROTATE_TILE&&(A+S)%2===1)&&(q=[1-P,1-K,1-f,1-K,1-f,1-B,1-P,1-B]),(H===k.b.FLIP_ROW&&A%2===1||H===k.b.FLIP_TILE&&(A+S)%2===1)&&(q=[1-P,K,1-f,K,1-f,B,1-P,B]),(H===k.b.FLIP_N_ROTATE_ROW&&A%2===1||H===k.b.FLIP_N_ROTATE_TILE&&(A+S)%2===1)&&(q=[P,1-K,f,1-K,f,1-B,P,1-B]),b=b.concat(q),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),o){const o=[];P=0,K=1-l/E,f=1,B=1,o[0]=[P,K,f,K,f,B,P,B],o[1]=[P,K,f,K,f,B,P,B],H!==k.b.ROTATE_TILE&&H!==k.b.ROTATE_ROW||(o[1]=[1-P,1-K,1-f,1-K,1-f,1-B,1-P,1-B]),H!==k.b.FLIP_TILE&&H!==k.b.FLIP_ROW||(o[1]=[1-P,K,1-f,K,1-f,B,1-P,B]),H!==k.b.FLIP_N_ROTATE_TILE&&H!==k.b.FLIP_N_ROTATE_ROW||(o[1]=[P,1-K,f,1-K,f,1-B,P,1-B]);for(let E=0;E<S;E++)j.push(E*n-x+V,h+J,0),j.push((E+1)*n-x+V,h+J,0),j.push((E+1)*n-x+V,h+l+J,0),j.push(E*n-x+V,h+l+J,0),Z.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,b=H===k.b.FLIP_TILE||H===k.b.ROTATE_TILE||H===k.b.FLIP_N_ROTATE_TILE?b.concat(o[(E+1)%2]):H===k.b.FLIP_ROW||H===k.b.ROTATE_ROW||H===k.b.FLIP_N_ROTATE_ROW?b.concat(o[1]):b.concat(o[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(O){const o=[];P=0,K=0,f=1,B=l/E,o[0]=[P,K,f,K,f,B,P,B],o[1]=[P,K,f,K,f,B,P,B],H!==k.b.ROTATE_TILE&&H!==k.b.ROTATE_ROW||(o[1]=[1-P,1-K,1-f,1-K,1-f,1-B,1-P,1-B]),H!==k.b.FLIP_TILE&&H!==k.b.FLIP_ROW||(o[1]=[1-P,K,1-f,K,1-f,B,1-P,B]),H!==k.b.FLIP_N_ROTATE_TILE&&H!==k.b.FLIP_N_ROTATE_ROW||(o[1]=[P,1-K,f,1-K,f,1-B,P,1-B]);for(let E=0;E<S;E++)j.push(E*n-x+V,p-l+J,0),j.push((E+1)*n-x+V,p-l+J,0),j.push((E+1)*n-x+V,p+J,0),j.push(E*n-x+V,p+J,0),Z.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,b=H===k.b.FLIP_TILE||H===k.b.ROTATE_TILE||H===k.b.FLIP_N_ROTATE_TILE?b.concat(o[(E+A)%2]):H===k.b.FLIP_ROW||H===k.b.ROTATE_ROW||H===k.b.FLIP_N_ROTATE_ROW?b.concat(o[A%2]):b.concat(o[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(y){const o=[];P=1-G/n,K=0,f=1,B=1,o[0]=[P,K,f,K,f,B,P,B],o[1]=[P,K,f,K,f,B,P,B],H!==k.b.ROTATE_TILE&&H!==k.b.ROTATE_ROW||(o[1]=[1-P,1-K,1-f,1-K,1-f,1-B,1-P,1-B]),H!==k.b.FLIP_TILE&&H!==k.b.FLIP_ROW||(o[1]=[1-P,K,1-f,K,1-f,B,1-P,B]),H!==k.b.FLIP_N_ROTATE_TILE&&H!==k.b.FLIP_N_ROTATE_ROW||(o[1]=[P,1-K,f,1-K,f,1-B,P,1-B]);for(let n=0;n<A;n++)j.push(N+V,n*E-z+J,0),j.push(N+G+V,n*E-z+J,0),j.push(N+G+V,(n+1)*E-z+J,0),j.push(N+V,(n+1)*E-z+J,0),Z.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,b=H===k.b.FLIP_TILE||H===k.b.ROTATE_TILE||H===k.b.FLIP_N_ROTATE_TILE?b.concat(o[(n+1)%2]):H===k.b.FLIP_ROW||H===k.b.ROTATE_ROW||H===k.b.FLIP_N_ROTATE_ROW?b.concat(o[n%2]):b.concat(o[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(c){const o=[];P=0,K=0,f=G/E,B=1,o[0]=[P,K,f,K,f,B,P,B],o[1]=[P,K,f,K,f,B,P,B],H!==k.b.ROTATE_TILE&&H!==k.b.ROTATE_ROW||(o[1]=[1-P,1-K,1-f,1-K,1-f,1-B,1-P,1-B]),H!==k.b.FLIP_TILE&&H!==k.b.FLIP_ROW||(o[1]=[1-P,K,1-f,K,1-f,B,1-P,B]),H!==k.b.FLIP_N_ROTATE_TILE&&H!==k.b.FLIP_N_ROTATE_ROW||(o[1]=[P,1-K,f,1-K,f,1-B,P,1-B]);for(let n=0;n<A;n++)j.push(Q-G+V,n*E-z+J,0),j.push(Q+V,n*E-z+J,0),j.push(Q+V,(n+1)*E-z+J,0),j.push(Q-G+V,(n+1)*E-z+J,0),Z.push(M,M+1,M+3,M+1,M+2,M+3),M+=4,b=H===k.b.FLIP_TILE||H===k.b.ROTATE_TILE||H===k.b.FLIP_N_ROTATE_TILE?b.concat(o[(n+S)%2]):H===k.b.FLIP_ROW||H===k.b.ROTATE_ROW||H===k.b.FLIP_N_ROTATE_ROW?b.concat(o[n%2]):b.concat(o[0]),e.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),m.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const K=0===o.sideOrientation?0:o.sideOrientation||O.c.DEFAULTSIDE;O.c._ComputeSides(K,j,Z,m,b,o.frontUVs,o.backUVs);const f=new O.c;f.indices=Z,f.Zo=j,f.Mo=m,f.fo=b;const B=K===O.c.DOUBLESIDE?e.concat(e):e;return f.Ko=B,f}function x(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new k.b(o,n);H.sideOrientation=k.b._GetDefaultSideOrientation(H.sideOrientation),E._originalBuilderSideOrientation=H.sideOrientation;return l(H).qo(E,H.updatable),E}function z(o){const H=o.faceUV||new Array(6),n=o.faceColors,g=o.pattern||k.b.NO_FLIP,y=o.width||o.size||1,S=o.height||o.size||1,G=o.depth||o.size||1,c=o.tileWidth||o.tileSize||1,x=o.tileHeight||o.tileSize||1,z=o.alignHorizontal||0,V=o.alignVertical||0,J=0===o.sideOrientation?0:o.sideOrientation||O.c.DEFAULTSIDE;for(let k=0;k<6;k++)void 0===H[k]&&(H[k]=new E.Vector4(0,0,1,1)),n&&void 0===n[k]&&(n[k]=new A.d(1,1,1,1));const N=y/2,h=S/2,Q=G/2,p=[];for(let E=0;E<2;E++)p[E]=l({pattern:g,tileWidth:c,tileHeight:x,width:y,height:S,alignVertical:V,alignHorizontal:z,sideOrientation:J});for(let E=2;E<4;E++)p[E]=l({pattern:g,tileWidth:c,tileHeight:x,width:G,height:S,alignVertical:V,alignHorizontal:z,sideOrientation:J});let j=V;V===k.b.BOTTOM?j=k.b.TOP:V===k.b.TOP&&(j=k.b.BOTTOM);for(let E=4;E<6;E++)p[E]=l({pattern:g,tileWidth:c,tileHeight:x,width:y,height:G,alignVertical:j,alignHorizontal:z,sideOrientation:J});let m=[],P=[],b=[],e=[];const Z=[],M=[],K=[],f=[];let B=0,q=0;for(let k=0;k<6;k++){const o=p[k].Zo.length;M[k]=[],K[k]=[];for(let H=0;H<o/3;H++)M[k].push(new E.xH(p[k].Zo[3*H],p[k].Zo[3*H+1],p[k].Zo[3*H+2])),K[k].push(new E.xH(p[k].Mo[3*H],p[k].Mo[3*H+1],p[k].Mo[3*H+2]));B=p[k].fo.length,f[k]=[];for(let n=0;n<B;n+=2)f[k][n]=H[k].x+(H[k].z-H[k].x)*p[k].fo[n],f[k][n+1]=H[k].y+(H[k].w-H[k].y)*p[k].fo[n+1],Y.d&&(f[k][n+1]=1-f[k][n+1]);if(b=b.concat(f[k]),e=e.concat(p[k].indices.map((o=>o+q))),q+=M[k].length,n)for(let H=0;H<4;H++)Z.push(n[k].r,n[k].g,n[k].b,n[k].a)}const D=new E.xH(0,0,Q),T=E.Matrix.RotationY(Math.PI);m=M[0].map((o=>E.xH.TransformNormal(o,T).add(D))).map((o=>[o.x,o.y,o.z])).reduce(((o,H)=>o.concat(H)),[]),P=K[0].map((o=>E.xH.TransformNormal(o,T))).map((o=>[o.x,o.y,o.z])).reduce(((o,H)=>o.concat(H)),[]),m=m.concat(M[1].map((o=>o.zH(D))).map((o=>[o.x,o.y,o.z])).reduce(((o,H)=>o.concat(H)),[])),P=P.concat(K[1].map((o=>[o.x,o.y,o.z])).reduce(((o,H)=>o.concat(H)),[]));const a=new E.xH(N,0,0),F=E.Matrix.RotationY(-Math.PI/2);m=m.concat(M[2].map((o=>E.xH.TransformNormal(o,F).add(a))).map((o=>[o.x,o.y,o.z])).reduce(((o,H)=>o.concat(H)),[])),P=P.concat(K[2].map((o=>E.xH.TransformNormal(o,F))).map((o=>[o.x,o.y,o.z])).reduce(((o,H)=>o.concat(H)),[]));const C=E.Matrix.RotationY(Math.PI/2);m=m.concat(M[3].map((o=>E.xH.TransformNormal(o,C).zH(a))).map((o=>[o.x,o.y,o.z])).reduce(((o,H)=>o.concat(H)),[])),P=P.concat(K[3].map((o=>E.xH.TransformNormal(o,C))).map((o=>[o.x,o.y,o.z])).reduce(((o,H)=>o.concat(H)),[]));const t=new E.xH(0,h,0),X=E.Matrix.RotationX(Math.PI/2);m=m.concat(M[4].map((o=>E.xH.TransformNormal(o,X).add(t))).map((o=>[o.x,o.y,o.z])).reduce(((o,H)=>o.concat(H)),[])),P=P.concat(K[4].map((o=>E.xH.TransformNormal(o,X))).map((o=>[o.x,o.y,o.z])).reduce(((o,H)=>o.concat(H)),[]));const s=E.Matrix.RotationX(-Math.PI/2);m=m.concat(M[5].map((o=>E.xH.TransformNormal(o,s).zH(t))).map((o=>[o.x,o.y,o.z])).reduce(((o,H)=>o.concat(H)),[])),P=P.concat(K[5].map((o=>E.xH.TransformNormal(o,s))).map((o=>[o.x,o.y,o.z])).reduce(((o,H)=>o.concat(H)),[])),O.c._ComputeSides(J,m,e,P,b);const U=new O.c;if(U.indices=e,U.Zo=m,U.Mo=P,U.fo=b,n){const o=J===O.c.DOUBLESIDE?Z.concat(Z):Z;U.Ko=o}return U}function V(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new k.b(o,n);H.sideOrientation=k.b._GetDefaultSideOrientation(H.sideOrientation),E._originalBuilderSideOrientation=H.sideOrientation;return z(H).qo(E,H.updatable),E}O.c.CreateTiledPlane=l;O.c.CreateTiledBox=z;var J=n(12595),N=n(11435),h=n(11392);function Q(o){const H=o.height||2;let n=0===o.diameterTop?0:o.diameterTop||o.diameter||1,g=0===o.diameterBottom?0:o.diameterBottom||o.diameter||1;n=n||1e-5,g=g||1e-5;const y=0|(o.tessellation||24),S=0|(o.subdivisions||1),G=!!o.hasRings,c=!!o.enclose,l=0===o.cap?0:o.cap||k.b.CAP_ALL,x=o.arc&&(o.arc<=0||o.arc>1)?1:o.arc||1,z=0===o.sideOrientation?0:o.sideOrientation||O.c.DEFAULTSIDE,V=o.faceUV||new Array(3),J=o.faceColors,N=2+(1+(1!==x&&c?2:0))*(G?S:1);let Q;for(Q=0;Q<N;Q++)J&&void 0===J[Q]&&(J[Q]=new A.d(1,1,1,1));for(Q=0;Q<N;Q++)V&&void 0===V[Q]&&(V[Q]=new E.Vector4(0,0,1,1));const p=[],j=[],m=[],P=[],b=[],e=2*Math.PI*x/y;let Z,M,K;const f=(g-n)/2/H,B=E.xH.Zero(),q=E.xH.Zero(),D=E.xH.Zero(),T=E.xH.Zero(),a=E.xH.Zero(),F=h.e.Y;let C,t,X,s=1,U=1,I=0,v=0;for(C=0;C<=S;C++)for(M=C/S,K=(M*(n-g)+g)/2,s=G&&0!==C&&C!==S?2:1,X=0;X<s;X++){for(G&&(U+=X),c&&(U+=2*X),t=0;t<=y;t++)Z=t*e,B.x=Math.cos(-Z)*K,B.y=-H/2+M*H,B.z=Math.sin(-Z)*K,0===n&&C===S?(q.x=m[m.length-3*(y+1)],q.y=m[m.length-3*(y+1)+1],q.z=m[m.length-3*(y+1)+2]):(q.x=B.x,q.z=B.z,q.y=Math.sqrt(q.x*q.x+q.z*q.z)*f,q.normalize()),0===t&&(D.S(B),T.S(q)),j.push(B.x,B.y,B.z),m.push(q.x,q.y,q.z),v=G?I!==U?V[U].y:V[U].w:V[U].y+(V[U].w-V[U].y)*M,P.push(V[U].x+(V[U].z-V[U].x)*t/y,Y.d?1-v:v),J&&b.push(J[U].r,J[U].g,J[U].b,J[U].a);1!==x&&c&&(j.push(B.x,B.y,B.z),j.push(0,B.y,0),j.push(0,B.y,0),j.push(D.x,D.y,D.z),E.xH.CrossToRef(F,q,a),a.normalize(),m.push(a.x,a.y,a.z,a.x,a.y,a.z),E.xH.CrossToRef(T,F,a),a.normalize(),m.push(a.x,a.y,a.z,a.x,a.y,a.z),v=G?I!==U?V[U+1].y:V[U+1].w:V[U+1].y+(V[U+1].w-V[U+1].y)*M,P.push(V[U+1].x,Y.d?1-v:v),P.push(V[U+1].z,Y.d?1-v:v),v=G?I!==U?V[U+2].y:V[U+2].w:V[U+2].y+(V[U+2].w-V[U+2].y)*M,P.push(V[U+2].x,Y.d?1-v:v),P.push(V[U+2].z,Y.d?1-v:v),J&&(b.push(J[U+1].r,J[U+1].g,J[U+1].b,J[U+1].a),b.push(J[U+1].r,J[U+1].g,J[U+1].b,J[U+1].a),b.push(J[U+2].r,J[U+2].g,J[U+2].b,J[U+2].a),b.push(J[U+2].r,J[U+2].g,J[U+2].b,J[U+2].a))),I!==U&&(I=U)}const w=1!==x&&c?y+4:y;for(C=0,U=0;U<S;U++){let o=0,H=0,n=0,E=0;for(t=0;t<y;t++)o=C*(w+1)+t,H=(C+1)*(w+1)+t,n=C*(w+1)+(t+1),E=(C+1)*(w+1)+(t+1),p.push(o,H,n),p.push(E,n,H);1!==x&&c&&(p.push(o+2,H+2,n+2),p.push(E+2,n+2,H+2),p.push(o+4,H+4,n+4),p.push(E+4,n+4,H+4)),C=G?C+2:C+1}const r=o=>{const k=o?n/2:g/2;if(0===k)return;let O,S,G;const c=o?V[N-1]:V[0];let A=null;J&&(A=o?J[N-1]:J[0]);const l=j.length/3,z=o?H/2:-H/2,h=new E.xH(0,z,0);j.push(h.x,h.y,h.z),m.push(0,o?1:-1,0);const Q=c.y+.5*(c.w-c.y);P.push(c.x+.5*(c.z-c.x),Y.d?1-Q:Q),A&&b.push(A.r,A.g,A.b,A.a);const e=new E.Vector2(.5,.5);for(G=0;G<=y;G++){O=2*Math.PI*G*x/y;const H=Math.cos(-O),n=Math.sin(-O);S=new E.xH(H*k,z,n*k);const g=new E.Vector2(H*e.x+.5,n*e.y+.5);j.push(S.x,S.y,S.z),m.push(0,o?1:-1,0);const l=c.y+(c.w-c.y)*g.y;P.push(c.x+(c.z-c.x)*g.x,Y.d?1-l:l),A&&b.push(A.r,A.g,A.b,A.a)}for(G=0;G<y;G++)o?(p.push(l),p.push(l+(G+2)),p.push(l+(G+1))):(p.push(l),p.push(l+(G+1)),p.push(l+(G+2)))};l!==k.b.CAP_START&&l!==k.b.CAP_ALL||r(!1),l!==k.b.CAP_END&&l!==k.b.CAP_ALL||r(!0),O.c._ComputeSides(z,j,p,m,P,o.frontUVs,o.backUVs);const u=new O.c;return u.indices=p,u.Zo=j,u.Mo=m,u.fo=P,J&&(u.Ko=b),u}function p(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const E=new k.b(o,n);H.sideOrientation=k.b._GetDefaultSideOrientation(H.sideOrientation),E._originalBuilderSideOrientation=H.sideOrientation;return Q(H).qo(E,H.updatable),E}function j(o){const H=[],n=[],k=[],g=[],y=o.diameter||1,S=o.thickness||.5,G=0|(o.tessellation||16),c=0===o.sideOrientation?0:o.sideOrientation||O.c.DEFAULTSIDE,A=G+1;for(let O=0;O<=G;O++){const o=O/G,c=O*Math.PI*2/G-Math.PI/2,l=E.Matrix.Translation(y/2,0,0).multiply(E.Matrix.RotationY(c));for(let y=0;y<=G;y++){const c=1-y/G,x=y*Math.PI*2/G+Math.PI,z=Math.cos(x),V=Math.sin(x);let J=new E.xH(z,V,0),N=J.scale(S/2);const h=new E.Vector2(o,c);N=E.xH.TransformCoordinates(N,l),J=E.xH.TransformNormal(J,l),n.push(N.x,N.y,N.z),k.push(J.x,J.y,J.z),g.push(h.x,Y.d?1-h.y:h.y);const Q=(O+1)%A,p=(y+1)%A;H.push(O*A+y),H.push(O*A+p),H.push(Q*A+y),H.push(O*A+p),H.push(Q*A+p),H.push(Q*A+y)}}O.c._ComputeSides(c,n,H,k,g,o.frontUVs,o.backUVs);const l=new O.c;return l.indices=H,l.Zo=n,l.Mo=k,l.fo=g,l}function m(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const E=new k.b(o,n);H.sideOrientation=k.b._GetDefaultSideOrientation(H.sideOrientation),E._originalBuilderSideOrientation=H.sideOrientation;return j(H).qo(E,H.updatable),E}O.c.CreateCylinder=Q,k.b.CreateCylinder=(o,H,n,E,g,O,Y,y,S)=>{void 0!==Y&&Y instanceof N.c||(void 0!==Y&&(S=y||k.b.DEFAULTSIDE,y=Y),Y=O,O=1);return p(o,{height:H,diameterTop:n,diameterBottom:E,tessellation:g,subdivisions:O,sideOrientation:S,updatable:y},Y)};function P(o){const H=[],n=[],k=[],g=[],y=o.radius||2,S=o.tube||.5,G=o.radialSegments||32,c=o.tubularSegments||32,A=o.p||2,l=o.q||3,x=0===o.sideOrientation?0:o.sideOrientation||O.c.DEFAULTSIDE,z=o=>{const H=Math.cos(o),n=Math.sin(o),k=l/A*o,g=Math.cos(k),O=y*(2+g)*.5*H,Y=y*(2+g)*n*.5,S=y*Math.sin(k)*.5;return new E.xH(O,Y,S)};let V,J;for(V=0;V<=G;V++){const o=V%G/G*2*A*Math.PI,H=z(o),k=z(o+.01),O=k.zH(H);let y=k.add(H);const l=E.xH.Cross(O,y);for(y=E.xH.Cross(l,O),l.normalize(),y.normalize(),J=0;J<c;J++){const o=J%c/c*2*Math.PI,E=-S*Math.cos(o),k=S*Math.sin(o);n.push(H.x+E*y.x+k*l.x),n.push(H.y+E*y.y+k*l.y),n.push(H.z+E*y.z+k*l.z),g.push(V/G),g.push(Y.d?1-J/c:J/c)}}for(V=0;V<G;V++)for(J=0;J<c;J++){const o=(J+1)%c,n=V*c+J,E=(V+1)*c+J,k=(V+1)*c+o,g=V*c+o;H.push(g),H.push(E),H.push(n),H.push(g),H.push(k),H.push(E)}O.c.ComputeNormals(n,H,k),O.c._ComputeSides(x,n,H,k,g,o.frontUVs,o.backUVs);const N=new O.c;return N.indices=H,N.Zo=n,N.Mo=k,N.fo=g,N}function b(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const E=new k.b(o,n);H.sideOrientation=k.b._GetDefaultSideOrientation(H.sideOrientation),E._originalBuilderSideOrientation=H.sideOrientation;return P(H).qo(E,H.updatable),E}O.c.CreateTorus=j,k.b.CreateTorus=(o,H,n,E,k,g,O)=>m(o,{diameter:H,thickness:n,tessellation:E,sideOrientation:O,updatable:g},k);O.c.CreateTorusKnot=P,k.b.CreateTorusKnot=(o,H,n,E,k,g,O,Y,y,S)=>b(o,{radius:H,tube:n,radialSegments:E,tubularSegments:k,p:g,q:O,sideOrientation:S,updatable:y},Y);var e=n(13114),Z=n(11751),M=n(11410);function K(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=H.path,g=H.shape,O=H.scale||1,Y=H.rotation||0,y=0===H.cap?0:H.cap||k.b.NO_CAP,S=H.updatable,G=k.b._GetDefaultSideOrientation(H.sideOrientation),c=H.instance||null,A=H.invertUV||!1,l=H.closeShape||!1,x=H.closePath||!1,z=H.capFunction||null;return B(o,g,E,O,Y,null,null,x,l,y,!1,n,!!S,G,c,A,H.frontUVs||null,H.backUVs||null,H.firstNormal||null,!!H.adjustFrame,z)}function f(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=H.path,g=H.shape,O=H.scaleFunction||(()=>1),Y=H.rotationFunction||(()=>0),y=H.closePath||H.ribbonCloseArray||!1,S=H.closeShape||H.ribbonClosePath||!1,G=0===H.cap?0:H.cap||k.b.NO_CAP,c=H.updatable,A=H.firstNormal||null,l=H.adjustFrame||!1,x=k.b._GetDefaultSideOrientation(H.sideOrientation),z=H.instance,V=H.invertUV||!1,J=H.capFunction||null;return B(o,g,E,null,null,O,Y,y,S,G,!0,n,!!c,x,z||null,V,H.frontUVs||null,H.backUVs||null,A,l,J||null)}function B(o,H,n,g,O,Y,y,G,c,A,l,x,z,V,J,N,h,Q,p,j,m){const P=(o,H,n,g,O,Y,y,S,G,c,A)=>{const l=n.getTangents(),x=n.getNormals(),z=n.getBinormals(),V=n.getDistances();if(A)for(let k=0;k<l.length;k++)if(0==l[k].x&&0==l[k].y&&0==l[k].z&&l[k].S(l[k-1]),0==x[k].x&&0==x[k].y&&0==x[k].z&&x[k].S(x[k-1]),0==z[k].x&&0==z[k].y&&0==z[k].z&&z[k].S(z[k-1]),k>0){let o=l[k-1];E.xH.Dot(o,l[k])<0&&l[k].scaleInPlace(-1),o=x[k-1],E.xH.Dot(o,x[k])<0&&x[k].scaleInPlace(-1),o=z[k-1],E.xH.Dot(o,z[k])<0&&z[k].scaleInPlace(-1)}let J=0;const N=c&&S?S:()=>null!==Y?Y:0,h=c&&y?y:()=>null!==O?O:1;let Q=G===k.b.NO_CAP||G===k.b.CAP_END?0:2;const p=E.TmpVectors.Matrix[0];for(let k=0;k<H.length;k++){const n=[],O=N(k,V[k]),Y=h(k,V[k]);E.Matrix.RotationAxisToRef(l[k],J,p);for(let g=0;g<o.length;g++){const O=l[k].scale(o[g].z).add(x[k].scale(o[g].x)).add(z[k].scale(o[g].y)),y=E.xH.Zero();E.xH.TransformCoordinatesToRef(O,p,y),y.scaleInPlace(Y).addInPlace(H[k]),n[g]=y}g[Q]=n,J+=O,Q++}const j=m||(o=>{const H=Array(),n=E.xH.Zero();let k;for(k=0;k<o.length;k++)n.addInPlace(o[k]);for(n.scaleInPlace(1/o.length),k=0;k<o.length;k++)H.push(n);return H});switch(G){case k.b.NO_CAP:break;case k.b.CAP_START:g[0]=j(g[2]),g[1]=g[2];break;case k.b.CAP_END:g[Q]=g[Q-1],g[Q+1]=j(g[Q-1]);break;case k.b.CAP_ALL:g[0]=j(g[2]),g[1]=g[2],g[Q]=g[Q-1],g[Q+1]=j(g[Q-1])}return g};let b,e;if(J){const o=J._creationDataStorage;return b=p?o.path3D.update(n,p):o.path3D.update(n),e=P(H,n,o.path3D,o.pathArray,g,O,Y,y,o.cap,l,j),J=S("",{pathArray:e,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:J},x||void 0)}b=p?new M.l(n,p):new M.l(n);e=P(H,n,b,new Array,g,O,Y,y,A=A<0||A>3?0:A,l,j);const Z=S(o,{pathArray:e,closeArray:G,closePath:c,updatable:z,sideOrientation:V,invertUV:N,frontUVs:h||void 0,backUVs:Q||void 0},x);return Z._creationDataStorage.pathArray=e,Z._creationDataStorage.path3D=b,Z._creationDataStorage.cap=A,Z}function q(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=H.arc?H.arc<=0||H.arc>1?1:H.arc:1,O=void 0===H.closed||H.closed,Y=H.shape,y=H.radius||1,G=H.tessellation||64,c=H.clip||0,A=H.updatable,l=k.b._GetDefaultSideOrientation(H.sideOrientation),x=H.cap||k.b.NO_CAP,z=2*Math.PI,V=[],J=H.invertUV||!1;let N=0,h=0;const Q=z/G*g;let p,j;for(N=0;N<=G-c;N++){for(j=[],x!=k.b.CAP_START&&x!=k.b.CAP_ALL||(j.push(new E.xH(0,Y[0].y,0)),j.push(new E.xH(Math.cos(N*Q)*Y[0].x*y,Y[0].y,Math.sin(N*Q)*Y[0].x*y))),h=0;h<Y.length;h++)p=new E.xH(Math.cos(N*Q)*Y[h].x*y,Y[h].y,Math.sin(N*Q)*Y[h].x*y),j.push(p);x!=k.b.CAP_END&&x!=k.b.CAP_ALL||(j.push(new E.xH(Math.cos(N*Q)*Y[Y.length-1].x*y,Y[Y.length-1].y,Math.sin(N*Q)*Y[Y.length-1].x*y)),j.push(new E.xH(0,Y[Y.length-1].y,0))),V.push(j)}return S(o,{pathArray:V,closeArray:O,sideOrientation:l,updatable:A,invertUV:J,frontUVs:H.frontUVs,backUVs:H.backUVs},n)}k.b.ExtrudeShape=function(o,H,n,E,g,O){let Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7?arguments[7]:void 0,S=arguments.length>8?arguments[8]:void 0,G=arguments.length>9?arguments[9]:void 0;return K(o,{shape:H,path:n,scale:E,rotation:g,cap:0===O?0:O||k.b.NO_CAP,sideOrientation:S,instance:G,updatable:y},Y)},k.b.ExtrudeShapeCustom=(o,H,n,E,g,O,Y,y,S,G,c,A)=>f(o,{shape:H,path:n,scaleFunction:E,rotationFunction:g,ribbonCloseArray:O,ribbonClosePath:Y,cap:0===y?0:y||k.b.NO_CAP,sideOrientation:c,instance:A,updatable:G},S);k.b.CreateLathe=(o,H,n,E,k,g,O)=>q(o,{shape:H,radius:n,tessellation:E,sideOrientation:O,updatable:g},k);var D=n(12504),T=n(12444);function a(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=H.path;let O=H.instance,Y=1;void 0!==H.radius?Y=H.radius:O&&(Y=O._creationDataStorage.radius);const y=H.tessellation||64,G=H.radiusFunction||null;let c=H.cap||k.b.NO_CAP;const A=H.invertUV||!1,l=H.updatable,x=k.b._GetDefaultSideOrientation(H.sideOrientation);H.arc=H.arc&&(H.arc<=0||H.arc>1)?1:H.arc||1;const z=(o,H,n,g,O,Y,y,S)=>{const G=H.getTangents(),c=H.getNormals(),A=H.getDistances(),l=2*Math.PI/O*S,x=Y||(()=>g);let z,V,J,N;const h=E.TmpVectors.Matrix[0];let Q=y===k.b.NO_CAP||y===k.b.CAP_END?0:2;for(let k=0;k<o.length;k++){V=x(k,A[k]),z=Array(),J=c[k];for(let H=0;H<O;H++)E.Matrix.RotationAxisToRef(G[k],l*H,h),N=z[H]?z[H]:E.xH.Zero(),E.xH.TransformCoordinatesToRef(J,h,N),N.scaleInPlace(V).addInPlace(o[k]),z[H]=N;n[Q]=z,Q++}const p=(H,n)=>{const E=Array();for(let k=0;k<H;k++)E.push(o[n]);return E};switch(y){case k.b.NO_CAP:break;case k.b.CAP_START:n[0]=p(O,0),n[1]=n[2].slice(0);break;case k.b.CAP_END:n[Q]=n[Q-1].slice(0),n[Q+1]=p(O,o.length-1);break;case k.b.CAP_ALL:n[0]=p(O,0),n[1]=n[2].slice(0),n[Q]=n[Q-1].slice(0),n[Q+1]=p(O,o.length-1)}return n};let V,J;if(O){const o=O._creationDataStorage,n=H.arc||o.arc;return V=o.path3D.update(g),J=z(g,V,o.pathArray,Y,o.tessellation,G,o.cap,n),O=S("",{pathArray:J,instance:O}),o.path3D=V,o.pathArray=J,o.arc=n,o.radius=Y,O}V=new M.l(g);c=c<0||c>3?0:c,J=z(g,V,new Array,Y,y,G,c,H.arc);const N=S(o,{pathArray:J,closePath:!0,closeArray:!1,updatable:l,sideOrientation:x,invertUV:A,frontUVs:H.frontUVs,backUVs:H.backUVs},n);return N._creationDataStorage.pathArray=J,N._creationDataStorage.path3D=V,N._creationDataStorage.tessellation=y,N._creationDataStorage.cap=c,N._creationDataStorage.arc=H.arc,N._creationDataStorage.radius=Y,N}function F(o){const H=[];H[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},H[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},H[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},H[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},H[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},H[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},H[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},H[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},H[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},H[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},H[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},H[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},H[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},H[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},H[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const n=o.type&&(o.type<0||o.type>=H.length)?0:o.type||0,k=o.size,g=o.sizeX||k||1,y=o.sizeY||k||1,S=o.sizeZ||k||1,G=o.custom||H[n],c=G.face.length,l=o.faceUV||new Array(c),x=o.faceColors,z=void 0===o.flat||o.flat,V=0===o.sideOrientation?0:o.sideOrientation||O.c.DEFAULTSIDE,J=[],N=[],h=[],Q=[],p=[];let j=0,m=0;const P=[];let b,e,Z,M,K,f,B=0,q=0;if(z)for(q=0;q<c;q++)x&&void 0===x[q]&&(x[q]=new A.d(1,1,1,1)),l&&void 0===l[q]&&(l[q]=new E.Vector4(0,0,1,1));if(z)for(q=0;q<c;q++){const o=G.face[q].length;for(Z=2*Math.PI/o,M=.5*Math.tan(Z/2),K=.5,B=0;B<o;B++)J.push(G.vertex[G.face[q][B]][0]*g,G.vertex[G.face[q][B]][1]*y,G.vertex[G.face[q][B]][2]*S),P.push(j),j++,b=l[q].x+(l[q].z-l[q].x)*(.5+M),e=l[q].y+(l[q].w-l[q].y)*(K-.5),Q.push(b,Y.d?1-e:e),f=M*Math.cos(Z)-K*Math.sin(Z),K=M*Math.sin(Z)+K*Math.cos(Z),M=f,x&&p.push(x[q].r,x[q].g,x[q].b,x[q].a);for(B=0;B<o-2;B++)N.push(P[0+m],P[B+2+m],P[B+1+m]);m+=o}else{for(B=0;B<G.vertex.length;B++)J.push(G.vertex[B][0]*g,G.vertex[B][1]*y,G.vertex[B][2]*S),Q.push(0,Y.d?1:0);for(q=0;q<c;q++)for(B=0;B<G.face[q].length-2;B++)N.push(G.face[q][0],G.face[q][B+2],G.face[q][B+1])}O.c.ComputeNormals(J,N,h),O.c._ComputeSides(V,J,N,h,Q,o.frontUVs,o.backUVs);const D=new O.c;return D.Zo=J,D.indices=N,D.Mo=h,D.fo=Q,x&&z&&(D.Ko=p),D}function C(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new k.b(o,n);H.sideOrientation=k.b._GetDefaultSideOrientation(H.sideOrientation),E._originalBuilderSideOrientation=H.sideOrientation;return F(H).qo(E,H.updatable),E}k.b.CreateTube=(o,H,n,E,k,g,O,Y,y,S)=>a(o,{path:H,radius:n,tessellation:E,radiusFunction:k,arc:1,cap:g,updatable:Y,sideOrientation:y,instance:S},O);function t(o){const H=o.sideOrientation||O.c.DEFAULTSIDE,n=o.radius||1,k=void 0===o.flat||o.flat,g=0|(o.subdivisions||4),y=o.radiusX||n,S=o.radiusY||n,G=o.radiusZ||n,c=(1+Math.sqrt(5))/2,A=[-1,c,-0,1,c,0,-1,-c,0,1,-c,0,0,-1,-c,0,1,-c,0,-1,c,0,1,c,c,0,1,c,0,-1,-c,0,1,-c,0,-1],l=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],x=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],z=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],V=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],J=[],N=[],h=[],Q=[];let p=0;const j=new Array(3),m=new Array(3);let P;for(P=0;P<3;P++)j[P]=E.xH.Zero(),m[P]=E.Vector2.Zero();for(let O=0;O<20;O++){for(P=0;P<3;P++){const o=l[3*O+P];j[P].Wg(A[3*x[o]],A[3*x[o]+1],A[3*x[o]+2]),j[P].normalize(),m[P].Wg(.134765625*z[2*o]+.05859375+-.0390625*V[O],.2333984375*z[2*o+1]+.025390625+.01953125*V[O])}const o=(o,H,n,O)=>{const c=E.xH.Lerp(j[0],j[2],H/g),A=E.xH.Lerp(j[1],j[2],H/g),l=g===H?j[2]:E.xH.Lerp(c,A,o/(g-H));let x;if(l.normalize(),k){const o=E.xH.Lerp(j[0],j[2],O/g),H=E.xH.Lerp(j[1],j[2],O/g);x=E.xH.Lerp(o,H,n/(g-O))}else x=new E.xH(l.x,l.y,l.z);x.x/=y,x.y/=S,x.z/=G,x.normalize();const z=E.Vector2.Lerp(m[0],m[2],H/g),V=E.Vector2.Lerp(m[1],m[2],H/g),P=g===H?m[2]:E.Vector2.Lerp(z,V,o/(g-H));N.push(l.x*y,l.y*S,l.z*G),h.push(x.x,x.y,x.z),Q.push(P.x,Y.d?1-P.y:P.y),J.push(p),p++};for(let H=0;H<g;H++)for(let n=0;n+H<g;n++)o(n,H,n+1/3,H+1/3),o(n+1,H,n+1/3,H+1/3),o(n,H+1,n+1/3,H+1/3),n+H+1<g&&(o(n+1,H,n+2/3,H+2/3),o(n+1,H+1,n+2/3,H+2/3),o(n,H+1,n+2/3,H+2/3))}O.c._ComputeSides(H,N,J,h,Q,o.frontUVs,o.backUVs);const b=new O.c;return b.indices=J,b.Zo=N,b.Mo=h,b.fo=Q,b}function X(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new k.b(o,n);H.sideOrientation=k.b._GetDefaultSideOrientation(H.sideOrientation),E._originalBuilderSideOrientation=H.sideOrientation;return t(H).qo(E,H.updatable),E}O.c.CreatePolyhedron=F,k.b.CreatePolyhedron=(o,H,n)=>C(o,H,n);O.c.CreateIcoSphere=t,k.b.CreateIcoSphere=(o,H,n)=>X(o,H,n);var s=n(11205);const U=new E.xH(1,0,0),I=new E.xH(-1,0,0),v=new E.xH(0,1,0),w=new E.xH(0,-1,0),r=new E.xH(0,0,1),u=new E.xH(0,0,-1);class d{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E.xH.Zero(),H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E.xH.Up(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:E.Vector2.Zero(),k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=o,this.normal=H,this.uv=n,this.vertexIdx=k,this.vertexIdxForBones=g,this.localPositionOverride=O,this.localNormalOverride=Y,this.matrixIndicesOverride=y,this.matrixWeightsOverride=S}clone(){var o,H,n,E;return new d(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(o=this.localPositionOverride)||void 0===o?void 0:o.slice(),null===(H=this.localNormalOverride)||void 0===H?void 0:H.slice(),null===(n=this.matrixIndicesOverride)||void 0===n?void 0:n.slice(),null===(E=this.matrixWeightsOverride)||void 0===E?void 0:E.slice())}}function R(o,H,n){var y,S,G,c,A;const l=!!H.skeleton,x=!(null===(y=H.morphTargetManager)||void 0===y||!y.numTargets),z=n.localMode||l,V=H.dg(),J=l||x?H.MY(!0,!0):H.getVerticesData(g.d.PositionKind),N=l||x?H.getNormalsData(!0,!0):H.getVerticesData(g.d.NormalKind),h=z?l?H.getVerticesData(g.d.PositionKind):J:null,Q=z?l?H.getVerticesData(g.d.NormalKind):N:null,p=H.getVerticesData(g.d.UVKind),j=l?H.getVerticesData(g.d.MatricesIndicesKind):null,m=l?H.getVerticesData(g.d.MatricesWeightsKind):null,P=l?H.getVerticesData(g.d.MatricesIndicesExtraKind):null,b=l?H.getVerticesData(g.d.MatricesWeightsExtraKind):null,e=n.position||E.xH.Zero();let Z=n.normal||E.xH.Up();const M=n.size||E.xH.One(),K=n.angle||0;if(!Z){const o=new E.xH(0,0,1),n=H.bo().activeCamera,k=E.xH.TransformCoordinates(o,n.getWorldMatrix());Z=n.globalPosition.zH(k)}const f=-Math.atan2(Z.z,Z.x)-Math.PI/2,B=Math.sqrt(Z.x*Z.x+Z.z*Z.z),q=Math.atan2(Z.y,B),D=new O.c;D.indices=[],D.Zo=[],D.Mo=[],D.fo=[],D.matricesIndices=l?[]:null,D.matricesWeights=l?[]:null,D.matricesIndicesExtra=P?[]:null,D.matricesWeightsExtra=b?[]:null;let T=0;const a=(o,H)=>{const k=new d;if(!V||!J||!N)return k;const g=V[o];if(k.vertexIdx=3*g,k.vertexIdxForBones=4*g,k.position=new E.xH(J[3*g],J[3*g+1],J[3*g+2]),E.xH.TransformCoordinatesToRef(k.position,H,k.position),k.normal=new E.xH(N[3*g],N[3*g+1],N[3*g+2]),E.xH.TransformNormalToRef(k.normal,H,k.normal),n.captureUVS&&p){const o=p[2*g+1];k.uv=new E.Vector2(p[2*g],Y.d?1-o:o)}return k},F=[0,0,0,0],C=(o,H)=>{if(0===o.length)return o;const n=.5*Math.abs(E.xH.Dot(M,H)),k=(o,H,n,E)=>{for(let k=0;k<E;++k)if(o[n+k]===H)return n+k;return-1},g=(o,g)=>{const O=E.xH.GetClipFactor(o.position,g.position,H,n);let Y=F,y=F;if(j&&m){const H=o.matrixIndicesOverride?0:o.vertexIdxForBones,n=o.matrixIndicesOverride??j,E=o.matrixWeightsOverride??m,S=g.matrixIndicesOverride?0:g.vertexIdxForBones,G=g.matrixIndicesOverride??j,c=g.matrixWeightsOverride??m;Y=[0,0,0,0],y=[0,0,0,0];let A=0;for(let o=0;o<4;++o)if(E[H+o]>0){const g=k(G,n[H+o],S,4);Y[A]=n[H+o],y[A]=(0,s.Lerp)(E[H+o],g>=0?c[g]:0,O),A++}for(let o=0;o<4&&A<4;++o){const E=G[S+o];-1===k(n,E,H,4)&&(Y[A]=E,y[A]=(0,s.Lerp)(0,c[S+o],O),A++)}const l=y[0]+y[1]+y[2]+y[3];y[0]/=l,y[1]/=l,y[2]/=l,y[3]/=l}const S=o.localPositionOverride?o.localPositionOverride[0]:(null===h||void 0===h?void 0:h[o.vertexIdx])??0,G=o.localPositionOverride?o.localPositionOverride[1]:(null===h||void 0===h?void 0:h[o.vertexIdx+1])??0,c=o.localPositionOverride?o.localPositionOverride[2]:(null===h||void 0===h?void 0:h[o.vertexIdx+2])??0,A=g.localPositionOverride?g.localPositionOverride[0]:(null===h||void 0===h?void 0:h[g.vertexIdx])??0,l=g.localPositionOverride?g.localPositionOverride[1]:(null===h||void 0===h?void 0:h[g.vertexIdx+1])??0,x=g.localPositionOverride?g.localPositionOverride[2]:(null===h||void 0===h?void 0:h[g.vertexIdx+2])??0,z=o.localNormalOverride?o.localNormalOverride[0]:(null===Q||void 0===Q?void 0:Q[o.vertexIdx])??0,V=o.localNormalOverride?o.localNormalOverride[1]:(null===Q||void 0===Q?void 0:Q[o.vertexIdx+1])??0,J=o.localNormalOverride?o.localNormalOverride[2]:(null===Q||void 0===Q?void 0:Q[o.vertexIdx+2])??0,N=z+((g.localNormalOverride?g.localNormalOverride[0]:(null===Q||void 0===Q?void 0:Q[g.vertexIdx])??0)-z)*O,p=V+((g.localNormalOverride?g.localNormalOverride[1]:(null===Q||void 0===Q?void 0:Q[g.vertexIdx+1])??0)-V)*O,P=J+((g.localNormalOverride?g.localNormalOverride[2]:(null===Q||void 0===Q?void 0:Q[g.vertexIdx+2])??0)-J)*O,b=Math.sqrt(N*N+p*p+P*P);return new d(E.xH.Lerp(o.position,g.position,O),E.xH.Lerp(o.normal,g.normal,O).normalize(),E.Vector2.Lerp(o.uv,g.uv,O),-1,-1,h?[S+(A-S)*O,G+(l-G)*O,c+(x-c)*O]:null,Q?[N/b,p/b,P/b]:null,Y,y)};let O=null;o.length>3&&(O=[]);for(let Y=0;Y<o.length;Y+=3){let k=0,y=null,S=null,G=null,c=null;const A=E.xH.Dot(o[Y].position,H)-n>0,l=E.xH.Dot(o[Y+1].position,H)-n>0,x=E.xH.Dot(o[Y+2].position,H)-n>0;switch(k=(A?1:0)+(l?1:0)+(x?1:0),k){case 0:o.length>3?(O.push(o[Y]),O.push(o[Y+1]),O.push(o[Y+2])):O=o;break;case 1:if(O=O??new Array,A&&(y=o[Y+1],S=o[Y+2],G=g(o[Y],y),c=g(o[Y],S)),l){y=o[Y],S=o[Y+2],G=g(o[Y+1],y),c=g(o[Y+1],S),O.push(G),O.push(S.clone()),O.push(y.clone()),O.push(S.clone()),O.push(G.clone()),O.push(c);break}x&&(y=o[Y],S=o[Y+1],G=g(o[Y+2],y),c=g(o[Y+2],S)),y&&S&&G&&c&&(O.push(y.clone()),O.push(S.clone()),O.push(G),O.push(c),O.push(G.clone()),O.push(S.clone()));break;case 2:O=O??new Array,A||(y=o[Y].clone(),S=g(y,o[Y+1]),G=g(y,o[Y+2]),O.push(y),O.push(S),O.push(G)),l||(y=o[Y+1].clone(),S=g(y,o[Y+2]),G=g(y,o[Y]),O.push(y),O.push(S),O.push(G)),x||(y=o[Y+2].clone(),S=g(y,o[Y]),G=g(y,o[Y+1]),O.push(y),O.push(S),O.push(G))}}return O},t=H instanceof k.b?H:null,X=null===t||void 0===t?void 0:t._thinInstanceDataStorage.matrixData,R=(null===t||void 0===t?void 0:t.xY)||1,W=E.TmpVectors.Matrix[0];W.S(E.Matrix.IdentityReadOnly);for(let k=0;k<R;++k){if(null!==t&&void 0!==t&&t.hasThinInstances&&X){const o=16*k;W.setRowFromFloats(0,X[o+0],X[o+1],X[o+2],X[o+3]),W.setRowFromFloats(1,X[o+4],X[o+5],X[o+6],X[o+7]),W.setRowFromFloats(2,X[o+8],X[o+9],X[o+10],X[o+11]),W.setRowFromFloats(3,X[o+12],X[o+13],X[o+14],X[o+15])}const o=E.Matrix.RotationYawPitchRoll(f,q,K).multiply(E.Matrix.Translation(e.x,e.y,e.z)),g=E.Matrix.Invert(o),O=H.getWorldMatrix(),y=W.multiply(O).multiply(g),S=new Array(3);for(let H=0;H<V.length;H+=3){let o=S;if(o[0]=a(H,y),o[1]=a(H+1,y),o[2]=a(H+2,y),!(n.cullBackFaces&&-o[0].normal.z<=0&&-o[1].normal.z<=0&&-o[2].normal.z<=0)&&(o=C(o,U),o&&(o=C(o,I),o&&(o=C(o,v),o&&(o=C(o,w),o&&(o=C(o,r),o&&(o=C(o,u),o)))))))for(let H=0;H<o.length;H++){const E=o[H];if(D.indices.push(T),z?(E.localPositionOverride?(D.Zo[3*T]=E.localPositionOverride[0],D.Zo[3*T+1]=E.localPositionOverride[1],D.Zo[3*T+2]=E.localPositionOverride[2]):h&&(D.Zo[3*T]=h[E.vertexIdx],D.Zo[3*T+1]=h[E.vertexIdx+1],D.Zo[3*T+2]=h[E.vertexIdx+2]),E.localNormalOverride?(D.Mo[3*T]=E.localNormalOverride[0],D.Mo[3*T+1]=E.localNormalOverride[1],D.Mo[3*T+2]=E.localNormalOverride[2]):Q&&(D.Mo[3*T]=Q[E.vertexIdx],D.Mo[3*T+1]=Q[E.vertexIdx+1],D.Mo[3*T+2]=Q[E.vertexIdx+2])):(E.position.toArray(D.Zo,3*T),E.normal.toArray(D.Mo,3*T)),D.matricesIndices&&D.matricesWeights&&(E.matrixIndicesOverride?(D.matricesIndices[4*T]=E.matrixIndicesOverride[0],D.matricesIndices[4*T+1]=E.matrixIndicesOverride[1],D.matricesIndices[4*T+2]=E.matrixIndicesOverride[2],D.matricesIndices[4*T+3]=E.matrixIndicesOverride[3]):(j&&(D.matricesIndices[4*T]=j[E.vertexIdxForBones],D.matricesIndices[4*T+1]=j[E.vertexIdxForBones+1],D.matricesIndices[4*T+2]=j[E.vertexIdxForBones+2],D.matricesIndices[4*T+3]=j[E.vertexIdxForBones+3]),P&&D.matricesIndicesExtra&&(D.matricesIndicesExtra[4*T]=P[E.vertexIdxForBones],D.matricesIndicesExtra[4*T+1]=P[E.vertexIdxForBones+1],D.matricesIndicesExtra[4*T+2]=P[E.vertexIdxForBones+2],D.matricesIndicesExtra[4*T+3]=P[E.vertexIdxForBones+3])),E.matrixWeightsOverride?(D.matricesWeights[4*T]=E.matrixWeightsOverride[0],D.matricesWeights[4*T+1]=E.matrixWeightsOverride[1],D.matricesWeights[4*T+2]=E.matrixWeightsOverride[2],D.matricesWeights[4*T+3]=E.matrixWeightsOverride[3]):(m&&(D.matricesWeights[4*T]=m[E.vertexIdxForBones],D.matricesWeights[4*T+1]=m[E.vertexIdxForBones+1],D.matricesWeights[4*T+2]=m[E.vertexIdxForBones+2],D.matricesWeights[4*T+3]=m[E.vertexIdxForBones+3]),b&&D.matricesWeightsExtra&&(D.matricesWeightsExtra[4*T]=b[E.vertexIdxForBones],D.matricesWeightsExtra[4*T+1]=b[E.vertexIdxForBones+1],D.matricesWeightsExtra[4*T+2]=b[E.vertexIdxForBones+2],D.matricesWeightsExtra[4*T+3]=b[E.vertexIdxForBones+3]))),n.captureUVS)E.uv.toArray(D.fo,2*T);else{D.fo.push(.5+E.position.x/M.x);const o=.5+E.position.y/M.y;D.fo.push(Y.d?1-o:o)}T++}}}0===D.indices.length&&(D.indices=null),0===D.Zo.length&&(D.Zo=null),0===D.Mo.length&&(D.Mo=null),0===D.fo.length&&(D.fo=null),0===(null===(S=D.matricesIndices)||void 0===S?void 0:S.length)&&(D.matricesIndices=null),0===(null===(G=D.matricesWeights)||void 0===G?void 0:G.length)&&(D.matricesWeights=null),0===(null===(c=D.matricesIndicesExtra)||void 0===c?void 0:c.length)&&(D.matricesIndicesExtra=null),0===(null===(A=D.matricesWeightsExtra)||void 0===A?void 0:A.length)&&(D.matricesWeightsExtra=null);const i=new k.b(o,H.bo());return D.qo(i),z?(i.skeleton=H.skeleton,i.parent=H):(i.position=e.clone(),i.rotation=new E.xH(q,f,K)),i.Ig(!0),i.refreshBoundingInfo(!0,!0),i}function W(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const H=0|Math.max(o.subdivisions?o.subdivisions:2,1),n=0|Math.max(o.tessellation?o.tessellation:16,3),k=Math.max(o.height?o.height:1,0),g=Math.max(o.radius?o.radius:.25,0),y=0|Math.max(o.capSubdivisions?o.capSubdivisions:6,1),S=n,G=H,c=Math.max(o.radiusTop?o.radiusTop:g,0),A=Math.max(o.radiusBottom?o.radiusBottom:g,0),l=k-(c+A),x=2*Math.PI,z=Math.max(o.topCapSubdivisions?o.topCapSubdivisions:y,1),V=Math.max(o.bottomCapSubdivisions?o.bottomCapSubdivisions:y,1),J=Math.acos((A-c)/k);let N=[];const h=[],Q=[],p=[];let j=0;const m=[],P=.5*l,b=.5*Math.PI;let e,Z;const M=E.xH.Zero(),K=E.xH.Zero(),f=Math.cos(J),B=Math.sin(J),q=new E.Vector2(c*B,P+c*f).zH(new E.Vector2(A*B,A*f-P)).length(),D=c*J+q+A*(b-J);let T=0;for(Z=0;Z<=z;Z++){const o=[],H=b-J*(Z/z);T+=c*J/z;const n=Math.cos(H),E=Math.sin(H),k=n*c;for(e=0;e<=S;e++){const H=e/S,g=H*x+0,O=Math.sin(g),y=Math.cos(g);K.x=k*O,K.y=P+E*c,K.z=k*y,h.push(K.x,K.y,K.z),M.set(n*O,E,n*y),Q.push(M.x,M.y,M.z),p.push(H,Y.d?T/D:1-T/D),o.push(j),j++}m.push(o)}const a=k-c-A+f*c-f*A,F=B*(A-c)/a;for(Z=1;Z<=G;Z++){const o=[];T+=q/G;const H=B*(Z*(A-c)/G+c);for(e=0;e<=S;e++){const n=e/S,E=n*x+0,k=Math.sin(E),g=Math.cos(E);K.x=H*k,K.y=P+f*c-Z*a/G,K.z=H*g,h.push(K.x,K.y,K.z),M.set(k,F,g).normalize(),Q.push(M.x,M.y,M.z),p.push(n,Y.d?T/D:1-T/D),o.push(j),j++}m.push(o)}for(Z=1;Z<=V;Z++){const o=[],H=b-J-(Math.PI-J)*(Z/V);T+=A*J/V;const n=Math.cos(H),E=Math.sin(H),k=n*A;for(e=0;e<=S;e++){const H=e/S,g=H*x+0,O=Math.sin(g),y=Math.cos(g);K.x=k*O,K.y=E*A-P,K.z=k*y,h.push(K.x,K.y,K.z),M.set(n*O,E,n*y),Q.push(M.x,M.y,M.z),p.push(H,Y.d?T/D:1-T/D),o.push(j),j++}m.push(o)}for(e=0;e<S;e++)for(Z=0;Z<z+G+V;Z++){const o=m[Z][e],H=m[Z+1][e],n=m[Z+1][e+1],E=m[Z][e+1];N.push(o),N.push(H),N.push(E),N.push(H),N.push(n),N.push(E)}if(N=N.reverse(),o.orientation&&!o.orientation.equals(E.xH.Up())){const H=new E.Matrix;o.orientation.clone().scale(.5*Math.PI).cross(E.xH.Up()).toQuaternion().toRotationMatrix(H);const n=E.xH.Zero();for(let o=0;o<h.length;o+=3)n.set(h[o],h[o+1],h[o+2]),E.xH.TransformCoordinatesToRef(n.clone(),H,n),h[o]=n.x,h[o+1]=n.y,h[o+2]=n.z}const C=new O.c;return C.Zo=h,C.Mo=Q,C.fo=p,C.indices=N,C}function i(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:E.xH.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=new k.b(o,n);return W(H).qo(g,H.updatable),g}k.b.CreateDecal=(o,H,n,E,k,g)=>R(o,H,{position:n,normal:E,size:k,angle:g});k.b.CreateCapsule=(o,H,n)=>i(o,H,n),O.c.CreateCapsule=W;var L=n(11038),oo=n(11196);class Ho{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=o,this.y=H,o!==Math.floor(o)&&(o=Math.floor(o),L.d.Warn("x is not an integer, floor(x) used")),H!==Math.floor(H)&&(H=Math.floor(H),L.d.Warn("y is not an integer, floor(y) used"))}clone(){return new Ho(this.x,this.y)}rotate60About(o){const H=this.x;return this.x=o.x+o.y-this.y,this.y=H+this.y-o.x,this}rotateNeg60About(o){const H=this.x;return this.x=H+this.y-o.y,this.y=o.x+o.y-H,this}rotate120(o,H){o!==Math.floor(o)&&(o=Math.floor(o),L.d.Warn("m not an integer only floor(m) used")),H!==Math.floor(H)&&(H=Math.floor(H),L.d.Warn("n not an integer only floor(n) used"));const n=this.x;return this.x=o-n-this.y,this.y=H+n,this}rotateNeg120(o,H){o!==Math.floor(o)&&(o=Math.floor(o),L.d.Warn("m is not an integer, floor(m) used")),H!==Math.floor(H)&&(H=Math.floor(H),L.d.Warn("n is not an integer,   floor(n) used"));const n=this.x;return this.x=this.y-H,this.y=o+H-n-this.y,this}toCartesianOrigin(o,H){const n=E.xH.Zero();return n.x=o.x+2*this.x*H+this.y*H,n.y=o.y+Math.sqrt(3)*this.y*H,n}static Zero(){return new Ho(0,0)}}class no{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Eo("icosahedron","Regular",[[0,oo.h,-1],[-oo.h,1,0],[-1,0,-oo.h],[1,0,-oo.h],[oo.h,1,0],[0,oo.h,1],[-1,0,oo.h],[-oo.h,-1,0],[0,-oo.h,-1],[oo.h,-1,0],[1,0,oo.h],[0,-oo.h,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let o=12;const H={},n=this.m,E=this.n;let k,g,O,Y,y,S=n,G=1,c=0;0!==E&&(S=(0,s.HighestCommonFactor)(n,E)),G=n/S,c=E/S;const A=Ho.Zero(),l=new Ho(n,E),x=new Ho(-E,n+E),z=Ho.Zero(),V=Ho.Zero(),J=Ho.Zero();let N,h,Q,p,j=[];const m=[],P=this.vertByDist,b=(n,E,k,g)=>{N=n+"|"+k,h=E+"|"+g,N in H||h in H?N in H&&!(h in H)?H[h]=H[N]:h in H&&!(N in H)&&(H[N]=H[h]):(H[N]=o,H[h]=o,o++),P[k][0]>2?m[H[N]]=[-P[k][0],P[k][1],H[N]]:m[H[N]]=[j[P[k][0]],P[k][1],H[N]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let e=0;e<20;e++){if(j=this.IDATA.face[e],O=j[2],Y=j[1],y=j[0],Q=A.x+"|"+A.y,N=e+"|"+Q,N in H||(H[N]=O,m[O]=[j[P[Q][0]],P[Q][1]]),Q=l.x+"|"+l.y,N=e+"|"+Q,N in H||(H[N]=Y,m[Y]=[j[P[Q][0]],P[Q][1]]),Q=x.x+"|"+x.y,N=e+"|"+Q,N in H||(H[N]=y,m[y]=[j[P[Q][0]],P[Q][1]]),k=this.IDATA.edgematch[e][0],g=this.IDATA.edgematch[e][1],"B"===g)for(let o=1;o<S;o++)V.x=n-o*(G+c),V.y=E+o*G,J.x=-o*c,J.y=o*(G+c),Q=V.x+"|"+V.y,p=J.x+"|"+J.y,b(e,k,Q,p);if("O"===g)for(let o=1;o<S;o++)J.x=-o*c,J.y=o*(G+c),z.x=o*G,z.y=o*c,Q=J.x+"|"+J.y,p=z.x+"|"+z.y,b(e,k,Q,p);if(k=this.IDATA.edgematch[e][2],g=this.IDATA.edgematch[e][3],g&&"A"===g)for(let o=1;o<S;o++)z.x=o*G,z.y=o*c,V.x=n-(S-o)*(G+c),V.y=E+(S-o)*G,Q=z.x+"|"+z.y,p=V.x+"|"+V.y,b(e,k,Q,p);for(let n=0;n<this.vertices.length;n++)Q=this.vertices[n].x+"|"+this.vertices[n].y,N=e+"|"+Q,N in H||(H[N]=o++,P[Q][0]>2?m[H[N]]=[-P[Q][0],P[Q][1],H[N]]:m[H[N]]=[j[P[Q][0]],P[Q][1],H[N]])}this.closestTo=m,this.vecToidx=H}calcCoeffs(){const o=this.m,H=this.n,n=Math.sqrt(3)/3,E=o*o+H*H+o*H;this.coau=(o+H)/E,this.cobu=-H/E,this.coav=-n*(o-H)/E,this.cobv=n*(2*o+H)/E}createInnerFacets(){const o=this.m,H=this.n;for(let n=0;n<H+o+1;n++)for(let o=this.min[n];o<this.max[n]+1;o++)o<this.max[n]&&o<this.max[n+1]+1&&this.innerFacets.push(["|"+o+"|"+n,"|"+o+"|"+(n+1),"|"+(o+1)+"|"+n]),n>0&&o<this.max[n-1]&&o+1<this.max[n]+1&&this.innerFacets.push(["|"+o+"|"+n,"|"+(o+1)+"|"+n,"|"+(o+1)+"|"+(n-1)])}edgeVecsABOB(){const o=this.m,H=this.n,n=new Ho(-H,o+H);for(let E=1;E<o+H;E++){const o=new Ho(this.min[E],E),H=new Ho(this.min[E-1],E-1),k=new Ho(this.min[E+1],E+1),g=o.clone(),O=H.clone(),Y=k.clone();g.rotate60About(n),O.rotate60About(n),Y.rotate60About(n);const y=new Ho(this.max[g.y],g.y),S=new Ho(this.max[g.y-1],g.y-1),G=new Ho(this.max[g.y-1]-1,g.y-1);g.x===y.x&&g.y===y.y||(g.x!==S.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([o,S,G]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([o,G,y])):g.y===Y.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([o,H,S]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([o,S,k])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([o,H,S]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([o,S,y])))}}mapABOBtoOBOA(){const o=new Ho(0,0);for(let H=0;H<this.isoVecsABOB.length;H++){const n=[];for(let E=0;E<3;E++)o.x=this.isoVecsABOB[H][E].x,o.y=this.isoVecsABOB[H][E].y,0===this.vertexTypes[H][E]&&o.rotateNeg120(this.m,this.n),n.push(o.clone());this.isoVecsOBOA.push(n)}}mapABOBtoBAOA(){const o=new Ho(0,0);for(let H=0;H<this.isoVecsABOB.length;H++){const n=[];for(let E=0;E<3;E++)o.x=this.isoVecsABOB[H][E].x,o.y=this.isoVecsABOB[H][E].y,1===this.vertexTypes[H][E]&&o.rotate120(this.m,this.n),n.push(o.clone());this.isoVecsBAOA.push(n)}}MapToFace(o,H){const n=this.IDATA.face[o],k=n[2],g=n[1],O=n[0],Y=E.xH.Mg(this.IDATA.vertex[k]),y=E.xH.Mg(this.IDATA.vertex[g]),S=E.xH.Mg(this.IDATA.vertex[O]),G=y.zH(Y),c=S.zH(Y),A=G.scale(this.coau).add(c.scale(this.cobu)),l=G.scale(this.coav).add(c.scale(this.cobv)),x=[];let z,V=E.TmpVectors.xH[0];for(let E=0;E<this.cartesian.length;E++)V=A.scale(this.cartesian[E].x).add(l.scale(this.cartesian[E].y)).add(Y),x[E]=[V.x,V.y,V.z],z=o+"|"+this.vertices[E].x+"|"+this.vertices[E].y,H.vertex[this.vecToidx[z]]=[V.x,V.y,V.z]}build(o,H){const n=[],E=Ho.Zero(),k=new Ho(o,H),g=new Ho(-H,o+H);n.push(E,k,g);for(let Q=H;Q<o+1;Q++)for(let H=0;H<o+1-Q;H++)n.push(new Ho(H,Q));if(H>0){const E=(0,s.HighestCommonFactor)(o,H),k=o/E,g=H/E;for(let Y=1;Y<E;Y++)n.push(new Ho(Y*k,Y*g)),n.push(new Ho(-Y*g,Y*(k+g))),n.push(new Ho(o-Y*(k+g),H+Y*k));const O=o/H;for(let Y=1;Y<H;Y++)for(let E=0;E<Y*O;E++)n.push(new Ho(E,Y)),n.push(new Ho(E,Y).rotate120(o,H)),n.push(new Ho(E,Y).rotateNeg120(o,H))}n.sort(((o,H)=>o.x-H.x)),n.sort(((o,H)=>o.y-H.y));const O=new Array(o+H+1),Y=new Array(o+H+1);for(let Q=0;Q<O.length;Q++)O[Q]=1/0,Y[Q]=-1/0;let y=0,S=0;const G=n.length;for(let Q=0;Q<G;Q++)S=n[Q].x,y=n[Q].y,O[y]=Math.min(S,O[y]),Y[y]=Math.max(S,Y[y]);const c=(n,E)=>{const k=n.clone();return"A"===E&&k.rotateNeg120(o,H),"B"===E&&k.rotate120(o,H),k.x<0?k.y:k.x+k.y},A=[],l=[],x=[],z=[],V={},J=[];let N=-1,h=-1;for(let Q=0;Q<G;Q++)A[Q]=n[Q].toCartesianOrigin(new Ho(0,0),.5),l[Q]=c(n[Q],"O"),x[Q]=c(n[Q],"A"),z[Q]=c(n[Q],"B"),l[Q]===x[Q]&&x[Q]===z[Q]?(N=3,h=l[Q]):l[Q]===x[Q]?(N=4,h=l[Q]):x[Q]===z[Q]?(N=5,h=x[Q]):z[Q]===l[Q]&&(N=6,h=l[Q]),l[Q]<x[Q]&&l[Q]<z[Q]&&(N=2,h=l[Q]),x[Q]<l[Q]&&x[Q]<z[Q]&&(N=1,h=x[Q]),z[Q]<x[Q]&&z[Q]<l[Q]&&(N=0,h=z[Q]),J.push([N,h,n[Q].x,n[Q].y]);J.sort(((o,H)=>o[2]-H[2])),J.sort(((o,H)=>o[3]-H[3])),J.sort(((o,H)=>o[1]-H[1])),J.sort(((o,H)=>o[0]-H[0]));for(let Q=0;Q<J.length;Q++)V[J[Q][2]+"|"+J[Q][3]]=[J[Q][0],J[Q][1],Q];return this.m=o,this.n=H,this.vertices=n,this.vertByDist=V,this.cartesian=A,this.min=O,this.max=Y,this}}class Eo{constructor(o,H,n,E){this.name=o,this.category=H,this.vertex=n,this.face=E}}class ko extends Eo{innerToData(o,H){for(let n=0;n<H.innerFacets.length;n++)this.face.push(H.innerFacets[n].map((n=>H.vecToidx[o+n])))}mapABOBtoDATA(o,H){const n=H.IDATA.edgematch[o][0];for(let E=0;E<H.isoVecsABOB.length;E++){const k=[];for(let g=0;g<3;g++)0===H.vertexTypes[E][g]?k.push(o+"|"+H.isoVecsABOB[E][g].x+"|"+H.isoVecsABOB[E][g].y):k.push(n+"|"+H.isoVecsABOB[E][g].x+"|"+H.isoVecsABOB[E][g].y);this.face.push([H.vecToidx[k[0]],H.vecToidx[k[1]],H.vecToidx[k[2]]])}}mapOBOAtoDATA(o,H){const n=H.IDATA.edgematch[o][0];for(let E=0;E<H.isoVecsOBOA.length;E++){const k=[];for(let g=0;g<3;g++)1===H.vertexTypes[E][g]?k.push(o+"|"+H.isoVecsOBOA[E][g].x+"|"+H.isoVecsOBOA[E][g].y):k.push(n+"|"+H.isoVecsOBOA[E][g].x+"|"+H.isoVecsOBOA[E][g].y);this.face.push([H.vecToidx[k[0]],H.vecToidx[k[1]],H.vecToidx[k[2]]])}}mapBAOAtoDATA(o,H){const n=H.IDATA.edgematch[o][2];for(let E=0;E<H.isoVecsBAOA.length;E++){const k=[];for(let g=0;g<3;g++)1===H.vertexTypes[E][g]?k.push(o+"|"+H.isoVecsBAOA[E][g].x+"|"+H.isoVecsBAOA[E][g].y):k.push(n+"|"+H.isoVecsBAOA[E][g].x+"|"+H.isoVecsBAOA[E][g].y);this.face.push([H.vecToidx[k[0]],H.vecToidx[k[1]],H.vecToidx[k[2]]])}}orderData(o){const H=[];for(let g=0;g<13;g++)H[g]=[];const n=o.closestTo;for(let g=0;g<n.length;g++)n[g][0]>-1?n[g][1]>0&&H[n[g][0]].push([g,n[g][1]]):H[12].push([g,n[g][0]]);const E=[];for(let g=0;g<12;g++)E[g]=g;let k=12;for(let g=0;g<12;g++){H[g].sort(((o,H)=>o[1]-H[1]));for(let o=0;o<H[g].length;o++)E[H[g][o][0]]=k++}for(let g=0;g<H[12].length;g++)E[H[12][g][0]]=k++;for(let g=0;g<this.vertex.length;g++)this.vertex[g].push(E[g]);this.vertex.sort(((o,H)=>o[3]-H[3]));for(let g=0;g<this.vertex.length;g++)this.vertex[g].pop();for(let g=0;g<this.face.length;g++)for(let o=0;o<this.face[g].length;o++)this.face[g][o]=E[this.face[g][o]];this.sharedNodes=H[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(o,H){const n=[],E=[];let k=H.pop();E.push(k);let g=this.face[k].indexOf(o);g=(g+2)%3;let O=this.face[k][g];n.push(O);let Y=0;for(;H.length>0;)k=H[Y],this.face[k].indexOf(O)>-1?(g=(this.face[k].indexOf(O)+1)%3,O=this.face[k][g],n.push(O),E.push(k),H.splice(Y,1),Y=0):Y++;return this.adjacentFaces.push(n),E}toGoldbergPolyhedronData(){const o=new Eo("GeoDual","Goldberg",[],[]);o.name="GD dual";const H=this.vertex.length,n=new Array(H);for(let y=0;y<H;y++)n[y]=[];for(let y=0;y<this.face.length;y++)for(let o=0;o<3;o++)n[this.face[y][o]].push(y);let E=0,k=0,g=0,O=[],Y=[];this.adjacentFaces=[];for(let y=0;y<n.length;y++){o.face[y]=this.setOrder(y,n[y].concat([]));for(const H of n[y]){E=0,k=0,g=0,O=this.face[H];for(let o=0;o<3;o++)Y=this.vertex[O[o]],E+=Y[0],k+=Y[1],g+=Y[2];o.vertex[H]=[E/3,k/3,g/3]}}return o}static BuildGeodesicData(o){const H=new ko("Geodesic-m-n","Geodesic",[[0,oo.h,-1],[-oo.h,1,0],[-1,0,-oo.h],[1,0,-oo.h],[oo.h,1,0],[0,oo.h,1],[-1,0,oo.h],[-oo.h,-1,0],[0,-oo.h,-1],[oo.h,-1,0],[1,0,oo.h],[0,-oo.h,1]],[]);o.setIndices(),o.calcCoeffs(),o.createInnerFacets(),o.edgeVecsABOB(),o.mapABOBtoOBOA(),o.mapABOBtoBAOA();for(let n=0;n<o.IDATA.face.length;n++)o.MapToFace(n,H),H.innerToData(n,o),"B"===o.IDATA.edgematch[n][1]&&H.mapABOBtoDATA(n,o),"O"===o.IDATA.edgematch[n][1]&&H.mapOBOAtoDATA(n,o),"A"===o.IDATA.edgematch[n][3]&&H.mapBAOAtoDATA(n,o);H.orderData(o);return H.vertex=H.vertex.map((function(o){const H=o[0],n=o[1],E=o[2],k=Math.sqrt(H*H+n*n+E*E);return o[0]*=1/k,o[1]*=1/k,o[2]*=1/k,o})),H}}k.b._GoldbergMeshParser=(o,H)=>go.Parse(o,H);class go extends k.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(o,H){return void 0===H?(o>this.goldbergData.nbUnsharedFaces-1&&(L.d.Warn("Maximum number of unshared faces used"),o=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+o):(o>11&&(L.d.Warn("Last pole used"),o=11),H>this.goldbergData.nbFacesAtPole-1&&(L.d.Warn("Maximum number of faces at a pole used"),H=this.goldbergData.nbFacesAtPole-1),12+o*this.goldbergData.nbFacesAtPole+H)}_changeGoldbergFaceColors(o){for(let n=0;n<o.length;n++){const H=o[n][0],E=o[n][1],k=o[n][2];for(let o=H;o<E+1;o++)this.goldbergData.faceColors[o]=k}const H=[];for(let n=0;n<12;n++)for(let o=0;o<5;o++)H.push(this.goldbergData.faceColors[n].r,this.goldbergData.faceColors[n].g,this.goldbergData.faceColors[n].b,this.goldbergData.faceColors[n].a);for(let n=12;n<this.goldbergData.faceColors.length;n++)for(let o=0;o<6;o++)H.push(this.goldbergData.faceColors[n].r,this.goldbergData.faceColors[n].g,this.goldbergData.faceColors[n].b,this.goldbergData.faceColors[n].a);return H}setGoldbergFaceColors(o){const H=this._changeGoldbergFaceColors(o);this.Fo(g.d.ColorKind,H)}updateGoldbergFaceColors(o){const H=this._changeGoldbergFaceColors(o);this.updateVerticesData(g.d.ColorKind,H)}_changeGoldbergFaceUVs(o){const H=this.getVerticesData(g.d.UVKind);for(let n=0;n<o.length;n++){const E=o[n][0],k=o[n][1],g=o[n][2],O=o[n][3],Y=o[n][4],y=[],S=[];let G,c;for(let o=0;o<5;o++)G=g.x+O*Math.cos(Y+o*Math.PI/2.5),c=g.y+O*Math.sin(Y+o*Math.PI/2.5),G<0&&(G=0),G>1&&(G=1),y.push(G,c);for(let o=0;o<6;o++)G=g.x+O*Math.cos(Y+o*Math.PI/3),c=g.y+O*Math.sin(Y+o*Math.PI/3),G<0&&(G=0),G>1&&(G=1),S.push(G,c);for(let o=E;o<Math.min(12,k+1);o++)for(let n=0;n<5;n++)H[10*o+2*n]=y[2*n],H[10*o+2*n+1]=y[2*n+1];for(let o=Math.max(12,E);o<k+1;o++)for(let n=0;n<6;n++)H[12*o-24+2*n]=S[2*n],H[12*o-23+2*n]=S[2*n+1]}return H}setGoldbergFaceUVs(o){const H=this._changeGoldbergFaceUVs(o);this.Fo(g.d.UVKind,H)}updateGoldbergFaceUVs(o){const H=this._changeGoldbergFaceUVs(o);this.updateVerticesData(g.d.UVKind,H)}placeOnGoldbergFaceAt(o,H,n){const k=E.xH.RotationFromAxis(this.goldbergData.faceXaxis[H],this.goldbergData.faceYaxis[H],this.goldbergData.faceZaxis[H]);o.rotation=k,o.position=this.goldbergData.faceCenters[H].add(this.goldbergData.faceXaxis[H].scale(n.x)).add(this.goldbergData.faceYaxis[H].scale(n.y)).add(this.goldbergData.faceZaxis[H].scale(n.z))}serialize(o){super.serialize(o),o.type="GoldbergMesh";const H={};if(H.adjacentFaces=this.goldbergData.adjacentFaces,H.nbSharedFaces=this.goldbergData.nbSharedFaces,H.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,H.nbFaces=this.goldbergData.nbFaces,H.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){H.faceColors=[];for(const o of this.goldbergData.faceColors)H.faceColors.push(o.bg())}if(this.goldbergData.faceCenters){H.faceCenters=[];for(const o of this.goldbergData.faceCenters)H.faceCenters.push(o.bg())}if(this.goldbergData.faceZaxis){H.faceZaxis=[];for(const o of this.goldbergData.faceZaxis)H.faceZaxis.push(o.bg())}if(this.goldbergData.faceYaxis){H.faceYaxis=[];for(const o of this.goldbergData.faceYaxis)H.faceYaxis.push(o.bg())}if(this.goldbergData.faceXaxis){H.faceXaxis=[];for(const o of this.goldbergData.faceXaxis)H.faceXaxis.push(o.bg())}o.goldbergData=H}static Parse(o,H){const n=o.goldbergData;n.faceColors=n.faceColors.map((o=>A.d.Mg(o))),n.faceCenters=n.faceCenters.map((o=>E.xH.Mg(o))),n.faceZaxis=n.faceZaxis.map((o=>E.xH.Mg(o))),n.faceXaxis=n.faceXaxis.map((o=>E.xH.Mg(o))),n.faceYaxis=n.faceYaxis.map((o=>E.xH.Mg(o)));const k=new go(o.name,H);return k.goldbergData=n,k}}var Oo=n(11748);const Yo={CreateBox:c.d,CreateTiledBox:V,CreateSphere:J.b,CreateDisc:G.b,CreateIcoSphere:X,CreateRibbon:S,CreateCylinder:p,CreateTorus:m,CreateTorusKnot:b,CreateLineSystem:e.f,yS:e.i,CreateDashedLines:e.e,ExtrudeShape:K,ExtrudeShapeCustom:f,CreateLathe:q,CreateTiledPlane:x,GS:D.e,CreateGround:T.e,CreateTiledGround:T.i,CreateGroundFromHeightMap:T.c,CreatePolygon:Z.b,ExtrudePolygon:Z.e,CreateTube:a,CreatePolyhedron:C,CreateGeodesic:function(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=H.m||1;E!==Math.floor(E)&&(E=Math.floor(E),L.d.Warn("m not an integer only floor(m) used"));let k=H.n||0;if(k!==Math.floor(k)&&(k=Math.floor(k),L.d.Warn("n not an integer only floor(n) used")),k>E){const o=k;k=E,E=o,L.d.Warn("n > m therefore m and n swapped")}const g=new no;return g.build(E,k),C(o,{custom:ko.BuildGeodesicData(g),size:H.size,sizeX:H.sizeX,sizeY:H.sizeY,sizeZ:H.sizeZ,faceUV:H.faceUV,faceColors:H.faceColors,flat:H.flat,updatable:H.updatable,sideOrientation:H.sideOrientation,frontUVs:H.frontUVs,backUVs:H.backUVs},n)},CreateGoldberg:function(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=H.size,y=H.sizeX||g||1,S=H.sizeY||g||1,G=H.sizeZ||g||1;let c=H.m||1;c!==Math.floor(c)&&(c=Math.floor(c),L.d.Warn("m not an integer only floor(m) used"));let l=H.n||0;if(l!==Math.floor(l)&&(l=Math.floor(l),L.d.Warn("n not an integer only floor(n) used")),l>c){const o=l;l=c,c=o,L.d.Warn("n > m therefore m and n swapped")}const x=new no;x.build(c,l);const z=ko.BuildGeodesicData(x),V=z.toGoldbergPolyhedronData(),J=new go(o,n);H.sideOrientation=k.b._GetDefaultSideOrientation(H.sideOrientation),J._originalBuilderSideOrientation=H.sideOrientation;(function(o,H){const n=o.size,k=o.sizeX||n||1,g=o.sizeY||n||1,y=o.sizeZ||n||1,S=0===o.sideOrientation?0:o.sideOrientation||O.c.DEFAULTSIDE,G=[],c=[],A=[],l=[];let x=1/0,z=-1/0,V=1/0,J=-1/0;for(let E=0;E<H.vertex.length;E++)x=Math.min(x,H.vertex[E][0]*k),z=Math.max(z,H.vertex[E][0]*k),V=Math.min(V,H.vertex[E][1]*g),J=Math.max(J,H.vertex[E][1]*g);let N=0;for(let O=0;O<H.face.length;O++){const o=H.face[O],n=E.xH.Mg(H.vertex[o[0]]),S=E.xH.Mg(H.vertex[o[2]]),h=E.xH.Mg(H.vertex[o[1]]),Q=S.zH(n),p=h.zH(n),j=E.xH.Cross(p,Q).normalize();for(let E=0;E<o.length;E++){A.push(j.x,j.y,j.z);const n=H.vertex[o[E]];G.push(n[0]*k,n[1]*g,n[2]*y);const O=(n[1]*g-V)/(J-V);l.push((n[0]*k-x)/(z-x),Y.d?1-O:O)}for(let H=0;H<o.length-2;H++)c.push(N,N+H+2,N+H+1);N+=o.length}O.c._ComputeSides(S,G,c,A,l);const h=new O.c;return h.Zo=G,h.indices=c,h.Mo=A,h.fo=l,h})(H,V).qo(J,H.updatable),J.goldbergData.nbSharedFaces=z.sharedNodes,J.goldbergData.nbUnsharedFaces=z.poleNodes,J.goldbergData.adjacentFaces=z.adjacentFaces,J.goldbergData.nbFaces=J.goldbergData.nbSharedFaces+J.goldbergData.nbUnsharedFaces,J.goldbergData.nbFacesAtPole=(J.goldbergData.nbUnsharedFaces-12)/12;for(let k=0;k<z.vertex.length;k++)J.goldbergData.faceCenters.push(E.xH.Mg(z.vertex[k])),J.goldbergData.faceCenters[k].x*=y,J.goldbergData.faceCenters[k].y*=S,J.goldbergData.faceCenters[k].z*=G,J.goldbergData.faceColors.push(new A.d(1,1,1,1));for(let k=0;k<V.face.length;k++){const o=V.face[k],H=E.xH.Mg(V.vertex[o[0]]),n=E.xH.Mg(V.vertex[o[2]]),g=E.xH.Mg(V.vertex[o[1]]),O=n.zH(H),Y=g.zH(H),y=E.xH.Cross(Y,O).normalize(),S=E.xH.Cross(Y,y).normalize();J.goldbergData.faceXaxis.push(Y.normalize()),J.goldbergData.faceYaxis.push(y),J.goldbergData.faceZaxis.push(S)}return J},CreateDecal:R,CreateCapsule:i,CreateText:Oo.f}},12525:(o,H,n)=>{"use strict";n.d(H,{e:()=>yH});var E=n(11189),k=n(11580);class g extends k.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var O=n(11238),Y=(n(11361),n(11140));class y{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(o){this._targetStopDuration!==o&&(this._targetStopDuration=o)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(o){this._noiseTexture!==o&&(this._noiseTexture=o,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(o){this._animationSheetEnabled!==o&&(this._animationSheetEnabled=o)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(o){this._isAnimationSheetEnabled!=o&&(this._isAnimationSheetEnabled=o,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(o){this._useLogarithmicDepth=o&&this.bo().getEngine().getCaps().fragmentDepthSupported}bo(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(o){switch(o){case y.BLENDMODE_MULTIPLYADD:return;case y.BLENDMODE_ADD:o=1;break;case y.BLENDMODE_ONEONE:o=6;break;case y.BLENDMODE_STANDARD:o=2;break;case y.BLENDMODE_MULTIPLY:o=4;break;case y.BLENDMODE_SUBTRACT:o=3}this._engine.setAlphaMode(o)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:E.xH.Zero()}set direction1(o){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=o)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:E.xH.Zero()}set direction2(o){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=o)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:E.xH.Zero()}set minEmitBox(o){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=o)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:E.xH.Zero()}set maxEmitBox(o){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=o)}get billboardMode(){return this._billboardMode}set billboardMode(o){this._billboardMode!==o&&(this._billboardMode=o,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(o){this._isBillboardBased!==o&&(this._isBillboardBased=o,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(o){this._attachImageProcessingConfiguration(o)}_attachImageProcessingConfiguration(o){o!==this._imageProcessingConfiguration&&(!o&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=o)}_reset(){}_removeGradientAndTexture(o,H,n){if(!H)return this;let E=0;for(const k of H){if(k.gradient===o){H.splice(E,1);break}E++}return n&&n.dispose(),this}constructor(o){this.animations=[],this.renderingGroupId=0,this.i=E.xH.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new E.xH(10,10,10),this.onAnimationEnd=null,this.blendMode=y.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new E.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.gS=new E.xH(0,0,0),this._useLogarithmicDepth=!1,this.gravity=E.xH.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new O.d(1,1,1,1),this.color2=new O.d(1,1,1,1),this.colorDead=new O.d(0,0,0,1),this.textureMask=new O.d(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new g,this.id=o,this.name=o}createPointEmitter(o,H){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new E.xH(0,1,0),arguments.length>2&&void 0!==arguments[2]||new E.xH(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new E.xH(0,1,0),arguments.length>4&&void 0!==arguments[4]||new E.xH(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new E.xH(0,1,0),arguments.length>3&&void 0!==arguments[3]||new E.xH(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(o,H,n,E){throw new Error("Method not implemented.")}}y.BLENDMODE_ONEONE=0,y.BLENDMODE_STANDARD=1,y.BLENDMODE_ADD=2,y.BLENDMODE_MULTIPLY=3,y.BLENDMODE_MULTIPLYADD=4,y.BLENDMODE_SUBTRACT=-1,(0,Y.e)("BABYLON.BaseParticleSystem",y);var S=n(11205),G=n(11040);class c{constructor(){this.direction1=new E.xH(0,1,0),this.direction2=new E.xH(0,1,0),this.minEmitBox=new E.xH(-.5,-.5,-.5),this.maxEmitBox=new E.xH(.5,.5,.5)}startDirectionFunction(o,H,n,k){const g=(0,S.RandomRange)(this.direction1.x,this.direction2.x),O=(0,S.RandomRange)(this.direction1.y,this.direction2.y),Y=(0,S.RandomRange)(this.direction1.z,this.direction2.z);if(k)return H.x=g,H.y=O,void(H.z=Y);E.xH.TransformNormalFromFloatsToRef(g,O,Y,o,H)}startPositionFunction(o,H,n,k){const g=(0,S.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),O=(0,S.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),Y=(0,S.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(k)return H.x=g,H.y=O,void(H.z=Y);E.xH.TransformCoordinatesFromFloatsToRef(g,O,Y,o,H)}clone(){const o=new c;return G.b.DeepCopy(this,o),o}applyToShader(o){o.setVector3("direction1",this.direction1),o.setVector3("direction2",this.direction2),o.setVector3("minEmitBox",this.minEmitBox),o.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(o){o.addUniform("direction1",3),o.addUniform("direction2",3),o.addUniform("minEmitBox",3),o.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const o={};return o.type=this.getClassName(),o.direction1=this.direction1.bg(),o.direction2=this.direction2.bg(),o.minEmitBox=this.minEmitBox.bg(),o.maxEmitBox=this.maxEmitBox.bg(),o}parse(o){E.xH.FromArrayToRef(o.direction1,0,this.direction1),E.xH.FromArrayToRef(o.direction2,0,this.direction2),E.xH.FromArrayToRef(o.minEmitBox,0,this.minEmitBox),E.xH.FromArrayToRef(o.maxEmitBox,0,this.maxEmitBox)}}class A{get radius(){return this._radius}set radius(o){this._radius=o,this._buildHeight()}get angle(){return this._angle}set angle(o){this._angle=o,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=n,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=H,this.radius=o}startDirectionFunction(o,H,n,k){k?E.TmpVectors.xH[0].S(n.tY).normalize():n.position.subtractToRef(o.getTranslation(),E.TmpVectors.xH[0]).normalize();const g=(0,S.RandomRange)(0,this.directionRandomizer),O=(0,S.RandomRange)(0,this.directionRandomizer),Y=(0,S.RandomRange)(0,this.directionRandomizer);H.x=E.TmpVectors.xH[0].x+g,H.y=E.TmpVectors.xH[0].y+O,H.z=E.TmpVectors.xH[0].z+Y,H.normalize()}startPositionFunction(o,H,n,k){const g=(0,S.RandomRange)(0,2*Math.PI);let O;this.emitFromSpawnPointOnly?O=1e-4:(O=(0,S.RandomRange)(0,this.heightRange),O=1-O*O);let Y=this._radius-(0,S.RandomRange)(0,this._radius*this.radiusRange);Y*=O;const y=Y*Math.sin(g),G=Y*Math.cos(g),c=O*this._height;if(k)return H.x=y,H.y=c,void(H.z=G);E.xH.TransformCoordinatesFromFloatsToRef(y,c,G,o,H)}clone(){const o=new A(this._radius,this._angle,this.directionRandomizer);return G.b.DeepCopy(this,o),o}applyToShader(o){o.setFloat2("radius",this._radius,this.radiusRange),o.setFloat("coneAngle",this._angle),o.setFloat2("height",this._height,this.heightRange),o.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(o){o.addUniform("radius",2),o.addUniform("coneAngle",1),o.addUniform("height",2),o.addUniform("directionRandomizer",1)}getEffectDefines(){let o="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(o+="\n#define CONEEMITTERSPAWNPOINT"),o}getClassName(){return"ConeParticleEmitter"}serialize(){const o={};return o.type=this.getClassName(),o.radius=this._radius,o.angle=this._angle,o.directionRandomizer=this.directionRandomizer,o.radiusRange=this.radiusRange,o.heightRange=this.heightRange,o.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,o}parse(o){this.radius=o.radius,this.angle=o.angle,this.directionRandomizer=o.directionRandomizer,this.radiusRange=void 0!==o.radiusRange?o.radiusRange:1,this.heightRange=void 0!==o.radiusRange?o.heightRange:1,this.emitFromSpawnPointOnly=void 0!==o.emitFromSpawnPointOnly&&o.emitFromSpawnPointOnly}}class l extends A{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new E.xH(0,1,0),k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new E.xH(0,1,0);super(o,H),this.direction1=n,this.direction2=k}startDirectionFunction(o,H){const n=(0,S.RandomRange)(this.direction1.x,this.direction2.x),k=(0,S.RandomRange)(this.direction1.y,this.direction2.y),g=(0,S.RandomRange)(this.direction1.z,this.direction2.z);E.xH.TransformNormalFromFloatsToRef(n,k,g,o,H)}clone(){const o=new l(this.radius,this.angle,this.direction1,this.direction2);return G.b.DeepCopy(this,o),o}applyToShader(o){o.setFloat("radius",this.radius),o.setFloat("radiusRange",this.radiusRange),o.setVector3("direction1",this.direction1),o.setVector3("direction2",this.direction2)}buildUniformLayout(o){o.addUniform("radius",1),o.addUniform("radiusRange",1),o.addUniform("direction1",3),o.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const o=super.serialize();return o.direction1=this.direction1.bg(),o.direction2=this.direction2.bg(),o}parse(o){super.parse(o),this.direction1.S(o.direction1),this.direction2.S(o.direction2)}}class x{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=o,this.height=H,this.radiusRange=n,this.directionRandomizer=k,this._tempVector=E.xH.Zero()}startDirectionFunction(o,H,n,k,g){n.position.subtractToRef(o.getTranslation(),this._tempVector),this._tempVector.normalize(),E.xH.TransformNormalToRef(this._tempVector,g,this._tempVector);const O=(0,S.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let Y=Math.atan2(this._tempVector.x,this._tempVector.z);Y+=(0,S.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=O,this._tempVector.x=Math.sin(Y),this._tempVector.z=Math.cos(Y),this._tempVector.normalize(),k?H.S(this._tempVector):E.xH.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,o,H)}startPositionFunction(o,H,n,k){const g=(0,S.RandomRange)(-this.height/2,this.height/2),O=(0,S.RandomRange)(0,2*Math.PI),Y=(0,S.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),y=Math.sqrt(Y)*this.radius,G=y*Math.cos(O),c=y*Math.sin(O);k?H.Wg(G,g,c):E.xH.TransformCoordinatesFromFloatsToRef(G,g,c,o,H)}clone(){const o=new x(this.radius,this.directionRandomizer);return G.b.DeepCopy(this,o),o}applyToShader(o){o.setFloat("radius",this.radius),o.setFloat("height",this.height),o.setFloat("radiusRange",this.radiusRange),o.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(o){o.addUniform("radius",1),o.addUniform("height",1),o.addUniform("radiusRange",1),o.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const o={};return o.type=this.getClassName(),o.radius=this.radius,o.height=this.height,o.radiusRange=this.radiusRange,o.directionRandomizer=this.directionRandomizer,o}parse(o){this.radius=o.radius,this.height=o.height,this.radiusRange=o.radiusRange,this.directionRandomizer=o.directionRandomizer}}class z extends x{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new E.xH(0,1,0),g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new E.xH(0,1,0);super(o,H,n),this.direction1=k,this.direction2=g}startDirectionFunction(o,H,n,k){const g=(0,S.RandomRange)(this.direction1.x,this.direction2.x),O=(0,S.RandomRange)(this.direction1.y,this.direction2.y),Y=(0,S.RandomRange)(this.direction1.z,this.direction2.z);k?H.Wg(g,O,Y):E.xH.TransformNormalFromFloatsToRef(g,O,Y,o,H)}clone(){const o=new z(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return G.b.DeepCopy(this,o),o}applyToShader(o){o.setFloat("radius",this.radius),o.setFloat("height",this.height),o.setFloat("radiusRange",this.radiusRange),o.setVector3("direction1",this.direction1),o.setVector3("direction2",this.direction2)}buildUniformLayout(o){o.addUniform("radius",1),o.addUniform("height",1),o.addUniform("radiusRange",1),o.addUniform("direction1",3),o.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const o=super.serialize();return o.direction1=this.direction1.bg(),o.direction2=this.direction2.bg(),o}parse(o){super.parse(o),E.xH.FromArrayToRef(o.direction1,0,this.direction1),E.xH.FromArrayToRef(o.direction2,0,this.direction2)}}class V{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=o,this.radiusRange=H,this.directionRandomizer=n}startDirectionFunction(o,H,n,k){const g=n.position.zH(o.getTranslation()).normalize(),O=(0,S.RandomRange)(0,this.directionRandomizer),Y=(0,S.RandomRange)(0,this.directionRandomizer),y=(0,S.RandomRange)(0,this.directionRandomizer);g.x+=O,g.y+=Y,g.z+=y,g.normalize(),k?H.S(g):E.xH.TransformNormalFromFloatsToRef(g.x,g.y,g.z,o,H)}startPositionFunction(o,H,n,k){const g=this.radius-(0,S.RandomRange)(0,this.radius*this.radiusRange),O=(0,S.RandomRange)(0,1),Y=(0,S.RandomRange)(0,2*Math.PI),y=Math.acos(2*O-1),G=g*Math.cos(Y)*Math.sin(y),c=g*Math.cos(y),A=g*Math.sin(Y)*Math.sin(y);k?H.Wg(G,Math.abs(c),A):E.xH.TransformCoordinatesFromFloatsToRef(G,Math.abs(c),A,o,H)}clone(){const o=new V(this.radius,this.directionRandomizer);return G.b.DeepCopy(this,o),o}applyToShader(o){o.setFloat("radius",this.radius),o.setFloat("radiusRange",this.radiusRange),o.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(o){o.addUniform("radius",1),o.addUniform("radiusRange",1),o.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const o={};return o.type=this.getClassName(),o.radius=this.radius,o.radiusRange=this.radiusRange,o.directionRandomizer=this.directionRandomizer,o}parse(o){this.radius=o.radius,this.radiusRange=o.radiusRange,this.directionRandomizer=o.directionRandomizer}}class J{constructor(){this.direction1=new E.xH(0,1,0),this.direction2=new E.xH(0,1,0)}startDirectionFunction(o,H,n,k){const g=(0,S.RandomRange)(this.direction1.x,this.direction2.x),O=(0,S.RandomRange)(this.direction1.y,this.direction2.y),Y=(0,S.RandomRange)(this.direction1.z,this.direction2.z);k?H.Wg(g,O,Y):E.xH.TransformNormalFromFloatsToRef(g,O,Y,o,H)}startPositionFunction(o,H,n,k){k?H.Wg(0,0,0):E.xH.TransformCoordinatesFromFloatsToRef(0,0,0,o,H)}clone(){const o=new J;return G.b.DeepCopy(this,o),o}applyToShader(o){o.setVector3("direction1",this.direction1),o.setVector3("direction2",this.direction2)}buildUniformLayout(o){o.addUniform("direction1",3),o.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const o={};return o.type=this.getClassName(),o.direction1=this.direction1.bg(),o.direction2=this.direction2.bg(),o}parse(o){E.xH.FromArrayToRef(o.direction1,0,this.direction1),E.xH.FromArrayToRef(o.direction2,0,this.direction2)}}class N{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=o,this.radiusRange=H,this.directionRandomizer=n}startDirectionFunction(o,H,n,k){const g=n.position.zH(o.getTranslation()).normalize(),O=(0,S.RandomRange)(0,this.directionRandomizer),Y=(0,S.RandomRange)(0,this.directionRandomizer),y=(0,S.RandomRange)(0,this.directionRandomizer);g.x+=O,g.y+=Y,g.z+=y,g.normalize(),k?H.S(g):E.xH.TransformNormalFromFloatsToRef(g.x,g.y,g.z,o,H)}startPositionFunction(o,H,n,k){const g=this.radius-(0,S.RandomRange)(0,this.radius*this.radiusRange),O=(0,S.RandomRange)(0,1),Y=(0,S.RandomRange)(0,2*Math.PI),y=Math.acos(2*O-1),G=g*Math.cos(Y)*Math.sin(y),c=g*Math.cos(y),A=g*Math.sin(Y)*Math.sin(y);k?H.Wg(G,c,A):E.xH.TransformCoordinatesFromFloatsToRef(G,c,A,o,H)}clone(){const o=new N(this.radius,this.directionRandomizer);return G.b.DeepCopy(this,o),o}applyToShader(o){o.setFloat("radius",this.radius),o.setFloat("radiusRange",this.radiusRange),o.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(o){o.addUniform("radius",1),o.addUniform("radiusRange",1),o.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const o={};return o.type=this.getClassName(),o.radius=this.radius,o.radiusRange=this.radiusRange,o.directionRandomizer=this.directionRandomizer,o}parse(o){this.radius=o.radius,this.radiusRange=o.radiusRange,this.directionRandomizer=o.directionRandomizer}}class h extends N{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new E.xH(0,1,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new E.xH(0,1,0);super(o),this.direction1=H,this.direction2=n}startDirectionFunction(o,H){const n=(0,S.RandomRange)(this.direction1.x,this.direction2.x),k=(0,S.RandomRange)(this.direction1.y,this.direction2.y),g=(0,S.RandomRange)(this.direction1.z,this.direction2.z);E.xH.TransformNormalFromFloatsToRef(n,k,g,o,H)}clone(){const o=new h(this.radius,this.direction1,this.direction2);return G.b.DeepCopy(this,o),o}applyToShader(o){o.setFloat("radius",this.radius),o.setFloat("radiusRange",this.radiusRange),o.setVector3("direction1",this.direction1),o.setVector3("direction2",this.direction2)}buildUniformLayout(o){o.addUniform("radius",1),o.addUniform("radiusRange",1),o.addUniform("direction1",3),o.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const o=super.serialize();return o.direction1=this.direction1.bg(),o.direction2=this.direction2.bg(),o}parse(o){super.parse(o),this.direction1.S(o.direction1),this.direction2.S(o.direction2)}}class Q{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(o,H,n,k){const g=E.TmpVectors.xH[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,n,g);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,n,g);const o=E.TmpVectors.xH[1];g.subtractToRef(n.position,o),o.scaleToRef(1/n.lifeTime,g)}else g.set(0,0,0);k?H.S(g):E.xH.TransformNormalToRef(g,o,H)}startPositionFunction(o,H,n,k){const g=E.TmpVectors.xH[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,n,g):g.set(0,0,0),k?H.S(g):E.xH.TransformCoordinatesToRef(g,o,H)}clone(){const o=new Q;return G.b.DeepCopy(this,o),o}applyToShader(o){}buildUniformLayout(o){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const o={};return o.type=this.getClassName(),o.particlePositionGenerator=this.particlePositionGenerator,o.particleDestinationGenerator=this.particleDestinationGenerator,o}parse(o){o.particlePositionGenerator&&(this.particlePositionGenerator=o.particlePositionGenerator),o.particleDestinationGenerator&&(this.particleDestinationGenerator=o.particleDestinationGenerator)}}var p=n(11259);class j{get mesh(){return this._mesh}set mesh(o){this._mesh!==o&&(this._mesh=o,o?(this._indices=o.dg(),this._positions=o.getVerticesData(p.d.PositionKind),this._normals=o.getVerticesData(p.d.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=E.xH.Zero(),this._mesh=null,this.direction1=new E.xH(0,1,0),this.direction2=new E.xH(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=o}startDirectionFunction(o,H,n,k){if(this.useMeshNormalsForDirection&&this._normals)return void E.xH.TransformNormalToRef(this._storedNormal,o,H);const g=(0,S.RandomRange)(this.direction1.x,this.direction2.x),O=(0,S.RandomRange)(this.direction1.y,this.direction2.y),Y=(0,S.RandomRange)(this.direction1.z,this.direction2.z);k?H.Wg(g,O,Y):E.xH.TransformNormalFromFloatsToRef(g,O,Y,o,H)}startPositionFunction(o,H,n,k){if(!this._indices||!this._positions)return;const g=3*(Math.random()*(this._indices.length/3)|0),O=Math.random(),Y=Math.random()*(1-O),y=1-O-Y,S=this._indices[g],G=this._indices[g+1],c=this._indices[g+2],A=E.TmpVectors.xH[0],l=E.TmpVectors.xH[1],x=E.TmpVectors.xH[2],z=E.TmpVectors.xH[3];E.xH.FromArrayToRef(this._positions,3*S,A),E.xH.FromArrayToRef(this._positions,3*G,l),E.xH.FromArrayToRef(this._positions,3*c,x),z.x=O*A.x+Y*l.x+y*x.x,z.y=O*A.y+Y*l.y+y*x.y,z.z=O*A.z+Y*l.z+y*x.z,k?H.Wg(z.x,z.y,z.z):E.xH.TransformCoordinatesFromFloatsToRef(z.x,z.y,z.z,o,H),this.useMeshNormalsForDirection&&this._normals&&(E.xH.FromArrayToRef(this._normals,3*S,A),E.xH.FromArrayToRef(this._normals,3*G,l),E.xH.FromArrayToRef(this._normals,3*c,x),this._storedNormal.x=O*A.x+Y*l.x+y*x.x,this._storedNormal.y=O*A.y+Y*l.y+y*x.y,this._storedNormal.z=O*A.z+Y*l.z+y*x.z)}clone(){const o=new j(this.mesh);return G.b.DeepCopy(this,o),o}applyToShader(o){o.setVector3("direction1",this.direction1),o.setVector3("direction2",this.direction2)}buildUniformLayout(o){o.addUniform("direction1",3),o.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var o;const H={};return H.type=this.getClassName(),H.direction1=this.direction1.bg(),H.direction2=this.direction2.bg(),H.meshId=null===(o=this.mesh)||void 0===o?void 0:o.id,H.useMeshNormalsForDirection=this.useMeshNormalsForDirection,H}parse(o,H){E.xH.FromArrayToRef(o.direction1,0,this.direction1),E.xH.FromArrayToRef(o.direction2,0,this.direction2),o.meshId&&H&&(this.mesh=H.getLastMeshById(o.meshId)),this.useMeshNormalsForDirection=o.useMeshNormalsForDirection}}class m{_isUbo(o){return void 0!==o.addUniform}constructor(o){this._isUbo(o)?(this.setMatrix3x3=o.updateMatrix3x3.bind(o),this.setMatrix2x2=o.updateMatrix2x2.bind(o),this.setFloat=o.updateFloat.bind(o),this.setFloat2=o.updateFloat2.bind(o),this.setFloat3=o.updateFloat3.bind(o),this.setFloat4=o.updateFloat4.bind(o),this.setFloatArray=o.updateFloatArray.bind(o),this.setArray=o.updateArray.bind(o),this.setIntArray=o.updateIntArray.bind(o),this.setMatrix=o.sg.bind(o),this.setMatrices=o.updateMatrices.bind(o),this.setVector3=o.updateVector3.bind(o),this.setVector4=o.updateVector4.bind(o),this.setColor3=o.updateColor3.bind(o),this.setColor4=o.updateColor4.bind(o),this.setDirectColor4=o.updateDirectColor4.bind(o),this.setInt=o.updateInt.bind(o),this.setInt2=o.updateInt2.bind(o),this.setInt3=o.updateInt3.bind(o),this.setInt4=o.updateInt4.bind(o)):(this.setMatrix3x3=o.setMatrix3x3.bind(o),this.setMatrix2x2=o.setMatrix2x2.bind(o),this.setFloat=o.setFloat.bind(o),this.setFloat2=o.setFloat2.bind(o),this.setFloat3=o.setFloat3.bind(o),this.setFloat4=o.setFloat4.bind(o),this.setFloatArray=o.setFloatArray.bind(o),this.setArray=o.setArray.bind(o),this.setIntArray=o.setIntArray.bind(o),this.setMatrix=o.setMatrix.bind(o),this.setMatrices=o.setMatrices.bind(o),this.setVector3=o.setVector3.bind(o),this.setVector4=o.setVector4.bind(o),this.setColor3=o.setColor3.bind(o),this.setColor4=o.setColor4.bind(o),this.setDirectColor4=o.setDirectColor4.bind(o),this.setInt=o.setInt.bind(o),this.setInt2=o.setInt2.bind(o),this.setInt3=o.setInt3.bind(o),this.setInt4=o.setInt4.bind(o))}}var P=n(11101);const b="gpuUpdateParticlesPixelShader",e="#version 300 es\nvoid main() {discard;}\n";P.d.ShadersStore[b]||(P.d.ShadersStore[b]=e);const Z="gpuUpdateParticlesVertexShader",M="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";P.d.ShadersStore[Z]||(P.d.ShadersStore[Z]=M);(0,Y.e)("BABYLON.WebGL2ParticleSystem",class{constructor(o,H){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=o,this._engine=H,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var o;return(null===(o=this._updateEffect)||void 0===o?void 0:o.isReady())??!1}createUpdateBuffer(o){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof Q&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=o,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new m(this._updateEffect)}createVertexBuffers(o,H){this._updateVAO.push(this._createUpdateVAO(o)),this._renderVAO.push(this._engine.recordVertexArrayObject(H,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=H}createParticleBuffer(o){return o}bindDrawBuffers(o,H,n){n?this._engine.bindBuffers(this._renderVertexBuffers,n,H):this._engine.bindVertexArrayObject(this._renderVAO[o],null)}preUpdateParticleBuffer(){const o=this._engine;if(this._engine.enableEffect(this._updateEffect),!o.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(o,H,n){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[o],null);const E=this._engine;E.bindTransformFeedbackBuffer(H.getBuffer()),E.setRasterizerState(!1),E.beginTransformFeedback(!0),E.drawArraysType(3,0,n),E.endTransformFeedback(),E.setRasterizerState(!0),E.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let o=0;o<this._updateVAO.length;o++)this._engine.releaseVertexArrayObject(this._updateVAO[o]);this._updateVAO.length=0;for(let o=0;o<this._renderVAO.length;o++)this._engine.releaseVertexArrayObject(this._renderVAO[o]);this._renderVAO.length=0}_createUpdateVAO(o){const H={};H.position=o.createVertexBuffer("position",0,3);let n=3;H.age=o.createVertexBuffer("age",n,1),n+=1,H.size=o.createVertexBuffer("size",n,3),n+=3,H.life=o.createVertexBuffer("life",n,1),n+=1,H.seed=o.createVertexBuffer("seed",n,4),n+=4,H.direction=o.createVertexBuffer("direction",n,3),n+=3,this._parent.particleEmitterType instanceof Q&&(H.initialPosition=o.createVertexBuffer("initialPosition",n,3),n+=3),this._parent._colorGradientsTexture||(H.color=o.createVertexBuffer("color",n,4),n+=4),this._parent._isBillboardBased||(H.initialDirection=o.createVertexBuffer("initialDirection",n,3),n+=3),this._parent.noiseTexture&&(H.noiseCoordinates1=o.createVertexBuffer("noiseCoordinates1",n,3),n+=3,H.noiseCoordinates2=o.createVertexBuffer("noiseCoordinates2",n,3),n+=3),this._parent._angularSpeedGradientsTexture?(H.angle=o.createVertexBuffer("angle",n,1),n+=1):(H.angle=o.createVertexBuffer("angle",n,2),n+=2),this._parent._isAnimationSheetEnabled&&(H.cellIndex=o.createVertexBuffer("cellIndex",n,1),n+=1,this._parent.spriteRandomStartCell&&(H.cellStartOffset=o.createVertexBuffer("cellStartOffset",n,1),n+=1));const E=this._engine.recordVertexArrayObject(H,null,this._updateEffect);return this._engine.bindArrayBuffer(null),E}});class K{constructor(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,E=arguments.length>3?arguments[3]:void 0;this._engine=o,this._label=E,this._engine._storageBuffers.push(this),this._create(H,n)}_create(o,H){this._bufferSize=o,this._creationFlags=H,this._buffer=this._engine.createStorageBuffer(o,H,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(o,H,n){this._buffer&&this._engine.updateStorageBuffer(this._buffer,o,H,n)}async read(o,H,n,E){return await this._engine.readFromStorageBuffer(this._buffer,o,H,n,E)}dispose(){const o=this._engine._storageBuffers,H=o.indexOf(this);-1!==H&&(o[H]=o[o.length-1],o.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var f=n(11170),B=n(11177),q=n(11224),D=n(11168),T=n(11506),a=n(11038),F=n(11128),C=n(11412);class t{constructor(){this._gpuTimeInFrameId=-1,this.counter=new C.e}_addDuration(o,H){o<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==o?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(H,!1),this._gpuTimeInFrameId=o):this.counter.addCount(H,!1))}}var X=n(11088);class s{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(o,H,n){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=o,this._engine=H,this.uniqueId=T.b.UniqueId,H.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new t),this._engine.getCaps().supportComputeShaders?E.bindingsMapping?(this._context=H.createComputeContext(),this._shaderPath=n,this._options={bindingsMapping:{},defines:[],...E}):a.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):a.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(o,H){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const E=this._bindings[o];this._bindings[o]={type:n?0:4,object:H,indexInGroupEntries:null===E||void 0===E?void 0:E.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!E||E.object!==H||E.type!==this._bindings[o].type)}setStorageTexture(o,H){const n=this._bindings[o];this._contextIsDirty||(this._contextIsDirty=!n||n.object!==H),this._bindings[o]={type:1,object:H,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries}}setExternalTexture(o,H){const n=this._bindings[o];this._contextIsDirty||(this._contextIsDirty=!n||n.object!==H),this._bindings[o]={type:6,object:H,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries}}setVideoTexture(o,H){return!!H.externalTexture&&(this.setExternalTexture(o,H.externalTexture),!0)}setUniformBuffer(o,H){const n=this._bindings[o];this._contextIsDirty||(this._contextIsDirty=!n||n.object!==H),this._bindings[o]={type:s._BufferIsDataBuffer(H)?7:2,object:H,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries}}setStorageBuffer(o,H){const n=this._bindings[o];this._contextIsDirty||(this._contextIsDirty=!n||n.object!==H),this._bindings[o]={type:s._BufferIsDataBuffer(H)?7:3,object:H,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries}}setTextureSampler(o,H){const n=this._bindings[o];this._contextIsDirty||(this._contextIsDirty=!n||!H.compareSampler(n.object)),this._bindings[o]={type:5,object:H,indexInGroupEntries:null===n||void 0===n?void 0:n.indexInGroupEntries}}isReady(){let o=this._effect;for(const k in this._bindings){const o=this._bindings[k],H=o.type,n=o.object;switch(H){case 0:case 4:case 1:if(!n.isReady())return!1;break;case 6:if(!n.isReady())return!1;break}}const H=[],n=this._shaderPath;if(this._options.defines)for(let k=0;k<this._options.defines.length;k++)H.push(this._options.defines[k]);const E=H.join("\n");return this._cachedDefines!==E&&(this._cachedDefines=E,o=this._engine.createComputeEffect(n,{defines:E,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=o),!!o.isReady()}dispatch(o,H,n){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,o,H,n,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const n=s._BufferIsDataBuffer(o)?o:o.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,n,H,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const H in this._bindings){const n=this._bindings[H];if(!this._options.bindingsMapping[H])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+H+"'");switch(n.type){case 0:{const E=this._samplers[H],k=n.object;var o;if(!E||!k._texture||!E.compareSampler(k._texture))this._samplers[H]=(new F.d).setParameters(k.wrapU,k.wrapV,k.wrapR,k.anisotropicFilteringLevel,k._texture.samplingMode,null===(o=k._texture)||void 0===o?void 0:o._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const o=n.object;o.getBuffer()!==n.buffer&&(n.buffer=o.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(o,H,n){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((k=>{(0,X.d)((()=>this.dispatch(o,H,n)),k,void 0,E)}))}serialize(){const o=q.e.Serialize(this);o.options=this._options,o.shaderPath=this._shaderPath,o.KA={},o.textures={};for(const H in this._bindings){const n=this._bindings[H],E=n.object;switch(n.type){case 0:case 4:case 1:{const k=E.serialize();k&&(o.textures[H]=k,o.KA[H]={type:n.type});break}}}return o}static Parse(o,H,n){const E=q.e.Parse((()=>new s(o.name,H.getEngine(),o.shaderPath,o.options)),o,H,n);for(const k in o.textures){const g=o.KA[k],O=D.c.Parse(o.textures[k],H,n);0===g.type?E.setTexture(k,O):4===g.type?E.setTexture(k,O,!1):E.setStorageTexture(k,O)}return E}static _BufferIsDataBuffer(o){return void 0!==o.underlyingResource}}(0,f.c)([(0,B.P)()],s.prototype,"name",void 0),(0,f.c)([(0,B.P)()],s.prototype,"fastMode",void 0),(0,Y.e)("BABYLON.ComputeShader",s);var U=n(11457);const I="gpuUpdateParticlesComputeShader",v="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";P.d.ShadersStoreWGSL[I]||(P.d.ShadersStoreWGSL[I]=v);(0,Y.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(o,H){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=o,this._engine=H}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var o;return(null===(o=this._updateComputeShader)||void 0===o?void 0:o.isReady())??!1}createUpdateBuffer(o){var H;const n={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(n.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(n.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(n.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(n.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(n.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(n.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(n.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new s("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:n,defines:o.split("\n")}),null===(H=this._simParamsComputeShader)||void 0===H||H.dispose(),this._simParamsComputeShader=new U.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new m(this._simParamsComputeShader)}createVertexBuffers(o,H){this._renderVertexBuffers.push(H)}createParticleBuffer(o){const H=new K(this._engine,4*o.length,11,"ComputeShaderParticleSystemBuffer");return H.update(o),this._bufferComputeShader.push(H),H.getBuffer()}bindDrawBuffers(o,H,n){this._engine.bindBuffers(this._renderVertexBuffers[o],n,H)}preUpdateParticleBuffer(){}updateParticleBuffer(o,H,n){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[o]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^o]),this._updateComputeShader.dispatch(Math.ceil(n/64))}releaseBuffers(){var o;for(let H=0;H<this._bufferComputeShader.length;++H)this._bufferComputeShader[H].dispose();this._bufferComputeShader.length=0,null===(o=this._simParamsComputeShader)||void 0===o||o.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class w{constructor(o,H,n){this.gradient=o,this.color1=H,this.color2=n}getColorToRef(o){this.color2?O.d.LerpToRef(this.color1,this.color2,Math.random(),o):o.S(this.color1)}}class r{constructor(o,H){this.gradient=o,this.color=H}}class u{constructor(o,H,n){this.gradient=o,this.factor1=H,this.factor2=n}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class d{static GetCurrentGradient(o,H,n){if(H[0].gradient>o)return void n(H[0],H[0],1);for(let k=0;k<H.length-1;k++){const E=H[k],g=H[k+1];if(o>=E.gradient&&o<=g.gradient){return void n(E,g,(o-E.gradient)/(g.gradient-E.gradient))}}const E=H.length-1;n(H[E],H[E],1)}}var R=n(11026),W=n(11680),i=n(11060);class L{constructor(o){this.particleSystem=o,this.position=E.xH.Zero(),this.direction=E.xH.Zero(),this.color=new O.d(0,0,0,0),this.colorStep=new O.d(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new E.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new O.d(0,0,0,0),this._currentColor2=new O.d(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=L._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let o=this.age,H=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===H?(H=1,o=this._randomCellOffset):o+=this._randomCellOffset);const n=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let E;E=this._initialSpriteCellLoop?(0,S.Clamp)(o*H%this.lifeTime/this.lifeTime):(0,S.Clamp)(o*H/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+E*n|0}_inheritParticleInfoToSubEmitter(o){if(o.particleSystem.i.position){const H=o.particleSystem.i;if(H.position.S(this.position),o.inheritDirection){const o=E.TmpVectors.xH[0];this.direction.normalizeToRef(o),H.setDirection(o,0,Math.PI/2)}}else{o.particleSystem.i.S(this.position)}this.direction.scaleToRef(o.inheritedVelocityAmount/2,E.TmpVectors.xH[0]),o.particleSystem._inheritedVelocityOffset.S(E.TmpVectors.xH[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const o of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(o)}_reset(){this.age=0,this.id=L._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(o){o.position.S(this.position),this._initialDirection?o._initialDirection?o._initialDirection.S(this._initialDirection):o._initialDirection=this._initialDirection.clone():o._initialDirection=null,o.direction.S(this.direction),this.tY&&(o.tY?o.tY.S(this.tY):o.tY=this.tY.clone()),o.color.S(this.color),o.colorStep.S(this.colorStep),o.lifeTime=this.lifeTime,o.age=this.age,o._randomCellOffset=this._randomCellOffset,o.size=this.size,o.scale.S(this.scale),o.angle=this.angle,o.angularSpeed=this.angularSpeed,o.particleSystem=this.particleSystem,o.cellIndex=this.cellIndex,o.id=this.id,o._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(o._currentColorGradient=this._currentColorGradient,o._currentColor1.S(this._currentColor1),o._currentColor2.S(this._currentColor2)),this._currentSizeGradient&&(o._currentSizeGradient=this._currentSizeGradient,o._currentSize1=this._currentSize1,o._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(o._currentAngularSpeedGradient=this._currentAngularSpeedGradient,o._currentAngularSpeed1=this._currentAngularSpeed1,o._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(o._currentVelocityGradient=this._currentVelocityGradient,o._currentVelocity1=this._currentVelocity1,o._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(o._currentLimitVelocityGradient=this._currentLimitVelocityGradient,o._currentLimitVelocity1=this._currentLimitVelocity1,o._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(o._currentDragGradient=this._currentDragGradient,o._currentDrag1=this._currentDrag1,o._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(o._initialStartSpriteCellId=this._initialStartSpriteCellId,o._initialEndSpriteCellId=this._initialEndSpriteCellId,o._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(o.remapData&&this.remapData?o.remapData.S(this.remapData):o.remapData=new E.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(o._randomNoiseCoordinates1?(o._randomNoiseCoordinates1.S(this._randomNoiseCoordinates1),o._randomNoiseCoordinates2.S(this._randomNoiseCoordinates2)):(o._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),o._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}L._Count=0;var oo=n(11310),Ho=(n(11359),n(11565)),no=n(11562),Eo=n(11452);function ko(o,H){const n=(0,S.RandomRange)(0,1);O.d.LerpToRef(H.color1,H.color2,n,o.color),H.colorDead.subtractToRef(o.color,H._colorDiff),H._colorDiff.scaleToRef(1/o.lifeTime,o.colorStep)}function go(o,H){o._currentColorGradient=H._colorGradients[0],o._currentColorGradient.getColorToRef(o.color),o._currentColor1.S(o.color),H._colorGradients.length>1?H._colorGradients[1].getColorToRef(o._currentColor2):o._currentColor2.S(o.color)}function Oo(o,H){const n=H._colorGradients;d.GetCurrentGradient(H._ratio,n,((H,n,E)=>{H!==o._currentColorGradient&&(o._currentColor1.S(o._currentColor2),n.getColorToRef(o._currentColor2),o._currentColorGradient=H),O.d.LerpToRef(o._currentColor1,o._currentColor2,E,o.color)}))}function Yo(o,H){o.colorStep.scaleToRef(H._scaledUpdateSpeed,H._scaledColorStep),o.color.addInPlace(H._scaledColorStep),o.color.a<0&&(o.color.a=0)}function yo(o,H){d.GetCurrentGradient(H._ratio,H._angularSpeedGradients,((H,n,E)=>{H!==o._currentAngularSpeedGradient&&(o._currentAngularSpeed1=o._currentAngularSpeed2,o._currentAngularSpeed2=n.getFactor(),o._currentAngularSpeedGradient=H),o.angularSpeed=(0,S.Lerp)(o._currentAngularSpeed1,o._currentAngularSpeed2,E)}))}function So(o,H){o.angle+=o.angularSpeed*H._scaledUpdateSpeed}function Go(o,H){H.particleEmitterType.startDirectionFunction(H._emitterWorldMatrix,o.direction,o,H.isLocal,H._emitterInverseWorldMatrix)}function co(o,H){H.startDirectionFunction(H._emitterWorldMatrix,o.direction,o,H.isLocal)}function Ao(o,H){o._currentVelocityGradient=H._velocityGradients[0],o._currentVelocity1=o._currentVelocityGradient.getFactor(),H._velocityGradients.length>1?o._currentVelocity2=H._velocityGradients[1].getFactor():o._currentVelocity2=o._currentVelocity1}function lo(o,H){o._currentLimitVelocityGradient=H._limitVelocityGradients[0],o._currentLimitVelocity1=o._currentLimitVelocityGradient.getFactor(),H._limitVelocityGradients.length>1?o._currentLimitVelocity2=H._limitVelocityGradients[1].getFactor():o._currentLimitVelocity2=o._currentLimitVelocity1}function xo(o,H){d.GetCurrentGradient(H._ratio,H._velocityGradients,((n,E,k)=>{n!==o._currentVelocityGradient&&(o._currentVelocity1=o._currentVelocity2,o._currentVelocity2=E.getFactor(),o._currentVelocityGradient=n),H._directionScale*=(0,S.Lerp)(o._currentVelocity1,o._currentVelocity2,k)}))}function zo(o,H){d.GetCurrentGradient(H._ratio,H._limitVelocityGradients,((n,E,k)=>{n!==o._currentLimitVelocityGradient&&(o._currentLimitVelocity1=o._currentLimitVelocity2,o._currentLimitVelocity2=E.getFactor(),o._currentLimitVelocityGradient=n);const g=(0,S.Lerp)(o._currentLimitVelocity1,o._currentLimitVelocity2,k);o.direction.length()>g&&o.direction.scaleInPlace(H.limitVelocityDamping)}))}function Vo(o,H){o.direction.scaleToRef(H._directionScale,H._scaledDirection)}function Jo(o,H){H.particleEmitterType.startPositionFunction(H._emitterWorldMatrix,o.position,o,H.isLocal)}function No(o,H){H.startPositionFunction(H._emitterWorldMatrix,o.position,o,H.isLocal)}function ho(o,H){o.tY?o.tY.S(o.position):o.tY=o.position.clone(),E.xH.TransformCoordinatesToRef(o.tY,H._emitterWorldMatrix,o.position)}function Qo(o,H){H.isLocal&&o.tY?(o.tY.addInPlace(H._scaledDirection),E.xH.TransformCoordinatesToRef(o.tY,H._emitterWorldMatrix,o.position)):o.position.addInPlace(H._scaledDirection)}function po(o,H){o._currentDragGradient=H._dragGradients[0],o._currentDrag1=o._currentDragGradient.getFactor(),H._dragGradients.length>1?o._currentDrag2=H._dragGradients[1].getFactor():o._currentDrag2=o._currentDrag1}function jo(o,H){d.GetCurrentGradient(H._ratio,H._dragGradients,((n,E,k)=>{n!==o._currentDragGradient&&(o._currentDrag1=o._currentDrag2,o._currentDrag2=E.getFactor(),o._currentDragGradient=n);const g=(0,S.Lerp)(o._currentDrag1,o._currentDrag2,k);H._scaledDirection.scaleInPlace(1-g)}))}function mo(o,H){o._randomNoiseCoordinates1?(o._randomNoiseCoordinates1.Wg(Math.random(),Math.random(),Math.random()),o._randomNoiseCoordinates2.Wg(Math.random(),Math.random(),Math.random())):(o._randomNoiseCoordinates1=new E.xH(Math.random(),Math.random(),Math.random()),o._randomNoiseCoordinates2=new E.xH(Math.random(),Math.random(),Math.random()))}function Po(o,H){const n=H._noiseTextureData,k=H._noiseTextureSize;if(n&&k&&o._randomNoiseCoordinates1){const g=H._fetchR(o._randomNoiseCoordinates1.x,o._randomNoiseCoordinates1.y,k.width,k.height,n),O=H._fetchR(o._randomNoiseCoordinates1.z,o._randomNoiseCoordinates2.x,k.width,k.height,n),Y=H._fetchR(o._randomNoiseCoordinates2.y,o._randomNoiseCoordinates2.z,k.width,k.height,n),y=E.TmpVectors.xH[0],S=E.TmpVectors.xH[1];y.Wg((2*g-1)*H.noiseStrength.x,(2*O-1)*H.noiseStrength.y,(2*Y-1)*H.noiseStrength.z),y.scaleToRef(H._tempScaledUpdateSpeed,S),o.direction.addInPlace(S)}}function bo(o,H){H.gravity.scaleToRef(H._tempScaledUpdateSpeed,H._scaledGravity),o.direction.addInPlace(H._scaledGravity)}function eo(o,H){o.size=(0,S.RandomRange)(H.minSize,H.maxSize),o.scale.Wg((0,S.RandomRange)(H.minScaleX,H.maxScaleX),(0,S.RandomRange)(H.minScaleY,H.maxScaleY))}function Zo(o,H){o._currentSizeGradient=H._sizeGradients[0],o._currentSize1=o._currentSizeGradient.getFactor(),o.size=o._currentSize1,H._sizeGradients.length>1?o._currentSize2=H._sizeGradients[1].getFactor():o._currentSize2=o._currentSize1,o.scale.Wg((0,S.RandomRange)(H.minScaleX,H.maxScaleX),(0,S.RandomRange)(H.minScaleY,H.maxScaleY))}function Mo(o,H){const n=H._actualFrame/H.targetStopDuration;d.GetCurrentGradient(n,H._startSizeGradients,((n,E,k)=>{n!==H._currentStartSizeGradient&&(H._currentStartSize1=H._currentStartSize2,H._currentStartSize2=E.getFactor(),H._currentStartSizeGradient=n);const g=(0,S.Lerp)(H._currentStartSize1,H._currentStartSize2,k);o.scale.scaleInPlace(g)}))}function Ko(o,H){d.GetCurrentGradient(H._ratio,H._sizeGradients,((H,n,E)=>{H!==o._currentSizeGradient&&(o._currentSize1=o._currentSize2,o._currentSize2=n.getFactor(),o._currentSizeGradient=H),o.size=(0,S.Lerp)(o._currentSize1,o._currentSize2,E)}))}function fo(o,H){o.remapData=new E.Vector4(0,1,0,1)}function Bo(o,H){H._colorRemapGradients&&H._colorRemapGradients.length>0&&d.GetCurrentGradient(H._ratio,H._colorRemapGradients,((H,n,E)=>{const k=(0,S.Lerp)(H.factor1,n.factor1,E),g=(0,S.Lerp)(H.factor2,n.factor2,E);o.remapData.x=k,o.remapData.y=g-k})),H._alphaRemapGradients&&H._alphaRemapGradients.length>0&&d.GetCurrentGradient(H._ratio,H._alphaRemapGradients,((H,n,E)=>{const k=(0,S.Lerp)(H.factor1,n.factor1,E),g=(0,S.Lerp)(H.factor2,n.factor2,E);o.remapData.z=k,o.remapData.w=g-k}))}function qo(o,H){const n=(0,S.Clamp)(H._actualFrame/H.targetStopDuration);d.GetCurrentGradient(n,H._lifeTimeGradients,((H,E)=>{const k=H,g=E,O=k.getFactor(),Y=g.getFactor(),y=(n-k.gradient)/(g.gradient-k.gradient);o.lifeTime=(0,S.Lerp)(O,Y,y)})),H._emitPower=(0,S.RandomRange)(H.minEmitPower,H.maxEmitPower)}function Do(o,H){o.lifeTime=(0,S.RandomRange)(H.minLifeTime,H.maxLifeTime),H._emitPower=(0,S.RandomRange)(H.minEmitPower,H.maxEmitPower)}function To(o,H){0===H._emitPower?(o._initialDirection?o._initialDirection.S(o.direction):o._initialDirection=o.direction.clone(),o.direction.set(0,0,0)):(o._initialDirection=null,o.direction.scaleInPlace(H._emitPower)),o.direction.addInPlace(H._inheritedVelocityOffset)}function ao(o,H){o.angularSpeed=(0,S.RandomRange)(H.minAngularSpeed,H.maxAngularSpeed),o.angle=(0,S.RandomRange)(H.minInitialRotation,H.maxInitialRotation)}function Fo(o,H){o._currentAngularSpeedGradient=H._angularSpeedGradients[0],o.angularSpeed=o._currentAngularSpeedGradient.getFactor(),o._currentAngularSpeed1=o.angularSpeed,H._angularSpeedGradients.length>1?o._currentAngularSpeed2=H._angularSpeedGradients[1].getFactor():o._currentAngularSpeed2=o._currentAngularSpeed1,o.angle=(0,S.RandomRange)(H.minInitialRotation,H.maxInitialRotation)}function Co(o,H){o._initialStartSpriteCellId=H.startSpriteCellID,o._initialEndSpriteCellId=H.endSpriteCellID,o._initialSpriteCellLoop=H.spriteCellLoop}function to(o,H){o.previousItem=H.previousItem,o.nextItem=H,H.previousItem&&(H.previousItem.nextItem=o),H.previousItem=o}function Xo(o,H){o.previousItem=H,o.nextItem=H.nextItem,H.nextItem&&(H.nextItem.previousItem=o),H.nextItem=o}function so(o,H){let n=H;for(;n.nextItem;)n=n.nextItem;o.previousItem=n,o.nextItem=n.nextItem,n.nextItem=o}function Uo(o){o.previousItem&&(o.previousItem.nextItem=o.nextItem),o.nextItem&&(o.nextItem.previousItem=o.previousItem)}class Io extends y{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(o){this._startDirectionFunction!==o&&(this._startDirectionFunction=o,this._directionProcessing.process=o?co:Go)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(o){this._startPositionFunction!==o&&(this._startPositionFunction=o,this._positionCreation.process=o?No:Jo)}set onDispose(o){this._onDisposeObserver&&this.yg.remove(this._onDisposeObserver),this._onDisposeObserver=this.yg.add(o)}get l(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(o){this._useRampGradients!==o&&(this._useRampGradients=o,this._resetEffect(),o?(this._rampCreation={process:fo,previousItem:null,nextItem:null},Xo(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Bo,previousItem:null,nextItem:null},Xo(this._remapGradientProcessing,this._gravityProcessing)):(Uo(this._rampCreation),Uo(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(o){this._isLocal!==o&&(this._isLocal=o,o?(this._isLocalCreation={process:ho,previousItem:null,nextItem:null},Xo(this._isLocalCreation,this._positionCreation)):Uo(this._isLocalCreation))}get particles(){return this.PA}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(o){this._animationSheetEnabled!==o&&(this._animationSheetEnabled=o,o?(this._sheetCreation={process:Co,previousItem:null,nextItem:null},Xo(this._sheetCreation,this._colorCreation)):Uo(this._sheetCreation),this._reset())}getActiveCount(){return this.PA.length}getClassName(){return"ny"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var o;let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(o=this._customWrappers[H])||void 0===o?void 0:o.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[o]??this._customWrappers[0]}setCustomEffect(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[H]=new oo.c(this._engine),this._customWrappers[H].effect=o,this._customWrappers[H].drawContext&&(this._customWrappers[H].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new R.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(o){if(this.noiseTexture!==o){if(this._noiseTexture=o,!o)return Uo(this._noiseCreation),void Uo(this._noiseProcessing);this._noiseCreation={process:mo,previousItem:null,nextItem:null},Xo(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Po,previousItem:null,nextItem:null},Xo(this._noiseProcessing,this._positionProcessing)}}constructor(o,H,n){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(o),this._emitterInverseWorldMatrix=E.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new E.xH,this.yg=new R.d,this.onStoppedObservable=new R.d,this.onStartedObservable=new R.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.PA=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new O.d(0,0,0,0),this._colorDiff=new O.d(0,0,0,0),this._scaledDirection=E.xH.Zero(),this._scaledGravity=E.xH.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=o=>{},this.recycleParticle=o=>{const H=this.PA.pop();H!==o&&H.copyTo(o),this._stockParticles.push(H)},this._createParticle=()=>{let o;return 0!==this._stockParticles.length?(o=this._stockParticles.pop(),o._reset()):o=new L(this),this._prepareParticle(o),o},this.paused=!1,this._shadersLoaded=!1,this._capacity=H,this._epsilon=Y,n&&"Scene"!==n.getClassName()?(this._engine=n,this.defaultProjectionMatrix=E.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=n||i.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.jA.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:Do,previousItem:null,nextItem:null},this._positionCreation={process:Jo,previousItem:null,nextItem:null},Xo(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:Go,previousItem:null,nextItem:null},Xo(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:To,previousItem:null,nextItem:null},Xo(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:eo,previousItem:null,nextItem:null},Xo(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:ao,previousItem:null,nextItem:null},Xo(this._angleCreation,this._sizeCreation),this._colorCreation={process:ko,previousItem:null,nextItem:null},Xo(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,y||(this._colorProcessing={process:Yo,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:So,previousItem:null,nextItem:null},Xo(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Vo,previousItem:null,nextItem:null},Xo(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Qo,previousItem:null,nextItem:null},Xo(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:bo,previousItem:null,nextItem:null},Xo(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=g,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new oo.c(this._engine)},this._customWrappers[0].effect=k,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new c,this.updateFunction=o=>{var H;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(H=this.noiseTexture.getContent())||void 0===H||H.then((o=>{this._noiseTextureData=o})));const n=o===this.PA;for(let E=0;E<o.length;E++){const H=o[E];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const k=H.age;if(H.age+=this._tempScaledUpdateSpeed,H.age>H.lifeTime){const o=H.age-k,n=H.lifeTime-k;this._tempScaledUpdateSpeed=n*this._tempScaledUpdateSpeed/o,H.age=H.lifeTime}this._ratio=H.age/H.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let g=this._updateQueueStart;for(;g;)g.process(H,this),g=g.nextItem;if(this._isAnimationSheetEnabled&&!y&&H.updateCellIndex(),H._inheritParticleInfoToSubEmitters(),H.age>=H.lifeTime){if(this._emitFromParticle(H),H._attachedSubEmitters){for(const o of H._attachedSubEmitters)o.particleSystem.disposeOnStop=!0,o.particleSystem.stop();H._attachedSubEmitters=null}this.recycleParticle(H),n&&E--}else;}}}serialize(o){throw new Error("Method not implemented.")}clone(o,H){throw new Error("Method not implemented.")}_addFactorGradient(o,H,n,E){const k=new u(H,n,E);o.push(k),o.sort(((o,H)=>o.gradient<H.gradient?-1:o.gradient>H.gradient?1:0))}_removeFactorGradient(o,H){if(!o)return;let n=0;for(const E of o){if(E.gradient===H){o.splice(n,1);break}n++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=qo:this._lifeTimeCreation.process=Do}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Mo,previousItem:null,nextItem:null},Xo(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Uo(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(o){this.targetStopDuration!==o&&(this._targetStopDuration=o,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(o,H,n){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,o,H,n),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(o){return this._removeFactorGradient(this._lifeTimeGradients,o),this._syncLifeTimeCreation(),this}addSizeGradient(o,H,n){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Zo,this._sizeGradientProcessing={process:Ko,previousItem:null,nextItem:null},to(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,o,H,n),this}removeSizeGradient(o){var H;return this._removeFactorGradient(this._sizeGradients,o),0===(null===(H=this._sizeGradients)||void 0===H?void 0:H.length)&&(Uo(this._sizeGradientProcessing),this._sizeCreation.process=eo),this}addColorRemapGradient(o,H,n){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,o,H,n),this}removeColorRemapGradient(o){return this._removeFactorGradient(this._colorRemapGradients,o),this}addAlphaRemapGradient(o,H,n){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,o,H,n),this}removeAlphaRemapGradient(o){return this._removeFactorGradient(this._alphaRemapGradients,o),this}addAngularSpeedGradient(o,H,n){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Fo,this._angularSpeedGradientProcessing={process:yo,previousItem:null,nextItem:null},to(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,o,H,n),this}removeAngularSpeedGradient(o){var H;return this._removeFactorGradient(this._angularSpeedGradients,o),0===(null===(H=this._angularSpeedGradients)||void 0===H?void 0:H.length)&&(this._angleCreation.process=ao,Uo(this._angularSpeedGradientProcessing)),this}addVelocityGradient(o,H,n){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Ao,previousItem:null,nextItem:null},Xo(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:xo,previousItem:null,nextItem:null},to(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,o,H,n),this}removeVelocityGradient(o){var H;return this._removeFactorGradient(this._velocityGradients,o),0===(null===(H=this._velocityGradients)||void 0===H?void 0:H.length)&&(Uo(this._velocityCreation),Uo(this._velocityGradientProcessing)),this}addLimitVelocityGradient(o,H,n){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:lo,previousItem:null,nextItem:null},Xo(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:zo,previousItem:null,nextItem:null},Xo(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,o,H,n),this}removeLimitVelocityGradient(o){var H;return this._removeFactorGradient(this._limitVelocityGradients,o),0===(null===(H=this._limitVelocityGradients)||void 0===H?void 0:H.length)&&(Uo(this._limitVelocityCreation),Uo(this._limitVelocityGradientProcessing)),this}addDragGradient(o,H,n){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:po,previousItem:null,nextItem:null},to(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:jo,previousItem:null,nextItem:null},to(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,o,H,n),this}removeDragGradient(o){var H;return this._removeFactorGradient(this._dragGradients,o),0===(null===(H=this._dragGradients)||void 0===H?void 0:H.length)&&(Uo(this._dragCreation),Uo(this._dragGradientProcessing)),this}addEmitRateGradient(o,H,n){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,o,H,n),this}removeEmitRateGradient(o){return this._removeFactorGradient(this._emitRateGradients,o),this}addStartSizeGradient(o,H,n){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,o,H,n),this._syncStartSizeCreation(),this}removeStartSizeGradient(o){return this._removeFactorGradient(this._startSizeGradients,o),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const o=new Uint8Array(4*this._rawTextureWidth),H=O.g.NH[0];for(let n=0;n<this._rawTextureWidth;n++){const E=n/this._rawTextureWidth;d.GetCurrentGradient(E,this._rampGradients,((E,k,g)=>{O.NH.LerpToRef(E.color,k.color,g,H),o[4*n]=255*H.r,o[4*n+1]=255*H.g,o[4*n+2]=255*H.b,o[4*n+3]=255}))}this._rampGradientsTexture=W.b.CreateRGBATexture(o,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((o,H)=>o.gradient<H.gradient?-1:o.gradient>H.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(o,H){this._rampGradients||(this._rampGradients=[]);const n=new r(o,H);return this._rampGradients.push(n),this._syncRampGradientTexture(),this}removeRampGradient(o){return this._removeGradientAndTexture(o,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(o,H,n){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=go,this._colorProcessing.process=Oo);const E=new w(o,H,n);return this._colorGradients.push(E),this._colorGradients.sort(((o,H)=>o.gradient<H.gradient?-1:o.gradient>H.gradient?1:0)),this}removeColorGradient(o){if(!this._colorGradients)return this;let H=0;for(const n of this._colorGradients){if(n.gradient===o){this._colorGradients.splice(H,1);break}H++}return 0===this._colorGradients.length&&(this._colorCreation.process=ko,this._colorProcessing.process=Yo),this}resetDrawCache(){if(this._drawWrappers){for(const o of this._drawWrappers)if(o)for(const H of o)null===H||void 0===H||H.dispose();this._drawWrappers=[]}}_fetchR(o,H,n,E,k){return k[4*(((o=.5*Math.abs(o)+.5)*n%n|0)+((H=.5*Math.abs(H)+.5)*E%E|0)*n)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const o=this._engine,H=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*H),this._vertexBuffer=new p.c(o,this._vertexData,!0,H);let n=0;const E=this._vertexBuffer.createVertexBuffer(p.d.PositionKind,n,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[p.d.PositionKind]=E,n+=3;const k=this._vertexBuffer.createVertexBuffer(p.d.ColorKind,n,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[p.d.ColorKind]=k,n+=4;const g=this._vertexBuffer.createVertexBuffer("angle",n,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=g,n+=1;const O=this._vertexBuffer.createVertexBuffer("size",n,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=O,n+=2,this._isAnimationSheetEnabled){const o=this._vertexBuffer.createVertexBuffer("cellIndex",n,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=o,n+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const o=this._vertexBuffer.createVertexBuffer("direction",n,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=o,n+=3}if(this._useRampGradients){const o=this._vertexBuffer.createVertexBuffer("remapData",n,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=o,n+=4}let Y;if(this._useInstancing){const H=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new p.c(o,H,!1,2),Y=this._spriteBuffer.createVertexBuffer("offset",0,2)}else Y=this._vertexBuffer.createVertexBuffer("offset",n,2,this._vertexBufferSize,this._useInstancing),n+=2;this._vertexBuffers.offset=Y,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const o=[],H=[];let n=0;for(let E=0;E<this._capacity;E++)o.push(n),o.push(n+1),o.push(n+2),o.push(n),o.push(n+2),o.push(n+3),H.push(n,n+1,n+1,n+2,n+2,n+3,n+3,n,n,n+3),n+=4;this._indexBuffer=this._engine.createIndexBuffer(o),this._linesIndexBuffer=this._engine.createIndexBuffer(H)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(o)setTimeout((()=>{this.start(0)}),o);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var H;-1!==(null===(H=this.i)||void 0===H?void 0:H.getClassName().indexOf("Mesh"))&&this.i.Ig(!0);const o=this.noiseTexture;if(o&&o.onGeneratedObservable)o.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let H=0;H<this.preWarmCycles;H++)this.animate(!0),o.render()}))}));else for(let H=0;H<this.preWarmCycles;H++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(o))}_postStop(o){}reset(){this._stockParticles.length=0,this.PA.length=0}_appendParticleVertex(o,H,n,k){let g=o*this._vertexBufferSize;if(this._vertexData[g++]=H.position.x+this.gS.x,this._vertexData[g++]=H.position.y+this.gS.y,this._vertexData[g++]=H.position.z+this.gS.z,this._vertexData[g++]=H.color.r,this._vertexData[g++]=H.color.g,this._vertexData[g++]=H.color.b,this._vertexData[g++]=H.color.a,this._vertexData[g++]=H.angle,this._vertexData[g++]=H.scale.x*H.size,this._vertexData[g++]=H.scale.y*H.size,this._isAnimationSheetEnabled&&(this._vertexData[g++]=H.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[g++]=H.direction.x,this._vertexData[g++]=H.direction.y,this._vertexData[g++]=H.direction.z);else if(H._initialDirection){let o=H._initialDirection;this.isLocal&&(E.xH.TransformNormalToRef(o,this._emitterWorldMatrix,E.TmpVectors.xH[0]),o=E.TmpVectors.xH[0]),0===o.x&&0===o.z&&(o.x=.001),this._vertexData[g++]=o.x,this._vertexData[g++]=o.y,this._vertexData[g++]=o.z}else{let o=H.direction;this.isLocal&&(E.xH.TransformNormalToRef(o,this._emitterWorldMatrix,E.TmpVectors.xH[0]),o=E.TmpVectors.xH[0]),0===o.x&&0===o.z&&(o.x=.001),this._vertexData[g++]=o.x,this._vertexData[g++]=o.y,this._vertexData[g++]=o.z}this._useRampGradients&&H.remapData&&(this._vertexData[g++]=H.remapData.x,this._vertexData[g++]=H.remapData.y,this._vertexData[g++]=H.remapData.z,this._vertexData[g++]=H.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===n?n=this._epsilon:1===n&&(n=1-this._epsilon),0===k?k=this._epsilon:1===k&&(k=1-this._epsilon)),this._vertexData[g++]=n,this._vertexData[g++]=k)}_prepareParticle(o){}_createNewOnes(o){let H;for(let n=0;n<o&&this.PA.length!==this._capacity;n++){H=this._createParticle(),this.PA.push(H);let o=this._createQueueStart;for(;o;)o.process(H,this),o=o.nextItem;H._inheritParticleInfoToSubEmitters()}}_update(o){if(this._alive=this.PA.length>0,this.i.position){const o=this.i;this._emitterWorldMatrix=o.getWorldMatrix()}else{const o=this.i;this._emitterWorldMatrix=E.Matrix.Translation(o.x,o.y,o.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.PA),this._createNewOnes(o)}static _GetAttributeNamesOrOptions(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const E=[p.d.PositionKind,p.d.ColorKind,"angle","offset","size"];return o&&E.push("cellIndex"),H||E.push("direction"),n&&E.push("remapData"),E}static _GetEffectCreationOptions(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const E=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,Ho.e)(E),o&&E.push("particlesInfos"),H&&E.push("logarithmicDepthConstant"),n&&(E.push("vFogInfos"),E.push("vFogColor")),E}fillDefines(o,H){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Ho.n)(this,this._scene,o),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&o.push("#define FOG")),this._isAnimationSheetEnabled&&o.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&o.push("#define LOGARITHMICDEPTH"),H===y.BLENDMODE_MULTIPLY&&o.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&o.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(o.push("#define BILLBOARD"),this.billboardMode){case 2:o.push("#define BILLBOARDY");break;case 8:case 9:o.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&o.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:o.push("#define BILLBOARDMODE_ALL")}n&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),o.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(o,H,n){H.push(...Io._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),o.push(...Io._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),n.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Eo.e)(o,this._imageProcessingConfigurationDefines),(0,Eo.c)(n,this._imageProcessingConfigurationDefines))}_getWrapper(o){const H=this._getCustomDrawWrapper(o);if(null!==H&&void 0!==H&&H.effect)return H;const n=[];this.fillDefines(n,o);const E=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let k=this._drawWrappers[E];k||(k=this._drawWrappers[E]=[]);let g=k[o];g||(g=new oo.c(this._engine),g.drawContext&&(g.drawContext.useInstancing=this._useInstancing),k[o]=g);const O=n.join("\n");if(g.defines!==O){const o=[],H=[],n=[];this.fillUniformsAttributesAndSamplerNames(H,o,n),g.setEffect(this._engine.createEffect("particles",o,H,n,O,void 0,void 0,void 0,void 0,this._shaderLanguage),O)}return g}animate(){var o;let H,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!n&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(n?this.preWarmStepOffset:(null===(o=this._scene)||void 0===o?void 0:o.getAnimationRatio())||1),this.manualEmitCount>-1)H=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let o=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const H=this._actualFrame/this.targetStopDuration;d.GetCurrentGradient(H,this._emitRateGradients,((H,n,E)=>{H!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=n.getFactor(),this._currentEmitRateGradient=H),o=(0,S.Lerp)(this._currentEmitRate1,this._currentEmitRate2,E)}))}H=o*this._scaledUpdateSpeed|0,this._newPartsExcess+=o*this._scaledUpdateSpeed-H}if(this._newPartsExcess>1&&(H+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?H=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(H),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!n){let o=0;for(let H=0;H<this.PA.length;H++){const n=this.PA[H];this._appendParticleVertices(o,n),o+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.PA.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(o,H){this._appendParticleVertex(o++,H,0,0),this._useInstancing||(this._appendParticleVertex(o++,H,1,0),this._appendParticleVertex(o++,H,1,1),this._appendParticleVertex(o++,H,0,1))}rebuild(){var o;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(o=this._spriteBuffer)||void 0===o||o._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Io.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(n.bind(n,12709)),Promise.resolve().then(n.bind(n,12645))])):await Promise.all([Promise.resolve().then(n.bind(n,12632)),Promise.resolve().then(n.bind(n,12624))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.i||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==y.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(y.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(y.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(o){const H=this._getWrapper(o),n=H.effect,k=this._engine;k.enableEffect(H);const g=this.defaultViewMatrix??this._scene.getViewMatrix();if(n.setTexture("diffuseSampler",this.particleTexture),n.setMatrix("view",g),n.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const o=this.particleTexture.getBaseSize();n.setFloat3("particlesInfos",this.spriteCellWidth/o.width,this.spriteCellHeight/o.height,this.spriteCellWidth/o.width)}if(n.setVector2("translationPivot",this.translationPivot),n.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const o=this._scene.activeCamera;n.setVector3("eyePosition",o.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),n.setTexture("rampSampler",this._rampGradientsTexture));const O=n.defines;var Y,y,S,G,c,A;(this._scene&&((0,Ho.i)(n,this,this._scene),this.applyFog&&(0,no.f)(this._scene,void 0,n)),O.indexOf("#define BILLBOARDMODE_ALL")>=0&&(g.invertToRef(E.TmpVectors.Matrix[0]),n.setMatrix("invView",E.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?k.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,n):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,n)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?k.bindBuffers(this._vertexBuffers,null!==(S=this._scene)&&void 0!==S&&S.forceWireframe?this._linesIndexBuffer:this._indexBuffer,n):k.bindBuffers(this._vertexBuffers,null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?this._linesIndexBufferUseInstancing:null,n);(this.useLogarithmicDepth&&this._scene&&(0,no.l)(O,n,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(n),this._setEngineBasedOnBlendMode(o),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(n),this._useInstancing)?null!==(c=this._scene)&&void 0!==c&&c.forceWireframe?k.drawElementsType(6,0,10,this.PA.length):k.drawArraysType(7,0,4,this.PA.length):null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?k.drawElementsType(1,0,10*this.PA.length):k.drawElementsType(0,0,6*this.PA.length);return this.PA.length}render(){if(!this.isReady()||!this.PA.length)return 0;const o=this._engine;o.setState&&(o.setState(!1),this.forceDepthWrite&&o.setDepthWrite(!0));let H=0;return H=this.blendMode===y.BLENDMODE_MULTIPLYADD?this._render(y.BLENDMODE_MULTIPLY)+this._render(y.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),H}_onDispose(){}dispose(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),o&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),o&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(H,n),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const o=this._scene.jA.indexOf(this);o>-1&&this._scene.jA.splice(o,1),this._scene._activeParticleSystems.dispose()}this.yg.notifyObservers(this),this.yg.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Io.ForceGLSL=!1;var vo,wo=n(11051);!function(o){o[o.ATTACHED=0]="ATTACHED",o[o.END=1]="END"}(vo||(vo={}));class ro{constructor(o){if(this.particleSystem=o,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!o.i||!o.i.dispose){const H=(0,Y.b)("BABYLON.AbstractMesh");o.i=new H("SubemitterSystemEmitter",o.bo()),o._disposeEmitterOnDispose=!0}}clone(){let o=this.particleSystem.i;if(o){if(o instanceof E.xH)o=o.clone();else if(-1!==o.getClassName().indexOf("Mesh")){o=new((0,Y.b)("BABYLON.Mesh"))("",o.bo()),o.isVisible=!1}}else o=new E.xH;const H=new ro(this.particleSystem.clone(this.particleSystem.name,o));return H.particleSystem.name+="Clone",H.type=this.type,H.inheritDirection=this.inheritDirection,H.inheritedVelocityAmount=this.inheritedVelocityAmount,H.particleSystem._disposeEmitterOnDispose=!0,H.particleSystem.disposeOnStop=!0,H}serialize(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H={};return H.type=this.type,H.inheritDirection=this.inheritDirection,H.inheritedVelocityAmount=this.inheritedVelocityAmount,H.particleSystem=this.particleSystem.serialize(o),H}static _ParseParticleSystem(o,H,n){throw(0,wo.c)("ParseParticle")}static Parse(o,H,n){const E=o.particleSystem,k=new ro(ro._ParseParticleSystem(E,H,n,!0));return k.type=o.type,k.inheritDirection=o.inheritDirection,k.inheritedVelocityAmount=o.inheritedVelocityAmount,k.particleSystem._isSubEmitter=!0,k}dispose(){this.particleSystem.dispose()}}var uo=n(11093);function Ro(o,H){const n=new J;return n.direction1=o,n.direction2=H,n}function Wo(){return new V(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function io(){return new N(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Lo(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new E.xH(0,1,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new E.xH(0,1,0);return new h(o,H,n)}function oH(){return new x(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function HH(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new E.xH(0,1,0),g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new E.xH(0,1,0);return new z(o,H,n,k,g)}function nH(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new A(o,H)}function EH(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new E.xH(0,1,0),k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new E.xH(0,1,0);return new l(o,H,n,k)}const kH=E.xH.Zero(),gH=E.xH.Zero(),OH=E.xH.Zero();class YH{constructor(){this.strength=0,this.position=E.xH.Zero()}_processParticle(o,H){this.position.subtractToRef(o.position,kH);const n=kH.lengthSquared()+1;kH.normalize().scaleToRef(this.strength/n,gH),gH.scaleToRef(H._tempScaledUpdateSpeed,OH),o.direction.addInPlace(OH)}serialize(){return{position:this.position.bg(),strength:this.strength}}}class yH extends Io{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=o=>{if(!this._subEmitters||0===this._subEmitters.length)return;const H=Math.floor(Math.random()*this._subEmitters.length);for(const n of this._subEmitters[H])if(1===n.type){const H=n.clone();o._inheritParticleInfoToSubEmitter(H),H.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(H.particleSystem),H.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(o,H){const n=Ro(o,H);return this.particleEmitterType=n,n}get flowMap(){return this._flowMap}set flowMap(o){this._flowMap!==o&&(this._flowMap=o,this._flowMapUpdate&&(Uo(this._flowMapUpdate),this._flowMapUpdate=null),o&&(this._flowMapUpdate={process:o=>{var H;const n=null===(H=this.bo())||void 0===H?void 0:H.getTransformMatrix();this._flowMap._processParticle(o,this.flowMapStrength*this._tempScaledUpdateSpeed,n)},previousItem:null,nextItem:null},Xo(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(o){this._attractors.push(o),1===this._attractors.length&&(this._attractorUpdate={process:o=>{for(const H of this._attractors)H._processParticle(o,this)},previousItem:null,nextItem:null},Xo(this._attractorUpdate,this._directionProcessing))}removeAttractor(o){const H=this._attractors.indexOf(o);-1!==H&&this._attractors.splice(H,1),0===this._attractors.length&&Uo(this._attractorUpdate)}start(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(o)}createHemisphericEmitter(){const o=Wo(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=o,o}createSphereEmitter(){const o=io(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=o,o}createDirectedSphereEmitter(){const o=Lo(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new E.xH(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new E.xH(0,1,0));return this.particleEmitterType=o,o}createCylinderEmitter(){const o=oH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=o,o}createDirectedCylinderEmitter(){const o=HH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new E.xH(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new E.xH(0,1,0));return this.particleEmitterType=o,o}createConeEmitter(){const o=nH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=o,o}createDirectedConeEmitter(){const o=EH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new E.xH(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new E.xH(0,1,0));return this.particleEmitterType=o,o}createBoxEmitter(o,H,n,E){const k=new c;return this.particleEmitterType=k,this.direction1=o,this.direction2=H,this.minEmitBox=n,this.maxEmitBox=E,k}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const o of this.subEmitters)o instanceof yH?this._subEmitters.push([new ro(o)]):o instanceof ro?this._subEmitters.push([o]):o instanceof Array&&this._subEmitters.push(o)}_stopSubEmitters(){if(this.activeSubSystems){for(const o of this.activeSubSystems)o.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const o=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==o&&this._rootParticleSystem.activeSubSystems.splice(o,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(o){o&&this._stopSubEmitters()}_prepareParticle(o){if(this._subEmitters&&this._subEmitters.length>0){const H=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];o._attachedSubEmitters=[];for(const n of H)if(0===n.type){const H=n.clone();o._attachedSubEmitters.push(H),H.particleSystem.start()}}}_onDispose(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),o&&this.particles)for(const n of this.particles)if(n._attachedSubEmitters)for(let o=n._attachedSubEmitters.length-1;o>=0;o-=1)n._attachedSubEmitters[o].dispose();if(H&&this.activeSubSystems)for(let n=this.activeSubSystems.length-1;n>=0;n-=1)this.activeSubSystems[n].dispose();if(this._subEmitters&&this._subEmitters.length){for(let o=0;o<this._subEmitters.length;o++)for(const H of this._subEmitters[o])H.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.i&&this.i.dispose&&this.i.dispose(!0)}static _Parse(o,H,n,k){let g;g=n instanceof uo.e?null:n;const y=(0,Y.b)("BABYLON.Texture");if(y&&g&&(o.texture?H.particleTexture=y.Parse(o.texture,g,k):o.textureName&&(H.particleTexture=new y(k+o.textureName,g,!1,void 0===o.invertY||o.invertY),H.particleTexture.name=o.textureName)),o.emitterId||0===o.emitterId||void 0!==o.i?o.emitterId&&g?H.i=g.getLastMeshById(o.emitterId):H.i=E.xH.Mg(o.i):H.i=E.xH.Zero(),H.isLocal=!!o.isLocal,void 0!==o.renderingGroupId&&(H.renderingGroupId=o.renderingGroupId),void 0!==o.isBillboardBased&&(H.isBillboardBased=o.isBillboardBased),void 0!==o.billboardMode&&(H.billboardMode=o.billboardMode),void 0!==o.useLogarithmicDepth&&(H.useLogarithmicDepth=o.useLogarithmicDepth),o.animations){for(let n=0;n<o.animations.length;n++){const E=o.animations[n],k=(0,Y.b)("BABYLON.Animation");k&&H.animations.push(k.Parse(E))}H.beginAnimationOnStart=o.beginAnimationOnStart,H.beginAnimationFrom=o.beginAnimationFrom,H.beginAnimationTo=o.beginAnimationTo,H.beginAnimationLoop=o.beginAnimationLoop}if(o.autoAnimate&&g&&g.beginAnimation(H,o.autoAnimateFrom,o.autoAnimateTo,o.autoAnimateLoop,o.autoAnimateSpeed||1),H.startDelay=0|o.startDelay,H.minAngularSpeed=o.minAngularSpeed,H.maxAngularSpeed=o.maxAngularSpeed,H.minSize=o.minSize,H.maxSize=o.maxSize,o.minScaleX&&(H.minScaleX=o.minScaleX,H.maxScaleX=o.maxScaleX,H.minScaleY=o.minScaleY,H.maxScaleY=o.maxScaleY),void 0!==o.preWarmCycles&&(H.preWarmCycles=o.preWarmCycles,H.preWarmStepOffset=o.preWarmStepOffset),void 0!==o.minInitialRotation&&(H.minInitialRotation=o.minInitialRotation,H.maxInitialRotation=o.maxInitialRotation),H.minLifeTime=o.minLifeTime,H.maxLifeTime=o.maxLifeTime,H.minEmitPower=o.minEmitPower,H.maxEmitPower=o.maxEmitPower,H.emitRate=o.emitRate,H.gravity=E.xH.Mg(o.gravity),o.noiseStrength&&(H.noiseStrength=E.xH.Mg(o.noiseStrength)),H.color1=O.d.Mg(o.color1),H.color2=O.d.Mg(o.color2),H.colorDead=O.d.Mg(o.colorDead),H.updateSpeed=o.updateSpeed,H.targetStopDuration=o.targetStopDuration,H.blendMode=o.blendMode,o.colorGradients)for(const E of o.colorGradients)H.addColorGradient(E.gradient,O.d.Mg(E.color1),E.color2?O.d.Mg(E.color2):void 0);if(o.rampGradients){for(const n of o.rampGradients)H.addRampGradient(n.gradient,O.NH.Mg(n.color));H.useRampGradients=o.useRampGradients}if(o.colorRemapGradients)for(const E of o.colorRemapGradients)H.addColorRemapGradient(E.gradient,void 0!==E.factor1?E.factor1:E.factor,E.factor2);if(o.alphaRemapGradients)for(const E of o.alphaRemapGradients)H.addAlphaRemapGradient(E.gradient,void 0!==E.factor1?E.factor1:E.factor,E.factor2);if(o.sizeGradients)for(const E of o.sizeGradients)H.addSizeGradient(E.gradient,void 0!==E.factor1?E.factor1:E.factor,E.factor2);if(o.angularSpeedGradients)for(const E of o.angularSpeedGradients)H.addAngularSpeedGradient(E.gradient,void 0!==E.factor1?E.factor1:E.factor,E.factor2);if(o.velocityGradients)for(const E of o.velocityGradients)H.addVelocityGradient(E.gradient,void 0!==E.factor1?E.factor1:E.factor,E.factor2);if(o.dragGradients)for(const E of o.dragGradients)H.addDragGradient(E.gradient,void 0!==E.factor1?E.factor1:E.factor,E.factor2);if(o.emitRateGradients)for(const E of o.emitRateGradients)H.addEmitRateGradient(E.gradient,void 0!==E.factor1?E.factor1:E.factor,E.factor2);if(o.startSizeGradients)for(const E of o.startSizeGradients)H.addStartSizeGradient(E.gradient,void 0!==E.factor1?E.factor1:E.factor,E.factor2);if(o.lifeTimeGradients)for(const E of o.lifeTimeGradients)H.addLifeTimeGradient(E.gradient,void 0!==E.factor1?E.factor1:E.factor,E.factor2);if(o.limitVelocityGradients){for(const n of o.limitVelocityGradients)H.addLimitVelocityGradient(n.gradient,void 0!==n.factor1?n.factor1:n.factor,n.factor2);H.limitVelocityDamping=o.limitVelocityDamping}if(o.noiseTexture&&g){const n=(0,Y.b)("BABYLON.ProceduralTexture");H.noiseTexture=n.Parse(o.noiseTexture,g,k)}let S;if(o.particleEmitterType){switch(o.particleEmitterType.type){case"SphereParticleEmitter":S=new N;break;case"SphereDirectedParticleEmitter":S=new h;break;case"ConeEmitter":case"ConeParticleEmitter":S=new A;break;case"ConeDirectedParticleEmitter":S=new l;break;case"CylinderParticleEmitter":S=new x;break;case"CylinderDirectedParticleEmitter":S=new z;break;case"HemisphericParticleEmitter":S=new V;break;case"PointParticleEmitter":S=new J;break;case"MeshParticleEmitter":S=new j;break;case"CustomParticleEmitter":S=new Q;break;default:S=new c}S.parse(o.particleEmitterType,g)}else S=new c,S.parse(o,g);H.particleEmitterType=S,H.startSpriteCellID=o.startSpriteCellID,H.endSpriteCellID=o.endSpriteCellID,H.spriteCellLoop=o.spriteCellLoop??!0,H.spriteCellWidth=o.spriteCellWidth,H.spriteCellHeight=o.spriteCellHeight,H.spriteCellChangeSpeed=o.spriteCellChangeSpeed,H.spriteRandomStartCell=o.spriteRandomStartCell,H.disposeOnStop=o.disposeOnStop??!1,H.manualEmitCount=o.manualEmitCount??-1}static Parse(o,H,n){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=arguments.length>4?arguments[4]:void 0;const Y=o.name;let y,S,G=null,c=null;if(H instanceof uo.e?y=H:(S=H,y=S.getEngine()),o.customShader&&y.createEffectForParticles){c=o.customShader;const H=c.shaderOptions.defines.length>0?c.shaderOptions.defines.join("\n"):"";G=y.createEffectForParticles(c.shaderPath.fragmentElement,c.shaderOptions.uniforms,c.shaderOptions.samplers,H)}const A=new yH(Y,g||o.xn,H,G,o.isAnimationSheetEnabled);if(A.customShader=c,A._rootUrl=n,o.id&&(A.id=o.id),o.subEmitters){A.subEmitters=[];for(const E of o.subEmitters){const o=[];for(const k of E)o.push(ro.Parse(k,H,n));A.subEmitters.push(o)}}if(o.attractors)for(const O of o.attractors){const o=new YH;o.position=E.xH.Mg(O.position),o.strength=O.strength,A.addAttractor(o)}return yH._Parse(o,A,H,n),o.textureMask&&(A.textureMask=O.d.Mg(o.textureMask)),o.gS&&(A.gS=E.xH.Mg(o.gS)),o.preventAutoStart&&(A.preventAutoStart=o.preventAutoStart),k||A.preventAutoStart||A.start(),A}serialize(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H={};if(yH._Serialize(H,this,o),H.textureMask=this.textureMask.bg(),H.customShader=this.customShader,H.preventAutoStart=this.preventAutoStart,H.gS=this.gS.bg(),this.subEmitters){H.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const n of this._subEmitters){const E=[];for(const H of n)E.push(H.serialize(o));H.subEmitters.push(E)}}if(this._attractors&&this._attractors.length){H.attractors=[];for(const o of this._attractors)H.attractors.push(o.serialize())}return H}static _Serialize(o,H,n){if(o.name=H.name,o.id=H.id,o.xn=H.getCapacity(),o.disposeOnStop=H.disposeOnStop,o.manualEmitCount=H.manualEmitCount,H.i.position){const n=H.i;o.emitterId=n.id}else{const n=H.i;o.i=n.bg()}H.particleEmitterType&&(o.particleEmitterType=H.particleEmitterType.serialize()),H.particleTexture&&(n?o.texture=H.particleTexture.serialize():(o.textureName=H.particleTexture.name,o.invertY=!!H.particleTexture._invertY)),o.isLocal=H.isLocal,q.e.AppendSerializedAnimations(H,o),o.beginAnimationOnStart=H.beginAnimationOnStart,o.beginAnimationFrom=H.beginAnimationFrom,o.beginAnimationTo=H.beginAnimationTo,o.beginAnimationLoop=H.beginAnimationLoop,o.startDelay=H.startDelay,o.renderingGroupId=H.renderingGroupId,o.isBillboardBased=H.isBillboardBased,o.billboardMode=H.billboardMode,o.minAngularSpeed=H.minAngularSpeed,o.maxAngularSpeed=H.maxAngularSpeed,o.minSize=H.minSize,o.maxSize=H.maxSize,o.minScaleX=H.minScaleX,o.maxScaleX=H.maxScaleX,o.minScaleY=H.minScaleY,o.maxScaleY=H.maxScaleY,o.minEmitPower=H.minEmitPower,o.maxEmitPower=H.maxEmitPower,o.minLifeTime=H.minLifeTime,o.maxLifeTime=H.maxLifeTime,o.emitRate=H.emitRate,o.gravity=H.gravity.bg(),o.noiseStrength=H.noiseStrength.bg(),o.color1=H.color1.bg(),o.color2=H.color2.bg(),o.colorDead=H.colorDead.bg(),o.updateSpeed=H.updateSpeed,o.targetStopDuration=H.targetStopDuration,o.blendMode=H.blendMode,o.preWarmCycles=H.preWarmCycles,o.preWarmStepOffset=H.preWarmStepOffset,o.minInitialRotation=H.minInitialRotation,o.maxInitialRotation=H.maxInitialRotation,o.startSpriteCellID=H.startSpriteCellID,o.spriteCellLoop=H.spriteCellLoop,o.endSpriteCellID=H.endSpriteCellID,o.spriteCellChangeSpeed=H.spriteCellChangeSpeed,o.spriteCellWidth=H.spriteCellWidth,o.spriteCellHeight=H.spriteCellHeight,o.spriteRandomStartCell=H.spriteRandomStartCell,o.isAnimationSheetEnabled=H.isAnimationSheetEnabled,o.useLogarithmicDepth=H.useLogarithmicDepth;const E=H.getColorGradients();if(E){o.colorGradients=[];for(const H of E){const n={gradient:H.gradient,color1:H.color1.bg()};H.color2?n.color2=H.color2.bg():n.color2=H.color1.bg(),o.colorGradients.push(n)}}const k=H.getRampGradients();if(k){o.rampGradients=[];for(const H of k){const n={gradient:H.gradient,color:H.color.bg()};o.rampGradients.push(n)}o.useRampGradients=H.useRampGradients}const g=H.getColorRemapGradients();if(g){o.colorRemapGradients=[];for(const H of g){const n={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?n.factor2=H.factor2:n.factor2=H.factor1,o.colorRemapGradients.push(n)}}const O=H.getAlphaRemapGradients();if(O){o.alphaRemapGradients=[];for(const H of O){const n={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?n.factor2=H.factor2:n.factor2=H.factor1,o.alphaRemapGradients.push(n)}}const Y=H.getSizeGradients();if(Y){o.sizeGradients=[];for(const H of Y){const n={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?n.factor2=H.factor2:n.factor2=H.factor1,o.sizeGradients.push(n)}}const y=H.getAngularSpeedGradients();if(y){o.angularSpeedGradients=[];for(const H of y){const n={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?n.factor2=H.factor2:n.factor2=H.factor1,o.angularSpeedGradients.push(n)}}const S=H.getVelocityGradients();if(S){o.velocityGradients=[];for(const H of S){const n={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?n.factor2=H.factor2:n.factor2=H.factor1,o.velocityGradients.push(n)}}const G=H.getDragGradients();if(G){o.dragGradients=[];for(const H of G){const n={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?n.factor2=H.factor2:n.factor2=H.factor1,o.dragGradients.push(n)}}const c=H.getEmitRateGradients();if(c){o.emitRateGradients=[];for(const H of c){const n={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?n.factor2=H.factor2:n.factor2=H.factor1,o.emitRateGradients.push(n)}}const A=H.getStartSizeGradients();if(A){o.startSizeGradients=[];for(const H of A){const n={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?n.factor2=H.factor2:n.factor2=H.factor1,o.startSizeGradients.push(n)}}const l=H.getLifeTimeGradients();if(l){o.lifeTimeGradients=[];for(const H of l){const n={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?n.factor2=H.factor2:n.factor2=H.factor1,o.lifeTimeGradients.push(n)}}const x=H.getLimitVelocityGradients();if(x){o.limitVelocityGradients=[];for(const H of x){const n={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?n.factor2=H.factor2:n.factor2=H.factor1,o.limitVelocityGradients.push(n)}o.limitVelocityDamping=H.limitVelocityDamping}H.noiseTexture&&(o.noiseTexture=H.noiseTexture.serialize())}clone(o,H){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const E={...this._customWrappers};let k=null;const g=this._engine;if(g.createEffectForParticles&&null!=this.customShader){k=this.customShader;const o=k.shaderOptions.defines.length>0?k.shaderOptions.defines.join("\n"):"",H=g.createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,o);E[0]?E[0].effect=H:this.setCustomEffect(H,0)}const O=this.serialize(n),Y=yH.Parse(O,this._scene||this._engine,this._rootUrl);return Y.name=o,Y.customShader=k,Y._customWrappers=E,void 0===H&&(H=this.i),this.noiseTexture&&(Y.noiseTexture=this.noiseTexture.clone()),Y.i=H,this.preventAutoStart||Y.start(),Y}}yH.BILLBOARDMODE_Y=2,yH.BILLBOARDMODE_ALL=7,yH.BILLBOARDMODE_STRETCHED=8,yH.BILLBOARDMODE_STRETCHED_LOCAL=9,ro._ParseParticleSystem=yH.Parse;var SH=n(11439),GH=n(11435),cH=n(11321);cH.e.prototype.createTransformFeedback=function(){const o=this._gl.createTransformFeedback();if(!o)throw new Error("Unable to create Transform Feedback");return o},cH.e.prototype.deleteTransformFeedback=function(o){this._gl.deleteTransformFeedback(o)},cH.e.prototype.bindTransformFeedback=function(o){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,o)},cH.e.prototype.beginTransformFeedback=function(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(o?this._gl.POINTS:this._gl.TRIANGLES)},cH.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},cH.e.prototype.setTranformFeedbackVaryings=function(o,H){this._gl.transformFeedbackVaryings(o,H,this._gl.INTERLEAVED_ATTRIBS)},cH.e.prototype.bindTransformFeedbackBuffer=function(o){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,o?o.underlyingResource:null)},cH.e.prototype.readTransformFeedbackBuffer=function(o){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,o)};const AH="clipPlaneFragmentDeclaration2",lH="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";P.d.IncludesShadersStore[AH]||(P.d.IncludesShadersStore[AH]=lH);n(12533),n(12541),n(12545),n(12548),n(12552),n(12554),n(12559),n(12562);const xH="gpuRenderParticlesPixelShader",zH="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";P.d.ShadersStore[xH]||(P.d.ShadersStore[xH]=zH);const VH="clipPlaneVertexDeclaration2",JH="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";P.d.IncludesShadersStore[VH]||(P.d.IncludesShadersStore[VH]=JH);n(12571),n(12577),n(12583),n(12586);const NH="gpuRenderParticlesVertexShader",hH="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";P.d.ShadersStore[NH]||(P.d.ShadersStore[NH]=hH);class QH extends y{static get IsSupported(){if(!i.e.LastCreatedEngine)return!1;const o=i.e.LastCreatedEngine.getCaps();return o.supportTransformFeedbacks||o.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(o){this._maxActiveParticleCount=Math.min(o,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(o){this.maxActiveParticleCount=o}createPointEmitter(o,H){const n=Ro(o,H);return this.particleEmitterType=n,n}createHemisphericEmitter(){const o=Wo(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=o,o}createSphereEmitter(){const o=io(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=o,o}createDirectedSphereEmitter(){const o=Lo(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new E.xH(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new E.xH(0,1,0));return this.particleEmitterType=o,o}createCylinderEmitter(){const o=oH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=o,o}createDirectedCylinderEmitter(){const o=HH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new E.xH(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new E.xH(0,1,0));return this.particleEmitterType=o,o}createConeEmitter(){const o=nH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=o,o}createDirectedConeEmitter(){const o=EH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new E.xH(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new E.xH(0,1,0));return this.particleEmitterType=o,o}createBoxEmitter(o,H,n,E){const k=new c;return this.particleEmitterType=k,this.direction1=o,this.direction2=H,this.minEmitBox=n,this.maxEmitBox=E,k}get flowMap(){return this._flowMap}set flowMap(o){this._flowMap!==o&&(this._flowMap=o)}isReady(){if(!this.i||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==yH.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(yH.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(yH.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";o?setTimeout((()=>{this.start(0)}),o):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var o;let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(o=this._customWrappers[H])||void 0===o?void 0:o.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[o]??this._customWrappers[0]}setCustomEffect(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[H]=new oo.c(this._engine),this._customWrappers[H].effect=o}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new R.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(o,H,n){return super._removeGradientAndTexture(o,H,n),this._releaseBuffers(),this}addColorGradient(o,H){this._colorGradients||(this._colorGradients=[]);const n=new w(o,H);return this._colorGradients.push(n),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(o&&this._colorGradients.sort(((o,H)=>o.gradient<H.gradient?-1:o.gradient>H.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(o){return this._removeGradientAndTexture(o,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const H in this._drawWrappers){var o;null===(o=this._drawWrappers[H].drawContext)||void 0===o||o.reset()}}_addFactorGradient(o,H,n){const E=new u(H,n);o.push(E),this._releaseBuffers()}addSizeGradient(o,H){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,o,H),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(o){return this._removeGradientAndTexture(o,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(o,H){if(!o)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&o.sort(((o,H)=>o.gradient<H.gradient?-1:o.gradient>H.gradient?1:0));const n=this;n[H]&&(n[H].dispose(),n[H]=null)}addAngularSpeedGradient(o,H){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,o,H),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(o){return this._removeGradientAndTexture(o,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(o,H){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,o,H),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(o){return this._removeGradientAndTexture(o,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(o,H){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,o,H),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(o){return this._removeGradientAndTexture(o,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(o,H){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,o,H),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(o){return this._removeGradientAndTexture(o,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(o){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(o,H,n){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(o),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.yg=new R.d,this.onStoppedObservable=new R.d,this.onStartedObservable=new R.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,n&&"Scene"!==n.getClassName()?(this._engine=n,this.defaultProjectionMatrix=E.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=n||i.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.jA.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,Y.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,Y.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,Y.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,Y.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new oo.c(this._engine)},this._customWrappers[0].effect=k,this._drawWrappers={0:new oo.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(H=H??{}).randomTextureSize||delete H.randomTextureSize;const O={xn:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...H},y=H;isFinite(y)&&(O.xn=y),this._capacity=O.xn,this._maxActiveParticleCount=O.xn,this._currentActiveCount=0,this._isAnimationSheetEnabled=g,this.particleEmitterType=new c;const S=Math.min(this._engine.getCaps().maxTextureSize,O.randomTextureSize);let G=[];for(let E=0;E<S;++E)G.push(Math.random()),G.push(Math.random()),G.push(Math.random()),G.push(Math.random());this._randomTexture=new W.b(new Float32Array(G),S,1,5,n,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,G=[];for(let E=0;E<S;++E)G.push(Math.random()),G.push(Math.random()),G.push(Math.random()),G.push(Math.random());this._randomTexture2=new W.b(new Float32Array(G),S,1,5,n,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=S}_reset(){this._releaseBuffers()}_createVertexBuffers(o,H,n){const E={};E.position=H.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let k=3;E.age=H.createVertexBuffer("age",k,1,this._attributesStrideSize,!0),k+=1,E.size=H.createVertexBuffer("size",k,3,this._attributesStrideSize,!0),k+=3,E.life=H.createVertexBuffer("life",k,1,this._attributesStrideSize,!0),k+=1,k+=4,this.billboardMode===yH.BILLBOARDMODE_STRETCHED&&(E.direction=H.createVertexBuffer("direction",k,3,this._attributesStrideSize,!0)),k+=3,this._platform.alignDataInBuffer&&(k+=1),this.particleEmitterType instanceof Q&&(k+=3,this._platform.alignDataInBuffer&&(k+=1)),this._colorGradientsTexture||(E.color=H.createVertexBuffer("color",k,4,this._attributesStrideSize,!0),k+=4),this._isBillboardBased||(E.initialDirection=H.createVertexBuffer("initialDirection",k,3,this._attributesStrideSize,!0),k+=3,this._platform.alignDataInBuffer&&(k+=1)),this.noiseTexture&&(E.noiseCoordinates1=H.createVertexBuffer("noiseCoordinates1",k,3,this._attributesStrideSize,!0),k+=3,this._platform.alignDataInBuffer&&(k+=1),E.noiseCoordinates2=H.createVertexBuffer("noiseCoordinates2",k,3,this._attributesStrideSize,!0),k+=3,this._platform.alignDataInBuffer&&(k+=1)),E.angle=H.createVertexBuffer("angle",k,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?k++:k+=2,this._isAnimationSheetEnabled&&(E.cellIndex=H.createVertexBuffer("cellIndex",k,1,this._attributesStrideSize,!0),k+=1,this.spriteRandomStartCell&&(E.cellStartOffset=H.createVertexBuffer("cellStartOffset",k,1,this._attributesStrideSize,!0),k+=1)),E.offset=n.createVertexBuffer("offset",0,2),E.uv=n.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(E),this._platform.createVertexBuffers(o,E),this.resetDrawCache()}_initialize(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!o)return;const H=this._engine,n=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof Q&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const k=this.particleEmitterType instanceof Q,g=E.TmpVectors.xH[0];let O=0;for(let E=0;E<this._capacity;E++)if(n.push(0),n.push(0),n.push(0),n.push(0),n.push(0),n.push(0),n.push(0),n.push(0),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),k?(this.particleEmitterType.particleDestinationGenerator(E,null,g),n.push(g.x),n.push(g.y),n.push(g.z)):(n.push(0),n.push(0),n.push(0)),this._platform.alignDataInBuffer&&n.push(0),O+=16,k&&(this.particleEmitterType.particlePositionGenerator(E,null,g),n.push(g.x),n.push(g.y),n.push(g.z),this._platform.alignDataInBuffer&&n.push(0),O+=4),this._colorGradientsTexture||(n.push(0),n.push(0),n.push(0),n.push(0),O+=4),this.isBillboardBased||(n.push(0),n.push(0),n.push(0),this._platform.alignDataInBuffer&&n.push(0),O+=4),this.noiseTexture&&(n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),this._platform.alignDataInBuffer&&n.push(0),n.push(Math.random()),n.push(Math.random()),n.push(Math.random()),this._platform.alignDataInBuffer&&n.push(0),O+=8),n.push(0),O+=1,this._angularSpeedGradientsTexture||(n.push(0),O+=1),this._isAnimationSheetEnabled&&(n.push(0),O+=1,this.spriteRandomStartCell&&(n.push(0),O+=1)),this._platform.alignDataInBuffer){let o=3-(O+3&3);for(O+=o;o-- >0;)n.push(0)}const Y=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),y=this._platform.createParticleBuffer(n),S=this._platform.createParticleBuffer(n);this._buffer0=new p.c(H,y,!1,this._attributesStrideSize),this._buffer1=new p.c(H,S,!1,this._attributesStrideSize),this._spriteBuffer=new p.c(H,Y,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let o=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(o+="\n#define BILLBOARD"),this._colorGradientsTexture&&(o+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(o+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(o+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(o+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(o+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(o+="\n#define DRAGGRADIENTS"),this._flowMap&&(o+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(o+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(o+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(o+="\n#define NOISE"),this.isLocal&&(o+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===o||(this._cachedUpdateDefines=o,this._updateBuffer=this._platform.createUpdateBuffer(o)),this._platform.isUpdateBufferReady()}_getWrapper(o){const H=this._getCustomDrawWrapper(o);if(null!==H&&void 0!==H&&H.effect)return H;const n=[];this.fillDefines(n,o);let E=this._drawWrappers[o];E||(E=new oo.c(this._engine),E.drawContext&&(E.drawContext.useInstancing=!0),this._drawWrappers[o]=E);const k=n.join("\n");if(E.defines!==k){const o=[],H=[],n=[];this.fillUniformsAttributesAndSamplerNames(H,o,n),E.setEffect(this._engine.createEffect("gpuRenderParticles",o,H,n,k),k)}return E}static _GetAttributeNamesOrOptions(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],E=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const k=[p.d.PositionKind,"age","life","size","angle"];return o||k.push(p.d.ColorKind),H&&k.push("cellIndex"),n||k.push("initialDirection"),E&&k.push("direction"),k.push("offset",p.d.UVKind),k}static _GetEffectCreationOptions(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const E=["emitterWM","gS","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,Ho.e)(E),o&&E.push("sheetInfos"),H&&E.push("logarithmicDepthConstant"),n&&(E.push("vFogInfos"),E.push("vFogColor")),E}fillDefines(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,Ho.n)(this,this._scene,o),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==GH.c.FOGMODE_NONE&&o.push("#define FOG")),H===yH.BLENDMODE_MULTIPLY&&o.push("#define BLENDMULTIPLYMODE"),this.isLocal&&o.push("#define LOCAL"),this.useLogarithmicDepth&&o.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(o.push("#define BILLBOARD"),this.billboardMode){case yH.BILLBOARDMODE_Y:o.push("#define BILLBOARDY");break;case yH.BILLBOARDMODE_STRETCHED:o.push("#define BILLBOARDSTRETCHED");break;case yH.BILLBOARDMODE_ALL:o.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&o.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&o.push("#define ANIMATESHEET"),n&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),o.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(o,H,n){H.push(...QH._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===yH.BILLBOARDMODE_STRETCHED)),o.push(...QH._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),n.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(SH.c.PrepareUniforms(o,this._imageProcessingConfigurationDefines),SH.c.PrepareSamplers(n,this._imageProcessingConfigurationDefines))}animate(){var o;let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(H?this.preWarmStepOffset:(null===(o=this._scene)||void 0===o?void 0:o.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(o,H){const n=this[H];if(!o||!o.length||n)return;const E=new Float32Array(this._rawTextureWidth);for(let k=0;k<this._rawTextureWidth;k++){const H=k/this._rawTextureWidth;d.GetCurrentGradient(H,o,((o,H,n)=>{E[k]=(0,S.Lerp)(o.factor1,H.factor1,n)}))}this[H]=W.b.CreateRTexture(E,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[H].name=H.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const o=new Uint8Array(4*this._rawTextureWidth),H=O.g.dY[0];for(let n=0;n<this._rawTextureWidth;n++){const E=n/this._rawTextureWidth;d.GetCurrentGradient(E,this._colorGradients,((E,k,g)=>{O.d.LerpToRef(E.color1,k.color1,g,H),o[4*n]=255*H.r,o[4*n+1]=255*H.g,o[4*n+2]=255*H.b,o[4*n+3]=255*H.a}))}this._colorGradientsTexture=W.b.CreateRGBATexture(o,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(o,H){var n,k,g,O;const Y=this._getWrapper(o),y=Y.effect;this._engine.enableEffect(Y);const S=(null===(n=this._scene)||void 0===n?void 0:n.getViewMatrix())||E.Matrix.IdentityReadOnly;if(y.setMatrix("view",S),y.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),y.setTexture("diffuseSampler",this.particleTexture),y.setVector2("translationPivot",this.translationPivot),y.setVector3("gS",this.gS),this.isLocal&&y.setMatrix("emitterWM",H),this._colorGradientsTexture?y.setTexture("colorGradientSampler",this._colorGradientsTexture):y.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const o=this.particleTexture.getBaseSize();y.setFloat3("sheetInfos",this.spriteCellWidth/o.width,this.spriteCellHeight/o.height,o.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const o=this._scene.activeCamera;y.setVector3("eyePosition",o.globalPosition)}const G=y.defines;if(this._scene&&((0,Ho.i)(y,this,this._scene),this.applyFog&&(0,no.f)(this._scene,void 0,y)),G.indexOf("#define BILLBOARDMODE_ALL")>=0){const o=S.clone();o.invert(),y.setMatrix("invView",o)}return this.useLogarithmicDepth&&this._scene&&(0,no.l)(G,y,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(y),this._setEngineBasedOnBlendMode(o),this._platform.bindDrawBuffers(this._targetIndex,y,null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(y),null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(O=this._scene)&&void 0!==O&&O.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(o){if(!this.i||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!o)if(this.i.position){o=this.i.getWorldMatrix()}else{const H=this.i;o=E.TmpVectors.Matrix[0],E.Matrix.TranslationToRef(H.x,H.y,H.z,o)}const H=this._engine,n=H.getDepthWrite();if(H.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const o=this.bo();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",o.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",o),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const k=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=k,H.setDepthWrite(n)}render(){let o,H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!H&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let o=0;o<this.preWarmCycles;o++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const o=0|this._accumulatedCount;this._accumulatedCount-=o,this._currentActiveCount+=o}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.i.position){o=this.i.getWorldMatrix()}else{const H=this.i;o=E.TmpVectors.Matrix[0],E.Matrix.TranslationToRef(H.x,H.y,H.z,o)}const k=this._engine;this.updateInAnimate||this._update(o);let g=0;return H||n||(k.setState(!1),this.forceDepthWrite&&k.setDepthWrite(!0),g=this.blendMode===yH.BLENDMODE_MULTIPLYADD?this._render(yH.BLENDMODE_MULTIPLY,o)+this._render(yH.BLENDMODE_ADD,o):this._render(this.blendMode,o),this._engine.setAlphaMode(0)),g}rebuild(){const o=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(o,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,o()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const H in this._drawWrappers){this._drawWrappers[H].dispose()}if(this._drawWrappers={},this._scene){const o=this._scene.jA.indexOf(this);o>-1&&this._scene.jA.splice(o,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let H=0;H<this._renderVertexBuffers.length;++H){const o=this._renderVertexBuffers[H];for(const H in o)o[H].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),o&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),o&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.yg.notifyObservers(this),this.yg.clear()}clone(o,H){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const E={...this._customWrappers};let k=null;const g=this._engine;if(g.createEffectForParticles&&null!=this.customShader){k=this.customShader;const o=k.shaderOptions.defines.length>0?k.shaderOptions.defines.join("\n"):"";E[0]=g.createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,o,void 0,void 0,void 0,this)}const O=this.serialize(n),Y=QH.Parse(O,this._scene||this._engine,this._rootUrl);return Y.name=o,Y.customShader=k,Y._customWrappers=E,void 0===H&&(H=this.i),this.noiseTexture&&(Y.noiseTexture=this.noiseTexture.clone()),Y.i=H,Y}serialize(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H={};return yH._Serialize(H,this,o),H.activeParticleCount=this.activeParticleCount,H.randomTextureSize=this._randomTextureSize,H.customShader=this.customShader,H}static Parse(o,H,n){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0;const g=o.name;let O,Y;H instanceof uo.e?O=H:(Y=H,O=Y.getEngine());const y=new QH(g,{xn:k||o.xn,randomTextureSize:o.randomTextureSize},H,null,o.isAnimationSheetEnabled);if(y._rootUrl=n,o.customShader&&O.createEffectForParticles){const H=o.customShader,n=H.shaderOptions.defines.length>0?H.shaderOptions.defines.join("\n"):"",E=O.createEffectForParticles(H.shaderPath.fragmentElement,H.shaderOptions.uniforms,H.shaderOptions.samplers,n,void 0,void 0,void 0,y);y.setCustomEffect(E,0),y.customShader=H}return o.id&&(y.id=o.id),o.activeParticleCount&&(y.activeParticleCount=o.activeParticleCount),yH._Parse(o,y,H,n),o.preventAutoStart&&(y.preventAutoStart=o.preventAutoStart),E||y.preventAutoStart||y.start(),y}}var pH=n(11024),jH=n(12595),mH=n(11568);class PH{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(o){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const H of this.systems)H.i=o;this._emitterNode=o}setEmitterAsSphere(o,H,n){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:o,renderingGroupId:H};const E=(0,jH.b)("emitterSphere",{diameter:o.diameter,segments:o.segments},n);E.renderingGroupId=H;const k=new mH.JH("emitterSphereMaterial",n);k.emissiveColor=o.color,E.material=k;for(const g of this.systems)g.i=E;this._emitterNode=E}start(o){for(const H of this.systems)o&&(H.i=o),H.start()}dispose(){for(const o of this.systems)o.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H={systems:[]};for(const n of this.systems)H.systems.push(n.serialize(o));return this._emitterNode&&(H.i=this._emitterCreationOptions),H}static Parse(o,H){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],E=arguments.length>3?arguments[3]:void 0;const k=new PH,g=this.BaseAssetsUrl+"/textures/";H=H||i.e.LastCreatedScene;for(const O of o.systems)k.systems.push(n?QH.Parse(O,H,g,!0,E):yH.Parse(O,H,g,!0,E));if(o.i){const n=o.i.options;if("Sphere"===o.i.kind)k.setEmitterAsSphere({diameter:n.diameter,segments:n.segments,color:O.NH.Mg(n.color)},o.i.renderingGroupId,H)}return k}}PH.BaseAssetsUrl="https://assets.babylonjs.com/particles";var bH=n(11057);class eH{static CreateDefault(o){let H,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,E=arguments.length>2?arguments[2]:void 0;H=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new QH("default system",{xn:n},E):new yH("default system",n,E),H.i=o;const k=pH.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return H.particleTexture=new D.c(k,H.bo()),H.createConeEmitter(.1,Math.PI/4),H.color1=new O.d(1,1,1,1),H.color2=new O.d(1,1,1,1),H.colorDead=new O.d(1,1,1,0),H.minSize=.1,H.maxSize=.1,H.minEmitPower=2,H.maxEmitPower=2,H.updateSpeed=1/60,H.emitRate=30,H}static CreateAsync(o,H){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],E=arguments.length>3?arguments[3]:void 0;H||(H=i.e.LastCreatedScene);const k={};return H.addPendingData(k),new Promise(((g,O)=>{if(n&&!QH.IsSupported)return H.removePendingData(k),O("Particle system with GPU is not supported.");pH.Tools.LoadFile(`${eH.BaseAssetsUrl}/systems/${o}.json`,(o=>{H.removePendingData(k);const O=JSON.parse(o.toString());return g(PH.Parse(O,H,n,E))}),void 0,void 0,void 0,(()=>(H.removePendingData(k),O(`An error occurred with the creation of your particle system. Check if your type '${o}' exists.`))))}))}static ExportSet(o){const H=new PH;for(const n of o)H.systems.push(n);return H}static ParseFromFileAsync(o,H,n){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",g=arguments.length>5?arguments[5]:void 0;return new Promise(((O,Y)=>{const y=new bH.d;y.addEventListener("readystatechange",(()=>{if(4==y.readyState)if(200==y.status){const H=JSON.parse(y.responseText);let Y;Y=E?QH.Parse(H,n,k,!1,g):yH.Parse(H,n,k,!1,g),o&&(Y.name=o),O(Y)}else Y("Unable to load the particle system")})),y.open("GET",H),y.send()}))}static ParseFromSnippetAsync(o,H){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",k=arguments.length>4?arguments[4]:void 0;if("_BLANK"===o){const o=this.CreateDefault(null);return o.start(),Promise.resolve(o)}return new Promise(((g,O)=>{const Y=new bH.d;Y.addEventListener("readystatechange",(()=>{if(4==Y.readyState)if(200==Y.status){const O=JSON.parse(JSON.parse(Y.responseText).jsonPayload),y=JSON.parse(O.particleSystem);let S;S=n?QH.Parse(y,H,E,!1,k):yH.Parse(y,H,E,!1,k),S.snippetId=o,g(S)}else O("Unable to load the snippet "+o)})),Y.open("GET",this.SnippetUrl+"/"+o.replace(/#/g,"/")),Y.send()}))}}eH.BaseAssetsUrl=PH.BaseAssetsUrl,eH.SnippetUrl="https://snippet.babylonjs.com",eH.CreateFromSnippetAsync=eH.ParseFromSnippetAsync;var ZH=n(11652),MH=n(11475),KH=n(12600);(0,KH.i)(MH.d.NAME_PARTICLESYSTEM,((o,H,n,E)=>{const k=(0,KH.j)(MH.d.NAME_PARTICLESYSTEM);if(k&&void 0!==o.jA&&null!==o.jA)for(let g=0,O=o.jA.length;g<O;g++){const O=o.jA[g];n.jA.push(k(O,H,E))}})),(0,KH.e)(MH.d.NAME_PARTICLESYSTEM,((o,H,n)=>{if(o.activeParticleCount){return QH.Parse(o,H,n)}return yH.Parse(o,H,n)})),uo.e.prototype.createEffectForParticles=function(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],E=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",g=arguments.length>4?arguments[4]:void 0,O=arguments.length>5?arguments[5]:void 0,Y=arguments.length>6?arguments[6]:void 0,y=arguments.length>7?arguments[7]:void 0,S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,G=arguments.length>9?arguments[9]:void 0,c=[],A=[];const l=[];return y?y.fillUniformsAttributesAndSamplerNames(A,c,l):(c=yH._GetAttributeNamesOrOptions(),A=yH._GetEffectCreationOptions()),-1===k.indexOf(" BILLBOARD")&&(k+="\n#define BILLBOARD\n"),null!==y&&void 0!==y&&y.isAnimationSheetEnabled&&-1===k.indexOf(" ANIMATESHEET")&&(k+="\n#define ANIMATESHEET\n"),-1===E.indexOf("diffuseSampler")&&E.push("diffuseSampler"),this.createEffect({vertex:G??(null===y||void 0===y?void 0:y.vertexShaderName)??"particles",fragmentElement:o},c,A.concat(H),l.concat(E),k,g,O,Y,void 0,S,(async()=>{0===S?await Promise.resolve().then(n.bind(n,12632)):await Promise.resolve().then(n.bind(n,12709))}))},ZH.b.prototype.getEmittedParticleSystems=function(){const o=[];for(let H=0;H<this.bo().jA.length;H++){const n=this.bo().jA[H];n.i===this&&o.push(n)}return o},ZH.b.prototype.getHierarchyEmittedParticleSystems=function(){const o=[],H=this.getDescendants();H.push(this);for(let n=0;n<this.bo().jA.length;n++){const E=this.bo().jA[n],k=E.i;k.position&&-1!==H.indexOf(k)&&o.push(E)}return o};n(11546),n(11557),n(11626);n(11629),n(12606),n(11392),n(11538),n(11676);n(11388);var fH;n(12613),n(11213);!function(o){o[o.Color=2]="Color",o[o.UV=1]="UV",o[o.Random=0]="Random",o[o.Stated=3]="Stated"}(fH||(fH={}));var BH=n(11422);const qH=new E.xH(0,0,0),DH=new E.xH(0,0,0),TH=new E.xH(0,0,0);class aH{constructor(o,H,n){this.width=o,this.height=H,this.data=n}processFlowable(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;if(!n)return;n instanceof E.Matrix?E.xH.TransformCoordinatesToRef(o.position,n,TH):(TH.x=n.x,TH.y=n.y,TH.z=n.z);const k=.5*TH.x+.5,g=1-(.5*TH.y+.5),O=Math.floor(k*this.width),Y=Math.floor(g*this.height);if(O<0||O>=this.width||Y<0||Y>=this.height)return;const y=4*(Y*this.width+O),S=this.data[y]/255*2-1,G=this.data[y+1]/255*2-1,c=this.data[y+2]/255*2-1,A=this.data[y+3]/255;qH.set(S,G,c),qH.scaleToRef(H*A,DH),o.direction.addInPlace(DH)}_processParticle(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;this.processFlowable(o,H,n)}static async FromUrlAsync(o){return await new Promise(((H,n)=>{const E=document.createElement("canvas"),k=E.getContext("2d");let g=null;const O=new Image;O.crossOrigin="anonymous",O.src=o,O.onerror=H=>{n(new Error(`Failed to load image: ${o} : ${H}`))},O.onload=()=>{E.width=O.width,E.height=O.height,k.drawImage(O,0,0),g=k.getImageData(0,0,E.width,E.height),H(new aH(E.width,E.height,g.data))}}))}static async ExtractFromTextureAsync(o){return await new Promise(((H,n)=>{if(!o.isReady())return void o.onLoadObservable.addOnce((async()=>{try{const n=await this.ExtractFromTextureAsync(o);H(n)}catch(E){n(E)}}));const E=o.getSize();BH.j.GetTextureDataAsync(o,E.width,E.height).then((o=>{H(new aH(E.width,E.height,new Uint8ClampedArray(o)))})).catch(n)}))}}var FH,CH,tH,XH,sH,UH,IH,vH,wH;!function(o){o[o.Int=1]="Int",o[o.Float=2]="Float",o[o.Vector2=4]="Vector2",o[o.xH=8]="xH",o[o.Matrix=16]="Matrix",o[o.Particle=32]="Particle",o[o.Texture=64]="Texture",o[o.dY=128]="dY",o[o.FloatGradient=256]="FloatGradient",o[o.Vector2Gradient=512]="Vector2Gradient",o[o.Vector3Gradient=1024]="Vector3Gradient",o[o.Color4Gradient=2048]="Color4Gradient",o[o.System=4096]="System",o[o.AutoDetect=8192]="AutoDetect",o[o.BasedOnInput=16384]="BasedOnInput",o[o.Undefined=32768]="Undefined",o[o.All=65535]="All"}(FH||(FH={})),function(o){o[o.Compatible=0]="Compatible",o[o.TypeIncompatible=1]="TypeIncompatible",o[o.HierarchyIssue=2]="HierarchyIssue"}(CH||(CH={})),function(o){o[o.Input=0]="Input",o[o.Output=1]="Output"}(tH||(tH={}));class rH{get direction(){return this._direction}get type(){if(this._type===FH.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===FH.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(o){this._type=o}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((o=>o.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(o,H,n){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=FH.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new R.d,this.onDisconnectionObservable=new R.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=H,this.name=o,this._direction=n}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(o){var H;return this.isConnected?null!==(H=this._connectedPoint)&&void 0!==H&&H._storedFunction?this._connectedPoint._storedFunction(o):this._connectedPoint._storedValue:this.value}canConnectTo(o){return 0===this.checkCompatibilityState(o)}checkCompatibilityState(o){const H=this._ownerBlock,n=o.ownerBlock;if(this.type!==o.type&&o.innerType!==FH.AutoDetect)return o.acceptedConnectionPointTypes&&-1!==o.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(o.excludedConnectionPointTypes&&-1!==o.excludedConnectionPointTypes.indexOf(this.type))return 1;let E=n,k=H;return 0===this.direction&&(E=H,k=n),E.isAnAncestorOf(k)?2:0}connectTo(o){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(o))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${o.ownerBlock.name}".${o.name}`;return this._endpoints.push(o),o._connectedPoint=this,this.onConnectionObservable.notifyObservers(o),o.onConnectionObservable.notifyObservers(this),this}disconnectFrom(o){const H=this._endpoints.indexOf(o);return-1===H||(this._endpoints.splice(H,1),o._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(o),o.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(o){let H=1;for(;H<FH.All;)o&H||this.excludedConnectionPointTypes.push(H),H<<=1}serialize(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const H={};return H.name=this.name,H.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.bg?(H.valueType="BABYLON."+this.value.getClassName(),H.value=this.value.bg()):(H.valueType="number",H.value=this.value)),o&&this.connectedPoint&&(H.inputName=this.name,H.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,H.targetConnectionName=this.connectedPoint.name,H.isExposedOnFrame=!0,H.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(H.isExposedOnFrame=!0,H.exposedPortPosition=this.exposedPortPosition),H}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class uH{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(o){this._name=o}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(o){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new R.d,this.yg=new R.d,this.onInputChangedObservable=new R.d,this.visibleOnFrame=!1,this._name=o,this.uniqueId=T.b.UniqueId}_inputRename(o){return o}_outputRename(o){return o}isAnAncestorOf(o){for(const H of this._outputs)if(H.hasEndpoints)for(const n of H.endpoints){if(n.ownerBlock===o)return!0;if(n.ownerBlock.isAnAncestorOf(o))return!0}return!1}isAnAncestorOfType(o){if(this.getClassName()===o)return!0;for(const H of this._outputs)if(H.hasEndpoints)for(const n of H.endpoints)if(n.ownerBlock.isAnAncestorOfType(o))return!0;return!1}getInputByName(o){const H=this._inputs.filter((H=>H.name===o));return H.length?H[0]:null}_linkConnectionTypes(o,H){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[H]._acceptedConnectionPointType=this._inputs[o]:(this._inputs[o]._linkedConnectionSource=this._inputs[H],this._inputs[o]._isMainLinkSource=!0),this._inputs[H]._linkedConnectionSource=this._inputs[o]}registerInput(o,H){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],E=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0;const O=new rH(o,this,0);return O.type=H,O.isOptional=n,O.defaultValue=E,O.value=E,O.valueMin=k,O.valueMax=g,this._inputs.push(O),this.onInputChangedObservable.notifyObservers(O),this}registerOutput(o,H,n){return(n=n??new rH(o,this,1)).type=H,this._outputs.push(n),this}_build(o){}_customBuildStep(o){}build(o){if(this._buildId===o.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((o=>o.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=o.buildId;for(const H of this._inputs){if(!H.connectedPoint){H.isOptional||o.notConnectedNonOptionalInputs.push(H);continue}const n=H.connectedPoint.ownerBlock;n&&n!==this&&!n.isSystem&&n.build(o)}return this._customBuildStep(o),o.verbose&&a.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(o),this.onBuildObservable.notifyObservers(this),!1}serialize(){const o={};o.customType="BABYLON."+this.getClassName(),o.id=this.uniqueId,o.name=this.name,o.visibleOnFrame=this.visibleOnFrame,o.inputs=[],o.outputs=[];for(const H of this.inputs)o.inputs.push(H.serialize());for(const H of this.outputs)o.outputs.push(H.serialize(!1));return o}_deserialize(o){this._name=o.name,this.comments=o.comments,this.visibleOnFrame=!!o.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(o)}_deserializePortDisplayNamesAndExposedOnFrame(o){const H=o.inputs,n=o.outputs;if(H)for(const E of H){const o=this.inputs.find((o=>o.name===E.name));if(!o)return;if(E.displayName&&(o.displayName=E.displayName),E.isExposedOnFrame&&(o.isExposedOnFrame=E.isExposedOnFrame,o.exposedPortPosition=E.exposedPortPosition),void 0!==E.value&&null!==E.value)if("number"===E.valueType)o.value=E.value;else{const H=(0,Y.b)(E.valueType);H&&(o.value=H.Mg(E.value))}}if(n)for(let E=0;E<n.length;E++){const o=n[E];o.displayName&&(this.outputs[E].displayName=o.displayName),o.isExposedOnFrame&&(this.outputs[E].isExposedOnFrame=o.isExposedOnFrame,this.outputs[E].exposedPortPosition=o.exposedPortPosition)}}clone(){const o=this.serialize(),H=(0,Y.b)(o.customType);if(H){const n=new H;return n._deserialize(o),n}return null}dispose(){this.yg.notifyObservers(this),this.yg.clear();for(const o of this.inputs)o.dispose();for(const o of this.outputs)o.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function dH(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",E=arguments.length>3?arguments[3]:void 0;return(k,g)=>{let O=k._propStore;O||(O=[],k._propStore=O),O.push({propertyName:g,displayName:o,type:H,groupName:n,options:E??{},className:k.getClassName()})}}(0,f.c)([(0,B.P)("comment")],uH.prototype,"comments",void 0),function(o){o[o.Boolean=0]="Boolean",o[o.Float=1]="Float",o[o.Int=2]="Int",o[o.Vector2=3]="Vector2",o[o.List=4]="List",o[o.dY=5]="dY",o[o.SamplingMode=6]="SamplingMode",o[o.TextureFormat=7]="TextureFormat",o[o.TextureType=8]="TextureType"}(XH||(XH={})),function(o){o[o.None=0]="None",o[o.Position=1]="Position",o[o.Direction=2]="Direction",o[o.Age=3]="Age",o[o.Lifetime=4]="Lifetime",o[o.Color=5]="Color",o[o.ScaledDirection=6]="ScaledDirection",o[o.Scale=7]="Scale",o[o.AgeGradient=8]="AgeGradient",o[o.Angle=9]="Angle",o[o.SpriteCellIndex=16]="SpriteCellIndex",o[o.SpriteCellStart=17]="SpriteCellStart",o[o.SpriteCellEnd=18]="SpriteCellEnd"}(sH||(sH={})),function(o){o[o.None=0]="None",o[o.Time=1]="Time",o[o.Delta=2]="Delta",o[o.Emitter=3]="Emitter"}(UH||(UH={}));class RH{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let o="";for(const H of this.notConnectedNonOptionalInputs)o+=`input ${H.name} from block ${H.ownerBlock.name}[${H.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(o)throw"Build of Node Particle System Set failed:\n"+o}adapt(o,H){const n=o.getConnectedValue(this)||0;if(o.type===H)return n;switch(H){case FH.Vector2:return new E.Vector2(n,n);case FH.xH:return new E.xH(n,n,n);case FH.dY:return new O.d(n,n,n,n)}return null}getContextualValue(o){if(!this.particleContext||!this.systemContext)return null;switch(o){case sH.Position:return this.particleContext.position;case sH.Direction:return this.particleContext.direction;case sH.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case sH.Color:return this.particleContext.color;case sH.Age:return this.particleContext.age;case sH.Lifetime:return this.particleContext.lifeTime;case sH.Angle:return this.particleContext.angle;case sH.Scale:return this.particleContext.scale;case sH.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case sH.SpriteCellEnd:return this.systemContext.endSpriteCellID;case sH.SpriteCellIndex:return this.particleContext.cellIndex;case sH.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.i.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.i.absolutePosition:this.systemContext.i:null}getSystemValue(o){if(!this.particleContext||!this.systemContext)return null;switch(o){case UH.Time:return this.systemContext._actualFrame;case UH.Delta:return this.systemContext._scaledUpdateSpeed;case UH.Emitter:if(this.isEmitterTransformNode){return this.systemContext.i.absolutePosition}return this.systemContext.i}return null}}function WH(o,H,n){const E=new RH;E.VH=H;const k=o.createSystem(E);return k.canStart=()=>!0,k.i=n.clone(),k.disposeOnStop=!0,k.start(),k}class iH extends uH{constructor(o){super(o),this.blendMode=y.BLENDMODE_ONEONE,this.xn=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",FH.Particle),this.registerInput("texture",FH.Texture),this.registerInput("onStart",FH.System,!0),this.registerInput("onEnd",FH.System,!0),this.registerOutput("system",FH.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(o){o.xn=this.xn,o.buildId=this._buildId++,this.build(o);const H=this.particle.getConnectedValue(o);return H.particleTexture=this.texture.getConnectedValue(o),H.emitRate=this.emitRate,H.blendMode=this.blendMode,H.name=this.name,H._nodeGenerated=!0,H._targetStopDuration=this.targetStopDuration,H.startDelay=this.startDelay,this.system._storedValue=this,H.canStart=()=>!this.doNoStart,H.onStartedObservable.add((n=>{const E=this.onStart.getConnectedValue(o);E&&n.onStartedObservable.addOnce((()=>{o.systemContext=H;const n=WH(E,o.VH,o.emitterPosition);this.yg.addOnce((()=>{n.dispose()}))}));const k=this.onEnd.getConnectedValue(o);k&&n.onStoppedObservable.addOnce((()=>{o.systemContext=H;const n=WH(k,o.VH,o.emitterPosition);this.yg.addOnce((()=>{n.dispose()}))}))})),this.yg.addOnce((()=>{H.dispose()})),H}serialize(){const o=super.serialize();return o.xn=this.xn,o.emitRate=this.emitRate,o.blendMode=this.blendMode,o.doNoStart=this.doNoStart,o.targetStopDuration=this.targetStopDuration,o.startDelay=this.startDelay,o}_deserialize(o){super._deserialize(o),this.xn=o.xn,this.emitRate=o.emitRate,this.doNoStart=!!o.doNoStart,void 0!==o.blendMode&&(this.blendMode=o.blendMode),void 0!==o.targetStopDuration&&(this.targetStopDuration=o.targetStopDuration),void 0!==o.startDelay&&(this.startDelay=o.startDelay)}}(0,f.c)([dH("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:y.BLENDMODE_ONEONE},{label:"Standard",value:y.BLENDMODE_STANDARD},{label:"Add",value:y.BLENDMODE_ADD},{label:"Multiply",value:y.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:y.BLENDMODE_MULTIPLYADD}]})],iH.prototype,"blendMode",void 0),(0,f.c)([dH("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],iH.prototype,"xn",void 0),(0,f.c)([dH("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],iH.prototype,"emitRate",void 0),(0,f.c)([dH("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],iH.prototype,"targetStopDuration",void 0),(0,f.c)([dH("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],iH.prototype,"startDelay",void 0),(0,f.c)([dH("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],iH.prototype,"doNoStart",void 0),(0,Y.e)("BABYLON.SystemBlock",iH);class LH extends uH{get type(){if(this._type===FH.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=FH.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=FH.Vector2,this._type;case"xH":return this._type=FH.xH,this._type;case"dY":return this._type=FH.dY,this._type;case"Matrix":return this._type=FH.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===sH.None&&this._systemSource!==UH.None}get systemSource(){return this._systemSource}set systemSource(o){if(this._systemSource=o,o!==UH.None){switch(this._contextualSource=sH.None,this._type=FH.Float,o){case UH.Time:case UH.Delta:this._type=FH.Float;break;case UH.Emitter:this._type=FH.xH}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==sH.None}get contextualValue(){return this._contextualSource}set contextualValue(o){if(this._contextualSource=o,o!==sH.None){switch(this._systemSource=UH.None,o){case sH.Scale:this._type=FH.Vector2;break;case sH.Position:case sH.Direction:case sH.ScaledDirection:this._type=FH.xH;break;case sH.Color:this._type=FH.dY;break;case sH.Age:case sH.Lifetime:case sH.Angle:case sH.AgeGradient:this._type=FH.Float;break;case sH.SpriteCellEnd:case sH.SpriteCellStart:case sH.SpriteCellIndex:this._type=FH.Int}this.output&&(this.output.type=this._type)}}constructor(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:FH.AutoDetect;super(o),this._type=FH.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new R.d,this._systemSource=UH.None,this._contextualSource=sH.None,this._type=H,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",H)}get value(){return this._storedValue}set value(o){this.type===FH.Float&&this.min!==this.max&&(o=Math.max(this.min,o),o=Math.min(this.max,o)),this._storedValue=o,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(o){this._valueCallback=o}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case FH.Int:case FH.Float:this.value=0;break;case FH.Vector2:this.value=E.Vector2.Zero();break;case FH.xH:this.value=E.xH.Zero();break;case FH.dY:this.value=new O.d(1,1,1,1);break;case FH.Matrix:this.value=E.Matrix.Identity()}}_build(o){super._build(o),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=o=>o.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=o=>o.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const o=super.serialize();return o.type=this.type,o.contextualValue=this.contextualValue,o.systemSource=this.systemSource,o.min=this.min,o.max=this.max,o.groupInInspector=this.groupInInspector,o.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.bg?(o.valueType="BABYLON."+this._storedValue.getClassName(),o.value=this._storedValue.bg()):(o.valueType="number",o.value=this._storedValue)),o}_deserialize(o){if(super._deserialize(o),this._type=o.type,this.contextualValue=o.contextualValue,this.systemSource=o.systemSource||UH.None,this.min=o.min||0,this.max=o.max||0,this.groupInInspector=o.groupInInspector||"",void 0!==o.displayInInspector&&(this.displayInInspector=o.displayInInspector),o.valueType)if("number"===o.valueType)this._storedValue=o.value;else{const H=(0,Y.b)(o.valueType);H&&(this._storedValue=H.Mg(o.value))}}}(0,Y.e)("BABYLON.ParticleInputBlock",LH);class on extends uH{get url(){return this._url}set url(o){this._url!==o&&(this._cachedData=null,this._url=o,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(o){this._textureDataUrl!==o&&(this._cachedData=null,this._textureDataUrl=o,this._url="",this._sourceTexture=null)}set sourceTexture(o){this._sourceTexture!==o&&(this._cachedData=null,this._sourceTexture=o,this._url="",this._textureDataUrl="")}constructor(o){super(o),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",FH.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const o=this.texture._storedValue;return await new Promise(((H,n)=>{if(!o.isReady())return void o.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),H(this._cachedData)}catch(o){n(o)}}));const E=o.getSize();BH.j.GetTextureDataAsync(o,E.width,E.height).then((n=>{this._cachedData={width:E.width,height:E.height,data:new Uint8ClampedArray(n)},o.dispose(),H(this._cachedData)})).catch(n)}))}_build(o){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new D.c(this._textureDataUrl,o.VH):this.texture._storedValue=new D.c(this._url,o.VH):this.texture._storedValue=null}serialize(){const o=super.serialize();return o.url=this.url,o.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(o.textureDataUrl=this.textureDataUrl),o}_deserialize(o){super._deserialize(o),this.url=o.url,this.serializedCachedData=!!o.serializedCachedData,o.textureDataUrl&&(this.textureDataUrl=o.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,Y.e)("BABYLON.ParticleTextureSourceBlock",on);class Hn extends uH{constructor(o){super(o),this.registerInput("particle",FH.Particle),this.registerInput("position",FH.xH),this.registerOutput("output",FH.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(o){const H=this.particle.getConnectedValue(o);if(this.output._storedValue=H,!this.position.isConnected)return;const n={process:n=>{o.particleContext=n,o.systemContext=H,n.position.S(this.position.getConnectedValue(o))},previousItem:null,nextItem:null};H._updateQueueStart?so(n,H._updateQueueStart):H._updateQueueStart=n}}(0,Y.e)("BABYLON.UpdatePositionBlock",Hn),function(o){o[o.Add=0]="Add",o[o.Subtract=1]="Subtract",o[o.Multiply=2]="Multiply",o[o.Divide=3]="Divide",o[o.Max=4]="Max",o[o.Min=5]="Min"}(IH||(IH={}));class nn extends uH{constructor(o){super(o),this.operation=IH.Add,this.registerInput("left",FH.AutoDetect),this.registerInput("right",FH.AutoDetect),this.registerOutput("output",FH.BasedOnInput),this.output._typeConnectionSource=this.left;const H=[FH.Matrix,FH.Particle,FH.Texture,FH.System,FH.FloatGradient,FH.Color4Gradient,FH.Vector2Gradient,FH.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...H),this.right.excludedConnectionPointTypes.push(...H),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(o){let H;const n=this.left,k=this.right;if(!n.isConnected||!k.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const g=n.type===FH.Float||n.type===FH.Int,Y=k.type===FH.Float||k.type===FH.Int,y=g&&Y;switch(this.operation){case IH.Add:H=y?o=>n.getConnectedValue(o)+k.getConnectedValue(o):g?o=>o.adapt(n,k.type).add(k.getConnectedValue(o)):o=>n.getConnectedValue(o).add(o.adapt(k,n.type));break;case IH.Subtract:H=y?o=>n.getConnectedValue(o)-k.getConnectedValue(o):g?o=>o.adapt(n,k.type).zH(k.getConnectedValue(o)):o=>n.getConnectedValue(o).zH(o.adapt(k,n.type));break;case IH.Multiply:H=y?o=>n.getConnectedValue(o)*k.getConnectedValue(o):g?o=>o.adapt(n,k.type).multiply(k.getConnectedValue(o)):o=>n.getConnectedValue(o).multiply(o.adapt(k,n.type));break;case IH.Divide:H=y?o=>n.getConnectedValue(o)/k.getConnectedValue(o):g?o=>o.adapt(n,k.type).divide(k.getConnectedValue(o)):o=>n.getConnectedValue(o).divide(o.adapt(k,n.type));break;case IH.Min:if(y)H=o=>Math.min(n.getConnectedValue(o),k.getConnectedValue(o));else{const[o,Y]=g?[k,n]:[n,k];switch(o.type){case FH.Vector2:H=H=>E.Vector2.Minimize(o.getConnectedValue(H),H.adapt(Y,o.type));break;case FH.xH:H=H=>E.xH.Minimize(o.getConnectedValue(H),H.adapt(Y,o.type));break;case FH.dY:H=H=>{const n=o.getConnectedValue(H),{r:E,g:k,b:g,a:y}=H.adapt(Y,o.type);return new O.d(Math.min(n.r,E),Math.min(n.g,k),Math.min(n.b,g),Math.min(n.a,y))}}}break;case IH.Max:if(!y){const[o,Y]=g?[k,n]:[n,k];switch(o.type){case FH.Vector2:H=H=>E.Vector2.Maximize(o.getConnectedValue(H),H.adapt(Y,o.type));break;case FH.xH:H=H=>E.xH.Maximize(o.getConnectedValue(H),H.adapt(Y,o.type));break;case FH.dY:H=H=>{const n=o.getConnectedValue(H),{r:E,g:k,b:g,a:y}=H.adapt(Y,o.type);return new O.d(Math.max(n.r,E),Math.min(n.g,k),Math.min(n.b,g),Math.min(n.a,y))}}break}H=o=>Math.max(n.getConnectedValue(o),k.getConnectedValue(o))}this.output._storedFunction=o=>n.type===FH.Int?0|H(o):H(o)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===FH.Int||this.left.type===FH.Float&&this.right.type!==FH.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[o,H]of[[this.left,this.right],[this.right,this.left]])o.acceptedConnectionPointTypes=[FH.Int,FH.Float],H.isConnected&&(o.acceptedConnectionPointTypes.push(H.type),H.type!==FH.Int&&H.type!==FH.Float||o.acceptedConnectionPointTypes.push(FH.Vector2,FH.xH,FH.dY))}dispose(){super.dispose();for(const o of this._connectionObservers)o.remove();this._connectionObservers.length=0}serialize(){const o=super.serialize();return o.operation=this.operation,o}_deserialize(o){super._deserialize(o),this.operation=o.operation}}(0,f.c)([dH("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:IH.Add},{label:"Subtract",value:IH.Subtract},{label:"Multiply",value:IH.Multiply},{label:"Divide",value:IH.Divide},{label:"Max",value:IH.Max},{label:"Min",value:IH.Min}]})],nn.prototype,"operation",void 0),(0,Y.e)("BABYLON.ParticleMathBlock",nn);class En extends uH{constructor(o){super(o),this.registerInput("particle",FH.Particle),this.registerInput("direction1",FH.xH,!0,new E.xH(0,1,0)),this.registerInput("direction2",FH.xH,!0,new E.xH(0,1,0)),this.registerInput("minEmitBox",FH.xH,!0,new E.xH(-.5,-.5,-.5)),this.registerInput("maxEmitBox",FH.xH,!0,new E.xH(.5,.5,.5)),this.registerOutput("output",FH.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(o){const H=this.particle.getConnectedValue(o);H._directionCreation.process=n=>{o.particleContext=n,o.systemContext=H;const k=this.direction1.getConnectedValue(o),g=this.direction2.getConnectedValue(o),O=(0,S.RandomRange)(k.x,g.x),Y=(0,S.RandomRange)(k.y,g.y),y=(0,S.RandomRange)(k.z,g.z);o.isEmitterTransformNode?E.xH.TransformNormalFromFloatsToRef(O,Y,y,o.emitterWorldMatrix,n.direction):n.direction.Wg(O,Y,y)},H._positionCreation.process=n=>{o.particleContext=n,o.systemContext=H;const k=this.minEmitBox.getConnectedValue(o),g=this.maxEmitBox.getConnectedValue(o),O=(0,S.RandomRange)(k.x,g.x),Y=(0,S.RandomRange)(k.y,g.y),y=(0,S.RandomRange)(k.z,g.z);o.isEmitterTransformNode?E.xH.TransformCoordinatesFromFloatsToRef(O,Y,y,o.emitterWorldMatrix,n.position):(n.position.Wg(O,Y,y),n.position.addInPlace(o.emitterPosition))},this.output._storedValue=H}}(0,Y.e)("BABYLON.BoxShapeBlock",En);class kn extends uH{constructor(o){super(o),this.registerInput("emitPower",FH.Float,!0,1),this.registerInput("lifeTime",FH.Float,!0,1),this.registerInput("color",FH.dY,!0,new O.d(1,1,1,1)),this.registerInput("scale",FH.Vector2,!0,new E.Vector2(1,1)),this.registerInput("angle",FH.Float,!0,0),this.registerOutput("particle",FH.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(o){const H=new yH(this.name,o.xn,o.VH,null,!1,void 0,!0);H.particleEmitterType=new J,H._lifeTimeCreation.process=(H,n)=>{o.particleContext=H,H.lifeTime=this.lifeTime.getConnectedValue(o),n._emitPower=this.emitPower.getConnectedValue(o)},H._colorCreation.process=H=>{o.particleContext=H,H.color.S(this.color.getConnectedValue(o))},H._sizeCreation.process=H=>{o.particleContext=H,H.size=1,H.scale.S(this.scale.getConnectedValue(o))},H._angleCreation.process=H=>{o.particleContext=H,H.angle=this.angle.getConnectedValue(o)},this.particle._storedValue=H}}(0,Y.e)("BABYLON.CreateParticleBlock",kn);class gn{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const o=[];for(const H of this.attachedBlocks)H.isInput&&o.push(H);return o}constructor(o){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new R.d,this.name=o}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(o){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(o)&&this.attachedBlocks.push(o);for(const n of o.inputs){const E=n.connectedPoint;if(E){const n=E.ownerBlock;n!==o&&this._initializeBlock(n,H)}}}async buildAsync(o){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((n=>{const E=new PH;for(const o of this._systemBlocks)this._initializeBlock(o);for(const k of this.systemBlocks){const n=new RH;n.buildId=this._buildId++,n.VH=o,n.verbose=H;const g=k.createSystem(n);n.emitErrors(),E.systems.push(g)}this.onBuildObservable.notifyObservers(this),n(E)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const o=new iH("Particle system"),H=new Hn("Update position");H.output.connectTo(o.particle);const n=new LH("Position");n.contextualValue=sH.Position;const E=new LH("Scaled direction");E.contextualValue=sH.ScaledDirection;const k=new nn("Add");k.operation=IH.Add,n.output.connectTo(k.left),E.output.connectTo(k.right),k.output.connectTo(H.position);const g=new kn("Create particle"),O=new En("Box shape");g.particle.connectTo(O.particle),O.output.connectTo(H.particle);const Y=new on("Texture");Y.texture.connectTo(o.texture),Y.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(o)}removeBlock(o){const H=this.attachedBlocks.indexOf(o);if(H>-1&&this.attachedBlocks.splice(H,1),o.isSystem){const H=this._systemBlocks.indexOf(o);H>-1&&this._systemBlocks.splice(H,1)}}parseSerializedObject(o){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];H||this.clear();const n={};for(const E of o.nG){const o=(0,Y.b)(E.customType);if(o){const H=new o;H._deserialize(E),n[E.id]=H,this.attachedBlocks.push(H),H.isSystem&&this._systemBlocks.push(H)}}for(const E of this.attachedBlocks)if(E.isTeleportOut){const o=E,H=o._tempEntryPointUniqueId;if(H){const E=n[H];E&&E.attachToEndpoint(o)}}for(let E=0;E<o.nG.length;E++){const k=o.nG[E],g=n[k.id];g&&(g.inputs.length&&k.inputs.some((o=>o.targetConnectionName))&&!H||this._restoreConnections(g,o,n))}if(o.locations||o.editorData&&o.editorData.locations){const E=o.locations||o.editorData.locations;for(const o of E)n[o.fk]&&(o.fk=n[o.fk].uniqueId);H&&this.editorData&&this.editorData.locations&&E.concat(this.editorData.locations),o.locations?this.editorData={locations:E}:(this.editorData=o.editorData,this.editorData.locations=E);const k=[];for(const o in n)k[o]=n[o].uniqueId;this.editorData.map=k}this.comment=o.comment}_restoreConnections(o,H,n){for(const E of o.outputs)for(const k of H.nG){const g=n[k.id];if(g)for(const O of k.inputs)if(n[O.targetBlockId]!==o||O.targetConnectionName!==E.name);else{const o=g.getInputByName(O.inputName);if(!o||o.isConnected)continue;E.connectTo(o,!0),this._restoreConnections(g,H,n)}}}serialize(o){const H=o?{}:q.e.Serialize(this);H.editorData=JSON.parse(JSON.stringify(this.editorData));let n=[];o?n=o:H.customType="BABYLON.NodeParticleSystemSet",H.nG=[];for(const E of n)H.nG.push(E.serialize());if(!o)for(const E of this.attachedBlocks)-1===n.indexOf(E)&&H.nG.push(E.serialize());return H}dispose(){for(const o of this.attachedBlocks)o.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(o){const H=new gn(o);return H.setToDefault(),H}static Parse(o){const H=q.e.Parse((()=>new gn(o.name)),o,null);return H.parseSerializedObject(o),H}static ParseFromSnippetAsync(o,H){return"_BLANK"===o?Promise.resolve(gn.CreateDefault("blank")):new Promise(((n,E)=>{const k=new bH.d;k.addEventListener("readystatechange",(()=>{if(4==k.readyState)if(200==k.status){const O=JSON.parse(JSON.parse(k.responseText).jsonPayload),Y=JSON.parse(O.nodeParticle);H||(H=q.e.Parse((()=>new gn(o)),Y,null)),H.parseSerializedObject(Y),H.snippetId=o;try{n(H)}catch(g){E(g)}}else E("Unable to load the snippet "+o)})),k.open("GET",this.SnippetUrl+"/"+o.replace(/#/g,"/")),k.send()}))}}gn.EditorURL=`${pH.Tools._DefaultCdnUrl}/v${uo.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,gn.SnippetUrl="https://snippet.babylonjs.com",(0,f.c)([(0,B.P)()],gn.prototype,"name",void 0),(0,f.c)([(0,B.P)("comment")],gn.prototype,"comment",void 0),function(o){o[o.None=0]="None",o[o.PerParticle=1]="PerParticle",o[o.PerSystem=2]="PerSystem"}(vH||(vH={}));class On extends uH{constructor(o){super(o),this._currentLockId=-2,this.lockMode=vH.PerParticle,this.registerInput("min",FH.AutoDetect,!0,0),this.registerInput("max",FH.AutoDetect,!0,1),this.registerOutput("output",FH.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(FH.Float|FH.Int|FH.Vector2|FH.xH|FH.dY),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(FH.Float|FH.Int|FH.Vector2|FH.xH|FH.dY),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=FH.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let o=null;switch(this._currentLockId=-2,this.min.type){case FH.AutoDetect:case FH.Int:case FH.Float:o=o=>{const H=this.min.getConnectedValue(o)||0,n=this.max.getConnectedValue(o)||1;return H+Math.random()*(n-H)};break;case FH.Vector2:o=o=>{const H=this.min.getConnectedValue(o)||E.Vector2.Zero(),n=this.max.getConnectedValue(o)||E.Vector2.One();return new E.Vector2(H.x+Math.random()*(n.x-H.x),H.y+Math.random()*(n.y-H.y))};break;case FH.xH:o=o=>{const H=this.min.getConnectedValue(o)||E.xH.Zero(),n=this.max.getConnectedValue(o)||E.xH.One();return new E.xH(H.x+Math.random()*(n.x-H.x),H.y+Math.random()*(n.y-H.y),H.z+Math.random()*(n.z-H.z))};break;case FH.dY:o=o=>{const H=this.min.getConnectedValue(o)||new O.d(0,0,0,0),n=this.max.getConnectedValue(o)||new O.d(1,1,1,1);return new O.d(H.x+Math.random()*(n.x-H.x),H.y+Math.random()*(n.y-H.y),H.z+Math.random()*(n.z-H.z),H.w+Math.random()*(n.w-H.w))}}this.output._storedFunction=H=>{var n;let E=0;switch(this.lockMode){case vH.PerParticle:E=(null===(n=H.particleContext)||void 0===n?void 0:n.id)||-1;break;case vH.PerSystem:E=H.buildId||0}return this._currentLockId!==E&&(this.lockMode!==vH.None&&(this._currentLockId=E),this.output._storedValue=o(H)),this.output._storedValue}}serialize(){const o=super.serialize();return o.lockMode=this.lockMode,o}_deserialize(o){super._deserialize(o),this.lockMode=o.lockMode}}(0,f.c)([dH("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:vH.None},{label:"Per particle",value:vH.PerParticle},{label:"Per system",value:vH.PerSystem}]})],On.prototype,"lockMode",void 0),(0,Y.e)("BABYLON.ParticleRandomBlock",On);class Yn extends uH{constructor(o){super(o),this._currentLockId=-2,this.lockMode=vH.PerParticle,this.registerInput("min",FH.AutoDetect),this.registerInput("max",FH.AutoDetect),this.registerOutput("output",FH.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const H=[FH.Matrix,FH.Particle,FH.Texture,FH.System,FH.FloatGradient,FH.Color4Gradient,FH.Vector2Gradient,FH.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...H),this.max.excludedConnectionPointTypes.push(...H)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let o=null;switch(this._currentLockId=-2,this.min.type){case FH.Float:case FH.Int:o=o=>{const H=this.min.getConnectedValue(o),n=this.max.getConnectedValue(o);return Math.random()*(n-H)+H};break;case FH.Vector2:o=o=>{const H=this.min.getConnectedValue(o),n=this.max.getConnectedValue(o);return new E.Vector2(Math.random()*(n.x-H.x)+H.x,Math.random()*(n.y-H.y)+H.y)};break;case FH.xH:o=o=>{const H=this.min.getConnectedValue(o),n=this.max.getConnectedValue(o);return new E.xH(Math.random()*(n.x-H.x)+H.x,Math.random()*(n.y-H.y)+H.y,Math.random()*(n.z-H.z)+H.z)};break;case FH.dY:o=o=>{const H=this.min.getConnectedValue(o),n=this.max.getConnectedValue(o);return new O.d(Math.random()*(n.r-H.r)+H.r,Math.random()*(n.g-H.g)+H.g,Math.random()*(n.b-H.b)+H.b,Math.random()*(n.a-H.a)+H.a)}}this.output._storedFunction=H=>{var n;let E=0;switch(this.lockMode){case vH.PerParticle:E=(null===(n=H.particleContext)||void 0===n?void 0:n.id)||-1;break;case vH.PerSystem:E=H.buildId||0}return this._currentLockId!==E&&(this.lockMode!==vH.None&&(this._currentLockId=E),this.output._storedValue=o(H)),this.output._storedValue}}serialize(){const o=super.serialize();return o.lockMode=this.lockMode,o}_deserialize(o){super._deserialize(o),void 0!==o.lockMode&&(this.lockMode=o.lockMode)}}(0,f.c)([dH("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:vH.None},{label:"Per particle",value:vH.PerParticle},{label:"Per system",value:vH.PerSystem}]})],Yn.prototype,"lockMode",void 0),(0,Y.e)("BABYLON.RandomRangeBlock",Yn);(0,Y.e)("BABYLON.ParticleLerpBlock",class extends uH{constructor(o){super(o),this.registerInput("left",FH.AutoDetect),this.registerInput("right",FH.AutoDetect),this.registerInput("gradient",FH.Float,!0,0,0,1),this.registerOutput("output",FH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(FH.Float|FH.Int|FH.Vector2|FH.xH|FH.dY)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const o=(o,H,n)=>(1-o)*H+o*n;this.output._storedFunction=H=>{const n=this.left.getConnectedValue(H),k=this.right.getConnectedValue(H),g=this.gradient.getConnectedValue(H);switch(this.left.type){case FH.Int:case FH.Float:return o(g,n,k);case FH.Vector2:return new E.Vector2(o(g,n.x,k.x),o(g,n.y,k.y));case FH.xH:return new E.xH(o(g,n.x,k.x),o(g,n.y,k.y),o(g,n.z,k.z));case FH.dY:return new O.d(o(g,n.r,k.r),o(g,n.g,k.g),o(g,n.b,k.b),o(g,n.a,k.a))}return 0}}});(0,Y.e)("BABYLON.UpdateDirectionBlock",class extends uH{constructor(o){super(o),this.registerInput("particle",FH.Particle),this.registerInput("direction",FH.xH),this.registerOutput("output",FH.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(o){const H=this.particle.getConnectedValue(o);if(this.output._storedValue=H,!this.direction.isConnected)return;const n={process:n=>{o.particleContext=n,o.systemContext=H,n.direction.S(this.direction.getConnectedValue(o))},previousItem:null,nextItem:null};H._updateQueueStart?so(n,H._updateQueueStart):H._updateQueueStart=n}});(0,Y.e)("BABYLON.UpdateColorBlock",class extends uH{constructor(o){super(o),this.registerInput("particle",FH.Particle),this.registerInput("color",FH.dY),this.registerOutput("output",FH.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(o){const H=this.particle.getConnectedValue(o);if(this.output._storedValue=H,!this.color.isConnected)return;const n={process:n=>{o.particleContext=n,o.systemContext=H,n.color.S(this.color.getConnectedValue(o))},previousItem:null,nextItem:null};H._updateQueueStart?so(n,H._updateQueueStart):H._updateQueueStart=n}});(0,Y.e)("BABYLON.UpdateScaleBlock",class extends uH{constructor(o){super(o),this.registerInput("particle",FH.Particle),this.registerInput("scale",FH.Vector2),this.registerOutput("output",FH.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(o){const H=this.particle.getConnectedValue(o);if(this.output._storedValue=H,!this.scale.isConnected)return;const n={process:n=>{o.particleContext=n,o.systemContext=H,n.scale.S(this.scale.getConnectedValue(o))},previousItem:null,nextItem:null};H._updateQueueStart?so(n,H._updateQueueStart):H._updateQueueStart=n}});(0,Y.e)("BABYLON.UpdateAngleBlock",class extends uH{constructor(o){super(o),this.registerInput("particle",FH.Particle),this.registerInput("angle",FH.Float),this.registerOutput("output",FH.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(o){const H=this.particle.getConnectedValue(o);if(this.output._storedValue=H,!this.angle.isConnected)return;const n={process:n=>{o.particleContext=n,o.systemContext=H,n.angle=this.angle.getConnectedValue(o)},previousItem:null,nextItem:null};H._updateQueueStart?so(n,H._updateQueueStart):H._updateQueueStart=n}});(0,Y.e)("BABYLON.BasicPositionUpdateBlock",class extends uH{constructor(o){super(o),this.registerInput("particle",FH.Particle),this.registerOutput("output",FH.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(o){const H=this.particle.getConnectedValue(o),n={process:n=>{o.particleContext=n,o.systemContext=H,n.direction.scaleToRef(H._directionScale,H._scaledDirection),n.position.addInPlace(H._scaledDirection)},previousItem:null,nextItem:null};H._updateQueueStart?so(n,H._updateQueueStart):H._updateQueueStart=n,this.output._storedValue=H}});(0,Y.e)("BABYLON.BasicSpriteUpdateBlock",class extends uH{constructor(o){super(o),this.registerInput("particle",FH.Particle),this.registerOutput("output",FH.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(o){const H=this.particle.getConnectedValue(o),n={process:n=>{o.particleContext=n,o.systemContext=H,n.updateCellIndex()},previousItem:null,nextItem:null};H._updateQueueStart?so(n,H._updateQueueStart):H._updateQueueStart=n,this.output._storedValue=H}});(0,Y.e)("BABYLON.UpdateSpriteCellIndexBlock",class extends uH{constructor(o){super(o),this.registerInput("particle",FH.Particle),this.registerInput("cellIndex",FH.Int),this.registerOutput("output",FH.Particle),this.cellIndex.acceptedConnectionPointTypes=[FH.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(o){const H=this.particle.getConnectedValue(o);if(this.output._storedValue=H,!this.cellIndex.isConnected)return;const n={process:n=>{o.particleContext=n,o.systemContext=H,n.cellIndex=Math.floor(this.cellIndex.getConnectedValue(o))},previousItem:null,nextItem:null};H._updateQueueStart?so(n,H._updateQueueStart):H._updateQueueStart=n}});class yn extends uH{constructor(o){super(o),this.strength=1,this.registerInput("particle",FH.Particle),this.registerInput("flowMap",FH.Texture),this.registerOutput("output",FH.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(o){var H;const n=this.particle.getConnectedValue(o),E=o.VH;let k;(null===(H=this.flowMap.connectedPoint)||void 0===H?void 0:H.ownerBlock).extractTextureContentAsync().then((o=>{o&&(k=new aH(o.width,o.height,o.data))}));const g={process:o=>{const H=E.getTransformMatrix();k&&k._processParticle(o,this.strength*n._tempScaledUpdateSpeed,H)},previousItem:null,nextItem:null};n._updateQueueStart?so(g,n._updateQueueStart):n._updateQueueStart=g,this.output._storedValue=n}serialize(){const o=super.serialize();return o.strength=this.strength,o}_deserialize(o){super._deserialize(o),this.strength=o.strength}}(0,f.c)([dH("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],yn.prototype,"strength",void 0),(0,Y.e)("BABYLON.UpdateFlowMapBlock",yn);(0,Y.e)("BABYLON.SphereShapeBlock",class extends uH{constructor(o){super(o),this.registerInput("input",FH.Particle),this.registerInput("radius",FH.Float,!0,1),this.registerInput("radiusRange",FH.Float,!0,1,0,1),this.registerInput("directionRandomizer",FH.Float,!0,0,0,1),this.registerOutput("output",FH.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(o){const H=this.input.getConnectedValue(o);H._directionCreation.process=n=>{o.particleContext=n,o.systemContext=H;const k=this.directionRandomizer.getConnectedValue(o),g=n.position.zH(o.emitterPosition).normalize(),O=(0,S.RandomRange)(0,k),Y=(0,S.RandomRange)(0,k),y=(0,S.RandomRange)(0,k);g.x+=O,g.y+=Y,g.z+=y,g.normalize(),o.isEmitterTransformNode?E.xH.TransformNormalFromFloatsToRef(O,Y,y,o.emitterWorldMatrix,n.direction):n.direction.Wg(O,Y,y)},H._positionCreation.process=n=>{o.particleContext=n,o.systemContext=H;const k=this.radius.getConnectedValue(o),g=this.radiusRange.getConnectedValue(o),O=k-(0,S.RandomRange)(0,k*g),Y=(0,S.RandomRange)(0,1),y=(0,S.RandomRange)(0,2*Math.PI),G=Math.acos(2*Y-1),c=O*Math.cos(y)*Math.sin(G),A=O*Math.cos(G),l=O*Math.sin(y)*Math.sin(G);o.isEmitterTransformNode?E.xH.TransformCoordinatesFromFloatsToRef(c,A,l,o.emitterWorldMatrix,n.position):(n.position.Wg(c,A,l),n.position.addInPlace(o.emitterPosition))},this.output._storedValue=H}});(0,Y.e)("BABYLON.PointShapeBlock",class extends uH{constructor(o){super(o),this.registerInput("particle",FH.Particle),this.registerInput("direction1",FH.xH,!0,new E.xH(0,1,0)),this.registerInput("direction2",FH.xH,!0,new E.xH(0,1,0)),this.registerOutput("output",FH.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(o){const H=this.particle.getConnectedValue(o);H._directionCreation.process=n=>{o.particleContext=n,o.systemContext=H;const k=this.direction1.getConnectedValue(o),g=this.direction2.getConnectedValue(o),O=(0,S.RandomRange)(k.x,g.x),Y=(0,S.RandomRange)(k.y,g.y),y=(0,S.RandomRange)(k.z,g.z);o.isEmitterTransformNode?E.xH.TransformNormalFromFloatsToRef(O,Y,y,o.emitterWorldMatrix,n.direction):n.direction.Wg(O,Y,y)},H._positionCreation.process=n=>{o.systemContext=H,o.isEmitterTransformNode?E.xH.TransformCoordinatesFromFloatsToRef(0,0,0,o.emitterWorldMatrix,n.position):n.position.S(o.emitterPosition)},this.output._storedValue=H}});(0,Y.e)("BABYLON.CustomShapeBlock",class extends uH{constructor(o){super(o),this.registerInput("particle",FH.Particle),this.registerInput("position",FH.xH,!0,new E.xH(0,0,0)),this.registerInput("direction",FH.xH,!0,new E.xH(0,1,0)),this.registerOutput("output",FH.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(o){const H=this.particle.getConnectedValue(o);H._directionCreation.process=n=>{o.particleContext=n,o.systemContext=H;const k=this.direction.getConnectedValue(o);o.isEmitterTransformNode?E.xH.TransformNormalToRef(k,o.emitterWorldMatrix,n.direction):n.direction.S(k)},H._positionCreation.process=n=>{o.particleContext=n,o.systemContext=H;const k=this.position.getConnectedValue(o);o.isEmitterTransformNode?E.xH.TransformCoordinatesToRef(k,o.emitterWorldMatrix,n.position):(n.position.S(k),n.position.addInPlace(o.emitterPosition))},this.output._storedValue=H}});(0,Y.e)("BABYLON.CylinderShapeBlock",class extends uH{constructor(o){super(o),this._tempVector=E.xH.Zero(),this.registerInput("particle",FH.Particle),this.registerInput("radius",FH.Float,!0,1),this.registerInput("height",FH.Float,!0,1,0),this.registerInput("radiusRange",FH.Float,!0,1,0,1),this.registerInput("directionRandomizer",FH.Float,!0,0,0,1),this.registerOutput("output",FH.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(o){const H=this.particle.getConnectedValue(o);H._directionCreation.process=n=>{o.particleContext=n,o.systemContext=H;const k=this.directionRandomizer.getConnectedValue(o);n.position.subtractToRef(o.emitterPosition,this._tempVector),this._tempVector.normalize(),o.isEmitterTransformNode&&E.xH.TransformNormalToRef(this._tempVector,o.emitterInverseWorldMatrix,this._tempVector);const g=(0,S.RandomRange)(-k/2,k/2);let O=Math.atan2(this._tempVector.x,this._tempVector.z);O+=(0,S.RandomRange)(-Math.PI/2,Math.PI/2)*k,this._tempVector.y=g,this._tempVector.x=Math.sin(O),this._tempVector.z=Math.cos(O),this._tempVector.normalize(),o.isEmitterTransformNode?E.xH.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,o.emitterWorldMatrix,n.direction):n.direction.S(this._tempVector)},H._positionCreation.process=n=>{o.particleContext=n,o.systemContext=H;const k=this.height.getConnectedValue(o),g=this.radiusRange.getConnectedValue(o),O=this.radius.getConnectedValue(o),Y=(0,S.RandomRange)(-k/2,k/2),y=(0,S.RandomRange)(0,2*Math.PI),G=(0,S.RandomRange)((1-g)*(1-g),1),c=Math.sqrt(G)*O,A=c*Math.cos(y),l=c*Math.sin(y);o.isEmitterTransformNode?E.xH.TransformCoordinatesFromFloatsToRef(A,Y,l,o.emitterWorldMatrix,n.position):(n.position.Wg(A,Y,l),n.position.addInPlace(o.emitterPosition))},this.output._storedValue=H}});class Sn extends uH{constructor(o){super(o),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",FH.Particle),this.registerOutput("output",FH.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(o){super._build(o);const H=this.particle.getConnectedValue(o);H._isAnimationSheetEnabled=!0,H.spriteCellWidth=this.width,H.spriteCellHeight=this.height,H.startSpriteCellID=this.start,H.endSpriteCellID=this.end,H.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=H}serialize(){const o=super.serialize();return o.width=this.width,o.height=this.height,o.start=this.start,o.end=this.end,o.randomStartCell=this.randomStartCell,o}_deserialize(o){super._deserialize(o),this.width=o.width,this.height=o.height,this.start=o.start,this.end=o.end,this.randomStartCell=o.randomStartCell}}(0,f.c)([dH("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Sn.prototype,"start",void 0),(0,f.c)([dH("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Sn.prototype,"end",void 0),(0,f.c)([dH("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Sn.prototype,"width",void 0),(0,f.c)([dH("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Sn.prototype,"height",void 0),(0,f.c)([dH("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Sn.prototype,"loop",void 0),(0,f.c)([dH("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Sn.prototype,"randomStartCell",void 0),(0,Y.e)("BABYLON.SetupSpriteSheetBlock",Sn);class Gn extends uH{constructor(o){super(o),this.reference=0,this.registerInput("value",FH.AutoDetect),this.registerOutput("output",FH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=o=>{switch(o){case FH.Float:return FH.FloatGradient;case FH.Vector2:return FH.Vector2Gradient;case FH.xH:return FH.Vector3Gradient;case FH.dY:return FH.Color4Gradient}return o},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(FH.Float|FH.Vector2|FH.xH|FH.dY)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=o=>null}serialize(){const o=super.serialize();return o.reference=this.reference,o}_deserialize(o){super._deserialize(o),this.reference=o.reference}}(0,f.c)([dH("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Gn.prototype,"reference",void 0),(0,Y.e)("BABYLON.ParticleGradientValueBlock",Gn);(0,Y.e)("BABYLON.ParticleGradientBlock",class extends uH{constructor(o){super(o),this._entryCount=1,this.registerInput("gradient",FH.Float,!0,1,0,1),this.registerInput("value0",FH.AutoDetect),this.registerOutput("output",FH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=o=>{switch(o){case FH.FloatGradient:return FH.Float;case FH.Vector2Gradient:return FH.Vector2;case FH.Vector3Gradient:return FH.xH;case FH.Color4Gradient:return FH.dY}return o},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(FH.FloatGradient|FH.Vector2Gradient|FH.Vector3Gradient|FH.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(o){this._inputs[o].onConnectionObservable.add((()=>{this._entryCount>o||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),FH.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const o=[];for(let n=1;n<this._inputs.length;n++){var H;if(this._inputs[n].isConnected)o.push(null===(H=this._inputs[n].connectedPoint)||void 0===H?void 0:H.ownerBlock)}o.sort(((o,H)=>o.reference-H.reference)),this.output._storedFunction=H=>{const n=this.gradient.getConnectedValue(H);if(1===o.length)return o[0].value.getConnectedValue(H);let k=null;for(let g=o.length-1;g>=0;g--){const Y=o[g];if(Y.reference<=n){const o=Y.value.getConnectedValue(H);if(k){const g=k.value.getConnectedValue(H),y=k.reference,G=Y.reference,c=Math.max(0,Math.min(1,(n-G)/(y-G)));switch(this.output.type){case FH.Float:return(0,S.Lerp)(o,g,c);case FH.Vector2:return E.Vector2.Lerp(o,g,c);case FH.xH:return E.xH.Lerp(o,g,c);case FH.dY:return O.d.Lerp(o,g,c)}}return o}k=Y}return 0}}});(0,Y.e)("BABYLON.ParticleConverterBlock",class extends uH{constructor(o){super(o),this.registerInput("color ",FH.dY,!0),this.registerInput("xyz ",FH.xH,!0),this.registerInput("xy ",FH.Vector2,!0),this.registerInput("zw ",FH.Vector2,!0),this.registerInput("x ",FH.Float,!0),this.registerInput("y ",FH.Float,!0),this.registerInput("z ",FH.Float,!0),this.registerInput("w ",FH.Float,!0),this.registerOutput("color",FH.dY),this.registerOutput("xyz",FH.xH),this.registerOutput("xy",FH.Vector2),this.registerOutput("zw",FH.Vector2),this.registerOutput("x",FH.Float),this.registerOutput("y",FH.Float),this.registerOutput("z",FH.Float),this.registerOutput("w",FH.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(o){return"color "===o?"colorIn":"xyz "===o?"xyzIn":"xy "===o?"xyIn":"zw "===o?"zwIn":"x "===o?"xIn":"y "===o?"yIn":"z "===o?"zIn":"w "===o?"wIn":o}_outputRename(o){switch(o){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return o}}_build(o){super._build(o);const H=this.xIn,n=this.yIn,k=this.zIn,g=this.wIn,Y=this.xyIn,y=this.zwIn,S=this.xyzIn,G=this.colorIn,c=this.colorOut,A=this.xyzOut,l=this.xyOut,x=this.zwOut,z=this.xOut,V=this.yOut,J=this.zOut,N=this.wOut,h=o=>{if(G.isConnected)return G.getConnectedValue(o);let E=0,c=0,A=0,l=0;if(H.isConnected&&(E=H.getConnectedValue(o)),n.isConnected&&(c=n.getConnectedValue(o)),k.isConnected&&(A=k.getConnectedValue(o)),g.isConnected&&(l=g.getConnectedValue(o)),Y.isConnected){const H=Y.getConnectedValue(o);H&&(E=H.x,c=H.y)}if(y.isConnected){const H=y.getConnectedValue(o);H&&(A=H.x,l=H.y)}if(S.isConnected){const H=S.getConnectedValue(o);H&&(E=H.x,c=H.y,A=H.z)}return new O.d(E,c,A,l)};c._storedFunction=o=>h(o),A._storedFunction=o=>{const H=h(o);return new E.xH(H.r,H.g,H.b)},l._storedFunction=o=>{const H=h(o);return new E.Vector2(H.r,H.g)},x._storedFunction=o=>{const H=h(o);return new E.Vector2(H.b,H.a)},z._storedFunction=o=>h(o).r,V._storedFunction=o=>h(o).g,J._storedFunction=o=>h(o).b,N._storedFunction=o=>h(o).a}}),function(o){o[o.Cos=0]="Cos",o[o.Sin=1]="Sin",o[o.Abs=2]="Abs",o[o.Exp=3]="Exp",o[o.Exp2=4]="Exp2",o[o.Round=5]="Round",o[o.Floor=6]="Floor",o[o.Ceiling=7]="Ceiling",o[o.Sqrt=8]="Sqrt",o[o.Log=9]="Log",o[o.Tan=10]="Tan",o[o.ArcTan=11]="ArcTan",o[o.ArcCos=12]="ArcCos",o[o.ArcSin=13]="ArcSin",o[o.Sign=14]="Sign",o[o.Negate=15]="Negate",o[o.OneMinus=16]="OneMinus",o[o.Reciprocal=17]="Reciprocal",o[o.ToDegrees=18]="ToDegrees",o[o.ToRadians=19]="ToRadians",o[o.Fract=20]="Fract"}(wH||(wH={}));class cn extends uH{constructor(o){super(o),this.operation=wH.Cos,this.registerInput("input",FH.AutoDetect),this.registerOutput("output",FH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(FH.Float|FH.Int|FH.Vector2|FH.xH|FH.dY)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(o){super._build(o);let H=null;switch(this.operation){case wH.Cos:H=o=>Math.cos(o);break;case wH.Sin:H=o=>Math.sin(o);break;case wH.Abs:H=o=>Math.abs(o);break;case wH.Exp:H=o=>Math.exp(o);break;case wH.Exp2:H=o=>Math.pow(2,o);break;case wH.Round:H=o=>Math.round(o);break;case wH.Floor:H=o=>Math.floor(o);break;case wH.Ceiling:H=o=>Math.ceil(o);break;case wH.Sqrt:H=o=>Math.sqrt(o);break;case wH.Log:H=o=>Math.log(o);break;case wH.Tan:H=o=>Math.tan(o);break;case wH.ArcTan:H=o=>Math.atan(o);break;case wH.ArcCos:H=o=>Math.acos(o);break;case wH.ArcSin:H=o=>Math.asin(o);break;case wH.Sign:H=o=>Math.sign(o);break;case wH.Negate:H=o=>-o;break;case wH.OneMinus:H=o=>1-o;break;case wH.Reciprocal:H=o=>1/o;break;case wH.ToRadians:H=o=>o*Math.PI/180;break;case wH.ToDegrees:H=o=>180*o/Math.PI;break;case wH.Fract:H=o=>o>=0?o-Math.floor(o):o-Math.ceil(o)}if(!H)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case FH.Int:case FH.Float:this.output._storedFunction=o=>{const n=this.input.getConnectedValue(o);return H(n)};break;case FH.Vector2:this.output._storedFunction=o=>{const n=this.input.getConnectedValue(o);return new E.Vector2(H(n.x),H(n.y))};break;case FH.xH:this.output._storedFunction=o=>{const n=this.input.getConnectedValue(o);return new E.xH(H(n.x),H(n.y),H(n.z))};break;case FH.dY:this.output._storedFunction=o=>{const n=this.input.getConnectedValue(o);return new O.d(H(n.r),H(n.g),H(n.b),H(n.a))}}return this}serialize(){const o=super.serialize();return o.operation=this.operation,o}_deserialize(o){super._deserialize(o),this.operation=o.operation}}(0,f.c)([dH("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:wH.Cos},{label:"Sin",value:wH.Sin},{label:"Abs",value:wH.Abs},{label:"Exp",value:wH.Exp},{label:"Exp2",value:wH.Exp2},{label:"Round",value:wH.Round},{label:"Floor",value:wH.Floor},{label:"Ceiling",value:wH.Ceiling},{label:"Sqrt",value:wH.Sqrt},{label:"Log",value:wH.Log},{label:"Tan",value:wH.Tan},{label:"ArcTan",value:wH.ArcTan},{label:"ArcCos",value:wH.ArcCos},{label:"ArcSin",value:wH.ArcSin},{label:"Sign",value:wH.Sign},{label:"Negate",value:wH.Negate},{label:"OneMinus",value:wH.OneMinus},{label:"Reciprocal",value:wH.Reciprocal},{label:"ToDegrees",value:wH.ToDegrees},{label:"ToRadians",value:wH.ToRadians},{label:"Fract",value:wH.Fract}]})],cn.prototype,"operation",void 0),(0,Y.e)("BABYLON.ParticleTrigonometryBlock",cn);var An,ln=n(12620);class xn extends uH{constructor(o){super(o),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",FH.AutoDetect),this.registerOutput("output",FH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(FH.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(FH.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(FH.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(FH.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(FH.System),this._inputs[0].excludedConnectionPointTypes.push(FH.Particle),this._inputs[0].excludedConnectionPointTypes.push(FH.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(o){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const H=o=>{const H=this.input.getConnectedValue(o);if(this.log.length>=this.stackSize)return H;if(null===H||void 0===H)return this.log.push(["null",""]),H;switch(this.input.type){case FH.Vector2:this.log.push([(0,ln.i)(H,4),H.toString()]);break;case FH.xH:this.log.push([(0,ln.l)(H,4),H.toString()]);break;case FH.dY:this.log.push([`{R: ${H.r.toFixed(4)} G: ${H.g.toFixed(4)} B: ${H.b.toFixed(4)} A: ${H.a.toFixed(4)}}`,H.toString()]);break;default:this.log.push([H.toString(),H.toString()])}return H};this.output.isConnected?this.output._storedFunction=H:this.output._storedValue=H(o)}serialize(){const o=super.serialize();return o.stackSize=this.stackSize,o}_deserialize(o){super._deserialize(o),this.stackSize=o.stackSize}}(0,f.c)([dH("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],xn.prototype,"stackSize",void 0),(0,Y.e)("BABYLON.ParticleDebugBlock",xn);(0,Y.e)("BABYLON.ParticleElbowBlock",class extends uH{constructor(o){super(o),this.registerInput("input",FH.AutoDetect),this.registerOutput("output",FH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(o){super._build(o);const H=this._outputs[0],n=this._inputs[0];H._storedFunction=o=>n.getConnectedValue(o)}});(0,Y.e)("BABYLON.ParticleTeleportInBlock",class extends uH{get endpoints(){return this._endpoints}constructor(o){super(o),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",FH.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(o){if(this.getClassName()===o)return!0;for(const H of this.endpoints)if(H.isAnAncestorOfType(o))return!0;return!1}isAnAncestorOf(o){for(const H of this.endpoints){if(H===o)return!0;if(H.isAnAncestorOf(o))return!0}return!1}attachToEndpoint(o){o.detach(),this._endpoints.push(o),o._entryPoint=this,o._outputs[0]._typeConnectionSource=this._inputs[0],o._tempEntryPointUniqueId=null,o.name="> "+this.name}detachFromEndpoint(o){const H=this._endpoints.indexOf(o);-1!==H&&(this._endpoints.splice(H,1),o._outputs[0]._typeConnectionSource=null,o._entryPoint=null)}_build(){for(const o of this._endpoints)o.output._storedFunction=o=>this.input.getConnectedValue(o)}});(0,Y.e)("BABYLON.ParticleTeleportOutBlock",class extends uH{constructor(o){super(o),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",FH.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(o){this.entryPoint&&this.entryPoint.build(o)}clone(){const o=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(o),o}serialize(){var o;const H=super.serialize();return H.entryPoint=(null===(o=this.entryPoint)||void 0===o?void 0:o.uniqueId)??"",H}_deserialize(o){super._deserialize(o),this._tempEntryPointUniqueId=o.entryPoint}}),function(o){o[o.Equal=0]="Equal",o[o.NotEqual=1]="NotEqual",o[o.LessThan=2]="LessThan",o[o.GreaterThan=3]="GreaterThan",o[o.LessOrEqual=4]="LessOrEqual",o[o.GreaterOrEqual=5]="GreaterOrEqual",o[o.Xor=6]="Xor",o[o.Or=7]="Or",o[o.And=8]="And"}(An||(An={}));class zn extends uH{constructor(o){super(o),this.test=An.Equal,this.epsilon=0,this.registerInput("left",FH.Float),this.registerInput("right",FH.Float,!0,0),this.registerInput("ifTrue",FH.AutoDetect,!0,1),this.registerInput("ifFalse",FH.AutoDetect,!0,0),this.registerOutput("output",FH.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=FH.Float,this._inputs[0].acceptedConnectionPointTypes.push(FH.Int),this._inputs[1].acceptedConnectionPointTypes.push(FH.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const o=o=>{const H=this.left.getConnectedValue(o),n=this.right.getConnectedValue(o);let E=!1;switch(this.test){case An.Equal:E=(0,S.WithinEpsilon)(H,n,this.epsilon);break;case An.NotEqual:E=!(0,S.WithinEpsilon)(H,n,this.epsilon);break;case An.LessThan:E=H<n+this.epsilon;break;case An.GreaterThan:E=H>n-this.epsilon;break;case An.LessOrEqual:E=H<=n+this.epsilon;break;case An.GreaterOrEqual:E=H>=n-this.epsilon;break;case An.Xor:E=!!H&&!n||!H&&!!n;break;case An.Or:E=!!H||!!n;break;case An.And:E=!!H&&!!n}return E};this.output._storedFunction=H=>o(H)?this.ifTrue.getConnectedValue(H):this.ifFalse.getConnectedValue(H)}serialize(){const o=super.serialize();return o.test=this.test,o.epsilon=this.epsilon,o}_deserialize(o){super._deserialize(o),this.test=o.test,void 0!==o.epsilon&&(this.epsilon=o.epsilon)}}(0,f.c)([dH("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:An.Equal},{label:"NotEqual",value:An.NotEqual},{label:"LessThan",value:An.LessThan},{label:"GreaterThan",value:An.GreaterThan},{label:"LessOrEqual",value:An.LessOrEqual},{label:"GreaterOrEqual",value:An.GreaterOrEqual},{label:"Xor",value:An.Xor},{label:"Or",value:An.Or},{label:"And",value:An.And}]})],zn.prototype,"test",void 0),(0,f.c)([dH("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],zn.prototype,"epsilon",void 0),(0,Y.e)("BABYLON.ParticleConditionBlock",zn);class Vn extends uH{constructor(o){super(o),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",FH.Particle),this.registerInput("condition",FH.Float,!0,0),this.registerInput("system",FH.System),this.registerOutput("output",FH.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(o){this._triggerCount=0;const H=this.input.getConnectedValue(o),n={process:n=>{if(o.particleContext=n,o.systemContext=H,0!==this.condition.getConnectedValue(o)&&(0===this.limit||this._triggerCount<this.limit)){const E=(new Date).getTime();if(this._previousOne&&E-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=E;const k=this.system.getConnectedValue(o);if(k){const E=WH(k,o.VH,n.position);E.yg.addOnce((()=>{this._triggerCount--})),H.yg.addOnce((()=>{E.dispose()}))}}},previousItem:null,nextItem:null};H._updateQueueStart?so(n,H._updateQueueStart):H._updateQueueStart=n,this.output._storedValue=H}serialize(){const o=super.serialize();return o.limit=this.limit,o.delay=this.delay,o}_deserialize(o){super._deserialize(o),void 0!==o.limit&&(this.limit=o.limit),void 0!==o.delay&&(this.delay=o.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,f.c)([dH("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Vn.prototype,"limit",void 0),(0,f.c)([dH("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Vn.prototype,"delay",void 0),(0,Y.e)("BABYLON.ParticleTriggerBlock",Vn);n(12624),n(12632),n(12645),n(12709)},12688:(o,H,n)=>{"use strict";var E=n(11101);const k="clipPlaneFragment",g="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";E.d.IncludesShadersStoreWGSL[k]||(E.d.IncludesShadersStoreWGSL[k]=g)},12652:(o,H,n)=>{"use strict";var E=n(11101);const k="clipPlaneFragmentDeclaration",g="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";E.d.IncludesShadersStoreWGSL[k]||(E.d.IncludesShadersStoreWGSL[k]=g)},12720:(o,H,n)=>{"use strict";var E=n(11101);const k="clipPlaneVertex",g="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";E.d.IncludesShadersStoreWGSL[k]||(E.d.IncludesShadersStoreWGSL[k]=g)},12714:(o,H,n)=>{"use strict";var E=n(11101);const k="clipPlaneVertexDeclaration",g="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";E.d.IncludesShadersStoreWGSL[k]||(E.d.IncludesShadersStoreWGSL[k]=g)},12703:(o,H,n)=>{"use strict";var E=n(11101);const k="fogFragment",g="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";E.d.IncludesShadersStoreWGSL[k]||(E.d.IncludesShadersStoreWGSL[k]=g)},12684:(o,H,n)=>{"use strict";var E=n(11101);const k="fogFragmentDeclaration",g="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";E.d.IncludesShadersStoreWGSL[k]||(E.d.IncludesShadersStoreWGSL[k]=g)},12728:(o,H,n)=>{"use strict";var E=n(11101);const k="fogVertex",g="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";E.d.IncludesShadersStoreWGSL[k]||(E.d.IncludesShadersStoreWGSL[k]=g)},12717:(o,H,n)=>{"use strict";var E=n(11101);const k="fogVertexDeclaration",g="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";E.d.IncludesShadersStoreWGSL[k]||(E.d.IncludesShadersStoreWGSL[k]=g)},12670:(o,H,n)=>{"use strict";var E=n(11101);const k="helperFunctions",g="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";E.d.IncludesShadersStoreWGSL[k]||(E.d.IncludesShadersStoreWGSL[k]=g)},12659:(o,H,n)=>{"use strict";var E=n(11101);const k="imageProcessingDeclaration",g="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";E.d.IncludesShadersStoreWGSL[k]||(E.d.IncludesShadersStoreWGSL[k]=g)},12677:(o,H,n)=>{"use strict";var E=n(11101);const k="imageProcessingFunctions",g="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";E.d.IncludesShadersStoreWGSL[k]||(E.d.IncludesShadersStoreWGSL[k]=g)},12661:(o,H,n)=>{"use strict";var E=n(11101);const k="logDepthDeclaration",g="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";E.d.IncludesShadersStoreWGSL[k]||(E.d.IncludesShadersStoreWGSL[k]=g)},12696:(o,H,n)=>{"use strict";var E=n(11101);const k="logDepthFragment",g="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";E.d.IncludesShadersStoreWGSL[k]||(E.d.IncludesShadersStoreWGSL[k]=g)},12730:(o,H,n)=>{"use strict";var E=n(11101);const k="logDepthVertex",g="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";E.d.IncludesShadersStoreWGSL[k]||(E.d.IncludesShadersStoreWGSL[k]=g)},12645:(o,H,n)=>{"use strict";n.r(H),n.d(H,{particlesPixelShaderWGSL:()=>O});var E=n(11101);n(12652),n(12659),n(12661),n(12670),n(12677),n(12684),n(12688),n(12696),n(12703);const k="particlesPixelShader",g="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";E.d.ShadersStoreWGSL[k]||(E.d.ShadersStoreWGSL[k]=g);const O={name:k,shader:g}},12709:(o,H,n)=>{"use strict";n.r(H),n.d(H,{particlesVertexShaderWGSL:()=>O});var E=n(11101);n(12714),n(12717),n(12661),n(12720),n(12728),n(12730);const k="particlesVertexShader",g="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";E.d.ShadersStoreWGSL[k]||(E.d.ShadersStoreWGSL[k]=g);const O={name:k,shader:g}},12554:(o,H,n)=>{"use strict";var E=n(11101);const k="clipPlaneFragment",g="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";E.d.IncludesShadersStore[k]||(E.d.IncludesShadersStore[k]=g)},12627:(o,H,n)=>{"use strict";var E=n(11101);const k="clipPlaneFragmentDeclaration",g="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";E.d.IncludesShadersStore[k]||(E.d.IncludesShadersStore[k]=g)},12577:(o,H,n)=>{"use strict";var E=n(11101);const k="clipPlaneVertex",g="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";E.d.IncludesShadersStore[k]||(E.d.IncludesShadersStore[k]=g)},12640:(o,H,n)=>{"use strict";var E=n(11101);const k="clipPlaneVertexDeclaration",g="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";E.d.IncludesShadersStore[k]||(E.d.IncludesShadersStore[k]=g)},12562:(o,H,n)=>{"use strict";var E=n(11101);const k="fogFragment",g="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";E.d.IncludesShadersStore[k]||(E.d.IncludesShadersStore[k]=g)},12552:(o,H,n)=>{"use strict";var E=n(11101);const k="fogFragmentDeclaration",g="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";E.d.IncludesShadersStore[k]||(E.d.IncludesShadersStore[k]=g)},12583:(o,H,n)=>{"use strict";var E=n(11101);const k="fogVertex",g="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";E.d.IncludesShadersStore[k]||(E.d.IncludesShadersStore[k]=g)},12571:(o,H,n)=>{"use strict";var E=n(11101);const k="fogVertexDeclaration",g="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";E.d.IncludesShadersStore[k]||(E.d.IncludesShadersStore[k]=g)},12545:(o,H,n)=>{"use strict";var E=n(11101);const k="helperFunctions",g="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";E.d.IncludesShadersStore[k]||(E.d.IncludesShadersStore[k]=g)},12533:(o,H,n)=>{"use strict";var E=n(11101);const k="imageProcessingDeclaration",g="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";E.d.IncludesShadersStore[k]||(E.d.IncludesShadersStore[k]=g)},12548:(o,H,n)=>{"use strict";var E=n(11101);const k="imageProcessingFunctions",g="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";E.d.IncludesShadersStore[k]||(E.d.IncludesShadersStore[k]=g)},12541:(o,H,n)=>{"use strict";var E=n(11101);const k="logDepthDeclaration",g="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";E.d.IncludesShadersStore[k]||(E.d.IncludesShadersStore[k]=g)},12559:(o,H,n)=>{"use strict";var E=n(11101);const k="logDepthFragment",g="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";E.d.IncludesShadersStore[k]||(E.d.IncludesShadersStore[k]=g)},12586:(o,H,n)=>{"use strict";var E=n(11101);const k="logDepthVertex",g="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";E.d.IncludesShadersStore[k]||(E.d.IncludesShadersStore[k]=g)},12624:(o,H,n)=>{"use strict";n.r(H),n.d(H,{particlesPixelShader:()=>O});var E=n(11101);n(12627),n(12533),n(12541),n(12545),n(12548),n(12552),n(12554),n(12559),n(12562);const k="particlesPixelShader",g="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";E.d.ShadersStore[k]||(E.d.ShadersStore[k]=g);const O={name:k,shader:g}},12632:(o,H,n)=>{"use strict";n.r(H),n.d(H,{particlesVertexShader:()=>O});var E=n(11101);n(12640),n(12571),n(12541),n(12577),n(12583),n(12586);const k="particlesVertexShader",g="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";E.d.ShadersStore[k]||(E.d.ShadersStore[k]=g);const O={name:k,shader:g}},12989:(o,H,n)=>{"use strict";n.r(H),n.d(H,{FlowGraphGLTFDataProvider:()=>g});var E=n(12956),k=n(12933);class g extends E.c{constructor(o){var H,n;super();const E=o.glTF,g=(null===(H=E.animations)||void 0===H?void 0:H.map((o=>o._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",k.b,g);const O=(null===(n=E.nodes)||void 0===n?void 0:n.map((o=>o._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",k.b,O)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12876:(o,H,n)=>{"use strict";n.d(H,{b:()=>V,d:()=>x,f:()=>l,i:()=>z});var E=n(11189),k=n(11683),g=n(11238),O=n(12878);const Y=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class y{constructor(o,H){this._gltf=o,this._infoTree=H}convert(o){let H,n=this._gltf,E=this._infoTree;if(!o.startsWith("/"))throw new Error("Path must start with a /");const k=o.split("/");if(k.shift(),k[k.length-1].includes(".length")){const o=k[k.length-1].split(".");k.pop(),k.push(...o)}let g=!1;for(const y of k){const k="length"===y;if(k&&!E.__array__)throw new Error(`Path ${o} is invalid`);if(E.__ignoreObjectTree__&&(g=!0),E.__array__&&!k)E=E.__array__;else if(E=E[y],!E)throw new Error(`Path ${o} is invalid`);if(!g)if(void 0===n){if(!Y.find((H=>H.regex.test(o))))throw new Error(`Path ${o} is invalid`)}else if(!k){var O;n=null===(O=n)||void 0===O?void 0:O[y]}(E.__target__||k)&&(H=n)}return{object:H,info:E}}}function S(o,H,n,E){const k=G(o,H);return E?k[n][E]:k[n]}function G(o,H,n){var E,g;return null===(E=o._data)||void 0===E||null===(g=E[(null===n||void 0===n?void 0:n.fillMode)??k.b.MATERIAL_TriangleFillMode])||void 0===g?void 0:g.babylonMaterial}function c(o,H){return{offset:{componentsCount:2,type:"Vector2",get:(n,k,g)=>{const O=S(n,g,o,H);return new E.Vector2(null===O||void 0===O?void 0:O.uOffset,null===O||void 0===O?void 0:O.vOffset)},getTarget:G,set:(n,E,k,g)=>{const O=S(E,g,o,H);O.uOffset=n.x,O.vOffset=n.y},getPropertyName:[()=>`${o}${H?"."+H:""}.uOffset`,()=>`${o}${H?"."+H:""}.vOffset`]},rotation:{type:"number",get:(n,E,k)=>{var g;return null===(g=S(n,k,o,H))||void 0===g?void 0:g.wAng},getTarget:G,set:(n,E,k,g)=>S(E,g,o,H).wAng=n,getPropertyName:[()=>`${o}${H?"."+H:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(n,k,g)=>{const O=S(n,g,o,H);return new E.Vector2(null===O||void 0===O?void 0:O.uScale,null===O||void 0===O?void 0:O.vScale)},getTarget:G,set:(n,E,k,g)=>{const O=S(E,g,o,H);O.uScale=n.x,O.vScale=n.y},getPropertyName:[()=>`${o}${H?"."+H:""}.uScale`,()=>`${o}${H?"."+H:""}.vScale`]}}}const A={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:o=>{var H,n;return new E.Vector2((null===(H=o._babylonCamera)||void 0===H?void 0:H.orthoLeft)??0,(null===(n=o._babylonCamera)||void 0===n?void 0:n.orthoRight)??0)},set:(o,H)=>{H._babylonCamera&&(H._babylonCamera.orthoLeft=o.x,H._babylonCamera.orthoRight=o.y)},getTarget:o=>o,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:o=>{var H,n;return new E.Vector2((null===(H=o._babylonCamera)||void 0===H?void 0:H.orthoBottom)??0,(null===(n=o._babylonCamera)||void 0===n?void 0:n.orthoTop)??0)},set:(o,H)=>{H._babylonCamera&&(H._babylonCamera.orthoBottom=o.x,H._babylonCamera.orthoTop=o.y)},getTarget:o=>o,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:o=>{var H;return null===(H=o._babylonCamera)||void 0===H?void 0:H.maxZ},set:(o,H)=>{H._babylonCamera&&(H._babylonCamera.maxZ=o)},getTarget:o=>o,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:o=>{var H;return null===(H=o._babylonCamera)||void 0===H?void 0:H.Cg},set:(o,H)=>{H._babylonCamera&&(H._babylonCamera.Cg=o)},getTarget:o=>o,getPropertyName:[()=>"Cg"]}},perspective:{aspectRatio:{type:"number",get:o=>{var H;return null===(H=o._babylonCamera)||void 0===H?void 0:H.getEngine().getAspectRatio(o._babylonCamera)},getTarget:o=>o,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:o=>{var H;return null===(H=o._babylonCamera)||void 0===H?void 0:H.fov},set:(o,H)=>{H._babylonCamera&&(H._babylonCamera.fov=o)},getTarget:o=>o,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:o=>{var H;return null===(H=o._babylonCamera)||void 0===H?void 0:H.maxZ},set:(o,H)=>{H._babylonCamera&&(H._babylonCamera.maxZ=o)},getTarget:o=>o,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:o=>{var H;return null===(H=o._babylonCamera)||void 0===H?void 0:H.Cg},set:(o,H)=>{H._babylonCamera&&(H._babylonCamera.Cg=o)},getTarget:o=>o,getPropertyName:[()=>"Cg"]}}}},nodes:{length:{type:"number",get:o=>o.length,getTarget:o=>o.map((o=>o._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"xH",get:o=>{var H;return null===(H=o._babylonTransformNode)||void 0===H?void 0:H.position},set:(o,H)=>{var n;return null===(n=H._babylonTransformNode)||void 0===n?void 0:n.position.S(o)},getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:o=>{var H;return null===(H=o._babylonTransformNode)||void 0===H?void 0:H.rotationQuaternion},set:(o,H)=>{var n,E;return null===(n=H._babylonTransformNode)||void 0===n||null===(E=n.rotationQuaternion)||void 0===E?void 0:E.S(o)},getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"xH",get:o=>{var H;return null===(H=o._babylonTransformNode)||void 0===H?void 0:H.cY},set:(o,H)=>{var n;return null===(n=H._babylonTransformNode)||void 0===n?void 0:n.cY.S(o)},getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"cY"]},weights:{length:{type:"number",get:o=>o._numMorphTargets,getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(o,H)=>{var n,E;return void 0!==H?null===(n=o._primitiveBabylonMeshes)||void 0===n||null===(E=n[0].morphTargetManager)||void 0===E?void 0:E.getTarget(H).influence:void 0},getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(o,H)=>[0],getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:o=>{var H,n,k;return E.Matrix.Compose(null===(H=o._babylonTransformNode)||void 0===H?void 0:H.cY,null===(n=o._babylonTransformNode)||void 0===n?void 0:n.rotationQuaternion,null===(k=o._babylonTransformNode)||void 0===k?void 0:k.position)},getTarget:o=>o._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:o=>{var H,n,k,g;const O=E.Matrix.Identity();let Y=o.parent;for(;Y&&Y.parent;)Y=Y.parent;const y=(null===(H=o._babylonTransformNode)||void 0===H?void 0:H.position._isDirty)||(null===(n=o._babylonTransformNode)||void 0===n||null===(k=n.rotationQuaternion)||void 0===k?void 0:k._isDirty)||(null===(g=o._babylonTransformNode)||void 0===g?void 0:g.cY._isDirty);if(Y){var S;const H=null===(S=Y._babylonTransformNode)||void 0===S?void 0:S.Ig(!0).invert();var G,c;if(H)null===(G=o._babylonTransformNode)||void 0===G||null===(c=G.Ig(y))||void 0===c||c.multiplyToRef(H,O)}else o._babylonTransformNode&&O.S(o._babylonTransformNode.Ig(y));return O},getTarget:o=>o._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:o=>{var H,n;return null===(H=o._babylonTransformNode)||void 0===H||null===(n=H.getChildren((o=>o instanceof O.d),!0)[0])||void 0===n?void 0:n.zY},getTarget:o=>{var H;return null===(H=o._babylonTransformNode)||void 0===H?void 0:H.getChildren((o=>o instanceof O.d),!0)[0]},set:(o,H)=>{if(H._babylonTransformNode){const n=H._babylonTransformNode.getChildren((o=>o instanceof O.d),!0)[0];n&&(n.zY=o)}}},color:{type:"NH",get:o=>{var H,n;return null===(H=o._babylonTransformNode)||void 0===H||null===(n=H.getChildren((o=>o instanceof O.d),!0)[0])||void 0===n?void 0:n.VY},getTarget:o=>{var H;return null===(H=o._babylonTransformNode)||void 0===H?void 0:H.getChildren((o=>o instanceof O.d),!0)[0]},set:(o,H)=>{if(H._babylonTransformNode){const n=H._babylonTransformNode.getChildren((o=>o instanceof O.d),!0)[0];n&&(n.VY=o)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"NH",get:(o,H,n)=>G(o,H,n).emissiveColor,set:(o,H,n,E)=>G(H,n,E).emissiveColor.S(o),getTarget:(o,H,n)=>G(o,H,n),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:c("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(o,H,n)=>{var E;return null===(E=S(o,n,"bumpTexture"))||void 0===E?void 0:E.level},set:(o,H,n,E)=>{const k=S(H,E,"bumpTexture");k&&(k.level=o)},getTarget:(o,H,n)=>G(o,H,n),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:c("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(o,H,n)=>G(o,H,n).ambientTextureStrength,set:(o,H,n,E)=>{const k=G(H,n,E);k&&(k.ambientTextureStrength=o)},getTarget:(o,H,n)=>G(o,H,n),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:c("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"dY",get:(o,H,n)=>{const E=G(o,H,n);return g.d.FromColor3(E.albedoColor,E.alpha)},set:(o,H,n,E)=>{const k=G(H,n,E);k.albedoColor.set(o.r,o.g,o.b),k.alpha=o.a},getTarget:(o,H,n)=>G(o,H,n),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:c("albedoTexture")}},metallicFactor:{type:"number",get:(o,H,n)=>G(o,H,n).metallic,set:(o,H,n,E)=>{const k=G(H,n,E);k&&(k.metallic=o)},getTarget:(o,H,n)=>G(o,H,n),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(o,H,n)=>G(o,H,n).roughness,set:(o,H,n,E)=>{const k=G(H,n,E);k&&(k.roughness=o)},getTarget:(o,H,n)=>G(o,H,n),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:c("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(o,H,n)=>G(o,H,n).anisotropy.zY,set:(o,H,n,E)=>{G(H,n,E).anisotropy.zY=o},getTarget:(o,H,n)=>G(o,H,n),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(o,H,n)=>G(o,H,n).anisotropy.angle,set:(o,H,n,E)=>{G(H,n,E).anisotropy.angle=o},getTarget:(o,H,n)=>G(o,H,n),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:c("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(o,H,n)=>G(o,H,n).clearCoat.zY,set:(o,H,n,E)=>{G(H,n,E).clearCoat.zY=o},getTarget:(o,H,n)=>G(o,H,n),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(o,H,n)=>G(o,H,n).clearCoat.roughness,set:(o,H,n,E)=>{G(H,n,E).clearCoat.roughness=o},getTarget:(o,H,n)=>G(o,H,n),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:c("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(o,H,n)=>{var E;return null===(E=G(o,H,n).clearCoat.bumpTexture)||void 0===E?void 0:E.level},getTarget:G,set:(o,H,n,E)=>G(H,n,E).clearCoat.bumpTexture.level=o},extensions:{KHR_texture_transform:c("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:c("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(o,H,n)=>G(o,H,n).subSurface.dispersion,getTarget:G,set:(o,H,n,E)=>G(H,n,E).subSurface.dispersion=o}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(o,H,n)=>G(o,H,n).emissiveIntensity,getTarget:G,set:(o,H,n,E)=>G(H,n,E).emissiveIntensity=o}},KHR_materials_ior:{ior:{type:"number",get:(o,H,n)=>G(o,H,n).indexOfRefraction,getTarget:G,set:(o,H,n,E)=>G(H,n,E).indexOfRefraction=o}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(o,H,n)=>G(o,H,n).iridescence.zY,getTarget:G,set:(o,H,n,E)=>G(H,n,E).iridescence.zY=o},iridescenceIor:{type:"number",get:(o,H,n)=>G(o,H,n).iridescence.indexOfRefraction,getTarget:G,set:(o,H,n,E)=>G(H,n,E).iridescence.indexOfRefraction=o},iridescenceTexture:{extensions:{KHR_texture_transform:c("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(o,H,n)=>G(o,H,n).iridescence.maximumThickness,getTarget:G,set:(o,H,n,E)=>G(H,n,E).iridescence.maximumThickness=o},iridescenceThicknessMinimum:{type:"number",get:(o,H,n)=>G(o,H,n).iridescence.minimumThickness,getTarget:G,set:(o,H,n,E)=>G(H,n,E).iridescence.minimumThickness=o},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:c("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"NH",get:(o,H,n)=>G(o,H,n).sheen.color,getTarget:G,set:(o,H,n,E)=>G(H,n,E).sheen.color.S(o)},sheenColorTexture:{extensions:{KHR_texture_transform:c("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(o,H,n)=>G(o,H,n).sheen.zY,getTarget:G,set:(o,H,n,E)=>G(H,n,E).sheen.zY=o},sheenRoughnessTexture:{extensions:{KHR_texture_transform:c("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(o,H,n)=>G(o,H,n).metallicF0Factor,getTarget:G,set:(o,H,n,E)=>G(H,n,E).metallicF0Factor=o,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"NH",get:(o,H,n)=>G(o,H,n).metallicReflectanceColor,getTarget:G,set:(o,H,n,E)=>G(H,n,E).metallicReflectanceColor.S(o),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:c("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:c("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(o,H,n)=>G(o,H,n).subSurface.refractionIntensity,getTarget:G,set:(o,H,n,E)=>G(H,n,E).subSurface.refractionIntensity=o,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:c("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(o,H,n)=>G(o,H,n).subSurface.translucencyIntensity,getTarget:G,set:(o,H,n,E)=>G(H,n,E).subSurface.translucencyIntensity=o},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:c("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"NH",get:(o,H,n)=>G(o,H,n).subSurface.translucencyColor,getTarget:G,set:(o,H,n,E)=>{var k;return o&&(null===(k=G(H,n,E).subSurface.translucencyColor)||void 0===k?void 0:k.S(o))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:c("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"NH",get:(o,H,n)=>G(o,H,n).subSurface.tintColor,getTarget:G,set:(o,H,n,E)=>G(H,n,E).subSurface.tintColor.S(o)},attenuationDistance:{type:"number",get:(o,H,n)=>G(o,H,n).subSurface.tintColorAtDistance,getTarget:G,set:(o,H,n,E)=>G(H,n,E).subSurface.tintColorAtDistance=o},thicknessFactor:{type:"number",get:(o,H,n)=>G(o,H,n).subSurface.maximumThickness,getTarget:G,set:(o,H,n,E)=>G(H,n,E).subSurface.maximumThickness=o},thicknessTexture:{extensions:{KHR_texture_transform:c("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:o=>o.length,getTarget:o=>o.map((o=>o._babylonLight)),getPropertyName:[o=>"length"]},__array__:{__target__:!0,color:{type:"NH",get:o=>{var H;return null===(H=o._babylonLight)||void 0===H?void 0:H.VY},set:(o,H)=>{var n;return null===(n=H._babylonLight)||void 0===n?void 0:n.VY.S(o)},getTarget:o=>o._babylonLight,getPropertyName:[o=>"diffuse"]},zY:{type:"number",get:o=>{var H;return null===(H=o._babylonLight)||void 0===H?void 0:H.zY},set:(o,H)=>H._babylonLight?H._babylonLight.zY=o:void 0,getTarget:o=>o._babylonLight,getPropertyName:[o=>"intensity"]},range:{type:"number",get:o=>{var H;return null===(H=o._babylonLight)||void 0===H?void 0:H.range},set:(o,H)=>H._babylonLight?H._babylonLight.range=o:void 0,getTarget:o=>o._babylonLight,getPropertyName:[o=>"range"]},spot:{innerConeAngle:{type:"number",get:o=>{var H;return null===(H=o._babylonLight)||void 0===H?void 0:H.innerAngle},set:(o,H)=>H._babylonLight?H._babylonLight.innerAngle=o:void 0,getTarget:o=>o._babylonLight,getPropertyName:[o=>"innerConeAngle"]},outerConeAngle:{type:"number",get:o=>{var H;return null===(H=o._babylonLight)||void 0===H?void 0:H.angle},set:(o,H)=>H._babylonLight?H._babylonLight.angle=o:void 0,getTarget:o=>o._babylonLight,getPropertyName:[o=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:o=>o.length,getTarget:o=>o.map((o=>o._babylonLight)),getPropertyName:[o=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:o=>o.length,getTarget:o=>o.map((o=>o._babylonTexture)),getPropertyName:[o=>"length"]},__array__:{__target__:!0,zY:{type:"number",get:o=>{var H;return null===(H=o._babylonTexture)||void 0===H?void 0:H.level},set:(o,H)=>{H._babylonTexture&&(H._babylonTexture.level=o)},getTarget:o=>o._babylonTexture},rotation:{type:"Quaternion",get:o=>{var H;return o._babylonTexture&&E.Quaternion.FromRotationMatrix(null===(H=o._babylonTexture)||void 0===H?void 0:H.getReflectionTextureMatrix())},set:(o,H)=>{var n;H._babylonTexture&&(null!==(n=H._babylonTexture.bo())&&void 0!==n&&n.useRightHandedSystem||(o=E.Quaternion.Inverse(o)),E.Matrix.FromQuaternionToRef(o,H._babylonTexture.getReflectionTextureMatrix()))},getTarget:o=>o._babylonTexture}}}}},animations:{length:{type:"number",get:o=>o.length,getTarget:o=>o.map((o=>o._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:o=>o.length,getTarget:o=>o.map((o=>{var H;return null===(H=o.primitives[0]._instanceData)||void 0===H?void 0:H.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function l(o){return new y(o,A)}function x(o){const H=o.split("/").map((o=>o.replace(/{}/g,"__array__")));let n=A;for(const E of H)E&&(n=n[E]);if(n&&n.type&&n.get)return n}function z(o,H){const n=o.split("/").map((o=>o.replace(/{}/g,"__array__")));let E=A;for(const k of n)k&&(E=E[k]);E&&E.type&&E.get&&(E.interpolation=H)}function V(o,H){const n=o.split("/").map((o=>o.replace(/{}/g,"__array__")));let E=A;for(const k of n)if(k){if(!E[k]){if("?"===k){E.__ignoreObjectTree__=!0;continue}E[k]={},"__array__"===k&&(E[k].__target__=!0)}E=E[k]}Object.assign(E,H)}},12887:(o,H,n)=>{"use strict";n.r(H),n.d(H,{AnimationPropertyInfo:()=>S,TransformNodeAnimationPropertyInfo:()=>G,WeightAnimationPropertyInfo:()=>c,getQuaternion:()=>Y,getVector3:()=>O,getWeights:()=>y});var E=n(11717),k=n(11189),g=n(12876);function O(o,H,n,E){return k.xH.Mg(H,n).scaleInPlace(E)}function Y(o,H,n,E){return k.Quaternion.Mg(H,n).scaleInPlace(E)}function y(o,H,n,E){const k=new Array(o._numMorphTargets);for(let g=0;g<k.length;g++)k[g]=H[n++]*E;return k}class S{constructor(o,H,n,E){this.type=o,this.name=H,this.getValue=n,this.getStride=E}_buildAnimation(o,H,n){const k=new E.b(o,this.name,H,this.type);return k.setKeys(n),k}}class G extends S{buildAnimations(o,H,n,E){const k=[];return k.push({babylonAnimatable:o._babylonTransformNode,babylonAnimation:this._buildAnimation(H,n,E)}),k}}class c extends S{buildAnimations(o,H,n,k){const g=[];if(o._numMorphTargets)for(let O=0;O<o._numMorphTargets;O++){const Y=new E.b(`${H}_${O}`,this.name,n,this.type);if(Y.setKeys(k.map((o=>({frame:o.frame,inTangent:o.inTangent?o.inTangent[O]:void 0,value:o.value[O],outTangent:o.outTangent?o.outTangent[O]:void 0,interpolation:o.interpolation})))),o._primitiveBabylonMeshes)for(const H of o._primitiveBabylonMeshes)if(H.morphTargetManager){const o=H.morphTargetManager.getTarget(O),n=Y.clone();o.animations.push(n),g.push({babylonAnimatable:o,babylonAnimation:n})}}return g}}(0,g.i)("/nodes/{}/translation",[new G(E.b.ANIMATIONTYPE_VECTOR3,"position",O,(()=>3))]),(0,g.i)("/nodes/{}/rotation",[new G(E.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",Y,(()=>4))]),(0,g.i)("/nodes/{}/scale",[new G(E.b.ANIMATIONTYPE_VECTOR3,"cY",O,(()=>3))]),(0,g.i)("/nodes/{}/weights",[new c(E.b.ANIMATIONTYPE_FLOAT,"influence",y,(o=>o._numMorphTargets))])},12826:(o,H,n)=>{"use strict";class E{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((o,H)=>{this._resolve=o,this._reject=H}))}}var k=n(11189),g=n(11238),O=n(11024),Y=n(11659),y=n(12835),S=n(12851),G=n(11026),c=n(11680),A=n(11717),l=n(11726),x=n(11060),z=n(11038),V=n(11040);class J{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(o){this._useTextureToStoreBoneMatrices=o,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(o){this._animationPropertiesOverride=o}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(o,H,n){this.name=o,this.id=H,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=k.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new G.d,this.bones=[],this._scene=n||x.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const E=this._scene.getEngine().getCaps();this._canUseTextureForBones=E.textureFloat&&E.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((o=>!o.getParent()))}getTransformMatrices(o){if(this.needInitialSkinMatrix){if(!o)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return o._bonesTransformMatrices||this.prepare(!0),o._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(o){return this.needInitialSkinMatrix&&o._transformMatrixTexture?o._transformMatrixTexture:this._transformMatrixTexture}bo(){return this._scene}toString(o){let H=`Name: ${this.name}, nBones: ${this.bones.length}`;if(H+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,o){H+=", Ranges: {";let o=!0;for(const n in this._ranges)o&&(H+=", ",o=!1),H+=n;H+="}"}return H}getBoneIndexByName(o){for(let H=0,n=this.bones.length;H<n;H++)if(this.bones[H].name===o)return H;return-1}createAnimationRange(o,H,n){if(!this._ranges[o]){this._ranges[o]=new l.c(o,H,n);for(let E=0,k=this.bones.length;E<k;E++)this.bones[E].animations[0]&&this.bones[E].animations[0].createRange(o,H,n)}}deleteAnimationRange(o){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let n=0,E=this.bones.length;n<E;n++)this.bones[n].animations[0]&&this.bones[n].animations[0].deleteRange(o,H);this._ranges[o]=null}getAnimationRange(o){return this._ranges[o]||null}getAnimationRanges(){const o=[];let H;for(H in this._ranges)o.push(this._ranges[H]);return o}copyAnimationRange(o,H){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[H]||!o.getAnimationRange(H))return!1;let E=!0;const k=this._getHighestAnimationFrame()+1,g={},O=o.bones;let Y,y;for(y=0,Y=O.length;y<Y;y++)g[O[y].name]=O[y];this.bones.length!==O.length&&(z.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${O.length}`),E=!1);const S=n&&this.dimensionsAtRest&&o.dimensionsAtRest?this.dimensionsAtRest.divide(o.dimensionsAtRest):null;for(y=0,Y=this.bones.length;y<Y;y++){const o=this.bones[y].name,O=g[o];O?E=E&&this.bones[y].copyAnimationRange(O,H,k,n,S):(z.d.Warn("copyAnimationRange: not same rig, missing source bone "+o),E=!1)}const G=o.getAnimationRange(H);return G&&(this._ranges[H]=new l.c(H,G.from+k,G.to+k)),E}returnToRest(){for(const o of this.bones)-1!==o._index&&o.returnToRest()}_getHighestAnimationFrame(){let o=0;for(let H=0,n=this.bones.length;H<n;H++)if(this.bones[H].animations[0]){const n=this.bones[H].animations[0].getHighestFrame();o<n&&(o=n)}return o}beginAnimation(o,H,n,E){const k=this.getAnimationRange(o);return k?this._scene.beginAnimation(this,k.from,k.to,H,n,E):null}static MakeAnimationAdditive(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const E=o.getAnimationRange(n);if(!E)return null;const k=o._scene.getAllAnimatablesByTarget(o);let g=null;for(let Y=0;Y<k.length;Y++){const o=k[Y];if(o.fromFrame===(null===E||void 0===E?void 0:E.from)&&o.toFrame===(null===E||void 0===E?void 0:E.to)){g=o;break}}const O=o.getAnimatables();for(let Y=0;Y<O.length;Y++){const o=O[Y].animations;if(o)for(let E=0;E<o.length;E++)A.b.MakeAnimationAdditive(o[E],H,n)}return g&&(g.isAdditive=!0),o}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(o){this._meshesWithPoseMatrix.push(o)}_unregisterMeshWithPoseMatrix(o){const H=this._meshesWithPoseMatrix.indexOf(o);H>-1&&this._meshesWithPoseMatrix.splice(H,1)}_computeTransformMatrices(o,H){this.onBeforeComputeObservable.notifyObservers(this);for(let n=0;n<this.bones.length;n++){const E=this.bones[n];E._childUpdateId++;const k=E.getParent();if(k?E.getLocalMatrix().multiplyToRef(k.getFinalMatrix(),E.getFinalMatrix()):H?E.getLocalMatrix().multiplyToRef(H,E.getFinalMatrix()):E.getFinalMatrix().S(E.getLocalMatrix()),-1!==E._index){const H=null===E._index?n:E._index;E.getAbsoluteInverseBindMatrix().multiplyToArray(E.getFinalMatrix(),o,16*H)}}this._identity.copyToArray(o,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const o=this.bo().getRenderId();if(this._currentRenderId===o)return;this._currentRenderId=o}if(this._numBonesWithLinkedTransformNode>0)for(const o of this.bones)if(o._linkedTransformNode){const H=o._linkedTransformNode;o.position=H.position,H.rotationQuaternion?o.rotationQuaternion=H.rotationQuaternion:o.rotation=H.rotation,o.cY=H.cY}if(this.needInitialSkinMatrix)for(const o of this._meshesWithPoseMatrix){const H=o.getPoseMatrix();let n=this._isDirty;if(o._bonesTransformMatrices&&o._bonesTransformMatrices.length===16*(this.bones.length+1)||(o._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),n=!0),n){if(this._synchronizedWithMesh!==o){this._synchronizedWithMesh=o;for(const o of this.bones)if(!o.getParent()){o.getBindMatrix().multiplyToRef(H,k.TmpVectors.Matrix[1]),o._updateAbsoluteBindMatrices(k.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const H=4*(this.bones.length+1);o._transformMatrixTexture&&o._transformMatrixTexture.getSize().width===H||(o._transformMatrixTexture&&o._transformMatrixTexture.dispose(),o._transformMatrixTexture=c.b.CreateRGBATexture(o._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(o._bonesTransformMatrices,H),this.isUsingTextureForMatrices&&o._transformMatrixTexture&&o._transformMatrixTexture.update(o._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=c.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let o=0;o<this.bones.length;o++)this._animatables.push(this.bones[o])}return this._animatables}clone(o,H){const n=new J(o,H||o,this._scene);n.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let E=0;E<this.bones.length;E++){const o=this.bones[E];let H=null;const k=o.getParent();if(k){const o=this.bones.indexOf(k);H=n.bones[o]}const g=new S.b(o.name,n,H,o.getBindMatrix().clone(),o.getRestMatrix().clone());g._index=o._index,o._linkedTransformNode&&g.linkTransformNode(o._linkedTransformNode),V.b.DeepCopy(o.animations,g.animations)}if(this._ranges){n._ranges={};for(const o in this._ranges){const H=this._ranges[o];H&&(n._ranges[o]=H.clone())}}return this._isDirty=!0,n.prepare(!0),n}enableBlending(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const H of this.bones)for(const n of H.animations)n.enableBlending=!0,n.blendingSpeed=o}dispose(){if(this._meshesWithPoseMatrix.length=0,this.bo().stopAnimation(this),this.bo().removeSkeleton(this),this._parentContainer){const o=this._parentContainer.skeletons.indexOf(this);o>-1&&this._parentContainer.skeletons.splice(o,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const o={};o.name=this.name,o.id=this.id,this.dimensionsAtRest&&(o.dimensionsAtRest=this.dimensionsAtRest.bg()),o.bones=[],o.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let n=0;n<this.bones.length;n++){var H;const E=this.bones[n],k=E.getParent(),g={parentBoneIndex:k?this.bones.indexOf(k):-1,index:E.getIndex(),name:E.name,id:E.id,matrix:E.getBindMatrix().bg(),rest:E.getRestMatrix().bg(),linkedTransformNodeId:null===(H=E.getTransformNode())||void 0===H?void 0:H.id};o.bones.push(g),E.length&&(g.length=E.length),E.metadata&&(g.metadata=E.metadata),E.animations&&E.animations.length>0&&(g.animation=E.animations[0].serialize()),o.ranges=[];for(const H in this._ranges){const n=this._ranges[H];if(!n)continue;const E={};E.name=H,E.from=n.from,E.to=n.to,o.ranges.push(E)}}return o}static Parse(o,H){const n=new J(o.name,o.id,H);let E;for(o.dimensionsAtRest&&(n.dimensionsAtRest=k.xH.Mg(o.dimensionsAtRest)),n.needInitialSkinMatrix=o.needInitialSkinMatrix,E=0;E<o.bones.length;E++){const H=o.bones[E],g=o.bones[E].index;let O=null;H.parentBoneIndex>-1&&(O=n.bones[H.parentBoneIndex]);const Y=H.rest?k.Matrix.Mg(H.rest):null,y=new S.b(H.name,n,O,k.Matrix.Mg(H.matrix),Y,null,g);void 0!==H.id&&null!==H.id&&(y.id=H.id),H.length&&(y.length=H.length),H.metadata&&(y.metadata=H.metadata),H.animation&&y.animations.push(A.b.Parse(H.animation)),void 0!==H.linkedTransformNodeId&&null!==H.linkedTransformNodeId&&(n._hasWaitingData=!0,y._waitingTransformNodeId=H.linkedTransformNodeId)}if(o.ranges)for(E=0;E<o.ranges.length;E++){const H=o.ranges[E];n.createAnimationRange(H.name,H.from,H.to)}return n}computeAbsoluteMatrices(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||o)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(o)}getPoseMatrix(){let o=null;return this._meshesWithPoseMatrix.length>0&&(o=this._meshesWithPoseMatrix[0].getPoseMatrix()),o}sortBones(){const o=[],H=new Array(this.bones.length);for(let n=0;n<this.bones.length;n++)this._sortBones(n,o,H);this.bones=o}_sortBones(o,H,n){if(n[o])return;n[o]=!0;const E=this.bones[o];if(!E)return;void 0===E._index&&(E._index=o);const k=E.getParent();k&&this._sortBones(this.bones.indexOf(k),H,n),H.push(E)}setCurrentPoseAsRest(){for(const o of this.bones)o.setCurrentPoseAsRest()}}var N=n(11529),h=n(11688),Q=n(11168),p=n(11620),j=n(11259),m=n(11664),P=n(11626),b=n(11652),e=n(11730),Z=n(11289),M=n(12797);class K{set areUpdatesFrozen(o){o?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new Z.c(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,o||(o=x.e.LastCreatedScene),this._scene=o,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const o=this._scene.getEngine().getCaps();this._canUseTextureForTargets=o.canUseGLVertexID&&o.textureFloat&&o.maxVertexTextureImageUnits>0&&o.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return K.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?K.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(o){this._numMaxInfluencers!==o&&(this._numMaxInfluencers=o,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(o){this._useTextureToStoreTargets!==o&&(this._useTextureToStoreTargets=o,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var o;return K.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(o=this._scene)&&void 0!==o&&o.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(o){return this._activeTargets.data[o]}getTarget(o){return this._targets[o]}getTargetByName(o){for(const H of this._targets)if(H.name===o)return H;return null}addTarget(o){this._targets.push(o),this._targetInfluenceChangedObservers.push(o.onInfluenceChanged.add((o=>{this.areUpdatesFrozen&&o&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(o)}))),this._targetDataLayoutChangedObservers.push(o._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(o){const H=this._targets.indexOf(o);H>=0&&(this._targets.splice(H,1),o.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(H,1)[0]),o._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(H,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(o)}_bind(o){o.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),o.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),o.setTexture("morphTargets",this._targetStoreTexture),o.setInt("morphTargetCount",this.numInfluencers)}clone(){const o=new K(this._scene);for(const H of this._targets)o.addTarget(H.clone());return o.enablePositionMorphing=this.enablePositionMorphing,o.enableNormalMorphing=this.enableNormalMorphing,o.enableTangentMorphing=this.enableTangentMorphing,o.enableUVMorphing=this.enableUVMorphing,o.enableUV2Morphing=this.enableUV2Morphing,o.enableColorMorphing=this.enableColorMorphing,o}serialize(){const o={};o.id=this.uniqueId,o.targets=[];for(const H of this._targets)o.targets.push(H.serialize());return o}_syncActiveTargets(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const H=!!this._targetStoreTexture,n=this.isUsingTextureForTargets;(this._mustSynchronize||H!==n)&&(this._mustSynchronize=!1,this.synchronize());let E=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let k=-1;for(const g of this._targets)if(k++,0!==g.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=K.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(g),this._morphTargetTextureIndices[E]=k,this._tempInfluences[E++]=g.influence}this._morphTargetTextureIndices.length!==E&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,E)),this._influences&&this._influences.length===E||(this._influences=new Float32Array(E));for(let g=0;g<E;g++)this._influences[g]=this._tempInfluences[g];if(o&&this._scene)for(const g of this._scene.meshes)g.morphTargetManager===this&&(n?g._markSubMeshesAsAttributesDirty():g._syncGeometryWithMorphTargetManager())}synchronize(){var o;if(!this._scene||this.areUpdatesFrozen)return;const H=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(o=this._targetStoreTexture)||void 0===o||o.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>H.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const n of this._targets){this._supportsPositions=this._supportsPositions&&n.hasPositions,this._supportsNormals=this._supportsNormals&&n.hasNormals,this._supportsTangents=this._supportsTangents&&n.hasTangents,this._supportsUVs=this._supportsUVs&&n.hasUVs,this._supportsUV2s=this._supportsUV2s&&n.hasUV2s,this._supportsColors=this._supportsColors&&n.hasColors;const o=n.vertexCount;if(0===this._vertexCount)this._vertexCount=o;else if(this._vertexCount!==o)return void z.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${n.name}": ${o}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const o=H.getCaps().maxTextureSize;this._textureWidth>o&&(this._textureHeight=Math.ceil(this._textureWidth/o),this._textureWidth=o);const n=this._targets.length,E=new Float32Array(n*this._textureWidth*this._textureHeight*4);let k=0;for(let H=0;H<n;H++){const o=this._targets[H],n=o.getPositions(),g=o.getNormals(),O=o.getUVs(),Y=o.getTangents(),y=o.getUV2s(),S=o.getColors();k=H*this._textureWidth*this._textureHeight*4;for(let H=0;H<this._vertexCount;H++)this._supportsPositions&&n&&(E[k]=n[3*H],E[k+1]=n[3*H+1],E[k+2]=n[3*H+2],k+=4),this._supportsNormals&&g&&(E[k]=g[3*H],E[k+1]=g[3*H+1],E[k+2]=g[3*H+2],k+=4),this._supportsUVs&&O&&(E[k]=O[2*H],E[k+1]=O[2*H+1],k+=4),this._supportsTangents&&Y&&(E[k]=Y[3*H],E[k+1]=Y[3*H+1],E[k+2]=Y[3*H+2],k+=4),this._supportsUV2s&&y&&(E[k]=y[2*H],E[k+1]=y[2*H+1],k+=4),this._supportsColors&&S&&(E[k]=S[4*H],E[k+1]=S[4*H+1],E[k+2]=S[4*H+2],E[k+3]=S[4*H+3],k+=4)}this._targetStoreTexture=M.b.CreateRGBATexture(E,this._textureWidth,this._textureHeight,n,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const n of this._scene.meshes)n.morphTargetManager===this&&n._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const o=this._parentContainer.morphTargetManagers.indexOf(this);o>-1&&this._parentContainer.morphTargetManagers.splice(o,1),this._parentContainer=null}for(const o of this._targets)this._scene.stopAnimation(o)}}static Parse(o,H){const n=new K(H);for(const E of o.targets)n.addTarget(e.d.Parse(E,H));return n}}K.EnableTextureStorage=!0,K.MaxActiveMorphTargetsInVertexAttributeMode=8,K.ConstantTargetCountForTextureMode=0;var f=n(12860),B=n(11066),q=n(11546);const D=new Map,T=D;function a(o,H,n){F(o)&&z.d.Warn(`Extension with the name '${o}' already exists`),D.set(o,{isGLTFExtension:H,factory:n})}function F(o){return D.delete(o)}var C=n(12876),t=n(11793),X=n(11276);class s{static Get(o,H,n){if(!H||void 0==n||!H[n])throw new Error(`${o}: Failed to find index (${n})`);return H[n]}static TryGet(o,H){return o&&void 0!=H&&o[H]?o[H]:null}static Assign(o){if(o)for(let H=0;H<o.length;H++)o[H].index=H}}function U(o){if(o.min&&o.max){const H=o.min,n=o.max,E=k.TmpVectors.xH[0].Wg(H[0],H[1],H[2]),g=k.TmpVectors.xH[1].Wg(n[0],n[1],n[2]);if(o.normalized&&5126!==o.componentType){let H=1;switch(o.componentType){case 5120:H=127;break;case 5121:H=255;break;case 5122:H=32767;break;case 5123:H=65535}const n=1/H;E.scaleInPlace(n),g.scaleInPlace(n)}return new q.e(E,g)}return null}class I{static RegisterExtension(o,H){a(o,!1,H)}static UnregisterExtension(o){return F(o)}get Ag(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(o){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=o}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((o=>o.dispose&&o.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(o,H,n,E,k,g){let O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=H,this._assetContainer=n,this._loadData(E);let g=null;if(o){const H={};if(this._gltf.nodes)for(const o of this._gltf.nodes)o.name&&(H[o.name]=o.index);g=(o instanceof Array?o:[o]).map((o=>{const n=H[o];if(void 0===n)throw new Error(`Failed to find node '${o}'`);return n}))}return await this._loadAsync(k,O,g,(()=>({meshes:this._getMeshes(),jA:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(o,H,n,E){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=o,this._loadData(H),await this._loadAsync(n,k,null,(()=>{}))}async _loadAsync(o,H,n,E){return await Promise.resolve().then((async()=>{this._rootUrl=o,this._uniqueRootUrl=!o.startsWith("file:")&&H?o:`${o}${Date.now()}/`,this._fileName=H,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const k=`${f.f[f.f.LOADING]} => ${f.f[f.f.READY]}`,g=`${f.f[f.f.LOADING]} => ${f.f[f.f.COMPLETE]}`;this._parent._startPerformanceCounter(k),this._parent._startPerformanceCounter(g),this._parent._setState(f.f.LOADING),this._extensionsOnLoading();const Y=new Array;if(!this.parent.loadOnlyMaterials)if(n)Y.push(this.loadSceneAsync("/nodes",{nodes:n,index:-1}));else if(void 0!=this._gltf.VH||this._gltf.scenes&&this._gltf.scenes[0]){const o=s.Get("/scene",this._gltf.scenes,this._gltf.VH||0);Y.push(this.loadSceneAsync(`/scenes/${o.index}`,o))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let o=0;o<this._gltf.materials.length;++o){const H=this._gltf.materials[o],n="/materials/"+o,E=N.e.TriangleFillMode;Y.push(this._loadMaterialAsync(n,H,null,E,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&Y.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&Y.push(this._compileShadowGeneratorsAsync());const y=Promise.all(Y).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.eY(!0);for(const o of this._babylonScene.materials){const H=o;void 0!==H.maxSimultaneousLights&&(H.maxSimultaneousLights=Math.max(H.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(f.f.READY),this._skipStartAnimationStep||this._startAnimations(),E()}));return await y.then((o=>(this._parent._endPerformanceCounter(k),O.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(g),this._parent._setState(f.f.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(o=>{this._parent.onErrorObservable.notifyObservers(o),this._parent.onErrorObservable.clear(),this.dispose()}))})),o)))})).catch((o=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(o),this._parent.onErrorObservable.clear(),this.dispose()),o}))}_loadData(o){if(this._gltf=o.json,this._setupData(),o.bin){const H=this._gltf.buffers;if(H&&H[0]&&!H[0].uri){const n=H[0];(n.byteLength<o.bin.byteLength-3||n.byteLength>o.bin.byteLength)&&z.d.Warn(`Binary buffer length (${n.byteLength}) from JSON does not match chunk length (${o.bin.byteLength})`),this._bin=o.bin}else z.d.Warn("Unexpected BIN chunk")}}_setupData(){if(s.Assign(this._gltf.accessors),s.Assign(this._gltf.animations),s.Assign(this._gltf.buffers),s.Assign(this._gltf.bufferViews),s.Assign(this._gltf.cameras),s.Assign(this._gltf.images),s.Assign(this._gltf.materials),s.Assign(this._gltf.meshes),s.Assign(this._gltf.nodes),s.Assign(this._gltf.samplers),s.Assign(this._gltf.scenes),s.Assign(this._gltf.skins),s.Assign(this._gltf.textures),this._gltf.nodes){const o={};for(const n of this._gltf.nodes)if(n.children)for(const H of n.children)o[H]=n.index;const H=this._createRootNode();for(const n of this._gltf.nodes){const E=o[n.index];n.parent=void 0===E?H:this._gltf.nodes[E]}}}async _loadExtensionsAsync(){const o=[];if(T.forEach(((H,n)=>{var E;!1===(null===(E=this.parent.extensionOptions[n])||void 0===E?void 0:E.enabled)?H.isGLTFExtension&&this.isExtensionUsed(n)&&z.d.Warn(`Extension ${n} is used but has been explicitly disabled.`):H.isGLTFExtension&&!this.isExtensionUsed(n)||o.push((async()=>{const o=await H.factory(this);return o.name!==n&&z.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${o.name} !== ${n}`),this._parent.onExtensionLoadedObservable.notifyObservers(o),o})())})),this._extensions.push(...await Promise.all(o)),this._extensions.sort(((o,H)=>(o.order||Number.MAX_VALUE)-(H.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const n of this._gltf.extensionsRequired){if(!this._extensions.some((o=>o.name===n&&o.enabled))){var H;if(!1===(null===(H=this.parent.extensionOptions[n])||void 0===H?void 0:H.enabled))throw new Error(`Required extension ${n} is disabled`);throw new Error(`Required extension ${n} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new b.b("__root__",this._babylonScene);this._rootBabylonMesh=o,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.eY(!1);const H={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case f.e.AUTO:this._babylonScene.useRightHandedSystem||(H.rotation=[0,1,0,0],H.scale=[1,1,-1],I._LoadTransform(H,this._rootBabylonMesh));break;case f.e.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(o),H}loadSceneAsync(o,H){const n=this._extensionsLoadSceneAsync(o,H);if(n)return n;const E=new Array;if(this.logOpen(`${o} ${H.name||""}`),H.nodes)for(const k of H.nodes){const H=s.Get(`${o}/nodes/${k}`,this._gltf.nodes,k);E.push(this.loadNodeAsync(`/nodes/${H.index}`,H,(o=>{o.parent=this._rootBabylonMesh})))}for(const k of this._postSceneLoadActions)k();return E.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(E).then((()=>{}))}_forEachPrimitive(o,H){if(o._primitiveBabylonMeshes)for(const n of o._primitiveBabylonMeshes)H(n)}_getGeometries(){const o=[],H=this._gltf.nodes;if(H)for(const n of H)this._forEachPrimitive(n,(H=>{const n=H.wg;n&&-1===o.indexOf(n)&&o.push(n)}));return o}_getMeshes(){const o=[];this._rootBabylonMesh instanceof P.e&&o.push(this._rootBabylonMesh);const H=this._gltf.nodes;if(H)for(const n of H)this._forEachPrimitive(n,(H=>{o.push(H)}));return o}_getTransformNodes(){const o=[],H=this._gltf.nodes;if(H)for(const n of H)n._babylonTransformNode&&"oc"===n._babylonTransformNode.getClassName()&&o.push(n._babylonTransformNode),n._babylonTransformNodeForSkin&&o.push(n._babylonTransformNodeForSkin);return o}_getSkeletons(){const o=[],H=this._gltf.skins;if(H)for(const n of H)n._data&&o.push(n._data.babylonSkeleton);return o}_getAnimationGroups(){const o=[],H=this._gltf.animations;if(H)for(const n of H)n._babylonAnimationGroup&&o.push(n._babylonAnimationGroup);return o}_startAnimations(){switch(this._parent.animationStartMode){case f.d.NONE:break;case f.d.FIRST:{const o=this._getAnimationGroups();0!==o.length&&o[0].start(!0);break}case f.d.ALL:{const o=this._getAnimationGroups();for(const H of o)H.start(!0);break}default:return void z.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const E=this._extensionsLoadNodeAsync(o,H,n);if(E)return E;if(H._babylonTransformNode)throw new Error(`${o}: Invalid recursive node hierarchy`);const k=new Array;this.logOpen(`${o} ${H.name||""}`);const g=E=>{if(I.AddPointerMetadata(E,o),I._LoadTransform(H,E),void 0!=H.camera){const n=s.Get(`${o}/camera`,this._gltf.cameras,H.camera);k.push(this.loadCameraAsync(`/cameras/${n.index}`,n,(o=>{o.parent=E,this._babylonScene.useRightHandedSystem||(E.cY.x=-1)})))}if(H.children)for(const n of H.children){const H=s.Get(`${o}/children/${n}`,this._gltf.nodes,n);k.push(this.loadNodeAsync(`/nodes/${H.index}`,H,(o=>{o.parent=E})))}n(E)},O=void 0!=H.mesh,Y=this._parent.loadSkins&&void 0!=H.skin;if(!O||Y){const o=H.name||`node${H.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new p.b(o,this._babylonScene);n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==H.mesh?H._babylonTransformNode=n:H._babylonTransformNodeForSkin=n,g(n)}if(O)if(Y){const n=s.Get(`${o}/mesh`,this._gltf.meshes,H.mesh);k.push(this._loadMeshAsync(`/meshes/${n.index}`,H,n,(n=>{const E=H._babylonTransformNodeForSkin;n.metadata=(0,t.b)(E.metadata,n.metadata||{});const g=s.Get(`${o}/skin`,this._gltf.skins,H.skin);k.push(this._loadSkinAsync(`/skins/${g.index}`,H,g,(o=>{this._forEachPrimitive(H,(H=>{H.skeleton=o})),this._postSceneLoadActions.push((()=>{if(void 0!=g.skeleton){const o=s.Get(`/skins/${g.index}/skeleton`,this._gltf.nodes,g.skeleton).parent;H.index===o.index?n.parent=E.parent:n.parent=o._babylonTransformNode}else n.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:E,skinnedNode:n})}))})))})))}else{const n=s.Get(`${o}/mesh`,this._gltf.meshes,H.mesh);k.push(this._loadMeshAsync(`/meshes/${n.index}`,H,n,g))}return this.logClose(),Promise.all(k).then((()=>(this._forEachPrimitive(H,(o=>{const H=o;!H.isAnInstance&&H.wg&&H.wg.useBoundingInfoFromGeometry?o.To():o.refreshBoundingInfo(!0,!0)})),H._babylonTransformNode)))}_loadMeshAsync(o,H,n,E){const k=n.primitives;if(!k||!k.length)throw new Error(`${o}: Primitives are missing`);void 0==k[0].index&&s.Assign(k);const g=new Array;this.logOpen(`${o} ${n.name||""}`);const O=H.name||`node${H.index}`;if(1===k.length){const E=n.primitives[0];g.push(this._loadMeshPrimitiveAsync(`${o}/primitives/${E.index}`,O,H,n,E,(o=>{H._babylonTransformNode=o,H._primitiveBabylonMeshes=[o]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,H._babylonTransformNode=new p.b(O,this._babylonScene),H._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H._primitiveBabylonMeshes=[];for(const E of k)g.push(this._loadMeshPrimitiveAsync(`${o}/primitives/${E.index}`,`${O}_primitive${E.index}`,H,n,E,(o=>{o.parent=H._babylonTransformNode,H._primitiveBabylonMeshes.push(o)})))}return E(H._babylonTransformNode),this.logClose(),Promise.all(g).then((()=>H._babylonTransformNode))}_loadMeshPrimitiveAsync(o,H,n,E,k,g){const O=this._extensionsLoadMeshPrimitiveAsync(o,H,n,E,k,g);if(O)return O;this.logOpen(`${o}`);const Y=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==n.skin&&!E.primitives[0].targets;let y,S;if(Y&&k._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,y=k._instanceData.babylonSourceMesh.createInstance(H),y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,S=k._instanceData.promise;else{const g=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const O=new b.b(H,this._babylonScene);O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,O.sideOrientation=this._babylonScene.useRightHandedSystem?N.e.CounterClockWiseSideOrientation:N.e.ClockWiseSideOrientation,this._createMorphTargets(o,n,E,k,O),g.push(this._loadVertexDataAsync(o,k,O).then((async H=>await this._loadMorphTargetsAsync(o,k,O,H).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,H.qo(O),H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const G=I._GetDrawMode(o,k.mode);if(void 0==k.material){let o=this._defaultBabylonMaterialData[G];o||(o=this._createDefaultMaterial("__GLTFLoader._default",G),this._parent.onMaterialLoadedObservable.notifyObservers(o),this._defaultBabylonMaterialData[G]=o),O.material=o}else if(!this.parent.skipMaterials){const H=s.Get(`${o}/material`,this._gltf.materials,k.material);g.push(this._loadMaterialAsync(`/materials/${H.index}`,H,O,G,(o=>{O.material=o})))}S=Promise.all(g),Y&&(k._instanceData={babylonSourceMesh:O,promise:S}),y=O}return I.AddPointerMetadata(y,o),this._parent.onMeshLoadedObservable.notifyObservers(y),g(y),this.logClose(),S.then((()=>y))}_loadVertexDataAsync(o,H,n){const E=this._extensionsLoadVertexDataAsync(o,H,n);if(E)return E;const k=H.attributes;if(!k)throw new Error(`${o}: Attributes are missing`);const g=new Array,O=new m.b(n.name,this._babylonScene);if(void 0==H.indices)n.isUnIndexed=!0;else{const n=s.Get(`${o}/indices`,this._gltf.accessors,H.indices);g.push(this._loadIndicesAccessorAsync(`/accessors/${n.index}`,n).then((o=>{O.setIndices(o)})))}const Y=(H,E,Y)=>{if(void 0==k[H])return;n._delayInfo=n._delayInfo||[],-1===n._delayInfo.indexOf(E)&&n._delayInfo.push(E);const y=s.Get(`${o}/attributes/${H}`,this._gltf.accessors,k[H]);g.push(this._loadVertexAccessorAsync(`/accessors/${y.index}`,y,E).then((o=>{if(o.getKind()===j.d.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!n.skeleton){const o=U(y);o&&(O._boundingInfo=o,O.useBoundingInfoFromGeometry=!0)}O.setVerticesBuffer(o,y.count)}))),E==j.d.MatricesIndicesExtraKind&&(n.numBoneInfluencers=8),Y&&Y(y)};return Y("POSITION",j.d.PositionKind),Y("NORMAL",j.d.NormalKind),Y("TANGENT",j.d.TangentKind),Y("TEXCOORD_0",j.d.UVKind),Y("TEXCOORD_1",j.d.UV2Kind),Y("TEXCOORD_2",j.d.UV3Kind),Y("TEXCOORD_3",j.d.UV4Kind),Y("TEXCOORD_4",j.d.UV5Kind),Y("TEXCOORD_5",j.d.UV6Kind),Y("JOINTS_0",j.d.MatricesIndicesKind),Y("WEIGHTS_0",j.d.MatricesWeightsKind),Y("JOINTS_1",j.d.MatricesIndicesExtraKind),Y("WEIGHTS_1",j.d.MatricesWeightsExtraKind),Y("COLOR_0",j.d.ColorKind,(o=>{"VEC4"===o.type&&(n.hasVertexAlpha=!0)})),Promise.all(g).then((()=>O))}_createMorphTargets(o,H,n,E,k){if(!E.targets||!this._parent.loadMorphTargets)return;if(void 0==H._numMorphTargets)H._numMorphTargets=E.targets.length;else if(E.targets.length!==H._numMorphTargets)throw new Error(`${o}: Primitives do not have the same number of targets`);const g=n.extras?n.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,k.morphTargetManager=new K(this._babylonScene),k.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,k.morphTargetManager.areUpdatesFrozen=!0;for(let O=0;O<E.targets.length;O++){const o=H.weights?H.weights[O]:n.weights?n.weights[O]:0,E=g?g[O]:`morphTarget${O}`;k.morphTargetManager.addTarget(new e.d(E,o,k.bo()))}}_loadMorphTargetsAsync(o,H,n,E){if(!H.targets||!this._parent.loadMorphTargets)return Promise.resolve();const k=new Array,g=n.morphTargetManager;for(let O=0;O<g.numTargets;O++){const n=g.getTarget(O);k.push(this._loadMorphTargetVertexDataAsync(`${o}/targets/${O}`,E,H.targets[O],n))}return Promise.all(k).then((()=>{g.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(o,H,n,E){const k=new Array,g=(E,g,O)=>{if(void 0==n[E])return;const Y=H.getVertexBuffer(g);if(!Y)return;const y=s.Get(`${o}/${E}`,this._gltf.accessors,n[E]);k.push(this._loadFloatAccessorAsync(`/accessors/${y.index}`,y).then((o=>{O(Y,o)})))};return g("POSITION",j.d.PositionKind,((o,H)=>{const n=new Float32Array(H.length);o.forEach(H.length,((o,E)=>{n[E]=H[E]+o})),E.setPositions(n)})),g("NORMAL",j.d.NormalKind,((o,H)=>{const n=new Float32Array(H.length);o.forEach(n.length,((o,E)=>{n[E]=H[E]+o})),E.setNormals(n)})),g("TANGENT",j.d.TangentKind,((o,H)=>{const n=new Float32Array(H.length/3*4);let k=0;o.forEach(H.length/3*4,((o,E)=>{(E+1)%4!==0&&(n[k]=H[k]+o,k++)})),E.setTangents(n)})),g("TEXCOORD_0",j.d.UVKind,((o,H)=>{const n=new Float32Array(H.length);o.forEach(H.length,((o,E)=>{n[E]=H[E]+o})),E.setUVs(n)})),g("TEXCOORD_1",j.d.UV2Kind,((o,H)=>{const n=new Float32Array(H.length);o.forEach(H.length,((o,E)=>{n[E]=H[E]+o})),E.setUV2s(n)})),g("COLOR_0",j.d.ColorKind,((H,n)=>{let k=null;const g=H.getSize();if(3===g){k=new Float32Array(n.length/3*4),H.forEach(n.length,((o,H)=>{const E=Math.floor(H/3),g=H%3;k[4*E+g]=n[3*E+g]+o}));for(let o=0;o<n.length/3;++o)k[4*o+3]=1}else{if(4!==g)throw new Error(`${o}: Invalid number of components (${g}) for COLOR_0 attribute`);k=new Float32Array(n.length),H.forEach(n.length,((o,H)=>{k[H]=n[H]+o}))}E.setColors(k)})),await Promise.all(k).then((()=>{}))}static _LoadTransform(o,H){if(void 0!=o.skin)return;let n=k.xH.Zero(),E=k.Quaternion.Identity(),g=k.xH.One();if(o.matrix){k.Matrix.Mg(o.matrix).decompose(g,E,n)}else o.translation&&(n=k.xH.Mg(o.translation)),o.rotation&&(E=k.Quaternion.Mg(o.rotation)),o.scale&&(g=k.xH.Mg(o.scale));H.position=n,H.rotationQuaternion=E,H.cY=g}_loadSkinAsync(o,H,n,E){if(!this._parent.loadSkins)return Promise.resolve();const k=this._extensionsLoadSkinAsync(o,H,n);if(k)return k;if(n._data)return E(n._data.babylonSkeleton),n._data.promise;const g=`skeleton${n.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const O=new J(n.name||g,g,this._babylonScene);O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(o,n,O);const Y=this._loadSkinInverseBindMatricesDataAsync(o,n).then((o=>{this._updateBoneMatrices(O,o)}));return n._data={babylonSkeleton:O,promise:Y},E(O),Y}_loadBones(o,H,n){if(void 0==H.skeleton||this._parent.alwaysComputeSkeletonRootNode){const n=this._findSkeletonRootNode(`${o}/joints`,H.joints);if(n)if(void 0===H.skeleton)H.skeleton=n.index;else{const E=(o,H)=>{for(;H.parent;H=H.parent)if(H.parent===o)return!0;return!1},k=s.Get(`${o}/skeleton`,this._gltf.nodes,H.skeleton);k===n||E(k,n)||(z.d.Warn(`${o}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),H.skeleton=n.index)}else z.d.Warn(`${o}: Failed to find common root`)}const E={};for(const k of H.joints){const g=s.Get(`${o}/joints/${k}`,this._gltf.nodes,k);this._loadBone(g,H,n,E)}}_findSkeletonRootNode(o,H){if(0===H.length)return null;const n={};for(const k of H){const H=[];let E=s.Get(`${o}/${k}`,this._gltf.nodes,k);for(;-1!==E.index;)H.unshift(E),E=E.parent;n[k]=H}let E=null;for(let k=0;;++k){let o=n[H[0]];if(k>=o.length)return E;const g=o[k];for(let O=1;O<H.length;++O)if(o=n[H[O]],k>=o.length||g!==o[k])return E;E=g}}_loadBone(o,H,n,E){o._isJoint=!0;let k=E[o.index];if(k)return k;let g=null;o.index!==H.skeleton&&(o.parent&&-1!==o.parent.index?g=this._loadBone(o.parent,H,n,E):void 0!==H.skeleton&&z.d.Warn(`/skins/${H.index}/skeleton: Skeleton node is not a common root`));const O=H.joints.indexOf(o.index);return k=new S.b(o.name||`joint${o.index}`,n,g,this._getNodeMatrix(o),null,null,O),E[o.index]=k,this._postSceneLoadActions.push((()=>{k.linkTransformNode(o._babylonTransformNode)})),k}_loadSkinInverseBindMatricesDataAsync(o,H){if(void 0==H.inverseBindMatrices)return Promise.resolve(null);const n=s.Get(`${o}/inverseBindMatrices`,this._gltf.accessors,H.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${n.index}`,n)}_updateBoneMatrices(o,H){for(const n of o.bones){const o=k.Matrix.Identity(),E=n._index;H&&-1!==E&&(k.Matrix.FromArrayToRef(H,16*E,o),o.invertToRef(o));const g=n.getParent();g&&o.multiplyToRef(g.getAbsoluteInverseBindMatrix(),o),n.sg(o,!1,!1),n._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(o){return o.matrix?k.Matrix.Mg(o.matrix):k.Matrix.Compose(o.scale?k.xH.Mg(o.scale):k.xH.One(),o.rotation?k.Quaternion.Mg(o.rotation):k.Quaternion.Identity(),o.translation?k.xH.Mg(o.translation):k.xH.Zero())}loadCameraAsync(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const E=this._extensionsLoadCameraAsync(o,H,n);if(E)return E;const g=new Array;this.logOpen(`${o} ${H.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const O=new y.c(H.name||`camera${H.index}`,k.xH.Zero(),this._babylonScene,!1);switch(O._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H._babylonCamera=O,O.setTarget(new k.xH(0,0,-1)),H.type){case"perspective":{const n=H.perspective;if(!n)throw new Error(`${o}: Camera perspective properties are missing`);O.fov=n.yfov,O.Cg=n.znear,O.maxZ=n.zfar||0;break}case"orthographic":if(!H.orthographic)throw new Error(`${o}: Camera orthographic properties are missing`);O.mode=Y.b.ORTHOGRAPHIC_CAMERA,O.orthoLeft=-H.orthographic.xmag,O.orthoRight=H.orthographic.xmag,O.orthoBottom=-H.orthographic.ymag,O.orthoTop=H.orthographic.ymag,O.Cg=H.orthographic.znear,O.maxZ=H.orthographic.zfar;break;default:throw new Error(`${o}: Invalid camera type (${H.type})`)}return I.AddPointerMetadata(O,o),this._parent.onCameraLoadedObservable.notifyObservers(O),n(O),this.logClose(),Promise.all(g).then((()=>O))}_loadAnimationsAsync(){const o=this._gltf.animations;if(!o)return Promise.resolve();const H=new Array;for(let n=0;n<o.length;n++){const E=o[n];H.push(this.loadAnimationAsync(`/animations/${E.index}`,E).then((o=>{0===o.targetedAnimations.length&&o.dispose()})))}return Promise.all(H).then((()=>{}))}loadAnimationAsync(o,H){const E=this._extensionsLoadAnimationAsync(o,H);return E||n.e(78).then(n.bind(n,14406)).then((n=>{let{AnimationGroup:E}=n;this._babylonScene._blockEntityCollection=!!this._assetContainer;const k=new E(H.name||`animation${H.index}`,this._babylonScene);k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H._babylonAnimationGroup=k;const g=new Array;s.Assign(H.channels),s.Assign(H.samplers);for(const O of H.channels)g.push(this._loadAnimationChannelAsync(`${o}/channels/${O.index}`,o,H,O,((o,H)=>{o.animations=o.animations||[],o.animations.push(H),k.addTargetedAnimation(H,o)})));return Promise.all(g).then((()=>(k.normalize(0),k)))}))}async _loadAnimationChannelAsync(o,H,E,k,g){const O=this._extensionsLoadAnimationChannelAsync(o,H,E,k,g);if(O)return await O;if(void 0==k.target.node)return await Promise.resolve();const Y=s.Get(`${o}/target/node`,this._gltf.nodes,k.target.node),y=k.target.path,S="weights"===y;if(S&&!Y._numMorphTargets||!S&&!Y._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!S&&!Y._isJoint)return await Promise.resolve();let G;switch(await Promise.resolve().then(n.bind(n,12887)),y){case"translation":var c;G=null===(c=(0,C.d)("/nodes/{}/translation"))||void 0===c?void 0:c.interpolation;break;case"rotation":var A;G=null===(A=(0,C.d)("/nodes/{}/rotation"))||void 0===A?void 0:A.interpolation;break;case"scale":var l;G=null===(l=(0,C.d)("/nodes/{}/scale"))||void 0===l?void 0:l.interpolation;break;case"weights":var x;G=null===(x=(0,C.d)("/nodes/{}/weights"))||void 0===x?void 0:x.interpolation;break;default:throw new Error(`${o}/target/path: Invalid value (${k.target.path})`)}if(!G)throw new Error(`${o}/target/path: Could not find interpolation properties for target path (${k.target.path})`);const z={object:Y,info:G};return await this._loadAnimationChannelFromTargetInfoAsync(o,H,E,k,z,g)}_loadAnimationChannelFromTargetInfoAsync(o,H,n,E,k,g){const O=this.parent.targetFps,Y=1/O,y=s.Get(`${o}/sampler`,n.samplers,E.sampler);return this._loadAnimationSamplerAsync(`${H}/samplers/${E.sampler}`,y).then((o=>{let H=0;const y=k.object,S=k.info;for(const k of S){const S=k.getStride(y),G=o.input,c=o.output,A=new Array(G.length);let l=0;switch(o.interpolation){case"STEP":for(let o=0;o<G.length;o++){const H=k.getValue(y,c,l,1);l+=S,A[o]={frame:G[o]*O,value:H,interpolation:1}}break;case"CUBICSPLINE":for(let o=0;o<G.length;o++){const H=k.getValue(y,c,l,Y);l+=S;const n=k.getValue(y,c,l,1);l+=S;const E=k.getValue(y,c,l,Y);l+=S,A[o]={frame:G[o]*O,inTangent:H,value:n,outTangent:E}}break;case"LINEAR":for(let o=0;o<G.length;o++){const H=k.getValue(y,c,l,1);l+=S,A[o]={frame:G[o]*O,value:H}}}if(l>0){const o=`${n.name||`animation${n.index}`}_channel${E.index}_${H}`,Y=k.buildAnimations(y,o,O,A);for(const n of Y)H++,g(n.babylonAnimatable,n.babylonAnimation)}}}))}_loadAnimationSamplerAsync(o,H){if(H._data)return H._data;const n=H.interpolation||"LINEAR";switch(n){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${o}/interpolation: Invalid value (${H.interpolation})`)}const E=s.Get(`${o}/input`,this._gltf.accessors,H.input),k=s.Get(`${o}/output`,this._gltf.accessors,H.output);return H._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${E.index}`,E),this._loadFloatAccessorAsync(`/accessors/${k.index}`,k)]).then((o=>{let[H,E]=o;return{input:H,interpolation:n,output:E}})),H._data}loadBufferAsync(o,H,n,E){const k=this._extensionsLoadBufferAsync(o,H,n,E);if(k)return k;if(!H._data)if(H.uri)H._data=this.loadUriAsync(`${o}/uri`,H,H.uri);else{if(!this._bin)throw new Error(`${o}: Uri is missing or the binary glTF is missing its binary chunk`);H._data=this._bin.readAsync(0,H.byteLength)}return H._data.then((H=>{try{return new Uint8Array(H.buffer,H.byteOffset+n,E)}catch(k){throw new Error(`${o}: ${k.message}`)}}))}loadBufferViewAsync(o,H){const n=this._extensionsLoadBufferViewAsync(o,H);if(n)return n;if(H._data)return H._data;const E=s.Get(`${o}/buffer`,this._gltf.buffers,H.buffer);return H._data=this.loadBufferAsync(`/buffers/${E.index}`,E,H.byteOffset||0,H.byteLength),H._data}_loadAccessorAsync(o,H,n){if(H._data)return H._data;const E=I._GetNumComponents(o,H.type),k=E*j.d.GetTypeByteLength(H.componentType),g=E*H.count;if(void 0==H.bufferView)H._data=Promise.resolve(new n(g));else{const O=s.Get(`${o}/bufferView`,this._gltf.bufferViews,H.bufferView);H._data=this.loadBufferViewAsync(`/bufferViews/${O.index}`,O).then((Y=>{if(5126!==H.componentType||H.normalized||O.byteStride&&O.byteStride!==k){const o=new n(g);return j.d.ForEach(Y,H.byteOffset||0,O.byteStride||k,E,H.componentType,o.length,H.normalized||!1,((H,n)=>{o[n]=H})),o}return I._GetTypedArray(o,H.componentType,Y,H.byteOffset,g)}))}if(H.sparse){const g=H.sparse;H._data=H._data.then((O=>{const Y=O,y=s.Get(`${o}/sparse/indices/bufferView`,this._gltf.bufferViews,g.indices.bufferView),S=s.Get(`${o}/sparse/values/bufferView`,this._gltf.bufferViews,g.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${y.index}`,y),this.loadBufferViewAsync(`/bufferViews/${S.index}`,S)]).then((O=>{let[y,S]=O;const G=I._GetTypedArray(`${o}/sparse/indices`,g.indices.componentType,y,g.indices.byteOffset,g.count),c=E*g.count;let A;if(5126!==H.componentType||H.normalized){const O=I._GetTypedArray(`${o}/sparse/values`,H.componentType,S,g.values.byteOffset,c);A=new n(c),j.d.ForEach(O,0,k,E,H.componentType,A.length,H.normalized||!1,((o,H)=>{A[H]=o}))}else A=I._GetTypedArray(`${o}/sparse/values`,H.componentType,S,g.values.byteOffset,c);let l=0;for(let o=0;o<G.length;o++){let H=G[o]*E;for(let o=0;o<E;o++)Y[H++]=A[l++]}return Y}))}))}return H._data}_loadFloatAccessorAsync(o,H){return this._loadAccessorAsync(o,H,Float32Array)}_loadIndicesAccessorAsync(o,H){if("SCALAR"!==H.type)throw new Error(`${o}/type: Invalid value ${H.type}`);if(5121!==H.componentType&&5123!==H.componentType&&5125!==H.componentType)throw new Error(`${o}/componentType: Invalid value ${H.componentType}`);if(H._data)return H._data;if(H.sparse){const n=I._GetTypedArrayConstructor(`${o}/componentType`,H.componentType);H._data=this._loadAccessorAsync(o,H,n)}else{const n=s.Get(`${o}/bufferView`,this._gltf.bufferViews,H.bufferView);H._data=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n).then((n=>I._GetTypedArray(o,H.componentType,n,H.byteOffset,H.count)))}return H._data}_loadVertexBufferViewAsync(o){if(o._babylonBuffer)return o._babylonBuffer;const H=this._babylonScene.getEngine();return o._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${o.index}`,o).then((o=>new j.c(H,o,!1))),o._babylonBuffer}_loadVertexAccessorAsync(o,H,n){var E;if(null!==(E=H._babylonVertexBuffer)&&void 0!==E&&E[n])return H._babylonVertexBuffer[n];H._babylonVertexBuffer||(H._babylonVertexBuffer={});const k=this._babylonScene.getEngine();if(H.sparse||void 0==H.bufferView)H._babylonVertexBuffer[n]=this._loadFloatAccessorAsync(o,H).then((o=>new j.d(k,o,n,!1)));else{const E=s.Get(`${o}/bufferView`,this._gltf.bufferViews,H.bufferView);H._babylonVertexBuffer[n]=this._loadVertexBufferViewAsync(E).then((g=>{const O=I._GetNumComponents(o,H.type);return new j.d(k,g,n,!1,void 0,E.byteStride,void 0,H.byteOffset,O,H.componentType,H.normalized,!0,void 0,!0)}))}return H._babylonVertexBuffer[n]}_loadMaterialMetallicRoughnessPropertiesAsync(o,H,n){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);const E=new Array;return H&&(H.baseColorFactor?(n.albedoColor=g.NH.Mg(H.baseColorFactor),n.alpha=H.baseColorFactor[3]):n.albedoColor=g.NH.White(),n.metallic=void 0==H.metallicFactor?1:H.metallicFactor,n.roughness=void 0==H.roughnessFactor?1:H.roughnessFactor,H.baseColorTexture&&E.push(this.loadTextureInfoAsync(`${o}/baseColorTexture`,H.baseColorTexture,(o=>{o.name=`${n.name} (Base Color)`,n.albedoTexture=o}))),H.metallicRoughnessTexture&&(H.metallicRoughnessTexture.nonColorData=!0,E.push(this.loadTextureInfoAsync(`${o}/metallicRoughnessTexture`,H.metallicRoughnessTexture,(o=>{o.name=`${n.name} (Metallic Roughness)`,n.metallicTexture=o}))),n.useMetallnessFromMetallicTextureBlue=!0,n.useRoughnessFromMetallicTextureGreen=!0,n.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(E).then((()=>{}))}_loadMaterialAsync(o,H,n,E){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const g=this._extensionsLoadMaterialAsync(o,H,n,E,k);if(g)return g;H._data=H._data||{};let O=H._data[E];if(!O){this.logOpen(`${o} ${H.name||""}`);const n=this.createMaterial(o,H,E);O={babylonMaterial:n,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(o,H,n)},H._data[E]=O,I.AddPointerMetadata(n,o),this._parent.onMaterialLoadedObservable.notifyObservers(n),this.logClose()}return n&&(O.babylonMeshes.push(n),n.yg.addOnce((()=>{const o=O.babylonMeshes.indexOf(n);-1!==o&&O.babylonMeshes.splice(o,1)}))),k(O.babylonMaterial),O.promise.then((()=>O.babylonMaterial))}_createDefaultMaterial(o,H){this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new h.c(o,this._babylonScene);return n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.fillMode=H,n.enableSpecularAntiAliasing=!0,n.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,n.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,n.transparencyMode=h.c.PBRMATERIAL_OPAQUE,n.metallic=1,n.roughness=1,n}createMaterial(o,H,n){const E=this._extensionsCreateMaterial(o,H,n);if(E)return E;const k=H.name||`material${H.index}`;return this._createDefaultMaterial(k,n)}loadMaterialPropertiesAsync(o,H,n){const E=this._extensionsLoadMaterialPropertiesAsync(o,H,n);if(E)return E;const k=new Array;return k.push(this.loadMaterialBasePropertiesAsync(o,H,n)),H.pbrMetallicRoughness&&k.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${o}/pbrMetallicRoughness`,H.pbrMetallicRoughness,n)),this.loadMaterialAlphaProperties(o,H,n),Promise.all(k).then((()=>{}))}loadMaterialBasePropertiesAsync(o,H,n){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);const E=new Array;return n.emissiveColor=H.emissiveFactor?g.NH.Mg(H.emissiveFactor):new g.NH(0,0,0),H.doubleSided&&(n.Rg=!1,n.twoSidedLighting=!0),H.normalTexture&&(H.normalTexture.nonColorData=!0,E.push(this.loadTextureInfoAsync(`${o}/normalTexture`,H.normalTexture,(o=>{o.name=`${n.name} (Normal)`,n.bumpTexture=o}))),n.invertNormalMapX=!this._babylonScene.useRightHandedSystem,n.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=H.normalTexture.scale&&n.bumpTexture&&(n.bumpTexture.level=H.normalTexture.scale),n.forceIrradianceInFragment=!0),H.occlusionTexture&&(H.occlusionTexture.nonColorData=!0,E.push(this.loadTextureInfoAsync(`${o}/occlusionTexture`,H.occlusionTexture,(o=>{o.name=`${n.name} (Occlusion)`,n.ambientTexture=o}))),n.useAmbientInGrayScale=!0,void 0!=H.occlusionTexture.strength&&(n.ambientTextureStrength=H.occlusionTexture.strength)),H.emissiveTexture&&E.push(this.loadTextureInfoAsync(`${o}/emissiveTexture`,H.emissiveTexture,(o=>{o.name=`${n.name} (Emissive)`,n.emissiveTexture=o}))),Promise.all(E).then((()=>{}))}loadMaterialAlphaProperties(o,H,n){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);switch(H.alphaMode||"OPAQUE"){case"OPAQUE":n.transparencyMode=h.c.PBRMATERIAL_OPAQUE,n.alpha=1;break;case"MASK":n.transparencyMode=h.c.PBRMATERIAL_ALPHATEST,n.alphaCutOff=void 0==H.alphaCutoff?.5:H.alphaCutoff,n.albedoTexture&&(n.albedoTexture.fg=!0);break;case"BLEND":n.transparencyMode=h.c.PBRMATERIAL_ALPHABLEND,n.albedoTexture&&(n.albedoTexture.fg=!0,n.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${o}/alphaMode: Invalid value (${H.alphaMode})`)}}loadTextureInfoAsync(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const E=this._extensionsLoadTextureInfoAsync(o,H,n);if(E)return E;if(this.logOpen(`${o}`),H.texCoord>=6)throw new Error(`${o}/texCoord: Invalid value (${H.texCoord})`);const k=s.Get(`${o}/index`,this._gltf.textures,H.index);k._textureInfo=H;const g=this._loadTextureAsync(`/textures/${H.index}`,k,(E=>{E.coordinatesIndex=H.texCoord||0,I.AddPointerMetadata(E,o),this._parent.onTextureLoadedObservable.notifyObservers(E),n(E)}));return this.logClose(),g}_loadTextureAsync(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const E=this._extensionsLoadTextureAsync(o,H,n);if(E)return E;this.logOpen(`${o} ${H.name||""}`);const k=void 0==H.sampler?I.DefaultSampler:s.Get(`${o}/sampler`,this._gltf.samplers,H.sampler),g=s.Get(`${o}/source`,this._gltf.images,H.source),O=this._createTextureAsync(o,k,g,n,void 0,!H._textureInfo.nonColorData);return this.logClose(),O}_createTextureAsync(o,H,n){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},g=arguments.length>4?arguments[4]:void 0,O=arguments.length>5?arguments[5]:void 0;const Y=this._loadSampler(`/samplers/${H.index}`,H),y=new Array,S=new E;this._babylonScene._blockEntityCollection=!!this._assetContainer;const G={noMipmap:Y.noMipMaps,invertY:!1,samplingMode:Y.samplingMode,R:()=>{this._disposed||S.resolve()},onError:(H,n)=>{this._disposed||S.reject(new Error(`${o}: ${n&&n.message?n.message:H||"Failed to load texture"}`))},mimeType:n.mimeType??(0,B.f)(n.uri??""),loaderOptions:g,useSRGBBuffer:!!O&&this._parent.useSRGBBuffers},c=new Q.c(null,this._babylonScene,G);return c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y.push(S.promise),y.push(this.loadImageAsync(`/images/${n.index}`,n).then((o=>{const H=n.uri||`${this._fileName}#image${n.index}`,E=`data:${this._uniqueRootUrl}${H}`;c.updateURL(E,o);const k=c.getInternalTexture();k&&(k.label=n.name)}))),c.wrapU=Y.wrapU,c.wrapV=Y.wrapV,k(c),this._parent.useGltfTextureNames&&(c.name=n.name||n.uri||`image${n.index}`),Promise.all(y).then((()=>c))}_loadSampler(o,H){return H._data||(H._data={noMipMaps:9728===H.minFilter||9729===H.minFilter,samplingMode:I._GetTextureSamplingMode(o,H),wrapU:I._GetTextureWrapMode(`${o}/wrapS`,H.wrapS),wrapV:I._GetTextureWrapMode(`${o}/wrapT`,H.wrapT)}),H._data}loadImageAsync(o,H){if(!H._data){if(this.logOpen(`${o} ${H.name||""}`),H.uri)H._data=this.loadUriAsync(`${o}/uri`,H,H.uri);else{const n=s.Get(`${o}/bufferView`,this._gltf.bufferViews,H.bufferView);H._data=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n)}this.logClose()}return H._data}loadUriAsync(o,H,n){const E=this._extensionsLoadUriAsync(o,H,n);if(E)return E;if(!I._ValidateUri(n))throw new Error(`${o}: '${n}' is invalid`);if((0,B.i)(n)){const H=new Uint8Array((0,B.c)(n));return this.log(`${o}: Decoded ${n.substring(0,64)}... (${H.length} bytes)`),Promise.resolve(H)}return this.log(`${o}: Loading ${n}`),this._parent.preprocessUrlAsync(this._rootUrl+n).then((H=>new Promise(((E,k)=>{this._parent._loadFile(this._babylonScene,H,(H=>{this._disposed||(this.log(`${o}: Loaded ${n} (${H.byteLength} bytes)`),E(new Uint8Array(H)))}),!0,(H=>{k(new B.j(`${o}: Failed to load '${n}'${H?": "+H.status+" "+H.statusText:""}`,H))}))}))))}static AddPointerMetadata(o,H){o.metadata=o.metadata||{};const n=o._internalMetadata=o._internalMetadata||{},E=n.Ag=n.Ag||{};(E.pointers=E.pointers||[]).push(H)}static _GetTextureWrapMode(o,H){switch(H=void 0==H?10497:H){case 33071:return Q.c.CLAMP_ADDRESSMODE;case 33648:return Q.c.MIRROR_ADDRESSMODE;case 10497:return Q.c.WRAP_ADDRESSMODE;default:return z.d.Warn(`${o}: Invalid value (${H})`),Q.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(o,H){const n=void 0==H.magFilter?9729:H.magFilter,E=void 0==H.minFilter?9987:H.minFilter;if(9729===n)switch(E){case 9728:return Q.c.LINEAR_NEAREST;case 9729:return Q.c.LINEAR_LINEAR;case 9984:return Q.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return Q.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return Q.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return Q.c.LINEAR_LINEAR_MIPLINEAR;default:return z.d.Warn(`${o}/minFilter: Invalid value (${E})`),Q.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==n&&z.d.Warn(`${o}/magFilter: Invalid value (${n})`),E){case 9728:return Q.c.NEAREST_NEAREST;case 9729:return Q.c.NEAREST_LINEAR;case 9984:return Q.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return Q.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return Q.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return Q.c.NEAREST_LINEAR_MIPLINEAR;default:return z.d.Warn(`${o}/minFilter: Invalid value (${E})`),Q.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(o,H){try{return(0,X.n)(H)}catch(n){throw new Error(`${o}: ${n.message}`)}}static _GetTypedArray(o,H,n,E,k){const g=n.buffer;E=n.byteOffset+(E||0);const O=I._GetTypedArrayConstructor(`${o}/componentType`,H),Y=j.d.GetTypeByteLength(H);return E%Y!==0?(z.d.Warn(`${o}: Copying buffer as byte offset (${E}) is not a multiple of component type byte length (${Y})`),new O(g.slice(E,E+k*Y),0)):new O(g,E,k)}static _GetNumComponents(o,H){switch(H){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${o}: Invalid type (${H})`)}static _ValidateUri(o){return O.Tools.IsBase64(o)||-1===o.indexOf("..")}static _GetDrawMode(o,H){switch(void 0==H&&(H=4),H){case 0:return N.e.PointListDrawMode;case 1:return N.e.LineListDrawMode;case 2:return N.e.LineLoopDrawMode;case 3:return N.e.LineStripDrawMode;case 4:return N.e.TriangleFillMode;case 5:return N.e.TriangleStripDrawMode;case 6:return N.e.TriangleFanDrawMode}throw new Error(`${o}: Invalid mesh primitive mode (${H})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const o=new Array;if(this._gltf.materials)for(const H of this._gltf.materials)if(H._data)for(const n in H._data){const E=H._data[n];for(const H of E.babylonMeshes){H.Ig(!0);const n=E.babylonMaterial;o.push(n.forceCompilationAsync(H)),o.push(n.forceCompilationAsync(H,{useInstances:!0})),this._parent.useClipPlane&&(o.push(n.forceCompilationAsync(H,{clipPlane:!0})),o.push(n.forceCompilationAsync(H,{clipPlane:!0,useInstances:!0})))}}return Promise.all(o).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const o=new Array,H=this._babylonScene.lights;for(const n of H){const H=n.getShadowGenerator();H&&o.push(H.forceCompilationAsync())}return Promise.all(o).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(o){for(const H of this._extensions)H.enabled&&o(H)}_applyExtensions(o,H,n){for(const E of this._extensions)if(E.enabled){const k=`${E.name}.${H}`,g=o;g._activeLoaderExtensionFunctions=g._activeLoaderExtensionFunctions||{};const O=g._activeLoaderExtensionFunctions;if(!O[k]){O[k]=!0;try{const o=n(E);if(o)return o}finally{delete O[k]}}}return null}_extensionsOnLoading(){this._forEachExtensions((o=>o.onLoading&&o.onLoading()))}_extensionsOnReady(){this._forEachExtensions((o=>o.onReady&&o.onReady()))}_extensionsLoadSceneAsync(o,H){return this._applyExtensions(H,"loadScene",(n=>n.loadSceneAsync&&n.loadSceneAsync(o,H)))}_extensionsLoadNodeAsync(o,H,n){return this._applyExtensions(H,"loadNode",(E=>E.loadNodeAsync&&E.loadNodeAsync(o,H,n)))}_extensionsLoadCameraAsync(o,H,n){return this._applyExtensions(H,"loadCamera",(E=>E.loadCameraAsync&&E.loadCameraAsync(o,H,n)))}_extensionsLoadVertexDataAsync(o,H,n){return this._applyExtensions(H,"loadVertexData",(E=>E._loadVertexDataAsync&&E._loadVertexDataAsync(o,H,n)))}_extensionsLoadMeshPrimitiveAsync(o,H,n,E,k,g){return this._applyExtensions(k,"loadMeshPrimitive",(O=>O._loadMeshPrimitiveAsync&&O._loadMeshPrimitiveAsync(o,H,n,E,k,g)))}_extensionsLoadMaterialAsync(o,H,n,E,k){return this._applyExtensions(H,"loadMaterial",(g=>g._loadMaterialAsync&&g._loadMaterialAsync(o,H,n,E,k)))}_extensionsCreateMaterial(o,H,n){return this._applyExtensions(H,"createMaterial",(E=>E.createMaterial&&E.createMaterial(o,H,n)))}_extensionsLoadMaterialPropertiesAsync(o,H,n){return this._applyExtensions(H,"loadMaterialProperties",(E=>E.loadMaterialPropertiesAsync&&E.loadMaterialPropertiesAsync(o,H,n)))}_extensionsLoadTextureInfoAsync(o,H,n){return this._applyExtensions(H,"loadTextureInfo",(E=>E.loadTextureInfoAsync&&E.loadTextureInfoAsync(o,H,n)))}_extensionsLoadTextureAsync(o,H,n){return this._applyExtensions(H,"loadTexture",(E=>E._loadTextureAsync&&E._loadTextureAsync(o,H,n)))}_extensionsLoadAnimationAsync(o,H){return this._applyExtensions(H,"loadAnimation",(n=>n.loadAnimationAsync&&n.loadAnimationAsync(o,H)))}_extensionsLoadAnimationChannelAsync(o,H,n,E,k){return this._applyExtensions(n,"loadAnimationChannel",(g=>g._loadAnimationChannelAsync&&g._loadAnimationChannelAsync(o,H,n,E,k)))}_extensionsLoadSkinAsync(o,H,n){return this._applyExtensions(n,"loadSkin",(E=>E._loadSkinAsync&&E._loadSkinAsync(o,H,n)))}_extensionsLoadUriAsync(o,H,n){return this._applyExtensions(H,"loadUri",(E=>E._loadUriAsync&&E._loadUriAsync(o,H,n)))}_extensionsLoadBufferViewAsync(o,H){return this._applyExtensions(H,"loadBufferView",(n=>n.loadBufferViewAsync&&n.loadBufferViewAsync(o,H)))}_extensionsLoadBufferAsync(o,H,n,E){return this._applyExtensions(H,"loadBuffer",(k=>k.loadBufferAsync&&k.loadBufferAsync(o,H,n,E)))}static LoadExtensionAsync(o,H,n,E){if(!H.extensions)return null;const k=H.extensions[n];return k?E(`${o}/extensions/${n}`,k):null}static LoadExtraAsync(o,H,n,E){if(!H.extras)return null;const k=H.extras[n];return k?E(`${o}/extras/${n}`,k):null}isExtensionUsed(o){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(o)}logOpen(o){this._parent._logOpen(o)}logClose(){this._parent._logClose()}log(o){this._parent._log(o)}startPerformanceCounter(o){this._parent._startPerformanceCounter(o)}endPerformanceCounter(o){this._parent._endPerformanceCounter(o)}}I.DefaultSampler={index:-1},f.b._CreateGLTF2Loader=o=>new I(o);var v=n(12887),w=n(11380),r=n(11224),u=n(12891),d=n(12896);class R extends d.e{constructor(o,H,n){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,g=arguments.length>5&&void 0!==arguments[5]&&arguments[5],O=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",o),this._texture=o.getEngine().createRawCubeTexture(H,n,E,k,g,O,Y,y)}update(o,H,n,E){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,o,H,n,E,k)}updateRGBDAsync(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,u.j)(this._texture,o,H,n,E).then((()=>{}))}clone(){return r.e.Clone((()=>{const o=this.bo(),H=this._texture,n=new R(o,H._bufferViewArray,H.width,H.format,H.type,H.generateMipMaps,H.invertY,H.samplingMode,H._compression);return 13===H.source&&n.updateRGBDAsync(H._bufferViewArrayArray,H._sphericalPolynomial,H._lodGenerationScale,H._lodGenerationOffset),n}),this)}}const W="EXT_lights_image_based";class i{constructor(o){this.name=W,this._loader=o,this.enabled=this._loader.isExtensionUsed(W)}dispose(){this._loader=null,delete this._lights}onLoading(){const o=this._loader.Ag.extensions;if(o&&o[this.name]){const H=o[this.name];this._lights=H.lights}}loadSceneAsync(o,H){return I.LoadExtensionAsync(o,H,this.name,(async(n,E)=>{this._loader._allMaterialsDirtyRequired=!0;const k=new Array;k.push(this._loader.loadSceneAsync(o,H)),this._loader.logOpen(`${n}`);const g=s.Get(`${n}/light`,this._lights,E.ng);return k.push(this._loadLightAsync(`/extensions/${this.name}/lights/${E.ng}`,g).then((o=>{this._loader.babylonScene.environmentTexture=o}))),this._loader.logClose(),await Promise.all(k).then((()=>{}))}))}_loadLightAsync(o,H){if(!H._loaded){const n=new Array;this._loader.logOpen(`${o}`);const E=new Array(H.specularImages.length);for(let k=0;k<H.specularImages.length;k++){const g=H.specularImages[k];E[k]=new Array(g.length);for(let H=0;H<g.length;H++){const O=`${o}/specularImages/${k}/${H}`;this._loader.logOpen(`${O}`);const Y=g[H],y=s.Get(O,this._loader.Ag.images,Y);n.push(this._loader.loadImageAsync(`/images/${Y}`,y).then((o=>{E[k][H]=o}))),this._loader.logClose()}}this._loader.logClose(),H._loaded=Promise.all(n).then((async()=>{const n=new R(this._loader.babylonScene,null,H.specularImageSize);if(n.name=H.name||"environment",H._babylonTexture=n,void 0!=H.zY&&(n.level=H.zY),H.rotation){let o=k.Quaternion.Mg(H.rotation);this._loader.babylonScene.useRightHandedSystem||(o=k.Quaternion.Inverse(o)),k.Matrix.FromQuaternionToRef(o,n.getReflectionTextureMatrix())}if(!H.irradianceCoefficients)throw new Error(`${o}: Irradiance coefficients are missing`);const g=w.e.Mg(H.irradianceCoefficients);g.scaleInPlace(H.zY),g.convertIrradianceToLambertianRadiance();const O=w.f.FromHarmonics(g),Y=(E.length-1)/Math.log2(H.specularImageSize);return await n.updateRGBDAsync(E,O,Y)}))}return H._loaded.then((()=>H._babylonTexture))}}F(W),a(W,!0,(o=>new i(o)));n(11757);const L="EXT_mesh_gpu_instancing";class oo{constructor(o){this.name=L,this._loader=o,this.enabled=this._loader.isExtensionUsed(L)}dispose(){this._loader=null}loadNodeAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(o,E)=>{this._loader._disableInstancedMesh++;const g=this._loader.loadNodeAsync(`/nodes/${H.index}`,H,n);if(this._loader._disableInstancedMesh--,!H._primitiveBabylonMeshes)return await g;const O=new Array;let Y=0;const y=H=>{if(void 0==E.attributes[H])return void O.push(Promise.resolve(null));const n=s.Get(`${o}/attributes/${H}`,this._loader.Ag.accessors,E.attributes[H]);if(O.push(this._loader._loadFloatAccessorAsync(`/accessors/${n.bufferView}`,n)),0===Y)Y=n.count;else if(Y!==n.count)throw new Error(`${o}/attributes: Instance buffer accessors do not have the same count.`)};return y("TRANSLATION"),y("ROTATION"),y("SCALE"),await g.then((async o=>{const[n,E,g]=await Promise.all(O),y=new Float32Array(16*Y);k.TmpVectors.xH[0].Wg(0,0,0),k.TmpVectors.Quaternion[0].Wg(0,0,0,1),k.TmpVectors.xH[1].Wg(1,1,1);for(let H=0;H<Y;++H)n&&k.xH.FromArrayToRef(n,3*H,k.TmpVectors.xH[0]),E&&k.Quaternion.FromArrayToRef(E,4*H,k.TmpVectors.Quaternion[0]),g&&k.xH.FromArrayToRef(g,3*H,k.TmpVectors.xH[1]),k.Matrix.ComposeToRef(k.TmpVectors.xH[1],k.TmpVectors.Quaternion[0],k.TmpVectors.xH[0],k.TmpVectors.Matrix[0]),k.TmpVectors.Matrix[0].copyToArray(y,16*H);for(const k of H._primitiveBabylonMeshes)k.xc("matrix",y,16,!0);return o}))}))}}F(L),a(L,!0,(o=>new oo(o)));let Ho=0,no=null;class Eo{static get Default(){return Eo._Default||(Eo._Default=new Eo),Eo._Default}constructor(){const o=Eo.Configuration.decoder;this._decoderModulePromise=O.Tools.LoadBabylonScriptAsync(o.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(o,H,n,E,k){await this._decoderModulePromise,0===Ho&&(MeshoptDecoder.useWorkers(1),Ho=1);const g=await MeshoptDecoder.decodeGltfBufferAsync(H,n,o,E,k);return null!==no&&clearTimeout(no),no=setTimeout((()=>{MeshoptDecoder.useWorkers(0),Ho=0,no=null}),1e3),g}}Eo.Configuration={decoder:{url:`${O.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Eo._Default=null;const ko="EXT_meshopt_compression";class go{constructor(o){this.name=ko,this.enabled=o.isExtensionUsed(ko),this._loader=o}dispose(){this._loader=null}loadBufferViewAsync(o,H){return I.LoadExtensionAsync(o,H,this.name,(async(n,E)=>{const k=H;if(k._meshOptData)return await k._meshOptData;const g=s.Get(`${o}/buffer`,this._loader.Ag.buffers,E.buffer);return k._meshOptData=this._loader.loadBufferAsync(`/buffers/${g.index}`,g,E.byteOffset||0,E.byteLength).then((async o=>await Eo.Default.decodeGltfBufferAsync(o,E.count,E.byteStride,E.mode,E.filter))),await k._meshOptData}))}}F(ko),a(ko,!0,(o=>new go(o)));const Oo="EXT_texture_webp";class Yo{constructor(o){this.name=Oo,this._loader=o,this.enabled=o.isExtensionUsed(Oo)}dispose(){this._loader=null}_loadTextureAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>{const g=void 0==H.sampler?I.DefaultSampler:s.Get(`${o}/sampler`,this._loader.Ag.samplers,H.sampler),O=s.Get(`${E}/source`,this._loader.Ag.images,k.source);return await this._loader._createTextureAsync(o,g,O,(o=>{n(o)}),void 0,!H._textureInfo.nonColorData)}))}}F(Oo),a(Oo,!0,(o=>new Yo(o)));const yo="EXT_texture_avif";class So{constructor(o){this.name=yo,this._loader=o,this.enabled=o.isExtensionUsed(yo)}dispose(){this._loader=null}_loadTextureAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>{const g=void 0==H.sampler?I.DefaultSampler:s.Get(`${o}/sampler`,this._loader.Ag.samplers,H.sampler),O=s.Get(`${E}/source`,this._loader.Ag.images,k.source);return await this._loader._createTextureAsync(o,g,O,(o=>{n(o)}),void 0,!H._textureInfo.nonColorData)}))}}F(yo),a(yo,!0,(o=>new So(o)));var Go=n(12878),co=n(11738);const Ao="EXT_lights_ies";class lo{constructor(o){this.name=Ao,this._loader=o,this.enabled=this._loader.isExtensionUsed(Ao)}dispose(){this._loader=null,delete this._lights}onLoading(){const o=this._loader.Ag.extensions;if(o&&o[this.name]){const H=o[this.name];this._lights=H.lights,s.Assign(this._lights)}}loadNodeAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,O)=>{let Y,y;this._loader._allMaterialsDirtyRequired=!0;const S=await this._loader.loadNodeAsync(o,H,(o=>{y=s.Get(E,this._lights,O.ng);const H=y.name||o.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,Y=new Go.d(H,k.xH.Zero(),k.xH.Backward(),0,1,this._loader.babylonScene),Y.angle=Math.PI/2,Y.innerAngle=0,Y._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,y._babylonLight=Y,Y.falloffType=co.e.FALLOFF_GLTF,Y.VY=O.color?g.NH.Mg(O.color):g.NH.White(),Y.zY=O.multiplier||1,Y.range=Number.MAX_VALUE,Y.parent=o,this._loader._babylonLights.push(Y),I.AddPointerMetadata(Y,E),n(o)}));let G;if(y.uri)G=await this._loader.loadUriAsync(o,y,y.uri);else{const H=s.Get(`${o}/bufferView`,this._loader.Ag.bufferViews,y.bufferView);G=await this._loader.loadBufferViewAsync(`/bufferViews/${H.index}`,H)}return Y.iesProfileTexture=new Q.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,G,!0,void 0,void 0,void 0,void 0,".ies"),S}))}}F(Ao),a(Ao,!0,(o=>new lo(o)));var xo=n(12912);const zo="KHR_draco_mesh_compression";class Vo{constructor(o){this.name=zo,this.useNormalizedFlagFromAccessor=!0,this._loader=o,this.enabled=xo.e.DefaultAvailable&&this._loader.isExtensionUsed(zo)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>{if(void 0!=H.mode&&4!==H.mode&&5!==H.mode)throw new Error(`${o}: Unsupported mode ${H.mode}`);const g={},O={},Y=(o,E)=>{const Y=k.attributes[o];if(void 0!=Y&&(n._delayInfo=n._delayInfo||[],-1===n._delayInfo.indexOf(E)&&n._delayInfo.push(E),g[E]=Y,this.useNormalizedFlagFromAccessor)){const n=s.TryGet(this._loader.Ag.accessors,H.attributes[o]);n&&(O[E]=n.normalized||!1)}};Y("POSITION",j.d.PositionKind),Y("NORMAL",j.d.NormalKind),Y("TANGENT",j.d.TangentKind),Y("TEXCOORD_0",j.d.UVKind),Y("TEXCOORD_1",j.d.UV2Kind),Y("TEXCOORD_2",j.d.UV3Kind),Y("TEXCOORD_3",j.d.UV4Kind),Y("TEXCOORD_4",j.d.UV5Kind),Y("TEXCOORD_5",j.d.UV6Kind),Y("JOINTS_0",j.d.MatricesIndicesKind),Y("WEIGHTS_0",j.d.MatricesWeightsKind),Y("COLOR_0",j.d.ColorKind);const y=s.Get(E,this._loader.Ag.bufferViews,k.bufferView);return y._dracoBabylonGeometry||(y._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${y.index}`,y).then((async E=>{const k=this.dracoDecoder||xo.e.Default,Y=s.TryGet(this._loader.Ag.accessors,H.attributes.POSITION),y=this._loader.parent.alwaysComputeBoundingBox||n.skeleton||!Y?null:U(Y);return await k._decodeMeshToGeometryForGltfAsync(n.name,this._loader.babylonScene,E,g,O,y).catch((H=>{throw new Error(`${o}: ${H.message}`)}))}))),await y._dracoBabylonGeometry}))}}F(zo),a(zo,!0,(o=>new Vo(o)));var Jo=n(12916),No=n(11170),ho=n(11177),Qo=n(11623),po=n(11797),jo=n(11140);Qo.b.AddNodeConstructor("Light_Type_0",((o,H)=>()=>new mo(o,k.xH.Zero(),H)));class mo extends po.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(o){this._shadowAngle=o,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(o){const H=this.needCube();if(this._direction=o,this.needCube()!==H&&this._shadowGenerators){const o=this._shadowGenerators.values();for(let H=o.next();!0!==H.done;H=o.next()){H.value.recreateShadowMap()}}}constructor(o,H,n){super(o,n),this._shadowAngle=Math.PI/2,this.position=H}getClassName(){return"PointLight"}getTypeID(){return co.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(o){if(this.direction)return super.getShadowDirection(o);switch(o){case 0:return new k.xH(1,0,0);case 1:return new k.xH(-1,0,0);case 2:return new k.xH(0,-1,0);case 3:return new k.xH(0,1,0);case 4:return new k.xH(0,0,1);case 5:return new k.xH(0,0,-1)}return k.xH.Zero()}_setDefaultShadowProjectionMatrix(o,H,n){const E=this.bo().activeCamera;if(!E)return;const g=void 0!==this.shadowMinZ?this.shadowMinZ:E.Cg,O=void 0!==this.shadowMaxZ?this.shadowMaxZ:E.maxZ,Y=this.bo().getEngine().useReverseDepthBuffer;k.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,Y?O:g,Y?g:O,o,!0,this._scene.getEngine().isNDCHalfZRange,void 0,Y)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(o,H){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,H):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,H),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,H),this}transferToNodeMaterialEffect(o,H){return this.computeTransformedInformation()?o.setFloat3(H,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):o.setFloat3(H,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(o,H){o["POINTLIGHT"+H]=!0}}(0,No.c)([(0,ho.P)()],mo.prototype,"shadowAngle",null),(0,jo.e)("BABYLON.PointLight",mo);const Po="KHR_lights_punctual";class bo{constructor(o){this.name=Po,this._loader=o,this.enabled=this._loader.isExtensionUsed(Po)}dispose(){this._loader=null,delete this._lights}onLoading(){const o=this._loader.Ag.extensions;if(o&&o[this.name]){const H=o[this.name];this._lights=H.lights,s.Assign(this._lights)}}loadNodeAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,O)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(o,H,(o=>{let H;const Y=s.Get(E,this._lights,O.ng),y=Y.name||o.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,Y.type){case"directional":{const o=new Jo.b(y,k.xH.Backward(),this._loader.babylonScene);o.position.AY(0),H=o;break}case"point":H=new mo(y,k.xH.Zero(),this._loader.babylonScene);break;case"spot":{const o=new Go.d(y,k.xH.Zero(),k.xH.Backward(),0,1,this._loader.babylonScene);o.angle=2*(Y.spot&&Y.spot.outerConeAngle||Math.PI/4),o.innerAngle=2*(Y.spot&&Y.spot.innerConeAngle||0),H=o;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${E}: Invalid light type (${Y.type})`)}H._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,Y._babylonLight=H,H.falloffType=co.e.FALLOFF_GLTF,H.VY=Y.color?g.NH.Mg(Y.color):g.NH.White(),H.zY=void 0==Y.zY?1:Y.zY,H.range=void 0==Y.range?Number.MAX_VALUE:Y.range,H.parent=o,this._loader._babylonLights.push(H),I.AddPointerMetadata(H,E),n(o)})))))}}F(Po),a(Po,!0,(o=>new bo(o)));const eo="KHR_materials_pbrSpecularGlossiness";class Zo{constructor(o){this.name=eo,this.order=200,this._loader=o,this.enabled=this._loader.isExtensionUsed(eo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>{const g=new Array;return g.push(this._loader.loadMaterialBasePropertiesAsync(o,H,n)),g.push(this._loadSpecularGlossinessPropertiesAsync(E,k,n)),this._loader.loadMaterialAlphaProperties(o,H,n),await Promise.all(g).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(o,H,n){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);const E=new Array;return n.metallic=null,n.roughness=null,H.diffuseFactor?(n.albedoColor=g.NH.Mg(H.diffuseFactor),n.alpha=H.diffuseFactor[3]):n.albedoColor=g.NH.White(),n.reflectivityColor=H.specularFactor?g.NH.Mg(H.specularFactor):g.NH.White(),n.microSurface=void 0==H.glossinessFactor?1:H.glossinessFactor,H.diffuseTexture&&E.push(this._loader.loadTextureInfoAsync(`${o}/diffuseTexture`,H.diffuseTexture,(o=>{o.name=`${n.name} (Diffuse)`,n.albedoTexture=o}))),H.specularGlossinessTexture&&(E.push(this._loader.loadTextureInfoAsync(`${o}/specularGlossinessTexture`,H.specularGlossinessTexture,(o=>{o.name=`${n.name} (Specular Glossiness)`,n.reflectivityTexture=o,n.reflectivityTexture.fg=!0}))),n.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(E).then((()=>{}))}}F(eo),a(eo,!0,(o=>new Zo(o)));const Mo="KHR_materials_unlit";class Ko{constructor(o){this.name=Mo,this.order=210,this._loader=o,this.enabled=this._loader.isExtensionUsed(Mo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async()=>await this._loadUnlitPropertiesAsync(o,H,n)))}_loadUnlitPropertiesAsync(o,H,n){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);const E=new Array;n.unlit=!0;const k=H.pbrMetallicRoughness;return k&&(k.baseColorFactor?(n.albedoColor=g.NH.Mg(k.baseColorFactor),n.alpha=k.baseColorFactor[3]):n.albedoColor=g.NH.White(),k.baseColorTexture&&E.push(this._loader.loadTextureInfoAsync(`${o}/baseColorTexture`,k.baseColorTexture,(o=>{o.name=`${n.name} (Base Color)`,n.albedoTexture=o})))),H.doubleSided&&(n.Rg=!1,n.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(o,H,n),Promise.all(E).then((()=>{}))}}F(Mo),a(Mo,!0,(o=>new Ko(o)));const fo="KHR_materials_clearcoat";class Bo{constructor(o){this.name=fo,this.order=190,this._loader=o,this.enabled=this._loader.isExtensionUsed(fo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>{const g=new Array;g.push(this._loader.loadMaterialPropertiesAsync(o,H,n)),g.push(this._loadClearCoatPropertiesAsync(E,k,n)),await Promise.all(g)}))}_loadClearCoatPropertiesAsync(o,H,n){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);const E=new Array;return n.clearCoat.isEnabled=!0,n.clearCoat.useRoughnessFromMainTexture=!1,n.clearCoat.remapF0OnInterfaceChange=!1,void 0!=H.clearcoatFactor?n.clearCoat.zY=H.clearcoatFactor:n.clearCoat.zY=0,H.clearcoatTexture&&E.push(this._loader.loadTextureInfoAsync(`${o}/clearcoatTexture`,H.clearcoatTexture,(o=>{o.name=`${n.name} (ClearCoat)`,n.clearCoat.texture=o}))),void 0!=H.clearcoatRoughnessFactor?n.clearCoat.roughness=H.clearcoatRoughnessFactor:n.clearCoat.roughness=0,H.clearcoatRoughnessTexture&&(H.clearcoatRoughnessTexture.nonColorData=!0,E.push(this._loader.loadTextureInfoAsync(`${o}/clearcoatRoughnessTexture`,H.clearcoatRoughnessTexture,(o=>{o.name=`${n.name} (ClearCoat Roughness)`,n.clearCoat.textureRoughness=o})))),H.clearcoatNormalTexture&&(H.clearcoatNormalTexture.nonColorData=!0,E.push(this._loader.loadTextureInfoAsync(`${o}/clearcoatNormalTexture`,H.clearcoatNormalTexture,(o=>{o.name=`${n.name} (ClearCoat Normal)`,n.clearCoat.bumpTexture=o}))),n.invertNormalMapX=!n.bo().useRightHandedSystem,n.invertNormalMapY=n.bo().useRightHandedSystem,void 0!=H.clearcoatNormalTexture.scale&&(n.clearCoat.bumpTexture.level=H.clearcoatNormalTexture.scale)),Promise.all(E).then((()=>{}))}}F(fo),a(fo,!0,(o=>new Bo(o)));const qo="KHR_materials_iridescence";class Do{constructor(o){this.name=qo,this.order=195,this._loader=o,this.enabled=this._loader.isExtensionUsed(qo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>{const g=new Array;return g.push(this._loader.loadMaterialPropertiesAsync(o,H,n)),g.push(this._loadIridescencePropertiesAsync(E,k,n)),await Promise.all(g).then((()=>{}))}))}_loadIridescencePropertiesAsync(o,H,n){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);const E=new Array;return n.iridescence.isEnabled=!0,n.iridescence.zY=H.iridescenceFactor??0,n.iridescence.indexOfRefraction=H.iridescenceIor??H.iridescenceIOR??1.3,n.iridescence.minimumThickness=H.iridescenceThicknessMinimum??100,n.iridescence.maximumThickness=H.iridescenceThicknessMaximum??400,H.iridescenceTexture&&E.push(this._loader.loadTextureInfoAsync(`${o}/iridescenceTexture`,H.iridescenceTexture,(o=>{o.name=`${n.name} (Iridescence)`,n.iridescence.texture=o}))),H.iridescenceThicknessTexture&&E.push(this._loader.loadTextureInfoAsync(`${o}/iridescenceThicknessTexture`,H.iridescenceThicknessTexture,(o=>{o.name=`${n.name} (Iridescence Thickness)`,n.iridescence.thicknessTexture=o}))),Promise.all(E).then((()=>{}))}}F(qo),a(qo,!0,(o=>new Do(o)));const To="KHR_materials_anisotropy";class ao{constructor(o){this.name=To,this.order=195,this._loader=o,this.enabled=this._loader.isExtensionUsed(To)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>{const g=new Array;g.push(this._loader.loadMaterialPropertiesAsync(o,H,n)),g.push(this._loadIridescencePropertiesAsync(E,k,n)),await Promise.all(g)}))}async _loadIridescencePropertiesAsync(o,H,n){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);const E=new Array;n.anisotropy.isEnabled=!0,n.anisotropy.zY=H.anisotropyStrength??0,n.anisotropy.angle=H.anisotropyRotation??0,H.anisotropyTexture&&(H.anisotropyTexture.nonColorData=!0,E.push(this._loader.loadTextureInfoAsync(`${o}/anisotropyTexture`,H.anisotropyTexture,(o=>{o.name=`${n.name} (Anisotropy Intensity)`,n.anisotropy.texture=o})))),await Promise.all(E)}}F(To),a(To,!0,(o=>new ao(o)));const Fo="KHR_materials_emissive_strength";class Co{constructor(o){this.name=Fo,this.order=170,this._loader=o,this.enabled=this._loader.isExtensionUsed(Fo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>await this._loader.loadMaterialPropertiesAsync(o,H,n).then((()=>{this._loadEmissiveProperties(E,k,n)}))))}_loadEmissiveProperties(o,H,n){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);void 0!==H.emissiveStrength&&(n.emissiveIntensity=H.emissiveStrength)}}F(Fo),a(Fo,!0,(o=>new Co(o)));const to="KHR_materials_sheen";class Xo{constructor(o){this.name=to,this.order=190,this._loader=o,this.enabled=this._loader.isExtensionUsed(to)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>{const g=new Array;return g.push(this._loader.loadMaterialPropertiesAsync(o,H,n)),g.push(this._loadSheenPropertiesAsync(E,k,n)),await Promise.all(g).then((()=>{}))}))}_loadSheenPropertiesAsync(o,H,n){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);const E=new Array;return n.sheen.isEnabled=!0,n.sheen.zY=1,void 0!=H.sheenColorFactor?n.sheen.color=g.NH.Mg(H.sheenColorFactor):n.sheen.color=g.NH.Black(),H.sheenColorTexture&&E.push(this._loader.loadTextureInfoAsync(`${o}/sheenColorTexture`,H.sheenColorTexture,(o=>{o.name=`${n.name} (Sheen Color)`,n.sheen.texture=o}))),void 0!==H.sheenRoughnessFactor?n.sheen.roughness=H.sheenRoughnessFactor:n.sheen.roughness=0,H.sheenRoughnessTexture&&(H.sheenRoughnessTexture.nonColorData=!0,E.push(this._loader.loadTextureInfoAsync(`${o}/sheenRoughnessTexture`,H.sheenRoughnessTexture,(o=>{o.name=`${n.name} (Sheen Roughness)`,n.sheen.textureRoughness=o})))),n.sheen.albedoScaling=!0,n.sheen.useRoughnessFromMainTexture=!1,Promise.all(E).then((()=>{}))}}F(to),a(to,!0,(o=>new Xo(o)));var so=n(11683);const Uo="KHR_materials_specular";class Io{constructor(o){this.name=Uo,this.order=190,this._loader=o,this.enabled=this._loader.isExtensionUsed(Uo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>{const g=new Array;if(g.push(this._loader.loadMaterialPropertiesAsync(o,H,n)),g.push(this._loadSpecularPropertiesAsync(E,k,n)),k.extensions&&k.extensions.EXT_materials_specular_edge_color&&n instanceof h.c){k.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(n.brdf.dielectricSpecularModel=so.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,n.brdf.conductorSpecularModel=so.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(g).then((()=>{}))}))}_loadSpecularPropertiesAsync(o,H,n){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);const E=new Array;return void 0!==H.specularFactor&&(n.metallicF0Factor=H.specularFactor),void 0!==H.specularColorFactor&&(n.metallicReflectanceColor=g.NH.Mg(H.specularColorFactor)),H.specularTexture&&(H.specularTexture.nonColorData=!0,E.push(this._loader.loadTextureInfoAsync(`${o}/specularTexture`,H.specularTexture,(o=>{o.name=`${n.name} (Specular)`,n.metallicReflectanceTexture=o,n.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),H.specularColorTexture&&E.push(this._loader.loadTextureInfoAsync(`${o}/specularColorTexture`,H.specularColorTexture,(o=>{o.name=`${n.name} (Specular Color)`,n.reflectanceTexture=o}))),Promise.all(E).then((()=>{}))}}F(Uo),a(Uo,!0,(o=>new Io(o)));const vo="KHR_materials_ior";class wo{constructor(o){this.name=vo,this.order=180,this._loader=o,this.enabled=this._loader.isExtensionUsed(vo)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>{const g=new Array;return g.push(this._loader.loadMaterialPropertiesAsync(o,H,n)),g.push(this._loadIorPropertiesAsync(E,k,n)),await Promise.all(g).then((()=>{}))}))}_loadIorPropertiesAsync(o,H,n){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);return void 0!==H.ior?n.indexOfRefraction=H.ior:n.indexOfRefraction=wo._DEFAULT_IOR,Promise.resolve()}}wo._DEFAULT_IOR=1.5,F(vo),a(vo,!0,(o=>new wo(o)));const ro="KHR_materials_variants";class uo{constructor(o){this.name=ro,this._loader=o,this.enabled=this._loader.isExtensionUsed(ro)}dispose(){this._loader=null}static GetAvailableVariants(o){const H=this._GetExtensionMetadata(o);return H?Object.keys(H.variants):[]}getAvailableVariants(o){return uo.GetAvailableVariants(o)}static SelectVariant(o,H){const n=this._GetExtensionMetadata(o);if(!n)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${ro} extension`);const E=o=>{const H=n.variants[o];if(H)for(const n of H)n.mesh.material=n.material};if(H instanceof Array)for(const k of H)E(k);else E(H);n.lastSelected=H}selectVariant(o,H){uo.SelectVariant(o,H)}static Reset(o){const H=this._GetExtensionMetadata(o);if(!H)throw new Error(`Cannot reset on a glTF mesh that does not have the ${ro} extension`);for(const n of H.original)n.mesh.material=n.material;H.lastSelected=null}reset(o){uo.Reset(o)}static GetLastSelectedVariant(o){const H=this._GetExtensionMetadata(o);if(!H)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${ro} extension`);return H.lastSelected}getLastSelectedVariant(o){return uo.GetLastSelectedVariant(o)}static _GetExtensionMetadata(o){var H,n;return(null===o||void 0===o||null===(H=o._internalMetadata)||void 0===H||null===(n=H.Ag)||void 0===n?void 0:n[ro])||null}onLoading(){const o=this._loader.Ag.extensions;if(o&&o[this.name]){const H=o[this.name];this._variants=H.variants}}onReady(){const o=this._loader.rootBabylonMesh;if(o){var H;const n=this._loader.parent.extensionOptions[ro];null!==n&&void 0!==n&&n.defaultVariant&&uo.SelectVariant(o,n.defaultVariant),null===n||void 0===n||null===(H=n.onLoaded)||void 0===H||H.call(n,{get variants(){return uo.GetAvailableVariants(o)},get selectedVariant(){const H=uo.GetLastSelectedVariant(o);return H?Array.isArray(H)?H[0]:H:uo.GetAvailableVariants(o)[0]},set selectedVariant(H){uo.SelectVariant(o,H)}})}}_loadMeshPrimitiveAsync(o,H,n,E,k,g){return I.LoadExtensionAsync(o,k,this.name,(async(O,Y)=>{const y=new Array;return y.push(this._loader._loadMeshPrimitiveAsync(o,H,n,E,k,(H=>{if(g(H),H instanceof b.b){const n=I._GetDrawMode(o,k.mode),E=this._loader.rootBabylonMesh,g=E?E._internalMetadata=E._internalMetadata||{}:{},S=g.Ag=g.Ag||{},G=S[ro]=S[ro]||{lastSelected:null,original:[],variants:{}};G.original.push({mesh:H,material:H.material});for(let o=0;o<Y.mappings.length;++o){const k=Y.mappings[o],g=s.Get(`${O}/mappings/${o}/material`,this._loader.Ag.materials,k.material);y.push(this._loader._loadMaterialAsync(`#/materials/${k.material}`,g,H,n,(o=>{for(let n=0;n<k.variants.length;++n){const g=k.variants[n],O=s.Get(`/extensions/${ro}/variants/${g}`,this._variants,g);G.variants[O.name]=G.variants[O.name]||[],G.variants[O.name].push({mesh:H,material:o}),H.onClonedObservable.add((o=>{const n=o;let k=null,g=n;do{if(g=g.parent,!g)return;k=uo._GetExtensionMetadata(g)}while(null===k);if(E&&k===uo._GetExtensionMetadata(E)){g._internalMetadata={};for(const o in E._internalMetadata)g._internalMetadata[o]=E._internalMetadata[o];g._internalMetadata.Ag=[];for(const o in E._internalMetadata.Ag)g._internalMetadata.Ag[o]=E._internalMetadata.Ag[o];g._internalMetadata.Ag[ro]={lastSelected:null,original:[],variants:{}};for(const o of k.original)g._internalMetadata.Ag[ro].original.push({mesh:o.mesh,material:o.material});for(const o in k.variants)if(Object.prototype.hasOwnProperty.call(k.variants,o)){g._internalMetadata.Ag[ro].variants[o]=[];for(const H of k.variants[o])g._internalMetadata.Ag[ro].variants[o].push({mesh:H.mesh,material:H.material})}k=g._internalMetadata.Ag[ro]}for(const E of k.original)E.mesh===H&&(E.mesh=n);for(const E of k.variants[O.name])E.mesh===H&&(E.mesh=n)}))}})))}}}))),await Promise.all(y).then((o=>{let[H]=o;return H}))}))}}F(ro),a(ro,!0,(o=>new uo(o)));var Ro=n(11252);class Wo{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:so.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(o,H){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Wo._GetDefaultOptions(),...o},this._scene=H,this._scene._transmissionHelper=this,this.onErrorObservable=new G.d,this._scene.yg.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(o){if(!Object.keys(o).filter((H=>this._options[H]!==o[H])).length)return;const H={...this._options,...o},n=this._options;this._options=H,H.renderSize===n.renderSize&&H.renderTargetTextureType===n.renderTargetTextureType&&H.generateMipmaps===n.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=H.samples,this._opaqueRenderTarget.lodGenerationScale=H.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=H.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(o){return!!o&&!!(o instanceof h.c&&o.subSurface.isRefractionEnabled)}_addMesh(o){this._materialObservers[o.uniqueId]=o.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),O.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(o.material)?(o.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(o)&&this._transparentMeshesCache.push(o)):-1===this._opaqueMeshesCache.indexOf(o)&&this._opaqueMeshesCache.push(o)}))}_removeMesh(o){o.onMaterialChangedObservable.remove(this._materialObservers[o.uniqueId]),delete this._materialObservers[o.uniqueId];let H=this._transparentMeshesCache.indexOf(o);-1!==H&&this._transparentMeshesCache.splice(H,1),H=this._opaqueMeshesCache.indexOf(o),-1!==H&&this._opaqueMeshesCache.splice(H,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(o){const H=this._transparentMeshesCache.indexOf(o),n=this._opaqueMeshesCache.indexOf(o);this._shouldRenderAsTransmission(o.material)?(o.material instanceof h.c&&(o.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==n?(this._opaqueMeshesCache.splice(n,1),this._transparentMeshesCache.push(o)):-1===H&&this._transparentMeshesCache.push(o)):-1!==H?(this._transparentMeshesCache.splice(H,1),this._opaqueMeshesCache.push(o)):-1===n&&this._opaqueMeshesCache.push(o)}_isRenderTargetValid(){var o;return null!==(null===(o=this._opaqueRenderTarget)||void 0===o?void 0:o.getInternalTexture())}_setupRenderTargets(){var o;let H;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Ro.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(o=this._options.clearColor)||void 0===o?void 0:o.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((o=>{H=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?o.clearColor.S(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(o.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=H}));for(const n of this._transparentMeshesCache)this._shouldRenderAsTransmission(n.material)&&(n.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const io="KHR_materials_transmission";class Lo{constructor(o){this.name=io,this.order=175,this._loader=o,this.enabled=this._loader.isExtensionUsed(io),this.enabled&&(o.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>{const g=new Array;return g.push(this._loader.loadMaterialPropertiesAsync(o,H,n)),g.push(this._loadTransparentPropertiesAsync(E,H,n,k)),await Promise.all(g).then((()=>{}))}))}_loadTransparentPropertiesAsync(o,H,n,E){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);const k=n;if(k.subSurface.isRefractionEnabled=!0,k.subSurface.volumeIndexOfRefraction=1,k.subSurface.useAlbedoToTintRefraction=!0,void 0===E.transmissionFactor)return k.subSurface.refractionIntensity=0,k.subSurface.isRefractionEnabled=!1,Promise.resolve();{var g;k.subSurface.refractionIntensity=E.transmissionFactor;const o=k.bo();if(k.subSurface.refractionIntensity&&!o._transmissionHelper)new Wo({},k.bo());else if(k.subSurface.refractionIntensity&&(null===(g=o._transmissionHelper)||void 0===g||!g._isRenderTargetValid())){var O;null===(O=o._transmissionHelper)||void 0===O||O._setupRenderTargets()}}return k.subSurface.minimumThickness=0,k.subSurface.maximumThickness=0,E.transmissionTexture?(E.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${o}/transmissionTexture`,E.transmissionTexture,void 0).then((o=>{o.name=`${n.name} (Transmission)`,k.subSurface.refractionIntensityTexture=o,k.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}F(io),a(io,!0,(o=>new Lo(o)));const oH="KHR_materials_diffuse_transmission";class HH{constructor(o){this.name=oH,this.order=174,this._loader=o,this.enabled=this._loader.isExtensionUsed(oH),this.enabled&&(o.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>{const g=new Array;return g.push(this._loader.loadMaterialPropertiesAsync(o,H,n)),g.push(this._loadTranslucentPropertiesAsync(E,H,n,k)),await Promise.all(g).then((()=>{}))}))}_loadTranslucentPropertiesAsync(o,H,n,E){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);const k=n;if(k.subSurface.isTranslucencyEnabled=!0,k.subSurface.volumeIndexOfRefraction=1,k.subSurface.minimumThickness=0,k.subSurface.maximumThickness=0,k.subSurface.useAlbedoToTintTranslucency=!1,void 0===E.diffuseTransmissionFactor)return k.subSurface.translucencyIntensity=0,k.subSurface.isTranslucencyEnabled=!1,Promise.resolve();k.subSurface.translucencyIntensity=E.diffuseTransmissionFactor;const O=new Array;return k.subSurface.useGltfStyleTextures=!0,E.diffuseTransmissionTexture&&(E.diffuseTransmissionTexture.nonColorData=!0,O.push(this._loader.loadTextureInfoAsync(`${o}/diffuseTransmissionTexture`,E.diffuseTransmissionTexture).then((o=>{o.name=`${n.name} (Diffuse Transmission)`,k.subSurface.translucencyIntensityTexture=o})))),void 0!==E.diffuseTransmissionColorFactor?k.subSurface.translucencyColor=g.NH.Mg(E.diffuseTransmissionColorFactor):k.subSurface.translucencyColor=g.NH.White(),E.diffuseTransmissionColorTexture&&O.push(this._loader.loadTextureInfoAsync(`${o}/diffuseTransmissionColorTexture`,E.diffuseTransmissionColorTexture).then((o=>{o.name=`${n.name} (Diffuse Transmission Color)`,k.subSurface.translucencyColorTexture=o}))),Promise.all(O).then((()=>{}))}}F(oH),a(oH,!0,(o=>new HH(o)));const nH="KHR_materials_volume";class EH{constructor(o){this.name=nH,this.order=173,this._loader=o,this.enabled=this._loader.isExtensionUsed(nH),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>{const g=new Array;return g.push(this._loader.loadMaterialPropertiesAsync(o,H,n)),g.push(this._loadVolumePropertiesAsync(E,H,n,k)),await Promise.all(g).then((()=>{}))}))}_loadVolumePropertiesAsync(o,H,n,E){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);if(!n.subSurface.isRefractionEnabled&&!n.subSurface.isTranslucencyEnabled||!E.thicknessFactor)return Promise.resolve();n.subSurface.volumeIndexOfRefraction=n.indexOfRefraction;const k=void 0!==E.attenuationDistance?E.attenuationDistance:Number.MAX_VALUE;return n.subSurface.tintColorAtDistance=k,void 0!==E.attenuationColor&&3==E.attenuationColor.length&&n.subSurface.tintColor.Wg(E.attenuationColor[0],E.attenuationColor[1],E.attenuationColor[2]),n.subSurface.minimumThickness=0,n.subSurface.maximumThickness=E.thicknessFactor,n.subSurface.useThicknessAsDepth=!0,E.thicknessTexture?(E.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${o}/thicknessTexture`,E.thicknessTexture).then((o=>{o.name=`${n.name} (Thickness)`,n.subSurface.thicknessTexture=o,n.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}F(nH),a(nH,!0,(o=>new EH(o)));const kH="KHR_materials_dispersion";class gH{constructor(o){this.name=kH,this.order=174,this._loader=o,this.enabled=this._loader.isExtensionUsed(kH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>{const g=new Array;return g.push(this._loader.loadMaterialPropertiesAsync(o,H,n)),g.push(this._loadDispersionPropertiesAsync(E,H,n,k)),await Promise.all(g).then((()=>{}))}))}_loadDispersionPropertiesAsync(o,H,n,E){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);return n.subSurface.isRefractionEnabled&&E.dispersion?(n.subSurface.isDispersionEnabled=!0,n.subSurface.dispersion=E.dispersion,Promise.resolve()):Promise.resolve()}}F(kH),a(kH,!0,(o=>new gH(o)));const OH="EXT_materials_diffuse_roughness";class YH{constructor(o){this.name=OH,this.order=190,this._loader=o,this.enabled=this._loader.isExtensionUsed(OH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>{const g=new Array;return g.push(this._loader.loadMaterialPropertiesAsync(o,H,n)),g.push(this._loadDiffuseRoughnessPropertiesAsync(E,k,n)),await Promise.all(g).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(o,H,n){if(!(n instanceof h.c))throw new Error(`${o}: Material type not supported`);const E=new Array;return n.brdf.baseDiffuseModel=so.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=H.diffuseRoughnessFactor?n.baseDiffuseRoughness=H.diffuseRoughnessFactor:n.baseDiffuseRoughness=0,H.diffuseRoughnessTexture&&E.push(this._loader.loadTextureInfoAsync(`${o}/diffuseRoughnessTexture`,H.diffuseRoughnessTexture,(o=>{o.name=`${n.name} (Diffuse Roughness)`,n.baseDiffuseRoughnessTexture=o}))),Promise.all(E).then((()=>{}))}}F(OH),a(OH,!0,(o=>new YH(o)));const yH="KHR_mesh_quantization";class SH{constructor(o){this.name=yH,this.enabled=o.isExtensionUsed(yH)}dispose(){}}F(yH),a(yH,!0,(o=>new SH(o)));const GH="KHR_texture_basisu";class cH{constructor(o){this.name=GH,this._loader=o,this.enabled=o.isExtensionUsed(GH)}dispose(){this._loader=null}_loadTextureAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>{const g=void 0==H.sampler?I.DefaultSampler:s.Get(`${o}/sampler`,this._loader.Ag.samplers,H.sampler),O=s.Get(`${E}/source`,this._loader.Ag.images,k.source);return await this._loader._createTextureAsync(o,g,O,(o=>{n(o)}),H._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!H._textureInfo.nonColorData)}))}}F(GH),a(GH,!0,(o=>new cH(o)));const AH="KHR_texture_transform";class lH{constructor(o){this.name=AH,this._loader=o,this.enabled=this._loader.isExtensionUsed(AH)}dispose(){this._loader=null}loadTextureInfoAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(E,k)=>await this._loader.loadTextureInfoAsync(o,H,(o=>{if(!(o instanceof Q.c))throw new Error(`${E}: Texture type not supported`);k.offset&&(o.uOffset=k.offset[0],o.vOffset=k.offset[1]),o.uRotationCenter=0,o.vRotationCenter=0,k.rotation&&(o.wAng=-k.rotation),k.scale&&(o.uScale=k.scale[0],o.vScale=k.scale[1]),void 0!=k.texCoord&&(o.coordinatesIndex=k.texCoord),n(o)}))))}}F(AH),a(AH,!0,(o=>new lH(o)));const xH="KHR_xmp_json_ld";class zH{constructor(o){this.name=xH,this.order=100,this._loader=o,this.enabled=this._loader.isExtensionUsed(xH)}dispose(){this._loader=null}onLoading(){var o,H,n;if(null===this._loader.rootBabylonMesh)return;const E=null===(o=this._loader.Ag.extensions)||void 0===o?void 0:o.KHR_xmp_json_ld,k=null===(H=this._loader.Ag.asset)||void 0===H||null===(n=H.extensions)||void 0===n?void 0:n.KHR_xmp_json_ld;if(E&&k){const o=+k.packet;E.packets&&o<E.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=E.packets[o])}}}function VH(o,H,n,E){return g.NH.Mg(H,n).scale(E)}function JH(o,H,n,E){return H[n]*E}function NH(o,H,n,E){return-H[n]*E}function hH(o,H,n,E){return H[n+1]*E}function QH(o,H,n,E){return H[n]*E*2}function pH(o){return{scale:[new mH(A.b.ANIMATIONTYPE_FLOAT,`${o}.uScale`,JH,(()=>2)),new mH(A.b.ANIMATIONTYPE_FLOAT,`${o}.vScale`,hH,(()=>2))],offset:[new mH(A.b.ANIMATIONTYPE_FLOAT,`${o}.uOffset`,JH,(()=>2)),new mH(A.b.ANIMATIONTYPE_FLOAT,`${o}.vOffset`,hH,(()=>2))],rotation:[new mH(A.b.ANIMATIONTYPE_FLOAT,`${o}.wAng`,NH,(()=>1))]}}F(xH),a(xH,!0,(o=>new zH(o)));class jH extends v.AnimationPropertyInfo{buildAnimations(o,H,n,E){return[{babylonAnimatable:o._babylonCamera,babylonAnimation:this._buildAnimation(H,n,E)}]}}class mH extends v.AnimationPropertyInfo{buildAnimations(o,H,n,E){const k=[];for(const g in o._data)k.push({babylonAnimatable:o._data[g].babylonMaterial,babylonAnimation:this._buildAnimation(H,n,E)});return k}}class PH extends v.AnimationPropertyInfo{buildAnimations(o,H,n,E){return[{babylonAnimatable:o._babylonLight,babylonAnimation:this._buildAnimation(H,n,E)}]}}(0,C.i)("/cameras/{}/orthographic/xmag",[new jH(A.b.ANIMATIONTYPE_FLOAT,"orthoLeft",NH,(()=>1)),new jH(A.b.ANIMATIONTYPE_FLOAT,"orthoRight",hH,(()=>1))]),(0,C.i)("/cameras/{}/orthographic/ymag",[new jH(A.b.ANIMATIONTYPE_FLOAT,"orthoBottom",NH,(()=>1)),new jH(A.b.ANIMATIONTYPE_FLOAT,"orthoTop",hH,(()=>1))]),(0,C.i)("/cameras/{}/orthographic/zfar",[new jH(A.b.ANIMATIONTYPE_FLOAT,"maxZ",JH,(()=>1))]),(0,C.i)("/cameras/{}/orthographic/znear",[new jH(A.b.ANIMATIONTYPE_FLOAT,"Cg",JH,(()=>1))]),(0,C.i)("/cameras/{}/perspective/yfov",[new jH(A.b.ANIMATIONTYPE_FLOAT,"fov",JH,(()=>1))]),(0,C.i)("/cameras/{}/perspective/zfar",[new jH(A.b.ANIMATIONTYPE_FLOAT,"maxZ",JH,(()=>1))]),(0,C.i)("/cameras/{}/perspective/znear",[new jH(A.b.ANIMATIONTYPE_FLOAT,"Cg",JH,(()=>1))]),(0,C.i)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new mH(A.b.ANIMATIONTYPE_COLOR3,"albedoColor",VH,(()=>4)),new mH(A.b.ANIMATIONTYPE_FLOAT,"alpha",(function(o,H,n,E){return H[n+3]*E}),(()=>4))]),(0,C.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new mH(A.b.ANIMATIONTYPE_FLOAT,"metallic",JH,(()=>1))]),(0,C.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new mH(A.b.ANIMATIONTYPE_FLOAT,"roughness",JH,(()=>1))]);const bH=pH("albedoTexture");(0,C.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",bH.scale),(0,C.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",bH.offset),(0,C.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",bH.rotation);const eH=pH("metallicTexture");(0,C.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",eH.scale),(0,C.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",eH.offset),(0,C.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",eH.rotation),(0,C.i)("/materials/{}/emissiveFactor",[new mH(A.b.ANIMATIONTYPE_COLOR3,"emissiveColor",VH,(()=>3))]);const ZH=pH("bumpTexture");(0,C.i)("/materials/{}/normalTexture/scale",[new mH(A.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",JH,(()=>1))]),(0,C.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",ZH.scale),(0,C.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",ZH.offset),(0,C.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",ZH.rotation),(0,C.i)("/materials/{}/occlusionTexture/strength",[new mH(A.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",JH,(()=>1))]);const MH=pH("ambientTexture");(0,C.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",MH.scale),(0,C.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",MH.offset),(0,C.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",MH.rotation);const KH=pH("emissiveTexture");(0,C.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",KH.scale),(0,C.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",KH.offset),(0,C.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",KH.rotation),(0,C.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new mH(A.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",JH,(()=>1))]),(0,C.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new mH(A.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",JH,(()=>1))]);const fH=pH("anisotropy.texture");(0,C.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",fH.scale),(0,C.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",fH.offset),(0,C.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",fH.rotation),(0,C.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new mH(A.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",JH,(()=>1))]),(0,C.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new mH(A.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",JH,(()=>1))]);const BH=pH("clearCoat.texture");(0,C.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",BH.scale),(0,C.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",BH.offset),(0,C.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",BH.rotation);const qH=pH("clearCoat.bumpTexture");(0,C.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new mH(A.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",JH,(()=>1))]),(0,C.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",qH.scale),(0,C.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",qH.offset),(0,C.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",qH.rotation);const DH=pH("clearCoat.textureRoughness");(0,C.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",DH.scale),(0,C.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",DH.offset),(0,C.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",DH.rotation),(0,C.i)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new mH(A.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",JH,(()=>1))]),(0,C.i)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new mH(A.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",JH,(()=>1))]),(0,C.i)("/materials/{}/extensions/KHR_materials_ior/ior",[new mH(A.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",JH,(()=>1))]),(0,C.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new mH(A.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",JH,(()=>1))]),(0,C.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new mH(A.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",JH,(()=>1))]),(0,C.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new mH(A.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",JH,(()=>1))]),(0,C.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new mH(A.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",JH,(()=>1))]);const TH=pH("iridescence.texture");(0,C.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",TH.scale),(0,C.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",TH.offset),(0,C.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",TH.rotation);const aH=pH("iridescence.thicknessTexture");(0,C.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",aH.scale),(0,C.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",aH.offset),(0,C.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",aH.rotation),(0,C.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new mH(A.b.ANIMATIONTYPE_COLOR3,"sheen.color",VH,(()=>3))]),(0,C.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new mH(A.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",JH,(()=>1))]);const FH=pH("sheen.texture");(0,C.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",FH.scale),(0,C.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",FH.offset),(0,C.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",FH.rotation);const CH=pH("sheen.textureRoughness");(0,C.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",CH.scale),(0,C.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",CH.offset),(0,C.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",CH.rotation),(0,C.i)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new mH(A.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",JH,(()=>1))]),(0,C.i)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new mH(A.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",VH,(()=>3))]);const tH=pH("metallicReflectanceTexture");(0,C.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",tH.scale),(0,C.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",tH.offset),(0,C.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",tH.rotation);const XH=pH("reflectanceTexture");(0,C.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",XH.scale),(0,C.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",XH.offset),(0,C.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",XH.rotation),(0,C.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new mH(A.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",JH,(()=>1))]);const sH=pH("subSurface.refractionIntensityTexture");(0,C.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",sH.scale),(0,C.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",sH.offset),(0,C.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",sH.rotation),(0,C.i)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new mH(A.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",VH,(()=>3))]),(0,C.i)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new mH(A.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",JH,(()=>1))]),(0,C.i)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new mH(A.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",JH,(()=>1))]);const UH=pH("subSurface.thicknessTexture");(0,C.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",UH.scale),(0,C.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",UH.offset),(0,C.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",UH.rotation),(0,C.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new mH(A.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",JH,(()=>1))]);const IH=pH("subSurface.translucencyIntensityTexture");(0,C.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",IH.scale),(0,C.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",IH.offset),(0,C.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",IH.rotation),(0,C.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new mH(A.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",VH,(()=>3))]);const vH=pH("subSurface.translucencyColorTexture");(0,C.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",vH.scale),(0,C.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",vH.offset),(0,C.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",vH.rotation),(0,C.i)("/extensions/KHR_lights_punctual/lights/{}/color",[new PH(A.b.ANIMATIONTYPE_COLOR3,"diffuse",VH,(()=>3))]),(0,C.i)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new PH(A.b.ANIMATIONTYPE_FLOAT,"intensity",JH,(()=>1))]),(0,C.i)("/extensions/KHR_lights_punctual/lights/{}/range",[new PH(A.b.ANIMATIONTYPE_FLOAT,"range",JH,(()=>1))]),(0,C.i)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new PH(A.b.ANIMATIONTYPE_FLOAT,"innerAngle",QH,(()=>1))]),(0,C.i)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new PH(A.b.ANIMATIONTYPE_FLOAT,"angle",QH,(()=>1))]),(0,C.i)("/nodes/{}/extensions/EXT_lights_ies/color",[new PH(A.b.ANIMATIONTYPE_COLOR3,"diffuse",VH,(()=>3))]),(0,C.i)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new PH(A.b.ANIMATIONTYPE_FLOAT,"intensity",JH,(()=>1))]);const wH="KHR_animation_pointer";class rH{constructor(o){this.name=wH,this._loader=o,this._pathToObjectConverter=(0,C.f)(this._loader.Ag)}get enabled(){return this._loader.isExtensionUsed(wH)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(o,H,n,E,k){var g;const O=null===(g=E.target.extensions)||void 0===g?void 0:g.KHR_animation_pointer;if(!O||!this._pathToObjectConverter)return null;"pointer"!==E.target.path&&z.d.Warn(`${o}/target/path: Value (${E.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=E.target.node&&z.d.Warn(`${o}/target/node: Value (${E.target.node}) must not be present when using the ${this.name} extension`);const Y=`${o}/extensions/${this.name}`,y=O.pointer;if(!y)throw new Error(`${Y}: Pointer is missing`);try{const g=this._pathToObjectConverter.convert(y);if(!g.info.interpolation)throw new Error(`${Y}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(o,H,n,E,{object:g.object,info:g.info.interpolation},k)}catch(S){return z.d.Warn(`${Y}/pointer: Invalid pointer (${y}) skipped`),null}}}F(wH),a(wH,!0,(o=>new rH(o)));class uH{constructor(o,H,n){this.frame=o,this.action=H,this.onlyOnce=n,this.isDone=!1}_clone(){return new uH(this.frame,this.action,this.onlyOnce)}}var dH=n(11051),RH=n(11093),WH=n(11088);class iH{get loop(){return this._loop}set loop(o){o!==this._loop&&(this._loop=o,this.updateOptions({loop:o}))}get currentTime(){var o;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(o=RH.e.audioEngine)&&void 0!==o&&o.audioContext&&(this.isPlaying||this.isPaused)){const o=this.isPaused?0:RH.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+o}return 0}get spatialSound(){return this._spatialSound}set spatialSound(o){if(o==this._spatialSound)return;const H=this.isPlaying;this.pause(),o?(this._spatialSound=o,this._updateSpatialParameters()):this._disableSpatialSound(),H&&this.play()}constructor(o,H,n){var E;let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new G.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=k.xH.Zero(),this._localDirection=new k.xH(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=o,n=n||x.e.LastCreatedScene)if(this._scene=n,iH._SceneComponentInitialization(n),this._readyToPlayCallback=g,this._customAttenuationFunction=(o,H,n,E,k)=>H<n?o*(1-H/n):0,Y&&(this.autoplay=Y.autoplay||!1,this._loop=Y.loop||!1,void 0!==Y.volume&&(this._volume=Y.volume),this._spatialSound=Y.spatialSound??!1,this.maxDistance=Y.maxDistance??100,this.useCustomAttenuation=Y.useCustomAttenuation??!1,this.rolloffFactor=Y.rolloffFactor||1,this.refDistance=Y.refDistance||1,this.distanceModel=Y.distanceModel||"linear",this._playbackRate=Y.playbackRate||1,this._streaming=Y.streaming??!1,this._length=Y.length,this._offset=Y.offset),null!==(E=RH.e.audioEngine)&&void 0!==E&&E.canUseWebAudio&&RH.e.audioEngine.audioContext){this._soundGain=RH.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let o=!0;if(H)try{"string"===typeof H?(this._urlType="String",this._url=H):H instanceof ArrayBuffer?this._urlType="ArrayBuffer":H instanceof HTMLMediaElement?this._urlType="MediaElement":H instanceof MediaStream?this._urlType="MediaStream":H instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(H)&&(this._urlType="Array");let n=[],E=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=RH.e.audioEngine.audioContext.createMediaElementSource(H),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=RH.e.audioEngine.audioContext.createMediaStreamSource(H),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":H.byteLength>0&&(E=!0,this._soundLoaded(H));break;case"AudioBuffer":this._audioBufferLoaded(H);break;case"String":n.push(H);case"Array":0===n.length&&(n=H);for(let o=0;o<n.length;o++){const H=n[o];if(E=Y&&Y.skipCodecCheck||-1!==H.indexOf(".mp3",H.length-4)&&RH.e.audioEngine.isMP3supported||-1!==H.indexOf(".ogg",H.length-4)&&RH.e.audioEngine.isOGGsupported||-1!==H.indexOf(".wav",H.length-4)||-1!==H.indexOf(".m4a",H.length-4)||-1!==H.indexOf(".mp4",H.length-4)||-1!==H.indexOf("blob:"),E){this._streaming?(this._htmlAudioElement=new Audio(H),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,O.Tools.SetCorsBehavior(H,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(H,(o=>{this._soundLoaded(o)}),void 0,!0,!0,(o=>{o&&z.d.Error("XHR "+o.status+" error on: "+H+"."),z.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:o=!1}o?E||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):z.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(y){z.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),RH.e.audioEngine&&!RH.e.audioEngine.WarnedWebAudioUnsupported&&(z.d.Error("Web Audio is not supported by your browser."),RH.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var o;null!==(o=RH.e.audioEngine)&&void 0!==o&&o.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(o){var H;null!==(H=RH.e.audioEngine)&&void 0!==H&&H.audioContext&&(this._audioBuffer=o,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(o){var H;null!==(H=RH.e.audioEngine)&&void 0!==H&&H.audioContext&&RH.e.audioEngine.audioContext.decodeAudioData(o,(o=>{this._audioBufferLoaded(o)}),(o=>{z.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+o)}))}setAudioBuffer(o){var H;null!==(H=RH.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&(this._audioBuffer=o,this._isReadyToPlay=!0)}updateOptions(o){o&&(this.loop=o.loop??this.loop,this.maxDistance=o.maxDistance??this.maxDistance,this.useCustomAttenuation=o.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=o.rolloffFactor??this.rolloffFactor,this.refDistance=o.refDistance??this.refDistance,this.distanceModel=o.distanceModel??this.distanceModel,this._playbackRate=o.playbackRate??this._playbackRate,this._length=o.length??void 0,this.spatialSound=o.spatialSound??this._spatialSound,this._setOffset(o.offset??void 0),this.setVolume(o.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var o;null!==(o=RH.e.audioEngine)&&void 0!==o&&o.canUseWebAudio&&RH.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??RH.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var o;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(o=this._soundPanner)||void 0===o||o.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var o;null!==(o=RH.e.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(o){var H;null!==(H=RH.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(o),this._isOutputConnected=!0)}setDirectionalCone(o,H,n){H<o?z.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=o,this._coneOuterAngle=H,this._coneOuterGain=n,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(o){if(o!=this._coneInnerAngle){var H;if(this._coneOuterAngle<o)return void z.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=o,null!==(H=RH.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(o){if(o!=this._coneOuterAngle){var H;if(o<this._coneInnerAngle)return void z.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=o,null!==(H=RH.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(o){var H;o.equals(this._position)||(this._position.S(o),null!==(H=RH.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(o){var H;this._localDirection=o,null!==(H=RH.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const o=this._connectedTransformNode.getWorldMatrix(),H=k.xH.TransformNormal(this._localDirection,o);H.normalize(),this._soundPanner.orientationX.value=H.x,this._soundPanner.orientationY.value=H.y,this._soundPanner.orientationZ.value=H.z}updateDistanceFromListener(){var o;if(null!==(o=RH.e.audioEngine)&&void 0!==o&&o.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const o=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.zH(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,o,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(o){this._customAttenuationFunction=o}play(o,H,n){var E;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(E=RH.e.audioEngine)&&void 0!==E&&E.audioContext)try{var k,g;this._clearTimeoutsAndObservers();let E=o?(null===(k=RH.e.audioEngine)||void 0===k?void 0:k.audioContext.currentTime)+o:null===(g=RH.e.audioEngine)||void 0===g?void 0:g.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=RH.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const o=()=>{var n;if(null!==(n=RH.e.audioEngine)&&void 0!==n&&n.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=H??0;const n=this._htmlAudioElement.play();void 0!==n&&n.catch((()=>{var H,n;(null===(H=RH.e.audioEngine)||void 0===H||H.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(n=RH.e.audioEngine)||void 0===n?void 0:n.onAudioUnlockedObservable.addOnce((()=>{o()})))}))}else{var E;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(E=RH.e.audioEngine)||void 0===E?void 0:E.onAudioUnlockedObservable.addOnce((()=>{o()}))}};o()}}else{var O;const k=()=>{var k;if(null!==(k=RH.e.audioEngine)&&void 0!==k&&k.audioContext){var g;if(n=n||this._length,void 0!==H&&this._setOffset(H),this._soundSource){const o=this._soundSource;o.onended=()=>{o.disconnect()}}if(this._soundSource=null===(g=RH.e.audioEngine)||void 0===g?void 0:g.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var O;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==H&&(this._soundSource.loopStart=H),void 0!==n&&(this._soundSource.loopEnd=(0|H)+n),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},E=o?(null===(O=RH.e.audioEngine)||void 0===O?void 0:O.audioContext.currentTime)+o:RH.e.audioEngine.audioContext.currentTime;const k=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(E,k,this.loop?void 0:n)}}};"suspended"===(null===(O=RH.e.audioEngine)||void 0===O?void 0:O.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var o;"suspended"===(null===(o=RH.e.audioEngine)||void 0===o?void 0:o.audioContext.state)?(RH.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=RH.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{k()})))):k()}),500):k()}this._startTime=E,this.isPlaying=!0,this.isPaused=!1}catch(Y){z.d.Error("Error while trying to play audio: "+this.name+", "+Y.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(o){var H;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var n;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(n=this._streamingSource)||void 0===n||n.disconnect();this.isPlaying=!1}else if(null!==(H=RH.e.audioEngine)&&void 0!==H&&H.audioContext&&this._soundSource){const H=o?RH.e.audioEngine.audioContext.currentTime+o:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(H)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var o;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var H;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(H=this._streamingSource)||void 0===H||H.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(o=RH.e.audioEngine)&&void 0!==o&&o.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=RH.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(o,H){var n;null!==(n=RH.e.audioEngine)&&void 0!==n&&n.canUseWebAudio&&this._soundGain&&(H&&RH.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(RH.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,RH.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(o,RH.e.audioEngine.audioContext.currentTime+H)):this._soundGain.gain.value=o),this._volume=o}setPlaybackRate(o){this._playbackRate=o,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(o){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=o,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=o=>this._onRegisterAfterWorldMatrixUpdate(o),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(o){var H;if(o.getBoundingInfo){const H=o.getBoundingInfo();this.setPosition(H.boundingSphere.centerWorld)}else this.setPosition(o.absolutePosition);null!==(H=RH.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const o=()=>{(0,WH.d)((()=>this._isReadyToPlay),(()=>{n._audioBuffer=this.getAudioBuffer(),n._isReadyToPlay=!0,n.autoplay&&n.play(0,this._offset,this._length)}),void 0,300)},H={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},n=new iH(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,H);return this.useCustomAttenuation&&n.setAttenuationFunction(this._customAttenuationFunction),n.setPosition(this._position),n.setPlaybackRate(this._playbackRate),o(),n}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const o={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(o.connectedMeshId=this._connectedTransformNode.id),o.position=this._position.bg(),o.refDistance=this.refDistance,o.distanceModel=this.distanceModel,o.isDirectional=this._isDirectional,o.localDirectionToMesh=this._localDirection.bg(),o.coneInnerAngle=this._coneInnerAngle,o.coneOuterAngle=this._coneOuterAngle,o.coneOuterGain=this._coneOuterGain),o}static Parse(o,H,n,E){const g=o.name;let O;O=o.url?n+o.url:n+g;const Y={autoplay:o.autoplay,loop:o.loop,volume:o.volume,spatialSound:o.spatialSound,maxDistance:o.maxDistance,rolloffFactor:o.rolloffFactor,refDistance:o.refDistance,distanceModel:o.distanceModel,playbackRate:o.playbackRate};let y;if(E){const o=()=>{(0,WH.d)((()=>E._isReadyToPlay),(()=>{y._audioBuffer=E.getAudioBuffer(),y._isReadyToPlay=!0,y.autoplay&&y.play(0,y._offset,y._length)}),void 0,300)};y=new iH(g,new ArrayBuffer(0),H,null,Y),o()}else y=new iH(g,O,H,(()=>{H.removePendingData(y)}),Y),H.addPendingData(y);if(o.position){const H=k.xH.Mg(o.position);y.setPosition(H)}if(o.isDirectional&&(y.setDirectionalCone(o.coneInnerAngle||360,o.coneOuterAngle||360,o.coneOuterGain||0),o.localDirectionToMesh)){const H=k.xH.Mg(o.localDirectionToMesh);y.setLocalDirectionToMesh(H)}if(o.connectedMeshId){const n=H.getMeshById(o.connectedMeshId);n&&y.attachToMesh(n)}return o.metadata&&(y.metadata=o.metadata),y}_setOffset(o){this._offset!==o&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=o)}_clearTimeoutsAndObservers(){var o;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(o=RH.e.audioEngine)||void 0===o||o.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}iH._SceneComponentInitialization=o=>{throw(0,dH.c)("AudioSceneComponent")},(0,jo.e)("BABYLON.Sound",iH);class LH{constructor(o,H,n){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],H.length!==n.length)throw new Error("Sounds length does not equal weights length");this.loop=o,this._weights=n;let E=0;for(const g of n)E+=g;const k=E>0?1/E:0;for(let g=0;g<this._weights.length;g++)this._weights[g]*=k;this._sounds=H;for(const g of this._sounds)g.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(o){if(o!==this._coneInnerAngle){if(this._coneOuterAngle<o)return void z.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=o;for(const H of this._sounds)H.directionalConeInnerAngle=o}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(o){if(o!==this._coneOuterAngle){if(o<this._coneInnerAngle)return void z.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=o;for(const H of this._sounds)H.directionalConeOuterAngle=o}}get volume(){return this._volume}set volume(o){if(o!==this._volume)for(const H of this._sounds)H.setVolume(o)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(o){if(!this.isPaused){this.stop();const o=Math.random();let H=0;for(let n=0;n<this._weights.length;n++)if(H+=this._weights[n],o<=H){this._currentIndex=n;break}}const H=this._sounds[this._currentIndex??0];H.isReady()?H.play(0,this.isPaused?void 0:o):H.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class on{constructor(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(o=o||x.e.LastCreatedScene)&&(this._scene=o,this.soundCollection=[],this._options=H,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var o;null!==(o=RH.e.audioEngine)&&void 0!==o&&o.canUseWebAudio&&RH.e.audioEngine.audioContext&&(this._outputAudioNode=RH.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(RH.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(RH.e.audioEngine&&RH.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(o){var H;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(H=RH.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._outputAudioNode&&o.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==o.soundTrackId&&(-1===o.soundTrackId?this._scene.mainSoundTrack.removeSound(o):this._scene.soundTracks&&this._scene.soundTracks[o.soundTrackId].removeSound(o)),this.soundCollection.push(o),o.soundTrackId=this.id}removeSound(o){const H=this.soundCollection.indexOf(o);-1!==H&&this.soundCollection.splice(H,1)}setVolume(o){var H;null!==(H=RH.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=o)}switchPanningModelToHRTF(){var o;if(null!==(o=RH.e.audioEngine)&&void 0!==o&&o.canUseWebAudio)for(let H=0;H<this.soundCollection.length;H++)this.soundCollection[H].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var o;if(null!==(o=RH.e.audioEngine)&&void 0!==o&&o.canUseWebAudio)for(let H=0;H<this.soundCollection.length;H++)this.soundCollection[H].switchPanningModelToEqualPower()}connectToAnalyser(o){var H;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=o,null!==(H=RH.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,RH.e.audioEngine.masterGain))}}var Hn=n(11475),nn=n(11435),En=n(11035);RH.e.AudioEngineFactory=(o,H,n)=>new kn(o,H,n);class kn{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new G.d,this.onAudioLockedObservable=new G.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,En.f)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const E=document.createElement("audio");this._hostElement=o,this._audioContext=H,this._audioDestination=n;try{E&&E.canPlayType&&(E.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||E.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(k){}try{E&&E.canPlayType&&E.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(k){}}lock(){this._triggerSuspendedState()}unlock(){var o,H;if("running"===(null===(o=this._audioContext)||void 0===o?void 0:o.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(H=this._audioContext)||void 0===H||H.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{z.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var o;null===(o=this._audioContext)||void 0===o||o.addEventListener("statechange",(()=>{var o;this.unlocked&&"running"!==(null===(o=this._audioContext)||void 0===o?void 0:o.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var o;return null!==(o=this._audioContext)&&void 0!==o&&o.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(o){this.canUseWebAudio=!1,z.d.Error("Web Audio: "+o.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(o){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const o=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",H=document.createElement("style");H.appendChild(document.createTextNode(o)),document.getElementsByTagName("head")[0].appendChild(H),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var o;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(o=this._audioContext)||void 0===o||o.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(o){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=o)}connectToAnalyser(o){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=o,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var gn=n(11042);(0,n(12600).i)(Hn.d.NAME_AUDIO,((o,H,n,E)=>{let k,g=[];if(n.El=n.El||[],void 0!==o.El&&null!==o.El)for(let Y=0,y=o.El.length;Y<y;Y++){var O;const y=o.El[Y];null!==(O=RH.e.audioEngine)&&void 0!==O&&O.canUseWebAudio?(y.url||(y.url=y.name),g[y.url]?n.El.push(iH.Parse(y,H,E,g[y.url])):(k=iH.Parse(y,H,E),g[y.url]=k,n.El.push(k))):n.El.push(new iH(y.name,null,H))}g=[]})),Object.defineProperty(nn.c.prototype,"mainSoundTrack",{get:function(){let o=this._getComponent(Hn.d.NAME_AUDIO);return o||(o=new On(this),this.o(o)),this._mainSoundTrack||(this._mainSoundTrack=new on(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),nn.c.prototype.getSoundByName=function(o){let H;for(H=0;H<this.mainSoundTrack.soundCollection.length;H++)if(this.mainSoundTrack.soundCollection[H].name===o)return this.mainSoundTrack.soundCollection[H];if(this.soundTracks)for(let n=0;n<this.soundTracks.length;n++)for(H=0;H<this.soundTracks[n].soundCollection.length;H++)if(this.soundTracks[n].soundCollection[H].name===o)return this.soundTracks[n].soundCollection[H];return null},Object.defineProperty(nn.c.prototype,"audioEnabled",{get:function(){let o=this._getComponent(Hn.d.NAME_AUDIO);return o||(o=new On(this),this.o(o)),o.audioEnabled},set:function(o){let H=this._getComponent(Hn.d.NAME_AUDIO);H||(H=new On(this),this.o(H)),o?H.enableAudio():H.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(nn.c.prototype,"headphone",{get:function(){let o=this._getComponent(Hn.d.NAME_AUDIO);return o||(o=new On(this),this.o(o)),o.headphone},set:function(o){let H=this._getComponent(Hn.d.NAME_AUDIO);H||(H=new On(this),this.o(H)),o?H.switchAudioModeForHeadphones():H.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(nn.c.prototype,"audioListenerPositionProvider",{get:function(){let o=this._getComponent(Hn.d.NAME_AUDIO);return o||(o=new On(this),this.o(o)),o.audioListenerPositionProvider},set:function(o){let H=this._getComponent(Hn.d.NAME_AUDIO);if(H||(H=new On(this),this.o(H)),o&&"function"!==typeof o)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");H.audioListenerPositionProvider=o},enumerable:!0,configurable:!0}),Object.defineProperty(nn.c.prototype,"audioListenerRotationProvider",{get:function(){let o=this._getComponent(Hn.d.NAME_AUDIO);return o||(o=new On(this),this.o(o)),o.audioListenerRotationProvider},set:function(o){let H=this._getComponent(Hn.d.NAME_AUDIO);if(H||(H=new On(this),this.o(H)),o&&"function"!==typeof o)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");H.audioListenerRotationProvider=o},enumerable:!0,configurable:!0}),Object.defineProperty(nn.c.prototype,"audioPositioningRefreshRate",{get:function(){let o=this._getComponent(Hn.d.NAME_AUDIO);return o||(o=new On(this),this.o(o)),o.audioPositioningRefreshRate},set:function(o){let H=this._getComponent(Hn.d.NAME_AUDIO);H||(H=new On(this),this.o(H)),H.audioPositioningRefreshRate=o},enumerable:!0,configurable:!0});class On{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(o){this.name=Hn.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new k.xH,this._cachedCameraPosition=new k.xH,this._lastCheck=0,this._invertMatrixTemp=new k.Matrix,this._cameraDirectionTemp=new k.xH,(o=o||x.e.LastCreatedScene)&&(this.VH=o,o.soundTracks=[],o.El=[])}register(){this.VH._afterRenderStage.registerStep(Hn.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(o){if(o.El=[],this.VH.soundTracks)for(let H=0;H<this.VH.soundTracks.length;H++){const n=this.VH.soundTracks[H];for(let H=0;H<n.soundCollection.length;H++)o.El.push(n.soundCollection[H].serialize())}}addFromContainer(o){if(o.El)for(const H of o.El)H.play(),H.autoplay=!0,this.VH.mainSoundTrack.addSound(H)}removeFromContainer(o){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(o.El)for(const n of o.El)n.stop(),n.autoplay=!1,this.VH.mainSoundTrack.removeSound(n),H&&n.dispose()}dispose(){const o=this.VH;if(o._mainSoundTrack&&o.mainSoundTrack.dispose(),o.soundTracks)for(let H=0;H<o.soundTracks.length;H++)o.soundTracks[H].dispose()}disableAudio(){const o=this.VH;let H;for(this._audioEnabled=!1,RH.e.audioEngine&&RH.e.audioEngine.audioContext&&RH.e.audioEngine.audioContext.suspend(),H=0;H<o.mainSoundTrack.soundCollection.length;H++)o.mainSoundTrack.soundCollection[H].pause();if(o.soundTracks)for(H=0;H<o.soundTracks.length;H++)for(let n=0;n<o.soundTracks[H].soundCollection.length;n++)o.soundTracks[H].soundCollection[n].pause()}enableAudio(){const o=this.VH;let H;for(this._audioEnabled=!0,RH.e.audioEngine&&RH.e.audioEngine.audioContext&&RH.e.audioEngine.audioContext.resume(),H=0;H<o.mainSoundTrack.soundCollection.length;H++)o.mainSoundTrack.soundCollection[H].isPaused&&o.mainSoundTrack.soundCollection[H].play();if(o.soundTracks)for(H=0;H<o.soundTracks.length;H++)for(let n=0;n<o.soundTracks[H].soundCollection.length;n++)o.soundTracks[H].soundCollection[n].isPaused&&o.soundTracks[H].soundCollection[n].play()}switchAudioModeForHeadphones(){const o=this.VH;if(this._headphone=!0,o.mainSoundTrack.switchPanningModelToHRTF(),o.soundTracks)for(let H=0;H<o.soundTracks.length;H++)o.soundTracks[H].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const o=this.VH;if(this._headphone=!1,o.mainSoundTrack.switchPanningModelToEqualPower(),o.soundTracks)for(let H=0;H<o.soundTracks.length;H++)o.soundTracks[H].switchPanningModelToEqualPower()}_afterRender(){const o=gn.b.Now;if(this._lastCheck&&o-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=o;const H=this.VH;if(!this._audioEnabled||!H._mainSoundTrack||!H.soundTracks||0===H._mainSoundTrack.soundCollection.length&&1===H.soundTracks.length)return;const n=RH.e.audioEngine;if(n&&n.audioContext){let o,E=H.activeCamera;if(H.activeCameras&&H.activeCameras.length>0&&(E=H.activeCameras[0]),this.audioListenerPositionProvider){const o=this.audioListenerPositionProvider();n.audioContext.listener.setPosition(o.x||0,o.y||0,o.z||0)}else E?this._cachedCameraPosition.equals(E.globalPosition)||(this._cachedCameraPosition.S(E.globalPosition),n.audioContext.listener.setPosition(E.globalPosition.x,E.globalPosition.y,E.globalPosition.z)):n.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const o=this.audioListenerRotationProvider();n.audioContext.listener.setOrientation(o.x||0,o.y||0,o.z||0,0,1,0)}else E?(E.rigCameras&&E.rigCameras.length>0&&(E=E.rigCameras[0]),E.getViewMatrix().invertToRef(this._invertMatrixTemp),k.xH.TransformNormalToRef(On._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.S(this._cameraDirectionTemp),n.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):n.audioContext.listener.setOrientation(0,0,0,0,1,0);for(o=0;o<H.mainSoundTrack.soundCollection.length;o++){const n=H.mainSoundTrack.soundCollection[o];n.useCustomAttenuation&&n.updateDistanceFromListener()}if(H.soundTracks)for(o=0;o<H.soundTracks.length;o++)for(let n=0;n<H.soundTracks[o].soundCollection.length;n++){const E=H.soundTracks[o].soundCollection[n];E.useCustomAttenuation&&E.updateDistanceFromListener()}}}}On._CameraDirection=new k.xH(0,0,-1),iH._SceneComponentInitialization=o=>{let H=o._getComponent(Hn.d.NAME_AUDIO);H||(H=new On(o),o.o(H))};const Yn="MSFT_audio_emitter";class yn{constructor(o){this.name=Yn,this._loader=o,this.enabled=this._loader.isExtensionUsed(Yn)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const o=this._loader.Ag.extensions;if(o&&o[this.name]){const H=o[this.name];this._clips=H.clips,this._emitters=H.emitters,s.Assign(this._clips),s.Assign(this._emitters)}}loadSceneAsync(o,H){return I.LoadExtensionAsync(o,H,this.name,(async(n,E)=>{const k=new Array;k.push(this._loader.loadSceneAsync(o,H));for(const o of E.emitters){const H=s.Get(`${n}/emitters`,this._emitters,o);if(void 0!=H.refDistance||void 0!=H.maxDistance||void 0!=H.rolloffFactor||void 0!=H.distanceModel||void 0!=H.innerAngle||void 0!=H.outerAngle)throw new Error(`${n}: Direction or Distance properties are not allowed on emitters attached to a scene`);k.push(this._loadEmitterAsync(`${n}/emitters/${H.index}`,H))}await Promise.all(k)}))}loadNodeAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(o,E)=>{const g=new Array,Y=await this._loader.loadNodeAsync(o,H,(H=>{for(const n of E.emitters){const E=s.Get(`${o}/emitters`,this._emitters,n);g.push(this._loadEmitterAsync(`${o}/emitters/${E.index}`,E).then((()=>{for(const o of E._babylonSounds)o.attachToMesh(H),void 0==E.innerAngle&&void 0==E.outerAngle||(o.setLocalDirectionToMesh(k.xH.Forward()),o.setDirectionalCone(2*O.Tools.ToDegrees(void 0==E.innerAngle?Math.PI:E.innerAngle),2*O.Tools.ToDegrees(void 0==E.outerAngle?Math.PI:E.outerAngle),0))})))}n(H)}));return await Promise.all(g),Y}))}loadAnimationAsync(o,H){return I.LoadExtensionAsync(o,H,this.name,(async(n,E)=>{const k=await this._loader.loadAnimationAsync(o,H),g=new Array;s.Assign(E.events);for(const O of E.events)g.push(this._loadAnimationEventAsync(`${n}/events/${O.index}`,o,H,O,k));return await Promise.all(g),k}))}_loadClipAsync(o,H){if(H._objectURL)return H._objectURL;let n;if(H.uri)n=this._loader.loadUriAsync(o,H,H.uri);else{const E=s.Get(`${o}/bufferView`,this._loader.Ag.bufferViews,H.bufferView);n=this._loader.loadBufferViewAsync(`/bufferViews/${E.index}`,E)}return H._objectURL=n.then((o=>URL.createObjectURL(new Blob([o],{type:H.mimeType})))),H._objectURL}_loadEmitterAsync(o,H){if(H._babylonSounds=H._babylonSounds||[],!H._babylonData){const o=new Array,n=H.name||`emitter${H.index}`,E={loop:!1,autoplay:!1,volume:void 0==H.volume?1:H.volume};for(let g=0;g<H.clips.length;g++){const k=`/extensions/${this.name}/clips`,O=s.Get(k,this._clips,H.clips[g].clip);o.push(this._loadClipAsync(`${k}/${H.clips[g].clip}`,O).then((o=>{const k=H._babylonSounds[g]=new iH(n,o,this._loader.babylonScene,null,E);k.refDistance=H.refDistance||1,k.maxDistance=H.maxDistance||256,k.rolloffFactor=H.rolloffFactor||1,k.distanceModel=H.distanceModel||"exponential"})))}const k=Promise.all(o).then((()=>{const o=H.clips.map((o=>o.weight||1)),n=new LH(H.loop||!1,H._babylonSounds,o);H.innerAngle&&(n.directionalConeInnerAngle=2*O.Tools.ToDegrees(H.innerAngle)),H.outerAngle&&(n.directionalConeOuterAngle=2*O.Tools.ToDegrees(H.outerAngle)),H.volume&&(n.volume=H.volume),H._babylonData.sound=n}));H._babylonData={loaded:k}}return H._babylonData.loaded}_getEventAction(o,H,n,E,k){switch(n){case"play":return o=>{const n=(k||0)+(o-E);H.play(n)};case"stop":return()=>{H.stop()};case"pause":return()=>{H.pause()};default:throw new Error(`${o}: Unsupported action ${n}`)}}_loadAnimationEventAsync(o,H,n,E,k){if(0==k.targetedAnimations.length)return Promise.resolve();const g=k.targetedAnimations[0],O=E.i,Y=s.Get(`/extensions/${this.name}/emitters`,this._emitters,O);return this._loadEmitterAsync(o,Y).then((()=>{const H=Y._babylonData.sound;if(H){const n=new uH(E.time,this._getEventAction(o,H,E.action,E.time,E.startOffset));g.animation.addEvent(n),k.onAnimationGroupEndObservable.add((()=>{H.stop()})),k.onAnimationGroupPauseObservable.add((()=>{H.pause()}))}}))}}F(Yn),a(Yn,!0,(o=>new yn(o)));const Sn="MSFT_lod";class Gn{constructor(o){var H;this.name=Sn,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new G.d,this.onMaterialLODsLoadedObservable=new G.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=o,this.maxLODsToLoad=(null===(H=this._loader.parent.extensionOptions[Sn])||void 0===H?void 0:H.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Sn)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let o=0;o<this._nodePromiseLODs.length;o++){const H=Promise.all(this._nodePromiseLODs[o]).then((()=>{0!==o&&(this._loader.endPerformanceCounter(`Node LOD ${o}`),this._loader.log(`Loaded node LOD ${o}`)),this.onNodeLODsLoadedObservable.notifyObservers(o),o!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${o+1}`),this._loadBufferLOD(this._nodeBufferLODs,o+1),this._nodeSignalLODs[o]&&this._nodeSignalLODs[o].resolve())}));this._loader._completePromises.push(H)}for(let o=0;o<this._materialPromiseLODs.length;o++){const H=Promise.all(this._materialPromiseLODs[o]).then((()=>{0!==o&&(this._loader.endPerformanceCounter(`Material LOD ${o}`),this._loader.log(`Loaded material LOD ${o}`)),this.onMaterialLODsLoadedObservable.notifyObservers(o),o!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${o+1}`),this._loadBufferLOD(this._materialBufferLODs,o+1),this._materialSignalLODs[o]&&this._materialSignalLODs[o].resolve())}));this._loader._completePromises.push(H)}}loadSceneAsync(o,H){const n=this._loader.loadSceneAsync(o,H);return this._loadBufferLOD(this._bufferLODs,0),n}loadNodeAsync(o,H,n){return I.LoadExtensionAsync(o,H,this.name,(async(o,k)=>{let g;const O=this._getLODs(o,H,this._loader.Ag.nodes,k.ids);this._loader.logOpen(`${o}`);for(let H=0;H<O.length;H++){const o=O[H];0!==H&&(this._nodeIndexLOD=H,this._nodeSignalLODs[H]=this._nodeSignalLODs[H]||new E);const k=o=>{n(o),o.eY(!1)},Y=this._loader.loadNodeAsync(`/nodes/${o.index}`,o,k).then((o=>{if(0!==H){const o=O[H-1];o._babylonTransformNode&&(this._disposeTransformNode(o._babylonTransformNode),delete o._babylonTransformNode)}return o.eY(!0),o}));this._nodePromiseLODs[H]=this._nodePromiseLODs[H]||[],0===H?g=Y:(this._nodeIndexLOD=null,this._nodePromiseLODs[H].push(Y))}return this._loader.logClose(),await g}))}_loadMaterialAsync(o,H,n,E,k){return this._nodeIndexLOD?null:I.LoadExtensionAsync(o,H,this.name,(async(o,g)=>{let O;const Y=this._getLODs(o,H,this._loader.Ag.materials,g.ids);this._loader.logOpen(`${o}`);for(let H=0;H<Y.length;H++){const o=Y[H];0!==H&&(this._materialIndexLOD=H);const g=this._loader._loadMaterialAsync(`/materials/${o.index}`,o,n,E,(o=>{0===H&&k(o)})).then((o=>{if(0!==H){k(o);const n=Y[H-1]._data;n[E]&&(this._disposeMaterials([n[E].babylonMaterial]),delete n[E])}return o}));this._materialPromiseLODs[H]=this._materialPromiseLODs[H]||[],0===H?O=g:(this._materialIndexLOD=null,this._materialPromiseLODs[H].push(g))}return this._loader.logClose(),await O}))}_loadUriAsync(o,H,n){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const k=this._nodeIndexLOD-1;return this._nodeSignalLODs[k]=this._nodeSignalLODs[k]||new E,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(o,H,n)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const k=this._materialIndexLOD-1;return this._materialSignalLODs[k]=this._materialSignalLODs[k]||new E,this._materialSignalLODs[k].promise.then((async()=>await this._loader.loadUriAsync(o,H,n)))}return null}loadBufferAsync(o,H,n,k){if(this._loader.parent.useRangeRequests&&!H.uri){if(!this._loader.bin)throw new Error(`${o}: Uri is missing or the binary glTF is missing its binary chunk`);const H=async(o,H)=>{const g=n,O=g+k-1;let Y=o[H];return Y?(Y.start=Math.min(Y.start,g),Y.end=Math.max(Y.end,O)):(Y={start:g,end:O,loaded:new E},o[H]=Y),await Y.loaded.promise.then((o=>new Uint8Array(o.buffer,o.byteOffset+n-Y.start,k)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?H(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?H(this._materialBufferLODs,this._materialIndexLOD):H(this._bufferLODs,0)}return null}_loadBufferLOD(o,H){const n=o[H];n&&(this._loader.log(`Loading buffer range [${n.start}-${n.end}]`),this._loader.bin.readAsync(n.start,n.end-n.start+1).then((o=>{n.loaded.resolve(o)}),(o=>{n.loaded.reject(o)})))}_getLODs(o,H,n,E){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const k=[];for(let g=E.length-1;g>=0;g--)if(k.push(s.Get(`${o}/ids/${E[g]}`,n,E[g])),k.length===this.maxLODsToLoad)return k;return k.push(H),k}_disposeTransformNode(o){const H=[],n=o.material;n&&H.push(n);for(const k of o.getChildMeshes())k.material&&H.push(k.material);o.dispose();const E=H.filter((o=>this._loader.babylonScene.meshes.every((H=>H.material!=o))));this._disposeMaterials(E)}_disposeMaterials(o){const H={};for(const n of o){for(const o of n.getActiveTextures())H[o.uniqueId]=o;n.dispose()}for(const n in H)for(const o of this._loader.babylonScene.materials)o.hasTexture(H[n])&&delete H[n];for(const n in H)H[n].dispose()}}F(Sn),a(Sn,!0,(o=>new Gn(o)));const cn="MSFT_minecraftMesh";class An{constructor(o){this.name=cn,this._loader=o,this.enabled=this._loader.isExtensionUsed(cn)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,H,n){return I.LoadExtraAsync(o,H,this.name,(async(E,k)=>{if(k){if(!(n instanceof h.c))throw new Error(`${E}: Material type not supported`);const k=this._loader.loadMaterialPropertiesAsync(o,H,n);return n.needAlphaBlending()&&(n.forceDepthWrite=!0,n.separateCullingPass=!0),n.Rg=n.forceDepthWrite,n.twoSidedLighting=!0,await k}}))}}F(cn),a(cn,!0,(o=>new An(o)));const ln="MSFT_sRGBFactors";class xn{constructor(o){this.name=ln,this._loader=o,this.enabled=this._loader.isExtensionUsed(ln)}dispose(){this._loader=null}loadMaterialPropertiesAsync(o,H,n){return I.LoadExtraAsync(o,H,this.name,(async(E,k)=>{if(k){if(!(n instanceof h.c))throw new Error(`${E}: Material type not supported`);const k=this._loader.loadMaterialPropertiesAsync(o,H,n),g=n.bo().getEngine().useExactSrgbConversions;return n.albedoTexture||n.albedoColor.toLinearSpaceToRef(n.albedoColor,g),n.reflectivityTexture||n.reflectivityColor.toLinearSpaceToRef(n.reflectivityColor,g),await k}}))}}F(ln),a(ln,!0,(o=>new xn(o)));var zn=n(12921);const Vn={};var Jn=n(12972),Nn=n(12951),hn=n(12926),Qn=n(12933);function pn(o,H){for(const n of o)for(const o of n.dataOutputs)if(o.uniqueId===H)return o;throw new Error("Could not find data out connection with unique id "+H)}function jn(o,H){for(const n of o)if(n instanceof Nn.b)for(const o of n.signalInputs)if(o.uniqueId===H)return o;throw new Error("Could not find signal in connection with unique id "+H)}async function mn(o,H){const E=await Promise.all(o.allBlocks.map((async o=>{const H=function(o){switch(o){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([n.e(78),n.e(79)]).then(n.bind(n,14414))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await n.e(80).then(n.bind(n,14416))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await n.e(81).then(n.bind(n,14422))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await n.e(82).then(n.bind(n,14427))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await n.e(83).then(n.bind(n,14430))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await n.e(84).then(n.bind(n,14439))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await n.e(85).then(n.bind(n,14443))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await n.e(86).then(n.bind(n,14445))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await n.e(87).then(n.bind(n,14447))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await n.e(89).then(n.bind(n,14473))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await n.e(89).then(n.bind(n,14473))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await n.e(89).then(n.bind(n,14473))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await n.e(89).then(n.bind(n,14473))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await n.e(89).then(n.bind(n,14473))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await n.e(89).then(n.bind(n,14473))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await n.e(90).then(n.bind(n,14479))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await n.e(90).then(n.bind(n,14479))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await n.e(90).then(n.bind(n,14479))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await n.e(90).then(n.bind(n,14479))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await n.e(95).then(n.bind(n,14483))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await n.e(96).then(n.bind(n,14492))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await n.e(97).then(n.bind(n,14501))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await n.e(98).then(n.bind(n,14510))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await n.e(99).then(n.bind(n,14514))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await n.e(100).then(n.bind(n,14521))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await n.e(101).then(n.bind(n,14529))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await n.e(102).then(n.bind(n,14532))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await n.e(103).then(n.bind(n,14536))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await n.e(104).then(n.bind(n,14540))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await n.e(105).then(n.bind(n,14544))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await n.e(106).then(n.bind(n,14551))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await n.e(107).then(n.bind(n,14554))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await n.e(108).then(n.bind(n,14563))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await n.e(109).then(n.bind(n,14568))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await n.e(110).then(n.bind(n,14577))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await n.e(111).then(n.bind(n,14580))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await n.e(112).then(n.bind(n,14584))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await n.e(113).then(n.bind(n,14586))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await n.e(92).then(n.bind(n,14592))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await n.e(114).then(n.bind(n,14596))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await n.e(115).then(n.bind(n,14602))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await n.e(116).then(n.bind(n,14606))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await n.e(93).then(n.bind(n,14609))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await n.e(88).then(n.bind(n,14449))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await n.e(94).then(n.bind(n,14616))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await n.e(94).then(n.bind(n,14616))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await n.e(94).then(n.bind(n,14616))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await n.e(94).then(n.bind(n,14616))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await n.e(94).then(n.bind(n,14616))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await n.e(94).then(n.bind(n,14616))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await n.e(94).then(n.bind(n,14616))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await n.e(94).then(n.bind(n,14616))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await n.e(89).then(n.bind(n,14473))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await n.e(89).then(n.bind(n,14473))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await n.e(89).then(n.bind(n,14473))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await n.e(89).then(n.bind(n,14473))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await n.e(89).then(n.bind(n,14473))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await n.e(89).then(n.bind(n,14473))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await n.e(89).then(n.bind(n,14473))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await n.e(90).then(n.bind(n,14479))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await n.e(90).then(n.bind(n,14479))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await n.e(91).then(n.bind(n,14618))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await n.e(91).then(n.bind(n,14618))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await n.e(91).then(n.bind(n,14618))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await n.e(91).then(n.bind(n,14618))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await n.e(91).then(n.bind(n,14618))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await n.e(91).then(n.bind(n,14618))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await n.e(117).then(n.bind(n,14621))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await n.e(118).then(n.bind(n,14627))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await n.e(119).then(n.bind(n,14633))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await n.e(120).then(n.bind(n,14637))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await n.e(121).then(n.bind(n,14644))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await n.e(122).then(n.bind(n,14647))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await n.e(123).then(n.bind(n,14649))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await n.e(124).then(n.bind(n,14654))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await n.e(125).then(n.bind(n,14663))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await n.e(126).then(n.bind(n,14668))).FlowGraphDataSwitchBlock;default:if(Vn[o])return Vn[o];throw new Error(`Unknown block name ${o}`)}}(o.className);return await H()})));return function(o,H,n){const E=H.coordinator.createGraph(),k=[],g=H.valueParseFunction??hn.d;for(let O=0;O<o.allBlocks.length;O++){const Y=bn(o.allBlocks[O],{VH:H.coordinator.config.VH,pathConverter:H.pathConverter,assetsContainer:H.coordinator.config.VH,valueParseFunction:g},n[O]);k.push(Y),Y instanceof Jn.d&&E.addEventBlock(Y)}for(const O of k){for(const o of O.dataInputs)for(const H of o.connectedPointIds){const n=pn(k,H);o.connectTo(n)}if(O instanceof Nn.b)for(const o of O.signalOutputs)for(const H of o.connectedPointIds){const n=jn(k,H);o.connectTo(n)}}for(const O of o.executionContexts)Pn(O,{graph:E,valueParseFunction:g},o.rightHanded);return E}(o,H,E)}function Pn(o,H,n){const E=H.graph.createContext();o.enableLogging&&(E.enableLogging=!0),E.treatDataAsRightHanded=n||!1;const k=H.valueParseFunction??hn.d;E.uniqueId=o.uniqueId;const g=E.bo();if(o._assetsContext){var O,Y,y,S,G,c,A,l,x,z;const H=o._assetsContext,n={meshes:null===(O=H.meshes)||void 0===O?void 0:O.map((o=>g.getMeshById(o))),lights:null===(Y=H.lights)||void 0===Y?void 0:Y.map((o=>g.getLightByName(o))),cameras:null===(y=H.cameras)||void 0===y?void 0:y.map((o=>g.getCameraByName(o))),materials:null===(S=H.materials)||void 0===S?void 0:S.map((o=>g.getMaterialById(o))),textures:null===(G=H.textures)||void 0===G?void 0:G.map((o=>g.getTextureByName(o))),animations:null===(c=H.animations)||void 0===c?void 0:c.map((o=>g.animations.find((H=>H.name===o)))),skeletons:null===(A=H.skeletons)||void 0===A?void 0:A.map((o=>g.getSkeletonByName(o))),jA:null===(l=H.jA)||void 0===l?void 0:l.map((o=>g.getParticleSystemById(o))),animationGroups:null===(x=H.animationGroups)||void 0===x?void 0:x.map((o=>g.getAnimationGroupByName(o))),transformNodes:null===(z=H.transformNodes)||void 0===z?void 0:z.map((o=>g.getTransformNodeById(o))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],El:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};E.assetsContext=n}for(const V in o._userVariables){const H=k(V,o._userVariables,E.assetsContext,g);E.userVariables[V]=H}for(const V in o._connectionValues){const H=k(V,o._connectionValues,E.assetsContext,g);E._setConnectionValueByKey(V,H)}return E}function bn(o,H,n){const E={},k=H.valueParseFunction??hn.d;if(o.config)for(const O in o.config)E[O]=k(O,o.config,H.assetsContainer||H.VH,H.VH);if((0,hn.j)(o.className)){if(!H.pathConverter)throw new Error("Path converter is required for this block");E.pathConverter=H.pathConverter}const g=new n(E);g.uniqueId=o.uniqueId;for(let O=0;O<o.dataInputs.length;O++){const H=g.getDataInput(o.dataInputs[O].name);if(!H)throw new Error("Could not find data input with name "+o.dataInputs[O].name+" in block "+o.className);H.deserialize(o.dataInputs[O])}for(let O=0;O<o.dataOutputs.length;O++){const H=g.getDataOutput(o.dataOutputs[O].name);if(!H)throw new Error("Could not find data output with name "+o.dataOutputs[O].name+" in block "+o.className);H.deserialize(o.dataOutputs[O])}return g.metadata=o.metadata,g.deserialize&&g.deserialize(o),g}function en(o){const[H,n]=o.split(":");return Zn({op:H,extension:n})}function Zn(o){var H;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const E=o.extension?null===(H=Kn[o.extension])||void 0===H?void 0:H[o.op]:fn[o.op];if(!E&&(z.d.Warn(`No mapping found for operation ${o.op} and extension ${o.extension||"KHR_interactivity"}`),n)){const H={},n={flows:{}};if(o.inputValueSockets){H.values={};for(const n in o.inputValueSockets)H.values[n]={name:n}}return o.outputValueSockets&&(n.values={},Object.keys(o.outputValueSockets).forEach((o=>{n.values[o]={name:o}}))),{nG:[],inputs:H,outputs:n}}return E}function Mn(o,H,n){Kn[H]||(Kn[H]={}),Kn[H][o]=n}const Kn={BABYLON:{"flow/log":{nG:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},fn={"event/onStart":{nG:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{nG:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{nG:["FlowGraphSendCustomEventBlock"],extraProcessor(o,H,n,E,k){if("event/send"!==H.op||!o.configuration||1!==Object.keys(o.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const g=o.configuration.event.value[0];if("number"!==typeof g)throw new Error("Event id should be a number");const O=E.arrays.events[g],Y=k[0];return Y.config||(Y.config={}),Y.config.eventId=O.eventId,Y.config.eventData=O.eventData,k}},"event/receive":{nG:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(o,H){var n;if(!o.configuration)return z.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const E=o.configuration.event;if(!E)return z.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const k=E.value[0];if("number"!==typeof k)return z.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(n=H.events)||void 0===n?void 0:n[k])?{valid:!0}:(z.d.Error(`Event with id ${k} not found`),{valid:!1,error:`Event with id ${k} not found`})},extraProcessor(o,H,n,E,k){if("event/receive"!==H.op||!o.configuration||1!==Object.keys(o.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const g=o.configuration.event.value[0];if("number"!==typeof g)throw new Error("Event id should be a number");const O=E.arrays.events[g],Y=k[0];return Y.config||(Y.config={}),Y.config.eventId=O.eventId,Y.config.eventData=O.eventData,k}},"math/e":Bn("FlowGraphEBlock"),"math/pi":Bn("FlowGraphPIBlock"),"math/inf":Bn("FlowGraphInfBlock"),"math/nan":Bn("FlowGraphNaNBlock"),"math/abs":Bn("FlowGraphAbsBlock"),"math/sign":Bn("FlowGraphSignBlock"),"math/trunc":Bn("FlowGraphTruncBlock"),"math/floor":Bn("FlowGraphFloorBlock"),"math/ceil":Bn("FlowGraphCeilBlock"),"math/round":{nG:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,H,n,E,k){var g;return(g=k[0]).config||(g.config={}),k[0].config.roundHalfAwayFromZero=!0,k}},"math/fract":Bn("FlowGraphFractBlock"),"math/neg":Bn("FlowGraphNegationBlock"),"math/add":Bn("FlowGraphAddBlock",["a","b"],!0),"math/sub":Bn("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{nG:["FlowGraphMultiplyBlock"],extraProcessor(o,H,n,E,k){var g;(g=k[0]).config||(g.config={}),k[0].config.useMatrixPerComponent=!0,k[0].config.preventIntegerFloatArithmetic=!0;let O=-1;return Object.keys(o.values||{}).find((H=>{var n;return void 0!==(null===(n=o.values)||void 0===n?void 0:n[H].type)&&(O=o.values[H].type,!0)})),-1!==O&&(k[0].config.type=E.arrays.types[O].flowGraphType),k},validation:o=>o.values?qn(o):{valid:!0}},"math/div":Bn("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Bn("FlowGraphModuloBlock",["a","b"]),"math/min":Bn("FlowGraphMinBlock",["a","b"]),"math/max":Bn("FlowGraphMaxBlock",["a","b"]),"math/clamp":Bn("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Bn("FlowGraphSaturateBlock"),"math/mix":Bn("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Bn("FlowGraphEqualityBlock",["a","b"]),"math/lt":Bn("FlowGraphLessThanBlock",["a","b"]),"math/le":Bn("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Bn("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Bn("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Bn("FlowGraphIsNaNBlock"),"math/isinf":Bn("FlowGraphIsInfBlock"),"math/select":{nG:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{nG:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Bn("FlowGraphSinBlock"),"math/cos":Bn("FlowGraphCosBlock"),"math/tan":Bn("FlowGraphTanBlock"),"math/asin":Bn("FlowGraphASinBlock"),"math/acos":Bn("FlowGraphACosBlock"),"math/atan":Bn("FlowGraphATanBlock"),"math/atan2":Bn("FlowGraphATan2Block",["a","b"]),"math/sinh":Bn("FlowGraphSinhBlock"),"math/cosh":Bn("FlowGraphCoshBlock"),"math/tanh":Bn("FlowGraphTanhBlock"),"math/asinh":Bn("FlowGraphASinhBlock"),"math/acosh":Bn("FlowGraphACoshBlock"),"math/atanh":Bn("FlowGraphATanhBlock"),"math/exp":Bn("FlowGraphExponentialBlock"),"math/log":Bn("FlowGraphLogBlock"),"math/log2":Bn("FlowGraphLog2Block"),"math/log10":Bn("FlowGraphLog10Block"),"math/sqrt":Bn("FlowGraphSquareRootBlock"),"math/cbrt":Bn("FlowGraphCubeRootBlock"),"math/pow":Bn("FlowGraphPowerBlock",["a","b"]),"math/length":Bn("FlowGraphLengthBlock"),"math/normalize":Bn("FlowGraphNormalizeBlock"),"math/dot":Bn("FlowGraphDotBlock",["a","b"]),"math/cross":Bn("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Bn("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Bn("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{nG:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{nG:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{nG:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{nG:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{nG:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{nG:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{nG:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Bn("FlowGraphTransposeBlock"),"math/determinant":Bn("FlowGraphDeterminantBlock"),"math/inverse":Bn("FlowGraphInvertMatrixBlock"),"math/matmul":Bn("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{nG:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"cY",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,H,n,E,k,g){const O=k[0].dataInputs.find((o=>"rotationQuaternion"===o.name));if(!O)throw new Error("Rotation quaternion input not found");return g._connectionValues[O.uniqueId]&&(g._connectionValues[O.uniqueId].type="Quaternion"),k}},"math/matDecompose":{nG:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"cY"}}}},"math/quatConjugate":Bn("FlowGraphConjugateBlock",["a"]),"math/quatMul":{nG:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,H,n,E,k){var g;return(g=k[0]).config||(g.config={}),k[0].config.type="Quaternion",k}},"math/quatAngleBetween":Bn("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{nG:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Bn("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Bn("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{nG:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,H,n,E,k){var g;return(g=k[0]).config||(g.config={}),k[0].config.inputIsColumnMajor=!0,k}},"math/extract2x2":{nG:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{nG:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,H,n,E,k){var g;return(g=k[0]).config||(g.config={}),k[0].config.inputIsColumnMajor=!0,k}},"math/extract3x3":{nG:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{nG:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,H,n,E,k){var g;return(g=k[0]).config||(g.config={}),k[0].config.inputIsColumnMajor=!0,k}},"math/extract4x4":{nG:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{nG:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,H,n,E,k,g){var O,Y;(Y=k[0]).config||(Y.config={});const y=k[0].dataInputs[0];return k[0].config.valueType=(null===(O=g._connectionValues[y.uniqueId])||void 0===O?void 0:O.type)??"FlowGraphInteger",k}},"math/and":{nG:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,H,n,E,k,g){var O,Y,y;(y=k[0]).config||(y.config={});const S=k[0].dataInputs[0],G=k[0].dataInputs[1];return k[0].config.valueType=(null===(O=g._connectionValues[S.uniqueId])||void 0===O?void 0:O.type)??(null===(Y=g._connectionValues[G.uniqueId])||void 0===Y?void 0:Y.type)??"FlowGraphInteger",k}},"math/or":{nG:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,H,n,E,k,g){var O,Y,y;(y=k[0]).config||(y.config={});const S=k[0].dataInputs[0],G=k[0].dataInputs[1];return k[0].config.valueType=(null===(O=g._connectionValues[S.uniqueId])||void 0===O?void 0:O.type)??(null===(Y=g._connectionValues[G.uniqueId])||void 0===Y?void 0:Y.type)??"FlowGraphInteger",k}},"math/xor":{nG:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(o,H,n,E,k,g){var O,Y,y;(y=k[0]).config||(y.config={});const S=k[0].dataInputs[0],G=k[0].dataInputs[1];return k[0].config.valueType=(null===(O=g._connectionValues[S.uniqueId])||void 0===O?void 0:O.type)??(null===(Y=g._connectionValues[G.uniqueId])||void 0===Y?void 0:Y.type)??"FlowGraphInteger",k}},"math/asr":Bn("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Bn("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Bn("FlowGraphLeadingZerosBlock"),"math/ctz":Bn("FlowGraphTrailingZerosBlock"),"math/popcnt":Bn("FlowGraphOneBitsCounterBlock"),"math/rad":Bn("FlowGraphDegToRadBlock"),"math/deg":Bn("FlowGraphRadToDegBlock"),"type/boolToInt":Bn("FlowGraphBooleanToInt"),"type/boolToFloat":Bn("FlowGraphBooleanToFloat"),"type/intToBool":Bn("FlowGraphIntToBoolean"),"type/intToFloat":Bn("FlowGraphIntToFloat"),"type/floatToInt":Bn("FlowGraphFloatToInt"),"type/floatToBool":Bn("FlowGraphFloatToBoolean"),"flow/sequence":{nG:["FlowGraphSequenceBlock"],extraProcessor(o,H,n,E,k){const g=k[0];return g.config||(g.config={}),g.config.outputSignalCount=Object.keys(o.flows||[]).length,g.signalOutputs.forEach(((o,H)=>{o.name="out_"+H})),k}},"flow/branch":{nG:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{nG:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(o){if(o.configuration&&o.configuration.cases){const H=o.configuration.cases.value;if(!H.every((o=>"number"===typeof o&&/^-?\d+$/.test(o.toString()))))return z.d.Warn("Switch cases should be integers. Using empty array instead."),o.configuration.cases.value=[],{valid:!0};const n=new Set(H);o.configuration.cases.value=Array.from(n)}return{valid:!0}},extraProcessor(o,H,n,E,k){if("flow/switch"!==H.op||!o.flows||0===Object.keys(o.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return k[0].signalOutputs.forEach((o=>{"default"!==o.name&&(o.name="out_"+o.name)})),k}},"flow/while":{nG:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{nG:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(o,H,n,E,k){const g=k[0];return g.config||(g.config={}),g.config.incrementIndexWhenLoopDone=!0,k}},"flow/doN":{nG:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{nG:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(o,H,n,E,k){if("flow/multiGate"!==H.op||!o.flows||0===Object.keys(o.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const g=k[0];return g.config||(g.config={}),g.config.outputSignalCount=Object.keys(o.flows).length,g.signalOutputs.forEach(((o,H)=>{o.name="out_"+H})),k}},"flow/waitAll":{nG:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(o){var H,n;return"number"!==typeof(null===(H=o.configuration)||void 0===H||null===(n=H.inputFlows)||void 0===n?void 0:n.value[0])&&(o.configuration=o.configuration||{inputFlows:{value:[0]}},o.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{nG:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{nG:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{nG:["FlowGraphCancelDelayBlock"]},"variable/get":{nG:["FlowGraphGetVariableBlock"],validation(o){var H,n;return null!==(H=o.configuration)&&void 0!==H&&null!==(n=H.variable)&&void 0!==n&&n.value?{valid:!0}:(z.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(o,H)=>[H.getVariableName(o[0])]}}},"variable/set":{nG:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(o,H)=>[H.getVariableName(o[0])]}}},"variable/setMultiple":{nG:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(o,H)=>[o[0].map((o=>H.getVariableName(o)))]}},extraProcessor:(o,H,n,E,k)=>(k[0].dataInputs.forEach((o=>{o.name=E.getVariableName(+o.name)})),k)},"variable/interpolate":{nG:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(o,H)=>[H.getVariableName(o[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:o=>!0===o[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",hn:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",hn:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",hn:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",hn:"FlowGraphPlayAnimationBlock"},out:{name:"out",hn:"FlowGraphPlayAnimationBlock"},done:{name:"done",hn:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(o,H,n,E,k){var g,O,Y;const y=k[0],S=null===(g=o.configuration)||void 0===g?void 0:g.variable.value[0];if("number"!==typeof S)throw z.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const G=E.arrays.staticVariables[S];"undefined"===typeof y.config.animationType.value&&(E.arrays.staticVariables,y.config.animationType.value=(0,Qn.F)(G.type));const c=k[4];return c.config||(c.config={}),(O=c.config).variable||(O.variable={}),c.config.variable.value=E.getVariableName(S),(Y=k[3]).config||(Y.config={}),k}},"pointer/get":{nG:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",hn:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",hn:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(o,H,n,E,k)=>(k.forEach((o=>{"FlowGraphJsonPointerParserBlock"===o.className&&(o.config||(o.config={}),o.config.outputValue=!0)})),k)},"pointer/set":{nG:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",hn:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",hn:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(o,H,n,E,k)=>(k.forEach((o=>{"FlowGraphJsonPointerParserBlock"===o.className&&(o.config||(o.config={}),o.config.outputValue=!0)})),k)},"pointer/interpolate":{nG:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",hn:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",hn:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",hn:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",hn:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",hn:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",hn:"FlowGraphPlayAnimationBlock"},out:{name:"out",hn:"FlowGraphPlayAnimationBlock"},done:{name:"done",hn:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(o,H,n,E,k)=>(k.forEach((H=>{"FlowGraphJsonPointerParserBlock"===H.className?(H.config||(H.config={}),H.config.outputValue=!0):"FlowGraphInterpolationBlock"===H.className&&(H.config||(H.config={}),Object.keys(o.values||[]).forEach((n=>{var k;const g=null===(k=o.values)||void 0===k?void 0:k[n];if("value"===n&&g){const o=g.type;void 0!==o&&(H.config.animationType=E.arrays.types[o].flowGraphType)}})))})),k)},"animation/start":{nG:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",hn:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(o,H)=>[o[0]*H._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(o,H)=>[o[0]*H._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(o,H,n,E,k,g,O){const Y=k[k.length-1];return Y.config||(Y.config={}),Y.config.glTF=O,k}},"animation/stop":{nG:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",hn:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(o,H,n,E,k,g,O){const Y=k[k.length-1];return Y.config||(Y.config={}),Y.config.glTF=O,k}},"animation/stopAt":{nG:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",hn:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(o,H)=>[o[0]*H._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(o,H,n,E,k,g,O){const Y=k[k.length-1];return Y.config||(Y.config={}),Y.config.glTF=O,k}},"math/switch":{nG:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(o){if(o.configuration&&o.configuration.cases){const H=o.configuration.cases.value;if(!H.every((o=>"number"===typeof o&&/^-?\d+$/.test(o.toString()))))return z.d.Warn("Switch cases should be integers. Using empty array instead."),o.configuration.cases.value=[],{valid:!0};const n=new Set(H);o.configuration.cases.value=Array.from(n)}return{valid:!0}},extraProcessor(o,H,n,E,k){const g=k[0];return g.dataInputs.forEach((o=>{"default"!==o.name&&"case"!==o.name&&(o.name="in_"+o.name)})),g.config||(g.config={}),g.config.treatCasesAsIntegers=!0,k}},"debug/log":{nG:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Bn(o){let H=arguments.length>2?arguments[2]:void 0;return{nG:[o],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((o,H)=>(o[H]={name:H},o)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(o,n,E,k,g){var O;if(H){(O=g[0]).config||(O.config={}),g[0].config.preventIntegerFloatArithmetic=!0;let H=-1;Object.keys(o.values||{}).find((n=>{var E;return void 0!==(null===(E=o.values)||void 0===E?void 0:E[n].type)&&(H=o.values[n].type,!0)})),-1!==H&&(g[0].config.type=k.arrays.types[H].flowGraphType)}return g},validation:o=>H?qn(o):{valid:!0}}}function qn(o){if(o.values){const H=Object.keys(o.values).map((H=>o.values[H].type)).filter((o=>void 0!==o));if(!H.every((o=>o===H[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}fn["math/compose"]=fn["math/matCompose"],fn["math/decompose"]=fn["math/matDecompose"];var Dn=n(11149);const Tn={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"xH",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class an{constructor(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=o,this._gltf=H,this._animationTargetFps=n,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const o of this._interactivityGraph.types)this._types.push(Tn[o.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const o of this._interactivityGraph.declarations){const H=Zn(o);if(!H)throw z.d.Error(["No mapping found for declaration",o]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:H,fullOperationName:o.extension?o.op+":"+o.extension:o.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const o of this._interactivityGraph.variables){const H=this._parseVariable(o);this._staticVariables.push(H)}}_parseVariable(o,H){const n=this._types[o.type];if(!n)throw z.d.Error(["No type found for variable",o]),new Error("Error parsing variables");if(o.value&&o.value.length!==n.length)throw z.d.Error(["Invalid value length for variable",o,n]),new Error("Error parsing variables");const E=o.value||[];if(!E.length)switch(n.flowGraphType){case"boolean":E.push(!1);break;case"FlowGraphInteger":E.push(0);break;case"number":E.push(NaN);break;case"Vector2":E.push(NaN,NaN);break;case"xH":E.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":E.fill(NaN,0,4);break;case"Matrix":E.fill(NaN,0,16);break;case"Matrix3D":E.fill(NaN,0,9)}return"number"===n.elementType&&"string"===typeof E[0]&&(E[0]=parseFloat(E[0])),{type:n.flowGraphType,value:H?H(E,this):E}}_parseEvents(){if(this._interactivityGraph.events)for(const o of this._interactivityGraph.events){const H={eventId:o.id||"internalEvent_"+this._internalEventsCounter++};o.values&&(H.eventData=Object.keys(o.values).map((H=>{var n;const E=null===(n=o.values)||void 0===n?void 0:n[H];if(!E)throw z.d.Error(["No value found for event key",H]),new Error("Error parsing events");const k=this._types[E.type];if(!k)throw z.d.Error(["No type found for event value",E]),new Error("Error parsing events");const g="undefined"!==typeof E.value?this._parseVariable(E):void 0;return{id:H,type:k.flowGraphType,eventData:!0,value:g}}))),this._events.push(H)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const H of this._interactivityGraph.nodes){if("number"!==typeof H.declaration)throw z.d.Error(["No declaration found for node",H]),new Error("Error parsing nodes");const n=this._mappings[H.declaration];if(!n)throw z.d.Error(["No mapping found for node",H]),new Error("Error parsing nodes");if(n.flowGraphMapping.validation){const E=n.flowGraphMapping.validation(H,this._interactivityGraph,this._gltf);var o;if(!E.valid)throw new Error(`Error validating interactivity node ${null===(o=this._interactivityGraph.declarations)||void 0===o?void 0:o[H.declaration].op} - ${E.error}`)}const E=[];for(const o of n.flowGraphMapping.nG){const k=this._getEmptyBlock(o,n.fullOperationName);this._parseNodeConfiguration(H,k,n.flowGraphMapping,o),E.push(k)}this._nodes.push({nG:E,fullOperationName:n.fullOperationName})}}_getEmptyBlock(o,H){return{uniqueId:(0,Dn.b)(),className:o,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:H,metadata:{}}}_parseNodeConfiguration(o,H,n,E){const k=H.config;if(o.configuration){const H=Object.keys(o.configuration);for(const Y of H){var g,O;const H=null===(g=o.configuration)||void 0===g?void 0:g[Y];if(!H)throw z.d.Error(["No value found for node configuration",Y]),new Error("Error parsing node configuration");const y=null===(O=n.configuration)||void 0===O?void 0:O[Y];if(y&&y.hn?y.hn===E:0===n.nG.indexOf(E)){const o=(null===y||void 0===y?void 0:y.name)||Y;H&&"undefined"!==typeof H.value||"undefined"===typeof(null===y||void 0===y?void 0:y.defaultValue)?H.value.length>=0?k[o]={value:1===H.value.length?H.value[0]:H.value}:z.d.Warn(["Invalid value for node configuration",H]):k[o]={value:y.defaultValue},y&&y.dataTransformer&&(k[o].value=y.dataTransformer([k[o].value],this)[0])}}}}_parseNodeConnections(o){for(let j=0;j<this._nodes.length;j++){var H;const m=null===(H=this._interactivityGraph.nodes)||void 0===H?void 0:H[j];if(!m)throw z.d.Error(["No node found for interactivity node",this._nodes[j]]),new Error("Error parsing node connections");const P=this._nodes[j],b=this._mappings[m.declaration];if(!b)throw z.d.Error(["No mapping found for node",m]),new Error("Error parsing node connections");const e=m.flows||{},Z=Object.keys(e).sort();for(const o of Z){var n,E,k,g;const H=e[o],S=null===(n=b.flowGraphMapping.outputs)||void 0===n||null===(E=n.flows)||void 0===E?void 0:E[o],G=(null===S||void 0===S?void 0:S.name)||o,c=this._createNewSocketConnection(G,!0);(S&&S.hn&&P.nG.find((o=>o.className===S.hn))||P.nG[0]).signalOutputs.push(c);const A=H.node,l=this._nodes[A];if(!l)throw z.d.Error(["No node found for input node id",A]),new Error("Error parsing node connections");const x=en(l.fullOperationName);if(!x)throw z.d.Error(["No mapping found for input node",l]),new Error("Error parsing node connections");let V=null===(k=x.inputs)||void 0===k||null===(g=k.flows)||void 0===g?void 0:g[H.socket||"in"],J=!1;if(!V)for(const o in null===(O=x.inputs)||void 0===O?void 0:O.flows){var O,Y,y;if(o.startsWith("[")&&o.endsWith("]"))J=!0,V=null===(Y=x.inputs)||void 0===Y||null===(y=Y.flows)||void 0===y?void 0:y[o]}const N=V?J?V.name.replace("$1",H.socket||""):V.name:H.socket||"in",h=V&&V.hn&&l.nG.find((o=>o.className===V.hn))||l.nG[0];let Q=h.signalInputs.find((o=>o.name===N));Q||(Q=this._createNewSocketConnection(N),h.signalInputs.push(Q)),Q.connectedPointIds.push(c.uniqueId),c.connectedPointIds.push(Q.uniqueId)}const M=m.values||{},K=Object.keys(M);for(const H of K){var S,G;const n=M[H];let E=null===(S=b.flowGraphMapping.inputs)||void 0===S||null===(G=S.values)||void 0===G?void 0:G[H],k=!1;if(!E)for(const o in null===(c=b.flowGraphMapping.inputs)||void 0===c?void 0:c.values){var c,A,l;if(o.startsWith("[")&&o.endsWith("]"))k=!0,E=null===(A=b.flowGraphMapping.inputs)||void 0===A||null===(l=A.values)||void 0===l?void 0:l[o]}const g=E?k?E.name.replace("$1",H):E.name:H,O=this._createNewSocketConnection(g);if((E&&E.hn&&P.nG.find((o=>o.className===E.hn))||P.nG[0]).dataInputs.push(O),void 0!==n.value){const H=this._parseVariable(n,E&&E.dataTransformer);o._connectionValues[O.uniqueId]=H}else{if("undefined"===typeof n.node)throw z.d.Error(["Invalid value for value connection",n]),new Error("Error parsing node connections");{var x,V,J;const o=n.node,H=n.socket||"value",E=this._nodes[o];if(!E)throw z.d.Error(["No node found for output socket reference",n]),new Error("Error parsing node connections");const k=en(E.fullOperationName);if(!k)throw z.d.Error(["No mapping found for output socket reference",n]),new Error("Error parsing node connections");let g=null===(x=k.outputs)||void 0===x||null===(V=x.values)||void 0===V?void 0:V[H],Y=!1;if(!g)for(const n in null===(N=k.outputs)||void 0===N?void 0:N.values){var N,h,Q;if(n.startsWith("[")&&n.endsWith("]"))Y=!0,g=null===(h=k.outputs)||void 0===h||null===(Q=h.values)||void 0===Q?void 0:Q[n]}const y=g?Y?g.name.replace("$1",H):null===(J=g)||void 0===J?void 0:J.name:H,S=g&&g.hn&&E.nG.find((o=>o.className===g.hn))||E.nG[0];let G=S.dataOutputs.find((o=>o.name===y));G||(G=this._createNewSocketConnection(y,!0),S.dataOutputs.push(G)),O.connectedPointIds.push(G.uniqueId),G.connectedPointIds.push(O.uniqueId)}}}if(b.flowGraphMapping.interBlockConnectors)for(const o of b.flowGraphMapping.interBlockConnectors){const H=o.input,n=o.output,E=o.isVariable;this._connectFlowGraphNodes(H,n,P.nG[o.inputBlockIndex],P.nG[o.outputBlockIndex],E)}if(b.flowGraphMapping.extraProcessor){var p;const H=null===(p=this._interactivityGraph.declarations)||void 0===p?void 0:p[m.declaration];if(!H)throw z.d.Error(["No declaration found for extra processor",m]),new Error("Error parsing node connections");P.nG=b.flowGraphMapping.extraProcessor(m,H,b.flowGraphMapping,this,P.nG,o,this._gltf)}}}_createNewSocketConnection(o,H){return{uniqueId:(0,Dn.b)(),name:o,_connectionType:H?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(o,H,n,E,k){const g=k?n.dataInputs:n.signalInputs,O=k?E.dataOutputs:E.signalOutputs,Y=g.find((H=>H.name===o))||this._createNewSocketConnection(o),y=O.find((o=>o.name===H))||this._createNewSocketConnection(H,!0);g.find((H=>H.name===o))||g.push(Y),O.find((o=>o.name===H))||O.push(y),Y.connectedPointIds.push(y.uniqueId),y.connectedPointIds.push(Y.uniqueId)}getVariableName(o){return"staticVariable_"+o}serializeToFlowGraph(){const o={uniqueId:(0,Dn.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(o);for(let H=0;H<this._staticVariables.length;H++){const n=this._staticVariables[H];o._userVariables[this.getVariableName(H)]=n}return{rightHanded:!0,allBlocks:this._nodes.reduce(((o,H)=>o.concat(H.nG)),[]),executionContexts:[o]}}}const Fn="KHR_interactivity";class Cn{constructor(o){this._loader=o,this.name=Fn,this.enabled=this._loader.isExtensionUsed(Fn),this._pathConverter=(0,C.f)(this._loader.Ag),o._skipStartAnimationStep=!0;const H=o.babylonScene;H&&function(o){(0,C.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!o.activeCamera)return new k.Quaternion(NaN,NaN,NaN,NaN);const H=k.Quaternion.FromRotationMatrix(o.activeCamera.getWorldMatrix()).normalize();return o.useRightHandedSystem||(H.w*=-1,H.x*=-1),H},type:"Quaternion",getTarget:()=>o.activeCamera}),(0,C.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!o.activeCamera)return new k.xH(NaN,NaN,NaN);const H=o.activeCamera.getWorldMatrix().getTranslation();return o.useRightHandedSystem||(H.x*=-1),H},type:"xH",getTarget:()=>o.activeCamera}),(0,C.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:o=>{var H;return(null===(H=o._babylonAnimationGroup)||void 0===H?void 0:H.isPlaying)??!1},type:"boolean",getTarget:o=>o._babylonAnimationGroup}),(0,C.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:o=>{var H;return((null===(H=o._babylonAnimationGroup)||void 0===H?void 0:H.from)??0)/60},type:"number",getTarget:o=>o._babylonAnimationGroup}),(0,C.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:o=>{var H;return((null===(H=o._babylonAnimationGroup)||void 0===H?void 0:H.to)??0)/60},type:"number",getTarget:o=>o._babylonAnimationGroup}),(0,C.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:o=>{var H;return((null===(H=o._babylonAnimationGroup)||void 0===H?void 0:H.getCurrentFrame())??0)/60},type:"number",getTarget:o=>o._babylonAnimationGroup}),(0,C.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:o=>{var H;return((null===(H=o._babylonAnimationGroup)||void 0===H?void 0:H.getCurrentFrame())??0)/60},type:"number",getTarget:o=>o._babylonAnimationGroup})}(H)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var o;if(!this._loader.babylonScene||!this._pathConverter)return;const H=this._loader.babylonScene,n=null===(o=this._loader.Ag.extensions)||void 0===o?void 0:o.KHR_interactivity;if(!n)return;const E=new zn.e({VH:H});E.dispatchEventsSynchronously=!1;const k=n.graphs.map((o=>new an(o,this._loader.Ag,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(k.map((async o=>await mn(o,{coordinator:E,pathConverter:this._pathConverter})))),E.start()}}var tn;tn=async()=>(await Promise.resolve().then(n.bind(n,12989))).FlowGraphGLTFDataProvider,Vn[`${Fn}/${"FlowGraphGLTFDataProvider"}`]=tn,F(Fn),a(Fn,!0,(o=>new Cn(o)));const Xn="KHR_node_visibility";(0,C.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:o=>{const H=o._babylonTransformNode;return!H||void 0===H.isVisible||H.isVisible},set:(o,H)=>{var n,E;null===(n=H._primitiveBabylonMeshes)||void 0===n||n.forEach((o=>{o.inheritVisibility=!0})),H._babylonTransformNode&&(H._babylonTransformNode.isVisible=o),null===(E=H._primitiveBabylonMeshes)||void 0===E||E.forEach((H=>{H.isVisible=o}))},getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class sn{constructor(o){this.name=Xn,this._loader=o,this.enabled=o.isExtensionUsed(Xn)}async onReady(){var o;null===(o=this._loader.Ag.nodes)||void 0===o||o.forEach((o=>{var H,n,E,k;(null===(H=o._primitiveBabylonMeshes)||void 0===H||H.forEach((o=>{o.inheritVisibility=!0})),null!==(n=o.extensions)&&void 0!==n&&n.KHR_node_visibility)&&(!1===(null===(E=o.extensions)||void 0===E?void 0:E.KHR_node_visibility.visible)&&(o._babylonTransformNode&&(o._babylonTransformNode.isVisible=!1),null===(k=o._primitiveBabylonMeshes)||void 0===k||k.forEach((o=>{o.isVisible=!1}))))}))}dispose(){this._loader=null}}F(Xn),a(Xn,!0,(o=>new sn(o)));const Un="KHR_node_selectability";Mn("event/onSelect",Un,{nG:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",hn:"FlowGraphGetVariableBlock",dataTransformer:o=>["pickedMesh_"+o[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",hn:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(o,H,n,E,k,g,O){var Y,y,S,G,c,A;const l=k[k.length-1];l.config=l.config||{},l.config.glTF=O;const x=null===(Y=o.configuration)||void 0===Y||null===(y=Y.nodeIndex)||void 0===y?void 0:y.value[0];if(void 0===x||"number"!==typeof x)throw new Error("nodeIndex not found in configuration");const z="pickedMesh_"+x;return k[1].config.variable=z,g._userVariables[z]={className:"Mesh",id:null===O||void 0===O||null===(S=O.nodes)||void 0===S||null===(G=S[x]._babylonTransformNode)||void 0===G?void 0:G.id,uniqueId:null===O||void 0===O||null===(c=O.nodes)||void 0===c||null===(A=c[x]._babylonTransformNode)||void 0===A?void 0:A.uniqueId},k}}),(0,C.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:o=>{const H=o._babylonTransformNode;return!H||void 0===H.ey||H.ey},set:(o,H)=>{var n;null===(n=H._primitiveBabylonMeshes)||void 0===n||n.forEach((H=>{H.ey=o}))},getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"ey"],type:"boolean"});class In{constructor(o){this.name=Un,this._loader=o,this.enabled=o.isExtensionUsed(Un)}async onReady(){var o;null===(o=this._loader.Ag.nodes)||void 0===o||o.forEach((o=>{var H,n,E;null!==(H=o.extensions)&&void 0!==H&&H.KHR_node_selectability&&!1===(null===(n=o.extensions)||void 0===n?void 0:n.KHR_node_selectability.selectable)&&(null===(E=o._babylonTransformNode)||void 0===E||E.getChildMeshes().forEach((o=>{o.ey=!1})))}))}dispose(){this._loader=null}}F(Un),a(Un,!0,(o=>new In(o)));const vn="KHR_node_hoverability",wn="targetMeshPointerOver_";Mn("event/onHoverIn",vn,{nG:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",hn:"FlowGraphGetVariableBlock",dataTransformer:o=>[wn+o[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",hn:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(o,H,n,E,k,g,O){var Y,y,S,G,c,A;const l=k[k.length-1];l.config=l.config||{},l.config.glTF=O;const x=null===(Y=o.configuration)||void 0===Y||null===(y=Y.nodeIndex)||void 0===y?void 0:y.value[0];if(void 0===x||"number"!==typeof x)throw new Error("nodeIndex not found in configuration");const z=wn+x;return k[1].config.variable=z,g._userVariables[z]={className:"Mesh",id:null===O||void 0===O||null===(S=O.nodes)||void 0===S||null===(G=S[x]._babylonTransformNode)||void 0===G?void 0:G.id,uniqueId:null===O||void 0===O||null===(c=O.nodes)||void 0===c||null===(A=c[x]._babylonTransformNode)||void 0===A?void 0:A.uniqueId},k}});const rn="targetMeshPointerOut_";Mn("event/onHoverOut",vn,{nG:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",hn:"FlowGraphGetVariableBlock",dataTransformer:o=>[rn+o[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",hn:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(o,H,n,E,k,g,O){var Y,y,S,G,c,A;const l=k[k.length-1];l.config=l.config||{},l.config.glTF=O;const x=null===(Y=o.configuration)||void 0===Y||null===(y=Y.nodeIndex)||void 0===y?void 0:y.value[0];if(void 0===x||"number"!==typeof x)throw new Error("nodeIndex not found in configuration");const z=rn+x;return k[1].config.variable=z,g._userVariables[z]={className:"Mesh",id:null===O||void 0===O||null===(S=O.nodes)||void 0===S||null===(G=S[x]._babylonTransformNode)||void 0===G?void 0:G.id,uniqueId:null===O||void 0===O||null===(c=O.nodes)||void 0===c||null===(A=c[x]._babylonTransformNode)||void 0===A?void 0:A.uniqueId},k}}),(0,C.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:o=>{const H=o._babylonTransformNode;return!H||void 0===H.pointerOverDisableMeshTesting||H.pointerOverDisableMeshTesting},set:(o,H)=>{var n;null===(n=H._primitiveBabylonMeshes)||void 0===n||n.forEach((H=>{H.pointerOverDisableMeshTesting=!o}))},getTarget:o=>o._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class un{constructor(o){this.name=vn,this._loader=o,this.enabled=o.isExtensionUsed(vn)}async onReady(){var o;null===(o=this._loader.Ag.nodes)||void 0===o||o.forEach((o=>{var H,n,E;null!==(H=o.extensions)&&void 0!==H&&H.KHR_node_hoverability&&!1===(null===(n=o.extensions)||void 0===n?void 0:n.KHR_node_hoverability.hoverable)&&(null===(E=o._babylonTransformNode)||void 0===E||E.getChildMeshes().forEach((o=>{o.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}F(vn),a(vn,!0,(o=>new un(o)));const dn="ExtrasAsMetadata";class Rn{_assignExtras(o,H){if(H.extras&&Object.keys(H.extras).length>0){const n=o.metadata=o.metadata||{};(n.Ag=n.Ag||{}).extras=H.extras}}constructor(o){this.name=dn,this.enabled=!0,this._loader=o}dispose(){this._loader=null}loadNodeAsync(o,H,n){return this._loader.loadNodeAsync(o,H,(o=>{this._assignExtras(o,H),n(o)}))}loadCameraAsync(o,H,n){return this._loader.loadCameraAsync(o,H,(o=>{this._assignExtras(o,H),n(o)}))}createMaterial(o,H,n){const E=this._loader.createMaterial(o,H,n);return this._assignExtras(E,H),E}}F(dn),a(dn,!1,(o=>new Rn(o)));n(12989)},12860:(o,H,n)=>{"use strict";n.d(H,{b:()=>B,d:()=>b,e:()=>P,f:()=>e});var E=n(11026),k=n(11024),g=n(12495),O=n(11652),Y=n(11620),y=n(11626),S=n(11038),G=n(11060),c=n(11647),A=n(11738),l=n(11659),x=n(11229);class z{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.jA=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.El=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(o){this._environmentTexture=o}getNodes(){let o=[];o=o.concat(this.meshes),o=o.concat(this.lights),o=o.concat(this.cameras),o=o.concat(this.transformNodes);for(const H of this.skeletons)o=o.concat(H.bones);return o}}class V extends z{}class J{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const o=this.rootNodes;for(const E of o)E.dispose();o.length=0;const H=this.skeletons;for(const E of H)E.dispose();H.length=0;const n=this.animationGroups;for(const E of n)E.dispose();n.length=0}}class N extends z{constructor(o){super(),this._wasAddedToScene=!1,(o=o||G.e.LastCreatedScene)&&(this.VH=o,this.proceduralTextures=[],o.yg.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=o.getEngine().onContextRestoredObservable.add((()=>{for(const o of this.geometries)o._rebuild();for(const o of this.meshes)o._rebuild();for(const o of this.jA)o.rebuild();for(const o of this.textures)o._rebuild()})))}_topologicalSort(o){const H=new Map;for(const O of o)H.set(O.uniqueId,O);const n={dependsOn:new Map,dependedBy:new Map};for(const O of o){const o=O.uniqueId;n.dependsOn.set(o,new Set),n.dependedBy.set(o,new Set)}for(const O of o){const o=O.uniqueId,E=n.dependsOn.get(o);if(O instanceof c.e){const k=O.sourceMesh;H.has(k.uniqueId)&&(E.add(k.uniqueId),n.dependedBy.get(k.uniqueId).add(o))}const k=n.dependedBy.get(o);for(const g of O.getDescendants()){const E=g.uniqueId;if(H.has(E)){k.add(E);n.dependsOn.get(E).add(o)}}}const E=[],k=[];for(const O of o){const o=O.uniqueId;0===n.dependsOn.get(o).size&&(k.push(O),H.delete(o))}const g=k;for(;g.length>0;){const o=g.shift();E.push(o);const k=n.dependedBy.get(o.uniqueId);for(const E of Array.from(k.values())){const k=n.dependsOn.get(E);k.delete(o.uniqueId),0===k.size&&H.get(E)&&(g.push(H.get(E)),H.delete(E))}}return H.size>0&&(S.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),H.forEach((o=>{S.d.Error(o.name)}))),E}_addNodeAndDescendantsToList(o,H,n,E){if(n&&(!E||E(n))&&!H.has(n.uniqueId)){o.push(n),H.add(n.uniqueId);for(const k of n.getDescendants(!0))this._addNodeAndDescendantsToList(o,H,k,E)}}_isNodeInContainer(o){return o instanceof y.e&&-1!==this.meshes.indexOf(o)||(o instanceof Y.b&&-1!==this.transformNodes.indexOf(o)||(o instanceof A.e&&-1!==this.lights.indexOf(o)||o instanceof l.b&&-1!==this.cameras.indexOf(o)))}_isValidHierarchy(){for(const o of this.meshes)if(o.parent&&!this._isNodeInContainer(o.parent))return S.d.Warn(`Node ${o.name} has a parent that is not in the container.`),!1;for(const o of this.transformNodes)if(o.parent&&!this._isNodeInContainer(o.parent))return S.d.Warn(`Node ${o.name} has a parent that is not in the container.`),!1;for(const o of this.lights)if(o.parent&&!this._isNodeInContainer(o.parent))return S.d.Warn(`Node ${o.name} has a parent that is not in the container.`),!1;for(const o of this.cameras)if(o.parent&&!this._isNodeInContainer(o.parent))return S.d.Warn(`Node ${o.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(o){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||k.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const E={},g={},Y=new J,y=[],S=[],G={doNotInstantiate:!0,...n},c=[],A=new Set;for(const k of this.transformNodes)null===k.parent&&this._addNodeAndDescendantsToList(c,A,k,G.predicate);for(const k of this.meshes)null===k.parent&&this._addNodeAndDescendantsToList(c,A,k,G.predicate);const l=this._topologicalSort(c),x=(n,k)=>{if(((H,n)=>{if(E[H.uniqueId]=n.uniqueId,g[n.uniqueId]=n,o&&(n.name=o(H.name)),n instanceof O.b){const o=n;if(o.morphTargetManager){const n=H.morphTargetManager;o.morphTargetManager=n.clone();for(let H=0;H<n.numTargets;H++){const k=n.getTarget(H),O=o.morphTargetManager.getTarget(H);E[k.uniqueId]=O.uniqueId,g[O.uniqueId]=O}}}})(n,k),n.parent){const o=E[n.parent.uniqueId],H=g[o];k.parent=H||n.parent}if(k.position&&n.position&&k.position.S(n.position),k.rotationQuaternion&&n.rotationQuaternion&&k.rotationQuaternion.S(n.rotationQuaternion),k.rotation&&n.rotation&&k.rotation.S(n.rotation),k.cY&&n.cY&&k.cY.S(n.cY),k.material){const O=k;if(O.material)if(H){const H=n.material;if(-1===S.indexOf(H)){let n=H.clone(o?o(H.name):"Clone of "+H.name);if(S.push(H),E[H.uniqueId]=n.uniqueId,g[n.uniqueId]=n,"MultiMaterial"===H.getClassName()){const k=H;for(const H of k.lY)H&&(n=H.clone(o?o(H.name):"Clone of "+H.name),S.push(H),E[H.uniqueId]=n.uniqueId,g[n.uniqueId]=n);k.lY=k.lY.map((o=>o&&g[E[o.uniqueId]]))}}"InstancedMesh"!==O.getClassName()&&(O.material=g[E[H.uniqueId]])}else"MultiMaterial"===O.material.getClassName()?-1===this.VH.multiMaterials.indexOf(O.material)&&this.VH.addMultiMaterial(O.material):-1===this.VH.materials.indexOf(O.material)&&this.VH.addMaterial(O.material)}null===k.parent&&Y.rootNodes.push(k)};for(const k of l)if("InstancedMesh"===k.getClassName()){const o=k,H=o.sourceMesh,n=E[H.uniqueId];x(o,("number"===typeof n?g[n]:H).createInstance(o.name))}else{let o=!0;"oc"===k.getClassName()||"Node"===k.getClassName()||k.skeleton||!k.getTotalVertices||0===k.getTotalVertices()?o=!1:G.doNotInstantiate&&(o="function"===typeof G.doNotInstantiate?!G.doNotInstantiate(k):!G.doNotInstantiate);const H=o?k.createInstance(`instance of ${k.name}`):k.clone(`Clone of ${k.name}`,null,!0);if(!H)throw new Error(`Could not clone or instantiate node on Asset Container ${k.name}`);x(k,H)}for(const k of this.skeletons){if(G.predicate&&!G.predicate(k))continue;const H=k.clone(o?o(k.name):"Clone of "+k.name);for(const o of this.meshes)if(o.skeleton===k&&!o.isAnInstance){const n=g[E[o.uniqueId]];if(!n||n.isAnInstance)continue;if(n.skeleton=H,-1!==y.indexOf(H))continue;y.push(H);for(const o of H.bones)o._linkedTransformNode&&(o._linkedTransformNode=g[E[o._linkedTransformNode.uniqueId]])}Y.skeletons.push(H)}for(const k of this.animationGroups){if(G.predicate&&!G.predicate(k))continue;const H=k.clone(o?o(k.name):"Clone of "+k.name,(o=>g[E[o.uniqueId]]||o));Y.animationGroups.push(H)}return Y}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||k.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.VH.environmentTexture=this.environmentTexture);for(const o of this.VH._serializableComponents)o.addFromContainer(this);this.VH.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const H=[];for(const n of this.cameras)o&&!o(n)||(this.VH.addCamera(n),H.push(n));for(const n of this.lights)o&&!o(n)||(this.VH.addLight(n),H.push(n));for(const n of this.meshes)o&&!o(n)||(this.VH.IS(n),H.push(n));for(const n of this.skeletons)o&&!o(n)||this.VH.addSkeleton(n);for(const n of this.animations)o&&!o(n)||this.VH.addAnimation(n);for(const n of this.animationGroups)o&&!o(n)||this.VH.addAnimationGroup(n);for(const n of this.multiMaterials)o&&!o(n)||this.VH.addMultiMaterial(n);for(const n of this.materials)o&&!o(n)||this.VH.addMaterial(n);for(const n of this.morphTargetManagers)o&&!o(n)||this.VH.addMorphTargetManager(n);for(const n of this.geometries)o&&!o(n)||this.VH.addGeometry(n);for(const n of this.transformNodes)o&&!o(n)||(this.VH.addTransformNode(n),H.push(n));for(const n of this.actionManagers)o&&!o(n)||this.VH.addActionManager(n);for(const n of this.textures)o&&!o(n)||this.VH.addTexture(n);for(const n of this.reflectionProbes)o&&!o(n)||this.VH.addReflectionProbe(n);for(const n of H)n.parent&&-1===this.VH.getNodes().indexOf(n.parent)&&(n.setParent?n.setParent(null):n.parent=null)}removeAllFromScene(){this._isValidHierarchy()||k.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.VH.environmentTexture&&(this.VH.environmentTexture=null);for(const o of this.VH._serializableComponents)o.removeFromContainer(this)}removeFromScene(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const H of this.cameras)o&&!o(H)||this.VH.removeCamera(H);for(const H of this.lights)o&&!o(H)||this.VH.removeLight(H);for(const H of this.meshes)o&&!o(H)||this.VH.US(H,!0);for(const H of this.skeletons)o&&!o(H)||this.VH.removeSkeleton(H);for(const H of this.animations)o&&!o(H)||this.VH.removeAnimation(H);for(const H of this.animationGroups)o&&!o(H)||this.VH.removeAnimationGroup(H);for(const H of this.multiMaterials)o&&!o(H)||this.VH.removeMultiMaterial(H);for(const H of this.materials)o&&!o(H)||this.VH.removeMaterial(H);for(const H of this.morphTargetManagers)o&&!o(H)||this.VH.removeMorphTargetManager(H);for(const H of this.geometries)o&&!o(H)||this.VH.removeGeometry(H);for(const H of this.transformNodes)o&&!o(H)||this.VH.removeTransformNode(H);for(const H of this.actionManagers)o&&!o(H)||this.VH.removeActionManager(H);for(const H of this.textures)o&&!o(H)||this.VH.removeTexture(H);for(const H of this.reflectionProbes)o&&!o(H)||this.VH.removeReflectionProbe(H)}dispose(){const o=this.cameras.slice(0);for(const l of o)l.dispose();this.cameras.length=0;const H=this.lights.slice(0);for(const l of H)l.dispose();this.lights.length=0;const n=this.meshes.slice(0);for(const l of n)l.dispose();this.meshes.length=0;const E=this.skeletons.slice(0);for(const l of E)l.dispose();this.skeletons.length=0;const k=this.animationGroups.slice(0);for(const l of k)l.dispose();this.animationGroups.length=0;const g=this.multiMaterials.slice(0);for(const l of g)l.dispose();this.multiMaterials.length=0;const O=this.materials.slice(0);for(const l of O)l.dispose();this.materials.length=0;const Y=this.geometries.slice(0);for(const l of Y)l.dispose();this.geometries.length=0;const y=this.transformNodes.slice(0);for(const l of y)l.dispose();this.transformNodes.length=0;const S=this.actionManagers.slice(0);for(const l of S)l.dispose();this.actionManagers.length=0;const G=this.textures.slice(0);for(const l of G)l.dispose();this.textures.length=0;const c=this.reflectionProbes.slice(0);for(const l of c)l.dispose();this.reflectionProbes.length=0;const A=this.morphTargetManagers.slice(0);for(const l of A)l.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const l of this.VH._serializableComponents)l.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.VH.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(o,H,n){if(o&&H)for(const E of o){let o=!0;if(n)for(const H of n)if(E===H){o=!1;break}o&&(H.push(E),E._parentContainer=this)}}moveAllFromScene(o){this._wasAddedToScene=!1,void 0===o&&(o=new V);for(const H in this)Object.prototype.hasOwnProperty.call(this,H)&&(this[H]=this[H]||("_environmentTexture"===H?null:[]),this._moveAssets(this.VH[H],this[H],o[H]));this.environmentTexture=this.VH.environmentTexture,this.removeAllFromScene()}createRootMesh(){const o=new O.b("assetContainerRootMesh",this.VH);for(const H of this.meshes)H.parent||o.addChild(H);return this.meshes.unshift(o),o}mergeAnimationsTo(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G.e.LastCreatedScene,H=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!o)return S.d.Error("No scene available to merge animations to"),[];const E=n||(H=>{let n=null;const E=H.animations.length?H.animations[0].targetProperty:"",k=H.name.split(".").join("").split("_primitive")[0];switch(E){case"position":case"rotationQuaternion":n=o.getTransformNodeByName(H.name)||o.getTransformNodeByName(k);break;case"influence":n=o.getMorphTargetByName(H.name)||o.getMorphTargetByName(k);break;default:n=o.getNodeByName(H.name)||o.getNodeByName(k)}return n}),k=this.getNodes();for(const Y of k){const o=E(Y);if(null!==o){for(const H of Y.animations){const n=o.animations.filter((o=>o.targetProperty===H.targetProperty));for(const H of n){const n=o.animations.indexOf(H,0);n>-1&&o.animations.splice(n,1)}}o.animations=o.animations.concat(Y.animations)}}const g=[],O=this.animationGroups.slice();for(const Y of O){g.push(Y.clone(Y.name,E));for(const o of Y.animatables)o.stop()}for(const Y of H){const H=E(Y.target);H&&(o.beginAnimation(H,Y.fromFrame,Y.toFrame,Y.loopAnimation,Y.speedRatio,Y.onAnimationEnd?Y.onAnimationEnd:void 0,void 0,!0,void 0,Y.onAnimationLoop?Y.onAnimationLoop:void 0),o.stopAnimation(Y.target))}return g}populateRootNodes(){this.rootNodes.length=0;for(const o of this.meshes)o.parent||-1!==this.rootNodes.indexOf(o)||this.rootNodes.push(o);for(const o of this.transformNodes)o.parent||-1!==this.rootNodes.indexOf(o)||this.rootNodes.push(o);for(const o of this.lights)o.parent||-1!==this.rootNodes.indexOf(o)||this.rootNodes.push(o);for(const o of this.cameras)o.parent||-1!==this.rootNodes.indexOf(o)||this.rootNodes.push(o)}addAllAssetsToContainer(o){if(!o)return;const H=[],n=new Set;for(H.push(o);H.length>0;){const o=H.pop();if(o instanceof O.b?(o.wg&&-1===this.geometries.indexOf(o.wg)&&this.geometries.push(o.wg),this.meshes.push(o)):o instanceof c.e?this.meshes.push(o):o instanceof Y.b?this.transformNodes.push(o):o instanceof A.e?this.lights.push(o):o instanceof l.b&&this.cameras.push(o),o instanceof y.e){if(o.material&&-1===this.materials.indexOf(o.material)){this.materials.push(o.material);for(const H of o.material.getActiveTextures())-1===this.textures.indexOf(H)&&this.textures.push(H)}o.skeleton&&-1===this.skeletons.indexOf(o.skeleton)&&this.skeletons.push(o.skeleton),o.morphTargetManager&&-1===this.morphTargetManagers.indexOf(o.morphTargetManager)&&this.morphTargetManagers.push(o.morphTargetManager)}for(const E of o.getChildren())n.has(E)||H.push(E);n.add(o)}this.populateRootNodes()}_getByTags(o,H,n){if(void 0===H)return o;const E=[];for(const k in o){const g=o[k];x.e&&x.e.MatchesQuery(g,H)&&(!n||n(g))&&E.push(g)}return E}getMeshesByTags(o,H){return this._getByTags(this.meshes,o,H)}getCamerasByTags(o,H){return this._getByTags(this.cameras,o,H)}getLightsByTags(o,H){return this._getByTags(this.lights,o,H)}getMaterialsByTags(o,H){return this._getByTags(this.materials,o,H).concat(this._getByTags(this.multiMaterials,o,H))}getTransformNodesByTags(o,H){return this._getByTags(this.transformNodes,o,H)}}var h=n(11072);class Q{constructor(o){this.byteOffset=0,this.buffer=o}async loadAsync(o){const H=await this.buffer.readAsync(this.byteOffset,o);this._dataView=new DataView(H.buffer,H.byteOffset,H.byteLength),this._dataByteOffset=0}readUint32(){const o=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,o}readUint8Array(o){const H=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,o);return this._dataByteOffset+=o,this.byteOffset+=o,H}readString(o){return(0,h.j)(this.readUint8Array(o))}skipBytes(o){this._dataByteOffset+=o,this.byteOffset+=o}}var p=n(12869);const j="Z2xURg",m={name:"Ag",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:o=>-1!==o.indexOf("asset")&&-1!==o.indexOf("version")||o.startsWith("data:base64,"+j)||o.startsWith("data:;base64,"+j)||o.startsWith("data:application/octet-stream;base64,"+j)||o.startsWith("data:model/gltf-binary;base64,"+j)};var P,b,e,Z=n(11066),M=n(11068);function K(o,H,n){try{return Promise.resolve(new Uint8Array(o,H,n))}catch(E){return Promise.reject(E)}}!function(o){o[o.AUTO=0]="AUTO",o[o.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(P||(P={})),function(o){o[o.NONE=0]="NONE",o[o.FIRST=1]="FIRST",o[o.ALL=2]="ALL"}(b||(b={})),function(o){o[o.LOADING=0]="LOADING",o[o.READY=1]="READY",o[o.COMPLETE=2]="COMPLETE"}(e||(e={}));class f{constructor(){this.coordinateSystemMode=P.AUTO,this.animationStartMode=b.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=o=>Promise.resolve(o),this.extensionOptions={}}S(o){o&&(this.onParsed=o.onParsed,this.coordinateSystemMode=o.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=o.animationStartMode??this.animationStartMode,this.loadNodeAnimations=o.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=o.loadSkins??this.loadSkins,this.loadMorphTargets=o.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=o.compileMaterials??this.compileMaterials,this.useClipPlane=o.useClipPlane??this.useClipPlane,this.compileShadowGenerators=o.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=o.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=o.useRangeRequests??this.useRangeRequests,this.createInstances=o.createInstances??this.createInstances,this.alwaysComputeBoundingBox=o.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=o.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=o.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=o.skipMaterials??this.skipMaterials,this.useSRGBBuffers=o.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=o.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=o.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=o.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=o.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=o.customRootNode,this.onMeshLoaded=o.onMeshLoaded,this.onSkinLoaded=o.onSkinLoaded,this.onTextureLoaded=o.onTextureLoaded,this.onMaterialLoaded=o.onMaterialLoaded,this.onCameraLoaded=o.onCameraLoaded,this.extensionOptions=o.extensionOptions??this.extensionOptions)}}class B extends f{constructor(o){super(),this.onParsedObservable=new E.d,this.onMeshLoadedObservable=new E.d,this.onSkinLoadedObservable=new E.d,this.onTextureLoadedObservable=new E.d,this.onMaterialLoadedObservable=new E.d,this.onCameraLoadedObservable=new E.d,this.onCompleteObservable=new E.d,this.onErrorObservable=new E.d,this.yg=new E.d,this.onExtensionLoadedObservable=new E.d,this.validate=!1,this.onValidatedObservable=new E.d,this._loader=null,this._state=null,this._requests=new Array,this.name=m.name,this.extensions=m.extensions,this.onLoaderStateChangedObservable=new E.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.S(o)}set onParsed(o){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),o&&(this._onParsedObserver=this.onParsedObservable.add(o))}set onMeshLoaded(o){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),o&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(o))}set onSkinLoaded(o){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),o&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((H=>o(H.node,H.skinnedNode))))}set onTextureLoaded(o){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),o&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(o))}set onMaterialLoaded(o){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),o&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(o))}set onCameraLoaded(o){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),o&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(o))}set onComplete(o){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(o)}set onError(o){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(o)}set onDispose(o){this._onDisposeObserver&&this.yg.remove(this._onDisposeObserver),this._onDisposeObserver=this.yg.add(o)}set onExtensionLoaded(o){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(o)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(o){this._loggingEnabled!==o&&(this._loggingEnabled=o,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(o){this._capturePerformanceCounters!==o&&(this._capturePerformanceCounters=o,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(o){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(o)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const o of this._requests)o.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=o=>Promise.resolve(o),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.yg.notifyObservers(void 0),this.yg.clear()}loadFile(o,H,n,g,O,Y,y,G){if(ArrayBuffer.isView(H))return this._loadBinary(o,H,n,g,y,G),null;this._progressCallback=O;const c=H.name||k.Tools.GetFilename(H);if(Y){if(this.useRangeRequests){this.validate&&S.d.Warn("glTF validation is not supported when range requests are enabled");const n={abort:()=>{},onCompleteObservable:new E.d},k={readAsync:(n,E)=>new Promise(((k,g)=>{this._loadFile(o,H,(o=>{k(new Uint8Array(o))}),!0,(o=>{g(o)}),(o=>{o.setRequestHeader("Range",`bytes=${n}-${n+E-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new Q(k)).then((o=>{n.onCompleteObservable.notifyObservers(n),g(o)}),y?o=>y(void 0,o):void 0),n}return this._loadFile(o,H,(H=>{this._validate(o,new Uint8Array(H,0,H.byteLength),n,c),this._unpackBinaryAsync(new Q({readAsync:(o,n)=>K(H,o,n),byteLength:H.byteLength})).then((o=>{g(o)}),y?o=>y(void 0,o):void 0)}),!0,y)}return this._loadFile(o,H,(H=>{try{this._validate(o,H,n,c),g({json:this._parseJson(H)})}catch{y&&y()}}),!1,y)}_loadBinary(o,H,n,E,k,g){this._validate(o,new Uint8Array(H.buffer,H.byteOffset,H.byteLength),n,g),this._unpackBinaryAsync(new Q({readAsync:(o,n)=>function(o,H,n){try{if(H<0||H>=o.byteLength)throw new RangeError("Offset is out of range.");if(H+n>o.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(o.buffer,o.byteOffset+H,n))}catch(E){return Promise.reject(E)}}(H,o,n),byteLength:H.byteLength})).then((o=>{E(o)}),k?o=>k(void 0,o):void 0)}importMeshAsync(o,H,n,E,k,g){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(n),this.onParsedObservable.clear(),this._log(`Loading ${g||""}`),this._loader=this._getLoader(n),this._loader.importMeshAsync(o,H,null,n,E,k,g))))}loadAsync(o,H,n,E,k){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(H),this.onParsedObservable.clear(),this._log(`Loading ${k||""}`),this._loader=this._getLoader(H),this._loader.loadAsync(o,H,n,E,k))))}loadAssetContainerAsync(o,H,n,E,k){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(H),this.onParsedObservable.clear(),this._log(`Loading ${k||""}`),this._loader=this._getLoader(H);const g=new N(o),O=[];this.onMaterialLoadedObservable.add((o=>{O.push(o)}));const Y=[];this.onTextureLoadedObservable.add((o=>{Y.push(o)}));const y=[];this.onCameraLoadedObservable.add((o=>{y.push(o)}));const S=[];return this.onMeshLoadedObservable.add((o=>{o.morphTargetManager&&S.push(o.morphTargetManager)})),this._loader.importMeshAsync(null,o,g,H,n,E,k).then((o=>(Array.prototype.push.apply(g.geometries,o.geometries),Array.prototype.push.apply(g.meshes,o.meshes),Array.prototype.push.apply(g.jA,o.jA),Array.prototype.push.apply(g.skeletons,o.skeletons),Array.prototype.push.apply(g.animationGroups,o.animationGroups),Array.prototype.push.apply(g.materials,O),Array.prototype.push.apply(g.textures,Y),Array.prototype.push.apply(g.lights,o.lights),Array.prototype.push.apply(g.transformNodes,o.transformNodes),Array.prototype.push.apply(g.cameras,y),Array.prototype.push.apply(g.morphTargetManagers,S),g)))}))}canDirectLoad(o){return m.canDirectLoad(o)}directLoad(o,H){if(H.startsWith("base64,"+j)||H.startsWith(";base64,"+j)||H.startsWith("application/octet-stream;base64,"+j)||H.startsWith("model/gltf-binary;base64,"+j)){const n=(0,Z.c)(H);return this._validate(o,new Uint8Array(n,0,n.byteLength)),this._unpackBinaryAsync(new Q({readAsync:(o,H)=>K(n,o,H),byteLength:n.byteLength}))}return this._validate(o,H),Promise.resolve({json:this._parseJson(H)})}createPlugin(o){return new B(o[m.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((o,H)=>{this.onCompleteObservable.addOnce((()=>{o()})),this.onErrorObservable.addOnce((o=>{H(o)}))}))}_setState(o){this._state!==o&&(this._state=o,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(e[this._state]))}_loadFile(o,H,n,E,k,g){const O=o._loadFile(H,n,(o=>{this._onProgress(o,O)}),!0,E,k,g);return O.onCompleteObservable.add((()=>{O._lengthComputable=!0,O._total=O._loaded})),this._requests.push(O),O}_onProgress(o,H){if(!this._progressCallback)return;H._lengthComputable=o.lengthComputable,H._loaded=o.loaded,H._total=o.total;let n=!0,E=0,k=0;for(const g of this._requests){if(void 0===g._lengthComputable||void 0===g._loaded||void 0===g._total)return;n=n&&g._lengthComputable,E+=g._loaded,k+=g._total}this._progressCallback({lengthComputable:n,loaded:E,total:n?k:0})}_validate(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),p.d.ValidateAsync(H,n,E,(H=>this.preprocessUrlAsync(n+H).then((H=>o._loadFileAsync(H,void 0,!0,!0).then((o=>new Uint8Array(o,0,o.byteLength))))))).then((o=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(o),this.onValidatedObservable.clear()}),(o=>{this._endPerformanceCounter("Validate JSON"),k.Tools.Warn(`Failed to validate: ${o.message}`),this.onValidatedObservable.clear()})))}_getLoader(o){const H=o.json.asset||{};this._log(`Asset version: ${H.version}`),H.minVersion&&this._log(`Asset minimum version: ${H.minVersion}`),H.generator&&this._log(`Asset generator: ${H.generator}`);const n=B._parseVersion(H.version);if(!n)throw new Error("Invalid version: "+H.version);if(void 0!==H.minVersion){const o=B._parseVersion(H.minVersion);if(!o)throw new Error("Invalid minimum version: "+H.minVersion);if(B._compareVersion(o,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+H.minVersion)}const E={1:B._CreateGLTF1Loader,2:B._CreateGLTF2Loader}[n.major];if(!E)throw new Error("Unsupported version: "+H.version);return E(this)}_parseJson(o){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${o.length}`);const H=JSON.parse(o);return this._endPerformanceCounter("Parse JSON"),H}_unpackBinaryAsync(o){return this._startPerformanceCounter("Unpack Binary"),o.loadAsync(20).then((()=>{const H=o.readUint32();if(1179937895!==H)throw new M.l("Unexpected magic: "+H,M.i.GLTFLoaderUnexpectedMagicError);const n=o.readUint32();this.loggingEnabled&&this._log(`Binary version: ${n}`);const E=o.readUint32();let k;switch(this.useRangeRequests||E===o.buffer.byteLength||S.d.Warn(`Length in header does not match actual data length: ${E} != ${o.buffer.byteLength}`),n){case 1:k=this._unpackBinaryV1Async(o,E);break;case 2:k=this._unpackBinaryV2Async(o,E);break;default:throw new Error("Unsupported version: "+n)}return this._endPerformanceCounter("Unpack Binary"),k}))}_unpackBinaryV1Async(o,H){const n=o.readUint32(),E=o.readUint32();if(0!==E)throw new Error(`Unexpected content format: ${E}`);const k=H-o.byteOffset,g={json:this._parseJson(o.readString(n)),bin:null};if(0!==k){const H=o.byteOffset;g.bin={readAsync:(n,E)=>o.buffer.readAsync(H+n,E),byteLength:k}}return Promise.resolve(g)}_unpackBinaryV2Async(o,H){const n=1313821514,E=5130562,k=o.readUint32();if(o.readUint32()!==n)throw new Error("First chunk format is not JSON");return o.byteOffset+k===H?o.loadAsync(k).then((()=>({json:this._parseJson(o.readString(k)),bin:null}))):o.loadAsync(k+8).then((()=>{const g={json:this._parseJson(o.readString(k)),bin:null},O=()=>{const k=o.readUint32();switch(o.readUint32()){case n:throw new Error("Unexpected JSON chunk");case E:{const H=o.byteOffset;g.bin={readAsync:(n,E)=>o.buffer.readAsync(H+n,E),byteLength:k},o.skipBytes(k);break}default:o.skipBytes(k)}return o.byteOffset!==H?o.loadAsync(8).then(O):Promise.resolve(g)};return O()}))}static _parseVersion(o){if("1.0"===o||"1.0.1"===o)return{major:1,minor:0};const H=(o+"").match(/^(\d+)\.(\d+)/);return H?{major:parseInt(H[1]),minor:parseInt(H[2])}:null}static _compareVersion(o,H){return o.major>H.major?1:o.major<H.major?-1:o.minor>H.minor?1:o.minor<H.minor?-1:0}_logOpen(o){this._log(o),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(o){const H=B._logSpaces.substring(0,2*this._logIndentLevel);S.d.Log(`${H}${o}`)}_logDisabled(o){}_startPerformanceCounterEnabled(o){k.Tools.StartPerformanceCounter(o)}_startPerformanceCounterDisabled(o){}_endPerformanceCounterEnabled(o){k.Tools.EndPerformanceCounter(o)}_endPerformanceCounterDisabled(o){}}B.IncrementalLoading=!0,B.HomogeneousCoordinates=!1,B._logSpaces="                                ",(0,g.b)(new B)},12869:(o,H,n)=>{"use strict";n.d(H,{d:()=>O});var E=n(11024);function k(o,H,n,E){const k={externalResourceFunction:E};return n&&(k.uri="file:"===H?n:H+n),ArrayBuffer.isView(o)?GLTFValidator.validateBytes(o,k):GLTFValidator.validateString(o,k)}function g(){const o=[];onmessage=H=>{const n=H.data;switch(n.id){case"init":importScripts(n.url);break;case"validate":k(n.data,n.rootUrl,n.fileName,(H=>new Promise(((n,E)=>{const k=o.length;o.push({resolve:n,reject:E}),postMessage({id:"getExternalResource",index:k,uri:H})})))).then((o=>{postMessage({id:"validate.resolve",value:o})}),(o=>{postMessage({id:"validate.reject",reason:o})}));break;case"getExternalResource.resolve":o[n.index].resolve(n.value);break;case"getExternalResource.reject":o[n.index].reject(n.reason)}}}class O{static ValidateAsync(o,H,n,O){return"function"===typeof Worker?new Promise(((Y,y)=>{const S=`${k}(${g})()`,G=URL.createObjectURL(new Blob([S],{type:"application/javascript"})),c=new Worker(G),A=o=>{c.removeEventListener("error",A),c.removeEventListener("message",l),y(o)},l=o=>{const H=o.data;switch(H.id){case"getExternalResource":O(H.uri).then((o=>{c.postMessage({id:"getExternalResource.resolve",index:H.index,value:o},[o.buffer])}),(o=>{c.postMessage({id:"getExternalResource.reject",index:H.index,reason:o})}));break;case"validate.resolve":c.removeEventListener("error",A),c.removeEventListener("message",l),Y(H.value),c.terminate();break;case"validate.reject":c.removeEventListener("error",A),c.removeEventListener("message",l),y(H.reason),c.terminate()}};if(c.addEventListener("error",A),c.addEventListener("message",l),c.postMessage({id:"init",url:E.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(o)){const E=o.slice();c.postMessage({id:"validate",data:E,rootUrl:H,fileName:n},[E.buffer])}else c.postMessage({id:"validate",data:o,rootUrl:H,fileName:n})})):(this._LoadScriptPromise||(this._LoadScriptPromise=E.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>k(o,H,n,O))))}}O.Configuration={url:`${E.Tools._DefaultCdnUrl}/gltf_validator.js`}},13432:(o,H,n)=>{"use strict";n.d(H,{e:()=>m});var E=n(11170),k=n(11177),g=n(11224),O=n(11189),Y=n(11580),y=n(11525),S=n(11259),G=n(11435),c=n(11140),A=n(11101);n(12627),n(12541),n(12552),n(12545),n(12554),n(12559),n(12562);const l="imageProcessingCompatibility",x="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";A.d.IncludesShadersStore[l]||(A.d.IncludesShadersStore[l]=x);const z="skyPixelShader",V="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";A.d.ShadersStore[z]||(A.d.ShadersStore[z]=V);n(12640),n(12571),n(12577),n(12586),n(12583);const J="skyVertexShader",N="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";A.d.ShadersStore[J]||(A.d.ShadersStore[J]=N);var h=n(11520),Q=n(11565),p=n(11562);class j extends Y.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class m extends y.b{constructor(o,H){super(o,H),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new O.xH(0,100,0),this.useSunPosition=!1,this.cameraOffset=O.xH.Zero(),this.up=O.xH.Up(),this.dithering=!1,this._cameraPosition=O.xH.Zero(),this._skyOrientation=new O.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(o,H){const n=H._drawWrapper;if(this.isFrozen&&n.effect&&n._wasPreviouslyReady)return!0;H.materialDefines||(H.materialDefines=new j);const E=H.materialDefines,k=this.bo();if(this._isReadyForSubMesh(H))return!0;if((0,p.Y)(o,k,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,E),(0,p.Q)(o,E,!0,!1),E.IMAGEPROCESSINGPOSTPROCESS!==k.imageProcessingConfiguration.applyByPostProcess&&E.markAsMiscDirty(),E.DITHER!==this.dithering&&E.markAsMiscDirty(),E.isDirty){E.markAsProcessed(),k.resetCachedMaterial();const o=new h.d;E.FOG&&o.addFallback(1,"FOG"),E.IMAGEPROCESSINGPOSTPROCESS=k.imageProcessingConfiguration.applyByPostProcess,E.DITHER=this.dithering;const n=[S.d.PositionKind];E.VERTEXCOLOR&&n.push(S.d.ColorKind);const g="sky",O=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,Q.e)(O);const Y=E.toString();H.setEffect(k.getEngine().createEffect(g,n,O,[],Y,o,this.onCompiled,this.onError),E,this._materialContext)}return!(!H.effect||!H.effect.isReady())&&(E._renderId=k.getRenderId(),n._wasPreviouslyReady=!0,!0)}bindForSubMesh(o,H,n){const E=this.bo(),k=n.materialDefines;if(!k)return;const g=n.effect;if(!g)return;this._activeEffect=g,this.bindOnlyWorldMatrix(o),this._activeEffect.setMatrix("viewProjection",E.getTransformMatrix()),this._mustRebind(E,g,n)&&((0,Q.i)(g,this,E),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,p.l)(k,g,E)),E.fogEnabled&&H.applyFog&&E.fogMode!==G.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",E.getViewMatrix()),(0,p.f)(E,H,this._activeEffect);const Y=E.activeCamera;if(Y){const o=Y.getWorldMatrix();this._cameraPosition.x=o.m[12],this._cameraPosition.y=o.m[13],this._cameraPosition.z=o.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const o=Math.PI*(this.inclination-.5),H=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(H)*Math.cos(o),this.sunPosition.y=this.distance*Math.sin(-o),this.sunPosition.z=this.distance*Math.sin(H)*Math.cos(o),O.Quaternion.FromUnitVectorsToRef(O.xH.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(H,this._activeEffect,n)}getAnimatables(){return[]}dispose(o){super.dispose(o)}clone(o){return g.e.Clone((()=>new m(o,this.bo())),this)}serialize(){const o=super.serialize();return o.customType="BABYLON.SkyMaterial",o}getClassName(){return"SkyMaterial"}static Parse(o,H,n){return g.e.Parse((()=>new m(o.name,H)),o,H,n)}}(0,E.c)([(0,k.P)()],m.prototype,"luminance",void 0),(0,E.c)([(0,k.P)()],m.prototype,"turbidity",void 0),(0,E.c)([(0,k.P)()],m.prototype,"rayleigh",void 0),(0,E.c)([(0,k.P)()],m.prototype,"mieCoefficient",void 0),(0,E.c)([(0,k.P)()],m.prototype,"mieDirectionalG",void 0),(0,E.c)([(0,k.P)()],m.prototype,"distance",void 0),(0,E.c)([(0,k.P)()],m.prototype,"inclination",void 0),(0,E.c)([(0,k.P)()],m.prototype,"azimuth",void 0),(0,E.c)([(0,k.L)()],m.prototype,"sunPosition",void 0),(0,E.c)([(0,k.P)()],m.prototype,"useSunPosition",void 0),(0,E.c)([(0,k.L)()],m.prototype,"cameraOffset",void 0),(0,E.c)([(0,k.L)()],m.prototype,"up",void 0),(0,E.c)([(0,k.P)()],m.prototype,"dithering",void 0),(0,c.e)("BABYLON.SkyMaterial",m)},11827:(o,H,n)=>{"use strict";function E(o,H){H.headers=o.headers||{},H.statusMessage=o.statusText,H.statusCode=o.status,H.data=o.response}function k(o,H,n){return new Promise((function(k,g){n=n||{};var O,Y,y,S=new XMLHttpRequest,G=n.body,c=n.headers||{};for(O in n.timeout&&(S.timeout=n.timeout),S.ontimeout=S.onerror=function(o){o.timeout="timeout"==o.type,g(o)},S.open(o,H.href||H),S.onload=function(){for(y=S.getAllResponseHeaders().trim().split(/[\r\n]+/),E(S,S);Y=y.shift();)Y=Y.split(": "),S.headers[Y.shift().toLowerCase()]=Y.join(": ");if((Y=S.headers["content-type"])&&~Y.indexOf("application/json"))try{S.data=JSON.parse(S.data,n.reviver)}catch(o){return E(S,o),g(o)}(S.status>=400?g:k)(S)},typeof FormData<"u"&&G instanceof FormData||G&&"object"==typeof G&&(c["content-type"]="application/json",G=JSON.stringify(G)),S.withCredentials=!!n.withCredentials,c)S.setRequestHeader(O,c[O]);S.send(G)}))}n.r(H),n.d(H,{del:()=>y,get:()=>g,patch:()=>Y,post:()=>O,put:()=>S,send:()=>k});var g=k.bind(k,"GET"),O=k.bind(k,"POST"),Y=k.bind(k,"PATCH"),y=k.bind(k,"DELETE"),S=k.bind(k,"PUT")},13538:(o,H,n)=>{"use strict";n.d(H,{b:()=>c});const E=.5*(Math.sqrt(3)-1),k=(3-Math.sqrt(3))/6,g=1/3,O=1/6,Y=(Math.sqrt(5)-1)/4,y=(5-Math.sqrt(5))/20,S=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),G=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const c=class{constructor(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const H="function"==typeof o?o:function(o){let H=0,n=0,E=0,k=1;const g=function(){let o=4022871197;return function(H){H=H.toString();for(let n=0;n<H.length;n++){o+=H.charCodeAt(n);let E=.02519603282416938*o;o=E>>>0,E-=o,E*=o,o=E>>>0,E-=o,o+=4294967296*E}return 2.3283064365386963e-10*(o>>>0)}}();H=g(" "),n=g(" "),E=g(" "),H-=g(o),H<0&&(H+=1);n-=g(o),n<0&&(n+=1);E-=g(o),E<0&&(E+=1);return function(){const o=2091639*H+2.3283064365386963e-10*k;return H=n,n=E,E=o-(k=0|o)}}(o);this.p=function(o){const H=new Uint8Array(256);for(let n=0;n<256;n++)H[n]=n;for(let n=0;n<255;n++){const E=n+~~(o()*(256-n)),k=H[n];H[n]=H[E],H[E]=k}return H}(H),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let n=0;n<512;n++)this.perm[n]=this.p[255&n],this.permMod12[n]=this.perm[n]%12}noise2D(o,H){const n=this.permMod12,g=this.perm;let O=0,Y=0,y=0;const G=(o+H)*E,c=Math.floor(o+G),A=Math.floor(H+G),l=(c+A)*k,x=o-(c-l),z=H-(A-l);let V,J;x>z?(V=1,J=0):(V=0,J=1);const N=x-V+k,h=z-J+k,Q=x-1+2*k,p=z-1+2*k,j=255&c,m=255&A;let P=.5-x*x-z*z;if(P>=0){const o=3*n[j+g[m]];P*=P,O=P*P*(S[o]*x+S[o+1]*z)}let b=.5-N*N-h*h;if(b>=0){const o=3*n[j+V+g[m+J]];b*=b,Y=b*b*(S[o]*N+S[o+1]*h)}let e=.5-Q*Q-p*p;if(e>=0){const o=3*n[j+1+g[m+1]];e*=e,y=e*e*(S[o]*Q+S[o+1]*p)}return 70*(O+Y+y)}noise3D(o,H,n){const E=this.permMod12,k=this.perm;let Y,y,G,c;const A=(o+H+n)*g,l=Math.floor(o+A),x=Math.floor(H+A),z=Math.floor(n+A),V=(l+x+z)*O,J=o-(l-V),N=H-(x-V),h=n-(z-V);let Q,p,j,m,P,b;J>=N?N>=h?(Q=1,p=0,j=0,m=1,P=1,b=0):J>=h?(Q=1,p=0,j=0,m=1,P=0,b=1):(Q=0,p=0,j=1,m=1,P=0,b=1):N<h?(Q=0,p=0,j=1,m=0,P=1,b=1):J<h?(Q=0,p=1,j=0,m=0,P=1,b=1):(Q=0,p=1,j=0,m=1,P=1,b=0);const e=J-Q+O,Z=N-p+O,M=h-j+O,K=J-m+2*O,f=N-P+2*O,B=h-b+2*O,q=J-1+.5,D=N-1+.5,T=h-1+.5,a=255&l,F=255&x,C=255&z;let t=.6-J*J-N*N-h*h;if(t<0)Y=0;else{const o=3*E[a+k[F+k[C]]];t*=t,Y=t*t*(S[o]*J+S[o+1]*N+S[o+2]*h)}let X=.6-e*e-Z*Z-M*M;if(X<0)y=0;else{const o=3*E[a+Q+k[F+p+k[C+j]]];X*=X,y=X*X*(S[o]*e+S[o+1]*Z+S[o+2]*M)}let s=.6-K*K-f*f-B*B;if(s<0)G=0;else{const o=3*E[a+m+k[F+P+k[C+b]]];s*=s,G=s*s*(S[o]*K+S[o+1]*f+S[o+2]*B)}let U=.6-q*q-D*D-T*T;if(U<0)c=0;else{const o=3*E[a+1+k[F+1+k[C+1]]];U*=U,c=U*U*(S[o]*q+S[o+1]*D+S[o+2]*T)}return 32*(Y+y+G+c)}noise4D(o,H,n,E){const k=this.perm;let g,O,S,c,A;const l=(o+H+n+E)*Y,x=Math.floor(o+l),z=Math.floor(H+l),V=Math.floor(n+l),J=Math.floor(E+l),N=(x+z+V+J)*y,h=o-(x-N),Q=H-(z-N),p=n-(V-N),j=E-(J-N);let m=0,P=0,b=0,e=0;h>Q?m++:P++,h>p?m++:b++,h>j?m++:e++,Q>p?P++:b++,Q>j?P++:e++,p>j?b++:e++;const Z=m>=3?1:0,M=P>=3?1:0,K=b>=3?1:0,f=e>=3?1:0,B=m>=2?1:0,q=P>=2?1:0,D=b>=2?1:0,T=e>=2?1:0,a=m>=1?1:0,F=P>=1?1:0,C=b>=1?1:0,t=e>=1?1:0,X=h-Z+y,s=Q-M+y,U=p-K+y,I=j-f+y,v=h-B+2*y,w=Q-q+2*y,r=p-D+2*y,u=j-T+2*y,d=h-a+3*y,R=Q-F+3*y,W=p-C+3*y,i=j-t+3*y,L=h-1+4*y,oo=Q-1+4*y,Ho=p-1+4*y,no=j-1+4*y,Eo=255&x,ko=255&z,go=255&V,Oo=255&J;let Yo=.6-h*h-Q*Q-p*p-j*j;if(Yo<0)g=0;else{const o=k[Eo+k[ko+k[go+k[Oo]]]]%32*4;Yo*=Yo,g=Yo*Yo*(G[o]*h+G[o+1]*Q+G[o+2]*p+G[o+3]*j)}let yo=.6-X*X-s*s-U*U-I*I;if(yo<0)O=0;else{const o=k[Eo+Z+k[ko+M+k[go+K+k[Oo+f]]]]%32*4;yo*=yo,O=yo*yo*(G[o]*X+G[o+1]*s+G[o+2]*U+G[o+3]*I)}let So=.6-v*v-w*w-r*r-u*u;if(So<0)S=0;else{const o=k[Eo+B+k[ko+q+k[go+D+k[Oo+T]]]]%32*4;So*=So,S=So*So*(G[o]*v+G[o+1]*w+G[o+2]*r+G[o+3]*u)}let Go=.6-d*d-R*R-W*W-i*i;if(Go<0)c=0;else{const o=k[Eo+a+k[ko+F+k[go+C+k[Oo+t]]]]%32*4;Go*=Go,c=Go*Go*(G[o]*d+G[o+1]*R+G[o+2]*W+G[o+3]*i)}let co=.6-L*L-oo*oo-Ho*Ho-no*no;if(co<0)A=0;else{const o=k[Eo+1+k[ko+1+k[go+1+k[Oo+1]]]]%32*4;co*=co,A=co*co*(G[o]*L+G[o+1]*oo+G[o+2]*Ho+G[o+3]*no)}return 27*(g+O+S+c+A)}}}}]);