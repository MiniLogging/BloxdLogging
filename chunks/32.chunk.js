/*! For license information please see no2ey.32.891182dc.chunk.js.LICENSE.txt */
(self.hmihoa2fs98=self.hmihoa2fs98||[]).push([[32],{13629:(b,d,P)=>{"use strict";var G=P(13631),W=P(13640),i=P(13644);P.g.__TYPEDARRAY_POOL||(P.g.__TYPEDARRAY_POOL={UINT8:W([32,0]),UINT16:W([32,0]),UINT32:W([32,0]),INT8:W([32,0]),INT16:W([32,0]),INT32:W([32,0]),FLOAT:W([32,0]),DOUBLE:W([32,0]),DATA:W([32,0]),UINT8C:W([32,0]),BUFFER:W([32,0])});var q="undefined"!==typeof Uint8ClampedArray,C=P.g.__TYPEDARRAY_POOL;C.UINT8C||(C.UINT8C=W([32,0])),C.BUFFER||(C.BUFFER=W([32,0]));var J=C.DATA,L=C.BUFFER;function x(b){if(b){var d=b.length||b.byteLength,P=G.log2(d);J[P].push(b)}}function Y(b){b=G.nextPow2(b);var d=G.log2(b),P=J[d];return P.length>0?P.pop():new ArrayBuffer(b)}function s(b){return new Uint8Array(Y(b),0,b)}function E(b){return new Uint16Array(Y(2*b),0,b)}function w(b){return new Uint32Array(Y(4*b),0,b)}function t(b){return new Int8Array(Y(b),0,b)}function r(b){return new Int16Array(Y(2*b),0,b)}function B(b){return new Int32Array(Y(4*b),0,b)}function n(b){return new Float32Array(Y(4*b),0,b)}function Z(b){return new Float64Array(Y(8*b),0,b)}function o(b){return q?new Uint8ClampedArray(Y(b),0,b):s(b)}function A(b){return new DataView(Y(b),0,b)}d.free=function(b){if(i(b))L[G.log2(b.length)].push(b);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(b)&&(b=b.buffer),!b)return;var d=b.length||b.byteLength,P=0|G.log2(d);J[P].push(b)}},d.freeUint8=d.freeUint16=d.freeUint32=d.freeInt8=d.freeInt16=d.freeInt32=d.freeFloat32=d.freeFloat=d.freeFloat64=d.freeDouble=d.freeUint8Clamped=d.freeDataView=function(b){x(b.buffer)},d.freeArrayBuffer=x,d.freeBuffer=function(b){L[G.log2(b.length)].push(b)},d.malloc=function(b,d){if(void 0===d||"arraybuffer"===d)return Y(b);switch(d){case"uint8":return s(b);case"uint16":return E(b);case"uint32":return w(b);case"int8":return t(b);case"int16":return r(b);case"int32":return B(b);case"float":case"float32":return n(b);case"double":case"float64":return Z(b);case"uint8_clamped":return o(b);case"buffer":throw"Buffer not supported";case"data":case"dataview":return A(b);default:return null}return null},d.mallocArrayBuffer=Y,d.mallocUint8=s,d.mallocUint16=E,d.mallocUint32=w,d.mallocInt8=t,d.mallocInt16=r,d.mallocInt32=B,d.mallocFloat32=d.mallocFloat=n,d.mallocFloat64=d.mallocDouble=Z,d.mallocUint8Clamped=o,d.mallocDataView=A,d.clearCache=function(){for(var b=0;b<32;++b)C.UINT8[b].length=0,C.UINT16[b].length=0,C.UINT32[b].length=0,C.INT8[b].length=0,C.INT16[b].length=0,C.INT32[b].length=0,C.FLOAT[b].length=0,C.DOUBLE[b].length=0,C.UINT8C[b].length=0,J[b].length=0,L[b].length=0}},13721:(b,d,P)=>{b.exports=W;var G=P(12470);function W(b,d){if(!(this instanceof W))return new W(b,d);var P=G.create();G.add(P,b,d),this.base=G.min(G.create(),b,P),this.IL=G.clone(d),this.max=G.max(G.create(),b,P),this.mag=G.length(this.IL)}var i=W.prototype;i.width=function(){return this.IL[0]},i.height=function(){return this.IL[1]},i.depth=function(){return this.IL[2]},i.x0=function(){return this.base[0]},i.y0=function(){return this.base[1]},i.z0=function(){return this.base[2]},i.x1=function(){return this.max[0]},i.y1=function(){return this.max[1]},i.z1=function(){return this.max[2]},i.translate=function(b){return G.add(this.max,this.max,b),G.add(this.base,this.base,b),this},i.setPosition=function(b){return G.add(this.max,b,this.IL),G.k(this.base,b),this},i.expand=function(b){var d=G.create(),P=G.create();return G.max(d,b.max,this.max),G.min(P,b.base,this.base),G.Rd(d,d,P),new W(P,d)},i.intersects=function(b){return!(b.base[0]>this.max[0])&&(!(b.base[1]>this.max[1])&&(!(b.base[2]>this.max[2])&&(!(b.max[0]<this.base[0])&&(!(b.max[1]<this.base[1])&&!(b.max[2]<this.base[2])))))},i.touches=function(b){var d=this.union(b);return null!==d&&(0==d.width()||0==d.height()||0==d.depth())},i.union=function(b){if(!this.intersects(b))return null;var d=Math.max(b.base[0],this.base[0]),P=Math.max(b.base[1],this.base[1]),G=Math.max(b.base[2],this.base[2]);return new W([d,P,G],[Math.min(b.max[0],this.max[0])-d,Math.min(b.max[1],this.max[1])-P,Math.min(b.max[2],this.max[2])-G])}},13631:(b,d)=>{"use strict";function P(b){var d=32;return(b&=-b)&&d--,65535&b&&(d-=16),16711935&b&&(d-=8),252645135&b&&(d-=4),858993459&b&&(d-=2),1431655765&b&&(d-=1),d}d.INT_BITS=32,d.INT_MAX=2147483647,d.INT_MIN=-1<<31,d.sign=function(b){return(b>0)-(b<0)},d.abs=function(b){var d=b>>31;return(b^d)-d},d.min=function(b,d){return d^(b^d)&-(b<d)},d.max=function(b,d){return b^(b^d)&-(b<d)},d.isPow2=function(b){return!(b&b-1)&&!!b},d.log2=function(b){var d,P;return d=(b>65535)<<4,d|=P=((b>>>=d)>255)<<3,d|=P=((b>>>=P)>15)<<2,(d|=P=((b>>>=P)>3)<<1)|(b>>>=P)>>1},d.log10=function(b){return b>=1e9?9:b>=1e8?8:b>=1e7?7:b>=1e6?6:b>=1e5?5:b>=1e4?4:b>=1e3?3:b>=100?2:b>=10?1:0},d.popCount=function(b){return 16843009*((b=(858993459&(b-=b>>>1&1431655765))+(b>>>2&858993459))+(b>>>4)&252645135)>>>24},d.countTrailingZeros=P,d.nextPow2=function(b){return b+=0===b,--b,b|=b>>>1,b|=b>>>2,b|=b>>>4,b|=b>>>8,(b|=b>>>16)+1},d.prevPow2=function(b){return b|=b>>>1,b|=b>>>2,b|=b>>>4,b|=b>>>8,(b|=b>>>16)-(b>>>1)},d.parity=function(b){return b^=b>>>16,b^=b>>>8,b^=b>>>4,27030>>>(b&=15)&1};var G=new Array(256);!function(b){for(var d=0;d<256;++d){var P=d,G=d,W=7;for(P>>>=1;P;P>>>=1)G<<=1,G|=1&P,--W;b[d]=G<<W&255}}(G),d.reverse=function(b){return G[255&b]<<24|G[b>>>8&255]<<16|G[b>>>16&255]<<8|G[b>>>24&255]},d.interleave2=function(b,d){return(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))|(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d&=65535)|d<<8))|d<<4))|d<<2))|d<<1))<<1},d.deinterleave2=function(b,d){return(b=65535&((b=16711935&((b=252645135&((b=858993459&((b=b>>>d&1431655765)|b>>>1))|b>>>2))|b>>>4))|b>>>16))<<16>>16},d.interleave3=function(b,d,P){return b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2),(b|=(d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2))<<1)|(P=1227133513&((P=3272356035&((P=251719695&((P=4278190335&((P&=1023)|P<<16))|P<<8))|P<<4))|P<<2))<<2},d.deinterleave3=function(b,d){return(b=1023&((b=4278190335&((b=251719695&((b=3272356035&((b=b>>>d&1227133513)|b>>>2))|b>>>4))|b>>>8))|b>>>16))<<22>>22},d.nextCombination=function(b){var d=b|b-1;return d+1|(~d&-~d)-1>>>P(b)+1}},13623:(b,d,P)=>{"use strict";b.exports=function(b,d,P){switch(arguments.length){case 1:return G=[],L(W=b,W,x,!0),G;case 2:return"function"===typeof d?L(b,b,d,!0):function(b,d){return G=[],L(b,d,x,!1),G}(b,d);case 3:return L(b,d,P,!1);default:throw new Error("box-intersect: Invalid arguments")}var W};var G,W=P(13629),i=P(13653),q=P(13664);function C(b,d){for(var P=0;P<b;++P)if(!(d[P]<=d[P+b]))return!0;return!1}function J(b,d,P,G){for(var W=0,i=0,q=0,J=b.length;q<J;++q){var L=b[q];if(!C(d,L)){for(var x=0;x<2*d;++x)P[W++]=L[x];G[i++]=q}}return i}function L(b,d,P,G){var C=b.length,L=d.length;if(!(C<=0||L<=0)){var x=b[0].length>>>1;if(!(x<=0)){var Y,s=W.mallocDouble(2*x*C),E=W.mallocInt32(C);if((C=J(b,x,s,E))>0){if(1===x&&G)i.init(C),Y=i.sweepComplete(x,P,0,C,s,E,0,C,s,E);else{var w=W.mallocDouble(2*x*L),t=W.mallocInt32(L);(L=J(d,x,w,t))>0&&(i.init(C+L),Y=1===x?i.sweepBipartite(x,P,0,C,s,E,0,L,w,t):q(x,P,G,C,s,E,L,w,t),W.free(w),W.free(t))}W.free(s),W.free(E)}return Y}}}function x(b,d){G.push([b,d])}},13668:(b,d)=>{"use strict";var P="d",G="ax",W="fp",i="es",q="rs",C="re",J="rb",L="bs",x="be",Y="bb",s=[P,G,"vv",q,C,J,"ri",L,x,Y,"bi"];function E(b){var d="bruteForce"+(b?"Full":"Partial"),G=[],q=s.slice();b||q.splice(3,0,W);var C=["function "+d+"("+q.join()+"){"];function J(d,W){var q=function(b,d,G){var W="bruteForce"+(b?"Red":"Blue")+(d?"Flip":"")+(G?"Full":""),q=["function ",W,"(",s.join(),"){","var ",i,"=2*",P,";"],C="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",J="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(G?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return b?q.push(C,"Q",":",J):q.push(J,"Q",":",C),G?q.push("if(y1<x0||x1<y0)continue;"):d?q.push("if(y0<=x0||x1<y0)continue;"):q.push("if(y0<x0||x1<y0)continue;"),q.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),d?q.push("yi,xi"):q.push("xi,yi"),q.push(");if(rv!==void 0)return rv;}}}"),{name:W,code:q.join("")}}(d,W,b);G.push(q.code),C.push("return "+q.name+"("+s.join()+");")}C.push("if(re-rs>be-bs){"),b?(J(!0,!1),C.push("}else{"),J(!1,!1)):(C.push("if(fp){"),J(!0,!0),C.push("}else{"),J(!0,!1),C.push("}}else{if(fp){"),J(!1,!0),C.push("}else{"),J(!1,!1),C.push("}")),C.push("}}return "+d);var L=G.join("")+C.join("");return new Function(L)()}d.partial=E(!1),d.full=E(!0)},13664:(b,d,P)=>{"use strict";b.exports=function(b,d,P,i,x,e,R,U,H){!function(b,d){var P=8*W.log2(d+1)*(b+1)|0,i=W.nextPow2(o*P);f.length<i&&(G.free(f),f=G.mallocInt32(i));var q=W.nextPow2(A*P);g.length<q&&(G.free(g),g=G.mallocDouble(q))}(b,i+R);var p,S=0,l=2*b;X(S++,0,0,i,0,R,P?16:0,-1/0,1/0),P||X(S++,0,0,R,0,i,1,-1/0,1/0);for(;S>0;){var N=(S-=1)*o,j=f[N],a=f[N+1],O=f[N+2],V=f[N+3],y=f[N+4],c=f[N+5],D=S*A,z=g[D],Q=g[D+1],I=1&c,m=!!(16&c),v=x,F=e,h=U,T=H;if(I&&(v=U,F=H,h=x,T=e),!(2&c&&a>=(O=r(b,j,a,O,v,F,Q)))&&!(4&c&&(a=B(b,j,a,O,v,F,z))>=O)){var K=O-a,k=y-V;if(m){if(b*K*(K+k)<E){if(void 0!==(p=J.scanComplete(b,j,d,a,O,v,F,V,y,h,T)))return p;continue}}else{if(b*Math.min(K,k)<Y){if(void 0!==(p=q(b,j,d,I,a,O,v,F,V,y,h,T)))return p;continue}if(b*K*k<s){if(void 0!==(p=J.scanBipartite(b,j,d,I,a,O,v,F,V,y,h,T)))return p;continue}}var bb=w(b,j,a,O,v,F,z,Q);if(a<bb)if(b*(bb-a)<Y){if(void 0!==(p=C(b,j+1,d,a,bb,v,F,V,y,h,T)))return p}else if(j===b-2){if(void 0!==(p=I?J.sweepBipartite(b,d,V,y,h,T,a,bb,v,F):J.sweepBipartite(b,d,a,bb,v,F,V,y,h,T)))return p}else X(S++,j+1,a,bb,V,y,I,-1/0,1/0),X(S++,j+1,V,y,a,bb,1^I,-1/0,1/0);if(bb<O){var db=L(b,j,V,y,h,T),Pb=h[l*db+j],Gb=t(b,j,db,y,h,T,Pb);if(Gb<y&&X(S++,j,bb,O,Gb,y,(4|I)+(m?16:0),Pb,Q),V<db&&X(S++,j,bb,O,V,db,(2|I)+(m?16:0),z,Pb),db+1===Gb){if(void 0!==(p=m?M(b,j,d,bb,O,v,F,db,h,T[db]):u(b,j,d,I,bb,O,v,F,db,h,T[db])))return p}else if(db<Gb){var Wb;if(m){if(bb<(Wb=n(b,j,bb,O,v,F,Pb))){var ib=t(b,j,bb,Wb,v,F,Pb);if(j===b-2){if(bb<ib&&void 0!==(p=J.sweepComplete(b,d,bb,ib,v,F,db,Gb,h,T)))return p;if(ib<Wb&&void 0!==(p=J.sweepBipartite(b,d,ib,Wb,v,F,db,Gb,h,T)))return p}else bb<ib&&X(S++,j+1,bb,ib,db,Gb,16,-1/0,1/0),ib<Wb&&(X(S++,j+1,ib,Wb,db,Gb,0,-1/0,1/0),X(S++,j+1,db,Gb,ib,Wb,1,-1/0,1/0))}}else bb<(Wb=I?Z(b,j,bb,O,v,F,Pb):n(b,j,bb,O,v,F,Pb))&&(j===b-2?p=I?J.sweepBipartite(b,d,db,Gb,h,T,bb,Wb,v,F):J.sweepBipartite(b,d,bb,Wb,v,F,db,Gb,h,T):(X(S++,j+1,bb,Wb,db,Gb,I,-1/0,1/0),X(S++,j+1,db,Gb,bb,Wb,1^I,-1/0,1/0)))}}}}};var G=P(13629),W=P(13631),i=P(13668),q=i.partial,C=i.full,J=P(13653),L=P(13672),x=P(13675),Y=128,s=1<<22,E=1<<22,w=x("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),t=x("lo===p0",["p0"]),r=x("lo<p0",["p0"]),B=x("hi<=p0",["p0"]),n=x("lo<=p0&&p0<=hi",["p0"]),Z=x("lo<p0&&p0<=hi",["p0"]),o=6,A=2,f=G.mallocInt32(1024),g=G.mallocDouble(1024);function X(b,d,P,G,W,i,q,C,J){var L=o*b;f[L]=d,f[L+1]=P,f[L+2]=G,f[L+3]=W,f[L+4]=i,f[L+5]=q;var x=A*b;g[x]=C,g[x+1]=J}function u(b,d,P,G,W,i,q,C,J,L,x){var Y=2*b,s=J*Y,E=L[s+d];b:for(var w=W,t=W*Y;w<i;++w,t+=Y){var r=q[t+d],B=q[t+d+b];if(!(E<r||B<E)&&(!G||E!==r)){for(var n,Z=C[w],o=d+1;o<b;++o){r=q[t+o],B=q[t+o+b];var A=L[s+o],f=L[s+o+b];if(B<A||f<r)continue b}if(void 0!==(n=G?P(x,Z):P(Z,x)))return n}}}function M(b,d,P,G,W,i,q,C,J,L){var x=2*b,Y=C*x,s=J[Y+d];b:for(var E=G,w=G*x;E<W;++E,w+=x){var t=q[E];if(t!==L){var r=i[w+d],B=i[w+d+b];if(!(s<r||B<s)){for(var n=d+1;n<b;++n){r=i[w+n],B=i[w+n+b];var Z=J[Y+n],o=J[Y+n+b];if(B<Z||o<r)continue b}var A=P(t,L);if(void 0!==A)return A}}}}},13672:(b,d,P)=>{"use strict";b.exports=function(b,d,P,q,C,J){if(q<=P+1)return P;var L=P,x=q,Y=q+P>>>1,s=2*b,E=Y,w=C[s*Y+d];for(;L<x;){if(x-L<W){i(b,d,L,x,C,J),w=C[s*Y+d];break}var t=x-L,r=Math.random()*t+L|0,B=C[s*r+d],n=Math.random()*t+L|0,Z=C[s*n+d],o=Math.random()*t+L|0,A=C[s*o+d];B<=Z?A>=Z?(E=n,w=Z):B>=A?(E=r,w=B):(E=o,w=A):Z>=A?(E=n,w=Z):A>=B?(E=r,w=B):(E=o,w=A);for(var f=s*(x-1),g=s*E,X=0;X<s;++X,++f,++g){var u=C[f];C[f]=C[g],C[g]=u}var M=J[x-1];J[x-1]=J[E],J[E]=M;for(f=s*(x-1),g=s*(E=G(b,d,L,x-1,C,J,w)),X=0;X<s;++X,++f,++g){u=C[f];C[f]=C[g],C[g]=u}M=J[x-1];if(J[x-1]=J[E],J[E]=M,Y<E){for(x=E-1;L<x&&C[s*(x-1)+d]===w;)x-=1;x+=1}else{if(!(E<Y))break;for(L=E+1;L<x&&C[s*L+d]===w;)L+=1}}return G(b,d,P,Y,C,J,C[s*Y+d])};var G=P(13675)("lo<p0",["p0"]),W=8;function i(b,d,P,G,W,i){for(var q=2*b,C=q*(P+1)+d,J=P+1;J<G;++J,C+=q)for(var L=W[C],x=J,Y=q*(J-1);x>P&&W[Y+d]>L;--x,Y-=q){for(var s=Y,E=Y+q,w=0;w<q;++w,++s,++E){var t=W[s];W[s]=W[E],W[E]=t}var r=i[x];i[x]=i[x-1],i[x-1]=r}}},13675:b=>{"use strict";b.exports=function(b,P){var G="abcdef".split("").concat(P),W=[];b.indexOf("lo")>=0&&W.push("lo=e[k+n]");b.indexOf("hi")>=0&&W.push("hi=e[k+o]");return G.push(d.replace("_",W.join()).replace("$",b)),Function.apply(void 0,G)};var d="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13658:b=>{"use strict";b.exports=function(b,G){G<=4*d?P(0,G-1,b):L(0,G-1,b)};var d=32;function P(b,d,P){for(var G=2*(b+1),W=b+1;W<=d;++W){for(var i=P[G++],q=P[G++],C=W,J=G-2;C-- >b;){var L=P[J-2],x=P[J-1];if(L<i)break;if(L===i&&x<q)break;P[J]=L,P[J+1]=x,J-=2}P[J]=i,P[J+1]=q}}function G(b,d,P){d*=2;var G=P[b*=2],W=P[b+1];P[b]=P[d],P[b+1]=P[d+1],P[d]=G,P[d+1]=W}function W(b,d,P){d*=2,P[b*=2]=P[d],P[b+1]=P[d+1]}function i(b,d,P,G){d*=2,P*=2;var W=G[b*=2],i=G[b+1];G[b]=G[d],G[b+1]=G[d+1],G[d]=G[P],G[d+1]=G[P+1],G[P]=W,G[P+1]=i}function q(b,d,P,G,W){d*=2,W[b*=2]=W[d],W[d]=P,W[b+1]=W[d+1],W[d+1]=G}function C(b,d,P){d*=2;var G=P[b*=2],W=P[d];return!(G<W)&&(G!==W||P[b+1]>P[d+1])}function J(b,d,P,G){var W=G[b*=2];return W<d||W===d&&G[b+1]<P}function L(b,x,Y){var s=(x-b+1)/6|0,E=b+s,w=x-s,t=b+x>>1,r=t-s,B=t+s,n=E,Z=r,o=t,A=B,f=w,g=b+1,X=x-1,u=0;C(n,Z,Y)&&(u=n,n=Z,Z=u),C(A,f,Y)&&(u=A,A=f,f=u),C(n,o,Y)&&(u=n,n=o,o=u),C(Z,o,Y)&&(u=Z,Z=o,o=u),C(n,A,Y)&&(u=n,n=A,A=u),C(o,A,Y)&&(u=o,o=A,A=u),C(Z,f,Y)&&(u=Z,Z=f,f=u),C(Z,o,Y)&&(u=Z,Z=o,o=u),C(A,f,Y)&&(u=A,A=f,f=u);for(var M=Y[2*Z],e=Y[2*Z+1],R=Y[2*A],U=Y[2*A+1],H=2*n,p=2*o,S=2*f,l=2*E,N=2*t,j=2*w,a=0;a<2;++a){var O=Y[H+a],V=Y[p+a],y=Y[S+a];Y[l+a]=O,Y[N+a]=V,Y[j+a]=y}W(r,b,Y),W(B,x,Y);for(var c=g;c<=X;++c)if(J(c,M,e,Y))c!==g&&G(c,g,Y),++g;else if(!J(c,R,U,Y))for(;;){if(J(X,R,U,Y)){J(X,M,e,Y)?(i(c,g,X,Y),++g,--X):(G(c,X,Y),--X);break}if(--X<c)break}q(b,g-1,M,e,Y),q(x,X+1,R,U,Y),g-2-b<=d?P(b,g-2,Y):L(b,g-2,Y),x-(X+2)<=d?P(X+2,x,Y):L(X+2,x,Y),X-g<=d?P(g,X,Y):L(g,X,Y)}},13653:(b,d,P)=>{"use strict";b.exports={init:function(b){var d=W.nextPow2(b);J.length<d&&(G.free(J),J=G.mallocInt32(d));L.length<d&&(G.free(L),L=G.mallocInt32(d));x.length<d&&(G.free(x),x=G.mallocInt32(d));Y.length<d&&(G.free(Y),Y=G.mallocInt32(d));s.length<d&&(G.free(s),s=G.mallocInt32(d));E.length<d&&(G.free(E),E=G.mallocInt32(d));var P=8*d;w.length<P&&(G.free(w),w=G.mallocDouble(P))},sweepBipartite:function(b,d,P,G,W,C,s,E,B,n){for(var Z=0,o=2*b,A=b-1,f=o-1,g=P;g<G;++g){var X=C[g],u=o*g;w[Z++]=W[u+A],w[Z++]=-(X+1),w[Z++]=W[u+f],w[Z++]=X}for(g=s;g<E;++g){X=n[g]+q;var M=o*g;w[Z++]=B[M+A],w[Z++]=-X,w[Z++]=B[M+f],w[Z++]=X}var e=Z>>>1;i(w,e);var R=0,U=0;for(g=0;g<e;++g){var H=0|w[2*g+1];if(H>=q)t(x,Y,U--,H=H-q|0);else if(H>=0)t(J,L,R--,H);else if(H<=-q){H=-H-q|0;for(var p=0;p<R;++p){if(void 0!==(S=d(J[p],H)))return S}r(x,Y,U++,H)}else{H=-H-1|0;for(p=0;p<U;++p){var S;if(void 0!==(S=d(H,x[p])))return S}r(J,L,R++,H)}}},sweepComplete:function(b,d,P,G,W,q,C,B,n,Z){for(var o=0,A=2*b,f=b-1,g=A-1,X=P;X<G;++X){var u=q[X]+1<<1,M=A*X;w[o++]=W[M+f],w[o++]=-u,w[o++]=W[M+g],w[o++]=u}for(X=C;X<B;++X){u=Z[X]+1<<1;var e=A*X;w[o++]=n[e+f],w[o++]=1|-u,w[o++]=n[e+g],w[o++]=1|u}var R=o>>>1;i(w,R);var U=0,H=0,p=0;for(X=0;X<R;++X){var S=0|w[2*X+1],l=1&S;if(X<R-1&&S>>1===w[2*X+3]>>1&&(l=2,X+=1),S<0){for(var N=-(S>>1)-1,j=0;j<p;++j){if(void 0!==(a=d(s[j],N)))return a}if(0!==l)for(j=0;j<U;++j){if(void 0!==(a=d(J[j],N)))return a}if(1!==l)for(j=0;j<H;++j){var a;if(void 0!==(a=d(x[j],N)))return a}0===l?r(J,L,U++,N):1===l?r(x,Y,H++,N):2===l&&r(s,E,p++,N)}else{N=(S>>1)-1;0===l?t(J,L,U--,N):1===l?t(x,Y,H--,N):2===l&&t(s,E,p--,N)}}},scanBipartite:function(b,d,P,G,W,C,x,Y,s,E,B,n){var Z=0,o=2*b,A=d,f=d+b,g=1,X=1;G?X=q:g=q;for(var u=W;u<C;++u){var M=u+g,e=o*u;w[Z++]=x[e+A],w[Z++]=-M,w[Z++]=x[e+f],w[Z++]=M}for(u=s;u<E;++u){M=u+X;var R=o*u;w[Z++]=B[R+A],w[Z++]=-M}var U=Z>>>1;i(w,U);var H=0;for(u=0;u<U;++u){var p=0|w[2*u+1];if(p<0){var S=!1;if((M=-p)>=q?(S=!G,M-=q):(S=!!G,M-=1),S)r(J,L,H++,M);else{var l=n[M],N=o*M,j=B[N+d+1],a=B[N+d+1+b];b:for(var O=0;O<H;++O){var V=J[O],y=o*V;if(!(a<x[y+d+1]||x[y+d+1+b]<j)){for(var c=d+2;c<b;++c)if(B[N+c+b]<x[y+c]||x[y+c+b]<B[N+c])continue b;var D,z=Y[V];if(void 0!==(D=G?P(l,z):P(z,l)))return D}}}}else t(J,L,H--,p-g)}},scanComplete:function(b,d,P,G,W,C,L,x,Y,s,E){for(var t=0,r=2*b,B=d,n=d+b,Z=G;Z<W;++Z){var o=Z+q,A=r*Z;w[t++]=C[A+B],w[t++]=-o,w[t++]=C[A+n],w[t++]=o}for(Z=x;Z<Y;++Z){o=Z+1;var f=r*Z;w[t++]=s[f+B],w[t++]=-o}var g=t>>>1;i(w,g);var X=0;for(Z=0;Z<g;++Z){var u=0|w[2*Z+1];if(u<0){if((o=-u)>=q)J[X++]=o-q;else{var M=E[o-=1],e=r*o,R=s[e+d+1],U=s[e+d+1+b];b:for(var H=0;H<X;++H){var p=J[H],S=L[p];if(S===M)break;var l=r*p;if(!(U<C[l+d+1]||C[l+d+1+b]<R)){for(var N=d+2;N<b;++N)if(s[e+N+b]<C[l+N]||C[l+N+b]<s[e+N])continue b;var j=P(S,M);if(void 0!==j)return j}}}}else{for(o=u-q,H=X-1;H>=0;--H)if(J[H]===o){for(N=H+1;N<X;++N)J[N-1]=J[N];break}--X}}}};var G=P(13629),W=P(13631),i=P(13658),q=1<<28,C=1024,J=G.mallocInt32(C),L=G.mallocInt32(C),x=G.mallocInt32(C),Y=G.mallocInt32(C),s=G.mallocInt32(C),E=G.mallocInt32(C),w=G.mallocDouble(8192);function t(b,d,P,G){var W=d[G],i=b[P-1];b[W]=i,d[i]=W}function r(b,d,P,G){b[P]=G,d[G]=P}},13640:b=>{"use strict";function d(b,P,G){var W=0|b[G];if(W<=0)return[];var i,q=new Array(W);if(G===b.length-1)for(i=0;i<W;++i)q[i]=P;else for(i=0;i<W;++i)q[i]=d(b,P,G+1);return q}b.exports=function(b,P){switch("undefined"===typeof P&&(P=0),typeof b){case"number":if(b>0)return function(b,d){var P,G;for(P=new Array(b),G=0;G<b;++G)P[G]=d;return P}(0|b,P);break;case"object":if("number"===typeof b.length)return d(b,P,0)}return[]}},13596:(b,d,P)=>{b.exports=function(){var b=this;this.components={},this.comps=this.components;var d=this.components,P=1,W={},i=[],q=[],C={timeout:!1,removals:[],multiComps:[]};function J(b,P){var G=d[P],i=W[P],q=i.hash[b];q&&(i.remove(b),G.Ld&&(G.multi?(q.forEach((d=>{d&&G.Ld(b,d)})),q.length=0):G.Ld(b,q)),C.removals.push(i),L())}function L(){C.timeout||(C.timeout=!0,setTimeout(x,1))}function x(){C.timeout=!1,Y()}function Y(){C.multiComps.length&&function(b){for(var d=0;d<b.length;d++){var{entID:P,data:G}=b[d],W=G.hash[P];if(W){for(var i=0;i<W.length;i++)W[i]||(W.splice(i,1),i--);0===W.length&&(G.remove(P),C.removals.push(G))}}b.length=0}(C.multiComps),C.removals.length&&function(b){for(var d=0;d<b.length;d++){b[d].flush()}b.length=0}(C.removals)}this.tY=W,this._systems=i,this._renderSystems=q,this.FL=function(d){var G=P++;return Array.isArray(d)&&d.forEach((d=>b.pJ(G,d))),G},this.deleteEntity=function(d){return Object.keys(W).forEach((b=>{W[b].hash[d]&&J(d,b)})),b},this.Yx=function(b){if(!b)throw new Error("Missing component definition");var P=b.name;if(!P)throw new Error("Component definition must have a name property.");if("string"!==typeof P)throw new Error("Component name must be a string.");if(""===P)throw new Error("Component name must be a non-empty string.");if(W[P])throw new Error(`Component ${P} already exists.`);var C={};return C.name=P,C.multi=!!b.multi,C.order=isNaN(b.order)?99:b.order,C.stateConstructor=b.stateConstructor||null,C.state=b.state||{},C.UC=b.UC||null,C.Ld=b.Ld||null,C.system=b.system||null,C.jC=b.jC||null,d[P]=C,W[P]=new G,W[P]._pendingMultiCleanup=!1,W[P]._multiCleanupIDs=C.multi?[]:null,C.system&&(i.push(P),i.sort(((b,P)=>d[b].order-d[P].order))),C.jC&&(q.push(P),q.sort(((b,P)=>d[b].order-d[P].order))),P},this.overwriteComponent=function(b,P){var G=d[b];if(!G)throw new Error(`Unknown component: ${b}`);if(!P)throw new Error("Missing component definition");if(G.name!==P.name)throw new Error("Overwriting component must use the same name property.");var C={};C.name=b,C.multi=!!P.multi,C.order=isNaN(P.order)?99:P.order,C.state=P.state||{},C.UC=P.UC||null,C.Ld=P.Ld||null,C.system=P.system||null,C.jC=P.jC||null,d[b]=C,W[b]._pendingMultiCleanup=!1,W[b]._multiCleanupIDs=C.multi?[]:null;var J=i.indexOf(b);C.system&&J<0&&i.push(b),!C.system&&J>=0&&i.splice(J,1),i.sort(((b,P)=>d[b].order-d[P].order));var L=q.indexOf(b);C.jC&&L<0&&q.push(b),!C.jC&&L>=0&&q.splice(L,1),q.sort(((b,P)=>d[b].order-d[P].order));var x=C.state;return this.UL(b).forEach((b=>{for(var d in x)d in b||(b[d]=x[d]);C.UC&&C.UC(b.lC,b)})),b},this.deleteComponent=function(P){var G=W[P];if(!G)throw new Error(`Unknown component: ${P}`);G.flush(),G.list.forEach((b=>{b&&J(b.lC||b[0].lC,P)}));var C=i.indexOf(P),L=q.indexOf(P);return C>-1&&i.splice(C,1),L>-1&&q.splice(L,1),W[P].dispose(),delete W[P],delete d[P],b},this.pJ=function(b,P,G){var i,q=d[P],C=W[P];if(!C)throw new Error(`Unknown component: ${P}.`);if(C.hash[b]&&!q.multi)throw new Error(`Entity ${b} already has component: ${P}.`);if(q.stateConstructor){if(!(i=new q.stateConstructor).hasOwnProperty("lC"))throw new Error(`Component ${q.name} stateConstructor type does not have property __id`)}else i=Object.assign({},{lC:b},q.state,G);if(i.lC=b,q.multi){var J=C.hash[b];J||(J=[],C.add(b,J)),J.push(i)}else C.add(b,i);return q.UC&&q.UC(b,i),this},this.DJ=function(b,d){var P=W[d];if(!P)throw new Error(`Unknown component: ${d}.`);return!!P.hash[b]},this.jJ=function(d,P){if(!W[P])throw new Error(`Unknown component: ${P}.`);return J(d,P),b},this.getState=function(b,d){var P=W[d];if(!P)throw new Error(`Unknown component: ${d}.`);return P.hash[b]},this.UL=function(b){var d=W[b];if(!d)throw new Error(`Unknown component: ${b}.`);return Y(),d.list},this.qE=function(b){if(!W[b])throw new Error(`Unknown component: ${b}.`);var d=W[b].hash;return b=>d[b]},this.LE=function(b){if(!W[b])throw new Error(`Unknown component: ${b}.`);var d=W[b].hash;return b=>!!d[b]},this.AC=function(P){Y();for(var G=0;G<i.length;G++){var q=i[G],C=d[q],J=W[q];C.system(P,J.list),Y()}return b},this.render=function(P){Y();for(var G=0;G<q.length;G++){var i=q[G],C=d[i],J=W[i];C.jC(P,J.list),Y()}return b},this.removeMultiComponent=function(P,G,i){var q=d[G],J=W[G];if(!J)throw new Error(`Unknown component: ${G}.`);if(!q.multi)throw new Error("removeMultiComponent called on non-multi component");return function(b,d,P,G){var W=P.hash[b];if(W){var i=W[G];i&&(W[G]=null,d.Ld&&d.Ld(b,i),C.multiComps.push({entID:b,data:P}),L())}}(P,q,J,i),b}};var G=P(13602)},13602:b=>{function d(b,d){var P=b._map[d];if(delete b.hash[d],delete b._map[d],P===b.list.length-1)b.list.pop();else{var G=b.list.pop();if(b.list[P]=G,null===G||null===G[0]){var W=b.list.length;for(var i in b._map)if(b._map[i]===W)return void(b._map[i]=P)}else{var q=G.lC||G[0].lC;b._map[q]=P}}}b.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(b,d){if("number"===typeof this._map[b]){var P=this._map[b];this.hash[b]=d,this.list[P]=d}else this._map[b]=this.list.length,this.hash[b]=d,this.list.push(d)}remove(b){var d=this._map[b];this.hash[b]=null,this.list[d]=null,this._pendingRemovals.push(b)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var b=0;b<this._pendingRemovals.length;b++){var P=this._pendingRemovals[b];null===this.hash[P]&&d(this,P)}this._pendingRemovals.length=0}}},13565:b=>{"use strict";var d,P="object"===typeof Reflect?Reflect:null,G=function(b,d,P){return Function.prototype.apply.call(b,d,P)};d=P&&"function"===typeof P.ownKeys?P.ownKeys:Object.getOwnPropertySymbols?function(b){return Object.getOwnPropertyNames(b).concat(Object.getOwnPropertySymbols(b))}:function(b){return Object.getOwnPropertyNames(b)};var W=Number.isNaN||function(b){return b!==b};function i(){i.init.call(this)}b.exports=i,b.exports.once=function(b,d){return new Promise((function(P,G){function W(P){b.removeListener(d,i),G(P)}function i(){"function"===typeof b.removeListener&&b.removeListener("error",W),P([].slice.call(arguments))}t(b,d,i,{once:!0}),"error"!==d&&function(b,d,P){"function"===typeof b.on&&t(b,"error",d,P)}(b,W,{once:!0})}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var q=10;function C(b){if("function"!==typeof b)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}function J(b){return void 0===b._maxListeners?i.defaultMaxListeners:b._maxListeners}function L(b,d,P,G){var W,i,q,L;if(C(P),void 0===(i=b._events)?(i=b._events=Object.create(null),b._eventsCount=0):(void 0!==i.newListener&&(b.emit("newListener",d,P.listener?P.listener:P),i=b._events),q=i[d]),void 0===q)q=i[d]=P,++b._eventsCount;else if("function"===typeof q?q=i[d]=G?[P,q]:[q,P]:G?q.unshift(P):q.push(P),(W=J(b))>0&&q.length>W&&!q.warned){q.warned=!0;var x=new Error("Possible EventEmitter memory leak detected. "+q.length+" "+String(d)+" listeners added. Use emitter.setMaxListeners() to increase limit");x.name="MaxListenersExceededWarning",x.qd=b,x.type=d,x.count=q.length,L=x,console&&console.warn&&console.warn(L)}return b}function x(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Y(b,d,P){var G={fired:!1,wrapFn:void 0,target:b,type:d,listener:P},W=x.bind(G);return W.listener=P,G.wrapFn=W,W}function s(b,d,P){var G=b._events;if(void 0===G)return[];var W=G[d];return void 0===W?[]:"function"===typeof W?P?[W.listener||W]:[W]:P?function(b){for(var d=new Array(b.length),P=0;P<d.length;++P)d[P]=b[P].listener||b[P];return d}(W):w(W,W.length)}function E(b){var d=this._events;if(void 0!==d){var P=d[b];if("function"===typeof P)return 1;if(void 0!==P)return P.length}return 0}function w(b,d){for(var P=new Array(d),G=0;G<d;++G)P[G]=b[G];return P}function t(b,d,P,G){if("function"===typeof b.on)G.once?b.once(d,P):b.on(d,P);else{if("function"!==typeof b.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b);b.addEventListener(d,(function W(i){G.once&&b.removeEventListener(d,W),P(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return q},set:function(b){if("number"!==typeof b||b<0||W(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");q=b}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(b){if("number"!==typeof b||b<0||W(b))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+b+".");return this._maxListeners=b,this},i.prototype.getMaxListeners=function(){return J(this)},i.prototype.emit=function(b){for(var d=[],P=1;P<arguments.length;P++)d.push(arguments[P]);var W="error"===b,i=this._events;if(void 0!==i)W=W&&void 0===i.error;else if(!W)return!1;if(W){var q;if(d.length>0&&(q=d[0]),q instanceof Error)throw q;var C=new Error("Unhandled error."+(q?" ("+q.message+")":""));throw C.context=q,C}var J=i[b];if(void 0===J)return!1;if("function"===typeof J)G(J,this,d);else{var L=J.length,x=w(J,L);for(P=0;P<L;++P)G(x[P],this,d)}return!0},i.prototype.addListener=function(b,d){return L(this,b,d,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(b,d){return L(this,b,d,!0)},i.prototype.once=function(b,d){return C(d),this.on(b,Y(this,b,d)),this},i.prototype.prependOnceListener=function(b,d){return C(d),this.prependListener(b,Y(this,b,d)),this},i.prototype.removeListener=function(b,d){var P,G,W,i,q;if(C(d),void 0===(G=this._events))return this;if(void 0===(P=G[b]))return this;if(P===d||P.listener===d)0===--this._eventsCount?this._events=Object.create(null):(delete G[b],G.removeListener&&this.emit("removeListener",b,P.listener||d));else if("function"!==typeof P){for(W=-1,i=P.length-1;i>=0;i--)if(P[i]===d||P[i].listener===d){q=P[i].listener,W=i;break}if(W<0)return this;0===W?P.shift():function(b,d){for(;d+1<b.length;d++)b[d]=b[d+1];b.pop()}(P,W),1===P.length&&(G[b]=P[0]),void 0!==G.removeListener&&this.emit("removeListener",b,q||d)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.Cd=function(b){var d,P,G;if(void 0===(P=this._events))return this;if(void 0===P.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==P[b]&&(0===--this._eventsCount?this._events=Object.create(null):delete P[b]),this;if(0===arguments.length){var W,i=Object.keys(P);for(G=0;G<i.length;++G)"removeListener"!==(W=i[G])&&this.Cd(W);return this.Cd("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(d=P[b]))this.removeListener(b,d);else if(void 0!==d)for(G=d.length-1;G>=0;G--)this.removeListener(b,d[G]);return this},i.prototype.listeners=function(b){return s(this,b,!0)},i.prototype.rawListeners=function(b){return s(this,b,!1)},i.listenerCount=function(b,d){return"function"===typeof b.listenerCount?b.listenerCount(d):E.call(b,d)},i.prototype.listenerCount=E,i.prototype.eventNames=function(){return this._eventsCount>0?d(this._events):[]}},13862:b=>{"use strict";b.exports=function(b,d,P,G,W,i){var q=+d[0],C=+d[1],J=+d[2],L=+P[0],x=+P[1],Y=+P[2],s=Math.sqrt(L*L+x*x+Y*Y);if(0===s)throw new Error("Can't raycast along a zero vector");return function(b,d,P,G,W,i,q,C,J,L){for(var x=0,Y=Math.floor,s=0|Y(d),E=0|Y(P),w=0|Y(G),t=W>0?1:-1,r=i>0?1:-1,B=q>0?1:-1,n=Math.abs(1/W),Z=Math.abs(1/i),o=Math.abs(1/q),A=n<1/0?n*(t>0?s+1-d:d-s):1/0,f=Z<1/0?Z*(r>0?E+1-P:P-E):1/0,g=o<1/0?o*(B>0?w+1-G:G-w):1/0,X=-1;x<=C;){var u=b(s,E,w);if(u)return J&&(J[0]=d+x*W,J[1]=P+x*i,J[2]=G+x*q),L&&(L[0]=L[1]=L[2]=0,0===X&&(L[0]=-t),1===X&&(L[1]=-r),2===X&&(L[2]=-B)),u;A<f?A<g?(s+=t,x=A,A+=n,X=0):(w+=B,x=g,g+=o,X=2):f<g?(E+=r,x=f,f+=Z,X=1):(w+=B,x=g,g+=o,X=2)}return J&&(J[0]=d+x*W,J[1]=P+x*i,J[2]=G+x*q),L&&(L[0]=L[1]=L[2]=0),0}(b,q,C,J,L/=s,x/=s,Y/=s,G="undefined"===typeof G?64:+G,W,i)}},13889:(b,d,P)=>{"use strict";P.d(d,{d:()=>i});var G=P(13565);function W(){this.Ws=!1,this.stopPropagation=!1,this.qs=!1,this.disabled=!1}class i{constructor(b,d){this.version="0.7.0";var P=Object.assign({},new W,d||{});this.element=b||document,this.Ws=!!P.Ws,this.stopPropagation=!!P.stopPropagation,this.qs=!!P.qs,this.disabled=!!P.disabled,this.filterEvents=(b,d)=>!0,this.down=new G.EventEmitter,this.up=new G.EventEmitter,this.state={},this.gL={dx:0,dy:0,Ts:0,fL:0,Ks:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?C(this):document.addEventListener("DOMContentLoaded",(b=>{C(this)}),{once:!0})}bind(b){for(var d=arguments.length,P=new Array(d>1?d-1:0),G=1;G<d;G++)P[G-1]=arguments[G];P.forEach((d=>{var P=this._keyBindmap[d]||[];P.includes(b)||(P.push(b),this._keyBindmap[d]=P)})),this.state[b]=!!this.state[b],this.pressCount[b]=this.pressCount[b]||0,this.releaseCount[b]=this.releaseCount[b]||0}unbind(b){for(var d in this._keyBindmap){var P=this._keyBindmap[d],G=P.indexOf(b);G>-1&&P.splice(G,1)}}getBindings(){var b={};for(var d in this._keyBindmap){this._keyBindmap[d].forEach((P=>{b[P]=b[P]||[],b[P].push(d)}))}return b}AC(){q(this.gL),q(this.pressCount),q(this.releaseCount)}}function q(b){for(var d in b)b[d]=0}function C(b){window.addEventListener("keydown",w.bind(null,b,!0),!1),window.addEventListener("keyup",w.bind(null,b,!1),!1);var d={passive:!0};b.element.addEventListener("touchstart",Y.bind(void 0,b),{passive:!1}),b.element.addEventListener("touchend",E.bind(void 0,b),d),b.element.addEventListener("mousedown",t.bind(null,b,!0),d),window.document.addEventListener("mouseup",t.bind(null,b,!1),d),b.element.addEventListener("touchmove",r.bind(null,b),d),b.element.addEventListener("mousemove",r.bind(null,b),d),window.PointerEvent,b.element.addEventListener("wheel",B.bind(null,b),d),b.element.addEventListener("contextmenu",n.bind(null,b),!1),window.addEventListener("blur",Z.bind(null,b),!1)}var J=0,L=0,x=null;function Y(b,d){d.preventDefault(),s(d)}function s(b){let d=!1;for(let P=0;P<b.touches.length;++P)if(b.touches[P].identifier===x){d=!0;break}if(!d){const d=b.changedTouches[0];J=d.clientX,L=d.clientY,x=d.identifier}}function E(b,d){for(var P=d.changedTouches,G=0;G<P.length;++G)P[G].identifier===x&&(x=null)}function w(b,d,P){o(P.code,d,b,P)}function t(b,d,P){if("pointerId"in P)if(d){if(null!==b._touches.currID)return;b._touches.currID=P.pointerId}else{if(b._touches.currID!==P.pointerId)return;b._touches.currID=null}return o("Mouse"+("button"in P?P.button+1:1),d,b,P),!1}function r(b,d){var P=d.movementX||d.mozMovementX||0,G=d.movementY||d.mozMovementY||0;if(d.touches&&0===(P|G)){var W=function(b){s(b);for(let d=0;d<b.changedTouches.length;++d)if(b.changedTouches[d].identifier==x){const P=b.changedTouches[d],G=[P.clientX-J,P.clientY-L];return J=P.clientX,L=P.clientY,G}return console.error(`Did not find touch id ${x}`),[0,0]}(d);P=W[0],G=W[1]}b.gL.dx+=P,b.gL.dy+=G}function B(b,d){var P=1;switch(d.deltaMode){case 0:P=1;break;case 1:P=12;break;case 2:P=b.element.clientHeight||window.innerHeight}b.gL.Ts+=(d.deltaX||0)*P,b.gL.fL+=(d.deltaY||0)*P,b.gL.Ks+=(d.deltaZ||0)*P}function n(b,d){if(!b.qs)return d.preventDefault(),!1}function Z(b){for(var d in b._keyStates)b._keyStates[d]&&(/^Mouse\d/.test(d)||o(d,!1,b,{code:d,note:"p0rlpyxou",preventDefault:()=>{},stopPropagation:()=>{}}))}function o(b,d,P,G){var W=P._keyBindmap[b];W&&(A(P._keyStates[b],d)&&(P._keyStates[b]=d,W.forEach((b=>{(!P.filterEvents||P.filterEvents(G,b))&&function(b,d,P,G){var W=d?P.pressCount:P.releaseCount;W[b]=(W[b]||0)+1;var i=P._bindPressCount[b]||0;(i+=d?1:-1)<0&&(i=0);P._bindPressCount[b]=i;var q=P.state[b];if(A(q,i)){P.state[b]=i>0;var C=d?P.down:P.up;P.disabled||C.emit(b,G)}}(b,d,P,G)}))),"button"in G||(P.Ws&&!G.defaultPrevented&&G.preventDefault(),P.stopPropagation&&G.stopPropagation()))}function A(b,d){return b?!d:d}},12545:b=>{b.exports=function(b,d,P){return b[0]=d[0]+P[0],b[1]=d[1]+P[1],b[2]=d[2]+P[2],b}},12502:(b,d,P)=>{b.exports=function(b,d){var P=G(b[0],b[1],b[2]),q=G(d[0],d[1],d[2]);W(P,P),W(q,q);var C=i(P,q);return C>1?0:Math.acos(C)};var G=P(12505),W=P(12513),i=P(12522)},12608:b=>{b.exports=function(b,d){return b[0]=Math.ceil(d[0]),b[1]=Math.ceil(d[1]),b[2]=Math.ceil(d[2]),b}},12494:b=>{b.exports=function(b){var d=new Float32Array(3);return d[0]=b[0],d[1]=b[1],d[2]=b[2],d}},12524:b=>{b.exports=function(b,d){return b[0]=d[0],b[1]=d[1],b[2]=d[2],b}},12485:b=>{b.exports=function(){var b=new Float32Array(3);return b[0]=0,b[1]=0,b[2]=0,b}},12695:b=>{b.exports=function(b,d,P){var G=d[0],W=d[1],i=d[2],q=P[0],C=P[1],J=P[2];return b[0]=W*J-i*C,b[1]=i*q-G*J,b[2]=G*C-W*q,b}},12637:(b,d,P)=>{b.exports=P(12629)},12629:b=>{b.exports=function(b,d){var P=d[0]-b[0],G=d[1]-b[1],W=d[2]-b[2];return Math.sqrt(P*P+G*G+W*W)}},12583:(b,d,P)=>{b.exports=P(12581)},12581:b=>{b.exports=function(b,d,P){return b[0]=d[0]/P[0],b[1]=d[1]/P[1],b[2]=d[2]/P[2],b}},12522:b=>{b.exports=function(b,d){return b[0]*d[0]+b[1]*d[1]+b[2]*d[2]}},12479:b=>{b.exports=1e-6},12538:(b,d,P)=>{b.exports=function(b,d){var P=b[0],W=b[1],i=b[2],q=d[0],C=d[1],J=d[2];return Math.abs(P-q)<=G*Math.max(1,Math.abs(P),Math.abs(q))&&Math.abs(W-C)<=G*Math.max(1,Math.abs(W),Math.abs(C))&&Math.abs(i-J)<=G*Math.max(1,Math.abs(i),Math.abs(J))};var G=P(12479)},12543:b=>{b.exports=function(b,d){return b[0]===d[0]&&b[1]===d[1]&&b[2]===d[2]}},12600:b=>{b.exports=function(b,d){return b[0]=Math.floor(d[0]),b[1]=Math.floor(d[1]),b[2]=Math.floor(d[2]),b}},12742:(b,d,P)=>{b.exports=function(b,d,P,W,i,q){var C,J;d||(d=3);P||(P=0);J=W?Math.min(W*d+P,b.length):b.length;for(C=P;C<J;C+=d)G[0]=b[C],G[1]=b[C+1],G[2]=b[C+2],i(G,G,q),b[C]=G[0],b[C+1]=G[1],b[C+2]=G[2];return b};var G=P(12485)()},12505:b=>{b.exports=function(b,d,P){var G=new Float32Array(3);return G[0]=b,G[1]=d,G[2]=P,G}},12470:(b,d,P)=>{b.exports={EPSILON:P(12479),create:P(12485),clone:P(12494),angle:P(12502),sC:P(12505),k:P(12524),set:P(12533),equals:P(12538),exactEquals:P(12543),add:P(12545),Rd:P(12553),sub:P(12561),multiply:P(12567),mul:P(12575),divide:P(12581),div:P(12583),min:P(12590),max:P(12596),floor:P(12600),ceil:P(12608),round:P(12614),scale:P(12620),EC:P(12623),distance:P(12629),i:P(12637),squaredDistance:P(12644),sqrDist:P(12649),length:P(12655),len:P(12659),squaredLength:P(12665),wC:P(12673),negate:P(12680),inverse:P(12687),normalize:P(12513),dot:P(12522),cross:P(12695),LC:P(12702),random:P(12709),transformMat4:P(12715),transformMat3:P(12717),transformQuat:P(12721),tC:P(12725),rC:P(12732),BC:P(12739),forEach:P(12742)}},12687:b=>{b.exports=function(b,d){return b[0]=1/d[0],b[1]=1/d[1],b[2]=1/d[2],b}},12659:(b,d,P)=>{b.exports=P(12655)},12655:b=>{b.exports=function(b){var d=b[0],P=b[1],G=b[2];return Math.sqrt(d*d+P*P+G*G)}},12702:b=>{b.exports=function(b,d,P,G){var W=d[0],i=d[1],q=d[2];return b[0]=W+G*(P[0]-W),b[1]=i+G*(P[1]-i),b[2]=q+G*(P[2]-q),b}},12596:b=>{b.exports=function(b,d,P){return b[0]=Math.max(d[0],P[0]),b[1]=Math.max(d[1],P[1]),b[2]=Math.max(d[2],P[2]),b}},12590:b=>{b.exports=function(b,d,P){return b[0]=Math.min(d[0],P[0]),b[1]=Math.min(d[1],P[1]),b[2]=Math.min(d[2],P[2]),b}},12575:(b,d,P)=>{b.exports=P(12567)},12567:b=>{b.exports=function(b,d,P){return b[0]=d[0]*P[0],b[1]=d[1]*P[1],b[2]=d[2]*P[2],b}},12680:b=>{b.exports=function(b,d){return b[0]=-d[0],b[1]=-d[1],b[2]=-d[2],b}},12513:b=>{b.exports=function(b,d){var P=d[0],G=d[1],W=d[2],i=P*P+G*G+W*W;i>0&&(i=1/Math.sqrt(i),b[0]=d[0]*i,b[1]=d[1]*i,b[2]=d[2]*i);return b}},12709:b=>{b.exports=function(b,d){d=d||1;var P=2*Math.random()*Math.PI,G=2*Math.random()-1,W=Math.sqrt(1-G*G)*d;return b[0]=Math.cos(P)*W,b[1]=Math.sin(P)*W,b[2]=G*d,b}},12725:b=>{b.exports=function(b,d,P,G){var W=P[1],i=P[2],q=d[1]-W,C=d[2]-i,J=Math.sin(G),L=Math.cos(G);return b[0]=d[0],b[1]=W+q*L-C*J,b[2]=i+q*J+C*L,b}},12732:b=>{b.exports=function(b,d,P,G){var W=P[0],i=P[2],q=d[0]-W,C=d[2]-i,J=Math.sin(G),L=Math.cos(G);return b[0]=W+C*J+q*L,b[1]=d[1],b[2]=i+C*L-q*J,b}},12739:b=>{b.exports=function(b,d,P,G){var W=P[0],i=P[1],q=d[0]-W,C=d[1]-i,J=Math.sin(G),L=Math.cos(G);return b[0]=W+q*L-C*J,b[1]=i+q*J+C*L,b[2]=d[2],b}},12614:b=>{b.exports=function(b,d){return b[0]=Math.round(d[0]),b[1]=Math.round(d[1]),b[2]=Math.round(d[2]),b}},12620:b=>{b.exports=function(b,d,P){return b[0]=d[0]*P,b[1]=d[1]*P,b[2]=d[2]*P,b}},12623:b=>{b.exports=function(b,d,P,G){return b[0]=d[0]+P[0]*G,b[1]=d[1]+P[1]*G,b[2]=d[2]+P[2]*G,b}},12533:b=>{b.exports=function(b,d,P,G){return b[0]=d,b[1]=P,b[2]=G,b}},12649:(b,d,P)=>{b.exports=P(12644)},12673:(b,d,P)=>{b.exports=P(12665)},12644:b=>{b.exports=function(b,d){var P=d[0]-b[0],G=d[1]-b[1],W=d[2]-b[2];return P*P+G*G+W*W}},12665:b=>{b.exports=function(b){var d=b[0],P=b[1],G=b[2];return d*d+P*P+G*G}},12561:(b,d,P)=>{b.exports=P(12553)},12553:b=>{b.exports=function(b,d,P){return b[0]=d[0]-P[0],b[1]=d[1]-P[1],b[2]=d[2]-P[2],b}},12717:b=>{b.exports=function(b,d,P){var G=d[0],W=d[1],i=d[2];return b[0]=G*P[0]+W*P[3]+i*P[6],b[1]=G*P[1]+W*P[4]+i*P[7],b[2]=G*P[2]+W*P[5]+i*P[8],b}},12715:b=>{b.exports=function(b,d,P){var G=d[0],W=d[1],i=d[2],q=P[3]*G+P[7]*W+P[11]*i+P[15];return q=q||1,b[0]=(P[0]*G+P[4]*W+P[8]*i+P[12])/q,b[1]=(P[1]*G+P[5]*W+P[9]*i+P[13])/q,b[2]=(P[2]*G+P[6]*W+P[10]*i+P[14])/q,b}},12721:b=>{b.exports=function(b,d,P){var G=d[0],W=d[1],i=d[2],q=P[0],C=P[1],J=P[2],L=P[3],x=L*G+C*i-J*W,Y=L*W+J*G-q*i,s=L*i+q*W-C*G,E=-q*G-C*W-J*i;return b[0]=x*L+E*-q+Y*-J-s*-C,b[1]=Y*L+E*-C+s*-q-x*-J,b[2]=s*L+E*-J+x*-C-Y*-q,b}},13583:b=>{"use strict";b.exports=function(b){for(var d=new Array(b),P=0;P<b;++P)d[P]=P;return d}},13644:b=>{b.exports=function(b){return null!=b&&null!=b.constructor&&"function"===typeof b.constructor.isBuffer&&b.constructor.isBuffer(b)}},13866:(b,d,P)=>{"use strict";P.d(d,{b:()=>G});class G{constructor(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Ox=!1,this.Vx=!1,this.Nx=30,this.jx=0,this.Fx=!1,this.fullscreen=!1,this.Dx=function(b){},this.zx=function(){},this.mx=function(){},this.xd=function(){},this.Qx=function(b){},this.onFullscreenChanged=function(b){},L((()=>{!function(b,d){b._nowObject=performance||Date,b._lastTick=0,b._renderAccum=0,b._rt=0,b._frameCB=C.bind(null,b),requestAnimationFrame(b._frameCB),d>0&&(b._intervalCB=q.bind(null,b),b._interval=setInterval(b._intervalCB,Math.max(d,1e3/b.Nx/2)))}(this,d),function(b,d){if(!d)return;var P=!1,G=!1;document.addEventListener("pointerlockchange",(G=>{P=document.pointerLockElement===d,b.Qx(P)})),document.addEventListener("fullscreenchange",(P=>{G=document.fullscreenElement===d,b.onFullscreenChanged(G)})),Object.defineProperty(b,"Fx",{get:()=>P,set:b=>{b&&!P?J(d):P&&!b&&function(b){b.exitPointerLock&&b.exitPointerLock()}(document)}}),Object.defineProperty(b,"fullscreen",{get:()=>G,set:b=>{b&&!G?d.requestFullscreen():G&&!b&&document.exitFullscreen()}}),d.addEventListener("click",(W=>{b.Ox&&!P&&J(d),b.Vx&&!G&&d.requestFullscreen()}));var W=()=>b.xd();if(window.ResizeObserver){new ResizeObserver(W).observe(d)}else window.addEventListener("resize",W)}(this,b),this.mx()}))}}var W=3,i=20;function q(b){for(var d=1e3/b.Nx,P=b._nowObject.now()+i,G=0;b._nowObject.now()>=b._lastTick+d&&b._nowObject.now()<P&&++G<=W;)b.Dx(d),b._lastTick+=d;var q=5*(d+5),C=b._nowObject.now();if(C-b._lastTick>q)for(;C>=b._lastTick+d;)b._lastTick+=d}function C(b){requestAnimationFrame(b._frameCB),q(b);var d=b._nowObject.now(),P=d-b._rt;if(b._rt=d,b.jx>0){b._renderAccum+=P;var G=1e3/b.jx;if(b._renderAccum<G)return;b._renderAccum=Math.min(b._renderAccum-G,G)}var W=1e3/b.Nx,i=(d-b._lastTick)/W;b.zx(P,i,W)}function J(b){b.requestPointerLock&&b.requestPointerLock()}var L=b=>{if("loading"===document.readyState){var d=()=>{document.removeEventListener("readystatechange",d),b()};document.addEventListener("readystatechange",d)}else setTimeout(b,1)}},13580:(b,d,P)=>{var G=P(13583),W=P(13591),i="undefined"!==typeof Float64Array;function q(b,d){return b[0]-d[0]}function C(){var b,d=this.stride,P=new Array(d.length);for(b=0;b<P.length;++b)P[b]=[Math.abs(d[b]),b];P.sort(q);var G=new Array(P.length);for(b=0;b<G.length;++b)G[b]=P[b][1];return G}function J(b,d){var P=["View",d,"d",b].join("");d<0&&(P="View_Nil"+b);var W="generic"===b;if(-1===d){var i="function "+P+"(a){this.data=a;};var proto="+P+".prototype;proto.dtype='"+b+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+P+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+P+"(a){return new "+P+"(a);}";return new Function(i)()}if(0===d){i="function "+P+"(a,d) {this.data = a;this.offset = d};var proto="+P+".prototype;proto.dtype='"+b+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+P+"_copy() {return new "+P+"(this.data,this.offset)};proto.pick=function "+P+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+P+"_get(){return "+(W?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+P+"_set(v){return "+(W?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+P+"(a,b,c,d){return new "+P+"(a,d)}";return new Function("TrivialArray",i)(L[b][0])}i=["'use strict'"];var q=G(d),J=q.map((function(b){return"i"+b})),x="this.offset+"+q.map((function(b){return"this.stride["+b+"]*i"+b})).join("+"),Y=q.map((function(b){return"b"+b})).join(","),s=q.map((function(b){return"c"+b})).join(",");i.push("function "+P+"(a,"+Y+","+s+",d){this.data=a","this.shape=["+Y+"]","this.stride=["+s+"]","this.offset=d|0}","var proto="+P+".prototype","proto.dtype='"+b+"'","proto.dimension="+d),i.push("Object.defineProperty(proto,'size',{get:function "+P+"_size(){return "+q.map((function(b){return"this.shape["+b+"]"})).join("*"),"}})"),1===d?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),d<4?(i.push("function "+P+"_order(){"),2===d?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===d&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+P+"_set("+J.join(",")+",v){"),W?i.push("return this.data.set("+x+",v)}"):i.push("return this.data["+x+"]=v}"),i.push("proto.get=function "+P+"_get("+J.join(",")+"){"),W?i.push("return this.data.get("+x+")}"):i.push("return this.data["+x+"]}"),i.push("proto.index=function "+P+"_index(",J.join(),"){return "+x+"}"),i.push("proto.hi=function "+P+"_hi("+J.join(",")+"){return new "+P+"(this.data,"+q.map((function(b){return["(typeof i",b,"!=='number'||i",b,"<0)?this.shape[",b,"]:i",b,"|0"].join("")})).join(",")+","+q.map((function(b){return"this.stride["+b+"]"})).join(",")+",this.offset)}");var E=q.map((function(b){return"a"+b+"=this.shape["+b+"]"})),w=q.map((function(b){return"c"+b+"=this.stride["+b+"]"}));i.push("proto.lo=function "+P+"_lo("+J.join(",")+"){var b=this.offset,d=0,"+E.join(",")+","+w.join(","));for(var t=0;t<d;++t)i.push("if(typeof i"+t+"==='number'&&i"+t+">=0){d=i"+t+"|0;b+=c"+t+"*d;a"+t+"-=d}");i.push("return new "+P+"(this.data,"+q.map((function(b){return"a"+b})).join(",")+","+q.map((function(b){return"c"+b})).join(",")+",b)}"),i.push("proto.step=function "+P+"_step("+J.join(",")+"){var "+q.map((function(b){return"a"+b+"=this.shape["+b+"]"})).join(",")+","+q.map((function(b){return"b"+b+"=this.stride["+b+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(t=0;t<d;++t)i.push("if(typeof i"+t+"==='number'){d=i"+t+"|0;if(d<0){c+=b"+t+"*(a"+t+"-1);a"+t+"=ceil(-a"+t+"/d)}else{a"+t+"=ceil(a"+t+"/d)}b"+t+"*=d}");i.push("return new "+P+"(this.data,"+q.map((function(b){return"a"+b})).join(",")+","+q.map((function(b){return"b"+b})).join(",")+",c)}");var r=new Array(d),B=new Array(d);for(t=0;t<d;++t)r[t]="a[i"+t+"]",B[t]="b[i"+t+"]";i.push("proto.transpose=function "+P+"_transpose("+J+"){"+J.map((function(b,d){return b+"=("+b+"===undefined?"+d+":"+b+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+P+"(this.data,"+r.join(",")+","+B.join(",")+",this.offset)}"),i.push("proto.pick=function "+P+"_pick("+J+"){var a=[],b=[],c=this.offset");for(t=0;t<d;++t)i.push("if(typeof i"+t+"==='number'&&i"+t+">=0){c=(c+this.stride["+t+"]*i"+t+")|0}else{a.push(this.shape["+t+"]);b.push(this.stride["+t+"])}");return i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+P+"(data,shape,stride,offset){return new "+P+"(data,"+q.map((function(b){return"shape["+b+"]"})).join(",")+","+q.map((function(b){return"stride["+b+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",i.join("\n"))(L[b],C)}var L={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};b.exports=function(b,d,P,G){if(void 0===b)return(0,L.array[0])([]);"number"===typeof b&&(b=[b]),void 0===d&&(d=[b.length]);var q=d.length;if(void 0===P){P=new Array(q);for(var C=q-1,x=1;C>=0;--C)P[C]=x,x*=d[C]}if(void 0===G){G=0;for(C=0;C<q;++C)P[C]<0&&(G-=(d[C]-1)*P[C])}for(var Y=function(b){if(W(b))return"buffer";if(i)switch(Object.prototype.toString.call(b)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(b)?"array":"generic"}(b),s=L[Y];s.length<=q+1;)s.push(J(Y,s.length-1));return(0,s[q+1])(b,d,P,G)}},13591:b=>{function d(b){return!!b.constructor&&"function"===typeof b.constructor.isBuffer&&b.constructor.isBuffer(b)}b.exports=function(b){return null!=b&&(d(b)||function(b){return"function"===typeof b.readFloatLE&&"function"===typeof b.slice&&d(b.slice(0,0))}(b)||!!b._isBuffer)}},13725:b=>{"use strict";var d=[],P=[],G=[],W=[],i=[],q=[],C=[],J=[],L=[],x=[],Y=[],s=[];b.exports=function(b,E,w,t,r,B){for(var n=C,Z=L,o=x,A=s,f=0;f<3;f++)n[f]=+w[f],o[f]=+E.max[f],Z[f]=+E.base[f];B||(B=1e-10);var g=function(b,C,L,x,s,E){var w=d,t=P,r=G,B=W,n=i,Z=q,o=J,A=Math.floor,f=0,g=0,X=0,u=0,M=0;if(e(),0===X)return 0;for(u=H();g<=X;){if(R(u)&&U())return f;u=H()}for(f+=X,M=0;M<3;M++)x[M]+=L[M],s[M]+=L[M];return f;function e(){if(g=0,0!==(X=Math.sqrt(L[0]*L[0]+L[1]*L[1]+L[2]*L[2])))for(var b=0;b<3;b++){var d=L[b]>=0;B[b]=d?1:-1;var P=d?s[b]:x[b];w[b]=d?x[b]:s[b],t[b]=p(P,B[b]),r[b]=S(w[b],B[b]),o[b]=L[b]/X,n[b]=Math.abs(1/o[b]);var G=d?t[b]+1-P:P-t[b];Z[b]=n[b]<1/0?n[b]*G:1/0}}function R(d){for(var P=B[0],G=0===d?t[0]:r[0],W=t[0]+P,i=B[1],q=1===d?t[1]:r[1],C=t[1]+i,J=B[2],L=2===d?t[2]:r[2],x=t[2]+J,Y=G;Y!=W;Y+=P)for(var s=q;s!=C;s+=i)for(var E=L;E!=x;E+=J)if(b(Y,s,E))return!0;return!1}function U(){f+=g;var b=B[u],d=g/X,P=Y;for(M=0;M<3;M++){var G=L[M]*d;x[M]+=G,s[M]+=G,P[M]=L[M]-G}if(b>0?s[u]=Math.round(s[u]):x[u]=Math.round(x[u]),C(f,u,b,P))return!0;for(M=0;M<3;M++)L[M]=P[M];return e(),0===X}function H(){var b=Z[0]<Z[1]?Z[0]<Z[2]?0:2:Z[1]<Z[2]?1:2,d=Z[b]-g;for(g=Z[b],t[b]+=B[b],Z[b]+=n[b],M=0;M<3;M++)w[M]+=d*o[M],r[M]=S(w[M],B[M]);return b}function p(b,d){return A(b-d*E)}function S(b,d){return A(b+d*E)}}(b,t,n,Z,o,B);if(!r){for(f=0;f<3;f++)A[f]=w[f]>0?o[f]-E.max[f]:Z[f]-E.base[f];E.translate(A)}return g}},13892:(b,d,P)=>{"use strict";P.d(d,{b:()=>Y});var G=P(13721),W=P(12470);class i{constructor(b,d,P,i,q,C,J){this.RL=new G(b.base,b.IL),this.xi=d,this.friction=P,this.restitution=i,this.PC=q,this.BE=C,this.GC=!!J,this.QL=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Ww=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.WL=W.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=W.create(),this._impulses=W.create(),this._sleepFrameCount=10}loadFromCopy(b){W.k(this.RL.base,b.RL.base),W.k(this.RL.IL,b.RL.IL),W.k(this.RL.max,b.RL.max),this.RL.mag=b.RL.mag,this.xi=b.xi,this.friction=b.friction,this.restitution=b.restitution,this.PC=b.PC,this.BE=b.BE,this.GC=b.GC,this.QL=b.QL,this.fluidDrag=b.fluidDrag,this.Ww=b.Ww,this.preventFallOffEdge=b.preventFallOffEdge,this.rolledBackLastTick=b.rolledBackLastTick,W.k(this.WL,b.WL),W.k(this.resting,b.resting),this.inFluid=b.inFluid,this._ratioInFluid=b._ratioInFluid,W.k(this._forces,b._forces),W.k(this._impulses,b._impulses),this._sleepFrameCount=b._sleepFrameCount}setPosition(b){q(b),W.Rd(b,b,this.RL.base),this.RL.translate(b),this.CL()}sd(){return W.clone(this.RL.base)}applyForce(b){q(b),W.add(this._forces,this._forces,b),this.CL()}applyImpulse(b){q(b),W.add(this._impulses,this._impulses,b),this.CL()}CL(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var q=b=>{};var C=P(13721),J=P(12470),L=P(13725);function x(){this.QL=.1,this.fluidDrag=.4,this.JC=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function Y(b,d,P){b=Object.assign(new x,b),this.gravity=b.gravity||[0,-10,0],this.QL=b.QL||.1,this.JC=b.JC||2,this.fluidDrag=b.fluidDrag||.4,this.minBounceImpulse=b.minBounceImpulse,this.bodies=[],this.Vs=b.Vs,this.testSolid=d,this.testFluid=P}Y.prototype.XE=function(b,d,P,G,W,q){b=b||new C([0,0,0],[1,1,1]),"undefined"==typeof d&&(d=1),"undefined"==typeof P&&(P=1),"undefined"==typeof G&&(G=0),"undefined"==typeof W&&(W=1);var J=new i(b,d,P,G,W,q);return this.bodies.push(J),J},Y.prototype.uE=function(b){var d=this.bodies.indexOf(b);d<0||(this.bodies.splice(d,1),b.RL=b.BE=null)};var s=J.create(),E=J.create(),w=J.create(),t=J.create(),r=J.create(),B=J.create(),n=J.create(),Z=new C([0,0,0],[1,1,1]),o=new i(Z,1,1,0,1,(()=>{}),!1);function A(b,d,P){return d=P,d*=1-(1-b.ratioInFluid)**2}Y.prototype.AC=function(b){b/=1e3;var d=O(0,J.squaredLength(this.gravity));this.bodies.forEach((P=>function(b,d,P,G){J.k(r,d.resting),b.Vs&&o.loadFromCopy(d);if(d.xi<=0)return J.set(d.WL,0,0,0),J.set(d._forces,0,0,0),void J.set(d._impulses,0,0,0);var W=G||0===d.PC;if(function(b,d,P,G){if(d._sleepFrameCount>0)return!1;if(G)return!0;var W=!1,i=.5*P*P*d.PC;return J.scale(a,b.gravity,i),L(b.testSolid,d.RL,a,(function(){return W=!0,!0}),!0),W}(b,d,P,W))return;d._sleepFrameCount--,function(b,d){var P=d.RL,G=Math.floor(P.base[0]),W=Math.floor(P.base[2]),i=Math.floor(P.base[1]),q=Math.floor(P.max[1]);if(!b.testFluid(G,i,W))return d.inFluid=!1,void(d.ratioInFluid=0);var C=1,L=i+1;for(;L<=q&&b.testFluid(G,L,W);)C++,L++;var x=(i+C-P.base[1])/P.IL[1];x>1&&(x=1);var Y=P.IL[0]*P.IL[1]*P.IL[2]*x,s=g;J.scale(s,b.gravity,-b.JC*Y*d.PC),d.applyForce(s),d.inFluid=!0,d.ratioInFluid=x}(b,d),y(d._forces),y(d._impulses),y(d.WL),y(d.resting),J.scale(s,d._forces,1/d.xi),J.EC(s,s,b.gravity,d.PC),J.scale(E,d._impulses,1/d.xi),J.EC(E,E,s,P),J.add(d.WL,d.WL,E),d.friction&&(X(b,0,d,E,P),X(b,1,d,E,P),X(b,2,d,E,P));var i=d.fluidDrag>=0?d.fluidDrag:b.fluidDrag,q=d.QL>=0?d.QL:b.QL,C=q,x=q;d.inFluid&&(C=A(d,C,d.fluidDragHoriz>=0?d.fluidDragHoriz:i),x=A(d,x,d.fluidDragVert>=0?d.fluidDragVert:i));C=Math.max(1-C*P/d.xi,0),x=Math.max(1-x*P/d.xi,0),J.set(f,C,x,C),J.multiply(d.WL,d.WL,f),J.scale(w,d.WL,P),J.set(d._forces,0,0,0),J.set(d._impulses,0,0,0),d.GC&&V(e,d.RL);J.k(B,w),J.set(n,0,0,0),d.preventFallOffEdge&&function(b,d,P,G){if(!d.resting[1]||P[1]>0)return;var W=l;V(W,d.RL);for(var i=0;i<3;i+=2){J.set(S,0,0,0),S[i]=P[i];var q=!0;(q=(q=(q=(q=q&&!j(b,W.base[0]+S[0]+1e-5,W.base[1],W.base[2]+S[2]+1e-5))&&!j(b,W.max[0]+S[0]-1e-5,W.base[1],W.base[2]+S[2]+1e-5))&&!j(b,W.base[0]+S[0]+1e-5,W.base[1],W.max[2]+S[2]-1e-5))&&!j(b,W.max[0]+S[0]-1e-5,W.base[1],W.max[2]+S[2]-1e-5))?(G[i]=P[i]>0?1:-1,P[i]=0):0===i&&(J.set(N,P[0],0,0),M(b,W,N,G,d.slideOnCollision))}}(b,d,w,n);M(b,d.RL,w,d.resting,d.slideOnCollision),d.GC&&function(b,d,P,G){if(d.resting[1]>=0&&!d.inFluid)return;var W=0!==d.resting[0],i=0!==d.resting[2];if(!W&&!i)return;var q=Math.abs(G[0]/G[2]),C=4;if(!W&&q>C)return;if(!i&&q<1/C)return;J.add(U,P.base,G);var x=b.testSolid;L(x,P,G,(function(b,d,P,G){if(1!==d)return!0;G[d]=0}));var Y=P.base[1],s=d.inFluid?1.951:1.001,E=Math.floor(Y+s)-Y;J.set(H,0,E,0);var w=!1;if(L(x,P,H,(function(b,d,P,G){return w=!0,!0})),w)return;J.Rd(p,U,P.base),p[1]=0,M(b,P,p,R,!0);var t=O(P.base[0],U[0]),r=O(P.base[2],U[2]);if(W&&!t&&(!r||!i))return;if(i&&(!t||!W)&&!r)return;var B=!0;if(B=B&&!j(b,P.base[0]+1e-5,P.base[1],P.base[2]+1e-5),B=B&&!j(b,P.max[0]-1e-5,P.base[1],P.base[2]+1e-5),B=B&&!j(b,P.base[0]+1e-5,P.base[1],P.max[2]-1e-5),B=B&&!j(b,P.max[0]-1e-5,P.base[1],P.max[2]-1e-5),B)return;V(d.RL,P),d.resting[0]=R[0],d.resting[2]=R[2],d.Ww&&d.Ww()}(b,d,e,B);for(var Y=0;Y<3;++Y)d.resting[Y]=d.resting[Y]||n[Y],t[Y]=0,d.resting[Y]&&(r[Y]||(t[Y]=-d.WL[Y]),d.WL[Y]=0);var Z=J.length(t);Z>.001&&(J.scale(t,t,d.xi),d.BE&&d.BE(t),d.restitution>0&&Z>b.minBounceImpulse&&(J.scale(t,t,d.restitution),d.applyImpulse(t)));var u=J.squaredLength(d.WL);u>1e-5&&d.CL();b.Vs&&b.Vs(d)?(d.loadFromCopy(o),d.rolledBackLastTick=!0):d.rolledBackLastTick=!1}(this,P,b,d)))};var f=J.create([0,0,0]);var g=J.create();function X(b,d,P,G,W){var i=P.resting[d],q=G[d];if(!P.alwaysApplyHorizFriction||1!==d){if(0===i)return;if(i*q<=0)return}J.k(u,P.WL),u[d]=0;var C=J.length(u);if(!O(C,0)){var L=Math.abs(P.friction*b.gravity[d]*W),x=C>L?(C-L)/C:0;P.WL[(d+1)%3]*=x,P.WL[(d+2)%3]*=x}}var u=J.create();function M(b,d,P,G,W){return J.set(G,0,0,0),L(b.testSolid,d,P,(function(b,d,P,i){G[d]=P,i[d]=0,W||(i[0]=0,i[1]=0,i[2]=0)}))}var e=new C([],[]),R=J.create(),U=J.create(),H=J.create(),p=J.create();var S=J.create(),l=new C([],[]),N=J.create();function j(b,d,P,G){return b.testSolid(Math.floor(d),Math.floor(P-1),Math.floor(G))}var a=J.create();function O(b,d){return Math.abs(b-d)<1e-5}function V(b,d){for(var P=0;P<3;P++)b.base[P]=d.base[P],b.max[P]=d.max[P],b.IL[P]=d.IL[P]}var y=function(b){}},12356:function(b,d){!function(b){"use strict";var d=function(b,P){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,d){b.__proto__=d}||function(b,d){for(var P in d)Object.prototype.hasOwnProperty.call(d,P)&&(b[P]=d[P])},d(b,P)};function P(b,P){if("function"!==typeof P&&null!==P)throw new TypeError("Class extends value "+String(P)+" is not a constructor or null");function G(){this.constructor=b}d(b,P),b.prototype=null===P?Object.create(P):(G.prototype=P.prototype,new G)}function G(b,d,P,G){var W,i=arguments.length,q=i<3?d:null===G?G=Object.getOwnPropertyDescriptor(d,P):G;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)q=Reflect.decorate(b,d,P,G);else for(var C=b.length-1;C>=0;C--)(W=b[C])&&(q=(i<3?W(q):i>3?W(d,P,q):W(d,P))||q);return i>3&&q&&Object.defineProperty(d,P,q),q}function W(b,d,P){if(P||2===arguments.length)for(var G,W=0,i=d.length;W<i;W++)!G&&W in d||(G||(G=Array.prototype.slice.call(d,0,W)),G[W]=d[W]);return b.concat(G||Array.prototype.slice.call(d))}var i,q=255,C=213;b.OPERATION=void 0,(i=b.OPERATION||(b.OPERATION={}))[i.ADD=128]="ADD",i[i.REPLACE=0]="REPLACE",i[i.DELETE=64]="DELETE",i[i.DELETE_AND_ADD=192]="DELETE_AND_ADD",i[i.TOUCH=1]="TOUCH",i[i.CLEAR=10]="CLEAR";var J=function(){function d(b,d,P){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=b,this.setParent(d,P)}return d.prototype.setParent=function(b,d,P){var G=this;if(this.indexes||(this.indexes=this.ref instanceof pb?this.ref._definition.indexes:{}),this.parent=b,this.parentIndex=P,d)if(this.root=d,this.ref instanceof pb){var W=this.ref._definition;for(var i in W.schema){var q=this.ref[i];if(q&&q.$changes){var C=W.indexes[i];q.$changes.setParent(this.ref,d,C)}}}else"object"===typeof this.ref&&this.ref.forEach((function(b,d){if(b instanceof pb){var P=b.$changes,W=G.ref.$changes.indexes[d];P.setParent(G.ref,G.root,W)}}))},d.prototype.operation=function(b){this.changes.set(--this.currentCustomOperation,b)},d.prototype.change=function(d,P){void 0===P&&(P=b.OPERATION.ADD);var G="number"===typeof d?d:this.indexes[d];this.assertValidIndex(G,d);var W=this.changes.get(G);W&&W.op!==b.OPERATION.DELETE&&W.op!==b.OPERATION.TOUCH||this.changes.set(G,{op:W&&W.op===b.OPERATION.DELETE?b.OPERATION.DELETE_AND_ADD:P,index:G}),this.allChanges.add(G),this.changed=!0,this.touchParents()},d.prototype.touch=function(d){var P="number"===typeof d?d:this.indexes[d];this.assertValidIndex(P,d),this.changes.has(P)||this.changes.set(P,{op:b.OPERATION.TOUCH,index:P}),this.allChanges.add(P),this.touchParents()},d.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},d.prototype.getType=function(b){if(this.ref._definition)return(d=this.ref._definition).schema[d.fieldsByIndex[b]];var d,P=(d=this.parent._definition).schema[d.fieldsByIndex[this.parentIndex]];return Object.values(P)[0]},d.prototype.getChildrenFilter=function(){var b=this.parent._definition.childFilters;return b&&b[this.parentIndex]},d.prototype.getValue=function(b){return this.ref.getByIndex(b)},d.prototype.delete=function(d){var P="number"===typeof d?d:this.indexes[d];if(void 0!==P){var G=this.getValue(P);this.changes.set(P,{op:b.OPERATION.DELETE,index:P}),this.allChanges.delete(P),delete this.caches[P],G&&G.$changes&&(G.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(d," (").concat(P,")"))},d.prototype.discard=function(d,P){var G=this;void 0===d&&(d=!1),void 0===P&&(P=!1),this.ref instanceof pb||this.changes.forEach((function(d){if(d.op===b.OPERATION.DELETE){var P=G.ref.getIndex(d.index);delete G.indexes[P]}})),this.changes.clear(),this.changed=d,P&&this.allChanges.clear(),this.currentCustomOperation=0},d.prototype.discardAll=function(){var b=this;this.changes.forEach((function(d){var P=b.getValue(d.index);P&&P.$changes&&P.$changes.discardAll()})),this.discard()},d.prototype.cache=function(b,d){this.caches[b]=d},d.prototype.clone=function(){return new d(this.ref,this.parent,this.root)},d.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},d.prototype.assertValidIndex=function(b,d){if(void 0===b)throw new Error('ChangeTree: missing index for field "'.concat(d,'"'))},d}();function L(b,d,P,G){return b[d]||(b[d]=[]),b[d].push(P),null===G||void 0===G||G.forEach((function(b,d){return P(b,d)})),function(){return Y(b[d],b[d].indexOf(P))}}function x(d){var P=this,G="string"!==typeof this.$changes.getType();this.$items.forEach((function(W,i){d.push({refId:P.$changes.refId,op:b.OPERATION.DELETE,field:i,value:void 0,previousValue:W}),G&&P.$changes.root.removeRef(W.$changes.refId)}))}function Y(b,d){if(-1===d||d>=b.length)return!1;for(var P=b.length-1,G=d;G<P;G++)b[G]=b[G+1];return b.length=P,!0}var s=function(b,d){var P=b.toString(),G=d.toString();return P<G?-1:P>G?1:0};function E(b){return b.$proxy=!0,b=new Proxy(b,{get:function(b,d){return"symbol"===typeof d||isNaN(d)?b[d]:b.at(d)},set:function(b,d,P){if("symbol"===typeof d||isNaN(d))b[d]=P;else{var G=Array.from(b.$items.keys()),W=parseInt(G[d]||d);void 0===P||null===P?b.deleteAt(W):b.setAt(W,P)}return!0},deleteProperty:function(b,d){return"number"===typeof d?b.deleteAt(d):delete b[d],!0}})}var w=function(){function d(){for(var b=[],d=0;d<arguments.length;d++)b[d]=arguments[d];this.$changes=new J(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,b)}return d.prototype.UC=function(d,P){return void 0===P&&(P=!0),L(this.$callbacks||(this.$callbacks=[]),b.OPERATION.ADD,d,P?this.$items:void 0)},d.prototype.Ld=function(d){return L(this.$callbacks||(this.$callbacks=[]),b.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return L(this.$callbacks||(this.$callbacks=[]),b.OPERATION.REPLACE,d)},d.is=function(b){return Array.isArray(b)||void 0!==b.array},Object.defineProperty(d.prototype,"length",{get:function(){return this.$items.size},set:function(b){0===b?this.clear():this.splice(b,this.length-b)},enumerable:!1,configurable:!0}),d.prototype.push=function(){for(var b,d=this,P=[],G=0;G<arguments.length;G++)P[G]=arguments[G];return P.forEach((function(P){b=d.$refId++,d.setAt(b,P)})),b},d.prototype.pop=function(){var b=Array.from(this.$indexes.values()).pop();if(void 0!==b){this.$changes.delete(b),this.$indexes.delete(b);var d=this.$items.get(b);return this.$items.delete(b),d}},d.prototype.at=function(b){var d=Array.from(this.$items.keys())[b];return this.$items.get(d)},d.prototype.setAt=function(d,P){var G,W;if(void 0!==P&&null!==P){if(this.$items.get(d)!==P){void 0!==P.$changes&&P.$changes.setParent(this,this.$changes.root,d);var i=null!==(W=null===(G=this.$changes.indexes[d])||void 0===G?void 0:G.op)&&void 0!==W?W:b.OPERATION.ADD;this.$changes.indexes[d]=d,this.$indexes.set(d,d),this.$items.set(d,P),this.$changes.change(d,i)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},d.prototype.deleteAt=function(b){var d=Array.from(this.$items.keys())[b];return void 0!==d&&this.$deleteAt(d)},d.prototype.$deleteAt=function(b){return this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b)},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&x.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:b.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.concat=function(){for(var b,P=[],G=0;G<arguments.length;G++)P[G]=arguments[G];return new(d.bind.apply(d,W([void 0],(b=Array.from(this.$items.values())).concat.apply(b,P),!1)))},d.prototype.join=function(b){return Array.from(this.$items.values()).join(b)},d.prototype.reverse=function(){var b=this,d=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(P,G){b.setAt(d[G],P)})),this},d.prototype.shift=function(){var b=Array.from(this.$items.keys()).shift();if(void 0!==b){var d=this.$items.get(b);return this.$deleteAt(b),d}},d.prototype.slice=function(b,P){var G=new d;return G.push.apply(G,Array.from(this.$items.values()).slice(b,P)),G},d.prototype.sort=function(b){var d=this;void 0===b&&(b=s);var P=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(b).forEach((function(b,G){d.setAt(P[G],b)})),this},d.prototype.splice=function(b,d){void 0===d&&(d=this.length-b);for(var P=Array.from(this.$items.keys()),G=[],W=b;W<b+d;W++)G.push(this.$items.get(P[W])),this.$deleteAt(P[W]);return G},d.prototype.unshift=function(){for(var b=this,d=[],P=0;P<arguments.length;P++)d[P]=arguments[P];var G=this.length,W=d.length,i=Array.from(this.$items.values());return d.forEach((function(d,P){b.setAt(P,d)})),i.forEach((function(d,P){b.setAt(W+P,d)})),G+W},d.prototype.indexOf=function(b,d){return Array.from(this.$items.values()).indexOf(b,d)},d.prototype.lastIndexOf=function(b,d){return void 0===d&&(d=this.length-1),Array.from(this.$items.values()).lastIndexOf(b,d)},d.prototype.every=function(b,d){return Array.from(this.$items.values()).every(b,d)},d.prototype.some=function(b,d){return Array.from(this.$items.values()).some(b,d)},d.prototype.forEach=function(b,d){Array.from(this.$items.values()).forEach(b,d)},d.prototype.map=function(b,d){return Array.from(this.$items.values()).map(b,d)},d.prototype.filter=function(b,d){return Array.from(this.$items.values()).filter(b,d)},d.prototype.reduce=function(b,d){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},d.prototype.reduceRight=function(b,d){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},d.prototype.find=function(b,d){return Array.from(this.$items.values()).find(b,d)},d.prototype.findIndex=function(b,d){return Array.from(this.$items.values()).findIndex(b,d)},d.prototype.fill=function(b,d,P){throw new Error("ArraySchema#fill() not implemented")},d.prototype.copyWithin=function(b,d,P){throw new Error("ArraySchema#copyWithin() not implemented")},d.prototype.toString=function(){return this.$items.toString()},d.prototype.toLocaleString=function(){return this.$items.toLocaleString()},d.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(d,Symbol.species,{get:function(){return d},enumerable:!1,configurable:!0}),d.prototype.entries=function(){return this.$items.entries()},d.prototype.keys=function(){return this.$items.keys()},d.prototype.values=function(){return this.$items.values()},d.prototype.includes=function(b,d){return Array.from(this.$items.values()).includes(b,d)},d.prototype.flatMap=function(b,d){throw new Error("ArraySchema#flatMap() is not supported.")},d.prototype.flat=function(b){throw new Error("ArraySchema#flat() is not supported.")},d.prototype.findLast=function(){var b=Array.from(this.$items.values());return b.findLast.apply(b,arguments)},d.prototype.findLastIndex=function(){var b=Array.from(this.$items.values());return b.findLastIndex.apply(b,arguments)},d.prototype.setIndex=function(b,d){this.$indexes.set(b,d)},d.prototype.getIndex=function(b){return this.$indexes.get(b)},d.prototype.getByIndex=function(b){return this.$items.get(this.$indexes.get(b))},d.prototype.deleteByIndex=function(b){var d=this.$indexes.get(b);this.$items.delete(d),this.$indexes.delete(b)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){return this.toArray().map((function(b){return"function"===typeof b.toJSON?b.toJSON():b}))},d.prototype.clone=function(b){return b?new(d.bind.apply(d,W([void 0],Array.from(this.$items.values()),!1))):new(d.bind.apply(d,W([void 0],this.map((function(b){return b.$changes?b.clone():b})),!1)))},d}();function t(b){return b.$proxy=!0,b=new Proxy(b,{get:function(b,d){return"symbol"!==typeof d&&"undefined"===typeof b[d]?b.get(d):b[d]},set:function(b,d,P){return"symbol"!==typeof d&&-1===d.indexOf("$")&&"UC"!==d&&"Ld"!==d&&"onChange"!==d?b.set(d,P):b[d]=P,!0},deleteProperty:function(b,d){return b.delete(d),!0}})}var r=function(){function d(b){var P=this;if(this.$changes=new J(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,b)if(b instanceof Map||b instanceof d)b.forEach((function(b,d){return P.set(d,b)}));else for(var G in b)this.set(G,b[G])}return d.prototype.UC=function(d,P){return void 0===P&&(P=!0),L(this.$callbacks||(this.$callbacks=[]),b.OPERATION.ADD,d,P?this.$items:void 0)},d.prototype.Ld=function(d){return L(this.$callbacks||(this.$callbacks=[]),b.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return L(this.$callbacks||(this.$callbacks=[]),b.OPERATION.REPLACE,d)},d.is=function(b){return void 0!==b.map},d.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(d.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(d,Symbol.species,{get:function(){return d},enumerable:!1,configurable:!0}),d.prototype.set=function(d,P){if(void 0===P||null===P)throw new Error("MapSchema#set('".concat(d,"', ").concat(P,"): trying to set ").concat(P," value on '").concat(d,"'."));d=d.toString();var G="undefined"!==typeof this.$changes.indexes[d],W=G?this.$changes.indexes[d]:this.$refId++,i=G?b.OPERATION.REPLACE:b.OPERATION.ADD,q=void 0!==P.$changes;if(q&&P.$changes.setParent(this,this.$changes.root,W),G){if(!q&&this.$items.get(d)===P)return;q&&this.$items.get(d)!==P&&(i=b.OPERATION.ADD)}else this.$changes.indexes[d]=W,this.$indexes.set(W,d);return this.$items.set(d,P),this.$changes.change(d,i),this},d.prototype.get=function(b){return this.$items.get(b)},d.prototype.delete=function(b){return this.$changes.delete(b),this.$items.delete(b)},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&x.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:b.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(b){return this.$items.has(b)},d.prototype.forEach=function(b){this.$items.forEach(b)},d.prototype.entries=function(){return this.$items.entries()},d.prototype.keys=function(){return this.$items.keys()},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(b,d){this.$indexes.set(b,d)},d.prototype.getIndex=function(b){return this.$indexes.get(b)},d.prototype.getByIndex=function(b){return this.$items.get(this.$indexes.get(b))},d.prototype.deleteByIndex=function(b){var d=this.$indexes.get(b);this.$items.delete(d),this.$indexes.delete(b)},d.prototype.toJSON=function(){var b={};return this.forEach((function(d,P){b[P]="function"===typeof d.toJSON?d.toJSON():d})),b},d.prototype.clone=function(b){var P;return b?P=Object.assign(new d,this):(P=new d,this.forEach((function(b,d){b.$changes?P.set(d,b.clone()):P.set(d,b)}))),P},d}(),B={};function n(b,d){B[b]=d}function Z(b){return B[b]}var o=function(){function b(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return b.create=function(d){var P=new b;return P.schema=Object.assign({},d&&d.schema||{}),P.indexes=Object.assign({},d&&d.indexes||{}),P.fieldsByIndex=Object.assign({},d&&d.fieldsByIndex||{}),P.descriptors=Object.assign({},d&&d.descriptors||{}),P.deprecated=Object.assign({},d&&d.deprecated||{}),P},b.prototype.addField=function(b,d){var P=this.getNextFieldIndex();this.fieldsByIndex[P]=b,this.indexes[b]=P,this.schema[b]=Array.isArray(d)?{array:d[0]}:d},b.prototype.hasField=function(b){return void 0!==this.indexes[b]},b.prototype.addFilter=function(b,d){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[b]]=d,this.indexesWithFilters.push(this.indexes[b]),!0},b.prototype.addChildrenFilter=function(b,d){var P=this.indexes[b],G=this.schema[b];if(Z(Object.keys(G)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[P]=d,!0;console.warn("@filterChildren: field '".concat(b,"' can't have children. Ignoring filter."))},b.prototype.getChildrenFilter=function(b){return this.childFilters&&this.childFilters[this.indexes[b]]},b.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},b}();function A(b){return b._context&&b._context.useFilters}var f=function(){function b(){this.types={},this.schemas=new Map,this.useFilters=!1}return b.prototype.has=function(b){return this.schemas.has(b)},b.prototype.get=function(b){return this.types[b]},b.prototype.add=function(b,d){void 0===d&&(d=this.schemas.size),b._definition=o.create(b._definition),b._typeid=d,this.types[d]=b,this.schemas.set(b,d)},b.create=function(d){return void 0===d&&(d={}),function(P){return d.context||(d.context=new b),X(P,d)}},b}(),g=new f;function X(b,d){return void 0===d&&(d={}),function(P,G){var i=d.context||g,q=P.constructor;if(q._context=i,!b)throw new Error("".concat(q.name,': @type() reference provided for "').concat(G,"\" is undefined. Make sure you don't have any circular dependencies."));i.has(q)||i.add(q);var C=q._definition;if(C.addField(G,b),C.descriptors[G]){if(C.deprecated[G])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(G,"' definition on '").concat(q.name,"'.\nCheck @type() annotation"))}catch(B){var J=B.stack.split("\n")[4].trim();throw new Error("".concat(B.message," ").concat(J))}}var L=w.is(b),x=!L&&r.is(b);if("string"!==typeof b&&!pb.is(b)){var Y=Object.values(b)[0];"string"===typeof Y||i.has(Y)||i.add(Y)}if(d.manual)C.descriptors[G]={enumerable:!0,configurable:!0,writable:!0};else{var s="_".concat(G);C.descriptors[s]={enumerable:!1,configurable:!1,writable:!0},C.descriptors[G]={get:function(){return this[s]},set:function(b){b!==this[s]&&(void 0!==b&&null!==b?(!L||b instanceof w||(b=new(w.bind.apply(w,W([void 0],b,!1)))),!x||b instanceof r||(b=new r(b)),void 0===b.$proxy&&(x?b=t(b):L&&(b=E(b))),this.$changes.change(G),b.$changes&&b.$changes.setParent(this,this.$changes.root,this._definition.indexes[G])):this[s]&&this.$changes.delete(G),this[s]=b)},enumerable:!0,configurable:!0}}}}function u(b){return function(d,P){var G=d.constructor;G._definition.addFilter(P,b)&&(G._context.useFilters=!0)}}function M(b){return function(d,P){var G=d.constructor;G._definition.addChildrenFilter(P,b)&&(G._context.useFilters=!0)}}function e(b){return void 0===b&&(b=!0),function(d,P){var G=d.constructor._definition;G.deprecated[P]=!0,b&&(G.descriptors[P]={get:function(){throw new Error("".concat(P," is deprecated."))},set:function(b){},enumerable:!1,configurable:!0})}}function R(b,d,P){for(var G in void 0===P&&(P={}),P.context||(P.context=b._context||P.context||g),d)X(d[G],P)(b.prototype,G);return b}function U(b){for(var d=0,P=0,G=0,W=b.length;G<W;G++)(d=b.charCodeAt(G))<128?P+=1:d<2048?P+=2:d<55296||d>=57344?P+=3:(G++,P+=4);return P}function H(b,d,P){for(var G=0,W=0,i=P.length;W<i;W++)(G=P.charCodeAt(W))<128?b[d++]=G:G<2048?(b[d++]=192|G>>6,b[d++]=128|63&G):G<55296||G>=57344?(b[d++]=224|G>>12,b[d++]=128|G>>6&63,b[d++]=128|63&G):(W++,G=65536+((1023&G)<<10|1023&P.charCodeAt(W)),b[d++]=240|G>>18,b[d++]=128|G>>12&63,b[d++]=128|G>>6&63,b[d++]=128|63&G)}function p(b,d){b.push(255&d)}function S(b,d){b.push(255&d)}function l(b,d){b.push(255&d),b.push(d>>8&255)}function N(b,d){b.push(255&d),b.push(d>>8&255)}function j(b,d){b.push(255&d),b.push(d>>8&255),b.push(d>>16&255),b.push(d>>24&255)}function a(b,d){var P=d>>24,G=d>>16,W=d>>8,i=d;b.push(255&i),b.push(255&W),b.push(255&G),b.push(255&P)}function O(b,d){var P=Math.floor(d/Math.pow(2,32));a(b,d>>>0),a(b,P)}function V(b,d){var P=d/Math.pow(2,32)|0;a(b,d>>>0),a(b,P)}function y(b,d){I(b,d)}function c(b,d){m(b,d)}var D=new Int32Array(2),z=new Float32Array(D.buffer),Q=new Float64Array(D.buffer);function I(b,d){z[0]=d,j(b,D[0])}function m(b,d){Q[0]=d,j(b,D[0]),j(b,D[1])}function v(b,d){return S(b,d?1:0)}function F(b,d){d||(d="");var P=U(d),G=0;if(P<32)b.push(160|P),G=1;else if(P<256)b.push(217),S(b,P),G=2;else if(P<65536)b.push(218),N(b,P),G=3;else{if(!(P<4294967296))throw new Error("String too long");b.push(219),a(b,P),G=5}return H(b,b.length,d),G+P}function h(b,d){return isNaN(d)?h(b,0):isFinite(d)?d!==(0|d)?(b.push(203),m(b,d),9):d>=0?d<128?(S(b,d),1):d<256?(b.push(204),S(b,d),2):d<65536?(b.push(205),N(b,d),3):d<4294967296?(b.push(206),a(b,d),5):(b.push(207),V(b,d),9):d>=-32?(b.push(224|d+32),1):d>=-128?(b.push(208),p(b,d),2):d>=-32768?(b.push(209),l(b,d),3):d>=-2147483648?(b.push(210),j(b,d),5):(b.push(211),O(b,d),9):h(b,d>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var T=Object.freeze({__proto__:null,utf8Write:H,int8:p,uint8:S,int16:l,uint16:N,int32:j,uint32:a,int64:O,uint64:V,float32:y,float64:c,writeFloat32:I,writeFloat64:m,boolean:v,string:F,number:h});function K(b,d,P){for(var G="",W=0,i=d,q=d+P;i<q;i++){var C=b[i];0!==(128&C)?192!==(224&C)?224!==(240&C)?240!==(248&C)?console.error("Invalid byte "+C.toString(16)):(W=(7&C)<<18|(63&b[++i])<<12|(63&b[++i])<<6|63&b[++i])>=65536?(W-=65536,G+=String.fromCharCode(55296+(W>>>10),56320+(1023&W))):G+=String.fromCharCode(W):G+=String.fromCharCode((15&C)<<12|(63&b[++i])<<6|63&b[++i]):G+=String.fromCharCode((31&C)<<6|63&b[++i]):G+=String.fromCharCode(C)}return G}function k(b,d){return bb(b,d)<<24>>24}function bb(b,d){return b[d.offset++]}function db(b,d){return Pb(b,d)<<16>>16}function Pb(b,d){return b[d.offset++]|b[d.offset++]<<8}function Gb(b,d){return b[d.offset++]|b[d.offset++]<<8|b[d.offset++]<<16|b[d.offset++]<<24}function Wb(b,d){return Gb(b,d)>>>0}function ib(b,d){return sb(b,d)}function qb(b,d){return Eb(b,d)}function Cb(b,d){var P=Wb(b,d);return Gb(b,d)*Math.pow(2,32)+P}function Jb(b,d){var P=Wb(b,d);return Wb(b,d)*Math.pow(2,32)+P}var Lb=new Int32Array(2),xb=new Float32Array(Lb.buffer),Yb=new Float64Array(Lb.buffer);function sb(b,d){return Lb[0]=Gb(b,d),xb[0]}function Eb(b,d){return Lb[0]=Gb(b,d),Lb[1]=Gb(b,d),Yb[0]}function wb(b,d){return bb(b,d)>0}function tb(b,d){var P,G=b[d.offset++];G<192?P=31&G:217===G?P=bb(b,d):218===G?P=Pb(b,d):219===G&&(P=Wb(b,d));var W=K(b,d.offset,P);return d.offset+=P,W}function rb(b,d){var P=b[d.offset];return P<192&&P>160||217===P||218===P||219===P}function Bb(b,d){var P=b[d.offset++];return P<128?P:202===P?sb(b,d):203===P?Eb(b,d):204===P?bb(b,d):205===P?Pb(b,d):206===P?Wb(b,d):207===P?Jb(b,d):208===P?k(b,d):209===P?db(b,d):210===P?Gb(b,d):211===P?Cb(b,d):P>223?-1*(255-P+1):void 0}function nb(b,d){var P=b[d.offset];return P<128||P>=202&&P<=211}function Zb(b,d){return b[d.offset]<160}function ob(b,d){return b[d.offset-1]===q&&(b[d.offset]<128||b[d.offset]>=202&&b[d.offset]<=211)}var Ab=Object.freeze({__proto__:null,int8:k,uint8:bb,int16:db,uint16:Pb,int32:Gb,uint32:Wb,float32:ib,float64:qb,int64:Cb,uint64:Jb,readFloat32:sb,readFloat64:Eb,boolean:wb,string:tb,stringCheck:rb,number:Bb,numberCheck:nb,arrayCheck:Zb,switchStructureCheck:ob}),fb=function(){function d(b){var d=this;this.$changes=new J(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,b&&b.forEach((function(b){return d.add(b)}))}return d.prototype.UC=function(d,P){return void 0===P&&(P=!0),L(this.$callbacks||(this.$callbacks=[]),b.OPERATION.ADD,d,P?this.$items:void 0)},d.prototype.Ld=function(d){return L(this.$callbacks||(this.$callbacks=[]),b.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return L(this.$callbacks||(this.$callbacks=[]),b.OPERATION.REPLACE,d)},d.is=function(b){return void 0!==b.collection},d.prototype.add=function(b){var d=this.$refId++;return void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,d),this.$changes.indexes[d]=d,this.$indexes.set(d,d),this.$items.set(d,b),this.$changes.change(d),d},d.prototype.at=function(b){var d=Array.from(this.$items.keys())[b];return this.$items.get(d)},d.prototype.entries=function(){return this.$items.entries()},d.prototype.delete=function(b){for(var d,P,G=this.$items.entries();(P=G.next())&&!P.done;)if(b===P.value[1]){d=P.value[0];break}return void 0!==d&&(this.$changes.delete(d),this.$indexes.delete(d),this.$items.delete(d))},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&x.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:b.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(b){return Array.from(this.$items.values()).some((function(d){return d===b}))},d.prototype.forEach=function(b){var d=this;this.$items.forEach((function(P,G,W){return b(P,G,d)}))},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(b,d){this.$indexes.set(b,d)},d.prototype.getIndex=function(b){return this.$indexes.get(b)},d.prototype.getByIndex=function(b){return this.$items.get(this.$indexes.get(b))},d.prototype.deleteByIndex=function(b){var d=this.$indexes.get(b);this.$items.delete(d),this.$indexes.delete(b)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){var b=[];return this.forEach((function(d,P){b.push("function"===typeof d.toJSON?d.toJSON():d)})),b},d.prototype.clone=function(b){var P;return b?P=Object.assign(new d,this):(P=new d,this.forEach((function(b){b.$changes?P.add(b.clone()):P.add(b)}))),P},d}(),gb=function(){function d(b){var d=this;this.$changes=new J(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,b&&b.forEach((function(b){return d.add(b)}))}return d.prototype.UC=function(d,P){return void 0===P&&(P=!0),L(this.$callbacks||(this.$callbacks=[]),b.OPERATION.ADD,d,P?this.$items:void 0)},d.prototype.Ld=function(d){return L(this.$callbacks||(this.$callbacks=[]),b.OPERATION.DELETE,d)},d.prototype.onChange=function(d){return L(this.$callbacks||(this.$callbacks=[]),b.OPERATION.REPLACE,d)},d.is=function(b){return void 0!==b.set},d.prototype.add=function(d){var P,G;if(this.has(d))return!1;var W=this.$refId++;void 0!==d.$changes&&d.$changes.setParent(this,this.$changes.root,W);var i=null!==(G=null===(P=this.$changes.indexes[W])||void 0===P?void 0:P.op)&&void 0!==G?G:b.OPERATION.ADD;return this.$changes.indexes[W]=W,this.$indexes.set(W,W),this.$items.set(W,d),this.$changes.change(W,i),W},d.prototype.entries=function(){return this.$items.entries()},d.prototype.delete=function(b){for(var d,P,G=this.$items.entries();(P=G.next())&&!P.done;)if(b===P.value[1]){d=P.value[0];break}return void 0!==d&&(this.$changes.delete(d),this.$indexes.delete(d),this.$items.delete(d))},d.prototype.clear=function(d){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),d&&x.call(this,d),this.$items.clear(),this.$changes.operation({index:0,op:b.OPERATION.CLEAR}),this.$changes.touchParents()},d.prototype.has=function(b){for(var d,P=this.$items.values(),G=!1;(d=P.next())&&!d.done;)if(b===d.value){G=!0;break}return G},d.prototype.forEach=function(b){var d=this;this.$items.forEach((function(P,G,W){return b(P,G,d)}))},d.prototype.values=function(){return this.$items.values()},Object.defineProperty(d.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),d.prototype.setIndex=function(b,d){this.$indexes.set(b,d)},d.prototype.getIndex=function(b){return this.$indexes.get(b)},d.prototype.getByIndex=function(b){return this.$items.get(this.$indexes.get(b))},d.prototype.deleteByIndex=function(b){var d=this.$indexes.get(b);this.$items.delete(d),this.$indexes.delete(b)},d.prototype.toArray=function(){return Array.from(this.$items.values())},d.prototype.toJSON=function(){var b=[];return this.forEach((function(d,P){b.push("function"===typeof d.toJSON?d.toJSON():d)})),b},d.prototype.clone=function(b){var P;return b?P=Object.assign(new d,this):(P=new d,this.forEach((function(b){b.$changes?P.add(b.clone()):P.add(b)}))),P},d}(),Xb=function(){function b(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return b.prototype.addRefId=function(b){this.refIds.has(b)||(this.refIds.add(b),this.containerIndexes.set(b,new Set))},b.get=function(d){return void 0===d.$filterState&&(d.$filterState=new b),d.$filterState},b}(),ub=function(){function b(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return b.prototype.getNextUniqueId=function(){return this.nextUniqueId++},b.prototype.addRef=function(b,d,P){void 0===P&&(P=!0),this.refs.set(b,d),P&&(this.refCounts[b]=(this.refCounts[b]||0)+1)},b.prototype.removeRef=function(b){this.refCounts[b]=this.refCounts[b]-1,this.deletedRefs.add(b)},b.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},b.prototype.garbageCollectDeletedRefs=function(){var b=this;this.deletedRefs.forEach((function(d){if(!(b.refCounts[d]>0)){var P=b.refs.get(d);if(P instanceof pb)for(var G in P._definition.schema)"string"!==typeof P._definition.schema[G]&&P[G]&&P[G].$changes&&b.removeRef(P[G].$changes.refId);else{var W=P.$changes.parent._definition,i=W.schema[W.fieldsByIndex[P.$changes.parentIndex]];"function"===typeof Object.values(i)[0]&&Array.from(P.values()).forEach((function(d){return b.removeRef(d.$changes.refId)}))}b.refs.delete(d),delete b.refCounts[d]}})),this.deletedRefs.clear()},b}(),Mb=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}return P(d,b),d}(Error);function eb(b,d,P,G){var W,i=!1;switch(d){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":W="number",isNaN(b)&&console.log('trying to encode "NaN" in '.concat(P.constructor.name,"#").concat(G));break;case"string":W="string",i=!0;break;case"boolean":return}if(typeof b!==W&&(!i||i&&null!==b)){var q="'".concat(JSON.stringify(b),"'").concat(b&&b.constructor&&" (".concat(b.constructor.name,")")||"");throw new Mb("a '".concat(W,"' was expected, but ").concat(q," was provided in ").concat(P.constructor.name,"#").concat(G))}}function Rb(b,d,P,G){if(!(b instanceof d))throw new Mb("a '".concat(d.name,"' was expected, but '").concat(b.constructor.name,"' was provided in ").concat(P.constructor.name,"#").concat(G))}function Ub(b,d,P,G,W){eb(P,b,G,W);var i=T[b];if(!i)throw new Mb("a '".concat(b,"' was expected, but ").concat(P," was provided in ").concat(G.constructor.name,"#").concat(W));i(d,P)}function Hb(b,d,P){return Ab[b](d,P)}var pb=function(){function d(){for(var b=[],d=0;d<arguments.length;d++)b[d]=arguments[d];Object.defineProperties(this,{$changes:{value:new J(this,void 0,new ub),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var P=this._definition.descriptors;P&&Object.defineProperties(this,P),b[0]&&this.assign(b[0])}return d.onError=function(b){console.error(b)},d.is=function(b){return b._definition&&void 0!==b._definition.schema},d.prototype.onChange=function(d){return L(this.$callbacks||(this.$callbacks=[]),b.OPERATION.REPLACE,d)},d.prototype.Ld=function(d){return L(this.$callbacks||(this.$callbacks=[]),b.OPERATION.DELETE,d)},d.prototype.assign=function(b){return Object.assign(this,b),this},Object.defineProperty(d.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),d.prototype.setDirty=function(b,d){this.$changes.change(b,d)},d.prototype.listen=function(b,d,P){var G=this;return void 0===P&&(P=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[b]||(this.$callbacks[b]=[]),this.$callbacks[b].push(d),P&&void 0!==this[b]&&d(this[b],void 0),function(){return Y(G.$callbacks[b],G.$callbacks[b].indexOf(d))}},d.prototype.decode=function(P,G,W){var i;void 0===G&&(G={offset:0}),void 0===W&&(W=this);var C=[],J=this.$changes.root,L=P.length,x=0;for(J.refs.set(x,this);G.offset<L;){var Y=P[G.offset++];if(Y!=q){var s=W.$changes,E=void 0!==W._definition,t=E?Y>>6<<6:Y;if(t!==b.OPERATION.CLEAR){var B=E?Y%(t||255):Bb(P,G),n=E?W._definition.fieldsByIndex[B]:"",o=s.getType(B),A=void 0,f=void 0,g=void 0;if(E?f=W["_".concat(n)]:(f=W.getByIndex(B),(t&b.OPERATION.ADD)===b.OPERATION.ADD?(g=W instanceof r?tb(P,G):B,W.setIndex(B,g)):g=W.getIndex(B)),(t&b.OPERATION.DELETE)===b.OPERATION.DELETE&&(t!==b.OPERATION.DELETE_AND_ADD&&W.deleteByIndex(B),f&&f.$changes&&J.removeRef(f.$changes.refId),A=null),void 0!==n){if(t===b.OPERATION.DELETE);else if(d.is(o)){var X=Bb(P,G);if(A=J.refs.get(X),t!==b.OPERATION.REPLACE){var u=this.getSchemaType(P,G,o);A||((A=this.createTypeInstance(u)).$changes.refId=X,f&&(A.$callbacks=f.$callbacks,f.$changes.refId&&X!==f.$changes.refId&&J.removeRef(f.$changes.refId))),J.addRef(X,A,A!==f)}}else if("string"===typeof o)A=Hb(o,P,G);else{var M=Z(Object.keys(o)[0]),e=Bb(P,G),R=J.refs.has(e)?f||J.refs.get(e):new M.constructor;if((A=R.clone(!0)).$changes.refId=e,f&&(A.$callbacks=f.$callbacks,f.$changes.refId&&e!==f.$changes.refId)){J.removeRef(f.$changes.refId);for(var U=f.entries(),H=void 0;(H=U.next())&&!H.done;){var p=(i=H.value)[0],S=i[1];C.push({refId:e,op:b.OPERATION.DELETE,field:p,value:void 0,previousValue:S})}}J.addRef(e,A,R!==f)}if(null!==A&&void 0!==A)if(A.$changes&&A.$changes.setParent(s.ref,s.root,B),W instanceof d)W[n]=A;else if(W instanceof r)p=g,W.$items.set(p,A),W.$changes.allChanges.add(B);else if(W instanceof w)W.setAt(B,A);else if(W instanceof fb){var l=W.add(A);W.setIndex(B,l)}else W instanceof gb&&!1!==(l=W.add(A))&&W.setIndex(B,l);f!==A&&C.push({refId:x,op:t,field:n,dynamicIndex:g,value:A,previousValue:f})}else{console.warn("@colyseus/schema: definition mismatch");for(var N={offset:G.offset};G.offset<L&&(!ob(P,G)||(N.offset=G.offset+1,!J.refs.has(Bb(P,N))));)G.offset++}}else W.clear(C)}else{x=Bb(P,G);var j=J.refs.get(x);if(!j)throw new Error('"refId" not found: '.concat(x));W=j}}return this._triggerChanges(C),J.garbageCollectDeletedRefs(),C},d.prototype.encode=function(P,G,W){void 0===P&&(P=!1),void 0===G&&(G=[]),void 0===W&&(W=!1);for(var i=this.$changes,C=new WeakSet,J=[i],L=1,x=0;x<L;x++){var Y=J[x],s=Y.ref,E=s instanceof d;Y.ensureRefId(),C.add(Y),Y!==i&&(Y.changed||P)&&(S(G,q),h(G,Y.refId));for(var w=P?Array.from(Y.allChanges):Array.from(Y.changes.values()),t=0,B=w.length;t<B;t++){var n=P?{op:b.OPERATION.ADD,index:w[t]}:w[t],o=n.index,A=E?s._definition.fieldsByIndex&&s._definition.fieldsByIndex[o]:o,f=G.length;if(n.op!==b.OPERATION.TOUCH)if(E)S(G,o|n.op);else{if(S(G,n.op),n.op===b.OPERATION.CLEAR)continue;h(G,o)}if(E||(n.op&b.OPERATION.ADD)!=b.OPERATION.ADD||s instanceof r&&F(G,Y.ref.$indexes.get(o)),n.op!==b.OPERATION.DELETE){var g=Y.getType(o),X=Y.getValue(o);if(X&&X.$changes&&!C.has(X.$changes)&&(J.push(X.$changes),X.$changes.ensureRefId(),L++),n.op!==b.OPERATION.TOUCH){if(d.is(g))Rb(X,g,s,A),h(G,X.$changes.refId),(n.op&b.OPERATION.ADD)===b.OPERATION.ADD&&this.tryEncodeTypeId(G,g,X.constructor);else if("string"===typeof g)Ub(g,G,X,s,A);else{var u=Z(Object.keys(g)[0]);Rb(s["_".concat(A)],u.constructor,s,A),h(G,X.$changes.refId)}W&&Y.cache(o,G.slice(f))}}}P||W||Y.discard()}return G},d.prototype.encodeAll=function(b){return this.encode(!0,[],b)},d.prototype.applyFilters=function(P,G){var W,i;void 0===G&&(G=!1);for(var C=this,J=new Set,L=Xb.get(P),x=[this.$changes],Y=1,s=[],E=function(E){var w=x[E];if(J.has(w.refId))return"continue";var t=w.ref,B=t instanceof d;S(s,q),h(s,w.refId);var n=L.refIds.has(w),Z=G||!n;L.addRefId(w);var o=L.containerIndexes.get(w),A=Z?Array.from(w.allChanges):Array.from(w.changes.values());!G&&B&&t._definition.indexesWithFilters&&t._definition.indexesWithFilters.forEach((function(d){!o.has(d)&&w.allChanges.has(d)&&(Z?A.push(d):A.push({op:b.OPERATION.ADD,index:d}))}));for(var f=0,g=A.length;f<g;f++){var X=Z?{op:b.OPERATION.ADD,index:A[f]}:A[f];if(X.op!==b.OPERATION.CLEAR){var u=X.index;if(X.op!==b.OPERATION.DELETE){var M=w.getValue(u),e=w.getType(u);if(B){if((R=t._definition.filters&&t._definition.filters[u])&&!R.call(t,P,M,C)){M&&M.$changes&&J.add(M.$changes.refId);continue}}else{var R,U=w.parent;if((R=w.getChildrenFilter())&&!R.call(U,P,t.$indexes.get(u),M,C)){M&&M.$changes&&J.add(M.$changes.refId);continue}}if(M.$changes&&(x.push(M.$changes),Y++),X.op!==b.OPERATION.TOUCH)if(X.op===b.OPERATION.ADD||B)s.push.apply(s,null!==(W=w.caches[u])&&void 0!==W?W:[]),o.add(u);else if(o.has(u))s.push.apply(s,null!==(i=w.caches[u])&&void 0!==i?i:[]);else{if(o.add(u),S(s,b.OPERATION.ADD),h(s,u),t instanceof r){var H=w.ref.$indexes.get(u);F(s,H)}M.$changes?h(s,M.$changes.refId):T[e](s,M)}else M.$changes&&!B&&(S(s,b.OPERATION.ADD),h(s,u),t instanceof r&&(H=w.ref.$indexes.get(u),F(s,H)),h(s,M.$changes.refId))}else B?S(s,X.op|u):(S(s,X.op),h(s,u))}else S(s,X.op)}},w=0;w<Y;w++)E(w);return s},d.prototype.clone=function(){var b,d=new this.constructor,P=this._definition.schema;for(var G in P)"object"===typeof this[G]&&"function"===typeof(null===(b=this[G])||void 0===b?void 0:b.clone)?d[G]=this[G].clone():d[G]=this[G];return d},d.prototype.toJSON=function(){var b=this._definition.schema,d=this._definition.deprecated,P={};for(var G in b)d[G]||null===this[G]||"undefined"===typeof this[G]||(P[G]="function"===typeof this[G].toJSON?this[G].toJSON():this["_".concat(G)]);return P},d.prototype.discardAllChanges=function(){this.$changes.discardAll()},d.prototype.getByIndex=function(b){return this[this._definition.fieldsByIndex[b]]},d.prototype.deleteByIndex=function(b){this[this._definition.fieldsByIndex[b]]=void 0},d.prototype.tryEncodeTypeId=function(b,d,P){d._typeid!==P._typeid&&(S(b,C),h(b,P._typeid))},d.prototype.getSchemaType=function(b,d,P){var G;return b[d.offset]===C&&(d.offset++,G=this.constructor._context.get(Bb(b,d))),G||P},d.prototype.createTypeInstance=function(b){var d=new b;return d.$changes.root=this.$changes.root,d},d.prototype._triggerChanges=function(P){for(var G,W,i,q,C,J,L,x,Y,s=new Set,E=this.$changes.root.refs,w=function(w){var t=P[w],r=t.refId,B=E.get(r),n=B.$callbacks;if((t.op&b.OPERATION.DELETE)===b.OPERATION.DELETE&&t.previousValue instanceof d&&(null===(W=null===(G=t.previousValue.$callbacks)||void 0===G?void 0:G[b.OPERATION.DELETE])||void 0===W||W.forEach((function(b){return b()}))),!n)return"continue";if(B instanceof d){if(!s.has(r))try{null===(i=null===n||void 0===n?void 0:n[b.OPERATION.REPLACE])||void 0===i||i.forEach((function(b){return b()}))}catch(Z){d.onError(Z)}try{n.hasOwnProperty(t.field)&&(null===(q=n[t.field])||void 0===q||q.forEach((function(b){return b(t.value,t.previousValue)})))}catch(Z){d.onError(Z)}}else t.op===b.OPERATION.ADD&&void 0===t.previousValue?null===(C=n[b.OPERATION.ADD])||void 0===C||C.forEach((function(b){var d;return b(t.value,null!==(d=t.dynamicIndex)&&void 0!==d?d:t.field)})):t.op===b.OPERATION.DELETE?void 0!==t.previousValue&&(null===(J=n[b.OPERATION.DELETE])||void 0===J||J.forEach((function(b){var d;return b(t.previousValue,null!==(d=t.dynamicIndex)&&void 0!==d?d:t.field)}))):t.op===b.OPERATION.DELETE_AND_ADD&&(void 0!==t.previousValue&&(null===(L=n[b.OPERATION.DELETE])||void 0===L||L.forEach((function(b){var d;return b(t.previousValue,null!==(d=t.dynamicIndex)&&void 0!==d?d:t.field)}))),null===(x=n[b.OPERATION.ADD])||void 0===x||x.forEach((function(b){var d;return b(t.value,null!==(d=t.dynamicIndex)&&void 0!==d?d:t.field)}))),t.value!==t.previousValue&&(null===(Y=n[b.OPERATION.REPLACE])||void 0===Y||Y.forEach((function(b){var d;return b(t.value,null!==(d=t.dynamicIndex)&&void 0!==d?d:t.field)})));s.add(r)},t=0;t<P.length;t++)w(t)},d._definition=o.create(),d}();function Sb(b){for(var d=[b.$changes],P=1,G={},W=G,i=function(b){var P=d[b];P.changes.forEach((function(b){var d=P.ref,G=b.index,i=d._definition?d._definition.fieldsByIndex[G]:d.$indexes.get(G);W[i]=P.getValue(G)}))},q=0;q<P;q++)i(q);return G}var lb={context:new f},Nb=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}return P(d,b),G([X("string",lb)],d.prototype,"name",void 0),G([X("string",lb)],d.prototype,"type",void 0),G([X("number",lb)],d.prototype,"referencedType",void 0),d}(pb),jb=function(b){function d(){var d=null!==b&&b.apply(this,arguments)||this;return d.fields=new w,d}return P(d,b),G([X("number",lb)],d.prototype,"id",void 0),G([X([Nb],lb)],d.prototype,"fields",void 0),d}(pb),ab=function(b){function d(){var d=null!==b&&b.apply(this,arguments)||this;return d.types=new w,d}return P(d,b),d.encode=function(b){var P=b.constructor,G=new d;G.rootType=P._typeid;var W=function(b,d){for(var P in d){var W=new Nb;W.name=P;var i=void 0;if("string"===typeof d[P])i=d[P];else{var q=d[P],C=void 0;pb.is(q)?(i="ref",C=d[P]):"string"===typeof q[i=Object.keys(q)[0]]?i+=":"+q[i]:C=q[i],W.referencedType=C?C._typeid:-1}W.type=i,b.fields.push(W)}G.types.push(b)},i=P._context.types;for(var q in i){var C=new jb;C.id=Number(q),W(C,i[q]._definition.schema)}return G.encodeAll()},d.decode=function(b,G){var W=new f,i=new d;i.decode(b,G);var q=i.types.reduce((function(b,d){var G=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}return P(d,b),d}(pb),i=d.id;return b[i]=G,W.add(G,i),b}),{});i.types.forEach((function(b){var d=q[b.id];b.fields.forEach((function(b){var P;if(void 0!==b.referencedType){var G=b.type,i=q[b.referencedType];if(!i){var C=b.type.split(":");G=C[0],i=C[1]}"ref"===G?X(i,{context:W})(d.prototype,b.name):X(((P={})[G]=i,P),{context:W})(d.prototype,b.name)}else X(b.type,{context:W})(d.prototype,b.name)}))}));var C=q[i.rootType],J=new C;for(var L in C._definition.schema){var x=C._definition.schema[L];"string"!==typeof x&&(J[L]="function"===typeof x?new x:new(Z(Object.keys(x)[0]).constructor))}return J},G([X([jb],lb)],d.prototype,"types",void 0),G([X("number",lb)],d.prototype,"rootType",void 0),d}(pb);n("map",{constructor:r}),n("array",{constructor:w}),n("set",{constructor:gb}),n("collection",{constructor:fb}),b.ArraySchema=w,b.CollectionSchema=fb,b.Context=f,b.MapSchema=r,b.Reflection=ab,b.ReflectionField=Nb,b.ReflectionType=jb,b.Schema=pb,b.SchemaDefinition=o,b.SetSchema=gb,b.decode=Ab,b.defineTypes=R,b.deprecated=e,b.dumpChanges=Sb,b.encode=T,b.filter=u,b.filterChildren=M,b.hasFilter=A,b.registerType=n,b.type=X,Object.defineProperty(b,"__esModule",{value:!0})}(d)},13756:b=>{"use strict";b.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13749:(b,d,P)=>{var G=P(13756),W=P(13762),i=Object.hasOwnProperty,q=Object.create(null);for(var C in G)i.call(G,C)&&(q[G[C]]=C);var J=b.exports={to:{},get:{}};function L(b,d,P){return Math.min(Math.max(d,b),P)}function x(b){var d=Math.round(b).toString(16).toUpperCase();return d.length<2?"0"+d:d}J.get=function(b){var d,P;switch(b.substring(0,3).toLowerCase()){case"hsl":d=J.get.hsl(b),P="hsl";break;case"hwb":d=J.get.hwb(b),P="hwb";break;default:d=J.get.rgb(b),P="rgb"}return d?{model:P,value:d}:null},J.get.rgb=function(b){if(!b)return null;var d,P,W,q=[0,0,0,1];if(d=b.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(W=d[2],d=d[1],P=0;P<3;P++){var C=2*P;q[P]=parseInt(d.slice(C,C+2),16)}W&&(q[3]=parseInt(W,16)/255)}else if(d=b.match(/^#([a-f0-9]{3,4})$/i)){for(W=(d=d[1])[3],P=0;P<3;P++)q[P]=parseInt(d[P]+d[P],16);W&&(q[3]=parseInt(W+W,16)/255)}else if(d=b.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(P=0;P<3;P++)q[P]=parseInt(d[P+1],0);d[4]&&(d[5]?q[3]=.01*parseFloat(d[4]):q[3]=parseFloat(d[4]))}else{if(!(d=b.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(d=b.match(/^(\w+)$/))?"transparent"===d[1]?[0,0,0,0]:i.call(G,d[1])?((q=G[d[1]])[3]=1,q):null:null;for(P=0;P<3;P++)q[P]=Math.round(2.55*parseFloat(d[P+1]));d[4]&&(d[5]?q[3]=.01*parseFloat(d[4]):q[3]=parseFloat(d[4]))}for(P=0;P<3;P++)q[P]=L(q[P],0,255);return q[3]=L(q[3],0,1),q},J.get.hsl=function(b){if(!b)return null;var d=b.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(d){var P=parseFloat(d[4]);return[(parseFloat(d[1])%360+360)%360,L(parseFloat(d[2]),0,100),L(parseFloat(d[3]),0,100),L(isNaN(P)?1:P,0,1)]}return null},J.get.hwb=function(b){if(!b)return null;var d=b.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(d){var P=parseFloat(d[4]);return[(parseFloat(d[1])%360+360)%360,L(parseFloat(d[2]),0,100),L(parseFloat(d[3]),0,100),L(isNaN(P)?1:P,0,1)]}return null},J.to.hex=function(){var b=W(arguments);return"#"+x(b[0])+x(b[1])+x(b[2])+(b[3]<1?x(Math.round(255*b[3])):"")},J.to.rgb=function(){var b=W(arguments);return b.length<4||1===b[3]?"rgb("+Math.round(b[0])+", "+Math.round(b[1])+", "+Math.round(b[2])+")":"rgba("+Math.round(b[0])+", "+Math.round(b[1])+", "+Math.round(b[2])+", "+b[3]+")"},J.to.rgb.percent=function(){var b=W(arguments),d=Math.round(b[0]/255*100),P=Math.round(b[1]/255*100),G=Math.round(b[2]/255*100);return b.length<4||1===b[3]?"rgb("+d+"%, "+P+"%, "+G+"%)":"rgba("+d+"%, "+P+"%, "+G+"%, "+b[3]+")"},J.to.hsl=function(){var b=W(arguments);return b.length<4||1===b[3]?"hsl("+b[0]+", "+b[1]+"%, "+b[2]+"%)":"hsla("+b[0]+", "+b[1]+"%, "+b[2]+"%, "+b[3]+")"},J.to.hwb=function(){var b=W(arguments),d="";return b.length>=4&&1!==b[3]&&(d=", "+b[3]),"hwb("+b[0]+", "+b[1]+"%, "+b[2]+"%"+d+")"},J.to.keyword=function(b){return q[b.slice(0,3)]}},13744:(b,d,P)=>{const G=P(13749),W=P(13771),i=["keyword","gray","hex"],q={};for(const E of Object.keys(W))q[[...W[E].labels].sort().join("")]=E;const C={};function J(b,d){if(!(this instanceof J))return new J(b,d);if(d&&d in i&&(d=null),d&&!(d in W))throw new Error("Unknown model: "+d);let P,L;if(null==b)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(b instanceof J)this.model=b.model,this.color=[...b.color],this.valpha=b.valpha;else if("string"===typeof b){const d=G.get(b);if(null===d)throw new Error("Unable to parse color from string: "+b);this.model=d.model,L=W[this.model].channels,this.color=d.value.slice(0,L),this.valpha="number"===typeof d.value[L]?d.value[L]:1}else if(b.length>0){this.model=d||"rgb",L=W[this.model].channels;const P=Array.prototype.slice.call(b,0,L);this.color=s(P,L),this.valpha="number"===typeof b[L]?b[L]:1}else if("number"===typeof b)this.model="rgb",this.color=[b>>16&255,b>>8&255,255&b],this.valpha=1;else{this.valpha=1;const d=Object.keys(b);"alpha"in b&&(d.splice(d.indexOf("alpha"),1),this.valpha="number"===typeof b.alpha?b.alpha:0);const G=d.sort().join("");if(!(G in q))throw new Error("Unable to parse color from object: "+JSON.stringify(b));this.model=q[G];const{labels:i}=W[this.model],C=[];for(P=0;P<i.length;P++)C.push(b[i[P]]);this.color=s(C)}if(C[this.model])for(L=W[this.model].channels,P=0;P<L;P++){const b=C[this.model][P];b&&(this.color[P]=b(this.color[P]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}J.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(b){let d=this.model in G.to?this:this.rgb();d=d.round("number"===typeof b?b:1);const P=1===d.valpha?d.color:[...d.color,this.valpha];return G.to[d.model](P)},percentString(b){const d=this.rgb().round("number"===typeof b?b:1),P=1===d.valpha?d.color:[...d.color,this.valpha];return G.to.rgb.percent(P)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const b={},{channels:d}=W[this.model],{labels:P}=W[this.model];for(let G=0;G<d;G++)b[P[G]]=this.color[G];return 1!==this.valpha&&(b.alpha=this.valpha),b},unitArray(){const b=this.rgb().color;return b[0]/=255,b[1]/=255,b[2]/=255,1!==this.valpha&&b.push(this.valpha),b},unitObject(){const b=this.rgb().object();return b.r/=255,b.g/=255,b.b/=255,1!==this.valpha&&(b.alpha=this.valpha),b},round(b){return b=Math.max(b||0,0),new J([...this.color.map(L(b)),this.valpha],this.model)},alpha(b){return void 0!==b?new J([...this.color,Math.max(0,Math.min(1,b))],this.model):this.valpha},red:x("rgb",0,Y(255)),green:x("rgb",1,Y(255)),blue:x("rgb",2,Y(255)),hue:x(["hsl","hsv","hsl","hwb","hcg"],0,(b=>(b%360+360)%360)),saturationl:x("hsl",1,Y(100)),lightness:x("hsl",2,Y(100)),saturationv:x("hsv",1,Y(100)),value:x("hsv",2,Y(100)),chroma:x("hcg",1,Y(100)),gray:x("hcg",2,Y(100)),white:x("hwb",1,Y(100)),wblack:x("hwb",2,Y(100)),cyan:x("cmyk",0,Y(100)),magenta:x("cmyk",1,Y(100)),yellow:x("cmyk",2,Y(100)),black:x("cmyk",3,Y(100)),x:x("xyz",0,Y(95.047)),y:x("xyz",1,Y(100)),z:x("xyz",2,Y(108.833)),l:x("lab",0,Y(100)),a:x("lab",1),b:x("lab",2),keyword(b){return void 0!==b?new J(b):W[this.model].keyword(this.color)},hex(b){return void 0!==b?new J(b):G.to.hex(this.rgb().round().color)},hexa(b){if(void 0!==b)return new J(b);const d=this.rgb().round().color;let P=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===P.length&&(P="0"+P),G.to.hex(d)+P},rgbNumber(){const b=this.rgb().color;return(255&b[0])<<16|(255&b[1])<<8|255&b[2]},luminosity(){const b=this.rgb().color,d=[];for(const[P,G]of b.entries()){const b=G/255;d[P]=b<=.04045?b/12.92:((b+.055)/1.055)**2.4}return.2126*d[0]+.7152*d[1]+.0722*d[2]},contrast(b){const d=this.luminosity(),P=b.luminosity();return d>P?(d+.05)/(P+.05):(P+.05)/(d+.05)},level(b){const d=this.contrast(b);return d>=7?"AAA":d>=4.5?"AA":""},isDark(){const b=this.rgb().color;return(2126*b[0]+7152*b[1]+722*b[2])/1e4<128},isLight(){return!this.isDark()},negate(){const b=this.rgb();for(let d=0;d<3;d++)b.color[d]=255-b.color[d];return b},lighten(b){const d=this.hsl();return d.color[2]+=d.color[2]*b,d},darken(b){const d=this.hsl();return d.color[2]-=d.color[2]*b,d},saturate(b){const d=this.hsl();return d.color[1]+=d.color[1]*b,d},desaturate(b){const d=this.hsl();return d.color[1]-=d.color[1]*b,d},whiten(b){const d=this.hwb();return d.color[1]+=d.color[1]*b,d},blacken(b){const d=this.hwb();return d.color[2]+=d.color[2]*b,d},grayscale(){const b=this.rgb().color,d=.3*b[0]+.59*b[1]+.11*b[2];return J.rgb(d,d,d)},fade(b){return this.alpha(this.valpha-this.valpha*b)},opaquer(b){return this.alpha(this.valpha+this.valpha*b)},rotate(b){const d=this.hsl();let P=d.color[0];return P=(P+b)%360,P=P<0?360+P:P,d.color[0]=P,d},mix(b,d){if(!b||!b.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof b);const P=b.rgb(),G=this.rgb(),W=void 0===d?.5:d,i=2*W-1,q=P.alpha()-G.alpha(),C=((i*q===-1?i:(i+q)/(1+i*q))+1)/2,L=1-C;return J.rgb(C*P.red()+L*G.red(),C*P.green()+L*G.green(),C*P.blue()+L*G.blue(),P.alpha()*W+G.alpha()*(1-W))}};for(const E of Object.keys(W)){if(i.includes(E))continue;const{channels:b}=W[E];J.prototype[E]=function(){if(this.model===E)return new J(this);for(var b=arguments.length,d=new Array(b),P=0;P<b;P++)d[P]=arguments[P];return d.length>0?new J(d,E):new J([...(G=W[this.model][E].raw(this.color),Array.isArray(G)?G:[G]),this.valpha],E);var G},J[E]=function(){for(var d=arguments.length,P=new Array(d),G=0;G<d;G++)P[G]=arguments[G];let W=P[0];return"number"===typeof W&&(W=s(P,b)),new J(W,E)}}function L(b){return function(d){return function(b,d){return Number(b.toFixed(d))}(d,b)}}function x(b,d,P){b=Array.isArray(b)?b:[b];for(const G of b)(C[G]||(C[G]=[]))[d]=P;return b=b[0],function(G){let W;return void 0!==G?(P&&(G=P(G)),W=this[b](),W.color[d]=G,W):(W=this[b]().color[d],P&&(W=P(W)),W)}}function Y(b){return function(d){return Math.max(0,Math.min(b,d))}}function s(b,d){for(let P=0;P<d;P++)"number"!==typeof b[P]&&(b[P]=0);return b}b.exports=J},13776:(b,d,P)=>{const G=P(13781),W={};for(const q of Object.keys(G))W[G[q]]=q;const i={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};b.exports=i;for(const q of Object.keys(i)){if(!("channels"in i[q]))throw new Error("missing channels property: "+q);if(!("labels"in i[q]))throw new Error("missing channel labels property: "+q);if(i[q].labels.length!==i[q].channels)throw new Error("channel and label counts mismatch: "+q);const{channels:b,labels:d}=i[q];delete i[q].channels,delete i[q].labels,Object.defineProperty(i[q],"channels",{value:b}),Object.defineProperty(i[q],"labels",{value:d})}i.rgb.hsl=function(b){const d=b[0]/255,P=b[1]/255,G=b[2]/255,W=Math.min(d,P,G),i=Math.max(d,P,G),q=i-W;let C,J;i===W?C=0:d===i?C=(P-G)/q:P===i?C=2+(G-d)/q:G===i&&(C=4+(d-P)/q),C=Math.min(60*C,360),C<0&&(C+=360);const L=(W+i)/2;return J=i===W?0:L<=.5?q/(i+W):q/(2-i-W),[C,100*J,100*L]},i.rgb.hsv=function(b){let d,P,G,W,i;const q=b[0]/255,C=b[1]/255,J=b[2]/255,L=Math.max(q,C,J),x=L-Math.min(q,C,J),Y=function(b){return(L-b)/6/x+.5};return 0===x?(W=0,i=0):(i=x/L,d=Y(q),P=Y(C),G=Y(J),q===L?W=G-P:C===L?W=1/3+d-G:J===L&&(W=2/3+P-d),W<0?W+=1:W>1&&(W-=1)),[360*W,100*i,100*L]},i.rgb.hwb=function(b){const d=b[0],P=b[1];let G=b[2];const W=i.rgb.hsl(b)[0],q=1/255*Math.min(d,Math.min(P,G));return G=1-1/255*Math.max(d,Math.max(P,G)),[W,100*q,100*G]},i.rgb.cmyk=function(b){const d=b[0]/255,P=b[1]/255,G=b[2]/255,W=Math.min(1-d,1-P,1-G);return[100*((1-d-W)/(1-W)||0),100*((1-P-W)/(1-W)||0),100*((1-G-W)/(1-W)||0),100*W]},i.rgb.keyword=function(b){const d=W[b];if(d)return d;let P,i=1/0;for(const W of Object.keys(G)){const d=G[W],J=(C=d,((q=b)[0]-C[0])**2+(q[1]-C[1])**2+(q[2]-C[2])**2);J<i&&(i=J,P=W)}var q,C;return P},i.keyword.rgb=function(b){return G[b]},i.rgb.xyz=function(b){let d=b[0]/255,P=b[1]/255,G=b[2]/255;d=d>.04045?((d+.055)/1.055)**2.4:d/12.92,P=P>.04045?((P+.055)/1.055)**2.4:P/12.92,G=G>.04045?((G+.055)/1.055)**2.4:G/12.92;return[100*(.4124*d+.3576*P+.1805*G),100*(.2126*d+.7152*P+.0722*G),100*(.0193*d+.1192*P+.9505*G)]},i.rgb.lab=function(b){const d=i.rgb.xyz(b);let P=d[0],G=d[1],W=d[2];P/=95.047,G/=100,W/=108.883,P=P>.008856?P**(1/3):7.787*P+16/116,G=G>.008856?G**(1/3):7.787*G+16/116,W=W>.008856?W**(1/3):7.787*W+16/116;return[116*G-16,500*(P-G),200*(G-W)]},i.hsl.rgb=function(b){const d=b[0]/360,P=b[1]/100,G=b[2]/100;let W,i,q;if(0===P)return q=255*G,[q,q,q];W=G<.5?G*(1+P):G+P-G*P;const C=2*G-W,J=[0,0,0];for(let L=0;L<3;L++)i=d+1/3*-(L-1),i<0&&i++,i>1&&i--,q=6*i<1?C+6*(W-C)*i:2*i<1?W:3*i<2?C+(W-C)*(2/3-i)*6:C,J[L]=255*q;return J},i.hsl.hsv=function(b){const d=b[0];let P=b[1]/100,G=b[2]/100,W=P;const i=Math.max(G,.01);G*=2,P*=G<=1?G:2-G,W*=i<=1?i:2-i;return[d,100*(0===G?2*W/(i+W):2*P/(G+P)),100*((G+P)/2)]},i.hsv.rgb=function(b){const d=b[0]/60,P=b[1]/100;let G=b[2]/100;const W=Math.floor(d)%6,i=d-Math.floor(d),q=255*G*(1-P),C=255*G*(1-P*i),J=255*G*(1-P*(1-i));switch(G*=255,W){case 0:return[G,J,q];case 1:return[C,G,q];case 2:return[q,G,J];case 3:return[q,C,G];case 4:return[J,q,G];case 5:return[G,q,C]}},i.hsv.hsl=function(b){const d=b[0],P=b[1]/100,G=b[2]/100,W=Math.max(G,.01);let i,q;q=(2-P)*G;const C=(2-P)*W;return i=P*W,i/=C<=1?C:2-C,i=i||0,q/=2,[d,100*i,100*q]},i.hwb.rgb=function(b){const d=b[0]/360;let P=b[1]/100,G=b[2]/100;const W=P+G;let i;W>1&&(P/=W,G/=W);const q=Math.floor(6*d),C=1-G;i=6*d-q,0!==(1&q)&&(i=1-i);const J=P+i*(C-P);let L,x,Y;switch(q){default:case 6:case 0:L=C,x=J,Y=P;break;case 1:L=J,x=C,Y=P;break;case 2:L=P,x=C,Y=J;break;case 3:L=P,x=J,Y=C;break;case 4:L=J,x=P,Y=C;break;case 5:L=C,x=P,Y=J}return[255*L,255*x,255*Y]},i.cmyk.rgb=function(b){const d=b[0]/100,P=b[1]/100,G=b[2]/100,W=b[3]/100;return[255*(1-Math.min(1,d*(1-W)+W)),255*(1-Math.min(1,P*(1-W)+W)),255*(1-Math.min(1,G*(1-W)+W))]},i.xyz.rgb=function(b){const d=b[0]/100,P=b[1]/100,G=b[2]/100;let W,i,q;return W=3.2406*d+-1.5372*P+-.4986*G,i=-.9689*d+1.8758*P+.0415*G,q=.0557*d+-.204*P+1.057*G,W=W>.0031308?1.055*W**(1/2.4)-.055:12.92*W,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,q=q>.0031308?1.055*q**(1/2.4)-.055:12.92*q,W=Math.min(Math.max(0,W),1),i=Math.min(Math.max(0,i),1),q=Math.min(Math.max(0,q),1),[255*W,255*i,255*q]},i.xyz.lab=function(b){let d=b[0],P=b[1],G=b[2];d/=95.047,P/=100,G/=108.883,d=d>.008856?d**(1/3):7.787*d+16/116,P=P>.008856?P**(1/3):7.787*P+16/116,G=G>.008856?G**(1/3):7.787*G+16/116;return[116*P-16,500*(d-P),200*(P-G)]},i.lab.xyz=function(b){let d,P,G;P=(b[0]+16)/116,d=b[1]/500+P,G=P-b[2]/200;const W=P**3,i=d**3,q=G**3;return P=W>.008856?W:(P-16/116)/7.787,d=i>.008856?i:(d-16/116)/7.787,G=q>.008856?q:(G-16/116)/7.787,d*=95.047,P*=100,G*=108.883,[d,P,G]},i.lab.lch=function(b){const d=b[0],P=b[1],G=b[2];let W;W=360*Math.atan2(G,P)/2/Math.PI,W<0&&(W+=360);return[d,Math.sqrt(P*P+G*G),W]},i.lch.lab=function(b){const d=b[0],P=b[1],G=b[2]/360*2*Math.PI;return[d,P*Math.cos(G),P*Math.sin(G)]},i.rgb.ansi16=function(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[P,G,W]=b;let q=null===d?i.rgb.hsv(b)[2]:d;if(q=Math.round(q/50),0===q)return 30;let C=30+(Math.round(W/255)<<2|Math.round(G/255)<<1|Math.round(P/255));return 2===q&&(C+=60),C},i.hsv.ansi16=function(b){return i.rgb.ansi16(i.hsv.rgb(b),b[2])},i.rgb.ansi256=function(b){const d=b[0],P=b[1],G=b[2];if(d===P&&P===G)return d<8?16:d>248?231:Math.round((d-8)/247*24)+232;return 16+36*Math.round(d/255*5)+6*Math.round(P/255*5)+Math.round(G/255*5)},i.ansi16.rgb=function(b){let d=b%10;if(0===d||7===d)return b>50&&(d+=3.5),d=d/10.5*255,[d,d,d];const P=.5*(1+~~(b>50));return[(1&d)*P*255,(d>>1&1)*P*255,(d>>2&1)*P*255]},i.ansi256.rgb=function(b){if(b>=232){const d=10*(b-232)+8;return[d,d,d]}let d;b-=16;return[Math.floor(b/36)/5*255,Math.floor((d=b%36)/6)/5*255,d%6/5*255]},i.rgb.hex=function(b){const d=(((255&Math.round(b[0]))<<16)+((255&Math.round(b[1]))<<8)+(255&Math.round(b[2]))).toString(16).toUpperCase();return"000000".substring(d.length)+d},i.hex.rgb=function(b){const d=b.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!d)return[0,0,0];let P=d[0];3===d[0].length&&(P=P.split("").map((b=>b+b)).join(""));const G=parseInt(P,16);return[G>>16&255,G>>8&255,255&G]},i.rgb.hcg=function(b){const d=b[0]/255,P=b[1]/255,G=b[2]/255,W=Math.max(Math.max(d,P),G),i=Math.min(Math.min(d,P),G),q=W-i;let C,J;return C=q<1?i/(1-q):0,J=q<=0?0:W===d?(P-G)/q%6:W===P?2+(G-d)/q:4+(d-P)/q,J/=6,J%=1,[360*J,100*q,100*C]},i.hsl.hcg=function(b){const d=b[1]/100,P=b[2]/100,G=P<.5?2*d*P:2*d*(1-P);let W=0;return G<1&&(W=(P-.5*G)/(1-G)),[b[0],100*G,100*W]},i.hsv.hcg=function(b){const d=b[1]/100,P=b[2]/100,G=d*P;let W=0;return G<1&&(W=(P-G)/(1-G)),[b[0],100*G,100*W]},i.hcg.rgb=function(b){const d=b[0]/360,P=b[1]/100,G=b[2]/100;if(0===P)return[255*G,255*G,255*G];const W=[0,0,0],i=d%1*6,q=i%1,C=1-q;let J=0;switch(Math.floor(i)){case 0:W[0]=1,W[1]=q,W[2]=0;break;case 1:W[0]=C,W[1]=1,W[2]=0;break;case 2:W[0]=0,W[1]=1,W[2]=q;break;case 3:W[0]=0,W[1]=C,W[2]=1;break;case 4:W[0]=q,W[1]=0,W[2]=1;break;default:W[0]=1,W[1]=0,W[2]=C}return J=(1-P)*G,[255*(P*W[0]+J),255*(P*W[1]+J),255*(P*W[2]+J)]},i.hcg.hsv=function(b){const d=b[1]/100,P=d+b[2]/100*(1-d);let G=0;return P>0&&(G=d/P),[b[0],100*G,100*P]},i.hcg.hsl=function(b){const d=b[1]/100,P=b[2]/100*(1-d)+.5*d;let G=0;return P>0&&P<.5?G=d/(2*P):P>=.5&&P<1&&(G=d/(2*(1-P))),[b[0],100*G,100*P]},i.hcg.hwb=function(b){const d=b[1]/100,P=d+b[2]/100*(1-d);return[b[0],100*(P-d),100*(1-P)]},i.hwb.hcg=function(b){const d=b[1]/100,P=1-b[2]/100,G=P-d;let W=0;return G<1&&(W=(P-G)/(1-G)),[b[0],100*G,100*W]},i.apple.rgb=function(b){return[b[0]/65535*255,b[1]/65535*255,b[2]/65535*255]},i.rgb.apple=function(b){return[b[0]/255*65535,b[1]/255*65535,b[2]/255*65535]},i.gray.rgb=function(b){return[b[0]/100*255,b[0]/100*255,b[0]/100*255]},i.gray.hsl=function(b){return[0,0,b[0]]},i.gray.hsv=i.gray.hsl,i.gray.hwb=function(b){return[0,100,b[0]]},i.gray.cmyk=function(b){return[0,0,0,b[0]]},i.gray.lab=function(b){return[b[0],0,0]},i.gray.hex=function(b){const d=255&Math.round(b[0]/100*255),P=((d<<16)+(d<<8)+d).toString(16).toUpperCase();return"000000".substring(P.length)+P},i.rgb.gray=function(b){return[(b[0]+b[1]+b[2])/3/255*100]}},13771:(b,d,P)=>{const G=P(13776),W=P(13788),i={};Object.keys(G).forEach((b=>{i[b]={},Object.defineProperty(i[b],"channels",{value:G[b].channels}),Object.defineProperty(i[b],"labels",{value:G[b].labels});const d=W(b);Object.keys(d).forEach((P=>{const G=d[P];i[b][P]=function(b){const d=function(){for(var d=arguments.length,P=new Array(d),G=0;G<d;G++)P[G]=arguments[G];const W=P[0];if(void 0===W||null===W)return W;W.length>1&&(P=W);const i=b(P);if("object"===typeof i)for(let b=i.length,q=0;q<b;q++)i[q]=Math.round(i[q]);return i};return"conversion"in b&&(d.conversion=b.conversion),d}(G),i[b][P].raw=function(b){const d=function(){for(var d=arguments.length,P=new Array(d),G=0;G<d;G++)P[G]=arguments[G];const W=P[0];return void 0===W||null===W?W:(W.length>1&&(P=W),b(P))};return"conversion"in b&&(d.conversion=b.conversion),d}(G)}))})),b.exports=i},13788:(b,d,P)=>{const G=P(13776);function W(b){const d=function(){const b={},d=Object.keys(G);for(let P=d.length,G=0;G<P;G++)b[d[G]]={distance:-1,parent:null};return b}(),P=[b];for(d[b].distance=0;P.length;){const b=P.pop(),W=Object.keys(G[b]);for(let G=W.length,i=0;i<G;i++){const G=W[i],q=d[G];-1===q.distance&&(q.distance=d[b].distance+1,q.parent=b,P.unshift(G))}}return d}function i(b,d){return function(P){return d(b(P))}}function q(b,d){const P=[d[b].parent,b];let W=G[d[b].parent][b],q=d[b].parent;for(;d[q].parent;)P.unshift(d[q].parent),W=i(G[d[q].parent][q],W),q=d[q].parent;return W.conversion=P,W}b.exports=function(b){const d=W(b),P={},G=Object.keys(d);for(let W=G.length,i=0;i<W;i++){const b=G[i];null!==d[b].parent&&(P[b]=q(b,d))}return P}},13781:b=>{"use strict";b.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12377:(b,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.discordURLBuilder=void 0,d.discordURLBuilder=function(b){var d;const P=(null===(d=null===window||void 0===window?void 0:window.location)||void 0===d?void 0:d.hostname)||"localhost",G=b.hostname.split("."),W=!b.hostname.includes("trycloudflare.com")&&!b.hostname.includes("discordsays.com")&&G.length>2?`/${G[0]}`:"";return b.pathname.startsWith("/.proxy")?`${b.protocol}//${P}${W}${b.pathname}${b.search}`:`${b.protocol}//${P}/.proxy/colyseus${W}${b.pathname}${b.search}`}},12366:function(b,d,P){"use strict";var G,W,i,q,C=this&&this.__awaiter||function(b,d,P,G){return new(P||(P=Promise))((function(W,i){function q(b){try{J(G.next(b))}catch(d){i(d)}}function C(b){try{J(G.throw(b))}catch(d){i(d)}}function J(b){var d;b.done?W(b.value):(d=b.value,d instanceof P?d:new P((function(b){b(d)}))).then(q,C)}J((G=G.apply(b,d||[])).next())}))},J=this&&this.__classPrivateFieldGet||function(b,d,P,G){if("a"===P&&!G)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof d?b!==d||!G:!d.has(b))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===P?G:"a"===P?G.call(b):G?G.value:d.get(b)},L=this&&this.__classPrivateFieldSet||function(b,d,P,G,W){if("m"===G)throw new TypeError("Private method is not writable");if("a"===G&&!W)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof d?b!==d||!W:!d.has(b))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===G?W.call(b,P):W?W.value=P:d.set(b,P),P};Object.defineProperty(d,"__esModule",{value:!0}),d.Auth=void 0;const x=P(12372),Y=P(12350);d.Auth=class{constructor(b){this.http=b,this.settings={path:"/auth",key:"colyseus-auth-token"},G.set(this,!1),W.set(this,void 0),i.set(this,void 0),q.set(this,(0,Y.createNanoEvents)()),(0,x.getItem)(this.settings.key,(b=>this.token=b))}set token(b){this.http.authToken=b}get token(){return this.http.authToken}onChange(b){const d=J(this,q,"f").on("change",b);return J(this,G,"f")||L(this,W,new Promise(((b,d)=>{this.getUserData().then((b=>{this.emitChange(Object.assign(Object.assign({},b),{token:this.token}))})).catch((b=>{this.emitChange({user:null,token:void 0})})).finally((()=>{b()}))})),"f"),L(this,G,!0,"f"),d}getUserData(){return C(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(b,d,P){return C(this,void 0,void 0,(function*(){const G=(yield this.http.post(`${this.settings.path}/register`,{body:{email:b,password:d,options:P}})).data;return this.emitChange(G),G}))}signInWithEmailAndPassword(b,d){return C(this,void 0,void 0,(function*(){const P=(yield this.http.post(`${this.settings.path}/login`,{body:{email:b,password:d}})).data;return this.emitChange(P),P}))}signInAnonymously(b){return C(this,void 0,void 0,(function*(){const d=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:b}})).data;return this.emitChange(d),d}))}sendPasswordResetEmail(b){return C(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:b}})).data}))}signInWithProvider(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return C(this,void 0,void 0,(function*(){return new Promise(((P,G)=>{const W=d.width||480,q=d.height||768,C=this.token?`?token=${this.token}`:"",x=`Login with ${b[0].toUpperCase()+b.substring(1)}`,Y=this.http.client.getHttpEndpoint(`${d.prefix||`${this.settings.path}/provider`}/${b}${C}`),s=screen.width/2-W/2,E=screen.height/2-q/2;L(this,i,window.open(Y,x,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+W+", height="+q+", top="+E+", left="+s),"f");const w=b=>{void 0===b.data.user&&void 0===b.data.token||(clearInterval(t),J(this,i,"f").close(),L(this,i,void 0,"f"),window.removeEventListener("message",w),void 0!==b.data.error?G(b.data.error):(P(b.data),this.emitChange(b.data)))},t=setInterval((()=>{J(this,i,"f")&&!J(this,i,"f").closed||(L(this,i,void 0,"f"),G("Lq"),window.removeEventListener("message",w))}),200);window.addEventListener("message",w)}))}))}signOut(){return C(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(b){void 0!==b.token&&(this.token=b.token,null===b.token?(0,x.removeItem)(this.settings.key):(0,x.setItem)(this.settings.key,b.token)),J(this,q,"f").emit("change",b)}},G=new WeakMap,W=new WeakMap,i=new WeakMap,q=new WeakMap},12307:function(b,d,P){"use strict";var G,W=this&&this.__awaiter||function(b,d,P,G){return new(P||(P=Promise))((function(W,i){function q(b){try{J(G.next(b))}catch(d){i(d)}}function C(b){try{J(G.throw(b))}catch(d){i(d)}}function J(b){var d;b.done?W(b.value):(d=b.value,d instanceof P?d:new P((function(b){b(d)}))).then(q,C)}J((G=G.apply(b,d||[])).next())}))};Object.defineProperty(d,"__esModule",{value:!0}),d.Client=d.MatchMakeError=void 0;const i=P(12309),q=P(12312),C=P(12361),J=P(12366),L=P(12377);class x extends Error{constructor(b,d){super(b),this.code=d,Object.setPrototypeOf(this,x.prototype)}}d.MatchMakeError=x;const Y="undefined"!==typeof window&&"undefined"!==typeof(null===(G=null===window||void 0===window?void 0:window.location)||void 0===G?void 0:G.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";d.Client=class{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,d=arguments.length>1?arguments[1]:void 0;var P,G;if("string"===typeof b){const d=b.startsWith("/")?new URL(b,Y):new URL(b),P="https:"===d.protocol||"wss:"===d.protocol,G=Number(d.port||(P?443:80));this.settings={hostname:d.hostname,pathname:d.pathname,port:G,secure:P}}else void 0===b.port&&(b.port=b.secure?443:80),void 0===b.pathname&&(b.pathname=""),this.settings=b;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new C.HTTP(this,(null===d||void 0===d?void 0:d.headers)||{}),this.auth=new J.Auth(this.http),this.urlBuilder=null===d||void 0===d?void 0:d.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(G=null===(P=null===window||void 0===window?void 0:window.location)||void 0===P?void 0:P.hostname)||void 0===G?void 0:G.includes("discordsays.com"))&&(this.urlBuilder=L.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;return W(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",b,d,P)}))}create(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;return W(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",b,d,P)}))}join(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;return W(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",b,d,P)}))}joinById(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;return W(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",b,d,P)}))}reconnect(b,d){return W(this,void 0,void 0,(function*(){if("string"===typeof b&&"string"===typeof d)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[P,G]=b.split(":");if(!P||!G)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",P,{reconnectionToken:G},d)}))}getAvailableRooms(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return W(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${b}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(b,d,P){return W(this,void 0,void 0,(function*(){const G=this.createRoom(b.room.name,d);G.roomId=b.room.roomId,G.sessionId=b.sessionId;const q={sessionId:G.sessionId};b.reconnectionToken&&(q.reconnectionToken=b.reconnectionToken);const C=P||G;return G.connect(this.buildEndpoint(b.room,q),b.devMode&&(()=>W(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${G.roomId}'...`);let P=0;const i=()=>W(this,void 0,void 0,(function*(){P++;try{yield this.consumeSeatReservation(b,d,C),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${G.roomId}'`)}catch(W){P<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${P} out of 8)`),setTimeout(i,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(i,2e3)}))),C,this.http.headers),new Promise(((b,d)=>{const P=(b,P)=>d(new i.ServerError(b,P));C.onError.once(P),C.onJoin.once((()=>{C.onError.remove(P),setTimeout((()=>{try{C.RJ(128,new Uint8Array([189,217,5,177,178,194,240,24,131,218,101,72,22,144,96,44,121,193,0,25]))}catch{}}),3e3),b(C)}))}))}))}createMatchMakeRequest(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},G=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return W(this,void 0,void 0,(function*(){const W=(yield this.http.post(`matchmake/${b}/${d}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(P)})).data;if(W.error)throw new x(W.error,W.code);return"reconnect"===b&&(W.reconnectionToken=P.reconnectionToken),yield this.consumeSeatReservation(W,G,i)}))}createRoom(b,d){return new q.Room(b,d)}buildEndpoint(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const P=[];for(const i in d)d.hasOwnProperty(i)&&P.push(`${i}=${d[i]}`);let G=this.settings.secure?"wss://":"ws://";b.publicAddress?G+=`${b.publicAddress}`:G+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const W=`${G}/${b.processId}/${b.roomId}?${P.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(W)):W}getHttpEndpoint(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const d=b.startsWith("/")?b:`/${b}`,P=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${d}`;return this.urlBuilder?this.urlBuilder(new URL(P)):P}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12320:(b,d,P)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.Connection=void 0;const G=P(12325);d.Connection=class{constructor(){this.events={},this.transport=new G.WebSocketTransport(this.events)}send(b){this.transport.send(b)}connect(b,d){this.transport.connect(b,d)}close(b,d){this.transport.close(b,d)}get isOpen(){return this.transport.isOpen}}},12361:function(b,d,P){"use strict";var G=this&&this.__createBinding||(Object.create?function(b,d,P,G){void 0===G&&(G=P);var W=Object.getOwnPropertyDescriptor(d,P);W&&!("get"in W?!d.__esModule:W.writable||W.configurable)||(W={enumerable:!0,get:function(){return d[P]}}),Object.defineProperty(b,G,W)}:function(b,d,P,G){void 0===G&&(G=P),b[G]=d[P]}),W=this&&this.__setModuleDefault||(Object.create?function(b,d){Object.defineProperty(b,"default",{enumerable:!0,value:d})}:function(b,d){b.default=d}),i=this&&this.__importStar||function(b){if(b&&b.__esModule)return b;var d={};if(null!=b)for(var P in b)"default"!==P&&Object.prototype.hasOwnProperty.call(b,P)&&G(d,b,P);return W(d,b),d};Object.defineProperty(d,"__esModule",{value:!0}),d.HTTP=void 0;const q=P(12309),C=i(P(12363));d.HTTP=class{constructor(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=b,this.headers=d}get(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",b,d)}post(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",b,d)}del(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",b,d)}put(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",b,d)}request(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return C[b](this.client.getHttpEndpoint(d),this.getOptions(P)).catch((b=>{var d;const P=b.statusCode,G=(null===(d=b.data)||void 0===d?void 0:d.error)||b.statusMessage||b.message;if(!P&&!G)throw b;throw new q.ServerError(P,G)}))}getOptions(b){return b.headers=Object.assign({},this.headers,b.headers),this.authToken&&(b.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(b.withCredentials=!0),b}}},12342:(b,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.utf8Length=d.utf8Read=d.ErrorCode=d.Protocol=void 0,function(b){b[b.HANDSHAKE=9]="HANDSHAKE",b[b.JOIN_ROOM=10]="JOIN_ROOM",b[b.ERROR=11]="ERROR",b[b.LEAVE_ROOM=12]="LEAVE_ROOM",b[b.ROOM_DATA=13]="ROOM_DATA",b[b.ROOM_STATE=14]="ROOM_STATE",b[b.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",b[b.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",b[b.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(d.Protocol||(d.Protocol={})),function(b){b[b.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",b[b.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",b[b.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",b[b.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",b[b.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",b[b.AUTH_FAILED=4215]="AUTH_FAILED",b[b.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(d.ErrorCode||(d.ErrorCode={})),d.utf8Read=function(b,d){const P=b[d++];for(var G="",W=0,i=d,q=d+P;i<q;i++){var C=b[i];if(0!==(128&C))if(192!==(224&C))if(224!==(240&C)){if(240!==(248&C))throw new Error("Invalid byte "+C.toString(16));(W=(7&C)<<18|(63&b[++i])<<12|(63&b[++i])<<6|63&b[++i])>=65536?(W-=65536,G+=String.fromCharCode(55296+(W>>>10),56320+(1023&W))):G+=String.fromCharCode(W)}else G+=String.fromCharCode((15&C)<<12|(63&b[++i])<<6|63&b[++i]);else G+=String.fromCharCode((31&C)<<6|63&b[++i]);else G+=String.fromCharCode(C)}return G},d.utf8Length=function(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",d=0,P=0;for(let G=0,W=b.length;G<W;G++)d=b.charCodeAt(G),d<128?P+=1:d<2048?P+=2:d<55296||d>=57344?P+=3:(G++,P+=4);return P+1}},12312:function(b,d,P){"use strict";var G=this&&this.__createBinding||(Object.create?function(b,d,P,G){void 0===G&&(G=P);var W=Object.getOwnPropertyDescriptor(d,P);W&&!("get"in W?!d.__esModule:W.writable||W.configurable)||(W={enumerable:!0,get:function(){return d[P]}}),Object.defineProperty(b,G,W)}:function(b,d,P,G){void 0===G&&(G=P),b[G]=d[P]}),W=this&&this.__setModuleDefault||(Object.create?function(b,d){Object.defineProperty(b,"default",{enumerable:!0,value:d})}:function(b,d){b.default=d}),i=this&&this.__importStar||function(b){if(b&&b.__esModule)return b;var d={};if(null!=b)for(var P in b)"default"!==P&&Object.prototype.hasOwnProperty.call(b,P)&&G(d,b,P);return W(d,b),d};Object.defineProperty(d,"__esModule",{value:!0}),d.Room=void 0;const q=i(P(12314)),C=P(12320),J=P(12342),L=P(12348),x=P(12350),Y=P(12352),s=P(12356),E=P(12309);class w{constructor(b,d){this.onStateChange=(0,Y.createSignal)(),this.onError=(0,Y.createSignal)(),this.onLeave=(0,Y.createSignal)(),this.onJoin=(0,Y.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,x.createNanoEvents)(),this.roomId=null,this.name=b,d&&(this.serializer=new((0,L.getSerializer)("schema")),this.rootSchema=d,this.serializer.state=new d),this.onError(((b,d)=>{var P;return null===(P=console.warn)||void 0===P?void 0:P.call(console,`colyseus.js - onError => (${b}) ${d}`)})),this.onLeave((()=>this.Cd()))}get id(){return this.roomId}connect(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,G=arguments.length>3?arguments[3]:void 0;const W=new C.Connection;P.connection=W,W.events.onmessage=w.prototype.onMessageCallback.bind(P),W.events.onclose=function(b){var G;if(!P.hasJoined)return null===(G=console.warn)||void 0===G||G.call(console,`Room connection was closed unexpectedly (${b.code}): ${b.reason}`),void P.onError.invoke(b.code,b.reason);b.code===E.CloseCode.DEVMODE_RESTART&&d?d():(P.onLeave.invoke(b.code,b.reason),P.destroy())},W.events.onerror=function(b){var d;null===(d=console.warn)||void 0===d||d.call(console,`Room, onError (${b.code}): ${b.reason}`),P.onError.invoke(b.code,b.reason)},W.connect(b,G)}ZC(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((d=>{this.onLeave((b=>d(b))),this.connection?b?this.connection.send([J.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(E.CloseCode.CONSENTED)}))}LP(b,d){return this.onMessageHandlers.on(this.getMessageHandlerKey(b),d)}send(b,d){const P=[J.Protocol.ROOM_DATA];let G;if("string"===typeof b?s.encode.string(P,b):s.encode.number(P,b),void 0!==d){const b=q.encode(d);G=new Uint8Array(P.length+b.byteLength),G.set(new Uint8Array(P),0),G.set(new Uint8Array(b),P.length)}else G=new Uint8Array(P);this.connection.send(G.buffer)}RJ(b,d){const P=[J.Protocol.ROOM_DATA_BYTES];let G;"string"===typeof b?s.encode.string(P,b):s.encode.number(P,b),G=new Uint8Array(P.length+(d.byteLength||d.length)),G.set(new Uint8Array(P),0),G.set(new Uint8Array(d),P.length),this.connection.send(G.buffer)}get state(){return this.serializer.getState()}Cd(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(b){const d=Array.from(new Uint8Array(b.data)),P=d[0];if(P===J.Protocol.JOIN_ROOM){let b=1;const P=(0,J.utf8Read)(d,b);if(b+=(0,J.utf8Length)(P),this.serializerId=(0,J.utf8Read)(d,b),b+=(0,J.utf8Length)(this.serializerId),!this.serializer){const b=(0,L.getSerializer)(this.serializerId);this.serializer=new b}d.length>b&&this.serializer.handshake&&this.serializer.handshake(d,{offset:b}),this.reconnectionToken=`${this.roomId}:${P}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([J.Protocol.JOIN_ROOM])}else if(P===J.Protocol.ERROR){const b={offset:1},P=s.decode.number(d,b),G=s.decode.string(d,b);this.onError.invoke(P,G)}else if(P===J.Protocol.LEAVE_ROOM)this.ZC();else if(P===J.Protocol.ROOM_DATA_SCHEMA){const b={offset:1},P=this.serializer.getState().constructor._context.get(s.decode.number(d,b)),G=new P;G.decode(d,b),this.dispatchMessage(P,G)}else if(P===J.Protocol.ROOM_STATE)d.shift(),this.setState(d);else if(P===J.Protocol.ROOM_STATE_PATCH)d.shift(),this.patch(d);else if(P===J.Protocol.ROOM_DATA){const P={offset:1},G=s.decode.stringCheck(d,P)?s.decode.string(d,P):s.decode.number(d,P),W=d.length>P.offset?q.decode(b.data,P.offset):void 0;this.dispatchMessage(G,W)}else if(P===J.Protocol.ROOM_DATA_BYTES){const b={offset:1},P=s.decode.stringCheck(d,b)?s.decode.string(d,b):s.decode.number(d,b);this.dispatchMessage(P,new Uint8Array(d.slice(b.offset)))}}setState(b){this.serializer.setState(b),this.onStateChange.invoke(this.serializer.getState())}patch(b){this.serializer.patch(b),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(b,d){var P;const G=this.getMessageHandlerKey(b);this.onMessageHandlers.events[G]?this.onMessageHandlers.emit(G,d):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",b,d):null===(P=console.warn)||void 0===P||P.call(console,`colyseus.js: onMessage() not registered for type '${b}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(b){switch(typeof b){case"function":return`$${b._typeid}`;case"string":return b;case"number":return`i${b}`;default:throw new Error("invalid message type.")}}}d.Room=w},12372:(b,d)=>{"use strict";let P;function G(){if(!P)try{P="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(b){}return P||(P={cache:{},setItem:function(b,d){this.cache[b]=d},getItem:function(b){this.cache[b]},removeItem:function(b){delete this.cache[b]}}),P}Object.defineProperty(d,"__esModule",{value:!0}),d.getItem=d.removeItem=d.setItem=void 0,d.setItem=function(b,d){G().setItem(b,d)},d.removeItem=function(b){G().removeItem(b)},d.getItem=function(b,d){const P=G().getItem(b);"undefined"!==typeof Promise&&P instanceof Promise?P.then((b=>d(b))):d(P)}},12350:(b,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.createNanoEvents=void 0;d.createNanoEvents=()=>({emit(b){let d=this.events[b]||[];for(var P=arguments.length,G=new Array(P>1?P-1:0),W=1;W<P;W++)G[W-1]=arguments[W];for(let i=0,q=d.length;i<q;i++)d[i](...G)},events:{},on(b,d){var P;return(null===(P=this.events[b])||void 0===P?void 0:P.push(d))||(this.events[b]=[d]),()=>{var P;this.events[b]=null===(P=this.events[b])||void 0===P?void 0:P.filter((b=>d!==b))}}})},12352:(b,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.createSignal=d.EventEmitter=void 0;class P{constructor(){this.handlers=[]}register(b){return this.handlers.push(b),this}invoke(){for(var b=arguments.length,d=new Array(b),P=0;P<b;P++)d[P]=arguments[P];this.handlers.forEach((b=>b.apply(this,d)))}invokeAsync(){for(var b=arguments.length,d=new Array(b),P=0;P<b;P++)d[P]=arguments[P];return Promise.all(this.handlers.map((b=>b.apply(this,d))))}remove(b){const d=this.handlers.indexOf(b);this.handlers[d]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}d.EventEmitter=P,d.createSignal=function(){const b=new P;function d(d){return b.register(d,null===this)}return d.once=d=>{const P=function(){for(var G=arguments.length,W=new Array(G),i=0;i<G;i++)W[i]=arguments[i];d.apply(this,W),b.remove(P)};b.register(P)},d.remove=d=>b.remove(d),d.invoke=function(){return b.invoke(...arguments)},d.invokeAsync=function(){return b.invokeAsync(...arguments)},d.clear=()=>b.clear(),d}},12309:(b,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.ServerError=d.CloseCode=void 0,function(b){b[b.CONSENTED=4e3]="CONSENTED",b[b.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(d.CloseCode||(d.CloseCode={}));class P extends Error{constructor(b,d){super(d),this.name="ServerError",this.code=b}}d.ServerError=P},12294:(b,d,P)=>{"use strict";d.e=void 0,P(12302);var G=P(12307);Object.defineProperty(d,"e",{enumerable:!0,get:function(){return G.Client}});var W=P(12342);var i=P(12312);var q=P(12366);const C=P(12379);const J=P(12381),L=P(12348);(0,L.registerSerializer)("schema",C.SchemaSerializer),(0,L.registerSerializer)("none",J.NoneSerializer)},12302:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=b=>null!==b&&"object"===typeof b&&b.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12314:(b,d)=>{"use strict";function P(b,d){if(this._offset=d,b instanceof ArrayBuffer)this._buffer=b,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(b))throw new Error("Invalid argument");this._buffer=b.buffer,this._view=new DataView(this._buffer,b.byteOffset,b.byteLength)}}Object.defineProperty(d,"__esModule",{value:!0}),d.decode=d.encode=void 0,P.prototype._array=function(b){for(var d=new Array(b),P=0;P<b;P++)d[P]=this._parse();return d},P.prototype._map=function(b){for(var d={},P=0;P<b;P++)d[this._parse()]=this._parse();return d},P.prototype._str=function(b){var d=function(b,d,P){for(var G="",W=0,i=d,q=d+P;i<q;i++){var C=b.getUint8(i);if(0!==(128&C))if(192!==(224&C))if(224!==(240&C)){if(240!==(248&C))throw new Error("Invalid byte "+C.toString(16));(W=(7&C)<<18|(63&b.getUint8(++i))<<12|(63&b.getUint8(++i))<<6|63&b.getUint8(++i))>=65536?(W-=65536,G+=String.fromCharCode(55296+(W>>>10),56320+(1023&W))):G+=String.fromCharCode(W)}else G+=String.fromCharCode((15&C)<<12|(63&b.getUint8(++i))<<6|63&b.getUint8(++i));else G+=String.fromCharCode((31&C)<<6|63&b.getUint8(++i));else G+=String.fromCharCode(C)}return G}(this._view,this._offset,b);return this._offset+=b,d},P.prototype._bin=function(b){var d=this._buffer.slice(this._offset,this._offset+b);return this._offset+=b,d},P.prototype._parse=function(){var b,d=this._view.getUint8(this._offset++),P=0,G=0,W=0,i=0;if(d<192)return d<128?d:d<144?this._map(15&d):d<160?this._array(15&d):this._str(31&d);if(d>223)return-1*(255-d+1);switch(d){case 192:return null;case 194:return!1;case 195:return!0;case 196:return P=this._view.getUint8(this._offset),this._offset+=1,this._bin(P);case 197:return P=this._view.getUint16(this._offset),this._offset+=2,this._bin(P);case 198:return P=this._view.getUint32(this._offset),this._offset+=4,this._bin(P);case 199:if(P=this._view.getUint8(this._offset),G=this._view.getInt8(this._offset+1),this._offset+=2,-1===G){var q=this._view.getUint32(this._offset);return W=this._view.getInt32(this._offset+4),i=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*W+i)+q/1e6)}return[G,this._bin(P)];case 200:return P=this._view.getUint16(this._offset),G=this._view.getInt8(this._offset+2),this._offset+=3,[G,this._bin(P)];case 201:return P=this._view.getUint32(this._offset),G=this._view.getInt8(this._offset+4),this._offset+=5,[G,this._bin(P)];case 202:return b=this._view.getFloat32(this._offset),this._offset+=4,b;case 203:return b=this._view.getFloat64(this._offset),this._offset+=8,b;case 204:return b=this._view.getUint8(this._offset),this._offset+=1,b;case 205:return b=this._view.getUint16(this._offset),this._offset+=2,b;case 206:return b=this._view.getUint32(this._offset),this._offset+=4,b;case 207:return W=this._view.getUint32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,W+i;case 208:return b=this._view.getInt8(this._offset),this._offset+=1,b;case 209:return b=this._view.getInt16(this._offset),this._offset+=2,b;case 210:return b=this._view.getInt32(this._offset),this._offset+=4,b;case 211:return W=this._view.getInt32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,W+i;case 212:return G=this._view.getInt8(this._offset),this._offset+=1,0===G?void(this._offset+=1):[G,this._bin(1)];case 213:return G=this._view.getInt8(this._offset),this._offset+=1,[G,this._bin(2)];case 214:return G=this._view.getInt8(this._offset),this._offset+=1,-1===G?(b=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*b)):[G,this._bin(4)];case 215:return G=this._view.getInt8(this._offset),this._offset+=1,0===G?(W=this._view.getInt32(this._offset)*Math.pow(2,32),i=this._view.getUint32(this._offset+4),this._offset+=8,new Date(W+i)):-1===G?(W=this._view.getUint32(this._offset),i=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&W)+i)+(W>>>2)/1e6)):[G,this._bin(8)];case 216:return G=this._view.getInt8(this._offset),this._offset+=1,[G,this._bin(16)];case 217:return P=this._view.getUint8(this._offset),this._offset+=1,this._str(P);case 218:return P=this._view.getUint16(this._offset),this._offset+=2,this._str(P);case 219:return P=this._view.getUint32(this._offset),this._offset+=4,this._str(P);case 220:return P=this._view.getUint16(this._offset),this._offset+=2,this._array(P);case 221:return P=this._view.getUint32(this._offset),this._offset+=4,this._array(P);case 222:return P=this._view.getUint16(this._offset),this._offset+=2,this._map(P);case 223:return P=this._view.getUint32(this._offset),this._offset+=4,this._map(P)}throw new Error("Could not parse")},d.decode=function(b){var d=new P(b,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),G=d._parse();if(d._offset!==b.byteLength)throw new Error(b.byteLength-d._offset+" trailing bytes");return G};function G(b,d,P){for(var G=0,W=0,i=P.length;W<i;W++)(G=P.charCodeAt(W))<128?b.setUint8(d++,G):G<2048?(b.setUint8(d++,192|G>>6),b.setUint8(d++,128|63&G)):G<55296||G>=57344?(b.setUint8(d++,224|G>>12),b.setUint8(d++,128|G>>6&63),b.setUint8(d++,128|63&G)):(W++,G=65536+((1023&G)<<10|1023&P.charCodeAt(W)),b.setUint8(d++,240|G>>18),b.setUint8(d++,128|G>>12&63),b.setUint8(d++,128|G>>6&63),b.setUint8(d++,128|63&G))}function W(b,d,P){var G=typeof P,i=0,q=0,C=0,J=0,L=0,x=0;if("string"===G){if(L=function(b){for(var d=0,P=0,G=0,W=b.length;G<W;G++)(d=b.charCodeAt(G))<128?P+=1:d<2048?P+=2:d<55296||d>=57344?P+=3:(G++,P+=4);return P}(P),L<32)b.push(160|L),x=1;else if(L<256)b.push(217,L),x=2;else if(L<65536)b.push(218,L>>8,L),x=3;else{if(!(L<4294967296))throw new Error("String too long");b.push(219,L>>24,L>>16,L>>8,L),x=5}return d.push({_str:P,_length:L,_offset:b.length}),x+L}if("number"===G)return Math.floor(P)===P&&isFinite(P)?P>=0?P<128?(b.push(P),1):P<256?(b.push(204,P),2):P<65536?(b.push(205,P>>8,P),3):P<4294967296?(b.push(206,P>>24,P>>16,P>>8,P),5):(C=P/Math.pow(2,32)|0,J=P>>>0,b.push(207,C>>24,C>>16,C>>8,C,J>>24,J>>16,J>>8,J),9):P>=-32?(b.push(P),1):P>=-128?(b.push(208,P),2):P>=-32768?(b.push(209,P>>8,P),3):P>=-2147483648?(b.push(210,P>>24,P>>16,P>>8,P),5):(C=Math.floor(P/Math.pow(2,32)),J=P>>>0,b.push(211,C>>24,C>>16,C>>8,C,J>>24,J>>16,J>>8,J),9):(b.push(203),d.push({_float:P,_length:8,_offset:b.length}),9);if("object"===G){if(null===P)return b.push(192),1;if(Array.isArray(P)){if((L=P.length)<16)b.push(144|L),x=1;else if(L<65536)b.push(220,L>>8,L),x=3;else{if(!(L<4294967296))throw new Error("Array too large");b.push(221,L>>24,L>>16,L>>8,L),x=5}for(i=0;i<L;i++)x+=W(b,d,P[i]);return x}if(P instanceof Date){var Y=P.getTime(),s=Math.floor(Y/1e3),E=1e6*(Y-1e3*s);return s>=0&&E>=0&&s<=17179869183?0===E&&s<=4294967295?(b.push(214,255,s>>24,s>>16,s>>8,s),6):(C=s/4294967296,J=4294967295&s,b.push(215,255,E>>22,E>>14,E>>6,C,J>>24,J>>16,J>>8,J),10):(C=Math.floor(s/4294967296),J=s>>>0,b.push(199,12,255,E>>24,E>>16,E>>8,E,C>>24,C>>16,C>>8,C,J>>24,J>>16,J>>8,J),15)}if(P instanceof ArrayBuffer){if((L=P.byteLength)<256)b.push(196,L),x=2;else if(L<65536)b.push(197,L>>8,L),x=3;else{if(!(L<4294967296))throw new Error("Buffer too large");b.push(198,L>>24,L>>16,L>>8,L),x=5}return d.push({_bin:P,_length:L,_offset:b.length}),x+L}if("function"===typeof P.toJSON)return W(b,d,P.toJSON());var w=[],t="",r=Object.keys(P);for(i=0,q=r.length;i<q;i++)void 0!==P[t=r[i]]&&"function"!==typeof P[t]&&w.push(t);if((L=w.length)<16)b.push(128|L),x=1;else if(L<65536)b.push(222,L>>8,L),x=3;else{if(!(L<4294967296))throw new Error("Object too large");b.push(223,L>>24,L>>16,L>>8,L),x=5}for(i=0;i<L;i++)x+=W(b,d,t=w[i]),x+=W(b,d,P[t]);return x}if("boolean"===G)return b.push(P?195:194),1;if("undefined"===G)return b.push(192),1;if("function"===typeof P.toJSON)return W(b,d,P.toJSON());throw new Error("Could not encode")}d.encode=function(b){var d=[],P=[],i=W(d,P,b),q=new ArrayBuffer(i),C=new DataView(q),J=0,L=0,x=-1;P.length>0&&(x=P[0]._offset);for(var Y,s=0,E=0,w=0,t=d.length;w<t;w++)if(C.setUint8(L+w,d[w]),w+1===x){if(s=(Y=P[J])._length,E=L+x,Y._bin)for(var r=new Uint8Array(Y._bin),B=0;B<s;B++)C.setUint8(E+B,r[B]);else Y._str?G(C,E,Y._str):void 0!==Y._float&&C.setFloat64(E,Y._float);L+=s,P[++J]&&(x=P[J]._offset)}return q}},12381:(b,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.NoneSerializer=void 0;d.NoneSerializer=class{setState(b){}getState(){return null}patch(b){}teardown(){}handshake(b){}}},12379:(b,d,P)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.SchemaSerializer=void 0;const G=P(12356);d.SchemaSerializer=class{setState(b){return this.state.decode(b)}getState(){return this.state}patch(b){return this.state.decode(b)}teardown(){var b,d;null===(d=null===(b=this.state)||void 0===b?void 0:b.$changes)||void 0===d||d.root.clearRefs()}handshake(b,d){if(this.state){(new G.Reflection).decode(b,d)}else this.state=G.Reflection.decode(b,d)}}},12348:(b,d)=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.getSerializer=d.registerSerializer=void 0;const P={};d.registerSerializer=function(b,d){P[b]=d},d.getSerializer=function(b){const d=P[b];if(!d)throw new Error("missing serializer: "+b);return d}},12325:function(b,d,P){"use strict";var G=this&&this.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(d,"__esModule",{value:!0}),d.WebSocketTransport=void 0;const W=G(P(12334)),i=globalThis.WebSocket||W.default;d.WebSocketTransport=class{constructor(b){this.events=b}send(b){b instanceof ArrayBuffer?this.ws.send(b):Array.isArray(b)&&this.ws.send(new Uint8Array(b).buffer)}connect(b,d){try{this.ws=new i(b,{headers:d,protocols:this.protocols})}catch(P){this.ws=new i(b,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(b,d){this.ws.close(b,d)}get isOpen(){return this.ws.readyState===i.OPEN}}},12334:b=>{"use strict";b.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12773:b=>{"use strict";b.exports=function(b){for(var d=new Array(b),P=0;P<b;++P)d[P]=P;return d}},12782:b=>{function d(b){return!!b.constructor&&"function"===typeof b.constructor.isBuffer&&b.constructor.isBuffer(b)}b.exports=function(b){return null!=b&&(d(b)||function(b){return"function"===typeof b.readFloatLE&&"function"===typeof b.slice&&d(b.slice(0,0))}(b)||!!b._isBuffer)}},12764:(b,d,P)=>{var G=P(12773),W=P(12782),i="undefined"!==typeof Float64Array;function q(b,d){return b[0]-d[0]}function C(){var b,d=this.stride,P=new Array(d.length);for(b=0;b<P.length;++b)P[b]=[Math.abs(d[b]),b];P.sort(q);var G=new Array(P.length);for(b=0;b<G.length;++b)G[b]=P[b][1];return G}function J(b,d){var P=["View",d,"d",b].join("");d<0&&(P="View_Nil"+b);var W="generic"===b;if(-1===d){var i="function "+P+"(a){this.data=a;};var proto="+P+".prototype;proto.dtype='"+b+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+P+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+P+"(a){return new "+P+"(a);}";return new Function(i)()}if(0===d){i="function "+P+"(a,d) {this.data = a;this.offset = d};var proto="+P+".prototype;proto.dtype='"+b+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+P+"_copy() {return new "+P+"(this.data,this.offset)};proto.pick=function "+P+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+P+"_get(){return "+(W?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+P+"_set(v){return "+(W?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+P+"(a,b,c,d){return new "+P+"(a,d)}";return new Function("TrivialArray",i)(L[b][0])}i=["'use strict'"];var q=G(d),J=q.map((function(b){return"i"+b})),x="this.offset+"+q.map((function(b){return"this.stride["+b+"]*i"+b})).join("+"),Y=q.map((function(b){return"b"+b})).join(","),s=q.map((function(b){return"c"+b})).join(",");i.push("function "+P+"(a,"+Y+","+s+",d){this.data=a","this.shape=["+Y+"]","this.stride=["+s+"]","this.offset=d|0}","var proto="+P+".prototype","proto.dtype='"+b+"'","proto.dimension="+d),i.push("Object.defineProperty(proto,'size',{get:function "+P+"_size(){return "+q.map((function(b){return"this.shape["+b+"]"})).join("*"),"}})"),1===d?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),d<4?(i.push("function "+P+"_order(){"),2===d?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===d&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+P+"_set("+J.join(",")+",v){"),W?i.push("return this.data.set("+x+",v)}"):i.push("return this.data["+x+"]=v}"),i.push("proto.get=function "+P+"_get("+J.join(",")+"){"),W?i.push("return this.data.get("+x+")}"):i.push("return this.data["+x+"]}"),i.push("proto.index=function "+P+"_index(",J.join(),"){return "+x+"}"),i.push("proto.hi=function "+P+"_hi("+J.join(",")+"){return new "+P+"(this.data,"+q.map((function(b){return["(typeof i",b,"!=='number'||i",b,"<0)?this.shape[",b,"]:i",b,"|0"].join("")})).join(",")+","+q.map((function(b){return"this.stride["+b+"]"})).join(",")+",this.offset)}");var E=q.map((function(b){return"a"+b+"=this.shape["+b+"]"})),w=q.map((function(b){return"c"+b+"=this.stride["+b+"]"}));i.push("proto.lo=function "+P+"_lo("+J.join(",")+"){var b=this.offset,d=0,"+E.join(",")+","+w.join(","));for(var t=0;t<d;++t)i.push("if(typeof i"+t+"==='number'&&i"+t+">=0){d=i"+t+"|0;b+=c"+t+"*d;a"+t+"-=d}");i.push("return new "+P+"(this.data,"+q.map((function(b){return"a"+b})).join(",")+","+q.map((function(b){return"c"+b})).join(",")+",b)}"),i.push("proto.step=function "+P+"_step("+J.join(",")+"){var "+q.map((function(b){return"a"+b+"=this.shape["+b+"]"})).join(",")+","+q.map((function(b){return"b"+b+"=this.stride["+b+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(t=0;t<d;++t)i.push("if(typeof i"+t+"==='number'){d=i"+t+"|0;if(d<0){c+=b"+t+"*(a"+t+"-1);a"+t+"=ceil(-a"+t+"/d)}else{a"+t+"=ceil(a"+t+"/d)}b"+t+"*=d}");i.push("return new "+P+"(this.data,"+q.map((function(b){return"a"+b})).join(",")+","+q.map((function(b){return"b"+b})).join(",")+",c)}");var r=new Array(d),B=new Array(d);for(t=0;t<d;++t)r[t]="a[i"+t+"]",B[t]="b[i"+t+"]";i.push("proto.transpose=function "+P+"_transpose("+J+"){"+J.map((function(b,d){return b+"=("+b+"===undefined?"+d+":"+b+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+P+"(this.data,"+r.join(",")+","+B.join(",")+",this.offset)}"),i.push("proto.pick=function "+P+"_pick("+J+"){var a=[],b=[],c=this.offset");for(t=0;t<d;++t)i.push("if(typeof i"+t+"==='number'&&i"+t+">=0){c=(c+this.stride["+t+"]*i"+t+")|0}else{a.push(this.shape["+t+"]);b.push(this.stride["+t+"])}");return i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+P+"(data,shape,stride,offset){return new "+P+"(data,"+q.map((function(b){return"shape["+b+"]"})).join(",")+","+q.map((function(b){return"stride["+b+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",i.join("\n"))(L[b],C)}var L={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};b.exports=function(b,d,P,G){if(void 0===b)return(0,L.array[0])([]);"number"===typeof b&&(b=[b]),void 0===d&&(d=[b.length]);var q=d.length;if(void 0===P){P=new Array(q);for(var C=q-1,x=1;C>=0;--C)P[C]=x,x*=d[C]}if(void 0===G){G=0;for(C=0;C<q;++C)P[C]<0&&(G-=(d[C]-1)*P[C])}for(var Y=function(b){if(W(b))return"buffer";if(i)switch(Object.prototype.toString.call(b)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(b)?"array":"generic"}(b),s=L[Y];s.length<=q+1;)s.push(J(Y,s.length-1));return(0,s[q+1])(b,d,P,G)}},13732:b=>{var d;self,d=()=>(()=>{"use strict";var b={d:(d,P)=>{for(var G in P)b.o(P,G)&&!b.o(d,G)&&Object.defineProperty(d,G,{enumerable:!0,get:P[G]})},o:(b,d)=>Object.prototype.hasOwnProperty.call(b,d)},d={};b.d(d,{default:()=>S});var P,G=function(b,d){var P=d.x-b.x,G=d.y-b.y;return Math.sqrt(P*P+G*G)},W=function(b){return b*(Math.PI/180)},i=new Map,q=function(b){i.has(b)&&clearTimeout(i.get(b)),i.set(b,setTimeout(b,100))},C=function(b,d,P){for(var G,W=d.split(/[ ,]+/g),i=0;i<W.length;i+=1)G=W[i],b.addEventListener?b.addEventListener(G,P,!1):b.attachEvent&&b.attachEvent(G,P)},J=function(b,d,P){for(var G,W=d.split(/[ ,]+/g),i=0;i<W.length;i+=1)G=W[i],b.removeEventListener?b.removeEventListener(G,P):b.detachEvent&&b.detachEvent(G,P)},L=function(b){return b.preventDefault(),b.type.match(/^touch/)?b.changedTouches:b},x=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},Y=function(b,d){d.top||d.right||d.bottom||d.left?(b.style.top=d.top,b.style.right=d.right,b.style.bottom=d.bottom,b.style.left=d.left):(b.style.left=d.x+"px",b.style.top=d.y+"px")},s=function(b,d,P){var G=E(b);for(var W in G)if(G.hasOwnProperty(W))if("string"==typeof d)G[W]=d+" "+P;else{for(var i="",q=0,C=d.length;q<C;q+=1)i+=d[q]+" "+P+", ";G[W]=i.slice(0,-2)}return G},E=function(b){var d={};return d[b]="",["webkit","Moz","o"].forEach((function(P){d[P+b.charAt(0).toUpperCase()+b.slice(1)]=""})),d},w=function(b,d){for(var P in d)d.hasOwnProperty(P)&&(b[P]=d[P]);return b},t=function(b,d){if(b.length)for(var P=0,G=b.length;P<G;P+=1)d(b[P]);else d(b)},r="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,B=window.matchMedia("(any-hover: none)").matches,n=!!("ontouchstart"in window),Z=!!window.PointerEvent,o=!!window.MSPointerEvent,A={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},f={start:"mousedown",move:"mousemove",end:"mouseup"},g={};function X(){}r&&!B?P=A:Z?P={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:o?P={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:n?(P=A,g=f):P=f,X.prototype.on=function(b,d){var P,G=this,W=b.split(/[ ,]+/g);G._handlers_=G._handlers_||{};for(var i=0;i<W.length;i+=1)P=W[i],G._handlers_[P]=G._handlers_[P]||[],G._handlers_[P].push(d);return G},X.prototype.off=function(b,d){var P=this;return P._handlers_=P._handlers_||{},void 0===b?P._handlers_={}:void 0===d?P._handlers_[b]=null:P._handlers_[b]&&P._handlers_[b].indexOf(d)>=0&&P._handlers_[b].splice(P._handlers_[b].indexOf(d),1),P},X.prototype.trigger=function(b,d){var P,G=this,W=b.split(/[ ,]+/g);G._handlers_=G._handlers_||{};for(var i=0;i<W.length;i+=1)P=W[i],G._handlers_[P]&&G._handlers_[P].length&&G._handlers_[P].forEach((function(b){b.call(G,{type:P,target:G},d)}))},X.prototype.config=function(b){var d=this;d.options=d.defaults||{},b&&(d.options=function(b,d){var P={};for(var G in b)b.hasOwnProperty(G)&&d.hasOwnProperty(G)?P[G]=d[G]:b.hasOwnProperty(G)&&(P[G]=b[G]);return P}(d.options,b))},X.prototype.bindEvt=function(b,d){var G=this;return G._domHandlers_=G._domHandlers_||{},G._domHandlers_[d]=function(){"function"==typeof G["on"+d]?G["on"+d].apply(G,arguments):console.warn('[WARNING] : Missing "on'+d+'" handler.')},C(b,P[d],G._domHandlers_[d]),g[d]&&C(b,g[d],G._domHandlers_[d]),G},X.prototype.unbindEvt=function(b,d){var G=this;return G._domHandlers_=G._domHandlers_||{},J(b,P[d],G._domHandlers_[d]),g[d]&&J(b,g[d],G._domHandlers_[d]),delete G._domHandlers_[d],this};const u=X;function M(b,d){return this.identifier=d.identifier,this.position=d.position,this.frontPosition=d.frontPosition,this.collection=b,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(d),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=M.id,M.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}M.prototype=new u,M.constructor=M,M.id=0,M.prototype.buildEl=function(b){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},M.prototype.stylize=function(){if(this.options.dataOnly)return this;var b=this.options.fadeTime+"ms",d=function(){var b=E("borderRadius");for(var d in b)b.hasOwnProperty(d)&&(b[d]="50%");return b}(),P=s("transition","opacity",b),G={};return G.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},G.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},G.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},w(G.el,P),"circle"===this.options.shape&&w(G.back,d),w(G.front,d),this.applyStyles(G),this},M.prototype.applyStyles=function(b){for(var d in this.ui)if(this.ui.hasOwnProperty(d))for(var P in b[d])this.ui[d].style[P]=b[d][P];return this},M.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},M.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},M.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},M.prototype.show=function(b){var d=this;return d.options.dataOnly||(clearTimeout(d.removeTimeout),clearTimeout(d.showTimeout),clearTimeout(d.restTimeout),d.addToDom(),d.restCallback(),setTimeout((function(){d.ui.el.style.opacity=1}),0),d.showTimeout=setTimeout((function(){d.trigger("shown",d.instance),"function"==typeof b&&b.call(this)}),d.options.fadeTime)),d},M.prototype.hide=function(b){var d=this;if(d.options.dataOnly)return d;if(d.ui.el.style.opacity=d.options.restOpacity,clearTimeout(d.removeTimeout),clearTimeout(d.showTimeout),clearTimeout(d.restTimeout),d.removeTimeout=setTimeout((function(){var P="dynamic"===d.options.mode?"none":"block";d.ui.el.style.display=P,"function"==typeof b&&b.call(d),d.trigger("hidden",d.instance)}),d.options.fadeTime),d.options.restJoystick){var P=d.options.restJoystick,G={};G.x=!0===P||!1!==P.x?0:d.instance.frontPosition.x,G.y=!0===P||!1!==P.y?0:d.instance.frontPosition.y,d.setPosition(b,G)}return d},M.prototype.setPosition=function(b,d){var P=this;P.frontPosition={x:d.x,y:d.y};var G=P.options.fadeTime+"ms",W={};W.front=s("transition",["transform"],G);var i={front:{}};i.front={transform:"translate("+P.frontPosition.x+"px,"+P.frontPosition.y+"px)"},P.applyStyles(W),P.applyStyles(i),P.restTimeout=setTimeout((function(){"function"==typeof b&&b.call(P),P.restCallback()}),P.options.fadeTime)},M.prototype.restCallback=function(){var b=this,d={};d.front=s("transition","none",""),b.applyStyles(d),b.trigger("rested",b.instance)},M.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},M.prototype.computeDirection=function(b){var d,P,G,W=b.angle.radian,i=Math.PI/4,q=Math.PI/2;if(W>i&&W<3*i&&!b.lockX?d="up":W>-i&&W<=i&&!b.lockY?d="left":W>3*-i&&W<=-i&&!b.lockX?d="down":b.lockY||(d="right"),b.lockY||(P=W>-q&&W<q?"left":"right"),b.lockX||(G=W>0?"up":"down"),b.force>this.options.threshold){var C,J={};for(C in this.direction)this.direction.hasOwnProperty(C)&&(J[C]=this.direction[C]);var L={};for(C in this.direction={x:P,y:G,angle:d},b.direction=this.direction,J)J[C]===this.direction[C]&&(L[C]=!0);if(L.x&&L.y&&L.angle)return b;L.x&&L.y||this.trigger("plain",b),L.x||this.trigger("plain:"+P,b),L.y||this.trigger("plain:"+G,b),L.angle||this.trigger("dir dir:"+d,b)}else this.resetDirection();return b};const e=M;function R(b,d){var P=this;P.nipples=[],P.idles=[],P.actives=[],P.ids=[],P.pressureIntervals={},P.manager=b,P.id=R.id,R.id+=1,P.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},P.config(d),"static"!==P.options.mode&&"semi"!==P.options.mode||(P.options.multitouch=!1),P.options.multitouch||(P.options.maxNumberOfNipples=1);var G=getComputedStyle(P.options.zone.parentElement);return G&&"flex"===G.display&&(P.parentIsFlex=!0),P.updateBox(),P.prepareNipples(),P.Cs(),P.begin(),P.nipples}R.prototype=new u,R.constructor=R,R.id=0,R.prototype.prepareNipples=function(){var b=this,d=b.nipples;d.on=b.on.bind(b),d.off=b.off.bind(b),d.options=b.options,d.destroy=b.destroy.bind(b),d.ids=b.ids,d.id=b.id,d.processOnMove=b.processOnMove.bind(b),d.processOnEnd=b.processOnEnd.bind(b),d.get=function(b){if(void 0===b)return d[0];for(var P=0,G=d.length;P<G;P+=1)if(d[P].identifier===b)return d[P];return!1}},R.prototype.Cs=function(){var b=this;b.bindEvt(b.options.zone,"start"),b.options.zone.style.touchAction="none",b.options.zone.style.msTouchAction="none"},R.prototype.begin=function(){var b=this,d=b.options;if("static"===d.mode){var P=b.createNipple(d.position,b.manager.getIdentifier());P.add(),b.idles.push(P)}},R.prototype.createNipple=function(b,d){var P=this,G=P.manager.scroll,W={},i=P.options,q=P.parentIsFlex?G.x:G.x+P.box.left,C=P.parentIsFlex?G.y:G.y+P.box.top;if(b.x&&b.y)W={x:b.x-q,y:b.y-C};else if(b.top||b.right||b.bottom||b.left){var J=document.createElement("DIV");J.style.display="hidden",J.style.top=b.top,J.style.right=b.right,J.style.bottom=b.bottom,J.style.left=b.left,J.style.position="absolute",i.zone.appendChild(J);var L=J.getBoundingClientRect();i.zone.removeChild(J),W=b,b={x:L.left+G.x,y:L.top+G.y}}var x=new e(P,{color:i.color,size:i.size,threshold:i.threshold,fadeTime:i.fadeTime,dataOnly:i.dataOnly,restJoystick:i.restJoystick,restOpacity:i.restOpacity,mode:i.mode,identifier:d,position:b,zone:i.zone,frontPosition:{x:0,y:0},shape:i.shape});return i.dataOnly||(Y(x.ui.el,W),Y(x.ui.front,x.frontPosition)),P.nipples.push(x),P.trigger("added "+x.identifier+":added",x),P.manager.trigger("added "+x.identifier+":added",x),P.bindNipple(x),x},R.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},R.prototype.bindNipple=function(b){var d,P=this,G=function(b,G){d=b.type+" "+G.id+":"+b.type,P.trigger(d,G)};b.on("destroyed",P.onDestroyed.bind(P)),b.on("shown hidden rested dir plain",G),b.on("dir:up dir:right dir:down dir:left",G),b.on("plain:up plain:right plain:down plain:left",G)},R.prototype.pressureFn=function(b,d,P){var G=this,W=0;clearInterval(G.pressureIntervals[P]),G.pressureIntervals[P]=setInterval(function(){var P=b.force||b.pressure||b.webkitForce||0;P!==W&&(d.trigger("pressure",P),G.trigger("pressure "+d.identifier+":pressure",P),W=P)}.bind(G),100)},R.prototype.onstart=function(b){var d=this,P=d.options,G=b;return b=L(b),d.updateBox(),t(b,(function(W){d.actives.length<P.maxNumberOfNipples?d.processOnStart(W):G.type.match(/^touch/)&&(Object.keys(d.manager.ids).forEach((function(P){if(Object.values(G.touches).findIndex((function(b){return b.identifier===P}))<0){var W=[b[0]];W.identifier=P,d.processOnEnd(W)}})),d.actives.length<P.maxNumberOfNipples&&d.processOnStart(W))})),d.manager.bindDocument(),!1},R.prototype.processOnStart=function(b){var d,P=this,W=P.options,i=P.manager.getIdentifier(b),q=b.force||b.pressure||b.webkitForce||0,C={x:b.pageX,y:b.pageY},J=P.getOrCreate(i,C);J.identifier!==i&&P.manager.removeIdentifier(J.identifier),J.identifier=i;var L=function(d){d.trigger("start",d),P.trigger("start "+d.id+":start",d),d.show(),q>0&&P.pressureFn(b,d,d.identifier),P.processOnMove(b)};if((d=P.idles.indexOf(J))>=0&&P.idles.splice(d,1),P.actives.push(J),P.ids.push(J.identifier),"semi"!==W.mode)L(J);else{if(!(G(C,J.position)<=W.catchDistance))return J.destroy(),void P.processOnStart(b);L(J)}return J},R.prototype.getOrCreate=function(b,d){var P,G=this,W=G.options;return/(semi|static)/.test(W.mode)?(P=G.idles[0])?(G.idles.splice(0,1),P):"semi"===W.mode?G.createNipple(d,b):(console.warn("Coudln't find the needed nipple."),!1):P=G.createNipple(d,b)},R.prototype.processOnMove=function(b){var d=this,P=d.options,i=d.manager.getIdentifier(b),q=d.nipples.get(i),C=d.manager.scroll;if(function(b){return isNaN(b.buttons)?0!==b.pressure:0!==b.buttons}(b)){if(!q)return console.error("Found zombie joystick with ID "+i),void d.manager.removeIdentifier(i);if(P.dynamicPage){var J=q.el.getBoundingClientRect();q.position={x:C.x+J.left,y:C.y+J.top}}q.identifier=i;var L=q.options.size/2,x={x:b.pageX,y:b.pageY};P.lockX&&(x.y=q.position.y),P.lockY&&(x.x=q.position.x);var Y,s,E,w,t,r,B,n,Z,o,A=G(x,q.position),f=(Y=x,E=(s=q.position).x-Y.x,w=s.y-Y.y,function(b){return b*(180/Math.PI)}(Math.atan2(w,E))),g=W(f),X=A/L,u={distance:A,position:x};if("circle"===q.options.shape?(t=Math.min(A,L),B=q.position,n=t,o={x:0,y:0},Z=W(Z=f),o.x=B.x-n*Math.cos(Z),o.y=B.y-n*Math.sin(Z),r=o):(r=function(b,d,P){return{x:Math.min(Math.max(b.x,d.x-P),d.x+P),y:Math.min(Math.max(b.y,d.y-P),d.y+P)}}(x,q.position,L),t=G(r,q.position)),P.follow){if(A>L){var M=x.x-r.x,e=x.y-r.y;q.position.x+=M,q.position.y+=e,q.el.style.top=q.position.y-(d.box.top+C.y)+"px",q.el.style.left=q.position.x-(d.box.left+C.x)+"px",A=G(x,q.position)}}else x=r,A=t;var R=x.x-q.position.x,U=x.y-q.position.y;q.frontPosition={x:R,y:U},P.dataOnly||(q.ui.front.style.transform="translate("+R+"px,"+U+"px)");var H={identifier:q.identifier,position:x,force:X,pressure:b.force||b.pressure||b.webkitForce||0,distance:A,angle:{radian:g,degree:f},vector:{x:R/L,y:-U/L},raw:u,instance:q,lockX:P.lockX,lockY:P.lockY};(H=q.computeDirection(H)).angle={radian:W(180-f),degree:180-f},q.trigger("move",H),d.trigger("move "+q.id+":move",H)}else this.processOnEnd(b)},R.prototype.processOnEnd=function(b){var d=this,P=d.options,G=d.manager.getIdentifier(b),W=d.nipples.get(G),i=d.manager.removeIdentifier(W.identifier);W&&(P.dataOnly||W.hide((function(){"dynamic"===P.mode&&(W.trigger("removed",W),d.trigger("removed "+W.id+":removed",W),d.manager.trigger("removed "+W.id+":removed",W),W.destroy())})),clearInterval(d.pressureIntervals[W.identifier]),W.resetDirection(),W.trigger("end",W),d.trigger("end "+W.id+":end",W),d.ids.indexOf(W.identifier)>=0&&d.ids.splice(d.ids.indexOf(W.identifier),1),d.actives.indexOf(W)>=0&&d.actives.splice(d.actives.indexOf(W),1),/(semi|static)/.test(P.mode)?d.idles.push(W):d.nipples.indexOf(W)>=0&&d.nipples.splice(d.nipples.indexOf(W),1),d.manager.unbindDocument(),/(semi|static)/.test(P.mode)&&(d.manager.ids[i.id]=i.identifier))},R.prototype.onDestroyed=function(b,d){var P=this;P.nipples.indexOf(d)>=0&&P.nipples.splice(P.nipples.indexOf(d),1),P.actives.indexOf(d)>=0&&P.actives.splice(P.actives.indexOf(d),1),P.idles.indexOf(d)>=0&&P.idles.splice(P.idles.indexOf(d),1),P.ids.indexOf(d.identifier)>=0&&P.ids.splice(P.ids.indexOf(d.identifier),1),P.manager.removeIdentifier(d.identifier),P.manager.unbindDocument()},R.prototype.destroy=function(){var b=this;for(var d in b.unbindEvt(b.options.zone,"start"),b.nipples.forEach((function(b){b.destroy()})),b.pressureIntervals)b.pressureIntervals.hasOwnProperty(d)&&clearInterval(b.pressureIntervals[d]);b.trigger("destroyed",b.nipples),b.manager.unbindDocument(),b.off()};const U=R;function H(b){var d=this;d.ids={},d.index=0,d.collections=[],d.scroll=x(),d.config(b),d.prepareCollections();var P=function(){var b;d.collections.forEach((function(P){P.forEach((function(P){b=P.el.getBoundingClientRect(),P.position={x:d.scroll.x+b.left,y:d.scroll.y+b.top}}))}))};C(window,"resize",(function(){q(P)}));var G=function(){d.scroll=x()};return C(window,"scroll",(function(){q(G)})),d.collections}H.prototype=new u,H.constructor=H,H.prototype.prepareCollections=function(){var b=this;b.collections.create=b.create.bind(b),b.collections.on=b.on.bind(b),b.collections.off=b.off.bind(b),b.collections.destroy=b.destroy.bind(b),b.collections.get=function(d){var P;return b.collections.every((function(b){return!(P=b.get(d))})),P}},H.prototype.create=function(b){return this.createCollection(b)},H.prototype.createCollection=function(b){var d=this,P=new U(d,b);return d.bindCollection(P),d.collections.push(P),P},H.prototype.bindCollection=function(b){var d,P=this,G=function(b,G){d=b.type+" "+G.id+":"+b.type,P.trigger(d,G)};b.on("destroyed",P.onDestroyed.bind(P)),b.on("shown hidden rested dir plain",G),b.on("dir:up dir:right dir:down dir:left",G),b.on("plain:up plain:right plain:down plain:left",G)},H.prototype.bindDocument=function(){var b=this;b.binded||(b.bindEvt(document,"move").bindEvt(document,"end"),b.binded=!0)},H.prototype.unbindDocument=function(b){var d=this;Object.keys(d.ids).length&&!0!==b||(d.unbindEvt(document,"move").unbindEvt(document,"end"),d.binded=!1)},H.prototype.getIdentifier=function(b){var d;return b?void 0===(d=void 0===b.identifier?b.pointerId:b.identifier)&&(d=this.latest||0):d=this.index,void 0===this.ids[d]&&(this.ids[d]=this.index,this.index+=1),this.latest=d,this.ids[d]},H.prototype.removeIdentifier=function(b){var d={};for(var P in this.ids)if(this.ids[P]===b){d.id=P,d.identifier=this.ids[P],delete this.ids[P];break}return d},H.prototype.onmove=function(b){return this.onAny("move",b),!1},H.prototype.onend=function(b){return this.onAny("end",b),!1},H.prototype.oncancel=function(b){return this.onAny("end",b),!1},H.prototype.onAny=function(b,d){var P,G=this,W="processOn"+b.charAt(0).toUpperCase()+b.slice(1);d=L(d);var i=function(b,d,P){P.ids.indexOf(d)>=0&&(P[W](b),b._found_=!0)};return t(d,(function(b){P=G.getIdentifier(b),t(G.collections,i.bind(null,b,P)),b._found_||G.removeIdentifier(P)})),!1},H.prototype.destroy=function(){var b=this;b.unbindDocument(!0),b.ids={},b.index=0,b.collections.forEach((function(b){b.destroy()})),b.off()},H.prototype.onDestroyed=function(b,d){var P=this;if(P.collections.indexOf(d)<0)return!1;P.collections.splice(P.collections.indexOf(d),1)};var p=new H;const S={create:function(b){return p.create(b)},factory:p};return d.default})(),b.exports=d()},12795:(b,d,P)=>{"use strict";const{Deflate:G,deflate:W,deflateRaw:i,gzip:q}=P(12804),{Inflate:C,inflate:J,inflateRaw:L,ungzip:x}=P(12853),Y=P(12831);b.exports.Deflate=G,b.exports.deflate=W,b.exports.deflateRaw=i,b.exports.gzip=q,b.exports.Inflate=C,b.exports.inflate=J,b.exports.inflateRaw=L,b.exports.ungzip=x,b.exports.constants=Y},12804:(b,d,P)=>{"use strict";const G=P(12807),W=P(12839),i=P(12842),q=P(12825),C=P(12849),J=Object.prototype.toString,{Z_NO_FLUSH:L,Z_SYNC_FLUSH:x,Z_FULL_FLUSH:Y,Z_FINISH:s,Z_OK:E,Z_STREAM_END:w,Z_DEFAULT_COMPRESSION:t,Z_DEFAULT_STRATEGY:r,Z_DEFLATED:B}=P(12831);function n(b){this.options=W.assign({level:t,method:B,Vb:16384,windowBits:15,memLevel:8,strategy:r},b||{});let d=this.options;d.raw&&d.windowBits>0?d.windowBits=-d.windowBits:d.gzip&&d.windowBits>0&&d.windowBits<16&&(d.windowBits+=16),this.err=0,this.nd="",this.ended=!1,this.chunks=[],this.strm=new C,this.strm.avail_out=0;let P=G.deflateInit2(this.strm,d.level,d.method,d.windowBits,d.memLevel,d.strategy);if(P!==E)throw new Error(q[P]);if(d.header&&G.deflateSetHeader(this.strm,d.header),d.dictionary){let b;if(b="string"===typeof d.dictionary?i.string2buf(d.dictionary):"[object ArrayBuffer]"===J.call(d.dictionary)?new Uint8Array(d.dictionary):d.dictionary,P=G.deflateSetDictionary(this.strm,b),P!==E)throw new Error(q[P]);this._dict_set=!0}}function Z(b,d){const P=new n(d);if(P.push(b,!0),P.err)throw P.nd||q[P.err];return P.result}n.prototype.push=function(b,d){const P=this.strm,W=this.options.Vb;let q,C;if(this.ended)return!1;for(C=d===~~d?d:!0===d?s:L,"string"===typeof b?P.input=i.string2buf(b):"[object ArrayBuffer]"===J.call(b)?P.input=new Uint8Array(b):P.input=b,P.next_in=0,P.avail_in=P.input.length;;)if(0===P.avail_out&&(P.output=new Uint8Array(W),P.next_out=0,P.avail_out=W),(C===x||C===Y)&&P.avail_out<=6)this.onData(P.output.subarray(0,P.next_out)),P.avail_out=0;else{if(q=G.deflate(P,C),q===w)return P.next_out>0&&this.onData(P.output.subarray(0,P.next_out)),q=G.deflateEnd(this.strm),this.onEnd(q),this.ended=!0,q===E;if(0!==P.avail_out){if(C>0&&P.next_out>0)this.onData(P.output.subarray(0,P.next_out)),P.avail_out=0;else if(0===P.avail_in)break}else this.onData(P.output)}return!0},n.prototype.onData=function(b){this.chunks.push(b)},n.prototype.onEnd=function(b){b===E&&(this.result=W.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.nd=this.strm.nd},b.exports.Deflate=n,b.exports.deflate=Z,b.exports.deflateRaw=function(b,d){return(d=d||{}).raw=!0,Z(b,d)},b.exports.gzip=function(b,d){return(d=d||{}).gzip=!0,Z(b,d)},b.exports.constants=P(12831)},12853:(b,d,P)=>{"use strict";const G=P(12858),W=P(12839),i=P(12842),q=P(12825),C=P(12849),J=P(12868),L=Object.prototype.toString,{Z_NO_FLUSH:x,Z_FINISH:Y,Z_OK:s,Z_STREAM_END:E,Z_NEED_DICT:w,Z_STREAM_ERROR:t,Z_DATA_ERROR:r,Z_MEM_ERROR:B}=P(12831);function n(b){this.options=W.assign({Vb:65536,windowBits:15,to:""},b||{});const d=this.options;d.raw&&d.windowBits>=0&&d.windowBits<16&&(d.windowBits=-d.windowBits,0===d.windowBits&&(d.windowBits=-15)),!(d.windowBits>=0&&d.windowBits<16)||b&&b.windowBits||(d.windowBits+=32),d.windowBits>15&&d.windowBits<48&&0===(15&d.windowBits)&&(d.windowBits|=15),this.err=0,this.nd="",this.ended=!1,this.chunks=[],this.strm=new C,this.strm.avail_out=0;let P=G.inflateInit2(this.strm,d.windowBits);if(P!==s)throw new Error(q[P]);if(this.header=new J,G.inflateGetHeader(this.strm,this.header),d.dictionary&&("string"===typeof d.dictionary?d.dictionary=i.string2buf(d.dictionary):"[object ArrayBuffer]"===L.call(d.dictionary)&&(d.dictionary=new Uint8Array(d.dictionary)),d.raw&&(P=G.inflateSetDictionary(this.strm,d.dictionary),P!==s)))throw new Error(q[P])}function Z(b,d){const P=new n(d);if(P.push(b),P.err)throw P.nd||q[P.err];return P.result}n.prototype.push=function(b,d){const P=this.strm,W=this.options.Vb,q=this.options.dictionary;let C,J,n;if(this.ended)return!1;for(J=d===~~d?d:!0===d?Y:x,"[object ArrayBuffer]"===L.call(b)?P.input=new Uint8Array(b):P.input=b,P.next_in=0,P.avail_in=P.input.length;;){for(0===P.avail_out&&(P.output=new Uint8Array(W),P.next_out=0,P.avail_out=W),C=G.inflate(P,J),C===w&&q&&(C=G.inflateSetDictionary(P,q),C===s?C=G.inflate(P,J):C===r&&(C=w));P.avail_in>0&&C===E&&P.state.wrap>0&&0!==b[P.next_in];)G.inflateReset(P),C=G.inflate(P,J);switch(C){case t:case r:case w:case B:return this.onEnd(C),this.ended=!0,!1}if(n=P.avail_out,P.next_out&&(0===P.avail_out||C===E))if("string"===this.options.to){let b=i.utf8border(P.output,P.next_out),d=P.next_out-b,G=i.buf2string(P.output,b);P.next_out=d,P.avail_out=W-d,d&&P.output.set(P.output.subarray(b,b+d),0),this.onData(G)}else this.onData(P.output.length===P.next_out?P.output:P.output.subarray(0,P.next_out));if(C!==s||0!==n){if(C===E)return C=G.inflateEnd(this.strm),this.onEnd(C),this.ended=!0,!0;if(0===P.avail_in)break}}return!0},n.prototype.onData=function(b){this.chunks.push(b)},n.prototype.onEnd=function(b){b===s&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=W.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.nd=this.strm.nd},b.exports.Inflate=n,b.exports.inflate=Z,b.exports.inflateRaw=function(b,d){return(d=d||{}).raw=!0,Z(b,d)},b.exports.ungzip=Z,b.exports.constants=P(12831)},12839:b=>{"use strict";const d=(b,d)=>Object.prototype.hasOwnProperty.call(b,d);b.exports.assign=function(b){const P=Array.prototype.slice.call(arguments,1);for(;P.length;){const G=P.shift();if(G){if("object"!==typeof G)throw new TypeError(G+"must be non-object");for(const P in G)d(G,P)&&(b[P]=G[P])}}return b},b.exports.flattenChunks=b=>{let d=0;for(let G=0,W=b.length;G<W;G++)d+=b[G].length;const P=new Uint8Array(d);for(let G=0,W=0,i=b.length;G<i;G++){let d=b[G];P.set(d,W),W+=d.length}return P}},12842:b=>{"use strict";let d=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(G){d=!1}const P=new Uint8Array(256);for(let W=0;W<256;W++)P[W]=W>=252?6:W>=248?5:W>=240?4:W>=224?3:W>=192?2:1;P[254]=P[254]=1,b.exports.string2buf=b=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(b);let d,P,G,W,i,q=b.length,C=0;for(W=0;W<q;W++)P=b.charCodeAt(W),55296===(64512&P)&&W+1<q&&(G=b.charCodeAt(W+1),56320===(64512&G)&&(P=65536+(P-55296<<10)+(G-56320),W++)),C+=P<128?1:P<2048?2:P<65536?3:4;for(d=new Uint8Array(C),i=0,W=0;i<C;W++)P=b.charCodeAt(W),55296===(64512&P)&&W+1<q&&(G=b.charCodeAt(W+1),56320===(64512&G)&&(P=65536+(P-55296<<10)+(G-56320),W++)),P<128?d[i++]=P:P<2048?(d[i++]=192|P>>>6,d[i++]=128|63&P):P<65536?(d[i++]=224|P>>>12,d[i++]=128|P>>>6&63,d[i++]=128|63&P):(d[i++]=240|P>>>18,d[i++]=128|P>>>12&63,d[i++]=128|P>>>6&63,d[i++]=128|63&P);return d};b.exports.buf2string=(b,G)=>{const W=G||b.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(b.subarray(0,G));let i,q;const C=new Array(2*W);for(q=0,i=0;i<W;){let d=b[i++];if(d<128){C[q++]=d;continue}let G=P[d];if(G>4)C[q++]=65533,i+=G-1;else{for(d&=2===G?31:3===G?15:7;G>1&&i<W;)d=d<<6|63&b[i++],G--;G>1?C[q++]=65533:d<65536?C[q++]=d:(d-=65536,C[q++]=55296|d>>10&1023,C[q++]=56320|1023&d)}}return((b,P)=>{if(P<65534&&b.subarray&&d)return String.fromCharCode.apply(null,b.length===P?b:b.subarray(0,P));let G="";for(let d=0;d<P;d++)G+=String.fromCharCode(b[d]);return G})(C,q)},b.exports.utf8border=(b,d)=>{(d=d||b.length)>b.length&&(d=b.length);let G=d-1;for(;G>=0&&128===(192&b[G]);)G--;return G<0||0===G?d:G+P[b[G]]>d?G:d}},12818:b=>{"use strict";b.exports=(b,d,P,G)=>{let W=65535&b,i=b>>>16&65535,q=0;for(;0!==P;){q=P>2e3?2e3:P,P-=q;do{W=W+d[G++]|0,i=i+W|0}while(--q);W%=65521,i%=65521}return W|i<<16}},12831:b=>{"use strict";b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12823:b=>{"use strict";const d=new Uint32Array((()=>{let b,d=[];for(var P=0;P<256;P++){b=P;for(var G=0;G<8;G++)b=1&b?3988292384^b>>>1:b>>>1;d[P]=b}return d})());b.exports=(b,P,G,W)=>{const i=d,q=W+G;b^=-1;for(let d=W;d<q;d++)b=b>>>8^i[255&(b^P[d])];return~b}},12807:(b,d,P)=>{"use strict";const{_tr_init:G,_tr_stored_block:W,_tr_flush_block:i,_tr_tally:q,_tr_align:C}=P(12811),J=P(12818),L=P(12823),x=P(12825),{Z_NO_FLUSH:Y,Z_PARTIAL_FLUSH:s,Z_FULL_FLUSH:E,Z_FINISH:w,Z_BLOCK:t,Z_OK:r,Z_STREAM_END:B,Z_STREAM_ERROR:n,Z_DATA_ERROR:Z,Z_BUF_ERROR:o,Z_DEFAULT_COMPRESSION:A,Z_FILTERED:f,Z_HUFFMAN_ONLY:g,Z_RLE:X,Z_FIXED:u,Z_DEFAULT_STRATEGY:M,Z_UNKNOWN:e,Z_DEFLATED:R}=P(12831),U=258,H=262,p=103,S=113,l=666,N=(b,d)=>(b.nd=x[d],d),j=b=>(b<<1)-(b>4?9:0),a=b=>{let d=b.length;for(;--d>=0;)b[d]=0};let O=(b,d,P)=>(d<<b.hash_shift^P)&b.hash_mask;const V=b=>{const d=b.state;let P=d.pending;P>b.avail_out&&(P=b.avail_out),0!==P&&(b.output.set(d.pending_buf.subarray(d.pending_out,d.pending_out+P),b.next_out),b.next_out+=P,d.pending_out+=P,b.total_out+=P,b.avail_out-=P,d.pending-=P,0===d.pending&&(d.pending_out=0))},y=(b,d)=>{i(b,b.block_start>=0?b.block_start:-1,b.strstart-b.block_start,d),b.block_start=b.strstart,V(b.strm)},c=(b,d)=>{b.pending_buf[b.pending++]=d},D=(b,d)=>{b.pending_buf[b.pending++]=d>>>8&255,b.pending_buf[b.pending++]=255&d},z=(b,d,P,G)=>{let W=b.avail_in;return W>G&&(W=G),0===W?0:(b.avail_in-=W,d.set(b.input.subarray(b.next_in,b.next_in+W),P),1===b.state.wrap?b.adler=J(b.adler,d,W,P):2===b.state.wrap&&(b.adler=L(b.adler,d,W,P)),b.next_in+=W,b.total_in+=W,W)},Q=(b,d)=>{let P,G,W=b.max_chain_length,i=b.strstart,q=b.prev_length,C=b.nice_match;const J=b.strstart>b.w_size-H?b.strstart-(b.w_size-H):0,L=b.window,x=b.w_mask,Y=b.prev,s=b.strstart+U;let E=L[i+q-1],w=L[i+q];b.prev_length>=b.good_match&&(W>>=2),C>b.lookahead&&(C=b.lookahead);do{if(P=d,L[P+q]===w&&L[P+q-1]===E&&L[P]===L[i]&&L[++P]===L[i+1]){i+=2,P++;do{}while(L[++i]===L[++P]&&L[++i]===L[++P]&&L[++i]===L[++P]&&L[++i]===L[++P]&&L[++i]===L[++P]&&L[++i]===L[++P]&&L[++i]===L[++P]&&L[++i]===L[++P]&&i<s);if(G=U-(s-i),i=s-U,G>q){if(b.match_start=d,q=G,G>=C)break;E=L[i+q-1],w=L[i+q]}}}while((d=Y[d&x])>J&&0!==--W);return q<=b.lookahead?q:b.lookahead},I=b=>{const d=b.w_size;let P,G,W,i,q;do{if(i=b.window_size-b.lookahead-b.strstart,b.strstart>=d+(d-H)){b.window.set(b.window.subarray(d,d+d),0),b.match_start-=d,b.strstart-=d,b.block_start-=d,G=b.hash_size,P=G;do{W=b.head[--P],b.head[P]=W>=d?W-d:0}while(--G);G=d,P=G;do{W=b.prev[--P],b.prev[P]=W>=d?W-d:0}while(--G);i+=d}if(0===b.strm.avail_in)break;if(G=z(b.strm,b.window,b.strstart+b.lookahead,i),b.lookahead+=G,b.lookahead+b.insert>=3)for(q=b.strstart-b.insert,b.ins_h=b.window[q],b.ins_h=O(b,b.ins_h,b.window[q+1]);b.insert&&(b.ins_h=O(b,b.ins_h,b.window[q+3-1]),b.prev[q&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=q,q++,b.insert--,!(b.lookahead+b.insert<3)););}while(b.lookahead<H&&0!==b.strm.avail_in)},m=(b,d)=>{let P,G;for(;;){if(b.lookahead<H){if(I(b),b.lookahead<H&&d===Y)return 1;if(0===b.lookahead)break}if(P=0,b.lookahead>=3&&(b.ins_h=O(b,b.ins_h,b.window[b.strstart+3-1]),P=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),0!==P&&b.strstart-P<=b.w_size-H&&(b.match_length=Q(b,P)),b.match_length>=3)if(G=q(b,b.strstart-b.match_start,b.match_length-3),b.lookahead-=b.match_length,b.match_length<=b.max_lazy_match&&b.lookahead>=3){b.match_length--;do{b.strstart++,b.ins_h=O(b,b.ins_h,b.window[b.strstart+3-1]),P=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart}while(0!==--b.match_length);b.strstart++}else b.strstart+=b.match_length,b.match_length=0,b.ins_h=b.window[b.strstart],b.ins_h=O(b,b.ins_h,b.window[b.strstart+1]);else G=q(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++;if(G&&(y(b,!1),0===b.strm.avail_out))return 1}return b.insert=b.strstart<2?b.strstart:2,d===w?(y(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(y(b,!1),0===b.strm.avail_out)?1:2},v=(b,d)=>{let P,G,W;for(;;){if(b.lookahead<H){if(I(b),b.lookahead<H&&d===Y)return 1;if(0===b.lookahead)break}if(P=0,b.lookahead>=3&&(b.ins_h=O(b,b.ins_h,b.window[b.strstart+3-1]),P=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),b.prev_length=b.match_length,b.prev_match=b.match_start,b.match_length=2,0!==P&&b.prev_length<b.max_lazy_match&&b.strstart-P<=b.w_size-H&&(b.match_length=Q(b,P),b.match_length<=5&&(b.strategy===f||3===b.match_length&&b.strstart-b.match_start>4096)&&(b.match_length=2)),b.prev_length>=3&&b.match_length<=b.prev_length){W=b.strstart+b.lookahead-3,G=q(b,b.strstart-1-b.prev_match,b.prev_length-3),b.lookahead-=b.prev_length-1,b.prev_length-=2;do{++b.strstart<=W&&(b.ins_h=O(b,b.ins_h,b.window[b.strstart+3-1]),P=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart)}while(0!==--b.prev_length);if(b.match_available=0,b.match_length=2,b.strstart++,G&&(y(b,!1),0===b.strm.avail_out))return 1}else if(b.match_available){if(G=q(b,0,b.window[b.strstart-1]),G&&y(b,!1),b.strstart++,b.lookahead--,0===b.strm.avail_out)return 1}else b.match_available=1,b.strstart++,b.lookahead--}return b.match_available&&(G=q(b,0,b.window[b.strstart-1]),b.match_available=0),b.insert=b.strstart<2?b.strstart:2,d===w?(y(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(y(b,!1),0===b.strm.avail_out)?1:2};function F(b,d,P,G,W){this.good_length=b,this.max_lazy=d,this.nice_length=P,this.max_chain=G,this.func=W}const h=[new F(0,0,0,0,((b,d)=>{let P=65535;for(P>b.pending_buf_size-5&&(P=b.pending_buf_size-5);;){if(b.lookahead<=1){if(I(b),0===b.lookahead&&d===Y)return 1;if(0===b.lookahead)break}b.strstart+=b.lookahead,b.lookahead=0;const G=b.block_start+P;if((0===b.strstart||b.strstart>=G)&&(b.lookahead=b.strstart-G,b.strstart=G,y(b,!1),0===b.strm.avail_out))return 1;if(b.strstart-b.block_start>=b.w_size-H&&(y(b,!1),0===b.strm.avail_out))return 1}return b.insert=0,d===w?(y(b,!0),0===b.strm.avail_out?3:4):(b.strstart>b.block_start&&(y(b,!1),b.strm.avail_out),1)})),new F(4,4,8,4,m),new F(4,5,16,8,m),new F(4,6,32,32,m),new F(4,4,16,16,v),new F(8,16,32,32,v),new F(8,16,128,128,v),new F(8,32,128,256,v),new F(32,128,258,1024,v),new F(32,258,258,4096,v)];function T(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=R,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),a(this.dyn_ltree),a(this.dyn_dtree),a(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),a(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),a(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const K=b=>{if(!b||!b.state)return N(b,n);b.total_in=b.total_out=0,b.data_type=e;const d=b.state;return d.pending=0,d.pending_out=0,d.wrap<0&&(d.wrap=-d.wrap),d.status=d.wrap?42:S,b.adler=2===d.wrap?0:1,d.last_flush=Y,G(d),r},k=b=>{const d=K(b);var P;return d===r&&((P=b.state).window_size=2*P.w_size,a(P.head),P.max_lazy_match=h[P.level].max_lazy,P.good_match=h[P.level].good_length,P.nice_match=h[P.level].nice_length,P.max_chain_length=h[P.level].max_chain,P.strstart=0,P.block_start=0,P.lookahead=0,P.insert=0,P.match_length=P.prev_length=2,P.match_available=0,P.ins_h=0),d},bb=(b,d,P,G,W,i)=>{if(!b)return n;let q=1;if(d===A&&(d=6),G<0?(q=0,G=-G):G>15&&(q=2,G-=16),W<1||W>9||P!==R||G<8||G>15||d<0||d>9||i<0||i>u)return N(b,n);8===G&&(G=9);const C=new T;return b.state=C,C.strm=b,C.wrap=q,C.gzhead=null,C.w_bits=G,C.w_size=1<<C.w_bits,C.w_mask=C.w_size-1,C.hash_bits=W+7,C.hash_size=1<<C.hash_bits,C.hash_mask=C.hash_size-1,C.hash_shift=~~((C.hash_bits+3-1)/3),C.window=new Uint8Array(2*C.w_size),C.head=new Uint16Array(C.hash_size),C.prev=new Uint16Array(C.w_size),C.lit_bufsize=1<<W+6,C.pending_buf_size=4*C.lit_bufsize,C.pending_buf=new Uint8Array(C.pending_buf_size),C.d_buf=1*C.lit_bufsize,C.l_buf=3*C.lit_bufsize,C.level=d,C.strategy=i,C.method=P,k(b)};b.exports.deflateInit=(b,d)=>bb(b,d,R,15,8,M),b.exports.deflateInit2=bb,b.exports.deflateReset=k,b.exports.deflateResetKeep=K,b.exports.deflateSetHeader=(b,d)=>b&&b.state?2!==b.state.wrap?n:(b.state.gzhead=d,r):n,b.exports.deflate=(b,d)=>{let P,G;if(!b||!b.state||d>t||d<0)return b?N(b,n):n;const i=b.state;if(!b.output||!b.input&&0!==b.avail_in||i.status===l&&d!==w)return N(b,0===b.avail_out?o:n);i.strm=b;const J=i.last_flush;if(i.last_flush=d,42===i.status)if(2===i.wrap)b.adler=0,c(i,31),c(i,139),c(i,8),i.gzhead?(c(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),c(i,255&i.gzhead.time),c(i,i.gzhead.time>>8&255),c(i,i.gzhead.time>>16&255),c(i,i.gzhead.time>>24&255),c(i,9===i.level?2:i.strategy>=g||i.level<2?4:0),c(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(c(i,255&i.gzhead.extra.length),c(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(b.adler=L(b.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(c(i,0),c(i,0),c(i,0),c(i,0),c(i,0),c(i,9===i.level?2:i.strategy>=g||i.level<2?4:0),c(i,3),i.status=S);else{let d=R+(i.w_bits-8<<4)<<8,P=-1;P=i.strategy>=g||i.level<2?0:i.level<6?1:6===i.level?2:3,d|=P<<6,0!==i.strstart&&(d|=32),d+=31-d%31,i.status=S,D(i,d),0!==i.strstart&&(D(i,b.adler>>>16),D(i,65535&b.adler)),b.adler=1}if(69===i.status)if(i.gzhead.extra){for(P=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>P&&(b.adler=L(b.adler,i.pending_buf,i.pending-P,P)),V(b),P=i.pending,i.pending!==i.pending_buf_size));)c(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>P&&(b.adler=L(b.adler,i.pending_buf,i.pending-P,P)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){P=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>P&&(b.adler=L(b.adler,i.pending_buf,i.pending-P,P)),V(b),P=i.pending,i.pending===i.pending_buf_size)){G=1;break}G=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,c(i,G)}while(0!==G);i.gzhead.hcrc&&i.pending>P&&(b.adler=L(b.adler,i.pending_buf,i.pending-P,P)),0===G&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){P=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>P&&(b.adler=L(b.adler,i.pending_buf,i.pending-P,P)),V(b),P=i.pending,i.pending===i.pending_buf_size)){G=1;break}G=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,c(i,G)}while(0!==G);i.gzhead.hcrc&&i.pending>P&&(b.adler=L(b.adler,i.pending_buf,i.pending-P,P)),0===G&&(i.status=p)}else i.status=p;if(i.status===p&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&V(b),i.pending+2<=i.pending_buf_size&&(c(i,255&b.adler),c(i,b.adler>>8&255),b.adler=0,i.status=S)):i.status=S),0!==i.pending){if(V(b),0===b.avail_out)return i.last_flush=-1,r}else if(0===b.avail_in&&j(d)<=j(J)&&d!==w)return N(b,o);if(i.status===l&&0!==b.avail_in)return N(b,o);if(0!==b.avail_in||0!==i.lookahead||d!==Y&&i.status!==l){let P=i.strategy===g?((b,d)=>{let P;for(;;){if(0===b.lookahead&&(I(b),0===b.lookahead)){if(d===Y)return 1;break}if(b.match_length=0,P=q(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++,P&&(y(b,!1),0===b.strm.avail_out))return 1}return b.insert=0,d===w?(y(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(y(b,!1),0===b.strm.avail_out)?1:2})(i,d):i.strategy===X?((b,d)=>{let P,G,W,i;const C=b.window;for(;;){if(b.lookahead<=U){if(I(b),b.lookahead<=U&&d===Y)return 1;if(0===b.lookahead)break}if(b.match_length=0,b.lookahead>=3&&b.strstart>0&&(W=b.strstart-1,G=C[W],G===C[++W]&&G===C[++W]&&G===C[++W])){i=b.strstart+U;do{}while(G===C[++W]&&G===C[++W]&&G===C[++W]&&G===C[++W]&&G===C[++W]&&G===C[++W]&&G===C[++W]&&G===C[++W]&&W<i);b.match_length=U-(i-W),b.match_length>b.lookahead&&(b.match_length=b.lookahead)}if(b.match_length>=3?(P=q(b,1,b.match_length-3),b.lookahead-=b.match_length,b.strstart+=b.match_length,b.match_length=0):(P=q(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++),P&&(y(b,!1),0===b.strm.avail_out))return 1}return b.insert=0,d===w?(y(b,!0),0===b.strm.avail_out?3:4):b.last_lit&&(y(b,!1),0===b.strm.avail_out)?1:2})(i,d):h[i.level].func(i,d);if(3!==P&&4!==P||(i.status=l),1===P||3===P)return 0===b.avail_out&&(i.last_flush=-1),r;if(2===P&&(d===s?C(i):d!==t&&(W(i,0,0,!1),d===E&&(a(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),V(b),0===b.avail_out))return i.last_flush=-1,r}return d!==w?r:i.wrap<=0?B:(2===i.wrap?(c(i,255&b.adler),c(i,b.adler>>8&255),c(i,b.adler>>16&255),c(i,b.adler>>24&255),c(i,255&b.total_in),c(i,b.total_in>>8&255),c(i,b.total_in>>16&255),c(i,b.total_in>>24&255)):(D(i,b.adler>>>16),D(i,65535&b.adler)),V(b),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?r:B)},b.exports.deflateEnd=b=>{if(!b||!b.state)return n;const d=b.state.status;return 42!==d&&69!==d&&73!==d&&91!==d&&d!==p&&d!==S&&d!==l?N(b,n):(b.state=null,d===S?N(b,Z):r)},b.exports.deflateSetDictionary=(b,d)=>{let P=d.length;if(!b||!b.state)return n;const G=b.state,W=G.wrap;if(2===W||1===W&&42!==G.status||G.lookahead)return n;if(1===W&&(b.adler=J(b.adler,d,P,0)),G.wrap=0,P>=G.w_size){0===W&&(a(G.head),G.strstart=0,G.block_start=0,G.insert=0);let b=new Uint8Array(G.w_size);b.set(d.subarray(P-G.w_size,P),0),d=b,P=G.w_size}const i=b.avail_in,q=b.next_in,C=b.input;for(b.avail_in=P,b.next_in=0,b.input=d,I(G);G.lookahead>=3;){let b=G.strstart,d=G.lookahead-2;do{G.ins_h=O(G,G.ins_h,G.window[b+3-1]),G.prev[b&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=b,b++}while(--d);G.strstart=b,G.lookahead=2,I(G)}return G.strstart+=G.lookahead,G.block_start=G.strstart,G.insert=G.lookahead,G.lookahead=0,G.match_length=G.prev_length=2,G.match_available=0,b.next_in=q,b.input=C,b.avail_in=i,G.wrap=W,r},b.exports.deflateInfo="pako deflate (from Nodeca project)"},12868:b=>{"use strict";b.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12864:b=>{"use strict";b.exports=function(b,d){let P,G,W,i,q,C,J,L,x,Y,s,E,w,t,r,B,n,Z,o,A,f,g,X,u;const M=b.state;P=b.next_in,X=b.input,G=P+(b.avail_in-5),W=b.next_out,u=b.output,i=W-(d-b.avail_out),q=W+(b.avail_out-257),C=M.dmax,J=M.wsize,L=M.whave,x=M.wnext,Y=M.window,s=M.hold,E=M.bits,w=M.lencode,t=M.distcode,r=(1<<M.lenbits)-1,B=(1<<M.distbits)-1;b:do{E<15&&(s+=X[P++]<<E,E+=8,s+=X[P++]<<E,E+=8),n=w[s&r];d:for(;;){if(Z=n>>>24,s>>>=Z,E-=Z,Z=n>>>16&255,0===Z)u[W++]=65535&n;else{if(!(16&Z)){if(0===(64&Z)){n=w[(65535&n)+(s&(1<<Z)-1)];continue d}if(32&Z){M.mode=12;break b}b.nd="invalid literal/length code",M.mode=30;break b}o=65535&n,Z&=15,Z&&(E<Z&&(s+=X[P++]<<E,E+=8),o+=s&(1<<Z)-1,s>>>=Z,E-=Z),E<15&&(s+=X[P++]<<E,E+=8,s+=X[P++]<<E,E+=8),n=t[s&B];P:for(;;){if(Z=n>>>24,s>>>=Z,E-=Z,Z=n>>>16&255,!(16&Z)){if(0===(64&Z)){n=t[(65535&n)+(s&(1<<Z)-1)];continue P}b.nd="invalid distance code",M.mode=30;break b}if(A=65535&n,Z&=15,E<Z&&(s+=X[P++]<<E,E+=8,E<Z&&(s+=X[P++]<<E,E+=8)),A+=s&(1<<Z)-1,A>C){b.nd="invalid distance too far back",M.mode=30;break b}if(s>>>=Z,E-=Z,Z=W-i,A>Z){if(Z=A-Z,Z>L&&M.sane){b.nd="invalid distance too far back",M.mode=30;break b}if(f=0,g=Y,0===x){if(f+=J-Z,Z<o){o-=Z;do{u[W++]=Y[f++]}while(--Z);f=W-A,g=u}}else if(x<Z){if(f+=J+x-Z,Z-=x,Z<o){o-=Z;do{u[W++]=Y[f++]}while(--Z);if(f=0,x<o){Z=x,o-=Z;do{u[W++]=Y[f++]}while(--Z);f=W-A,g=u}}}else if(f+=x-Z,Z<o){o-=Z;do{u[W++]=Y[f++]}while(--Z);f=W-A,g=u}for(;o>2;)u[W++]=g[f++],u[W++]=g[f++],u[W++]=g[f++],o-=3;o&&(u[W++]=g[f++],o>1&&(u[W++]=g[f++]))}else{f=W-A;do{u[W++]=u[f++],u[W++]=u[f++],u[W++]=u[f++],o-=3}while(o>2);o&&(u[W++]=u[f++],o>1&&(u[W++]=u[f++]))}break}}break}}while(P<G&&W<q);o=E>>3,P-=o,E-=o<<3,s&=(1<<E)-1,b.next_in=P,b.next_out=W,b.avail_in=P<G?G-P+5:5-(P-G),b.avail_out=W<q?q-W+257:257-(W-q),M.hold=s,M.bits=E}},12858:(b,d,P)=>{"use strict";const G=P(12818),W=P(12823),i=P(12864),q=P(12866),{Z_FINISH:C,Z_BLOCK:J,Z_TREES:L,Z_OK:x,Z_STREAM_END:Y,Z_NEED_DICT:s,Z_STREAM_ERROR:E,Z_DATA_ERROR:w,Z_MEM_ERROR:t,Z_BUF_ERROR:r,Z_DEFLATED:B}=P(12831),n=12,Z=30,o=b=>(b>>>24&255)+(b>>>8&65280)+((65280&b)<<8)+((255&b)<<24);function A(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const f=b=>{if(!b||!b.state)return E;const d=b.state;return b.total_in=b.total_out=d.total=0,b.nd="",d.wrap&&(b.adler=1&d.wrap),d.mode=1,d.last=0,d.havedict=0,d.dmax=32768,d.head=null,d.hold=0,d.bits=0,d.lencode=d.lendyn=new Int32Array(852),d.distcode=d.distdyn=new Int32Array(592),d.sane=1,d.back=-1,x},g=b=>{if(!b||!b.state)return E;const d=b.state;return d.wsize=0,d.whave=0,d.wnext=0,f(b)},X=(b,d)=>{let P;if(!b||!b.state)return E;const G=b.state;return d<0?(P=0,d=-d):(P=1+(d>>4),d<48&&(d&=15)),d&&(d<8||d>15)?E:(null!==G.window&&G.wbits!==d&&(G.window=null),G.wrap=P,G.wbits=d,g(b))},u=(b,d)=>{if(!b)return E;const P=new A;b.state=P,P.window=null;const G=X(b,d);return G!==x&&(b.state=null),G};let M,e,R=!0;const U=b=>{if(R){M=new Int32Array(512),e=new Int32Array(32);let d=0;for(;d<144;)b.lens[d++]=8;for(;d<256;)b.lens[d++]=9;for(;d<280;)b.lens[d++]=7;for(;d<288;)b.lens[d++]=8;for(q(1,b.lens,0,288,M,0,b.work,{bits:9}),d=0;d<32;)b.lens[d++]=5;q(2,b.lens,0,32,e,0,b.work,{bits:5}),R=!1}b.lencode=M,b.lenbits=9,b.distcode=e,b.distbits=5},H=(b,d,P,G)=>{let W;const i=b.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),G>=i.wsize?(i.window.set(d.subarray(P-i.wsize,P),0),i.wnext=0,i.whave=i.wsize):(W=i.wsize-i.wnext,W>G&&(W=G),i.window.set(d.subarray(P-G,P-G+W),i.wnext),(G-=W)?(i.window.set(d.subarray(P-G,P),0),i.wnext=G,i.whave=i.wsize):(i.wnext+=W,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=W))),0};b.exports.inflateReset=g,b.exports.inflateReset2=X,b.exports.inflateResetKeep=f,b.exports.inflateInit=b=>u(b,15),b.exports.inflateInit2=u,b.exports.inflate=(b,d)=>{let P,A,f,g,X,u,M,e,R,p,S,l,N,j,a,O,V,y,c,D,z,Q,I=0;const m=new Uint8Array(4);let v,F;const h=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!b||!b.state||!b.output||!b.input&&0!==b.avail_in)return E;P=b.state,P.mode===n&&(P.mode=13),X=b.next_out,f=b.output,M=b.avail_out,g=b.next_in,A=b.input,u=b.avail_in,e=P.hold,R=P.bits,p=u,S=M,Q=x;b:for(;;)switch(P.mode){case 1:if(0===P.wrap){P.mode=13;break}for(;R<16;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}if(2&P.wrap&&35615===e){P.check=0,m[0]=255&e,m[1]=e>>>8&255,P.check=W(P.check,m,2,0),e=0,R=0,P.mode=2;break}if(P.flags=0,P.head&&(P.head.done=!1),!(1&P.wrap)||(((255&e)<<8)+(e>>8))%31){b.nd="incorrect header check",P.mode=Z;break}if((15&e)!==B){b.nd="unknown compression method",P.mode=Z;break}if(e>>>=4,R-=4,z=8+(15&e),0===P.wbits)P.wbits=z;else if(z>P.wbits){b.nd="invalid window size",P.mode=Z;break}P.dmax=1<<P.wbits,b.adler=P.check=1,P.mode=512&e?10:n,e=0,R=0;break;case 2:for(;R<16;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}if(P.flags=e,(255&P.flags)!==B){b.nd="unknown compression method",P.mode=Z;break}if(57344&P.flags){b.nd="unknown header flags set",P.mode=Z;break}P.head&&(P.head.text=e>>8&1),512&P.flags&&(m[0]=255&e,m[1]=e>>>8&255,P.check=W(P.check,m,2,0)),e=0,R=0,P.mode=3;case 3:for(;R<32;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}P.head&&(P.head.time=e),512&P.flags&&(m[0]=255&e,m[1]=e>>>8&255,m[2]=e>>>16&255,m[3]=e>>>24&255,P.check=W(P.check,m,4,0)),e=0,R=0,P.mode=4;case 4:for(;R<16;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}P.head&&(P.head.xflags=255&e,P.head.os=e>>8),512&P.flags&&(m[0]=255&e,m[1]=e>>>8&255,P.check=W(P.check,m,2,0)),e=0,R=0,P.mode=5;case 5:if(1024&P.flags){for(;R<16;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}P.length=e,P.head&&(P.head.extra_len=e),512&P.flags&&(m[0]=255&e,m[1]=e>>>8&255,P.check=W(P.check,m,2,0)),e=0,R=0}else P.head&&(P.head.extra=null);P.mode=6;case 6:if(1024&P.flags&&(l=P.length,l>u&&(l=u),l&&(P.head&&(z=P.head.extra_len-P.length,P.head.extra||(P.head.extra=new Uint8Array(P.head.extra_len)),P.head.extra.set(A.subarray(g,g+l),z)),512&P.flags&&(P.check=W(P.check,A,l,g)),u-=l,g+=l,P.length-=l),P.length))break b;P.length=0,P.mode=7;case 7:if(2048&P.flags){if(0===u)break b;l=0;do{z=A[g+l++],P.head&&z&&P.length<65536&&(P.head.name+=String.fromCharCode(z))}while(z&&l<u);if(512&P.flags&&(P.check=W(P.check,A,l,g)),u-=l,g+=l,z)break b}else P.head&&(P.head.name=null);P.length=0,P.mode=8;case 8:if(4096&P.flags){if(0===u)break b;l=0;do{z=A[g+l++],P.head&&z&&P.length<65536&&(P.head.comment+=String.fromCharCode(z))}while(z&&l<u);if(512&P.flags&&(P.check=W(P.check,A,l,g)),u-=l,g+=l,z)break b}else P.head&&(P.head.comment=null);P.mode=9;case 9:if(512&P.flags){for(;R<16;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}if(e!==(65535&P.check)){b.nd="header crc mismatch",P.mode=Z;break}e=0,R=0}P.head&&(P.head.hcrc=P.flags>>9&1,P.head.done=!0),b.adler=P.check=0,P.mode=n;break;case 10:for(;R<32;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}b.adler=P.check=o(e),e=0,R=0,P.mode=11;case 11:if(0===P.havedict)return b.next_out=X,b.avail_out=M,b.next_in=g,b.avail_in=u,P.hold=e,P.bits=R,s;b.adler=P.check=1,P.mode=n;case n:if(d===J||d===L)break b;case 13:if(P.last){e>>>=7&R,R-=7&R,P.mode=27;break}for(;R<3;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}switch(P.last=1&e,e>>>=1,R-=1,3&e){case 0:P.mode=14;break;case 1:if(U(P),P.mode=20,d===L){e>>>=2,R-=2;break b}break;case 2:P.mode=17;break;case 3:b.nd="invalid block type",P.mode=Z}e>>>=2,R-=2;break;case 14:for(e>>>=7&R,R-=7&R;R<32;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}if((65535&e)!==(e>>>16^65535)){b.nd="invalid stored block lengths",P.mode=Z;break}if(P.length=65535&e,e=0,R=0,P.mode=15,d===L)break b;case 15:P.mode=16;case 16:if(l=P.length,l){if(l>u&&(l=u),l>M&&(l=M),0===l)break b;f.set(A.subarray(g,g+l),X),u-=l,g+=l,M-=l,X+=l,P.length-=l;break}P.mode=n;break;case 17:for(;R<14;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}if(P.nlen=257+(31&e),e>>>=5,R-=5,P.ndist=1+(31&e),e>>>=5,R-=5,P.ncode=4+(15&e),e>>>=4,R-=4,P.nlen>286||P.ndist>30){b.nd="too many length or distance symbols",P.mode=Z;break}P.have=0,P.mode=18;case 18:for(;P.have<P.ncode;){for(;R<3;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}P.lens[h[P.have++]]=7&e,e>>>=3,R-=3}for(;P.have<19;)P.lens[h[P.have++]]=0;if(P.lencode=P.lendyn,P.lenbits=7,v={bits:P.lenbits},Q=q(0,P.lens,0,19,P.lencode,0,P.work,v),P.lenbits=v.bits,Q){b.nd="invalid code lengths set",P.mode=Z;break}P.have=0,P.mode=19;case 19:for(;P.have<P.nlen+P.ndist;){for(;I=P.lencode[e&(1<<P.lenbits)-1],a=I>>>24,O=I>>>16&255,V=65535&I,!(a<=R);){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}if(V<16)e>>>=a,R-=a,P.lens[P.have++]=V;else{if(16===V){for(F=a+2;R<F;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}if(e>>>=a,R-=a,0===P.have){b.nd="invalid bit length repeat",P.mode=Z;break}z=P.lens[P.have-1],l=3+(3&e),e>>>=2,R-=2}else if(17===V){for(F=a+3;R<F;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}e>>>=a,R-=a,z=0,l=3+(7&e),e>>>=3,R-=3}else{for(F=a+7;R<F;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}e>>>=a,R-=a,z=0,l=11+(127&e),e>>>=7,R-=7}if(P.have+l>P.nlen+P.ndist){b.nd="invalid bit length repeat",P.mode=Z;break}for(;l--;)P.lens[P.have++]=z}}if(P.mode===Z)break;if(0===P.lens[256]){b.nd="invalid code -- missing end-of-block",P.mode=Z;break}if(P.lenbits=9,v={bits:P.lenbits},Q=q(1,P.lens,0,P.nlen,P.lencode,0,P.work,v),P.lenbits=v.bits,Q){b.nd="invalid literal/lengths set",P.mode=Z;break}if(P.distbits=6,P.distcode=P.distdyn,v={bits:P.distbits},Q=q(2,P.lens,P.nlen,P.ndist,P.distcode,0,P.work,v),P.distbits=v.bits,Q){b.nd="invalid distances set",P.mode=Z;break}if(P.mode=20,d===L)break b;case 20:P.mode=21;case 21:if(u>=6&&M>=258){b.next_out=X,b.avail_out=M,b.next_in=g,b.avail_in=u,P.hold=e,P.bits=R,i(b,S),X=b.next_out,f=b.output,M=b.avail_out,g=b.next_in,A=b.input,u=b.avail_in,e=P.hold,R=P.bits,P.mode===n&&(P.back=-1);break}for(P.back=0;I=P.lencode[e&(1<<P.lenbits)-1],a=I>>>24,O=I>>>16&255,V=65535&I,!(a<=R);){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}if(O&&0===(240&O)){for(y=a,c=O,D=V;I=P.lencode[D+((e&(1<<y+c)-1)>>y)],a=I>>>24,O=I>>>16&255,V=65535&I,!(y+a<=R);){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}e>>>=y,R-=y,P.back+=y}if(e>>>=a,R-=a,P.back+=a,P.length=V,0===O){P.mode=26;break}if(32&O){P.back=-1,P.mode=n;break}if(64&O){b.nd="invalid literal/length code",P.mode=Z;break}P.extra=15&O,P.mode=22;case 22:if(P.extra){for(F=P.extra;R<F;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}P.length+=e&(1<<P.extra)-1,e>>>=P.extra,R-=P.extra,P.back+=P.extra}P.was=P.length,P.mode=23;case 23:for(;I=P.distcode[e&(1<<P.distbits)-1],a=I>>>24,O=I>>>16&255,V=65535&I,!(a<=R);){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}if(0===(240&O)){for(y=a,c=O,D=V;I=P.distcode[D+((e&(1<<y+c)-1)>>y)],a=I>>>24,O=I>>>16&255,V=65535&I,!(y+a<=R);){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}e>>>=y,R-=y,P.back+=y}if(e>>>=a,R-=a,P.back+=a,64&O){b.nd="invalid distance code",P.mode=Z;break}P.offset=V,P.extra=15&O,P.mode=24;case 24:if(P.extra){for(F=P.extra;R<F;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}P.offset+=e&(1<<P.extra)-1,e>>>=P.extra,R-=P.extra,P.back+=P.extra}if(P.offset>P.dmax){b.nd="invalid distance too far back",P.mode=Z;break}P.mode=25;case 25:if(0===M)break b;if(l=S-M,P.offset>l){if(l=P.offset-l,l>P.whave&&P.sane){b.nd="invalid distance too far back",P.mode=Z;break}l>P.wnext?(l-=P.wnext,N=P.wsize-l):N=P.wnext-l,l>P.length&&(l=P.length),j=P.window}else j=f,N=X-P.offset,l=P.length;l>M&&(l=M),M-=l,P.length-=l;do{f[X++]=j[N++]}while(--l);0===P.length&&(P.mode=21);break;case 26:if(0===M)break b;f[X++]=P.length,M--,P.mode=21;break;case 27:if(P.wrap){for(;R<32;){if(0===u)break b;u--,e|=A[g++]<<R,R+=8}if(S-=M,b.total_out+=S,P.total+=S,S&&(b.adler=P.check=P.flags?W(P.check,f,S,X-S):G(P.check,f,S,X-S)),S=M,(P.flags?e:o(e))!==P.check){b.nd="incorrect data check",P.mode=Z;break}e=0,R=0}P.mode=28;case 28:if(P.wrap&&P.flags){for(;R<32;){if(0===u)break b;u--,e+=A[g++]<<R,R+=8}if(e!==(4294967295&P.total)){b.nd="incorrect length check",P.mode=Z;break}e=0,R=0}P.mode=29;case 29:Q=Y;break b;case Z:Q=w;break b;case 31:return t;default:return E}return b.next_out=X,b.avail_out=M,b.next_in=g,b.avail_in=u,P.hold=e,P.bits=R,(P.wsize||S!==b.avail_out&&P.mode<Z&&(P.mode<27||d!==C))&&H(b,b.output,b.next_out,S-b.avail_out)?(P.mode=31,t):(p-=b.avail_in,S-=b.avail_out,b.total_in+=p,b.total_out+=S,P.total+=S,P.wrap&&S&&(b.adler=P.check=P.flags?W(P.check,f,S,b.next_out-S):G(P.check,f,S,b.next_out-S)),b.data_type=P.bits+(P.last?64:0)+(P.mode===n?128:0)+(20===P.mode||15===P.mode?256:0),(0===p&&0===S||d===C)&&Q===x&&(Q=r),Q)},b.exports.inflateEnd=b=>{if(!b||!b.state)return E;let d=b.state;return d.window&&(d.window=null),b.state=null,x},b.exports.inflateGetHeader=(b,d)=>{if(!b||!b.state)return E;const P=b.state;return 0===(2&P.wrap)?E:(P.head=d,d.done=!1,x)},b.exports.inflateSetDictionary=(b,d)=>{const P=d.length;let W,i,q;return b&&b.state?(W=b.state,0!==W.wrap&&11!==W.mode?E:11===W.mode&&(i=1,i=G(i,d,P,0),i!==W.check)?w:(q=H(b,d,P,P),q?(W.mode=31,t):(W.havedict=1,x))):E},b.exports.inflateInfo="pako inflate (from Nodeca project)"},12866:b=>{"use strict";const d=15,P=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),G=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),W=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),i=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);b.exports=(b,q,C,J,L,x,Y,s)=>{const E=s.bits;let w,t,r,B,n,Z,o=0,A=0,f=0,g=0,X=0,u=0,M=0,e=0,R=0,U=0,H=null,p=0;const S=new Uint16Array(16),l=new Uint16Array(16);let N,j,a,O=null,V=0;for(o=0;o<=d;o++)S[o]=0;for(A=0;A<J;A++)S[q[C+A]]++;for(X=E,g=d;g>=1&&0===S[g];g--);if(X>g&&(X=g),0===g)return L[x++]=20971520,L[x++]=20971520,s.bits=1,0;for(f=1;f<g&&0===S[f];f++);for(X<f&&(X=f),e=1,o=1;o<=d;o++)if(e<<=1,e-=S[o],e<0)return-1;if(e>0&&(0===b||1!==g))return-1;for(l[1]=0,o=1;o<d;o++)l[o+1]=l[o]+S[o];for(A=0;A<J;A++)0!==q[C+A]&&(Y[l[q[C+A]]++]=A);if(0===b?(H=O=Y,Z=19):1===b?(H=P,p-=257,O=G,V-=257,Z=256):(H=W,O=i,Z=-1),U=0,A=0,o=f,n=x,u=X,M=0,r=-1,R=1<<X,B=R-1,1===b&&R>852||2===b&&R>592)return 1;for(;;){N=o-M,Y[A]<Z?(j=0,a=Y[A]):Y[A]>Z?(j=O[V+Y[A]],a=H[p+Y[A]]):(j=96,a=0),w=1<<o-M,t=1<<u,f=t;do{t-=w,L[n+(U>>M)+t]=N<<24|j<<16|a}while(0!==t);for(w=1<<o-1;U&w;)w>>=1;if(0!==w?(U&=w-1,U+=w):U=0,A++,0===--S[o]){if(o===g)break;o=q[C+Y[A]]}if(o>X&&(U&B)!==r){for(0===M&&(M=X),n+=f,u=o-M,e=1<<u;u+M<g&&(e-=S[u+M],!(e<=0));)u++,e<<=1;if(R+=1<<u,1===b&&R>852||2===b&&R>592)return 1;r=U&B,L[r]=X<<24|u<<16|n-x}}return 0!==U&&(L[n+U]=o-M<<24|64<<16),s.bits=X,0}},12825:b=>{"use strict";b.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12811:b=>{"use strict";function d(b){let d=b.length;for(;--d>=0;)b[d]=0}const P=256,G=286,W=30,i=15,q=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),C=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),J=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),x=new Array(576);d(x);const Y=new Array(60);d(Y);const s=new Array(512);d(s);const E=new Array(256);d(E);const w=new Array(29);d(w);const t=new Array(W);function r(b,d,P,G,W){this.static_tree=b,this.extra_bits=d,this.extra_base=P,this.elems=G,this.max_length=W,this.has_stree=b&&b.length}let B,n,Z;function o(b,d){this.dyn_tree=b,this.max_code=0,this.stat_desc=d}d(t);const A=b=>b<256?s[b]:s[256+(b>>>7)],f=(b,d)=>{b.pending_buf[b.pending++]=255&d,b.pending_buf[b.pending++]=d>>>8&255},g=(b,d,P)=>{b.bi_valid>16-P?(b.bi_buf|=d<<b.bi_valid&65535,f(b,b.bi_buf),b.bi_buf=d>>16-b.bi_valid,b.bi_valid+=P-16):(b.bi_buf|=d<<b.bi_valid&65535,b.bi_valid+=P)},X=(b,d,P)=>{g(b,P[2*d],P[2*d+1])},u=(b,d)=>{let P=0;do{P|=1&b,b>>>=1,P<<=1}while(--d>0);return P>>>1},M=(b,d,P)=>{const G=new Array(16);let W,q,C=0;for(W=1;W<=i;W++)G[W]=C=C+P[W-1]<<1;for(q=0;q<=d;q++){let d=b[2*q+1];0!==d&&(b[2*q]=u(G[d]++,d))}},e=b=>{let d;for(d=0;d<G;d++)b.dyn_ltree[2*d]=0;for(d=0;d<W;d++)b.dyn_dtree[2*d]=0;for(d=0;d<19;d++)b.bl_tree[2*d]=0;b.dyn_ltree[512]=1,b.opt_len=b.static_len=0,b.last_lit=b.matches=0},R=b=>{b.bi_valid>8?f(b,b.bi_buf):b.bi_valid>0&&(b.pending_buf[b.pending++]=b.bi_buf),b.bi_buf=0,b.bi_valid=0},U=(b,d,P,G)=>{const W=2*d,i=2*P;return b[W]<b[i]||b[W]===b[i]&&G[d]<=G[P]},H=(b,d,P)=>{const G=b.heap[P];let W=P<<1;for(;W<=b.heap_len&&(W<b.heap_len&&U(d,b.heap[W+1],b.heap[W],b.depth)&&W++,!U(d,G,b.heap[W],b.depth));)b.heap[P]=b.heap[W],P=W,W<<=1;b.heap[P]=G},p=(b,d,G)=>{let W,i,J,L,x=0;if(0!==b.last_lit)do{W=b.pending_buf[b.d_buf+2*x]<<8|b.pending_buf[b.d_buf+2*x+1],i=b.pending_buf[b.l_buf+x],x++,0===W?X(b,i,d):(J=E[i],X(b,J+P+1,d),L=q[J],0!==L&&(i-=w[J],g(b,i,L)),W--,J=A(W),X(b,J,G),L=C[J],0!==L&&(W-=t[J],g(b,W,L)))}while(x<b.last_lit);X(b,256,d)},S=(b,d)=>{const P=d.dyn_tree,G=d.stat_desc.static_tree,W=d.stat_desc.has_stree,q=d.stat_desc.elems;let C,J,L,x=-1;for(b.heap_len=0,b.heap_max=573,C=0;C<q;C++)0!==P[2*C]?(b.heap[++b.heap_len]=x=C,b.depth[C]=0):P[2*C+1]=0;for(;b.heap_len<2;)L=b.heap[++b.heap_len]=x<2?++x:0,P[2*L]=1,b.depth[L]=0,b.opt_len--,W&&(b.static_len-=G[2*L+1]);for(d.max_code=x,C=b.heap_len>>1;C>=1;C--)H(b,P,C);L=q;do{C=b.heap[1],b.heap[1]=b.heap[b.heap_len--],H(b,P,1),J=b.heap[1],b.heap[--b.heap_max]=C,b.heap[--b.heap_max]=J,P[2*L]=P[2*C]+P[2*J],b.depth[L]=(b.depth[C]>=b.depth[J]?b.depth[C]:b.depth[J])+1,P[2*C+1]=P[2*J+1]=L,b.heap[1]=L++,H(b,P,1)}while(b.heap_len>=2);b.heap[--b.heap_max]=b.heap[1],((b,d)=>{const P=d.dyn_tree,G=d.max_code,W=d.stat_desc.static_tree,q=d.stat_desc.has_stree,C=d.stat_desc.extra_bits,J=d.stat_desc.extra_base,L=d.stat_desc.max_length;let x,Y,s,E,w,t,r=0;for(E=0;E<=i;E++)b.bl_count[E]=0;for(P[2*b.heap[b.heap_max]+1]=0,x=b.heap_max+1;x<573;x++)Y=b.heap[x],E=P[2*P[2*Y+1]+1]+1,E>L&&(E=L,r++),P[2*Y+1]=E,Y>G||(b.bl_count[E]++,w=0,Y>=J&&(w=C[Y-J]),t=P[2*Y],b.opt_len+=t*(E+w),q&&(b.static_len+=t*(W[2*Y+1]+w)));if(0!==r){do{for(E=L-1;0===b.bl_count[E];)E--;b.bl_count[E]--,b.bl_count[E+1]+=2,b.bl_count[L]--,r-=2}while(r>0);for(E=L;0!==E;E--)for(Y=b.bl_count[E];0!==Y;)s=b.heap[--x],s>G||(P[2*s+1]!==E&&(b.opt_len+=(E-P[2*s+1])*P[2*s],P[2*s+1]=E),Y--)}})(b,d),M(P,x,b.bl_count)},l=(b,d,P)=>{let G,W,i=-1,q=d[1],C=0,J=7,L=4;for(0===q&&(J=138,L=3),d[2*(P+1)+1]=65535,G=0;G<=P;G++)W=q,q=d[2*(G+1)+1],++C<J&&W===q||(C<L?b.bl_tree[2*W]+=C:0!==W?(W!==i&&b.bl_tree[2*W]++,b.bl_tree[32]++):C<=10?b.bl_tree[34]++:b.bl_tree[36]++,C=0,i=W,0===q?(J=138,L=3):W===q?(J=6,L=3):(J=7,L=4))},N=(b,d,P)=>{let G,W,i=-1,q=d[1],C=0,J=7,L=4;for(0===q&&(J=138,L=3),G=0;G<=P;G++)if(W=q,q=d[2*(G+1)+1],!(++C<J&&W===q)){if(C<L)do{X(b,W,b.bl_tree)}while(0!==--C);else 0!==W?(W!==i&&(X(b,W,b.bl_tree),C--),X(b,16,b.bl_tree),g(b,C-3,2)):C<=10?(X(b,17,b.bl_tree),g(b,C-3,3)):(X(b,18,b.bl_tree),g(b,C-11,7));C=0,i=W,0===q?(J=138,L=3):W===q?(J=6,L=3):(J=7,L=4)}};let j=!1;const a=(b,d,P,G)=>{g(b,0+(G?1:0),3),((b,d,P,G)=>{R(b),G&&(f(b,P),f(b,~P)),b.pending_buf.set(b.window.subarray(d,d+P),b.pending),b.pending+=P})(b,d,P,!0)};b.exports._tr_init=b=>{j||((()=>{let b,d,P,L,o;const A=new Array(16);for(P=0,L=0;L<28;L++)for(w[L]=P,b=0;b<1<<q[L];b++)E[P++]=L;for(E[P-1]=L,o=0,L=0;L<16;L++)for(t[L]=o,b=0;b<1<<C[L];b++)s[o++]=L;for(o>>=7;L<W;L++)for(t[L]=o<<7,b=0;b<1<<C[L]-7;b++)s[256+o++]=L;for(d=0;d<=i;d++)A[d]=0;for(b=0;b<=143;)x[2*b+1]=8,b++,A[8]++;for(;b<=255;)x[2*b+1]=9,b++,A[9]++;for(;b<=279;)x[2*b+1]=7,b++,A[7]++;for(;b<=287;)x[2*b+1]=8,b++,A[8]++;for(M(x,287,A),b=0;b<W;b++)Y[2*b+1]=5,Y[2*b]=u(b,5);B=new r(x,q,257,G,i),n=new r(Y,C,0,W,i),Z=new r(new Array(0),J,0,19,7)})(),j=!0),b.l_desc=new o(b.dyn_ltree,B),b.d_desc=new o(b.dyn_dtree,n),b.bl_desc=new o(b.bl_tree,Z),b.bi_buf=0,b.bi_valid=0,e(b)},b.exports._tr_stored_block=a,b.exports._tr_flush_block=(b,d,G,W)=>{let i,q,C=0;b.level>0?(2===b.strm.data_type&&(b.strm.data_type=(b=>{let d,G=4093624447;for(d=0;d<=31;d++,G>>>=1)if(1&G&&0!==b.dyn_ltree[2*d])return 0;if(0!==b.dyn_ltree[18]||0!==b.dyn_ltree[20]||0!==b.dyn_ltree[26])return 1;for(d=32;d<P;d++)if(0!==b.dyn_ltree[2*d])return 1;return 0})(b)),S(b,b.l_desc),S(b,b.d_desc),C=(b=>{let d;for(l(b,b.dyn_ltree,b.l_desc.max_code),l(b,b.dyn_dtree,b.d_desc.max_code),S(b,b.bl_desc),d=18;d>=3&&0===b.bl_tree[2*L[d]+1];d--);return b.opt_len+=3*(d+1)+5+5+4,d})(b),i=b.opt_len+3+7>>>3,q=b.static_len+3+7>>>3,q<=i&&(i=q)):i=q=G+5,G+4<=i&&-1!==d?a(b,d,G,W):4===b.strategy||q===i?(g(b,2+(W?1:0),3),p(b,x,Y)):(g(b,4+(W?1:0),3),((b,d,P,G)=>{let W;for(g(b,d-257,5),g(b,P-1,5),g(b,G-4,4),W=0;W<G;W++)g(b,b.bl_tree[2*L[W]+1],3);N(b,b.dyn_ltree,d-1),N(b,b.dyn_dtree,P-1)})(b,b.l_desc.max_code+1,b.d_desc.max_code+1,C+1),p(b,b.dyn_ltree,b.dyn_dtree)),e(b),W&&R(b)},b.exports._tr_tally=(b,d,G)=>(b.pending_buf[b.d_buf+2*b.last_lit]=d>>>8&255,b.pending_buf[b.d_buf+2*b.last_lit+1]=255&d,b.pending_buf[b.l_buf+b.last_lit]=255&G,b.last_lit++,0===d?b.dyn_ltree[2*G]++:(b.matches++,d--,b.dyn_ltree[2*(E[G]+P+1)]++,b.dyn_dtree[2*A(d)]++),b.last_lit===b.lit_bufsize-1),b.exports._tr_align=b=>{g(b,2,3),X(b,256,x),(b=>{16===b.bi_valid?(f(b,b.bi_buf),b.bi_buf=0,b.bi_valid=0):b.bi_valid>=8&&(b.pending_buf[b.pending++]=255&b.bi_buf,b.bi_buf>>=8,b.bi_valid-=8)})(b)}},12849:b=>{"use strict";b.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.nd="",this.state=null,this.data_type=2,this.adler=0}},12455:b=>{function d(b,d,P){for(var G=b.length,W=-1/0,i=1/0,q=0;q<G;q++){var C=(P[0][q]-b[q])/d[q],J=(P[1][q]-b[q])/d[q];if(C>J){var L=C;C=J,J=L}if(J<W||C>i)return 1/0;C>W&&(W=C),J<i&&(i=J)}return W>i?1/0:W}b.exports=function(b,P,G,W){var i=d(P,G,W);if(i===1/0)b=null;else{b=b||[];for(var q=0;q<P.length;q++)b[q]=P[q]+G[q]*i}return b},b.exports.distance=d},13819:(b,d,P)=>{"use strict";P.d(d,{c:()=>q});var G=P(29);const W=G.useLayoutEffect;const i=function(b){var d=(0,G.useRef)(b);return W((function(){d.current=b})),d};var q=function(b){var d=i(b);(0,G.Yd)((function(){var b=function(b){var P;if(null!=d.current&&(P=d.current(b)),b.defaultPrevented&&(b.returnValue=""),"string"===typeof P)return b.returnValue=P,P};return window.addEventListener("beforeunload",b),function(){window.removeEventListener("beforeunload",b)}}),[])}},13762:(b,d,P)=>{"use strict";var G=P(13766),W=Array.prototype.concat,i=Array.prototype.slice,q=b.exports=function(b){for(var d=[],P=0,q=b.length;P<q;P++){var C=b[P];G(C)?d=W.call(d,i.call(C)):d.push(C)}return d};q.wrap=function(b){return function(){return b(q(arguments))}}},13766:b=>{b.exports=function(b){return!(!b||"string"===typeof b)&&(b instanceof Array||Array.isArray(b)||b.length>=0&&(b.splice instanceof Function||Object.getOwnPropertyDescriptor(b,b.length-1)&&"String"!==b.constructor.name))}},12754:(b,d,P)=>{var G=P(12756);function W(b){for(var d,P,W=0,i=b.length,q=0;q<b.length;){for(d=b[q],P=0;q<i&&b[q]===d;)++q,++P;W+=G.log2(P)/7|0,W+=G.log2(d>>>0)/7|0,W+=2}return W}d.size=W,d.encode=function(b,d){d||(d=new Uint8Array(W(b)));for(var P,G,i=0,q=d.length,C=0;C<b.length;){for(P=b[C],G=0;C<b.length&&b[C]===P;)++C,++G;for(;i<q&&G>=128;)d[i++]=128+(127&G),G>>>=7;if(i>=q)throw new Error("RLE buffer overflow");for(d[i++]=G,P>>>=0;i<q&&P>=128;)d[i++]=128+(127&P),P>>>=7;if(i>=q)throw new Error("RLE buffer overflow");d[i++]=P}return d},d.decode=function(b,d){for(var P,G,W,i,q=d.length,C=b.length,J=0,L=0;L<C;){for(P=0,G=0;L<C&&b[L]>=128;)P+=(127&b[L++])<<G,G+=7;if(P+=b[L++]<<G,L>=C)throw new Error("RLE buffer underrun");if(J+P>q)throw new Error("Chunk buffer overflow");for(W=0,G=0;L<C&&b[L]>=128;)W+=(127&b[L++])<<G,G+=7;if(L>=C)throw new Error("RLE buffer underrun");for(W+=b[L++]<<G,i=0;i<P;++i)d[J++]=W}return d}},12756:(b,d)=>{"use strict";function P(b){var d=32;return(b&=-b)&&d--,65535&b&&(d-=16),16711935&b&&(d-=8),252645135&b&&(d-=4),858993459&b&&(d-=2),1431655765&b&&(d-=1),d}d.INT_BITS=32,d.INT_MAX=2147483647,d.INT_MIN=-1<<31,d.sign=function(b){return(b>0)-(b<0)},d.abs=function(b){var d=b>>31;return(b^d)-d},d.min=function(b,d){return d^(b^d)&-(b<d)},d.max=function(b,d){return b^(b^d)&-(b<d)},d.isPow2=function(b){return!(b&b-1)&&!!b},d.log2=function(b){var d,P;return d=(b>65535)<<4,d|=P=((b>>>=d)>255)<<3,d|=P=((b>>>=P)>15)<<2,(d|=P=((b>>>=P)>3)<<1)|(b>>>=P)>>1},d.log10=function(b){return b>=1e9?9:b>=1e8?8:b>=1e7?7:b>=1e6?6:b>=1e5?5:b>=1e4?4:b>=1e3?3:b>=100?2:b>=10?1:0},d.popCount=function(b){return 16843009*((b=(858993459&(b-=b>>>1&1431655765))+(b>>>2&858993459))+(b>>>4)&252645135)>>>24},d.countTrailingZeros=P,d.nextPow2=function(b){return b+=0===b,--b,b|=b>>>1,b|=b>>>2,b|=b>>>4,b|=b>>>8,(b|=b>>>16)+1},d.prevPow2=function(b){return b|=b>>>1,b|=b>>>2,b|=b>>>4,b|=b>>>8,(b|=b>>>16)-(b>>>1)},d.parity=function(b){return b^=b>>>16,b^=b>>>8,b^=b>>>4,27030>>>(b&=15)&1};var G=new Array(256);!function(b){for(var d=0;d<256;++d){var P=d,G=d,W=7;for(P>>>=1;P;P>>>=1)G<<=1,G|=1&P,--W;b[d]=G<<W&255}}(G),d.reverse=function(b){return G[255&b]<<24|G[b>>>8&255]<<16|G[b>>>16&255]<<8|G[b>>>24&255]},d.interleave2=function(b,d){return(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))|(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d&=65535)|d<<8))|d<<4))|d<<2))|d<<1))<<1},d.deinterleave2=function(b,d){return(b=65535&((b=16711935&((b=252645135&((b=858993459&((b=b>>>d&1431655765)|b>>>1))|b>>>2))|b>>>4))|b>>>16))<<16>>16},d.interleave3=function(b,d,P){return b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2),(b|=(d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2))<<1)|(P=1227133513&((P=3272356035&((P=251719695&((P=4278190335&((P&=1023)|P<<16))|P<<8))|P<<4))|P<<2))<<2},d.deinterleave3=function(b,d){return(b=1023&((b=4278190335&((b=251719695&((b=3272356035&((b=b>>>d&1227133513)|b>>>2))|b>>>4))|b>>>8))|b>>>16))<<22>>22},d.nextCombination=function(b){var d=b|b-1;return d+1|(~d&-~d)-1>>>P(b)+1}},12787:b=>{"use strict";b.exports=function(b,d,P,G){var W=self||window;try{try{var i;try{i=new W.Blob([b])}catch(L){(i=new(W.BlobBuilder||W.WebKitBlobBuilder||W.MozBlobBuilder||W.MSBlobBuilder)).append(b),i=i.getBlob()}var q=W.URL||W.webkitURL,C=q.createObjectURL(i),J=new W[d](C,P);return q.revokeObjectURL(C),J}catch(L){return new W[d]("data:application/javascript,".concat(encodeURIComponent(b)),P)}}catch(L){if(!G)throw Error("Inline worker is not supported");return new W[d](G,P)}}},12445:(b,d,P)=>{"use strict";function G(b,d,P,G,W){var i={};return Object.keys(G).forEach((function(b){i[b]=G[b]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=P.slice().reverse().reduce((function(P,G){return G(b,d,P)||P}),i),W&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(W):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(b,d,i),i=null),i}P.d(d,{b:()=>G})},12441:(b,d,P)=>{"use strict";function G(b,d,P,G){P&&Object.defineProperty(b,d,{enumerable:P.enumerable,configurable:P.configurable,writable:P.writable,value:P.initializer?P.initializer.call(G):void 0})}P.d(d,{b:()=>G})},13803:(b,d,P)=>{"use strict";P.d(d,{c:()=>q,e:()=>Y,g:()=>C,j:()=>i,l:()=>J,o:()=>W,r:()=>L,u:()=>x});var G=P(11882);class W{constructor(){this._easingMode=W.EASINGMODE_EASEIN}setEasingMode(b){const d=Math.min(Math.max(b,0),2);this._easingMode=d}getEasingMode(){return this._easingMode}easeInCore(b){throw new Error("You must implement this method")}ease(b){switch(this._easingMode){case W.EASINGMODE_EASEIN:return this.easeInCore(b);case W.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-b)}return b>=.5?.5*(1-this.easeInCore(2*(1-b)))+.5:.5*this.easeInCore(2*b)}}W.EASINGMODE_EASEIN=0,W.EASINGMODE_EASEOUT=1,W.EASINGMODE_EASEINOUT=2;class i extends W{easeInCore(b){return b=Math.max(0,Math.min(1,b)),1-Math.sqrt(1-b*b)}}class q extends W{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=b}easeInCore(b){const d=Math.max(0,this.amplitude);return Math.pow(b,3)-b*d*Math.sin(3.141592653589793*b)}}class C extends W{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=b,this.bounciness=d}easeInCore(b){const d=Math.max(0,this.bounces);let P=this.bounciness;P<=1&&(P=1.001);const G=Math.pow(P,d),W=1-P,i=(1-G)/W+.5*G,q=b*i,C=Math.log(-q*(1-P)+1)/Math.log(P),J=Math.floor(C),L=J+1,x=(1-Math.pow(P,J))/(W*i),Y=.5*(x+(1-Math.pow(P,L))/(W*i)),s=b-Y,E=Y-x;return-Math.pow(1/P,d-J)/(E*E)*(s-E)*(s+E)}}class J extends W{easeInCore(b){return b*b*b}}class L extends W{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=b,this.springiness=d}easeInCore(b){let d;const P=Math.max(0,this.oscillations),G=Math.max(0,this.springiness);return d=0==G?b:(Math.exp(G*b)-1)/(Math.exp(G)-1),d*Math.sin((6.283185307179586*P+1.5707963267948966)*b)}}class x extends W{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=b}easeInCore(b){return this.exponent<=0?b:(Math.exp(this.exponent*b)-1)/(Math.exp(this.exponent)-1)}}class Y extends W{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=b,this.y1=d,this.x2=P,this.y2=G}easeInCore(b){return G.e.Interpolate(b,this.x1,this.y1,this.x2,this.y2)}}},13292:(b,d,P)=>{"use strict";P.d(d,{e:()=>q});var G=P(11681),W=P(11691),i=P(12111);class q extends i.c{get _matrix(){return this._compose(),this.fs}set _matrix(b){(b.updateFlag!==this.fs.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.fs.q(b),this._markAsDirtyAndDecompose())}constructor(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(b,d.Xb(),!1),this.name=b,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=d,this.fs=(null===W||void 0===W?void 0:W.clone())??G.Matrix.Identity(),this._restMatrix=i??this.fs.clone(),this._bindMatrix=q??this.fs.clone(),this._index=C,this._absoluteMatrix=new G.Matrix,this._absoluteBindMatrix=new G.Matrix,this._absoluteInverseBindMatrix=new G.Matrix,this._finalMatrix=new G.Matrix,d.bones.push(this),this.setParent(P,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(b){this.setParent(b)}setParent(b){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==b){if(this.parent){const b=this.parent.children.indexOf(this);-1!==b&&this.parent.children.splice(b,1)}this._parentNode=b,this.parent&&this.parent.children.push(this),d&&this._updateAbsoluteBindMatrices(),this.aL()}}getLocalMatrix(){return this._compose(),this.fs}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(b){this._restMatrix.q(b)}setRestPose(b){this.setRestMatrix(b)}getBindPose(){return this.getBindMatrix()}setBindMatrix(b){this.yd(b)}setBindPose(b){this.setBindMatrix(b)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const b=G.TmpVectors.ed[0],d=G.TmpVectors.Quaternion[0],P=G.TmpVectors.ed[1];this.getRestMatrix().decompose(b,d,P),this._linkedTransformNode.position.q(P),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??G.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.q(d),this._linkedTransformNode.hd.q(b)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(b){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=b,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.DC}set position(b){this._decompose(),this.DC.q(b),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(b){this.setRotation(b)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(b){this.setRotationQuaternion(b)}get hd(){return this.getScale()}set hd(b){this.setScale(b)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=G.ed.Zero(),this._localRotation=G.Quaternion.Zero(),this.DC=G.ed.Zero()),this.fs.decompose(this._localScaling,this._localRotation,this.DC))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,G.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.DC,this.fs)):this._needToCompose=!1)}yd(b){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.q(b),d&&this._updateAbsoluteBindMatrices(),P?this._matrix=b:this.aL()}_updateAbsoluteBindMatrices(b){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(b||(b=this._bindMatrix),this.parent?b.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.q(b),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),d)for(let P=0;P<this.children.length;P++)this.children[P]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}aL(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.aL(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.aL(),this._needToDecompose=!0}_updatePosition(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0,W=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=this.getLocalMatrix();if(0==d)W?(i.addAtIndex(12,b.x),i.addAtIndex(13,b.y),i.addAtIndex(14,b.z)):i.setTranslationFromFloats(b.x,b.y,b.z);else{let d=null;P&&(d=P.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const C=q._TmpMats[0],J=q._TmpVecs[0];this.parent?P&&d?(C.q(this.parent.getAbsoluteMatrix()),C.multiplyToRef(d,C)):C.q(this.parent.getAbsoluteMatrix()):G.Matrix.IdentityToRef(C),W&&C.setTranslationFromFloats(0,0,0),C.invert(),G.ed.TransformCoordinatesToRef(b,C,J),W?(i.addAtIndex(12,J.x),i.addAtIndex(13,J.y),i.addAtIndex(14,J.z)):i.setTranslationFromFloats(J.x,J.y,J.z)}this._markAsDirtyAndDecompose()}translate(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;this._updatePosition(b,d,P,!0)}setPosition(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;this._updatePosition(b,d,P,!1)}setAbsolutePosition(b,d){this.setPosition(b,1,d)}scale(b,d,P){let W=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=this.getLocalMatrix(),C=q._TmpMats[0];G.Matrix.ScalingToRef(b,d,P,C),C.multiplyToRef(i,i),C.invert();for(const G of this.children){const W=G.getLocalMatrix();W.multiplyToRef(C,W),W.multiplyAtIndex(12,b),W.multiplyAtIndex(13,d),W.multiplyAtIndex(14,P),G._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),W)for(const G of this.children)G.scale(b,d,P,W)}setScale(b){this._decompose(),this._localScaling.q(b),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(b){this._decompose(),b.q(this._localScaling)}setYawPitchRoll(b,d,P){let W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;if(0===W){const C=q._TmpQuat;return G.Quaternion.RotationYawPitchRollToRef(b,d,P,C),void this.setRotationQuaternion(C,W,i)}const C=q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(C,i))return;const J=q._TmpMats[1];G.Matrix.RotationYawPitchRollToRef(b,d,P,J),C.multiplyToRef(J,J),this._rotateWithMatrix(J,W,i)}rotate(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,W=arguments.length>3?arguments[3]:void 0;const i=q._TmpMats[0];i.setTranslationFromFloats(0,0,0),G.Matrix.RotationAxisToRef(b,d,i),this._rotateWithMatrix(i,P,W)}setAxisAngle(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,W=arguments.length>3?arguments[3]:void 0;if(0===P){const i=q._TmpQuat;return G.Quaternion.RotationAxisToRef(b,d,i),void this.setRotationQuaternion(i,P,W)}const i=q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(i,W))return;const C=q._TmpMats[1];G.Matrix.RotationAxisToRef(b,d,C),i.multiplyToRef(C,C),this._rotateWithMatrix(C,P,W)}setRotation(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(b.y,b.x,b.z,d,P)}setRotationQuaternion(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;if(0===d)return this._decompose(),this._localRotation.q(b),void this._markAsDirtyAndCompose();const W=q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(W,P))return;const i=q._TmpMats[1];G.Matrix.FromQuaternionToRef(b,i),W.multiplyToRef(i,i),this._rotateWithMatrix(i,d,P)}setRotationMatrix(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;if(0===d){const W=q._TmpQuat;return G.Quaternion.FromRotationMatrixToRef(b,W),void this.setRotationQuaternion(W,d,P)}const W=q._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(W,P))return;const i=q._TmpMats[1];i.q(b),W.multiplyToRef(b,i),this._rotateWithMatrix(i,d,P)}_rotateWithMatrix(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;const G=this.getLocalMatrix(),W=G.m[12],i=G.m[13],C=G.m[14],J=this.getParent(),L=q._TmpMats[3],x=q._TmpMats[4];J&&1==d?(P?(L.q(P.getWorldMatrix()),J.getAbsoluteMatrix().multiplyToRef(L,L)):L.q(J.getAbsoluteMatrix()),x.q(L),x.invert(),G.multiplyToRef(L,G),G.multiplyToRef(b,G),G.multiplyToRef(x,G)):1==d&&P?(L.q(P.getWorldMatrix()),x.q(L),x.invert(),G.multiplyToRef(L,G),G.multiplyToRef(b,G),G.multiplyToRef(x,G)):G.multiplyToRef(b,G),G.setTranslationFromFloats(W,i,C),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(b,d){const P=q._TmpMats[2];return b.q(this.getAbsoluteMatrix()),d?(b.multiplyToRef(d.getWorldMatrix(),b),G.Matrix.ScalingToRef(d.hd.x,d.hd.y,d.hd.z,P)):G.Matrix.IdentityToRef(P),b.invert(),!isNaN(b.m[0])&&(P.multiplyAtIndex(0,this._scalingDeterminant),b.multiplyToRef(P,b),!0)}sd(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=G.ed.Zero();return this.getPositionToRef(b,d,P),P}getPositionToRef(){let b=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const b=this.getLocalMatrix();d.x=b.m[12],d.y=b.m[13],d.z=b.m[14]}else{let P=null;b&&(P=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let G=q._TmpMats[0];b&&P?(G.q(this.getAbsoluteMatrix()),G.multiplyToRef(P,G)):G=this.getAbsoluteMatrix(),d.x=G.m[12],d.y=G.m[13],d.z=G.m[14]}}getAbsolutePosition(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const d=G.ed.Zero();return this.getPositionToRef(1,b,d),d}getAbsolutePositionToRef(b,d){this.getPositionToRef(1,b,d)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.fs.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.q(this.fs);const b=this._skeleton.getPoseMatrix();b&&this._absoluteMatrix.multiplyToRef(b,this._absoluteMatrix)}const b=this.children,d=b.length;for(let P=0;P<d;P++)b[P].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}rJ(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=G.ed.Zero();return this.getDirectionToRef(b,d,P),P}getDirectionToRef(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0,W=null;d&&(W=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const i=q._TmpMats[0];i.q(this.getAbsoluteMatrix()),d&&W&&i.multiplyToRef(W,i),G.ed.TransformNormalToRef(b,i,P),P.normalize()}getRotation(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=G.ed.Zero();return this.getRotationToRef(b,d,P),P}getRotationToRef(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0;const G=q._TmpQuat;this.getRotationQuaternionToRef(b,d,G),G.toEulerAnglesToRef(P)}getRotationQuaternion(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=G.Quaternion.Identity();return this.getRotationQuaternionToRef(b,d,P),P}getRotationQuaternionToRef(){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),d.q(this._localRotation);else{const P=q._TmpMats[0],G=this.getAbsoluteMatrix();b?G.multiplyToRef(b.getWorldMatrix(),P):P.q(G),P.multiplyAtIndex(0,this._scalingDeterminant),P.multiplyAtIndex(1,this._scalingDeterminant),P.multiplyAtIndex(2,this._scalingDeterminant),P.decompose(void 0,d,void 0)}}getRotationMatrix(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1?arguments[1]:void 0;const P=G.Matrix.Identity();return this.getRotationMatrixToRef(b,d,P),P}getRotationMatrixToRef(){let b=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(d);else{const P=q._TmpMats[0],G=this.getAbsoluteMatrix();b?G.multiplyToRef(b.getWorldMatrix(),P):P.q(G),P.multiplyAtIndex(0,this._scalingDeterminant),P.multiplyAtIndex(1,this._scalingDeterminant),P.multiplyAtIndex(2,this._scalingDeterminant),P.getRotationMatrixToRef(d)}}getAbsolutePositionFromLocal(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=G.ed.Zero();return this.getAbsolutePositionFromLocalToRef(b,d,P),P}getAbsolutePositionFromLocalToRef(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0,W=null;d&&(W=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const i=q._TmpMats[0];i.q(this.getAbsoluteMatrix()),d&&W&&i.multiplyToRef(W,i),G.ed.TransformCoordinatesToRef(b,i,P)}getLocalPositionFromAbsolute(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=G.ed.Zero();return this.getLocalPositionFromAbsoluteToRef(b,d,P),P}getLocalPositionFromAbsoluteToRef(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2?arguments[2]:void 0,W=null;d&&(W=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const i=q._TmpMats[0];i.q(this.getAbsoluteMatrix()),d&&W&&i.multiplyToRef(W,i),i.invert(),G.ed.TransformCoordinatesToRef(b,i,P)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const b=this._skeleton.bones.indexOf(this);if(-1!==b&&this._skeleton.bones.splice(b,1),this._parentNode&&this._parentNode.children){const b=this._parentNode.children,d=b.indexOf(this);-1!==d&&b.splice(d,1)}super.dispose()}}q._TmpVecs=(0,W.b)(2,G.ed.Zero),q._TmpQuat=G.Quaternion.Identity(),q._TmpMats=(0,W.b)(5,G.Matrix.Identity)},13794:(b,d,P)=>{"use strict";P.d(d,{b:()=>S});var G=P(11663),W=P(11670),i=P(11487),q=P(11681),C=P(11700),J=P(12111),L=P(12134),x=P(11951),Y=P(11517),s=P(11688);class E{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(b){this._zoomStopsAnimation=b}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(b){this._idleRotationSpeed=b}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(b){this._idleRotationWaitTime=b}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(b){this._idleRotationSpinupTime=b}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(b){this._attachedCamera=b;const d=this._attachedCamera.Xb();this._onPrePointerObservableObserver=d.onPrePointerObservable.add((b=>{b.type!==x.e.POINTERDOWN?b.type===x.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=b.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const b=Y.c.Now;let d=0;null!=this._lastFrameTime&&(d=b-this._lastFrameTime),this._lastFrameTime=b,this._applyUserInteraction();const P=b-this._lastInteractionTime-this._idleRotationWaitTime,G=Math.max(Math.min(P/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*G,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(d/1e3))}))}detach(){if(!this._attachedCamera)return;const b=this._attachedCamera.Xb();this._onPrePointerObservableObserver&&b.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(b){this._lastInteractionTime=b??Y.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<s.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let b=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(b=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?b:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Y.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var w=P(13803),t=P(12201);class r{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(b){if(this._autoTransitionRange===b)return;this._autoTransitionRange=b;const d=this._attachedCamera;d&&(b?this._onMeshTargetChangedObserver=d.onMeshTargetChangedObservable.add((b=>{if(b&&(b.zd(!0),b.getBoundingInfo)){const d=b.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*d,this.upperRadiusTransitionRange=.05*d}})):this._onMeshTargetChangedObserver&&d.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(b){this._attachedCamera=b,this._onAfterCheckInputsObserver=b.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(b){return!!this._attachedCamera&&(this._attachedCamera.radius===b&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(b){if(!this._attachedCamera)return;this._radiusBounceTransition||(r.EasingFunction.setEasingMode(r.EasingMode),this._radiusBounceTransition=t.b.CreateAnimation("radius",t.b.ANIMATIONTYPE_FLOAT,60,r.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const d=t.b.TransitionTo("radius",this._attachedCamera.radius+b,this._attachedCamera,this._attachedCamera.Xb(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));d&&this._animatables.push(d)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}r.EasingFunction=new w.c(.3),r.EasingMode=w.o.EASINGMODE_EASEOUT;class B{constructor(){this.onTargetFramingAnimationEndObservable=new i.d,this._mode=B.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(b){this._mode=b}get mode(){return this._mode}set radiusScale(b){this._radiusScale=b}get radiusScale(){return this._radiusScale}set positionScale(b){this._positionScale=b}get positionScale(){return this._positionScale}set defaultElevation(b){this._defaultElevation=b}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(b){this._elevationReturnTime=b}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(b){this._elevationReturnWaitTime=b}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(b){this._zoomStopsAnimation=b}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(b){this._framingTime=b}get framingTime(){return this._framingTime}init(){}attach(b){this._attachedCamera=b;const d=this._attachedCamera.Xb();B.EasingFunction.setEasingMode(B.EasingMode),this._onPrePointerObservableObserver=d.onPrePointerObservable.add((b=>{b.type!==x.e.POINTERDOWN?b.type===x.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=b.onMeshTargetChangedObservable.add((b=>{b&&b.getBoundingInfo&&this.zoomOnMesh(b,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=b.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const b=this._attachedCamera.Xb();this._onPrePointerObservableObserver&&b.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(b){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;b.zd(!0);const G=b.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(G.minimumWorld,G.maximumWorld,d,P)}zoomOnMeshHierarchy(b){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;b.zd(!0);const G=b.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(G.min,G.max,d,P)}zoomOnMeshesHierarchy(b){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new q.ed(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),W=new q.ed(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<b.length;i++){const d=b[i].getHierarchyBoundingVectors(!0);q.ed.CheckExtends(d.min,G,W),q.ed.CheckExtends(d.max,G,W)}this.zoomOnBoundingInfo(G,W,d,P)}zoomOnBoundingInfo(b,d){let P,G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const i=b.y,C=i+(d.y-i)*this._positionScale,J=d.Rd(b).scale(.5);if(!isFinite(C))return!1;if(G)P=new q.ed(0,C,0);else{const d=b.add(J);P=new q.ed(d.x,C,d.z)}this._vectorTransition||(this._vectorTransition=t.b.CreateAnimation("target",t.b.ANIMATIONTYPE_VECTOR3,60,B.EasingFunction)),this._betaIsAnimating=!0;let L=t.b.TransitionTo("target",P,this._attachedCamera,this._attachedCamera.Xb(),60,this._vectorTransition,this._framingTime);L&&this._animatables.push(L);let x=0;if(this._mode===B.FitFrustumSidesMode){const P=this._calculateLowerRadiusFromModelBoundingSphere(b,d);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=J.length()+this._attachedCamera.Vd),x=P}else this._mode===B.IgnoreBoundsSizeMode&&(x=this._calculateLowerRadiusFromModelBoundingSphere(b,d),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Vd));if(this.autoCorrectCameraLimitsAndSensibility){const P=d.Rd(b).length();this._attachedCamera.panningSensibility=5e3/P,this._attachedCamera.wheelPrecision=100/x}return this._radiusTransition||(this._radiusTransition=t.b.CreateAnimation("radius",t.b.ANIMATIONTYPE_FLOAT,60,B.EasingFunction)),L=t.b.TransitionTo("radius",x,this._attachedCamera,this._attachedCamera.Xb(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),W&&W(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),L&&this._animatables.push(L),!0}_calculateLowerRadiusFromModelBoundingSphere(b,d){const P=this._attachedCamera;if(!P)return 0;let G=P._calculateLowerRadiusFromModelBoundingSphere(b,d,this._radiusScale);return P.lowerRadiusLimit&&this._mode===B.IgnoreBoundsSizeMode&&(G=G<P.lowerRadiusLimit?P.lowerRadiusLimit:G),P.upperRadiusLimit&&(G=G>P.upperRadiusLimit?P.upperRadiusLimit:G),G}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const b=Y.c.Now-this._lastInteractionTime,d=.5*Math.PI-this._defaultElevation,P=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>P&&b>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=t.b.CreateAnimation("beta",t.b.ANIMATIONTYPE_FLOAT,60,B.EasingFunction));const b=t.b.TransitionTo("beta",d,this._attachedCamera,this._attachedCamera.Xb(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));b&&this._animatables.push(b)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=Y.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}B.EasingFunction=new w.u,B.EasingMode=w.o.EASINGMODE_EASEINOUT,B.IgnoreBoundsSizeMode=0,B.FitFrustumSidesMode=1;var n=P(12139),Z=P(12168),o=P(13288),A=P(11484);class f{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(b){b=A.Tools.BackCompatCameraNoPreventDefault(arguments);const d=this.camera.getEngine(),P=d.getInputElement();let G=0,W=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=i=>{var q,C;const J=i.event,L="touch"===J.pointerType;if(i.type!==x.e.POINTERMOVE&&-1===this.buttons.indexOf(J.button))return;const Y=J.target;if(this._altKey=J.altKey,this._ctrlKey=J.ctrlKey,this._metaKey=J.metaKey,this._shiftKey=J.shiftKey,this._buttonsPressed=J.buttons,d.isPointerLock){const b=J.movementX,d=J.movementY;this.onTouch(null,b,d),this._pointA=null,this._pointB=null}else{if(i.type!==x.e.POINTERDOWN&&i.type!==x.e.POINTERDOUBLETAP&&L&&(null===(q=this._pointA)||void 0===q?void 0:q.pointerId)!==J.pointerId&&(null===(C=this._pointB)||void 0===C?void 0:C.pointerId)!==J.pointerId)return;if(i.type!==x.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!L)if(i.type===x.e.POINTERDOUBLETAP)this.onDoubleTap(J.pointerType);else if(i.type!==x.e.POINTERUP||this._currentMousePointerIdDown!==J.pointerId&&!L){if(i.type===x.e.POINTERMOVE)if(b||J.preventDefault(),this._pointA&&null===this._pointB){const b=J.clientX-this._pointA.x,d=J.clientY-this._pointA.y;this._pointA.x=J.clientX,this._pointA.y=J.clientY,this.onTouch(this._pointA,b,d)}else if(this._pointA&&this._pointB){const b=this._pointA.pointerId===J.pointerId?this._pointA:this._pointB;b.x=J.clientX,b.y=J.clientY;const d=this._pointA.x-this._pointB.x,P=this._pointA.y-this._pointB.y,q=d*d+P*P,C={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:J.pointerId,type:i.type};this.onMultiTouch(this._pointA,this._pointB,G,q,W,C),W=C,G=q}}else{try{null===Y||void 0===Y||Y.releasePointerCapture(J.pointerId)}catch(s){}L||(this._pointB=null),d._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==J.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==J.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==G||W)&&(this.onMultiTouch(this._pointA,this._pointB,G,0,W,null),G=0,W=null),this._currentMousePointerIdDown=-1,this.onButtonUp(J),b||J.preventDefault()}else{try{null===Y||void 0===Y||Y.setPointerCapture(J.pointerId)}catch(s){}if(null===this._pointA)this._pointA={x:J.clientX,y:J.clientY,pointerId:J.pointerId,type:J.pointerType};else{if(null!==this._pointB)return;this._pointB={x:J.clientX,y:J.clientY,pointerId:J.pointerId,type:J.pointerType}}-1!==this._currentMousePointerIdDown||L||(this._currentMousePointerIdDown=J.pointerId),this.onButtonDown(J),b||(J.preventDefault(),P&&P.focus())}}},this._observer=this.camera.Xb()._inputManager._addCameraPointerObserver(this._pointerInput,x.e.POINTERDOWN|x.e.POINTERUP|x.e.POINTERMOVE|x.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,G=0,W=null,this.onLostFocus()},this._contextMenuBind=b=>this.onContextMenu(b),P&&P.addEventListener("contextmenu",this._contextMenuBind,!1);const i=this.camera.Xb().getEngine().getHostWindow();i&&A.Tools.RegisterTopRootEvents(i,[{name:"blur",handler:this._onLostFocus}])}SY(){if(this._onLostFocus){const b=this.camera.Xb().getEngine().getHostWindow();b&&A.Tools.UnregisterTopRootEvents(b,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.Xb()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const b=this.camera.Xb().getEngine().getInputElement();b&&b.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(b){}onTouch(b,d,P){}onMultiTouch(b,d,P,G,W,i){}onContextMenu(b){b.preventDefault()}onButtonDown(b){}onButtonUp(b){}onLostFocus(){}}(0,G.d)([(0,W.G)()],f.prototype,"buttons",void 0);class g extends f{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(b,d){if(0!==this.panningSensibility&&b&&d){const P=d.x-b.x,G=d.y-b.y;this.camera.inertialPanningX+=-P/this.panningSensibility,this.camera.inertialPanningY+=G/this.panningSensibility}}_computePinchZoom(b,d){const P=this.camera.radius||g.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=P*Math.sqrt(b)/Math.sqrt(d):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(d-b)*P*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(d-b)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(b,d,P){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-d/this.panningSensibility,this.camera.inertialPanningY+=P/this.panningSensibility):(this.camera.inertialAlphaOffset-=d/this.angularSensibilityX,this.camera.inertialBetaOffset-=P/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(b,d,P,G,W,i){0===P&&null===W||0===G&&null===i||(this.multiTouchPanAndZoom?(this._computePinchZoom(P,G),this._computeMultiTouchPanning(W,i)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(G)-Math.sqrt(P))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(P,G),this._isPinching=!0):this._computeMultiTouchPanning(W,i)):this.multiTouchPanning?this._computeMultiTouchPanning(W,i):this.pinchZoom&&this._computePinchZoom(P,G))}onButtonDown(b){this._isPanClick=b.button===this.camera._panningMouseButton}onButtonUp(b){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}g.MinimumRadiusForPinch=.001,(0,G.d)([(0,W.G)()],g.prototype,"buttons",void 0),(0,G.d)([(0,W.G)()],g.prototype,"angularSensibilityX",void 0),(0,G.d)([(0,W.G)()],g.prototype,"angularSensibilityY",void 0),(0,G.d)([(0,W.G)()],g.prototype,"pinchPrecision",void 0),(0,G.d)([(0,W.G)()],g.prototype,"pinchDeltaPercentage",void 0),(0,G.d)([(0,W.G)()],g.prototype,"useNaturalPinchZoom",void 0),(0,G.d)([(0,W.G)()],g.prototype,"pinchZoom",void 0),(0,G.d)([(0,W.G)()],g.prototype,"panningSensibility",void 0),(0,G.d)([(0,W.G)()],g.prototype,"multiTouchPanning",void 0),(0,G.d)([(0,W.G)()],g.prototype,"multiTouchPanAndZoom",void 0),o.e.ArcRotateCameraPointersInput=g;var X=P(11955);class u{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(b){b=A.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Xb(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((d=>{const P=d.event;if(!P.metaKey)if(d.type===X.c.KEYDOWN){if(this._ctrlPressed=P.ctrlKey,this._altPressed=P.altKey,-1!==this.keysUp.indexOf(P.keyCode)||-1!==this.keysDown.indexOf(P.keyCode)||-1!==this.keysLeft.indexOf(P.keyCode)||-1!==this.keysRight.indexOf(P.keyCode)||-1!==this.keysReset.indexOf(P.keyCode)){-1===this._keys.indexOf(P.keyCode)&&this._keys.push(P.keyCode),P.preventDefault&&(b||P.preventDefault())}}else if(-1!==this.keysUp.indexOf(P.keyCode)||-1!==this.keysDown.indexOf(P.keyCode)||-1!==this.keysLeft.indexOf(P.keyCode)||-1!==this.keysRight.indexOf(P.keyCode)||-1!==this.keysReset.indexOf(P.keyCode)){const d=this._keys.indexOf(P.keyCode);d>=0&&this._keys.splice(d,1),P.preventDefault&&(b||P.preventDefault())}})))}SY(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const b=this.camera;for(let d=0;d<this._keys.length;d++){const P=this._keys[d];-1!==this.keysLeft.indexOf(P)?this._ctrlPressed&&this.camera._useCtrlForPanning?b.inertialPanningX-=1/this.panningSensibility:b.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(P)?this._ctrlPressed&&this.camera._useCtrlForPanning?b.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?b.inertialRadiusOffset+=1/this.zoomingSensibility:b.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(P)?this._ctrlPressed&&this.camera._useCtrlForPanning?b.inertialPanningX+=1/this.panningSensibility:b.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(P)?this._ctrlPressed&&this.camera._useCtrlForPanning?b.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?b.inertialRadiusOffset-=1/this.zoomingSensibility:b.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(P)&&b.useInputToRestoreState&&b.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,G.d)([(0,W.G)()],u.prototype,"keysUp",void 0),(0,G.d)([(0,W.G)()],u.prototype,"keysDown",void 0),(0,G.d)([(0,W.G)()],u.prototype,"keysLeft",void 0),(0,G.d)([(0,W.G)()],u.prototype,"keysRight",void 0),(0,G.d)([(0,W.G)()],u.prototype,"keysReset",void 0),(0,G.d)([(0,W.G)()],u.prototype,"panningSensibility",void 0),(0,G.d)([(0,W.G)()],u.prototype,"zoomingSensibility",void 0),(0,G.d)([(0,W.G)()],u.prototype,"useAltToZoom",void 0),(0,G.d)([(0,W.G)()],u.prototype,"angularSpeed",void 0),o.e.ArcRotateCameraKeyboardMoveInput=u;var M=P(11733),e=P(11958);class R{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new q.ed(0,0,0),this._globalOffset=new q.ed(0,0,0),this._inertialPanning=q.ed.Zero()}_computeDeltaFromMouseWheelLegacyEvent(b,d){let P=0;const G=.01*b*this.wheelDeltaPercentage*d;return P=b>0?G/(1+this.wheelDeltaPercentage):G*(1+this.wheelDeltaPercentage),P}attachControl(b){b=A.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=d=>{if(d.type!==x.e.POINTERWHEEL)return;const P=d.event;let G=0;const W=P.deltaMode===e.c.DOM_DELTA_LINE?40:1,i=-P.deltaY*W;if(this.customComputeDeltaFromMouseWheel)G=this.customComputeDeltaFromMouseWheel(i,this,P);else if(this.wheelDeltaPercentage){if(G=this._computeDeltaFromMouseWheelLegacyEvent(i,this.camera.radius),G>0){let b=this.camera.radius,d=this.camera.inertialRadiusOffset+G;for(let P=0;P<20&&!(b<=d)&&!(Math.abs(d*this.camera.inertia)<.001);P++)b-=d,d*=this.camera.inertia;b=(0,C.Clamp)(b,0,Number.MAX_VALUE),G=this._computeDeltaFromMouseWheelLegacyEvent(i,b)}}else G=i/(40*this.wheelPrecision);G&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(G)):this.camera.inertialRadiusOffset+=G),P.preventDefault&&(b||P.preventDefault())},this._observer=this.camera.Xb()._inputManager._addCameraPointerObserver(this._wheel,x.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.kd(0)}SY(){this._observer&&(this.camera.Xb()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const b=this.camera;0+b.inertialAlphaOffset+b.inertialBetaOffset+b.inertialRadiusOffset&&(this._updateHitPlane(),b.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(b.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const b=this.camera,d=b.target.Rd(b.position);this._hitPlane=M.d.FromPositionAndNormal(b.target,d)}_getPosition(){const b=this.camera,d=b.Xb(),P=d.createPickingRay(d.pointerX,d.pointerY,q.Matrix.Identity(),b,!1);0===b.targetScreenOffset.x&&0===b.targetScreenOffset.y||(this._viewOffset.set(b.targetScreenOffset.x,b.targetScreenOffset.y,0),b.getViewMatrix().invertToRef(b._cameraTransformMatrix),this._globalOffset=q.ed.TransformNormal(this._viewOffset,b._cameraTransformMatrix),P.origin.addInPlace(this._globalOffset));let G=0;return this._hitPlane&&(G=P.intersectsPlane(this._hitPlane)??0),P.origin.addInPlace(P.direction.scaleInPlace(G))}_zoomToMouse(b){const d=this.camera,P=1-d.inertia;if(d.lowerRadiusLimit){const G=d.lowerRadiusLimit??0;d.radius-(d.inertialRadiusOffset+b)/P<G&&(b=(d.radius-G)*P-d.inertialRadiusOffset)}if(d.upperRadiusLimit){const G=d.upperRadiusLimit??0;d.radius-(d.inertialRadiusOffset+b)/P>G&&(b=(d.radius-G)*P-d.inertialRadiusOffset)}const G=b/P/d.radius,W=this._getPosition(),i=q.TmpVectors.ed[6];W.subtractToRef(d.target,i),i.scaleInPlace(G),i.scaleInPlace(P),this._inertialPanning.addInPlace(i),d.inertialRadiusOffset+=b}_zeroIfClose(b){Math.abs(b.x)<s.c&&(b.x=0),Math.abs(b.y)<s.c&&(b.y=0),Math.abs(b.z)<s.c&&(b.z=0)}}(0,G.d)([(0,W.G)()],R.prototype,"wheelPrecision",void 0),(0,G.d)([(0,W.G)()],R.prototype,"zoomToMouseLocation",void 0),(0,G.d)([(0,W.G)()],R.prototype,"wheelDeltaPercentage",void 0),o.e.ArcRotateCameraMouseWheelInput=R;class U extends o.h{constructor(b){super(b)}addMouseWheel(){return this.add(new R),this}addPointers(){return this.add(new g),this}addKeyboard(){return this.add(new u),this}}var H=P(11639);function p(b,d){return isNaN(b)?d:b}J.c.AddNodeConstructor("ArcRotateCamera",((b,d)=>()=>new S(b,0,0,1,q.ed.Zero(),d)));class S extends Z.d{get target(){return this._target}set target(b){this.setTarget(b)}get targetHost(){return this._targetHost}set targetHost(b){b&&this.setTarget(b)}getTarget(){return this.target}get position(){return this._position}set position(b){this.setPosition(b)}set upVector(b){this._upToYMatrix||(this._yToUpMatrix=new q.Matrix,this._upToYMatrix=new q.Matrix,this._upVector=q.ed.Zero()),b.normalize(),this._upVector.q(b),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){q.Matrix.RotationAlignToRef(q.ed.UpReadOnly,this._upVector,this._yToUpMatrix),q.Matrix.RotationAlignToRef(this._upVector,q.ed.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const b=this.inputs.attached.pointers;return b?b.angularSensibilityX:0}set angularSensibilityX(b){const d=this.inputs.attached.pointers;d&&(d.angularSensibilityX=b)}get angularSensibilityY(){const b=this.inputs.attached.pointers;return b?b.angularSensibilityY:0}set angularSensibilityY(b){const d=this.inputs.attached.pointers;d&&(d.angularSensibilityY=b)}get pinchPrecision(){const b=this.inputs.attached.pointers;return b?b.pinchPrecision:0}set pinchPrecision(b){const d=this.inputs.attached.pointers;d&&(d.pinchPrecision=b)}get pinchDeltaPercentage(){const b=this.inputs.attached.pointers;return b?b.pinchDeltaPercentage:0}set pinchDeltaPercentage(b){const d=this.inputs.attached.pointers;d&&(d.pinchDeltaPercentage=b)}get useNaturalPinchZoom(){const b=this.inputs.attached.pointers;return!!b&&b.useNaturalPinchZoom}set useNaturalPinchZoom(b){const d=this.inputs.attached.pointers;d&&(d.useNaturalPinchZoom=b)}get panningSensibility(){const b=this.inputs.attached.pointers;return b?b.panningSensibility:0}set panningSensibility(b){const d=this.inputs.attached.pointers;d&&(d.panningSensibility=b)}get keysUp(){const b=this.inputs.attached.keyboard;return b?b.keysUp:[]}set keysUp(b){const d=this.inputs.attached.keyboard;d&&(d.keysUp=b)}get keysDown(){const b=this.inputs.attached.keyboard;return b?b.keysDown:[]}set keysDown(b){const d=this.inputs.attached.keyboard;d&&(d.keysDown=b)}get keysLeft(){const b=this.inputs.attached.keyboard;return b?b.keysLeft:[]}set keysLeft(b){const d=this.inputs.attached.keyboard;d&&(d.keysLeft=b)}get keysRight(){const b=this.inputs.attached.keyboard;return b?b.keysRight:[]}set keysRight(b){const d=this.inputs.attached.keyboard;d&&(d.keysRight=b)}get wheelPrecision(){const b=this.inputs.attached.mousewheel;return b?b.wheelPrecision:0}set wheelPrecision(b){const d=this.inputs.attached.mousewheel;d&&(d.wheelPrecision=b)}get zoomToMouseLocation(){const b=this.inputs.attached.mousewheel;return!!b&&b.zoomToMouseLocation}set zoomToMouseLocation(b){const d=this.inputs.attached.mousewheel;d&&(d.zoomToMouseLocation=b)}get wheelDeltaPercentage(){const b=this.inputs.attached.mousewheel;return b?b.wheelDeltaPercentage:0}set wheelDeltaPercentage(b){const d=this.inputs.attached.mousewheel;d&&(d.wheelDeltaPercentage=b)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(b){b!==this.useBouncingBehavior&&(b?(this._bouncingBehavior=new r,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(b){b!==this.useFramingBehavior&&(b?(this._framingBehavior=new B,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(b){b!==this.useAutoRotationBehavior&&(b?(this._autoRotationBehavior=new E,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(b,d,P,G,W,C){var J;let L=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(b,q.ed.Zero(),C,L),J=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=q.ed.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=q.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new q.Matrix,this.panningAxis=new q.ed(1,1,0),this._transformedDirection=new q.ed,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new i.d,this.checkCollisions=!1,this.collisionRadius=new q.ed(.5,.5,.5),this._previousPosition=q.ed.Zero(),this._collisionVelocity=q.ed.Zero(),this._newPosition=q.ed.Zero(),this._computationVector=q.ed.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new q.ed(NaN,NaN,NaN),this._goalTargetScreenOffset=new q.Vector2(NaN,NaN),this._onCollisionPositionChange=function(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;P?(J.setPosition(d),J.BE&&J.BE(P)):J._previousPosition.q(J._position);const G=Math.cos(J.alpha),W=Math.sin(J.alpha),i=Math.cos(J.beta);let q=Math.sin(J.beta);0===q&&(q=1e-4);const C=J._getTargetPosition();J._computationVector.Fd(J.radius*G*q,J.radius*i,J.radius*W*q),C.addToRef(J._computationVector,J._newPosition),J._position.q(J._newPosition);let L=J.upVector;J.allowUpsideDown&&J.beta<0&&(L=L.clone(),L=L.negate()),J._computeViewMatrix(J._position,C,L),J._viewMatrix.addAtIndex(12,J.targetScreenOffset.x),J._viewMatrix.addAtIndex(13,J.targetScreenOffset.y),J._collisionTriggered=!1},this._target=q.ed.Zero(),W&&this.setTarget(W),this.alpha=d,this.beta=P,this.radius=G,this.getViewMatrix(),this.inputs=new U(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new q.ed(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=q.Vector2.Zero()}_updateCache(b){b||super._updateCache(),this._cache._target.q(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.q(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const b=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?b.addToRef(this._targetBoundingCenter,this._target):this._target.q(b)}const b=this._getLockedTargetPosition();return b||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>s.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,i=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=i?this._currentInterpolationFactor=i:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=p(b,this._goalAlpha),this._goalBeta=p(d,this._goalBeta),this._goalRadius=p(P,this._goalRadius),this._goalTarget.set(p(G.x,this._goalTarget.x),p(G.y,this._goalTarget.y),p(G.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(p(W.x,this._goalTargetScreenOffset.x),p(W.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,C.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,C.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,C.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,C.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(b,d){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const W=arguments;d=A.Tools.BackCompatCameraNoPreventDefault(W),this._useCtrlForPanning=P,this._panningMouseButton=G,"boolean"===typeof W[0]&&(W.length>1&&(this._useCtrlForPanning=W[1]),W.length>2&&(this._panningMouseButton=W[2])),this.inputs.attachElement(d),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}SY(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let b=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){b=!0;const d=this.invertRotation?-1:1,P=this._calculateHandednessMultiplier();let G=this.inertialAlphaOffset*P;this.beta<0&&(G*=-1),this.alpha+=G*d,this.beta+=this.inertialBetaOffset*d,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<s.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<s.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*s.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){b=!0;const d=new q.ed(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),d.multiplyInPlace(this.panningAxis),q.ed.TransformNormalToRef(d,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const b=this.upVector,d=q.ed.CrossToRef(this._transformedDirection,b,this._transformedDirection);q.ed.CrossToRef(b,d,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);q.ed.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.q(this._transformedDirection)}else{if(this.parent){const b=q.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(b),b.transposeToRef(b),q.ed.TransformCoordinatesToRef(this._transformedDirection,b,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*s.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*s.c&&(this.inertialPanningY=0)}if(b)this.stopInterpolation();else if(this._isInterpolating){let b=!1;const d=this._scene.getEngine().getDeltaTime()/1e3,P=1-Math.pow(2,-d/this._currentInterpolationFactor),G=p(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const d=q.TmpVectors.ed[0].set(p(this._goalTarget.x,this._target.x),p(this._goalTarget.y,this._target.y),p(this._goalTarget.z,this._target.z));q.ed.LerpToRef(this.target,d,P,this._target),10*q.ed.Distance(this.target,d)/G<s.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.q(d),this.setTarget(this.target,!1,!0,!0)):b=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const d=q.Quaternion.RotationAlphaBetaGammaToRef(p(this._goalAlpha,this.alpha),p(this._goalBeta,this.beta),0,q.TmpVectors.Quaternion[0]),G=q.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,q.TmpVectors.Quaternion[1]),W=q.Quaternion.SlerpToRef(G,d,P,q.TmpVectors.Quaternion[2]);W.normalize();const i=W.toAlphaBetaGammaToRef(q.TmpVectors.ed[0]);if(this.alpha=i.x,this.beta=i.y,W.isApprox(d,s.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const b=d.toAlphaBetaGammaToRef(q.TmpVectors.ed[0]);this.alpha=b.x,this.beta=b.y}else b=!0}if(isNaN(this._goalRadius)||(this.radius+=(G-this.radius)*P,Math.abs(G/this.radius-1)<s.c?(this._goalRadius=NaN,this.radius=G):b=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const d=q.TmpVectors.Vector2[0].set(p(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),p(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));q.Vector2.LerpToRef(this.targetScreenOffset,d,P,this.targetScreenOffset),q.Vector2.Distance(this.targetScreenOffset,d)<s.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.q(d)):b=!0}this._isInterpolating=b}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||q.ed.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const b=this.alpha;var d,P;this.alpha=function(b){let d=Math.PI/2;return 0===b.x&&0===b.z||(d=Math.acos(b.x/Math.sqrt(Math.pow(b.x,2)+Math.pow(b.z,2)))),b.z<0&&(d=2*Math.PI-d),d}(this._computationVector),this.beta=(d=this._computationVector.y,P=this.radius,Math.acos(d/P));const G=Math.round((b-this.alpha)/(2*Math.PI));this.alpha+=2*G*Math.PI,this._checkLimits()}setPosition(b){this._position.equals(b)||(this._position.q(b),this.rebuildAnglesAndRadius())}setTarget(b){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(G=this.overrideCloneAlphaBetaRadius??G,b.zd)d&&b.getBoundingInfo?this._targetBoundingCenter=b.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,b.zd(),this._targetHost=b,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const d=b,G=this._getTargetPosition();if(G&&!P&&G.equals(d))return;this._targetHost=null,this._target=d,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}G||this.rebuildAnglesAndRadius()}_getViewMatrix(){const b=Math.cos(this.alpha),d=Math.sin(this.alpha),P=Math.cos(this.beta);let G=Math.sin(this.beta);0===G&&(G=1e-4),0===this.radius&&(this.radius=1e-4);const W=this._getTargetPosition();if(this._computationVector.Fd(this.radius*b*G,this.radius*P,this.radius*d*G),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||q.ed.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),W.addToRef(this._computationVector,this._newPosition),this.Xb().collisionsEnabled&&this.checkCollisions){const b=this.Xb().collisionCoordinator;this._collider||(this._collider=b.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,b.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.q(this._newPosition);let b=this.upVector;this.allowUpsideDown&&G<0&&(b=b.negate()),this._computeViewMatrix(this._position,W,b),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.q(W),this._viewMatrix}zoomOn(b){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];b=b||this.Xb().meshes;const P=L.d.MinMax(b);let G=this._calculateLowerRadiusFromModelBoundingSphere(P.min,P.max);if(G=Math.max(Math.min(G,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=G*this.zoomOnFactor,this.mode===n.c.ORTHOGRAPHIC_CAMERA){const b=this.Xb().getEngine().getAspectRatio(this),d=G*this.zoomOnFactor/2;this.orthoLeft=-d*b,this.orthoRight=d*b,this.orthoBottom=-d,this.orthoTop=d}this.focusOn({min:P.min,max:P.max,distance:G},d)}focusOn(b){let d,P,G=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===b.min){const G=b||this.Xb().meshes;d=L.d.MinMax(G),P=q.ed.Distance(d.min,d.max)}else{d=b,P=b.distance}this._target=L.d.Center(d),G||(this.maxZ=2*P)}createRigCamera(b,d){let P=0;switch(this.cameraRigMode){case n.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case n.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case n.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case n.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case n.c.RIG_MODE_VR:P=this._cameraRigParams.stereoHalfAngle*(0===d?1:-1);break;case n.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:P=this._cameraRigParams.stereoHalfAngle*(0===d?-1:1)}const G=new S(b,this.alpha+P,this.beta,this.radius,this._target,this.Xb());return G._cameraRigParams={},G.isRigCamera=!0,G.rigParent=this,G.upVector=this.upVector,G.mode=this.mode,G.orthoLeft=this.orthoLeft,G.orthoRight=this.orthoRight,G.orthoBottom=this.orthoBottom,G.orthoTop=this.orthoTop,G}_updateRigCameras(){const b=this._rigCameras[0],d=this._rigCameras[1];switch(b.beta=d.beta=this.beta,this.cameraRigMode){case n.c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case n.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case n.c.RIG_MODE_STEREOSCOPIC_OVERUNDER:case n.c.RIG_MODE_STEREOSCOPIC_INTERLACED:case n.c.RIG_MODE_VR:b.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,d.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case n.c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:b.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,d.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const G=q.ed.Distance(b,d),W=this.Xb().getEngine().getAspectRatio(this),i=Math.tan(this.fov/2),C=i*W,J=.5*G*P,L=J*Math.sqrt(1+1/(C*C)),x=J*Math.sqrt(1+1/(i*i));return Math.max(L,x)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,G.d)([(0,W.G)()],S.prototype,"alpha",void 0),(0,G.d)([(0,W.G)()],S.prototype,"beta",void 0),(0,G.d)([(0,W.G)()],S.prototype,"radius",void 0),(0,G.d)([(0,W.G)()],S.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,G.d)([(0,W.F)("target")],S.prototype,"_target",void 0),(0,G.d)([(0,W.y)("targetHost")],S.prototype,"_targetHost",void 0),(0,G.d)([(0,W.G)()],S.prototype,"inertialAlphaOffset",void 0),(0,G.d)([(0,W.G)()],S.prototype,"inertialBetaOffset",void 0),(0,G.d)([(0,W.G)()],S.prototype,"inertialRadiusOffset",void 0),(0,G.d)([(0,W.G)()],S.prototype,"lowerAlphaLimit",void 0),(0,G.d)([(0,W.G)()],S.prototype,"upperAlphaLimit",void 0),(0,G.d)([(0,W.G)()],S.prototype,"lowerBetaLimit",void 0),(0,G.d)([(0,W.G)()],S.prototype,"upperBetaLimit",void 0),(0,G.d)([(0,W.G)()],S.prototype,"lowerRadiusLimit",void 0),(0,G.d)([(0,W.G)()],S.prototype,"upperRadiusLimit",void 0),(0,G.d)([(0,W.G)()],S.prototype,"lowerTargetYLimit",void 0),(0,G.d)([(0,W.G)()],S.prototype,"inertialPanningX",void 0),(0,G.d)([(0,W.G)()],S.prototype,"inertialPanningY",void 0),(0,G.d)([(0,W.G)()],S.prototype,"pinchToPanMaxDistance",void 0),(0,G.d)([(0,W.G)()],S.prototype,"panningDistanceLimit",void 0),(0,G.d)([(0,W.F)()],S.prototype,"panningOriginTarget",void 0),(0,G.d)([(0,W.G)()],S.prototype,"panningInertia",void 0),(0,G.d)([(0,W.G)()],S.prototype,"zoomToMouseLocation",null),(0,G.d)([(0,W.G)()],S.prototype,"zoomOnFactor",void 0),(0,G.d)([(0,W.D)()],S.prototype,"targetScreenOffset",void 0),(0,G.d)([(0,W.G)()],S.prototype,"allowUpsideDown",void 0),(0,G.d)([(0,W.G)()],S.prototype,"useInputToRestoreState",void 0),(0,G.d)([(0,W.G)()],S.prototype,"restoreStateInterpolationFactor",void 0),(0,H.f)("BABYLON.ArcRotateCamera",S)},13288:(b,d,P)=>{"use strict";P.d(d,{e:()=>q,h:()=>C});var G=P(11504),W=P(11716),i=P(12139),q={};class C{constructor(b){this.attachedToElement=!1,this.attached={},this.camera=b,this.checkInputs=()=>{}}add(b){const d=b.getSimpleName();this.attached[d]?G.e.Warn("camera input of type "+d+" already exists on camera"):(this.attached[d]=b,b.camera=this.camera,b.checkInputs&&(this.checkInputs=this._addCheckInputs(b.checkInputs.bind(b))),this.attachedToElement&&b.attachControl(this.noPreventDefault))}remove(b){for(const d in this.attached){const P=this.attached[d];if(P===b)return P.SY(),P.camera=null,delete this.attached[d],void this.rebuildInputCheck()}}removeByType(b){for(const d in this.attached){const P=this.attached[d];P.getClassName()===b&&(P.SY(),P.camera=null,delete this.attached[d],this.rebuildInputCheck())}}_addCheckInputs(b){const d=this.checkInputs;return()=>{d(),b()}}attachInput(b){this.attachedToElement&&b.attachControl(this.noPreventDefault)}attachElement(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){b=!i.c.ForceAttachControlToAlwaysPreventDefault&&b,this.attachedToElement=!0,this.noPreventDefault=b;for(const d in this.attached)this.attached[d].attachControl(b)}}detachElement(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const d in this.attached)this.attached[d].SY(),b&&(this.attached[d].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const b in this.attached){const d=this.attached[b];d.checkInputs&&(this.checkInputs=this._addCheckInputs(d.checkInputs.bind(d)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(b){const d={};for(const P in this.attached){const b=this.attached[P],G=W.c.Serialize(b);d[b.getClassName()]=G}b.inputsmgr=d}parse(b){const d=b.inputsmgr;if(d){this.clear();for(const b in d){const P=q[b];if(P){const G=d[b],i=W.c.Parse((()=>new P),G,null);this.add(i)}}}else for(const P in this.attached){const d=q[this.attached[P].getClassName()];if(d){const G=W.c.Parse((()=>new d),b,null);this.remove(this.attached[P]),this.add(G)}}}}},13281:(b,d,P)=>{"use strict";P.d(d,{b:()=>f});var G=P(11663),W=P(11670),i=P(11681),q=P(12168),C=P(13288),J=P(11955),L=P(11484);class x{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(b){b=L.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.Xb(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((d=>{const P=d.event;if(!P.metaKey)if(d.type===J.c.KEYDOWN){if(-1!==this.keysUp.indexOf(P.keyCode)||-1!==this.keysDown.indexOf(P.keyCode)||-1!==this.keysLeft.indexOf(P.keyCode)||-1!==this.keysRight.indexOf(P.keyCode)||-1!==this.keysUpward.indexOf(P.keyCode)||-1!==this.keysDownward.indexOf(P.keyCode)||-1!==this.keysRotateLeft.indexOf(P.keyCode)||-1!==this.keysRotateRight.indexOf(P.keyCode)||-1!==this.keysRotateUp.indexOf(P.keyCode)||-1!==this.keysRotateDown.indexOf(P.keyCode)){-1===this._keys.indexOf(P.keyCode)&&this._keys.push(P.keyCode),b||P.preventDefault()}}else if(-1!==this.keysUp.indexOf(P.keyCode)||-1!==this.keysDown.indexOf(P.keyCode)||-1!==this.keysLeft.indexOf(P.keyCode)||-1!==this.keysRight.indexOf(P.keyCode)||-1!==this.keysUpward.indexOf(P.keyCode)||-1!==this.keysDownward.indexOf(P.keyCode)||-1!==this.keysRotateLeft.indexOf(P.keyCode)||-1!==this.keysRotateRight.indexOf(P.keyCode)||-1!==this.keysRotateUp.indexOf(P.keyCode)||-1!==this.keysRotateDown.indexOf(P.keyCode)){const d=this._keys.indexOf(P.keyCode);d>=0&&this._keys.splice(d,1),b||P.preventDefault()}})))}SY(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const b=this.camera;for(let d=0;d<this._keys.length;d++){const P=this._keys[d],G=b._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(P)?b._localDirection.Fd(-G,0,0):-1!==this.keysUp.indexOf(P)?b._localDirection.Fd(0,0,G):-1!==this.keysRight.indexOf(P)?b._localDirection.Fd(G,0,0):-1!==this.keysDown.indexOf(P)?b._localDirection.Fd(0,0,-G):-1!==this.keysUpward.indexOf(P)?b._localDirection.Fd(0,G,0):-1!==this.keysDownward.indexOf(P)?b._localDirection.Fd(0,-G,0):-1!==this.keysRotateLeft.indexOf(P)?(b._localDirection.Fd(0,0,0),b.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(P)?(b._localDirection.Fd(0,0,0),b.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(P)?(b._localDirection.Fd(0,0,0),b.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(P)&&(b._localDirection.Fd(0,0,0),b.cameraRotation.x+=this._getLocalRotation()),b.Xb().useRightHandedSystem&&(b._localDirection.z*=-1),b.getViewMatrix().invertToRef(b._cameraTransformMatrix),i.ed.TransformNormalToRef(b._localDirection,b._cameraTransformMatrix,b._transformedDirection),b.cameraDirection.addInPlace(b._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const b=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*b}}(0,G.d)([(0,W.G)()],x.prototype,"keysUp",void 0),(0,G.d)([(0,W.G)()],x.prototype,"keysUpward",void 0),(0,G.d)([(0,W.G)()],x.prototype,"keysDown",void 0),(0,G.d)([(0,W.G)()],x.prototype,"keysDownward",void 0),(0,G.d)([(0,W.G)()],x.prototype,"keysLeft",void 0),(0,G.d)([(0,W.G)()],x.prototype,"keysRight",void 0),(0,G.d)([(0,W.G)()],x.prototype,"rotationSpeed",void 0),(0,G.d)([(0,W.G)()],x.prototype,"keysRotateLeft",void 0),(0,G.d)([(0,W.G)()],x.prototype,"keysRotateRight",void 0),(0,G.d)([(0,W.G)()],x.prototype,"keysRotateUp",void 0),(0,G.d)([(0,W.G)()],x.prototype,"keysRotateDown",void 0),C.e.FreeCameraKeyboardMoveInput=x;var Y=P(11487),s=P(11951);class E{constructor(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=b,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new Y.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(b){b=L.Tools.BackCompatCameraNoPreventDefault(arguments);const d=this.camera.getEngine(),P=d.getInputElement();this._pointerInput||(this._pointerInput=G=>{const W=G.event,i="touch"===W.pointerType;if(!this.touchEnabled&&i)return;if(G.type!==s.e.POINTERMOVE&&-1===this.buttons.indexOf(W.button))return;const q=W.target;if(G.type===s.e.POINTERDOWN){if(i&&-1!==this._activePointerId||!i&&-1!==this._currentActiveButton)return;this._activePointerId=W.pointerId;try{null===q||void 0===q||q.setPointerCapture(W.pointerId)}catch(C){}-1===this._currentActiveButton&&(this._currentActiveButton=W.button),this._previousPosition={x:W.clientX,y:W.clientY},b||(W.preventDefault(),P&&P.focus()),d.isPointerLock&&this._onMouseMove&&this._onMouseMove(G.event)}else if(G.type===s.e.POINTERUP){if(i&&this._activePointerId!==W.pointerId||!i&&this._currentActiveButton!==W.button)return;try{null===q||void 0===q||q.releasePointerCapture(W.pointerId)}catch(C){}this._currentActiveButton=-1,this._previousPosition=null,b||W.preventDefault(),this._activePointerId=-1}else if(G.type===s.e.POINTERMOVE&&(this._activePointerId===W.pointerId||!i))if(d.isPointerLock&&this._onMouseMove)this._onMouseMove(G.event);else if(this._previousPosition){const d=this.camera._calculateHandednessMultiplier(),P=(W.clientX-this._previousPosition.x)*d,G=W.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=P/this.angularSensibility,this.camera.cameraRotation.x+=G/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:P,offsetY:G}),this._previousPosition={x:W.clientX,y:W.clientY},b||W.preventDefault()}}),this._onMouseMove=P=>{if(!d.isPointerLock)return;const G=this.camera._calculateHandednessMultiplier(),W=P.movementX*G;this.camera.cameraRotation.y+=W/this.angularSensibility;const i=P.movementY;this.camera.cameraRotation.x+=i/this.angularSensibility,this._previousPosition=null,b||P.preventDefault()},this._observer=this.camera.Xb()._inputManager._addCameraPointerObserver(this._pointerInput,s.e.POINTERDOWN|s.e.POINTERUP|s.e.POINTERMOVE),P&&(this._contextMenuBind=b=>this.onContextMenu(b),P.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(b){b.preventDefault()}SY(){if(this._observer){if(this.camera.Xb()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const b=this.camera.getEngine().getInputElement();b&&b.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,G.d)([(0,W.G)()],E.prototype,"buttons",void 0),(0,G.d)([(0,W.G)()],E.prototype,"angularSensibility",void 0),C.e.FreeCameraMouseInput=E;var w,t=P(11958);class r{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new Y.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(b){b=L.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=d=>{if(d.type!==s.e.POINTERWHEEL)return;const P=d.event,G=P.deltaMode===t.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*G*P.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*G*P.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*G*P.deltaZ/this._normalize,P.preventDefault&&(b||P.preventDefault())},this._observer=this.camera.Xb()._inputManager._addCameraPointerObserver(this._wheel,s.e.POINTERWHEEL)}SY(){this._observer&&(this.camera.Xb()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,G.d)([(0,W.G)()],r.prototype,"wheelPrecisionX",void 0),(0,G.d)([(0,W.G)()],r.prototype,"wheelPrecisionY",void 0),(0,G.d)([(0,W.G)()],r.prototype,"wheelPrecisionZ",void 0),function(b){b[b.MoveRelative=0]="MoveRelative",b[b.RotateRelative=1]="RotateRelative",b[b.MoveScene=2]="MoveScene"}(w||(w={}));class B extends r{constructor(){super(...arguments),this._moveRelative=i.ed.Zero(),this._rotateRelative=i.ed.Zero(),this._moveScene=i.ed.Zero(),this._wheelXAction=w.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=w.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(b){null===b&&this._wheelXAction!==w.MoveRelative||(this._wheelXAction=w.MoveRelative,this._wheelXActionCoordinate=b)}get wheelXMoveRelative(){return this._wheelXAction!==w.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(b){null===b&&this._wheelYAction!==w.MoveRelative||(this._wheelYAction=w.MoveRelative,this._wheelYActionCoordinate=b)}get wheelYMoveRelative(){return this._wheelYAction!==w.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(b){null===b&&this._wheelZAction!==w.MoveRelative||(this._wheelZAction=w.MoveRelative,this._wheelZActionCoordinate=b)}get wheelZMoveRelative(){return this._wheelZAction!==w.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(b){null===b&&this._wheelXAction!==w.RotateRelative||(this._wheelXAction=w.RotateRelative,this._wheelXActionCoordinate=b)}get wheelXRotateRelative(){return this._wheelXAction!==w.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(b){null===b&&this._wheelYAction!==w.RotateRelative||(this._wheelYAction=w.RotateRelative,this._wheelYActionCoordinate=b)}get wheelYRotateRelative(){return this._wheelYAction!==w.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(b){null===b&&this._wheelZAction!==w.RotateRelative||(this._wheelZAction=w.RotateRelative,this._wheelZActionCoordinate=b)}get wheelZRotateRelative(){return this._wheelZAction!==w.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(b){null===b&&this._wheelXAction!==w.MoveScene||(this._wheelXAction=w.MoveScene,this._wheelXActionCoordinate=b)}get wheelXMoveScene(){return this._wheelXAction!==w.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(b){null===b&&this._wheelYAction!==w.MoveScene||(this._wheelYAction=w.MoveScene,this._wheelYActionCoordinate=b)}get wheelYMoveScene(){return this._wheelYAction!==w.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(b){null===b&&this._wheelZAction!==w.MoveScene||(this._wheelZAction=w.MoveScene,this._wheelZActionCoordinate=b)}get wheelZMoveScene(){return this._wheelZAction!==w.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.kd(0),this._rotateRelative.kd(0),this._moveScene.kd(0),this._updateCamera(),this.camera.Xb().useRightHandedSystem&&(this._moveRelative.z*=-1);const b=i.Matrix.Zero();this.camera.getViewMatrix().invertToRef(b);const d=i.ed.Zero();i.ed.TransformNormalToRef(this._moveRelative,b,d),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(d),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(b,d,P){if(0===b)return;if(null===d||null===P)return;let G=null;switch(d){case w.MoveRelative:G=this._moveRelative;break;case w.RotateRelative:G=this._rotateRelative;break;case w.MoveScene:G=this._moveScene}switch(P){case 0:G.set(b,0,0);break;case 1:G.set(0,b,0);break;case 2:G.set(0,0,b)}}}(0,G.d)([(0,W.G)()],B.prototype,"wheelXMoveRelative",null),(0,G.d)([(0,W.G)()],B.prototype,"wheelYMoveRelative",null),(0,G.d)([(0,W.G)()],B.prototype,"wheelZMoveRelative",null),(0,G.d)([(0,W.G)()],B.prototype,"wheelXRotateRelative",null),(0,G.d)([(0,W.G)()],B.prototype,"wheelYRotateRelative",null),(0,G.d)([(0,W.G)()],B.prototype,"wheelZRotateRelative",null),(0,G.d)([(0,W.G)()],B.prototype,"wheelXMoveScene",null),(0,G.d)([(0,W.G)()],B.prototype,"wheelYMoveScene",null),(0,G.d)([(0,W.G)()],B.prototype,"wheelZMoveScene",null),C.e.FreeCameraMouseWheelInput=B;class n{constructor(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=b,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=L.Tools.IsSafari()}attachControl(b){b=L.Tools.BackCompatCameraNoPreventDefault(arguments);let d=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=P=>{const G=P.event,W="mouse"===G.pointerType||this._isSafari&&"undefined"===typeof G.pointerType;if(this.allowMouse||!W)if(P.type===s.e.POINTERDOWN){if(b||G.preventDefault(),this._pointerPressed.push(G.pointerId),1!==this._pointerPressed.length)return;d={x:G.clientX,y:G.clientY}}else if(P.type===s.e.POINTERUP){b||G.preventDefault();const P=this._pointerPressed.indexOf(G.pointerId);if(-1===P)return;if(this._pointerPressed.splice(P,1),0!=P)return;d=null,this._offsetX=null,this._offsetY=null}else if(P.type===s.e.POINTERMOVE){if(b||G.preventDefault(),!d)return;if(0!=this._pointerPressed.indexOf(G.pointerId))return;this._offsetX=G.clientX-d.x,this._offsetY=-(G.clientY-d.y)}}),this._observer=this.camera.Xb()._inputManager._addCameraPointerObserver(this._pointerInput,s.e.POINTERDOWN|s.e.POINTERUP|s.e.POINTERMOVE),this._onLostFocus){const b=this.camera.getEngine().getInputElement();b&&b.addEventListener("blur",this._onLostFocus)}}SY(){if(this._pointerInput){if(this._observer&&(this.camera.Xb()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const b=this.camera.getEngine().getInputElement();b&&b.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const b=this.camera,d=b._calculateHandednessMultiplier();b.cameraRotation.y=d*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)b.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const d=b._computeLocalCameraSpeed(),P=new i.ed(0,0,0!==this.touchMoveSensibility?d*this._offsetY/this.touchMoveSensibility:0);i.Matrix.RotationYawPitchRollToRef(b.rotation.y,b.rotation.x,0,b._cameraRotationMatrix),b.cameraDirection.addInPlace(i.ed.TransformCoordinates(P,b._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,G.d)([(0,W.G)()],n.prototype,"touchAngularSensibility",void 0),(0,G.d)([(0,W.G)()],n.prototype,"touchMoveSensibility",void 0),C.e.FreeCameraTouchInput=n;class Z extends C.h{constructor(b){super(b),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new x),this}addMouse(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new E(b),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new B,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new n),this}clear(){super.clear(),this._mouseInput=null}}var o=P(11639),A=P(11574);class f extends q.d{get angularSensibility(){const b=this.inputs.attached.mouse;return b?b.angularSensibility:0}set angularSensibility(b){const d=this.inputs.attached.mouse;d&&(d.angularSensibility=b)}get keysUp(){const b=this.inputs.attached.keyboard;return b?b.keysUp:[]}set keysUp(b){const d=this.inputs.attached.keyboard;d&&(d.keysUp=b)}get keysUpward(){const b=this.inputs.attached.keyboard;return b?b.keysUpward:[]}set keysUpward(b){const d=this.inputs.attached.keyboard;d&&(d.keysUpward=b)}get keysDown(){const b=this.inputs.attached.keyboard;return b?b.keysDown:[]}set keysDown(b){const d=this.inputs.attached.keyboard;d&&(d.keysDown=b)}get keysDownward(){const b=this.inputs.attached.keyboard;return b?b.keysDownward:[]}set keysDownward(b){const d=this.inputs.attached.keyboard;d&&(d.keysDownward=b)}get keysLeft(){const b=this.inputs.attached.keyboard;return b?b.keysLeft:[]}set keysLeft(b){const d=this.inputs.attached.keyboard;d&&(d.keysLeft=b)}get keysRight(){const b=this.inputs.attached.keyboard;return b?b.keysRight:[]}set keysRight(b){const d=this.inputs.attached.keyboard;d&&(d.keysRight=b)}get keysRotateLeft(){const b=this.inputs.attached.keyboard;return b?b.keysRotateLeft:[]}set keysRotateLeft(b){const d=this.inputs.attached.keyboard;d&&(d.keysRotateLeft=b)}get keysRotateRight(){const b=this.inputs.attached.keyboard;return b?b.keysRotateRight:[]}set keysRotateRight(b){const d=this.inputs.attached.keyboard;d&&(d.keysRotateRight=b)}get keysRotateUp(){const b=this.inputs.attached.keyboard;return b?b.keysRotateUp:[]}set keysRotateUp(b){const d=this.inputs.attached.keyboard;d&&(d.keysRotateUp=b)}get keysRotateDown(){const b=this.inputs.attached.keyboard;return b?b.keysRotateDown:[]}set keysRotateDown(b){const d=this.inputs.attached.keyboard;d&&(d.keysRotateDown=b)}constructor(b,d,P){var G;super(b,d,P,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),G=this,this.ellipsoid=new i.ed(.5,1,.5),this.ellipsoidOffset=new i.ed(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=i.ed.Zero(),this._diffPosition=i.ed.Zero(),this._newPosition=i.ed.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;G._newPosition.q(d),G._newPosition.subtractToRef(G._oldPosition,G._diffPosition),G._diffPosition.length()>A.e.CollisionsEpsilon&&(G.position.addToRef(G._diffPosition,G._deferredPositionUpdate),G._deferOnly?G._deferredUpdated=!0:G.position.q(G._deferredPositionUpdate),G.BE&&P&&G.BE(P))},this.inputs=new Z(this),this.inputs.addKeyboard().addMouse()}attachControl(b,d){d=L.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(d)}SY(){this.inputs.detachElement(),this.cameraDirection=new i.ed(0,0,0),this.cameraRotation=new i.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(b){this._collisionMask=isNaN(b)?-1:b}_collideWithWorld(b){let d;d=this.parent?i.ed.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,d.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const P=this.Xb().collisionCoordinator;this._collider||(this._collider=P.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let G=b;this.applyGravity&&(G=b.add(this.Xb().gravity)),P.getNewPosition(this._oldPosition,G,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=i.ed.Zero(),this._transformedDirection=i.ed.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(b){this._needMoveForGravity=b}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.Xb().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Fw"}}(0,G.d)([(0,W.F)()],f.prototype,"ellipsoid",void 0),(0,G.d)([(0,W.F)()],f.prototype,"ellipsoidOffset",void 0),(0,G.d)([(0,W.G)()],f.prototype,"checkCollisions",void 0),(0,G.d)([(0,W.G)()],f.prototype,"applyGravity",void 0),(0,o.f)("BABYLON.FreeCamera",f)},13871:(b,d,P)=>{"use strict";P.d(d,{c:()=>i});var G=P(11781),W=P(13875);class i{constructor(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=P,this.Kx=[],this._maxBlockCapacity=d||64,this._selectionContent=new G.c(1024),this._creationFunc=b}update(b,d,P){W.e._CreateBlocks(b,d,P,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}TL(b){for(let d=0;d<this.xx.length;d++){this.xx[d].addEntry(b)}}hL(b){for(let d=0;d<this.xx.length;d++){this.xx[d].removeEntry(b)}}select(b,d){this._selectionContent.reset();for(let P=0;P<this.xx.length;P++){this.xx[P].select(b,this._selectionContent,d)}return d?this._selectionContent.concat(this.Kx):this._selectionContent.concatWithNoDuplicate(this.Kx),this._selectionContent}intersects(b,d,P){this._selectionContent.reset();for(let G=0;G<this.xx.length;G++){this.xx[G].intersects(b,d,this._selectionContent,P)}return P?this._selectionContent.concat(this.Kx):this._selectionContent.concatWithNoDuplicate(this.Kx),this._selectionContent}intersectsRay(b){this._selectionContent.reset();for(let d=0;d<this.xx.length;d++){this.xx[d].intersectsRay(b,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Kx),this._selectionContent}}i.CreationFuncForMeshes=(b,d)=>{const P=b.getBoundingInfo();!b.isBlocked&&P.boundingBox.intersectsMinMax(d.WY,d.iY)&&d.entries.push(b)},i.CreationFuncForSubMeshes=(b,d)=>{b.getBoundingInfo().boundingBox.intersectsMinMax(d.WY,d.iY)&&d.entries.push(b)}},13875:(b,d,P)=>{"use strict";P.d(d,{e:()=>i});var G=P(11681),W=P(12026);class i{constructor(b,d,P,G,W,i){this.entries=[],this.qY=new Array,this._capacity=P,this._depth=G,this._maxDepth=W,this._creationFunc=i,this._minPoint=b,this._maxPoint=d,this.qY.push(b.clone()),this.qY.push(d.clone()),this.qY.push(b.clone()),this.qY[2].x=d.x,this.qY.push(b.clone()),this.qY[3].y=d.y,this.qY.push(b.clone()),this.qY[4].z=d.z,this.qY.push(d.clone()),this.qY[5].z=b.z,this.qY.push(d.clone()),this.qY[6].x=b.x,this.qY.push(d.clone()),this.qY[7].y=b.y}get vd(){return this._capacity}get WY(){return this._minPoint}get iY(){return this._maxPoint}addEntry(b){if(this.xx)for(let d=0;d<this.xx.length;d++){this.xx[d].addEntry(b)}else this._creationFunc(b,this),this.entries.length>this.vd&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(b){if(this.xx){for(let d=0;d<this.xx.length;d++){this.xx[d].removeEntry(b)}return}const d=this.entries.indexOf(b);d>-1&&this.entries.splice(d,1)}addEntries(b){for(let d=0;d<b.length;d++){const P=b[d];this.addEntry(P)}}select(b,d,P){if(W.d.IsInFrustum(this.qY,b)){if(this.xx){for(let G=0;G<this.xx.length;G++){this.xx[G].select(b,d,P)}return}P?d.concat(this.entries):d.concatWithNoDuplicate(this.entries)}}intersects(b,d,P,G){if(W.d.IntersectsSphere(this._minPoint,this._maxPoint,b,d)){if(this.xx){for(let W=0;W<this.xx.length;W++){this.xx[W].intersects(b,d,P,G)}return}G?P.concat(this.entries):P.concatWithNoDuplicate(this.entries)}}intersectsRay(b,d){if(b.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.xx){for(let P=0;P<this.xx.length;P++){this.xx[P].intersectsRay(b,d)}return}d.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){i._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(b,d,P,W,q,C,J,L){J.xx=new Array;const x=new G.ed((d.x-b.x)/2,(d.y-b.y)/2,(d.z-b.z)/2);for(let G=0;G<2;G++)for(let d=0;d<2;d++)for(let Y=0;Y<2;Y++){const s=b.add(x.multiplyByFloats(G,d,Y)),E=b.add(x.multiplyByFloats(G+1,d+1,Y+1)),w=new i(s,E,W,q+1,C,L);w.addEntries(P),J.xx.push(w)}}}},13877:(b,d,P)=>{"use strict";P.d(d,{e:()=>x});var G=P(11909),W=P(11681),i=P(12115),q=P(13049),C=P(11949),J=P(13871),L=P(11535);G.e.prototype.createOrUpdateSelectionOctree=function(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,P=this._getComponent(C.b.NAME_OCTREE);P||(P=new x(this),this.o(P)),this.hx||(this.hx=new J.c(J.c.CreationFuncForMeshes,b,d));const G=this.getWorldExtends();return this.hx.update(G.min,G.max,this.meshes),this.hx},Object.defineProperty(G.e.prototype,"selectionOctree",{get:function(){return this.hx},enumerable:!0,configurable:!0}),i.d.prototype.createOrUpdateSubmeshesOctree=function(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const P=this.Xb();let G=P._getComponent(C.b.NAME_OCTREE);G||(G=new x(P),P.o(G)),this._submeshesOctree||(this._submeshesOctree=new J.c(J.c.CreationFuncForSubMeshes,b,d)),this.zd(!0);const W=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(W.minimumWorld,W.maximumWorld,this.ld),this._submeshesOctree};class x{constructor(b){this.name=C.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new q.e(W.ed.Zero(),new W.ed(1,1,1)),(b=b||L.e.LastCreatedScene)&&(this.Hd=b,this.Hd.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Hd.getActiveSubMeshCandidates=b=>this.getActiveSubMeshCandidates(b),this.Hd.getCollidingSubMeshCandidates=(b,d)=>this.getCollidingSubMeshCandidates(b,d),this.Hd.getIntersectingSubMeshCandidates=(b,d)=>this.getIntersectingSubMeshCandidates(b,d))}register(){this.Hd.onMeshRemovedObservable.add((b=>{const d=this.Hd.selectionOctree;if(void 0!==d&&null!==d){const P=d.Kx.indexOf(b);-1!==P&&d.Kx.splice(P,1)}})),this.Hd.onMeshImportedObservable.add((b=>{const d=this.Hd.selectionOctree;void 0!==d&&null!==d&&d.TL(b)}))}getActiveMeshCandidates(){var b;return(null===(b=this.Hd.hx)||void 0===b?void 0:b.select(this.Hd.frustumPlanes))||this.Hd._getDefaultMeshCandidates()}getActiveSubMeshCandidates(b){if(b._submeshesOctree&&b.useOctreeForRenderingSelection){return b._submeshesOctree.select(this.Hd.frustumPlanes)}return this.Hd._getDefaultSubMeshCandidates(b)}getIntersectingSubMeshCandidates(b,d){if(b._submeshesOctree&&b.useOctreeForPicking){q.e.TransformToRef(d,b.getWorldMatrix(),this._tempRay);return b._submeshesOctree.intersectsRay(this._tempRay)}return this.Hd._getDefaultSubMeshCandidates(b)}getCollidingSubMeshCandidates(b,d){if(b._submeshesOctree&&b.useOctreeForCollisions){const P=d._velocityWorldLength+Math.max(d._radius.x,d._radius.y,d._radius.z);return b._submeshesOctree.intersects(d._basePointWorld,P)}return this.Hd._getDefaultSubMeshCandidates(b)}rebuild(){}dispose(){}}},13049:(b,d,P)=>{"use strict";P.d(d,{e:()=>E});var G=P(11909),W=P(12139),i=P(11688),q=P(11681),C=P(11691),J=P(12013),L=P(11940),x=P(11535),Y=P(11966);const s={internalPickerForMesh:void 0};class E{constructor(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.c;this.origin=b,this.direction=d,this.length=P,this.epsilon=G}clone(){return new E(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const G=E._TmpVector3[0].Fd(b.x-P,b.y-P,b.z-P),W=E._TmpVector3[1].Fd(d.x+P,d.y+P,d.z+P);let i,q,C,J,L=0,x=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<G.x||this.origin.x>W.x)return!1}else if(i=1/this.direction.x,q=(G.x-this.origin.x)*i,C=(W.x-this.origin.x)*i,C===-1/0&&(C=1/0),q>C&&(J=q,q=C,C=J),L=Math.max(q,L),x=Math.min(C,x),L>x)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<G.y||this.origin.y>W.y)return!1}else if(i=1/this.direction.y,q=(G.y-this.origin.y)*i,C=(W.y-this.origin.y)*i,C===-1/0&&(C=1/0),q>C&&(J=q,q=C,C=J),L=Math.max(q,L),x=Math.min(C,x),L>x)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<G.z||this.origin.z>W.z)return!1}else if(i=1/this.direction.z,q=(G.z-this.origin.z)*i,C=(W.z-this.origin.z)*i,C===-1/0&&(C=1/0),q>C&&(J=q,q=C,C=J),L=Math.max(q,L),x=Math.min(C,x),L>x)return!1;return!0}intersectsBox(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(b.minimum,b.maximum,d)}intersectsSphere(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const P=b.center.x-this.origin.x,G=b.center.y-this.origin.y,W=b.center.z-this.origin.z,i=P*P+G*G+W*W,q=b.radius+d,C=q*q;if(i<=C)return!0;const J=P*this.direction.x+G*this.direction.y+W*this.direction.z;if(J<0)return!1;return i-J*J<=C}intersectsTriangle(b,d,P){const G=E._TmpVector3[0],W=E._TmpVector3[1],i=E._TmpVector3[2],C=E._TmpVector3[3],L=E._TmpVector3[4];d.subtractToRef(b,G),P.subtractToRef(b,W),q.ed.CrossToRef(this.direction,W,i);const x=q.ed.Dot(G,i);if(0===x)return null;const Y=1/x;this.origin.subtractToRef(b,C);const s=q.ed.Dot(C,i)*Y;if(s<-this.epsilon||s>1+this.epsilon)return null;q.ed.CrossToRef(C,G,L);const w=q.ed.Dot(this.direction,L)*Y;if(w<-this.epsilon||s+w>1+this.epsilon)return null;const t=q.ed.Dot(W,L)*Y;return t>this.length?null:new J.b(1-s-w,s,t)}intersectsPlane(b){let d;const P=q.ed.Dot(b.normal,this.direction);if(Math.abs(P)<9.99999997475243e-7)return null;{const G=q.ed.Dot(b.normal,this.origin);return d=(-b.d-G)/P,d<0?d<-9.99999997475243e-7?null:0:d}}intersectsAxis(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(b){case"y":{const b=(this.origin.y-d)/this.direction.y;return b>0?null:new q.ed(this.origin.x+this.direction.x*-b,d,this.origin.z+this.direction.z*-b)}case"x":{const b=(this.origin.x-d)/this.direction.x;return b>0?null:new q.ed(d,this.origin.y+this.direction.y*-b,this.origin.z+this.direction.z*-b)}case"z":{const b=(this.origin.z-d)/this.direction.z;return b>0?null:new q.ed(this.origin.x+this.direction.x*-b,this.origin.y+this.direction.y*-b,d)}default:return null}}intersectsMesh(b,d,P){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3],W=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const C=q.TmpVectors.Matrix[0];return b.getWorldMatrix().invertToRef(C),this._tmpRay?E.TransformToRef(this,C,this._tmpRay):this._tmpRay=E.Transform(this,C),b.intersects(this._tmpRay,d,P,G,W,i)}intersectsMeshes(b,d,P){P?P.length=0:P=[];for(let G=0;G<b.length;G++){const W=this.intersectsMesh(b[G],d);W.hit&&P.push(W)}return P.sort(this._comparePickingInfo),P}_comparePickingInfo(b,d){return b.distance<d.distance?-1:b.distance>d.distance?1:0}intersectionSegment(b,d,P){const G=this.origin,W=q.TmpVectors.ed[0],i=q.TmpVectors.ed[1],C=q.TmpVectors.ed[2],J=q.TmpVectors.ed[3];d.subtractToRef(b,W),this.direction.scaleToRef(E._Rayl,C),G.addToRef(C,i),b.subtractToRef(G,J);const L=q.ed.Dot(W,W),x=q.ed.Dot(W,C),Y=q.ed.Dot(C,C),s=q.ed.Dot(W,J),w=q.ed.Dot(C,J),t=L*Y-x*x;let r,B,n=t,Z=t;t<E._Smallnum?(r=0,n=1,B=w,Z=Y):(r=x*w-Y*s,B=L*w-x*s,r<0?(r=0,B=w,Z=Y):r>n&&(r=n,B=w+x,Z=Y)),B<0?(B=0,-s<0?r=0:-s>L?r=n:(r=-s,n=L)):B>Z&&(B=Z,-s+x<0?r=0:-s+x>L?r=n:(r=-s+x,n=L));const o=Math.abs(r)<E._Smallnum?0:r/n,A=Math.abs(B)<E._Smallnum?0:B/Z,f=q.TmpVectors.ed[4];C.scaleToRef(A,f);const g=q.TmpVectors.ed[5];W.scaleToRef(o,g),g.addInPlace(J);const X=q.TmpVectors.ed[6];g.subtractToRef(f,X);return A>0&&A<=this.length&&X.lengthSquared()<P*P?g.length():-1}update(b,d,P,G,W,i,C){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){E._RayDistant||(E._RayDistant=E.Zero()),E._RayDistant.unprojectRayToRef(b,d,P,G,q.Matrix.IdentityReadOnly,i,C);const J=q.TmpVectors.Matrix[0];W.invertToRef(J),E.TransformToRef(E._RayDistant,J,this)}else this.unprojectRayToRef(b,d,P,G,W,i,C);return this}static Zero(){return new E(q.ed.Zero(),q.ed.Zero())}static CreateNew(b,d,P,G,W,i,q){return E.Zero().update(b,d,P,G,W,i,q)}static CreateNewFromTo(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.Matrix.IdentityReadOnly;const G=new E(new q.ed(0,0,0),new q.ed(0,0,0));return E.CreateFromToToRef(b,d,G,P)}static CreateFromToToRef(b,d,P){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.Matrix.IdentityReadOnly;P.origin.q(b);const W=d.subtractToRef(b,P.direction),i=Math.sqrt(W.x*W.x+W.y*W.y+W.z*W.z);return P.length=i,P.direction.normalize(),E.TransformToRef(P,G,P)}static Transform(b,d){const P=new E(new q.ed(0,0,0),new q.ed(0,0,0));return E.TransformToRef(b,d,P),P}static TransformToRef(b,d,P){q.ed.TransformCoordinatesToRef(b.origin,d,P.origin),q.ed.TransformNormalToRef(b.direction,d,P.direction),P.length=b.length,P.epsilon=b.epsilon;const G=P.direction,W=G.length();if(0!==W&&1!==W){const b=1/W;G.x*=b,G.y*=b,G.z*=b,P.length*=W}return P}unprojectRayToRef(b,d,P,G,W,i,C){const J=q.TmpVectors.Matrix[0];W.multiplyToRef(i,J),J.multiplyToRef(C,J),J.invert();const L=x.e.LastCreatedEngine,Y=q.TmpVectors.ed[0];Y.x=b/P*2-1,Y.y=-(d/G*2-1),Y.z=null!==L&&void 0!==L&&L.useReverseDepthBuffer?1:null!==L&&void 0!==L&&L.isNDCHalfZRange?0:-1;const s=q.TmpVectors.ed[1].Fd(Y.x,Y.y,1-1e-8),E=q.TmpVectors.ed[2],w=q.TmpVectors.ed[3];q.ed._UnprojectFromInvertedMatrixToRef(Y,J,E),q.ed._UnprojectFromInvertedMatrixToRef(s,J,w),this.origin.q(E),w.subtractToRef(E,this.direction),this.direction.normalize()}}function w(b,d,P,G,W){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const q=E.Zero();return t(b,d,P,G,q,W,i),q}function t(b,d,P,G,W,i){let C=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const L=b.getEngine();if(!i&&!(i=b.activeCamera))return b;const x=i.viewport,Y=L.getRenderHeight(),{x:s,y:E,width:w,height:t}=x.toGlobal(L.getRenderWidth(),Y),r=1/L.getHardwareScalingLevel();return d=d*r-s,P=P*r-(Y-E-t),W.update(d,P,w,t,G||q.Matrix.IdentityReadOnly,C?q.Matrix.IdentityReadOnly:i.getViewMatrix(),i.getProjectionMatrix(),J),b}function r(b,d,P,G,W){if(!L.b)return b;const i=b.getEngine();if(!W&&!(W=b.activeCamera))throw new Error("Active camera not set");const C=W.viewport,J=i.getRenderHeight(),{x:x,y:Y,width:s,height:E}=C.toGlobal(i.getRenderWidth(),J),w=q.Matrix.Identity(),t=1/i.getHardwareScalingLevel();return d=d*t-x,P=P*t-(J-Y-E),G.update(d,P,s,E,w,w,W.getProjectionMatrix()),b}function B(b,d,P,G,W,i,q,C){const J=d(G,P.enableDistantPicking),L=P.intersects(J,W,q,i,G,C);return L&&L.hit?!W&&null!=b&&L.distance>=b.distance?null:L:null}function n(b,d,P,G,W,i){let C=null;const J=!!(b.activeCameras&&b.activeCameras.length>1&&b.cameraToUseForPointers!==b.activeCamera),x=b.cameraToUseForPointers||b.activeCamera,Y=s.internalPickerForMesh||B;for(let L=0;L<b.meshes.length;L++){const s=b.meshes[L];if(P){if(!P(s,-1))continue}else if(!s.isEnabled()||!s.isVisible||!s.lJ)continue;const E=J&&s.isWorldMatrixCameraDependent(),w=s.zd(E,x);if(s.hasThinInstances&&s.EL){const b=Y(C,d,s,w,!0,!0,i);if(b){if(W)return b;const J=q.TmpVectors.Matrix[1],L=s.thinInstanceGetWorldMatrices();for(let b=0;b<L.length;b++){if(P&&!P(s,b))continue;L[b].multiplyToRef(w,J);const q=Y(C,d,s,J,G,W,i,!0);if(q&&(C=q,C.thinInstanceIndex=b,G))return C}}}else{const b=Y(C,d,s,w,G,W,i);if(b&&(C=b,G))return C}}return C||new L.b}function Z(b,d,P,G){if(!L.b)return null;const W=[],i=!!(b.activeCameras&&b.activeCameras.length>1&&b.cameraToUseForPointers!==b.activeCamera),C=b.cameraToUseForPointers||b.activeCamera,J=s.internalPickerForMesh||B;for(let L=0;L<b.meshes.length;L++){const x=b.meshes[L];if(P){if(!P(x,-1))continue}else if(!x.isEnabled()||!x.isVisible||!x.lJ)continue;const Y=i&&x.isWorldMatrixCameraDependent(),s=x.zd(Y,C);if(x.hasThinInstances&&x.EL){if(J(null,d,x,s,!0,!0,G)){const b=q.TmpVectors.Matrix[1],i=x.thinInstanceGetWorldMatrices();for(let q=0;q<i.length;q++){if(P&&!P(x,q))continue;i[q].multiplyToRef(s,b);const C=J(null,d,x,b,!1,!1,G,!0);C&&(C.thinInstanceIndex=q,W.push(C))}}}else{const b=J(null,d,x,s,!1,!1,G);b&&W.push(b)}}return W}function o(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,G=arguments.length>3?arguments[3]:void 0,W=arguments.length>4?arguments[4]:void 0;G||(G=b.getWorldMatrix()),d.length=P,W?d.origin.q(W):d.origin.q(b.position);const i=q.TmpVectors.ed[2];i.set(0,0,b._scene.useRightHandedSystem?-1:1);const C=q.TmpVectors.ed[3];return q.ed.TransformNormalToRef(i,G,C),q.ed.NormalizeToRef(C,d.direction),d}var A,f;E._TmpVector3=(0,C.b)(6,q.ed.Zero),E._RayDistant=E.Zero(),E._Smallnum=1e-8,E._Rayl=1e9,A=G.e,(f=W.c)&&(f.prototype.getForwardRay=function(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,d=arguments.length>1?arguments[1]:void 0,P=arguments.length>2?arguments[2]:void 0;return o(this,new E(q.ed.Zero(),q.ed.Zero(),b),b,d,P)},f.prototype.getForwardRayToRef=function(b){return o(this,b,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),A&&(Y.d._IsPickingAvailable=!0,A.prototype.createPickingRay=function(b,d,P,G){return w(this,b,d,P,G,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),G.e.prototype.createPickingRayToRef=function(b,d,P,G,W){return t(this,b,d,P,G,W,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},G.e.prototype.createPickingRayInCameraSpace=function(b,d,P){return function(b,d,P,G){const W=E.Zero();return r(b,d,P,W,G),W}(this,b,d,P)},G.e.prototype.createPickingRayInCameraSpaceToRef=function(b,d,P,G){return r(this,b,d,P,G)},G.e.prototype.pickWithBoundingInfo=function(b,d,P,G,W){return function(b,d,P,G,W,i){if(!L.b)return null;const C=n(b,(G=>(b._tempPickingRay||(b._tempPickingRay=E.Zero()),t(b,d,P,G,b._tempPickingRay,i||null),b._tempPickingRay)),G,W,!0);return C&&(C.ray=w(b,d,P,q.Matrix.Identity(),i||null)),C}(this,b,d,P,G,W)},G.e.prototype.cP=function(b,d,P,G,W,i){return function(b,d,P,G,W,i,C){const J=n(b,((G,W)=>(b._tempPickingRay||(b._tempPickingRay=E.Zero()),t(b,d,P,G,b._tempPickingRay,i||null,!1,W),b._tempPickingRay)),G,W,!1,C);return J&&(J.ray=w(b,d,P,q.Matrix.Identity(),i||null)),J}(this,b,d,P,G,W,i)},G.e.prototype.pickWithRay=function(b,d,P,G){return function(b,d,P,G,W){const i=n(b,(P=>(b._pickWithRayInverseMatrix||(b._pickWithRayInverseMatrix=q.Matrix.Identity()),P.invertToRef(b._pickWithRayInverseMatrix),b._cachedRayForTransform||(b._cachedRayForTransform=E.Zero()),E.TransformToRef(d,b._pickWithRayInverseMatrix,b._cachedRayForTransform),b._cachedRayForTransform)),P,G,!1,W);return i&&(i.ray=d),i}(this,b,d,P,G)},G.e.prototype.multiPick=function(b,d,P,G,W){return function(b,d,P,G,W,i){return Z(b,(G=>w(b,d,P,G,W||null)),G,i)}(this,b,d,P,G,W)},G.e.prototype.multiPickWithRay=function(b,d,P){return function(b,d,P,G){return Z(b,(P=>(b._pickWithRayInverseMatrix||(b._pickWithRayInverseMatrix=q.Matrix.Identity()),P.invertToRef(b._pickWithRayInverseMatrix),b._cachedRayForTransform||(b._cachedRayForTransform=E.Zero()),E.TransformToRef(d,b._pickWithRayInverseMatrix,b._cachedRayForTransform),b._cachedRayForTransform)),P,G)}(this,b,d,P)}},13341:(b,d,P)=>{"use strict";var G=P(11619),W=P(11504),i=P(11539),q=P(11643),C=P(11574),J=P(11631);C.e.prototype._partialLoadFile=function(b,d,P,G){let W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(b,(b=>{P[d]=b,P._internalCount++,6===P._internalCount&&G(P)}),void 0,void 0,!0,((b,d)=>{W&&b&&W(b.status+" "+b.statusText,d)}))},C.e.prototype._cascadeLoadFiles=function(b,d,P){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const W=[];W._internalCount=0;for(let i=0;i<6;i++)this._partialLoadFile(P[i],i,W,d,G)},C.e.prototype._cascadeLoadImgs=function(b,d,P,G){let W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5?arguments[5]:void 0;const q=[];q._internalCount=0;for(let C=0;C<6;C++)this._partialLoadImg(G[C],C,q,b,d,P,W,i)},C.e.prototype._partialLoadImg=function(b,d,P,G,W,C){let J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7?arguments[7]:void 0;const x=(0,q.e)();(0,i.r)(b,(b=>{P[d]=b,P._internalCount++,G&&G.removePendingData(x),6===P._internalCount&&C&&C(W,P)}),((b,d)=>{G&&G.removePendingData(x),J&&J(b,d)}),G?G.offlineProvider:null,L),G&&G.addPendingData(x)},C.e.prototype.createCubeTextureBase=function(b,d,P,i){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6?arguments[6]:void 0,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],s=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,E=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,w=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,t=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,r=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,B=arguments.length>14&&void 0!==arguments[14]&&arguments[14],n=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const Z=w||new G.e(this,7);Z.isCube=!0,Z.url=b,Z.generateMipMaps=!i,Z._lodGenerationScale=s,Z._lodGenerationOffset=E,Z._useSRGBBuffer=!!B&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!i),Z!==w&&(Z.label=b.substring(0,60)),this._doNotHandleContextLost||(Z._extension=x,Z._files=P,Z._buffer=n);const o=b;this._transformTextureUrl&&!w&&(b=this._transformTextureUrl(b));const A=x??function(b){const d=b.split("?")[0],P=d.lastIndexOf(".");return P>-1?d.substring(P).toLowerCase():""}(b),f=(0,J.c)(A),g=(b,d)=>{Z.dispose(),C?C(b,d):b&&W.e.Warn(b)},X=(G,C)=>{b===o?G&&g(G.status+" "+G.statusText,C):(W.e.Warn(`Failed to load ${b}, falling back to the ${o}`),this.createCubeTextureBase(o,d,P,!!i,q,g,L,x,Y,s,E,Z,t,r,B,n))};if(f)f.then((G=>{const W=b=>{t&&t(Z,b),G.loadCubeData(b,Z,Y,q,((b,d)=>{g(b,d)}))};n?W(n):P&&6===P.length?G.supportCascades?this._cascadeLoadFiles(d,(b=>W(b.map((b=>new Uint8Array(b))))),P,g):g("Textures type does not support cascades."):this._loadFile(b,(b=>W(new Uint8Array(b))),void 0,void 0,!0,X)}));else{if(!P||0===P.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(d,Z,((b,d)=>{r&&r(b,d)}),P,g)}return this._internalTexturesCache.push(Z),Z}},13882:(b,d,P)=>{"use strict";P(11504);var G=P(11806);P(11619),P(11759),P(11614),P(11852),P(11818);G.e},13360:(b,d,P)=>{"use strict";P.d(d,{b:()=>W});var G=P(11639);class W{constructor(b){this.value=this._toInt(b)}_toInt(b){return 0|b}add(b){return new W(this.value+b.value)}Rd(b){return new W(this.value-b.value)}multiply(b){return new W(Math.imul(this.value,b.value))}divide(b){return new W(this.value/b.value)}getClassName(){return W.ClassName}equals(b){return this.value===b.value}static FromValue(b){return new W(b)}toString(){return this.value.toString()}}W.ClassName="FlowGraphInteger",(0,G.f)("FlowGraphInteger",W)},13368:(b,d,P)=>{"use strict";P.d(d,{d:()=>W,g:()=>i});var G=P(11681);class W{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.od=b}get m(){return this.od}transformVector(b){return this.transformVectorToRef(b,new G.Vector2)}transformVectorToRef(b,d){return d.x=b.x*this.od[0]+b.y*this.od[1],d.y=b.x*this.od[2]+b.y*this.od[3],d}jd(){return this.toArray()}toArray(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let d=0;d<4;d++)b[d]=this.od[d];return b}DP(b){for(let d=0;d<4;d++)this.od[d]=b[d];return this}multiplyToRef(b,d){const P=b.od,G=this.od,W=d.od;return W[0]=P[0]*G[0]+P[1]*G[2],W[1]=P[0]*G[1]+P[1]*G[3],W[2]=P[2]*G[0]+P[3]*G[2],W[3]=P[2]*G[1]+P[3]*G[3],d}multiply(b){return this.multiplyToRef(b,new W)}divideToRef(b,d){const P=this.od,G=b.od,W=d.od;return W[0]=P[0]/G[0],W[1]=P[1]/G[1],W[2]=P[2]/G[2],W[3]=P[3]/G[3],d}divide(b){return this.divideToRef(b,new W)}addToRef(b,d){const P=this.od,G=b.m,W=d.m;return W[0]=P[0]+G[0],W[1]=P[1]+G[1],W[2]=P[2]+G[2],W[3]=P[3]+G[3],d}add(b){return this.addToRef(b,new W)}subtractToRef(b,d){const P=this.od,G=b.m,W=d.m;return W[0]=P[0]-G[0],W[1]=P[1]-G[1],W[2]=P[2]-G[2],W[3]=P[3]-G[3],d}Rd(b){return this.subtractToRef(b,new W)}transpose(){const b=this.od;return new W([b[0],b[2],b[1],b[3]])}determinant(){const b=this.od;return b[0]*b[3]-b[1]*b[2]}inverse(){const b=this.determinant();if(0===b)throw new Error("Matrix is not invertible");const d=this.od,P=1/b;return new W([d[3]*P,-d[1]*P,-d[2]*P,d[0]*P])}equals(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const P=this.od,G=b.m;return 0===d?P[0]===G[0]&&P[1]===G[1]&&P[2]===G[2]&&P[3]===G[3]:Math.abs(P[0]-G[0])<d&&Math.abs(P[1]-G[1])<d&&Math.abs(P[2]-G[2])<d&&Math.abs(P[3]-G[3])<d}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.od.join(", ")})`}}class i{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.od=b}get m(){return this.od}transformVector(b){return this.transformVectorToRef(b,new G.ed)}transformVectorToRef(b,d){const P=this.od;return d.x=b.x*P[0]+b.y*P[1]+b.z*P[2],d.y=b.x*P[3]+b.y*P[4]+b.z*P[5],d.z=b.x*P[6]+b.y*P[7]+b.z*P[8],d}multiplyToRef(b,d){const P=b.od,G=this.od,W=d.m;return W[0]=P[0]*G[0]+P[1]*G[3]+P[2]*G[6],W[1]=P[0]*G[1]+P[1]*G[4]+P[2]*G[7],W[2]=P[0]*G[2]+P[1]*G[5]+P[2]*G[8],W[3]=P[3]*G[0]+P[4]*G[3]+P[5]*G[6],W[4]=P[3]*G[1]+P[4]*G[4]+P[5]*G[7],W[5]=P[3]*G[2]+P[4]*G[5]+P[5]*G[8],W[6]=P[6]*G[0]+P[7]*G[3]+P[8]*G[6],W[7]=P[6]*G[1]+P[7]*G[4]+P[8]*G[7],W[8]=P[6]*G[2]+P[7]*G[5]+P[8]*G[8],d}multiply(b){return this.multiplyToRef(b,new i)}divideToRef(b,d){const P=this.od,G=b.m,W=d.m;return W[0]=P[0]/G[0],W[1]=P[1]/G[1],W[2]=P[2]/G[2],W[3]=P[3]/G[3],W[4]=P[4]/G[4],W[5]=P[5]/G[5],W[6]=P[6]/G[6],W[7]=P[7]/G[7],W[8]=P[8]/G[8],d}divide(b){return this.divideToRef(b,new i)}addToRef(b,d){const P=this.od,G=b.m,W=d.m;return W[0]=P[0]+G[0],W[1]=P[1]+G[1],W[2]=P[2]+G[2],W[3]=P[3]+G[3],W[4]=P[4]+G[4],W[5]=P[5]+G[5],W[6]=P[6]+G[6],W[7]=P[7]+G[7],W[8]=P[8]+G[8],d}add(b){return this.addToRef(b,new i)}subtractToRef(b,d){const P=this.od,G=b.m,W=d.m;return W[0]=P[0]-G[0],W[1]=P[1]-G[1],W[2]=P[2]-G[2],W[3]=P[3]-G[3],W[4]=P[4]-G[4],W[5]=P[5]-G[5],W[6]=P[6]-G[6],W[7]=P[7]-G[7],W[8]=P[8]-G[8],d}Rd(b){return this.subtractToRef(b,new i)}toArray(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let d=0;d<9;d++)b[d]=this.od[d];return b}jd(){return this.toArray()}DP(b){for(let d=0;d<9;d++)this.od[d]=b[d];return this}transpose(){const b=this.od;return new i([b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]])}determinant(){const b=this.od;return b[0]*(b[4]*b[8]-b[5]*b[7])-b[1]*(b[3]*b[8]-b[5]*b[6])+b[2]*(b[3]*b[7]-b[4]*b[6])}inverse(){const b=this.determinant();if(0===b)throw new Error("Matrix is not invertible");const d=this.od,P=1/b;return new i([(d[4]*d[8]-d[5]*d[7])*P,(d[2]*d[7]-d[1]*d[8])*P,(d[1]*d[5]-d[2]*d[4])*P,(d[5]*d[6]-d[3]*d[8])*P,(d[0]*d[8]-d[2]*d[6])*P,(d[2]*d[3]-d[0]*d[5])*P,(d[3]*d[7]-d[4]*d[6])*P,(d[1]*d[6]-d[0]*d[7])*P,(d[0]*d[4]-d[1]*d[3])*P])}equals(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const P=this.od,G=b.m;return 0===d?P[0]===G[0]&&P[1]===G[1]&&P[2]===G[2]&&P[3]===G[3]&&P[4]===G[4]&&P[5]===G[5]&&P[6]===G[6]&&P[7]===G[7]&&P[8]===G[8]:Math.abs(P[0]-G[0])<d&&Math.abs(P[1]-G[1])<d&&Math.abs(P[2]-G[2])<d&&Math.abs(P[3]-G[3])<d&&Math.abs(P[4]-G[4])<d&&Math.abs(P[5]-G[5])<d&&Math.abs(P[6]-G[6])<d&&Math.abs(P[7]-G[7])<d&&Math.abs(P[8]-G[8])<d}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.od.join(", ")})`}}},13373:(b,d,P)=>{"use strict";var G;function W(b,d,P,G){switch(d){case"Animation":return G?b.animations.find((b=>b.uniqueId===P))??null:b.animations[P]??null;case"AnimationGroup":return G?b.animationGroups.find((b=>b.uniqueId===P))??null:b.animationGroups[P]??null;case"Mesh":return G?b.meshes.find((b=>b.uniqueId===P))??null:b.meshes[P]??null;case"Material":return G?b.materials.find((b=>b.uniqueId===P))??null:b.materials[P]??null;case"qx":return G?b.cameras.find((b=>b.uniqueId===P))??null:b.cameras[P]??null;case"Light":return G?b.lights.find((b=>b.uniqueId===P))??null:b.lights[P]??null;default:return null}}P.d(d,{e:()=>W}),function(b){b.Animation="Animation",b.AnimationGroup="AnimationGroup",b.Mesh="Mesh",b.Material="Material",b.qx="qx",b.Light="Light"}(G||(G={}))},13401:(b,d,P)=>{"use strict";P.d(d,{d:()=>W});var G=P(13409);class W extends G.e{constructor(b,d){if(super(b),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),d)for(const P of d)this._eventsSignalOutputs[P]=this._registerSignalOutput(P+"Event")}_executeOnTick(b){}_startPendingTasks(b){b._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(b),this._resetAfterCanceled(b)),this._preparePendingTasks(b),b._addPendingBlock(this),this.out._activateSignal(b),b._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(b){b._deleteExecutionVariable(this,"_initialized"),b._removePendingBlock(this)}}},13386:(b,d,P)=>{"use strict";P.d(d,{b:()=>L});var G=P(11643),W=P(11639),i=P(13389),q=P(11487),C=P(13352);class J extends i.e{constructor(b,d,P,G){let W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:G.defaultValue,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(b,d,P),this.richType=G,this._defaultValue=W,this._optional=i,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new q.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(b){this._isDisabled!==b&&(this._isDisabled=b,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(b,d){d._getConnectionValue(this)!==b&&(d._setConnectionValue(this,b),this.onValueChangedObservable.notifyObservers(b))}resetToDefaultValue(b){b._setConnectionValue(this,this._defaultValue)}connectTo(b){this._isDisabled||super.connectTo(b)}_getValueOrDefault(b){const d=b._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(d):d}getValue(b){if(1===this.connectionType){b._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(b);const d=this._getValueOrDefault(b);return this._lastValue=d,this.richType.typeTransformer?this.richType.typeTransformer(d):d}const d=this.isConnected()?this._connectedPoint[0].getValue(b):this._getValueOrDefault(b);return this._lastValue=d,this.richType.typeTransformer?this.richType.typeTransformer(d):d}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(b),b.richType={},this.richType.serialize(b.richType),b.optional=this._optional,(0,C.i)("defaultValue",this._defaultValue,b)}}(0,W.f)("FlowGraphDataConnection",J);class L{constructor(b){var d;this.config=b,this.uniqueId=(0,G.e)(),this.name=(null===(d=this.config)||void 0===d?void 0:d.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(b){}registerDataInput(b,d,P){const G=new J(b,0,this,d,P);return this.dataInputs.push(G),G}registerDataOutput(b,d,P){const G=new J(b,1,this,d,P);return this.dataOutputs.push(G),G}getDataInput(b){return this.dataInputs.find((d=>d.name===b))}getDataOutput(b){return this.dataOutputs.find((d=>d.name===b))}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.i;if(b.uniqueId=this.uniqueId,b.config={},this.config){const P=this.config,G=Object.keys(P);for(const W of G)d(W,P[W],b.config)}b.dataInputs=[],b.dataOutputs=[],b.className=this.getClassName();for(const P of this.dataInputs){const d={};P.serialize(d),b.dataInputs.push(d)}for(const P of this.dataOutputs){const d={};P.serialize(d),b.dataOutputs.push(d)}}deserialize(b){}_log(b,d,P){var G;null===(G=b.logger)||void 0===G||G.addLogItem({action:d,zP:P,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13389:(b,d,P)=>{"use strict";P.d(d,{e:()=>i});var G,W=P(11643);!function(b){b[b.Input=0]="Input",b[b.Output=1]="Output"}(G||(G={}));class i{constructor(b,d,P){this._ownerBlock=P,this._connectedPoint=[],this.uniqueId=(0,W.e)(),this.connectedPointIds=[],this.name=b,this._connectionType=d}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(b){if(this._connectionType===b._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||b._isSingularConnection()&&b._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(b),b._connectedPoint.push(this)}disconnectFrom(b){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const P=this._connectedPoint.indexOf(b),G=b._connectedPoint.indexOf(this);-1!==P&&-1!==G&&(d&&this._connectedPoint.splice(P,1),b._connectedPoint.splice(G,1))}disconnectFromAll(){for(const b of this._connectedPoint)this.disconnectFrom(b,!1);this._connectedPoint.length=0}dispose(){for(const b of this._connectedPoint)this.disconnectFrom(b)}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};b.uniqueId=this.uniqueId,b.name=this.name,b._connectionType=this._connectionType,b.connectedPointIds=[],b.className=this.getClassName();for(const d of this._connectedPoint)b.connectedPointIds.push(d.uniqueId)}getClassName(){return"FGConnection"}deserialize(b){this.uniqueId=b.uniqueId,this.name=b.name,this._connectionType=b._connectionType,this.connectedPointIds=b.connectedPointIds}}},13350:(b,d,P)=>{"use strict";P.d(d,{e:()=>Z});var G,W=P(11487),i=P(11663),q=P(11670),C=P(11643),J=P(13352),L=P(13373),x=P(11504);!function(b){b.ExecuteBlock="ExecuteBlock",b.ExecuteEvent="ExecuteEvent",b.TriggerConnection="TriggerConnection",b.ContextVariableSet="ContextVariableSet",b.GlobalVariableSet="GlobalVariableSet",b.GlobalVariableDelete="GlobalVariableDelete",b.GlobalVariableGet="GlobalVariableGet",b.AddConnection="AddConnection",b.GetConnectionValue="GetConnectionValue",b.SetConnectionValue="SetConnectionValue",b.ActivateSignal="ActivateSignal",b.ContextVariableGet="ContextVariableGet"}(G||(G={}));class Y{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(b){if(b.time||(b.time=Date.now()),this.log.push(b),this.logToConsole){var d;const P=null===(d=b.zP)||void 0===d?void 0:d.value;"object"===typeof P&&P.getClassName?x.e.Log(`[FGLog] ${b.className}:${b.uniqueId.split("-")[0]} ${b.action} - ${JSON.stringify(P.getClassName())}: ${P.toString()}`):x.e.Log(`[FGLog] ${b.className}:${b.uniqueId.split("-")[0]} ${b.action} - ${JSON.stringify(b.zP)}`)}}getItemsOfType(b){return this.log.filter((d=>d.action===b))}}class s{get enableLogging(){return this._enableLogging}set enableLogging(b){this._enableLogging!==b&&(this._enableLogging=b,this._enableLogging?(this.logger=new Y,this.logger.logToConsole=!0):this.logger=null)}constructor(b){this.uniqueId=(0,C.e)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new W.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=b,this.assetsContext=b.assetsContext??b.Hd}hasVariable(b){return b in this._userVariables}setVariable(b,d){var P;this._userVariables[b]=d,null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",zP:{name:b,value:d}})}getAsset(b,d){return(0,L.e)(this.assetsContext,b,d)}getVariable(b){var d;return null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",zP:{name:b,value:this._userVariables[b]}}),this._userVariables[b]}get userVariables(){return this._userVariables}Xb(){return this._configuration.Hd}_getUniqueIdPrefixedName(b,d){return`${b.uniqueId}_${d}`}_getGlobalContextVariable(b,d){var P;return null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",zP:{name:b,defaultValue:d,possibleValue:this._globalContextVariables[b]}}),this._hasGlobalContextVariable(b)?this._globalContextVariables[b]:d}_setGlobalContextVariable(b,d){var P;null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",zP:{name:b,value:d}}),this._globalContextVariables[b]=d}_deleteGlobalContextVariable(b){var d;null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",zP:{name:b}}),delete this._globalContextVariables[b]}_hasGlobalContextVariable(b){return b in this._globalContextVariables}_setExecutionVariable(b,d,P){this._executionVariables[this._getUniqueIdPrefixedName(b,d)]=P}_getExecutionVariable(b,d,P){return this._hasExecutionVariable(b,d)?this._executionVariables[this._getUniqueIdPrefixedName(b,d)]:P}_deleteExecutionVariable(b,d){delete this._executionVariables[this._getUniqueIdPrefixedName(b,d)]}_hasExecutionVariable(b,d){return this._getUniqueIdPrefixedName(b,d)in this._executionVariables}_hasConnectionValue(b){return b.uniqueId in this._connectionValues}_setConnectionValue(b,d){var P;this._connectionValues[b.uniqueId]=d,null===(P=this.logger)||void 0===P||P.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",zP:{connectionPointId:b.uniqueId,value:d}})}_setConnectionValueByKey(b,d){this._connectionValues[b]=d}_getConnectionValue(b){var d;return null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",zP:{connectionPointId:b.uniqueId,value:this._connectionValues[b.uniqueId]}}),this._connectionValues[b.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(b){this._pendingBlocks.includes(b)||(this._pendingBlocks.push(b),this._pendingBlocks.sort(((b,d)=>b.priority-d.priority)))}_removePendingBlock(b){const d=this._pendingBlocks.indexOf(b);-1!==d&&this._pendingBlocks.splice(d,1)}_clearPendingBlocks(){for(const b of this._pendingBlocks)b._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(b){var d;this.onNodeExecutedObservable.notifyObservers(b),null===(d=this.logger)||void 0===d||d.addLogItem({time:Date.now(),className:b.getClassName(),uniqueId:b.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(b){this._setGlobalContextVariable("timeSinceStart",b.timeSinceStart),this._setGlobalContextVariable("deltaTime",b.deltaTime);for(const P of this._pendingBlocks){var d;null===(d=P._executeOnTick)||void 0===d||d.call(P,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.i;b.uniqueId=this.uniqueId,b._userVariables={};for(const G in this._userVariables)d(G,this._userVariables[G],b._userVariables);b._connectionValues={};for(const G in this._connectionValues)d(G,this._connectionValues[G],b._connectionValues);var P;this.assetsContext!==this.Xb()&&(b._assetsContext={meshes:this.assetsContext.meshes.map((b=>b.id)),materials:this.assetsContext.materials.map((b=>b.id)),textures:this.assetsContext.textures.map((b=>b.name)),animations:this.assetsContext.animations.map((b=>b.name)),lights:this.assetsContext.lights.map((b=>b.id)),cameras:this.assetsContext.cameras.map((b=>b.id)),ls:null===(P=this.assetsContext.ls)||void 0===P?void 0:P.map((b=>b.name)),skeletons:this.assetsContext.skeletons.map((b=>b.id)),kY:this.assetsContext.kY.map((b=>b.name)),geometries:this.assetsContext.geometries.map((b=>b.id)),multiMaterials:this.assetsContext.multiMaterials.map((b=>b.id)),transformNodes:this.assetsContext.transformNodes.map((b=>b.id))})}getClassName(){return"FlowGraphContext"}}(0,i.d)([(0,q.G)()],s.prototype,"uniqueId",void 0);var E=P(13377),w=P(11951);class t{constructor(b){this.onEventTriggeredObservable=new W.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=b,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Zd.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const b=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",zP:{timeSinceStart:this._startingTime,deltaTime:b}}),this._startingTime+=b})),this._meshPickedObserver=this._scene.onPointerObservable.add((b=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",zP:b})}),w.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((b=>{const d=b.pointerId,P=b.mesh,G=this._pointerUnderMeshState[d];!G&&P?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",zP:{pointerId:d,mesh:P}}):G&&!P?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",zP:{pointerId:d,mesh:G}}):G&&P&&G!==P&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",zP:{pointerId:d,mesh:G,over:P}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",zP:{pointerId:d,mesh:P,out:G}})),this._pointerUnderMeshState[d]=P}),w.e.POINTERMOVE)}dispose(){var b,d,P,G,W;null===(b=this._sceneDisposeObserver)||void 0===b||b.remove(),null===(d=this._sceneReadyObserver)||void 0===d||d.remove(),null===(P=this._sceneOnBeforeRenderObserver)||void 0===P||P.remove(),null===(G=this._meshPickedObserver)||void 0===G||G.remove(),null===(W=this._meshUnderPointerObserver)||void 0===W||W.remove(),this.onEventTriggeredObservable.clear()}}var r,B=P(13394);!function(b){b[b.Stopped=0]="Stopped",b[b.Started=1]="Started"}(r||(r={}));class n{get state(){return this._state}set state(b){this._state=b,this.onStateChangedObservable.notifyObservers(b)}constructor(b){this.onStateChangedObservable=new W.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=b.Hd,this._sceneEventCoordinator=new t(this._scene),this._coordinator=b.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((b=>{for(const d of this._executionContexts){const P=this._getContextualOrder(b.type,d);for(const G of P)if(!G._executeEvent(d,b.zP))break}switch(b.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const d of this._executionContexts)d._notifyOnTick(b.zP);break;case"SceneDispose":this.dispose()}}))}createContext(){const b=new s({Hd:this._scene,coordinator:this._coordinator});return this._executionContexts.push(b),b}getContext(b){return this._executionContexts[b]}addEventBlock(b){if("PointerOver"!==b.type&&"PointerOut"!==b.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==b.type&&this._eventBlocks[b.type].push(b),1===this.state)for(const d of this._executionContexts)b._startPendingTasks(d);else this.onStateChangedObservable.addOnce((d=>{if(1===d)for(const P of this._executionContexts)b._startPendingTasks(P)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((b=>{1===b&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const b of this._executionContexts)for(const d in this._eventBlocks){const P=this._getContextualOrder(d,b);for(const d of P)d._startPendingTasks(b)}}_getContextualOrder(b,d){const P=this._eventBlocks[b].sort(((b,d)=>d.initPriority-b.initPriority));if("MeshPick"===b){const b=[];for(const G of P){const W=G.asset.getValue(d);let i=0;for(;i<P.length;i++){const b=P[i].asset.getValue(d);if(W&&b&&(0,B.k)(W,b))break}b.splice(i,0,G)}return b}return P}dispose(){var b;if(0!==this.state){this.state=0;for(const b of this._executionContexts)b._clearPendingBlocks();this._executionContexts.length=0;for(const b in this._eventBlocks)this._eventBlocks[b].length=0;null===(b=this._eventObserver)||void 0===b||b.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(b){const d=[],P=new Set;for(const G in this._eventBlocks)for(const b of this._eventBlocks[G])d.push(b),P.add(b.uniqueId);for(;d.length>0;){const G=d.pop();b(G);for(const b of G.dataInputs)for(const G of b._connectedPoint)P.has(G._ownerBlock.uniqueId)||(d.push(G._ownerBlock),P.add(G._ownerBlock.uniqueId));if(G instanceof E.b)for(const b of G.signalOutputs)for(const G of b._connectedPoint)P.has(G._ownerBlock.uniqueId)||(d.push(G._ownerBlock),P.add(G._ownerBlock.uniqueId))}}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1?arguments[1]:void 0;b.allBlocks=[],this.visitAllBlocks((d=>{const P={};d.serialize(P),b.allBlocks.push(P)})),b.executionContexts=[];for(const P of this._executionContexts){const G={};P.serialize(G,d),b.executionContexts.push(G)}}}class Z{constructor(b){this.config=b,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.Hd.Zd.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.Hd.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const b=this._executeOnNextFrame.slice(0);if(b.length)for(const d of b){this.notifyCustomEvent(d.id,d.data,!1);const b=this._executeOnNextFrame.findIndex((b=>b.uniqueId===d.uniqueId));-1!==b&&this._executeOnNextFrame.splice(b,1)}}));(Z.SceneCoordinators.get(this.config.Hd)??[]).push(this)}createGraph(){const b=new n({Hd:this.config.Hd,coordinator:this});return this._flowGraphs.push(b),b}removeGraph(b){const d=this._flowGraphs.indexOf(b);-1!==d&&(b.dispose(),this._flowGraphs.splice(d,1))}start(){for(const b of this._flowGraphs)b.start()}dispose(){var b,d;for(const W of this._flowGraphs)W.dispose();this._flowGraphs.length=0,null===(b=this._disposeObserver)||void 0===b||b.remove(),null===(d=this._onBeforeRenderObserver)||void 0===d||d.remove();const P=Z.SceneCoordinators.get(this.config.Hd)??[],G=P.indexOf(this);-1!==G&&P.splice(G,1)}serialize(b,d){b._flowGraphs=[];for(const P of this._flowGraphs){const G={};P.serialize(G,d),b._flowGraphs.push(G)}b.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(b){let d=this._customEventsMap.get(b);return d||(d=new W.d,this._customEventsMap.set(b,d)),d}notifyCustomEvent(b,d){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:b,data:d,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(b)){const d=this._eventExecutionCounter.get(b);if(this._eventExecutionCounter.set(b,d+1),d>=Z.MaxEventTypeExecutionPerFrame)return void(d===Z.MaxEventTypeExecutionPerFrame&&x.e.Warn(`FlowGraphCoordinator: Too many executions of event "${b}".`))}else this._eventExecutionCounter.set(b,1);const P=this._customEventsMap.get(b);P&&P.notifyObservers(d)}}Z.MaxEventsPerType=30,Z.MaxEventTypeExecutionPerFrame=30,Z.SceneCoordinators=new Map},13397:(b,d,P)=>{"use strict";P.d(d,{d:()=>W});var G=P(13401);class W extends G.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(b){b._notifyExecuteNode(this),this.done._activateSignal(b)}}},13377:(b,d,P)=>{"use strict";P.d(d,{b:()=>C});var G=P(13386),W=P(13389),i=P(11639);class q extends W.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(b){super.connectTo(b),this._connectedPoint.sort(((b,d)=>d.priority-b.priority))}_activateSignal(b){var d;if(null===(d=b.logger)||void 0===d||d.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,zP:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)b._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(b,this),b._increaseExecutionId();else for(const P of this._connectedPoint)P._activateSignal(b)}}(0,i.f)("FlowGraphSignalConnection",q);class C extends G.b{constructor(b){super(b),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(b){const d=new q(b,0,this);return this.signalInputs.push(d),d}_registerSignalOutput(b){const d=new q(b,1,this);return this.signalOutputs.push(d),d}_unregisterSignalInput(b){const d=this.signalInputs.findIndex((d=>d.name===b));-1!==d&&(this.signalInputs[d].dispose(),this.signalInputs.splice(d,1))}_unregisterSignalOutput(b){const d=this.signalOutputs.findIndex((d=>d.name===b));-1!==d&&(this.signalOutputs[d].dispose(),this.signalOutputs.splice(d,1))}_reportError(b,d){this.error.zP="string"===typeof d?new Error(d):d,this.error._activateSignal(b)}getSignalInput(b){return this.signalInputs.find((d=>d.name===b))}getSignalOutput(b){return this.signalOutputs.find((d=>d.name===b))}serialize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(b),b.signalInputs=[],b.signalOutputs=[];for(const d of this.signalInputs){const P={};d.serialize(P),b.signalInputs.push(P)}for(const d of this.signalOutputs){const P={};d.serialize(P),b.signalOutputs.push(P)}}deserialize(b){for(let d=0;d<b.signalInputs.length;d++){const P=this.getSignalInput(b.signalInputs[d].name);if(!P)throw new Error("Could not find signal input with name "+b.signalInputs[d].name+" in block "+b.className);P.deserialize(b.signalInputs[d])}for(let d=0;d<b.signalOutputs.length;d++){const P=this.getSignalOutput(b.signalOutputs[d].name);if(!P)throw new Error("Could not find signal output with name "+b.signalOutputs[d].name+" in block "+b.className);P.deserialize(b.signalOutputs[d])}}getClassName(){return"FlowGraphExecutionBlock"}}},13409:(b,d,P)=>{"use strict";P.d(d,{e:()=>W});var G=P(13377);class W extends G.b{constructor(b){super(b),this.out=this._registerSignalOutput("out")}}},13365:(b,d,P)=>{"use strict";P.d(d,{A:()=>t,B:()=>u,E:()=>M,F:()=>X,G:()=>g,b:()=>L,c:()=>s,d:()=>f,g:()=>r,i:()=>B,m:()=>n,p:()=>Y,s:()=>A,t:()=>x,u:()=>E,y:()=>w});var G,W=P(11681),i=P(11725),q=P(13360),C=P(13368);!function(b){b.Any="any",b.String="string",b.Number="number",b.Boolean="boolean",b.Object="object",b.Integer="FlowGraphInteger",b.Vector2="Vector2",b.ed="ed",b.Vector4="Vector4",b.Quaternion="Quaternion",b.Matrix="Matrix",b.Matrix2D="Matrix2D",b.Matrix3D="Matrix3D",b.Nd="Nd",b.ci="ci"}(G||(G={}));class J{constructor(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=b,this.defaultValue=d,this.animationType=P}serialize(b){b.typeName=this.typeName,b.defaultValue=this.defaultValue}}const L=new J("any",void 0),x=new J("string",""),Y=new J("number",0,0),s=new J("boolean",!1),E=new J("Vector2",W.Vector2.Zero(),5),w=new J("ed",W.ed.Zero(),1),t=new J("Vector4",W.Vector4.Zero()),r=new J("Matrix",W.Matrix.Identity(),3),B=new J("Matrix2D",new C.d),n=new J("Matrix3D",new C.g),Z=new J("Nd",i.Nd.Black(),4),o=new J("ci",new i.ci(0,0,0,0),7),A=new J("Quaternion",W.Quaternion.Identity(),2);A.typeTransformer=b=>{if(b.getClassName){if("Vector4"===b.getClassName())return W.Quaternion.Od(b.jd());if("ed"===b.getClassName())return W.Quaternion.FromEulerVector(b);if("Matrix"===b.getClassName())return W.Quaternion.FromRotationMatrix(b)}return b};const f=new J("FlowGraphInteger",new q.b(0),0);function g(b){const d=b;switch(typeof b){case"string":return x;case"number":return Y;case"boolean":return s;case"object":if(d.getClassName)switch(d.getClassName()){case"Vector2":return E;case"ed":return w;case"Vector4":return t;case"Matrix":return r;case"Nd":return Z;case"ci":return o;case"Quaternion":return A;case"FlowGraphInteger":return f;case"Matrix2D":return B;case"Matrix3D":return n}return L;default:return L}}function X(b){switch(b){case"string":return x;case"number":return Y;case"boolean":return s;case"Vector2":return E;case"ed":return w;case"Vector4":return t;case"Matrix":return r;case"Nd":return Z;case"ci":return o;case"Quaternion":return A;case"FlowGraphInteger":return f;case"Matrix2D":return B;case"Matrix3D":return n;default:return L}}function u(b){switch(b){case"number":default:return 0;case"Vector2":return 5;case"ed":return 1;case"Matrix":return 3;case"Nd":return 4;case"ci":return 7;case"Quaternion":return 2}}function M(b){switch(b){case 0:return Y;case 5:return E;case 1:return w;case 3:return r;case 4:return Z;case 7:return o;case 2:return A;default:return L}}},13352:(b,d,P)=>{"use strict";P.d(d,{e:()=>x,i:()=>L,l:()=>Y});var G=P(11725),W=P(11681),i=P(13360),q=P(13365),C=P(13368);function J(b){return"Vector2"===b||"ed"===b||"Vector4"===b||"Quaternion"===b||"Nd"===b||"ci"===b}function L(b,d,P){var G;const W=(null===d||void 0===d||null===(G=d.getClassName)||void 0===G?void 0:G.call(d))??"";if(J(W)||function(b){return"Matrix"===b||"Matrix2D"===b||"Matrix3D"===b}(W))P[b]={value:d.jd(),className:W};else if("FlowGraphInteger"===W)P[b]={value:d.value,className:W};else if(W&&(d.id||d.name))P[b]={id:d.id,name:d.name,className:W};else{if("object"===typeof d)throw new Error(`Could not serialize value ${d}`);P[b]=d}}function x(b,d,P,L){const Y=d[b];let s;const E=(null===Y||void 0===Y?void 0:Y.type)??(null===Y||void 0===Y?void 0:Y.className);if(function(b){return"Mesh"===b||"AbstractMesh"===b||"GroundMesh"===b||"InstanceMesh"===b||"LinesMesh"===b||"GoldbergMesh"===b||"GreasedLineMesh"===b||"TrailMesh"===b}(E)){let b=L.meshes.filter((b=>Y.id?b.id===Y.id:b.name===Y.name));0===b.length&&(b=L.transformNodes.filter((b=>Y.id?b.id===Y.id:b.name===Y.name))),s=Y.uniqueId?b.find((b=>b.uniqueId===Y.uniqueId)):b[0]}else if(J(E))s=function(b,d){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===b)return W.Vector2.Od(d);if("ed"===b)return P&&(d[2]*=-1),W.ed.Od(d);if("Vector4"===b)return W.Vector4.Od(d);if("Quaternion"===b)return P&&(d[2]*=-1,d[3]*=-1),W.Quaternion.Od(d);if("Nd"===b)return new G.Nd(d[0],d[1],d[2]);if("ci"===b)return new G.ci(d[0],d[1],d[2],d[3]);throw new Error(`Unknown vector class name ${b}`)}(E,Y.value);else if(function(b){return"AnimationGroup"===b}(E)){const b=L.animationGroups.filter((b=>b.name===Y.name));s=1===b.length?b[0]:b.find((b=>b.uniqueId===Y.uniqueId))}else s="Matrix"===E?W.Matrix.Od(Y.value):"Matrix2D"===E?new C.d(Y.value):"Matrix3D"===E?new C.g(Y.value):"FlowGraphInteger"===E?i.b.FromValue(Y.value):"number"===E||"string"===E||"boolean"===E?Y.value[0]:Y&&void 0!==Y.value?Y.value:Array.isArray(Y)?Y.reduce(((b,d)=>d.eventData?(b[d.id]={type:(0,q.F)(d.type)},"undefined"!==typeof d.value&&(b[d.id].value=x("value",d,P,L)),b):b),{}):Y;return s}function Y(b){return"FlowGraphJsonPointerParserBlock"===b}},13394:(b,d,P)=>{"use strict";function G(b,d){return!(!b.parent||b.parent!==d&&!G(b.parent,d))}function W(b){if(b.getClassName)return b.getClassName()}function i(b,d){return b===d&&("Vector2"===b||"ed"===b||"Vector4"===b||"Quaternion"===b)}function q(b,d){return b===d&&("Matrix"===b||"Matrix2D"===b||"Matrix3D"===b)}function C(b,d){return"FlowGraphInteger"===b&&"FlowGraphInteger"===d}function J(b,d){const P="number"===typeof b||"number"===typeof(null===b||void 0===b?void 0:b.value);return P&&!d?!isNaN(L(b)):P}function L(b){return"number"===typeof b?b:b.value}P.d(d,{c:()=>C,e:()=>q,h:()=>i,i:()=>W,k:()=>G,l:()=>L,n:()=>J})},12785:(b,d,P)=>{"use strict";P.r(d),P.d(d,{SceneInstrumentation:()=>i});var G=P(11484),W=P(11886);class i{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(b){b!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=b,b?(this._onBeforeActiveMeshesEvaluationObserver=this.Hd.onBeforeActiveMeshesEvaluationObservable.add((()=>{G.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Hd.onAfterActiveMeshesEvaluationObservable.add((()=>{G.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Hd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Hd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(b){b!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=b,b?(this._onBeforeRenderTargetsRenderObserver=this.Hd.onBeforeRenderTargetsRenderObservable.add((()=>{G.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Hd.onAfterRenderTargetsRenderObservable.add((()=>{G.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Hd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Hd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(b){b!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=b,b?(this._onBeforeParticlesRenderingObserver=this.Hd.onBeforeParticlesRenderingObservable.add((()=>{G.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Hd.onAfterParticlesRenderingObservable.add((()=>{G.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Hd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Hd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(b){b!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=b,this.Hd.spriteManagers&&(b?(this._onBeforeSpritesRenderingObserver=this.Hd.onBeforeSpritesRenderingObservable.add((()=>{G.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Hd.onAfterSpritesRenderingObservable.add((()=>{G.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Hd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Hd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(b){b!==this._capturePhysicsTime&&this.Hd.onBeforePhysicsObservable&&(this._capturePhysicsTime=b,b?(this._onBeforePhysicsObserver=this.Hd.onBeforePhysicsObservable.add((()=>{G.Tools.StartPerformanceCounter("hw"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Hd.onAfterPhysicsObservable.add((()=>{G.Tools.EndPerformanceCounter("hw"),this._physicsTime.endMonitoring()}))):(this.Hd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Hd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(b){b!==this._captureAnimationsTime&&(this._captureAnimationsTime=b,b?this._onAfterAnimationsObserver=this.Hd.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Hd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(b){this._captureFrameTime=b}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(b){this._captureInterFrameTime=b}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(b){b!==this._captureRenderTime&&(this._captureRenderTime=b,b?(this._onBeforeDrawPhaseObserver=this.Hd.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),G.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Hd.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),G.Tools.EndPerformanceCounter("Main render")}))):(this.Hd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Hd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(b){b!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=b,b?(this._onBeforeCameraRenderObserver=this.Hd.onBeforeCameraRenderObservable.add((b=>{this._cameraRenderTime.beginMonitoring(),G.Tools.StartPerformanceCounter(`Rendering camera ${b.name}`)})),this._onAfterCameraRenderObserver=this.Hd.onAfterCameraRenderObservable.add((b=>{this._cameraRenderTime.endMonitoring(!1),G.Tools.EndPerformanceCounter(`Rendering camera ${b.name}`)}))):(this.Hd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Hd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Hd.getEngine()._drawCalls}constructor(b){this.Hd=b,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new W.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new W.c,this._captureFrameTime=!1,this._frameTime=new W.c,this._captureRenderTime=!1,this._renderTime=new W.c,this._captureInterFrameTime=!1,this._interFrameTime=new W.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new W.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new W.c,this._capturePhysicsTime=!1,this._physicsTime=new W.c,this._captureAnimationsTime=!1,this._animationsTime=new W.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new W.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=b.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(G.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Hd.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=b.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(G.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.td(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.td(),this._captureParticlesRenderTime&&this._particlesRenderTime.td(),this._captureSpritesRenderTime&&this._spritesRenderTime.td(),this._captureRenderTime&&this._renderTime.td(),this._captureCameraRenderTime&&this._cameraRenderTime.td()}))}dispose(){this._disposed||(this.Hd.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Hd.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Hd.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Hd.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Hd.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Hd.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Hd.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Hd.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Hd.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Hd.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Hd.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Hd.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Hd.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Hd.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Hd.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Hd.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Hd.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Hd=null,this._disposed=!0)}}},13348:(b,d,P)=>{"use strict";P.d(d,{d:()=>x});var G=P(11663),W=P(11670),i=P(11681),q=P(12111),C=P(12220),J=P(12285),L=P(11639);q.c.AddNodeConstructor("Light_Type_1",((b,d)=>()=>new x(b,i.ed.Zero(),d)));class x extends J.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(b){this._shadowFrustumSize=b,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(b){this._shadowOrthoScale=b,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(b){this._orthoLeft=b}get orthoRight(){return this._orthoRight}set orthoRight(b){this._orthoRight=b}get orthoTop(){return this._orthoTop}set orthoTop(b){this._orthoTop=b}get orthoBottom(){return this._orthoBottom}set orthoBottom(b){this._orthoBottom=b}constructor(b,d,P){super(b,P),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=d.scale(-1),this.direction=d}getClassName(){return"Tw"}getTypeID(){return C.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(b,d,P){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(b):this._setDefaultAutoExtendShadowProjectionMatrix(b,d,P)}_setDefaultFixedFrustumShadowProjectionMatrix(b){const d=this.Xb().activeCamera;d&&i.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:d.Vd,void 0!==this.shadowMaxZ?this.shadowMaxZ:d.maxZ,b,this.Xb().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(b,d,P){const G=this.Xb().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const b=i.ed.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let G=Number.MAX_VALUE,W=-Number.MAX_VALUE;for(let q=0;q<P.length;q++){const C=P[q];if(!C)continue;const J=C.getBoundingInfo().boundingBox;for(let P=0;P<J.vectorsWorld.length;P++)i.ed.TransformCoordinatesToRef(J.vectorsWorld[P],d,b),b.x<this._orthoLeft&&(this._orthoLeft=b.x),b.y<this._orthoBottom&&(this._orthoBottom=b.y),b.x>this._orthoRight&&(this._orthoRight=b.x),b.y>this._orthoTop&&(this._orthoTop=b.y),this.autoCalcShadowZBounds&&(b.z<G&&(G=b.z),b.z>W&&(W=b.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=G,this._shadowMaxZ=W)}const W=this._orthoRight-this._orthoLeft,q=this._orthoTop-this._orthoBottom,C=void 0!==this.shadowMinZ?this.shadowMinZ:(null===G||void 0===G?void 0:G.Vd)||0,J=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===G||void 0===G?void 0:G.maxZ)||1e4,L=this.Xb().getEngine().useReverseDepthBuffer;i.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-W*this.shadowOrthoScale,this._orthoRight+W*this.shadowOrthoScale,this._orthoBottom-q*this.shadowOrthoScale,this._orthoTop+q*this.shadowOrthoScale,L?J:C,L?C:J,b,this.Xb().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(b,d){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,d),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,d),this)}transferToNodeMaterialEffect(b,d){return this.computeTransformedInformation()?(b.setFloat3(d,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(b.setFloat3(d,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(b){const d=this._scene.getEngine();return!d.useReverseDepthBuffer&&d.isNDCHalfZRange?0:1}getDepthMaxZ(b){const d=this._scene.getEngine();return d.useReverseDepthBuffer&&d.isNDCHalfZRange?0:1}prepareLightSpecificDefines(b,d){b["DIRLIGHT"+d]=!0}}(0,G.d)([(0,W.G)()],x.prototype,"shadowFrustumSize",null),(0,G.d)([(0,W.G)()],x.prototype,"shadowOrthoScale",null),(0,G.d)([(0,W.G)()],x.prototype,"autoUpdateExtends",void 0),(0,G.d)([(0,W.G)()],x.prototype,"autoCalcShadowZBounds",void 0),(0,G.d)([(0,W.G)("orthoLeft")],x.prototype,"_orthoLeft",void 0),(0,G.d)([(0,W.G)("orthoRight")],x.prototype,"_orthoRight",void 0),(0,G.d)([(0,W.G)("orthoTop")],x.prototype,"_orthoTop",void 0),(0,G.d)([(0,W.G)("orthoBottom")],x.prototype,"_orthoBottom",void 0),(0,L.f)("BABYLON.DirectionalLight",x)},13812:(b,d,P)=>{"use strict";P.d(d,{e:()=>x});var G=P(11663),W=P(11670),i=P(11681),q=P(11725),C=P(12111),J=P(12220),L=P(11639);C.c.AddNodeConstructor("Light_Type_3",((b,d)=>()=>new x(b,i.ed.Zero(),d)));class x extends J.d{constructor(b,d,P){super(b,P),this.groundColor=new q.Nd(0,0,0),this.direction=d||i.ed.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Kw"}setDirectionToTarget(b){return this.direction=i.ed.Normalize(b.Rd(i.ed.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(b,d){const P=i.ed.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",P.x,P.y,P.z,0,d),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.fC),d),this}transferToNodeMaterialEffect(b,d){const P=i.ed.Normalize(this.direction);return b.setFloat3(d,P.x,P.y,P.z),this}zd(){return this._worldMatrix||(this._worldMatrix=i.Matrix.Identity()),this._worldMatrix}getTypeID(){return J.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(b,d){b["HEMILIGHT"+d]=!0}}(0,G.d)([(0,W.n)()],x.prototype,"groundColor",void 0),(0,G.d)([(0,W.F)()],x.prototype,"direction",void 0),(0,L.f)("BABYLON.HemisphericLight",x)},13320:(b,d,P)=>{"use strict";P.d(d,{e:()=>Y});var G=P(11663),W=P(11670),i=P(11681),q=P(12111),C=P(12220),J=P(12285),L=P(11658),x=P(11639);q.c.AddNodeConstructor("Light_Type_2",((b,d)=>()=>new Y(b,i.ed.Zero(),i.ed.Zero(),0,0,d)));class Y extends J.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(b){this._iesProfileTexture!==b&&(this._iesProfileTexture=b,this._iesProfileTexture&&Y._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(b){this._angle=b,this._cosHalfAngle=Math.cos(.5*b),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(b){this._innerAngle=b,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(b){this._shadowAngleScale=b,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(b){this._projectionTextureLightNear=b,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(b){this._projectionTextureLightFar=b,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(b){this._projectionTextureUpDirection=b,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(b){this._projectionTexture!==b&&(this._projectionTexture=b,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Y._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Y._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(b){return void 0!==b.onGeneratedObservable}static _IsTexture(b){return void 0!==b.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(b){this._projectionTextureProjectionLightMatrix=b,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(b,d,P,G,W,q){super(b,q),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=i.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=i.ed.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=i.ed.Zero(),this._projectionTextureViewLightMatrix=i.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=i.Matrix.Zero(),this._projectionTextureScalingMatrix=i.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=d,this.direction=P,this.angle=G,this.exponent=W}getClassName(){return"SpotLight"}getTypeID(){return C.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(b){super._setDirection(b),this._projectionTextureViewLightDirty=!0}_setPosition(b){super._setPosition(b),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(b,d,P){const G=this.Xb().activeCamera;if(!G)return;this._shadowAngleScale=this._shadowAngleScale||1;const W=this._shadowAngleScale*this._angle,q=void 0!==this.shadowMinZ?this.shadowMinZ:G.Vd,C=void 0!==this.shadowMaxZ?this.shadowMaxZ:G.maxZ,J=this.Xb().getEngine().useReverseDepthBuffer;i.Matrix.PerspectiveFovLHToRef(W,1,J?C:q,J?q:C,b,!0,this._scene.getEngine().isNDCHalfZRange,void 0,J)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),i.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const b=this.projectionTextureLightFar,d=this.projectionTextureLightNear,P=b/(b-d),G=-P*d,W=1/Math.tan(this._angle/2);i.Matrix.FromValuesToRef(W/1,0,0,0,0,W,0,0,0,0,P,1,0,0,G,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof L.d){const b=this._projectionTexture.uScale/2,d=this._projectionTexture.vScale/2;i.Matrix.FromValuesToRef(b,0,0,0,0,d,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(b,d){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),b.setMatrix("textureProjectionMatrix"+d,this._projectionTextureMatrix),b.setTexture("projectionLightTexture"+d,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&b.setTexture("iesLightTexture"+d,this._iesProfileTexture),this}transferToEffect(b,d){let P;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,d),P=i.ed.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,d),P=i.ed.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",P.x,P.y,P.z,this._cosHalfAngle,d),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,d),this}transferToNodeMaterialEffect(b,d){let P;return P=this.computeTransformedInformation()?i.ed.Normalize(this.transformedDirection):i.ed.Normalize(this.direction),this.Xb().useRightHandedSystem?b.setFloat3(d,-P.x,-P.y,-P.z):b.setFloat3(d,P.x,P.y,P.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(b){const d=this._scene.getEngine(),P=void 0!==this.shadowMinZ?this.shadowMinZ:(null===b||void 0===b?void 0:b.Vd)??0;return d.useReverseDepthBuffer&&d.isNDCHalfZRange?P:this._scene.getEngine().isNDCHalfZRange?0:P}getDepthMaxZ(b){const d=this._scene.getEngine(),P=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===b||void 0===b?void 0:b.maxZ)??1e4;return d.useReverseDepthBuffer&&d.isNDCHalfZRange?0:P}prepareLightSpecificDefines(b,d){b["SPOTLIGHT"+d]=!0,b["PROJECTEDLIGHTTEXTURE"+d]=!(!this.projectionTexture||!this.projectionTexture.isReady()),b["IESLIGHTTEXTURE"+d]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,G.d)([(0,W.G)()],Y.prototype,"angle",null),(0,G.d)([(0,W.G)()],Y.prototype,"innerAngle",null),(0,G.d)([(0,W.G)()],Y.prototype,"shadowAngleScale",null),(0,G.d)([(0,W.G)()],Y.prototype,"exponent",void 0),(0,G.d)([(0,W.G)()],Y.prototype,"projectionTextureLightNear",null),(0,G.d)([(0,W.G)()],Y.prototype,"projectionTextureLightFar",null),(0,G.d)([(0,W.G)()],Y.prototype,"projectionTextureUpDirection",null),(0,G.d)([(0,W.B)("projectedLightTexture")],Y.prototype,"_projectionTexture",void 0),(0,x.f)("BABYLON.SpotLight",Y)},13034:(b,d,P)=>{"use strict";P.d(d,{d:()=>q,h:()=>i,l:()=>C});const G={},W={};function i(b,d){G[b]=d}function q(b,d){W[b]=d}function C(b){return W[b]?W[b]:null}},12934:(b,d,P)=>{"use strict";P.d(d,{e:()=>g,h:()=>N});var G,W=P(11484),i=P(11487),q=P(11909),C=P(11535),J=P(11504),L=P(12147),x=P(11539),Y=P(11546),s=P(11643),E=P(11574),w=P(11531);!function(b){b[b.Clean=0]="Clean",b[b.Stop=1]="Stop",b[b.Sync=2]="Sync",b[b.NoSync=3]="NoSync"}(G||(G={}));const t=new i.d,r={};let B=!1;function n(){return r[".babylon"]}function Z(b,d){const P=r[b];return P||(J.e.Warn("Unable to find a plugin to load "+b+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),d?n():void 0)}function o(b,d,P){let G="Unable to load from "+(b.rawData?"binary data":b.url);return d?G+=`: ${d}`:P&&(G+=`: ${P}`),G}async function A(b,d,P,G,W,i,q,C,J){var L;const Y="data:"===(s=b.url).substring(0,5)?s.substring(5):null;var s;if(b.rawData&&!q)throw"When using ArrayBufferView to load data the file extension must be provided.";const B=Y||q?"":function(b){const d=b.indexOf("?");-1!==d&&(b=b.substring(0,d));const P=b.lastIndexOf(".");return b.substring(P,b.length).toLowerCase()}(b.url);let o=q?Z(q,!0):Y?function(b){for(const d in r){const P=r[d].plugin;if(P.canDirectLoad&&P.canDirectLoad(b))return r[d]}return n()}(b.url):Z(B,!1);if(!o&&B){if(b.url&&!b.url.startsWith("blob:")){const d=await async function(b,d){const P=d.method||"GET";return await new Promise(((G,W)=>{const i=new w.c;i.addEventListener("readystatechange",(()=>{if(4==i.readyState)if(200==i.status){const b={};if(d.responseHeaders)for(const P of d.responseHeaders)b[P]=i.getResponseHeader(P)||"";G({response:i.response,headerValues:b})}else W(`Unable to fetch data from ${b}. Error code: ${i.status}`)})),i.open(P,b),i.send()}))}(b.url,{method:"HEAD",responseHeaders:["Content-Type"]}),P=d.headerValues?d.headerValues["Content-Type"]:"";P&&(o=function(b){for(const d in r){const P=r[d];if(P.mimeType===b)return P}}(P))}o||(o=n())}if(!o)throw new Error(`No plugin or fallback for ${q??b.url}`);if(!1===(null===J||void 0===J||null===(L=J[o.plugin.name])||void 0===L?void 0:L.enabled))throw new Error(`The '${o.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(b.rawData&&!o.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(b=>{if(o.plugin.createPlugin){const d=o.plugin.createPlugin(J??{});return d instanceof Promise?(d.then(b).catch((b=>{W("Error instantiating plugin.",b)})),null):(b(d),d)}return b(o.plugin),o.plugin})((J=>{var L;if(!J)throw`The loader plugin corresponding to the '${q}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(t.notifyObservers(J),Y&&(J.canDirectLoad&&J.canDirectLoad(b.url)||!(0,x.k)(b.url))){if(J.directLoad){const b=J.directLoad(d,Y);b instanceof Promise?b.then((b=>{P(J,b)})).catch((b=>{W("Error in directLoad of _loadData: "+b,b)})):P(J,b)}else P(J,Y);return}const s=o.isBinary,w=(b,G)=>{d.L?W("Scene has been disposed"):P(J,b,G)};let r=null,B=!1;null===(L=J.Zd)||void 0===L||L.add((()=>{B=!0,r&&(r.abort(),r=null),i()}));const n=()=>{if(B)return;const P=(b,d)=>{W(null===b||void 0===b?void 0:b.statusText,d)};if(!J.loadFile&&b.rawData)throw"Plugin does not support loading ArrayBufferView.";r=J.loadFile?J.loadFile(d,b.rawData||b.file||b.url,b.rootUrl,w,G,s,P,C):d._loadFile(b.file||b.url,w,G,!0,s,P)},Z=d.getEngine();let A=Z.enableOfflineSupport;if(A){let P=!1;for(const G of d.disableOfflineSupportExceptionRules)if(G.test(b.url)){P=!0;break}A=!P}A&&E.e.OfflineProviderFactory?d.offlineProvider=E.e.OfflineProviderFactory(b.url,n,Z.disableManifestCheck):n()}))}function f(b,d){let P,G,i=null,q=null;if(d)if(d.name)P=`file:${d.name}`,G=d.name,i=d;else if(ArrayBuffer.isView(d))P="",G=(0,s.e)(),q=d;else if(d.startsWith("data:"))P=d,G="";else if(b){const i=d;if("/"===i.substring(0,1))return W.Tools.Error("Wrong sceneFilename parameter"),null;P=b+i,G=i}else P=d,G=W.Tools.GetFilename(d),b=W.Tools.GetFolderPath(d);else P=b,G=W.Tools.GetFilename(b),b=W.Tools.GetFolderPath(b);return{url:P,rootUrl:b,name:G,file:i,rawData:q}}function g(b){if("string"===typeof b.extensions){const d=b.extensions;r[d.toLowerCase()]={plugin:b,isBinary:!1}}else{const d=b.extensions,P=Object.keys(d);for(const G of P)r[G.toLowerCase()]={plugin:b,isBinary:d[G].isBinary,mimeType:d[G].mimeType}}}async function X(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C.e.LastCreatedScene,W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",s=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!G)return J.e.Error("No scene available to import mesh to"),null;const E=f(d,P);if(!E)return null;const w={};G.addPendingData(w);const t=()=>{G.removePendingData(w)},r=(b,d)=>{const P=o(E,b,d);q?q(G,P,new Y.d(P,Y.c.SceneLoaderError,d)):J.e.Error(P),t()},B=i?b=>{try{i(b)}catch(d){r("Error in onProgress callback: "+d,d)}}:void 0,n=(b,d,P,i,q,C,J,L)=>{if(G.importedMeshesFiles.push(E.url),W)try{W(b,d,P,i,q,C,J,L)}catch(x){r("Error in onSuccess callback: "+x,x)}G.removePendingData(w)};return await A(E,G,((d,P,W)=>{if(d.rewriteRootURL&&(E.rootUrl=d.rewriteRootURL(E.rootUrl,W)),d.importMesh){const W=[],i=[],q=[];if(!d.importMesh(b,G,P,E.rootUrl,W,i,q,r))return;G.loadingPluginName=d.name,n(W,i,q,[],[],[],[],[])}else{d.importMeshAsync(b,G,P,E.rootUrl,B,E.name).then((b=>{G.loadingPluginName=d.name,n(b.meshes,b.kY,b.skeletons,b.animationGroups,b.transformNodes,b.geometries,b.lights,b.spriteManagers)})).catch((b=>{r(b.message,b)}))}}),B,r,t,L,x,s)}async function u(b,d,P,G,W,i,q,C){return await new Promise(((J,L)=>{try{X(b,d,P,G,((b,d,P,G,W,i,q,C)=>{J({meshes:b,kY:d,skeletons:P,animationGroups:G,transformNodes:W,geometries:i,lights:q,spriteManagers:C})}),W,((b,d,P)=>{L(P||new Error(d))}),i,q,C).catch(L)}catch(Y){L(Y)}}))}async function M(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.e.LastCreatedEngine,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};P?await R(b,d,new q.e(P),G,i,J,L,x,Y):W.Tools.Error("No engine available")}async function e(b,d,P,G,W,i,q){return await new Promise(((C,J)=>{M(b,d,P,(b=>{C(b)}),G,((b,d,P)=>{J(P||new Error(d))}),W,i,q)}))}async function R(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.e.LastCreatedScene,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!P)return J.e.Error("No scene available to append to"),null;const E=f(b,d);if(!E)return null;const w={};P.addPendingData(w);const t=()=>{P.removePendingData(w)};L.e.ShowLoadingScreen&&!B&&(B=!0,P.getEngine().displayLoadingUI(),P.executeWhenReady((()=>{P.getEngine().hideLoadingUI(),B=!1})));const r=(b,d)=>{const G=o(E,b,d);i?i(P,G,new Y.d(G,Y.c.SceneLoaderError,d)):J.e.Error(G),t()},n=W?b=>{try{W(b)}catch(d){r("Error in onProgress callback",d)}}:void 0,Z=()=>{if(G)try{G(P)}catch(b){r("Error in onSuccess callback",b)}P.removePendingData(w)};return await A(E,P,((b,d)=>{if(b.load){if(!b.load(P,d,E.rootUrl,r))return;P.loadingPluginName=b.name,Z()}else{b.loadAsync(P,d,E.rootUrl,n,E.name).then((()=>{P.loadingPluginName=b.name,Z()})).catch((b=>{r(b.message,b)}))}}),n,r,t,q,x,s)}async function U(b,d,P,G,W,i,q){return await new Promise(((C,J)=>{try{R(b,d,P,(b=>{C(b)}),G,((b,d,P)=>{J(P||new Error(d))}),W,i,q).catch(J)}catch(Y){J(Y)}}))}async function H(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.e.LastCreatedScene,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!P)return J.e.Error("No scene available to load asset container to"),null;const s=f(b,d);if(!s)return null;const E={};P.addPendingData(E);const w=()=>{P.removePendingData(E)},t=(b,d)=>{const G=o(s,b,d);i?i(P,G,new Y.d(G,Y.c.SceneLoaderError,d)):J.e.Error(G),w()},r=W?b=>{try{W(b)}catch(d){t("Error in onProgress callback",d)}}:void 0,B=b=>{if(G)try{G(b)}catch(d){t("Error in onSuccess callback",d)}P.removePendingData(E)};return await A(s,P,((b,d)=>{if(b.loadAssetContainer){const G=b.loadAssetContainer(P,d,s.rootUrl,t);if(!G)return;G.populateRootNodes(),P.loadingPluginName=b.name,B(G)}else if(b.loadAssetContainerAsync){b.loadAssetContainerAsync(P,d,s.rootUrl,r,s.name).then((d=>{d.populateRootNodes(),P.loadingPluginName=b.name,B(d)})).catch((b=>{t(b.message,b)}))}else t("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),r,t,w,q,L,x)}async function p(b,d,P,G,W,i,q){return await new Promise(((C,J)=>{try{H(b,d,P,(b=>{C(b)}),G,((b,d,P)=>{J(P||new Error(d))}),W,i,q).catch(J)}catch(Y){J(Y)}}))}async function S(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.e.LastCreatedScene,G=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,x=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,s=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",E=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!P)return void J.e.Error("No scene available to load animations to");if(G){for(const G of P.animatables)G.reset();P.stopAllAnimations();const b=P.animationGroups.slice();for(const P of b)P.dispose();const d=P.getNodes();for(const P of d)P.animations&&(P.animations=[])}else switch(W){case 0:const b=P.animationGroups.slice();for(const d of b)d.dispose();break;case 1:for(const d of P.animationGroups)d.stop();break;case 2:for(const d of P.animationGroups)d.reset(),d.restart();break;case 3:break;default:return void J.e.Error("Unknown animation group loading mode value '"+W+"'")}const w=P.animatables.length;await H(b,d,P,(b=>{b.mergeAnimationsTo(P,P.animatables.slice(w),i),b.dispose(),P.onAnimationFileImportedObservable.notifyObservers(P),q&&q(P)}),L,x,Y,s,E)}async function l(b,d,P,G,W,i,q,C,J,L){return await new Promise(((x,s)=>{try{S(b,d,P,G,W,i,(b=>{x(b)}),q,((b,d,P)=>{s(P||new Error(d))}),C,J,L).catch(s)}catch(Y){s(Y)}}))}class N{static get ForceFullSceneLoadingForIncremental(){return L.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(b){L.e.ForceFullSceneLoadingForIncremental=b}static get ShowLoadingScreen(){return L.e.ShowLoadingScreen}static set ShowLoadingScreen(b){L.e.ShowLoadingScreen=b}static get loggingLevel(){return L.e.loggingLevel}static set loggingLevel(b){L.e.loggingLevel=b}static get CleanBoneMatrixWeights(){return L.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(b){L.e.CleanBoneMatrixWeights=b}static GetDefaultPlugin(){return n()}static GetPluginForExtension(b){var d;return null===(d=Z(b,!0))||void 0===d?void 0:d.plugin}static IsPluginForExtensionAvailable(b){return function(b){return!!r[b]}(b)}static RegisterPlugin(b){g(b)}static ImportMesh(b,d,P,G,W,i,q,J,L){X(b,d,P,G,W,i,q,J,L).catch((b=>null===q||void 0===q?void 0:q(C.e.LastCreatedScene,null===b||void 0===b?void 0:b.message,b)))}static async ImportMeshAsync(b,d,P,G,W,i,q){return await u(b,d,P,G,W,i,q)}static Load(b,d,P,G,W,i,q,J){M(b,d,P,G,W,i,q,J).catch((b=>null===i||void 0===i?void 0:i(C.e.LastCreatedScene,null===b||void 0===b?void 0:b.message,b)))}static async LoadAsync(b,d,P,G,W,i){return await e(b,d,P,G,W,i)}static Append(b,d,P,G,W,i,q,J){R(b,d,P,G,W,i,q,J).catch((b=>null===i||void 0===i?void 0:i(P??C.e.LastCreatedScene,null===b||void 0===b?void 0:b.message,b)))}static async AppendAsync(b,d,P,G,W,i){return await U(b,d,P,G,W,i)}static LoadAssetContainer(b,d,P,G,W,i,q,J){H(b,d,P,G,W,i,q,J).catch((b=>null===i||void 0===i?void 0:i(P??C.e.LastCreatedScene,null===b||void 0===b?void 0:b.message,b)))}static async LoadAssetContainerAsync(b,d,P,G,W,i){return await p(b,d,P,G,W,i)}static ImportAnimations(b,d,P,G,W,i,q,J,L,x,Y){S(b,d,P,G,W,i,q,J,L,x,Y).catch((b=>null===L||void 0===L?void 0:L(P??C.e.LastCreatedScene,null===b||void 0===b?void 0:b.message,b)))}static async ImportAnimationsAsync(b,d,P,G,W,i,q,C,J,L,x){return await l(b,d,P,G,W,i,C,L,x)}}N.NO_LOGGING=0,N.MINIMAL_LOGGING=1,N.SUMMARY_LOGGING=2,N.DETAILED_LOGGING=3,N.OnPluginActivatedObservable=t},13335:(b,d,P)=>{"use strict";P.d(d,{e:()=>s});var G=P(11663),W=P(11670),i=P(11484),q=P(11681),C=P(11707),J=P(11658),L=P(11639),x=P(11487),Y=P(11716);P(13341);class s extends C.b{set boundingBoxSize(b){if(this._boundingBoxSize&&this._boundingBoxSize.equals(b))return;this._boundingBoxSize=b;const d=this.Xb();d&&d.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(b){this._rotationY=b,this.setReflectionTextureMatrix(q.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(b,d,P){let G="";for(const W of b)G+=W;return new s(G,d,null,P,b)}static CreateFromPrefilteredData(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,G=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const W=d.useDelayedTextureLoading;d.useDelayedTextureLoading=!1;const i=new s(b,d,null,!1,null,null,null,void 0,!0,P,G);return d.useDelayedTextureLoading=W,i}constructor(b,d){var P;let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,W=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,s=arguments.length>8&&void 0!==arguments[8]&&arguments[8],E=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,w=arguments.length>10&&void 0!==arguments[10]&&arguments[10],t=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,r=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,B=arguments.length>13?arguments[13]:void 0,n=arguments.length>14?arguments[14]:void 0;super(d),this.onLoadObservable=new x.d,this.boundingBoxPosition=q.ed.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new q.Matrix,this._buffer=null,this.name=b,this.url=b,this._noMipmap=W,this.ad=!1,this.isCube=!0,this._textureMatrix=q.Matrix.Identity(),this.coordinatesMode=J.d.CUBIC_MODE;let Z=null,o=null;null===G||Array.isArray(G)?(this._noMipmap=W,this._format=Y,this._createPolynomials=w,Z=G,this._loaderOptions=B,this._useSRGBBuffer=n,this._lodScale=t,this._lodOffset=r):(Z=G.extensions??null,this._noMipmap=G.noMipmap??!1,i=G.files??null,o=G.buffer??null,this._format=G.format??5,s=G.prefiltered??!1,E=G.forcedExtension??null,this._createPolynomials=G.createPolynomials??!1,this._lodScale=G.lodScale??.8,this._lodOffset=G.lodOffset??0,this._loaderOptions=G.loaderOptions,this._useSRGBBuffer=G.useSRGBBuffer,C=G.h??null,L=G.onError??null),(b||i)&&this.updateURL(b,E,C,s,L,Z,null===(P=this.Xb())||void 0===P?void 0:P.useDelayedTextureLoading,i,o)}getClassName(){return"CubeTexture"}updateURL(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,G=arguments.length>3&&void 0!==arguments[3]&&arguments[3],W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=b),this.url=b,d&&(this._forcedExtension=d);const L=b.lastIndexOf("."),x=d||(L>-1?b.substring(L).toLowerCase():""),Y=0===x.indexOf(".dds"),s=0===x.indexOf(".env"),E=0===x.indexOf(".basis");if(s?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=G,G&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),C)this._files=C;else if(E||s||Y||i||(i=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,i){for(let d=0;d<i.length;d++)this._files.push(b+i[d]);this._extensions=i}this._buffer=J,q?(this.delayLoadState=4,this._delayedOnLoad=P,this._delayedOnError=W):this._loadTexture(P,W)}delayLoad(b){4===this.delayLoadState&&(b&&(this._forcedExtension=b),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(b){var d,P;if(b.updateFlag===this._textureMatrix.updateFlag)return;b.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(P=this.Xb())||void 0===P||P.markAllMaterialsAsDirty(1,(b=>-1!==b.getActiveTextures().indexOf(this))));if(this._textureMatrix=b,null===(d=this.Xb())||void 0===d||!d.useRightHandedSystem)return;const G=q.TmpVectors.ed[0],W=q.TmpVectors.Quaternion[0],i=q.TmpVectors.ed[1];this._textureMatrix.decompose(G,W,i),W.z*=-1,W.w*=-1,q.Matrix.ComposeToRef(G,W,i,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var b;return null!==(b=this.Xb())&&void 0!==b&&b.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=this.Xb(),G=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const W=()=>{var d;(this.onLoadObservable.notifyObservers(this),G)&&(G.dispose(),null===(d=this.Xb())||void 0===d||d.markAllMaterialsAsDirty(1));b&&b()},q=(b,P)=>{this._loadingError=!0,this._errorObject={message:b,exception:P},d&&d(b,P),J.d.OnTextureLoadErrorObservable.notifyObservers(this)};var C;this._texture?this._texture.isReady?i.Tools.SetImmediate((()=>W())):this._texture.onLoadedObservable.add((()=>W())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,P,this._lodScale,this._lodOffset,b,q,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,P,this._files,this._noMipmap,b,q,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(C=this._texture)||void 0===C||C.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(b,d,P){const G=Y.c.Parse((()=>{let G=!1;return b.prefiltered&&(G=b.prefiltered),new s(P+(b.url??b.name),d,b.extensions,!1,b.files||null,null,null,void 0,G,b.forcedExtension)}),b,d);if(b.boundingBoxPosition&&(G.boundingBoxPosition=q.ed.Od(b.boundingBoxPosition)),b.boundingBoxSize&&(G.boundingBoxSize=q.ed.Od(b.boundingBoxSize)),b.animations)for(let W=0;W<b.animations.length;W++){const d=b.animations[W],P=(0,L.d)("BABYLON.Animation");P&&G.animations.push(P.Parse(d))}return G}clone(){let b=0;const d=Y.c.Clone((()=>{const d=new s(this.url,this.Xb()||this._getEngine(),this._extensions,this._noMipmap,this._files);return b=d.uniqueId,d}),this);return d.uniqueId=b,d}}(0,G.d)([(0,W.G)()],s.prototype,"url",void 0),(0,G.d)([(0,W.F)()],s.prototype,"boundingBoxPosition",void 0),(0,G.d)([(0,W.F)()],s.prototype,"boundingBoxSize",null),(0,G.d)([(0,W.G)("rotationY")],s.prototype,"rotationY",null),(0,G.d)([(0,W.G)("files")],s.prototype,"_files",void 0),(0,G.d)([(0,W.G)("forcedExtension")],s.prototype,"_forcedExtension",void 0),(0,G.d)([(0,W.G)("extensions")],s.prototype,"_extensions",void 0),(0,G.d)([(0,W.v)("textureMatrix")],s.prototype,"_textureMatrix",void 0),(0,G.d)([(0,W.v)("textureMatrixRefraction")],s.prototype,"_textureMatrixRefraction",void 0),J.d._CubeTextureParser=s.Parse,(0,L.f)("BABYLON.CubeTexture",s)},13828:(b,d,P)=>{"use strict";P.d(d,{b:()=>J});var G=P(11504),W=P(11658),i=P(11647),q=P(11815),C=P(11619);q.ThinEngine.prototype.createDynamicTexture=function(b,d,P,G){const W=new C.e(this,4);return W.baseWidth=b,W.baseHeight=d,P&&(b=this.needPOTTextures?(0,i.c)(b,this._caps.maxTextureSize):b,d=this.needPOTTextures?(0,i.c)(d,this._caps.maxTextureSize):d),W.width=b,W.height=d,W.isReady=!1,W.generateMipMaps=P,W.samplingMode=G,this.updateTextureSamplingMode(G,W),this._internalTexturesCache.push(W),W},q.ThinEngine.prototype.updateDynamicTexture=function(b,d,P){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3],W=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!b)return;const q=this._gl,C=q.TEXTURE_2D,J=this._bindTextureDirectly(C,b,!0,i);this._unpackFlipY(void 0===P?b.invertY:P),G&&q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const L=this._getWebGLTextureType(b.type),x=this._getInternalFormat(W||b.format),Y=this._getRGBABufferInternalSizedFormat(b.type,x);q.texImage2D(C,0,Y,x,L,d),b.generateMipMaps&&q.generateMipmap(C),J||this._bindTextureDirectly(C,null),G&&q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),W&&(b.format=W),b._dynamicTextureSource=d,b._premulAlpha=G,b.invertY=P||!1,b.isReady=!0};class J extends W.d{constructor(b,d,P){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,C=arguments.length>6?arguments[6]:void 0;const J=!P||P._isScene;super(null,J?P:null===P||void 0===P?void 0:P.Hd,J?!G:P,C,i,void 0,void 0,void 0,void 0,q),this.name=b,this.wrapU=W.d.CLAMP_ADDRESSMODE,this.wrapV=W.d.CLAMP_ADDRESSMODE,this._generateMipMaps=G;const L=this._getEngine();if(!L)return;if(d.getContext)this._canvas=d,this._ownCanvas=!1,this._texture=L.createDynamicTexture(this._canvas.width,this._canvas.height,G,i);else{this._canvas=L.createCanvas(1,1),this._ownCanvas=!0;const b=d;b.width||0===b.width?this._texture=L.createDynamicTexture(b.width,b.height,G,i):this._texture=L.createDynamicTexture(d,d,G,i)}const x=this.getSize();this._canvas.width!==x.width&&(this._canvas.width=x.width),this._canvas.height!==x.height&&(this._canvas.height=x.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(b){this._canvas.width=b.width,this._canvas.height=b.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(b.width,b.height,this._generateMipMaps,this.samplingMode)}scale(b){const d=this.getSize();d.width*=b,d.height*=b,this._recreate(d)}scaleTo(b,d){const P=this.getSize();P.width=b,P.height=d,this._recreate(P)}getContext(){return this._context}clear(b){const d=this.getSize();b&&(this._context.fillStyle=b),this._context.clearRect(0,0,d.width,d.height)}update(b){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===b||b,d,this._format||void 0,void 0,P)}drawText(b,d,P,G,W,i,q){let C=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const J=this.getSize();if(i&&(this._context.fillStyle=i,this._context.fillRect(0,0,J.width,J.height)),this._context.font=G,null===d||void 0===d){const P=this._context.measureText(b);d=(J.width-P.width)/2}if(null===P||void 0===P){const b=parseInt(G.replace(/\D/g,""));P=J.height/2+b/3.65}this._context.fillStyle=W||"",this._context.fillText(b,d,P),C&&this.update(q)}dispose(){var b,d;(super.dispose(),this._ownCanvas)&&(null===(b=this._canvas)||void 0===b||null===(d=b.remove)||void 0===d||d.call(b));this._canvas=null,this._context=null}clone(){const b=this.Xb();if(!b)return this;const d=this.getSize(),P=new J(this.name,d,b,this._generateMipMaps);return P.ad=this.ad,P.level=this.level,P.wrapU=this.wrapU,P.wrapV=this.wrapV,P}serialize(){const b=this.Xb();b&&!b.isReady()&&G.e.Warn("The scene must be ready before serializing the dynamic texture");const d=super.serialize();return J._IsCanvasElement(this._canvas)&&(d.base64String=this._canvas.toDataURL()),d.invertY=this._invertY,d.samplingMode=this.samplingMode,d}static _IsCanvasElement(b){return void 0!==b.toDataURL}_rebuild(){this.update()}}},13244:(b,d,P)=>{"use strict";P.d(d,{c:()=>W});var G=P(11658);class W extends G.d{get depth(){return this._depth}constructor(b,d,P,W,i,q){let C=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],J=arguments.length>7&&void 0!==arguments[7]&&arguments[7],L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:G.d.TRILINEAR_SAMPLINGMODE,x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Y=arguments.length>10?arguments[10]:void 0;super(null,q,!C,J),this.format=i,this._texture=q.getEngine().createRawTexture2DArray(b,d,P,W,i,C,J,L,null,x,Y),this._depth=W,this.is2DArray=!0}update(b){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,b,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(b,d,P,G,i){return new W(b,d,P,G,5,i,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13057:(b,d,P)=>{"use strict";P.d(d,{c:()=>C,f:()=>J,h:()=>i,k:()=>q});var G=P(11700),W=P(11681);function i(b,d){return`{X: ${b.x.toFixed(d)} Y: ${b.y.toFixed(d)}}`}function q(b,d){return`{X: ${b._x.toFixed(d)} Y: ${b._y.toFixed(d)} Z: ${b._z.toFixed(d)}}`}function C(b,d){return 2*Math.acos((0,G.Clamp)(W.Quaternion.Dot(b,d)))}function J(b,d){const P=new W.Quaternion;return function(b,d,P){const i=W.ed.Cross(b,d),q=Math.acos((0,G.Clamp)(W.ed.Dot(b,d),-1,1));W.Quaternion.RotationAxisToRef(i,q,P)}(b,d,P),P}},12893:(b,d,P)=>{"use strict";P.d(d,{e:()=>L});var G=P(11681),W=P(11725),i=P(12134),q=P(12119),C=P(11741);P(12900);function J(b){let d=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const P=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],i=[];let J=[];const L=b.width||b.size||1,x=b.height||b.size||1,Y=b.depth||b.size||1,s=b.wrap||!1;let E=void 0===b.topBaseAt?1:b.topBaseAt,w=void 0===b.bottomBaseAt?0:b.bottomBaseAt;E=(E+4)%4,w=(w+4)%4;let t=[2,0,3,1][E],r=[2,0,1,3][w],B=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(s){d=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],B=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let b=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],P=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const G=[17,18,19,16],W=[22,23,20,21];for(;t>0;)b.unshift(b.pop()),G.unshift(G.pop()),t--;for(;r>0;)P.unshift(P.pop()),W.unshift(W.pop()),r--;b=b.flat(),P=P.flat(),B=B.concat(b).concat(P),d.push(G[0],G[2],G[3],G[0],G[1],G[2]),d.push(W[0],W[2],W[3],W[0],W[1],W[2])}const n=[L/2,x/2,Y/2];J=B.reduce(((b,d,P)=>b.concat(d*n[P%3])),[]);const Z=0===b.sideOrientation?0:b.sideOrientation||q.e.DEFAULTSIDE,o=b.faceUV||new Array(6),A=b.faceColors,f=[];for(let q=0;q<6;q++)void 0===o[q]&&(o[q]=new G.Vector4(0,0,1,1)),A&&void 0===A[q]&&(A[q]=new W.ci(1,1,1,1));for(let G=0;G<6;G++)if(i.push(o[G].z,C.e?1-o[G].w:o[G].w),i.push(o[G].x,C.e?1-o[G].w:o[G].w),i.push(o[G].x,C.e?1-o[G].y:o[G].y),i.push(o[G].z,C.e?1-o[G].y:o[G].y),A)for(let b=0;b<4;b++)f.push(A[G].r,A[G].g,A[G].b,A[G].a);q.e._ComputeSides(Z,J,d,P,i,b.frontUVs,b.backUVs);const g=new q.e;if(g.indices=d,g.Mb=J,g.eb=P,g.Ub=i,A){const b=Z===q.e.DOUBLESIDE?f.concat(f):f;g.Rb=b}return g}function L(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new i.d(b,P);d.sideOrientation=i.d._GetDefaultSideOrientation(d.sideOrientation),G._originalBuilderSideOrientation=d.sideOrientation;return J(d).pb(G,d.updatable),G}q.e.CreateBox=J,i.d.CreateBox=function(b,d){return L(b,{size:d,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13041:(b,d,P)=>{"use strict";P.d(d,{b:()=>C});var G=P(12134),W=P(12119),i=P(11741);function q(b){const d=[],P=[],G=[],q=[],C=b.radius||.5,J=b.tessellation||64,L=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1,x=0===b.sideOrientation?0:b.sideOrientation||W.e.DEFAULTSIDE;d.push(0,0,0),q.push(.5,.5);const Y=2*Math.PI*L,s=1===L?Y/J:Y/(J-1);let E=0;for(let W=0;W<J;W++){const b=Math.cos(E),P=Math.sin(E),G=(b+1)/2,W=(1-P)/2;d.push(C*b,C*P,0),q.push(G,i.e?1-W:W),E+=s}1===L&&(d.push(d[3],d[4],d[5]),q.push(q[2],i.e?1-q[3]:q[3]));const w=d.length/3;for(let W=1;W<w-1;W++)P.push(W+1,0,W);W.e.ComputeNormals(d,P,G),W.e._ComputeSides(x,d,P,G,q,b.frontUVs,b.backUVs);const t=new W.e;return t.indices=P,t.Mb=d,t.eb=G,t.Ub=q,t}function C(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=new G.d(b,P);d.sideOrientation=G.d._GetDefaultSideOrientation(d.sideOrientation),W._originalBuilderSideOrientation=d.sideOrientation;return q(d).pb(W,d.updatable),W}W.e.CreateDisc=q,G.d.CreateDisc=function(b,d,P){return C(b,{radius:d,tessellation:P,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12900:(b,d,P)=>{"use strict";P.d(d,{e:()=>r,d:()=>n,h:()=>B});var G=P(11681),W=P(11725),i=P(12134),q=P(12119),C=P(11752);i.d._GroundMeshParser=(b,d)=>J.Parse(b,d);class J extends i.d{constructor(b,d){super(b,d),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=b,this._subdivisionsY=b,this.subdivide(b);const P=this;P.createOrUpdateSubmeshesOctree&&P.createOrUpdateSubmeshesOctree(d)}getHeightAtCoordinates(b,d){const P=this.getWorldMatrix(),W=G.TmpVectors.Matrix[5];P.invertToRef(W);const i=G.TmpVectors.ed[8];if(G.ed.TransformCoordinatesFromFloatsToRef(b,0,d,W,i),b=i.x,d=i.z,b<this._minX||b>=this._maxX||d<=this._minZ||d>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const q=this._getFacetAt(b,d),C=-(q.x*b+q.z*d+q.w)/q.y;return G.ed.TransformCoordinatesFromFloatsToRef(0,C,0,P,i),i.y}getNormalAtCoordinates(b,d){const P=new G.ed(0,1,0);return this.getNormalAtCoordinatesToRef(b,d,P),P}getNormalAtCoordinatesToRef(b,d,P){const W=this.getWorldMatrix(),i=G.TmpVectors.Matrix[5];W.invertToRef(i);const q=G.TmpVectors.ed[8];if(G.ed.TransformCoordinatesFromFloatsToRef(b,0,d,i,q),b=q.x,d=q.z,b<this._minX||b>this._maxX||d<this._minZ||d>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const C=this._getFacetAt(b,d);return G.ed.TransformNormalFromFloatsToRef(C.x,C.y,C.z,W,P),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(b,d){const P=Math.floor((b+this._maxX)*this._subdivisionsX/this._width),G=Math.floor(-(d+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),W=this._heightQuads[G*this._subdivisionsX+P];let i;return i=d<W.slope.x*b+W.slope.y?W.facet1:W.facet2,i}_initHeightQuads(){const b=this._subdivisionsX,d=this._subdivisionsY;this._heightQuads=[];for(let P=0;P<d;P++)for(let d=0;d<b;d++){const W={slope:G.Vector2.Zero(),facet1:new G.Vector4(0,0,0,0),facet2:new G.Vector4(0,0,0,0)};this._heightQuads[P*b+d]=W}return this}_computeHeightQuads(){const b=this.getVerticesData(C.c.PositionKind);if(!b)return this;const d=G.TmpVectors.ed[3],P=G.TmpVectors.ed[2],W=G.TmpVectors.ed[1],i=G.TmpVectors.ed[0],q=G.TmpVectors.ed[4],J=G.TmpVectors.ed[5],L=G.TmpVectors.ed[6],x=G.TmpVectors.ed[7],Y=G.TmpVectors.ed[8];let s=0,E=0,w=0,t=0,r=0,B=0,n=0;const Z=this._subdivisionsX,o=this._subdivisionsY;for(let C=0;C<o;C++)for(let o=0;o<Z;o++){s=3*o,E=C*(Z+1)*3,w=(C+1)*(Z+1)*3,d.x=b[E+s],d.y=b[E+s+1],d.z=b[E+s+2],P.x=b[E+s+3],P.y=b[E+s+4],P.z=b[E+s+5],W.x=b[w+s],W.y=b[w+s+1],W.z=b[w+s+2],i.x=b[w+s+3],i.y=b[w+s+4],i.z=b[w+s+5],t=(i.z-d.z)/(i.x-d.x),r=d.z-t*d.x,P.subtractToRef(d,q),W.subtractToRef(d,J),i.subtractToRef(d,L),G.ed.CrossToRef(L,J,x),G.ed.CrossToRef(q,L,Y),x.normalize(),Y.normalize(),B=-(x.x*d.x+x.y*d.y+x.z*d.z),n=-(Y.x*P.x+Y.y*P.y+Y.z*P.z);const A=this._heightQuads[C*Z+o];A.slope.Fd(t,r),A.facet1.Fd(x.x,x.y,x.z,B),A.facet2.Fd(Y.x,Y.y,Y.z,n)}return this}serialize(b){super.serialize(b),b.subdivisionsX=this._subdivisionsX,b.subdivisionsY=this._subdivisionsY,b.minX=this._minX,b.maxX=this._maxX,b.Vd=this._minZ,b.maxZ=this._maxZ,b.width=this._width,b.height=this._height}static Parse(b,d){const P=new J(b.name,d);return P._subdivisionsX=b.subdivisionsX||1,P._subdivisionsY=b.subdivisionsY||1,P._minX=b.minX,P._maxX=b.maxX,P._minZ=b.Vd,P._maxZ=b.maxZ,P._width=b.width,P._height=b.height,P}}var L=P(11484),x=P(11535),Y=P(11688),s=P(11741);function E(b){const d=[],P=[],W=[],i=[];let C,J;const L=b.width||b.size||1,x=b.height||b.size||1,Y=0|(b.subdivisionsX||b.subdivisions||1),E=0|(b.subdivisionsY||b.subdivisions||1);for(C=0;C<=E;C++)for(J=0;J<=Y;J++){const b=new G.ed(J*L/Y-L/2,0,(E-C)*x/E-x/2),d=new G.ed(0,1,0);P.push(b.x,b.y,b.z),W.push(d.x,d.y,d.z),i.push(J/Y,s.e?C/E:1-C/E)}for(C=0;C<E;C++)for(J=0;J<Y;J++)d.push(J+1+(C+1)*(Y+1)),d.push(J+1+C*(Y+1)),d.push(J+C*(Y+1)),d.push(J+(C+1)*(Y+1)),d.push(J+1+(C+1)*(Y+1)),d.push(J+C*(Y+1));const w=new q.e;return w.indices=d,w.Mb=P,w.eb=W,w.Ub=i,w}function w(b){const d=void 0!==b.xmin&&null!==b.xmin?b.xmin:-1,P=void 0!==b.zmin&&null!==b.zmin?b.zmin:-1,W=void 0!==b.xmax&&null!==b.xmax?b.xmax:1,i=void 0!==b.zmax&&null!==b.zmax?b.zmax:1,C=b.subdivisions||{w:1,h:1},J=b.precision||{w:1,h:1},L=[],x=[],Y=[],s=[];let E,w,t,r;C.h=C.h<1?1:C.h,C.w=C.w<1?1:C.w,J.w=J.w<1?1:J.w,J.h=J.h<1?1:J.h;const B=(W-d)/C.w,n=(i-P)/C.h;function Z(b,d,P,W){const i=x.length/3,q=J.w+1;for(E=0;E<J.h;E++)for(w=0;w<J.w;w++){const b=[i+w+E*q,i+(w+1)+E*q,i+(w+1)+(E+1)*q,i+w+(E+1)*q];L.push(b[1]),L.push(b[2]),L.push(b[3]),L.push(b[0]),L.push(b[1]),L.push(b[3])}const C=G.ed.Zero(),t=new G.ed(0,1,0);for(E=0;E<=J.h;E++)for(C.z=E*(W-d)/J.h+d,w=0;w<=J.w;w++)C.x=w*(P-b)/J.w+b,C.y=0,x.push(C.x,C.y,C.z),Y.push(t.x,t.y,t.z),s.push(w/J.w,E/J.h)}for(t=0;t<C.h;t++)for(r=0;r<C.w;r++)Z(d+r*B,P+t*n,d+(r+1)*B,P+(t+1)*n);const o=new q.e;return o.indices=L,o.Mb=x,o.eb=Y,o.Ub=s,o}function t(b){const d=[],P=[],i=[],C=[];let J,L;const x=b.colorFilter||new W.Nd(.3,.59,.11),s=b.alphaFilter||0;let E=!1;if(b.minHeight>b.maxHeight){E=!0;const d=b.maxHeight;b.maxHeight=b.minHeight,b.minHeight=d}for(J=0;J<=b.subdivisions;J++)for(L=0;L<=b.subdivisions;L++){const d=new G.ed(L*b.width/b.subdivisions-b.width/2,0,(b.subdivisions-J)*b.height/b.subdivisions-b.height/2),W=4*(((d.x+b.width/2)/b.width*(b.bufferWidth-1)|0)+((1-(d.z+b.height/2)/b.height)*(b.bufferHeight-1)|0)*b.bufferWidth);let q=b.buffer[W]/255,w=b.buffer[W+1]/255,t=b.buffer[W+2]/255;const r=b.buffer[W+3]/255;E&&(q=1-q,w=1-w,t=1-t);const B=q*x.r+w*x.g+t*x.b;d.y=r>=s?b.minHeight+(b.maxHeight-b.minHeight)*B:b.minHeight-Y.c,b.heightBuffer&&(b.heightBuffer[J*(b.subdivisions+1)+L]=d.y),P.push(d.x,d.y,d.z),i.push(0,0,0),C.push(L/b.subdivisions,1-J/b.subdivisions)}for(J=0;J<b.subdivisions;J++)for(L=0;L<b.subdivisions;L++){const G=L+1+(J+1)*(b.subdivisions+1),W=L+1+J*(b.subdivisions+1),i=L+J*(b.subdivisions+1),q=L+(J+1)*(b.subdivisions+1),C=P[3*G+1]>=b.minHeight,x=P[3*W+1]>=b.minHeight,Y=P[3*i+1]>=b.minHeight;C&&x&&Y&&(d.push(G),d.push(W),d.push(i));P[3*q+1]>=b.minHeight&&C&&Y&&(d.push(q),d.push(G),d.push(i))}q.e.ComputeNormals(P,d,i);const w=new q.e;return w.indices=d,w.Mb=P,w.eb=i,w.Ub=C,w}function r(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const P=new J(b,arguments.length>2?arguments[2]:void 0);P._setReady(!1),P._subdivisionsX=d.subdivisionsX||d.subdivisions||1,P._subdivisionsY=d.subdivisionsY||d.subdivisions||1,P._width=d.width||1,P._height=d.height||1,P._maxX=P._width/2,P._maxZ=P._height/2,P._minX=-P._maxX,P._minZ=-P._maxZ;return E(d).pb(P,d.updatable),P._setReady(!0),P}function B(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new i.d(b,P);return w(d).pb(G,d.updatable),G}function n(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=P.width||10,q=P.height||10,C=P.subdivisions||1,Y=P.minHeight||0,s=P.maxHeight||1,E=P.colorFilter||new W.Nd(.3,.59,.11),w=P.alphaFilter||0,r=P.updatable,B=P.onReady;G=G||x.e.LastCreatedScene;const n=new J(b,G);let Z;n._subdivisionsX=C,n._subdivisionsY=C,n._width=i,n._height=q,n._maxX=n._width/2,n._maxZ=n._height/2,n._minX=-n._maxX,n._minZ=-n._maxZ,n._setReady(!1),P.passHeightBufferInCallback&&(Z=new Float32Array((C+1)*(C+1)));const o=(b,d,P)=>{t({width:i,height:q,subdivisions:C,minHeight:Y,maxHeight:s,colorFilter:E,buffer:b,bufferWidth:d,bufferHeight:P,alphaFilter:w,heightBuffer:Z}).pb(n,r),B&&B(n,Z),n._setReady(!0)};if("string"===typeof d){const b=b=>{var d;const P=b.width,W=b.height;if(G.L)return;const i=null===(d=G)||void 0===d?void 0:d.getEngine().resizeImageBitmap(b,P,W);o(i,P,W)};L.Tools.LoadImage(d,b,P.onError?P.onError:()=>{},G.offlineProvider)}else o(d.data,d.width,d.height);return n}q.e.CreateGround=E,q.e.CreateTiledGround=w,q.e.CreateGroundFromHeightMap=t,i.d.CreateGround=(b,d,P,G,W,i)=>r(b,{width:d,height:P,subdivisions:G,updatable:i},W),i.d.CreateTiledGround=(b,d,P,G,W,i,q,C,J)=>B(b,{xmin:d,zmin:P,xmax:G,zmax:W,subdivisions:i,precision:q,updatable:J},C),i.d.CreateGroundFromHeightMap=(b,d,P,G,W,i,q,C,J,L,x)=>n(b,d,{width:P,height:G,subdivisions:W,minHeight:i,maxHeight:q,updatable:J,onReady:L,alphaFilter:x},C)},13539:(b,d,P)=>{"use strict";P.d(d,{c:()=>E,g:()=>Y,k:()=>s});var G=P(11681),W=P(12134),i=P(12119),q=P(12227),C=P(11752),J=P(11504);function L(b){const d=[],P=[],G=b.lines,W=b.Rb,q=[];let C=0;for(let i=0;i<G.length;i++){const b=G[i];for(let G=0;G<b.length;G++){const{x:J,y:L,z:x}=b[G];if(P.push(J,L,x),W){const b=W[i],{r:d,g:P,b:C,a:J}=b[G];q.push(d,P,C,J)}G>0&&(d.push(C-1),d.push(C)),C++}}const J=new i.e;return J.indices=d,J.Mb=P,W&&(J.Rb=q),J}function x(b){const d=b.dashSize||3,P=b.gapSize||1,W=b.dashNb||200,q=b.points,C=[],J=[],L=G.ed.Zero();let x=0,Y=0,s=0,E=0,w=0,t=0,r=0;for(r=0;r<q.length-1;r++)q[r+1].subtractToRef(q[r],L),x+=L.length();for(s=x/W,E=d*s/(d+P),r=0;r<q.length-1;r++){q[r+1].subtractToRef(q[r],L),Y=Math.floor(L.length()/s),L.normalize();for(let b=0;b<Y;b++)w=s*b,C.push(q[r].x+w*L.x,q[r].y+w*L.y,q[r].z+w*L.z),C.push(q[r].x+(w+E)*L.x,q[r].y+(w+E)*L.y,q[r].z+(w+E)*L.z),J.push(t,t+1),t+=2}const B=new i.e;return B.Mb=C,B.indices=J,B}function Y(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=d.instance,W=d.lines,i=d.Rb;if(G){const b=G.getVerticesData(C.c.PositionKind);let d,P;i&&(d=G.getVerticesData(C.c.ColorKind));let q=0,J=0;for(let G=0;G<W.length;G++){const C=W[G];for(let W=0;W<C.length;W++)b[q]=C[W].x,b[q+1]=C[W].y,b[q+2]=C[W].z,i&&d&&(P=i[G],d[J]=P[W].r,d[J+1]=P[W].g,d[J+2]=P[W].b,d[J+3]=P[W].a,J+=4),q+=3}return G.updateVerticesData(C.c.PositionKind,b,!1,!1),i&&d&&G.updateVerticesData(C.c.ColorKind,d,!1,!1),G.refreshBoundingInfo(),G}const J=!!i,x=new q.c(b,P,null,void 0,void 0,J,d.useVertexAlpha,d.material);return L(d).pb(x,d.updatable),x}function s(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=d.Rb?[d.Rb]:null;return Y(b,{lines:[d.points],updatable:d.updatable,instance:d.instance,Rb:G,useVertexAlpha:d.useVertexAlpha,material:d.material},P)}function E(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=d.points,C=d.instance,L=d.gapSize||1,Y=d.dashSize||3;if(C){const b=b=>{const d=G.ed.Zero(),P=b.length/6;let W=0,q=0,J=0,L=0,x=0,Y=0,s=0,E=0;for(s=0;s<i.length-1;s++)i[s+1].subtractToRef(i[s],d),W+=d.length();J=W/P;const w=C._creationDataStorage.dashSize;for(L=w*J/(w+C._creationDataStorage.gapSize),s=0;s<i.length-1;s++)for(i[s+1].subtractToRef(i[s],d),q=Math.floor(d.length()/J),d.normalize(),E=0;E<q&&Y<b.length;)x=J*E,b[Y]=i[s].x+x*d.x,b[Y+1]=i[s].y+x*d.y,b[Y+2]=i[s].z+x*d.z,b[Y+3]=i[s].x+(x+L)*d.x,b[Y+4]=i[s].y+(x+L)*d.y,b[Y+5]=i[s].z+(x+L)*d.z,Y+=6,E++;for(;Y<b.length;)b[Y]=i[s].x,b[Y+1]=i[s].y,b[Y+2]=i[s].z,Y+=3};return(d.dashNb||d.dashSize||d.gapSize||d.useVertexAlpha||d.material)&&J.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),C.updateMeshPositions(b,!1),C}const s=new q.c(b,P,null,void 0,void 0,void 0,d.useVertexAlpha,d.material);return x(d).pb(s,d.updatable),s._creationDataStorage=new W.g,s._creationDataStorage.dashSize=Y,s._creationDataStorage.gapSize=L,s}i.e.CreateLineSystem=L,i.e.CreateDashedLines=x,W.d.sL=function(b,d){return s(b,{points:d,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},W.d.CreateDashedLines=function(b,d,P,G,W){return E(b,{points:d,dashSize:P,gapSize:G,dashNb:W,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12943:(b,d,P)=>{"use strict";P.d(d,{c:()=>C,f:()=>J});var G=P(12134),W=P(12119),i=P(11741);function q(b){const d=[],P=[],G=[],q=[],C=void 0!==b.width?b.width:void 0!==b.size?b.size:1,J=void 0!==b.height?b.height:void 0!==b.size?b.size:1,L=0===b.sideOrientation?0:b.sideOrientation||W.e.DEFAULTSIDE,x=C/2,Y=J/2;P.push(-x,-Y,0),G.push(0,0,-1),q.push(0,i.e?1:0),P.push(x,-Y,0),G.push(0,0,-1),q.push(1,i.e?1:0),P.push(x,Y,0),G.push(0,0,-1),q.push(1,i.e?0:1),P.push(-x,Y,0),G.push(0,0,-1),q.push(0,i.e?0:1),d.push(0),d.push(1),d.push(2),d.push(0),d.push(2),d.push(3),W.e._ComputeSides(L,P,d,G,q,b.frontUVs,b.backUVs);const s=new W.e;return s.indices=d,s.Mb=P,s.eb=G,s.Ub=q,s}function C(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const W=new G.d(b,P);d.sideOrientation=G.d._GetDefaultSideOrientation(d.sideOrientation),W._originalBuilderSideOrientation=d.sideOrientation;return q(d).pb(W,d.updatable),d.sourcePlane&&(W.translate(d.sourcePlane.normal,-d.sourcePlane.d),W.setDirection(d.sourcePlane.normal.scale(-1))),W}const J={tL:C};W.e.tL=q,G.d.tL=(b,d,P,G,W)=>C(b,{size:d,width:d,height:d,sideOrientation:W,updatable:G},P)},13026:(b,d,P)=>{"use strict";P.d(d,{c:()=>J});var G=P(11681),W=P(12134),i=P(12119),q=P(11741);function C(b){const d=0|(b.segments||32),P=b.diameterX||b.diameter||1,W=b.diameterY||b.diameter||1,C=b.diameterZ||b.diameter||1,J=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1,L=b.slice&&b.slice<=0?1:b.slice||1,x=0===b.sideOrientation?0:b.sideOrientation||i.e.DEFAULTSIDE,Y=!!b.dedupTopBottomIndices,s=new G.ed(P/2,W/2,C/2),E=2+d,w=2*E,t=[],r=[],B=[],n=[];for(let i=0;i<=E;i++){const b=i/E,d=b*Math.PI*L;for(let P=0;P<=w;P++){const W=P/w,i=W*Math.PI*2*J,C=G.Matrix.RotationZ(-d),L=G.Matrix.RotationY(i),x=G.ed.TransformCoordinates(G.ed.Up(),C),Y=G.ed.TransformCoordinates(x,L),E=Y.multiply(s),t=Y.divide(s).normalize();r.push(E.x,E.y,E.z),B.push(t.x,t.y,t.z),n.push(W,q.e?1-b:b)}if(i>0){const b=r.length/3;for(let d=b-2*(w+1);d+w+2<b;d++)Y?(i>1&&(t.push(d),t.push(d+1),t.push(d+w+1)),(i<E||L<1)&&(t.push(d+w+1),t.push(d+1),t.push(d+w+2))):(t.push(d),t.push(d+1),t.push(d+w+1),t.push(d+w+1),t.push(d+1),t.push(d+w+2))}}i.e._ComputeSides(x,r,t,B,n,b.frontUVs,b.backUVs);const Z=new i.e;return Z.indices=t,Z.Mb=r,Z.eb=B,Z.Ub=n,Z}function J(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new W.d(b,P);d.sideOrientation=W.d._GetDefaultSideOrientation(d.sideOrientation),G._originalBuilderSideOrientation=d.sideOrientation;return C(d).pb(G,d.updatable),G}i.e.CreateSphere=C,W.d.CreateSphere=(b,d,P,G,W,i)=>J(b,{segments:d,diameterX:P,diameterY:P,diameterZ:P,sideOrientation:i,updatable:W},G)},13842:(b,d,P)=>{"use strict";P.d(d,{b:()=>C});var G=P(12254),W=P(13343),i=P(12269),q=P(12119);class C{static get Configuration(){return{get decoder(){return W.e.DefaultConfiguration},set decoder(b){W.e.DefaultConfiguration=b}}}static set Configuration(b){W.e.DefaultConfiguration=b.decoder}static get DecoderAvailable(){return(0,G.g)(W.e.DefaultConfiguration)}static get Default(){return C._Default??(C._Default=new C),C._Default}static ResetDefault(b){C._Default&&(b||C._Default.dispose(),C._Default=null)}constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.DefaultNumWorkers;const d="number"===typeof b?{...W.e.DefaultConfiguration,numWorkers:b}:{...W.e.DefaultConfiguration,...b};this._decoder=new W.e(d)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(b,d,P){return this._decoder.decodeMeshToMeshDataAsync(b,d,P)}async decodeMeshToGeometryAsync(b,d,P,G){return await this._decoder.decodeMeshToGeometryAsync(b,d,P,G)}async _decodeMeshToGeometryForGltfAsync(b,d,P,G,W,i){return await this._decoder._decodeMeshToGeometryForGltfAsync(b,d,P,G,W,i)}async decodeMeshAsync(b,d){const P=await this._decoder.decodeMeshToMeshDataAsync(b,d),G=new q.e;P.indices&&(G.indices=P.indices);for(const W of P.attributes){const b=i.c.GetFloatData(W.data,W.size,i.c.GetDataType(W.data),W.byteOffset,W.byteStride,W.normalized,P.totalVertices);G.set(b,W.kind)}return G}}C.DefaultNumWorkers=(0,G.c)(),C._Default=null},13343:(b,d,P)=>{"use strict";P.d(d,{e:()=>L});var G=P(12254),W=P(11484),i=P(12141),q=P(12269),C=P(11504),J=P(12266);class L extends G.b{static get DefaultAvailable(){return(0,G.g)(L.DefaultConfiguration)}static get Default(){return L._Default??(L._Default=new L),L._Default}static ResetDefault(b){L._Default&&(b||L._Default.dispose(),L._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(b,d){return{module:await(d||DracoDecoderModule)({wasmBinary:b})}}_getWorkerContent(){return`${J.e}(${J.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:L.DefaultConfiguration)}decodeMeshToMeshDataAsync(b,d,P){const G=b instanceof ArrayBuffer?new Int8Array(b):new Int8Array(b.buffer,b.byteOffset,b.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async b=>await new Promise(((W,i)=>{b.push(((b,q)=>{let J=null;const L=[],x=d=>{b.removeEventListener("error",x),b.removeEventListener("message",Y),i(d),q()},Y=d=>{const G=d.data;switch(G.id){case"indices":J=G.data;break;case"attribute":L.push({kind:G.kind,data:G.data,size:G.size,byteOffset:G.byteOffset,byteStride:G.byteStride,normalized:(i=G.kind,s=G.normalized,P&&void 0!==P[i]?(s!==P[i]&&C.e.Warn(`Normalized flag from Draco data (${s}) does not match normalized flag from glTF accessor (${P[i]}). Using flag from glTF accessor.`),P[i]):s)});break;case"decodeMeshDone":b.removeEventListener("error",x),b.removeEventListener("message",Y),W({indices:J,attributes:L,totalVertices:G.totalVertices}),q()}var i,s};b.addEventListener("error",x),b.addEventListener("message",Y);const s=G.slice();b.postMessage({id:"decodeMesh",dataView:s,attributes:d},[s.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((b=>{let P=null;const W=[],i=(0,J.e)(b.module,G,d,(b=>{P=b}),((b,d,P,G,i,q)=>{W.push({kind:b,data:d,size:P,byteOffset:G,byteStride:i,normalized:q})}));return{indices:P,attributes:W,totalVertices:i}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(b,d,P,G){const W=await this.decodeMeshToMeshDataAsync(P,G),C=new i.d(b,d);W.indices&&C.setIndices(W.indices);for(const i of W.attributes)C.setVerticesBuffer(new q.c(d.getEngine(),i.data,i.kind,!1,void 0,i.byteStride,void 0,i.byteOffset,i.size,void 0,i.normalized,!0),W.totalVertices);return C}async _decodeMeshToGeometryForGltfAsync(b,d,P,G,W,C){const J=await this.decodeMeshToMeshDataAsync(P,G,W),L=new i.d(b,d);C&&(L._boundingInfo=C,L.useBoundingInfoFromGeometry=!0),J.indices&&L.setIndices(J.indices);for(const i of J.attributes)L.setVerticesBuffer(new q.c(d.getEngine(),i.data,i.kind,!1,void 0,i.byteStride,void 0,i.byteOffset,i.size,void 0,i.normalized,!0),J.totalVertices);return L}}L.DefaultConfiguration={wasmUrl:`${W.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${W.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${W.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},L._Default=null},13530:(b,d,P)=>{"use strict";P.d(d,{b:()=>Cb});var G=P(11681),W=P(12134),i=P(11752),q=P(12119),C=P(11741);function J(b){let d=b.pathArray;const P=b.closeArray||!1,G=b.closePath||!1,W=b.invertUV||!1,J=Math.floor(d[0].length/2);let L=b.offset||J;L=L>J?J:Math.floor(L);const x=0===b.sideOrientation?0:b.sideOrientation||q.e.DEFAULTSIDE,Y=b.Ub,s=b.Rb,E=[],w=[],t=[],r=[],B=[],n=[],Z=[],o=[];let A;const f=[],g=[];let X,u,M;if(d.length<2){const b=[],P=[];for(u=0;u<d[0].length-L;u++)b.push(d[0][u]),P.push(d[0][u+L]);d=[b,P]}let e=0;const R=G?1:0,U=P?1:0;let H,p,S,l,N,j;for(A=d[0].length,X=0;X<d.length+U;X++){for(Z[X]=0,B[X]=[0],H=X===d.length?d[0]:d[X],p=H.length,A=A<p?A:p,M=0;M<p;)E.push(H[M].x,H[M].y,H[M].z),M>0&&(S=H[M].Rd(H[M-1]).length(),l=S+Z[X],B[X].push(l),Z[X]=l),M++;G&&(M--,E.push(H[0].x,H[0].y,H[0].z),S=H[M].Rd(H[0]).length(),l=S+Z[X],B[X].push(l),Z[X]=l),f[X]=p+R,g[X]=e,e+=p+R}let a,O,V=null,y=null;for(u=0;u<A+R;u++)for(o[u]=0,n[u]=[0],X=0;X<d.length-1+U;X++)N=d[X],j=X===d.length-1?d[0]:d[X+1],u===A?(V=N[0],y=j[0]):(V=N[u],y=j[u]),S=y.Rd(V).length(),l=S+o[u],n[u].push(l),o[u]=l;if(Y)for(X=0;X<Y.length;X++)r.push(Y[X].x,C.e?1-Y[X].y:Y[X].y);else for(X=0;X<d.length+U;X++)for(u=0;u<A+R;u++)a=0!=Z[X]?B[X][u]/Z[X]:0,O=0!=o[u]?n[u][X]/o[u]:0,W?r.push(O,a):r.push(a,C.e?1-O:O);X=0;let c=0,D=f[X]-1,z=f[X+1]-1,Q=D<z?D:z,I=g[1]-g[0];const m=f.length-1;for(;c<=Q&&X<m;)w.push(c,c+I,c+1),w.push(c+I+1,c+1,c+I),c+=1,c===Q&&(X++,I=g[X+1]-g[X],D=f[X]-1,z=f[X+1]-1,c=g[X],Q=D<z?D+c:z+c);if(q.e.ComputeNormals(E,w,t),G){let b=0,P=0;for(X=0;X<d.length;X++){b=3*g[X],P=X+1<d.length?3*(g[X+1]-1):t.length-3,t[b]=.5*(t[b]+t[P]),t[b+1]=.5*(t[b+1]+t[P+1]),t[b+2]=.5*(t[b+2]+t[P+2]);const G=Math.sqrt(t[b]*t[b]+t[b+1]*t[b+1]+t[b+2]*t[b+2]);t[b]/=G,t[b+1]/=G,t[b+2]/=G,t[P]=t[b],t[P+1]=t[b+1],t[P+2]=t[b+2]}}if(P){let b=3*g[0],P=3*g[d.length];for(u=0;u<A+R;u++){t[b]=.5*(t[b]+t[P]),t[b+1]=.5*(t[b+1]+t[P+1]),t[b+2]=.5*(t[b+2]+t[P+2]);const d=Math.sqrt(t[b]*t[b]+t[b+1]*t[b+1]+t[b+2]*t[b+2]);t[b]/=d,t[b+1]/=d,t[b+2]/=d,t[P]=t[b],t[P+1]=t[b+1],t[P+2]=t[b+2],b+=3,P+=3}}q.e._ComputeSides(x,E,w,t,r,b.frontUVs,b.backUVs);let v=null;if(s){v=new Float32Array(4*s.length);for(let b=0;b<s.length;b++)v[4*b]=s[b].r,v[4*b+1]=s[b].g,v[4*b+2]=s[b].b,v[4*b+3]=s[b].a}const F=new q.e,h=new Float32Array(E),T=new Float32Array(t),K=new Float32Array(r);return F.indices=w,F.Mb=h,F.eb=T,F.Ub=K,v&&F.set(v,i.c.ColorKind),G&&(F._idx=g),F}function L(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=d.pathArray,x=d.closeArray,Y=d.closePath,s=W.d._GetDefaultSideOrientation(d.sideOrientation),E=d.instance,w=d.updatable;if(E){const b=G.TmpVectors.ed[0].kd(Number.MAX_VALUE),P=G.TmpVectors.ed[1].kd(-Number.MAX_VALUE),J=d=>{let G=L[0].length;const i=E;let q=0;const C=i._originalBuilderSideOrientation===W.d.DOUBLESIDE?2:1;for(let W=1;W<=C;++W)for(let C=0;C<L.length;++C){const W=L[C],J=W.length;G=G<J?G:J;for(let i=0;i<G;++i){const G=W[i];d[q]=G.x,d[q+1]=G.y,d[q+2]=G.z,b.minimizeInPlaceFromFloats(G.x,G.y,G.z),P.maximizeInPlaceFromFloats(G.x,G.y,G.z),q+=3}if(i._creationDataStorage&&i._creationDataStorage.closePath){const b=W[0];d[q]=b.x,d[q+1]=b.y,d[q+2]=b.z,q+=3}}},x=E.getVerticesData(i.c.PositionKind);if(J(x),E.hasBoundingInfo?E.getBoundingInfo().reConstruct(b,P,E._worldMatrix):E.buildBoundingInfo(b,P,E._worldMatrix),E.updateVerticesData(i.c.PositionKind,x,!1,!1),d.Rb){const b=E.getVerticesData(i.c.ColorKind);for(let P=0,G=0;P<d.Rb.length;P++,G+=4){const W=d.Rb[P];b[G]=W.r,b[G+1]=W.g,b[G+2]=W.b,b[G+3]=W.a}E.updateVerticesData(i.c.ColorKind,b,!1,!1)}if(d.Ub){const b=E.getVerticesData(i.c.UVKind);for(let P=0;P<d.Ub.length;P++)b[2*P]=d.Ub[P].x,b[2*P+1]=C.e?1-d.Ub[P].y:d.Ub[P].y;E.updateVerticesData(i.c.UVKind,b,!1,!1)}if(!E.areNormalsFrozen||E.isFacetDataEnabled){const b=E.Id(),d=E.getVerticesData(i.c.NormalKind),P=E.isFacetDataEnabled?E.getFacetDataParameters():null;if(q.e.ComputeNormals(x,b,d,P),E._creationDataStorage&&E._creationDataStorage.closePath){let b=0,P=0;for(let G=0;G<L.length;G++)b=3*E._creationDataStorage.idx[G],P=G+1<L.length?3*(E._creationDataStorage.idx[G+1]-1):d.length-3,d[b]=.5*(d[b]+d[P]),d[b+1]=.5*(d[b+1]+d[P+1]),d[b+2]=.5*(d[b+2]+d[P+2]),d[P]=d[b],d[P+1]=d[b+1],d[P+2]=d[b+2]}E.areNormalsFrozen||E.updateVerticesData(i.c.NormalKind,d,!1,!1)}return E}{const G=new W.d(b,P);G._originalBuilderSideOrientation=s,G._creationDataStorage=new W.g;const i=J(d);return Y&&(G._creationDataStorage.idx=i._idx),G._creationDataStorage.closePath=Y,G._creationDataStorage.closeArray=x,i.pb(G,w),G}}q.e.CreateRibbon=J,W.d.CreateRibbon=function(b,d){return L(b,{pathArray:d,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var x=P(13041),Y=P(12893),s=P(11725);function E(b){const d=b.pattern||W.d.NO_FLIP,P=b.tileWidth||b.tileSize||1,G=b.tileHeight||b.tileSize||1,i=b.alignHorizontal||0,C=b.alignVertical||0,J=b.width||b.size||1,L=Math.floor(J/P);let x=J-L*P;const Y=b.height||b.size||1,s=Math.floor(Y/G);let E=Y-s*G;const w=P*L/2,t=G*s/2;let r=0,B=0,n=0,Z=0,o=0,A=0;if(x>0||E>0){switch(n=-w,Z=-t,o=w,A=t,i){case W.d.CENTER:x/=2,n-=x,o+=x;break;case W.d.LEFT:o+=x,r=-x/2;break;case W.d.RIGHT:n-=x,r=x/2}switch(C){case W.d.CENTER:E/=2,Z-=E,A+=E;break;case W.d.BOTTOM:A+=E,B=-E/2;break;case W.d.TOP:Z-=E,B=E/2}}const f=[],g=[],X=[];X[0]=[0,0,1,0,1,1,0,1],X[1]=[0,0,1,0,1,1,0,1],d!==W.d.ROTATE_TILE&&d!==W.d.ROTATE_ROW||(X[1]=[1,1,0,1,0,0,1,0]),d!==W.d.FLIP_TILE&&d!==W.d.FLIP_ROW||(X[1]=[1,0,0,0,0,1,1,1]),d!==W.d.FLIP_N_ROTATE_TILE&&d!==W.d.FLIP_N_ROTATE_ROW||(X[1]=[0,1,1,1,1,0,0,0]);let u=[];const M=[],e=[];let R=0;for(let q=0;q<s;q++)for(let b=0;b<L;b++)f.push(b*P-w+r,q*G-t+B,0),f.push((b+1)*P-w+r,q*G-t+B,0),f.push((b+1)*P-w+r,(q+1)*G-t+B,0),f.push(b*P-w+r,(q+1)*G-t+B,0),e.push(R,R+1,R+3,R+1,R+2,R+3),u=d===W.d.FLIP_TILE||d===W.d.ROTATE_TILE||d===W.d.FLIP_N_ROTATE_TILE?u.concat(X[(b%2+q%2)%2]):d===W.d.FLIP_ROW||d===W.d.ROTATE_ROW||d===W.d.FLIP_N_ROTATE_ROW?u.concat(X[q%2]):u.concat(X[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),R+=4;if(x>0||E>0){const b=E>0&&(C===W.d.CENTER||C===W.d.TOP),q=E>0&&(C===W.d.CENTER||C===W.d.BOTTOM),J=x>0&&(i===W.d.CENTER||i===W.d.RIGHT),Y=x>0&&(i===W.d.CENTER||i===W.d.LEFT);let X,U,H,p,S=[];if(b&&J&&(f.push(n+r,Z+B,0),f.push(-w+r,Z+B,0),f.push(-w+r,Z+E+B,0),f.push(n+r,Z+E+B,0),e.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,X=1-x/P,U=1-E/G,H=1,p=1,S=[X,U,H,U,H,p,X,p],d===W.d.ROTATE_ROW&&(S=[1-X,1-U,1-H,1-U,1-H,1-p,1-X,1-p]),d===W.d.FLIP_ROW&&(S=[1-X,U,1-H,U,1-H,p,1-X,p]),d===W.d.FLIP_N_ROTATE_ROW&&(S=[X,1-U,H,1-U,H,1-p,X,1-p]),u=u.concat(S),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),b&&Y&&(f.push(w+r,Z+B,0),f.push(o+r,Z+B,0),f.push(o+r,Z+E+B,0),f.push(w+r,Z+E+B,0),e.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,X=0,U=1-E/G,H=x/P,p=1,S=[X,U,H,U,H,p,X,p],(d===W.d.ROTATE_ROW||d===W.d.ROTATE_TILE&&L%2===0)&&(S=[1-X,1-U,1-H,1-U,1-H,1-p,1-X,1-p]),(d===W.d.FLIP_ROW||d===W.d.FLIP_TILE&&L%2===0)&&(S=[1-X,U,1-H,U,1-H,p,1-X,p]),(d===W.d.FLIP_N_ROTATE_ROW||d===W.d.FLIP_N_ROTATE_TILE&&L%2===0)&&(S=[X,1-U,H,1-U,H,1-p,X,1-p]),u=u.concat(S),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&J&&(f.push(n+r,t+B,0),f.push(-w+r,t+B,0),f.push(-w+r,A+B,0),f.push(n+r,A+B,0),e.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,X=1-x/P,U=0,H=1,p=E/G,S=[X,U,H,U,H,p,X,p],(d===W.d.ROTATE_ROW&&s%2===1||d===W.d.ROTATE_TILE&&s%1===0)&&(S=[1-X,1-U,1-H,1-U,1-H,1-p,1-X,1-p]),(d===W.d.FLIP_ROW&&s%2===1||d===W.d.FLIP_TILE&&s%2===0)&&(S=[1-X,U,1-H,U,1-H,p,1-X,p]),(d===W.d.FLIP_N_ROTATE_ROW&&s%2===1||d===W.d.FLIP_N_ROTATE_TILE&&s%2===0)&&(S=[X,1-U,H,1-U,H,1-p,X,1-p]),u=u.concat(S),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),q&&Y&&(f.push(w+r,t+B,0),f.push(o+r,t+B,0),f.push(o+r,A+B,0),f.push(w+r,A+B,0),e.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,X=0,U=0,H=x/P,p=E/G,S=[X,U,H,U,H,p,X,p],(d===W.d.ROTATE_ROW&&s%2===1||d===W.d.ROTATE_TILE&&(s+L)%2===1)&&(S=[1-X,1-U,1-H,1-U,1-H,1-p,1-X,1-p]),(d===W.d.FLIP_ROW&&s%2===1||d===W.d.FLIP_TILE&&(s+L)%2===1)&&(S=[1-X,U,1-H,U,1-H,p,1-X,p]),(d===W.d.FLIP_N_ROTATE_ROW&&s%2===1||d===W.d.FLIP_N_ROTATE_TILE&&(s+L)%2===1)&&(S=[X,1-U,H,1-U,H,1-p,X,1-p]),u=u.concat(S),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),b){const b=[];X=0,U=1-E/G,H=1,p=1,b[0]=[X,U,H,U,H,p,X,p],b[1]=[X,U,H,U,H,p,X,p],d!==W.d.ROTATE_TILE&&d!==W.d.ROTATE_ROW||(b[1]=[1-X,1-U,1-H,1-U,1-H,1-p,1-X,1-p]),d!==W.d.FLIP_TILE&&d!==W.d.FLIP_ROW||(b[1]=[1-X,U,1-H,U,1-H,p,1-X,p]),d!==W.d.FLIP_N_ROTATE_TILE&&d!==W.d.FLIP_N_ROTATE_ROW||(b[1]=[X,1-U,H,1-U,H,1-p,X,1-p]);for(let G=0;G<L;G++)f.push(G*P-w+r,Z+B,0),f.push((G+1)*P-w+r,Z+B,0),f.push((G+1)*P-w+r,Z+E+B,0),f.push(G*P-w+r,Z+E+B,0),e.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,u=d===W.d.FLIP_TILE||d===W.d.ROTATE_TILE||d===W.d.FLIP_N_ROTATE_TILE?u.concat(b[(G+1)%2]):d===W.d.FLIP_ROW||d===W.d.ROTATE_ROW||d===W.d.FLIP_N_ROTATE_ROW?u.concat(b[1]):u.concat(b[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(q){const b=[];X=0,U=0,H=1,p=E/G,b[0]=[X,U,H,U,H,p,X,p],b[1]=[X,U,H,U,H,p,X,p],d!==W.d.ROTATE_TILE&&d!==W.d.ROTATE_ROW||(b[1]=[1-X,1-U,1-H,1-U,1-H,1-p,1-X,1-p]),d!==W.d.FLIP_TILE&&d!==W.d.FLIP_ROW||(b[1]=[1-X,U,1-H,U,1-H,p,1-X,p]),d!==W.d.FLIP_N_ROTATE_TILE&&d!==W.d.FLIP_N_ROTATE_ROW||(b[1]=[X,1-U,H,1-U,H,1-p,X,1-p]);for(let G=0;G<L;G++)f.push(G*P-w+r,A-E+B,0),f.push((G+1)*P-w+r,A-E+B,0),f.push((G+1)*P-w+r,A+B,0),f.push(G*P-w+r,A+B,0),e.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,u=d===W.d.FLIP_TILE||d===W.d.ROTATE_TILE||d===W.d.FLIP_N_ROTATE_TILE?u.concat(b[(G+s)%2]):d===W.d.FLIP_ROW||d===W.d.ROTATE_ROW||d===W.d.FLIP_N_ROTATE_ROW?u.concat(b[s%2]):u.concat(b[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(J){const b=[];X=1-x/P,U=0,H=1,p=1,b[0]=[X,U,H,U,H,p,X,p],b[1]=[X,U,H,U,H,p,X,p],d!==W.d.ROTATE_TILE&&d!==W.d.ROTATE_ROW||(b[1]=[1-X,1-U,1-H,1-U,1-H,1-p,1-X,1-p]),d!==W.d.FLIP_TILE&&d!==W.d.FLIP_ROW||(b[1]=[1-X,U,1-H,U,1-H,p,1-X,p]),d!==W.d.FLIP_N_ROTATE_TILE&&d!==W.d.FLIP_N_ROTATE_ROW||(b[1]=[X,1-U,H,1-U,H,1-p,X,1-p]);for(let P=0;P<s;P++)f.push(n+r,P*G-t+B,0),f.push(n+x+r,P*G-t+B,0),f.push(n+x+r,(P+1)*G-t+B,0),f.push(n+r,(P+1)*G-t+B,0),e.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,u=d===W.d.FLIP_TILE||d===W.d.ROTATE_TILE||d===W.d.FLIP_N_ROTATE_TILE?u.concat(b[(P+1)%2]):d===W.d.FLIP_ROW||d===W.d.ROTATE_ROW||d===W.d.FLIP_N_ROTATE_ROW?u.concat(b[P%2]):u.concat(b[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Y){const b=[];X=0,U=0,H=x/G,p=1,b[0]=[X,U,H,U,H,p,X,p],b[1]=[X,U,H,U,H,p,X,p],d!==W.d.ROTATE_TILE&&d!==W.d.ROTATE_ROW||(b[1]=[1-X,1-U,1-H,1-U,1-H,1-p,1-X,1-p]),d!==W.d.FLIP_TILE&&d!==W.d.FLIP_ROW||(b[1]=[1-X,U,1-H,U,1-H,p,1-X,p]),d!==W.d.FLIP_N_ROTATE_TILE&&d!==W.d.FLIP_N_ROTATE_ROW||(b[1]=[X,1-U,H,1-U,H,1-p,X,1-p]);for(let P=0;P<s;P++)f.push(o-x+r,P*G-t+B,0),f.push(o+r,P*G-t+B,0),f.push(o+r,(P+1)*G-t+B,0),f.push(o-x+r,(P+1)*G-t+B,0),e.push(R,R+1,R+3,R+1,R+2,R+3),R+=4,u=d===W.d.FLIP_TILE||d===W.d.ROTATE_TILE||d===W.d.FLIP_N_ROTATE_TILE?u.concat(b[(P+L)%2]):d===W.d.FLIP_ROW||d===W.d.ROTATE_ROW||d===W.d.FLIP_N_ROTATE_ROW?u.concat(b[P%2]):u.concat(b[0]),M.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),g.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const U=0===b.sideOrientation?0:b.sideOrientation||q.e.DEFAULTSIDE;q.e._ComputeSides(U,f,e,g,u,b.frontUVs,b.backUVs);const H=new q.e;H.indices=e,H.Mb=f,H.eb=g,H.Ub=u;const p=U===q.e.DOUBLESIDE?M.concat(M):M;return H.Rb=p,H}function w(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new W.d(b,P);d.sideOrientation=W.d._GetDefaultSideOrientation(d.sideOrientation),G._originalBuilderSideOrientation=d.sideOrientation;return E(d).pb(G,d.updatable),G}function t(b){const d=b.faceUV||new Array(6),P=b.faceColors,i=b.pattern||W.d.NO_FLIP,J=b.width||b.size||1,L=b.height||b.size||1,x=b.depth||b.size||1,Y=b.tileWidth||b.tileSize||1,w=b.tileHeight||b.tileSize||1,t=b.alignHorizontal||0,r=b.alignVertical||0,B=0===b.sideOrientation?0:b.sideOrientation||q.e.DEFAULTSIDE;for(let W=0;W<6;W++)void 0===d[W]&&(d[W]=new G.Vector4(0,0,1,1)),P&&void 0===P[W]&&(P[W]=new s.ci(1,1,1,1));const n=J/2,Z=L/2,o=x/2,A=[];for(let G=0;G<2;G++)A[G]=E({pattern:i,tileWidth:Y,tileHeight:w,width:J,height:L,alignVertical:r,alignHorizontal:t,sideOrientation:B});for(let G=2;G<4;G++)A[G]=E({pattern:i,tileWidth:Y,tileHeight:w,width:x,height:L,alignVertical:r,alignHorizontal:t,sideOrientation:B});let f=r;r===W.d.BOTTOM?f=W.d.TOP:r===W.d.TOP&&(f=W.d.BOTTOM);for(let G=4;G<6;G++)A[G]=E({pattern:i,tileWidth:Y,tileHeight:w,width:J,height:x,alignVertical:f,alignHorizontal:t,sideOrientation:B});let g=[],X=[],u=[],M=[];const e=[],R=[],U=[],H=[];let p=0,S=0;for(let W=0;W<6;W++){const b=A[W].Mb.length;R[W]=[],U[W]=[];for(let d=0;d<b/3;d++)R[W].push(new G.ed(A[W].Mb[3*d],A[W].Mb[3*d+1],A[W].Mb[3*d+2])),U[W].push(new G.ed(A[W].eb[3*d],A[W].eb[3*d+1],A[W].eb[3*d+2]));p=A[W].Ub.length,H[W]=[];for(let P=0;P<p;P+=2)H[W][P]=d[W].x+(d[W].z-d[W].x)*A[W].Ub[P],H[W][P+1]=d[W].y+(d[W].w-d[W].y)*A[W].Ub[P+1],C.e&&(H[W][P+1]=1-H[W][P+1]);if(u=u.concat(H[W]),M=M.concat(A[W].indices.map((b=>b+S))),S+=R[W].length,P)for(let d=0;d<4;d++)e.push(P[W].r,P[W].g,P[W].b,P[W].a)}const l=new G.ed(0,0,o),N=G.Matrix.RotationY(Math.PI);g=R[0].map((b=>G.ed.TransformNormal(b,N).add(l))).map((b=>[b.x,b.y,b.z])).reduce(((b,d)=>b.concat(d)),[]),X=U[0].map((b=>G.ed.TransformNormal(b,N))).map((b=>[b.x,b.y,b.z])).reduce(((b,d)=>b.concat(d)),[]),g=g.concat(R[1].map((b=>b.Rd(l))).map((b=>[b.x,b.y,b.z])).reduce(((b,d)=>b.concat(d)),[])),X=X.concat(U[1].map((b=>[b.x,b.y,b.z])).reduce(((b,d)=>b.concat(d)),[]));const j=new G.ed(n,0,0),a=G.Matrix.RotationY(-Math.PI/2);g=g.concat(R[2].map((b=>G.ed.TransformNormal(b,a).add(j))).map((b=>[b.x,b.y,b.z])).reduce(((b,d)=>b.concat(d)),[])),X=X.concat(U[2].map((b=>G.ed.TransformNormal(b,a))).map((b=>[b.x,b.y,b.z])).reduce(((b,d)=>b.concat(d)),[]));const O=G.Matrix.RotationY(Math.PI/2);g=g.concat(R[3].map((b=>G.ed.TransformNormal(b,O).Rd(j))).map((b=>[b.x,b.y,b.z])).reduce(((b,d)=>b.concat(d)),[])),X=X.concat(U[3].map((b=>G.ed.TransformNormal(b,O))).map((b=>[b.x,b.y,b.z])).reduce(((b,d)=>b.concat(d)),[]));const V=new G.ed(0,Z,0),y=G.Matrix.RotationX(Math.PI/2);g=g.concat(R[4].map((b=>G.ed.TransformNormal(b,y).add(V))).map((b=>[b.x,b.y,b.z])).reduce(((b,d)=>b.concat(d)),[])),X=X.concat(U[4].map((b=>G.ed.TransformNormal(b,y))).map((b=>[b.x,b.y,b.z])).reduce(((b,d)=>b.concat(d)),[]));const c=G.Matrix.RotationX(-Math.PI/2);g=g.concat(R[5].map((b=>G.ed.TransformNormal(b,c).Rd(V))).map((b=>[b.x,b.y,b.z])).reduce(((b,d)=>b.concat(d)),[])),X=X.concat(U[5].map((b=>G.ed.TransformNormal(b,c))).map((b=>[b.x,b.y,b.z])).reduce(((b,d)=>b.concat(d)),[])),q.e._ComputeSides(B,g,M,X,u);const D=new q.e;if(D.indices=M,D.Mb=g,D.eb=X,D.Ub=u,P){const b=B===q.e.DOUBLESIDE?e.concat(e):e;D.Rb=b}return D}function r(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new W.d(b,P);d.sideOrientation=W.d._GetDefaultSideOrientation(d.sideOrientation),G._originalBuilderSideOrientation=d.sideOrientation;return t(d).pb(G,d.updatable),G}q.e.CreateTiledPlane=E;q.e.CreateTiledBox=t;var B=P(13026),n=P(11909),Z=P(11873);function o(b){const d=b.height||2;let P=0===b.diameterTop?0:b.diameterTop||b.diameter||1,i=0===b.diameterBottom?0:b.diameterBottom||b.diameter||1;P=P||1e-5,i=i||1e-5;const J=0|(b.tessellation||24),L=0|(b.subdivisions||1),x=!!b.hasRings,Y=!!b.enclose,E=0===b.cap?0:b.cap||W.d.CAP_ALL,w=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1,t=0===b.sideOrientation?0:b.sideOrientation||q.e.DEFAULTSIDE,r=b.faceUV||new Array(3),B=b.faceColors,n=2+(1+(1!==w&&Y?2:0))*(x?L:1);let o;for(o=0;o<n;o++)B&&void 0===B[o]&&(B[o]=new s.ci(1,1,1,1));for(o=0;o<n;o++)r&&void 0===r[o]&&(r[o]=new G.Vector4(0,0,1,1));const A=[],f=[],g=[],X=[],u=[],M=2*Math.PI*w/J;let e,R,U;const H=(i-P)/2/d,p=G.ed.Zero(),S=G.ed.Zero(),l=G.ed.Zero(),N=G.ed.Zero(),j=G.ed.Zero(),a=Z.b.Y;let O,V,y,c=1,D=1,z=0,Q=0;for(O=0;O<=L;O++)for(R=O/L,U=(R*(P-i)+i)/2,c=x&&0!==O&&O!==L?2:1,y=0;y<c;y++){for(x&&(D+=y),Y&&(D+=2*y),V=0;V<=J;V++)e=V*M,p.x=Math.cos(-e)*U,p.y=-d/2+R*d,p.z=Math.sin(-e)*U,0===P&&O===L?(S.x=g[g.length-3*(J+1)],S.y=g[g.length-3*(J+1)+1],S.z=g[g.length-3*(J+1)+2]):(S.x=p.x,S.z=p.z,S.y=Math.sqrt(S.x*S.x+S.z*S.z)*H,S.normalize()),0===V&&(l.q(p),N.q(S)),f.push(p.x,p.y,p.z),g.push(S.x,S.y,S.z),Q=x?z!==D?r[D].y:r[D].w:r[D].y+(r[D].w-r[D].y)*R,X.push(r[D].x+(r[D].z-r[D].x)*V/J,C.e?1-Q:Q),B&&u.push(B[D].r,B[D].g,B[D].b,B[D].a);1!==w&&Y&&(f.push(p.x,p.y,p.z),f.push(0,p.y,0),f.push(0,p.y,0),f.push(l.x,l.y,l.z),G.ed.CrossToRef(a,S,j),j.normalize(),g.push(j.x,j.y,j.z,j.x,j.y,j.z),G.ed.CrossToRef(N,a,j),j.normalize(),g.push(j.x,j.y,j.z,j.x,j.y,j.z),Q=x?z!==D?r[D+1].y:r[D+1].w:r[D+1].y+(r[D+1].w-r[D+1].y)*R,X.push(r[D+1].x,C.e?1-Q:Q),X.push(r[D+1].z,C.e?1-Q:Q),Q=x?z!==D?r[D+2].y:r[D+2].w:r[D+2].y+(r[D+2].w-r[D+2].y)*R,X.push(r[D+2].x,C.e?1-Q:Q),X.push(r[D+2].z,C.e?1-Q:Q),B&&(u.push(B[D+1].r,B[D+1].g,B[D+1].b,B[D+1].a),u.push(B[D+1].r,B[D+1].g,B[D+1].b,B[D+1].a),u.push(B[D+2].r,B[D+2].g,B[D+2].b,B[D+2].a),u.push(B[D+2].r,B[D+2].g,B[D+2].b,B[D+2].a))),z!==D&&(z=D)}const I=1!==w&&Y?J+4:J;for(O=0,D=0;D<L;D++){let b=0,d=0,P=0,G=0;for(V=0;V<J;V++)b=O*(I+1)+V,d=(O+1)*(I+1)+V,P=O*(I+1)+(V+1),G=(O+1)*(I+1)+(V+1),A.push(b,d,P),A.push(G,P,d);1!==w&&Y&&(A.push(b+2,d+2,P+2),A.push(G+2,P+2,d+2),A.push(b+4,d+4,P+4),A.push(G+4,P+4,d+4)),O=x?O+2:O+1}const m=b=>{const W=b?P/2:i/2;if(0===W)return;let q,L,x;const Y=b?r[n-1]:r[0];let s=null;B&&(s=b?B[n-1]:B[0]);const E=f.length/3,t=b?d/2:-d/2,Z=new G.ed(0,t,0);f.push(Z.x,Z.y,Z.z),g.push(0,b?1:-1,0);const o=Y.y+.5*(Y.w-Y.y);X.push(Y.x+.5*(Y.z-Y.x),C.e?1-o:o),s&&u.push(s.r,s.g,s.b,s.a);const M=new G.Vector2(.5,.5);for(x=0;x<=J;x++){q=2*Math.PI*x*w/J;const d=Math.cos(-q),P=Math.sin(-q);L=new G.ed(d*W,t,P*W);const i=new G.Vector2(d*M.x+.5,P*M.y+.5);f.push(L.x,L.y,L.z),g.push(0,b?1:-1,0);const E=Y.y+(Y.w-Y.y)*i.y;X.push(Y.x+(Y.z-Y.x)*i.x,C.e?1-E:E),s&&u.push(s.r,s.g,s.b,s.a)}for(x=0;x<J;x++)b?(A.push(E),A.push(E+(x+2)),A.push(E+(x+1))):(A.push(E),A.push(E+(x+1)),A.push(E+(x+2)))};E!==W.d.CAP_START&&E!==W.d.CAP_ALL||m(!1),E!==W.d.CAP_END&&E!==W.d.CAP_ALL||m(!0),q.e._ComputeSides(t,f,A,g,X,b.frontUVs,b.backUVs);const v=new q.e;return v.indices=A,v.Mb=f,v.eb=g,v.Ub=X,B&&(v.Rb=u),v}function A(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;const G=new W.d(b,P);d.sideOrientation=W.d._GetDefaultSideOrientation(d.sideOrientation),G._originalBuilderSideOrientation=d.sideOrientation;return o(d).pb(G,d.updatable),G}function f(b){const d=[],P=[],W=[],i=[],J=b.diameter||1,L=b.thickness||.5,x=0|(b.tessellation||16),Y=0===b.sideOrientation?0:b.sideOrientation||q.e.DEFAULTSIDE,s=x+1;for(let q=0;q<=x;q++){const b=q/x,Y=q*Math.PI*2/x-Math.PI/2,E=G.Matrix.Translation(J/2,0,0).multiply(G.Matrix.RotationY(Y));for(let J=0;J<=x;J++){const Y=1-J/x,w=J*Math.PI*2/x+Math.PI,t=Math.cos(w),r=Math.sin(w);let B=new G.ed(t,r,0),n=B.scale(L/2);const Z=new G.Vector2(b,Y);n=G.ed.TransformCoordinates(n,E),B=G.ed.TransformNormal(B,E),P.push(n.x,n.y,n.z),W.push(B.x,B.y,B.z),i.push(Z.x,C.e?1-Z.y:Z.y);const o=(q+1)%s,A=(J+1)%s;d.push(q*s+J),d.push(q*s+A),d.push(o*s+J),d.push(q*s+A),d.push(o*s+A),d.push(o*s+J)}}q.e._ComputeSides(Y,P,d,W,i,b.frontUVs,b.backUVs);const E=new q.e;return E.indices=d,E.Mb=P,E.eb=W,E.Ub=i,E}function g(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;const G=new W.d(b,P);d.sideOrientation=W.d._GetDefaultSideOrientation(d.sideOrientation),G._originalBuilderSideOrientation=d.sideOrientation;return f(d).pb(G,d.updatable),G}q.e.CreateCylinder=o,W.d.CreateCylinder=(b,d,P,G,i,q,C,J,L)=>{void 0!==C&&C instanceof n.e||(void 0!==C&&(L=J||W.d.DEFAULTSIDE,J=C),C=q,q=1);return A(b,{height:d,diameterTop:P,diameterBottom:G,tessellation:i,subdivisions:q,sideOrientation:L,updatable:J},C)};function X(b){const d=[],P=[],W=[],i=[],J=b.radius||2,L=b.tube||.5,x=b.radialSegments||32,Y=b.tubularSegments||32,s=b.p||2,E=b.q||3,w=0===b.sideOrientation?0:b.sideOrientation||q.e.DEFAULTSIDE,t=b=>{const d=Math.cos(b),P=Math.sin(b),W=E/s*b,i=Math.cos(W),q=J*(2+i)*.5*d,C=J*(2+i)*P*.5,L=J*Math.sin(W)*.5;return new G.ed(q,C,L)};let r,B;for(r=0;r<=x;r++){const b=r%x/x*2*s*Math.PI,d=t(b),W=t(b+.01),q=W.Rd(d);let J=W.add(d);const E=G.ed.Cross(q,J);for(J=G.ed.Cross(E,q),E.normalize(),J.normalize(),B=0;B<Y;B++){const b=B%Y/Y*2*Math.PI,G=-L*Math.cos(b),W=L*Math.sin(b);P.push(d.x+G*J.x+W*E.x),P.push(d.y+G*J.y+W*E.y),P.push(d.z+G*J.z+W*E.z),i.push(r/x),i.push(C.e?1-B/Y:B/Y)}}for(r=0;r<x;r++)for(B=0;B<Y;B++){const b=(B+1)%Y,P=r*Y+B,G=(r+1)*Y+B,W=(r+1)*Y+b,i=r*Y+b;d.push(i),d.push(G),d.push(P),d.push(i),d.push(W),d.push(G)}q.e.ComputeNormals(P,d,W),q.e._ComputeSides(w,P,d,W,i,b.frontUVs,b.backUVs);const n=new q.e;return n.indices=d,n.Mb=P,n.eb=W,n.Ub=i,n}function u(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;const G=new W.d(b,P);d.sideOrientation=W.d._GetDefaultSideOrientation(d.sideOrientation),G._originalBuilderSideOrientation=d.sideOrientation;return X(d).pb(G,d.updatable),G}q.e.CreateTorus=f,W.d.CreateTorus=(b,d,P,G,W,i,q)=>g(b,{diameter:d,thickness:P,tessellation:G,sideOrientation:q,updatable:i},W);q.e.CreateTorusKnot=X,W.d.CreateTorusKnot=(b,d,P,G,W,i,q,C,J,L)=>u(b,{radius:d,tube:P,radialSegments:G,tubularSegments:W,p:i,q:q,sideOrientation:L,updatable:J},C);var M=P(13539),e=P(12243),R=P(11882);function U(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=d.path,i=d.shape,q=d.scale||1,C=d.rotation||0,J=0===d.cap?0:d.cap||W.d.NO_CAP,L=d.updatable,x=W.d._GetDefaultSideOrientation(d.sideOrientation),Y=d.instance||null,s=d.invertUV||!1,E=d.closeShape||!1,w=d.closePath||!1,t=d.capFunction||null;return p(b,i,G,q,C,null,null,w,E,J,!1,P,!!L,x,Y,s,d.frontUVs||null,d.backUVs||null,d.firstNormal||null,!!d.adjustFrame,t)}function H(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=d.path,i=d.shape,q=d.scaleFunction||(()=>1),C=d.rotationFunction||(()=>0),J=d.closePath||d.ribbonCloseArray||!1,L=d.closeShape||d.ribbonClosePath||!1,x=0===d.cap?0:d.cap||W.d.NO_CAP,Y=d.updatable,s=d.firstNormal||null,E=d.adjustFrame||!1,w=W.d._GetDefaultSideOrientation(d.sideOrientation),t=d.instance,r=d.invertUV||!1,B=d.capFunction||null;return p(b,i,G,null,null,q,C,J,L,x,!0,P,!!Y,w,t||null,r,d.frontUVs||null,d.backUVs||null,s,E,B||null)}function p(b,d,P,i,q,C,J,x,Y,s,E,w,t,r,B,n,Z,o,A,f,g){const X=(b,d,P,i,q,C,J,L,x,Y,s)=>{const E=P.getTangents(),w=P.getNormals(),t=P.getBinormals(),r=P.getDistances();if(s)for(let W=0;W<E.length;W++)if(0==E[W].x&&0==E[W].y&&0==E[W].z&&E[W].q(E[W-1]),0==w[W].x&&0==w[W].y&&0==w[W].z&&w[W].q(w[W-1]),0==t[W].x&&0==t[W].y&&0==t[W].z&&t[W].q(t[W-1]),W>0){let b=E[W-1];G.ed.Dot(b,E[W])<0&&E[W].scaleInPlace(-1),b=w[W-1],G.ed.Dot(b,w[W])<0&&w[W].scaleInPlace(-1),b=t[W-1],G.ed.Dot(b,t[W])<0&&t[W].scaleInPlace(-1)}let B=0;const n=Y&&L?L:()=>null!==C?C:0,Z=Y&&J?J:()=>null!==q?q:1;let o=x===W.d.NO_CAP||x===W.d.CAP_END?0:2;const A=G.TmpVectors.Matrix[0];for(let W=0;W<d.length;W++){const P=[],q=n(W,r[W]),C=Z(W,r[W]);G.Matrix.RotationAxisToRef(E[W],B,A);for(let i=0;i<b.length;i++){const q=E[W].scale(b[i].z).add(w[W].scale(b[i].x)).add(t[W].scale(b[i].y)),J=G.ed.Zero();G.ed.TransformCoordinatesToRef(q,A,J),J.scaleInPlace(C).addInPlace(d[W]),P[i]=J}i[o]=P,B+=q,o++}const f=g||(b=>{const d=Array(),P=G.ed.Zero();let W;for(W=0;W<b.length;W++)P.addInPlace(b[W]);for(P.scaleInPlace(1/b.length),W=0;W<b.length;W++)d.push(P);return d});switch(x){case W.d.NO_CAP:break;case W.d.CAP_START:i[0]=f(i[2]),i[1]=i[2];break;case W.d.CAP_END:i[o]=i[o-1],i[o+1]=f(i[o-1]);break;case W.d.CAP_ALL:i[0]=f(i[2]),i[1]=i[2],i[o]=i[o-1],i[o+1]=f(i[o-1])}return i};let u,M;if(B){const b=B._creationDataStorage;return u=A?b.path3D.update(P,A):b.path3D.update(P),M=X(d,P,b.path3D,b.pathArray,i,q,C,J,b.cap,E,f),B=L("",{pathArray:M,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:B},w||void 0)}u=A?new R.i(P,A):new R.i(P);M=X(d,P,u,new Array,i,q,C,J,s=s<0||s>3?0:s,E,f);const e=L(b,{pathArray:M,closeArray:x,closePath:Y,updatable:t,sideOrientation:r,invertUV:n,frontUVs:Z||void 0,backUVs:o||void 0},w);return e._creationDataStorage.pathArray=M,e._creationDataStorage.path3D=u,e._creationDataStorage.cap=s,e}function S(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=d.arc?d.arc<=0||d.arc>1?1:d.arc:1,q=void 0===d.closed||d.closed,C=d.shape,J=d.radius||1,x=d.tessellation||64,Y=d.clip||0,s=d.updatable,E=W.d._GetDefaultSideOrientation(d.sideOrientation),w=d.cap||W.d.NO_CAP,t=2*Math.PI,r=[],B=d.invertUV||!1;let n=0,Z=0;const o=t/x*i;let A,f;for(n=0;n<=x-Y;n++){for(f=[],w!=W.d.CAP_START&&w!=W.d.CAP_ALL||(f.push(new G.ed(0,C[0].y,0)),f.push(new G.ed(Math.cos(n*o)*C[0].x*J,C[0].y,Math.sin(n*o)*C[0].x*J))),Z=0;Z<C.length;Z++)A=new G.ed(Math.cos(n*o)*C[Z].x*J,C[Z].y,Math.sin(n*o)*C[Z].x*J),f.push(A);w!=W.d.CAP_END&&w!=W.d.CAP_ALL||(f.push(new G.ed(Math.cos(n*o)*C[C.length-1].x*J,C[C.length-1].y,Math.sin(n*o)*C[C.length-1].x*J)),f.push(new G.ed(0,C[C.length-1].y,0))),r.push(f)}return L(b,{pathArray:r,closeArray:q,sideOrientation:E,updatable:s,invertUV:B,frontUVs:d.frontUVs,backUVs:d.backUVs},P)}W.d.ExtrudeShape=function(b,d,P,G,i,q){let C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7?arguments[7]:void 0,L=arguments.length>8?arguments[8]:void 0,x=arguments.length>9?arguments[9]:void 0;return U(b,{shape:d,path:P,scale:G,rotation:i,cap:0===q?0:q||W.d.NO_CAP,sideOrientation:L,instance:x,updatable:J},C)},W.d.ExtrudeShapeCustom=(b,d,P,G,i,q,C,J,L,x,Y,s)=>H(b,{shape:d,path:P,scaleFunction:G,rotationFunction:i,ribbonCloseArray:q,ribbonClosePath:C,cap:0===J?0:J||W.d.NO_CAP,sideOrientation:Y,instance:s,updatable:x},L);W.d.CreateLathe=(b,d,P,G,W,i,q)=>S(b,{shape:d,radius:P,tessellation:G,sideOrientation:q,updatable:i},W);var l=P(12943),N=P(12900);function j(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=d.path;let q=d.instance,C=1;void 0!==d.radius?C=d.radius:q&&(C=q._creationDataStorage.radius);const J=d.tessellation||64,x=d.radiusFunction||null;let Y=d.cap||W.d.NO_CAP;const s=d.invertUV||!1,E=d.updatable,w=W.d._GetDefaultSideOrientation(d.sideOrientation);d.arc=d.arc&&(d.arc<=0||d.arc>1)?1:d.arc||1;const t=(b,d,P,i,q,C,J,L)=>{const x=d.getTangents(),Y=d.getNormals(),s=d.getDistances(),E=2*Math.PI/q*L,w=C||(()=>i);let t,r,B,n;const Z=G.TmpVectors.Matrix[0];let o=J===W.d.NO_CAP||J===W.d.CAP_END?0:2;for(let W=0;W<b.length;W++){r=w(W,s[W]),t=Array(),B=Y[W];for(let d=0;d<q;d++)G.Matrix.RotationAxisToRef(x[W],E*d,Z),n=t[d]?t[d]:G.ed.Zero(),G.ed.TransformCoordinatesToRef(B,Z,n),n.scaleInPlace(r).addInPlace(b[W]),t[d]=n;P[o]=t,o++}const A=(d,P)=>{const G=Array();for(let W=0;W<d;W++)G.push(b[P]);return G};switch(J){case W.d.NO_CAP:break;case W.d.CAP_START:P[0]=A(q,0),P[1]=P[2].slice(0);break;case W.d.CAP_END:P[o]=P[o-1].slice(0),P[o+1]=A(q,b.length-1);break;case W.d.CAP_ALL:P[0]=A(q,0),P[1]=P[2].slice(0),P[o]=P[o-1].slice(0),P[o+1]=A(q,b.length-1)}return P};let r,B;if(q){const b=q._creationDataStorage,P=d.arc||b.arc;return r=b.path3D.update(i),B=t(i,r,b.pathArray,C,b.tessellation,x,b.cap,P),q=L("",{pathArray:B,instance:q}),b.path3D=r,b.pathArray=B,b.arc=P,b.radius=C,q}r=new R.i(i);Y=Y<0||Y>3?0:Y,B=t(i,r,new Array,C,J,x,Y,d.arc);const n=L(b,{pathArray:B,closePath:!0,closeArray:!1,updatable:E,sideOrientation:w,invertUV:s,frontUVs:d.frontUVs,backUVs:d.backUVs},P);return n._creationDataStorage.pathArray=B,n._creationDataStorage.path3D=r,n._creationDataStorage.tessellation=J,n._creationDataStorage.cap=Y,n._creationDataStorage.arc=d.arc,n._creationDataStorage.radius=C,n}function a(b){const d=[];d[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},d[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},d[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},d[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},d[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},d[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},d[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},d[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},d[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},d[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},d[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},d[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},d[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},d[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},d[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const P=b.type&&(b.type<0||b.type>=d.length)?0:b.type||0,W=b.size,i=b.sizeX||W||1,J=b.sizeY||W||1,L=b.sizeZ||W||1,x=b.custom||d[P],Y=x.face.length,E=b.faceUV||new Array(Y),w=b.faceColors,t=void 0===b.flat||b.flat,r=0===b.sideOrientation?0:b.sideOrientation||q.e.DEFAULTSIDE,B=[],n=[],Z=[],o=[],A=[];let f=0,g=0;const X=[];let u,M,e,R,U,H,p=0,S=0;if(t)for(S=0;S<Y;S++)w&&void 0===w[S]&&(w[S]=new s.ci(1,1,1,1)),E&&void 0===E[S]&&(E[S]=new G.Vector4(0,0,1,1));if(t)for(S=0;S<Y;S++){const b=x.face[S].length;for(e=2*Math.PI/b,R=.5*Math.tan(e/2),U=.5,p=0;p<b;p++)B.push(x.vertex[x.face[S][p]][0]*i,x.vertex[x.face[S][p]][1]*J,x.vertex[x.face[S][p]][2]*L),X.push(f),f++,u=E[S].x+(E[S].z-E[S].x)*(.5+R),M=E[S].y+(E[S].w-E[S].y)*(U-.5),o.push(u,C.e?1-M:M),H=R*Math.cos(e)-U*Math.sin(e),U=R*Math.sin(e)+U*Math.cos(e),R=H,w&&A.push(w[S].r,w[S].g,w[S].b,w[S].a);for(p=0;p<b-2;p++)n.push(X[0+g],X[p+2+g],X[p+1+g]);g+=b}else{for(p=0;p<x.vertex.length;p++)B.push(x.vertex[p][0]*i,x.vertex[p][1]*J,x.vertex[p][2]*L),o.push(0,C.e?1:0);for(S=0;S<Y;S++)for(p=0;p<x.face[S].length-2;p++)n.push(x.face[S][0],x.face[S][p+2],x.face[S][p+1])}q.e.ComputeNormals(B,n,Z),q.e._ComputeSides(r,B,n,Z,o,b.frontUVs,b.backUVs);const l=new q.e;return l.Mb=B,l.indices=n,l.eb=Z,l.Ub=o,w&&t&&(l.Rb=A),l}function O(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new W.d(b,P);d.sideOrientation=W.d._GetDefaultSideOrientation(d.sideOrientation),G._originalBuilderSideOrientation=d.sideOrientation;return a(d).pb(G,d.updatable),G}W.d.CreateTube=(b,d,P,G,W,i,q,C,J,L)=>j(b,{path:d,radius:P,tessellation:G,radiusFunction:W,arc:1,cap:i,updatable:C,sideOrientation:J,instance:L},q);function V(b){const d=b.sideOrientation||q.e.DEFAULTSIDE,P=b.radius||1,W=void 0===b.flat||b.flat,i=0|(b.subdivisions||4),J=b.radiusX||P,L=b.radiusY||P,x=b.radiusZ||P,Y=(1+Math.sqrt(5))/2,s=[-1,Y,-0,1,Y,0,-1,-Y,0,1,-Y,0,0,-1,-Y,0,1,-Y,0,-1,Y,0,1,Y,Y,0,1,Y,0,-1,-Y,0,1,-Y,0,-1],E=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],w=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],t=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],r=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],B=[],n=[],Z=[],o=[];let A=0;const f=new Array(3),g=new Array(3);let X;for(X=0;X<3;X++)f[X]=G.ed.Zero(),g[X]=G.Vector2.Zero();for(let q=0;q<20;q++){for(X=0;X<3;X++){const b=E[3*q+X];f[X].Fd(s[3*w[b]],s[3*w[b]+1],s[3*w[b]+2]),f[X].normalize(),g[X].Fd(.134765625*t[2*b]+.05859375+-.0390625*r[q],.2333984375*t[2*b+1]+.025390625+.01953125*r[q])}const b=(b,d,P,q)=>{const Y=G.ed.Lerp(f[0],f[2],d/i),s=G.ed.Lerp(f[1],f[2],d/i),E=i===d?f[2]:G.ed.Lerp(Y,s,b/(i-d));let w;if(E.normalize(),W){const b=G.ed.Lerp(f[0],f[2],q/i),d=G.ed.Lerp(f[1],f[2],q/i);w=G.ed.Lerp(b,d,P/(i-q))}else w=new G.ed(E.x,E.y,E.z);w.x/=J,w.y/=L,w.z/=x,w.normalize();const t=G.Vector2.Lerp(g[0],g[2],d/i),r=G.Vector2.Lerp(g[1],g[2],d/i),X=i===d?g[2]:G.Vector2.Lerp(t,r,b/(i-d));n.push(E.x*J,E.y*L,E.z*x),Z.push(w.x,w.y,w.z),o.push(X.x,C.e?1-X.y:X.y),B.push(A),A++};for(let d=0;d<i;d++)for(let P=0;P+d<i;P++)b(P,d,P+1/3,d+1/3),b(P+1,d,P+1/3,d+1/3),b(P,d+1,P+1/3,d+1/3),P+d+1<i&&(b(P+1,d,P+2/3,d+2/3),b(P+1,d+1,P+2/3,d+2/3),b(P,d+1,P+2/3,d+2/3))}q.e._ComputeSides(d,n,B,Z,o,b.frontUVs,b.backUVs);const u=new q.e;return u.indices=B,u.Mb=n,u.eb=Z,u.Ub=o,u}function y(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new W.d(b,P);d.sideOrientation=W.d._GetDefaultSideOrientation(d.sideOrientation),G._originalBuilderSideOrientation=d.sideOrientation;return V(d).pb(G,d.updatable),G}q.e.CreatePolyhedron=a,W.d.CreatePolyhedron=(b,d,P)=>O(b,d,P);q.e.CreateIcoSphere=V,W.d.CreateIcoSphere=(b,d,P)=>y(b,d,P);var c=P(11700);const D=new G.ed(1,0,0),z=new G.ed(-1,0,0),Q=new G.ed(0,1,0),I=new G.ed(0,-1,0),m=new G.ed(0,0,1),v=new G.ed(0,0,-1);class F{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G.ed.Zero(),d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G.ed.Up(),P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.Vector2.Zero(),W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=b,this.normal=d,this.uv=P,this.vertexIdx=W,this.vertexIdxForBones=i,this.localPositionOverride=q,this.localNormalOverride=C,this.matrixIndicesOverride=J,this.matrixWeightsOverride=L}clone(){var b,d,P,G;return new F(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(b=this.localPositionOverride)||void 0===b?void 0:b.slice(),null===(d=this.localNormalOverride)||void 0===d?void 0:d.slice(),null===(P=this.matrixIndicesOverride)||void 0===P?void 0:P.slice(),null===(G=this.matrixWeightsOverride)||void 0===G?void 0:G.slice())}}function h(b,d,P){var J,L,x,Y,s;const E=!!d.skeleton,w=!(null===(J=d.morphTargetManager)||void 0===J||!J.numTargets),t=P.localMode||E,r=d.Id(),B=E||w?d.pC(!0,!0):d.getVerticesData(i.c.PositionKind),n=E||w?d.getNormalsData(!0,!0):d.getVerticesData(i.c.NormalKind),Z=t?E?d.getVerticesData(i.c.PositionKind):B:null,o=t?E?d.getVerticesData(i.c.NormalKind):n:null,A=d.getVerticesData(i.c.UVKind),f=E?d.getVerticesData(i.c.MatricesIndicesKind):null,g=E?d.getVerticesData(i.c.MatricesWeightsKind):null,X=E?d.getVerticesData(i.c.MatricesIndicesExtraKind):null,u=E?d.getVerticesData(i.c.MatricesWeightsExtraKind):null,M=P.position||G.ed.Zero();let e=P.normal||G.ed.Up();const R=P.size||G.ed.One(),U=P.angle||0;if(!e){const b=new G.ed(0,0,1),P=d.Xb().activeCamera,W=G.ed.TransformCoordinates(b,P.getWorldMatrix());e=P.globalPosition.Rd(W)}const H=-Math.atan2(e.z,e.x)-Math.PI/2,p=Math.sqrt(e.x*e.x+e.z*e.z),S=Math.atan2(e.y,p),l=new q.e;l.indices=[],l.Mb=[],l.eb=[],l.Ub=[],l.matricesIndices=E?[]:null,l.matricesWeights=E?[]:null,l.matricesIndicesExtra=X?[]:null,l.matricesWeightsExtra=u?[]:null;let N=0;const j=(b,d)=>{const W=new F;if(!r||!B||!n)return W;const i=r[b];if(W.vertexIdx=3*i,W.vertexIdxForBones=4*i,W.position=new G.ed(B[3*i],B[3*i+1],B[3*i+2]),G.ed.TransformCoordinatesToRef(W.position,d,W.position),W.normal=new G.ed(n[3*i],n[3*i+1],n[3*i+2]),G.ed.TransformNormalToRef(W.normal,d,W.normal),P.captureUVS&&A){const b=A[2*i+1];W.uv=new G.Vector2(A[2*i],C.e?1-b:b)}return W},a=[0,0,0,0],O=(b,d)=>{if(0===b.length)return b;const P=.5*Math.abs(G.ed.Dot(R,d)),W=(b,d,P,G)=>{for(let W=0;W<G;++W)if(b[P+W]===d)return P+W;return-1},i=(b,i)=>{const q=G.ed.GetClipFactor(b.position,i.position,d,P);let C=a,J=a;if(f&&g){const d=b.matrixIndicesOverride?0:b.vertexIdxForBones,P=b.matrixIndicesOverride??f,G=b.matrixWeightsOverride??g,L=i.matrixIndicesOverride?0:i.vertexIdxForBones,x=i.matrixIndicesOverride??f,Y=i.matrixWeightsOverride??g;C=[0,0,0,0],J=[0,0,0,0];let s=0;for(let b=0;b<4;++b)if(G[d+b]>0){const i=W(x,P[d+b],L,4);C[s]=P[d+b],J[s]=(0,c.Lerp)(G[d+b],i>=0?Y[i]:0,q),s++}for(let b=0;b<4&&s<4;++b){const G=x[L+b];-1===W(P,G,d,4)&&(C[s]=G,J[s]=(0,c.Lerp)(0,Y[L+b],q),s++)}const E=J[0]+J[1]+J[2]+J[3];J[0]/=E,J[1]/=E,J[2]/=E,J[3]/=E}const L=b.localPositionOverride?b.localPositionOverride[0]:(null===Z||void 0===Z?void 0:Z[b.vertexIdx])??0,x=b.localPositionOverride?b.localPositionOverride[1]:(null===Z||void 0===Z?void 0:Z[b.vertexIdx+1])??0,Y=b.localPositionOverride?b.localPositionOverride[2]:(null===Z||void 0===Z?void 0:Z[b.vertexIdx+2])??0,s=i.localPositionOverride?i.localPositionOverride[0]:(null===Z||void 0===Z?void 0:Z[i.vertexIdx])??0,E=i.localPositionOverride?i.localPositionOverride[1]:(null===Z||void 0===Z?void 0:Z[i.vertexIdx+1])??0,w=i.localPositionOverride?i.localPositionOverride[2]:(null===Z||void 0===Z?void 0:Z[i.vertexIdx+2])??0,t=b.localNormalOverride?b.localNormalOverride[0]:(null===o||void 0===o?void 0:o[b.vertexIdx])??0,r=b.localNormalOverride?b.localNormalOverride[1]:(null===o||void 0===o?void 0:o[b.vertexIdx+1])??0,B=b.localNormalOverride?b.localNormalOverride[2]:(null===o||void 0===o?void 0:o[b.vertexIdx+2])??0,n=t+((i.localNormalOverride?i.localNormalOverride[0]:(null===o||void 0===o?void 0:o[i.vertexIdx])??0)-t)*q,A=r+((i.localNormalOverride?i.localNormalOverride[1]:(null===o||void 0===o?void 0:o[i.vertexIdx+1])??0)-r)*q,X=B+((i.localNormalOverride?i.localNormalOverride[2]:(null===o||void 0===o?void 0:o[i.vertexIdx+2])??0)-B)*q,u=Math.sqrt(n*n+A*A+X*X);return new F(G.ed.Lerp(b.position,i.position,q),G.ed.Lerp(b.normal,i.normal,q).normalize(),G.Vector2.Lerp(b.uv,i.uv,q),-1,-1,Z?[L+(s-L)*q,x+(E-x)*q,Y+(w-Y)*q]:null,o?[n/u,A/u,X/u]:null,C,J)};let q=null;b.length>3&&(q=[]);for(let C=0;C<b.length;C+=3){let W=0,J=null,L=null,x=null,Y=null;const s=G.ed.Dot(b[C].position,d)-P>0,E=G.ed.Dot(b[C+1].position,d)-P>0,w=G.ed.Dot(b[C+2].position,d)-P>0;switch(W=(s?1:0)+(E?1:0)+(w?1:0),W){case 0:b.length>3?(q.push(b[C]),q.push(b[C+1]),q.push(b[C+2])):q=b;break;case 1:if(q=q??new Array,s&&(J=b[C+1],L=b[C+2],x=i(b[C],J),Y=i(b[C],L)),E){J=b[C],L=b[C+2],x=i(b[C+1],J),Y=i(b[C+1],L),q.push(x),q.push(L.clone()),q.push(J.clone()),q.push(L.clone()),q.push(x.clone()),q.push(Y);break}w&&(J=b[C],L=b[C+1],x=i(b[C+2],J),Y=i(b[C+2],L)),J&&L&&x&&Y&&(q.push(J.clone()),q.push(L.clone()),q.push(x),q.push(Y),q.push(x.clone()),q.push(L.clone()));break;case 2:q=q??new Array,s||(J=b[C].clone(),L=i(J,b[C+1]),x=i(J,b[C+2]),q.push(J),q.push(L),q.push(x)),E||(J=b[C+1].clone(),L=i(J,b[C+2]),x=i(J,b[C]),q.push(J),q.push(L),q.push(x)),w||(J=b[C+2].clone(),L=i(J,b[C]),x=i(J,b[C+1]),q.push(J),q.push(L),q.push(x))}}return q},V=d instanceof W.d?d:null,y=null===V||void 0===V?void 0:V._thinInstanceDataStorage.matrixData,h=(null===V||void 0===V?void 0:V.eq)||1,T=G.TmpVectors.Matrix[0];T.q(G.Matrix.IdentityReadOnly);for(let W=0;W<h;++W){if(null!==V&&void 0!==V&&V.hasThinInstances&&y){const b=16*W;T.setRowFromFloats(0,y[b+0],y[b+1],y[b+2],y[b+3]),T.setRowFromFloats(1,y[b+4],y[b+5],y[b+6],y[b+7]),T.setRowFromFloats(2,y[b+8],y[b+9],y[b+10],y[b+11]),T.setRowFromFloats(3,y[b+12],y[b+13],y[b+14],y[b+15])}const b=G.Matrix.RotationYawPitchRoll(H,S,U).multiply(G.Matrix.Translation(M.x,M.y,M.z)),i=G.Matrix.Invert(b),q=d.getWorldMatrix(),J=T.multiply(q).multiply(i),L=new Array(3);for(let d=0;d<r.length;d+=3){let b=L;if(b[0]=j(d,J),b[1]=j(d+1,J),b[2]=j(d+2,J),!(P.cullBackFaces&&-b[0].normal.z<=0&&-b[1].normal.z<=0&&-b[2].normal.z<=0)&&(b=O(b,D),b&&(b=O(b,z),b&&(b=O(b,Q),b&&(b=O(b,I),b&&(b=O(b,m),b&&(b=O(b,v),b)))))))for(let d=0;d<b.length;d++){const G=b[d];if(l.indices.push(N),t?(G.localPositionOverride?(l.Mb[3*N]=G.localPositionOverride[0],l.Mb[3*N+1]=G.localPositionOverride[1],l.Mb[3*N+2]=G.localPositionOverride[2]):Z&&(l.Mb[3*N]=Z[G.vertexIdx],l.Mb[3*N+1]=Z[G.vertexIdx+1],l.Mb[3*N+2]=Z[G.vertexIdx+2]),G.localNormalOverride?(l.eb[3*N]=G.localNormalOverride[0],l.eb[3*N+1]=G.localNormalOverride[1],l.eb[3*N+2]=G.localNormalOverride[2]):o&&(l.eb[3*N]=o[G.vertexIdx],l.eb[3*N+1]=o[G.vertexIdx+1],l.eb[3*N+2]=o[G.vertexIdx+2])):(G.position.toArray(l.Mb,3*N),G.normal.toArray(l.eb,3*N)),l.matricesIndices&&l.matricesWeights&&(G.matrixIndicesOverride?(l.matricesIndices[4*N]=G.matrixIndicesOverride[0],l.matricesIndices[4*N+1]=G.matrixIndicesOverride[1],l.matricesIndices[4*N+2]=G.matrixIndicesOverride[2],l.matricesIndices[4*N+3]=G.matrixIndicesOverride[3]):(f&&(l.matricesIndices[4*N]=f[G.vertexIdxForBones],l.matricesIndices[4*N+1]=f[G.vertexIdxForBones+1],l.matricesIndices[4*N+2]=f[G.vertexIdxForBones+2],l.matricesIndices[4*N+3]=f[G.vertexIdxForBones+3]),X&&l.matricesIndicesExtra&&(l.matricesIndicesExtra[4*N]=X[G.vertexIdxForBones],l.matricesIndicesExtra[4*N+1]=X[G.vertexIdxForBones+1],l.matricesIndicesExtra[4*N+2]=X[G.vertexIdxForBones+2],l.matricesIndicesExtra[4*N+3]=X[G.vertexIdxForBones+3])),G.matrixWeightsOverride?(l.matricesWeights[4*N]=G.matrixWeightsOverride[0],l.matricesWeights[4*N+1]=G.matrixWeightsOverride[1],l.matricesWeights[4*N+2]=G.matrixWeightsOverride[2],l.matricesWeights[4*N+3]=G.matrixWeightsOverride[3]):(g&&(l.matricesWeights[4*N]=g[G.vertexIdxForBones],l.matricesWeights[4*N+1]=g[G.vertexIdxForBones+1],l.matricesWeights[4*N+2]=g[G.vertexIdxForBones+2],l.matricesWeights[4*N+3]=g[G.vertexIdxForBones+3]),u&&l.matricesWeightsExtra&&(l.matricesWeightsExtra[4*N]=u[G.vertexIdxForBones],l.matricesWeightsExtra[4*N+1]=u[G.vertexIdxForBones+1],l.matricesWeightsExtra[4*N+2]=u[G.vertexIdxForBones+2],l.matricesWeightsExtra[4*N+3]=u[G.vertexIdxForBones+3]))),P.captureUVS)G.uv.toArray(l.Ub,2*N);else{l.Ub.push(.5+G.position.x/R.x);const b=.5+G.position.y/R.y;l.Ub.push(C.e?1-b:b)}N++}}}0===l.indices.length&&(l.indices=null),0===l.Mb.length&&(l.Mb=null),0===l.eb.length&&(l.eb=null),0===l.Ub.length&&(l.Ub=null),0===(null===(L=l.matricesIndices)||void 0===L?void 0:L.length)&&(l.matricesIndices=null),0===(null===(x=l.matricesWeights)||void 0===x?void 0:x.length)&&(l.matricesWeights=null),0===(null===(Y=l.matricesIndicesExtra)||void 0===Y?void 0:Y.length)&&(l.matricesIndicesExtra=null),0===(null===(s=l.matricesWeightsExtra)||void 0===s?void 0:s.length)&&(l.matricesWeightsExtra=null);const K=new W.d(b,d.Xb());return l.pb(K),t?(K.skeleton=d.skeleton,K.parent=d):(K.position=M.clone(),K.rotation=new G.ed(S,H,U)),K.zd(!0),K.refreshBoundingInfo(!0,!0),K}function T(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const d=0|Math.max(b.subdivisions?b.subdivisions:2,1),P=0|Math.max(b.tessellation?b.tessellation:16,3),W=Math.max(b.height?b.height:1,0),i=Math.max(b.radius?b.radius:.25,0),J=0|Math.max(b.capSubdivisions?b.capSubdivisions:6,1),L=P,x=d,Y=Math.max(b.radiusTop?b.radiusTop:i,0),s=Math.max(b.radiusBottom?b.radiusBottom:i,0),E=W-(Y+s),w=2*Math.PI,t=Math.max(b.topCapSubdivisions?b.topCapSubdivisions:J,1),r=Math.max(b.bottomCapSubdivisions?b.bottomCapSubdivisions:J,1),B=Math.acos((s-Y)/W);let n=[];const Z=[],o=[],A=[];let f=0;const g=[],X=.5*E,u=.5*Math.PI;let M,e;const R=G.ed.Zero(),U=G.ed.Zero(),H=Math.cos(B),p=Math.sin(B),S=new G.Vector2(Y*p,X+Y*H).Rd(new G.Vector2(s*p,s*H-X)).length(),l=Y*B+S+s*(u-B);let N=0;for(e=0;e<=t;e++){const b=[],d=u-B*(e/t);N+=Y*B/t;const P=Math.cos(d),G=Math.sin(d),W=P*Y;for(M=0;M<=L;M++){const d=M/L,i=d*w+0,q=Math.sin(i),J=Math.cos(i);U.x=W*q,U.y=X+G*Y,U.z=W*J,Z.push(U.x,U.y,U.z),R.set(P*q,G,P*J),o.push(R.x,R.y,R.z),A.push(d,C.e?N/l:1-N/l),b.push(f),f++}g.push(b)}const j=W-Y-s+H*Y-H*s,a=p*(s-Y)/j;for(e=1;e<=x;e++){const b=[];N+=S/x;const d=p*(e*(s-Y)/x+Y);for(M=0;M<=L;M++){const P=M/L,G=P*w+0,W=Math.sin(G),i=Math.cos(G);U.x=d*W,U.y=X+H*Y-e*j/x,U.z=d*i,Z.push(U.x,U.y,U.z),R.set(W,a,i).normalize(),o.push(R.x,R.y,R.z),A.push(P,C.e?N/l:1-N/l),b.push(f),f++}g.push(b)}for(e=1;e<=r;e++){const b=[],d=u-B-(Math.PI-B)*(e/r);N+=s*B/r;const P=Math.cos(d),G=Math.sin(d),W=P*s;for(M=0;M<=L;M++){const d=M/L,i=d*w+0,q=Math.sin(i),J=Math.cos(i);U.x=W*q,U.y=G*s-X,U.z=W*J,Z.push(U.x,U.y,U.z),R.set(P*q,G,P*J),o.push(R.x,R.y,R.z),A.push(d,C.e?N/l:1-N/l),b.push(f),f++}g.push(b)}for(M=0;M<L;M++)for(e=0;e<t+x+r;e++){const b=g[e][M],d=g[e+1][M],P=g[e+1][M+1],G=g[e][M+1];n.push(b),n.push(d),n.push(G),n.push(d),n.push(P),n.push(G)}if(n=n.reverse(),b.orientation&&!b.orientation.equals(G.ed.Up())){const d=new G.Matrix;b.orientation.clone().scale(.5*Math.PI).cross(G.ed.Up()).toQuaternion().toRotationMatrix(d);const P=G.ed.Zero();for(let b=0;b<Z.length;b+=3)P.set(Z[b],Z[b+1],Z[b+2]),G.ed.TransformCoordinatesToRef(P.clone(),d,P),Z[b]=P.x,Z[b+1]=P.y,Z[b+2]=P.z}const O=new q.e;return O.Mb=Z,O.eb=o,O.Ub=A,O.indices=n,O}function K(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:G.ed.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=new W.d(b,P);return T(d).pb(i,d.updatable),i}W.d.CreateDecal=(b,d,P,G,W,i)=>h(b,d,{position:P,normal:G,size:W,angle:i});W.d.CreateCapsule=(b,d,P)=>K(b,d,P),q.e.CreateCapsule=T;var k=P(11504),bb=P(11688);class db{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=b,this.y=d,b!==Math.floor(b)&&(b=Math.floor(b),k.e.Warn("x is not an integer, floor(x) used")),d!==Math.floor(d)&&(d=Math.floor(d),k.e.Warn("y is not an integer, floor(y) used"))}clone(){return new db(this.x,this.y)}rotate60About(b){const d=this.x;return this.x=b.x+b.y-this.y,this.y=d+this.y-b.x,this}rotateNeg60About(b){const d=this.x;return this.x=d+this.y-b.y,this.y=b.x+b.y-d,this}rotate120(b,d){b!==Math.floor(b)&&(b=Math.floor(b),k.e.Warn("m not an integer only floor(m) used")),d!==Math.floor(d)&&(d=Math.floor(d),k.e.Warn("n not an integer only floor(n) used"));const P=this.x;return this.x=b-P-this.y,this.y=d+P,this}rotateNeg120(b,d){b!==Math.floor(b)&&(b=Math.floor(b),k.e.Warn("m is not an integer, floor(m) used")),d!==Math.floor(d)&&(d=Math.floor(d),k.e.Warn("n is not an integer,   floor(n) used"));const P=this.x;return this.x=this.y-d,this.y=b+d-P-this.y,this}toCartesianOrigin(b,d){const P=G.ed.Zero();return P.x=b.x+2*this.x*d+this.y*d,P.y=b.y+Math.sqrt(3)*this.y*d,P}static Zero(){return new db(0,0)}}class Pb{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new Gb("icosahedron","Regular",[[0,bb.f,-1],[-bb.f,1,0],[-1,0,-bb.f],[1,0,-bb.f],[bb.f,1,0],[0,bb.f,1],[-1,0,bb.f],[-bb.f,-1,0],[0,-bb.f,-1],[bb.f,-1,0],[1,0,bb.f],[0,-bb.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let b=12;const d={},P=this.m,G=this.n;let W,i,q,C,J,L=P,x=1,Y=0;0!==G&&(L=(0,c.HighestCommonFactor)(P,G)),x=P/L,Y=G/L;const s=db.Zero(),E=new db(P,G),w=new db(-G,P+G),t=db.Zero(),r=db.Zero(),B=db.Zero();let n,Z,o,A,f=[];const g=[],X=this.vertByDist,u=(P,G,W,i)=>{n=P+"|"+W,Z=G+"|"+i,n in d||Z in d?n in d&&!(Z in d)?d[Z]=d[n]:Z in d&&!(n in d)&&(d[n]=d[Z]):(d[n]=b,d[Z]=b,b++),X[W][0]>2?g[d[n]]=[-X[W][0],X[W][1],d[n]]:g[d[n]]=[f[X[W][0]],X[W][1],d[n]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let M=0;M<20;M++){if(f=this.IDATA.face[M],q=f[2],C=f[1],J=f[0],o=s.x+"|"+s.y,n=M+"|"+o,n in d||(d[n]=q,g[q]=[f[X[o][0]],X[o][1]]),o=E.x+"|"+E.y,n=M+"|"+o,n in d||(d[n]=C,g[C]=[f[X[o][0]],X[o][1]]),o=w.x+"|"+w.y,n=M+"|"+o,n in d||(d[n]=J,g[J]=[f[X[o][0]],X[o][1]]),W=this.IDATA.edgematch[M][0],i=this.IDATA.edgematch[M][1],"B"===i)for(let b=1;b<L;b++)r.x=P-b*(x+Y),r.y=G+b*x,B.x=-b*Y,B.y=b*(x+Y),o=r.x+"|"+r.y,A=B.x+"|"+B.y,u(M,W,o,A);if("O"===i)for(let b=1;b<L;b++)B.x=-b*Y,B.y=b*(x+Y),t.x=b*x,t.y=b*Y,o=B.x+"|"+B.y,A=t.x+"|"+t.y,u(M,W,o,A);if(W=this.IDATA.edgematch[M][2],i=this.IDATA.edgematch[M][3],i&&"A"===i)for(let b=1;b<L;b++)t.x=b*x,t.y=b*Y,r.x=P-(L-b)*(x+Y),r.y=G+(L-b)*x,o=t.x+"|"+t.y,A=r.x+"|"+r.y,u(M,W,o,A);for(let P=0;P<this.vertices.length;P++)o=this.vertices[P].x+"|"+this.vertices[P].y,n=M+"|"+o,n in d||(d[n]=b++,X[o][0]>2?g[d[n]]=[-X[o][0],X[o][1],d[n]]:g[d[n]]=[f[X[o][0]],X[o][1],d[n]])}this.closestTo=g,this.vecToidx=d}calcCoeffs(){const b=this.m,d=this.n,P=Math.sqrt(3)/3,G=b*b+d*d+b*d;this.coau=(b+d)/G,this.cobu=-d/G,this.coav=-P*(b-d)/G,this.cobv=P*(2*b+d)/G}createInnerFacets(){const b=this.m,d=this.n;for(let P=0;P<d+b+1;P++)for(let b=this.min[P];b<this.max[P]+1;b++)b<this.max[P]&&b<this.max[P+1]+1&&this.innerFacets.push(["|"+b+"|"+P,"|"+b+"|"+(P+1),"|"+(b+1)+"|"+P]),P>0&&b<this.max[P-1]&&b+1<this.max[P]+1&&this.innerFacets.push(["|"+b+"|"+P,"|"+(b+1)+"|"+P,"|"+(b+1)+"|"+(P-1)])}edgeVecsABOB(){const b=this.m,d=this.n,P=new db(-d,b+d);for(let G=1;G<b+d;G++){const b=new db(this.min[G],G),d=new db(this.min[G-1],G-1),W=new db(this.min[G+1],G+1),i=b.clone(),q=d.clone(),C=W.clone();i.rotate60About(P),q.rotate60About(P),C.rotate60About(P);const J=new db(this.max[i.y],i.y),L=new db(this.max[i.y-1],i.y-1),x=new db(this.max[i.y-1]-1,i.y-1);i.x===J.x&&i.y===J.y||(i.x!==L.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([b,L,x]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([b,x,J])):i.y===C.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([b,d,L]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([b,L,W])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([b,d,L]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([b,L,J])))}}mapABOBtoOBOA(){const b=new db(0,0);for(let d=0;d<this.isoVecsABOB.length;d++){const P=[];for(let G=0;G<3;G++)b.x=this.isoVecsABOB[d][G].x,b.y=this.isoVecsABOB[d][G].y,0===this.vertexTypes[d][G]&&b.rotateNeg120(this.m,this.n),P.push(b.clone());this.isoVecsOBOA.push(P)}}mapABOBtoBAOA(){const b=new db(0,0);for(let d=0;d<this.isoVecsABOB.length;d++){const P=[];for(let G=0;G<3;G++)b.x=this.isoVecsABOB[d][G].x,b.y=this.isoVecsABOB[d][G].y,1===this.vertexTypes[d][G]&&b.rotate120(this.m,this.n),P.push(b.clone());this.isoVecsBAOA.push(P)}}MapToFace(b,d){const P=this.IDATA.face[b],W=P[2],i=P[1],q=P[0],C=G.ed.Od(this.IDATA.vertex[W]),J=G.ed.Od(this.IDATA.vertex[i]),L=G.ed.Od(this.IDATA.vertex[q]),x=J.Rd(C),Y=L.Rd(C),s=x.scale(this.coau).add(Y.scale(this.cobu)),E=x.scale(this.coav).add(Y.scale(this.cobv)),w=[];let t,r=G.TmpVectors.ed[0];for(let G=0;G<this.cartesian.length;G++)r=s.scale(this.cartesian[G].x).add(E.scale(this.cartesian[G].y)).add(C),w[G]=[r.x,r.y,r.z],t=b+"|"+this.vertices[G].x+"|"+this.vertices[G].y,d.vertex[this.vecToidx[t]]=[r.x,r.y,r.z]}build(b,d){const P=[],G=db.Zero(),W=new db(b,d),i=new db(-d,b+d);P.push(G,W,i);for(let o=d;o<b+1;o++)for(let d=0;d<b+1-o;d++)P.push(new db(d,o));if(d>0){const G=(0,c.HighestCommonFactor)(b,d),W=b/G,i=d/G;for(let C=1;C<G;C++)P.push(new db(C*W,C*i)),P.push(new db(-C*i,C*(W+i))),P.push(new db(b-C*(W+i),d+C*W));const q=b/d;for(let C=1;C<d;C++)for(let G=0;G<C*q;G++)P.push(new db(G,C)),P.push(new db(G,C).rotate120(b,d)),P.push(new db(G,C).rotateNeg120(b,d))}P.sort(((b,d)=>b.x-d.x)),P.sort(((b,d)=>b.y-d.y));const q=new Array(b+d+1),C=new Array(b+d+1);for(let o=0;o<q.length;o++)q[o]=1/0,C[o]=-1/0;let J=0,L=0;const x=P.length;for(let o=0;o<x;o++)L=P[o].x,J=P[o].y,q[J]=Math.min(L,q[J]),C[J]=Math.max(L,C[J]);const Y=(P,G)=>{const W=P.clone();return"A"===G&&W.rotateNeg120(b,d),"B"===G&&W.rotate120(b,d),W.x<0?W.y:W.x+W.y},s=[],E=[],w=[],t=[],r={},B=[];let n=-1,Z=-1;for(let o=0;o<x;o++)s[o]=P[o].toCartesianOrigin(new db(0,0),.5),E[o]=Y(P[o],"O"),w[o]=Y(P[o],"A"),t[o]=Y(P[o],"B"),E[o]===w[o]&&w[o]===t[o]?(n=3,Z=E[o]):E[o]===w[o]?(n=4,Z=E[o]):w[o]===t[o]?(n=5,Z=w[o]):t[o]===E[o]&&(n=6,Z=E[o]),E[o]<w[o]&&E[o]<t[o]&&(n=2,Z=E[o]),w[o]<E[o]&&w[o]<t[o]&&(n=1,Z=w[o]),t[o]<w[o]&&t[o]<E[o]&&(n=0,Z=t[o]),B.push([n,Z,P[o].x,P[o].y]);B.sort(((b,d)=>b[2]-d[2])),B.sort(((b,d)=>b[3]-d[3])),B.sort(((b,d)=>b[1]-d[1])),B.sort(((b,d)=>b[0]-d[0]));for(let o=0;o<B.length;o++)r[B[o][2]+"|"+B[o][3]]=[B[o][0],B[o][1],o];return this.m=b,this.n=d,this.vertices=P,this.vertByDist=r,this.cartesian=s,this.min=q,this.max=C,this}}class Gb{constructor(b,d,P,G){this.name=b,this.category=d,this.vertex=P,this.face=G}}class Wb extends Gb{innerToData(b,d){for(let P=0;P<d.innerFacets.length;P++)this.face.push(d.innerFacets[P].map((P=>d.vecToidx[b+P])))}mapABOBtoDATA(b,d){const P=d.IDATA.edgematch[b][0];for(let G=0;G<d.isoVecsABOB.length;G++){const W=[];for(let i=0;i<3;i++)0===d.vertexTypes[G][i]?W.push(b+"|"+d.isoVecsABOB[G][i].x+"|"+d.isoVecsABOB[G][i].y):W.push(P+"|"+d.isoVecsABOB[G][i].x+"|"+d.isoVecsABOB[G][i].y);this.face.push([d.vecToidx[W[0]],d.vecToidx[W[1]],d.vecToidx[W[2]]])}}mapOBOAtoDATA(b,d){const P=d.IDATA.edgematch[b][0];for(let G=0;G<d.isoVecsOBOA.length;G++){const W=[];for(let i=0;i<3;i++)1===d.vertexTypes[G][i]?W.push(b+"|"+d.isoVecsOBOA[G][i].x+"|"+d.isoVecsOBOA[G][i].y):W.push(P+"|"+d.isoVecsOBOA[G][i].x+"|"+d.isoVecsOBOA[G][i].y);this.face.push([d.vecToidx[W[0]],d.vecToidx[W[1]],d.vecToidx[W[2]]])}}mapBAOAtoDATA(b,d){const P=d.IDATA.edgematch[b][2];for(let G=0;G<d.isoVecsBAOA.length;G++){const W=[];for(let i=0;i<3;i++)1===d.vertexTypes[G][i]?W.push(b+"|"+d.isoVecsBAOA[G][i].x+"|"+d.isoVecsBAOA[G][i].y):W.push(P+"|"+d.isoVecsBAOA[G][i].x+"|"+d.isoVecsBAOA[G][i].y);this.face.push([d.vecToidx[W[0]],d.vecToidx[W[1]],d.vecToidx[W[2]]])}}orderData(b){const d=[];for(let i=0;i<13;i++)d[i]=[];const P=b.closestTo;for(let i=0;i<P.length;i++)P[i][0]>-1?P[i][1]>0&&d[P[i][0]].push([i,P[i][1]]):d[12].push([i,P[i][0]]);const G=[];for(let i=0;i<12;i++)G[i]=i;let W=12;for(let i=0;i<12;i++){d[i].sort(((b,d)=>b[1]-d[1]));for(let b=0;b<d[i].length;b++)G[d[i][b][0]]=W++}for(let i=0;i<d[12].length;i++)G[d[12][i][0]]=W++;for(let i=0;i<this.vertex.length;i++)this.vertex[i].push(G[i]);this.vertex.sort(((b,d)=>b[3]-d[3]));for(let i=0;i<this.vertex.length;i++)this.vertex[i].pop();for(let i=0;i<this.face.length;i++)for(let b=0;b<this.face[i].length;b++)this.face[i][b]=G[this.face[i][b]];this.sharedNodes=d[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(b,d){const P=[],G=[];let W=d.pop();G.push(W);let i=this.face[W].indexOf(b);i=(i+2)%3;let q=this.face[W][i];P.push(q);let C=0;for(;d.length>0;)W=d[C],this.face[W].indexOf(q)>-1?(i=(this.face[W].indexOf(q)+1)%3,q=this.face[W][i],P.push(q),G.push(W),d.splice(C,1),C=0):C++;return this.adjacentFaces.push(P),G}toGoldbergPolyhedronData(){const b=new Gb("GeoDual","Goldberg",[],[]);b.name="GD dual";const d=this.vertex.length,P=new Array(d);for(let J=0;J<d;J++)P[J]=[];for(let J=0;J<this.face.length;J++)for(let b=0;b<3;b++)P[this.face[J][b]].push(J);let G=0,W=0,i=0,q=[],C=[];this.adjacentFaces=[];for(let J=0;J<P.length;J++){b.face[J]=this.setOrder(J,P[J].concat([]));for(const d of P[J]){G=0,W=0,i=0,q=this.face[d];for(let b=0;b<3;b++)C=this.vertex[q[b]],G+=C[0],W+=C[1],i+=C[2];b.vertex[d]=[G/3,W/3,i/3]}}return b}static BuildGeodesicData(b){const d=new Wb("Geodesic-m-n","Geodesic",[[0,bb.f,-1],[-bb.f,1,0],[-1,0,-bb.f],[1,0,-bb.f],[bb.f,1,0],[0,bb.f,1],[-1,0,bb.f],[-bb.f,-1,0],[0,-bb.f,-1],[bb.f,-1,0],[1,0,bb.f],[0,-bb.f,1]],[]);b.setIndices(),b.calcCoeffs(),b.createInnerFacets(),b.edgeVecsABOB(),b.mapABOBtoOBOA(),b.mapABOBtoBAOA();for(let P=0;P<b.IDATA.face.length;P++)b.MapToFace(P,d),d.innerToData(P,b),"B"===b.IDATA.edgematch[P][1]&&d.mapABOBtoDATA(P,b),"O"===b.IDATA.edgematch[P][1]&&d.mapOBOAtoDATA(P,b),"A"===b.IDATA.edgematch[P][3]&&d.mapBAOAtoDATA(P,b);d.orderData(b);return d.vertex=d.vertex.map((function(b){const d=b[0],P=b[1],G=b[2],W=Math.sqrt(d*d+P*P+G*G);return b[0]*=1/W,b[1]*=1/W,b[2]*=1/W,b})),d}}W.d._GoldbergMeshParser=(b,d)=>ib.Parse(b,d);class ib extends W.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(b,d){return void 0===d?(b>this.goldbergData.nbUnsharedFaces-1&&(k.e.Warn("Maximum number of unshared faces used"),b=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+b):(b>11&&(k.e.Warn("Last pole used"),b=11),d>this.goldbergData.nbFacesAtPole-1&&(k.e.Warn("Maximum number of faces at a pole used"),d=this.goldbergData.nbFacesAtPole-1),12+b*this.goldbergData.nbFacesAtPole+d)}_changeGoldbergFaceColors(b){for(let P=0;P<b.length;P++){const d=b[P][0],G=b[P][1],W=b[P][2];for(let b=d;b<G+1;b++)this.goldbergData.faceColors[b]=W}const d=[];for(let P=0;P<12;P++)for(let b=0;b<5;b++)d.push(this.goldbergData.faceColors[P].r,this.goldbergData.faceColors[P].g,this.goldbergData.faceColors[P].b,this.goldbergData.faceColors[P].a);for(let P=12;P<this.goldbergData.faceColors.length;P++)for(let b=0;b<6;b++)d.push(this.goldbergData.faceColors[P].r,this.goldbergData.faceColors[P].g,this.goldbergData.faceColors[P].b,this.goldbergData.faceColors[P].a);return d}setGoldbergFaceColors(b){const d=this._changeGoldbergFaceColors(b);this.jb(i.c.ColorKind,d)}updateGoldbergFaceColors(b){const d=this._changeGoldbergFaceColors(b);this.updateVerticesData(i.c.ColorKind,d)}_changeGoldbergFaceUVs(b){const d=this.getVerticesData(i.c.UVKind);for(let P=0;P<b.length;P++){const G=b[P][0],W=b[P][1],i=b[P][2],q=b[P][3],C=b[P][4],J=[],L=[];let x,Y;for(let b=0;b<5;b++)x=i.x+q*Math.cos(C+b*Math.PI/2.5),Y=i.y+q*Math.sin(C+b*Math.PI/2.5),x<0&&(x=0),x>1&&(x=1),J.push(x,Y);for(let b=0;b<6;b++)x=i.x+q*Math.cos(C+b*Math.PI/3),Y=i.y+q*Math.sin(C+b*Math.PI/3),x<0&&(x=0),x>1&&(x=1),L.push(x,Y);for(let b=G;b<Math.min(12,W+1);b++)for(let P=0;P<5;P++)d[10*b+2*P]=J[2*P],d[10*b+2*P+1]=J[2*P+1];for(let b=Math.max(12,G);b<W+1;b++)for(let P=0;P<6;P++)d[12*b-24+2*P]=L[2*P],d[12*b-23+2*P]=L[2*P+1]}return d}setGoldbergFaceUVs(b){const d=this._changeGoldbergFaceUVs(b);this.jb(i.c.UVKind,d)}updateGoldbergFaceUVs(b){const d=this._changeGoldbergFaceUVs(b);this.updateVerticesData(i.c.UVKind,d)}placeOnGoldbergFaceAt(b,d,P){const W=G.ed.RotationFromAxis(this.goldbergData.faceXaxis[d],this.goldbergData.faceYaxis[d],this.goldbergData.faceZaxis[d]);b.rotation=W,b.position=this.goldbergData.faceCenters[d].add(this.goldbergData.faceXaxis[d].scale(P.x)).add(this.goldbergData.faceYaxis[d].scale(P.y)).add(this.goldbergData.faceZaxis[d].scale(P.z))}serialize(b){super.serialize(b),b.type="GoldbergMesh";const d={};if(d.adjacentFaces=this.goldbergData.adjacentFaces,d.nbSharedFaces=this.goldbergData.nbSharedFaces,d.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,d.nbFaces=this.goldbergData.nbFaces,d.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){d.faceColors=[];for(const b of this.goldbergData.faceColors)d.faceColors.push(b.jd())}if(this.goldbergData.faceCenters){d.faceCenters=[];for(const b of this.goldbergData.faceCenters)d.faceCenters.push(b.jd())}if(this.goldbergData.faceZaxis){d.faceZaxis=[];for(const b of this.goldbergData.faceZaxis)d.faceZaxis.push(b.jd())}if(this.goldbergData.faceYaxis){d.faceYaxis=[];for(const b of this.goldbergData.faceYaxis)d.faceYaxis.push(b.jd())}if(this.goldbergData.faceXaxis){d.faceXaxis=[];for(const b of this.goldbergData.faceXaxis)d.faceXaxis.push(b.jd())}b.goldbergData=d}static Parse(b,d){const P=b.goldbergData;P.faceColors=P.faceColors.map((b=>s.ci.Od(b))),P.faceCenters=P.faceCenters.map((b=>G.ed.Od(b))),P.faceZaxis=P.faceZaxis.map((b=>G.ed.Od(b))),P.faceXaxis=P.faceXaxis.map((b=>G.ed.Od(b))),P.faceYaxis=P.faceYaxis.map((b=>G.ed.Od(b)));const W=new ib(b.name,d);return W.goldbergData=P,W}}var qb=P(12236);const Cb={CreateBox:Y.e,CreateTiledBox:r,CreateSphere:B.c,CreateDisc:x.b,CreateIcoSphere:y,CreateRibbon:L,CreateCylinder:A,CreateTorus:g,CreateTorusKnot:u,CreateLineSystem:M.g,sL:M.k,CreateDashedLines:M.c,ExtrudeShape:U,ExtrudeShapeCustom:H,CreateLathe:S,CreateTiledPlane:w,tL:l.c,CreateGround:N.e,CreateTiledGround:N.h,CreateGroundFromHeightMap:N.d,CreatePolygon:e.b,ExtrudePolygon:e.f,CreateTube:j,CreatePolyhedron:O,CreateGeodesic:function(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,G=d.m||1;G!==Math.floor(G)&&(G=Math.floor(G),k.e.Warn("m not an integer only floor(m) used"));let W=d.n||0;if(W!==Math.floor(W)&&(W=Math.floor(W),k.e.Warn("n not an integer only floor(n) used")),W>G){const b=W;W=G,G=b,k.e.Warn("n > m therefore m and n swapped")}const i=new Pb;return i.build(G,W),O(b,{custom:Wb.BuildGeodesicData(i),size:d.size,sizeX:d.sizeX,sizeY:d.sizeY,sizeZ:d.sizeZ,faceUV:d.faceUV,faceColors:d.faceColors,flat:d.flat,updatable:d.updatable,sideOrientation:d.sideOrientation,frontUVs:d.frontUVs,backUVs:d.backUVs},P)},CreateGoldberg:function(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const i=d.size,J=d.sizeX||i||1,L=d.sizeY||i||1,x=d.sizeZ||i||1;let Y=d.m||1;Y!==Math.floor(Y)&&(Y=Math.floor(Y),k.e.Warn("m not an integer only floor(m) used"));let E=d.n||0;if(E!==Math.floor(E)&&(E=Math.floor(E),k.e.Warn("n not an integer only floor(n) used")),E>Y){const b=E;E=Y,Y=b,k.e.Warn("n > m therefore m and n swapped")}const w=new Pb;w.build(Y,E);const t=Wb.BuildGeodesicData(w),r=t.toGoldbergPolyhedronData(),B=new ib(b,P);d.sideOrientation=W.d._GetDefaultSideOrientation(d.sideOrientation),B._originalBuilderSideOrientation=d.sideOrientation;(function(b,d){const P=b.size,W=b.sizeX||P||1,i=b.sizeY||P||1,J=b.sizeZ||P||1,L=0===b.sideOrientation?0:b.sideOrientation||q.e.DEFAULTSIDE,x=[],Y=[],s=[],E=[];let w=1/0,t=-1/0,r=1/0,B=-1/0;for(let G=0;G<d.vertex.length;G++)w=Math.min(w,d.vertex[G][0]*W),t=Math.max(t,d.vertex[G][0]*W),r=Math.min(r,d.vertex[G][1]*i),B=Math.max(B,d.vertex[G][1]*i);let n=0;for(let q=0;q<d.face.length;q++){const b=d.face[q],P=G.ed.Od(d.vertex[b[0]]),L=G.ed.Od(d.vertex[b[2]]),Z=G.ed.Od(d.vertex[b[1]]),o=L.Rd(P),A=Z.Rd(P),f=G.ed.Cross(A,o).normalize();for(let G=0;G<b.length;G++){s.push(f.x,f.y,f.z);const P=d.vertex[b[G]];x.push(P[0]*W,P[1]*i,P[2]*J);const q=(P[1]*i-r)/(B-r);E.push((P[0]*W-w)/(t-w),C.e?1-q:q)}for(let d=0;d<b.length-2;d++)Y.push(n,n+d+2,n+d+1);n+=b.length}q.e._ComputeSides(L,x,Y,s,E);const Z=new q.e;return Z.Mb=x,Z.indices=Y,Z.eb=s,Z.Ub=E,Z})(d,r).pb(B,d.updatable),B.goldbergData.nbSharedFaces=t.sharedNodes,B.goldbergData.nbUnsharedFaces=t.poleNodes,B.goldbergData.adjacentFaces=t.adjacentFaces,B.goldbergData.nbFaces=B.goldbergData.nbSharedFaces+B.goldbergData.nbUnsharedFaces,B.goldbergData.nbFacesAtPole=(B.goldbergData.nbUnsharedFaces-12)/12;for(let W=0;W<t.vertex.length;W++)B.goldbergData.faceCenters.push(G.ed.Od(t.vertex[W])),B.goldbergData.faceCenters[W].x*=J,B.goldbergData.faceCenters[W].y*=L,B.goldbergData.faceCenters[W].z*=x,B.goldbergData.faceColors.push(new s.ci(1,1,1,1));for(let W=0;W<r.face.length;W++){const b=r.face[W],d=G.ed.Od(r.vertex[b[0]]),P=G.ed.Od(r.vertex[b[2]]),i=G.ed.Od(r.vertex[b[1]]),q=P.Rd(d),C=i.Rd(d),J=G.ed.Cross(C,q).normalize(),L=G.ed.Cross(C,J).normalize();B.goldbergData.faceXaxis.push(C.normalize()),B.goldbergData.faceYaxis.push(J),B.goldbergData.faceZaxis.push(L)}return B},CreateDecal:h,CreateCapsule:K,CreateText:qb.f}},12959:(b,d,P)=>{"use strict";P.d(d,{e:()=>Cd});var G=P(11681),W=P(12063);class i extends W.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var q=P(11725),C=(P(11844),P(11639));class J{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(b){this._targetStopDuration!==b&&(this._targetStopDuration=b)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(b){this._noiseTexture!==b&&(this._noiseTexture=b,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(b){this._animationSheetEnabled!==b&&(this._animationSheetEnabled=b)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(b){this._isAnimationSheetEnabled!=b&&(this._isAnimationSheetEnabled=b,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(b){this._useLogarithmicDepth=b&&this.Xb().getEngine().getCaps().fragmentDepthSupported}Xb(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(b){switch(b){case J.BLENDMODE_MULTIPLYADD:return;case J.BLENDMODE_ADD:b=1;break;case J.BLENDMODE_ONEONE:b=6;break;case J.BLENDMODE_STANDARD:b=2;break;case J.BLENDMODE_MULTIPLY:b=4;break;case J.BLENDMODE_SUBTRACT:b=3}this._engine.setAlphaMode(b)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:G.ed.Zero()}set direction1(b){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=b)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:G.ed.Zero()}set direction2(b){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=b)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:G.ed.Zero()}set minEmitBox(b){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=b)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:G.ed.Zero()}set maxEmitBox(b){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=b)}get billboardMode(){return this._billboardMode}set billboardMode(b){this._billboardMode!==b&&(this._billboardMode=b,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(b){this._isBillboardBased!==b&&(this._isBillboardBased=b,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(b){this._attachImageProcessingConfiguration(b)}_attachImageProcessingConfiguration(b){b!==this._imageProcessingConfiguration&&(!b&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=b)}_reset(){}_removeGradientAndTexture(b,d,P){if(!d)return this;let G=0;for(const W of d){if(W.gradient===b){d.splice(G,1);break}G++}return P&&P.dispose(),this}constructor(b){this.animations=[],this.renderingGroupId=0,this.qd=G.ed.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new G.ed(10,10,10),this.onAnimationEnd=null,this.blendMode=J.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new G.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.LL=new G.ed(0,0,0),this._useLogarithmicDepth=!1,this.gravity=G.ed.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new q.ci(1,1,1,1),this.color2=new q.ci(1,1,1,1),this.colorDead=new q.ci(0,0,0,1),this.textureMask=new q.ci(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new i,this.id=b,this.name=b}createPointEmitter(b,d){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new G.ed(0,1,0),arguments.length>2&&void 0!==arguments[2]||new G.ed(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new G.ed(0,1,0),arguments.length>4&&void 0!==arguments[4]||new G.ed(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new G.ed(0,1,0),arguments.length>3&&void 0!==arguments[3]||new G.ed(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(b,d,P,G){throw new Error("Method not implemented.")}}J.BLENDMODE_ONEONE=0,J.BLENDMODE_STANDARD=1,J.BLENDMODE_ADD=2,J.BLENDMODE_MULTIPLY=3,J.BLENDMODE_MULTIPLYADD=4,J.BLENDMODE_SUBTRACT=-1,(0,C.f)("BABYLON.BaseParticleSystem",J);var L=P(11700),x=P(11510);class Y{constructor(){this.direction1=new G.ed(0,1,0),this.direction2=new G.ed(0,1,0),this.minEmitBox=new G.ed(-.5,-.5,-.5),this.maxEmitBox=new G.ed(.5,.5,.5)}startDirectionFunction(b,d,P,W){const i=(0,L.RandomRange)(this.direction1.x,this.direction2.x),q=(0,L.RandomRange)(this.direction1.y,this.direction2.y),C=(0,L.RandomRange)(this.direction1.z,this.direction2.z);if(W)return d.x=i,d.y=q,void(d.z=C);G.ed.TransformNormalFromFloatsToRef(i,q,C,b,d)}startPositionFunction(b,d,P,W){const i=(0,L.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),q=(0,L.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),C=(0,L.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(W)return d.x=i,d.y=q,void(d.z=C);G.ed.TransformCoordinatesFromFloatsToRef(i,q,C,b,d)}clone(){const b=new Y;return x.b.DeepCopy(this,b),b}applyToShader(b){b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2),b.setVector3("minEmitBox",this.minEmitBox),b.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(b){b.addUniform("direction1",3),b.addUniform("direction2",3),b.addUniform("minEmitBox",3),b.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.direction1=this.direction1.jd(),b.direction2=this.direction2.jd(),b.minEmitBox=this.minEmitBox.jd(),b.maxEmitBox=this.maxEmitBox.jd(),b}parse(b){G.ed.FromArrayToRef(b.direction1,0,this.direction1),G.ed.FromArrayToRef(b.direction2,0,this.direction2),G.ed.FromArrayToRef(b.minEmitBox,0,this.minEmitBox),G.ed.FromArrayToRef(b.maxEmitBox,0,this.maxEmitBox)}}class s{get radius(){return this._radius}set radius(b){this._radius=b,this._buildHeight()}get angle(){return this._angle}set angle(b){this._angle=b,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=P,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=d,this.radius=b}startDirectionFunction(b,d,P,W){W?G.TmpVectors.ed[0].q(P.DC).normalize():P.position.subtractToRef(b.getTranslation(),G.TmpVectors.ed[0]).normalize();const i=(0,L.RandomRange)(0,this.directionRandomizer),q=(0,L.RandomRange)(0,this.directionRandomizer),C=(0,L.RandomRange)(0,this.directionRandomizer);d.x=G.TmpVectors.ed[0].x+i,d.y=G.TmpVectors.ed[0].y+q,d.z=G.TmpVectors.ed[0].z+C,d.normalize()}startPositionFunction(b,d,P,W){const i=(0,L.RandomRange)(0,2*Math.PI);let q;this.emitFromSpawnPointOnly?q=1e-4:(q=(0,L.RandomRange)(0,this.heightRange),q=1-q*q);let C=this._radius-(0,L.RandomRange)(0,this._radius*this.radiusRange);C*=q;const J=C*Math.sin(i),x=C*Math.cos(i),Y=q*this._height;if(W)return d.x=J,d.y=Y,void(d.z=x);G.ed.TransformCoordinatesFromFloatsToRef(J,Y,x,b,d)}clone(){const b=new s(this._radius,this._angle,this.directionRandomizer);return x.b.DeepCopy(this,b),b}applyToShader(b){b.setFloat2("radius",this._radius,this.radiusRange),b.setFloat("coneAngle",this._angle),b.setFloat2("height",this._height,this.heightRange),b.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(b){b.addUniform("radius",2),b.addUniform("coneAngle",1),b.addUniform("height",2),b.addUniform("directionRandomizer",1)}getEffectDefines(){let b="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(b+="\n#define CONEEMITTERSPAWNPOINT"),b}getClassName(){return"ConeParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.radius=this._radius,b.angle=this._angle,b.directionRandomizer=this.directionRandomizer,b.radiusRange=this.radiusRange,b.heightRange=this.heightRange,b.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,b}parse(b){this.radius=b.radius,this.angle=b.angle,this.directionRandomizer=b.directionRandomizer,this.radiusRange=void 0!==b.radiusRange?b.radiusRange:1,this.heightRange=void 0!==b.radiusRange?b.heightRange:1,this.emitFromSpawnPointOnly=void 0!==b.emitFromSpawnPointOnly&&b.emitFromSpawnPointOnly}}class E extends s{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new G.ed(0,1,0),W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new G.ed(0,1,0);super(b,d),this.direction1=P,this.direction2=W}startDirectionFunction(b,d){const P=(0,L.RandomRange)(this.direction1.x,this.direction2.x),W=(0,L.RandomRange)(this.direction1.y,this.direction2.y),i=(0,L.RandomRange)(this.direction1.z,this.direction2.z);G.ed.TransformNormalFromFloatsToRef(P,W,i,b,d)}clone(){const b=new E(this.radius,this.angle,this.direction1,this.direction2);return x.b.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("radiusRange",this.radiusRange),b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("radiusRange",1),b.addUniform("direction1",3),b.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const b=super.serialize();return b.direction1=this.direction1.jd(),b.direction2=this.direction2.jd(),b}parse(b){super.parse(b),this.direction1.q(b.direction1),this.direction2.q(b.direction2)}}class w{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=b,this.height=d,this.radiusRange=P,this.directionRandomizer=W,this._tempVector=G.ed.Zero()}startDirectionFunction(b,d,P,W,i){P.position.subtractToRef(b.getTranslation(),this._tempVector),this._tempVector.normalize(),G.ed.TransformNormalToRef(this._tempVector,i,this._tempVector);const q=(0,L.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let C=Math.atan2(this._tempVector.x,this._tempVector.z);C+=(0,L.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=q,this._tempVector.x=Math.sin(C),this._tempVector.z=Math.cos(C),this._tempVector.normalize(),W?d.q(this._tempVector):G.ed.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,b,d)}startPositionFunction(b,d,P,W){const i=(0,L.RandomRange)(-this.height/2,this.height/2),q=(0,L.RandomRange)(0,2*Math.PI),C=(0,L.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),J=Math.sqrt(C)*this.radius,x=J*Math.cos(q),Y=J*Math.sin(q);W?d.Fd(x,i,Y):G.ed.TransformCoordinatesFromFloatsToRef(x,i,Y,b,d)}clone(){const b=new w(this.radius,this.directionRandomizer);return x.b.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("height",this.height),b.setFloat("radiusRange",this.radiusRange),b.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("height",1),b.addUniform("radiusRange",1),b.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.radius=this.radius,b.height=this.height,b.radiusRange=this.radiusRange,b.directionRandomizer=this.directionRandomizer,b}parse(b){this.radius=b.radius,this.height=b.height,this.radiusRange=b.radiusRange,this.directionRandomizer=b.directionRandomizer}}class t extends w{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new G.ed(0,1,0),i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new G.ed(0,1,0);super(b,d,P),this.direction1=W,this.direction2=i}startDirectionFunction(b,d,P,W){const i=(0,L.RandomRange)(this.direction1.x,this.direction2.x),q=(0,L.RandomRange)(this.direction1.y,this.direction2.y),C=(0,L.RandomRange)(this.direction1.z,this.direction2.z);W?d.Fd(i,q,C):G.ed.TransformNormalFromFloatsToRef(i,q,C,b,d)}clone(){const b=new t(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return x.b.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("height",this.height),b.setFloat("radiusRange",this.radiusRange),b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("height",1),b.addUniform("radiusRange",1),b.addUniform("direction1",3),b.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const b=super.serialize();return b.direction1=this.direction1.jd(),b.direction2=this.direction2.jd(),b}parse(b){super.parse(b),G.ed.FromArrayToRef(b.direction1,0,this.direction1),G.ed.FromArrayToRef(b.direction2,0,this.direction2)}}class r{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=b,this.radiusRange=d,this.directionRandomizer=P}startDirectionFunction(b,d,P,W){const i=P.position.Rd(b.getTranslation()).normalize(),q=(0,L.RandomRange)(0,this.directionRandomizer),C=(0,L.RandomRange)(0,this.directionRandomizer),J=(0,L.RandomRange)(0,this.directionRandomizer);i.x+=q,i.y+=C,i.z+=J,i.normalize(),W?d.q(i):G.ed.TransformNormalFromFloatsToRef(i.x,i.y,i.z,b,d)}startPositionFunction(b,d,P,W){const i=this.radius-(0,L.RandomRange)(0,this.radius*this.radiusRange),q=(0,L.RandomRange)(0,1),C=(0,L.RandomRange)(0,2*Math.PI),J=Math.acos(2*q-1),x=i*Math.cos(C)*Math.sin(J),Y=i*Math.cos(J),s=i*Math.sin(C)*Math.sin(J);W?d.Fd(x,Math.abs(Y),s):G.ed.TransformCoordinatesFromFloatsToRef(x,Math.abs(Y),s,b,d)}clone(){const b=new r(this.radius,this.directionRandomizer);return x.b.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("radiusRange",this.radiusRange),b.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("radiusRange",1),b.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.radius=this.radius,b.radiusRange=this.radiusRange,b.directionRandomizer=this.directionRandomizer,b}parse(b){this.radius=b.radius,this.radiusRange=b.radiusRange,this.directionRandomizer=b.directionRandomizer}}class B{constructor(){this.direction1=new G.ed(0,1,0),this.direction2=new G.ed(0,1,0)}startDirectionFunction(b,d,P,W){const i=(0,L.RandomRange)(this.direction1.x,this.direction2.x),q=(0,L.RandomRange)(this.direction1.y,this.direction2.y),C=(0,L.RandomRange)(this.direction1.z,this.direction2.z);W?d.Fd(i,q,C):G.ed.TransformNormalFromFloatsToRef(i,q,C,b,d)}startPositionFunction(b,d,P,W){W?d.Fd(0,0,0):G.ed.TransformCoordinatesFromFloatsToRef(0,0,0,b,d)}clone(){const b=new B;return x.b.DeepCopy(this,b),b}applyToShader(b){b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)}buildUniformLayout(b){b.addUniform("direction1",3),b.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.direction1=this.direction1.jd(),b.direction2=this.direction2.jd(),b}parse(b){G.ed.FromArrayToRef(b.direction1,0,this.direction1),G.ed.FromArrayToRef(b.direction2,0,this.direction2)}}class n{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=b,this.radiusRange=d,this.directionRandomizer=P}startDirectionFunction(b,d,P,W){const i=P.position.Rd(b.getTranslation()).normalize(),q=(0,L.RandomRange)(0,this.directionRandomizer),C=(0,L.RandomRange)(0,this.directionRandomizer),J=(0,L.RandomRange)(0,this.directionRandomizer);i.x+=q,i.y+=C,i.z+=J,i.normalize(),W?d.q(i):G.ed.TransformNormalFromFloatsToRef(i.x,i.y,i.z,b,d)}startPositionFunction(b,d,P,W){const i=this.radius-(0,L.RandomRange)(0,this.radius*this.radiusRange),q=(0,L.RandomRange)(0,1),C=(0,L.RandomRange)(0,2*Math.PI),J=Math.acos(2*q-1),x=i*Math.cos(C)*Math.sin(J),Y=i*Math.cos(J),s=i*Math.sin(C)*Math.sin(J);W?d.Fd(x,Y,s):G.ed.TransformCoordinatesFromFloatsToRef(x,Y,s,b,d)}clone(){const b=new n(this.radius,this.directionRandomizer);return x.b.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("radiusRange",this.radiusRange),b.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("radiusRange",1),b.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.radius=this.radius,b.radiusRange=this.radiusRange,b.directionRandomizer=this.directionRandomizer,b}parse(b){this.radius=b.radius,this.radiusRange=b.radiusRange,this.directionRandomizer=b.directionRandomizer}}class Z extends n{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new G.ed(0,1,0),P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new G.ed(0,1,0);super(b),this.direction1=d,this.direction2=P}startDirectionFunction(b,d){const P=(0,L.RandomRange)(this.direction1.x,this.direction2.x),W=(0,L.RandomRange)(this.direction1.y,this.direction2.y),i=(0,L.RandomRange)(this.direction1.z,this.direction2.z);G.ed.TransformNormalFromFloatsToRef(P,W,i,b,d)}clone(){const b=new Z(this.radius,this.direction1,this.direction2);return x.b.DeepCopy(this,b),b}applyToShader(b){b.setFloat("radius",this.radius),b.setFloat("radiusRange",this.radiusRange),b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)}buildUniformLayout(b){b.addUniform("radius",1),b.addUniform("radiusRange",1),b.addUniform("direction1",3),b.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const b=super.serialize();return b.direction1=this.direction1.jd(),b.direction2=this.direction2.jd(),b}parse(b){super.parse(b),this.direction1.q(b.direction1),this.direction2.q(b.direction2)}}class o{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(b,d,P,W){const i=G.TmpVectors.ed[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,P,i);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,P,i);const b=G.TmpVectors.ed[1];i.subtractToRef(P.position,b),b.scaleToRef(1/P.lifeTime,i)}else i.set(0,0,0);W?d.q(i):G.ed.TransformNormalToRef(i,b,d)}startPositionFunction(b,d,P,W){const i=G.TmpVectors.ed[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,P,i):i.set(0,0,0),W?d.q(i):G.ed.TransformCoordinatesToRef(i,b,d)}clone(){const b=new o;return x.b.DeepCopy(this,b),b}applyToShader(b){}buildUniformLayout(b){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const b={};return b.type=this.getClassName(),b.particlePositionGenerator=this.particlePositionGenerator,b.particleDestinationGenerator=this.particleDestinationGenerator,b}parse(b){b.particlePositionGenerator&&(this.particlePositionGenerator=b.particlePositionGenerator),b.particleDestinationGenerator&&(this.particleDestinationGenerator=b.particleDestinationGenerator)}}var A=P(11752);class f{get mesh(){return this._mesh}set mesh(b){this._mesh!==b&&(this._mesh=b,b?(this._indices=b.Id(),this._positions=b.getVerticesData(A.c.PositionKind),this._normals=b.getVerticesData(A.c.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=G.ed.Zero(),this._mesh=null,this.direction1=new G.ed(0,1,0),this.direction2=new G.ed(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=b}startDirectionFunction(b,d,P,W){if(this.useMeshNormalsForDirection&&this._normals)return void G.ed.TransformNormalToRef(this._storedNormal,b,d);const i=(0,L.RandomRange)(this.direction1.x,this.direction2.x),q=(0,L.RandomRange)(this.direction1.y,this.direction2.y),C=(0,L.RandomRange)(this.direction1.z,this.direction2.z);W?d.Fd(i,q,C):G.ed.TransformNormalFromFloatsToRef(i,q,C,b,d)}startPositionFunction(b,d,P,W){if(!this._indices||!this._positions)return;const i=3*(Math.random()*(this._indices.length/3)|0),q=Math.random(),C=Math.random()*(1-q),J=1-q-C,L=this._indices[i],x=this._indices[i+1],Y=this._indices[i+2],s=G.TmpVectors.ed[0],E=G.TmpVectors.ed[1],w=G.TmpVectors.ed[2],t=G.TmpVectors.ed[3];G.ed.FromArrayToRef(this._positions,3*L,s),G.ed.FromArrayToRef(this._positions,3*x,E),G.ed.FromArrayToRef(this._positions,3*Y,w),t.x=q*s.x+C*E.x+J*w.x,t.y=q*s.y+C*E.y+J*w.y,t.z=q*s.z+C*E.z+J*w.z,W?d.Fd(t.x,t.y,t.z):G.ed.TransformCoordinatesFromFloatsToRef(t.x,t.y,t.z,b,d),this.useMeshNormalsForDirection&&this._normals&&(G.ed.FromArrayToRef(this._normals,3*L,s),G.ed.FromArrayToRef(this._normals,3*x,E),G.ed.FromArrayToRef(this._normals,3*Y,w),this._storedNormal.x=q*s.x+C*E.x+J*w.x,this._storedNormal.y=q*s.y+C*E.y+J*w.y,this._storedNormal.z=q*s.z+C*E.z+J*w.z)}clone(){const b=new f(this.mesh);return x.b.DeepCopy(this,b),b}applyToShader(b){b.setVector3("direction1",this.direction1),b.setVector3("direction2",this.direction2)}buildUniformLayout(b){b.addUniform("direction1",3),b.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var b;const d={};return d.type=this.getClassName(),d.direction1=this.direction1.jd(),d.direction2=this.direction2.jd(),d.meshId=null===(b=this.mesh)||void 0===b?void 0:b.id,d.useMeshNormalsForDirection=this.useMeshNormalsForDirection,d}parse(b,d){G.ed.FromArrayToRef(b.direction1,0,this.direction1),G.ed.FromArrayToRef(b.direction2,0,this.direction2),b.meshId&&d&&(this.mesh=d.getLastMeshById(b.meshId)),this.useMeshNormalsForDirection=b.useMeshNormalsForDirection}}class g{_isUbo(b){return void 0!==b.addUniform}constructor(b){this._isUbo(b)?(this.setMatrix3x3=b.updateMatrix3x3.bind(b),this.setMatrix2x2=b.updateMatrix2x2.bind(b),this.setFloat=b.updateFloat.bind(b),this.setFloat2=b.updateFloat2.bind(b),this.setFloat3=b.updateFloat3.bind(b),this.setFloat4=b.updateFloat4.bind(b),this.setFloatArray=b.updateFloatArray.bind(b),this.setArray=b.updateArray.bind(b),this.setIntArray=b.updateIntArray.bind(b),this.setMatrix=b.yd.bind(b),this.setMatrices=b.updateMatrices.bind(b),this.setVector3=b.updateVector3.bind(b),this.setVector4=b.updateVector4.bind(b),this.setColor3=b.updateColor3.bind(b),this.setColor4=b.updateColor4.bind(b),this.setDirectColor4=b.updateDirectColor4.bind(b),this.setInt=b.updateInt.bind(b),this.setInt2=b.updateInt2.bind(b),this.setInt3=b.updateInt3.bind(b),this.setInt4=b.updateInt4.bind(b)):(this.setMatrix3x3=b.setMatrix3x3.bind(b),this.setMatrix2x2=b.setMatrix2x2.bind(b),this.setFloat=b.setFloat.bind(b),this.setFloat2=b.setFloat2.bind(b),this.setFloat3=b.setFloat3.bind(b),this.setFloat4=b.setFloat4.bind(b),this.setFloatArray=b.setFloatArray.bind(b),this.setArray=b.setArray.bind(b),this.setIntArray=b.setIntArray.bind(b),this.setMatrix=b.setMatrix.bind(b),this.setMatrices=b.setMatrices.bind(b),this.setVector3=b.setVector3.bind(b),this.setVector4=b.setVector4.bind(b),this.setColor3=b.setColor3.bind(b),this.setColor4=b.setColor4.bind(b),this.setDirectColor4=b.setDirectColor4.bind(b),this.setInt=b.setInt.bind(b),this.setInt2=b.setInt2.bind(b),this.setInt3=b.setInt3.bind(b),this.setInt4=b.setInt4.bind(b))}}var X=P(11591);const u="gpuUpdateParticlesPixelShader",M="#version 300 es\nvoid main() {discard;}\n";X.c.ShadersStore[u]||(X.c.ShadersStore[u]=M);const e="gpuUpdateParticlesVertexShader",R="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";X.c.ShadersStore[e]||(X.c.ShadersStore[e]=R);(0,C.f)("BABYLON.WebGL2ParticleSystem",class{constructor(b,d){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=b,this._engine=d,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var b;return(null===(b=this._updateEffect)||void 0===b?void 0:b.isReady())??!1}createUpdateBuffer(b){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof o&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=b,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new g(this._updateEffect)}createVertexBuffers(b,d){this._updateVAO.push(this._createUpdateVAO(b)),this._renderVAO.push(this._engine.recordVertexArrayObject(d,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=d}createParticleBuffer(b){return b}bindDrawBuffers(b,d,P){P?this._engine.bindBuffers(this._renderVertexBuffers,P,d):this._engine.bindVertexArrayObject(this._renderVAO[b],null)}preUpdateParticleBuffer(){const b=this._engine;if(this._engine.enableEffect(this._updateEffect),!b.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(b,d,P){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[b],null);const G=this._engine;G.bindTransformFeedbackBuffer(d.getBuffer()),G.setRasterizerState(!1),G.beginTransformFeedback(!0),G.drawArraysType(3,0,P),G.endTransformFeedback(),G.setRasterizerState(!0),G.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let b=0;b<this._updateVAO.length;b++)this._engine.releaseVertexArrayObject(this._updateVAO[b]);this._updateVAO.length=0;for(let b=0;b<this._renderVAO.length;b++)this._engine.releaseVertexArrayObject(this._renderVAO[b]);this._renderVAO.length=0}_createUpdateVAO(b){const d={};d.position=b.createVertexBuffer("position",0,3);let P=3;d.age=b.createVertexBuffer("age",P,1),P+=1,d.size=b.createVertexBuffer("size",P,3),P+=3,d.life=b.createVertexBuffer("life",P,1),P+=1,d.seed=b.createVertexBuffer("seed",P,4),P+=4,d.direction=b.createVertexBuffer("direction",P,3),P+=3,this._parent.particleEmitterType instanceof o&&(d.initialPosition=b.createVertexBuffer("initialPosition",P,3),P+=3),this._parent._colorGradientsTexture||(d.color=b.createVertexBuffer("color",P,4),P+=4),this._parent._isBillboardBased||(d.initialDirection=b.createVertexBuffer("initialDirection",P,3),P+=3),this._parent.noiseTexture&&(d.noiseCoordinates1=b.createVertexBuffer("noiseCoordinates1",P,3),P+=3,d.noiseCoordinates2=b.createVertexBuffer("noiseCoordinates2",P,3),P+=3),this._parent._angularSpeedGradientsTexture?(d.angle=b.createVertexBuffer("angle",P,1),P+=1):(d.angle=b.createVertexBuffer("angle",P,2),P+=2),this._parent._isAnimationSheetEnabled&&(d.cellIndex=b.createVertexBuffer("cellIndex",P,1),P+=1,this._parent.spriteRandomStartCell&&(d.cellStartOffset=b.createVertexBuffer("cellStartOffset",P,1),P+=1));const G=this._engine.recordVertexArrayObject(d,null,this._updateEffect);return this._engine.bindArrayBuffer(null),G}});class U{constructor(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,G=arguments.length>3?arguments[3]:void 0;this._engine=b,this._label=G,this._engine._storageBuffers.push(this),this._create(d,P)}_create(b,d){this._bufferSize=b,this._creationFlags=d,this._buffer=this._engine.createStorageBuffer(b,d,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(b,d,P){this._buffer&&this._engine.updateStorageBuffer(this._buffer,b,d,P)}async read(b,d,P,G){return await this._engine.readFromStorageBuffer(this._buffer,b,d,P,G)}dispose(){const b=this._engine._storageBuffers,d=b.indexOf(this);-1!==d&&(b[d]=b[b.length-1],b.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var H=P(11663),p=P(11670),S=P(11716),l=P(11658),N=P(11971),j=P(11504),a=P(11623),O=P(11886);class V{constructor(){this._gpuTimeInFrameId=-1,this.counter=new O.c}_addDuration(b,d){b<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==b?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(d,!1),this._gpuTimeInFrameId=b):this.counter.addCount(d,!1))}}var y=P(11569);class c{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(b,d,P){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=b,this._engine=d,this.uniqueId=N.b.UniqueId,d.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new V),this._engine.getCaps().supportComputeShaders?G.bindingsMapping?(this._context=d.createComputeContext(),this._shaderPath=P,this._options={bindingsMapping:{},defines:[],...G}):j.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):j.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(b,d){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const G=this._bindings[b];this._bindings[b]={type:P?0:4,object:d,indexInGroupEntries:null===G||void 0===G?void 0:G.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!G||G.object!==d||G.type!==this._bindings[b].type)}setStorageTexture(b,d){const P=this._bindings[b];this._contextIsDirty||(this._contextIsDirty=!P||P.object!==d),this._bindings[b]={type:1,object:d,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}setExternalTexture(b,d){const P=this._bindings[b];this._contextIsDirty||(this._contextIsDirty=!P||P.object!==d),this._bindings[b]={type:6,object:d,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}setVideoTexture(b,d){return!!d.externalTexture&&(this.setExternalTexture(b,d.externalTexture),!0)}setUniformBuffer(b,d){const P=this._bindings[b];this._contextIsDirty||(this._contextIsDirty=!P||P.object!==d),this._bindings[b]={type:c._BufferIsDataBuffer(d)?7:2,object:d,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}setStorageBuffer(b,d){const P=this._bindings[b];this._contextIsDirty||(this._contextIsDirty=!P||P.object!==d),this._bindings[b]={type:c._BufferIsDataBuffer(d)?7:3,object:d,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}setTextureSampler(b,d){const P=this._bindings[b];this._contextIsDirty||(this._contextIsDirty=!P||!d.compareSampler(P.object)),this._bindings[b]={type:5,object:d,indexInGroupEntries:null===P||void 0===P?void 0:P.indexInGroupEntries}}isReady(){let b=this._effect;for(const W in this._bindings){const b=this._bindings[W],d=b.type,P=b.object;switch(d){case 0:case 4:case 1:if(!P.isReady())return!1;break;case 6:if(!P.isReady())return!1;break}}const d=[],P=this._shaderPath;if(this._options.defines)for(let W=0;W<this._options.defines.length;W++)d.push(this._options.defines[W]);const G=d.join("\n");return this._cachedDefines!==G&&(this._cachedDefines=G,b=this._engine.createComputeEffect(P,{defines:G,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=b),!!b.isReady()}dispatch(b,d,P){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,b,d,P,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const P=c._BufferIsDataBuffer(b)?b:b.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,P,d,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const d in this._bindings){const P=this._bindings[d];if(!this._options.bindingsMapping[d])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+d+"'");switch(P.type){case 0:{const G=this._samplers[d],W=P.object;var b;if(!G||!W._texture||!G.compareSampler(W._texture))this._samplers[d]=(new a.b).setParameters(W.wrapU,W.wrapV,W.wrapR,W.anisotropicFilteringLevel,W._texture.samplingMode,null===(b=W._texture)||void 0===b?void 0:b._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const b=P.object;b.getBuffer()!==P.buffer&&(P.buffer=b.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(b,d,P){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((W=>{(0,y.e)((()=>this.dispatch(b,d,P)),W,void 0,G)}))}serialize(){const b=S.c.Serialize(this);b.options=this._options,b.shaderPath=this._shaderPath,b.Cs={},b.textures={};for(const d in this._bindings){const P=this._bindings[d],G=P.object;switch(P.type){case 0:case 4:case 1:{const W=G.serialize();W&&(b.textures[d]=W,b.Cs[d]={type:P.type});break}}}return b}static Parse(b,d,P){const G=S.c.Parse((()=>new c(b.name,d.getEngine(),b.shaderPath,b.options)),b,d,P);for(const W in b.textures){const i=b.Cs[W],q=l.d.Parse(b.textures[W],d,P);0===i.type?G.setTexture(W,q):4===i.type?G.setTexture(W,q,!1):G.setStorageTexture(W,q)}return G}static _BufferIsDataBuffer(b){return void 0!==b.underlyingResource}}(0,H.d)([(0,p.G)()],c.prototype,"name",void 0),(0,H.d)([(0,p.G)()],c.prototype,"fastMode",void 0),(0,C.f)("BABYLON.ComputeShader",c);var D=P(11935);const z="gpuUpdateParticlesComputeShader",Q="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";X.c.ShadersStoreWGSL[z]||(X.c.ShadersStoreWGSL[z]=Q);(0,C.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(b,d){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=b,this._engine=d}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var b;return(null===(b=this._updateComputeShader)||void 0===b?void 0:b.isReady())??!1}createUpdateBuffer(b){var d;const P={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(P.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(P.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(P.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(P.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(P.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(P.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(P.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new c("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:P,defines:b.split("\n")}),null===(d=this._simParamsComputeShader)||void 0===d||d.dispose(),this._simParamsComputeShader=new D.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new g(this._simParamsComputeShader)}createVertexBuffers(b,d){this._renderVertexBuffers.push(d)}createParticleBuffer(b){const d=new U(this._engine,4*b.length,11,"ComputeShaderParticleSystemBuffer");return d.update(b),this._bufferComputeShader.push(d),d.getBuffer()}bindDrawBuffers(b,d,P){this._engine.bindBuffers(this._renderVertexBuffers[b],P,d)}preUpdateParticleBuffer(){}updateParticleBuffer(b,d,P){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[b]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^b]),this._updateComputeShader.dispatch(Math.ceil(P/64))}releaseBuffers(){var b;for(let d=0;d<this._bufferComputeShader.length;++d)this._bufferComputeShader[d].dispose();this._bufferComputeShader.length=0,null===(b=this._simParamsComputeShader)||void 0===b||b.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class I{constructor(b,d,P){this.gradient=b,this.color1=d,this.color2=P}getColorToRef(b){this.color2?q.ci.LerpToRef(this.color1,this.color2,Math.random(),b):b.q(this.color1)}}class m{constructor(b,d){this.gradient=b,this.color=d}}class v{constructor(b,d,P){this.gradient=b,this.factor1=d,this.factor2=P}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class F{static GetCurrentGradient(b,d,P){if(d[0].gradient>b)return void P(d[0],d[0],1);for(let W=0;W<d.length-1;W++){const G=d[W],i=d[W+1];if(b>=G.gradient&&b<=i.gradient){return void P(G,i,(b-G.gradient)/(i.gradient-G.gradient))}}const G=d.length-1;P(d[G],d[G],1)}}var h=P(11487),T=P(12160),K=P(11535);class k{constructor(b){this.particleSystem=b,this.position=G.ed.Zero(),this.direction=G.ed.Zero(),this.color=new q.ci(0,0,0,0),this.colorStep=new q.ci(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new G.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new q.ci(0,0,0,0),this._currentColor2=new q.ci(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=k._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let b=this.age,d=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===d?(d=1,b=this._randomCellOffset):b+=this._randomCellOffset);const P=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let G;G=this._initialSpriteCellLoop?(0,L.Clamp)(b*d%this.lifeTime/this.lifeTime):(0,L.Clamp)(b*d/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+G*P|0}_inheritParticleInfoToSubEmitter(b){if(b.particleSystem.qd.position){const d=b.particleSystem.qd;if(d.position.q(this.position),b.inheritDirection){const b=G.TmpVectors.ed[0];this.direction.normalizeToRef(b),d.setDirection(b,0,Math.PI/2)}}else{b.particleSystem.qd.q(this.position)}this.direction.scaleToRef(b.inheritedVelocityAmount/2,G.TmpVectors.ed[0]),b.particleSystem._inheritedVelocityOffset.q(G.TmpVectors.ed[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const b of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(b)}_reset(){this.age=0,this.id=k._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(b){b.position.q(this.position),this._initialDirection?b._initialDirection?b._initialDirection.q(this._initialDirection):b._initialDirection=this._initialDirection.clone():b._initialDirection=null,b.direction.q(this.direction),this.DC&&(b.DC?b.DC.q(this.DC):b.DC=this.DC.clone()),b.color.q(this.color),b.colorStep.q(this.colorStep),b.lifeTime=this.lifeTime,b.age=this.age,b._randomCellOffset=this._randomCellOffset,b.size=this.size,b.scale.q(this.scale),b.angle=this.angle,b.angularSpeed=this.angularSpeed,b.particleSystem=this.particleSystem,b.cellIndex=this.cellIndex,b.id=this.id,b._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(b._currentColorGradient=this._currentColorGradient,b._currentColor1.q(this._currentColor1),b._currentColor2.q(this._currentColor2)),this._currentSizeGradient&&(b._currentSizeGradient=this._currentSizeGradient,b._currentSize1=this._currentSize1,b._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(b._currentAngularSpeedGradient=this._currentAngularSpeedGradient,b._currentAngularSpeed1=this._currentAngularSpeed1,b._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(b._currentVelocityGradient=this._currentVelocityGradient,b._currentVelocity1=this._currentVelocity1,b._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(b._currentLimitVelocityGradient=this._currentLimitVelocityGradient,b._currentLimitVelocity1=this._currentLimitVelocity1,b._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(b._currentDragGradient=this._currentDragGradient,b._currentDrag1=this._currentDrag1,b._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(b._initialStartSpriteCellId=this._initialStartSpriteCellId,b._initialEndSpriteCellId=this._initialEndSpriteCellId,b._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(b.remapData&&this.remapData?b.remapData.q(this.remapData):b.remapData=new G.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(b._randomNoiseCoordinates1?(b._randomNoiseCoordinates1.q(this._randomNoiseCoordinates1),b._randomNoiseCoordinates2.q(this._randomNoiseCoordinates2)):(b._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),b._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}k._Count=0;var bb=P(11798),db=(P(11841),P(12049)),Pb=P(12045),Gb=P(11926);function Wb(b,d){const P=(0,L.RandomRange)(0,1);q.ci.LerpToRef(d.color1,d.color2,P,b.color),d.colorDead.subtractToRef(b.color,d._colorDiff),d._colorDiff.scaleToRef(1/b.lifeTime,b.colorStep)}function ib(b,d){b._currentColorGradient=d._colorGradients[0],b._currentColorGradient.getColorToRef(b.color),b._currentColor1.q(b.color),d._colorGradients.length>1?d._colorGradients[1].getColorToRef(b._currentColor2):b._currentColor2.q(b.color)}function qb(b,d){const P=d._colorGradients;F.GetCurrentGradient(d._ratio,P,((d,P,G)=>{d!==b._currentColorGradient&&(b._currentColor1.q(b._currentColor2),P.getColorToRef(b._currentColor2),b._currentColorGradient=d),q.ci.LerpToRef(b._currentColor1,b._currentColor2,G,b.color)}))}function Cb(b,d){b.colorStep.scaleToRef(d._scaledUpdateSpeed,d._scaledColorStep),b.color.addInPlace(d._scaledColorStep),b.color.a<0&&(b.color.a=0)}function Jb(b,d){F.GetCurrentGradient(d._ratio,d._angularSpeedGradients,((d,P,G)=>{d!==b._currentAngularSpeedGradient&&(b._currentAngularSpeed1=b._currentAngularSpeed2,b._currentAngularSpeed2=P.getFactor(),b._currentAngularSpeedGradient=d),b.angularSpeed=(0,L.Lerp)(b._currentAngularSpeed1,b._currentAngularSpeed2,G)}))}function Lb(b,d){b.angle+=b.angularSpeed*d._scaledUpdateSpeed}function xb(b,d){d.particleEmitterType.startDirectionFunction(d._emitterWorldMatrix,b.direction,b,d.isLocal,d._emitterInverseWorldMatrix)}function Yb(b,d){d.startDirectionFunction(d._emitterWorldMatrix,b.direction,b,d.isLocal)}function sb(b,d){b._currentVelocityGradient=d._velocityGradients[0],b._currentVelocity1=b._currentVelocityGradient.getFactor(),d._velocityGradients.length>1?b._currentVelocity2=d._velocityGradients[1].getFactor():b._currentVelocity2=b._currentVelocity1}function Eb(b,d){b._currentLimitVelocityGradient=d._limitVelocityGradients[0],b._currentLimitVelocity1=b._currentLimitVelocityGradient.getFactor(),d._limitVelocityGradients.length>1?b._currentLimitVelocity2=d._limitVelocityGradients[1].getFactor():b._currentLimitVelocity2=b._currentLimitVelocity1}function wb(b,d){F.GetCurrentGradient(d._ratio,d._velocityGradients,((P,G,W)=>{P!==b._currentVelocityGradient&&(b._currentVelocity1=b._currentVelocity2,b._currentVelocity2=G.getFactor(),b._currentVelocityGradient=P),d._directionScale*=(0,L.Lerp)(b._currentVelocity1,b._currentVelocity2,W)}))}function tb(b,d){F.GetCurrentGradient(d._ratio,d._limitVelocityGradients,((P,G,W)=>{P!==b._currentLimitVelocityGradient&&(b._currentLimitVelocity1=b._currentLimitVelocity2,b._currentLimitVelocity2=G.getFactor(),b._currentLimitVelocityGradient=P);const i=(0,L.Lerp)(b._currentLimitVelocity1,b._currentLimitVelocity2,W);b.direction.length()>i&&b.direction.scaleInPlace(d.limitVelocityDamping)}))}function rb(b,d){b.direction.scaleToRef(d._directionScale,d._scaledDirection)}function Bb(b,d){d.particleEmitterType.startPositionFunction(d._emitterWorldMatrix,b.position,b,d.isLocal)}function nb(b,d){d.startPositionFunction(d._emitterWorldMatrix,b.position,b,d.isLocal)}function Zb(b,d){b.DC?b.DC.q(b.position):b.DC=b.position.clone(),G.ed.TransformCoordinatesToRef(b.DC,d._emitterWorldMatrix,b.position)}function ob(b,d){d.isLocal&&b.DC?(b.DC.addInPlace(d._scaledDirection),G.ed.TransformCoordinatesToRef(b.DC,d._emitterWorldMatrix,b.position)):b.position.addInPlace(d._scaledDirection)}function Ab(b,d){b._currentDragGradient=d._dragGradients[0],b._currentDrag1=b._currentDragGradient.getFactor(),d._dragGradients.length>1?b._currentDrag2=d._dragGradients[1].getFactor():b._currentDrag2=b._currentDrag1}function fb(b,d){F.GetCurrentGradient(d._ratio,d._dragGradients,((P,G,W)=>{P!==b._currentDragGradient&&(b._currentDrag1=b._currentDrag2,b._currentDrag2=G.getFactor(),b._currentDragGradient=P);const i=(0,L.Lerp)(b._currentDrag1,b._currentDrag2,W);d._scaledDirection.scaleInPlace(1-i)}))}function gb(b,d){b._randomNoiseCoordinates1?(b._randomNoiseCoordinates1.Fd(Math.random(),Math.random(),Math.random()),b._randomNoiseCoordinates2.Fd(Math.random(),Math.random(),Math.random())):(b._randomNoiseCoordinates1=new G.ed(Math.random(),Math.random(),Math.random()),b._randomNoiseCoordinates2=new G.ed(Math.random(),Math.random(),Math.random()))}function Xb(b,d){const P=d._noiseTextureData,W=d._noiseTextureSize;if(P&&W&&b._randomNoiseCoordinates1){const i=d._fetchR(b._randomNoiseCoordinates1.x,b._randomNoiseCoordinates1.y,W.width,W.height,P),q=d._fetchR(b._randomNoiseCoordinates1.z,b._randomNoiseCoordinates2.x,W.width,W.height,P),C=d._fetchR(b._randomNoiseCoordinates2.y,b._randomNoiseCoordinates2.z,W.width,W.height,P),J=G.TmpVectors.ed[0],L=G.TmpVectors.ed[1];J.Fd((2*i-1)*d.noiseStrength.x,(2*q-1)*d.noiseStrength.y,(2*C-1)*d.noiseStrength.z),J.scaleToRef(d._tempScaledUpdateSpeed,L),b.direction.addInPlace(L)}}function ub(b,d){d.gravity.scaleToRef(d._tempScaledUpdateSpeed,d._scaledGravity),b.direction.addInPlace(d._scaledGravity)}function Mb(b,d){b.size=(0,L.RandomRange)(d.minSize,d.maxSize),b.scale.Fd((0,L.RandomRange)(d.minScaleX,d.maxScaleX),(0,L.RandomRange)(d.minScaleY,d.maxScaleY))}function eb(b,d){b._currentSizeGradient=d._sizeGradients[0],b._currentSize1=b._currentSizeGradient.getFactor(),b.size=b._currentSize1,d._sizeGradients.length>1?b._currentSize2=d._sizeGradients[1].getFactor():b._currentSize2=b._currentSize1,b.scale.Fd((0,L.RandomRange)(d.minScaleX,d.maxScaleX),(0,L.RandomRange)(d.minScaleY,d.maxScaleY))}function Rb(b,d){const P=d._actualFrame/d.targetStopDuration;F.GetCurrentGradient(P,d._startSizeGradients,((P,G,W)=>{P!==d._currentStartSizeGradient&&(d._currentStartSize1=d._currentStartSize2,d._currentStartSize2=G.getFactor(),d._currentStartSizeGradient=P);const i=(0,L.Lerp)(d._currentStartSize1,d._currentStartSize2,W);b.scale.scaleInPlace(i)}))}function Ub(b,d){F.GetCurrentGradient(d._ratio,d._sizeGradients,((d,P,G)=>{d!==b._currentSizeGradient&&(b._currentSize1=b._currentSize2,b._currentSize2=P.getFactor(),b._currentSizeGradient=d),b.size=(0,L.Lerp)(b._currentSize1,b._currentSize2,G)}))}function Hb(b,d){b.remapData=new G.Vector4(0,1,0,1)}function pb(b,d){d._colorRemapGradients&&d._colorRemapGradients.length>0&&F.GetCurrentGradient(d._ratio,d._colorRemapGradients,((d,P,G)=>{const W=(0,L.Lerp)(d.factor1,P.factor1,G),i=(0,L.Lerp)(d.factor2,P.factor2,G);b.remapData.x=W,b.remapData.y=i-W})),d._alphaRemapGradients&&d._alphaRemapGradients.length>0&&F.GetCurrentGradient(d._ratio,d._alphaRemapGradients,((d,P,G)=>{const W=(0,L.Lerp)(d.factor1,P.factor1,G),i=(0,L.Lerp)(d.factor2,P.factor2,G);b.remapData.z=W,b.remapData.w=i-W}))}function Sb(b,d){const P=(0,L.Clamp)(d._actualFrame/d.targetStopDuration);F.GetCurrentGradient(P,d._lifeTimeGradients,((d,G)=>{const W=d,i=G,q=W.getFactor(),C=i.getFactor(),J=(P-W.gradient)/(i.gradient-W.gradient);b.lifeTime=(0,L.Lerp)(q,C,J)})),d._emitPower=(0,L.RandomRange)(d.minEmitPower,d.maxEmitPower)}function lb(b,d){b.lifeTime=(0,L.RandomRange)(d.minLifeTime,d.maxLifeTime),d._emitPower=(0,L.RandomRange)(d.minEmitPower,d.maxEmitPower)}function Nb(b,d){0===d._emitPower?(b._initialDirection?b._initialDirection.q(b.direction):b._initialDirection=b.direction.clone(),b.direction.set(0,0,0)):(b._initialDirection=null,b.direction.scaleInPlace(d._emitPower)),b.direction.addInPlace(d._inheritedVelocityOffset)}function jb(b,d){b.angularSpeed=(0,L.RandomRange)(d.minAngularSpeed,d.maxAngularSpeed),b.angle=(0,L.RandomRange)(d.minInitialRotation,d.maxInitialRotation)}function ab(b,d){b._currentAngularSpeedGradient=d._angularSpeedGradients[0],b.angularSpeed=b._currentAngularSpeedGradient.getFactor(),b._currentAngularSpeed1=b.angularSpeed,d._angularSpeedGradients.length>1?b._currentAngularSpeed2=d._angularSpeedGradients[1].getFactor():b._currentAngularSpeed2=b._currentAngularSpeed1,b.angle=(0,L.RandomRange)(d.minInitialRotation,d.maxInitialRotation)}function Ob(b,d){b._initialStartSpriteCellId=d.startSpriteCellID,b._initialEndSpriteCellId=d.endSpriteCellID,b._initialSpriteCellLoop=d.spriteCellLoop}function Vb(b,d){b.previousItem=d.previousItem,b.nextItem=d,d.previousItem&&(d.previousItem.nextItem=b),d.previousItem=b}function yb(b,d){b.previousItem=d,b.nextItem=d.nextItem,d.nextItem&&(d.nextItem.previousItem=b),d.nextItem=b}function cb(b,d){let P=d;for(;P.nextItem;)P=P.nextItem;b.previousItem=P,b.nextItem=P.nextItem,P.nextItem=b}function Db(b){b.previousItem&&(b.previousItem.nextItem=b.nextItem),b.nextItem&&(b.nextItem.previousItem=b.previousItem)}class zb extends J{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(b){this._startDirectionFunction!==b&&(this._startDirectionFunction=b,this._directionProcessing.process=b?Yb:xb)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(b){this._startPositionFunction!==b&&(this._startPositionFunction=b,this._positionCreation.process=b?nb:Bb)}set onDispose(b){this._onDisposeObserver&&this.Zd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Zd.add(b)}get L(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(b){this._useRampGradients!==b&&(this._useRampGradients=b,this._resetEffect(),b?(this._rampCreation={process:Hb,previousItem:null,nextItem:null},yb(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:pb,previousItem:null,nextItem:null},yb(this._remapGradientProcessing,this._gravityProcessing)):(Db(this._rampCreation),Db(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(b){this._isLocal!==b&&(this._isLocal=b,b?(this._isLocalCreation={process:Zb,previousItem:null,nextItem:null},yb(this._isLocalCreation,this._positionCreation)):Db(this._isLocalCreation))}get particles(){return this.ds}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(b){this._animationSheetEnabled!==b&&(this._animationSheetEnabled=b,b?(this._sheetCreation={process:Ob,previousItem:null,nextItem:null},yb(this._sheetCreation,this._colorCreation)):Db(this._sheetCreation),this._reset())}getActiveCount(){return this.ds.length}getClassName(){return"nx"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var b;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(b=this._customWrappers[d])||void 0===b?void 0:b.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[b]??this._customWrappers[0]}setCustomEffect(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[d]=new bb.b(this._engine),this._customWrappers[d].effect=b,this._customWrappers[d].drawContext&&(this._customWrappers[d].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new h.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(b){if(this.noiseTexture!==b){if(this._noiseTexture=b,!b)return Db(this._noiseCreation),void Db(this._noiseProcessing);this._noiseCreation={process:gb,previousItem:null,nextItem:null},yb(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Xb,previousItem:null,nextItem:null},yb(this._noiseProcessing,this._positionProcessing)}}constructor(b,d,P){let W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,J=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(b),this._emitterInverseWorldMatrix=G.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new G.ed,this.Zd=new h.d,this.onStoppedObservable=new h.d,this.onStartedObservable=new h.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.ds=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new q.ci(0,0,0,0),this._colorDiff=new q.ci(0,0,0,0),this._scaledDirection=G.ed.Zero(),this._scaledGravity=G.ed.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=b=>{},this.recycleParticle=b=>{const d=this.ds.pop();d!==b&&d.copyTo(b),this._stockParticles.push(d)},this._createParticle=()=>{let b;return 0!==this._stockParticles.length?(b=this._stockParticles.pop(),b._reset()):b=new k(this),this._prepareParticle(b),b},this.paused=!1,this._shadersLoaded=!1,this._capacity=d,this._epsilon=C,P&&"Scene"!==P.getClassName()?(this._engine=P,this.defaultProjectionMatrix=G.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=P||K.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.kY.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:lb,previousItem:null,nextItem:null},this._positionCreation={process:Bb,previousItem:null,nextItem:null},yb(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:xb,previousItem:null,nextItem:null},yb(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Nb,previousItem:null,nextItem:null},yb(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Mb,previousItem:null,nextItem:null},yb(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:jb,previousItem:null,nextItem:null},yb(this._angleCreation,this._sizeCreation),this._colorCreation={process:Wb,previousItem:null,nextItem:null},yb(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,J||(this._colorProcessing={process:Cb,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:Lb,previousItem:null,nextItem:null},yb(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:rb,previousItem:null,nextItem:null},yb(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:ob,previousItem:null,nextItem:null},yb(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:ub,previousItem:null,nextItem:null},yb(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=i,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new bb.b(this._engine)},this._customWrappers[0].effect=W,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new Y,this.updateFunction=b=>{var d;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(d=this.noiseTexture.getContent())||void 0===d||d.then((b=>{this._noiseTextureData=b})));const P=b===this.ds;for(let G=0;G<b.length;G++){const d=b[G];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const W=d.age;if(d.age+=this._tempScaledUpdateSpeed,d.age>d.lifeTime){const b=d.age-W,P=d.lifeTime-W;this._tempScaledUpdateSpeed=P*this._tempScaledUpdateSpeed/b,d.age=d.lifeTime}this._ratio=d.age/d.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let i=this._updateQueueStart;for(;i;)i.process(d,this),i=i.nextItem;if(this._isAnimationSheetEnabled&&!J&&d.updateCellIndex(),d._inheritParticleInfoToSubEmitters(),d.age>=d.lifeTime){if(this._emitFromParticle(d),d._attachedSubEmitters){for(const b of d._attachedSubEmitters)b.particleSystem.disposeOnStop=!0,b.particleSystem.stop();d._attachedSubEmitters=null}this.recycleParticle(d),P&&G--}else;}}}serialize(b){throw new Error("Method not implemented.")}clone(b,d){throw new Error("Method not implemented.")}_addFactorGradient(b,d,P,G){const W=new v(d,P,G);b.push(W),b.sort(((b,d)=>b.gradient<d.gradient?-1:b.gradient>d.gradient?1:0))}_removeFactorGradient(b,d){if(!b)return;let P=0;for(const G of b){if(G.gradient===d){b.splice(P,1);break}P++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Sb:this._lifeTimeCreation.process=lb}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:Rb,previousItem:null,nextItem:null},yb(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Db(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(b){this.targetStopDuration!==b&&(this._targetStopDuration=b,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(b,d,P){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,b,d,P),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(b){return this._removeFactorGradient(this._lifeTimeGradients,b),this._syncLifeTimeCreation(),this}addSizeGradient(b,d,P){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=eb,this._sizeGradientProcessing={process:Ub,previousItem:null,nextItem:null},Vb(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,b,d,P),this}removeSizeGradient(b){var d;return this._removeFactorGradient(this._sizeGradients,b),0===(null===(d=this._sizeGradients)||void 0===d?void 0:d.length)&&(Db(this._sizeGradientProcessing),this._sizeCreation.process=Mb),this}addColorRemapGradient(b,d,P){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,b,d,P),this}removeColorRemapGradient(b){return this._removeFactorGradient(this._colorRemapGradients,b),this}addAlphaRemapGradient(b,d,P){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,b,d,P),this}removeAlphaRemapGradient(b){return this._removeFactorGradient(this._alphaRemapGradients,b),this}addAngularSpeedGradient(b,d,P){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=ab,this._angularSpeedGradientProcessing={process:Jb,previousItem:null,nextItem:null},Vb(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,b,d,P),this}removeAngularSpeedGradient(b){var d;return this._removeFactorGradient(this._angularSpeedGradients,b),0===(null===(d=this._angularSpeedGradients)||void 0===d?void 0:d.length)&&(this._angleCreation.process=jb,Db(this._angularSpeedGradientProcessing)),this}addVelocityGradient(b,d,P){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:sb,previousItem:null,nextItem:null},yb(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:wb,previousItem:null,nextItem:null},Vb(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,b,d,P),this}removeVelocityGradient(b){var d;return this._removeFactorGradient(this._velocityGradients,b),0===(null===(d=this._velocityGradients)||void 0===d?void 0:d.length)&&(Db(this._velocityCreation),Db(this._velocityGradientProcessing)),this}addLimitVelocityGradient(b,d,P){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Eb,previousItem:null,nextItem:null},yb(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:tb,previousItem:null,nextItem:null},yb(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,b,d,P),this}removeLimitVelocityGradient(b){var d;return this._removeFactorGradient(this._limitVelocityGradients,b),0===(null===(d=this._limitVelocityGradients)||void 0===d?void 0:d.length)&&(Db(this._limitVelocityCreation),Db(this._limitVelocityGradientProcessing)),this}addDragGradient(b,d,P){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Ab,previousItem:null,nextItem:null},Vb(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:fb,previousItem:null,nextItem:null},Vb(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,b,d,P),this}removeDragGradient(b){var d;return this._removeFactorGradient(this._dragGradients,b),0===(null===(d=this._dragGradients)||void 0===d?void 0:d.length)&&(Db(this._dragCreation),Db(this._dragGradientProcessing)),this}addEmitRateGradient(b,d,P){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,b,d,P),this}removeEmitRateGradient(b){return this._removeFactorGradient(this._emitRateGradients,b),this}addStartSizeGradient(b,d,P){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,b,d,P),this._syncStartSizeCreation(),this}removeStartSizeGradient(b){return this._removeFactorGradient(this._startSizeGradients,b),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const b=new Uint8Array(4*this._rawTextureWidth),d=q.TmpColors.Nd[0];for(let P=0;P<this._rawTextureWidth;P++){const G=P/this._rawTextureWidth;F.GetCurrentGradient(G,this._rampGradients,((G,W,i)=>{q.Nd.LerpToRef(G.color,W.color,i,d),b[4*P]=255*d.r,b[4*P+1]=255*d.g,b[4*P+2]=255*d.b,b[4*P+3]=255}))}this._rampGradientsTexture=T.b.CreateRGBATexture(b,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((b,d)=>b.gradient<d.gradient?-1:b.gradient>d.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(b,d){this._rampGradients||(this._rampGradients=[]);const P=new m(b,d);return this._rampGradients.push(P),this._syncRampGradientTexture(),this}removeRampGradient(b){return this._removeGradientAndTexture(b,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(b,d,P){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=ib,this._colorProcessing.process=qb);const G=new I(b,d,P);return this._colorGradients.push(G),this._colorGradients.sort(((b,d)=>b.gradient<d.gradient?-1:b.gradient>d.gradient?1:0)),this}removeColorGradient(b){if(!this._colorGradients)return this;let d=0;for(const P of this._colorGradients){if(P.gradient===b){this._colorGradients.splice(d,1);break}d++}return 0===this._colorGradients.length&&(this._colorCreation.process=Wb,this._colorProcessing.process=Cb),this}resetDrawCache(){if(this._drawWrappers){for(const b of this._drawWrappers)if(b)for(const d of b)null===d||void 0===d||d.dispose();this._drawWrappers=[]}}_fetchR(b,d,P,G,W){return W[4*(((b=.5*Math.abs(b)+.5)*P%P|0)+((d=.5*Math.abs(d)+.5)*G%G|0)*P)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const b=this._engine,d=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*d),this._vertexBuffer=new A.b(b,this._vertexData,!0,d);let P=0;const G=this._vertexBuffer.createVertexBuffer(A.c.PositionKind,P,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[A.c.PositionKind]=G,P+=3;const W=this._vertexBuffer.createVertexBuffer(A.c.ColorKind,P,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[A.c.ColorKind]=W,P+=4;const i=this._vertexBuffer.createVertexBuffer("angle",P,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=i,P+=1;const q=this._vertexBuffer.createVertexBuffer("size",P,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=q,P+=2,this._isAnimationSheetEnabled){const b=this._vertexBuffer.createVertexBuffer("cellIndex",P,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=b,P+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const b=this._vertexBuffer.createVertexBuffer("direction",P,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=b,P+=3}if(this._useRampGradients){const b=this._vertexBuffer.createVertexBuffer("remapData",P,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=b,P+=4}let C;if(this._useInstancing){const d=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new A.b(b,d,!1,2),C=this._spriteBuffer.createVertexBuffer("offset",0,2)}else C=this._vertexBuffer.createVertexBuffer("offset",P,2,this._vertexBufferSize,this._useInstancing),P+=2;this._vertexBuffers.offset=C,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const b=[],d=[];let P=0;for(let G=0;G<this._capacity;G++)b.push(P),b.push(P+1),b.push(P+2),b.push(P),b.push(P+2),b.push(P+3),d.push(P,P+1,P+1,P+2,P+2,P+3,P+3,P,P,P+3),P+=4;this._indexBuffer=this._engine.createIndexBuffer(b),this._linesIndexBuffer=this._engine.createIndexBuffer(d)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(b)setTimeout((()=>{this.start(0)}),b);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var d;-1!==(null===(d=this.qd)||void 0===d?void 0:d.getClassName().indexOf("Mesh"))&&this.qd.zd(!0);const b=this.noiseTexture;if(b&&b.onGeneratedObservable)b.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let d=0;d<this.preWarmCycles;d++)this.animate(!0),b.render()}))}));else for(let d=0;d<this.preWarmCycles;d++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(b))}_postStop(b){}reset(){this._stockParticles.length=0,this.ds.length=0}_appendParticleVertex(b,d,P,W){let i=b*this._vertexBufferSize;if(this._vertexData[i++]=d.position.x+this.LL.x,this._vertexData[i++]=d.position.y+this.LL.y,this._vertexData[i++]=d.position.z+this.LL.z,this._vertexData[i++]=d.color.r,this._vertexData[i++]=d.color.g,this._vertexData[i++]=d.color.b,this._vertexData[i++]=d.color.a,this._vertexData[i++]=d.angle,this._vertexData[i++]=d.scale.x*d.size,this._vertexData[i++]=d.scale.y*d.size,this._isAnimationSheetEnabled&&(this._vertexData[i++]=d.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[i++]=d.direction.x,this._vertexData[i++]=d.direction.y,this._vertexData[i++]=d.direction.z);else if(d._initialDirection){let b=d._initialDirection;this.isLocal&&(G.ed.TransformNormalToRef(b,this._emitterWorldMatrix,G.TmpVectors.ed[0]),b=G.TmpVectors.ed[0]),0===b.x&&0===b.z&&(b.x=.001),this._vertexData[i++]=b.x,this._vertexData[i++]=b.y,this._vertexData[i++]=b.z}else{let b=d.direction;this.isLocal&&(G.ed.TransformNormalToRef(b,this._emitterWorldMatrix,G.TmpVectors.ed[0]),b=G.TmpVectors.ed[0]),0===b.x&&0===b.z&&(b.x=.001),this._vertexData[i++]=b.x,this._vertexData[i++]=b.y,this._vertexData[i++]=b.z}this._useRampGradients&&d.remapData&&(this._vertexData[i++]=d.remapData.x,this._vertexData[i++]=d.remapData.y,this._vertexData[i++]=d.remapData.z,this._vertexData[i++]=d.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===P?P=this._epsilon:1===P&&(P=1-this._epsilon),0===W?W=this._epsilon:1===W&&(W=1-this._epsilon)),this._vertexData[i++]=P,this._vertexData[i++]=W)}_prepareParticle(b){}_createNewOnes(b){let d;for(let P=0;P<b&&this.ds.length!==this._capacity;P++){d=this._createParticle(),this.ds.push(d);let b=this._createQueueStart;for(;b;)b.process(d,this),b=b.nextItem;d._inheritParticleInfoToSubEmitters()}}_update(b){if(this._alive=this.ds.length>0,this.qd.position){const b=this.qd;this._emitterWorldMatrix=b.getWorldMatrix()}else{const b=this.qd;this._emitterWorldMatrix=G.Matrix.Translation(b.x,b.y,b.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.ds),this._createNewOnes(b)}static _GetAttributeNamesOrOptions(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const G=[A.c.PositionKind,A.c.ColorKind,"angle","offset","size"];return b&&G.push("cellIndex"),d||G.push("direction"),P&&G.push("remapData"),G}static _GetEffectCreationOptions(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const G=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,db.c)(G),b&&G.push("particlesInfos"),d&&G.push("logarithmicDepthConstant"),P&&(G.push("vFogInfos"),G.push("vFogColor")),G}fillDefines(b,d){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,db.k)(this,this._scene,b),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&b.push("#define FOG")),this._isAnimationSheetEnabled&&b.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&b.push("#define LOGARITHMICDEPTH"),d===J.BLENDMODE_MULTIPLY&&b.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&b.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(b.push("#define BILLBOARD"),this.billboardMode){case 2:b.push("#define BILLBOARDY");break;case 8:case 9:b.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&b.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:b.push("#define BILLBOARDMODE_ALL")}P&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),b.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(b,d,P){d.push(...zb._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),b.push(...zb._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),P.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,Gb.e)(b,this._imageProcessingConfigurationDefines),(0,Gb.d)(P,this._imageProcessingConfigurationDefines))}_getWrapper(b){const d=this._getCustomDrawWrapper(b);if(null!==d&&void 0!==d&&d.effect)return d;const P=[];this.fillDefines(P,b);const G=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let W=this._drawWrappers[G];W||(W=this._drawWrappers[G]=[]);let i=W[b];i||(i=new bb.b(this._engine),i.drawContext&&(i.drawContext.useInstancing=this._useInstancing),W[b]=i);const q=P.join("\n");if(i.defines!==q){const b=[],d=[],P=[];this.fillUniformsAttributesAndSamplerNames(d,b,P),i.setEffect(this._engine.createEffect("particles",b,d,P,q,void 0,void 0,void 0,void 0,this._shaderLanguage),q)}return i}animate(){var b;let d,P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!P&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(P?this.preWarmStepOffset:(null===(b=this._scene)||void 0===b?void 0:b.getAnimationRatio())||1),this.manualEmitCount>-1)d=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let b=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const d=this._actualFrame/this.targetStopDuration;F.GetCurrentGradient(d,this._emitRateGradients,((d,P,G)=>{d!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=P.getFactor(),this._currentEmitRateGradient=d),b=(0,L.Lerp)(this._currentEmitRate1,this._currentEmitRate2,G)}))}d=b*this._scaledUpdateSpeed|0,this._newPartsExcess+=b*this._scaledUpdateSpeed-d}if(this._newPartsExcess>1&&(d+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?d=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(d),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!P){let b=0;for(let d=0;d<this.ds.length;d++){const P=this.ds[d];this._appendParticleVertices(b,P),b+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.ds.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(b,d){this._appendParticleVertex(b++,d,0,0),this._useInstancing||(this._appendParticleVertex(b++,d,1,0),this._appendParticleVertex(b++,d,1,1),this._appendParticleVertex(b++,d,0,1))}rebuild(){var b;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(b=this._spriteBuffer)||void 0===b||b._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!zb.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(P.bind(P,13151)),Promise.resolve().then(P.bind(P,13088))])):await Promise.all([Promise.resolve().then(P.bind(P,13079)),Promise.resolve().then(P.bind(P,13065))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.qd||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==J.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(J.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(J.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(b){const d=this._getWrapper(b),P=d.effect,W=this._engine;W.enableEffect(d);const i=this.defaultViewMatrix??this._scene.getViewMatrix();if(P.setTexture("diffuseSampler",this.particleTexture),P.setMatrix("view",i),P.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const b=this.particleTexture.getBaseSize();P.setFloat3("particlesInfos",this.spriteCellWidth/b.width,this.spriteCellHeight/b.height,this.spriteCellWidth/b.width)}if(P.setVector2("translationPivot",this.translationPivot),P.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const b=this._scene.activeCamera;P.setVector3("eyePosition",b.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),P.setTexture("rampSampler",this._rampGradientsTexture));const q=P.defines;var C,J,L,x,Y,s;(this._scene&&((0,db.f)(P,this,this._scene),this.applyFog&&(0,Pb.c)(this._scene,void 0,P)),q.indexOf("#define BILLBOARDMODE_ALL")>=0&&(i.invertToRef(G.TmpVectors.Matrix[0]),P.setMatrix("invView",G.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?W.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,P):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,P)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?W.bindBuffers(this._vertexBuffers,null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?this._linesIndexBuffer:this._indexBuffer,P):W.bindBuffers(this._vertexBuffers,null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?this._linesIndexBufferUseInstancing:null,P);(this.useLogarithmicDepth&&this._scene&&(0,Pb.e)(q,P,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(P),this._setEngineBasedOnBlendMode(b),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(P),this._useInstancing)?null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?W.drawElementsType(6,0,10,this.ds.length):W.drawArraysType(7,0,4,this.ds.length):null!==(s=this._scene)&&void 0!==s&&s.forceWireframe?W.drawElementsType(1,0,10*this.ds.length):W.drawElementsType(0,0,6*this.ds.length);return this.ds.length}render(){if(!this.isReady()||!this.ds.length)return 0;const b=this._engine;b.setState&&(b.setState(!1),this.forceDepthWrite&&b.setDepthWrite(!0));let d=0;return d=this.blendMode===J.BLENDMODE_MULTIPLYADD?this._render(J.BLENDMODE_MULTIPLY)+this._render(J.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),d}_onDispose(){}dispose(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),b&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),b&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(d,P),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const b=this._scene.kY.indexOf(this);b>-1&&this._scene.kY.splice(b,1),this._scene._activeParticleSystems.dispose()}this.Zd.notifyObservers(this),this.Zd.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}zb.ForceGLSL=!1;var Qb,Ib=P(11525);!function(b){b[b.ATTACHED=0]="ATTACHED",b[b.END=1]="END"}(Qb||(Qb={}));class mb{constructor(b){if(this.particleSystem=b,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!b.qd||!b.qd.dispose){const d=(0,C.d)("BABYLON.AbstractMesh");b.qd=new d("SubemitterSystemEmitter",b.Xb()),b._disposeEmitterOnDispose=!0}}clone(){let b=this.particleSystem.qd;if(b){if(b instanceof G.ed)b=b.clone();else if(-1!==b.getClassName().indexOf("Mesh")){b=new((0,C.d)("BABYLON.Mesh"))("",b.Xb()),b.isVisible=!1}}else b=new G.ed;const d=new mb(this.particleSystem.clone(this.particleSystem.name,b));return d.particleSystem.name+="Clone",d.type=this.type,d.inheritDirection=this.inheritDirection,d.inheritedVelocityAmount=this.inheritedVelocityAmount,d.particleSystem._disposeEmitterOnDispose=!0,d.particleSystem.disposeOnStop=!0,d}serialize(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={};return d.type=this.type,d.inheritDirection=this.inheritDirection,d.inheritedVelocityAmount=this.inheritedVelocityAmount,d.particleSystem=this.particleSystem.serialize(b),d}static _ParseParticleSystem(b,d,P){throw(0,Ib.d)("ParseParticle")}static Parse(b,d,P){const G=b.particleSystem,W=new mb(mb._ParseParticleSystem(G,d,P,!0));return W.type=b.type,W.inheritDirection=b.inheritDirection,W.inheritedVelocityAmount=b.inheritedVelocityAmount,W.particleSystem._isSubEmitter=!0,W}dispose(){this.particleSystem.dispose()}}var vb=P(11574);function Fb(b,d){const P=new B;return P.direction1=b,P.direction2=d,P}function hb(){return new r(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Tb(){return new n(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Kb(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new G.ed(0,1,0),P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new G.ed(0,1,0);return new Z(b,d,P)}function kb(){return new w(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function bd(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new G.ed(0,1,0),i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new G.ed(0,1,0);return new t(b,d,P,W,i)}function dd(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new s(b,d)}function Pd(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new G.ed(0,1,0),W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new G.ed(0,1,0);return new E(b,d,P,W)}const Gd=G.ed.Zero(),Wd=G.ed.Zero(),id=G.ed.Zero();class qd{constructor(){this.strength=0,this.position=G.ed.Zero()}_processParticle(b,d){this.position.subtractToRef(b.position,Gd);const P=Gd.lengthSquared()+1;Gd.normalize().scaleToRef(this.strength/P,Wd),Wd.scaleToRef(d._tempScaledUpdateSpeed,id),b.direction.addInPlace(id)}serialize(){return{position:this.position.jd(),strength:this.strength}}}class Cd extends zb{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=b=>{if(!this._subEmitters||0===this._subEmitters.length)return;const d=Math.floor(Math.random()*this._subEmitters.length);for(const P of this._subEmitters[d])if(1===P.type){const d=P.clone();b._inheritParticleInfoToSubEmitter(d),d.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(d.particleSystem),d.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(b,d){const P=Fb(b,d);return this.particleEmitterType=P,P}get flowMap(){return this._flowMap}set flowMap(b){this._flowMap!==b&&(this._flowMap=b,this._flowMapUpdate&&(Db(this._flowMapUpdate),this._flowMapUpdate=null),b&&(this._flowMapUpdate={process:b=>{var d;const P=null===(d=this.Xb())||void 0===d?void 0:d.getTransformMatrix();this._flowMap._processParticle(b,this.flowMapStrength*this._tempScaledUpdateSpeed,P)},previousItem:null,nextItem:null},yb(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(b){this._attractors.push(b),1===this._attractors.length&&(this._attractorUpdate={process:b=>{for(const d of this._attractors)d._processParticle(b,this)},previousItem:null,nextItem:null},yb(this._attractorUpdate,this._directionProcessing))}removeAttractor(b){const d=this._attractors.indexOf(b);-1!==d&&this._attractors.splice(d,1),0===this._attractors.length&&Db(this._attractorUpdate)}start(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(b)}createHemisphericEmitter(){const b=hb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=b,b}createSphereEmitter(){const b=Tb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=b,b}createDirectedSphereEmitter(){const b=Kb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new G.ed(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new G.ed(0,1,0));return this.particleEmitterType=b,b}createCylinderEmitter(){const b=kb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=b,b}createDirectedCylinderEmitter(){const b=bd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new G.ed(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new G.ed(0,1,0));return this.particleEmitterType=b,b}createConeEmitter(){const b=dd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=b,b}createDirectedConeEmitter(){const b=Pd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new G.ed(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new G.ed(0,1,0));return this.particleEmitterType=b,b}createBoxEmitter(b,d,P,G){const W=new Y;return this.particleEmitterType=W,this.direction1=b,this.direction2=d,this.minEmitBox=P,this.maxEmitBox=G,W}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const b of this.subEmitters)b instanceof Cd?this._subEmitters.push([new mb(b)]):b instanceof mb?this._subEmitters.push([b]):b instanceof Array&&this._subEmitters.push(b)}_stopSubEmitters(){if(this.activeSubSystems){for(const b of this.activeSubSystems)b.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const b=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==b&&this._rootParticleSystem.activeSubSystems.splice(b,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(b){b&&this._stopSubEmitters()}_prepareParticle(b){if(this._subEmitters&&this._subEmitters.length>0){const d=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];b._attachedSubEmitters=[];for(const P of d)if(0===P.type){const d=P.clone();b._attachedSubEmitters.push(d),d.particleSystem.start()}}}_onDispose(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),b&&this.particles)for(const P of this.particles)if(P._attachedSubEmitters)for(let b=P._attachedSubEmitters.length-1;b>=0;b-=1)P._attachedSubEmitters[b].dispose();if(d&&this.activeSubSystems)for(let P=this.activeSubSystems.length-1;P>=0;P-=1)this.activeSubSystems[P].dispose();if(this._subEmitters&&this._subEmitters.length){for(let b=0;b<this._subEmitters.length;b++)for(const d of this._subEmitters[b])d.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.qd&&this.qd.dispose&&this.qd.dispose(!0)}static _Parse(b,d,P,W){let i;i=P instanceof vb.e?null:P;const J=(0,C.d)("BABYLON.Texture");if(J&&i&&(b.texture?d.particleTexture=J.Parse(b.texture,i,W):b.textureName&&(d.particleTexture=new J(W+b.textureName,i,!1,void 0===b.invertY||b.invertY),d.particleTexture.name=b.textureName)),b.emitterId||0===b.emitterId||void 0!==b.qd?b.emitterId&&i?d.qd=i.getLastMeshById(b.emitterId):d.qd=G.ed.Od(b.qd):d.qd=G.ed.Zero(),d.isLocal=!!b.isLocal,void 0!==b.renderingGroupId&&(d.renderingGroupId=b.renderingGroupId),void 0!==b.isBillboardBased&&(d.isBillboardBased=b.isBillboardBased),void 0!==b.billboardMode&&(d.billboardMode=b.billboardMode),void 0!==b.useLogarithmicDepth&&(d.useLogarithmicDepth=b.useLogarithmicDepth),b.animations){for(let P=0;P<b.animations.length;P++){const G=b.animations[P],W=(0,C.d)("BABYLON.Animation");W&&d.animations.push(W.Parse(G))}d.beginAnimationOnStart=b.beginAnimationOnStart,d.beginAnimationFrom=b.beginAnimationFrom,d.beginAnimationTo=b.beginAnimationTo,d.beginAnimationLoop=b.beginAnimationLoop}if(b.autoAnimate&&i&&i.beginAnimation(d,b.autoAnimateFrom,b.autoAnimateTo,b.autoAnimateLoop,b.autoAnimateSpeed||1),d.startDelay=0|b.startDelay,d.minAngularSpeed=b.minAngularSpeed,d.maxAngularSpeed=b.maxAngularSpeed,d.minSize=b.minSize,d.maxSize=b.maxSize,b.minScaleX&&(d.minScaleX=b.minScaleX,d.maxScaleX=b.maxScaleX,d.minScaleY=b.minScaleY,d.maxScaleY=b.maxScaleY),void 0!==b.preWarmCycles&&(d.preWarmCycles=b.preWarmCycles,d.preWarmStepOffset=b.preWarmStepOffset),void 0!==b.minInitialRotation&&(d.minInitialRotation=b.minInitialRotation,d.maxInitialRotation=b.maxInitialRotation),d.minLifeTime=b.minLifeTime,d.maxLifeTime=b.maxLifeTime,d.minEmitPower=b.minEmitPower,d.maxEmitPower=b.maxEmitPower,d.emitRate=b.emitRate,d.gravity=G.ed.Od(b.gravity),b.noiseStrength&&(d.noiseStrength=G.ed.Od(b.noiseStrength)),d.color1=q.ci.Od(b.color1),d.color2=q.ci.Od(b.color2),d.colorDead=q.ci.Od(b.colorDead),d.updateSpeed=b.updateSpeed,d.targetStopDuration=b.targetStopDuration,d.blendMode=b.blendMode,b.colorGradients)for(const G of b.colorGradients)d.addColorGradient(G.gradient,q.ci.Od(G.color1),G.color2?q.ci.Od(G.color2):void 0);if(b.rampGradients){for(const P of b.rampGradients)d.addRampGradient(P.gradient,q.Nd.Od(P.color));d.useRampGradients=b.useRampGradients}if(b.colorRemapGradients)for(const G of b.colorRemapGradients)d.addColorRemapGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(b.alphaRemapGradients)for(const G of b.alphaRemapGradients)d.addAlphaRemapGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(b.sizeGradients)for(const G of b.sizeGradients)d.addSizeGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(b.angularSpeedGradients)for(const G of b.angularSpeedGradients)d.addAngularSpeedGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(b.velocityGradients)for(const G of b.velocityGradients)d.addVelocityGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(b.dragGradients)for(const G of b.dragGradients)d.addDragGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(b.emitRateGradients)for(const G of b.emitRateGradients)d.addEmitRateGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(b.startSizeGradients)for(const G of b.startSizeGradients)d.addStartSizeGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(b.lifeTimeGradients)for(const G of b.lifeTimeGradients)d.addLifeTimeGradient(G.gradient,void 0!==G.factor1?G.factor1:G.factor,G.factor2);if(b.limitVelocityGradients){for(const P of b.limitVelocityGradients)d.addLimitVelocityGradient(P.gradient,void 0!==P.factor1?P.factor1:P.factor,P.factor2);d.limitVelocityDamping=b.limitVelocityDamping}if(b.noiseTexture&&i){const P=(0,C.d)("BABYLON.ProceduralTexture");d.noiseTexture=P.Parse(b.noiseTexture,i,W)}let L;if(b.particleEmitterType){switch(b.particleEmitterType.type){case"SphereParticleEmitter":L=new n;break;case"SphereDirectedParticleEmitter":L=new Z;break;case"ConeEmitter":case"ConeParticleEmitter":L=new s;break;case"ConeDirectedParticleEmitter":L=new E;break;case"CylinderParticleEmitter":L=new w;break;case"CylinderDirectedParticleEmitter":L=new t;break;case"HemisphericParticleEmitter":L=new r;break;case"PointParticleEmitter":L=new B;break;case"MeshParticleEmitter":L=new f;break;case"CustomParticleEmitter":L=new o;break;default:L=new Y}L.parse(b.particleEmitterType,i)}else L=new Y,L.parse(b,i);d.particleEmitterType=L,d.startSpriteCellID=b.startSpriteCellID,d.endSpriteCellID=b.endSpriteCellID,d.spriteCellLoop=b.spriteCellLoop??!0,d.spriteCellWidth=b.spriteCellWidth,d.spriteCellHeight=b.spriteCellHeight,d.spriteCellChangeSpeed=b.spriteCellChangeSpeed,d.spriteRandomStartCell=b.spriteRandomStartCell,d.disposeOnStop=b.disposeOnStop??!1,d.manualEmitCount=b.manualEmitCount??-1}static Parse(b,d,P){let W=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0;const C=b.name;let J,L,x=null,Y=null;if(d instanceof vb.e?J=d:(L=d,J=L.getEngine()),b.customShader&&J.createEffectForParticles){Y=b.customShader;const d=Y.shaderOptions.defines.length>0?Y.shaderOptions.defines.join("\n"):"";x=J.createEffectForParticles(Y.shaderPath.fragmentElement,Y.shaderOptions.uniforms,Y.shaderOptions.samplers,d)}const s=new Cd(C,i||b.vd,d,x,b.isAnimationSheetEnabled);if(s.customShader=Y,s._rootUrl=P,b.id&&(s.id=b.id),b.subEmitters){s.subEmitters=[];for(const G of b.subEmitters){const b=[];for(const W of G)b.push(mb.Parse(W,d,P));s.subEmitters.push(b)}}if(b.attractors)for(const q of b.attractors){const b=new qd;b.position=G.ed.Od(q.position),b.strength=q.strength,s.addAttractor(b)}return Cd._Parse(b,s,d,P),b.textureMask&&(s.textureMask=q.ci.Od(b.textureMask)),b.LL&&(s.LL=G.ed.Od(b.LL)),b.preventAutoStart&&(s.preventAutoStart=b.preventAutoStart),W||s.preventAutoStart||s.start(),s}serialize(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={};if(Cd._Serialize(d,this,b),d.textureMask=this.textureMask.jd(),d.customShader=this.customShader,d.preventAutoStart=this.preventAutoStart,d.LL=this.LL.jd(),this.subEmitters){d.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const P of this._subEmitters){const G=[];for(const d of P)G.push(d.serialize(b));d.subEmitters.push(G)}}if(this._attractors&&this._attractors.length){d.attractors=[];for(const b of this._attractors)d.attractors.push(b.serialize())}return d}static _Serialize(b,d,P){if(b.name=d.name,b.id=d.id,b.vd=d.getCapacity(),b.disposeOnStop=d.disposeOnStop,b.manualEmitCount=d.manualEmitCount,d.qd.position){const P=d.qd;b.emitterId=P.id}else{const P=d.qd;b.qd=P.jd()}d.particleEmitterType&&(b.particleEmitterType=d.particleEmitterType.serialize()),d.particleTexture&&(P?b.texture=d.particleTexture.serialize():(b.textureName=d.particleTexture.name,b.invertY=!!d.particleTexture._invertY)),b.isLocal=d.isLocal,S.c.AppendSerializedAnimations(d,b),b.beginAnimationOnStart=d.beginAnimationOnStart,b.beginAnimationFrom=d.beginAnimationFrom,b.beginAnimationTo=d.beginAnimationTo,b.beginAnimationLoop=d.beginAnimationLoop,b.startDelay=d.startDelay,b.renderingGroupId=d.renderingGroupId,b.isBillboardBased=d.isBillboardBased,b.billboardMode=d.billboardMode,b.minAngularSpeed=d.minAngularSpeed,b.maxAngularSpeed=d.maxAngularSpeed,b.minSize=d.minSize,b.maxSize=d.maxSize,b.minScaleX=d.minScaleX,b.maxScaleX=d.maxScaleX,b.minScaleY=d.minScaleY,b.maxScaleY=d.maxScaleY,b.minEmitPower=d.minEmitPower,b.maxEmitPower=d.maxEmitPower,b.minLifeTime=d.minLifeTime,b.maxLifeTime=d.maxLifeTime,b.emitRate=d.emitRate,b.gravity=d.gravity.jd(),b.noiseStrength=d.noiseStrength.jd(),b.color1=d.color1.jd(),b.color2=d.color2.jd(),b.colorDead=d.colorDead.jd(),b.updateSpeed=d.updateSpeed,b.targetStopDuration=d.targetStopDuration,b.blendMode=d.blendMode,b.preWarmCycles=d.preWarmCycles,b.preWarmStepOffset=d.preWarmStepOffset,b.minInitialRotation=d.minInitialRotation,b.maxInitialRotation=d.maxInitialRotation,b.startSpriteCellID=d.startSpriteCellID,b.spriteCellLoop=d.spriteCellLoop,b.endSpriteCellID=d.endSpriteCellID,b.spriteCellChangeSpeed=d.spriteCellChangeSpeed,b.spriteCellWidth=d.spriteCellWidth,b.spriteCellHeight=d.spriteCellHeight,b.spriteRandomStartCell=d.spriteRandomStartCell,b.isAnimationSheetEnabled=d.isAnimationSheetEnabled,b.useLogarithmicDepth=d.useLogarithmicDepth;const G=d.getColorGradients();if(G){b.colorGradients=[];for(const d of G){const P={gradient:d.gradient,color1:d.color1.jd()};d.color2?P.color2=d.color2.jd():P.color2=d.color1.jd(),b.colorGradients.push(P)}}const W=d.getRampGradients();if(W){b.rampGradients=[];for(const d of W){const P={gradient:d.gradient,color:d.color.jd()};b.rampGradients.push(P)}b.useRampGradients=d.useRampGradients}const i=d.getColorRemapGradients();if(i){b.colorRemapGradients=[];for(const d of i){const P={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?P.factor2=d.factor2:P.factor2=d.factor1,b.colorRemapGradients.push(P)}}const q=d.getAlphaRemapGradients();if(q){b.alphaRemapGradients=[];for(const d of q){const P={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?P.factor2=d.factor2:P.factor2=d.factor1,b.alphaRemapGradients.push(P)}}const C=d.getSizeGradients();if(C){b.sizeGradients=[];for(const d of C){const P={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?P.factor2=d.factor2:P.factor2=d.factor1,b.sizeGradients.push(P)}}const J=d.getAngularSpeedGradients();if(J){b.angularSpeedGradients=[];for(const d of J){const P={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?P.factor2=d.factor2:P.factor2=d.factor1,b.angularSpeedGradients.push(P)}}const L=d.getVelocityGradients();if(L){b.velocityGradients=[];for(const d of L){const P={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?P.factor2=d.factor2:P.factor2=d.factor1,b.velocityGradients.push(P)}}const x=d.getDragGradients();if(x){b.dragGradients=[];for(const d of x){const P={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?P.factor2=d.factor2:P.factor2=d.factor1,b.dragGradients.push(P)}}const Y=d.getEmitRateGradients();if(Y){b.emitRateGradients=[];for(const d of Y){const P={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?P.factor2=d.factor2:P.factor2=d.factor1,b.emitRateGradients.push(P)}}const s=d.getStartSizeGradients();if(s){b.startSizeGradients=[];for(const d of s){const P={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?P.factor2=d.factor2:P.factor2=d.factor1,b.startSizeGradients.push(P)}}const E=d.getLifeTimeGradients();if(E){b.lifeTimeGradients=[];for(const d of E){const P={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?P.factor2=d.factor2:P.factor2=d.factor1,b.lifeTimeGradients.push(P)}}const w=d.getLimitVelocityGradients();if(w){b.limitVelocityGradients=[];for(const d of w){const P={gradient:d.gradient,factor1:d.factor1};void 0!==d.factor2?P.factor2=d.factor2:P.factor2=d.factor1,b.limitVelocityGradients.push(P)}b.limitVelocityDamping=d.limitVelocityDamping}d.noiseTexture&&(b.noiseTexture=d.noiseTexture.serialize())}clone(b,d){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const G={...this._customWrappers};let W=null;const i=this._engine;if(i.createEffectForParticles&&null!=this.customShader){W=this.customShader;const b=W.shaderOptions.defines.length>0?W.shaderOptions.defines.join("\n"):"",d=i.createEffectForParticles(W.shaderPath.fragmentElement,W.shaderOptions.uniforms,W.shaderOptions.samplers,b);G[0]?G[0].effect=d:this.setCustomEffect(d,0)}const q=this.serialize(P),C=Cd.Parse(q,this._scene||this._engine,this._rootUrl);return C.name=b,C.customShader=W,C._customWrappers=G,void 0===d&&(d=this.qd),this.noiseTexture&&(C.noiseTexture=this.noiseTexture.clone()),C.qd=d,this.preventAutoStart||C.start(),C}}Cd.BILLBOARDMODE_Y=2,Cd.BILLBOARDMODE_ALL=7,Cd.BILLBOARDMODE_STRETCHED=8,Cd.BILLBOARDMODE_STRETCHED_LOCAL=9,mb._ParseParticleSystem=Cd.Parse;var Jd=P(11918),Ld=P(11909),xd=P(11806);xd.e.prototype.createTransformFeedback=function(){const b=this._gl.createTransformFeedback();if(!b)throw new Error("Unable to create Transform Feedback");return b},xd.e.prototype.deleteTransformFeedback=function(b){this._gl.deleteTransformFeedback(b)},xd.e.prototype.bindTransformFeedback=function(b){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,b)},xd.e.prototype.beginTransformFeedback=function(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(b?this._gl.POINTS:this._gl.TRIANGLES)},xd.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},xd.e.prototype.setTranformFeedbackVaryings=function(b,d){this._gl.transformFeedbackVaryings(b,d,this._gl.INTERLEAVED_ATTRIBS)},xd.e.prototype.bindTransformFeedbackBuffer=function(b){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,b?b.underlyingResource:null)},xd.e.prototype.readTransformFeedbackBuffer=function(b){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,b)};const Yd="clipPlaneFragmentDeclaration2",sd="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";X.c.IncludesShadersStore[Yd]||(X.c.IncludesShadersStore[Yd]=sd);P(12966),P(12973),P(12979),P(12982),P(12988),P(12992),P(12996),P(13e3);const Ed="gpuRenderParticlesPixelShader",wd="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";X.c.ShadersStore[Ed]||(X.c.ShadersStore[Ed]=wd);const td="clipPlaneVertexDeclaration2",rd="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";X.c.IncludesShadersStore[td]||(X.c.IncludesShadersStore[td]=rd);P(13008),P(13011),P(13019),P(13021);const Bd="gpuRenderParticlesVertexShader",nd="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";X.c.ShadersStore[Bd]||(X.c.ShadersStore[Bd]=nd);class Zd extends J{static get IsSupported(){if(!K.e.LastCreatedEngine)return!1;const b=K.e.LastCreatedEngine.getCaps();return b.supportTransformFeedbacks||b.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(b){this._maxActiveParticleCount=Math.min(b,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(b){this.maxActiveParticleCount=b}createPointEmitter(b,d){const P=Fb(b,d);return this.particleEmitterType=P,P}createHemisphericEmitter(){const b=hb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=b,b}createSphereEmitter(){const b=Tb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=b,b}createDirectedSphereEmitter(){const b=Kb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new G.ed(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new G.ed(0,1,0));return this.particleEmitterType=b,b}createCylinderEmitter(){const b=kb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=b,b}createDirectedCylinderEmitter(){const b=bd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new G.ed(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new G.ed(0,1,0));return this.particleEmitterType=b,b}createConeEmitter(){const b=dd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=b,b}createDirectedConeEmitter(){const b=Pd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new G.ed(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new G.ed(0,1,0));return this.particleEmitterType=b,b}createBoxEmitter(b,d,P,G){const W=new Y;return this.particleEmitterType=W,this.direction1=b,this.direction2=d,this.minEmitBox=P,this.maxEmitBox=G,W}get flowMap(){return this._flowMap}set flowMap(b){this._flowMap!==b&&(this._flowMap=b)}isReady(){if(!this.qd||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Cd.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Cd.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Cd.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";b?setTimeout((()=>{this.start(0)}),b):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var b;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(b=this._customWrappers[d])||void 0===b?void 0:b.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[b]??this._customWrappers[0]}setCustomEffect(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[d]=new bb.b(this._engine),this._customWrappers[d].effect=b}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new h.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(b,d,P){return super._removeGradientAndTexture(b,d,P),this._releaseBuffers(),this}addColorGradient(b,d){this._colorGradients||(this._colorGradients=[]);const P=new I(b,d);return this._colorGradients.push(P),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(b&&this._colorGradients.sort(((b,d)=>b.gradient<d.gradient?-1:b.gradient>d.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(b){return this._removeGradientAndTexture(b,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const d in this._drawWrappers){var b;null===(b=this._drawWrappers[d].drawContext)||void 0===b||b.reset()}}_addFactorGradient(b,d,P){const G=new v(d,P);b.push(G),this._releaseBuffers()}addSizeGradient(b,d){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,b,d),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(b){return this._removeGradientAndTexture(b,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(b,d){if(!b)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&b.sort(((b,d)=>b.gradient<d.gradient?-1:b.gradient>d.gradient?1:0));const P=this;P[d]&&(P[d].dispose(),P[d]=null)}addAngularSpeedGradient(b,d){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,b,d),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(b){return this._removeGradientAndTexture(b,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(b,d){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,b,d),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(b){return this._removeGradientAndTexture(b,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(b,d){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,b,d),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(b){return this._removeGradientAndTexture(b,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(b,d){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,b,d),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(b){return this._removeGradientAndTexture(b,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(b){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(b,d,P){let W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(b),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Zd=new h.d,this.onStoppedObservable=new h.d,this.onStartedObservable=new h.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,P&&"Scene"!==P.getClassName()?(this._engine=P,this.defaultProjectionMatrix=G.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=P||K.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.kY.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,C.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,C.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,C.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,C.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new bb.b(this._engine)},this._customWrappers[0].effect=W,this._drawWrappers={0:new bb.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(d=d??{}).randomTextureSize||delete d.randomTextureSize;const q={vd:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...d},J=d;isFinite(J)&&(q.vd=J),this._capacity=q.vd,this._maxActiveParticleCount=q.vd,this._currentActiveCount=0,this._isAnimationSheetEnabled=i,this.particleEmitterType=new Y;const L=Math.min(this._engine.getCaps().maxTextureSize,q.randomTextureSize);let x=[];for(let G=0;G<L;++G)x.push(Math.random()),x.push(Math.random()),x.push(Math.random()),x.push(Math.random());this._randomTexture=new T.b(new Float32Array(x),L,1,5,P,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,x=[];for(let G=0;G<L;++G)x.push(Math.random()),x.push(Math.random()),x.push(Math.random()),x.push(Math.random());this._randomTexture2=new T.b(new Float32Array(x),L,1,5,P,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=L}_reset(){this._releaseBuffers()}_createVertexBuffers(b,d,P){const G={};G.position=d.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let W=3;G.age=d.createVertexBuffer("age",W,1,this._attributesStrideSize,!0),W+=1,G.size=d.createVertexBuffer("size",W,3,this._attributesStrideSize,!0),W+=3,G.life=d.createVertexBuffer("life",W,1,this._attributesStrideSize,!0),W+=1,W+=4,this.billboardMode===Cd.BILLBOARDMODE_STRETCHED&&(G.direction=d.createVertexBuffer("direction",W,3,this._attributesStrideSize,!0)),W+=3,this._platform.alignDataInBuffer&&(W+=1),this.particleEmitterType instanceof o&&(W+=3,this._platform.alignDataInBuffer&&(W+=1)),this._colorGradientsTexture||(G.color=d.createVertexBuffer("color",W,4,this._attributesStrideSize,!0),W+=4),this._isBillboardBased||(G.initialDirection=d.createVertexBuffer("initialDirection",W,3,this._attributesStrideSize,!0),W+=3,this._platform.alignDataInBuffer&&(W+=1)),this.noiseTexture&&(G.noiseCoordinates1=d.createVertexBuffer("noiseCoordinates1",W,3,this._attributesStrideSize,!0),W+=3,this._platform.alignDataInBuffer&&(W+=1),G.noiseCoordinates2=d.createVertexBuffer("noiseCoordinates2",W,3,this._attributesStrideSize,!0),W+=3,this._platform.alignDataInBuffer&&(W+=1)),G.angle=d.createVertexBuffer("angle",W,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?W++:W+=2,this._isAnimationSheetEnabled&&(G.cellIndex=d.createVertexBuffer("cellIndex",W,1,this._attributesStrideSize,!0),W+=1,this.spriteRandomStartCell&&(G.cellStartOffset=d.createVertexBuffer("cellStartOffset",W,1,this._attributesStrideSize,!0),W+=1)),G.offset=P.createVertexBuffer("offset",0,2),G.uv=P.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(G),this._platform.createVertexBuffers(b,G),this.resetDrawCache()}_initialize(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!b)return;const d=this._engine,P=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof o&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const W=this.particleEmitterType instanceof o,i=G.TmpVectors.ed[0];let q=0;for(let G=0;G<this._capacity;G++)if(P.push(0),P.push(0),P.push(0),P.push(0),P.push(0),P.push(0),P.push(0),P.push(0),P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),W?(this.particleEmitterType.particleDestinationGenerator(G,null,i),P.push(i.x),P.push(i.y),P.push(i.z)):(P.push(0),P.push(0),P.push(0)),this._platform.alignDataInBuffer&&P.push(0),q+=16,W&&(this.particleEmitterType.particlePositionGenerator(G,null,i),P.push(i.x),P.push(i.y),P.push(i.z),this._platform.alignDataInBuffer&&P.push(0),q+=4),this._colorGradientsTexture||(P.push(0),P.push(0),P.push(0),P.push(0),q+=4),this.isBillboardBased||(P.push(0),P.push(0),P.push(0),this._platform.alignDataInBuffer&&P.push(0),q+=4),this.noiseTexture&&(P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),this._platform.alignDataInBuffer&&P.push(0),P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),this._platform.alignDataInBuffer&&P.push(0),q+=8),P.push(0),q+=1,this._angularSpeedGradientsTexture||(P.push(0),q+=1),this._isAnimationSheetEnabled&&(P.push(0),q+=1,this.spriteRandomStartCell&&(P.push(0),q+=1)),this._platform.alignDataInBuffer){let b=3-(q+3&3);for(q+=b;b-- >0;)P.push(0)}const C=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),J=this._platform.createParticleBuffer(P),L=this._platform.createParticleBuffer(P);this._buffer0=new A.b(d,J,!1,this._attributesStrideSize),this._buffer1=new A.b(d,L,!1,this._attributesStrideSize),this._spriteBuffer=new A.b(d,C,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let b=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(b+="\n#define BILLBOARD"),this._colorGradientsTexture&&(b+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(b+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(b+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(b+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(b+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(b+="\n#define DRAGGRADIENTS"),this._flowMap&&(b+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(b+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(b+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(b+="\n#define NOISE"),this.isLocal&&(b+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===b||(this._cachedUpdateDefines=b,this._updateBuffer=this._platform.createUpdateBuffer(b)),this._platform.isUpdateBufferReady()}_getWrapper(b){const d=this._getCustomDrawWrapper(b);if(null!==d&&void 0!==d&&d.effect)return d;const P=[];this.fillDefines(P,b);let G=this._drawWrappers[b];G||(G=new bb.b(this._engine),G.drawContext&&(G.drawContext.useInstancing=!0),this._drawWrappers[b]=G);const W=P.join("\n");if(G.defines!==W){const b=[],d=[],P=[];this.fillUniformsAttributesAndSamplerNames(d,b,P),G.setEffect(this._engine.createEffect("gpuRenderParticles",b,d,P,W),W)}return G}static _GetAttributeNamesOrOptions(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const W=[A.c.PositionKind,"age","life","size","angle"];return b||W.push(A.c.ColorKind),d&&W.push("cellIndex"),P||W.push("initialDirection"),G&&W.push("direction"),W.push("offset",A.c.UVKind),W}static _GetEffectCreationOptions(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const G=["emitterWM","LL","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,db.c)(G),b&&G.push("sheetInfos"),d&&G.push("logarithmicDepthConstant"),P&&(G.push("vFogInfos"),G.push("vFogColor")),G}fillDefines(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,db.k)(this,this._scene,b),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Ld.e.FOGMODE_NONE&&b.push("#define FOG")),d===Cd.BLENDMODE_MULTIPLY&&b.push("#define BLENDMULTIPLYMODE"),this.isLocal&&b.push("#define LOCAL"),this.useLogarithmicDepth&&b.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(b.push("#define BILLBOARD"),this.billboardMode){case Cd.BILLBOARDMODE_Y:b.push("#define BILLBOARDY");break;case Cd.BILLBOARDMODE_STRETCHED:b.push("#define BILLBOARDSTRETCHED");break;case Cd.BILLBOARDMODE_ALL:b.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&b.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&b.push("#define ANIMATESHEET"),P&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),b.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(b,d,P){d.push(...Zd._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Cd.BILLBOARDMODE_STRETCHED)),b.push(...Zd._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),P.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Jd.d.PrepareUniforms(b,this._imageProcessingConfigurationDefines),Jd.d.PrepareSamplers(P,this._imageProcessingConfigurationDefines))}animate(){var b;let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(d?this.preWarmStepOffset:(null===(b=this._scene)||void 0===b?void 0:b.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(b,d){const P=this[d];if(!b||!b.length||P)return;const G=new Float32Array(this._rawTextureWidth);for(let W=0;W<this._rawTextureWidth;W++){const d=W/this._rawTextureWidth;F.GetCurrentGradient(d,b,((b,d,P)=>{G[W]=(0,L.Lerp)(b.factor1,d.factor1,P)}))}this[d]=T.b.CreateRTexture(G,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[d].name=d.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const b=new Uint8Array(4*this._rawTextureWidth),d=q.TmpColors.ci[0];for(let P=0;P<this._rawTextureWidth;P++){const G=P/this._rawTextureWidth;F.GetCurrentGradient(G,this._colorGradients,((G,W,i)=>{q.ci.LerpToRef(G.color1,W.color1,i,d),b[4*P]=255*d.r,b[4*P+1]=255*d.g,b[4*P+2]=255*d.b,b[4*P+3]=255*d.a}))}this._colorGradientsTexture=T.b.CreateRGBATexture(b,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(b,d){var P,W,i,q;const C=this._getWrapper(b),J=C.effect;this._engine.enableEffect(C);const L=(null===(P=this._scene)||void 0===P?void 0:P.getViewMatrix())||G.Matrix.IdentityReadOnly;if(J.setMatrix("view",L),J.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),J.setTexture("diffuseSampler",this.particleTexture),J.setVector2("translationPivot",this.translationPivot),J.setVector3("LL",this.LL),this.isLocal&&J.setMatrix("emitterWM",d),this._colorGradientsTexture?J.setTexture("colorGradientSampler",this._colorGradientsTexture):J.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const b=this.particleTexture.getBaseSize();J.setFloat3("sheetInfos",this.spriteCellWidth/b.width,this.spriteCellHeight/b.height,b.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const b=this._scene.activeCamera;J.setVector3("eyePosition",b.globalPosition)}const x=J.defines;if(this._scene&&((0,db.f)(J,this,this._scene),this.applyFog&&(0,Pb.c)(this._scene,void 0,J)),x.indexOf("#define BILLBOARDMODE_ALL")>=0){const b=L.clone();b.invert(),J.setMatrix("invView",b)}return this.useLogarithmicDepth&&this._scene&&(0,Pb.e)(x,J,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(J),this._setEngineBasedOnBlendMode(b),this._platform.bindDrawBuffers(this._targetIndex,J,null!==(W=this._scene)&&void 0!==W&&W.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(J),null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(q=this._scene)&&void 0!==q&&q.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(b){if(!this.qd||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!b)if(this.qd.position){b=this.qd.getWorldMatrix()}else{const d=this.qd;b=G.TmpVectors.Matrix[0],G.Matrix.TranslationToRef(d.x,d.y,d.z,b)}const d=this._engine,P=d.getDepthWrite();if(d.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const b=this.Xb();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",b.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",b),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const W=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=W,d.setDepthWrite(P)}render(){let b,d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],P=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!d&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let b=0;b<this.preWarmCycles;b++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const b=0|this._accumulatedCount;this._accumulatedCount-=b,this._currentActiveCount+=b}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.qd.position){b=this.qd.getWorldMatrix()}else{const d=this.qd;b=G.TmpVectors.Matrix[0],G.Matrix.TranslationToRef(d.x,d.y,d.z,b)}const W=this._engine;this.updateInAnimate||this._update(b);let i=0;return d||P||(W.setState(!1),this.forceDepthWrite&&W.setDepthWrite(!0),i=this.blendMode===Cd.BLENDMODE_MULTIPLYADD?this._render(Cd.BLENDMODE_MULTIPLY,b)+this._render(Cd.BLENDMODE_ADD,b):this._render(this.blendMode,b),this._engine.setAlphaMode(0)),i}rebuild(){const b=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(b,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,b()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const d in this._drawWrappers){this._drawWrappers[d].dispose()}if(this._drawWrappers={},this._scene){const b=this._scene.kY.indexOf(this);b>-1&&this._scene.kY.splice(b,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let d=0;d<this._renderVertexBuffers.length;++d){const b=this._renderVertexBuffers[d];for(const d in b)b[d].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),b&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),b&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Zd.notifyObservers(this),this.Zd.clear()}clone(b,d){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const G={...this._customWrappers};let W=null;const i=this._engine;if(i.createEffectForParticles&&null!=this.customShader){W=this.customShader;const b=W.shaderOptions.defines.length>0?W.shaderOptions.defines.join("\n"):"";G[0]=i.createEffectForParticles(W.shaderPath.fragmentElement,W.shaderOptions.uniforms,W.shaderOptions.samplers,b,void 0,void 0,void 0,this)}const q=this.serialize(P),C=Zd.Parse(q,this._scene||this._engine,this._rootUrl);return C.name=b,C.customShader=W,C._customWrappers=G,void 0===d&&(d=this.qd),this.noiseTexture&&(C.noiseTexture=this.noiseTexture.clone()),C.qd=d,C}serialize(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={};return Cd._Serialize(d,this,b),d.activeParticleCount=this.activeParticleCount,d.randomTextureSize=this._randomTextureSize,d.customShader=this.customShader,d}static Parse(b,d,P){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3],W=arguments.length>4?arguments[4]:void 0;const i=b.name;let q,C;d instanceof vb.e?q=d:(C=d,q=C.getEngine());const J=new Zd(i,{vd:W||b.vd,randomTextureSize:b.randomTextureSize},d,null,b.isAnimationSheetEnabled);if(J._rootUrl=P,b.customShader&&q.createEffectForParticles){const d=b.customShader,P=d.shaderOptions.defines.length>0?d.shaderOptions.defines.join("\n"):"",G=q.createEffectForParticles(d.shaderPath.fragmentElement,d.shaderOptions.uniforms,d.shaderOptions.samplers,P,void 0,void 0,void 0,J);J.setCustomEffect(G,0),J.customShader=d}return b.id&&(J.id=b.id),b.activeParticleCount&&(J.activeParticleCount=b.activeParticleCount),Cd._Parse(b,J,d,P),b.preventAutoStart&&(J.preventAutoStart=b.preventAutoStart),G||J.preventAutoStart||J.start(),J}}var od=P(11484),Ad=P(13026),fd=P(12056);class gd{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(b){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const d of this.systems)d.qd=b;this._emitterNode=b}setEmitterAsSphere(b,d,P){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:b,renderingGroupId:d};const G=(0,Ad.c)("emitterSphere",{diameter:b.diameter,segments:b.segments},P);G.renderingGroupId=d;const W=new fd.Sd("emitterSphereMaterial",P);W.emissiveColor=b.color,G.material=W;for(const i of this.systems)i.qd=G;this._emitterNode=G}start(b){for(const d of this.systems)b&&(d.qd=b),d.start()}dispose(){for(const b of this.systems)b.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const d={systems:[]};for(const P of this.systems)d.systems.push(P.serialize(b));return this._emitterNode&&(d.qd=this._emitterCreationOptions),d}static Parse(b,d){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>3?arguments[3]:void 0;const W=new gd,i=this.BaseAssetsUrl+"/textures/";d=d||K.e.LastCreatedScene;for(const q of b.systems)W.systems.push(P?Zd.Parse(q,d,i,!0,G):Cd.Parse(q,d,i,!0,G));if(b.qd){const P=b.qd.options;if("Sphere"===b.qd.kind)W.setEmitterAsSphere({diameter:P.diameter,segments:P.segments,color:q.Nd.Od(P.color)},b.qd.renderingGroupId,d)}return W}}gd.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Xd=P(11531);class ud{static CreateDefault(b){let d,P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,G=arguments.length>2?arguments[2]:void 0;d=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Zd("default system",{vd:P},G):new Cd("default system",P,G),d.qd=b;const W=od.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return d.particleTexture=new l.d(W,d.Xb()),d.createConeEmitter(.1,Math.PI/4),d.color1=new q.ci(1,1,1,1),d.color2=new q.ci(1,1,1,1),d.colorDead=new q.ci(1,1,1,0),d.minSize=.1,d.maxSize=.1,d.minEmitPower=2,d.maxEmitPower=2,d.updateSpeed=1/60,d.emitRate=30,d}static CreateAsync(b,d){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>3?arguments[3]:void 0;d||(d=K.e.LastCreatedScene);const W={};return d.addPendingData(W),new Promise(((i,q)=>{if(P&&!Zd.IsSupported)return d.removePendingData(W),q("Particle system with GPU is not supported.");od.Tools.LoadFile(`${ud.BaseAssetsUrl}/systems/${b}.json`,(b=>{d.removePendingData(W);const q=JSON.parse(b.toString());return i(gd.Parse(q,d,P,G))}),void 0,void 0,void 0,(()=>(d.removePendingData(W),q(`An error occurred with the creation of your particle system. Check if your type '${b}' exists.`))))}))}static ExportSet(b){const d=new gd;for(const P of b)d.systems.push(P);return d}static ParseFromFileAsync(b,d,P){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3],W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",i=arguments.length>5?arguments[5]:void 0;return new Promise(((q,C)=>{const J=new Xd.c;J.addEventListener("readystatechange",(()=>{if(4==J.readyState)if(200==J.status){const d=JSON.parse(J.responseText);let C;C=G?Zd.Parse(d,P,W,!1,i):Cd.Parse(d,P,W,!1,i),b&&(C.name=b),q(C)}else C("Unable to load the particle system")})),J.open("GET",d),J.send()}))}static ParseFromSnippetAsync(b,d){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",W=arguments.length>4?arguments[4]:void 0;if("_BLANK"===b){const b=this.CreateDefault(null);return b.start(),Promise.resolve(b)}return new Promise(((i,q)=>{const C=new Xd.c;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){const q=JSON.parse(JSON.parse(C.responseText).jsonPayload),J=JSON.parse(q.particleSystem);let L;L=P?Zd.Parse(J,d,G,!1,W):Cd.Parse(J,d,G,!1,W),L.snippetId=b,i(L)}else q("Unable to load the snippet "+b)})),C.open("GET",this.SnippetUrl+"/"+b.replace(/#/g,"/")),C.send()}))}}ud.BaseAssetsUrl=gd.BaseAssetsUrl,ud.SnippetUrl="https://snippet.babylonjs.com",ud.CreateFromSnippetAsync=ud.ParseFromSnippetAsync;var Md=P(12134),ed=P(11949),Rd=P(13034);(0,Rd.h)(ed.b.NAME_PARTICLESYSTEM,((b,d,P,G)=>{const W=(0,Rd.l)(ed.b.NAME_PARTICLESYSTEM);if(W&&void 0!==b.kY&&null!==b.kY)for(let i=0,q=b.kY.length;i<q;i++){const q=b.kY[i];P.kY.push(W(q,d,G))}})),(0,Rd.d)(ed.b.NAME_PARTICLESYSTEM,((b,d,P)=>{if(b.activeParticleCount){return Zd.Parse(b,d,P)}return Cd.Parse(b,d,P)})),vb.e.prototype.createEffectForParticles=function(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4?arguments[4]:void 0,q=arguments.length>5?arguments[5]:void 0,C=arguments.length>6?arguments[6]:void 0,J=arguments.length>7?arguments[7]:void 0,L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,x=arguments.length>9?arguments[9]:void 0,Y=[],s=[];const E=[];return J?J.fillUniformsAttributesAndSamplerNames(s,Y,E):(Y=Cd._GetAttributeNamesOrOptions(),s=Cd._GetEffectCreationOptions()),-1===W.indexOf(" BILLBOARD")&&(W+="\n#define BILLBOARD\n"),null!==J&&void 0!==J&&J.isAnimationSheetEnabled&&-1===W.indexOf(" ANIMATESHEET")&&(W+="\n#define ANIMATESHEET\n"),-1===G.indexOf("diffuseSampler")&&G.push("diffuseSampler"),this.createEffect({vertex:x??(null===J||void 0===J?void 0:J.vertexShaderName)??"particles",fragmentElement:b},Y,s.concat(d),E.concat(G),W,i,q,C,void 0,L,(async()=>{0===L?await Promise.resolve().then(P.bind(P,13079)):await Promise.resolve().then(P.bind(P,13151))}))},Md.d.prototype.getEmittedParticleSystems=function(){const b=[];for(let d=0;d<this.Xb().kY.length;d++){const P=this.Xb().kY[d];P.qd===this&&b.push(P)}return b},Md.d.prototype.getHierarchyEmittedParticleSystems=function(){const b=[],d=this.getDescendants();d.push(this);for(let P=0;P<this.Xb().kY.length;P++){const G=this.Xb().kY[P],W=G.qd;W.position&&-1!==d.indexOf(W)&&b.push(G)}return b};P(12018),P(12033),P(12115);P(12119),P(13041),P(11873),P(12007),P(12152);P(11864);var Ud;P(13049),P(11707);!function(b){b[b.Color=2]="Color",b[b.UV=1]="UV",b[b.Random=0]="Random",b[b.Stated=3]="Stated"}(Ud||(Ud={}));var Hd=P(11898);const pd=new G.ed(0,0,0),Sd=new G.ed(0,0,0),ld=new G.ed(0,0,0);class Nd{constructor(b,d,P){this.width=b,this.height=d,this.data=P}processFlowable(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2?arguments[2]:void 0;if(!P)return;P instanceof G.Matrix?G.ed.TransformCoordinatesToRef(b.position,P,ld):(ld.x=P.x,ld.y=P.y,ld.z=P.z);const W=.5*ld.x+.5,i=1-(.5*ld.y+.5),q=Math.floor(W*this.width),C=Math.floor(i*this.height);if(q<0||q>=this.width||C<0||C>=this.height)return;const J=4*(C*this.width+q),L=this.data[J]/255*2-1,x=this.data[J+1]/255*2-1,Y=this.data[J+2]/255*2-1,s=this.data[J+3]/255;pd.set(L,x,Y),pd.scaleToRef(d*s,Sd),b.direction.addInPlace(Sd)}_processParticle(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,P=arguments.length>2?arguments[2]:void 0;this.processFlowable(b,d,P)}static async FromUrlAsync(b){return await new Promise(((d,P)=>{const G=document.createElement("canvas"),W=G.getContext("2d");let i=null;const q=new Image;q.crossOrigin="anonymous",q.src=b,q.onerror=d=>{P(new Error(`Failed to load image: ${b} : ${d}`))},q.onload=()=>{G.width=q.width,G.height=q.height,W.drawImage(q,0,0),i=W.getImageData(0,0,G.width,G.height),d(new Nd(G.width,G.height,i.data))}}))}static async ExtractFromTextureAsync(b){return await new Promise(((d,P)=>{if(!b.isReady())return void b.onLoadObservable.addOnce((async()=>{try{const P=await this.ExtractFromTextureAsync(b);d(P)}catch(G){P(G)}}));const G=b.getSize();Hd.g.GetTextureDataAsync(b,G.width,G.height).then((b=>{d(new Nd(G.width,G.height,new Uint8ClampedArray(b)))})).catch(P)}))}}var jd,ad,Od,Vd,yd,cd,Dd,zd,Qd;!function(b){b[b.Int=1]="Int",b[b.Float=2]="Float",b[b.Vector2=4]="Vector2",b[b.ed=8]="ed",b[b.Matrix=16]="Matrix",b[b.Particle=32]="Particle",b[b.Texture=64]="Texture",b[b.ci=128]="ci",b[b.FloatGradient=256]="FloatGradient",b[b.Vector2Gradient=512]="Vector2Gradient",b[b.Vector3Gradient=1024]="Vector3Gradient",b[b.Color4Gradient=2048]="Color4Gradient",b[b.System=4096]="System",b[b.AutoDetect=8192]="AutoDetect",b[b.BasedOnInput=16384]="BasedOnInput",b[b.Undefined=32768]="Undefined",b[b.All=65535]="All"}(jd||(jd={})),function(b){b[b.Compatible=0]="Compatible",b[b.TypeIncompatible=1]="TypeIncompatible",b[b.HierarchyIssue=2]="HierarchyIssue"}(ad||(ad={})),function(b){b[b.Input=0]="Input",b[b.Output=1]="Output"}(Od||(Od={}));class Id{get direction(){return this._direction}get type(){if(this._type===jd.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===jd.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(b){this._type=b}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((b=>b.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(b,d,P){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=jd.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new h.d,this.onDisconnectionObservable=new h.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=d,this.name=b,this._direction=P}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(b){var d;return this.isConnected?null!==(d=this._connectedPoint)&&void 0!==d&&d._storedFunction?this._connectedPoint._storedFunction(b):this._connectedPoint._storedValue:this.value}canConnectTo(b){return 0===this.checkCompatibilityState(b)}checkCompatibilityState(b){const d=this._ownerBlock,P=b.ownerBlock;if(this.type!==b.type&&b.innerType!==jd.AutoDetect)return b.acceptedConnectionPointTypes&&-1!==b.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(b.excludedConnectionPointTypes&&-1!==b.excludedConnectionPointTypes.indexOf(this.type))return 1;let G=P,W=d;return 0===this.direction&&(G=d,W=P),G.isAnAncestorOf(W)?2:0}connectTo(b){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(b))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${b.ownerBlock.name}".${b.name}`;return this._endpoints.push(b),b._connectedPoint=this,this.onConnectionObservable.notifyObservers(b),b.onConnectionObservable.notifyObservers(this),this}disconnectFrom(b){const d=this._endpoints.indexOf(b);return-1===d||(this._endpoints.splice(d,1),b._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(b),b.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(b){let d=1;for(;d<jd.All;)b&d||this.excludedConnectionPointTypes.push(d),d<<=1}serialize(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const d={};return d.name=this.name,d.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.jd?(d.valueType="BABYLON."+this.value.getClassName(),d.value=this.value.jd()):(d.valueType="number",d.value=this.value)),b&&this.connectedPoint&&(d.inputName=this.name,d.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,d.targetConnectionName=this.connectedPoint.name,d.isExposedOnFrame=!0,d.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(d.isExposedOnFrame=!0,d.exposedPortPosition=this.exposedPortPosition),d}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class md{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(b){this._name=b}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(b){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new h.d,this.Zd=new h.d,this.onInputChangedObservable=new h.d,this.visibleOnFrame=!1,this._name=b,this.uniqueId=N.b.UniqueId}_inputRename(b){return b}_outputRename(b){return b}isAnAncestorOf(b){for(const d of this._outputs)if(d.hasEndpoints)for(const P of d.endpoints){if(P.ownerBlock===b)return!0;if(P.ownerBlock.isAnAncestorOf(b))return!0}return!1}isAnAncestorOfType(b){if(this.getClassName()===b)return!0;for(const d of this._outputs)if(d.hasEndpoints)for(const P of d.endpoints)if(P.ownerBlock.isAnAncestorOfType(b))return!0;return!1}getInputByName(b){const d=this._inputs.filter((d=>d.name===b));return d.length?d[0]:null}_linkConnectionTypes(b,d){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[d]._acceptedConnectionPointType=this._inputs[b]:(this._inputs[b]._linkedConnectionSource=this._inputs[d],this._inputs[b]._isMainLinkSource=!0),this._inputs[d]._linkedConnectionSource=this._inputs[b]}registerInput(b,d){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>3?arguments[3]:void 0,W=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;const q=new Id(b,this,0);return q.type=d,q.isOptional=P,q.defaultValue=G,q.value=G,q.valueMin=W,q.valueMax=i,this._inputs.push(q),this.onInputChangedObservable.notifyObservers(q),this}registerOutput(b,d,P){return(P=P??new Id(b,this,1)).type=d,this._outputs.push(P),this}_build(b){}_customBuildStep(b){}build(b){if(this._buildId===b.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((b=>b.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=b.buildId;for(const d of this._inputs){if(!d.connectedPoint){d.isOptional||b.notConnectedNonOptionalInputs.push(d);continue}const P=d.connectedPoint.ownerBlock;P&&P!==this&&!P.isSystem&&P.build(b)}return this._customBuildStep(b),b.verbose&&j.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(b),this.onBuildObservable.notifyObservers(this),!1}serialize(){const b={};b.customType="BABYLON."+this.getClassName(),b.id=this.uniqueId,b.name=this.name,b.visibleOnFrame=this.visibleOnFrame,b.inputs=[],b.outputs=[];for(const d of this.inputs)b.inputs.push(d.serialize());for(const d of this.outputs)b.outputs.push(d.serialize(!1));return b}_deserialize(b){this._name=b.name,this.comments=b.comments,this.visibleOnFrame=!!b.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(b)}_deserializePortDisplayNamesAndExposedOnFrame(b){const d=b.inputs,P=b.outputs;if(d)for(const G of d){const b=this.inputs.find((b=>b.name===G.name));if(!b)return;if(G.displayName&&(b.displayName=G.displayName),G.isExposedOnFrame&&(b.isExposedOnFrame=G.isExposedOnFrame,b.exposedPortPosition=G.exposedPortPosition),void 0!==G.value&&null!==G.value)if("number"===G.valueType)b.value=G.value;else{const d=(0,C.d)(G.valueType);d&&(b.value=d.Od(G.value))}}if(P)for(let G=0;G<P.length;G++){const b=P[G];b.displayName&&(this.outputs[G].displayName=b.displayName),b.isExposedOnFrame&&(this.outputs[G].isExposedOnFrame=b.isExposedOnFrame,this.outputs[G].exposedPortPosition=b.exposedPortPosition)}}clone(){const b=this.serialize(),d=(0,C.d)(b.customType);if(d){const P=new d;return P._deserialize(b),P}return null}dispose(){this.Zd.notifyObservers(this),this.Zd.clear();for(const b of this.inputs)b.dispose();for(const b of this.outputs)b.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function vd(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",G=arguments.length>3?arguments[3]:void 0;return(W,i)=>{let q=W._propStore;q||(q=[],W._propStore=q),q.push({propertyName:i,displayName:b,type:d,groupName:P,options:G??{},className:W.getClassName()})}}(0,H.d)([(0,p.G)("comment")],md.prototype,"comments",void 0),function(b){b[b.Boolean=0]="Boolean",b[b.Float=1]="Float",b[b.Int=2]="Int",b[b.Vector2=3]="Vector2",b[b.List=4]="List",b[b.ci=5]="ci",b[b.SamplingMode=6]="SamplingMode",b[b.TextureFormat=7]="TextureFormat",b[b.TextureType=8]="TextureType"}(Vd||(Vd={})),function(b){b[b.None=0]="None",b[b.Position=1]="Position",b[b.Direction=2]="Direction",b[b.Age=3]="Age",b[b.Lifetime=4]="Lifetime",b[b.Color=5]="Color",b[b.ScaledDirection=6]="ScaledDirection",b[b.Scale=7]="Scale",b[b.AgeGradient=8]="AgeGradient",b[b.Angle=9]="Angle",b[b.SpriteCellIndex=16]="SpriteCellIndex",b[b.SpriteCellStart=17]="SpriteCellStart",b[b.SpriteCellEnd=18]="SpriteCellEnd"}(yd||(yd={})),function(b){b[b.None=0]="None",b[b.Time=1]="Time",b[b.Delta=2]="Delta",b[b.Emitter=3]="Emitter"}(cd||(cd={}));class Fd{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let b="";for(const d of this.notConnectedNonOptionalInputs)b+=`input ${d.name} from block ${d.ownerBlock.name}[${d.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(b)throw"Build of Node Particle System Set failed:\n"+b}adapt(b,d){const P=b.getConnectedValue(this)||0;if(b.type===d)return P;switch(d){case jd.Vector2:return new G.Vector2(P,P);case jd.ed:return new G.ed(P,P,P);case jd.ci:return new q.ci(P,P,P,P)}return null}getContextualValue(b){if(!this.particleContext||!this.systemContext)return null;switch(b){case yd.Position:return this.particleContext.position;case yd.Direction:return this.particleContext.direction;case yd.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case yd.Color:return this.particleContext.color;case yd.Age:return this.particleContext.age;case yd.Lifetime:return this.particleContext.lifeTime;case yd.Angle:return this.particleContext.angle;case yd.Scale:return this.particleContext.scale;case yd.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case yd.SpriteCellEnd:return this.systemContext.endSpriteCellID;case yd.SpriteCellIndex:return this.particleContext.cellIndex;case yd.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.qd.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.qd.absolutePosition:this.systemContext.qd:null}getSystemValue(b){if(!this.particleContext||!this.systemContext)return null;switch(b){case cd.Time:return this.systemContext._actualFrame;case cd.Delta:return this.systemContext._scaledUpdateSpeed;case cd.Emitter:if(this.isEmitterTransformNode){return this.systemContext.qd.absolutePosition}return this.systemContext.qd}return null}}function hd(b,d,P){const G=new Fd;G.Hd=d;const W=b.createSystem(G);return W.canStart=()=>!0,W.qd=P.clone(),W.disposeOnStop=!0,W.start(),W}class Td extends md{constructor(b){super(b),this.blendMode=J.BLENDMODE_ONEONE,this.vd=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",jd.Particle),this.registerInput("texture",jd.Texture),this.registerInput("onStart",jd.System,!0),this.registerInput("onEnd",jd.System,!0),this.registerOutput("system",jd.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(b){b.vd=this.vd,b.buildId=this._buildId++,this.build(b);const d=this.particle.getConnectedValue(b);return d.particleTexture=this.texture.getConnectedValue(b),d.emitRate=this.emitRate,d.blendMode=this.blendMode,d.name=this.name,d._nodeGenerated=!0,d._targetStopDuration=this.targetStopDuration,d.startDelay=this.startDelay,this.system._storedValue=this,d.canStart=()=>!this.doNoStart,d.onStartedObservable.add((P=>{const G=this.onStart.getConnectedValue(b);G&&P.onStartedObservable.addOnce((()=>{b.systemContext=d;const P=hd(G,b.Hd,b.emitterPosition);this.Zd.addOnce((()=>{P.dispose()}))}));const W=this.onEnd.getConnectedValue(b);W&&P.onStoppedObservable.addOnce((()=>{b.systemContext=d;const P=hd(W,b.Hd,b.emitterPosition);this.Zd.addOnce((()=>{P.dispose()}))}))})),this.Zd.addOnce((()=>{d.dispose()})),d}serialize(){const b=super.serialize();return b.vd=this.vd,b.emitRate=this.emitRate,b.blendMode=this.blendMode,b.doNoStart=this.doNoStart,b.targetStopDuration=this.targetStopDuration,b.startDelay=this.startDelay,b}_deserialize(b){super._deserialize(b),this.vd=b.vd,this.emitRate=b.emitRate,this.doNoStart=!!b.doNoStart,void 0!==b.blendMode&&(this.blendMode=b.blendMode),void 0!==b.targetStopDuration&&(this.targetStopDuration=b.targetStopDuration),void 0!==b.startDelay&&(this.startDelay=b.startDelay)}}(0,H.d)([vd("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:J.BLENDMODE_ONEONE},{label:"Standard",value:J.BLENDMODE_STANDARD},{label:"Add",value:J.BLENDMODE_ADD},{label:"Multiply",value:J.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:J.BLENDMODE_MULTIPLYADD}]})],Td.prototype,"blendMode",void 0),(0,H.d)([vd("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Td.prototype,"vd",void 0),(0,H.d)([vd("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Td.prototype,"emitRate",void 0),(0,H.d)([vd("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Td.prototype,"targetStopDuration",void 0),(0,H.d)([vd("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Td.prototype,"startDelay",void 0),(0,H.d)([vd("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Td.prototype,"doNoStart",void 0),(0,C.f)("BABYLON.SystemBlock",Td);class Kd extends md{get type(){if(this._type===jd.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=jd.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=jd.Vector2,this._type;case"ed":return this._type=jd.ed,this._type;case"ci":return this._type=jd.ci,this._type;case"Matrix":return this._type=jd.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===yd.None&&this._systemSource!==cd.None}get systemSource(){return this._systemSource}set systemSource(b){if(this._systemSource=b,b!==cd.None){switch(this._contextualSource=yd.None,this._type=jd.Float,b){case cd.Time:case cd.Delta:this._type=jd.Float;break;case cd.Emitter:this._type=jd.ed}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==yd.None}get contextualValue(){return this._contextualSource}set contextualValue(b){if(this._contextualSource=b,b!==yd.None){switch(this._systemSource=cd.None,b){case yd.Scale:this._type=jd.Vector2;break;case yd.Position:case yd.Direction:case yd.ScaledDirection:this._type=jd.ed;break;case yd.Color:this._type=jd.ci;break;case yd.Age:case yd.Lifetime:case yd.Angle:case yd.AgeGradient:this._type=jd.Float;break;case yd.SpriteCellEnd:case yd.SpriteCellStart:case yd.SpriteCellIndex:this._type=jd.Int}this.output&&(this.output.type=this._type)}}constructor(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:jd.AutoDetect;super(b),this._type=jd.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new h.d,this._systemSource=cd.None,this._contextualSource=yd.None,this._type=d,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",d)}get value(){return this._storedValue}set value(b){this.type===jd.Float&&this.min!==this.max&&(b=Math.max(this.min,b),b=Math.min(this.max,b)),this._storedValue=b,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(b){this._valueCallback=b}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case jd.Int:case jd.Float:this.value=0;break;case jd.Vector2:this.value=G.Vector2.Zero();break;case jd.ed:this.value=G.ed.Zero();break;case jd.ci:this.value=new q.ci(1,1,1,1);break;case jd.Matrix:this.value=G.Matrix.Identity()}}_build(b){super._build(b),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=b=>b.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=b=>b.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const b=super.serialize();return b.type=this.type,b.contextualValue=this.contextualValue,b.systemSource=this.systemSource,b.min=this.min,b.max=this.max,b.groupInInspector=this.groupInInspector,b.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.jd?(b.valueType="BABYLON."+this._storedValue.getClassName(),b.value=this._storedValue.jd()):(b.valueType="number",b.value=this._storedValue)),b}_deserialize(b){if(super._deserialize(b),this._type=b.type,this.contextualValue=b.contextualValue,this.systemSource=b.systemSource||cd.None,this.min=b.min||0,this.max=b.max||0,this.groupInInspector=b.groupInInspector||"",void 0!==b.displayInInspector&&(this.displayInInspector=b.displayInInspector),b.valueType)if("number"===b.valueType)this._storedValue=b.value;else{const d=(0,C.d)(b.valueType);d&&(this._storedValue=d.Od(b.value))}}}(0,C.f)("BABYLON.ParticleInputBlock",Kd);class kd extends md{get url(){return this._url}set url(b){this._url!==b&&(this._cachedData=null,this._url=b,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(b){this._textureDataUrl!==b&&(this._cachedData=null,this._textureDataUrl=b,this._url="",this._sourceTexture=null)}set sourceTexture(b){this._sourceTexture!==b&&(this._cachedData=null,this._sourceTexture=b,this._url="",this._textureDataUrl="")}constructor(b){super(b),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",jd.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const b=this.texture._storedValue;return await new Promise(((d,P)=>{if(!b.isReady())return void b.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),d(this._cachedData)}catch(b){P(b)}}));const G=b.getSize();Hd.g.GetTextureDataAsync(b,G.width,G.height).then((P=>{this._cachedData={width:G.width,height:G.height,data:new Uint8ClampedArray(P)},b.dispose(),d(this._cachedData)})).catch(P)}))}_build(b){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new l.d(this._textureDataUrl,b.Hd):this.texture._storedValue=new l.d(this._url,b.Hd):this.texture._storedValue=null}serialize(){const b=super.serialize();return b.url=this.url,b.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(b.textureDataUrl=this.textureDataUrl),b}_deserialize(b){super._deserialize(b),this.url=b.url,this.serializedCachedData=!!b.serializedCachedData,b.textureDataUrl&&(this.textureDataUrl=b.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,C.f)("BABYLON.ParticleTextureSourceBlock",kd);class bP extends md{constructor(b){super(b),this.registerInput("particle",jd.Particle),this.registerInput("position",jd.ed),this.registerOutput("output",jd.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(b){const d=this.particle.getConnectedValue(b);if(this.output._storedValue=d,!this.position.isConnected)return;const P={process:P=>{b.particleContext=P,b.systemContext=d,P.position.q(this.position.getConnectedValue(b))},previousItem:null,nextItem:null};d._updateQueueStart?cb(P,d._updateQueueStart):d._updateQueueStart=P}}(0,C.f)("BABYLON.UpdatePositionBlock",bP),function(b){b[b.Add=0]="Add",b[b.Subtract=1]="Subtract",b[b.Multiply=2]="Multiply",b[b.Divide=3]="Divide",b[b.Max=4]="Max",b[b.Min=5]="Min"}(Dd||(Dd={}));class dP extends md{constructor(b){super(b),this.operation=Dd.Add,this.registerInput("left",jd.AutoDetect),this.registerInput("right",jd.AutoDetect),this.registerOutput("output",jd.BasedOnInput),this.output._typeConnectionSource=this.left;const d=[jd.Matrix,jd.Particle,jd.Texture,jd.System,jd.FloatGradient,jd.Color4Gradient,jd.Vector2Gradient,jd.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...d),this.right.excludedConnectionPointTypes.push(...d),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(b){let d;const P=this.left,W=this.right;if(!P.isConnected||!W.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const i=P.type===jd.Float||P.type===jd.Int,C=W.type===jd.Float||W.type===jd.Int,J=i&&C;switch(this.operation){case Dd.Add:d=J?b=>P.getConnectedValue(b)+W.getConnectedValue(b):i?b=>b.adapt(P,W.type).add(W.getConnectedValue(b)):b=>P.getConnectedValue(b).add(b.adapt(W,P.type));break;case Dd.Subtract:d=J?b=>P.getConnectedValue(b)-W.getConnectedValue(b):i?b=>b.adapt(P,W.type).Rd(W.getConnectedValue(b)):b=>P.getConnectedValue(b).Rd(b.adapt(W,P.type));break;case Dd.Multiply:d=J?b=>P.getConnectedValue(b)*W.getConnectedValue(b):i?b=>b.adapt(P,W.type).multiply(W.getConnectedValue(b)):b=>P.getConnectedValue(b).multiply(b.adapt(W,P.type));break;case Dd.Divide:d=J?b=>P.getConnectedValue(b)/W.getConnectedValue(b):i?b=>b.adapt(P,W.type).divide(W.getConnectedValue(b)):b=>P.getConnectedValue(b).divide(b.adapt(W,P.type));break;case Dd.Min:if(J)d=b=>Math.min(P.getConnectedValue(b),W.getConnectedValue(b));else{const[b,C]=i?[W,P]:[P,W];switch(b.type){case jd.Vector2:d=d=>G.Vector2.Minimize(b.getConnectedValue(d),d.adapt(C,b.type));break;case jd.ed:d=d=>G.ed.Minimize(b.getConnectedValue(d),d.adapt(C,b.type));break;case jd.ci:d=d=>{const P=b.getConnectedValue(d),{r:G,g:W,b:i,a:J}=d.adapt(C,b.type);return new q.ci(Math.min(P.r,G),Math.min(P.g,W),Math.min(P.b,i),Math.min(P.a,J))}}}break;case Dd.Max:if(!J){const[b,C]=i?[W,P]:[P,W];switch(b.type){case jd.Vector2:d=d=>G.Vector2.Maximize(b.getConnectedValue(d),d.adapt(C,b.type));break;case jd.ed:d=d=>G.ed.Maximize(b.getConnectedValue(d),d.adapt(C,b.type));break;case jd.ci:d=d=>{const P=b.getConnectedValue(d),{r:G,g:W,b:i,a:J}=d.adapt(C,b.type);return new q.ci(Math.max(P.r,G),Math.min(P.g,W),Math.min(P.b,i),Math.min(P.a,J))}}break}d=b=>Math.max(P.getConnectedValue(b),W.getConnectedValue(b))}this.output._storedFunction=b=>P.type===jd.Int?0|d(b):d(b)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===jd.Int||this.left.type===jd.Float&&this.right.type!==jd.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[b,d]of[[this.left,this.right],[this.right,this.left]])b.acceptedConnectionPointTypes=[jd.Int,jd.Float],d.isConnected&&(b.acceptedConnectionPointTypes.push(d.type),d.type!==jd.Int&&d.type!==jd.Float||b.acceptedConnectionPointTypes.push(jd.Vector2,jd.ed,jd.ci))}dispose(){super.dispose();for(const b of this._connectionObservers)b.remove();this._connectionObservers.length=0}serialize(){const b=super.serialize();return b.operation=this.operation,b}_deserialize(b){super._deserialize(b),this.operation=b.operation}}(0,H.d)([vd("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Dd.Add},{label:"Subtract",value:Dd.Subtract},{label:"Multiply",value:Dd.Multiply},{label:"Divide",value:Dd.Divide},{label:"Max",value:Dd.Max},{label:"Min",value:Dd.Min}]})],dP.prototype,"operation",void 0),(0,C.f)("BABYLON.ParticleMathBlock",dP);class PP extends md{constructor(b){super(b),this.registerInput("particle",jd.Particle),this.registerInput("direction1",jd.ed,!0,new G.ed(0,1,0)),this.registerInput("direction2",jd.ed,!0,new G.ed(0,1,0)),this.registerInput("minEmitBox",jd.ed,!0,new G.ed(-.5,-.5,-.5)),this.registerInput("maxEmitBox",jd.ed,!0,new G.ed(.5,.5,.5)),this.registerOutput("output",jd.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(b){const d=this.particle.getConnectedValue(b);d._directionCreation.process=P=>{b.particleContext=P,b.systemContext=d;const W=this.direction1.getConnectedValue(b),i=this.direction2.getConnectedValue(b),q=(0,L.RandomRange)(W.x,i.x),C=(0,L.RandomRange)(W.y,i.y),J=(0,L.RandomRange)(W.z,i.z);b.isEmitterTransformNode?G.ed.TransformNormalFromFloatsToRef(q,C,J,b.emitterWorldMatrix,P.direction):P.direction.Fd(q,C,J)},d._positionCreation.process=P=>{b.particleContext=P,b.systemContext=d;const W=this.minEmitBox.getConnectedValue(b),i=this.maxEmitBox.getConnectedValue(b),q=(0,L.RandomRange)(W.x,i.x),C=(0,L.RandomRange)(W.y,i.y),J=(0,L.RandomRange)(W.z,i.z);b.isEmitterTransformNode?G.ed.TransformCoordinatesFromFloatsToRef(q,C,J,b.emitterWorldMatrix,P.position):(P.position.Fd(q,C,J),P.position.addInPlace(b.emitterPosition))},this.output._storedValue=d}}(0,C.f)("BABYLON.BoxShapeBlock",PP);class GP extends md{constructor(b){super(b),this.registerInput("emitPower",jd.Float,!0,1),this.registerInput("lifeTime",jd.Float,!0,1),this.registerInput("color",jd.ci,!0,new q.ci(1,1,1,1)),this.registerInput("scale",jd.Vector2,!0,new G.Vector2(1,1)),this.registerInput("angle",jd.Float,!0,0),this.registerOutput("particle",jd.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(b){const d=new Cd(this.name,b.vd,b.Hd,null,!1,void 0,!0);d.particleEmitterType=new B,d._lifeTimeCreation.process=(d,P)=>{b.particleContext=d,d.lifeTime=this.lifeTime.getConnectedValue(b),P._emitPower=this.emitPower.getConnectedValue(b)},d._colorCreation.process=d=>{b.particleContext=d,d.color.q(this.color.getConnectedValue(b))},d._sizeCreation.process=d=>{b.particleContext=d,d.size=1,d.scale.q(this.scale.getConnectedValue(b))},d._angleCreation.process=d=>{b.particleContext=d,d.angle=this.angle.getConnectedValue(b)},this.particle._storedValue=d}}(0,C.f)("BABYLON.CreateParticleBlock",GP);class WP{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const b=[];for(const d of this.attachedBlocks)d.isInput&&b.push(d);return b}constructor(b){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new h.d,this.name=b}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(b){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(b)&&this.attachedBlocks.push(b);for(const P of b.inputs){const G=P.connectedPoint;if(G){const P=G.ownerBlock;P!==b&&this._initializeBlock(P,d)}}}async buildAsync(b){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((P=>{const G=new gd;for(const b of this._systemBlocks)this._initializeBlock(b);for(const W of this.systemBlocks){const P=new Fd;P.buildId=this._buildId++,P.Hd=b,P.verbose=d;const i=W.createSystem(P);P.emitErrors(),G.systems.push(i)}this.onBuildObservable.notifyObservers(this),P(G)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const b=new Td("Particle system"),d=new bP("Update position");d.output.connectTo(b.particle);const P=new Kd("Position");P.contextualValue=yd.Position;const G=new Kd("Scaled direction");G.contextualValue=yd.ScaledDirection;const W=new dP("Add");W.operation=Dd.Add,P.output.connectTo(W.left),G.output.connectTo(W.right),W.output.connectTo(d.position);const i=new GP("Create particle"),q=new PP("Box shape");i.particle.connectTo(q.particle),q.output.connectTo(d.particle);const C=new kd("Texture");C.texture.connectTo(b.texture),C.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(b)}removeBlock(b){const d=this.attachedBlocks.indexOf(b);if(d>-1&&this.attachedBlocks.splice(d,1),b.isSystem){const d=this._systemBlocks.indexOf(b);d>-1&&this._systemBlocks.splice(d,1)}}parseSerializedObject(b){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d||this.clear();const P={};for(const G of b.xx){const b=(0,C.d)(G.customType);if(b){const d=new b;d._deserialize(G),P[G.id]=d,this.attachedBlocks.push(d),d.isSystem&&this._systemBlocks.push(d)}}for(const G of this.attachedBlocks)if(G.isTeleportOut){const b=G,d=b._tempEntryPointUniqueId;if(d){const G=P[d];G&&G.attachToEndpoint(b)}}for(let G=0;G<b.xx.length;G++){const W=b.xx[G],i=P[W.id];i&&(i.inputs.length&&W.inputs.some((b=>b.targetConnectionName))&&!d||this._restoreConnections(i,b,P))}if(b.locations||b.editorData&&b.editorData.locations){const G=b.locations||b.editorData.locations;for(const b of G)P[b.oG]&&(b.oG=P[b.oG].uniqueId);d&&this.editorData&&this.editorData.locations&&G.concat(this.editorData.locations),b.locations?this.editorData={locations:G}:(this.editorData=b.editorData,this.editorData.locations=G);const W=[];for(const b in P)W[b]=P[b].uniqueId;this.editorData.map=W}this.comment=b.comment}_restoreConnections(b,d,P){for(const G of b.outputs)for(const W of d.xx){const i=P[W.id];if(i)for(const q of W.inputs)if(P[q.targetBlockId]!==b||q.targetConnectionName!==G.name);else{const b=i.getInputByName(q.inputName);if(!b||b.isConnected)continue;G.connectTo(b,!0),this._restoreConnections(i,d,P)}}}serialize(b){const d=b?{}:S.c.Serialize(this);d.editorData=JSON.parse(JSON.stringify(this.editorData));let P=[];b?P=b:d.customType="BABYLON.NodeParticleSystemSet",d.xx=[];for(const G of P)d.xx.push(G.serialize());if(!b)for(const G of this.attachedBlocks)-1===P.indexOf(G)&&d.xx.push(G.serialize());return d}dispose(){for(const b of this.attachedBlocks)b.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(b){const d=new WP(b);return d.setToDefault(),d}static Parse(b){const d=S.c.Parse((()=>new WP(b.name)),b,null);return d.parseSerializedObject(b),d}static ParseFromSnippetAsync(b,d){return"_BLANK"===b?Promise.resolve(WP.CreateDefault("blank")):new Promise(((P,G)=>{const W=new Xd.c;W.addEventListener("readystatechange",(()=>{if(4==W.readyState)if(200==W.status){const q=JSON.parse(JSON.parse(W.responseText).jsonPayload),C=JSON.parse(q.nodeParticle);d||(d=S.c.Parse((()=>new WP(b)),C,null)),d.parseSerializedObject(C),d.snippetId=b;try{P(d)}catch(i){G(i)}}else G("Unable to load the snippet "+b)})),W.open("GET",this.SnippetUrl+"/"+b.replace(/#/g,"/")),W.send()}))}}WP.EditorURL=`${od.Tools._DefaultCdnUrl}/v${vb.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,WP.SnippetUrl="https://snippet.babylonjs.com",(0,H.d)([(0,p.G)()],WP.prototype,"name",void 0),(0,H.d)([(0,p.G)("comment")],WP.prototype,"comment",void 0),function(b){b[b.None=0]="None",b[b.PerParticle=1]="PerParticle",b[b.PerSystem=2]="PerSystem"}(zd||(zd={}));class iP extends md{constructor(b){super(b),this._currentLockId=-2,this.lockMode=zd.PerParticle,this.registerInput("min",jd.AutoDetect,!0,0),this.registerInput("max",jd.AutoDetect,!0,1),this.registerOutput("output",jd.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(jd.Float|jd.Int|jd.Vector2|jd.ed|jd.ci),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(jd.Float|jd.Int|jd.Vector2|jd.ed|jd.ci),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=jd.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let b=null;switch(this._currentLockId=-2,this.min.type){case jd.AutoDetect:case jd.Int:case jd.Float:b=b=>{const d=this.min.getConnectedValue(b)||0,P=this.max.getConnectedValue(b)||1;return d+Math.random()*(P-d)};break;case jd.Vector2:b=b=>{const d=this.min.getConnectedValue(b)||G.Vector2.Zero(),P=this.max.getConnectedValue(b)||G.Vector2.One();return new G.Vector2(d.x+Math.random()*(P.x-d.x),d.y+Math.random()*(P.y-d.y))};break;case jd.ed:b=b=>{const d=this.min.getConnectedValue(b)||G.ed.Zero(),P=this.max.getConnectedValue(b)||G.ed.One();return new G.ed(d.x+Math.random()*(P.x-d.x),d.y+Math.random()*(P.y-d.y),d.z+Math.random()*(P.z-d.z))};break;case jd.ci:b=b=>{const d=this.min.getConnectedValue(b)||new q.ci(0,0,0,0),P=this.max.getConnectedValue(b)||new q.ci(1,1,1,1);return new q.ci(d.x+Math.random()*(P.x-d.x),d.y+Math.random()*(P.y-d.y),d.z+Math.random()*(P.z-d.z),d.w+Math.random()*(P.w-d.w))}}this.output._storedFunction=d=>{var P;let G=0;switch(this.lockMode){case zd.PerParticle:G=(null===(P=d.particleContext)||void 0===P?void 0:P.id)||-1;break;case zd.PerSystem:G=d.buildId||0}return this._currentLockId!==G&&(this.lockMode!==zd.None&&(this._currentLockId=G),this.output._storedValue=b(d)),this.output._storedValue}}serialize(){const b=super.serialize();return b.lockMode=this.lockMode,b}_deserialize(b){super._deserialize(b),this.lockMode=b.lockMode}}(0,H.d)([vd("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:zd.None},{label:"Per particle",value:zd.PerParticle},{label:"Per system",value:zd.PerSystem}]})],iP.prototype,"lockMode",void 0),(0,C.f)("BABYLON.ParticleRandomBlock",iP);class qP extends md{constructor(b){super(b),this._currentLockId=-2,this.lockMode=zd.PerParticle,this.registerInput("min",jd.AutoDetect),this.registerInput("max",jd.AutoDetect),this.registerOutput("output",jd.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const d=[jd.Matrix,jd.Particle,jd.Texture,jd.System,jd.FloatGradient,jd.Color4Gradient,jd.Vector2Gradient,jd.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...d),this.max.excludedConnectionPointTypes.push(...d)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let b=null;switch(this._currentLockId=-2,this.min.type){case jd.Float:case jd.Int:b=b=>{const d=this.min.getConnectedValue(b),P=this.max.getConnectedValue(b);return Math.random()*(P-d)+d};break;case jd.Vector2:b=b=>{const d=this.min.getConnectedValue(b),P=this.max.getConnectedValue(b);return new G.Vector2(Math.random()*(P.x-d.x)+d.x,Math.random()*(P.y-d.y)+d.y)};break;case jd.ed:b=b=>{const d=this.min.getConnectedValue(b),P=this.max.getConnectedValue(b);return new G.ed(Math.random()*(P.x-d.x)+d.x,Math.random()*(P.y-d.y)+d.y,Math.random()*(P.z-d.z)+d.z)};break;case jd.ci:b=b=>{const d=this.min.getConnectedValue(b),P=this.max.getConnectedValue(b);return new q.ci(Math.random()*(P.r-d.r)+d.r,Math.random()*(P.g-d.g)+d.g,Math.random()*(P.b-d.b)+d.b,Math.random()*(P.a-d.a)+d.a)}}this.output._storedFunction=d=>{var P;let G=0;switch(this.lockMode){case zd.PerParticle:G=(null===(P=d.particleContext)||void 0===P?void 0:P.id)||-1;break;case zd.PerSystem:G=d.buildId||0}return this._currentLockId!==G&&(this.lockMode!==zd.None&&(this._currentLockId=G),this.output._storedValue=b(d)),this.output._storedValue}}serialize(){const b=super.serialize();return b.lockMode=this.lockMode,b}_deserialize(b){super._deserialize(b),void 0!==b.lockMode&&(this.lockMode=b.lockMode)}}(0,H.d)([vd("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:zd.None},{label:"Per particle",value:zd.PerParticle},{label:"Per system",value:zd.PerSystem}]})],qP.prototype,"lockMode",void 0),(0,C.f)("BABYLON.RandomRangeBlock",qP);(0,C.f)("BABYLON.ParticleLerpBlock",class extends md{constructor(b){super(b),this.registerInput("left",jd.AutoDetect),this.registerInput("right",jd.AutoDetect),this.registerInput("gradient",jd.Float,!0,0,0,1),this.registerOutput("output",jd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(jd.Float|jd.Int|jd.Vector2|jd.ed|jd.ci)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const b=(b,d,P)=>(1-b)*d+b*P;this.output._storedFunction=d=>{const P=this.left.getConnectedValue(d),W=this.right.getConnectedValue(d),i=this.gradient.getConnectedValue(d);switch(this.left.type){case jd.Int:case jd.Float:return b(i,P,W);case jd.Vector2:return new G.Vector2(b(i,P.x,W.x),b(i,P.y,W.y));case jd.ed:return new G.ed(b(i,P.x,W.x),b(i,P.y,W.y),b(i,P.z,W.z));case jd.ci:return new q.ci(b(i,P.r,W.r),b(i,P.g,W.g),b(i,P.b,W.b),b(i,P.a,W.a))}return 0}}});(0,C.f)("BABYLON.UpdateDirectionBlock",class extends md{constructor(b){super(b),this.registerInput("particle",jd.Particle),this.registerInput("direction",jd.ed),this.registerOutput("output",jd.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(b){const d=this.particle.getConnectedValue(b);if(this.output._storedValue=d,!this.direction.isConnected)return;const P={process:P=>{b.particleContext=P,b.systemContext=d,P.direction.q(this.direction.getConnectedValue(b))},previousItem:null,nextItem:null};d._updateQueueStart?cb(P,d._updateQueueStart):d._updateQueueStart=P}});(0,C.f)("BABYLON.UpdateColorBlock",class extends md{constructor(b){super(b),this.registerInput("particle",jd.Particle),this.registerInput("color",jd.ci),this.registerOutput("output",jd.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(b){const d=this.particle.getConnectedValue(b);if(this.output._storedValue=d,!this.color.isConnected)return;const P={process:P=>{b.particleContext=P,b.systemContext=d,P.color.q(this.color.getConnectedValue(b))},previousItem:null,nextItem:null};d._updateQueueStart?cb(P,d._updateQueueStart):d._updateQueueStart=P}});(0,C.f)("BABYLON.UpdateScaleBlock",class extends md{constructor(b){super(b),this.registerInput("particle",jd.Particle),this.registerInput("scale",jd.Vector2),this.registerOutput("output",jd.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(b){const d=this.particle.getConnectedValue(b);if(this.output._storedValue=d,!this.scale.isConnected)return;const P={process:P=>{b.particleContext=P,b.systemContext=d,P.scale.q(this.scale.getConnectedValue(b))},previousItem:null,nextItem:null};d._updateQueueStart?cb(P,d._updateQueueStart):d._updateQueueStart=P}});(0,C.f)("BABYLON.UpdateAngleBlock",class extends md{constructor(b){super(b),this.registerInput("particle",jd.Particle),this.registerInput("angle",jd.Float),this.registerOutput("output",jd.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(b){const d=this.particle.getConnectedValue(b);if(this.output._storedValue=d,!this.angle.isConnected)return;const P={process:P=>{b.particleContext=P,b.systemContext=d,P.angle=this.angle.getConnectedValue(b)},previousItem:null,nextItem:null};d._updateQueueStart?cb(P,d._updateQueueStart):d._updateQueueStart=P}});(0,C.f)("BABYLON.BasicPositionUpdateBlock",class extends md{constructor(b){super(b),this.registerInput("particle",jd.Particle),this.registerOutput("output",jd.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(b){const d=this.particle.getConnectedValue(b),P={process:P=>{b.particleContext=P,b.systemContext=d,P.direction.scaleToRef(d._directionScale,d._scaledDirection),P.position.addInPlace(d._scaledDirection)},previousItem:null,nextItem:null};d._updateQueueStart?cb(P,d._updateQueueStart):d._updateQueueStart=P,this.output._storedValue=d}});(0,C.f)("BABYLON.BasicSpriteUpdateBlock",class extends md{constructor(b){super(b),this.registerInput("particle",jd.Particle),this.registerOutput("output",jd.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(b){const d=this.particle.getConnectedValue(b),P={process:P=>{b.particleContext=P,b.systemContext=d,P.updateCellIndex()},previousItem:null,nextItem:null};d._updateQueueStart?cb(P,d._updateQueueStart):d._updateQueueStart=P,this.output._storedValue=d}});(0,C.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends md{constructor(b){super(b),this.registerInput("particle",jd.Particle),this.registerInput("cellIndex",jd.Int),this.registerOutput("output",jd.Particle),this.cellIndex.acceptedConnectionPointTypes=[jd.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(b){const d=this.particle.getConnectedValue(b);if(this.output._storedValue=d,!this.cellIndex.isConnected)return;const P={process:P=>{b.particleContext=P,b.systemContext=d,P.cellIndex=Math.floor(this.cellIndex.getConnectedValue(b))},previousItem:null,nextItem:null};d._updateQueueStart?cb(P,d._updateQueueStart):d._updateQueueStart=P}});class CP extends md{constructor(b){super(b),this.strength=1,this.registerInput("particle",jd.Particle),this.registerInput("flowMap",jd.Texture),this.registerOutput("output",jd.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(b){var d;const P=this.particle.getConnectedValue(b),G=b.Hd;let W;(null===(d=this.flowMap.connectedPoint)||void 0===d?void 0:d.ownerBlock).extractTextureContentAsync().then((b=>{b&&(W=new Nd(b.width,b.height,b.data))}));const i={process:b=>{const d=G.getTransformMatrix();W&&W._processParticle(b,this.strength*P._tempScaledUpdateSpeed,d)},previousItem:null,nextItem:null};P._updateQueueStart?cb(i,P._updateQueueStart):P._updateQueueStart=i,this.output._storedValue=P}serialize(){const b=super.serialize();return b.strength=this.strength,b}_deserialize(b){super._deserialize(b),this.strength=b.strength}}(0,H.d)([vd("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],CP.prototype,"strength",void 0),(0,C.f)("BABYLON.UpdateFlowMapBlock",CP);(0,C.f)("BABYLON.SphereShapeBlock",class extends md{constructor(b){super(b),this.registerInput("input",jd.Particle),this.registerInput("radius",jd.Float,!0,1),this.registerInput("radiusRange",jd.Float,!0,1,0,1),this.registerInput("directionRandomizer",jd.Float,!0,0,0,1),this.registerOutput("output",jd.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(b){const d=this.input.getConnectedValue(b);d._directionCreation.process=P=>{b.particleContext=P,b.systemContext=d;const W=this.directionRandomizer.getConnectedValue(b),i=P.position.Rd(b.emitterPosition).normalize(),q=(0,L.RandomRange)(0,W),C=(0,L.RandomRange)(0,W),J=(0,L.RandomRange)(0,W);i.x+=q,i.y+=C,i.z+=J,i.normalize(),b.isEmitterTransformNode?G.ed.TransformNormalFromFloatsToRef(q,C,J,b.emitterWorldMatrix,P.direction):P.direction.Fd(q,C,J)},d._positionCreation.process=P=>{b.particleContext=P,b.systemContext=d;const W=this.radius.getConnectedValue(b),i=this.radiusRange.getConnectedValue(b),q=W-(0,L.RandomRange)(0,W*i),C=(0,L.RandomRange)(0,1),J=(0,L.RandomRange)(0,2*Math.PI),x=Math.acos(2*C-1),Y=q*Math.cos(J)*Math.sin(x),s=q*Math.cos(x),E=q*Math.sin(J)*Math.sin(x);b.isEmitterTransformNode?G.ed.TransformCoordinatesFromFloatsToRef(Y,s,E,b.emitterWorldMatrix,P.position):(P.position.Fd(Y,s,E),P.position.addInPlace(b.emitterPosition))},this.output._storedValue=d}});(0,C.f)("BABYLON.PointShapeBlock",class extends md{constructor(b){super(b),this.registerInput("particle",jd.Particle),this.registerInput("direction1",jd.ed,!0,new G.ed(0,1,0)),this.registerInput("direction2",jd.ed,!0,new G.ed(0,1,0)),this.registerOutput("output",jd.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(b){const d=this.particle.getConnectedValue(b);d._directionCreation.process=P=>{b.particleContext=P,b.systemContext=d;const W=this.direction1.getConnectedValue(b),i=this.direction2.getConnectedValue(b),q=(0,L.RandomRange)(W.x,i.x),C=(0,L.RandomRange)(W.y,i.y),J=(0,L.RandomRange)(W.z,i.z);b.isEmitterTransformNode?G.ed.TransformNormalFromFloatsToRef(q,C,J,b.emitterWorldMatrix,P.direction):P.direction.Fd(q,C,J)},d._positionCreation.process=P=>{b.systemContext=d,b.isEmitterTransformNode?G.ed.TransformCoordinatesFromFloatsToRef(0,0,0,b.emitterWorldMatrix,P.position):P.position.q(b.emitterPosition)},this.output._storedValue=d}});(0,C.f)("BABYLON.CustomShapeBlock",class extends md{constructor(b){super(b),this.registerInput("particle",jd.Particle),this.registerInput("position",jd.ed,!0,new G.ed(0,0,0)),this.registerInput("direction",jd.ed,!0,new G.ed(0,1,0)),this.registerOutput("output",jd.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(b){const d=this.particle.getConnectedValue(b);d._directionCreation.process=P=>{b.particleContext=P,b.systemContext=d;const W=this.direction.getConnectedValue(b);b.isEmitterTransformNode?G.ed.TransformNormalToRef(W,b.emitterWorldMatrix,P.direction):P.direction.q(W)},d._positionCreation.process=P=>{b.particleContext=P,b.systemContext=d;const W=this.position.getConnectedValue(b);b.isEmitterTransformNode?G.ed.TransformCoordinatesToRef(W,b.emitterWorldMatrix,P.position):(P.position.q(W),P.position.addInPlace(b.emitterPosition))},this.output._storedValue=d}});(0,C.f)("BABYLON.CylinderShapeBlock",class extends md{constructor(b){super(b),this._tempVector=G.ed.Zero(),this.registerInput("particle",jd.Particle),this.registerInput("radius",jd.Float,!0,1),this.registerInput("height",jd.Float,!0,1,0),this.registerInput("radiusRange",jd.Float,!0,1,0,1),this.registerInput("directionRandomizer",jd.Float,!0,0,0,1),this.registerOutput("output",jd.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(b){const d=this.particle.getConnectedValue(b);d._directionCreation.process=P=>{b.particleContext=P,b.systemContext=d;const W=this.directionRandomizer.getConnectedValue(b);P.position.subtractToRef(b.emitterPosition,this._tempVector),this._tempVector.normalize(),b.isEmitterTransformNode&&G.ed.TransformNormalToRef(this._tempVector,b.emitterInverseWorldMatrix,this._tempVector);const i=(0,L.RandomRange)(-W/2,W/2);let q=Math.atan2(this._tempVector.x,this._tempVector.z);q+=(0,L.RandomRange)(-Math.PI/2,Math.PI/2)*W,this._tempVector.y=i,this._tempVector.x=Math.sin(q),this._tempVector.z=Math.cos(q),this._tempVector.normalize(),b.isEmitterTransformNode?G.ed.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,b.emitterWorldMatrix,P.direction):P.direction.q(this._tempVector)},d._positionCreation.process=P=>{b.particleContext=P,b.systemContext=d;const W=this.height.getConnectedValue(b),i=this.radiusRange.getConnectedValue(b),q=this.radius.getConnectedValue(b),C=(0,L.RandomRange)(-W/2,W/2),J=(0,L.RandomRange)(0,2*Math.PI),x=(0,L.RandomRange)((1-i)*(1-i),1),Y=Math.sqrt(x)*q,s=Y*Math.cos(J),E=Y*Math.sin(J);b.isEmitterTransformNode?G.ed.TransformCoordinatesFromFloatsToRef(s,C,E,b.emitterWorldMatrix,P.position):(P.position.Fd(s,C,E),P.position.addInPlace(b.emitterPosition))},this.output._storedValue=d}});class JP extends md{constructor(b){super(b),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",jd.Particle),this.registerOutput("output",jd.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(b){super._build(b);const d=this.particle.getConnectedValue(b);d._isAnimationSheetEnabled=!0,d.spriteCellWidth=this.width,d.spriteCellHeight=this.height,d.startSpriteCellID=this.start,d.endSpriteCellID=this.end,d.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=d}serialize(){const b=super.serialize();return b.width=this.width,b.height=this.height,b.start=this.start,b.end=this.end,b.randomStartCell=this.randomStartCell,b}_deserialize(b){super._deserialize(b),this.width=b.width,this.height=b.height,this.start=b.start,this.end=b.end,this.randomStartCell=b.randomStartCell}}(0,H.d)([vd("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],JP.prototype,"start",void 0),(0,H.d)([vd("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],JP.prototype,"end",void 0),(0,H.d)([vd("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],JP.prototype,"width",void 0),(0,H.d)([vd("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],JP.prototype,"height",void 0),(0,H.d)([vd("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],JP.prototype,"loop",void 0),(0,H.d)([vd("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],JP.prototype,"randomStartCell",void 0),(0,C.f)("BABYLON.SetupSpriteSheetBlock",JP);class LP extends md{constructor(b){super(b),this.reference=0,this.registerInput("value",jd.AutoDetect),this.registerOutput("output",jd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=b=>{switch(b){case jd.Float:return jd.FloatGradient;case jd.Vector2:return jd.Vector2Gradient;case jd.ed:return jd.Vector3Gradient;case jd.ci:return jd.Color4Gradient}return b},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(jd.Float|jd.Vector2|jd.ed|jd.ci)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=b=>null}serialize(){const b=super.serialize();return b.reference=this.reference,b}_deserialize(b){super._deserialize(b),this.reference=b.reference}}(0,H.d)([vd("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],LP.prototype,"reference",void 0),(0,C.f)("BABYLON.ParticleGradientValueBlock",LP);(0,C.f)("BABYLON.ParticleGradientBlock",class extends md{constructor(b){super(b),this._entryCount=1,this.registerInput("gradient",jd.Float,!0,1,0,1),this.registerInput("value0",jd.AutoDetect),this.registerOutput("output",jd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=b=>{switch(b){case jd.FloatGradient:return jd.Float;case jd.Vector2Gradient:return jd.Vector2;case jd.Vector3Gradient:return jd.ed;case jd.Color4Gradient:return jd.ci}return b},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(jd.FloatGradient|jd.Vector2Gradient|jd.Vector3Gradient|jd.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(b){this._inputs[b].onConnectionObservable.add((()=>{this._entryCount>b||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),jd.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const b=[];for(let P=1;P<this._inputs.length;P++){var d;if(this._inputs[P].isConnected)b.push(null===(d=this._inputs[P].connectedPoint)||void 0===d?void 0:d.ownerBlock)}b.sort(((b,d)=>b.reference-d.reference)),this.output._storedFunction=d=>{const P=this.gradient.getConnectedValue(d);if(1===b.length)return b[0].value.getConnectedValue(d);let W=null;for(let i=b.length-1;i>=0;i--){const C=b[i];if(C.reference<=P){const b=C.value.getConnectedValue(d);if(W){const i=W.value.getConnectedValue(d),J=W.reference,x=C.reference,Y=Math.max(0,Math.min(1,(P-x)/(J-x)));switch(this.output.type){case jd.Float:return(0,L.Lerp)(b,i,Y);case jd.Vector2:return G.Vector2.Lerp(b,i,Y);case jd.ed:return G.ed.Lerp(b,i,Y);case jd.ci:return q.ci.Lerp(b,i,Y)}}return b}W=C}return 0}}});(0,C.f)("BABYLON.ParticleConverterBlock",class extends md{constructor(b){super(b),this.registerInput("color ",jd.ci,!0),this.registerInput("xyz ",jd.ed,!0),this.registerInput("xy ",jd.Vector2,!0),this.registerInput("zw ",jd.Vector2,!0),this.registerInput("x ",jd.Float,!0),this.registerInput("y ",jd.Float,!0),this.registerInput("z ",jd.Float,!0),this.registerInput("w ",jd.Float,!0),this.registerOutput("color",jd.ci),this.registerOutput("xyz",jd.ed),this.registerOutput("xy",jd.Vector2),this.registerOutput("zw",jd.Vector2),this.registerOutput("x",jd.Float),this.registerOutput("y",jd.Float),this.registerOutput("z",jd.Float),this.registerOutput("w",jd.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(b){return"color "===b?"colorIn":"xyz "===b?"xyzIn":"xy "===b?"xyIn":"zw "===b?"zwIn":"x "===b?"xIn":"y "===b?"yIn":"z "===b?"zIn":"w "===b?"wIn":b}_outputRename(b){switch(b){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return b}}_build(b){super._build(b);const d=this.xIn,P=this.yIn,W=this.zIn,i=this.wIn,C=this.xyIn,J=this.zwIn,L=this.xyzIn,x=this.colorIn,Y=this.colorOut,s=this.xyzOut,E=this.xyOut,w=this.zwOut,t=this.xOut,r=this.yOut,B=this.zOut,n=this.wOut,Z=b=>{if(x.isConnected)return x.getConnectedValue(b);let G=0,Y=0,s=0,E=0;if(d.isConnected&&(G=d.getConnectedValue(b)),P.isConnected&&(Y=P.getConnectedValue(b)),W.isConnected&&(s=W.getConnectedValue(b)),i.isConnected&&(E=i.getConnectedValue(b)),C.isConnected){const d=C.getConnectedValue(b);d&&(G=d.x,Y=d.y)}if(J.isConnected){const d=J.getConnectedValue(b);d&&(s=d.x,E=d.y)}if(L.isConnected){const d=L.getConnectedValue(b);d&&(G=d.x,Y=d.y,s=d.z)}return new q.ci(G,Y,s,E)};Y._storedFunction=b=>Z(b),s._storedFunction=b=>{const d=Z(b);return new G.ed(d.r,d.g,d.b)},E._storedFunction=b=>{const d=Z(b);return new G.Vector2(d.r,d.g)},w._storedFunction=b=>{const d=Z(b);return new G.Vector2(d.b,d.a)},t._storedFunction=b=>Z(b).r,r._storedFunction=b=>Z(b).g,B._storedFunction=b=>Z(b).b,n._storedFunction=b=>Z(b).a}}),function(b){b[b.Cos=0]="Cos",b[b.Sin=1]="Sin",b[b.Abs=2]="Abs",b[b.Exp=3]="Exp",b[b.Exp2=4]="Exp2",b[b.Round=5]="Round",b[b.Floor=6]="Floor",b[b.Ceiling=7]="Ceiling",b[b.Sqrt=8]="Sqrt",b[b.Log=9]="Log",b[b.Tan=10]="Tan",b[b.ArcTan=11]="ArcTan",b[b.ArcCos=12]="ArcCos",b[b.ArcSin=13]="ArcSin",b[b.Sign=14]="Sign",b[b.Negate=15]="Negate",b[b.OneMinus=16]="OneMinus",b[b.Reciprocal=17]="Reciprocal",b[b.ToDegrees=18]="ToDegrees",b[b.ToRadians=19]="ToRadians",b[b.Fract=20]="Fract"}(Qd||(Qd={}));class xP extends md{constructor(b){super(b),this.operation=Qd.Cos,this.registerInput("input",jd.AutoDetect),this.registerOutput("output",jd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(jd.Float|jd.Int|jd.Vector2|jd.ed|jd.ci)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(b){super._build(b);let d=null;switch(this.operation){case Qd.Cos:d=b=>Math.cos(b);break;case Qd.Sin:d=b=>Math.sin(b);break;case Qd.Abs:d=b=>Math.abs(b);break;case Qd.Exp:d=b=>Math.exp(b);break;case Qd.Exp2:d=b=>Math.pow(2,b);break;case Qd.Round:d=b=>Math.round(b);break;case Qd.Floor:d=b=>Math.floor(b);break;case Qd.Ceiling:d=b=>Math.ceil(b);break;case Qd.Sqrt:d=b=>Math.sqrt(b);break;case Qd.Log:d=b=>Math.log(b);break;case Qd.Tan:d=b=>Math.tan(b);break;case Qd.ArcTan:d=b=>Math.atan(b);break;case Qd.ArcCos:d=b=>Math.acos(b);break;case Qd.ArcSin:d=b=>Math.asin(b);break;case Qd.Sign:d=b=>Math.sign(b);break;case Qd.Negate:d=b=>-b;break;case Qd.OneMinus:d=b=>1-b;break;case Qd.Reciprocal:d=b=>1/b;break;case Qd.ToRadians:d=b=>b*Math.PI/180;break;case Qd.ToDegrees:d=b=>180*b/Math.PI;break;case Qd.Fract:d=b=>b>=0?b-Math.floor(b):b-Math.ceil(b)}if(!d)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case jd.Int:case jd.Float:this.output._storedFunction=b=>{const P=this.input.getConnectedValue(b);return d(P)};break;case jd.Vector2:this.output._storedFunction=b=>{const P=this.input.getConnectedValue(b);return new G.Vector2(d(P.x),d(P.y))};break;case jd.ed:this.output._storedFunction=b=>{const P=this.input.getConnectedValue(b);return new G.ed(d(P.x),d(P.y),d(P.z))};break;case jd.ci:this.output._storedFunction=b=>{const P=this.input.getConnectedValue(b);return new q.ci(d(P.r),d(P.g),d(P.b),d(P.a))}}return this}serialize(){const b=super.serialize();return b.operation=this.operation,b}_deserialize(b){super._deserialize(b),this.operation=b.operation}}(0,H.d)([vd("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:Qd.Cos},{label:"Sin",value:Qd.Sin},{label:"Abs",value:Qd.Abs},{label:"Exp",value:Qd.Exp},{label:"Exp2",value:Qd.Exp2},{label:"Round",value:Qd.Round},{label:"Floor",value:Qd.Floor},{label:"Ceiling",value:Qd.Ceiling},{label:"Sqrt",value:Qd.Sqrt},{label:"Log",value:Qd.Log},{label:"Tan",value:Qd.Tan},{label:"ArcTan",value:Qd.ArcTan},{label:"ArcCos",value:Qd.ArcCos},{label:"ArcSin",value:Qd.ArcSin},{label:"Sign",value:Qd.Sign},{label:"Negate",value:Qd.Negate},{label:"OneMinus",value:Qd.OneMinus},{label:"Reciprocal",value:Qd.Reciprocal},{label:"ToDegrees",value:Qd.ToDegrees},{label:"ToRadians",value:Qd.ToRadians},{label:"Fract",value:Qd.Fract}]})],xP.prototype,"operation",void 0),(0,C.f)("BABYLON.ParticleTrigonometryBlock",xP);var YP,sP=P(13057);class EP extends md{constructor(b){super(b),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",jd.AutoDetect),this.registerOutput("output",jd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(jd.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(jd.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(jd.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(jd.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(jd.System),this._inputs[0].excludedConnectionPointTypes.push(jd.Particle),this._inputs[0].excludedConnectionPointTypes.push(jd.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(b){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const d=b=>{const d=this.input.getConnectedValue(b);if(this.log.length>=this.stackSize)return d;if(null===d||void 0===d)return this.log.push(["null",""]),d;switch(this.input.type){case jd.Vector2:this.log.push([(0,sP.h)(d,4),d.toString()]);break;case jd.ed:this.log.push([(0,sP.k)(d,4),d.toString()]);break;case jd.ci:this.log.push([`{R: ${d.r.toFixed(4)} G: ${d.g.toFixed(4)} B: ${d.b.toFixed(4)} A: ${d.a.toFixed(4)}}`,d.toString()]);break;default:this.log.push([d.toString(),d.toString()])}return d};this.output.isConnected?this.output._storedFunction=d:this.output._storedValue=d(b)}serialize(){const b=super.serialize();return b.stackSize=this.stackSize,b}_deserialize(b){super._deserialize(b),this.stackSize=b.stackSize}}(0,H.d)([vd("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],EP.prototype,"stackSize",void 0),(0,C.f)("BABYLON.ParticleDebugBlock",EP);(0,C.f)("BABYLON.ParticleElbowBlock",class extends md{constructor(b){super(b),this.registerInput("input",jd.AutoDetect),this.registerOutput("output",jd.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(b){super._build(b);const d=this._outputs[0],P=this._inputs[0];d._storedFunction=b=>P.getConnectedValue(b)}});(0,C.f)("BABYLON.ParticleTeleportInBlock",class extends md{get endpoints(){return this._endpoints}constructor(b){super(b),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",jd.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(b){if(this.getClassName()===b)return!0;for(const d of this.endpoints)if(d.isAnAncestorOfType(b))return!0;return!1}isAnAncestorOf(b){for(const d of this.endpoints){if(d===b)return!0;if(d.isAnAncestorOf(b))return!0}return!1}attachToEndpoint(b){b.detach(),this._endpoints.push(b),b._entryPoint=this,b._outputs[0]._typeConnectionSource=this._inputs[0],b._tempEntryPointUniqueId=null,b.name="> "+this.name}detachFromEndpoint(b){const d=this._endpoints.indexOf(b);-1!==d&&(this._endpoints.splice(d,1),b._outputs[0]._typeConnectionSource=null,b._entryPoint=null)}_build(){for(const b of this._endpoints)b.output._storedFunction=b=>this.input.getConnectedValue(b)}});(0,C.f)("BABYLON.ParticleTeleportOutBlock",class extends md{constructor(b){super(b),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",jd.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(b){this.entryPoint&&this.entryPoint.build(b)}clone(){const b=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(b),b}serialize(){var b;const d=super.serialize();return d.entryPoint=(null===(b=this.entryPoint)||void 0===b?void 0:b.uniqueId)??"",d}_deserialize(b){super._deserialize(b),this._tempEntryPointUniqueId=b.entryPoint}}),function(b){b[b.Equal=0]="Equal",b[b.NotEqual=1]="NotEqual",b[b.LessThan=2]="LessThan",b[b.GreaterThan=3]="GreaterThan",b[b.LessOrEqual=4]="LessOrEqual",b[b.GreaterOrEqual=5]="GreaterOrEqual",b[b.Xor=6]="Xor",b[b.Or=7]="Or",b[b.And=8]="And"}(YP||(YP={}));class wP extends md{constructor(b){super(b),this.test=YP.Equal,this.epsilon=0,this.registerInput("left",jd.Float),this.registerInput("right",jd.Float,!0,0),this.registerInput("ifTrue",jd.AutoDetect,!0,1),this.registerInput("ifFalse",jd.AutoDetect,!0,0),this.registerOutput("output",jd.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=jd.Float,this._inputs[0].acceptedConnectionPointTypes.push(jd.Int),this._inputs[1].acceptedConnectionPointTypes.push(jd.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const b=b=>{const d=this.left.getConnectedValue(b),P=this.right.getConnectedValue(b);let G=!1;switch(this.test){case YP.Equal:G=(0,L.WithinEpsilon)(d,P,this.epsilon);break;case YP.NotEqual:G=!(0,L.WithinEpsilon)(d,P,this.epsilon);break;case YP.LessThan:G=d<P+this.epsilon;break;case YP.GreaterThan:G=d>P-this.epsilon;break;case YP.LessOrEqual:G=d<=P+this.epsilon;break;case YP.GreaterOrEqual:G=d>=P-this.epsilon;break;case YP.Xor:G=!!d&&!P||!d&&!!P;break;case YP.Or:G=!!d||!!P;break;case YP.And:G=!!d&&!!P}return G};this.output._storedFunction=d=>b(d)?this.ifTrue.getConnectedValue(d):this.ifFalse.getConnectedValue(d)}serialize(){const b=super.serialize();return b.test=this.test,b.epsilon=this.epsilon,b}_deserialize(b){super._deserialize(b),this.test=b.test,void 0!==b.epsilon&&(this.epsilon=b.epsilon)}}(0,H.d)([vd("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:YP.Equal},{label:"NotEqual",value:YP.NotEqual},{label:"LessThan",value:YP.LessThan},{label:"GreaterThan",value:YP.GreaterThan},{label:"LessOrEqual",value:YP.LessOrEqual},{label:"GreaterOrEqual",value:YP.GreaterOrEqual},{label:"Xor",value:YP.Xor},{label:"Or",value:YP.Or},{label:"And",value:YP.And}]})],wP.prototype,"test",void 0),(0,H.d)([vd("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],wP.prototype,"epsilon",void 0),(0,C.f)("BABYLON.ParticleConditionBlock",wP);class tP extends md{constructor(b){super(b),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",jd.Particle),this.registerInput("condition",jd.Float,!0,0),this.registerInput("system",jd.System),this.registerOutput("output",jd.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(b){this._triggerCount=0;const d=this.input.getConnectedValue(b),P={process:P=>{if(b.particleContext=P,b.systemContext=d,0!==this.condition.getConnectedValue(b)&&(0===this.limit||this._triggerCount<this.limit)){const G=(new Date).getTime();if(this._previousOne&&G-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=G;const W=this.system.getConnectedValue(b);if(W){const G=hd(W,b.Hd,P.position);G.Zd.addOnce((()=>{this._triggerCount--})),d.Zd.addOnce((()=>{G.dispose()}))}}},previousItem:null,nextItem:null};d._updateQueueStart?cb(P,d._updateQueueStart):d._updateQueueStart=P,this.output._storedValue=d}serialize(){const b=super.serialize();return b.limit=this.limit,b.delay=this.delay,b}_deserialize(b){super._deserialize(b),void 0!==b.limit&&(this.limit=b.limit),void 0!==b.delay&&(this.delay=b.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,H.d)([vd("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tP.prototype,"limit",void 0),(0,H.d)([vd("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tP.prototype,"delay",void 0),(0,C.f)("BABYLON.ParticleTriggerBlock",tP);P(13065),P(13079),P(13088),P(13151)},13131:(b,d,P)=>{"use strict";var G=P(11591);const W="clipPlaneFragment",i="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";G.c.IncludesShadersStoreWGSL[W]||(G.c.IncludesShadersStoreWGSL[W]=i)},13096:(b,d,P)=>{"use strict";var G=P(11591);const W="clipPlaneFragmentDeclaration",i="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";G.c.IncludesShadersStoreWGSL[W]||(G.c.IncludesShadersStoreWGSL[W]=i)},13169:(b,d,P)=>{"use strict";var G=P(11591);const W="clipPlaneVertex",i="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";G.c.IncludesShadersStoreWGSL[W]||(G.c.IncludesShadersStoreWGSL[W]=i)},13156:(b,d,P)=>{"use strict";var G=P(11591);const W="clipPlaneVertexDeclaration",i="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";G.c.IncludesShadersStoreWGSL[W]||(G.c.IncludesShadersStoreWGSL[W]=i)},13149:(b,d,P)=>{"use strict";var G=P(11591);const W="fogFragment",i="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";G.c.IncludesShadersStoreWGSL[W]||(G.c.IncludesShadersStoreWGSL[W]=i)},13124:(b,d,P)=>{"use strict";var G=P(11591);const W="fogFragmentDeclaration",i="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";G.c.IncludesShadersStoreWGSL[W]||(G.c.IncludesShadersStoreWGSL[W]=i)},13176:(b,d,P)=>{"use strict";var G=P(11591);const W="fogVertex",i="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";G.c.IncludesShadersStoreWGSL[W]||(G.c.IncludesShadersStoreWGSL[W]=i)},13160:(b,d,P)=>{"use strict";var G=P(11591);const W="fogVertexDeclaration",i="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";G.c.IncludesShadersStoreWGSL[W]||(G.c.IncludesShadersStoreWGSL[W]=i)},13114:(b,d,P)=>{"use strict";var G=P(11591);const W="helperFunctions",i="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";G.c.IncludesShadersStoreWGSL[W]||(G.c.IncludesShadersStoreWGSL[W]=i)},13103:(b,d,P)=>{"use strict";var G=P(11591);const W="imageProcessingDeclaration",i="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";G.c.IncludesShadersStoreWGSL[W]||(G.c.IncludesShadersStoreWGSL[W]=i)},13121:(b,d,P)=>{"use strict";var G=P(11591);const W="imageProcessingFunctions",i="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";G.c.IncludesShadersStoreWGSL[W]||(G.c.IncludesShadersStoreWGSL[W]=i)},13109:(b,d,P)=>{"use strict";var G=P(11591);const W="logDepthDeclaration",i="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";G.c.IncludesShadersStoreWGSL[W]||(G.c.IncludesShadersStoreWGSL[W]=i)},13140:(b,d,P)=>{"use strict";var G=P(11591);const W="logDepthFragment",i="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";G.c.IncludesShadersStoreWGSL[W]||(G.c.IncludesShadersStoreWGSL[W]=i)},13180:(b,d,P)=>{"use strict";var G=P(11591);const W="logDepthVertex",i="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";G.c.IncludesShadersStoreWGSL[W]||(G.c.IncludesShadersStoreWGSL[W]=i)},13088:(b,d,P)=>{"use strict";P.r(d),P.d(d,{particlesPixelShaderWGSL:()=>q});var G=P(11591);P(13096),P(13103),P(13109),P(13114),P(13121),P(13124),P(13131),P(13140),P(13149);const W="particlesPixelShader",i="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";G.c.ShadersStoreWGSL[W]||(G.c.ShadersStoreWGSL[W]=i);const q={name:W,shader:i}},13151:(b,d,P)=>{"use strict";P.r(d),P.d(d,{particlesVertexShaderWGSL:()=>q});var G=P(11591);P(13156),P(13160),P(13109),P(13169),P(13176),P(13180);const W="particlesVertexShader",i="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";G.c.ShadersStoreWGSL[W]||(G.c.ShadersStoreWGSL[W]=i);const q={name:W,shader:i}},12992:(b,d,P)=>{"use strict";var G=P(11591);const W="clipPlaneFragment",i="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";G.c.IncludesShadersStore[W]||(G.c.IncludesShadersStore[W]=i)},13071:(b,d,P)=>{"use strict";var G=P(11591);const W="clipPlaneFragmentDeclaration",i="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";G.c.IncludesShadersStore[W]||(G.c.IncludesShadersStore[W]=i)},13011:(b,d,P)=>{"use strict";var G=P(11591);const W="clipPlaneVertex",i="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";G.c.IncludesShadersStore[W]||(G.c.IncludesShadersStore[W]=i)},13082:(b,d,P)=>{"use strict";var G=P(11591);const W="clipPlaneVertexDeclaration",i="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";G.c.IncludesShadersStore[W]||(G.c.IncludesShadersStore[W]=i)},13e3:(b,d,P)=>{"use strict";var G=P(11591);const W="fogFragment",i="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";G.c.IncludesShadersStore[W]||(G.c.IncludesShadersStore[W]=i)},12988:(b,d,P)=>{"use strict";var G=P(11591);const W="fogFragmentDeclaration",i="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";G.c.IncludesShadersStore[W]||(G.c.IncludesShadersStore[W]=i)},13019:(b,d,P)=>{"use strict";var G=P(11591);const W="fogVertex",i="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";G.c.IncludesShadersStore[W]||(G.c.IncludesShadersStore[W]=i)},13008:(b,d,P)=>{"use strict";var G=P(11591);const W="fogVertexDeclaration",i="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";G.c.IncludesShadersStore[W]||(G.c.IncludesShadersStore[W]=i)},12979:(b,d,P)=>{"use strict";var G=P(11591);const W="helperFunctions",i="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";G.c.IncludesShadersStore[W]||(G.c.IncludesShadersStore[W]=i)},12966:(b,d,P)=>{"use strict";var G=P(11591);const W="imageProcessingDeclaration",i="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";G.c.IncludesShadersStore[W]||(G.c.IncludesShadersStore[W]=i)},12982:(b,d,P)=>{"use strict";var G=P(11591);const W="imageProcessingFunctions",i="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";G.c.IncludesShadersStore[W]||(G.c.IncludesShadersStore[W]=i)},12973:(b,d,P)=>{"use strict";var G=P(11591);const W="logDepthDeclaration",i="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";G.c.IncludesShadersStore[W]||(G.c.IncludesShadersStore[W]=i)},12996:(b,d,P)=>{"use strict";var G=P(11591);const W="logDepthFragment",i="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";G.c.IncludesShadersStore[W]||(G.c.IncludesShadersStore[W]=i)},13021:(b,d,P)=>{"use strict";var G=P(11591);const W="logDepthVertex",i="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";G.c.IncludesShadersStore[W]||(G.c.IncludesShadersStore[W]=i)},13065:(b,d,P)=>{"use strict";P.r(d),P.d(d,{particlesPixelShader:()=>q});var G=P(11591);P(13071),P(12966),P(12973),P(12979),P(12982),P(12988),P(12992),P(12996),P(13e3);const W="particlesPixelShader",i="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";G.c.ShadersStore[W]||(G.c.ShadersStore[W]=i);const q={name:W,shader:i}},13079:(b,d,P)=>{"use strict";P.r(d),P.d(d,{particlesVertexShader:()=>q});var G=P(11591);P(13082),P(13008),P(12973),P(13011),P(13019),P(13021);const W="particlesVertexShader",i="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";G.c.ShadersStore[W]||(G.c.ShadersStore[W]=i);const q={name:W,shader:i}},13417:(b,d,P)=>{"use strict";P.r(d),P.d(d,{FlowGraphGLTFDataProvider:()=>i});var G=P(13386),W=P(13365);class i extends G.b{constructor(b){var d,P;super();const G=b.glTF,i=(null===(d=G.animations)||void 0===d?void 0:d.map((b=>b._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",W.b,i);const q=(null===(P=G.nodes)||void 0===P?void 0:P.map((b=>b._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",W.b,q)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13314:(b,d,P)=>{"use strict";P.d(d,{c:()=>r,g:()=>w,h:()=>E,j:()=>t});var G=P(11681),W=P(12163),i=P(11725),q=P(13320);const C=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class J{constructor(b,d){this._gltf=b,this._infoTree=d}convert(b){let d,P=this._gltf,G=this._infoTree;if(!b.startsWith("/"))throw new Error("Path must start with a /");const W=b.split("/");if(W.shift(),W[W.length-1].includes(".length")){const b=W[W.length-1].split(".");W.pop(),W.push(...b)}let i=!1;for(const J of W){const W="length"===J;if(W&&!G.__array__)throw new Error(`Path ${b} is invalid`);if(G.__ignoreObjectTree__&&(i=!0),G.__array__&&!W)G=G.__array__;else if(G=G[J],!G)throw new Error(`Path ${b} is invalid`);if(!i)if(void 0===P){if(!C.find((d=>d.regex.test(b))))throw new Error(`Path ${b} is invalid`)}else if(!W){var q;P=null===(q=P)||void 0===q?void 0:q[J]}(G.__target__||W)&&(d=P)}return{object:d,info:G}}}function L(b,d,P,G){const W=x(b,d);return G?W[P][G]:W[P]}function x(b,d,P){var G,i;return null===(G=b._data)||void 0===G||null===(i=G[(null===P||void 0===P?void 0:P.fillMode)??W.d.MATERIAL_TriangleFillMode])||void 0===i?void 0:i.babylonMaterial}function Y(b,d){return{offset:{componentsCount:2,type:"Vector2",get:(P,W,i)=>{const q=L(P,i,b,d);return new G.Vector2(null===q||void 0===q?void 0:q.uOffset,null===q||void 0===q?void 0:q.vOffset)},getTarget:x,set:(P,G,W,i)=>{const q=L(G,i,b,d);q.uOffset=P.x,q.vOffset=P.y},getPropertyName:[()=>`${b}${d?"."+d:""}.uOffset`,()=>`${b}${d?"."+d:""}.vOffset`]},rotation:{type:"number",get:(P,G,W)=>{var i;return null===(i=L(P,W,b,d))||void 0===i?void 0:i.wAng},getTarget:x,set:(P,G,W,i)=>L(G,i,b,d).wAng=P,getPropertyName:[()=>`${b}${d?"."+d:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(P,W,i)=>{const q=L(P,i,b,d);return new G.Vector2(null===q||void 0===q?void 0:q.uScale,null===q||void 0===q?void 0:q.vScale)},getTarget:x,set:(P,G,W,i)=>{const q=L(G,i,b,d);q.uScale=P.x,q.vScale=P.y},getPropertyName:[()=>`${b}${d?"."+d:""}.uScale`,()=>`${b}${d?"."+d:""}.vScale`]}}}const s={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:b=>{var d,P;return new G.Vector2((null===(d=b._babylonCamera)||void 0===d?void 0:d.orthoLeft)??0,(null===(P=b._babylonCamera)||void 0===P?void 0:P.orthoRight)??0)},set:(b,d)=>{d._babylonCamera&&(d._babylonCamera.orthoLeft=b.x,d._babylonCamera.orthoRight=b.y)},getTarget:b=>b,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:b=>{var d,P;return new G.Vector2((null===(d=b._babylonCamera)||void 0===d?void 0:d.orthoBottom)??0,(null===(P=b._babylonCamera)||void 0===P?void 0:P.orthoTop)??0)},set:(b,d)=>{d._babylonCamera&&(d._babylonCamera.orthoBottom=b.x,d._babylonCamera.orthoTop=b.y)},getTarget:b=>b,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:b=>{var d;return null===(d=b._babylonCamera)||void 0===d?void 0:d.maxZ},set:(b,d)=>{d._babylonCamera&&(d._babylonCamera.maxZ=b)},getTarget:b=>b,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:b=>{var d;return null===(d=b._babylonCamera)||void 0===d?void 0:d.Vd},set:(b,d)=>{d._babylonCamera&&(d._babylonCamera.Vd=b)},getTarget:b=>b,getPropertyName:[()=>"Vd"]}},perspective:{aspectRatio:{type:"number",get:b=>{var d;return null===(d=b._babylonCamera)||void 0===d?void 0:d.getEngine().getAspectRatio(b._babylonCamera)},getTarget:b=>b,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:b=>{var d;return null===(d=b._babylonCamera)||void 0===d?void 0:d.fov},set:(b,d)=>{d._babylonCamera&&(d._babylonCamera.fov=b)},getTarget:b=>b,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:b=>{var d;return null===(d=b._babylonCamera)||void 0===d?void 0:d.maxZ},set:(b,d)=>{d._babylonCamera&&(d._babylonCamera.maxZ=b)},getTarget:b=>b,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:b=>{var d;return null===(d=b._babylonCamera)||void 0===d?void 0:d.Vd},set:(b,d)=>{d._babylonCamera&&(d._babylonCamera.Vd=b)},getTarget:b=>b,getPropertyName:[()=>"Vd"]}}}},nodes:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>b._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"ed",get:b=>{var d;return null===(d=b._babylonTransformNode)||void 0===d?void 0:d.position},set:(b,d)=>{var P;return null===(P=d._babylonTransformNode)||void 0===P?void 0:P.position.q(b)},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:b=>{var d;return null===(d=b._babylonTransformNode)||void 0===d?void 0:d.rotationQuaternion},set:(b,d)=>{var P,G;return null===(P=d._babylonTransformNode)||void 0===P||null===(G=P.rotationQuaternion)||void 0===G?void 0:G.q(b)},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"ed",get:b=>{var d;return null===(d=b._babylonTransformNode)||void 0===d?void 0:d.hd},set:(b,d)=>{var P;return null===(P=d._babylonTransformNode)||void 0===P?void 0:P.hd.q(b)},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"hd"]},weights:{length:{type:"number",get:b=>b._numMorphTargets,getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(b,d)=>{var P,G;return void 0!==d?null===(P=b._primitiveBabylonMeshes)||void 0===P||null===(G=P[0].morphTargetManager)||void 0===G?void 0:G.getTarget(d).influence:void 0},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(b,d)=>[0],getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:b=>{var d,P,W;return G.Matrix.Compose(null===(d=b._babylonTransformNode)||void 0===d?void 0:d.hd,null===(P=b._babylonTransformNode)||void 0===P?void 0:P.rotationQuaternion,null===(W=b._babylonTransformNode)||void 0===W?void 0:W.position)},getTarget:b=>b._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:b=>{var d,P,W,i;const q=G.Matrix.Identity();let C=b.parent;for(;C&&C.parent;)C=C.parent;const J=(null===(d=b._babylonTransformNode)||void 0===d?void 0:d.position._isDirty)||(null===(P=b._babylonTransformNode)||void 0===P||null===(W=P.rotationQuaternion)||void 0===W?void 0:W._isDirty)||(null===(i=b._babylonTransformNode)||void 0===i?void 0:i.hd._isDirty);if(C){var L;const d=null===(L=C._babylonTransformNode)||void 0===L?void 0:L.zd(!0).invert();var x,Y;if(d)null===(x=b._babylonTransformNode)||void 0===x||null===(Y=x.zd(J))||void 0===Y||Y.multiplyToRef(d,q)}else b._babylonTransformNode&&q.q(b._babylonTransformNode.zd(J));return q},getTarget:b=>b._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:b=>{var d,P;return null===(d=b._babylonTransformNode)||void 0===d||null===(P=d.getChildren((b=>b instanceof q.e),!0)[0])||void 0===P?void 0:P.fC},getTarget:b=>{var d;return null===(d=b._babylonTransformNode)||void 0===d?void 0:d.getChildren((b=>b instanceof q.e),!0)[0]},set:(b,d)=>{if(d._babylonTransformNode){const P=d._babylonTransformNode.getChildren((b=>b instanceof q.e),!0)[0];P&&(P.fC=b)}}},color:{type:"Nd",get:b=>{var d,P;return null===(d=b._babylonTransformNode)||void 0===d||null===(P=d.getChildren((b=>b instanceof q.e),!0)[0])||void 0===P?void 0:P.gC},getTarget:b=>{var d;return null===(d=b._babylonTransformNode)||void 0===d?void 0:d.getChildren((b=>b instanceof q.e),!0)[0]},set:(b,d)=>{if(d._babylonTransformNode){const P=d._babylonTransformNode.getChildren((b=>b instanceof q.e),!0)[0];P&&(P.gC=b)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Nd",get:(b,d,P)=>x(b,d,P).emissiveColor,set:(b,d,P,G)=>x(d,P,G).emissiveColor.q(b),getTarget:(b,d,P)=>x(b,d,P),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:Y("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(b,d,P)=>{var G;return null===(G=L(b,P,"bumpTexture"))||void 0===G?void 0:G.level},set:(b,d,P,G)=>{const W=L(d,G,"bumpTexture");W&&(W.level=b)},getTarget:(b,d,P)=>x(b,d,P),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:Y("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(b,d,P)=>x(b,d,P).ambientTextureStrength,set:(b,d,P,G)=>{const W=x(d,P,G);W&&(W.ambientTextureStrength=b)},getTarget:(b,d,P)=>x(b,d,P),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:Y("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"ci",get:(b,d,P)=>{const G=x(b,d,P);return i.ci.FromColor3(G.albedoColor,G.alpha)},set:(b,d,P,G)=>{const W=x(d,P,G);W.albedoColor.set(b.r,b.g,b.b),W.alpha=b.a},getTarget:(b,d,P)=>x(b,d,P),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:Y("albedoTexture")}},metallicFactor:{type:"number",get:(b,d,P)=>x(b,d,P).metallic,set:(b,d,P,G)=>{const W=x(d,P,G);W&&(W.metallic=b)},getTarget:(b,d,P)=>x(b,d,P),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(b,d,P)=>x(b,d,P).roughness,set:(b,d,P,G)=>{const W=x(d,P,G);W&&(W.roughness=b)},getTarget:(b,d,P)=>x(b,d,P),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:Y("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(b,d,P)=>x(b,d,P).anisotropy.fC,set:(b,d,P,G)=>{x(d,P,G).anisotropy.fC=b},getTarget:(b,d,P)=>x(b,d,P),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(b,d,P)=>x(b,d,P).anisotropy.angle,set:(b,d,P,G)=>{x(d,P,G).anisotropy.angle=b},getTarget:(b,d,P)=>x(b,d,P),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:Y("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(b,d,P)=>x(b,d,P).clearCoat.fC,set:(b,d,P,G)=>{x(d,P,G).clearCoat.fC=b},getTarget:(b,d,P)=>x(b,d,P),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(b,d,P)=>x(b,d,P).clearCoat.roughness,set:(b,d,P,G)=>{x(d,P,G).clearCoat.roughness=b},getTarget:(b,d,P)=>x(b,d,P),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:Y("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(b,d,P)=>{var G;return null===(G=x(b,d,P).clearCoat.bumpTexture)||void 0===G?void 0:G.level},getTarget:x,set:(b,d,P,G)=>x(d,P,G).clearCoat.bumpTexture.level=b},extensions:{KHR_texture_transform:Y("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:Y("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(b,d,P)=>x(b,d,P).subSurface.dispersion,getTarget:x,set:(b,d,P,G)=>x(d,P,G).subSurface.dispersion=b}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(b,d,P)=>x(b,d,P).emissiveIntensity,getTarget:x,set:(b,d,P,G)=>x(d,P,G).emissiveIntensity=b}},KHR_materials_ior:{ior:{type:"number",get:(b,d,P)=>x(b,d,P).indexOfRefraction,getTarget:x,set:(b,d,P,G)=>x(d,P,G).indexOfRefraction=b}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(b,d,P)=>x(b,d,P).iridescence.fC,getTarget:x,set:(b,d,P,G)=>x(d,P,G).iridescence.fC=b},iridescenceIor:{type:"number",get:(b,d,P)=>x(b,d,P).iridescence.indexOfRefraction,getTarget:x,set:(b,d,P,G)=>x(d,P,G).iridescence.indexOfRefraction=b},iridescenceTexture:{extensions:{KHR_texture_transform:Y("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(b,d,P)=>x(b,d,P).iridescence.maximumThickness,getTarget:x,set:(b,d,P,G)=>x(d,P,G).iridescence.maximumThickness=b},iridescenceThicknessMinimum:{type:"number",get:(b,d,P)=>x(b,d,P).iridescence.minimumThickness,getTarget:x,set:(b,d,P,G)=>x(d,P,G).iridescence.minimumThickness=b},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:Y("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Nd",get:(b,d,P)=>x(b,d,P).sheen.color,getTarget:x,set:(b,d,P,G)=>x(d,P,G).sheen.color.q(b)},sheenColorTexture:{extensions:{KHR_texture_transform:Y("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(b,d,P)=>x(b,d,P).sheen.fC,getTarget:x,set:(b,d,P,G)=>x(d,P,G).sheen.fC=b},sheenRoughnessTexture:{extensions:{KHR_texture_transform:Y("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(b,d,P)=>x(b,d,P).metallicF0Factor,getTarget:x,set:(b,d,P,G)=>x(d,P,G).metallicF0Factor=b,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Nd",get:(b,d,P)=>x(b,d,P).metallicReflectanceColor,getTarget:x,set:(b,d,P,G)=>x(d,P,G).metallicReflectanceColor.q(b),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:Y("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:Y("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(b,d,P)=>x(b,d,P).subSurface.refractionIntensity,getTarget:x,set:(b,d,P,G)=>x(d,P,G).subSurface.refractionIntensity=b,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:Y("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(b,d,P)=>x(b,d,P).subSurface.translucencyIntensity,getTarget:x,set:(b,d,P,G)=>x(d,P,G).subSurface.translucencyIntensity=b},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:Y("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Nd",get:(b,d,P)=>x(b,d,P).subSurface.translucencyColor,getTarget:x,set:(b,d,P,G)=>{var W;return b&&(null===(W=x(d,P,G).subSurface.translucencyColor)||void 0===W?void 0:W.q(b))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:Y("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Nd",get:(b,d,P)=>x(b,d,P).subSurface.tintColor,getTarget:x,set:(b,d,P,G)=>x(d,P,G).subSurface.tintColor.q(b)},attenuationDistance:{type:"number",get:(b,d,P)=>x(b,d,P).subSurface.tintColorAtDistance,getTarget:x,set:(b,d,P,G)=>x(d,P,G).subSurface.tintColorAtDistance=b},thicknessFactor:{type:"number",get:(b,d,P)=>x(b,d,P).subSurface.maximumThickness,getTarget:x,set:(b,d,P,G)=>x(d,P,G).subSurface.maximumThickness=b},thicknessTexture:{extensions:{KHR_texture_transform:Y("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>b._babylonLight)),getPropertyName:[b=>"length"]},__array__:{__target__:!0,color:{type:"Nd",get:b=>{var d;return null===(d=b._babylonLight)||void 0===d?void 0:d.gC},set:(b,d)=>{var P;return null===(P=d._babylonLight)||void 0===P?void 0:P.gC.q(b)},getTarget:b=>b._babylonLight,getPropertyName:[b=>"diffuse"]},fC:{type:"number",get:b=>{var d;return null===(d=b._babylonLight)||void 0===d?void 0:d.fC},set:(b,d)=>d._babylonLight?d._babylonLight.fC=b:void 0,getTarget:b=>b._babylonLight,getPropertyName:[b=>"intensity"]},range:{type:"number",get:b=>{var d;return null===(d=b._babylonLight)||void 0===d?void 0:d.range},set:(b,d)=>d._babylonLight?d._babylonLight.range=b:void 0,getTarget:b=>b._babylonLight,getPropertyName:[b=>"range"]},spot:{innerConeAngle:{type:"number",get:b=>{var d;return null===(d=b._babylonLight)||void 0===d?void 0:d.innerAngle},set:(b,d)=>d._babylonLight?d._babylonLight.innerAngle=b:void 0,getTarget:b=>b._babylonLight,getPropertyName:[b=>"innerConeAngle"]},outerConeAngle:{type:"number",get:b=>{var d;return null===(d=b._babylonLight)||void 0===d?void 0:d.angle},set:(b,d)=>d._babylonLight?d._babylonLight.angle=b:void 0,getTarget:b=>b._babylonLight,getPropertyName:[b=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>b._babylonLight)),getPropertyName:[b=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>b._babylonTexture)),getPropertyName:[b=>"length"]},__array__:{__target__:!0,fC:{type:"number",get:b=>{var d;return null===(d=b._babylonTexture)||void 0===d?void 0:d.level},set:(b,d)=>{d._babylonTexture&&(d._babylonTexture.level=b)},getTarget:b=>b._babylonTexture},rotation:{type:"Quaternion",get:b=>{var d;return b._babylonTexture&&G.Quaternion.FromRotationMatrix(null===(d=b._babylonTexture)||void 0===d?void 0:d.getReflectionTextureMatrix())},set:(b,d)=>{var P;d._babylonTexture&&(null!==(P=d._babylonTexture.Xb())&&void 0!==P&&P.useRightHandedSystem||(b=G.Quaternion.Inverse(b)),G.Matrix.FromQuaternionToRef(b,d._babylonTexture.getReflectionTextureMatrix()))},getTarget:b=>b._babylonTexture}}}}},animations:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>b._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:b=>b.length,getTarget:b=>b.map((b=>{var d;return null===(d=b.primitives[0]._instanceData)||void 0===d?void 0:d.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function E(b){return new J(b,s)}function w(b){const d=b.split("/").map((b=>b.replace(/{}/g,"__array__")));let P=s;for(const G of d)G&&(P=P[G]);if(P&&P.type&&P.get)return P}function t(b,d){const P=b.split("/").map((b=>b.replace(/{}/g,"__array__")));let G=s;for(const W of P)W&&(G=G[W]);G&&G.type&&G.get&&(G.interpolation=d)}function r(b,d){const P=b.split("/").map((b=>b.replace(/{}/g,"__array__")));let G=s;for(const W of P)if(W){if(!G[W]){if("?"===W){G.__ignoreObjectTree__=!0;continue}G[W]={},"__array__"===W&&(G[W].__target__=!0)}G=G[W]}Object.assign(G,d)}},13324:(b,d,P)=>{"use strict";P.r(d),P.d(d,{AnimationPropertyInfo:()=>L,TransformNodeAnimationPropertyInfo:()=>x,WeightAnimationPropertyInfo:()=>Y,getQuaternion:()=>C,getVector3:()=>q,getWeights:()=>J});var G=P(12201),W=P(11681),i=P(13314);function q(b,d,P,G){return W.ed.Od(d,P).scaleInPlace(G)}function C(b,d,P,G){return W.Quaternion.Od(d,P).scaleInPlace(G)}function J(b,d,P,G){const W=new Array(b._numMorphTargets);for(let i=0;i<W.length;i++)W[i]=d[P++]*G;return W}class L{constructor(b,d,P,G){this.type=b,this.name=d,this.getValue=P,this.getStride=G}_buildAnimation(b,d,P){const W=new G.b(b,this.name,d,this.type);return W.setKeys(P),W}}class x extends L{buildAnimations(b,d,P,G){const W=[];return W.push({babylonAnimatable:b._babylonTransformNode,babylonAnimation:this._buildAnimation(d,P,G)}),W}}class Y extends L{buildAnimations(b,d,P,W){const i=[];if(b._numMorphTargets)for(let q=0;q<b._numMorphTargets;q++){const C=new G.b(`${d}_${q}`,this.name,P,this.type);if(C.setKeys(W.map((b=>({frame:b.frame,inTangent:b.inTangent?b.inTangent[q]:void 0,value:b.value[q],outTangent:b.outTangent?b.outTangent[q]:void 0,interpolation:b.interpolation})))),b._primitiveBabylonMeshes)for(const d of b._primitiveBabylonMeshes)if(d.morphTargetManager){const b=d.morphTargetManager.getTarget(q),P=C.clone();b.animations.push(P),i.push({babylonAnimatable:b,babylonAnimation:P})}}return i}}(0,i.j)("/nodes/{}/translation",[new x(G.b.ANIMATIONTYPE_VECTOR3,"position",q,(()=>3))]),(0,i.j)("/nodes/{}/rotation",[new x(G.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",C,(()=>4))]),(0,i.j)("/nodes/{}/scale",[new x(G.b.ANIMATIONTYPE_VECTOR3,"hd",q,(()=>3))]),(0,i.j)("/nodes/{}/weights",[new Y(G.b.ANIMATIONTYPE_FLOAT,"influence",J,(b=>b._numMorphTargets))])},13279:(b,d,P)=>{"use strict";class G{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((b,d)=>{this._resolve=b,this._reject=d}))}}var W=P(11681),i=P(11725),q=P(11484),C=P(12139),J=P(13281),L=P(13292),x=P(11487),Y=P(12160),s=P(12201),E=P(12209),w=P(11535),t=P(11504),r=P(11510);class B{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(b){this._useTextureToStoreBoneMatrices=b,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(b){this._animationPropertiesOverride=b}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(b,d,P){this.name=b,this.id=d,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=W.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new x.d,this.bones=[],this._scene=P||w.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const G=this._scene.getEngine().getCaps();this._canUseTextureForBones=G.textureFloat&&G.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((b=>!b.getParent()))}getTransformMatrices(b){if(this.needInitialSkinMatrix){if(!b)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return b._bonesTransformMatrices||this.prepare(!0),b._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(b){return this.needInitialSkinMatrix&&b._transformMatrixTexture?b._transformMatrixTexture:this._transformMatrixTexture}Xb(){return this._scene}toString(b){let d=`Name: ${this.name}, nBones: ${this.bones.length}`;if(d+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,b){d+=", Ranges: {";let b=!0;for(const P in this._ranges)b&&(d+=", ",b=!1),d+=P;d+="}"}return d}getBoneIndexByName(b){for(let d=0,P=this.bones.length;d<P;d++)if(this.bones[d].name===b)return d;return-1}createAnimationRange(b,d,P){if(!this._ranges[b]){this._ranges[b]=new E.c(b,d,P);for(let G=0,W=this.bones.length;G<W;G++)this.bones[G].animations[0]&&this.bones[G].animations[0].createRange(b,d,P)}}deleteAnimationRange(b){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let P=0,G=this.bones.length;P<G;P++)this.bones[P].animations[0]&&this.bones[P].animations[0].deleteRange(b,d);this._ranges[b]=null}getAnimationRange(b){return this._ranges[b]||null}getAnimationRanges(){const b=[];let d;for(d in this._ranges)b.push(this._ranges[d]);return b}copyAnimationRange(b,d){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[d]||!b.getAnimationRange(d))return!1;let G=!0;const W=this._getHighestAnimationFrame()+1,i={},q=b.bones;let C,J;for(J=0,C=q.length;J<C;J++)i[q[J].name]=q[J];this.bones.length!==q.length&&(t.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${q.length}`),G=!1);const L=P&&this.dimensionsAtRest&&b.dimensionsAtRest?this.dimensionsAtRest.divide(b.dimensionsAtRest):null;for(J=0,C=this.bones.length;J<C;J++){const b=this.bones[J].name,q=i[b];q?G=G&&this.bones[J].copyAnimationRange(q,d,W,P,L):(t.e.Warn("copyAnimationRange: not same rig, missing source bone "+b),G=!1)}const x=b.getAnimationRange(d);return x&&(this._ranges[d]=new E.c(d,x.from+W,x.to+W)),G}returnToRest(){for(const b of this.bones)-1!==b._index&&b.returnToRest()}_getHighestAnimationFrame(){let b=0;for(let d=0,P=this.bones.length;d<P;d++)if(this.bones[d].animations[0]){const P=this.bones[d].animations[0].getHighestFrame();b<P&&(b=P)}return b}beginAnimation(b,d,P,G){const W=this.getAnimationRange(b);return W?this._scene.beginAnimation(this,W.from,W.to,d,P,G):null}static MakeAnimationAdditive(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,P=arguments.length>2?arguments[2]:void 0;const G=b.getAnimationRange(P);if(!G)return null;const W=b._scene.getAllAnimatablesByTarget(b);let i=null;for(let C=0;C<W.length;C++){const b=W[C];if(b.fromFrame===(null===G||void 0===G?void 0:G.from)&&b.toFrame===(null===G||void 0===G?void 0:G.to)){i=b;break}}const q=b.getAnimatables();for(let C=0;C<q.length;C++){const b=q[C].animations;if(b)for(let G=0;G<b.length;G++)s.b.MakeAnimationAdditive(b[G],d,P)}return i&&(i.isAdditive=!0),b}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(b){this._meshesWithPoseMatrix.push(b)}_unregisterMeshWithPoseMatrix(b){const d=this._meshesWithPoseMatrix.indexOf(b);d>-1&&this._meshesWithPoseMatrix.splice(d,1)}_computeTransformMatrices(b,d){this.onBeforeComputeObservable.notifyObservers(this);for(let P=0;P<this.bones.length;P++){const G=this.bones[P];G._childUpdateId++;const W=G.getParent();if(W?G.getLocalMatrix().multiplyToRef(W.getFinalMatrix(),G.getFinalMatrix()):d?G.getLocalMatrix().multiplyToRef(d,G.getFinalMatrix()):G.getFinalMatrix().q(G.getLocalMatrix()),-1!==G._index){const d=null===G._index?P:G._index;G.getAbsoluteInverseBindMatrix().multiplyToArray(G.getFinalMatrix(),b,16*d)}}this._identity.copyToArray(b,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const b=this.Xb().getRenderId();if(this._currentRenderId===b)return;this._currentRenderId=b}if(this._numBonesWithLinkedTransformNode>0)for(const b of this.bones)if(b._linkedTransformNode){const d=b._linkedTransformNode;b.position=d.position,d.rotationQuaternion?b.rotationQuaternion=d.rotationQuaternion:b.rotation=d.rotation,b.hd=d.hd}if(this.needInitialSkinMatrix)for(const b of this._meshesWithPoseMatrix){const d=b.getPoseMatrix();let P=this._isDirty;if(b._bonesTransformMatrices&&b._bonesTransformMatrices.length===16*(this.bones.length+1)||(b._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),P=!0),P){if(this._synchronizedWithMesh!==b){this._synchronizedWithMesh=b;for(const b of this.bones)if(!b.getParent()){b.getBindMatrix().multiplyToRef(d,W.TmpVectors.Matrix[1]),b._updateAbsoluteBindMatrices(W.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const d=4*(this.bones.length+1);b._transformMatrixTexture&&b._transformMatrixTexture.getSize().width===d||(b._transformMatrixTexture&&b._transformMatrixTexture.dispose(),b._transformMatrixTexture=Y.b.CreateRGBATexture(b._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(b._bonesTransformMatrices,d),this.isUsingTextureForMatrices&&b._transformMatrixTexture&&b._transformMatrixTexture.update(b._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=Y.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let b=0;b<this.bones.length;b++)this._animatables.push(this.bones[b])}return this._animatables}clone(b,d){const P=new B(b,d||b,this._scene);P.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let G=0;G<this.bones.length;G++){const b=this.bones[G];let d=null;const W=b.getParent();if(W){const b=this.bones.indexOf(W);d=P.bones[b]}const i=new L.e(b.name,P,d,b.getBindMatrix().clone(),b.getRestMatrix().clone());i._index=b._index,b._linkedTransformNode&&i.linkTransformNode(b._linkedTransformNode),r.b.DeepCopy(b.animations,i.animations)}if(this._ranges){P._ranges={};for(const b in this._ranges){const d=this._ranges[b];d&&(P._ranges[b]=d.clone())}}return this._isDirty=!0,P.prepare(!0),P}enableBlending(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const d of this.bones)for(const P of d.animations)P.enableBlending=!0,P.blendingSpeed=b}dispose(){if(this._meshesWithPoseMatrix.length=0,this.Xb().stopAnimation(this),this.Xb().removeSkeleton(this),this._parentContainer){const b=this._parentContainer.skeletons.indexOf(this);b>-1&&this._parentContainer.skeletons.splice(b,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const b={};b.name=this.name,b.id=this.id,this.dimensionsAtRest&&(b.dimensionsAtRest=this.dimensionsAtRest.jd()),b.bones=[],b.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let P=0;P<this.bones.length;P++){var d;const G=this.bones[P],W=G.getParent(),i={parentBoneIndex:W?this.bones.indexOf(W):-1,index:G.getIndex(),name:G.name,id:G.id,matrix:G.getBindMatrix().jd(),rest:G.getRestMatrix().jd(),linkedTransformNodeId:null===(d=G.getTransformNode())||void 0===d?void 0:d.id};b.bones.push(i),G.length&&(i.length=G.length),G.metadata&&(i.metadata=G.metadata),G.animations&&G.animations.length>0&&(i.animation=G.animations[0].serialize()),b.ranges=[];for(const d in this._ranges){const P=this._ranges[d];if(!P)continue;const G={};G.name=d,G.from=P.from,G.to=P.to,b.ranges.push(G)}}return b}static Parse(b,d){const P=new B(b.name,b.id,d);let G;for(b.dimensionsAtRest&&(P.dimensionsAtRest=W.ed.Od(b.dimensionsAtRest)),P.needInitialSkinMatrix=b.needInitialSkinMatrix,G=0;G<b.bones.length;G++){const d=b.bones[G],i=b.bones[G].index;let q=null;d.parentBoneIndex>-1&&(q=P.bones[d.parentBoneIndex]);const C=d.rest?W.Matrix.Od(d.rest):null,J=new L.e(d.name,P,q,W.Matrix.Od(d.matrix),C,null,i);void 0!==d.id&&null!==d.id&&(J.id=d.id),d.length&&(J.length=d.length),d.metadata&&(J.metadata=d.metadata),d.animation&&J.animations.push(s.b.Parse(d.animation)),void 0!==d.linkedTransformNodeId&&null!==d.linkedTransformNodeId&&(P._hasWaitingData=!0,J._waitingTransformNodeId=d.linkedTransformNodeId)}if(b.ranges)for(G=0;G<b.ranges.length;G++){const d=b.ranges[G];P.createAnimationRange(d.name,d.from,d.to)}return P}computeAbsoluteMatrices(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||b)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(b)}getPoseMatrix(){let b=null;return this._meshesWithPoseMatrix.length>0&&(b=this._meshesWithPoseMatrix[0].getPoseMatrix()),b}sortBones(){const b=[],d=new Array(this.bones.length);for(let P=0;P<this.bones.length;P++)this._sortBones(P,b,d);this.bones=b}_sortBones(b,d,P){if(P[b])return;P[b]=!0;const G=this.bones[b];if(!G)return;void 0===G._index&&(G._index=b);const W=G.getParent();W&&this._sortBones(this.bones.indexOf(W),d,P),d.push(G)}setCurrentPoseAsRest(){for(const b of this.bones)b.setCurrentPoseAsRest()}}var n=P(11999),Z=P(12174),o=P(11658),A=P(12103),f=P(11752),g=P(12141),X=P(12115),u=P(12134),M=P(12217),e=P(11781),R=P(13244);class U{set areUpdatesFrozen(b){b?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new e.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,b||(b=w.e.LastCreatedScene),this._scene=b,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const b=this._scene.getEngine().getCaps();this._canUseTextureForTargets=b.canUseGLVertexID&&b.textureFloat&&b.maxVertexTextureImageUnits>0&&b.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return U.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?U.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(b){this._numMaxInfluencers!==b&&(this._numMaxInfluencers=b,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(b){this._useTextureToStoreTargets!==b&&(this._useTextureToStoreTargets=b,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var b;return U.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(b=this._scene)&&void 0!==b&&b.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(b){return this._activeTargets.data[b]}getTarget(b){return this._targets[b]}getTargetByName(b){for(const d of this._targets)if(d.name===b)return d;return null}addTarget(b){this._targets.push(b),this._targetInfluenceChangedObservers.push(b.onInfluenceChanged.add((b=>{this.areUpdatesFrozen&&b&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(b)}))),this._targetDataLayoutChangedObservers.push(b._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(b){const d=this._targets.indexOf(b);d>=0&&(this._targets.splice(d,1),b.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(d,1)[0]),b._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(d,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(b)}_bind(b){b.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),b.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),b.setTexture("morphTargets",this._targetStoreTexture),b.setInt("morphTargetCount",this.numInfluencers)}clone(){const b=new U(this._scene);for(const d of this._targets)b.addTarget(d.clone());return b.enablePositionMorphing=this.enablePositionMorphing,b.enableNormalMorphing=this.enableNormalMorphing,b.enableTangentMorphing=this.enableTangentMorphing,b.enableUVMorphing=this.enableUVMorphing,b.enableUV2Morphing=this.enableUV2Morphing,b.enableColorMorphing=this.enableColorMorphing,b}serialize(){const b={};b.id=this.uniqueId,b.targets=[];for(const d of this._targets)b.targets.push(d.serialize());return b}_syncActiveTargets(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const d=!!this._targetStoreTexture,P=this.isUsingTextureForTargets;(this._mustSynchronize||d!==P)&&(this._mustSynchronize=!1,this.synchronize());let G=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let W=-1;for(const i of this._targets)if(W++,0!==i.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=U.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(i),this._morphTargetTextureIndices[G]=W,this._tempInfluences[G++]=i.influence}this._morphTargetTextureIndices.length!==G&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,G)),this._influences&&this._influences.length===G||(this._influences=new Float32Array(G));for(let i=0;i<G;i++)this._influences[i]=this._tempInfluences[i];if(b&&this._scene)for(const i of this._scene.meshes)i.morphTargetManager===this&&(P?i._markSubMeshesAsAttributesDirty():i._syncGeometryWithMorphTargetManager())}synchronize(){var b;if(!this._scene||this.areUpdatesFrozen)return;const d=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(b=this._targetStoreTexture)||void 0===b||b.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>d.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const P of this._targets){this._supportsPositions=this._supportsPositions&&P.hasPositions,this._supportsNormals=this._supportsNormals&&P.hasNormals,this._supportsTangents=this._supportsTangents&&P.hasTangents,this._supportsUVs=this._supportsUVs&&P.hasUVs,this._supportsUV2s=this._supportsUV2s&&P.hasUV2s,this._supportsColors=this._supportsColors&&P.hasColors;const b=P.vertexCount;if(0===this._vertexCount)this._vertexCount=b;else if(this._vertexCount!==b)return void t.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${P.name}": ${b}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const b=d.getCaps().maxTextureSize;this._textureWidth>b&&(this._textureHeight=Math.ceil(this._textureWidth/b),this._textureWidth=b);const P=this._targets.length,G=new Float32Array(P*this._textureWidth*this._textureHeight*4);let W=0;for(let d=0;d<P;d++){const b=this._targets[d],P=b.getPositions(),i=b.getNormals(),q=b.getUVs(),C=b.getTangents(),J=b.getUV2s(),L=b.getColors();W=d*this._textureWidth*this._textureHeight*4;for(let d=0;d<this._vertexCount;d++)this._supportsPositions&&P&&(G[W]=P[3*d],G[W+1]=P[3*d+1],G[W+2]=P[3*d+2],W+=4),this._supportsNormals&&i&&(G[W]=i[3*d],G[W+1]=i[3*d+1],G[W+2]=i[3*d+2],W+=4),this._supportsUVs&&q&&(G[W]=q[2*d],G[W+1]=q[2*d+1],W+=4),this._supportsTangents&&C&&(G[W]=C[3*d],G[W+1]=C[3*d+1],G[W+2]=C[3*d+2],W+=4),this._supportsUV2s&&J&&(G[W]=J[2*d],G[W+1]=J[2*d+1],W+=4),this._supportsColors&&L&&(G[W]=L[4*d],G[W+1]=L[4*d+1],G[W+2]=L[4*d+2],G[W+3]=L[4*d+3],W+=4)}this._targetStoreTexture=R.c.CreateRGBATexture(G,this._textureWidth,this._textureHeight,P,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const P of this._scene.meshes)P.morphTargetManager===this&&P._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const b=this._parentContainer.morphTargetManagers.indexOf(this);b>-1&&this._parentContainer.morphTargetManagers.splice(b,1),this._parentContainer=null}for(const b of this._targets)this._scene.stopAnimation(b)}}static Parse(b,d){const P=new U(d);for(const G of b.targets)P.addTarget(M.c.Parse(G,d));return P}}U.EnableTextureStorage=!0,U.MaxActiveMorphTargetsInVertexAttributeMode=8,U.ConstantTargetCountForTextureMode=0;var H=P(13299),p=P(11539),S=P(12018);const l=new Map,N=l;function j(b,d,P){a(b)&&t.e.Warn(`Extension with the name '${b}' already exists`),l.set(b,{isGLTFExtension:d,factory:P})}function a(b){return l.delete(b)}var O=P(13314),V=P(12278),y=P(11765);class c{static Get(b,d,P){if(!d||void 0==P||!d[P])throw new Error(`${b}: Failed to find index (${P})`);return d[P]}static TryGet(b,d){return b&&void 0!=d&&b[d]?b[d]:null}static Assign(b){if(b)for(let d=0;d<b.length;d++)b[d].index=d}}function D(b){if(b.min&&b.max){const d=b.min,P=b.max,G=W.TmpVectors.ed[0].Fd(d[0],d[1],d[2]),i=W.TmpVectors.ed[1].Fd(P[0],P[1],P[2]);if(b.normalized&&5126!==b.componentType){let d=1;switch(b.componentType){case 5120:d=127;break;case 5121:d=255;break;case 5122:d=32767;break;case 5123:d=65535}const P=1/d;G.scaleInPlace(P),i.scaleInPlace(P)}return new S.d(G,i)}return null}class z{static RegisterExtension(b,d){j(b,!1,d)}static UnregisterExtension(b){return a(b)}get fd(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(b){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=b}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((b=>b.dispose&&b.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(b,d,P,G,W,i){let q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=d,this._assetContainer=P,this._loadData(G);let i=null;if(b){const d={};if(this._gltf.nodes)for(const b of this._gltf.nodes)b.name&&(d[b.name]=b.index);i=(b instanceof Array?b:[b]).map((b=>{const P=d[b];if(void 0===P)throw new Error(`Failed to find node '${b}'`);return P}))}return await this._loadAsync(W,q,i,(()=>({meshes:this._getMeshes(),kY:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(b,d,P,G){let W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=b,this._loadData(d),await this._loadAsync(P,W,null,(()=>{}))}async _loadAsync(b,d,P,G){return await Promise.resolve().then((async()=>{this._rootUrl=b,this._uniqueRootUrl=!b.startsWith("file:")&&d?b:`${b}${Date.now()}/`,this._fileName=d,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const W=`${H.h[H.h.LOADING]} => ${H.h[H.h.READY]}`,i=`${H.h[H.h.LOADING]} => ${H.h[H.h.COMPLETE]}`;this._parent._startPerformanceCounter(W),this._parent._startPerformanceCounter(i),this._parent._setState(H.h.LOADING),this._extensionsOnLoading();const C=new Array;if(!this.parent.loadOnlyMaterials)if(P)C.push(this.loadSceneAsync("/nodes",{nodes:P,index:-1}));else if(void 0!=this._gltf.Hd||this._gltf.scenes&&this._gltf.scenes[0]){const b=c.Get("/scene",this._gltf.scenes,this._gltf.Hd||0);C.push(this.loadSceneAsync(`/scenes/${b.index}`,b))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let b=0;b<this._gltf.materials.length;++b){const d=this._gltf.materials[b],P="/materials/"+b,G=n.e.TriangleFillMode;C.push(this._loadMaterialAsync(P,d,null,G,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&C.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&C.push(this._compileShadowGeneratorsAsync());const J=Promise.all(C).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.yC(!0);for(const b of this._babylonScene.materials){const d=b;void 0!==d.maxSimultaneousLights&&(d.maxSimultaneousLights=Math.max(d.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(H.h.READY),this._skipStartAnimationStep||this._startAnimations(),G()}));return await J.then((b=>(this._parent._endPerformanceCounter(W),q.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(i),this._parent._setState(H.h.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(b=>{this._parent.onErrorObservable.notifyObservers(b),this._parent.onErrorObservable.clear(),this.dispose()}))})),b)))})).catch((b=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(b),this._parent.onErrorObservable.clear(),this.dispose()),b}))}_loadData(b){if(this._gltf=b.json,this._setupData(),b.bin){const d=this._gltf.buffers;if(d&&d[0]&&!d[0].uri){const P=d[0];(P.byteLength<b.bin.byteLength-3||P.byteLength>b.bin.byteLength)&&t.e.Warn(`Binary buffer length (${P.byteLength}) from JSON does not match chunk length (${b.bin.byteLength})`),this._bin=b.bin}else t.e.Warn("Unexpected BIN chunk")}}_setupData(){if(c.Assign(this._gltf.accessors),c.Assign(this._gltf.animations),c.Assign(this._gltf.buffers),c.Assign(this._gltf.bufferViews),c.Assign(this._gltf.cameras),c.Assign(this._gltf.images),c.Assign(this._gltf.materials),c.Assign(this._gltf.meshes),c.Assign(this._gltf.nodes),c.Assign(this._gltf.samplers),c.Assign(this._gltf.scenes),c.Assign(this._gltf.skins),c.Assign(this._gltf.textures),this._gltf.nodes){const b={};for(const P of this._gltf.nodes)if(P.children)for(const d of P.children)b[d]=P.index;const d=this._createRootNode();for(const P of this._gltf.nodes){const G=b[P.index];P.parent=void 0===G?d:this._gltf.nodes[G]}}}async _loadExtensionsAsync(){const b=[];if(N.forEach(((d,P)=>{var G;!1===(null===(G=this.parent.extensionOptions[P])||void 0===G?void 0:G.enabled)?d.isGLTFExtension&&this.isExtensionUsed(P)&&t.e.Warn(`Extension ${P} is used but has been explicitly disabled.`):d.isGLTFExtension&&!this.isExtensionUsed(P)||b.push((async()=>{const b=await d.factory(this);return b.name!==P&&t.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${b.name} !== ${P}`),this._parent.onExtensionLoadedObservable.notifyObservers(b),b})())})),this._extensions.push(...await Promise.all(b)),this._extensions.sort(((b,d)=>(b.order||Number.MAX_VALUE)-(d.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const P of this._gltf.extensionsRequired){if(!this._extensions.some((b=>b.name===P&&b.enabled))){var d;if(!1===(null===(d=this.parent.extensionOptions[P])||void 0===d?void 0:d.enabled))throw new Error(`Required extension ${P} is disabled`);throw new Error(`Required extension ${P} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const b=new u.d("__root__",this._babylonScene);this._rootBabylonMesh=b,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.yC(!1);const d={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case H.e.AUTO:this._babylonScene.useRightHandedSystem||(d.rotation=[0,1,0,0],d.scale=[1,1,-1],z._LoadTransform(d,this._rootBabylonMesh));break;case H.e.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(b),d}loadSceneAsync(b,d){const P=this._extensionsLoadSceneAsync(b,d);if(P)return P;const G=new Array;if(this.logOpen(`${b} ${d.name||""}`),d.nodes)for(const W of d.nodes){const d=c.Get(`${b}/nodes/${W}`,this._gltf.nodes,W);G.push(this.loadNodeAsync(`/nodes/${d.index}`,d,(b=>{b.parent=this._rootBabylonMesh})))}for(const W of this._postSceneLoadActions)W();return G.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(G).then((()=>{}))}_forEachPrimitive(b,d){if(b._primitiveBabylonMeshes)for(const P of b._primitiveBabylonMeshes)d(P)}_getGeometries(){const b=[],d=this._gltf.nodes;if(d)for(const P of d)this._forEachPrimitive(P,(d=>{const P=d.Qd;P&&-1===b.indexOf(P)&&b.push(P)}));return b}_getMeshes(){const b=[];this._rootBabylonMesh instanceof X.d&&b.push(this._rootBabylonMesh);const d=this._gltf.nodes;if(d)for(const P of d)this._forEachPrimitive(P,(d=>{b.push(d)}));return b}_getTransformNodes(){const b=[],d=this._gltf.nodes;if(d)for(const P of d)P._babylonTransformNode&&"mw"===P._babylonTransformNode.getClassName()&&b.push(P._babylonTransformNode),P._babylonTransformNodeForSkin&&b.push(P._babylonTransformNodeForSkin);return b}_getSkeletons(){const b=[],d=this._gltf.skins;if(d)for(const P of d)P._data&&b.push(P._data.babylonSkeleton);return b}_getAnimationGroups(){const b=[],d=this._gltf.animations;if(d)for(const P of d)P._babylonAnimationGroup&&b.push(P._babylonAnimationGroup);return b}_startAnimations(){switch(this._parent.animationStartMode){case H.c.NONE:break;case H.c.FIRST:{const b=this._getAnimationGroups();0!==b.length&&b[0].start(!0);break}case H.c.ALL:{const b=this._getAnimationGroups();for(const d of b)d.start(!0);break}default:return void t.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const G=this._extensionsLoadNodeAsync(b,d,P);if(G)return G;if(d._babylonTransformNode)throw new Error(`${b}: Invalid recursive node hierarchy`);const W=new Array;this.logOpen(`${b} ${d.name||""}`);const i=G=>{if(z.AddPointerMetadata(G,b),z._LoadTransform(d,G),void 0!=d.camera){const P=c.Get(`${b}/camera`,this._gltf.cameras,d.camera);W.push(this.loadCameraAsync(`/cameras/${P.index}`,P,(b=>{b.parent=G,this._babylonScene.useRightHandedSystem||(G.hd.x=-1)})))}if(d.children)for(const P of d.children){const d=c.Get(`${b}/children/${P}`,this._gltf.nodes,P);W.push(this.loadNodeAsync(`/nodes/${d.index}`,d,(b=>{b.parent=G})))}P(G)},q=void 0!=d.mesh,C=this._parent.loadSkins&&void 0!=d.skin;if(!q||C){const b=d.name||`node${d.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const P=new A.b(b,this._babylonScene);P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==d.mesh?d._babylonTransformNode=P:d._babylonTransformNodeForSkin=P,i(P)}if(q)if(C){const P=c.Get(`${b}/mesh`,this._gltf.meshes,d.mesh);W.push(this._loadMeshAsync(`/meshes/${P.index}`,d,P,(P=>{const G=d._babylonTransformNodeForSkin;P.metadata=(0,V.b)(G.metadata,P.metadata||{});const i=c.Get(`${b}/skin`,this._gltf.skins,d.skin);W.push(this._loadSkinAsync(`/skins/${i.index}`,d,i,(b=>{this._forEachPrimitive(d,(d=>{d.skeleton=b})),this._postSceneLoadActions.push((()=>{if(void 0!=i.skeleton){const b=c.Get(`/skins/${i.index}/skeleton`,this._gltf.nodes,i.skeleton).parent;d.index===b.index?P.parent=G.parent:P.parent=b._babylonTransformNode}else P.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:G,skinnedNode:P})}))})))})))}else{const P=c.Get(`${b}/mesh`,this._gltf.meshes,d.mesh);W.push(this._loadMeshAsync(`/meshes/${P.index}`,d,P,i))}return this.logClose(),Promise.all(W).then((()=>(this._forEachPrimitive(d,(b=>{const d=b;!d.isAnInstance&&d.Qd&&d.Qd.useBoundingInfoFromGeometry?b.lb():b.refreshBoundingInfo(!0,!0)})),d._babylonTransformNode)))}_loadMeshAsync(b,d,P,G){const W=P.primitives;if(!W||!W.length)throw new Error(`${b}: Primitives are missing`);void 0==W[0].index&&c.Assign(W);const i=new Array;this.logOpen(`${b} ${P.name||""}`);const q=d.name||`node${d.index}`;if(1===W.length){const G=P.primitives[0];i.push(this._loadMeshPrimitiveAsync(`${b}/primitives/${G.index}`,q,d,P,G,(b=>{d._babylonTransformNode=b,d._primitiveBabylonMeshes=[b]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,d._babylonTransformNode=new A.b(q,this._babylonScene),d._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d._primitiveBabylonMeshes=[];for(const G of W)i.push(this._loadMeshPrimitiveAsync(`${b}/primitives/${G.index}`,`${q}_primitive${G.index}`,d,P,G,(b=>{b.parent=d._babylonTransformNode,d._primitiveBabylonMeshes.push(b)})))}return G(d._babylonTransformNode),this.logClose(),Promise.all(i).then((()=>d._babylonTransformNode))}_loadMeshPrimitiveAsync(b,d,P,G,W,i){const q=this._extensionsLoadMeshPrimitiveAsync(b,d,P,G,W,i);if(q)return q;this.logOpen(`${b}`);const C=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==P.skin&&!G.primitives[0].targets;let J,L;if(C&&W._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,J=W._instanceData.babylonSourceMesh.createInstance(d),J._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,L=W._instanceData.promise;else{const i=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new u.d(d,this._babylonScene);q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q.sideOrientation=this._babylonScene.useRightHandedSystem?n.e.CounterClockWiseSideOrientation:n.e.ClockWiseSideOrientation,this._createMorphTargets(b,P,G,W,q),i.push(this._loadVertexDataAsync(b,W,q).then((async d=>await this._loadMorphTargetsAsync(b,W,q,d).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,d.pb(q),d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const x=z._GetDrawMode(b,W.mode);if(void 0==W.material){let b=this._defaultBabylonMaterialData[x];b||(b=this._createDefaultMaterial("__GLTFLoader._default",x),this._parent.onMaterialLoadedObservable.notifyObservers(b),this._defaultBabylonMaterialData[x]=b),q.material=b}else if(!this.parent.skipMaterials){const d=c.Get(`${b}/material`,this._gltf.materials,W.material);i.push(this._loadMaterialAsync(`/materials/${d.index}`,d,q,x,(b=>{q.material=b})))}L=Promise.all(i),C&&(W._instanceData={babylonSourceMesh:q,promise:L}),J=q}return z.AddPointerMetadata(J,b),this._parent.onMeshLoadedObservable.notifyObservers(J),i(J),this.logClose(),L.then((()=>J))}_loadVertexDataAsync(b,d,P){const G=this._extensionsLoadVertexDataAsync(b,d,P);if(G)return G;const W=d.attributes;if(!W)throw new Error(`${b}: Attributes are missing`);const i=new Array,q=new g.d(P.name,this._babylonScene);if(void 0==d.indices)P.isUnIndexed=!0;else{const P=c.Get(`${b}/indices`,this._gltf.accessors,d.indices);i.push(this._loadIndicesAccessorAsync(`/accessors/${P.index}`,P).then((b=>{q.setIndices(b)})))}const C=(d,G,C)=>{if(void 0==W[d])return;P._delayInfo=P._delayInfo||[],-1===P._delayInfo.indexOf(G)&&P._delayInfo.push(G);const J=c.Get(`${b}/attributes/${d}`,this._gltf.accessors,W[d]);i.push(this._loadVertexAccessorAsync(`/accessors/${J.index}`,J,G).then((b=>{if(b.getKind()===f.c.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!P.skeleton){const b=D(J);b&&(q._boundingInfo=b,q.useBoundingInfoFromGeometry=!0)}q.setVerticesBuffer(b,J.count)}))),G==f.c.MatricesIndicesExtraKind&&(P.numBoneInfluencers=8),C&&C(J)};return C("POSITION",f.c.PositionKind),C("NORMAL",f.c.NormalKind),C("TANGENT",f.c.TangentKind),C("TEXCOORD_0",f.c.UVKind),C("TEXCOORD_1",f.c.UV2Kind),C("TEXCOORD_2",f.c.UV3Kind),C("TEXCOORD_3",f.c.UV4Kind),C("TEXCOORD_4",f.c.UV5Kind),C("TEXCOORD_5",f.c.UV6Kind),C("JOINTS_0",f.c.MatricesIndicesKind),C("WEIGHTS_0",f.c.MatricesWeightsKind),C("JOINTS_1",f.c.MatricesIndicesExtraKind),C("WEIGHTS_1",f.c.MatricesWeightsExtraKind),C("COLOR_0",f.c.ColorKind,(b=>{"VEC4"===b.type&&(P.hasVertexAlpha=!0)})),Promise.all(i).then((()=>q))}_createMorphTargets(b,d,P,G,W){if(!G.targets||!this._parent.loadMorphTargets)return;if(void 0==d._numMorphTargets)d._numMorphTargets=G.targets.length;else if(G.targets.length!==d._numMorphTargets)throw new Error(`${b}: Primitives do not have the same number of targets`);const i=P.extras?P.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,W.morphTargetManager=new U(this._babylonScene),W.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,W.morphTargetManager.areUpdatesFrozen=!0;for(let q=0;q<G.targets.length;q++){const b=d.weights?d.weights[q]:P.weights?P.weights[q]:0,G=i?i[q]:`morphTarget${q}`;W.morphTargetManager.addTarget(new M.c(G,b,W.Xb()))}}_loadMorphTargetsAsync(b,d,P,G){if(!d.targets||!this._parent.loadMorphTargets)return Promise.resolve();const W=new Array,i=P.morphTargetManager;for(let q=0;q<i.numTargets;q++){const P=i.getTarget(q);W.push(this._loadMorphTargetVertexDataAsync(`${b}/targets/${q}`,G,d.targets[q],P))}return Promise.all(W).then((()=>{i.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(b,d,P,G){const W=new Array,i=(G,i,q)=>{if(void 0==P[G])return;const C=d.getVertexBuffer(i);if(!C)return;const J=c.Get(`${b}/${G}`,this._gltf.accessors,P[G]);W.push(this._loadFloatAccessorAsync(`/accessors/${J.index}`,J).then((b=>{q(C,b)})))};return i("POSITION",f.c.PositionKind,((b,d)=>{const P=new Float32Array(d.length);b.forEach(d.length,((b,G)=>{P[G]=d[G]+b})),G.setPositions(P)})),i("NORMAL",f.c.NormalKind,((b,d)=>{const P=new Float32Array(d.length);b.forEach(P.length,((b,G)=>{P[G]=d[G]+b})),G.setNormals(P)})),i("TANGENT",f.c.TangentKind,((b,d)=>{const P=new Float32Array(d.length/3*4);let W=0;b.forEach(d.length/3*4,((b,G)=>{(G+1)%4!==0&&(P[W]=d[W]+b,W++)})),G.setTangents(P)})),i("TEXCOORD_0",f.c.UVKind,((b,d)=>{const P=new Float32Array(d.length);b.forEach(d.length,((b,G)=>{P[G]=d[G]+b})),G.setUVs(P)})),i("TEXCOORD_1",f.c.UV2Kind,((b,d)=>{const P=new Float32Array(d.length);b.forEach(d.length,((b,G)=>{P[G]=d[G]+b})),G.setUV2s(P)})),i("COLOR_0",f.c.ColorKind,((d,P)=>{let W=null;const i=d.getSize();if(3===i){W=new Float32Array(P.length/3*4),d.forEach(P.length,((b,d)=>{const G=Math.floor(d/3),i=d%3;W[4*G+i]=P[3*G+i]+b}));for(let b=0;b<P.length/3;++b)W[4*b+3]=1}else{if(4!==i)throw new Error(`${b}: Invalid number of components (${i}) for COLOR_0 attribute`);W=new Float32Array(P.length),d.forEach(P.length,((b,d)=>{W[d]=P[d]+b}))}G.setColors(W)})),await Promise.all(W).then((()=>{}))}static _LoadTransform(b,d){if(void 0!=b.skin)return;let P=W.ed.Zero(),G=W.Quaternion.Identity(),i=W.ed.One();if(b.matrix){W.Matrix.Od(b.matrix).decompose(i,G,P)}else b.translation&&(P=W.ed.Od(b.translation)),b.rotation&&(G=W.Quaternion.Od(b.rotation)),b.scale&&(i=W.ed.Od(b.scale));d.position=P,d.rotationQuaternion=G,d.hd=i}_loadSkinAsync(b,d,P,G){if(!this._parent.loadSkins)return Promise.resolve();const W=this._extensionsLoadSkinAsync(b,d,P);if(W)return W;if(P._data)return G(P._data.babylonSkeleton),P._data.promise;const i=`skeleton${P.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new B(P.name||i,i,this._babylonScene);q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(b,P,q);const C=this._loadSkinInverseBindMatricesDataAsync(b,P).then((b=>{this._updateBoneMatrices(q,b)}));return P._data={babylonSkeleton:q,promise:C},G(q),C}_loadBones(b,d,P){if(void 0==d.skeleton||this._parent.alwaysComputeSkeletonRootNode){const P=this._findSkeletonRootNode(`${b}/joints`,d.joints);if(P)if(void 0===d.skeleton)d.skeleton=P.index;else{const G=(b,d)=>{for(;d.parent;d=d.parent)if(d.parent===b)return!0;return!1},W=c.Get(`${b}/skeleton`,this._gltf.nodes,d.skeleton);W===P||G(W,P)||(t.e.Warn(`${b}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),d.skeleton=P.index)}else t.e.Warn(`${b}: Failed to find common root`)}const G={};for(const W of d.joints){const i=c.Get(`${b}/joints/${W}`,this._gltf.nodes,W);this._loadBone(i,d,P,G)}}_findSkeletonRootNode(b,d){if(0===d.length)return null;const P={};for(const W of d){const d=[];let G=c.Get(`${b}/${W}`,this._gltf.nodes,W);for(;-1!==G.index;)d.unshift(G),G=G.parent;P[W]=d}let G=null;for(let W=0;;++W){let b=P[d[0]];if(W>=b.length)return G;const i=b[W];for(let q=1;q<d.length;++q)if(b=P[d[q]],W>=b.length||i!==b[W])return G;G=i}}_loadBone(b,d,P,G){b._isJoint=!0;let W=G[b.index];if(W)return W;let i=null;b.index!==d.skeleton&&(b.parent&&-1!==b.parent.index?i=this._loadBone(b.parent,d,P,G):void 0!==d.skeleton&&t.e.Warn(`/skins/${d.index}/skeleton: Skeleton node is not a common root`));const q=d.joints.indexOf(b.index);return W=new L.e(b.name||`joint${b.index}`,P,i,this._getNodeMatrix(b),null,null,q),G[b.index]=W,this._postSceneLoadActions.push((()=>{W.linkTransformNode(b._babylonTransformNode)})),W}_loadSkinInverseBindMatricesDataAsync(b,d){if(void 0==d.inverseBindMatrices)return Promise.resolve(null);const P=c.Get(`${b}/inverseBindMatrices`,this._gltf.accessors,d.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${P.index}`,P)}_updateBoneMatrices(b,d){for(const P of b.bones){const b=W.Matrix.Identity(),G=P._index;d&&-1!==G&&(W.Matrix.FromArrayToRef(d,16*G,b),b.invertToRef(b));const i=P.getParent();i&&b.multiplyToRef(i.getAbsoluteInverseBindMatrix(),b),P.yd(b,!1,!1),P._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(b){return b.matrix?W.Matrix.Od(b.matrix):W.Matrix.Compose(b.scale?W.ed.Od(b.scale):W.ed.One(),b.rotation?W.Quaternion.Od(b.rotation):W.Quaternion.Identity(),b.translation?W.ed.Od(b.translation):W.ed.Zero())}loadCameraAsync(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const G=this._extensionsLoadCameraAsync(b,d,P);if(G)return G;const i=new Array;this.logOpen(`${b} ${d.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new J.b(d.name||`camera${d.index}`,W.ed.Zero(),this._babylonScene,!1);switch(q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d._babylonCamera=q,q.setTarget(new W.ed(0,0,-1)),d.type){case"perspective":{const P=d.perspective;if(!P)throw new Error(`${b}: Camera perspective properties are missing`);q.fov=P.yfov,q.Vd=P.znear,q.maxZ=P.zfar||0;break}case"orthographic":if(!d.orthographic)throw new Error(`${b}: Camera orthographic properties are missing`);q.mode=C.c.ORTHOGRAPHIC_CAMERA,q.orthoLeft=-d.orthographic.xmag,q.orthoRight=d.orthographic.xmag,q.orthoBottom=-d.orthographic.ymag,q.orthoTop=d.orthographic.ymag,q.Vd=d.orthographic.znear,q.maxZ=d.orthographic.zfar;break;default:throw new Error(`${b}: Invalid camera type (${d.type})`)}return z.AddPointerMetadata(q,b),this._parent.onCameraLoadedObservable.notifyObservers(q),P(q),this.logClose(),Promise.all(i).then((()=>q))}_loadAnimationsAsync(){const b=this._gltf.animations;if(!b)return Promise.resolve();const d=new Array;for(let P=0;P<b.length;P++){const G=b[P];d.push(this.loadAnimationAsync(`/animations/${G.index}`,G).then((b=>{0===b.targetedAnimations.length&&b.dispose()})))}return Promise.all(d).then((()=>{}))}loadAnimationAsync(b,d){const G=this._extensionsLoadAnimationAsync(b,d);return G||P.e(78).then(P.bind(P,14826)).then((P=>{let{AnimationGroup:G}=P;this._babylonScene._blockEntityCollection=!!this._assetContainer;const W=new G(d.name||`animation${d.index}`,this._babylonScene);W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d._babylonAnimationGroup=W;const i=new Array;c.Assign(d.channels),c.Assign(d.samplers);for(const q of d.channels)i.push(this._loadAnimationChannelAsync(`${b}/channels/${q.index}`,b,d,q,((b,d)=>{b.animations=b.animations||[],b.animations.push(d),W.addTargetedAnimation(d,b)})));return Promise.all(i).then((()=>(W.normalize(0),W)))}))}async _loadAnimationChannelAsync(b,d,G,W,i){const q=this._extensionsLoadAnimationChannelAsync(b,d,G,W,i);if(q)return await q;if(void 0==W.target.node)return await Promise.resolve();const C=c.Get(`${b}/target/node`,this._gltf.nodes,W.target.node),J=W.target.path,L="weights"===J;if(L&&!C._numMorphTargets||!L&&!C._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!L&&!C._isJoint)return await Promise.resolve();let x;switch(await Promise.resolve().then(P.bind(P,13324)),J){case"translation":var Y;x=null===(Y=(0,O.g)("/nodes/{}/translation"))||void 0===Y?void 0:Y.interpolation;break;case"rotation":var s;x=null===(s=(0,O.g)("/nodes/{}/rotation"))||void 0===s?void 0:s.interpolation;break;case"scale":var E;x=null===(E=(0,O.g)("/nodes/{}/scale"))||void 0===E?void 0:E.interpolation;break;case"weights":var w;x=null===(w=(0,O.g)("/nodes/{}/weights"))||void 0===w?void 0:w.interpolation;break;default:throw new Error(`${b}/target/path: Invalid value (${W.target.path})`)}if(!x)throw new Error(`${b}/target/path: Could not find interpolation properties for target path (${W.target.path})`);const t={object:C,info:x};return await this._loadAnimationChannelFromTargetInfoAsync(b,d,G,W,t,i)}_loadAnimationChannelFromTargetInfoAsync(b,d,P,G,W,i){const q=this.parent.targetFps,C=1/q,J=c.Get(`${b}/sampler`,P.samplers,G.sampler);return this._loadAnimationSamplerAsync(`${d}/samplers/${G.sampler}`,J).then((b=>{let d=0;const J=W.object,L=W.info;for(const W of L){const L=W.getStride(J),x=b.input,Y=b.output,s=new Array(x.length);let E=0;switch(b.interpolation){case"STEP":for(let b=0;b<x.length;b++){const d=W.getValue(J,Y,E,1);E+=L,s[b]={frame:x[b]*q,value:d,interpolation:1}}break;case"CUBICSPLINE":for(let b=0;b<x.length;b++){const d=W.getValue(J,Y,E,C);E+=L;const P=W.getValue(J,Y,E,1);E+=L;const G=W.getValue(J,Y,E,C);E+=L,s[b]={frame:x[b]*q,inTangent:d,value:P,outTangent:G}}break;case"LINEAR":for(let b=0;b<x.length;b++){const d=W.getValue(J,Y,E,1);E+=L,s[b]={frame:x[b]*q,value:d}}}if(E>0){const b=`${P.name||`animation${P.index}`}_channel${G.index}_${d}`,C=W.buildAnimations(J,b,q,s);for(const P of C)d++,i(P.babylonAnimatable,P.babylonAnimation)}}}))}_loadAnimationSamplerAsync(b,d){if(d._data)return d._data;const P=d.interpolation||"LINEAR";switch(P){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${b}/interpolation: Invalid value (${d.interpolation})`)}const G=c.Get(`${b}/input`,this._gltf.accessors,d.input),W=c.Get(`${b}/output`,this._gltf.accessors,d.output);return d._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${G.index}`,G),this._loadFloatAccessorAsync(`/accessors/${W.index}`,W)]).then((b=>{let[d,G]=b;return{input:d,interpolation:P,output:G}})),d._data}loadBufferAsync(b,d,P,G){const W=this._extensionsLoadBufferAsync(b,d,P,G);if(W)return W;if(!d._data)if(d.uri)d._data=this.loadUriAsync(`${b}/uri`,d,d.uri);else{if(!this._bin)throw new Error(`${b}: Uri is missing or the binary glTF is missing its binary chunk`);d._data=this._bin.readAsync(0,d.byteLength)}return d._data.then((d=>{try{return new Uint8Array(d.buffer,d.byteOffset+P,G)}catch(W){throw new Error(`${b}: ${W.message}`)}}))}loadBufferViewAsync(b,d){const P=this._extensionsLoadBufferViewAsync(b,d);if(P)return P;if(d._data)return d._data;const G=c.Get(`${b}/buffer`,this._gltf.buffers,d.buffer);return d._data=this.loadBufferAsync(`/buffers/${G.index}`,G,d.byteOffset||0,d.byteLength),d._data}_loadAccessorAsync(b,d,P){if(d._data)return d._data;const G=z._GetNumComponents(b,d.type),W=G*f.c.GetTypeByteLength(d.componentType),i=G*d.count;if(void 0==d.bufferView)d._data=Promise.resolve(new P(i));else{const q=c.Get(`${b}/bufferView`,this._gltf.bufferViews,d.bufferView);d._data=this.loadBufferViewAsync(`/bufferViews/${q.index}`,q).then((C=>{if(5126!==d.componentType||d.normalized||q.byteStride&&q.byteStride!==W){const b=new P(i);return f.c.ForEach(C,d.byteOffset||0,q.byteStride||W,G,d.componentType,b.length,d.normalized||!1,((d,P)=>{b[P]=d})),b}return z._GetTypedArray(b,d.componentType,C,d.byteOffset,i)}))}if(d.sparse){const i=d.sparse;d._data=d._data.then((q=>{const C=q,J=c.Get(`${b}/sparse/indices/bufferView`,this._gltf.bufferViews,i.indices.bufferView),L=c.Get(`${b}/sparse/values/bufferView`,this._gltf.bufferViews,i.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${J.index}`,J),this.loadBufferViewAsync(`/bufferViews/${L.index}`,L)]).then((q=>{let[J,L]=q;const x=z._GetTypedArray(`${b}/sparse/indices`,i.indices.componentType,J,i.indices.byteOffset,i.count),Y=G*i.count;let s;if(5126!==d.componentType||d.normalized){const q=z._GetTypedArray(`${b}/sparse/values`,d.componentType,L,i.values.byteOffset,Y);s=new P(Y),f.c.ForEach(q,0,W,G,d.componentType,s.length,d.normalized||!1,((b,d)=>{s[d]=b}))}else s=z._GetTypedArray(`${b}/sparse/values`,d.componentType,L,i.values.byteOffset,Y);let E=0;for(let b=0;b<x.length;b++){let d=x[b]*G;for(let b=0;b<G;b++)C[d++]=s[E++]}return C}))}))}return d._data}_loadFloatAccessorAsync(b,d){return this._loadAccessorAsync(b,d,Float32Array)}_loadIndicesAccessorAsync(b,d){if("SCALAR"!==d.type)throw new Error(`${b}/type: Invalid value ${d.type}`);if(5121!==d.componentType&&5123!==d.componentType&&5125!==d.componentType)throw new Error(`${b}/componentType: Invalid value ${d.componentType}`);if(d._data)return d._data;if(d.sparse){const P=z._GetTypedArrayConstructor(`${b}/componentType`,d.componentType);d._data=this._loadAccessorAsync(b,d,P)}else{const P=c.Get(`${b}/bufferView`,this._gltf.bufferViews,d.bufferView);d._data=this.loadBufferViewAsync(`/bufferViews/${P.index}`,P).then((P=>z._GetTypedArray(b,d.componentType,P,d.byteOffset,d.count)))}return d._data}_loadVertexBufferViewAsync(b){if(b._babylonBuffer)return b._babylonBuffer;const d=this._babylonScene.getEngine();return b._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${b.index}`,b).then((b=>new f.b(d,b,!1))),b._babylonBuffer}_loadVertexAccessorAsync(b,d,P){var G;if(null!==(G=d._babylonVertexBuffer)&&void 0!==G&&G[P])return d._babylonVertexBuffer[P];d._babylonVertexBuffer||(d._babylonVertexBuffer={});const W=this._babylonScene.getEngine();if(d.sparse||void 0==d.bufferView)d._babylonVertexBuffer[P]=this._loadFloatAccessorAsync(b,d).then((b=>new f.c(W,b,P,!1)));else{const G=c.Get(`${b}/bufferView`,this._gltf.bufferViews,d.bufferView);d._babylonVertexBuffer[P]=this._loadVertexBufferViewAsync(G).then((i=>{const q=z._GetNumComponents(b,d.type);return new f.c(W,i,P,!1,void 0,G.byteStride,void 0,d.byteOffset,q,d.componentType,d.normalized,!0,void 0,!0)}))}return d._babylonVertexBuffer[P]}_loadMaterialMetallicRoughnessPropertiesAsync(b,d,P){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);const G=new Array;return d&&(d.baseColorFactor?(P.albedoColor=i.Nd.Od(d.baseColorFactor),P.alpha=d.baseColorFactor[3]):P.albedoColor=i.Nd.White(),P.metallic=void 0==d.metallicFactor?1:d.metallicFactor,P.roughness=void 0==d.roughnessFactor?1:d.roughnessFactor,d.baseColorTexture&&G.push(this.loadTextureInfoAsync(`${b}/baseColorTexture`,d.baseColorTexture,(b=>{b.name=`${P.name} (Base Color)`,P.albedoTexture=b}))),d.metallicRoughnessTexture&&(d.metallicRoughnessTexture.nonColorData=!0,G.push(this.loadTextureInfoAsync(`${b}/metallicRoughnessTexture`,d.metallicRoughnessTexture,(b=>{b.name=`${P.name} (Metallic Roughness)`,P.metallicTexture=b}))),P.useMetallnessFromMetallicTextureBlue=!0,P.useRoughnessFromMetallicTextureGreen=!0,P.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(G).then((()=>{}))}_loadMaterialAsync(b,d,P,G){let W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const i=this._extensionsLoadMaterialAsync(b,d,P,G,W);if(i)return i;d._data=d._data||{};let q=d._data[G];if(!q){this.logOpen(`${b} ${d.name||""}`);const P=this.createMaterial(b,d,G);q={babylonMaterial:P,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(b,d,P)},d._data[G]=q,z.AddPointerMetadata(P,b),this._parent.onMaterialLoadedObservable.notifyObservers(P),this.logClose()}return P&&(q.babylonMeshes.push(P),P.Zd.addOnce((()=>{const b=q.babylonMeshes.indexOf(P);-1!==b&&q.babylonMeshes.splice(b,1)}))),W(q.babylonMaterial),q.promise.then((()=>q.babylonMaterial))}_createDefaultMaterial(b,d){this._babylonScene._blockEntityCollection=!!this._assetContainer;const P=new Z.d(b,this._babylonScene);return P._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,P.fillMode=d,P.enableSpecularAntiAliasing=!0,P.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,P.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,P.transparencyMode=Z.d.PBRMATERIAL_OPAQUE,P.metallic=1,P.roughness=1,P}createMaterial(b,d,P){const G=this._extensionsCreateMaterial(b,d,P);if(G)return G;const W=d.name||`material${d.index}`;return this._createDefaultMaterial(W,P)}loadMaterialPropertiesAsync(b,d,P){const G=this._extensionsLoadMaterialPropertiesAsync(b,d,P);if(G)return G;const W=new Array;return W.push(this.loadMaterialBasePropertiesAsync(b,d,P)),d.pbrMetallicRoughness&&W.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${b}/pbrMetallicRoughness`,d.pbrMetallicRoughness,P)),this.loadMaterialAlphaProperties(b,d,P),Promise.all(W).then((()=>{}))}loadMaterialBasePropertiesAsync(b,d,P){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);const G=new Array;return P.emissiveColor=d.emissiveFactor?i.Nd.Od(d.emissiveFactor):new i.Nd(0,0,0),d.doubleSided&&(P.md=!1,P.twoSidedLighting=!0),d.normalTexture&&(d.normalTexture.nonColorData=!0,G.push(this.loadTextureInfoAsync(`${b}/normalTexture`,d.normalTexture,(b=>{b.name=`${P.name} (Normal)`,P.bumpTexture=b}))),P.invertNormalMapX=!this._babylonScene.useRightHandedSystem,P.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=d.normalTexture.scale&&P.bumpTexture&&(P.bumpTexture.level=d.normalTexture.scale),P.forceIrradianceInFragment=!0),d.occlusionTexture&&(d.occlusionTexture.nonColorData=!0,G.push(this.loadTextureInfoAsync(`${b}/occlusionTexture`,d.occlusionTexture,(b=>{b.name=`${P.name} (Occlusion)`,P.ambientTexture=b}))),P.useAmbientInGrayScale=!0,void 0!=d.occlusionTexture.strength&&(P.ambientTextureStrength=d.occlusionTexture.strength)),d.emissiveTexture&&G.push(this.loadTextureInfoAsync(`${b}/emissiveTexture`,d.emissiveTexture,(b=>{b.name=`${P.name} (Emissive)`,P.emissiveTexture=b}))),Promise.all(G).then((()=>{}))}loadMaterialAlphaProperties(b,d,P){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);switch(d.alphaMode||"OPAQUE"){case"OPAQUE":P.transparencyMode=Z.d.PBRMATERIAL_OPAQUE,P.alpha=1;break;case"MASK":P.transparencyMode=Z.d.PBRMATERIAL_ALPHATEST,P.alphaCutOff=void 0==d.alphaCutoff?.5:d.alphaCutoff,P.albedoTexture&&(P.albedoTexture.ad=!0);break;case"BLEND":P.transparencyMode=Z.d.PBRMATERIAL_ALPHABLEND,P.albedoTexture&&(P.albedoTexture.ad=!0,P.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${b}/alphaMode: Invalid value (${d.alphaMode})`)}}loadTextureInfoAsync(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const G=this._extensionsLoadTextureInfoAsync(b,d,P);if(G)return G;if(this.logOpen(`${b}`),d.texCoord>=6)throw new Error(`${b}/texCoord: Invalid value (${d.texCoord})`);const W=c.Get(`${b}/index`,this._gltf.textures,d.index);W._textureInfo=d;const i=this._loadTextureAsync(`/textures/${d.index}`,W,(G=>{G.coordinatesIndex=d.texCoord||0,z.AddPointerMetadata(G,b),this._parent.onTextureLoadedObservable.notifyObservers(G),P(G)}));return this.logClose(),i}_loadTextureAsync(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const G=this._extensionsLoadTextureAsync(b,d,P);if(G)return G;this.logOpen(`${b} ${d.name||""}`);const W=void 0==d.sampler?z.DefaultSampler:c.Get(`${b}/sampler`,this._gltf.samplers,d.sampler),i=c.Get(`${b}/source`,this._gltf.images,d.source),q=this._createTextureAsync(b,W,i,P,void 0,!d._textureInfo.nonColorData);return this.logClose(),q}_createTextureAsync(b,d,P){let W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},i=arguments.length>4?arguments[4]:void 0,q=arguments.length>5?arguments[5]:void 0;const C=this._loadSampler(`/samplers/${d.index}`,d),J=new Array,L=new G;this._babylonScene._blockEntityCollection=!!this._assetContainer;const x={noMipmap:C.noMipMaps,invertY:!1,samplingMode:C.samplingMode,h:()=>{this._disposed||L.resolve()},onError:(d,P)=>{this._disposed||L.reject(new Error(`${b}: ${P&&P.message?P.message:d||"Failed to load texture"}`))},mimeType:P.mimeType??(0,p.h)(P.uri??""),loaderOptions:i,useSRGBBuffer:!!q&&this._parent.useSRGBBuffers},Y=new o.d(null,this._babylonScene,x);return Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,J.push(L.promise),J.push(this.loadImageAsync(`/images/${P.index}`,P).then((b=>{const d=P.uri||`${this._fileName}#image${P.index}`,G=`data:${this._uniqueRootUrl}${d}`;Y.updateURL(G,b);const W=Y.getInternalTexture();W&&(W.label=P.name)}))),Y.wrapU=C.wrapU,Y.wrapV=C.wrapV,W(Y),this._parent.useGltfTextureNames&&(Y.name=P.name||P.uri||`image${P.index}`),Promise.all(J).then((()=>Y))}_loadSampler(b,d){return d._data||(d._data={noMipMaps:9728===d.minFilter||9729===d.minFilter,samplingMode:z._GetTextureSamplingMode(b,d),wrapU:z._GetTextureWrapMode(`${b}/wrapS`,d.wrapS),wrapV:z._GetTextureWrapMode(`${b}/wrapT`,d.wrapT)}),d._data}loadImageAsync(b,d){if(!d._data){if(this.logOpen(`${b} ${d.name||""}`),d.uri)d._data=this.loadUriAsync(`${b}/uri`,d,d.uri);else{const P=c.Get(`${b}/bufferView`,this._gltf.bufferViews,d.bufferView);d._data=this.loadBufferViewAsync(`/bufferViews/${P.index}`,P)}this.logClose()}return d._data}loadUriAsync(b,d,P){const G=this._extensionsLoadUriAsync(b,d,P);if(G)return G;if(!z._ValidateUri(P))throw new Error(`${b}: '${P}' is invalid`);if((0,p.k)(P)){const d=new Uint8Array((0,p.d)(P));return this.log(`${b}: Decoded ${P.substring(0,64)}... (${d.length} bytes)`),Promise.resolve(d)}return this.log(`${b}: Loading ${P}`),this._parent.preprocessUrlAsync(this._rootUrl+P).then((d=>new Promise(((G,W)=>{this._parent._loadFile(this._babylonScene,d,(d=>{this._disposed||(this.log(`${b}: Loaded ${P} (${d.byteLength} bytes)`),G(new Uint8Array(d)))}),!0,(d=>{W(new p.m(`${b}: Failed to load '${P}'${d?": "+d.status+" "+d.statusText:""}`,d))}))}))))}static AddPointerMetadata(b,d){b.metadata=b.metadata||{};const P=b._internalMetadata=b._internalMetadata||{},G=P.fd=P.fd||{};(G.pointers=G.pointers||[]).push(d)}static _GetTextureWrapMode(b,d){switch(d=void 0==d?10497:d){case 33071:return o.d.CLAMP_ADDRESSMODE;case 33648:return o.d.MIRROR_ADDRESSMODE;case 10497:return o.d.WRAP_ADDRESSMODE;default:return t.e.Warn(`${b}: Invalid value (${d})`),o.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(b,d){const P=void 0==d.magFilter?9729:d.magFilter,G=void 0==d.minFilter?9987:d.minFilter;if(9729===P)switch(G){case 9728:return o.d.LINEAR_NEAREST;case 9729:return o.d.LINEAR_LINEAR;case 9984:return o.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return o.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return o.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return o.d.LINEAR_LINEAR_MIPLINEAR;default:return t.e.Warn(`${b}/minFilter: Invalid value (${G})`),o.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==P&&t.e.Warn(`${b}/magFilter: Invalid value (${P})`),G){case 9728:return o.d.NEAREST_NEAREST;case 9729:return o.d.NEAREST_LINEAR;case 9984:return o.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return o.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return o.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return o.d.NEAREST_LINEAR_MIPLINEAR;default:return t.e.Warn(`${b}/minFilter: Invalid value (${G})`),o.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(b,d){try{return(0,y.q)(d)}catch(P){throw new Error(`${b}: ${P.message}`)}}static _GetTypedArray(b,d,P,G,W){const i=P.buffer;G=P.byteOffset+(G||0);const q=z._GetTypedArrayConstructor(`${b}/componentType`,d),C=f.c.GetTypeByteLength(d);return G%C!==0?(t.e.Warn(`${b}: Copying buffer as byte offset (${G}) is not a multiple of component type byte length (${C})`),new q(i.slice(G,G+W*C),0)):new q(i,G,W)}static _GetNumComponents(b,d){switch(d){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${b}: Invalid type (${d})`)}static _ValidateUri(b){return q.Tools.IsBase64(b)||-1===b.indexOf("..")}static _GetDrawMode(b,d){switch(void 0==d&&(d=4),d){case 0:return n.e.PointListDrawMode;case 1:return n.e.LineListDrawMode;case 2:return n.e.LineLoopDrawMode;case 3:return n.e.LineStripDrawMode;case 4:return n.e.TriangleFillMode;case 5:return n.e.TriangleStripDrawMode;case 6:return n.e.TriangleFanDrawMode}throw new Error(`${b}: Invalid mesh primitive mode (${d})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const b=new Array;if(this._gltf.materials)for(const d of this._gltf.materials)if(d._data)for(const P in d._data){const G=d._data[P];for(const d of G.babylonMeshes){d.zd(!0);const P=G.babylonMaterial;b.push(P.forceCompilationAsync(d)),b.push(P.forceCompilationAsync(d,{useInstances:!0})),this._parent.useClipPlane&&(b.push(P.forceCompilationAsync(d,{clipPlane:!0})),b.push(P.forceCompilationAsync(d,{clipPlane:!0,useInstances:!0})))}}return Promise.all(b).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const b=new Array,d=this._babylonScene.lights;for(const P of d){const d=P.getShadowGenerator();d&&b.push(d.forceCompilationAsync())}return Promise.all(b).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(b){for(const d of this._extensions)d.enabled&&b(d)}_applyExtensions(b,d,P){for(const G of this._extensions)if(G.enabled){const W=`${G.name}.${d}`,i=b;i._activeLoaderExtensionFunctions=i._activeLoaderExtensionFunctions||{};const q=i._activeLoaderExtensionFunctions;if(!q[W]){q[W]=!0;try{const b=P(G);if(b)return b}finally{delete q[W]}}}return null}_extensionsOnLoading(){this._forEachExtensions((b=>b.onLoading&&b.onLoading()))}_extensionsOnReady(){this._forEachExtensions((b=>b.onReady&&b.onReady()))}_extensionsLoadSceneAsync(b,d){return this._applyExtensions(d,"loadScene",(P=>P.loadSceneAsync&&P.loadSceneAsync(b,d)))}_extensionsLoadNodeAsync(b,d,P){return this._applyExtensions(d,"loadNode",(G=>G.loadNodeAsync&&G.loadNodeAsync(b,d,P)))}_extensionsLoadCameraAsync(b,d,P){return this._applyExtensions(d,"loadCamera",(G=>G.loadCameraAsync&&G.loadCameraAsync(b,d,P)))}_extensionsLoadVertexDataAsync(b,d,P){return this._applyExtensions(d,"loadVertexData",(G=>G._loadVertexDataAsync&&G._loadVertexDataAsync(b,d,P)))}_extensionsLoadMeshPrimitiveAsync(b,d,P,G,W,i){return this._applyExtensions(W,"loadMeshPrimitive",(q=>q._loadMeshPrimitiveAsync&&q._loadMeshPrimitiveAsync(b,d,P,G,W,i)))}_extensionsLoadMaterialAsync(b,d,P,G,W){return this._applyExtensions(d,"loadMaterial",(i=>i._loadMaterialAsync&&i._loadMaterialAsync(b,d,P,G,W)))}_extensionsCreateMaterial(b,d,P){return this._applyExtensions(d,"createMaterial",(G=>G.createMaterial&&G.createMaterial(b,d,P)))}_extensionsLoadMaterialPropertiesAsync(b,d,P){return this._applyExtensions(d,"loadMaterialProperties",(G=>G.loadMaterialPropertiesAsync&&G.loadMaterialPropertiesAsync(b,d,P)))}_extensionsLoadTextureInfoAsync(b,d,P){return this._applyExtensions(d,"loadTextureInfo",(G=>G.loadTextureInfoAsync&&G.loadTextureInfoAsync(b,d,P)))}_extensionsLoadTextureAsync(b,d,P){return this._applyExtensions(d,"loadTexture",(G=>G._loadTextureAsync&&G._loadTextureAsync(b,d,P)))}_extensionsLoadAnimationAsync(b,d){return this._applyExtensions(d,"loadAnimation",(P=>P.loadAnimationAsync&&P.loadAnimationAsync(b,d)))}_extensionsLoadAnimationChannelAsync(b,d,P,G,W){return this._applyExtensions(P,"loadAnimationChannel",(i=>i._loadAnimationChannelAsync&&i._loadAnimationChannelAsync(b,d,P,G,W)))}_extensionsLoadSkinAsync(b,d,P){return this._applyExtensions(P,"loadSkin",(G=>G._loadSkinAsync&&G._loadSkinAsync(b,d,P)))}_extensionsLoadUriAsync(b,d,P){return this._applyExtensions(d,"loadUri",(G=>G._loadUriAsync&&G._loadUriAsync(b,d,P)))}_extensionsLoadBufferViewAsync(b,d){return this._applyExtensions(d,"loadBufferView",(P=>P.loadBufferViewAsync&&P.loadBufferViewAsync(b,d)))}_extensionsLoadBufferAsync(b,d,P,G){return this._applyExtensions(d,"loadBuffer",(W=>W.loadBufferAsync&&W.loadBufferAsync(b,d,P,G)))}static LoadExtensionAsync(b,d,P,G){if(!d.extensions)return null;const W=d.extensions[P];return W?G(`${b}/extensions/${P}`,W):null}static LoadExtraAsync(b,d,P,G){if(!d.extras)return null;const W=d.extras[P];return W?G(`${b}/extras/${P}`,W):null}isExtensionUsed(b){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(b)}logOpen(b){this._parent._logOpen(b)}logClose(){this._parent._logClose()}log(b){this._parent._log(b)}startPerformanceCounter(b){this._parent._startPerformanceCounter(b)}endPerformanceCounter(b){this._parent._endPerformanceCounter(b)}}z.DefaultSampler={index:-1},H.b._CreateGLTF2Loader=b=>new z(b);var Q=P(13324),I=P(11858),m=P(11716),v=P(13333),F=P(13335);class h extends F.e{constructor(b,d,P){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,J=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",b),this._texture=b.getEngine().createRawCubeTexture(d,P,G,W,i,q,C,J)}update(b,d,P,G){let W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,b,d,P,G,W)}updateRGBDAsync(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,v.k)(this._texture,b,d,P,G).then((()=>{}))}clone(){return m.c.Clone((()=>{const b=this.Xb(),d=this._texture,P=new h(b,d._bufferViewArray,d.width,d.format,d.type,d.generateMipMaps,d.invertY,d.samplingMode,d._compression);return 13===d.source&&P.updateRGBDAsync(d._bufferViewArrayArray,d._sphericalPolynomial,d._lodGenerationScale,d._lodGenerationOffset),P}),this)}}const T="EXT_lights_image_based";class K{constructor(b){this.name=T,this._loader=b,this.enabled=this._loader.isExtensionUsed(T)}dispose(){this._loader=null,delete this._lights}onLoading(){const b=this._loader.fd.extensions;if(b&&b[this.name]){const d=b[this.name];this._lights=d.lights}}loadSceneAsync(b,d){return z.LoadExtensionAsync(b,d,this.name,(async(P,G)=>{this._loader._allMaterialsDirtyRequired=!0;const W=new Array;W.push(this._loader.loadSceneAsync(b,d)),this._loader.logOpen(`${P}`);const i=c.Get(`${P}/light`,this._lights,G.Ed);return W.push(this._loadLightAsync(`/extensions/${this.name}/lights/${G.Ed}`,i).then((b=>{this._loader.babylonScene.environmentTexture=b}))),this._loader.logClose(),await Promise.all(W).then((()=>{}))}))}_loadLightAsync(b,d){if(!d._loaded){const P=new Array;this._loader.logOpen(`${b}`);const G=new Array(d.specularImages.length);for(let W=0;W<d.specularImages.length;W++){const i=d.specularImages[W];G[W]=new Array(i.length);for(let d=0;d<i.length;d++){const q=`${b}/specularImages/${W}/${d}`;this._loader.logOpen(`${q}`);const C=i[d],J=c.Get(q,this._loader.fd.images,C);P.push(this._loader.loadImageAsync(`/images/${C}`,J).then((b=>{G[W][d]=b}))),this._loader.logClose()}}this._loader.logClose(),d._loaded=Promise.all(P).then((async()=>{const P=new h(this._loader.babylonScene,null,d.specularImageSize);if(P.name=d.name||"environment",d._babylonTexture=P,void 0!=d.fC&&(P.level=d.fC),d.rotation){let b=W.Quaternion.Od(d.rotation);this._loader.babylonScene.useRightHandedSystem||(b=W.Quaternion.Inverse(b)),W.Matrix.FromQuaternionToRef(b,P.getReflectionTextureMatrix())}if(!d.irradianceCoefficients)throw new Error(`${b}: Irradiance coefficients are missing`);const i=I.c.Od(d.irradianceCoefficients);i.scaleInPlace(d.fC),i.convertIrradianceToLambertianRadiance();const q=I.g.FromHarmonics(i),C=(G.length-1)/Math.log2(d.specularImageSize);return await P.updateRGBDAsync(G,q,C)}))}return d._loaded.then((()=>d._babylonTexture))}}a(T),j(T,!0,(b=>new K(b)));P(12250);const k="EXT_mesh_gpu_instancing";class bb{constructor(b){this.name=k,this._loader=b,this.enabled=this._loader.isExtensionUsed(k)}dispose(){this._loader=null}loadNodeAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(b,G)=>{this._loader._disableInstancedMesh++;const i=this._loader.loadNodeAsync(`/nodes/${d.index}`,d,P);if(this._loader._disableInstancedMesh--,!d._primitiveBabylonMeshes)return await i;const q=new Array;let C=0;const J=d=>{if(void 0==G.attributes[d])return void q.push(Promise.resolve(null));const P=c.Get(`${b}/attributes/${d}`,this._loader.fd.accessors,G.attributes[d]);if(q.push(this._loader._loadFloatAccessorAsync(`/accessors/${P.bufferView}`,P)),0===C)C=P.count;else if(C!==P.count)throw new Error(`${b}/attributes: Instance buffer accessors do not have the same count.`)};return J("TRANSLATION"),J("ROTATION"),J("SCALE"),await i.then((async b=>{const[P,G,i]=await Promise.all(q),J=new Float32Array(16*C);W.TmpVectors.ed[0].Fd(0,0,0),W.TmpVectors.Quaternion[0].Fd(0,0,0,1),W.TmpVectors.ed[1].Fd(1,1,1);for(let d=0;d<C;++d)P&&W.ed.FromArrayToRef(P,3*d,W.TmpVectors.ed[0]),G&&W.Quaternion.FromArrayToRef(G,4*d,W.TmpVectors.Quaternion[0]),i&&W.ed.FromArrayToRef(i,3*d,W.TmpVectors.ed[1]),W.Matrix.ComposeToRef(W.TmpVectors.ed[1],W.TmpVectors.Quaternion[0],W.TmpVectors.ed[0],W.TmpVectors.Matrix[0]),W.TmpVectors.Matrix[0].copyToArray(J,16*d);for(const W of d._primitiveBabylonMeshes)W.ZY("matrix",J,16,!0);return b}))}))}}a(k),j(k,!0,(b=>new bb(b)));let db=0,Pb=null;class Gb{static get Default(){return Gb._Default||(Gb._Default=new Gb),Gb._Default}constructor(){const b=Gb.Configuration.decoder;this._decoderModulePromise=q.Tools.LoadBabylonScriptAsync(b.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(b,d,P,G,W){await this._decoderModulePromise,0===db&&(MeshoptDecoder.useWorkers(1),db=1);const i=await MeshoptDecoder.decodeGltfBufferAsync(d,P,b,G,W);return null!==Pb&&clearTimeout(Pb),Pb=setTimeout((()=>{MeshoptDecoder.useWorkers(0),db=0,Pb=null}),1e3),i}}Gb.Configuration={decoder:{url:`${q.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},Gb._Default=null;const Wb="EXT_meshopt_compression";class ib{constructor(b){this.name=Wb,this.enabled=b.isExtensionUsed(Wb),this._loader=b}dispose(){this._loader=null}loadBufferViewAsync(b,d){return z.LoadExtensionAsync(b,d,this.name,(async(P,G)=>{const W=d;if(W._meshOptData)return await W._meshOptData;const i=c.Get(`${b}/buffer`,this._loader.fd.buffers,G.buffer);return W._meshOptData=this._loader.loadBufferAsync(`/buffers/${i.index}`,i,G.byteOffset||0,G.byteLength).then((async b=>await Gb.Default.decodeGltfBufferAsync(b,G.count,G.byteStride,G.mode,G.filter))),await W._meshOptData}))}}a(Wb),j(Wb,!0,(b=>new ib(b)));const qb="EXT_texture_webp";class Cb{constructor(b){this.name=qb,this._loader=b,this.enabled=b.isExtensionUsed(qb)}dispose(){this._loader=null}_loadTextureAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>{const i=void 0==d.sampler?z.DefaultSampler:c.Get(`${b}/sampler`,this._loader.fd.samplers,d.sampler),q=c.Get(`${G}/source`,this._loader.fd.images,W.source);return await this._loader._createTextureAsync(b,i,q,(b=>{P(b)}),void 0,!d._textureInfo.nonColorData)}))}}a(qb),j(qb,!0,(b=>new Cb(b)));const Jb="EXT_texture_avif";class Lb{constructor(b){this.name=Jb,this._loader=b,this.enabled=b.isExtensionUsed(Jb)}dispose(){this._loader=null}_loadTextureAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>{const i=void 0==d.sampler?z.DefaultSampler:c.Get(`${b}/sampler`,this._loader.fd.samplers,d.sampler),q=c.Get(`${G}/source`,this._loader.fd.images,W.source);return await this._loader._createTextureAsync(b,i,q,(b=>{P(b)}),void 0,!d._textureInfo.nonColorData)}))}}a(Jb),j(Jb,!0,(b=>new Lb(b)));var xb=P(13320),Yb=P(12220);const sb="EXT_lights_ies";class Eb{constructor(b){this.name=sb,this._loader=b,this.enabled=this._loader.isExtensionUsed(sb)}dispose(){this._loader=null,delete this._lights}onLoading(){const b=this._loader.fd.extensions;if(b&&b[this.name]){const d=b[this.name];this._lights=d.lights,c.Assign(this._lights)}}loadNodeAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,q)=>{let C,J;this._loader._allMaterialsDirtyRequired=!0;const L=await this._loader.loadNodeAsync(b,d,(b=>{J=c.Get(G,this._lights,q.Ed);const d=J.name||b.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,C=new xb.e(d,W.ed.Zero(),W.ed.Backward(),0,1,this._loader.babylonScene),C.angle=Math.PI/2,C.innerAngle=0,C._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,J._babylonLight=C,C.falloffType=Yb.d.FALLOFF_GLTF,C.gC=q.color?i.Nd.Od(q.color):i.Nd.White(),C.fC=q.multiplier||1,C.range=Number.MAX_VALUE,C.parent=b,this._loader._babylonLights.push(C),z.AddPointerMetadata(C,G),P(b)}));let x;if(J.uri)x=await this._loader.loadUriAsync(b,J,J.uri);else{const d=c.Get(`${b}/bufferView`,this._loader.fd.bufferViews,J.bufferView);x=await this._loader.loadBufferViewAsync(`/bufferViews/${d.index}`,d)}return C.iesProfileTexture=new o.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,x,!0,void 0,void 0,void 0,void 0,".ies"),L}))}}a(sb),j(sb,!0,(b=>new Eb(b)));var wb=P(13343);const tb="KHR_draco_mesh_compression";class rb{constructor(b){this.name=tb,this.useNormalizedFlagFromAccessor=!0,this._loader=b,this.enabled=wb.e.DefaultAvailable&&this._loader.isExtensionUsed(tb)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>{if(void 0!=d.mode&&4!==d.mode&&5!==d.mode)throw new Error(`${b}: Unsupported mode ${d.mode}`);const i={},q={},C=(b,G)=>{const C=W.attributes[b];if(void 0!=C&&(P._delayInfo=P._delayInfo||[],-1===P._delayInfo.indexOf(G)&&P._delayInfo.push(G),i[G]=C,this.useNormalizedFlagFromAccessor)){const P=c.TryGet(this._loader.fd.accessors,d.attributes[b]);P&&(q[G]=P.normalized||!1)}};C("POSITION",f.c.PositionKind),C("NORMAL",f.c.NormalKind),C("TANGENT",f.c.TangentKind),C("TEXCOORD_0",f.c.UVKind),C("TEXCOORD_1",f.c.UV2Kind),C("TEXCOORD_2",f.c.UV3Kind),C("TEXCOORD_3",f.c.UV4Kind),C("TEXCOORD_4",f.c.UV5Kind),C("TEXCOORD_5",f.c.UV6Kind),C("JOINTS_0",f.c.MatricesIndicesKind),C("WEIGHTS_0",f.c.MatricesWeightsKind),C("COLOR_0",f.c.ColorKind);const J=c.Get(G,this._loader.fd.bufferViews,W.bufferView);return J._dracoBabylonGeometry||(J._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${J.index}`,J).then((async G=>{const W=this.dracoDecoder||wb.e.Default,C=c.TryGet(this._loader.fd.accessors,d.attributes.POSITION),J=this._loader.parent.alwaysComputeBoundingBox||P.skeleton||!C?null:D(C);return await W._decodeMeshToGeometryForGltfAsync(P.name,this._loader.babylonScene,G,i,q,J).catch((d=>{throw new Error(`${b}: ${d.message}`)}))}))),await J._dracoBabylonGeometry}))}}a(tb),j(tb,!0,(b=>new rb(b)));var Bb=P(13348),nb=P(11663),Zb=P(11670),ob=P(12111),Ab=P(12285),fb=P(11639);ob.c.AddNodeConstructor("Light_Type_0",((b,d)=>()=>new gb(b,W.ed.Zero(),d)));class gb extends Ab.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(b){this._shadowAngle=b,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(b){const d=this.needCube();if(this._direction=b,this.needCube()!==d&&this._shadowGenerators){const b=this._shadowGenerators.values();for(let d=b.next();!0!==d.done;d=b.next()){d.value.recreateShadowMap()}}}constructor(b,d,P){super(b,P),this._shadowAngle=Math.PI/2,this.position=d}getClassName(){return"PointLight"}getTypeID(){return Yb.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(b){if(this.direction)return super.getShadowDirection(b);switch(b){case 0:return new W.ed(1,0,0);case 1:return new W.ed(-1,0,0);case 2:return new W.ed(0,-1,0);case 3:return new W.ed(0,1,0);case 4:return new W.ed(0,0,1);case 5:return new W.ed(0,0,-1)}return W.ed.Zero()}_setDefaultShadowProjectionMatrix(b,d,P){const G=this.Xb().activeCamera;if(!G)return;const i=void 0!==this.shadowMinZ?this.shadowMinZ:G.Vd,q=void 0!==this.shadowMaxZ?this.shadowMaxZ:G.maxZ,C=this.Xb().getEngine().useReverseDepthBuffer;W.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,C?q:i,C?i:q,b,!0,this._scene.getEngine().isNDCHalfZRange,void 0,C)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(b,d){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,d):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,d),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,d),this}transferToNodeMaterialEffect(b,d){return this.computeTransformedInformation()?b.setFloat3(d,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):b.setFloat3(d,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(b,d){b["POINTLIGHT"+d]=!0}}(0,nb.d)([(0,Zb.G)()],gb.prototype,"shadowAngle",null),(0,fb.f)("BABYLON.PointLight",gb);const Xb="KHR_lights_punctual";class ub{constructor(b){this.name=Xb,this._loader=b,this.enabled=this._loader.isExtensionUsed(Xb)}dispose(){this._loader=null,delete this._lights}onLoading(){const b=this._loader.fd.extensions;if(b&&b[this.name]){const d=b[this.name];this._lights=d.lights,c.Assign(this._lights)}}loadNodeAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,q)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(b,d,(b=>{let d;const C=c.Get(G,this._lights,q.Ed),J=C.name||b.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,C.type){case"directional":{const b=new Bb.d(J,W.ed.Backward(),this._loader.babylonScene);b.position.kd(0),d=b;break}case"point":d=new gb(J,W.ed.Zero(),this._loader.babylonScene);break;case"spot":{const b=new xb.e(J,W.ed.Zero(),W.ed.Backward(),0,1,this._loader.babylonScene);b.angle=2*(C.spot&&C.spot.outerConeAngle||Math.PI/4),b.innerAngle=2*(C.spot&&C.spot.innerConeAngle||0),d=b;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${G}: Invalid light type (${C.type})`)}d._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,C._babylonLight=d,d.falloffType=Yb.d.FALLOFF_GLTF,d.gC=C.color?i.Nd.Od(C.color):i.Nd.White(),d.fC=void 0==C.fC?1:C.fC,d.range=void 0==C.range?Number.MAX_VALUE:C.range,d.parent=b,this._loader._babylonLights.push(d),z.AddPointerMetadata(d,G),P(b)})))))}}a(Xb),j(Xb,!0,(b=>new ub(b)));const Mb="KHR_materials_pbrSpecularGlossiness";class eb{constructor(b){this.name=Mb,this.order=200,this._loader=b,this.enabled=this._loader.isExtensionUsed(Mb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>{const i=new Array;return i.push(this._loader.loadMaterialBasePropertiesAsync(b,d,P)),i.push(this._loadSpecularGlossinessPropertiesAsync(G,W,P)),this._loader.loadMaterialAlphaProperties(b,d,P),await Promise.all(i).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(b,d,P){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);const G=new Array;return P.metallic=null,P.roughness=null,d.diffuseFactor?(P.albedoColor=i.Nd.Od(d.diffuseFactor),P.alpha=d.diffuseFactor[3]):P.albedoColor=i.Nd.White(),P.reflectivityColor=d.specularFactor?i.Nd.Od(d.specularFactor):i.Nd.White(),P.microSurface=void 0==d.glossinessFactor?1:d.glossinessFactor,d.diffuseTexture&&G.push(this._loader.loadTextureInfoAsync(`${b}/diffuseTexture`,d.diffuseTexture,(b=>{b.name=`${P.name} (Diffuse)`,P.albedoTexture=b}))),d.specularGlossinessTexture&&(G.push(this._loader.loadTextureInfoAsync(`${b}/specularGlossinessTexture`,d.specularGlossinessTexture,(b=>{b.name=`${P.name} (Specular Glossiness)`,P.reflectivityTexture=b,P.reflectivityTexture.ad=!0}))),P.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(G).then((()=>{}))}}a(Mb),j(Mb,!0,(b=>new eb(b)));const Rb="KHR_materials_unlit";class Ub{constructor(b){this.name=Rb,this.order=210,this._loader=b,this.enabled=this._loader.isExtensionUsed(Rb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async()=>await this._loadUnlitPropertiesAsync(b,d,P)))}_loadUnlitPropertiesAsync(b,d,P){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);const G=new Array;P.unlit=!0;const W=d.pbrMetallicRoughness;return W&&(W.baseColorFactor?(P.albedoColor=i.Nd.Od(W.baseColorFactor),P.alpha=W.baseColorFactor[3]):P.albedoColor=i.Nd.White(),W.baseColorTexture&&G.push(this._loader.loadTextureInfoAsync(`${b}/baseColorTexture`,W.baseColorTexture,(b=>{b.name=`${P.name} (Base Color)`,P.albedoTexture=b})))),d.doubleSided&&(P.md=!1,P.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(b,d,P),Promise.all(G).then((()=>{}))}}a(Rb),j(Rb,!0,(b=>new Ub(b)));const Hb="KHR_materials_clearcoat";class pb{constructor(b){this.name=Hb,this.order=190,this._loader=b,this.enabled=this._loader.isExtensionUsed(Hb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>{const i=new Array;i.push(this._loader.loadMaterialPropertiesAsync(b,d,P)),i.push(this._loadClearCoatPropertiesAsync(G,W,P)),await Promise.all(i)}))}_loadClearCoatPropertiesAsync(b,d,P){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);const G=new Array;return P.clearCoat.isEnabled=!0,P.clearCoat.useRoughnessFromMainTexture=!1,P.clearCoat.remapF0OnInterfaceChange=!1,void 0!=d.clearcoatFactor?P.clearCoat.fC=d.clearcoatFactor:P.clearCoat.fC=0,d.clearcoatTexture&&G.push(this._loader.loadTextureInfoAsync(`${b}/clearcoatTexture`,d.clearcoatTexture,(b=>{b.name=`${P.name} (ClearCoat)`,P.clearCoat.texture=b}))),void 0!=d.clearcoatRoughnessFactor?P.clearCoat.roughness=d.clearcoatRoughnessFactor:P.clearCoat.roughness=0,d.clearcoatRoughnessTexture&&(d.clearcoatRoughnessTexture.nonColorData=!0,G.push(this._loader.loadTextureInfoAsync(`${b}/clearcoatRoughnessTexture`,d.clearcoatRoughnessTexture,(b=>{b.name=`${P.name} (ClearCoat Roughness)`,P.clearCoat.textureRoughness=b})))),d.clearcoatNormalTexture&&(d.clearcoatNormalTexture.nonColorData=!0,G.push(this._loader.loadTextureInfoAsync(`${b}/clearcoatNormalTexture`,d.clearcoatNormalTexture,(b=>{b.name=`${P.name} (ClearCoat Normal)`,P.clearCoat.bumpTexture=b}))),P.invertNormalMapX=!P.Xb().useRightHandedSystem,P.invertNormalMapY=P.Xb().useRightHandedSystem,void 0!=d.clearcoatNormalTexture.scale&&(P.clearCoat.bumpTexture.level=d.clearcoatNormalTexture.scale)),Promise.all(G).then((()=>{}))}}a(Hb),j(Hb,!0,(b=>new pb(b)));const Sb="KHR_materials_iridescence";class lb{constructor(b){this.name=Sb,this.order=195,this._loader=b,this.enabled=this._loader.isExtensionUsed(Sb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(b,d,P)),i.push(this._loadIridescencePropertiesAsync(G,W,P)),await Promise.all(i).then((()=>{}))}))}_loadIridescencePropertiesAsync(b,d,P){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);const G=new Array;return P.iridescence.isEnabled=!0,P.iridescence.fC=d.iridescenceFactor??0,P.iridescence.indexOfRefraction=d.iridescenceIor??d.iridescenceIOR??1.3,P.iridescence.minimumThickness=d.iridescenceThicknessMinimum??100,P.iridescence.maximumThickness=d.iridescenceThicknessMaximum??400,d.iridescenceTexture&&G.push(this._loader.loadTextureInfoAsync(`${b}/iridescenceTexture`,d.iridescenceTexture,(b=>{b.name=`${P.name} (Iridescence)`,P.iridescence.texture=b}))),d.iridescenceThicknessTexture&&G.push(this._loader.loadTextureInfoAsync(`${b}/iridescenceThicknessTexture`,d.iridescenceThicknessTexture,(b=>{b.name=`${P.name} (Iridescence Thickness)`,P.iridescence.thicknessTexture=b}))),Promise.all(G).then((()=>{}))}}a(Sb),j(Sb,!0,(b=>new lb(b)));const Nb="KHR_materials_anisotropy";class jb{constructor(b){this.name=Nb,this.order=195,this._loader=b,this.enabled=this._loader.isExtensionUsed(Nb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>{const i=new Array;i.push(this._loader.loadMaterialPropertiesAsync(b,d,P)),i.push(this._loadIridescencePropertiesAsync(G,W,P)),await Promise.all(i)}))}async _loadIridescencePropertiesAsync(b,d,P){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);const G=new Array;P.anisotropy.isEnabled=!0,P.anisotropy.fC=d.anisotropyStrength??0,P.anisotropy.angle=d.anisotropyRotation??0,d.anisotropyTexture&&(d.anisotropyTexture.nonColorData=!0,G.push(this._loader.loadTextureInfoAsync(`${b}/anisotropyTexture`,d.anisotropyTexture,(b=>{b.name=`${P.name} (Anisotropy Intensity)`,P.anisotropy.texture=b})))),await Promise.all(G)}}a(Nb),j(Nb,!0,(b=>new jb(b)));const ab="KHR_materials_emissive_strength";class Ob{constructor(b){this.name=ab,this.order=170,this._loader=b,this.enabled=this._loader.isExtensionUsed(ab)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>await this._loader.loadMaterialPropertiesAsync(b,d,P).then((()=>{this._loadEmissiveProperties(G,W,P)}))))}_loadEmissiveProperties(b,d,P){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);void 0!==d.emissiveStrength&&(P.emissiveIntensity=d.emissiveStrength)}}a(ab),j(ab,!0,(b=>new Ob(b)));const Vb="KHR_materials_sheen";class yb{constructor(b){this.name=Vb,this.order=190,this._loader=b,this.enabled=this._loader.isExtensionUsed(Vb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(b,d,P)),i.push(this._loadSheenPropertiesAsync(G,W,P)),await Promise.all(i).then((()=>{}))}))}_loadSheenPropertiesAsync(b,d,P){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);const G=new Array;return P.sheen.isEnabled=!0,P.sheen.fC=1,void 0!=d.sheenColorFactor?P.sheen.color=i.Nd.Od(d.sheenColorFactor):P.sheen.color=i.Nd.Black(),d.sheenColorTexture&&G.push(this._loader.loadTextureInfoAsync(`${b}/sheenColorTexture`,d.sheenColorTexture,(b=>{b.name=`${P.name} (Sheen Color)`,P.sheen.texture=b}))),void 0!==d.sheenRoughnessFactor?P.sheen.roughness=d.sheenRoughnessFactor:P.sheen.roughness=0,d.sheenRoughnessTexture&&(d.sheenRoughnessTexture.nonColorData=!0,G.push(this._loader.loadTextureInfoAsync(`${b}/sheenRoughnessTexture`,d.sheenRoughnessTexture,(b=>{b.name=`${P.name} (Sheen Roughness)`,P.sheen.textureRoughness=b})))),P.sheen.albedoScaling=!0,P.sheen.useRoughnessFromMainTexture=!1,Promise.all(G).then((()=>{}))}}a(Vb),j(Vb,!0,(b=>new yb(b)));var cb=P(12163);const Db="KHR_materials_specular";class zb{constructor(b){this.name=Db,this.order=190,this._loader=b,this.enabled=this._loader.isExtensionUsed(Db)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>{const i=new Array;if(i.push(this._loader.loadMaterialPropertiesAsync(b,d,P)),i.push(this._loadSpecularPropertiesAsync(G,W,P)),W.extensions&&W.extensions.EXT_materials_specular_edge_color&&P instanceof Z.d){W.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(P.brdf.dielectricSpecularModel=cb.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,P.brdf.conductorSpecularModel=cb.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(i).then((()=>{}))}))}_loadSpecularPropertiesAsync(b,d,P){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);const G=new Array;return void 0!==d.specularFactor&&(P.metallicF0Factor=d.specularFactor),void 0!==d.specularColorFactor&&(P.metallicReflectanceColor=i.Nd.Od(d.specularColorFactor)),d.specularTexture&&(d.specularTexture.nonColorData=!0,G.push(this._loader.loadTextureInfoAsync(`${b}/specularTexture`,d.specularTexture,(b=>{b.name=`${P.name} (Specular)`,P.metallicReflectanceTexture=b,P.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),d.specularColorTexture&&G.push(this._loader.loadTextureInfoAsync(`${b}/specularColorTexture`,d.specularColorTexture,(b=>{b.name=`${P.name} (Specular Color)`,P.reflectanceTexture=b}))),Promise.all(G).then((()=>{}))}}a(Db),j(Db,!0,(b=>new zb(b)));const Qb="KHR_materials_ior";class Ib{constructor(b){this.name=Qb,this.order=180,this._loader=b,this.enabled=this._loader.isExtensionUsed(Qb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(b,d,P)),i.push(this._loadIorPropertiesAsync(G,W,P)),await Promise.all(i).then((()=>{}))}))}_loadIorPropertiesAsync(b,d,P){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);return void 0!==d.ior?P.indexOfRefraction=d.ior:P.indexOfRefraction=Ib._DEFAULT_IOR,Promise.resolve()}}Ib._DEFAULT_IOR=1.5,a(Qb),j(Qb,!0,(b=>new Ib(b)));const mb="KHR_materials_variants";class vb{constructor(b){this.name=mb,this._loader=b,this.enabled=this._loader.isExtensionUsed(mb)}dispose(){this._loader=null}static GetAvailableVariants(b){const d=this._GetExtensionMetadata(b);return d?Object.keys(d.variants):[]}getAvailableVariants(b){return vb.GetAvailableVariants(b)}static SelectVariant(b,d){const P=this._GetExtensionMetadata(b);if(!P)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${mb} extension`);const G=b=>{const d=P.variants[b];if(d)for(const P of d)P.mesh.material=P.material};if(d instanceof Array)for(const W of d)G(W);else G(d);P.lastSelected=d}selectVariant(b,d){vb.SelectVariant(b,d)}static Reset(b){const d=this._GetExtensionMetadata(b);if(!d)throw new Error(`Cannot reset on a glTF mesh that does not have the ${mb} extension`);for(const P of d.original)P.mesh.material=P.material;d.lastSelected=null}reset(b){vb.Reset(b)}static GetLastSelectedVariant(b){const d=this._GetExtensionMetadata(b);if(!d)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${mb} extension`);return d.lastSelected}getLastSelectedVariant(b){return vb.GetLastSelectedVariant(b)}static _GetExtensionMetadata(b){var d,P;return(null===b||void 0===b||null===(d=b._internalMetadata)||void 0===d||null===(P=d.fd)||void 0===P?void 0:P[mb])||null}onLoading(){const b=this._loader.fd.extensions;if(b&&b[this.name]){const d=b[this.name];this._variants=d.variants}}onReady(){const b=this._loader.rootBabylonMesh;if(b){var d;const P=this._loader.parent.extensionOptions[mb];null!==P&&void 0!==P&&P.defaultVariant&&vb.SelectVariant(b,P.defaultVariant),null===P||void 0===P||null===(d=P.onLoaded)||void 0===d||d.call(P,{get variants(){return vb.GetAvailableVariants(b)},get selectedVariant(){const d=vb.GetLastSelectedVariant(b);return d?Array.isArray(d)?d[0]:d:vb.GetAvailableVariants(b)[0]},set selectedVariant(d){vb.SelectVariant(b,d)}})}}_loadMeshPrimitiveAsync(b,d,P,G,W,i){return z.LoadExtensionAsync(b,W,this.name,(async(q,C)=>{const J=new Array;return J.push(this._loader._loadMeshPrimitiveAsync(b,d,P,G,W,(d=>{if(i(d),d instanceof u.d){const P=z._GetDrawMode(b,W.mode),G=this._loader.rootBabylonMesh,i=G?G._internalMetadata=G._internalMetadata||{}:{},L=i.fd=i.fd||{},x=L[mb]=L[mb]||{lastSelected:null,original:[],variants:{}};x.original.push({mesh:d,material:d.material});for(let b=0;b<C.mappings.length;++b){const W=C.mappings[b],i=c.Get(`${q}/mappings/${b}/material`,this._loader.fd.materials,W.material);J.push(this._loader._loadMaterialAsync(`#/materials/${W.material}`,i,d,P,(b=>{for(let P=0;P<W.variants.length;++P){const i=W.variants[P],q=c.Get(`/extensions/${mb}/variants/${i}`,this._variants,i);x.variants[q.name]=x.variants[q.name]||[],x.variants[q.name].push({mesh:d,material:b}),d.onClonedObservable.add((b=>{const P=b;let W=null,i=P;do{if(i=i.parent,!i)return;W=vb._GetExtensionMetadata(i)}while(null===W);if(G&&W===vb._GetExtensionMetadata(G)){i._internalMetadata={};for(const b in G._internalMetadata)i._internalMetadata[b]=G._internalMetadata[b];i._internalMetadata.fd=[];for(const b in G._internalMetadata.fd)i._internalMetadata.fd[b]=G._internalMetadata.fd[b];i._internalMetadata.fd[mb]={lastSelected:null,original:[],variants:{}};for(const b of W.original)i._internalMetadata.fd[mb].original.push({mesh:b.mesh,material:b.material});for(const b in W.variants)if(Object.prototype.hasOwnProperty.call(W.variants,b)){i._internalMetadata.fd[mb].variants[b]=[];for(const d of W.variants[b])i._internalMetadata.fd[mb].variants[b].push({mesh:d.mesh,material:d.material})}W=i._internalMetadata.fd[mb]}for(const G of W.original)G.mesh===d&&(G.mesh=P);for(const G of W.variants[q.name])G.mesh===d&&(G.mesh=P)}))}})))}}}))),await Promise.all(J).then((b=>{let[d]=b;return d}))}))}}a(mb),j(mb,!0,(b=>new vb(b)));var Fb=P(11744);class hb{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:cb.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(b,d){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...hb._GetDefaultOptions(),...b},this._scene=d,this._scene._transmissionHelper=this,this.onErrorObservable=new x.d,this._scene.Zd.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(b){if(!Object.keys(b).filter((d=>this._options[d]!==b[d])).length)return;const d={...this._options,...b},P=this._options;this._options=d,d.renderSize===P.renderSize&&d.renderTargetTextureType===P.renderTargetTextureType&&d.generateMipmaps===P.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=d.samples,this._opaqueRenderTarget.lodGenerationScale=d.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=d.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(b){return!!b&&!!(b instanceof Z.d&&b.subSurface.isRefractionEnabled)}_addMesh(b){this._materialObservers[b.uniqueId]=b.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),q.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(b.material)?(b.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(b)&&this._transparentMeshesCache.push(b)):-1===this._opaqueMeshesCache.indexOf(b)&&this._opaqueMeshesCache.push(b)}))}_removeMesh(b){b.onMaterialChangedObservable.remove(this._materialObservers[b.uniqueId]),delete this._materialObservers[b.uniqueId];let d=this._transparentMeshesCache.indexOf(b);-1!==d&&this._transparentMeshesCache.splice(d,1),d=this._opaqueMeshesCache.indexOf(b),-1!==d&&this._opaqueMeshesCache.splice(d,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(b){const d=this._transparentMeshesCache.indexOf(b),P=this._opaqueMeshesCache.indexOf(b);this._shouldRenderAsTransmission(b.material)?(b.material instanceof Z.d&&(b.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==P?(this._opaqueMeshesCache.splice(P,1),this._transparentMeshesCache.push(b)):-1===d&&this._transparentMeshesCache.push(b)):-1!==d?(this._transparentMeshesCache.splice(d,1),this._opaqueMeshesCache.push(b)):-1===P&&this._opaqueMeshesCache.push(b)}_isRenderTargetValid(){var b;return null!==(null===(b=this._opaqueRenderTarget)||void 0===b?void 0:b.getInternalTexture())}_setupRenderTargets(){var b;let d;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new Fb.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(b=this._options.clearColor)||void 0===b?void 0:b.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((b=>{d=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?b.clearColor.q(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(b.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=d}));for(const P of this._transparentMeshesCache)this._shouldRenderAsTransmission(P.material)&&(P.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Tb="KHR_materials_transmission";class Kb{constructor(b){this.name=Tb,this.order=175,this._loader=b,this.enabled=this._loader.isExtensionUsed(Tb),this.enabled&&(b.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(b,d,P)),i.push(this._loadTransparentPropertiesAsync(G,d,P,W)),await Promise.all(i).then((()=>{}))}))}_loadTransparentPropertiesAsync(b,d,P,G){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);const W=P;if(W.subSurface.isRefractionEnabled=!0,W.subSurface.volumeIndexOfRefraction=1,W.subSurface.useAlbedoToTintRefraction=!0,void 0===G.transmissionFactor)return W.subSurface.refractionIntensity=0,W.subSurface.isRefractionEnabled=!1,Promise.resolve();{var i;W.subSurface.refractionIntensity=G.transmissionFactor;const b=W.Xb();if(W.subSurface.refractionIntensity&&!b._transmissionHelper)new hb({},W.Xb());else if(W.subSurface.refractionIntensity&&(null===(i=b._transmissionHelper)||void 0===i||!i._isRenderTargetValid())){var q;null===(q=b._transmissionHelper)||void 0===q||q._setupRenderTargets()}}return W.subSurface.minimumThickness=0,W.subSurface.maximumThickness=0,G.transmissionTexture?(G.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${b}/transmissionTexture`,G.transmissionTexture,void 0).then((b=>{b.name=`${P.name} (Transmission)`,W.subSurface.refractionIntensityTexture=b,W.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}a(Tb),j(Tb,!0,(b=>new Kb(b)));const kb="KHR_materials_diffuse_transmission";class bd{constructor(b){this.name=kb,this.order=174,this._loader=b,this.enabled=this._loader.isExtensionUsed(kb),this.enabled&&(b.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(b,d,P)),i.push(this._loadTranslucentPropertiesAsync(G,d,P,W)),await Promise.all(i).then((()=>{}))}))}_loadTranslucentPropertiesAsync(b,d,P,G){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);const W=P;if(W.subSurface.isTranslucencyEnabled=!0,W.subSurface.volumeIndexOfRefraction=1,W.subSurface.minimumThickness=0,W.subSurface.maximumThickness=0,W.subSurface.useAlbedoToTintTranslucency=!1,void 0===G.diffuseTransmissionFactor)return W.subSurface.translucencyIntensity=0,W.subSurface.isTranslucencyEnabled=!1,Promise.resolve();W.subSurface.translucencyIntensity=G.diffuseTransmissionFactor;const q=new Array;return W.subSurface.useGltfStyleTextures=!0,G.diffuseTransmissionTexture&&(G.diffuseTransmissionTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${b}/diffuseTransmissionTexture`,G.diffuseTransmissionTexture).then((b=>{b.name=`${P.name} (Diffuse Transmission)`,W.subSurface.translucencyIntensityTexture=b})))),void 0!==G.diffuseTransmissionColorFactor?W.subSurface.translucencyColor=i.Nd.Od(G.diffuseTransmissionColorFactor):W.subSurface.translucencyColor=i.Nd.White(),G.diffuseTransmissionColorTexture&&q.push(this._loader.loadTextureInfoAsync(`${b}/diffuseTransmissionColorTexture`,G.diffuseTransmissionColorTexture).then((b=>{b.name=`${P.name} (Diffuse Transmission Color)`,W.subSurface.translucencyColorTexture=b}))),Promise.all(q).then((()=>{}))}}a(kb),j(kb,!0,(b=>new bd(b)));const dd="KHR_materials_volume";class Pd{constructor(b){this.name=dd,this.order=173,this._loader=b,this.enabled=this._loader.isExtensionUsed(dd),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(b,d,P)),i.push(this._loadVolumePropertiesAsync(G,d,P,W)),await Promise.all(i).then((()=>{}))}))}_loadVolumePropertiesAsync(b,d,P,G){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);if(!P.subSurface.isRefractionEnabled&&!P.subSurface.isTranslucencyEnabled||!G.thicknessFactor)return Promise.resolve();P.subSurface.volumeIndexOfRefraction=P.indexOfRefraction;const W=void 0!==G.attenuationDistance?G.attenuationDistance:Number.MAX_VALUE;return P.subSurface.tintColorAtDistance=W,void 0!==G.attenuationColor&&3==G.attenuationColor.length&&P.subSurface.tintColor.Fd(G.attenuationColor[0],G.attenuationColor[1],G.attenuationColor[2]),P.subSurface.minimumThickness=0,P.subSurface.maximumThickness=G.thicknessFactor,P.subSurface.useThicknessAsDepth=!0,G.thicknessTexture?(G.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${b}/thicknessTexture`,G.thicknessTexture).then((b=>{b.name=`${P.name} (Thickness)`,P.subSurface.thicknessTexture=b,P.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}a(dd),j(dd,!0,(b=>new Pd(b)));const Gd="KHR_materials_dispersion";class Wd{constructor(b){this.name=Gd,this.order=174,this._loader=b,this.enabled=this._loader.isExtensionUsed(Gd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(b,d,P)),i.push(this._loadDispersionPropertiesAsync(G,d,P,W)),await Promise.all(i).then((()=>{}))}))}_loadDispersionPropertiesAsync(b,d,P,G){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);return P.subSurface.isRefractionEnabled&&G.dispersion?(P.subSurface.isDispersionEnabled=!0,P.subSurface.dispersion=G.dispersion,Promise.resolve()):Promise.resolve()}}a(Gd),j(Gd,!0,(b=>new Wd(b)));const id="EXT_materials_diffuse_roughness";class qd{constructor(b){this.name=id,this.order=190,this._loader=b,this.enabled=this._loader.isExtensionUsed(id)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>{const i=new Array;return i.push(this._loader.loadMaterialPropertiesAsync(b,d,P)),i.push(this._loadDiffuseRoughnessPropertiesAsync(G,W,P)),await Promise.all(i).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(b,d,P){if(!(P instanceof Z.d))throw new Error(`${b}: Material type not supported`);const G=new Array;return P.brdf.baseDiffuseModel=cb.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=d.diffuseRoughnessFactor?P.baseDiffuseRoughness=d.diffuseRoughnessFactor:P.baseDiffuseRoughness=0,d.diffuseRoughnessTexture&&G.push(this._loader.loadTextureInfoAsync(`${b}/diffuseRoughnessTexture`,d.diffuseRoughnessTexture,(b=>{b.name=`${P.name} (Diffuse Roughness)`,P.baseDiffuseRoughnessTexture=b}))),Promise.all(G).then((()=>{}))}}a(id),j(id,!0,(b=>new qd(b)));const Cd="KHR_mesh_quantization";class Jd{constructor(b){this.name=Cd,this.enabled=b.isExtensionUsed(Cd)}dispose(){}}a(Cd),j(Cd,!0,(b=>new Jd(b)));const Ld="KHR_texture_basisu";class xd{constructor(b){this.name=Ld,this._loader=b,this.enabled=b.isExtensionUsed(Ld)}dispose(){this._loader=null}_loadTextureAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>{const i=void 0==d.sampler?z.DefaultSampler:c.Get(`${b}/sampler`,this._loader.fd.samplers,d.sampler),q=c.Get(`${G}/source`,this._loader.fd.images,W.source);return await this._loader._createTextureAsync(b,i,q,(b=>{P(b)}),d._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!d._textureInfo.nonColorData)}))}}a(Ld),j(Ld,!0,(b=>new xd(b)));const Yd="KHR_texture_transform";class sd{constructor(b){this.name=Yd,this._loader=b,this.enabled=this._loader.isExtensionUsed(Yd)}dispose(){this._loader=null}loadTextureInfoAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(G,W)=>await this._loader.loadTextureInfoAsync(b,d,(b=>{if(!(b instanceof o.d))throw new Error(`${G}: Texture type not supported`);W.offset&&(b.uOffset=W.offset[0],b.vOffset=W.offset[1]),b.uRotationCenter=0,b.vRotationCenter=0,W.rotation&&(b.wAng=-W.rotation),W.scale&&(b.uScale=W.scale[0],b.vScale=W.scale[1]),void 0!=W.texCoord&&(b.coordinatesIndex=W.texCoord),P(b)}))))}}a(Yd),j(Yd,!0,(b=>new sd(b)));const Ed="KHR_xmp_json_ld";class wd{constructor(b){this.name=Ed,this.order=100,this._loader=b,this.enabled=this._loader.isExtensionUsed(Ed)}dispose(){this._loader=null}onLoading(){var b,d,P;if(null===this._loader.rootBabylonMesh)return;const G=null===(b=this._loader.fd.extensions)||void 0===b?void 0:b.KHR_xmp_json_ld,W=null===(d=this._loader.fd.asset)||void 0===d||null===(P=d.extensions)||void 0===P?void 0:P.KHR_xmp_json_ld;if(G&&W){const b=+W.packet;G.packets&&b<G.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=G.packets[b])}}}function td(b,d,P,G){return i.Nd.Od(d,P).scale(G)}function rd(b,d,P,G){return d[P]*G}function Bd(b,d,P,G){return-d[P]*G}function nd(b,d,P,G){return d[P+1]*G}function Zd(b,d,P,G){return d[P]*G*2}function od(b){return{scale:[new fd(s.b.ANIMATIONTYPE_FLOAT,`${b}.uScale`,rd,(()=>2)),new fd(s.b.ANIMATIONTYPE_FLOAT,`${b}.vScale`,nd,(()=>2))],offset:[new fd(s.b.ANIMATIONTYPE_FLOAT,`${b}.uOffset`,rd,(()=>2)),new fd(s.b.ANIMATIONTYPE_FLOAT,`${b}.vOffset`,nd,(()=>2))],rotation:[new fd(s.b.ANIMATIONTYPE_FLOAT,`${b}.wAng`,Bd,(()=>1))]}}a(Ed),j(Ed,!0,(b=>new wd(b)));class Ad extends Q.AnimationPropertyInfo{buildAnimations(b,d,P,G){return[{babylonAnimatable:b._babylonCamera,babylonAnimation:this._buildAnimation(d,P,G)}]}}class fd extends Q.AnimationPropertyInfo{buildAnimations(b,d,P,G){const W=[];for(const i in b._data)W.push({babylonAnimatable:b._data[i].babylonMaterial,babylonAnimation:this._buildAnimation(d,P,G)});return W}}class gd extends Q.AnimationPropertyInfo{buildAnimations(b,d,P,G){return[{babylonAnimatable:b._babylonLight,babylonAnimation:this._buildAnimation(d,P,G)}]}}(0,O.j)("/cameras/{}/orthographic/xmag",[new Ad(s.b.ANIMATIONTYPE_FLOAT,"orthoLeft",Bd,(()=>1)),new Ad(s.b.ANIMATIONTYPE_FLOAT,"orthoRight",nd,(()=>1))]),(0,O.j)("/cameras/{}/orthographic/ymag",[new Ad(s.b.ANIMATIONTYPE_FLOAT,"orthoBottom",Bd,(()=>1)),new Ad(s.b.ANIMATIONTYPE_FLOAT,"orthoTop",nd,(()=>1))]),(0,O.j)("/cameras/{}/orthographic/zfar",[new Ad(s.b.ANIMATIONTYPE_FLOAT,"maxZ",rd,(()=>1))]),(0,O.j)("/cameras/{}/orthographic/znear",[new Ad(s.b.ANIMATIONTYPE_FLOAT,"Vd",rd,(()=>1))]),(0,O.j)("/cameras/{}/perspective/yfov",[new Ad(s.b.ANIMATIONTYPE_FLOAT,"fov",rd,(()=>1))]),(0,O.j)("/cameras/{}/perspective/zfar",[new Ad(s.b.ANIMATIONTYPE_FLOAT,"maxZ",rd,(()=>1))]),(0,O.j)("/cameras/{}/perspective/znear",[new Ad(s.b.ANIMATIONTYPE_FLOAT,"Vd",rd,(()=>1))]),(0,O.j)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new fd(s.b.ANIMATIONTYPE_COLOR3,"albedoColor",td,(()=>4)),new fd(s.b.ANIMATIONTYPE_FLOAT,"alpha",(function(b,d,P,G){return d[P+3]*G}),(()=>4))]),(0,O.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new fd(s.b.ANIMATIONTYPE_FLOAT,"metallic",rd,(()=>1))]),(0,O.j)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new fd(s.b.ANIMATIONTYPE_FLOAT,"roughness",rd,(()=>1))]);const Xd=od("albedoTexture");(0,O.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Xd.scale),(0,O.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Xd.offset),(0,O.j)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Xd.rotation);const ud=od("metallicTexture");(0,O.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",ud.scale),(0,O.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",ud.offset),(0,O.j)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",ud.rotation),(0,O.j)("/materials/{}/emissiveFactor",[new fd(s.b.ANIMATIONTYPE_COLOR3,"emissiveColor",td,(()=>3))]);const Md=od("bumpTexture");(0,O.j)("/materials/{}/normalTexture/scale",[new fd(s.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",rd,(()=>1))]),(0,O.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Md.scale),(0,O.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Md.offset),(0,O.j)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Md.rotation),(0,O.j)("/materials/{}/occlusionTexture/strength",[new fd(s.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",rd,(()=>1))]);const ed=od("ambientTexture");(0,O.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",ed.scale),(0,O.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",ed.offset),(0,O.j)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",ed.rotation);const Rd=od("emissiveTexture");(0,O.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Rd.scale),(0,O.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Rd.offset),(0,O.j)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Rd.rotation),(0,O.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new fd(s.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",rd,(()=>1))]),(0,O.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new fd(s.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",rd,(()=>1))]);const Ud=od("anisotropy.texture");(0,O.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Ud.scale),(0,O.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Ud.offset),(0,O.j)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Ud.rotation),(0,O.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new fd(s.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",rd,(()=>1))]),(0,O.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new fd(s.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",rd,(()=>1))]);const Hd=od("clearCoat.texture");(0,O.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Hd.scale),(0,O.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Hd.offset),(0,O.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Hd.rotation);const pd=od("clearCoat.bumpTexture");(0,O.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new fd(s.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",rd,(()=>1))]),(0,O.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",pd.scale),(0,O.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",pd.offset),(0,O.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",pd.rotation);const Sd=od("clearCoat.textureRoughness");(0,O.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Sd.scale),(0,O.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Sd.offset),(0,O.j)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Sd.rotation),(0,O.j)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new fd(s.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",rd,(()=>1))]),(0,O.j)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new fd(s.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",rd,(()=>1))]),(0,O.j)("/materials/{}/extensions/KHR_materials_ior/ior",[new fd(s.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",rd,(()=>1))]),(0,O.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new fd(s.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",rd,(()=>1))]),(0,O.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new fd(s.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",rd,(()=>1))]),(0,O.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new fd(s.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",rd,(()=>1))]),(0,O.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new fd(s.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",rd,(()=>1))]);const ld=od("iridescence.texture");(0,O.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",ld.scale),(0,O.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",ld.offset),(0,O.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",ld.rotation);const Nd=od("iridescence.thicknessTexture");(0,O.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Nd.scale),(0,O.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Nd.offset),(0,O.j)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Nd.rotation),(0,O.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new fd(s.b.ANIMATIONTYPE_COLOR3,"sheen.color",td,(()=>3))]),(0,O.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new fd(s.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",rd,(()=>1))]);const jd=od("sheen.texture");(0,O.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",jd.scale),(0,O.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",jd.offset),(0,O.j)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",jd.rotation);const ad=od("sheen.textureRoughness");(0,O.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",ad.scale),(0,O.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",ad.offset),(0,O.j)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",ad.rotation),(0,O.j)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new fd(s.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",rd,(()=>1))]),(0,O.j)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new fd(s.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",td,(()=>3))]);const Od=od("metallicReflectanceTexture");(0,O.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Od.scale),(0,O.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Od.offset),(0,O.j)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Od.rotation);const Vd=od("reflectanceTexture");(0,O.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Vd.scale),(0,O.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Vd.offset),(0,O.j)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Vd.rotation),(0,O.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new fd(s.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",rd,(()=>1))]);const yd=od("subSurface.refractionIntensityTexture");(0,O.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",yd.scale),(0,O.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",yd.offset),(0,O.j)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",yd.rotation),(0,O.j)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new fd(s.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",td,(()=>3))]),(0,O.j)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new fd(s.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",rd,(()=>1))]),(0,O.j)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new fd(s.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",rd,(()=>1))]);const cd=od("subSurface.thicknessTexture");(0,O.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",cd.scale),(0,O.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",cd.offset),(0,O.j)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",cd.rotation),(0,O.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new fd(s.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",rd,(()=>1))]);const Dd=od("subSurface.translucencyIntensityTexture");(0,O.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Dd.scale),(0,O.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Dd.offset),(0,O.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Dd.rotation),(0,O.j)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new fd(s.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",td,(()=>3))]);const zd=od("subSurface.translucencyColorTexture");(0,O.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",zd.scale),(0,O.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",zd.offset),(0,O.j)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",zd.rotation),(0,O.j)("/extensions/KHR_lights_punctual/lights/{}/color",[new gd(s.b.ANIMATIONTYPE_COLOR3,"diffuse",td,(()=>3))]),(0,O.j)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new gd(s.b.ANIMATIONTYPE_FLOAT,"intensity",rd,(()=>1))]),(0,O.j)("/extensions/KHR_lights_punctual/lights/{}/range",[new gd(s.b.ANIMATIONTYPE_FLOAT,"range",rd,(()=>1))]),(0,O.j)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new gd(s.b.ANIMATIONTYPE_FLOAT,"innerAngle",Zd,(()=>1))]),(0,O.j)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new gd(s.b.ANIMATIONTYPE_FLOAT,"angle",Zd,(()=>1))]),(0,O.j)("/nodes/{}/extensions/EXT_lights_ies/color",[new gd(s.b.ANIMATIONTYPE_COLOR3,"diffuse",td,(()=>3))]),(0,O.j)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new gd(s.b.ANIMATIONTYPE_FLOAT,"intensity",rd,(()=>1))]);const Qd="KHR_animation_pointer";class Id{constructor(b){this.name=Qd,this._loader=b,this._pathToObjectConverter=(0,O.h)(this._loader.fd)}get enabled(){return this._loader.isExtensionUsed(Qd)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(b,d,P,G,W){var i;const q=null===(i=G.target.extensions)||void 0===i?void 0:i.KHR_animation_pointer;if(!q||!this._pathToObjectConverter)return null;"pointer"!==G.target.path&&t.e.Warn(`${b}/target/path: Value (${G.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=G.target.node&&t.e.Warn(`${b}/target/node: Value (${G.target.node}) must not be present when using the ${this.name} extension`);const C=`${b}/extensions/${this.name}`,J=q.pointer;if(!J)throw new Error(`${C}: Pointer is missing`);try{const i=this._pathToObjectConverter.convert(J);if(!i.info.interpolation)throw new Error(`${C}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(b,d,P,G,{object:i.object,info:i.info.interpolation},W)}catch(L){return t.e.Warn(`${C}/pointer: Invalid pointer (${J}) skipped`),null}}}a(Qd),j(Qd,!0,(b=>new Id(b)));class md{constructor(b,d,P){this.frame=b,this.action=d,this.onlyOnce=P,this.isDone=!1}_clone(){return new md(this.frame,this.action,this.onlyOnce)}}var vd=P(11525),Fd=P(11574),hd=P(11569);class Td{get loop(){return this._loop}set loop(b){b!==this._loop&&(this._loop=b,this.updateOptions({loop:b}))}get currentTime(){var b;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(b=Fd.e.audioEngine)&&void 0!==b&&b.audioContext&&(this.isPlaying||this.isPaused)){const b=this.isPaused?0:Fd.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+b}return 0}get spatialSound(){return this._spatialSound}set spatialSound(b){if(b==this._spatialSound)return;const d=this.isPlaying;this.pause(),b?(this._spatialSound=b,this._updateSpatialParameters()):this._disableSpatialSound(),d&&this.play()}constructor(b,d,P){var G;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new x.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=W.ed.Zero(),this._localDirection=new W.ed(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=b,P=P||w.e.LastCreatedScene)if(this._scene=P,Td._SceneComponentInitialization(P),this._readyToPlayCallback=i,this._customAttenuationFunction=(b,d,P,G,W)=>d<P?b*(1-d/P):0,C&&(this.autoplay=C.autoplay||!1,this._loop=C.loop||!1,void 0!==C.volume&&(this._volume=C.volume),this._spatialSound=C.spatialSound??!1,this.maxDistance=C.maxDistance??100,this.useCustomAttenuation=C.useCustomAttenuation??!1,this.rolloffFactor=C.rolloffFactor||1,this.refDistance=C.refDistance||1,this.distanceModel=C.distanceModel||"linear",this._playbackRate=C.playbackRate||1,this._streaming=C.streaming??!1,this._length=C.length,this._offset=C.offset),null!==(G=Fd.e.audioEngine)&&void 0!==G&&G.canUseWebAudio&&Fd.e.audioEngine.audioContext){this._soundGain=Fd.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let b=!0;if(d)try{"string"===typeof d?(this._urlType="String",this._url=d):d instanceof ArrayBuffer?this._urlType="ArrayBuffer":d instanceof HTMLMediaElement?this._urlType="MediaElement":d instanceof MediaStream?this._urlType="MediaStream":d instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(d)&&(this._urlType="Array");let P=[],G=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Fd.e.audioEngine.audioContext.createMediaElementSource(d),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Fd.e.audioEngine.audioContext.createMediaStreamSource(d),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":d.byteLength>0&&(G=!0,this._soundLoaded(d));break;case"AudioBuffer":this._audioBufferLoaded(d);break;case"String":P.push(d);case"Array":0===P.length&&(P=d);for(let b=0;b<P.length;b++){const d=P[b];if(G=C&&C.skipCodecCheck||-1!==d.indexOf(".mp3",d.length-4)&&Fd.e.audioEngine.isMP3supported||-1!==d.indexOf(".ogg",d.length-4)&&Fd.e.audioEngine.isOGGsupported||-1!==d.indexOf(".wav",d.length-4)||-1!==d.indexOf(".m4a",d.length-4)||-1!==d.indexOf(".mp4",d.length-4)||-1!==d.indexOf("blob:"),G){this._streaming?(this._htmlAudioElement=new Audio(d),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,q.Tools.SetCorsBehavior(d,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(d,(b=>{this._soundLoaded(b)}),void 0,!0,!0,(b=>{b&&t.e.Error("XHR "+b.status+" error on: "+d+"."),t.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:b=!1}b?G||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):t.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(J){t.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Fd.e.audioEngine&&!Fd.e.audioEngine.WarnedWebAudioUnsupported&&(t.e.Error("Web Audio is not supported by your browser."),Fd.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var b;null!==(b=Fd.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(b){var d;null!==(d=Fd.e.audioEngine)&&void 0!==d&&d.audioContext&&(this._audioBuffer=b,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(b){var d;null!==(d=Fd.e.audioEngine)&&void 0!==d&&d.audioContext&&Fd.e.audioEngine.audioContext.decodeAudioData(b,(b=>{this._audioBufferLoaded(b)}),(b=>{t.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+b)}))}setAudioBuffer(b){var d;null!==(d=Fd.e.audioEngine)&&void 0!==d&&d.canUseWebAudio&&(this._audioBuffer=b,this._isReadyToPlay=!0)}updateOptions(b){b&&(this.loop=b.loop??this.loop,this.maxDistance=b.maxDistance??this.maxDistance,this.useCustomAttenuation=b.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=b.rolloffFactor??this.rolloffFactor,this.refDistance=b.refDistance??this.refDistance,this.distanceModel=b.distanceModel??this.distanceModel,this._playbackRate=b.playbackRate??this._playbackRate,this._length=b.length??void 0,this.spatialSound=b.spatialSound??this._spatialSound,this._setOffset(b.offset??void 0),this.setVolume(b.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var b;null!==(b=Fd.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&Fd.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Fd.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var b;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(b=this._soundPanner)||void 0===b||b.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var b;null!==(b=Fd.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(b){var d;null!==(d=Fd.e.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(b),this._isOutputConnected=!0)}setDirectionalCone(b,d,P){d<b?t.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=b,this._coneOuterAngle=d,this._coneOuterGain=P,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(b){if(b!=this._coneInnerAngle){var d;if(this._coneOuterAngle<b)return void t.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=b,null!==(d=Fd.e.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(b){if(b!=this._coneOuterAngle){var d;if(b<this._coneInnerAngle)return void t.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=b,null!==(d=Fd.e.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(b){var d;b.equals(this._position)||(this._position.q(b),null!==(d=Fd.e.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(b){var d;this._localDirection=b,null!==(d=Fd.e.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const b=this._connectedTransformNode.getWorldMatrix(),d=W.ed.TransformNormal(this._localDirection,b);d.normalize(),this._soundPanner.orientationX.value=d.x,this._soundPanner.orientationY.value=d.y,this._soundPanner.orientationZ.value=d.z}updateDistanceFromListener(){var b;if(null!==(b=Fd.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const b=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Rd(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,b,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(b){this._customAttenuationFunction=b}play(b,d,P){var G;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(G=Fd.e.audioEngine)&&void 0!==G&&G.audioContext)try{var W,i;this._clearTimeoutsAndObservers();let G=b?(null===(W=Fd.e.audioEngine)||void 0===W?void 0:W.audioContext.currentTime)+b:null===(i=Fd.e.audioEngine)||void 0===i?void 0:i.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Fd.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const b=()=>{var P;if(null!==(P=Fd.e.audioEngine)&&void 0!==P&&P.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=d??0;const P=this._htmlAudioElement.play();void 0!==P&&P.catch((()=>{var d,P;(null===(d=Fd.e.audioEngine)||void 0===d||d.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(P=Fd.e.audioEngine)||void 0===P?void 0:P.onAudioUnlockedObservable.addOnce((()=>{b()})))}))}else{var G;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(G=Fd.e.audioEngine)||void 0===G?void 0:G.onAudioUnlockedObservable.addOnce((()=>{b()}))}};b()}}else{var q;const W=()=>{var W;if(null!==(W=Fd.e.audioEngine)&&void 0!==W&&W.audioContext){var i;if(P=P||this._length,void 0!==d&&this._setOffset(d),this._soundSource){const b=this._soundSource;b.onended=()=>{b.disconnect()}}if(this._soundSource=null===(i=Fd.e.audioEngine)||void 0===i?void 0:i.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var q;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==d&&(this._soundSource.loopStart=d),void 0!==P&&(this._soundSource.loopEnd=(0|d)+P),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},G=b?(null===(q=Fd.e.audioEngine)||void 0===q?void 0:q.audioContext.currentTime)+b:Fd.e.audioEngine.audioContext.currentTime;const W=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(G,W,this.loop?void 0:P)}}};"suspended"===(null===(q=Fd.e.audioEngine)||void 0===q?void 0:q.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var b;"suspended"===(null===(b=Fd.e.audioEngine)||void 0===b?void 0:b.audioContext.state)?(Fd.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Fd.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{W()})))):W()}),500):W()}this._startTime=G,this.isPlaying=!0,this.isPaused=!1}catch(C){t.e.Error("Error while trying to play audio: "+this.name+", "+C.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(b){var d;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var P;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(P=this._streamingSource)||void 0===P||P.disconnect();this.isPlaying=!1}else if(null!==(d=Fd.e.audioEngine)&&void 0!==d&&d.audioContext&&this._soundSource){const d=b?Fd.e.audioEngine.audioContext.currentTime+b:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(d)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var b;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var d;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(d=this._streamingSource)||void 0===d||d.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(b=Fd.e.audioEngine)&&void 0!==b&&b.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Fd.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(b,d){var P;null!==(P=Fd.e.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._soundGain&&(d&&Fd.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Fd.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Fd.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(b,Fd.e.audioEngine.audioContext.currentTime+d)):this._soundGain.gain.value=b),this._volume=b}setPlaybackRate(b){this._playbackRate=b,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(b){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=b,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=b=>this._onRegisterAfterWorldMatrixUpdate(b),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(b){var d;if(b.getBoundingInfo){const d=b.getBoundingInfo();this.setPosition(d.boundingSphere.centerWorld)}else this.setPosition(b.absolutePosition);null!==(d=Fd.e.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const b=()=>{(0,hd.e)((()=>this._isReadyToPlay),(()=>{P._audioBuffer=this.getAudioBuffer(),P._isReadyToPlay=!0,P.autoplay&&P.play(0,this._offset,this._length)}),void 0,300)},d={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},P=new Td(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,d);return this.useCustomAttenuation&&P.setAttenuationFunction(this._customAttenuationFunction),P.setPosition(this._position),P.setPlaybackRate(this._playbackRate),b(),P}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const b={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(b.connectedMeshId=this._connectedTransformNode.id),b.position=this._position.jd(),b.refDistance=this.refDistance,b.distanceModel=this.distanceModel,b.isDirectional=this._isDirectional,b.localDirectionToMesh=this._localDirection.jd(),b.coneInnerAngle=this._coneInnerAngle,b.coneOuterAngle=this._coneOuterAngle,b.coneOuterGain=this._coneOuterGain),b}static Parse(b,d,P,G){const i=b.name;let q;q=b.url?P+b.url:P+i;const C={autoplay:b.autoplay,loop:b.loop,volume:b.volume,spatialSound:b.spatialSound,maxDistance:b.maxDistance,rolloffFactor:b.rolloffFactor,refDistance:b.refDistance,distanceModel:b.distanceModel,playbackRate:b.playbackRate};let J;if(G){const b=()=>{(0,hd.e)((()=>G._isReadyToPlay),(()=>{J._audioBuffer=G.getAudioBuffer(),J._isReadyToPlay=!0,J.autoplay&&J.play(0,J._offset,J._length)}),void 0,300)};J=new Td(i,new ArrayBuffer(0),d,null,C),b()}else J=new Td(i,q,d,(()=>{d.removePendingData(J)}),C),d.addPendingData(J);if(b.position){const d=W.ed.Od(b.position);J.setPosition(d)}if(b.isDirectional&&(J.setDirectionalCone(b.coneInnerAngle||360,b.coneOuterAngle||360,b.coneOuterGain||0),b.localDirectionToMesh)){const d=W.ed.Od(b.localDirectionToMesh);J.setLocalDirectionToMesh(d)}if(b.connectedMeshId){const P=d.getMeshById(b.connectedMeshId);P&&J.attachToMesh(P)}return b.metadata&&(J.metadata=b.metadata),J}_setOffset(b){this._offset!==b&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=b)}_clearTimeoutsAndObservers(){var b;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(b=Fd.e.audioEngine)||void 0===b||b.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Td._SceneComponentInitialization=b=>{throw(0,vd.d)("AudioSceneComponent")},(0,fb.f)("BABYLON.Sound",Td);class Kd{constructor(b,d,P){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],d.length!==P.length)throw new Error("Sounds length does not equal weights length");this.loop=b,this._weights=P;let G=0;for(const i of P)G+=i;const W=G>0?1/G:0;for(let i=0;i<this._weights.length;i++)this._weights[i]*=W;this._sounds=d;for(const i of this._sounds)i.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(b){if(b!==this._coneInnerAngle){if(this._coneOuterAngle<b)return void t.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=b;for(const d of this._sounds)d.directionalConeInnerAngle=b}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(b){if(b!==this._coneOuterAngle){if(b<this._coneInnerAngle)return void t.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=b;for(const d of this._sounds)d.directionalConeOuterAngle=b}}get volume(){return this._volume}set volume(b){if(b!==this._volume)for(const d of this._sounds)d.setVolume(b)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(b){if(!this.isPaused){this.stop();const b=Math.random();let d=0;for(let P=0;P<this._weights.length;P++)if(d+=this._weights[P],b<=d){this._currentIndex=P;break}}const d=this._sounds[this._currentIndex??0];d.isReady()?d.play(0,this.isPaused?void 0:b):d.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class kd{constructor(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(b=b||w.e.LastCreatedScene)&&(this._scene=b,this.soundCollection=[],this._options=d,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var b;null!==(b=Fd.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&Fd.e.audioEngine.audioContext&&(this._outputAudioNode=Fd.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Fd.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Fd.e.audioEngine&&Fd.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(b){var d;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(d=Fd.e.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&b.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==b.soundTrackId&&(-1===b.soundTrackId?this._scene.mainSoundTrack.removeSound(b):this._scene.soundTracks&&this._scene.soundTracks[b.soundTrackId].removeSound(b)),this.soundCollection.push(b),b.soundTrackId=this.id}removeSound(b){const d=this.soundCollection.indexOf(b);-1!==d&&this.soundCollection.splice(d,1)}setVolume(b){var d;null!==(d=Fd.e.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=b)}switchPanningModelToHRTF(){var b;if(null!==(b=Fd.e.audioEngine)&&void 0!==b&&b.canUseWebAudio)for(let d=0;d<this.soundCollection.length;d++)this.soundCollection[d].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var b;if(null!==(b=Fd.e.audioEngine)&&void 0!==b&&b.canUseWebAudio)for(let d=0;d<this.soundCollection.length;d++)this.soundCollection[d].switchPanningModelToEqualPower()}connectToAnalyser(b){var d;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=b,null!==(d=Fd.e.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Fd.e.audioEngine.masterGain))}}var bP=P(11949),dP=P(11909),PP=P(11495);Fd.e.AudioEngineFactory=(b,d,P)=>new GP(b,d,P);class GP{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new x.d,this.onAudioLockedObservable=new x.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,PP.j)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const G=document.createElement("audio");this._hostElement=b,this._audioContext=d,this._audioDestination=P;try{G&&G.canPlayType&&(G.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||G.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(W){}try{G&&G.canPlayType&&G.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(W){}}lock(){this._triggerSuspendedState()}unlock(){var b,d;if("running"===(null===(b=this._audioContext)||void 0===b?void 0:b.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(d=this._audioContext)||void 0===d||d.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{t.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var b;null===(b=this._audioContext)||void 0===b||b.addEventListener("statechange",(()=>{var b;this.unlocked&&"running"!==(null===(b=this._audioContext)||void 0===b?void 0:b.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var b;return null!==(b=this._audioContext)&&void 0!==b&&b.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(b){this.canUseWebAudio=!1,t.e.Error("Web Audio: "+b.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(b){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const b=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",d=document.createElement("style");d.appendChild(document.createTextNode(b)),document.getElementsByTagName("head")[0].appendChild(d),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var b;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(b=this._audioContext)||void 0===b||b.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(b){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=b)}connectToAnalyser(b){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=b,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var WP=P(11517);(0,P(13034).h)(bP.b.NAME_AUDIO,((b,d,P,G)=>{let W,i=[];if(P.ls=P.ls||[],void 0!==b.ls&&null!==b.ls)for(let C=0,J=b.ls.length;C<J;C++){var q;const J=b.ls[C];null!==(q=Fd.e.audioEngine)&&void 0!==q&&q.canUseWebAudio?(J.url||(J.url=J.name),i[J.url]?P.ls.push(Td.Parse(J,d,G,i[J.url])):(W=Td.Parse(J,d,G),i[J.url]=W,P.ls.push(W))):P.ls.push(new Td(J.name,null,d))}i=[]})),Object.defineProperty(dP.e.prototype,"mainSoundTrack",{get:function(){let b=this._getComponent(bP.b.NAME_AUDIO);return b||(b=new iP(this),this.o(b)),this._mainSoundTrack||(this._mainSoundTrack=new kd(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),dP.e.prototype.getSoundByName=function(b){let d;for(d=0;d<this.mainSoundTrack.soundCollection.length;d++)if(this.mainSoundTrack.soundCollection[d].name===b)return this.mainSoundTrack.soundCollection[d];if(this.soundTracks)for(let P=0;P<this.soundTracks.length;P++)for(d=0;d<this.soundTracks[P].soundCollection.length;d++)if(this.soundTracks[P].soundCollection[d].name===b)return this.soundTracks[P].soundCollection[d];return null},Object.defineProperty(dP.e.prototype,"audioEnabled",{get:function(){let b=this._getComponent(bP.b.NAME_AUDIO);return b||(b=new iP(this),this.o(b)),b.audioEnabled},set:function(b){let d=this._getComponent(bP.b.NAME_AUDIO);d||(d=new iP(this),this.o(d)),b?d.enableAudio():d.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(dP.e.prototype,"headphone",{get:function(){let b=this._getComponent(bP.b.NAME_AUDIO);return b||(b=new iP(this),this.o(b)),b.headphone},set:function(b){let d=this._getComponent(bP.b.NAME_AUDIO);d||(d=new iP(this),this.o(d)),b?d.switchAudioModeForHeadphones():d.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(dP.e.prototype,"audioListenerPositionProvider",{get:function(){let b=this._getComponent(bP.b.NAME_AUDIO);return b||(b=new iP(this),this.o(b)),b.audioListenerPositionProvider},set:function(b){let d=this._getComponent(bP.b.NAME_AUDIO);if(d||(d=new iP(this),this.o(d)),b&&"function"!==typeof b)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");d.audioListenerPositionProvider=b},enumerable:!0,configurable:!0}),Object.defineProperty(dP.e.prototype,"audioListenerRotationProvider",{get:function(){let b=this._getComponent(bP.b.NAME_AUDIO);return b||(b=new iP(this),this.o(b)),b.audioListenerRotationProvider},set:function(b){let d=this._getComponent(bP.b.NAME_AUDIO);if(d||(d=new iP(this),this.o(d)),b&&"function"!==typeof b)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");d.audioListenerRotationProvider=b},enumerable:!0,configurable:!0}),Object.defineProperty(dP.e.prototype,"audioPositioningRefreshRate",{get:function(){let b=this._getComponent(bP.b.NAME_AUDIO);return b||(b=new iP(this),this.o(b)),b.audioPositioningRefreshRate},set:function(b){let d=this._getComponent(bP.b.NAME_AUDIO);d||(d=new iP(this),this.o(d)),d.audioPositioningRefreshRate=b},enumerable:!0,configurable:!0});class iP{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(b){this.name=bP.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new W.ed,this._cachedCameraPosition=new W.ed,this._lastCheck=0,this._invertMatrixTemp=new W.Matrix,this._cameraDirectionTemp=new W.ed,(b=b||w.e.LastCreatedScene)&&(this.Hd=b,b.soundTracks=[],b.ls=[])}register(){this.Hd._afterRenderStage.registerStep(bP.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(b){if(b.ls=[],this.Hd.soundTracks)for(let d=0;d<this.Hd.soundTracks.length;d++){const P=this.Hd.soundTracks[d];for(let d=0;d<P.soundCollection.length;d++)b.ls.push(P.soundCollection[d].serialize())}}addFromContainer(b){if(b.ls)for(const d of b.ls)d.play(),d.autoplay=!0,this.Hd.mainSoundTrack.addSound(d)}removeFromContainer(b){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(b.ls)for(const P of b.ls)P.stop(),P.autoplay=!1,this.Hd.mainSoundTrack.removeSound(P),d&&P.dispose()}dispose(){const b=this.Hd;if(b._mainSoundTrack&&b.mainSoundTrack.dispose(),b.soundTracks)for(let d=0;d<b.soundTracks.length;d++)b.soundTracks[d].dispose()}disableAudio(){const b=this.Hd;let d;for(this._audioEnabled=!1,Fd.e.audioEngine&&Fd.e.audioEngine.audioContext&&Fd.e.audioEngine.audioContext.suspend(),d=0;d<b.mainSoundTrack.soundCollection.length;d++)b.mainSoundTrack.soundCollection[d].pause();if(b.soundTracks)for(d=0;d<b.soundTracks.length;d++)for(let P=0;P<b.soundTracks[d].soundCollection.length;P++)b.soundTracks[d].soundCollection[P].pause()}enableAudio(){const b=this.Hd;let d;for(this._audioEnabled=!0,Fd.e.audioEngine&&Fd.e.audioEngine.audioContext&&Fd.e.audioEngine.audioContext.resume(),d=0;d<b.mainSoundTrack.soundCollection.length;d++)b.mainSoundTrack.soundCollection[d].isPaused&&b.mainSoundTrack.soundCollection[d].play();if(b.soundTracks)for(d=0;d<b.soundTracks.length;d++)for(let P=0;P<b.soundTracks[d].soundCollection.length;P++)b.soundTracks[d].soundCollection[P].isPaused&&b.soundTracks[d].soundCollection[P].play()}switchAudioModeForHeadphones(){const b=this.Hd;if(this._headphone=!0,b.mainSoundTrack.switchPanningModelToHRTF(),b.soundTracks)for(let d=0;d<b.soundTracks.length;d++)b.soundTracks[d].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const b=this.Hd;if(this._headphone=!1,b.mainSoundTrack.switchPanningModelToEqualPower(),b.soundTracks)for(let d=0;d<b.soundTracks.length;d++)b.soundTracks[d].switchPanningModelToEqualPower()}_afterRender(){const b=WP.c.Now;if(this._lastCheck&&b-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=b;const d=this.Hd;if(!this._audioEnabled||!d._mainSoundTrack||!d.soundTracks||0===d._mainSoundTrack.soundCollection.length&&1===d.soundTracks.length)return;const P=Fd.e.audioEngine;if(P&&P.audioContext){let b,G=d.activeCamera;if(d.activeCameras&&d.activeCameras.length>0&&(G=d.activeCameras[0]),this.audioListenerPositionProvider){const b=this.audioListenerPositionProvider();P.audioContext.listener.setPosition(b.x||0,b.y||0,b.z||0)}else G?this._cachedCameraPosition.equals(G.globalPosition)||(this._cachedCameraPosition.q(G.globalPosition),P.audioContext.listener.setPosition(G.globalPosition.x,G.globalPosition.y,G.globalPosition.z)):P.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const b=this.audioListenerRotationProvider();P.audioContext.listener.setOrientation(b.x||0,b.y||0,b.z||0,0,1,0)}else G?(G.rigCameras&&G.rigCameras.length>0&&(G=G.rigCameras[0]),G.getViewMatrix().invertToRef(this._invertMatrixTemp),W.ed.TransformNormalToRef(iP._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.q(this._cameraDirectionTemp),P.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):P.audioContext.listener.setOrientation(0,0,0,0,1,0);for(b=0;b<d.mainSoundTrack.soundCollection.length;b++){const P=d.mainSoundTrack.soundCollection[b];P.useCustomAttenuation&&P.updateDistanceFromListener()}if(d.soundTracks)for(b=0;b<d.soundTracks.length;b++)for(let P=0;P<d.soundTracks[b].soundCollection.length;P++){const G=d.soundTracks[b].soundCollection[P];G.useCustomAttenuation&&G.updateDistanceFromListener()}}}}iP._CameraDirection=new W.ed(0,0,-1),Td._SceneComponentInitialization=b=>{let d=b._getComponent(bP.b.NAME_AUDIO);d||(d=new iP(b),b.o(d))};const qP="MSFT_audio_emitter";class CP{constructor(b){this.name=qP,this._loader=b,this.enabled=this._loader.isExtensionUsed(qP)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const b=this._loader.fd.extensions;if(b&&b[this.name]){const d=b[this.name];this._clips=d.clips,this._emitters=d.emitters,c.Assign(this._clips),c.Assign(this._emitters)}}loadSceneAsync(b,d){return z.LoadExtensionAsync(b,d,this.name,(async(P,G)=>{const W=new Array;W.push(this._loader.loadSceneAsync(b,d));for(const b of G.emitters){const d=c.Get(`${P}/emitters`,this._emitters,b);if(void 0!=d.refDistance||void 0!=d.maxDistance||void 0!=d.rolloffFactor||void 0!=d.distanceModel||void 0!=d.innerAngle||void 0!=d.outerAngle)throw new Error(`${P}: Direction or Distance properties are not allowed on emitters attached to a scene`);W.push(this._loadEmitterAsync(`${P}/emitters/${d.index}`,d))}await Promise.all(W)}))}loadNodeAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(b,G)=>{const i=new Array,C=await this._loader.loadNodeAsync(b,d,(d=>{for(const P of G.emitters){const G=c.Get(`${b}/emitters`,this._emitters,P);i.push(this._loadEmitterAsync(`${b}/emitters/${G.index}`,G).then((()=>{for(const b of G._babylonSounds)b.attachToMesh(d),void 0==G.innerAngle&&void 0==G.outerAngle||(b.setLocalDirectionToMesh(W.ed.Forward()),b.setDirectionalCone(2*q.Tools.ToDegrees(void 0==G.innerAngle?Math.PI:G.innerAngle),2*q.Tools.ToDegrees(void 0==G.outerAngle?Math.PI:G.outerAngle),0))})))}P(d)}));return await Promise.all(i),C}))}loadAnimationAsync(b,d){return z.LoadExtensionAsync(b,d,this.name,(async(P,G)=>{const W=await this._loader.loadAnimationAsync(b,d),i=new Array;c.Assign(G.events);for(const q of G.events)i.push(this._loadAnimationEventAsync(`${P}/events/${q.index}`,b,d,q,W));return await Promise.all(i),W}))}_loadClipAsync(b,d){if(d._objectURL)return d._objectURL;let P;if(d.uri)P=this._loader.loadUriAsync(b,d,d.uri);else{const G=c.Get(`${b}/bufferView`,this._loader.fd.bufferViews,d.bufferView);P=this._loader.loadBufferViewAsync(`/bufferViews/${G.index}`,G)}return d._objectURL=P.then((b=>URL.createObjectURL(new Blob([b],{type:d.mimeType})))),d._objectURL}_loadEmitterAsync(b,d){if(d._babylonSounds=d._babylonSounds||[],!d._babylonData){const b=new Array,P=d.name||`emitter${d.index}`,G={loop:!1,autoplay:!1,volume:void 0==d.volume?1:d.volume};for(let i=0;i<d.clips.length;i++){const W=`/extensions/${this.name}/clips`,q=c.Get(W,this._clips,d.clips[i].clip);b.push(this._loadClipAsync(`${W}/${d.clips[i].clip}`,q).then((b=>{const W=d._babylonSounds[i]=new Td(P,b,this._loader.babylonScene,null,G);W.refDistance=d.refDistance||1,W.maxDistance=d.maxDistance||256,W.rolloffFactor=d.rolloffFactor||1,W.distanceModel=d.distanceModel||"exponential"})))}const W=Promise.all(b).then((()=>{const b=d.clips.map((b=>b.weight||1)),P=new Kd(d.loop||!1,d._babylonSounds,b);d.innerAngle&&(P.directionalConeInnerAngle=2*q.Tools.ToDegrees(d.innerAngle)),d.outerAngle&&(P.directionalConeOuterAngle=2*q.Tools.ToDegrees(d.outerAngle)),d.volume&&(P.volume=d.volume),d._babylonData.sound=P}));d._babylonData={loaded:W}}return d._babylonData.loaded}_getEventAction(b,d,P,G,W){switch(P){case"play":return b=>{const P=(W||0)+(b-G);d.play(P)};case"stop":return()=>{d.stop()};case"pause":return()=>{d.pause()};default:throw new Error(`${b}: Unsupported action ${P}`)}}_loadAnimationEventAsync(b,d,P,G,W){if(0==W.targetedAnimations.length)return Promise.resolve();const i=W.targetedAnimations[0],q=G.qd,C=c.Get(`/extensions/${this.name}/emitters`,this._emitters,q);return this._loadEmitterAsync(b,C).then((()=>{const d=C._babylonData.sound;if(d){const P=new md(G.time,this._getEventAction(b,d,G.action,G.time,G.startOffset));i.animation.addEvent(P),W.onAnimationGroupEndObservable.add((()=>{d.stop()})),W.onAnimationGroupPauseObservable.add((()=>{d.pause()}))}}))}}a(qP),j(qP,!0,(b=>new CP(b)));const JP="MSFT_lod";class LP{constructor(b){var d;this.name=JP,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new x.d,this.onMaterialLODsLoadedObservable=new x.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=b,this.maxLODsToLoad=(null===(d=this._loader.parent.extensionOptions[JP])||void 0===d?void 0:d.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(JP)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let b=0;b<this._nodePromiseLODs.length;b++){const d=Promise.all(this._nodePromiseLODs[b]).then((()=>{0!==b&&(this._loader.endPerformanceCounter(`Node LOD ${b}`),this._loader.log(`Loaded node LOD ${b}`)),this.onNodeLODsLoadedObservable.notifyObservers(b),b!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${b+1}`),this._loadBufferLOD(this._nodeBufferLODs,b+1),this._nodeSignalLODs[b]&&this._nodeSignalLODs[b].resolve())}));this._loader._completePromises.push(d)}for(let b=0;b<this._materialPromiseLODs.length;b++){const d=Promise.all(this._materialPromiseLODs[b]).then((()=>{0!==b&&(this._loader.endPerformanceCounter(`Material LOD ${b}`),this._loader.log(`Loaded material LOD ${b}`)),this.onMaterialLODsLoadedObservable.notifyObservers(b),b!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${b+1}`),this._loadBufferLOD(this._materialBufferLODs,b+1),this._materialSignalLODs[b]&&this._materialSignalLODs[b].resolve())}));this._loader._completePromises.push(d)}}loadSceneAsync(b,d){const P=this._loader.loadSceneAsync(b,d);return this._loadBufferLOD(this._bufferLODs,0),P}loadNodeAsync(b,d,P){return z.LoadExtensionAsync(b,d,this.name,(async(b,W)=>{let i;const q=this._getLODs(b,d,this._loader.fd.nodes,W.ids);this._loader.logOpen(`${b}`);for(let d=0;d<q.length;d++){const b=q[d];0!==d&&(this._nodeIndexLOD=d,this._nodeSignalLODs[d]=this._nodeSignalLODs[d]||new G);const W=b=>{P(b),b.yC(!1)},C=this._loader.loadNodeAsync(`/nodes/${b.index}`,b,W).then((b=>{if(0!==d){const b=q[d-1];b._babylonTransformNode&&(this._disposeTransformNode(b._babylonTransformNode),delete b._babylonTransformNode)}return b.yC(!0),b}));this._nodePromiseLODs[d]=this._nodePromiseLODs[d]||[],0===d?i=C:(this._nodeIndexLOD=null,this._nodePromiseLODs[d].push(C))}return this._loader.logClose(),await i}))}_loadMaterialAsync(b,d,P,G,W){return this._nodeIndexLOD?null:z.LoadExtensionAsync(b,d,this.name,(async(b,i)=>{let q;const C=this._getLODs(b,d,this._loader.fd.materials,i.ids);this._loader.logOpen(`${b}`);for(let d=0;d<C.length;d++){const b=C[d];0!==d&&(this._materialIndexLOD=d);const i=this._loader._loadMaterialAsync(`/materials/${b.index}`,b,P,G,(b=>{0===d&&W(b)})).then((b=>{if(0!==d){W(b);const P=C[d-1]._data;P[G]&&(this._disposeMaterials([P[G].babylonMaterial]),delete P[G])}return b}));this._materialPromiseLODs[d]=this._materialPromiseLODs[d]||[],0===d?q=i:(this._materialIndexLOD=null,this._materialPromiseLODs[d].push(i))}return this._loader.logClose(),await q}))}_loadUriAsync(b,d,P){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const W=this._nodeIndexLOD-1;return this._nodeSignalLODs[W]=this._nodeSignalLODs[W]||new G,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(b,d,P)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const W=this._materialIndexLOD-1;return this._materialSignalLODs[W]=this._materialSignalLODs[W]||new G,this._materialSignalLODs[W].promise.then((async()=>await this._loader.loadUriAsync(b,d,P)))}return null}loadBufferAsync(b,d,P,W){if(this._loader.parent.useRangeRequests&&!d.uri){if(!this._loader.bin)throw new Error(`${b}: Uri is missing or the binary glTF is missing its binary chunk`);const d=async(b,d)=>{const i=P,q=i+W-1;let C=b[d];return C?(C.start=Math.min(C.start,i),C.end=Math.max(C.end,q)):(C={start:i,end:q,loaded:new G},b[d]=C),await C.loaded.promise.then((b=>new Uint8Array(b.buffer,b.byteOffset+P-C.start,W)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?d(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?d(this._materialBufferLODs,this._materialIndexLOD):d(this._bufferLODs,0)}return null}_loadBufferLOD(b,d){const P=b[d];P&&(this._loader.log(`Loading buffer range [${P.start}-${P.end}]`),this._loader.bin.readAsync(P.start,P.end-P.start+1).then((b=>{P.loaded.resolve(b)}),(b=>{P.loaded.reject(b)})))}_getLODs(b,d,P,G){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const W=[];for(let i=G.length-1;i>=0;i--)if(W.push(c.Get(`${b}/ids/${G[i]}`,P,G[i])),W.length===this.maxLODsToLoad)return W;return W.push(d),W}_disposeTransformNode(b){const d=[],P=b.material;P&&d.push(P);for(const W of b.getChildMeshes())W.material&&d.push(W.material);b.dispose();const G=d.filter((b=>this._loader.babylonScene.meshes.every((d=>d.material!=b))));this._disposeMaterials(G)}_disposeMaterials(b){const d={};for(const P of b){for(const b of P.getActiveTextures())d[b.uniqueId]=b;P.dispose()}for(const P in d)for(const b of this._loader.babylonScene.materials)b.hasTexture(d[P])&&delete d[P];for(const P in d)d[P].dispose()}}a(JP),j(JP,!0,(b=>new LP(b)));const xP="MSFT_minecraftMesh";class YP{constructor(b){this.name=xP,this._loader=b,this.enabled=this._loader.isExtensionUsed(xP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,d,P){return z.LoadExtraAsync(b,d,this.name,(async(G,W)=>{if(W){if(!(P instanceof Z.d))throw new Error(`${G}: Material type not supported`);const W=this._loader.loadMaterialPropertiesAsync(b,d,P);return P.needAlphaBlending()&&(P.forceDepthWrite=!0,P.separateCullingPass=!0),P.md=P.forceDepthWrite,P.twoSidedLighting=!0,await W}}))}}a(xP),j(xP,!0,(b=>new YP(b)));const sP="MSFT_sRGBFactors";class EP{constructor(b){this.name=sP,this._loader=b,this.enabled=this._loader.isExtensionUsed(sP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(b,d,P){return z.LoadExtraAsync(b,d,this.name,(async(G,W)=>{if(W){if(!(P instanceof Z.d))throw new Error(`${G}: Material type not supported`);const W=this._loader.loadMaterialPropertiesAsync(b,d,P),i=P.Xb().getEngine().useExactSrgbConversions;return P.albedoTexture||P.albedoColor.toLinearSpaceToRef(P.albedoColor,i),P.reflectivityTexture||P.reflectivityColor.toLinearSpaceToRef(P.reflectivityColor,i),await W}}))}}a(sP),j(sP,!0,(b=>new EP(b)));var wP=P(13350);const tP={};var rP=P(13397),BP=P(13377),nP=P(13352),ZP=P(13365);function oP(b,d){for(const P of b)for(const b of P.dataOutputs)if(b.uniqueId===d)return b;throw new Error("Could not find data out connection with unique id "+d)}function AP(b,d){for(const P of b)if(P instanceof BP.b)for(const b of P.signalInputs)if(b.uniqueId===d)return b;throw new Error("Could not find signal in connection with unique id "+d)}async function fP(b,d){const G=await Promise.all(b.allBlocks.map((async b=>{const d=function(b){switch(b){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([P.e(78),P.e(79)]).then(P.bind(P,14834))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await P.e(80).then(P.bind(P,14836))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await P.e(81).then(P.bind(P,14845))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await P.e(82).then(P.bind(P,14849))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await P.e(83).then(P.bind(P,14855))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await P.e(84).then(P.bind(P,14860))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await P.e(85).then(P.bind(P,14865))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await P.e(86).then(P.bind(P,14872))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await P.e(87).then(P.bind(P,14874))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await P.e(89).then(P.bind(P,14895))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await P.e(89).then(P.bind(P,14895))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await P.e(89).then(P.bind(P,14895))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await P.e(89).then(P.bind(P,14895))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await P.e(89).then(P.bind(P,14895))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await P.e(89).then(P.bind(P,14895))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await P.e(90).then(P.bind(P,14903))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await P.e(90).then(P.bind(P,14903))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await P.e(90).then(P.bind(P,14903))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await P.e(90).then(P.bind(P,14903))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await P.e(95).then(P.bind(P,14907))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await P.e(96).then(P.bind(P,14912))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await P.e(97).then(P.bind(P,14914))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await P.e(98).then(P.bind(P,14921))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await P.e(99).then(P.bind(P,14927))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await P.e(100).then(P.bind(P,14931))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await P.e(101).then(P.bind(P,14939))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await P.e(102).then(P.bind(P,14948))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await P.e(103).then(P.bind(P,14954))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await P.e(104).then(P.bind(P,14962))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await P.e(105).then(P.bind(P,14966))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await P.e(106).then(P.bind(P,14972))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await P.e(107).then(P.bind(P,14975))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await P.e(108).then(P.bind(P,14982))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await P.e(109).then(P.bind(P,14987))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await P.e(110).then(P.bind(P,14990))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await P.e(111).then(P.bind(P,14992))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await P.e(112).then(P.bind(P,14998))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await P.e(113).then(P.bind(P,15002))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await P.e(92).then(P.bind(P,15004))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await P.e(114).then(P.bind(P,15010))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await P.e(115).then(P.bind(P,15016))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await P.e(116).then(P.bind(P,15023))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await P.e(93).then(P.bind(P,15025))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await P.e(88).then(P.bind(P,14877))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await P.e(94).then(P.bind(P,15033))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await P.e(94).then(P.bind(P,15033))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await P.e(94).then(P.bind(P,15033))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await P.e(94).then(P.bind(P,15033))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await P.e(94).then(P.bind(P,15033))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await P.e(94).then(P.bind(P,15033))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await P.e(94).then(P.bind(P,15033))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await P.e(94).then(P.bind(P,15033))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await P.e(89).then(P.bind(P,14895))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await P.e(89).then(P.bind(P,14895))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await P.e(89).then(P.bind(P,14895))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await P.e(89).then(P.bind(P,14895))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await P.e(89).then(P.bind(P,14895))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await P.e(89).then(P.bind(P,14895))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await P.e(89).then(P.bind(P,14895))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await P.e(90).then(P.bind(P,14903))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await P.e(90).then(P.bind(P,14903))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await P.e(91).then(P.bind(P,15037))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await P.e(91).then(P.bind(P,15037))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await P.e(91).then(P.bind(P,15037))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await P.e(91).then(P.bind(P,15037))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await P.e(91).then(P.bind(P,15037))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await P.e(91).then(P.bind(P,15037))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await P.e(117).then(P.bind(P,15041))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await P.e(118).then(P.bind(P,15048))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await P.e(119).then(P.bind(P,15052))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await P.e(120).then(P.bind(P,15057))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await P.e(121).then(P.bind(P,15062))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await P.e(122).then(P.bind(P,15068))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await P.e(123).then(P.bind(P,15075))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await P.e(124).then(P.bind(P,15078))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await P.e(125).then(P.bind(P,15084))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await P.e(126).then(P.bind(P,15086))).FlowGraphDataSwitchBlock;default:if(tP[b])return tP[b];throw new Error(`Unknown block name ${b}`)}}(b.className);return await d()})));return function(b,d,P){const G=d.coordinator.createGraph(),W=[],i=d.valueParseFunction??nP.e;for(let q=0;q<b.allBlocks.length;q++){const C=XP(b.allBlocks[q],{Hd:d.coordinator.config.Hd,pathConverter:d.pathConverter,assetsContainer:d.coordinator.config.Hd,valueParseFunction:i},P[q]);W.push(C),C instanceof rP.d&&G.addEventBlock(C)}for(const q of W){for(const b of q.dataInputs)for(const d of b.connectedPointIds){const P=oP(W,d);b.connectTo(P)}if(q instanceof BP.b)for(const b of q.signalOutputs)for(const d of b.connectedPointIds){const P=AP(W,d);b.connectTo(P)}}for(const q of b.executionContexts)gP(q,{graph:G,valueParseFunction:i},b.rightHanded);return G}(b,d,G)}function gP(b,d,P){const G=d.graph.createContext();b.enableLogging&&(G.enableLogging=!0),G.treatDataAsRightHanded=P||!1;const W=d.valueParseFunction??nP.e;G.uniqueId=b.uniqueId;const i=G.Xb();if(b._assetsContext){var q,C,J,L,x,Y,s,E,w,t;const d=b._assetsContext,P={meshes:null===(q=d.meshes)||void 0===q?void 0:q.map((b=>i.getMeshById(b))),lights:null===(C=d.lights)||void 0===C?void 0:C.map((b=>i.getLightByName(b))),cameras:null===(J=d.cameras)||void 0===J?void 0:J.map((b=>i.getCameraByName(b))),materials:null===(L=d.materials)||void 0===L?void 0:L.map((b=>i.getMaterialById(b))),textures:null===(x=d.textures)||void 0===x?void 0:x.map((b=>i.getTextureByName(b))),animations:null===(Y=d.animations)||void 0===Y?void 0:Y.map((b=>i.animations.find((d=>d.name===b)))),skeletons:null===(s=d.skeletons)||void 0===s?void 0:s.map((b=>i.getSkeletonByName(b))),kY:null===(E=d.kY)||void 0===E?void 0:E.map((b=>i.getParticleSystemById(b))),animationGroups:null===(w=d.animationGroups)||void 0===w?void 0:w.map((b=>i.getAnimationGroupByName(b))),transformNodes:null===(t=d.transformNodes)||void 0===t?void 0:t.map((b=>i.getTransformNodeById(b))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],ls:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};G.assetsContext=P}for(const r in b._userVariables){const d=W(r,b._userVariables,G.assetsContext,i);G.userVariables[r]=d}for(const r in b._connectionValues){const d=W(r,b._connectionValues,G.assetsContext,i);G._setConnectionValueByKey(r,d)}return G}function XP(b,d,P){const G={},W=d.valueParseFunction??nP.e;if(b.config)for(const q in b.config)G[q]=W(q,b.config,d.assetsContainer||d.Hd,d.Hd);if((0,nP.l)(b.className)){if(!d.pathConverter)throw new Error("Path converter is required for this block");G.pathConverter=d.pathConverter}const i=new P(G);i.uniqueId=b.uniqueId;for(let q=0;q<b.dataInputs.length;q++){const d=i.getDataInput(b.dataInputs[q].name);if(!d)throw new Error("Could not find data input with name "+b.dataInputs[q].name+" in block "+b.className);d.deserialize(b.dataInputs[q])}for(let q=0;q<b.dataOutputs.length;q++){const d=i.getDataOutput(b.dataOutputs[q].name);if(!d)throw new Error("Could not find data output with name "+b.dataOutputs[q].name+" in block "+b.className);d.deserialize(b.dataOutputs[q])}return i.metadata=b.metadata,i.deserialize&&i.deserialize(b),i}function uP(b){const[d,P]=b.split(":");return MP({op:d,extension:P})}function MP(b){var d;let P=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const G=b.extension?null===(d=RP[b.extension])||void 0===d?void 0:d[b.op]:UP[b.op];if(!G&&(t.e.Warn(`No mapping found for operation ${b.op} and extension ${b.extension||"KHR_interactivity"}`),P)){const d={},P={flows:{}};if(b.inputValueSockets){d.values={};for(const P in b.inputValueSockets)d.values[P]={name:P}}return b.outputValueSockets&&(P.values={},Object.keys(b.outputValueSockets).forEach((b=>{P.values[b]={name:b}}))),{xx:[],inputs:d,outputs:P}}return G}function eP(b,d,P){RP[d]||(RP[d]={}),RP[d][b]=P}const RP={BABYLON:{"flow/log":{xx:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},UP={"event/onStart":{xx:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{xx:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{xx:["FlowGraphSendCustomEventBlock"],extraProcessor(b,d,P,G,W){if("event/send"!==d.op||!b.configuration||1!==Object.keys(b.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const i=b.configuration.event.value[0];if("number"!==typeof i)throw new Error("Event id should be a number");const q=G.arrays.events[i],C=W[0];return C.config||(C.config={}),C.config.eventId=q.eventId,C.config.eventData=q.eventData,W}},"event/receive":{xx:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(b,d){var P;if(!b.configuration)return t.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const G=b.configuration.event;if(!G)return t.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const W=G.value[0];if("number"!==typeof W)return t.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(P=d.events)||void 0===P?void 0:P[W])?{valid:!0}:(t.e.Error(`Event with id ${W} not found`),{valid:!1,error:`Event with id ${W} not found`})},extraProcessor(b,d,P,G,W){if("event/receive"!==d.op||!b.configuration||1!==Object.keys(b.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const i=b.configuration.event.value[0];if("number"!==typeof i)throw new Error("Event id should be a number");const q=G.arrays.events[i],C=W[0];return C.config||(C.config={}),C.config.eventId=q.eventId,C.config.eventData=q.eventData,W}},"math/e":HP("FlowGraphEBlock"),"math/pi":HP("FlowGraphPIBlock"),"math/inf":HP("FlowGraphInfBlock"),"math/nan":HP("FlowGraphNaNBlock"),"math/abs":HP("FlowGraphAbsBlock"),"math/sign":HP("FlowGraphSignBlock"),"math/trunc":HP("FlowGraphTruncBlock"),"math/floor":HP("FlowGraphFloorBlock"),"math/ceil":HP("FlowGraphCeilBlock"),"math/round":{xx:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,d,P,G,W){var i;return(i=W[0]).config||(i.config={}),W[0].config.roundHalfAwayFromZero=!0,W}},"math/fract":HP("FlowGraphFractBlock"),"math/neg":HP("FlowGraphNegationBlock"),"math/add":HP("FlowGraphAddBlock",["a","b"],!0),"math/sub":HP("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{xx:["FlowGraphMultiplyBlock"],extraProcessor(b,d,P,G,W){var i;(i=W[0]).config||(i.config={}),W[0].config.useMatrixPerComponent=!0,W[0].config.preventIntegerFloatArithmetic=!0;let q=-1;return Object.keys(b.values||{}).find((d=>{var P;return void 0!==(null===(P=b.values)||void 0===P?void 0:P[d].type)&&(q=b.values[d].type,!0)})),-1!==q&&(W[0].config.type=G.arrays.types[q].flowGraphType),W},validation:b=>b.values?pP(b):{valid:!0}},"math/div":HP("FlowGraphDivideBlock",["a","b"],!0),"math/rem":HP("FlowGraphModuloBlock",["a","b"]),"math/min":HP("FlowGraphMinBlock",["a","b"]),"math/max":HP("FlowGraphMaxBlock",["a","b"]),"math/clamp":HP("FlowGraphClampBlock",["a","b","c"]),"math/saturate":HP("FlowGraphSaturateBlock"),"math/mix":HP("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":HP("FlowGraphEqualityBlock",["a","b"]),"math/lt":HP("FlowGraphLessThanBlock",["a","b"]),"math/le":HP("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":HP("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":HP("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":HP("FlowGraphIsNaNBlock"),"math/isinf":HP("FlowGraphIsInfBlock"),"math/select":{xx:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{xx:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":HP("FlowGraphSinBlock"),"math/cos":HP("FlowGraphCosBlock"),"math/tan":HP("FlowGraphTanBlock"),"math/asin":HP("FlowGraphASinBlock"),"math/acos":HP("FlowGraphACosBlock"),"math/atan":HP("FlowGraphATanBlock"),"math/atan2":HP("FlowGraphATan2Block",["a","b"]),"math/sinh":HP("FlowGraphSinhBlock"),"math/cosh":HP("FlowGraphCoshBlock"),"math/tanh":HP("FlowGraphTanhBlock"),"math/asinh":HP("FlowGraphASinhBlock"),"math/acosh":HP("FlowGraphACoshBlock"),"math/atanh":HP("FlowGraphATanhBlock"),"math/exp":HP("FlowGraphExponentialBlock"),"math/log":HP("FlowGraphLogBlock"),"math/log2":HP("FlowGraphLog2Block"),"math/log10":HP("FlowGraphLog10Block"),"math/sqrt":HP("FlowGraphSquareRootBlock"),"math/cbrt":HP("FlowGraphCubeRootBlock"),"math/pow":HP("FlowGraphPowerBlock",["a","b"]),"math/length":HP("FlowGraphLengthBlock"),"math/normalize":HP("FlowGraphNormalizeBlock"),"math/dot":HP("FlowGraphDotBlock",["a","b"]),"math/cross":HP("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":HP("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":HP("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{xx:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{xx:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{xx:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{xx:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{xx:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{xx:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{xx:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":HP("FlowGraphTransposeBlock"),"math/determinant":HP("FlowGraphDeterminantBlock"),"math/inverse":HP("FlowGraphInvertMatrixBlock"),"math/matmul":HP("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{xx:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"hd",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,d,P,G,W,i){const q=W[0].dataInputs.find((b=>"rotationQuaternion"===b.name));if(!q)throw new Error("Rotation quaternion input not found");return i._connectionValues[q.uniqueId]&&(i._connectionValues[q.uniqueId].type="Quaternion"),W}},"math/matDecompose":{xx:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"hd"}}}},"math/quatConjugate":HP("FlowGraphConjugateBlock",["a"]),"math/quatMul":{xx:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,d,P,G,W){var i;return(i=W[0]).config||(i.config={}),W[0].config.type="Quaternion",W}},"math/quatAngleBetween":HP("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{xx:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":HP("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":HP("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{xx:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,d,P,G,W){var i;return(i=W[0]).config||(i.config={}),W[0].config.inputIsColumnMajor=!0,W}},"math/extract2x2":{xx:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{xx:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,d,P,G,W){var i;return(i=W[0]).config||(i.config={}),W[0].config.inputIsColumnMajor=!0,W}},"math/extract3x3":{xx:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{xx:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,d,P,G,W){var i;return(i=W[0]).config||(i.config={}),W[0].config.inputIsColumnMajor=!0,W}},"math/extract4x4":{xx:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{xx:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,d,P,G,W,i){var q,C;(C=W[0]).config||(C.config={});const J=W[0].dataInputs[0];return W[0].config.valueType=(null===(q=i._connectionValues[J.uniqueId])||void 0===q?void 0:q.type)??"FlowGraphInteger",W}},"math/and":{xx:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,d,P,G,W,i){var q,C,J;(J=W[0]).config||(J.config={});const L=W[0].dataInputs[0],x=W[0].dataInputs[1];return W[0].config.valueType=(null===(q=i._connectionValues[L.uniqueId])||void 0===q?void 0:q.type)??(null===(C=i._connectionValues[x.uniqueId])||void 0===C?void 0:C.type)??"FlowGraphInteger",W}},"math/or":{xx:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,d,P,G,W,i){var q,C,J;(J=W[0]).config||(J.config={});const L=W[0].dataInputs[0],x=W[0].dataInputs[1];return W[0].config.valueType=(null===(q=i._connectionValues[L.uniqueId])||void 0===q?void 0:q.type)??(null===(C=i._connectionValues[x.uniqueId])||void 0===C?void 0:C.type)??"FlowGraphInteger",W}},"math/xor":{xx:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(b,d,P,G,W,i){var q,C,J;(J=W[0]).config||(J.config={});const L=W[0].dataInputs[0],x=W[0].dataInputs[1];return W[0].config.valueType=(null===(q=i._connectionValues[L.uniqueId])||void 0===q?void 0:q.type)??(null===(C=i._connectionValues[x.uniqueId])||void 0===C?void 0:C.type)??"FlowGraphInteger",W}},"math/asr":HP("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":HP("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":HP("FlowGraphLeadingZerosBlock"),"math/ctz":HP("FlowGraphTrailingZerosBlock"),"math/popcnt":HP("FlowGraphOneBitsCounterBlock"),"math/rad":HP("FlowGraphDegToRadBlock"),"math/deg":HP("FlowGraphRadToDegBlock"),"type/boolToInt":HP("FlowGraphBooleanToInt"),"type/boolToFloat":HP("FlowGraphBooleanToFloat"),"type/intToBool":HP("FlowGraphIntToBoolean"),"type/intToFloat":HP("FlowGraphIntToFloat"),"type/floatToInt":HP("FlowGraphFloatToInt"),"type/floatToBool":HP("FlowGraphFloatToBoolean"),"flow/sequence":{xx:["FlowGraphSequenceBlock"],extraProcessor(b,d,P,G,W){const i=W[0];return i.config||(i.config={}),i.config.outputSignalCount=Object.keys(b.flows||[]).length,i.signalOutputs.forEach(((b,d)=>{b.name="out_"+d})),W}},"flow/branch":{xx:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{xx:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(b){if(b.configuration&&b.configuration.cases){const d=b.configuration.cases.value;if(!d.every((b=>"number"===typeof b&&/^-?\d+$/.test(b.toString()))))return t.e.Warn("Switch cases should be integers. Using empty array instead."),b.configuration.cases.value=[],{valid:!0};const P=new Set(d);b.configuration.cases.value=Array.from(P)}return{valid:!0}},extraProcessor(b,d,P,G,W){if("flow/switch"!==d.op||!b.flows||0===Object.keys(b.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return W[0].signalOutputs.forEach((b=>{"default"!==b.name&&(b.name="out_"+b.name)})),W}},"flow/while":{xx:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{xx:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(b,d,P,G,W){const i=W[0];return i.config||(i.config={}),i.config.incrementIndexWhenLoopDone=!0,W}},"flow/doN":{xx:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{xx:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(b,d,P,G,W){if("flow/multiGate"!==d.op||!b.flows||0===Object.keys(b.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const i=W[0];return i.config||(i.config={}),i.config.outputSignalCount=Object.keys(b.flows).length,i.signalOutputs.forEach(((b,d)=>{b.name="out_"+d})),W}},"flow/waitAll":{xx:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(b){var d,P;return"number"!==typeof(null===(d=b.configuration)||void 0===d||null===(P=d.inputFlows)||void 0===P?void 0:P.value[0])&&(b.configuration=b.configuration||{inputFlows:{value:[0]}},b.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{xx:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{xx:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{xx:["FlowGraphCancelDelayBlock"]},"variable/get":{xx:["FlowGraphGetVariableBlock"],validation(b){var d,P;return null!==(d=b.configuration)&&void 0!==d&&null!==(P=d.variable)&&void 0!==P&&P.value?{valid:!0}:(t.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(b,d)=>[d.getVariableName(b[0])]}}},"variable/set":{xx:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(b,d)=>[d.getVariableName(b[0])]}}},"variable/setMultiple":{xx:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(b,d)=>[b[0].map((b=>d.getVariableName(b)))]}},extraProcessor:(b,d,P,G,W)=>(W[0].dataInputs.forEach((b=>{b.name=G.getVariableName(+b.name)})),W)},"variable/interpolate":{xx:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(b,d)=>[d.getVariableName(b[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:b=>!0===b[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",TP:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",TP:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",TP:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",TP:"FlowGraphPlayAnimationBlock"},out:{name:"out",TP:"FlowGraphPlayAnimationBlock"},done:{name:"done",TP:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(b,d,P,G,W){var i,q,C;const J=W[0],L=null===(i=b.configuration)||void 0===i?void 0:i.variable.value[0];if("number"!==typeof L)throw t.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const x=G.arrays.staticVariables[L];"undefined"===typeof J.config.animationType.value&&(G.arrays.staticVariables,J.config.animationType.value=(0,ZP.B)(x.type));const Y=W[4];return Y.config||(Y.config={}),(q=Y.config).variable||(q.variable={}),Y.config.variable.value=G.getVariableName(L),(C=W[3]).config||(C.config={}),W}},"pointer/get":{xx:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",TP:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",TP:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(b,d,P,G,W)=>(W.forEach((b=>{"FlowGraphJsonPointerParserBlock"===b.className&&(b.config||(b.config={}),b.config.outputValue=!0)})),W)},"pointer/set":{xx:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",TP:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",TP:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(b,d,P,G,W)=>(W.forEach((b=>{"FlowGraphJsonPointerParserBlock"===b.className&&(b.config||(b.config={}),b.config.outputValue=!0)})),W)},"pointer/interpolate":{xx:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",TP:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",TP:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",TP:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",TP:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",TP:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",TP:"FlowGraphPlayAnimationBlock"},out:{name:"out",TP:"FlowGraphPlayAnimationBlock"},done:{name:"done",TP:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(b,d,P,G,W)=>(W.forEach((d=>{"FlowGraphJsonPointerParserBlock"===d.className?(d.config||(d.config={}),d.config.outputValue=!0):"FlowGraphInterpolationBlock"===d.className&&(d.config||(d.config={}),Object.keys(b.values||[]).forEach((P=>{var W;const i=null===(W=b.values)||void 0===W?void 0:W[P];if("value"===P&&i){const b=i.type;void 0!==b&&(d.config.animationType=G.arrays.types[b].flowGraphType)}})))})),W)},"animation/start":{xx:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",TP:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(b,d)=>[b[0]*d._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(b,d)=>[b[0]*d._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(b,d,P,G,W,i,q){const C=W[W.length-1];return C.config||(C.config={}),C.config.glTF=q,W}},"animation/stop":{xx:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",TP:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(b,d,P,G,W,i,q){const C=W[W.length-1];return C.config||(C.config={}),C.config.glTF=q,W}},"animation/stopAt":{xx:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",TP:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(b,d)=>[b[0]*d._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(b,d,P,G,W,i,q){const C=W[W.length-1];return C.config||(C.config={}),C.config.glTF=q,W}},"math/switch":{xx:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(b){if(b.configuration&&b.configuration.cases){const d=b.configuration.cases.value;if(!d.every((b=>"number"===typeof b&&/^-?\d+$/.test(b.toString()))))return t.e.Warn("Switch cases should be integers. Using empty array instead."),b.configuration.cases.value=[],{valid:!0};const P=new Set(d);b.configuration.cases.value=Array.from(P)}return{valid:!0}},extraProcessor(b,d,P,G,W){const i=W[0];return i.dataInputs.forEach((b=>{"default"!==b.name&&"case"!==b.name&&(b.name="in_"+b.name)})),i.config||(i.config={}),i.config.treatCasesAsIntegers=!0,W}},"debug/log":{xx:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function HP(b){let d=arguments.length>2?arguments[2]:void 0;return{xx:[b],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((b,d)=>(b[d]={name:d},b)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(b,P,G,W,i){var q;if(d){(q=i[0]).config||(q.config={}),i[0].config.preventIntegerFloatArithmetic=!0;let d=-1;Object.keys(b.values||{}).find((P=>{var G;return void 0!==(null===(G=b.values)||void 0===G?void 0:G[P].type)&&(d=b.values[P].type,!0)})),-1!==d&&(i[0].config.type=W.arrays.types[d].flowGraphType)}return i},validation:b=>d?pP(b):{valid:!0}}}function pP(b){if(b.values){const d=Object.keys(b.values).map((d=>b.values[d].type)).filter((b=>void 0!==b));if(!d.every((b=>b===d[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}UP["math/compose"]=UP["math/matCompose"],UP["math/decompose"]=UP["math/matDecompose"];var SP=P(11643);const lP={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"ed",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class NP{constructor(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=b,this._gltf=d,this._animationTargetFps=P,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const b of this._interactivityGraph.types)this._types.push(lP[b.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const b of this._interactivityGraph.declarations){const d=MP(b);if(!d)throw t.e.Error(["No mapping found for declaration",b]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:d,fullOperationName:b.extension?b.op+":"+b.extension:b.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const b of this._interactivityGraph.variables){const d=this._parseVariable(b);this._staticVariables.push(d)}}_parseVariable(b,d){const P=this._types[b.type];if(!P)throw t.e.Error(["No type found for variable",b]),new Error("Error parsing variables");if(b.value&&b.value.length!==P.length)throw t.e.Error(["Invalid value length for variable",b,P]),new Error("Error parsing variables");const G=b.value||[];if(!G.length)switch(P.flowGraphType){case"boolean":G.push(!1);break;case"FlowGraphInteger":G.push(0);break;case"number":G.push(NaN);break;case"Vector2":G.push(NaN,NaN);break;case"ed":G.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":G.fill(NaN,0,4);break;case"Matrix":G.fill(NaN,0,16);break;case"Matrix3D":G.fill(NaN,0,9)}return"number"===P.elementType&&"string"===typeof G[0]&&(G[0]=parseFloat(G[0])),{type:P.flowGraphType,value:d?d(G,this):G}}_parseEvents(){if(this._interactivityGraph.events)for(const b of this._interactivityGraph.events){const d={eventId:b.id||"internalEvent_"+this._internalEventsCounter++};b.values&&(d.eventData=Object.keys(b.values).map((d=>{var P;const G=null===(P=b.values)||void 0===P?void 0:P[d];if(!G)throw t.e.Error(["No value found for event key",d]),new Error("Error parsing events");const W=this._types[G.type];if(!W)throw t.e.Error(["No type found for event value",G]),new Error("Error parsing events");const i="undefined"!==typeof G.value?this._parseVariable(G):void 0;return{id:d,type:W.flowGraphType,eventData:!0,value:i}}))),this._events.push(d)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const d of this._interactivityGraph.nodes){if("number"!==typeof d.declaration)throw t.e.Error(["No declaration found for node",d]),new Error("Error parsing nodes");const P=this._mappings[d.declaration];if(!P)throw t.e.Error(["No mapping found for node",d]),new Error("Error parsing nodes");if(P.flowGraphMapping.validation){const G=P.flowGraphMapping.validation(d,this._interactivityGraph,this._gltf);var b;if(!G.valid)throw new Error(`Error validating interactivity node ${null===(b=this._interactivityGraph.declarations)||void 0===b?void 0:b[d.declaration].op} - ${G.error}`)}const G=[];for(const b of P.flowGraphMapping.xx){const W=this._getEmptyBlock(b,P.fullOperationName);this._parseNodeConfiguration(d,W,P.flowGraphMapping,b),G.push(W)}this._nodes.push({xx:G,fullOperationName:P.fullOperationName})}}_getEmptyBlock(b,d){return{uniqueId:(0,SP.e)(),className:b,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:d,metadata:{}}}_parseNodeConfiguration(b,d,P,G){const W=d.config;if(b.configuration){const d=Object.keys(b.configuration);for(const C of d){var i,q;const d=null===(i=b.configuration)||void 0===i?void 0:i[C];if(!d)throw t.e.Error(["No value found for node configuration",C]),new Error("Error parsing node configuration");const J=null===(q=P.configuration)||void 0===q?void 0:q[C];if(J&&J.TP?J.TP===G:0===P.xx.indexOf(G)){const b=(null===J||void 0===J?void 0:J.name)||C;d&&"undefined"!==typeof d.value||"undefined"===typeof(null===J||void 0===J?void 0:J.defaultValue)?d.value.length>=0?W[b]={value:1===d.value.length?d.value[0]:d.value}:t.e.Warn(["Invalid value for node configuration",d]):W[b]={value:J.defaultValue},J&&J.dataTransformer&&(W[b].value=J.dataTransformer([W[b].value],this)[0])}}}}_parseNodeConnections(b){for(let f=0;f<this._nodes.length;f++){var d;const g=null===(d=this._interactivityGraph.nodes)||void 0===d?void 0:d[f];if(!g)throw t.e.Error(["No node found for interactivity node",this._nodes[f]]),new Error("Error parsing node connections");const X=this._nodes[f],u=this._mappings[g.declaration];if(!u)throw t.e.Error(["No mapping found for node",g]),new Error("Error parsing node connections");const M=g.flows||{},e=Object.keys(M).sort();for(const b of e){var P,G,W,i;const d=M[b],L=null===(P=u.flowGraphMapping.outputs)||void 0===P||null===(G=P.flows)||void 0===G?void 0:G[b],x=(null===L||void 0===L?void 0:L.name)||b,Y=this._createNewSocketConnection(x,!0);(L&&L.TP&&X.xx.find((b=>b.className===L.TP))||X.xx[0]).signalOutputs.push(Y);const s=d.node,E=this._nodes[s];if(!E)throw t.e.Error(["No node found for input node id",s]),new Error("Error parsing node connections");const w=uP(E.fullOperationName);if(!w)throw t.e.Error(["No mapping found for input node",E]),new Error("Error parsing node connections");let r=null===(W=w.inputs)||void 0===W||null===(i=W.flows)||void 0===i?void 0:i[d.socket||"in"],B=!1;if(!r)for(const b in null===(q=w.inputs)||void 0===q?void 0:q.flows){var q,C,J;if(b.startsWith("[")&&b.endsWith("]"))B=!0,r=null===(C=w.inputs)||void 0===C||null===(J=C.flows)||void 0===J?void 0:J[b]}const n=r?B?r.name.replace("$1",d.socket||""):r.name:d.socket||"in",Z=r&&r.TP&&E.xx.find((b=>b.className===r.TP))||E.xx[0];let o=Z.signalInputs.find((b=>b.name===n));o||(o=this._createNewSocketConnection(n),Z.signalInputs.push(o)),o.connectedPointIds.push(Y.uniqueId),Y.connectedPointIds.push(o.uniqueId)}const R=g.values||{},U=Object.keys(R);for(const d of U){var L,x;const P=R[d];let G=null===(L=u.flowGraphMapping.inputs)||void 0===L||null===(x=L.values)||void 0===x?void 0:x[d],W=!1;if(!G)for(const b in null===(Y=u.flowGraphMapping.inputs)||void 0===Y?void 0:Y.values){var Y,s,E;if(b.startsWith("[")&&b.endsWith("]"))W=!0,G=null===(s=u.flowGraphMapping.inputs)||void 0===s||null===(E=s.values)||void 0===E?void 0:E[b]}const i=G?W?G.name.replace("$1",d):G.name:d,q=this._createNewSocketConnection(i);if((G&&G.TP&&X.xx.find((b=>b.className===G.TP))||X.xx[0]).dataInputs.push(q),void 0!==P.value){const d=this._parseVariable(P,G&&G.dataTransformer);b._connectionValues[q.uniqueId]=d}else{if("undefined"===typeof P.node)throw t.e.Error(["Invalid value for value connection",P]),new Error("Error parsing node connections");{var w,r,B;const b=P.node,d=P.socket||"value",G=this._nodes[b];if(!G)throw t.e.Error(["No node found for output socket reference",P]),new Error("Error parsing node connections");const W=uP(G.fullOperationName);if(!W)throw t.e.Error(["No mapping found for output socket reference",P]),new Error("Error parsing node connections");let i=null===(w=W.outputs)||void 0===w||null===(r=w.values)||void 0===r?void 0:r[d],C=!1;if(!i)for(const P in null===(n=W.outputs)||void 0===n?void 0:n.values){var n,Z,o;if(P.startsWith("[")&&P.endsWith("]"))C=!0,i=null===(Z=W.outputs)||void 0===Z||null===(o=Z.values)||void 0===o?void 0:o[P]}const J=i?C?i.name.replace("$1",d):null===(B=i)||void 0===B?void 0:B.name:d,L=i&&i.TP&&G.xx.find((b=>b.className===i.TP))||G.xx[0];let x=L.dataOutputs.find((b=>b.name===J));x||(x=this._createNewSocketConnection(J,!0),L.dataOutputs.push(x)),q.connectedPointIds.push(x.uniqueId),x.connectedPointIds.push(q.uniqueId)}}}if(u.flowGraphMapping.interBlockConnectors)for(const b of u.flowGraphMapping.interBlockConnectors){const d=b.input,P=b.output,G=b.isVariable;this._connectFlowGraphNodes(d,P,X.xx[b.inputBlockIndex],X.xx[b.outputBlockIndex],G)}if(u.flowGraphMapping.extraProcessor){var A;const d=null===(A=this._interactivityGraph.declarations)||void 0===A?void 0:A[g.declaration];if(!d)throw t.e.Error(["No declaration found for extra processor",g]),new Error("Error parsing node connections");X.xx=u.flowGraphMapping.extraProcessor(g,d,u.flowGraphMapping,this,X.xx,b,this._gltf)}}}_createNewSocketConnection(b,d){return{uniqueId:(0,SP.e)(),name:b,_connectionType:d?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(b,d,P,G,W){const i=W?P.dataInputs:P.signalInputs,q=W?G.dataOutputs:G.signalOutputs,C=i.find((d=>d.name===b))||this._createNewSocketConnection(b),J=q.find((b=>b.name===d))||this._createNewSocketConnection(d,!0);i.find((d=>d.name===b))||i.push(C),q.find((b=>b.name===d))||q.push(J),C.connectedPointIds.push(J.uniqueId),J.connectedPointIds.push(C.uniqueId)}getVariableName(b){return"staticVariable_"+b}serializeToFlowGraph(){const b={uniqueId:(0,SP.e)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(b);for(let d=0;d<this._staticVariables.length;d++){const P=this._staticVariables[d];b._userVariables[this.getVariableName(d)]=P}return{rightHanded:!0,allBlocks:this._nodes.reduce(((b,d)=>b.concat(d.xx)),[]),executionContexts:[b]}}}const jP="KHR_interactivity";class aP{constructor(b){this._loader=b,this.name=jP,this.enabled=this._loader.isExtensionUsed(jP),this._pathConverter=(0,O.h)(this._loader.fd),b._skipStartAnimationStep=!0;const d=b.babylonScene;d&&function(b){(0,O.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!b.activeCamera)return new W.Quaternion(NaN,NaN,NaN,NaN);const d=W.Quaternion.FromRotationMatrix(b.activeCamera.getWorldMatrix()).normalize();return b.useRightHandedSystem||(d.w*=-1,d.x*=-1),d},type:"Quaternion",getTarget:()=>b.activeCamera}),(0,O.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!b.activeCamera)return new W.ed(NaN,NaN,NaN);const d=b.activeCamera.getWorldMatrix().getTranslation();return b.useRightHandedSystem||(d.x*=-1),d},type:"ed",getTarget:()=>b.activeCamera}),(0,O.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:b=>{var d;return(null===(d=b._babylonAnimationGroup)||void 0===d?void 0:d.isPlaying)??!1},type:"boolean",getTarget:b=>b._babylonAnimationGroup}),(0,O.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:b=>{var d;return((null===(d=b._babylonAnimationGroup)||void 0===d?void 0:d.from)??0)/60},type:"number",getTarget:b=>b._babylonAnimationGroup}),(0,O.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:b=>{var d;return((null===(d=b._babylonAnimationGroup)||void 0===d?void 0:d.to)??0)/60},type:"number",getTarget:b=>b._babylonAnimationGroup}),(0,O.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:b=>{var d;return((null===(d=b._babylonAnimationGroup)||void 0===d?void 0:d.getCurrentFrame())??0)/60},type:"number",getTarget:b=>b._babylonAnimationGroup}),(0,O.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:b=>{var d;return((null===(d=b._babylonAnimationGroup)||void 0===d?void 0:d.getCurrentFrame())??0)/60},type:"number",getTarget:b=>b._babylonAnimationGroup})}(d)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var b;if(!this._loader.babylonScene||!this._pathConverter)return;const d=this._loader.babylonScene,P=null===(b=this._loader.fd.extensions)||void 0===b?void 0:b.KHR_interactivity;if(!P)return;const G=new wP.e({Hd:d});G.dispatchEventsSynchronously=!1;const W=P.graphs.map((b=>new NP(b,this._loader.fd,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(W.map((async b=>await fP(b,{coordinator:G,pathConverter:this._pathConverter})))),G.start()}}var OP;OP=async()=>(await Promise.resolve().then(P.bind(P,13417))).FlowGraphGLTFDataProvider,tP[`${jP}/${"FlowGraphGLTFDataProvider"}`]=OP,a(jP),j(jP,!0,(b=>new aP(b)));const VP="KHR_node_visibility";(0,O.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:b=>{const d=b._babylonTransformNode;return!d||void 0===d.isVisible||d.isVisible},set:(b,d)=>{var P,G;null===(P=d._primitiveBabylonMeshes)||void 0===P||P.forEach((b=>{b.inheritVisibility=!0})),d._babylonTransformNode&&(d._babylonTransformNode.isVisible=b),null===(G=d._primitiveBabylonMeshes)||void 0===G||G.forEach((d=>{d.isVisible=b}))},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class yP{constructor(b){this.name=VP,this._loader=b,this.enabled=b.isExtensionUsed(VP)}async onReady(){var b;null===(b=this._loader.fd.nodes)||void 0===b||b.forEach((b=>{var d,P,G,W;(null===(d=b._primitiveBabylonMeshes)||void 0===d||d.forEach((b=>{b.inheritVisibility=!0})),null!==(P=b.extensions)&&void 0!==P&&P.KHR_node_visibility)&&(!1===(null===(G=b.extensions)||void 0===G?void 0:G.KHR_node_visibility.visible)&&(b._babylonTransformNode&&(b._babylonTransformNode.isVisible=!1),null===(W=b._primitiveBabylonMeshes)||void 0===W||W.forEach((b=>{b.isVisible=!1}))))}))}dispose(){this._loader=null}}a(VP),j(VP,!0,(b=>new yP(b)));const cP="KHR_node_selectability";eP("event/onSelect",cP,{xx:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",TP:"FlowGraphGetVariableBlock",dataTransformer:b=>["pickedMesh_"+b[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",TP:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(b,d,P,G,W,i,q){var C,J,L,x,Y,s;const E=W[W.length-1];E.config=E.config||{},E.config.glTF=q;const w=null===(C=b.configuration)||void 0===C||null===(J=C.nodeIndex)||void 0===J?void 0:J.value[0];if(void 0===w||"number"!==typeof w)throw new Error("nodeIndex not found in configuration");const t="pickedMesh_"+w;return W[1].config.variable=t,i._userVariables[t]={className:"Mesh",id:null===q||void 0===q||null===(L=q.nodes)||void 0===L||null===(x=L[w]._babylonTransformNode)||void 0===x?void 0:x.id,uniqueId:null===q||void 0===q||null===(Y=q.nodes)||void 0===Y||null===(s=Y[w]._babylonTransformNode)||void 0===s?void 0:s.uniqueId},W}}),(0,O.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:b=>{const d=b._babylonTransformNode;return!d||void 0===d.lJ||d.lJ},set:(b,d)=>{var P;null===(P=d._primitiveBabylonMeshes)||void 0===P||P.forEach((d=>{d.lJ=b}))},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"lJ"],type:"boolean"});class DP{constructor(b){this.name=cP,this._loader=b,this.enabled=b.isExtensionUsed(cP)}async onReady(){var b;null===(b=this._loader.fd.nodes)||void 0===b||b.forEach((b=>{var d,P,G;null!==(d=b.extensions)&&void 0!==d&&d.KHR_node_selectability&&!1===(null===(P=b.extensions)||void 0===P?void 0:P.KHR_node_selectability.selectable)&&(null===(G=b._babylonTransformNode)||void 0===G||G.getChildMeshes().forEach((b=>{b.lJ=!1})))}))}dispose(){this._loader=null}}a(cP),j(cP,!0,(b=>new DP(b)));const zP="KHR_node_hoverability",QP="targetMeshPointerOver_";eP("event/onHoverIn",zP,{xx:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",TP:"FlowGraphGetVariableBlock",dataTransformer:b=>[QP+b[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",TP:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(b,d,P,G,W,i,q){var C,J,L,x,Y,s;const E=W[W.length-1];E.config=E.config||{},E.config.glTF=q;const w=null===(C=b.configuration)||void 0===C||null===(J=C.nodeIndex)||void 0===J?void 0:J.value[0];if(void 0===w||"number"!==typeof w)throw new Error("nodeIndex not found in configuration");const t=QP+w;return W[1].config.variable=t,i._userVariables[t]={className:"Mesh",id:null===q||void 0===q||null===(L=q.nodes)||void 0===L||null===(x=L[w]._babylonTransformNode)||void 0===x?void 0:x.id,uniqueId:null===q||void 0===q||null===(Y=q.nodes)||void 0===Y||null===(s=Y[w]._babylonTransformNode)||void 0===s?void 0:s.uniqueId},W}});const IP="targetMeshPointerOut_";eP("event/onHoverOut",zP,{xx:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",TP:"FlowGraphGetVariableBlock",dataTransformer:b=>[IP+b[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",TP:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(b,d,P,G,W,i,q){var C,J,L,x,Y,s;const E=W[W.length-1];E.config=E.config||{},E.config.glTF=q;const w=null===(C=b.configuration)||void 0===C||null===(J=C.nodeIndex)||void 0===J?void 0:J.value[0];if(void 0===w||"number"!==typeof w)throw new Error("nodeIndex not found in configuration");const t=IP+w;return W[1].config.variable=t,i._userVariables[t]={className:"Mesh",id:null===q||void 0===q||null===(L=q.nodes)||void 0===L||null===(x=L[w]._babylonTransformNode)||void 0===x?void 0:x.id,uniqueId:null===q||void 0===q||null===(Y=q.nodes)||void 0===Y||null===(s=Y[w]._babylonTransformNode)||void 0===s?void 0:s.uniqueId},W}}),(0,O.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:b=>{const d=b._babylonTransformNode;return!d||void 0===d.pointerOverDisableMeshTesting||d.pointerOverDisableMeshTesting},set:(b,d)=>{var P;null===(P=d._primitiveBabylonMeshes)||void 0===P||P.forEach((d=>{d.pointerOverDisableMeshTesting=!b}))},getTarget:b=>b._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class mP{constructor(b){this.name=zP,this._loader=b,this.enabled=b.isExtensionUsed(zP)}async onReady(){var b;null===(b=this._loader.fd.nodes)||void 0===b||b.forEach((b=>{var d,P,G;null!==(d=b.extensions)&&void 0!==d&&d.KHR_node_hoverability&&!1===(null===(P=b.extensions)||void 0===P?void 0:P.KHR_node_hoverability.hoverable)&&(null===(G=b._babylonTransformNode)||void 0===G||G.getChildMeshes().forEach((b=>{b.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}a(zP),j(zP,!0,(b=>new mP(b)));const vP="ExtrasAsMetadata";class FP{_assignExtras(b,d){if(d.extras&&Object.keys(d.extras).length>0){const P=b.metadata=b.metadata||{};(P.fd=P.fd||{}).extras=d.extras}}constructor(b){this.name=vP,this.enabled=!0,this._loader=b}dispose(){this._loader=null}loadNodeAsync(b,d,P){return this._loader.loadNodeAsync(b,d,(b=>{this._assignExtras(b,d),P(b)}))}loadCameraAsync(b,d,P){return this._loader.loadCameraAsync(b,d,(b=>{this._assignExtras(b,d),P(b)}))}createMaterial(b,d,P){const G=this._loader.createMaterial(b,d,P);return this._assignExtras(G,d),G}}a(vP),j(vP,!1,(b=>new FP(b)));P(13417)},13299:(b,d,P)=>{"use strict";P.d(d,{b:()=>p,c:()=>u,e:()=>X,h:()=>M});var G=P(11487),W=P(11484),i=P(12934),q=P(12134),C=P(12103),J=P(12115),L=P(11504),x=P(11535),Y=P(12126),s=P(12220),E=P(12139),w=P(11722);class t{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.kY=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.ls=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(b){this._environmentTexture=b}getNodes(){let b=[];b=b.concat(this.meshes),b=b.concat(this.lights),b=b.concat(this.cameras),b=b.concat(this.transformNodes);for(const d of this.skeletons)b=b.concat(d.bones);return b}}class r extends t{}class B{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const b=this.rootNodes;for(const G of b)G.dispose();b.length=0;const d=this.skeletons;for(const G of d)G.dispose();d.length=0;const P=this.animationGroups;for(const G of P)G.dispose();P.length=0}}class n extends t{constructor(b){super(),this._wasAddedToScene=!1,(b=b||x.e.LastCreatedScene)&&(this.Hd=b,this.proceduralTextures=[],b.Zd.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=b.getEngine().onContextRestoredObservable.add((()=>{for(const b of this.geometries)b._rebuild();for(const b of this.meshes)b._rebuild();for(const b of this.kY)b.rebuild();for(const b of this.textures)b._rebuild()})))}_topologicalSort(b){const d=new Map;for(const q of b)d.set(q.uniqueId,q);const P={dependsOn:new Map,dependedBy:new Map};for(const q of b){const b=q.uniqueId;P.dependsOn.set(b,new Set),P.dependedBy.set(b,new Set)}for(const q of b){const b=q.uniqueId,G=P.dependsOn.get(b);if(q instanceof Y.d){const W=q.sourceMesh;d.has(W.uniqueId)&&(G.add(W.uniqueId),P.dependedBy.get(W.uniqueId).add(b))}const W=P.dependedBy.get(b);for(const i of q.getDescendants()){const G=i.uniqueId;if(d.has(G)){W.add(G);P.dependsOn.get(G).add(b)}}}const G=[],W=[];for(const q of b){const b=q.uniqueId;0===P.dependsOn.get(b).size&&(W.push(q),d.delete(b))}const i=W;for(;i.length>0;){const b=i.shift();G.push(b);const W=P.dependedBy.get(b.uniqueId);for(const G of Array.from(W.values())){const W=P.dependsOn.get(G);W.delete(b.uniqueId),0===W.size&&d.get(G)&&(i.push(d.get(G)),d.delete(G))}}return d.size>0&&(L.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),d.forEach((b=>{L.e.Error(b.name)}))),G}_addNodeAndDescendantsToList(b,d,P,G){if(P&&(!G||G(P))&&!d.has(P.uniqueId)){b.push(P),d.add(P.uniqueId);for(const W of P.getDescendants(!0))this._addNodeAndDescendantsToList(b,d,W,G)}}_isNodeInContainer(b){return b instanceof J.d&&-1!==this.meshes.indexOf(b)||(b instanceof C.b&&-1!==this.transformNodes.indexOf(b)||(b instanceof s.d&&-1!==this.lights.indexOf(b)||b instanceof E.c&&-1!==this.cameras.indexOf(b)))}_isValidHierarchy(){for(const b of this.meshes)if(b.parent&&!this._isNodeInContainer(b.parent))return L.e.Warn(`Node ${b.name} has a parent that is not in the container.`),!1;for(const b of this.transformNodes)if(b.parent&&!this._isNodeInContainer(b.parent))return L.e.Warn(`Node ${b.name} has a parent that is not in the container.`),!1;for(const b of this.lights)if(b.parent&&!this._isNodeInContainer(b.parent))return L.e.Warn(`Node ${b.name} has a parent that is not in the container.`),!1;for(const b of this.cameras)if(b.parent&&!this._isNodeInContainer(b.parent))return L.e.Warn(`Node ${b.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(b){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],P=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||W.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const G={},i={},C=new B,J=[],L=[],x={doNotInstantiate:!0,...P},Y=[],s=new Set;for(const W of this.transformNodes)null===W.parent&&this._addNodeAndDescendantsToList(Y,s,W,x.predicate);for(const W of this.meshes)null===W.parent&&this._addNodeAndDescendantsToList(Y,s,W,x.predicate);const E=this._topologicalSort(Y),w=(P,W)=>{if(((d,P)=>{if(G[d.uniqueId]=P.uniqueId,i[P.uniqueId]=P,b&&(P.name=b(d.name)),P instanceof q.d){const b=P;if(b.morphTargetManager){const P=d.morphTargetManager;b.morphTargetManager=P.clone();for(let d=0;d<P.numTargets;d++){const W=P.getTarget(d),q=b.morphTargetManager.getTarget(d);G[W.uniqueId]=q.uniqueId,i[q.uniqueId]=q}}}})(P,W),P.parent){const b=G[P.parent.uniqueId],d=i[b];W.parent=d||P.parent}if(W.position&&P.position&&W.position.q(P.position),W.rotationQuaternion&&P.rotationQuaternion&&W.rotationQuaternion.q(P.rotationQuaternion),W.rotation&&P.rotation&&W.rotation.q(P.rotation),W.hd&&P.hd&&W.hd.q(P.hd),W.material){const q=W;if(q.material)if(d){const d=P.material;if(-1===L.indexOf(d)){let P=d.clone(b?b(d.name):"Clone of "+d.name);if(L.push(d),G[d.uniqueId]=P.uniqueId,i[P.uniqueId]=P,"MultiMaterial"===d.getClassName()){const W=d;for(const d of W.qq)d&&(P=d.clone(b?b(d.name):"Clone of "+d.name),L.push(d),G[d.uniqueId]=P.uniqueId,i[P.uniqueId]=P);W.qq=W.qq.map((b=>b&&i[G[b.uniqueId]]))}}"InstancedMesh"!==q.getClassName()&&(q.material=i[G[d.uniqueId]])}else"MultiMaterial"===q.material.getClassName()?-1===this.Hd.multiMaterials.indexOf(q.material)&&this.Hd.addMultiMaterial(q.material):-1===this.Hd.materials.indexOf(q.material)&&this.Hd.addMaterial(q.material)}null===W.parent&&C.rootNodes.push(W)};for(const W of E)if("InstancedMesh"===W.getClassName()){const b=W,d=b.sourceMesh,P=G[d.uniqueId];w(b,("number"===typeof P?i[P]:d).createInstance(b.name))}else{let b=!0;"mw"===W.getClassName()||"Node"===W.getClassName()||W.skeleton||!W.getTotalVertices||0===W.getTotalVertices()?b=!1:x.doNotInstantiate&&(b="function"===typeof x.doNotInstantiate?!x.doNotInstantiate(W):!x.doNotInstantiate);const d=b?W.createInstance(`instance of ${W.name}`):W.clone(`Clone of ${W.name}`,null,!0);if(!d)throw new Error(`Could not clone or instantiate node on Asset Container ${W.name}`);w(W,d)}for(const W of this.skeletons){if(x.predicate&&!x.predicate(W))continue;const d=W.clone(b?b(W.name):"Clone of "+W.name);for(const b of this.meshes)if(b.skeleton===W&&!b.isAnInstance){const P=i[G[b.uniqueId]];if(!P||P.isAnInstance)continue;if(P.skeleton=d,-1!==J.indexOf(d))continue;J.push(d);for(const b of d.bones)b._linkedTransformNode&&(b._linkedTransformNode=i[G[b._linkedTransformNode.uniqueId]])}C.skeletons.push(d)}for(const W of this.animationGroups){if(x.predicate&&!x.predicate(W))continue;const d=W.clone(b?b(W.name):"Clone of "+W.name,(b=>i[G[b.uniqueId]]||b));C.animationGroups.push(d)}return C}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||W.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Hd.environmentTexture=this.environmentTexture);for(const b of this.Hd._serializableComponents)b.addFromContainer(this);this.Hd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const d=[];for(const P of this.cameras)b&&!b(P)||(this.Hd.addCamera(P),d.push(P));for(const P of this.lights)b&&!b(P)||(this.Hd.addLight(P),d.push(P));for(const P of this.meshes)b&&!b(P)||(this.Hd.TL(P),d.push(P));for(const P of this.skeletons)b&&!b(P)||this.Hd.addSkeleton(P);for(const P of this.animations)b&&!b(P)||this.Hd.addAnimation(P);for(const P of this.animationGroups)b&&!b(P)||this.Hd.addAnimationGroup(P);for(const P of this.multiMaterials)b&&!b(P)||this.Hd.addMultiMaterial(P);for(const P of this.materials)b&&!b(P)||this.Hd.addMaterial(P);for(const P of this.morphTargetManagers)b&&!b(P)||this.Hd.addMorphTargetManager(P);for(const P of this.geometries)b&&!b(P)||this.Hd.addGeometry(P);for(const P of this.transformNodes)b&&!b(P)||(this.Hd.addTransformNode(P),d.push(P));for(const P of this.actionManagers)b&&!b(P)||this.Hd.addActionManager(P);for(const P of this.textures)b&&!b(P)||this.Hd.addTexture(P);for(const P of this.reflectionProbes)b&&!b(P)||this.Hd.addReflectionProbe(P);for(const P of d)P.parent&&-1===this.Hd.getNodes().indexOf(P.parent)&&(P.setParent?P.setParent(null):P.parent=null)}removeAllFromScene(){this._isValidHierarchy()||W.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Hd.environmentTexture&&(this.Hd.environmentTexture=null);for(const b of this.Hd._serializableComponents)b.removeFromContainer(this)}removeFromScene(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const d of this.cameras)b&&!b(d)||this.Hd.removeCamera(d);for(const d of this.lights)b&&!b(d)||this.Hd.removeLight(d);for(const d of this.meshes)b&&!b(d)||this.Hd.hL(d,!0);for(const d of this.skeletons)b&&!b(d)||this.Hd.removeSkeleton(d);for(const d of this.animations)b&&!b(d)||this.Hd.removeAnimation(d);for(const d of this.animationGroups)b&&!b(d)||this.Hd.removeAnimationGroup(d);for(const d of this.multiMaterials)b&&!b(d)||this.Hd.removeMultiMaterial(d);for(const d of this.materials)b&&!b(d)||this.Hd.removeMaterial(d);for(const d of this.morphTargetManagers)b&&!b(d)||this.Hd.removeMorphTargetManager(d);for(const d of this.geometries)b&&!b(d)||this.Hd.removeGeometry(d);for(const d of this.transformNodes)b&&!b(d)||this.Hd.removeTransformNode(d);for(const d of this.actionManagers)b&&!b(d)||this.Hd.removeActionManager(d);for(const d of this.textures)b&&!b(d)||this.Hd.removeTexture(d);for(const d of this.reflectionProbes)b&&!b(d)||this.Hd.removeReflectionProbe(d)}dispose(){const b=this.cameras.slice(0);for(const E of b)E.dispose();this.cameras.length=0;const d=this.lights.slice(0);for(const E of d)E.dispose();this.lights.length=0;const P=this.meshes.slice(0);for(const E of P)E.dispose();this.meshes.length=0;const G=this.skeletons.slice(0);for(const E of G)E.dispose();this.skeletons.length=0;const W=this.animationGroups.slice(0);for(const E of W)E.dispose();this.animationGroups.length=0;const i=this.multiMaterials.slice(0);for(const E of i)E.dispose();this.multiMaterials.length=0;const q=this.materials.slice(0);for(const E of q)E.dispose();this.materials.length=0;const C=this.geometries.slice(0);for(const E of C)E.dispose();this.geometries.length=0;const J=this.transformNodes.slice(0);for(const E of J)E.dispose();this.transformNodes.length=0;const L=this.actionManagers.slice(0);for(const E of L)E.dispose();this.actionManagers.length=0;const x=this.textures.slice(0);for(const E of x)E.dispose();this.textures.length=0;const Y=this.reflectionProbes.slice(0);for(const E of Y)E.dispose();this.reflectionProbes.length=0;const s=this.morphTargetManagers.slice(0);for(const E of s)E.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const E of this.Hd._serializableComponents)E.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Hd.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(b,d,P){if(b&&d)for(const G of b){let b=!0;if(P)for(const d of P)if(G===d){b=!1;break}b&&(d.push(G),G._parentContainer=this)}}moveAllFromScene(b){this._wasAddedToScene=!1,void 0===b&&(b=new r);for(const d in this)Object.prototype.hasOwnProperty.call(this,d)&&(this[d]=this[d]||("_environmentTexture"===d?null:[]),this._moveAssets(this.Hd[d],this[d],b[d]));this.environmentTexture=this.Hd.environmentTexture,this.removeAllFromScene()}createRootMesh(){const b=new q.d("assetContainerRootMesh",this.Hd);for(const d of this.meshes)d.parent||b.addChild(d);return this.meshes.unshift(b),b}mergeAnimationsTo(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.e.LastCreatedScene,d=arguments.length>1?arguments[1]:void 0,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!b)return L.e.Error("No scene available to merge animations to"),[];const G=P||(d=>{let P=null;const G=d.animations.length?d.animations[0].targetProperty:"",W=d.name.split(".").join("").split("_primitive")[0];switch(G){case"position":case"rotationQuaternion":P=b.getTransformNodeByName(d.name)||b.getTransformNodeByName(W);break;case"influence":P=b.getMorphTargetByName(d.name)||b.getMorphTargetByName(W);break;default:P=b.getNodeByName(d.name)||b.getNodeByName(W)}return P}),W=this.getNodes();for(const C of W){const b=G(C);if(null!==b){for(const d of C.animations){const P=b.animations.filter((b=>b.targetProperty===d.targetProperty));for(const d of P){const P=b.animations.indexOf(d,0);P>-1&&b.animations.splice(P,1)}}b.animations=b.animations.concat(C.animations)}}const i=[],q=this.animationGroups.slice();for(const C of q){i.push(C.clone(C.name,G));for(const b of C.animatables)b.stop()}for(const C of d){const d=G(C.target);d&&(b.beginAnimation(d,C.fromFrame,C.toFrame,C.loopAnimation,C.speedRatio,C.onAnimationEnd?C.onAnimationEnd:void 0,void 0,!0,void 0,C.onAnimationLoop?C.onAnimationLoop:void 0),b.stopAnimation(C.target))}return i}populateRootNodes(){this.rootNodes.length=0;for(const b of this.meshes)b.parent||-1!==this.rootNodes.indexOf(b)||this.rootNodes.push(b);for(const b of this.transformNodes)b.parent||-1!==this.rootNodes.indexOf(b)||this.rootNodes.push(b);for(const b of this.lights)b.parent||-1!==this.rootNodes.indexOf(b)||this.rootNodes.push(b);for(const b of this.cameras)b.parent||-1!==this.rootNodes.indexOf(b)||this.rootNodes.push(b)}addAllAssetsToContainer(b){if(!b)return;const d=[],P=new Set;for(d.push(b);d.length>0;){const b=d.pop();if(b instanceof q.d?(b.Qd&&-1===this.geometries.indexOf(b.Qd)&&this.geometries.push(b.Qd),this.meshes.push(b)):b instanceof Y.d?this.meshes.push(b):b instanceof C.b?this.transformNodes.push(b):b instanceof s.d?this.lights.push(b):b instanceof E.c&&this.cameras.push(b),b instanceof J.d){if(b.material&&-1===this.materials.indexOf(b.material)){this.materials.push(b.material);for(const d of b.material.getActiveTextures())-1===this.textures.indexOf(d)&&this.textures.push(d)}b.skeleton&&-1===this.skeletons.indexOf(b.skeleton)&&this.skeletons.push(b.skeleton),b.morphTargetManager&&-1===this.morphTargetManagers.indexOf(b.morphTargetManager)&&this.morphTargetManagers.push(b.morphTargetManager)}for(const G of b.getChildren())P.has(G)||d.push(G);P.add(b)}this.populateRootNodes()}_getByTags(b,d,P){if(void 0===d)return b;const G=[];for(const W in b){const i=b[W];w.c&&w.c.MatchesQuery(i,d)&&(!P||P(i))&&G.push(i)}return G}getMeshesByTags(b,d){return this._getByTags(this.meshes,b,d)}getCamerasByTags(b,d){return this._getByTags(this.cameras,b,d)}getLightsByTags(b,d){return this._getByTags(this.lights,b,d)}getMaterialsByTags(b,d){return this._getByTags(this.materials,b,d).concat(this._getByTags(this.multiMaterials,b,d))}getTransformNodesByTags(b,d){return this._getByTags(this.transformNodes,b,d)}}var Z=P(11551);class o{constructor(b){this.byteOffset=0,this.buffer=b}async loadAsync(b){const d=await this.buffer.readAsync(this.byteOffset,b);this._dataView=new DataView(d.buffer,d.byteOffset,d.byteLength),this._dataByteOffset=0}readUint32(){const b=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,b}readUint8Array(b){const d=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,b);return this._dataByteOffset+=b,this.byteOffset+=b,d}readString(b){return(0,Z.k)(this.readUint8Array(b))}skipBytes(b){this._dataByteOffset+=b,this.byteOffset+=b}}var A=P(13306);const f="Z2xURg",g={name:"fd",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:b=>-1!==b.indexOf("asset")&&-1!==b.indexOf("version")||b.startsWith("data:base64,"+f)||b.startsWith("data:;base64,"+f)||b.startsWith("data:application/octet-stream;base64,"+f)||b.startsWith("data:model/gltf-binary;base64,"+f)};var X,u,M,e=P(11539),R=P(11546);function U(b,d,P){try{return Promise.resolve(new Uint8Array(b,d,P))}catch(G){return Promise.reject(G)}}!function(b){b[b.AUTO=0]="AUTO",b[b.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(X||(X={})),function(b){b[b.NONE=0]="NONE",b[b.FIRST=1]="FIRST",b[b.ALL=2]="ALL"}(u||(u={})),function(b){b[b.LOADING=0]="LOADING",b[b.READY=1]="READY",b[b.COMPLETE=2]="COMPLETE"}(M||(M={}));class H{constructor(){this.coordinateSystemMode=X.AUTO,this.animationStartMode=u.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=b=>Promise.resolve(b),this.extensionOptions={}}q(b){b&&(this.onParsed=b.onParsed,this.coordinateSystemMode=b.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=b.animationStartMode??this.animationStartMode,this.loadNodeAnimations=b.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=b.loadSkins??this.loadSkins,this.loadMorphTargets=b.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=b.compileMaterials??this.compileMaterials,this.useClipPlane=b.useClipPlane??this.useClipPlane,this.compileShadowGenerators=b.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=b.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=b.useRangeRequests??this.useRangeRequests,this.createInstances=b.createInstances??this.createInstances,this.alwaysComputeBoundingBox=b.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=b.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=b.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=b.skipMaterials??this.skipMaterials,this.useSRGBBuffers=b.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=b.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=b.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=b.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=b.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=b.customRootNode,this.onMeshLoaded=b.onMeshLoaded,this.onSkinLoaded=b.onSkinLoaded,this.onTextureLoaded=b.onTextureLoaded,this.onMaterialLoaded=b.onMaterialLoaded,this.onCameraLoaded=b.onCameraLoaded,this.extensionOptions=b.extensionOptions??this.extensionOptions)}}class p extends H{constructor(b){super(),this.onParsedObservable=new G.d,this.onMeshLoadedObservable=new G.d,this.onSkinLoadedObservable=new G.d,this.onTextureLoadedObservable=new G.d,this.onMaterialLoadedObservable=new G.d,this.onCameraLoadedObservable=new G.d,this.onCompleteObservable=new G.d,this.onErrorObservable=new G.d,this.Zd=new G.d,this.onExtensionLoadedObservable=new G.d,this.validate=!1,this.onValidatedObservable=new G.d,this._loader=null,this._state=null,this._requests=new Array,this.name=g.name,this.extensions=g.extensions,this.onLoaderStateChangedObservable=new G.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.q(b)}set onParsed(b){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),b&&(this._onParsedObserver=this.onParsedObservable.add(b))}set onMeshLoaded(b){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),b&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(b))}set onSkinLoaded(b){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),b&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((d=>b(d.node,d.skinnedNode))))}set onTextureLoaded(b){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),b&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(b))}set onMaterialLoaded(b){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),b&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(b))}set onCameraLoaded(b){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),b&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(b))}set onComplete(b){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(b)}set onError(b){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(b)}set onDispose(b){this._onDisposeObserver&&this.Zd.remove(this._onDisposeObserver),this._onDisposeObserver=this.Zd.add(b)}set onExtensionLoaded(b){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(b)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(b){this._loggingEnabled!==b&&(this._loggingEnabled=b,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(b){this._capturePerformanceCounters!==b&&(this._capturePerformanceCounters=b,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(b){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(b)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const b of this._requests)b.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=b=>Promise.resolve(b),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Zd.notifyObservers(void 0),this.Zd.clear()}loadFile(b,d,P,i,q,C,J,x){if(ArrayBuffer.isView(d))return this._loadBinary(b,d,P,i,J,x),null;this._progressCallback=q;const Y=d.name||W.Tools.GetFilename(d);if(C){if(this.useRangeRequests){this.validate&&L.e.Warn("glTF validation is not supported when range requests are enabled");const P={abort:()=>{},onCompleteObservable:new G.d},W={readAsync:(P,G)=>new Promise(((W,i)=>{this._loadFile(b,d,(b=>{W(new Uint8Array(b))}),!0,(b=>{i(b)}),(b=>{b.setRequestHeader("Range",`bytes=${P}-${P+G-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new o(W)).then((b=>{P.onCompleteObservable.notifyObservers(P),i(b)}),J?b=>J(void 0,b):void 0),P}return this._loadFile(b,d,(d=>{this._validate(b,new Uint8Array(d,0,d.byteLength),P,Y),this._unpackBinaryAsync(new o({readAsync:(b,P)=>U(d,b,P),byteLength:d.byteLength})).then((b=>{i(b)}),J?b=>J(void 0,b):void 0)}),!0,J)}return this._loadFile(b,d,(d=>{try{this._validate(b,d,P,Y),i({json:this._parseJson(d)})}catch{J&&J()}}),!1,J)}_loadBinary(b,d,P,G,W,i){this._validate(b,new Uint8Array(d.buffer,d.byteOffset,d.byteLength),P,i),this._unpackBinaryAsync(new o({readAsync:(b,P)=>function(b,d,P){try{if(d<0||d>=b.byteLength)throw new RangeError("Offset is out of range.");if(d+P>b.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(b.buffer,b.byteOffset+d,P))}catch(G){return Promise.reject(G)}}(d,b,P),byteLength:d.byteLength})).then((b=>{G(b)}),W?b=>W(void 0,b):void 0)}importMeshAsync(b,d,P,G,W,i){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(P),this.onParsedObservable.clear(),this._log(`Loading ${i||""}`),this._loader=this._getLoader(P),this._loader.importMeshAsync(b,d,null,P,G,W,i))))}loadAsync(b,d,P,G,W){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(d),this.onParsedObservable.clear(),this._log(`Loading ${W||""}`),this._loader=this._getLoader(d),this._loader.loadAsync(b,d,P,G,W))))}loadAssetContainerAsync(b,d,P,G,W){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(d),this.onParsedObservable.clear(),this._log(`Loading ${W||""}`),this._loader=this._getLoader(d);const i=new n(b),q=[];this.onMaterialLoadedObservable.add((b=>{q.push(b)}));const C=[];this.onTextureLoadedObservable.add((b=>{C.push(b)}));const J=[];this.onCameraLoadedObservable.add((b=>{J.push(b)}));const L=[];return this.onMeshLoadedObservable.add((b=>{b.morphTargetManager&&L.push(b.morphTargetManager)})),this._loader.importMeshAsync(null,b,i,d,P,G,W).then((b=>(Array.prototype.push.apply(i.geometries,b.geometries),Array.prototype.push.apply(i.meshes,b.meshes),Array.prototype.push.apply(i.kY,b.kY),Array.prototype.push.apply(i.skeletons,b.skeletons),Array.prototype.push.apply(i.animationGroups,b.animationGroups),Array.prototype.push.apply(i.materials,q),Array.prototype.push.apply(i.textures,C),Array.prototype.push.apply(i.lights,b.lights),Array.prototype.push.apply(i.transformNodes,b.transformNodes),Array.prototype.push.apply(i.cameras,J),Array.prototype.push.apply(i.morphTargetManagers,L),i)))}))}canDirectLoad(b){return g.canDirectLoad(b)}directLoad(b,d){if(d.startsWith("base64,"+f)||d.startsWith(";base64,"+f)||d.startsWith("application/octet-stream;base64,"+f)||d.startsWith("model/gltf-binary;base64,"+f)){const P=(0,e.d)(d);return this._validate(b,new Uint8Array(P,0,P.byteLength)),this._unpackBinaryAsync(new o({readAsync:(b,d)=>U(P,b,d),byteLength:P.byteLength}))}return this._validate(b,d),Promise.resolve({json:this._parseJson(d)})}createPlugin(b){return new p(b[g.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((b,d)=>{this.onCompleteObservable.addOnce((()=>{b()})),this.onErrorObservable.addOnce((b=>{d(b)}))}))}_setState(b){this._state!==b&&(this._state=b,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(M[this._state]))}_loadFile(b,d,P,G,W,i){const q=b._loadFile(d,P,(b=>{this._onProgress(b,q)}),!0,G,W,i);return q.onCompleteObservable.add((()=>{q._lengthComputable=!0,q._total=q._loaded})),this._requests.push(q),q}_onProgress(b,d){if(!this._progressCallback)return;d._lengthComputable=b.lengthComputable,d._loaded=b.loaded,d._total=b.total;let P=!0,G=0,W=0;for(const i of this._requests){if(void 0===i._lengthComputable||void 0===i._loaded||void 0===i._total)return;P=P&&i._lengthComputable,G+=i._loaded,W+=i._total}this._progressCallback({lengthComputable:P,loaded:G,total:P?W:0})}_validate(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),A.b.ValidateAsync(d,P,G,(d=>this.preprocessUrlAsync(P+d).then((d=>b._loadFileAsync(d,void 0,!0,!0).then((b=>new Uint8Array(b,0,b.byteLength))))))).then((b=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(b),this.onValidatedObservable.clear()}),(b=>{this._endPerformanceCounter("Validate JSON"),W.Tools.Warn(`Failed to validate: ${b.message}`),this.onValidatedObservable.clear()})))}_getLoader(b){const d=b.json.asset||{};this._log(`Asset version: ${d.version}`),d.minVersion&&this._log(`Asset minimum version: ${d.minVersion}`),d.generator&&this._log(`Asset generator: ${d.generator}`);const P=p._parseVersion(d.version);if(!P)throw new Error("Invalid version: "+d.version);if(void 0!==d.minVersion){const b=p._parseVersion(d.minVersion);if(!b)throw new Error("Invalid minimum version: "+d.minVersion);if(p._compareVersion(b,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+d.minVersion)}const G={1:p._CreateGLTF1Loader,2:p._CreateGLTF2Loader}[P.major];if(!G)throw new Error("Unsupported version: "+d.version);return G(this)}_parseJson(b){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${b.length}`);const d=JSON.parse(b);return this._endPerformanceCounter("Parse JSON"),d}_unpackBinaryAsync(b){return this._startPerformanceCounter("Unpack Binary"),b.loadAsync(20).then((()=>{const d=b.readUint32();if(1179937895!==d)throw new R.d("Unexpected magic: "+d,R.c.GLTFLoaderUnexpectedMagicError);const P=b.readUint32();this.loggingEnabled&&this._log(`Binary version: ${P}`);const G=b.readUint32();let W;switch(this.useRangeRequests||G===b.buffer.byteLength||L.e.Warn(`Length in header does not match actual data length: ${G} != ${b.buffer.byteLength}`),P){case 1:W=this._unpackBinaryV1Async(b,G);break;case 2:W=this._unpackBinaryV2Async(b,G);break;default:throw new Error("Unsupported version: "+P)}return this._endPerformanceCounter("Unpack Binary"),W}))}_unpackBinaryV1Async(b,d){const P=b.readUint32(),G=b.readUint32();if(0!==G)throw new Error(`Unexpected content format: ${G}`);const W=d-b.byteOffset,i={json:this._parseJson(b.readString(P)),bin:null};if(0!==W){const d=b.byteOffset;i.bin={readAsync:(P,G)=>b.buffer.readAsync(d+P,G),byteLength:W}}return Promise.resolve(i)}_unpackBinaryV2Async(b,d){const P=1313821514,G=5130562,W=b.readUint32();if(b.readUint32()!==P)throw new Error("First chunk format is not JSON");return b.byteOffset+W===d?b.loadAsync(W).then((()=>({json:this._parseJson(b.readString(W)),bin:null}))):b.loadAsync(W+8).then((()=>{const i={json:this._parseJson(b.readString(W)),bin:null},q=()=>{const W=b.readUint32();switch(b.readUint32()){case P:throw new Error("Unexpected JSON chunk");case G:{const d=b.byteOffset;i.bin={readAsync:(P,G)=>b.buffer.readAsync(d+P,G),byteLength:W},b.skipBytes(W);break}default:b.skipBytes(W)}return b.byteOffset!==d?b.loadAsync(8).then(q):Promise.resolve(i)};return q()}))}static _parseVersion(b){if("1.0"===b||"1.0.1"===b)return{major:1,minor:0};const d=(b+"").match(/^(\d+)\.(\d+)/);return d?{major:parseInt(d[1]),minor:parseInt(d[2])}:null}static _compareVersion(b,d){return b.major>d.major?1:b.major<d.major?-1:b.minor>d.minor?1:b.minor<d.minor?-1:0}_logOpen(b){this._log(b),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(b){const d=p._logSpaces.substring(0,2*this._logIndentLevel);L.e.Log(`${d}${b}`)}_logDisabled(b){}_startPerformanceCounterEnabled(b){W.Tools.StartPerformanceCounter(b)}_startPerformanceCounterDisabled(b){}_endPerformanceCounterEnabled(b){W.Tools.EndPerformanceCounter(b)}_endPerformanceCounterDisabled(b){}}p.IncrementalLoading=!0,p.HomogeneousCoordinates=!1,p._logSpaces="                                ",(0,i.e)(new p)},13306:(b,d,P)=>{"use strict";P.d(d,{b:()=>q});var G=P(11484);function W(b,d,P,G){const W={externalResourceFunction:G};return P&&(W.uri="file:"===d?P:d+P),ArrayBuffer.isView(b)?GLTFValidator.validateBytes(b,W):GLTFValidator.validateString(b,W)}function i(){const b=[];onmessage=d=>{const P=d.data;switch(P.id){case"init":importScripts(P.url);break;case"validate":W(P.data,P.rootUrl,P.fileName,(d=>new Promise(((P,G)=>{const W=b.length;b.push({resolve:P,reject:G}),postMessage({id:"getExternalResource",index:W,uri:d})})))).then((b=>{postMessage({id:"validate.resolve",value:b})}),(b=>{postMessage({id:"validate.reject",reason:b})}));break;case"getExternalResource.resolve":b[P.index].resolve(P.value);break;case"getExternalResource.reject":b[P.index].reject(P.reason)}}}class q{static ValidateAsync(b,d,P,q){return"function"===typeof Worker?new Promise(((C,J)=>{const L=`${W}(${i})()`,x=URL.createObjectURL(new Blob([L],{type:"application/javascript"})),Y=new Worker(x),s=b=>{Y.removeEventListener("error",s),Y.removeEventListener("message",E),J(b)},E=b=>{const d=b.data;switch(d.id){case"getExternalResource":q(d.uri).then((b=>{Y.postMessage({id:"getExternalResource.resolve",index:d.index,value:b},[b.buffer])}),(b=>{Y.postMessage({id:"getExternalResource.reject",index:d.index,reason:b})}));break;case"validate.resolve":Y.removeEventListener("error",s),Y.removeEventListener("message",E),C(d.value),Y.terminate();break;case"validate.reject":Y.removeEventListener("error",s),Y.removeEventListener("message",E),J(d.reason),Y.terminate()}};if(Y.addEventListener("error",s),Y.addEventListener("message",E),Y.postMessage({id:"init",url:G.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(b)){const G=b.slice();Y.postMessage({id:"validate",data:G,rootUrl:d,fileName:P},[G.buffer])}else Y.postMessage({id:"validate",data:b,rootUrl:d,fileName:P})})):(this._LoadScriptPromise||(this._LoadScriptPromise=G.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>W(b,d,P,q))))}}q.Configuration={url:`${G.Tools._DefaultCdnUrl}/gltf_validator.js`}},13833:(b,d,P)=>{"use strict";P.d(d,{b:()=>g});var G=P(11663),W=P(11670),i=P(11716),q=P(11681),C=P(12063),J=P(11990),L=P(11752),x=P(11909),Y=P(11639),s=P(11591);P(13071),P(12973),P(12988),P(12979),P(12992),P(12996),P(13e3);const E="imageProcessingCompatibility",w="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";s.c.IncludesShadersStore[E]||(s.c.IncludesShadersStore[E]=w);const t="skyPixelShader",r="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";s.c.ShadersStore[t]||(s.c.ShadersStore[t]=r);P(13082),P(13008),P(13011),P(13021),P(13019);const B="skyVertexShader",n="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";s.c.ShadersStore[B]||(s.c.ShadersStore[B]=n);var Z=P(11984),o=P(12049),A=P(12045);class f extends C.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class g extends J.c{constructor(b,d){super(b,d),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new q.ed(0,100,0),this.useSunPosition=!1,this.cameraOffset=q.ed.Zero(),this.up=q.ed.Up(),this.dithering=!1,this._cameraPosition=q.ed.Zero(),this._skyOrientation=new q.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(b,d){const P=d._drawWrapper;if(this.isFrozen&&P.effect&&P._wasPreviouslyReady)return!0;d.materialDefines||(d.materialDefines=new f);const G=d.materialDefines,W=this.Xb();if(this._isReadyForSubMesh(d))return!0;if((0,A.J)(b,W,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,G),(0,A.z)(b,G,!0,!1),G.IMAGEPROCESSINGPOSTPROCESS!==W.imageProcessingConfiguration.applyByPostProcess&&G.markAsMiscDirty(),G.DITHER!==this.dithering&&G.markAsMiscDirty(),G.isDirty){G.markAsProcessed(),W.resetCachedMaterial();const b=new Z.d;G.FOG&&b.addFallback(1,"FOG"),G.IMAGEPROCESSINGPOSTPROCESS=W.imageProcessingConfiguration.applyByPostProcess,G.DITHER=this.dithering;const P=[L.c.PositionKind];G.VERTEXCOLOR&&P.push(L.c.ColorKind);const i="sky",q=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,o.c)(q);const C=G.toString();d.setEffect(W.getEngine().createEffect(i,P,q,[],C,b,this.onCompiled,this.onError),G,this._materialContext)}return!(!d.effect||!d.effect.isReady())&&(G._renderId=W.getRenderId(),P._wasPreviouslyReady=!0,!0)}bindForSubMesh(b,d,P){const G=this.Xb(),W=P.materialDefines;if(!W)return;const i=P.effect;if(!i)return;this._activeEffect=i,this.bindOnlyWorldMatrix(b),this._activeEffect.setMatrix("viewProjection",G.getTransformMatrix()),this._mustRebind(G,i,P)&&((0,o.f)(i,this,G),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,A.e)(W,i,G)),G.fogEnabled&&d.applyFog&&G.fogMode!==x.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",G.getViewMatrix()),(0,A.c)(G,d,this._activeEffect);const C=G.activeCamera;if(C){const b=C.getWorldMatrix();this._cameraPosition.x=b.m[12],this._cameraPosition.y=b.m[13],this._cameraPosition.z=b.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const b=Math.PI*(this.inclination-.5),d=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(d)*Math.cos(b),this.sunPosition.y=this.distance*Math.sin(-b),this.sunPosition.z=this.distance*Math.sin(d)*Math.cos(b),q.Quaternion.FromUnitVectorsToRef(q.ed.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(d,this._activeEffect,P)}getAnimatables(){return[]}dispose(b){super.dispose(b)}clone(b){return i.c.Clone((()=>new g(b,this.Xb())),this)}serialize(){const b=super.serialize();return b.customType="BABYLON.SkyMaterial",b}getClassName(){return"SkyMaterial"}static Parse(b,d,P){return i.c.Parse((()=>new g(b.name,d)),b,d,P)}}(0,G.d)([(0,W.G)()],g.prototype,"luminance",void 0),(0,G.d)([(0,W.G)()],g.prototype,"turbidity",void 0),(0,G.d)([(0,W.G)()],g.prototype,"rayleigh",void 0),(0,G.d)([(0,W.G)()],g.prototype,"mieCoefficient",void 0),(0,G.d)([(0,W.G)()],g.prototype,"mieDirectionalG",void 0),(0,G.d)([(0,W.G)()],g.prototype,"distance",void 0),(0,G.d)([(0,W.G)()],g.prototype,"inclination",void 0),(0,G.d)([(0,W.G)()],g.prototype,"azimuth",void 0),(0,G.d)([(0,W.F)()],g.prototype,"sunPosition",void 0),(0,G.d)([(0,W.G)()],g.prototype,"useSunPosition",void 0),(0,G.d)([(0,W.F)()],g.prototype,"cameraOffset",void 0),(0,G.d)([(0,W.F)()],g.prototype,"up",void 0),(0,G.d)([(0,W.G)()],g.prototype,"dithering",void 0),(0,Y.f)("BABYLON.SkyMaterial",g)},12363:(b,d,P)=>{"use strict";function G(b,d){d.headers=b.headers||{},d.statusMessage=b.statusText,d.statusCode=b.status,d.data=b.response}function W(b,d,P){return new Promise((function(W,i){P=P||{};var q,C,J,L=new XMLHttpRequest,x=P.body,Y=P.headers||{};for(q in P.timeout&&(L.timeout=P.timeout),L.ontimeout=L.onerror=function(b){b.timeout="timeout"==b.type,i(b)},L.open(b,d.href||d),L.onload=function(){for(J=L.getAllResponseHeaders().trim().split(/[\r\n]+/),G(L,L);C=J.shift();)C=C.split(": "),L.headers[C.shift().toLowerCase()]=C.join(": ");if((C=L.headers["content-type"])&&~C.indexOf("application/json"))try{L.data=JSON.parse(L.data,P.reviver)}catch(b){return G(L,b),i(b)}(L.status>=400?i:W)(L)},typeof FormData<"u"&&x instanceof FormData||x&&"object"==typeof x&&(Y["content-type"]="application/json",x=JSON.stringify(x)),L.withCredentials=!!P.withCredentials,Y)L.setRequestHeader(q,Y[q]);L.send(x)}))}P.r(d),P.d(d,{del:()=>J,get:()=>i,patch:()=>C,post:()=>q,put:()=>L,send:()=>W});var i=W.bind(W,"GET"),q=W.bind(W,"POST"),C=W.bind(W,"PATCH"),J=W.bind(W,"DELETE"),L=W.bind(W,"PUT")},13944:(b,d,P)=>{"use strict";P.d(d,{b:()=>Y});const G=.5*(Math.sqrt(3)-1),W=(3-Math.sqrt(3))/6,i=1/3,q=1/6,C=(Math.sqrt(5)-1)/4,J=(5-Math.sqrt(5))/20,L=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),x=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const Y=class{constructor(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const d="function"==typeof b?b:function(b){let d=0,P=0,G=0,W=1;const i=function(){let b=4022871197;return function(d){d=d.toString();for(let P=0;P<d.length;P++){b+=d.charCodeAt(P);let G=.02519603282416938*b;b=G>>>0,G-=b,G*=b,b=G>>>0,G-=b,b+=4294967296*G}return 2.3283064365386963e-10*(b>>>0)}}();d=i(" "),P=i(" "),G=i(" "),d-=i(b),d<0&&(d+=1);P-=i(b),P<0&&(P+=1);G-=i(b),G<0&&(G+=1);return function(){const b=2091639*d+2.3283064365386963e-10*W;return d=P,P=G,G=b-(W=0|b)}}(b);this.p=function(b){const d=new Uint8Array(256);for(let P=0;P<256;P++)d[P]=P;for(let P=0;P<255;P++){const G=P+~~(b()*(256-P)),W=d[P];d[P]=d[G],d[G]=W}return d}(d),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let P=0;P<512;P++)this.perm[P]=this.p[255&P],this.permMod12[P]=this.perm[P]%12}noise2D(b,d){const P=this.permMod12,i=this.perm;let q=0,C=0,J=0;const x=(b+d)*G,Y=Math.floor(b+x),s=Math.floor(d+x),E=(Y+s)*W,w=b-(Y-E),t=d-(s-E);let r,B;w>t?(r=1,B=0):(r=0,B=1);const n=w-r+W,Z=t-B+W,o=w-1+2*W,A=t-1+2*W,f=255&Y,g=255&s;let X=.5-w*w-t*t;if(X>=0){const b=3*P[f+i[g]];X*=X,q=X*X*(L[b]*w+L[b+1]*t)}let u=.5-n*n-Z*Z;if(u>=0){const b=3*P[f+r+i[g+B]];u*=u,C=u*u*(L[b]*n+L[b+1]*Z)}let M=.5-o*o-A*A;if(M>=0){const b=3*P[f+1+i[g+1]];M*=M,J=M*M*(L[b]*o+L[b+1]*A)}return 70*(q+C+J)}noise3D(b,d,P){const G=this.permMod12,W=this.perm;let C,J,x,Y;const s=(b+d+P)*i,E=Math.floor(b+s),w=Math.floor(d+s),t=Math.floor(P+s),r=(E+w+t)*q,B=b-(E-r),n=d-(w-r),Z=P-(t-r);let o,A,f,g,X,u;B>=n?n>=Z?(o=1,A=0,f=0,g=1,X=1,u=0):B>=Z?(o=1,A=0,f=0,g=1,X=0,u=1):(o=0,A=0,f=1,g=1,X=0,u=1):n<Z?(o=0,A=0,f=1,g=0,X=1,u=1):B<Z?(o=0,A=1,f=0,g=0,X=1,u=1):(o=0,A=1,f=0,g=1,X=1,u=0);const M=B-o+q,e=n-A+q,R=Z-f+q,U=B-g+2*q,H=n-X+2*q,p=Z-u+2*q,S=B-1+.5,l=n-1+.5,N=Z-1+.5,j=255&E,a=255&w,O=255&t;let V=.6-B*B-n*n-Z*Z;if(V<0)C=0;else{const b=3*G[j+W[a+W[O]]];V*=V,C=V*V*(L[b]*B+L[b+1]*n+L[b+2]*Z)}let y=.6-M*M-e*e-R*R;if(y<0)J=0;else{const b=3*G[j+o+W[a+A+W[O+f]]];y*=y,J=y*y*(L[b]*M+L[b+1]*e+L[b+2]*R)}let c=.6-U*U-H*H-p*p;if(c<0)x=0;else{const b=3*G[j+g+W[a+X+W[O+u]]];c*=c,x=c*c*(L[b]*U+L[b+1]*H+L[b+2]*p)}let D=.6-S*S-l*l-N*N;if(D<0)Y=0;else{const b=3*G[j+1+W[a+1+W[O+1]]];D*=D,Y=D*D*(L[b]*S+L[b+1]*l+L[b+2]*N)}return 32*(C+J+x+Y)}noise4D(b,d,P,G){const W=this.perm;let i,q,L,Y,s;const E=(b+d+P+G)*C,w=Math.floor(b+E),t=Math.floor(d+E),r=Math.floor(P+E),B=Math.floor(G+E),n=(w+t+r+B)*J,Z=b-(w-n),o=d-(t-n),A=P-(r-n),f=G-(B-n);let g=0,X=0,u=0,M=0;Z>o?g++:X++,Z>A?g++:u++,Z>f?g++:M++,o>A?X++:u++,o>f?X++:M++,A>f?u++:M++;const e=g>=3?1:0,R=X>=3?1:0,U=u>=3?1:0,H=M>=3?1:0,p=g>=2?1:0,S=X>=2?1:0,l=u>=2?1:0,N=M>=2?1:0,j=g>=1?1:0,a=X>=1?1:0,O=u>=1?1:0,V=M>=1?1:0,y=Z-e+J,c=o-R+J,D=A-U+J,z=f-H+J,Q=Z-p+2*J,I=o-S+2*J,m=A-l+2*J,v=f-N+2*J,F=Z-j+3*J,h=o-a+3*J,T=A-O+3*J,K=f-V+3*J,k=Z-1+4*J,bb=o-1+4*J,db=A-1+4*J,Pb=f-1+4*J,Gb=255&w,Wb=255&t,ib=255&r,qb=255&B;let Cb=.6-Z*Z-o*o-A*A-f*f;if(Cb<0)i=0;else{const b=W[Gb+W[Wb+W[ib+W[qb]]]]%32*4;Cb*=Cb,i=Cb*Cb*(x[b]*Z+x[b+1]*o+x[b+2]*A+x[b+3]*f)}let Jb=.6-y*y-c*c-D*D-z*z;if(Jb<0)q=0;else{const b=W[Gb+e+W[Wb+R+W[ib+U+W[qb+H]]]]%32*4;Jb*=Jb,q=Jb*Jb*(x[b]*y+x[b+1]*c+x[b+2]*D+x[b+3]*z)}let Lb=.6-Q*Q-I*I-m*m-v*v;if(Lb<0)L=0;else{const b=W[Gb+p+W[Wb+S+W[ib+l+W[qb+N]]]]%32*4;Lb*=Lb,L=Lb*Lb*(x[b]*Q+x[b+1]*I+x[b+2]*m+x[b+3]*v)}let xb=.6-F*F-h*h-T*T-K*K;if(xb<0)Y=0;else{const b=W[Gb+j+W[Wb+a+W[ib+O+W[qb+V]]]]%32*4;xb*=xb,Y=xb*xb*(x[b]*F+x[b+1]*h+x[b+2]*T+x[b+3]*K)}let Yb=.6-k*k-bb*bb-db*db-Pb*Pb;if(Yb<0)s=0;else{const b=W[Gb+1+W[Wb+1+W[ib+1+W[qb+1]]]]%32*4;Yb*=Yb,s=Yb*Yb*(x[b]*k+x[b+1]*bb+x[b+2]*db+x[b+3]*Pb)}return 27*(i+q+L+Y+s)}}}}]);