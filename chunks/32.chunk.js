/*! For license information please see kkn31l.32.3d43830d.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[32],{13176:(B,I,C)=>{"use strict";var M=C(13180),x=C(13184),y=C(13193);C.g.__TYPEDARRAY_POOL||(C.g.__TYPEDARRAY_POOL={UINT8:x([32,0]),UINT16:x([32,0]),UINT32:x([32,0]),INT8:x([32,0]),INT16:x([32,0]),INT32:x([32,0]),FLOAT:x([32,0]),DOUBLE:x([32,0]),DATA:x([32,0]),UINT8C:x([32,0]),BUFFER:x([32,0])});var f="undefined"!==typeof Uint8ClampedArray,L=C.g.__TYPEDARRAY_POOL;L.UINT8C||(L.UINT8C=x([32,0])),L.BUFFER||(L.BUFFER=x([32,0]));var e=L.DATA,g=L.BUFFER;function N(B){if(B){var I=B.length||B.byteLength,C=M.log2(I);e[C].push(B)}}function R(B){B=M.nextPow2(B);var I=M.log2(B),C=e[I];return C.length>0?C.pop():new ArrayBuffer(B)}function H(B){return new Uint8Array(R(B),0,B)}function F(B){return new Uint16Array(R(2*B),0,B)}function k(B){return new Uint32Array(R(4*B),0,B)}function q(B){return new Int8Array(R(B),0,B)}function S(B){return new Int16Array(R(2*B),0,B)}function o(B){return new Int32Array(R(4*B),0,B)}function U(B){return new Float32Array(R(4*B),0,B)}function G(B){return new Float64Array(R(8*B),0,B)}function V(B){return f?new Uint8ClampedArray(R(B),0,B):H(B)}function c(B){return new DataView(R(B),0,B)}I.free=function(B){if(y(B))g[M.log2(B.length)].push(B);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(B)&&(B=B.buffer),!B)return;var I=B.length||B.byteLength,C=0|M.log2(I);e[C].push(B)}},I.freeUint8=I.freeUint16=I.freeUint32=I.freeInt8=I.freeInt16=I.freeInt32=I.freeFloat32=I.freeFloat=I.freeFloat64=I.freeDouble=I.freeUint8Clamped=I.freeDataView=function(B){N(B.buffer)},I.freeArrayBuffer=N,I.freeBuffer=function(B){g[M.log2(B.length)].push(B)},I.malloc=function(B,I){if(void 0===I||"arraybuffer"===I)return R(B);switch(I){case"uint8":return H(B);case"uint16":return F(B);case"uint32":return k(B);case"int8":return q(B);case"int16":return S(B);case"int32":return o(B);case"float":case"float32":return U(B);case"double":case"float64":return G(B);case"uint8_clamped":return V(B);case"buffer":throw"Buffer not supported";case"data":case"dataview":return c(B);default:return null}return null},I.mallocArrayBuffer=R,I.mallocUint8=H,I.mallocUint16=F,I.mallocUint32=k,I.mallocInt8=q,I.mallocInt16=S,I.mallocInt32=o,I.mallocFloat32=I.mallocFloat=U,I.mallocFloat64=I.mallocDouble=G,I.mallocUint8Clamped=V,I.mallocDataView=c,I.clearCache=function(){for(var B=0;B<32;++B)L.UINT8[B].length=0,L.UINT16[B].length=0,L.UINT32[B].length=0,L.INT8[B].length=0,L.INT16[B].length=0,L.INT32[B].length=0,L.FLOAT[B].length=0,L.DOUBLE[B].length=0,L.UINT8C[B].length=0,e[B].length=0,g[B].length=0}},13271:(B,I,C)=>{B.exports=x;var M=C(11976);function x(B,I){if(!(this instanceof x))return new x(B,I);var C=M.create();M.add(C,B,I),this.base=M.min(M.create(),B,C),this.GN=M.clone(I),this.max=M.max(M.create(),B,C),this.mag=M.length(this.GN)}var y=x.prototype;y.width=function(){return this.GN[0]},y.height=function(){return this.GN[1]},y.depth=function(){return this.GN[2]},y.x0=function(){return this.base[0]},y.y0=function(){return this.base[1]},y.z0=function(){return this.base[2]},y.x1=function(){return this.max[0]},y.y1=function(){return this.max[1]},y.z1=function(){return this.max[2]},y.translate=function(B){return M.add(this.max,this.max,B),M.add(this.base,this.base,B),this},y.setPosition=function(B){return M.add(this.max,B,this.GN),M.i(this.base,B),this},y.expand=function(B){var I=M.create(),C=M.create();return M.max(I,B.max,this.max),M.min(C,B.base,this.base),M.FI(I,I,C),new x(C,I)},y.intersects=function(B){return!(B.base[0]>this.max[0])&&(!(B.base[1]>this.max[1])&&(!(B.base[2]>this.max[2])&&(!(B.max[0]<this.base[0])&&(!(B.max[1]<this.base[1])&&!(B.max[2]<this.base[2])))))},y.touches=function(B){var I=this.union(B);return null!==I&&(0==I.width()||0==I.height()||0==I.depth())},y.union=function(B){if(!this.intersects(B))return null;var I=Math.max(B.base[0],this.base[0]),C=Math.max(B.base[1],this.base[1]),M=Math.max(B.base[2],this.base[2]);return new x([I,C,M],[Math.min(B.max[0],this.max[0])-I,Math.min(B.max[1],this.max[1])-C,Math.min(B.max[2],this.max[2])-M])}},13180:(B,I)=>{"use strict";function C(B){var I=32;return(B&=-B)&&I--,65535&B&&(I-=16),16711935&B&&(I-=8),252645135&B&&(I-=4),858993459&B&&(I-=2),1431655765&B&&(I-=1),I}I.INT_BITS=32,I.INT_MAX=2147483647,I.INT_MIN=-1<<31,I.sign=function(B){return(B>0)-(B<0)},I.abs=function(B){var I=B>>31;return(B^I)-I},I.min=function(B,I){return I^(B^I)&-(B<I)},I.max=function(B,I){return B^(B^I)&-(B<I)},I.isPow2=function(B){return!(B&B-1)&&!!B},I.log2=function(B){var I,C;return I=(B>65535)<<4,I|=C=((B>>>=I)>255)<<3,I|=C=((B>>>=C)>15)<<2,(I|=C=((B>>>=C)>3)<<1)|(B>>>=C)>>1},I.log10=function(B){return B>=1e9?9:B>=1e8?8:B>=1e7?7:B>=1e6?6:B>=1e5?5:B>=1e4?4:B>=1e3?3:B>=100?2:B>=10?1:0},I.popCount=function(B){return 16843009*((B=(858993459&(B-=B>>>1&1431655765))+(B>>>2&858993459))+(B>>>4)&252645135)>>>24},I.countTrailingZeros=C,I.nextPow2=function(B){return B+=0===B,--B,B|=B>>>1,B|=B>>>2,B|=B>>>4,B|=B>>>8,(B|=B>>>16)+1},I.prevPow2=function(B){return B|=B>>>1,B|=B>>>2,B|=B>>>4,B|=B>>>8,(B|=B>>>16)-(B>>>1)},I.parity=function(B){return B^=B>>>16,B^=B>>>8,B^=B>>>4,27030>>>(B&=15)&1};var M=new Array(256);!function(B){for(var I=0;I<256;++I){var C=I,M=I,x=7;for(C>>>=1;C;C>>>=1)M<<=1,M|=1&C,--x;B[I]=M<<x&255}}(M),I.reverse=function(B){return M[255&B]<<24|M[B>>>8&255]<<16|M[B>>>16&255]<<8|M[B>>>24&255]},I.interleave2=function(B,I){return(B=1431655765&((B=858993459&((B=252645135&((B=16711935&((B&=65535)|B<<8))|B<<4))|B<<2))|B<<1))|(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I&=65535)|I<<8))|I<<4))|I<<2))|I<<1))<<1},I.deinterleave2=function(B,I){return(B=65535&((B=16711935&((B=252645135&((B=858993459&((B=B>>>I&1431655765)|B>>>1))|B>>>2))|B>>>4))|B>>>16))<<16>>16},I.interleave3=function(B,I,C){return B=1227133513&((B=3272356035&((B=251719695&((B=4278190335&((B&=1023)|B<<16))|B<<8))|B<<4))|B<<2),(B|=(I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2))<<1)|(C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2))<<2},I.deinterleave3=function(B,I){return(B=1023&((B=4278190335&((B=251719695&((B=3272356035&((B=B>>>I&1227133513)|B>>>2))|B>>>4))|B>>>8))|B>>>16))<<22>>22},I.nextCombination=function(B){var I=B|B-1;return I+1|(~I&-~I)-1>>>C(B)+1}},13173:(B,I,C)=>{"use strict";B.exports=function(B,I,C){switch(arguments.length){case 1:return M=[],g(x=B,x,N,!0),M;case 2:return"function"===typeof I?g(B,B,I,!0):function(B,I){return M=[],g(B,I,N,!1),M}(B,I);case 3:return g(B,I,C,!1);default:throw new Error("box-intersect: Invalid arguments")}var x};var M,x=C(13176),y=C(13199),f=C(13204);function L(B,I){for(var C=0;C<B;++C)if(!(I[C]<=I[C+B]))return!0;return!1}function e(B,I,C,M){for(var x=0,y=0,f=0,e=B.length;f<e;++f){var g=B[f];if(!L(I,g)){for(var N=0;N<2*I;++N)C[x++]=g[N];M[y++]=f}}return y}function g(B,I,C,M){var L=B.length,g=I.length;if(!(L<=0||g<=0)){var N=B[0].length>>>1;if(!(N<=0)){var R,H=x.mallocDouble(2*N*L),F=x.mallocInt32(L);if((L=e(B,N,H,F))>0){if(1===N&&M)y.init(L),R=y.sweepComplete(N,C,0,L,H,F,0,L,H,F);else{var k=x.mallocDouble(2*N*g),q=x.mallocInt32(g);(g=e(I,N,k,q))>0&&(y.init(L+g),R=1===N?y.sweepBipartite(N,C,0,L,H,F,0,g,k,q):f(N,C,M,L,H,F,g,k,q),x.free(k),x.free(q))}x.free(H),x.free(F)}return R}}}function N(B,I){M.push([B,I])}},13207:(B,I)=>{"use strict";var C="d",M="ax",x="fp",y="es",f="rs",L="re",e="rb",g="bs",N="be",R="bb",H=[C,M,"vv",f,L,e,"ri",g,N,R,"bi"];function F(B){var I="bruteForce"+(B?"Full":"Partial"),M=[],f=H.slice();B||f.splice(3,0,x);var L=["function "+I+"("+f.join()+"){"];function e(I,x){var f=function(B,I,M){var x="bruteForce"+(B?"Red":"Blue")+(I?"Flip":"")+(M?"Full":""),f=["function ",x,"(",H.join(),"){","var ",y,"=2*",C,";"],L="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",e="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(M?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return B?f.push(L,"Q",":",e):f.push(e,"Q",":",L),M?f.push("if(y1<x0||x1<y0)continue;"):I?f.push("if(y0<=x0||x1<y0)continue;"):f.push("if(y0<x0||x1<y0)continue;"),f.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),I?f.push("yi,xi"):f.push("xi,yi"),f.push(");if(rv!==void 0)return rv;}}}"),{name:x,code:f.join("")}}(I,x,B);M.push(f.code),L.push("return "+f.name+"("+H.join()+");")}L.push("if(re-rs>be-bs){"),B?(e(!0,!1),L.push("}else{"),e(!1,!1)):(L.push("if(fp){"),e(!0,!0),L.push("}else{"),e(!0,!1),L.push("}}else{if(fp){"),e(!1,!0),L.push("}else{"),e(!1,!1),L.push("}")),L.push("}}return "+I);var g=M.join("")+L.join("");return new Function(g)()}I.partial=F(!1),I.full=F(!0)},13204:(B,I,C)=>{"use strict";B.exports=function(B,I,C,y,N,i,u,p,n){!function(B,I){var C=8*x.log2(I+1)*(B+1)|0,y=x.nextPow2(V*C);t.length<y&&(M.free(t),t=M.mallocInt32(y));var f=x.nextPow2(c*C);r.length<f&&(M.free(r),r=M.mallocDouble(f))}(B,y+u);var O,a=0,W=2*B;A(a++,0,0,y,0,u,C?16:0,-1/0,1/0),C||A(a++,0,0,u,0,y,1,-1/0,1/0);for(;a>0;){var d=(a-=1)*V,l=t[d],E=t[d+1],Q=t[d+2],Z=t[d+3],z=t[d+4],b=t[d+5],Y=a*c,v=r[Y],s=r[Y+1],X=1&b,T=!!(16&b),P=N,h=i,j=p,w=n;if(X&&(P=p,h=n,j=N,w=i),!(2&b&&E>=(Q=S(B,l,E,Q,P,h,s)))&&!(4&b&&(E=o(B,l,E,Q,P,h,v))>=Q)){var K=Q-E,m=z-Z;if(T){if(B*K*(K+m)<F){if(void 0!==(O=e.scanComplete(B,l,I,E,Q,P,h,Z,z,j,w)))return O;continue}}else{if(B*Math.min(K,m)<R){if(void 0!==(O=f(B,l,I,X,E,Q,P,h,Z,z,j,w)))return O;continue}if(B*K*m<H){if(void 0!==(O=e.scanBipartite(B,l,I,X,E,Q,P,h,Z,z,j,w)))return O;continue}}var BB=k(B,l,E,Q,P,h,v,s);if(E<BB)if(B*(BB-E)<R){if(void 0!==(O=L(B,l+1,I,E,BB,P,h,Z,z,j,w)))return O}else if(l===B-2){if(void 0!==(O=X?e.sweepBipartite(B,I,Z,z,j,w,E,BB,P,h):e.sweepBipartite(B,I,E,BB,P,h,Z,z,j,w)))return O}else A(a++,l+1,E,BB,Z,z,X,-1/0,1/0),A(a++,l+1,Z,z,E,BB,1^X,-1/0,1/0);if(BB<Q){var IB=g(B,l,Z,z,j,w),CB=j[W*IB+l],MB=q(B,l,IB,z,j,w,CB);if(MB<z&&A(a++,l,BB,Q,MB,z,(4|X)+(T?16:0),CB,s),Z<IB&&A(a++,l,BB,Q,Z,IB,(2|X)+(T?16:0),v,CB),IB+1===MB){if(void 0!==(O=T?J(B,l,I,BB,Q,P,h,IB,j,w[IB]):D(B,l,I,X,BB,Q,P,h,IB,j,w[IB])))return O}else if(IB<MB){var xB;if(T){if(BB<(xB=U(B,l,BB,Q,P,h,CB))){var yB=q(B,l,BB,xB,P,h,CB);if(l===B-2){if(BB<yB&&void 0!==(O=e.sweepComplete(B,I,BB,yB,P,h,IB,MB,j,w)))return O;if(yB<xB&&void 0!==(O=e.sweepBipartite(B,I,yB,xB,P,h,IB,MB,j,w)))return O}else BB<yB&&A(a++,l+1,BB,yB,IB,MB,16,-1/0,1/0),yB<xB&&(A(a++,l+1,yB,xB,IB,MB,0,-1/0,1/0),A(a++,l+1,IB,MB,yB,xB,1,-1/0,1/0))}}else BB<(xB=X?G(B,l,BB,Q,P,h,CB):U(B,l,BB,Q,P,h,CB))&&(l===B-2?O=X?e.sweepBipartite(B,I,IB,MB,j,w,BB,xB,P,h):e.sweepBipartite(B,I,BB,xB,P,h,IB,MB,j,w):(A(a++,l+1,BB,xB,IB,MB,X,-1/0,1/0),A(a++,l+1,IB,MB,BB,xB,1^X,-1/0,1/0)))}}}}};var M=C(13176),x=C(13180),y=C(13207),f=y.partial,L=y.full,e=C(13199),g=C(13216),N=C(13219),R=128,H=1<<22,F=1<<22,k=N("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),q=N("lo===p0",["p0"]),S=N("lo<p0",["p0"]),o=N("hi<=p0",["p0"]),U=N("lo<=p0&&p0<=hi",["p0"]),G=N("lo<p0&&p0<=hi",["p0"]),V=6,c=2,t=M.mallocInt32(1024),r=M.mallocDouble(1024);function A(B,I,C,M,x,y,f,L,e){var g=V*B;t[g]=I,t[g+1]=C,t[g+2]=M,t[g+3]=x,t[g+4]=y,t[g+5]=f;var N=c*B;r[N]=L,r[N+1]=e}function D(B,I,C,M,x,y,f,L,e,g,N){var R=2*B,H=e*R,F=g[H+I];B:for(var k=x,q=x*R;k<y;++k,q+=R){var S=f[q+I],o=f[q+I+B];if(!(F<S||o<F)&&(!M||F!==S)){for(var U,G=L[k],V=I+1;V<B;++V){S=f[q+V],o=f[q+V+B];var c=g[H+V],t=g[H+V+B];if(o<c||t<S)continue B}if(void 0!==(U=M?C(N,G):C(G,N)))return U}}}function J(B,I,C,M,x,y,f,L,e,g){var N=2*B,R=L*N,H=e[R+I];B:for(var F=M,k=M*N;F<x;++F,k+=N){var q=f[F];if(q!==g){var S=y[k+I],o=y[k+I+B];if(!(H<S||o<H)){for(var U=I+1;U<B;++U){S=y[k+U],o=y[k+U+B];var G=e[R+U],V=e[R+U+B];if(o<G||V<S)continue B}var c=C(q,g);if(void 0!==c)return c}}}}},13216:(B,I,C)=>{"use strict";B.exports=function(B,I,C,f,L,e){if(f<=C+1)return C;var g=C,N=f,R=f+C>>>1,H=2*B,F=R,k=L[H*R+I];for(;g<N;){if(N-g<x){y(B,I,g,N,L,e),k=L[H*R+I];break}var q=N-g,S=Math.random()*q+g|0,o=L[H*S+I],U=Math.random()*q+g|0,G=L[H*U+I],V=Math.random()*q+g|0,c=L[H*V+I];o<=G?c>=G?(F=U,k=G):o>=c?(F=S,k=o):(F=V,k=c):G>=c?(F=U,k=G):c>=o?(F=S,k=o):(F=V,k=c);for(var t=H*(N-1),r=H*F,A=0;A<H;++A,++t,++r){var D=L[t];L[t]=L[r],L[r]=D}var J=e[N-1];e[N-1]=e[F],e[F]=J;for(t=H*(N-1),r=H*(F=M(B,I,g,N-1,L,e,k)),A=0;A<H;++A,++t,++r){D=L[t];L[t]=L[r],L[r]=D}J=e[N-1];if(e[N-1]=e[F],e[F]=J,R<F){for(N=F-1;g<N&&L[H*(N-1)+I]===k;)N-=1;N+=1}else{if(!(F<R))break;for(g=F+1;g<N&&L[H*g+I]===k;)g+=1}}return M(B,I,C,R,L,e,L[H*R+I])};var M=C(13219)("lo<p0",["p0"]),x=8;function y(B,I,C,M,x,y){for(var f=2*B,L=f*(C+1)+I,e=C+1;e<M;++e,L+=f)for(var g=x[L],N=e,R=f*(e-1);N>C&&x[R+I]>g;--N,R-=f){for(var H=R,F=R+f,k=0;k<f;++k,++H,++F){var q=x[H];x[H]=x[F],x[F]=q}var S=y[N];y[N]=y[N-1],y[N-1]=S}}},13219:B=>{"use strict";B.exports=function(B,C){var M="abcdef".split("").concat(C),x=[];B.indexOf("lo")>=0&&x.push("lo=e[k+n]");B.indexOf("hi")>=0&&x.push("hi=e[k+o]");return M.push(I.replace("_",x.join()).replace("$",B)),Function.apply(void 0,M)};var I="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13202:B=>{"use strict";B.exports=function(B,M){M<=4*I?C(0,M-1,B):g(0,M-1,B)};var I=32;function C(B,I,C){for(var M=2*(B+1),x=B+1;x<=I;++x){for(var y=C[M++],f=C[M++],L=x,e=M-2;L-- >B;){var g=C[e-2],N=C[e-1];if(g<y)break;if(g===y&&N<f)break;C[e]=g,C[e+1]=N,e-=2}C[e]=y,C[e+1]=f}}function M(B,I,C){I*=2;var M=C[B*=2],x=C[B+1];C[B]=C[I],C[B+1]=C[I+1],C[I]=M,C[I+1]=x}function x(B,I,C){I*=2,C[B*=2]=C[I],C[B+1]=C[I+1]}function y(B,I,C,M){I*=2,C*=2;var x=M[B*=2],y=M[B+1];M[B]=M[I],M[B+1]=M[I+1],M[I]=M[C],M[I+1]=M[C+1],M[C]=x,M[C+1]=y}function f(B,I,C,M,x){I*=2,x[B*=2]=x[I],x[I]=C,x[B+1]=x[I+1],x[I+1]=M}function L(B,I,C){I*=2;var M=C[B*=2],x=C[I];return!(M<x)&&(M!==x||C[B+1]>C[I+1])}function e(B,I,C,M){var x=M[B*=2];return x<I||x===I&&M[B+1]<C}function g(B,N,R){var H=(N-B+1)/6|0,F=B+H,k=N-H,q=B+N>>1,S=q-H,o=q+H,U=F,G=S,V=q,c=o,t=k,r=B+1,A=N-1,D=0;L(U,G,R)&&(D=U,U=G,G=D),L(c,t,R)&&(D=c,c=t,t=D),L(U,V,R)&&(D=U,U=V,V=D),L(G,V,R)&&(D=G,G=V,V=D),L(U,c,R)&&(D=U,U=c,c=D),L(V,c,R)&&(D=V,V=c,c=D),L(G,t,R)&&(D=G,G=t,t=D),L(G,V,R)&&(D=G,G=V,V=D),L(c,t,R)&&(D=c,c=t,t=D);for(var J=R[2*G],i=R[2*G+1],u=R[2*c],p=R[2*c+1],n=2*U,O=2*V,a=2*t,W=2*F,d=2*q,l=2*k,E=0;E<2;++E){var Q=R[n+E],Z=R[O+E],z=R[a+E];R[W+E]=Q,R[d+E]=Z,R[l+E]=z}x(S,B,R),x(o,N,R);for(var b=r;b<=A;++b)if(e(b,J,i,R))b!==r&&M(b,r,R),++r;else if(!e(b,u,p,R))for(;;){if(e(A,u,p,R)){e(A,J,i,R)?(y(b,r,A,R),++r,--A):(M(b,A,R),--A);break}if(--A<b)break}f(B,r-1,J,i,R),f(N,A+1,u,p,R),r-2-B<=I?C(B,r-2,R):g(B,r-2,R),N-(A+2)<=I?C(A+2,N,R):g(A+2,N,R),A-r<=I?C(r,A,R):g(r,A,R)}},13199:(B,I,C)=>{"use strict";B.exports={init:function(B){var I=x.nextPow2(B);e.length<I&&(M.free(e),e=M.mallocInt32(I));g.length<I&&(M.free(g),g=M.mallocInt32(I));N.length<I&&(M.free(N),N=M.mallocInt32(I));R.length<I&&(M.free(R),R=M.mallocInt32(I));H.length<I&&(M.free(H),H=M.mallocInt32(I));F.length<I&&(M.free(F),F=M.mallocInt32(I));var C=8*I;k.length<C&&(M.free(k),k=M.mallocDouble(C))},sweepBipartite:function(B,I,C,M,x,L,H,F,o,U){for(var G=0,V=2*B,c=B-1,t=V-1,r=C;r<M;++r){var A=L[r],D=V*r;k[G++]=x[D+c],k[G++]=-(A+1),k[G++]=x[D+t],k[G++]=A}for(r=H;r<F;++r){A=U[r]+f;var J=V*r;k[G++]=o[J+c],k[G++]=-A,k[G++]=o[J+t],k[G++]=A}var i=G>>>1;y(k,i);var u=0,p=0;for(r=0;r<i;++r){var n=0|k[2*r+1];if(n>=f)q(N,R,p--,n=n-f|0);else if(n>=0)q(e,g,u--,n);else if(n<=-f){n=-n-f|0;for(var O=0;O<u;++O){if(void 0!==(a=I(e[O],n)))return a}S(N,R,p++,n)}else{n=-n-1|0;for(O=0;O<p;++O){var a;if(void 0!==(a=I(n,N[O])))return a}S(e,g,u++,n)}}},sweepComplete:function(B,I,C,M,x,f,L,o,U,G){for(var V=0,c=2*B,t=B-1,r=c-1,A=C;A<M;++A){var D=f[A]+1<<1,J=c*A;k[V++]=x[J+t],k[V++]=-D,k[V++]=x[J+r],k[V++]=D}for(A=L;A<o;++A){D=G[A]+1<<1;var i=c*A;k[V++]=U[i+t],k[V++]=1|-D,k[V++]=U[i+r],k[V++]=1|D}var u=V>>>1;y(k,u);var p=0,n=0,O=0;for(A=0;A<u;++A){var a=0|k[2*A+1],W=1&a;if(A<u-1&&a>>1===k[2*A+3]>>1&&(W=2,A+=1),a<0){for(var d=-(a>>1)-1,l=0;l<O;++l){if(void 0!==(E=I(H[l],d)))return E}if(0!==W)for(l=0;l<p;++l){if(void 0!==(E=I(e[l],d)))return E}if(1!==W)for(l=0;l<n;++l){var E;if(void 0!==(E=I(N[l],d)))return E}0===W?S(e,g,p++,d):1===W?S(N,R,n++,d):2===W&&S(H,F,O++,d)}else{d=(a>>1)-1;0===W?q(e,g,p--,d):1===W?q(N,R,n--,d):2===W&&q(H,F,O--,d)}}},scanBipartite:function(B,I,C,M,x,L,N,R,H,F,o,U){var G=0,V=2*B,c=I,t=I+B,r=1,A=1;M?A=f:r=f;for(var D=x;D<L;++D){var J=D+r,i=V*D;k[G++]=N[i+c],k[G++]=-J,k[G++]=N[i+t],k[G++]=J}for(D=H;D<F;++D){J=D+A;var u=V*D;k[G++]=o[u+c],k[G++]=-J}var p=G>>>1;y(k,p);var n=0;for(D=0;D<p;++D){var O=0|k[2*D+1];if(O<0){var a=!1;if((J=-O)>=f?(a=!M,J-=f):(a=!!M,J-=1),a)S(e,g,n++,J);else{var W=U[J],d=V*J,l=o[d+I+1],E=o[d+I+1+B];B:for(var Q=0;Q<n;++Q){var Z=e[Q],z=V*Z;if(!(E<N[z+I+1]||N[z+I+1+B]<l)){for(var b=I+2;b<B;++b)if(o[d+b+B]<N[z+b]||N[z+b+B]<o[d+b])continue B;var Y,v=R[Z];if(void 0!==(Y=M?C(W,v):C(v,W)))return Y}}}}else q(e,g,n--,O-r)}},scanComplete:function(B,I,C,M,x,L,g,N,R,H,F){for(var q=0,S=2*B,o=I,U=I+B,G=M;G<x;++G){var V=G+f,c=S*G;k[q++]=L[c+o],k[q++]=-V,k[q++]=L[c+U],k[q++]=V}for(G=N;G<R;++G){V=G+1;var t=S*G;k[q++]=H[t+o],k[q++]=-V}var r=q>>>1;y(k,r);var A=0;for(G=0;G<r;++G){var D=0|k[2*G+1];if(D<0){if((V=-D)>=f)e[A++]=V-f;else{var J=F[V-=1],i=S*V,u=H[i+I+1],p=H[i+I+1+B];B:for(var n=0;n<A;++n){var O=e[n],a=g[O];if(a===J)break;var W=S*O;if(!(p<L[W+I+1]||L[W+I+1+B]<u)){for(var d=I+2;d<B;++d)if(H[i+d+B]<L[W+d]||L[W+d+B]<H[i+d])continue B;var l=C(a,J);if(void 0!==l)return l}}}}else{for(V=D-f,n=A-1;n>=0;--n)if(e[n]===V){for(d=n+1;d<A;++d)e[d-1]=e[d];break}--A}}}};var M=C(13176),x=C(13180),y=C(13202),f=1<<28,L=1024,e=M.mallocInt32(L),g=M.mallocInt32(L),N=M.mallocInt32(L),R=M.mallocInt32(L),H=M.mallocInt32(L),F=M.mallocInt32(L),k=M.mallocDouble(8192);function q(B,I,C,M){var x=I[M],y=B[C-1];B[x]=y,I[y]=x}function S(B,I,C,M){B[C]=M,I[M]=C}},13184:B=>{"use strict";function I(B,C,M){var x=0|B[M];if(x<=0)return[];var y,f=new Array(x);if(M===B.length-1)for(y=0;y<x;++y)f[y]=C;else for(y=0;y<x;++y)f[y]=I(B,C,M+1);return f}B.exports=function(B,C){switch("undefined"===typeof C&&(C=0),typeof B){case"number":if(B>0)return function(B,I){var C,M;for(C=new Array(B),M=0;M<B;++M)C[M]=I;return C}(0|B,C);break;case"object":if("number"===typeof B.length)return I(B,C,0)}return[]}},13136:(B,I,C)=>{B.exports=function(){var B=this;this.components={},this.comps=this.components;var I=this.components,C=1,x={},y=[],f=[],L={timeout:!1,removals:[],multiComps:[]};function e(B,C){var M=I[C],y=x[C],f=y.hash[B];f&&(y.remove(B),M.XC&&(M.multi?(f.forEach((I=>{I&&M.XC(B,I)})),f.length=0):M.XC(B,f)),L.removals.push(y),g())}function g(){L.timeout||(L.timeout=!0,setTimeout(N,1))}function N(){L.timeout=!1,R()}function R(){L.multiComps.length&&function(B){for(var I=0;I<B.length;I++){var{entID:C,data:M}=B[I],x=M.hash[C];if(x){for(var y=0;y<x.length;y++)x[y]||(x.splice(y,1),y--);0===x.length&&(M.remove(C),L.removals.push(M))}}B.length=0}(L.multiComps),L.removals.length&&function(B){for(var I=0;I<B.length;I++){B[I].flush()}B.length=0}(L.removals)}this.WR=x,this._systems=y,this._renderSystems=f,this.tN=function(I){var M=C++;return Array.isArray(I)&&I.forEach((I=>B.ze(M,I))),M},this.deleteEntity=function(I){return Object.keys(x).forEach((B=>{x[B].hash[I]&&e(I,B)})),B},this.QN=function(B){if(!B)throw new Error("Missing component definition");var C=B.name;if(!C)throw new Error("Component definition must have a name property.");if("string"!==typeof C)throw new Error("Component name must be a string.");if(""===C)throw new Error("Component name must be a non-empty string.");if(x[C])throw new Error(`Component ${C} already exists.`);var L={};return L.name=C,L.multi=!!B.multi,L.order=isNaN(B.order)?99:B.order,L.stateConstructor=B.stateConstructor||null,L.state=B.state||{},L.OL=B.OL||null,L.XC=B.XC||null,L.system=B.system||null,L.QL=B.QL||null,I[C]=L,x[C]=new M,x[C]._pendingMultiCleanup=!1,x[C]._multiCleanupIDs=L.multi?[]:null,L.system&&(y.push(C),y.sort(((B,C)=>I[B].order-I[C].order))),L.QL&&(f.push(C),f.sort(((B,C)=>I[B].order-I[C].order))),C},this.overwriteComponent=function(B,C){var M=I[B];if(!M)throw new Error(`Unknown component: ${B}`);if(!C)throw new Error("Missing component definition");if(M.name!==C.name)throw new Error("Overwriting component must use the same name property.");var L={};L.name=B,L.multi=!!C.multi,L.order=isNaN(C.order)?99:C.order,L.state=C.state||{},L.OL=C.OL||null,L.XC=C.XC||null,L.system=C.system||null,L.QL=C.QL||null,I[B]=L,x[B]._pendingMultiCleanup=!1,x[B]._multiCleanupIDs=L.multi?[]:null;var e=y.indexOf(B);L.system&&e<0&&y.push(B),!L.system&&e>=0&&y.splice(e,1),y.sort(((B,C)=>I[B].order-I[C].order));var g=f.indexOf(B);L.QL&&g<0&&f.push(B),!L.QL&&g>=0&&f.splice(g,1),f.sort(((B,C)=>I[B].order-I[C].order));var N=L.state;return this.xN(B).forEach((B=>{for(var I in N)I in B||(B[I]=N[I]);L.OL&&L.OL(B.lL,B)})),B},this.deleteComponent=function(C){var M=x[C];if(!M)throw new Error(`Unknown component: ${C}`);M.flush(),M.list.forEach((B=>{B&&e(B.lL||B[0].lL,C)}));var L=y.indexOf(C),g=f.indexOf(C);return L>-1&&y.splice(L,1),g>-1&&f.splice(g,1),x[C].dispose(),delete x[C],delete I[C],B},this.ze=function(B,C,M){var y,f=I[C],L=x[C];if(!L)throw new Error(`Unknown component: ${C}.`);if(L.hash[B]&&!f.multi)throw new Error(`Entity ${B} already has component: ${C}.`);if(f.stateConstructor){if(!(y=new f.stateConstructor).hasOwnProperty("lL"))throw new Error(`Component ${f.name} stateConstructor type does not have property __id`)}else y=Object.assign({},{lL:B},f.state,M);if(y.lL=B,f.multi){var e=L.hash[B];e||(e=[],L.add(B,e)),e.push(y)}else L.add(B,y);return f.OL&&f.OL(B,y),this},this.Mg=function(B,I){var C=x[I];if(!C)throw new Error(`Unknown component: ${I}.`);return!!C.hash[B]},this.je=function(I,C){if(!x[C])throw new Error(`Unknown component: ${C}.`);return e(I,C),B},this.getState=function(B,I){var C=x[I];if(!C)throw new Error(`Unknown component: ${I}.`);return C.hash[B]},this.xN=function(B){var I=x[B];if(!I)throw new Error(`Unknown component: ${B}.`);return R(),I.list},this.cF=function(B){if(!x[B])throw new Error(`Unknown component: ${B}.`);var I=x[B].hash;return B=>I[B]},this.AF=function(B){if(!x[B])throw new Error(`Unknown component: ${B}.`);var I=x[B].hash;return B=>!!I[B]},this.tL=function(C){R();for(var M=0;M<y.length;M++){var f=y[M],L=I[f],e=x[f];L.system(C,e.list),R()}return B},this.render=function(C){R();for(var M=0;M<f.length;M++){var y=f[M],L=I[y],e=x[y];L.QL(C,e.list),R()}return B},this.removeMultiComponent=function(C,M,y){var f=I[M],e=x[M];if(!e)throw new Error(`Unknown component: ${M}.`);if(!f.multi)throw new Error("removeMultiComponent called on non-multi component");return function(B,I,C,M){var x=C.hash[B];if(x){var y=x[M];y&&(x[M]=null,I.XC&&I.XC(B,y),L.multiComps.push({entID:B,data:C}),g())}}(C,f,e,y),B}};var M=C(13141)},13141:B=>{function I(B,I){var C=B._map[I];if(delete B.hash[I],delete B._map[I],C===B.list.length-1)B.list.pop();else{var M=B.list.pop();if(B.list[C]=M,null===M||null===M[0]){var x=B.list.length;for(var y in B._map)if(B._map[y]===x)return void(B._map[y]=C)}else{var f=M.lL||M[0].lL;B._map[f]=C}}}B.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(B,I){if("number"===typeof this._map[B]){var C=this._map[B];this.hash[B]=I,this.list[C]=I}else this._map[B]=this.list.length,this.hash[B]=I,this.list.push(I)}remove(B){var I=this._map[B];this.hash[B]=null,this.list[I]=null,this._pendingRemovals.push(B)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var B=0;B<this._pendingRemovals.length;B++){var C=this._pendingRemovals[B];null===this.hash[C]&&I(this,C)}this._pendingRemovals.length=0}}},13099:B=>{"use strict";var I,C="object"===typeof Reflect?Reflect:null,M=function(B,I,C){return Function.prototype.apply.call(B,I,C)};I=C&&"function"===typeof C.ownKeys?C.ownKeys:Object.getOwnPropertySymbols?function(B){return Object.getOwnPropertyNames(B).concat(Object.getOwnPropertySymbols(B))}:function(B){return Object.getOwnPropertyNames(B)};var x=Number.isNaN||function(B){return B!==B};function y(){y.init.call(this)}B.exports=y,B.exports.once=function(B,I){return new Promise((function(C,M){function x(C){B.removeListener(I,y),M(C)}function y(){"function"===typeof B.removeListener&&B.removeListener("error",x),C([].slice.call(arguments))}q(B,I,y,{once:!0}),"error"!==I&&function(B,I,C){"function"===typeof B.on&&q(B,"error",I,C)}(B,x,{once:!0})}))},y.EventEmitter=y,y.prototype._events=void 0,y.prototype._eventsCount=0,y.prototype._maxListeners=void 0;var f=10;function L(B){if("function"!==typeof B)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof B)}function e(B){return void 0===B._maxListeners?y.defaultMaxListeners:B._maxListeners}function g(B,I,C,M){var x,y,f,g;if(L(C),void 0===(y=B._events)?(y=B._events=Object.create(null),B._eventsCount=0):(void 0!==y.newListener&&(B.emit("newListener",I,C.listener?C.listener:C),y=B._events),f=y[I]),void 0===f)f=y[I]=C,++B._eventsCount;else if("function"===typeof f?f=y[I]=M?[C,f]:[f,C]:M?f.unshift(C):f.push(C),(x=e(B))>0&&f.length>x&&!f.warned){f.warned=!0;var N=new Error("Possible EventEmitter memory leak detected. "+f.length+" "+String(I)+" listeners added. Use emitter.setMaxListeners() to increase limit");N.name="MaxListenersExceededWarning",N.j=B,N.type=I,N.count=f.length,g=N,console&&console.warn&&console.warn(g)}return B}function N(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function R(B,I,C){var M={fired:!1,wrapFn:void 0,target:B,type:I,listener:C},x=N.bind(M);return x.listener=C,M.wrapFn=x,x}function H(B,I,C){var M=B._events;if(void 0===M)return[];var x=M[I];return void 0===x?[]:"function"===typeof x?C?[x.listener||x]:[x]:C?function(B){for(var I=new Array(B.length),C=0;C<I.length;++C)I[C]=B[C].listener||B[C];return I}(x):k(x,x.length)}function F(B){var I=this._events;if(void 0!==I){var C=I[B];if("function"===typeof C)return 1;if(void 0!==C)return C.length}return 0}function k(B,I){for(var C=new Array(I),M=0;M<I;++M)C[M]=B[M];return C}function q(B,I,C,M){if("function"===typeof B.on)M.once?B.once(I,C):B.on(I,C);else{if("function"!==typeof B.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof B);B.addEventListener(I,(function x(y){M.once&&B.removeEventListener(I,x),C(y)}))}}Object.defineProperty(y,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(B){if("number"!==typeof B||B<0||x(B))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+B+".");f=B}}),y.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},y.prototype.setMaxListeners=function(B){if("number"!==typeof B||B<0||x(B))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+B+".");return this._maxListeners=B,this},y.prototype.getMaxListeners=function(){return e(this)},y.prototype.emit=function(B){for(var I=[],C=1;C<arguments.length;C++)I.push(arguments[C]);var x="error"===B,y=this._events;if(void 0!==y)x=x&&void 0===y.error;else if(!x)return!1;if(x){var f;if(I.length>0&&(f=I[0]),f instanceof Error)throw f;var L=new Error("Unhandled error."+(f?" ("+f.message+")":""));throw L.context=f,L}var e=y[B];if(void 0===e)return!1;if("function"===typeof e)M(e,this,I);else{var g=e.length,N=k(e,g);for(C=0;C<g;++C)M(N[C],this,I)}return!0},y.prototype.addListener=function(B,I){return g(this,B,I,!1)},y.prototype.on=y.prototype.addListener,y.prototype.prependListener=function(B,I){return g(this,B,I,!0)},y.prototype.once=function(B,I){return L(I),this.on(B,R(this,B,I)),this},y.prototype.prependOnceListener=function(B,I){return L(I),this.prependListener(B,R(this,B,I)),this},y.prototype.removeListener=function(B,I){var C,M,x,y,f;if(L(I),void 0===(M=this._events))return this;if(void 0===(C=M[B]))return this;if(C===I||C.listener===I)0===--this._eventsCount?this._events=Object.create(null):(delete M[B],M.removeListener&&this.emit("removeListener",B,C.listener||I));else if("function"!==typeof C){for(x=-1,y=C.length-1;y>=0;y--)if(C[y]===I||C[y].listener===I){f=C[y].listener,x=y;break}if(x<0)return this;0===x?C.shift():function(B,I){for(;I+1<B.length;I++)B[I]=B[I+1];B.pop()}(C,x),1===C.length&&(M[B]=C[0]),void 0!==M.removeListener&&this.emit("removeListener",B,f||I)}return this},y.prototype.off=y.prototype.removeListener,y.prototype.removeAllListeners=function(B){var I,C,M;if(void 0===(C=this._events))return this;if(void 0===C.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==C[B]&&(0===--this._eventsCount?this._events=Object.create(null):delete C[B]),this;if(0===arguments.length){var x,y=Object.keys(C);for(M=0;M<y.length;++M)"removeListener"!==(x=y[M])&&this.removeAllListeners(x);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(I=C[B]))this.removeListener(B,I);else if(void 0!==I)for(M=I.length-1;M>=0;M--)this.removeListener(B,I[M]);return this},y.prototype.listeners=function(B){return H(this,B,!0)},y.prototype.rawListeners=function(B){return H(this,B,!1)},y.listenerCount=function(B,I){return"function"===typeof B.listenerCount?B.listenerCount(I):F.call(B,I)},y.prototype.listenerCount=F,y.prototype.eventNames=function(){return this._eventsCount>0?I(this._events):[]}},13399:B=>{"use strict";B.exports=function(B,I,C,M,x,y){var f=+I[0],L=+I[1],e=+I[2],g=+C[0],N=+C[1],R=+C[2],H=Math.sqrt(g*g+N*N+R*R);if(0===H)throw new Error("Can't raycast along a zero vector");return function(B,I,C,M,x,y,f,L,e,g){for(var N=0,R=Math.floor,H=0|R(I),F=0|R(C),k=0|R(M),q=x>0?1:-1,S=y>0?1:-1,o=f>0?1:-1,U=Math.abs(1/x),G=Math.abs(1/y),V=Math.abs(1/f),c=U<1/0?U*(q>0?H+1-I:I-H):1/0,t=G<1/0?G*(S>0?F+1-C:C-F):1/0,r=V<1/0?V*(o>0?k+1-M:M-k):1/0,A=-1;N<=L;){var D=B(H,F,k);if(D)return e&&(e[0]=I+N*x,e[1]=C+N*y,e[2]=M+N*f),g&&(g[0]=g[1]=g[2]=0,0===A&&(g[0]=-q),1===A&&(g[1]=-S),2===A&&(g[2]=-o)),D;c<t?c<r?(H+=q,N=c,c+=U,A=0):(k+=o,N=r,r+=V,A=2):t<r?(F+=S,N=t,t+=G,A=1):(k+=o,N=r,r+=V,A=2)}return e&&(e[0]=I+N*x,e[1]=C+N*y,e[2]=M+N*f),g&&(g[0]=g[1]=g[2]=0),0}(B,f,L,e,g/=H,N/=H,R/=H,M="undefined"===typeof M?64:+M,x,y)}},13430:(B,I,C)=>{"use strict";C.d(I,{c:()=>y});var M=C(13099);function x(){this.tH=!1,this.stopPropagation=!1,this.rH=!1,this.disabled=!1}class y{constructor(B,I){this.version="0.7.0";var C=Object.assign({},new x,I||{});this.element=B||document,this.tH=!!C.tH,this.stopPropagation=!!C.stopPropagation,this.rH=!!C.rH,this.disabled=!!C.disabled,this.filterEvents=(B,I)=>!0,this.down=new M.EventEmitter,this.up=new M.EventEmitter,this.state={},this.Kg={dx:0,dy:0,HF:0,wg:0,FF:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?L(this):document.addEventListener("DOMContentLoaded",(B=>{L(this)}),{once:!0})}bind(B){for(var I=arguments.length,C=new Array(I>1?I-1:0),M=1;M<I;M++)C[M-1]=arguments[M];C.forEach((I=>{var C=this._keyBindmap[I]||[];C.includes(B)||(C.push(B),this._keyBindmap[I]=C)})),this.state[B]=!!this.state[B],this.pressCount[B]=this.pressCount[B]||0,this.releaseCount[B]=this.releaseCount[B]||0}unbind(B){for(var I in this._keyBindmap){var C=this._keyBindmap[I],M=C.indexOf(B);M>-1&&C.splice(M,1)}}getBindings(){var B={};for(var I in this._keyBindmap){this._keyBindmap[I].forEach((C=>{B[C]=B[C]||[],B[C].push(I)}))}return B}tL(){f(this.Kg),f(this.pressCount),f(this.releaseCount)}}function f(B){for(var I in B)B[I]=0}function L(B){window.addEventListener("keydown",k.bind(null,B,!0),!1),window.addEventListener("keyup",k.bind(null,B,!1),!1);var I={passive:!0};B.element.addEventListener("touchstart",R.bind(void 0,B),{passive:!1}),B.element.addEventListener("touchend",F.bind(void 0,B),I),B.element.addEventListener("mousedown",q.bind(null,B,!0),I),window.document.addEventListener("mouseup",q.bind(null,B,!1),I),B.element.addEventListener("touchmove",S.bind(null,B),I),B.element.addEventListener("mousemove",S.bind(null,B),I),window.PointerEvent,B.element.addEventListener("wheel",o.bind(null,B),I),B.element.addEventListener("contextmenu",U.bind(null,B),!1),window.addEventListener("blur",G.bind(null,B),!1)}var e=0,g=0,N=null;function R(B,I){I.preventDefault(),H(I)}function H(B){let I=!1;for(let C=0;C<B.touches.length;++C)if(B.touches[C].identifier===N){I=!0;break}if(!I){const I=B.changedTouches[0];e=I.clientX,g=I.clientY,N=I.identifier}}function F(B,I){for(var C=I.changedTouches,M=0;M<C.length;++M)C[M].identifier===N&&(N=null)}function k(B,I,C){V(C.code,I,B,C)}function q(B,I,C){if("pointerId"in C)if(I){if(null!==B._touches.currID)return;B._touches.currID=C.pointerId}else{if(B._touches.currID!==C.pointerId)return;B._touches.currID=null}return V("Mouse"+("button"in C?C.button+1:1),I,B,C),!1}function S(B,I){var C=I.movementX||I.mozMovementX||0,M=I.movementY||I.mozMovementY||0;if(I.touches&&0===(C|M)){var x=function(B){H(B);for(let I=0;I<B.changedTouches.length;++I)if(B.changedTouches[I].identifier==N){const C=B.changedTouches[I],M=[C.clientX-e,C.clientY-g];return e=C.clientX,g=C.clientY,M}return console.error(`Did not find touch id ${N}`),[0,0]}(I);C=x[0],M=x[1]}B.Kg.dx+=C,B.Kg.dy+=M}function o(B,I){var C=1;switch(I.deltaMode){case 0:C=1;break;case 1:C=12;break;case 2:C=B.element.clientHeight||window.innerHeight}B.Kg.HF+=(I.deltaX||0)*C,B.Kg.wg+=(I.deltaY||0)*C,B.Kg.FF+=(I.deltaZ||0)*C}function U(B,I){if(!B.rH)return I.preventDefault(),!1}function G(B){for(var I in B._keyStates)B._keyStates[I]&&(/^Mouse\d/.test(I)||V(I,!1,B,{code:I,note:"3hjziq4fzly",preventDefault:()=>{},stopPropagation:()=>{}}))}function V(B,I,C,M){var x=C._keyBindmap[B];x&&(c(C._keyStates[B],I)&&(C._keyStates[B]=I,x.forEach((B=>{(!C.filterEvents||C.filterEvents(M,B))&&function(B,I,C,M){var x=I?C.pressCount:C.releaseCount;x[B]=(x[B]||0)+1;var y=C._bindPressCount[B]||0;(y+=I?1:-1)<0&&(y=0);C._bindPressCount[B]=y;var f=C.state[B];if(c(f,y)){C.state[B]=y>0;var L=I?C.down:C.up;C.disabled||L.emit(B,M)}}(B,I,C,M)}))),"button"in M||(C.tH&&!M.defaultPrevented&&M.preventDefault(),C.stopPropagation&&M.stopPropagation()))}function c(B,I){return B?!I:I}},12041:B=>{B.exports=function(B,I,C){return B[0]=I[0]+C[0],B[1]=I[1]+C[1],B[2]=I[2]+C[2],B}},12002:(B,I,C)=>{B.exports=function(B,I){var C=M(B[0],B[1],B[2]),f=M(I[0],I[1],I[2]);x(C,C),x(f,f);var L=y(C,f);return L>1?0:Math.acos(L)};var M=C(12011),x=C(12014),y=C(12016)},12091:B=>{B.exports=function(B,I){return B[0]=Math.ceil(I[0]),B[1]=Math.ceil(I[1]),B[2]=Math.ceil(I[2]),B}},12e3:B=>{B.exports=function(B){var I=new Float32Array(3);return I[0]=B[0],I[1]=B[1],I[2]=B[2],I}},12022:B=>{B.exports=function(B,I){return B[0]=I[0],B[1]=I[1],B[2]=I[2],B}},11994:B=>{B.exports=function(){var B=new Float32Array(3);return B[0]=0,B[1]=0,B[2]=0,B}},12170:B=>{B.exports=function(B,I,C){var M=I[0],x=I[1],y=I[2],f=C[0],L=C[1],e=C[2];return B[0]=x*e-y*L,B[1]=y*f-M*e,B[2]=M*L-x*f,B}},12121:(B,I,C)=>{B.exports=C(12115)},12115:B=>{B.exports=function(B,I){var C=I[0]-B[0],M=I[1]-B[1],x=I[2]-B[2];return Math.sqrt(C*C+M*M+x*x)}},12078:(B,I,C)=>{B.exports=C(12071)},12071:B=>{B.exports=function(B,I,C){return B[0]=I[0]/C[0],B[1]=I[1]/C[1],B[2]=I[2]/C[2],B}},12016:B=>{B.exports=function(B,I){return B[0]*I[0]+B[1]*I[1]+B[2]*I[2]}},11985:B=>{B.exports=1e-6},12030:(B,I,C)=>{B.exports=function(B,I){var C=B[0],x=B[1],y=B[2],f=I[0],L=I[1],e=I[2];return Math.abs(C-f)<=M*Math.max(1,Math.abs(C),Math.abs(f))&&Math.abs(x-L)<=M*Math.max(1,Math.abs(x),Math.abs(L))&&Math.abs(y-e)<=M*Math.max(1,Math.abs(y),Math.abs(e))};var M=C(11985)},12034:B=>{B.exports=function(B,I){return B[0]===I[0]&&B[1]===I[1]&&B[2]===I[2]}},12088:B=>{B.exports=function(B,I){return B[0]=Math.floor(I[0]),B[1]=Math.floor(I[1]),B[2]=Math.floor(I[2]),B}},12224:(B,I,C)=>{B.exports=function(B,I,C,x,y,f){var L,e;I||(I=3);C||(C=0);e=x?Math.min(x*I+C,B.length):B.length;for(L=C;L<e;L+=I)M[0]=B[L],M[1]=B[L+1],M[2]=B[L+2],y(M,M,f),B[L]=M[0],B[L+1]=M[1],B[L+2]=M[2];return B};var M=C(11994)()},12011:B=>{B.exports=function(B,I,C){var M=new Float32Array(3);return M[0]=B,M[1]=I,M[2]=C,M}},11976:(B,I,C)=>{B.exports={EPSILON:C(11985),create:C(11994),clone:C(12e3),angle:C(12002),kL:C(12011),i:C(12022),set:C(12024),equals:C(12030),exactEquals:C(12034),add:C(12041),FI:C(12048),sub:C(12055),multiply:C(12059),mul:C(12066),divide:C(12071),div:C(12078),min:C(12080),max:C(12085),floor:C(12088),ceil:C(12091),round:C(12098),scale:C(12100),qL:C(12108),distance:C(12115),k:C(12121),squaredDistance:C(12123),sqrDist:C(12130),length:C(12132),len:C(12141),squaredLength:C(12147),SL:C(12153),negate:C(12161),inverse:C(12166),normalize:C(12014),dot:C(12016),cross:C(12170),RL:C(12177),random:C(12183),transformMat4:C(12189),transformMat3:C(12194),transformQuat:C(12200),oL:C(12202),UL:C(12211),GL:C(12215),forEach:C(12224)}},12166:B=>{B.exports=function(B,I){return B[0]=1/I[0],B[1]=1/I[1],B[2]=1/I[2],B}},12141:(B,I,C)=>{B.exports=C(12132)},12132:B=>{B.exports=function(B){var I=B[0],C=B[1],M=B[2];return Math.sqrt(I*I+C*C+M*M)}},12177:B=>{B.exports=function(B,I,C,M){var x=I[0],y=I[1],f=I[2];return B[0]=x+M*(C[0]-x),B[1]=y+M*(C[1]-y),B[2]=f+M*(C[2]-f),B}},12085:B=>{B.exports=function(B,I,C){return B[0]=Math.max(I[0],C[0]),B[1]=Math.max(I[1],C[1]),B[2]=Math.max(I[2],C[2]),B}},12080:B=>{B.exports=function(B,I,C){return B[0]=Math.min(I[0],C[0]),B[1]=Math.min(I[1],C[1]),B[2]=Math.min(I[2],C[2]),B}},12066:(B,I,C)=>{B.exports=C(12059)},12059:B=>{B.exports=function(B,I,C){return B[0]=I[0]*C[0],B[1]=I[1]*C[1],B[2]=I[2]*C[2],B}},12161:B=>{B.exports=function(B,I){return B[0]=-I[0],B[1]=-I[1],B[2]=-I[2],B}},12014:B=>{B.exports=function(B,I){var C=I[0],M=I[1],x=I[2],y=C*C+M*M+x*x;y>0&&(y=1/Math.sqrt(y),B[0]=I[0]*y,B[1]=I[1]*y,B[2]=I[2]*y);return B}},12183:B=>{B.exports=function(B,I){I=I||1;var C=2*Math.random()*Math.PI,M=2*Math.random()-1,x=Math.sqrt(1-M*M)*I;return B[0]=Math.cos(C)*x,B[1]=Math.sin(C)*x,B[2]=M*I,B}},12202:B=>{B.exports=function(B,I,C,M){var x=C[1],y=C[2],f=I[1]-x,L=I[2]-y,e=Math.sin(M),g=Math.cos(M);return B[0]=I[0],B[1]=x+f*g-L*e,B[2]=y+f*e+L*g,B}},12211:B=>{B.exports=function(B,I,C,M){var x=C[0],y=C[2],f=I[0]-x,L=I[2]-y,e=Math.sin(M),g=Math.cos(M);return B[0]=x+L*e+f*g,B[1]=I[1],B[2]=y+L*g-f*e,B}},12215:B=>{B.exports=function(B,I,C,M){var x=C[0],y=C[1],f=I[0]-x,L=I[1]-y,e=Math.sin(M),g=Math.cos(M);return B[0]=x+f*g-L*e,B[1]=y+f*e+L*g,B[2]=I[2],B}},12098:B=>{B.exports=function(B,I){return B[0]=Math.round(I[0]),B[1]=Math.round(I[1]),B[2]=Math.round(I[2]),B}},12100:B=>{B.exports=function(B,I,C){return B[0]=I[0]*C,B[1]=I[1]*C,B[2]=I[2]*C,B}},12108:B=>{B.exports=function(B,I,C,M){return B[0]=I[0]+C[0]*M,B[1]=I[1]+C[1]*M,B[2]=I[2]+C[2]*M,B}},12024:B=>{B.exports=function(B,I,C,M){return B[0]=I,B[1]=C,B[2]=M,B}},12130:(B,I,C)=>{B.exports=C(12123)},12153:(B,I,C)=>{B.exports=C(12147)},12123:B=>{B.exports=function(B,I){var C=I[0]-B[0],M=I[1]-B[1],x=I[2]-B[2];return C*C+M*M+x*x}},12147:B=>{B.exports=function(B){var I=B[0],C=B[1],M=B[2];return I*I+C*C+M*M}},12055:(B,I,C)=>{B.exports=C(12048)},12048:B=>{B.exports=function(B,I,C){return B[0]=I[0]-C[0],B[1]=I[1]-C[1],B[2]=I[2]-C[2],B}},12194:B=>{B.exports=function(B,I,C){var M=I[0],x=I[1],y=I[2];return B[0]=M*C[0]+x*C[3]+y*C[6],B[1]=M*C[1]+x*C[4]+y*C[7],B[2]=M*C[2]+x*C[5]+y*C[8],B}},12189:B=>{B.exports=function(B,I,C){var M=I[0],x=I[1],y=I[2],f=C[3]*M+C[7]*x+C[11]*y+C[15];return f=f||1,B[0]=(C[0]*M+C[4]*x+C[8]*y+C[12])/f,B[1]=(C[1]*M+C[5]*x+C[9]*y+C[13])/f,B[2]=(C[2]*M+C[6]*x+C[10]*y+C[14])/f,B}},12200:B=>{B.exports=function(B,I,C){var M=I[0],x=I[1],y=I[2],f=C[0],L=C[1],e=C[2],g=C[3],N=g*M+L*y-e*x,R=g*x+e*M-f*y,H=g*y+f*x-L*M,F=-f*M-L*x-e*y;return B[0]=N*g+F*-f+R*-e-H*-L,B[1]=R*g+F*-L+H*-f-N*-e,B[2]=H*g+F*-e+N*-L-R*-f,B}},13121:B=>{"use strict";B.exports=function(B){for(var I=new Array(B),C=0;C<B;++C)I[C]=C;return I}},13193:B=>{B.exports=function(B){return null!=B&&null!=B.constructor&&"function"===typeof B.constructor.isBuffer&&B.constructor.isBuffer(B)}},13408:(B,I,C)=>{"use strict";C.d(I,{d:()=>M});class M{constructor(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.yR=!1,this.fR=!1,this.MR=30,this.xR=0,this.kR=!1,this.fullscreen=!1,this.eR=function(B){},this.gR=function(){},this.HR=function(){},this.CM=function(){},this.NR=function(B){},this.onFullscreenChanged=function(B){},g((()=>{!function(B,I){B._nowObject=performance||Date,B._lastTick=0,B._renderAccum=0,B._rt=0,B._frameCB=L.bind(null,B),requestAnimationFrame(B._frameCB),I>0&&(B._intervalCB=f.bind(null,B),B._interval=setInterval(B._intervalCB,Math.max(I,1e3/B.MR/2)))}(this,I),function(B,I){if(!I)return;var C=!1,M=!1;document.addEventListener("pointerlockchange",(M=>{C=document.pointerLockElement===I,B.NR(C)})),document.addEventListener("fullscreenchange",(C=>{M=document.fullscreenElement===I,B.onFullscreenChanged(M)})),Object.defineProperty(B,"kR",{get:()=>C,set:B=>{B&&!C?e(I):C&&!B&&function(B){B.exitPointerLock&&B.exitPointerLock()}(document)}}),Object.defineProperty(B,"fullscreen",{get:()=>M,set:B=>{B&&!M?I.requestFullscreen():M&&!B&&document.exitFullscreen()}}),I.addEventListener("click",(x=>{B.yR&&!C&&e(I),B.fR&&!M&&I.requestFullscreen()}));var x=()=>B.CM();if(window.ResizeObserver){new ResizeObserver(x).observe(I)}else window.addEventListener("resize",x)}(this,B),this.HR()}))}}var x=3,y=20;function f(B){for(var I=1e3/B.MR,C=B._nowObject.now()+y,M=0;B._nowObject.now()>=B._lastTick+I&&B._nowObject.now()<C&&++M<=x;)B.eR(I),B._lastTick+=I;var f=5*(I+5),L=B._nowObject.now();if(L-B._lastTick>f)for(;L>=B._lastTick+I;)B._lastTick+=I}function L(B){requestAnimationFrame(B._frameCB),f(B);var I=B._nowObject.now(),C=I-B._rt;if(B._rt=I,B.xR>0){B._renderAccum+=C;var M=1e3/B.xR;if(B._renderAccum<M)return;B._renderAccum=Math.min(B._renderAccum-M,M)}var x=1e3/B.MR,y=(I-B._lastTick)/x;B.gR(C,y,x)}function e(B){B.requestPointerLock&&B.requestPointerLock()}var g=B=>{if("loading"===document.readyState){var I=()=>{document.removeEventListener("readystatechange",I),B()};document.addEventListener("readystatechange",I)}else setTimeout(B,1)}},13117:(B,I,C)=>{var M=C(13121),x=C(13128),y="undefined"!==typeof Float64Array;function f(B,I){return B[0]-I[0]}function L(){var B,I=this.stride,C=new Array(I.length);for(B=0;B<C.length;++B)C[B]=[Math.abs(I[B]),B];C.sort(f);var M=new Array(C.length);for(B=0;B<M.length;++B)M[B]=C[B][1];return M}function e(B,I){var C=["View",I,"d",B].join("");I<0&&(C="View_Nil"+B);var x="generic"===B;if(-1===I){var y="function "+C+"(a){this.data=a;};var proto="+C+".prototype;proto.dtype='"+B+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+C+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+C+"(a){return new "+C+"(a);}";return new Function(y)()}if(0===I){y="function "+C+"(a,d) {this.data = a;this.offset = d};var proto="+C+".prototype;proto.dtype='"+B+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+C+"_copy() {return new "+C+"(this.data,this.offset)};proto.pick=function "+C+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+C+"_get(){return "+(x?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+C+"_set(v){return "+(x?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+C+"(a,b,c,d){return new "+C+"(a,d)}";return new Function("TrivialArray",y)(g[B][0])}y=["'use strict'"];var f=M(I),e=f.map((function(B){return"i"+B})),N="this.offset+"+f.map((function(B){return"this.stride["+B+"]*i"+B})).join("+"),R=f.map((function(B){return"b"+B})).join(","),H=f.map((function(B){return"c"+B})).join(",");y.push("function "+C+"(a,"+R+","+H+",d){this.data=a","this.shape=["+R+"]","this.stride=["+H+"]","this.offset=d|0}","var proto="+C+".prototype","proto.dtype='"+B+"'","proto.dimension="+I),y.push("Object.defineProperty(proto,'size',{get:function "+C+"_size(){return "+f.map((function(B){return"this.shape["+B+"]"})).join("*"),"}})"),1===I?y.push("proto.order=[0]"):(y.push("Object.defineProperty(proto,'order',{get:"),I<4?(y.push("function "+C+"_order(){"),2===I?y.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===I&&y.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):y.push("ORDER})")),y.push("proto.set=function "+C+"_set("+e.join(",")+",v){"),x?y.push("return this.data.set("+N+",v)}"):y.push("return this.data["+N+"]=v}"),y.push("proto.get=function "+C+"_get("+e.join(",")+"){"),x?y.push("return this.data.get("+N+")}"):y.push("return this.data["+N+"]}"),y.push("proto.index=function "+C+"_index(",e.join(),"){return "+N+"}"),y.push("proto.hi=function "+C+"_hi("+e.join(",")+"){return new "+C+"(this.data,"+f.map((function(B){return["(typeof i",B,"!=='number'||i",B,"<0)?this.shape[",B,"]:i",B,"|0"].join("")})).join(",")+","+f.map((function(B){return"this.stride["+B+"]"})).join(",")+",this.offset)}");var F=f.map((function(B){return"a"+B+"=this.shape["+B+"]"})),k=f.map((function(B){return"c"+B+"=this.stride["+B+"]"}));y.push("proto.lo=function "+C+"_lo("+e.join(",")+"){var b=this.offset,d=0,"+F.join(",")+","+k.join(","));for(var q=0;q<I;++q)y.push("if(typeof i"+q+"==='number'&&i"+q+">=0){d=i"+q+"|0;b+=c"+q+"*d;a"+q+"-=d}");y.push("return new "+C+"(this.data,"+f.map((function(B){return"a"+B})).join(",")+","+f.map((function(B){return"c"+B})).join(",")+",b)}"),y.push("proto.step=function "+C+"_step("+e.join(",")+"){var "+f.map((function(B){return"a"+B+"=this.shape["+B+"]"})).join(",")+","+f.map((function(B){return"b"+B+"=this.stride["+B+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(q=0;q<I;++q)y.push("if(typeof i"+q+"==='number'){d=i"+q+"|0;if(d<0){c+=b"+q+"*(a"+q+"-1);a"+q+"=ceil(-a"+q+"/d)}else{a"+q+"=ceil(a"+q+"/d)}b"+q+"*=d}");y.push("return new "+C+"(this.data,"+f.map((function(B){return"a"+B})).join(",")+","+f.map((function(B){return"b"+B})).join(",")+",c)}");var S=new Array(I),o=new Array(I);for(q=0;q<I;++q)S[q]="a[i"+q+"]",o[q]="b[i"+q+"]";y.push("proto.transpose=function "+C+"_transpose("+e+"){"+e.map((function(B,I){return B+"=("+B+"===undefined?"+I+":"+B+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+C+"(this.data,"+S.join(",")+","+o.join(",")+",this.offset)}"),y.push("proto.pick=function "+C+"_pick("+e+"){var a=[],b=[],c=this.offset");for(q=0;q<I;++q)y.push("if(typeof i"+q+"==='number'&&i"+q+">=0){c=(c+this.stride["+q+"]*i"+q+")|0}else{a.push(this.shape["+q+"]);b.push(this.stride["+q+"])}");return y.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),y.push("return function construct_"+C+"(data,shape,stride,offset){return new "+C+"(data,"+f.map((function(B){return"shape["+B+"]"})).join(",")+","+f.map((function(B){return"stride["+B+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",y.join("\n"))(g[B],L)}var g={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};B.exports=function(B,I,C,M){if(void 0===B)return(0,g.array[0])([]);"number"===typeof B&&(B=[B]),void 0===I&&(I=[B.length]);var f=I.length;if(void 0===C){C=new Array(f);for(var L=f-1,N=1;L>=0;--L)C[L]=N,N*=I[L]}if(void 0===M){M=0;for(L=0;L<f;++L)C[L]<0&&(M-=(I[L]-1)*C[L])}for(var R=function(B){if(x(B))return"buffer";if(y)switch(Object.prototype.toString.call(B)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(B)?"array":"generic"}(B),H=g[R];H.length<=f+1;)H.push(e(R,H.length-1));return(0,H[f+1])(B,I,C,M)}},13128:B=>{function I(B){return!!B.constructor&&"function"===typeof B.constructor.isBuffer&&B.constructor.isBuffer(B)}B.exports=function(B){return null!=B&&(I(B)||function(B){return"function"===typeof B.readFloatLE&&"function"===typeof B.slice&&I(B.slice(0,0))}(B)||!!B._isBuffer)}},13275:B=>{"use strict";var I=[],C=[],M=[],x=[],y=[],f=[],L=[],e=[],g=[],N=[],R=[],H=[];B.exports=function(B,F,k,q,S,o){for(var U=L,G=g,V=N,c=H,t=0;t<3;t++)U[t]=+k[t],V[t]=+F.max[t],G[t]=+F.base[t];o||(o=1e-10);var r=function(B,L,g,N,H,F){var k=I,q=C,S=M,o=x,U=y,G=f,V=e,c=Math.floor,t=0,r=0,A=0,D=0,J=0;if(i(),0===A)return 0;for(D=n();r<=A;){if(u(D)&&p())return t;D=n()}for(t+=A,J=0;J<3;J++)N[J]+=g[J],H[J]+=g[J];return t;function i(){if(r=0,0!==(A=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2])))for(var B=0;B<3;B++){var I=g[B]>=0;o[B]=I?1:-1;var C=I?H[B]:N[B];k[B]=I?N[B]:H[B],q[B]=O(C,o[B]),S[B]=a(k[B],o[B]),V[B]=g[B]/A,U[B]=Math.abs(1/V[B]);var M=I?q[B]+1-C:C-q[B];G[B]=U[B]<1/0?U[B]*M:1/0}}function u(I){for(var C=o[0],M=0===I?q[0]:S[0],x=q[0]+C,y=o[1],f=1===I?q[1]:S[1],L=q[1]+y,e=o[2],g=2===I?q[2]:S[2],N=q[2]+e,R=M;R!=x;R+=C)for(var H=f;H!=L;H+=y)for(var F=g;F!=N;F+=e)if(B(R,H,F))return!0;return!1}function p(){t+=r;var B=o[D],I=r/A,C=R;for(J=0;J<3;J++){var M=g[J]*I;N[J]+=M,H[J]+=M,C[J]=g[J]-M}if(B>0?H[D]=Math.round(H[D]):N[D]=Math.round(N[D]),L(t,D,B,C))return!0;for(J=0;J<3;J++)g[J]=C[J];return i(),0===A}function n(){var B=G[0]<G[1]?G[0]<G[2]?0:2:G[1]<G[2]?1:2,I=G[B]-r;for(r=G[B],q[B]+=o[B],G[B]+=U[B],J=0;J<3;J++)k[J]+=I*V[J],S[J]=a(k[J],o[J]);return B}function O(B,I){return c(B-I*F)}function a(B,I){return c(B+I*F)}}(B,q,U,G,V,o);if(!S){for(t=0;t<3;t++)c[t]=k[t]>0?V[t]-F.max[t]:G[t]-F.base[t];F.translate(c)}return r}},13438:(B,I,C)=>{"use strict";C.d(I,{e:()=>R});var M=C(13271),x=C(11976);class y{constructor(B,I,C,y,f,L,e){this.MN=new M(B.base,B.GN),this.ux=I,this.friction=C,this.restitution=y,this.xL=f,this.aF=L,this.yL=!!e,this.UN=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Vk=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.tg=x.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=x.create(),this._impulses=x.create(),this._sleepFrameCount=10}loadFromCopy(B){x.i(this.MN.base,B.MN.base),x.i(this.MN.GN,B.MN.GN),x.i(this.MN.max,B.MN.max),this.MN.mag=B.MN.mag,this.ux=B.ux,this.friction=B.friction,this.restitution=B.restitution,this.xL=B.xL,this.aF=B.aF,this.yL=B.yL,this.UN=B.UN,this.fluidDrag=B.fluidDrag,this.Vk=B.Vk,this.preventFallOffEdge=B.preventFallOffEdge,this.rolledBackLastTick=B.rolledBackLastTick,x.i(this.tg,B.tg),x.i(this.resting,B.resting),this.inFluid=B.inFluid,this._ratioInFluid=B._ratioInFluid,x.i(this._forces,B._forces),x.i(this._impulses,B._impulses),this._sleepFrameCount=B._sleepFrameCount}setPosition(B){f(B),x.FI(B,B,this.MN.base),this.MN.translate(B),this.Jg()}DM(){return x.clone(this.MN.base)}applyForce(B){f(B),x.add(this._forces,this._forces,B),this.Jg()}applyImpulse(B){f(B),x.add(this._impulses,this._impulses,B),this.Jg()}Jg(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var f=B=>{};var L=C(13271),e=C(11976),g=C(13275);function N(){this.UN=.1,this.fluidDrag=.4,this.NL=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function R(B,I,C){B=Object.assign(new N,B),this.gravity=B.gravity||[0,-10,0],this.UN=B.UN||.1,this.NL=B.NL||2,this.fluidDrag=B.fluidDrag||.4,this.minBounceImpulse=B.minBounceImpulse,this.bodies=[],this.CF=B.CF,this.testSolid=I,this.testFluid=C}R.prototype.zF=function(B,I,C,M,x,f){B=B||new L([0,0,0],[1,1,1]),"undefined"==typeof I&&(I=1),"undefined"==typeof C&&(C=1),"undefined"==typeof M&&(M=0),"undefined"==typeof x&&(x=1);var e=new y(B,I,C,M,x,f);return this.bodies.push(e),e},R.prototype.bF=function(B){var I=this.bodies.indexOf(B);I<0||(this.bodies.splice(I,1),B.MN=B.aF=null)};var H=e.create(),F=e.create(),k=e.create(),q=e.create(),S=e.create(),o=e.create(),U=e.create(),G=new L([0,0,0],[1,1,1]),V=new y(G,1,1,0,1,(()=>{}),!1);function c(B,I,C){return I=C,I*=1-(1-B.ratioInFluid)**2}R.prototype.tL=function(B){B/=1e3;var I=Q(0,e.squaredLength(this.gravity));this.bodies.forEach((C=>function(B,I,C,M){e.i(S,I.resting),B.CF&&V.loadFromCopy(I);if(I.ux<=0)return e.set(I.tg,0,0,0),e.set(I._forces,0,0,0),void e.set(I._impulses,0,0,0);var x=M||0===I.xL;if(function(B,I,C,M){if(I._sleepFrameCount>0)return!1;if(M)return!0;var x=!1,y=.5*C*C*I.xL;return e.scale(E,B.gravity,y),g(B.testSolid,I.MN,E,(function(){return x=!0,!0}),!0),x}(B,I,C,x))return;I._sleepFrameCount--,function(B,I){var C=I.MN,M=Math.floor(C.base[0]),x=Math.floor(C.base[2]),y=Math.floor(C.base[1]),f=Math.floor(C.max[1]);if(!B.testFluid(M,y,x))return I.inFluid=!1,void(I.ratioInFluid=0);var L=1,g=y+1;for(;g<=f&&B.testFluid(M,g,x);)L++,g++;var N=(y+L-C.base[1])/C.GN[1];N>1&&(N=1);var R=C.GN[0]*C.GN[1]*C.GN[2]*N,H=r;e.scale(H,B.gravity,-B.NL*R*I.xL),I.applyForce(H),I.inFluid=!0,I.ratioInFluid=N}(B,I),z(I._forces),z(I._impulses),z(I.tg),z(I.resting),e.scale(H,I._forces,1/I.ux),e.qL(H,H,B.gravity,I.xL),e.scale(F,I._impulses,1/I.ux),e.qL(F,F,H,C),e.add(I.tg,I.tg,F),I.friction&&(A(B,0,I,F,C),A(B,1,I,F,C),A(B,2,I,F,C));var y=I.fluidDrag>=0?I.fluidDrag:B.fluidDrag,f=I.UN>=0?I.UN:B.UN,L=f,N=f;I.inFluid&&(L=c(I,L,I.fluidDragHoriz>=0?I.fluidDragHoriz:y),N=c(I,N,I.fluidDragVert>=0?I.fluidDragVert:y));L=Math.max(1-L*C/I.ux,0),N=Math.max(1-N*C/I.ux,0),e.set(t,L,N,L),e.multiply(I.tg,I.tg,t),e.scale(k,I.tg,C),e.set(I._forces,0,0,0),e.set(I._impulses,0,0,0),I.yL&&Z(i,I.MN);e.i(o,k),e.set(U,0,0,0),I.preventFallOffEdge&&function(B,I,C,M){if(!I.resting[1]||C[1]>0)return;var x=W;Z(x,I.MN);for(var y=0;y<3;y+=2){e.set(a,0,0,0),a[y]=C[y];var f=!0;(f=(f=(f=(f=f&&!l(B,x.base[0]+a[0]+1e-5,x.base[1],x.base[2]+a[2]+1e-5))&&!l(B,x.max[0]+a[0]-1e-5,x.base[1],x.base[2]+a[2]+1e-5))&&!l(B,x.base[0]+a[0]+1e-5,x.base[1],x.max[2]+a[2]-1e-5))&&!l(B,x.max[0]+a[0]-1e-5,x.base[1],x.max[2]+a[2]-1e-5))?(M[y]=C[y]>0?1:-1,C[y]=0):0===y&&(e.set(d,C[0],0,0),J(B,x,d,M,I.slideOnCollision))}}(B,I,k,U);J(B,I.MN,k,I.resting,I.slideOnCollision),I.yL&&function(B,I,C,M){if(I.resting[1]>=0&&!I.inFluid)return;var x=0!==I.resting[0],y=0!==I.resting[2];if(!x&&!y)return;var f=Math.abs(M[0]/M[2]),L=4;if(!x&&f>L)return;if(!y&&f<1/L)return;e.add(p,C.base,M);var N=B.testSolid;g(N,C,M,(function(B,I,C,M){if(1!==I)return!0;M[I]=0}));var R=C.base[1],H=I.inFluid?1.951:1.001,F=Math.floor(R+H)-R;e.set(n,0,F,0);var k=!1;if(g(N,C,n,(function(B,I,C,M){return k=!0,!0})),k)return;e.FI(O,p,C.base),O[1]=0,J(B,C,O,u,!0);var q=Q(C.base[0],p[0]),S=Q(C.base[2],p[2]);if(x&&!q&&(!S||!y))return;if(y&&(!q||!x)&&!S)return;var o=!0;if(o=o&&!l(B,C.base[0]+1e-5,C.base[1],C.base[2]+1e-5),o=o&&!l(B,C.max[0]-1e-5,C.base[1],C.base[2]+1e-5),o=o&&!l(B,C.base[0]+1e-5,C.base[1],C.max[2]-1e-5),o=o&&!l(B,C.max[0]-1e-5,C.base[1],C.max[2]-1e-5),o)return;Z(I.MN,C),I.resting[0]=u[0],I.resting[2]=u[2],I.Vk&&I.Vk()}(B,I,i,o);for(var R=0;R<3;++R)I.resting[R]=I.resting[R]||U[R],q[R]=0,I.resting[R]&&(S[R]||(q[R]=-I.tg[R]),I.tg[R]=0);var G=e.length(q);G>.001&&(e.scale(q,q,I.ux),I.aF&&I.aF(q),I.restitution>0&&G>B.minBounceImpulse&&(e.scale(q,q,I.restitution),I.applyImpulse(q)));var D=e.squaredLength(I.tg);D>1e-5&&I.Jg();B.CF&&B.CF(I)?(I.loadFromCopy(V),I.rolledBackLastTick=!0):I.rolledBackLastTick=!1}(this,C,B,I)))};var t=e.create([0,0,0]);var r=e.create();function A(B,I,C,M,x){var y=C.resting[I],f=M[I];if(!C.alwaysApplyHorizFriction||1!==I){if(0===y)return;if(y*f<=0)return}e.i(D,C.tg),D[I]=0;var L=e.length(D);if(!Q(L,0)){var g=Math.abs(C.friction*B.gravity[I]*x),N=L>g?(L-g)/L:0;C.tg[(I+1)%3]*=N,C.tg[(I+2)%3]*=N}}var D=e.create();function J(B,I,C,M,x){return e.set(M,0,0,0),g(B.testSolid,I,C,(function(B,I,C,y){M[I]=C,y[I]=0,x||(y[0]=0,y[1]=0,y[2]=0)}))}var i=new L([],[]),u=e.create(),p=e.create(),n=e.create(),O=e.create();var a=e.create(),W=new L([],[]),d=e.create();function l(B,I,C,M){return B.testSolid(Math.floor(I),Math.floor(C-1),Math.floor(M))}var E=e.create();function Q(B,I){return Math.abs(B-I)<1e-5}function Z(B,I){for(var C=0;C<3;C++)B.base[C]=I.base[C],B.max[C]=I.max[C],B.GN[C]=I.GN[C]}var z=function(B){}},11868:function(B,I){!function(B){"use strict";var I=function(B,C){return I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(B,I){B.__proto__=I}||function(B,I){for(var C in I)Object.prototype.hasOwnProperty.call(I,C)&&(B[C]=I[C])},I(B,C)};function C(B,C){if("function"!==typeof C&&null!==C)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function M(){this.constructor=B}I(B,C),B.prototype=null===C?Object.create(C):(M.prototype=C.prototype,new M)}function M(B,I,C,M){var x,y=arguments.length,f=y<3?I:null===M?M=Object.getOwnPropertyDescriptor(I,C):M;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)f=Reflect.decorate(B,I,C,M);else for(var L=B.length-1;L>=0;L--)(x=B[L])&&(f=(y<3?x(f):y>3?x(I,C,f):x(I,C))||f);return y>3&&f&&Object.defineProperty(I,C,f),f}function x(B,I,C){if(C||2===arguments.length)for(var M,x=0,y=I.length;x<y;x++)!M&&x in I||(M||(M=Array.prototype.slice.call(I,0,x)),M[x]=I[x]);return B.concat(M||Array.prototype.slice.call(I))}var y,f=255,L=213;B.OPERATION=void 0,(y=B.OPERATION||(B.OPERATION={}))[y.ADD=128]="ADD",y[y.REPLACE=0]="REPLACE",y[y.DELETE=64]="DELETE",y[y.DELETE_AND_ADD=192]="DELETE_AND_ADD",y[y.TOUCH=1]="TOUCH",y[y.CLEAR=10]="CLEAR";var e=function(){function I(B,I,C){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=B,this.setParent(I,C)}return I.prototype.setParent=function(B,I,C){var M=this;if(this.indexes||(this.indexes=this.ref instanceof OB?this.ref._definition.indexes:{}),this.parent=B,this.parentIndex=C,I)if(this.root=I,this.ref instanceof OB){var x=this.ref._definition;for(var y in x.schema){var f=this.ref[y];if(f&&f.$changes){var L=x.indexes[y];f.$changes.setParent(this.ref,I,L)}}}else"object"===typeof this.ref&&this.ref.forEach((function(B,I){if(B instanceof OB){var C=B.$changes,x=M.ref.$changes.indexes[I];C.setParent(M.ref,M.root,x)}}))},I.prototype.operation=function(B){this.changes.set(--this.currentCustomOperation,B)},I.prototype.change=function(I,C){void 0===C&&(C=B.OPERATION.ADD);var M="number"===typeof I?I:this.indexes[I];this.assertValidIndex(M,I);var x=this.changes.get(M);x&&x.op!==B.OPERATION.DELETE&&x.op!==B.OPERATION.TOUCH||this.changes.set(M,{op:x&&x.op===B.OPERATION.DELETE?B.OPERATION.DELETE_AND_ADD:C,index:M}),this.allChanges.add(M),this.changed=!0,this.touchParents()},I.prototype.touch=function(I){var C="number"===typeof I?I:this.indexes[I];this.assertValidIndex(C,I),this.changes.has(C)||this.changes.set(C,{op:B.OPERATION.TOUCH,index:C}),this.allChanges.add(C),this.touchParents()},I.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},I.prototype.getType=function(B){if(this.ref._definition)return(I=this.ref._definition).schema[I.fieldsByIndex[B]];var I,C=(I=this.parent._definition).schema[I.fieldsByIndex[this.parentIndex]];return Object.values(C)[0]},I.prototype.getChildrenFilter=function(){var B=this.parent._definition.childFilters;return B&&B[this.parentIndex]},I.prototype.getValue=function(B){return this.ref.getByIndex(B)},I.prototype.delete=function(I){var C="number"===typeof I?I:this.indexes[I];if(void 0!==C){var M=this.getValue(C);this.changes.set(C,{op:B.OPERATION.DELETE,index:C}),this.allChanges.delete(C),delete this.caches[C],M&&M.$changes&&(M.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(I," (").concat(C,")"))},I.prototype.discard=function(I,C){var M=this;void 0===I&&(I=!1),void 0===C&&(C=!1),this.ref instanceof OB||this.changes.forEach((function(I){if(I.op===B.OPERATION.DELETE){var C=M.ref.getIndex(I.index);delete M.indexes[C]}})),this.changes.clear(),this.changed=I,C&&this.allChanges.clear(),this.currentCustomOperation=0},I.prototype.discardAll=function(){var B=this;this.changes.forEach((function(I){var C=B.getValue(I.index);C&&C.$changes&&C.$changes.discardAll()})),this.discard()},I.prototype.cache=function(B,I){this.caches[B]=I},I.prototype.clone=function(){return new I(this.ref,this.parent,this.root)},I.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},I.prototype.assertValidIndex=function(B,I){if(void 0===B)throw new Error('ChangeTree: missing index for field "'.concat(I,'"'))},I}();function g(B,I,C,M){return B[I]||(B[I]=[]),B[I].push(C),null===M||void 0===M||M.forEach((function(B,I){return C(B,I)})),function(){return R(B[I],B[I].indexOf(C))}}function N(I){var C=this,M="string"!==typeof this.$changes.getType();this.$items.forEach((function(x,y){I.push({refId:C.$changes.refId,op:B.OPERATION.DELETE,field:y,value:void 0,previousValue:x}),M&&C.$changes.root.removeRef(x.$changes.refId)}))}function R(B,I){if(-1===I||I>=B.length)return!1;for(var C=B.length-1,M=I;M<C;M++)B[M]=B[M+1];return B.length=C,!0}var H=function(B,I){var C=B.toString(),M=I.toString();return C<M?-1:C>M?1:0};function F(B){return B.$proxy=!0,B=new Proxy(B,{get:function(B,I){return"symbol"===typeof I||isNaN(I)?B[I]:B.at(I)},set:function(B,I,C){if("symbol"===typeof I||isNaN(I))B[I]=C;else{var M=Array.from(B.$items.keys()),x=parseInt(M[I]||I);void 0===C||null===C?B.deleteAt(x):B.setAt(x,C)}return!0},deleteProperty:function(B,I){return"number"===typeof I?B.deleteAt(I):delete B[I],!0}})}var k=function(){function I(){for(var B=[],I=0;I<arguments.length;I++)B[I]=arguments[I];this.$changes=new e(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,B)}return I.prototype.OL=function(I,C){return void 0===C&&(C=!0),g(this.$callbacks||(this.$callbacks=[]),B.OPERATION.ADD,I,C?this.$items:void 0)},I.prototype.XC=function(I){return g(this.$callbacks||(this.$callbacks=[]),B.OPERATION.DELETE,I)},I.prototype.onChange=function(I){return g(this.$callbacks||(this.$callbacks=[]),B.OPERATION.REPLACE,I)},I.is=function(B){return Array.isArray(B)||void 0!==B.array},Object.defineProperty(I.prototype,"length",{get:function(){return this.$items.size},set:function(B){0===B?this.clear():this.splice(B,this.length-B)},enumerable:!1,configurable:!0}),I.prototype.push=function(){for(var B,I=this,C=[],M=0;M<arguments.length;M++)C[M]=arguments[M];return C.forEach((function(C){B=I.$refId++,I.setAt(B,C)})),B},I.prototype.pop=function(){var B=Array.from(this.$indexes.values()).pop();if(void 0!==B){this.$changes.delete(B),this.$indexes.delete(B);var I=this.$items.get(B);return this.$items.delete(B),I}},I.prototype.at=function(B){var I=Array.from(this.$items.keys())[B];return this.$items.get(I)},I.prototype.setAt=function(I,C){var M,x;if(void 0!==C&&null!==C){if(this.$items.get(I)!==C){void 0!==C.$changes&&C.$changes.setParent(this,this.$changes.root,I);var y=null!==(x=null===(M=this.$changes.indexes[I])||void 0===M?void 0:M.op)&&void 0!==x?x:B.OPERATION.ADD;this.$changes.indexes[I]=I,this.$indexes.set(I,I),this.$items.set(I,C),this.$changes.change(I,y)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},I.prototype.deleteAt=function(B){var I=Array.from(this.$items.keys())[B];return void 0!==I&&this.$deleteAt(I)},I.prototype.$deleteAt=function(B){return this.$changes.delete(B),this.$indexes.delete(B),this.$items.delete(B)},I.prototype.clear=function(I){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),I&&N.call(this,I),this.$items.clear(),this.$changes.operation({index:0,op:B.OPERATION.CLEAR}),this.$changes.touchParents()},I.prototype.concat=function(){for(var B,C=[],M=0;M<arguments.length;M++)C[M]=arguments[M];return new(I.bind.apply(I,x([void 0],(B=Array.from(this.$items.values())).concat.apply(B,C),!1)))},I.prototype.join=function(B){return Array.from(this.$items.values()).join(B)},I.prototype.reverse=function(){var B=this,I=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(C,M){B.setAt(I[M],C)})),this},I.prototype.shift=function(){var B=Array.from(this.$items.keys()).shift();if(void 0!==B){var I=this.$items.get(B);return this.$deleteAt(B),I}},I.prototype.slice=function(B,C){var M=new I;return M.push.apply(M,Array.from(this.$items.values()).slice(B,C)),M},I.prototype.sort=function(B){var I=this;void 0===B&&(B=H);var C=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(B).forEach((function(B,M){I.setAt(C[M],B)})),this},I.prototype.splice=function(B,I){void 0===I&&(I=this.length-B);for(var C=Array.from(this.$items.keys()),M=[],x=B;x<B+I;x++)M.push(this.$items.get(C[x])),this.$deleteAt(C[x]);return M},I.prototype.unshift=function(){for(var B=this,I=[],C=0;C<arguments.length;C++)I[C]=arguments[C];var M=this.length,x=I.length,y=Array.from(this.$items.values());return I.forEach((function(I,C){B.setAt(C,I)})),y.forEach((function(I,C){B.setAt(x+C,I)})),M+x},I.prototype.indexOf=function(B,I){return Array.from(this.$items.values()).indexOf(B,I)},I.prototype.lastIndexOf=function(B,I){return void 0===I&&(I=this.length-1),Array.from(this.$items.values()).lastIndexOf(B,I)},I.prototype.every=function(B,I){return Array.from(this.$items.values()).every(B,I)},I.prototype.some=function(B,I){return Array.from(this.$items.values()).some(B,I)},I.prototype.forEach=function(B,I){Array.from(this.$items.values()).forEach(B,I)},I.prototype.map=function(B,I){return Array.from(this.$items.values()).map(B,I)},I.prototype.filter=function(B,I){return Array.from(this.$items.values()).filter(B,I)},I.prototype.reduce=function(B,I){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},I.prototype.reduceRight=function(B,I){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},I.prototype.find=function(B,I){return Array.from(this.$items.values()).find(B,I)},I.prototype.findIndex=function(B,I){return Array.from(this.$items.values()).findIndex(B,I)},I.prototype.fill=function(B,I,C){throw new Error("ArraySchema#fill() not implemented")},I.prototype.copyWithin=function(B,I,C){throw new Error("ArraySchema#copyWithin() not implemented")},I.prototype.toString=function(){return this.$items.toString()},I.prototype.toLocaleString=function(){return this.$items.toLocaleString()},I.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(I,Symbol.species,{get:function(){return I},enumerable:!1,configurable:!0}),I.prototype.entries=function(){return this.$items.entries()},I.prototype.keys=function(){return this.$items.keys()},I.prototype.values=function(){return this.$items.values()},I.prototype.includes=function(B,I){return Array.from(this.$items.values()).includes(B,I)},I.prototype.flatMap=function(B,I){throw new Error("ArraySchema#flatMap() is not supported.")},I.prototype.flat=function(B){throw new Error("ArraySchema#flat() is not supported.")},I.prototype.findLast=function(){var B=Array.from(this.$items.values());return B.findLast.apply(B,arguments)},I.prototype.findLastIndex=function(){var B=Array.from(this.$items.values());return B.findLastIndex.apply(B,arguments)},I.prototype.setIndex=function(B,I){this.$indexes.set(B,I)},I.prototype.getIndex=function(B){return this.$indexes.get(B)},I.prototype.getByIndex=function(B){return this.$items.get(this.$indexes.get(B))},I.prototype.deleteByIndex=function(B){var I=this.$indexes.get(B);this.$items.delete(I),this.$indexes.delete(B)},I.prototype.toArray=function(){return Array.from(this.$items.values())},I.prototype.toJSON=function(){return this.toArray().map((function(B){return"function"===typeof B.toJSON?B.toJSON():B}))},I.prototype.clone=function(B){return B?new(I.bind.apply(I,x([void 0],Array.from(this.$items.values()),!1))):new(I.bind.apply(I,x([void 0],this.map((function(B){return B.$changes?B.clone():B})),!1)))},I}();function q(B){return B.$proxy=!0,B=new Proxy(B,{get:function(B,I){return"symbol"!==typeof I&&"undefined"===typeof B[I]?B.get(I):B[I]},set:function(B,I,C){return"symbol"!==typeof I&&-1===I.indexOf("$")&&"OL"!==I&&"XC"!==I&&"onChange"!==I?B.set(I,C):B[I]=C,!0},deleteProperty:function(B,I){return B.delete(I),!0}})}var S=function(){function I(B){var C=this;if(this.$changes=new e(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,B)if(B instanceof Map||B instanceof I)B.forEach((function(B,I){return C.set(I,B)}));else for(var M in B)this.set(M,B[M])}return I.prototype.OL=function(I,C){return void 0===C&&(C=!0),g(this.$callbacks||(this.$callbacks=[]),B.OPERATION.ADD,I,C?this.$items:void 0)},I.prototype.XC=function(I){return g(this.$callbacks||(this.$callbacks=[]),B.OPERATION.DELETE,I)},I.prototype.onChange=function(I){return g(this.$callbacks||(this.$callbacks=[]),B.OPERATION.REPLACE,I)},I.is=function(B){return void 0!==B.map},I.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(I.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(I,Symbol.species,{get:function(){return I},enumerable:!1,configurable:!0}),I.prototype.set=function(I,C){if(void 0===C||null===C)throw new Error("MapSchema#set('".concat(I,"', ").concat(C,"): trying to set ").concat(C," value on '").concat(I,"'."));I=I.toString();var M="undefined"!==typeof this.$changes.indexes[I],x=M?this.$changes.indexes[I]:this.$refId++,y=M?B.OPERATION.REPLACE:B.OPERATION.ADD,f=void 0!==C.$changes;if(f&&C.$changes.setParent(this,this.$changes.root,x),M){if(!f&&this.$items.get(I)===C)return;f&&this.$items.get(I)!==C&&(y=B.OPERATION.ADD)}else this.$changes.indexes[I]=x,this.$indexes.set(x,I);return this.$items.set(I,C),this.$changes.change(I,y),this},I.prototype.get=function(B){return this.$items.get(B)},I.prototype.delete=function(B){return this.$changes.delete(B),this.$items.delete(B)},I.prototype.clear=function(I){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),I&&N.call(this,I),this.$items.clear(),this.$changes.operation({index:0,op:B.OPERATION.CLEAR}),this.$changes.touchParents()},I.prototype.has=function(B){return this.$items.has(B)},I.prototype.forEach=function(B){this.$items.forEach(B)},I.prototype.entries=function(){return this.$items.entries()},I.prototype.keys=function(){return this.$items.keys()},I.prototype.values=function(){return this.$items.values()},Object.defineProperty(I.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),I.prototype.setIndex=function(B,I){this.$indexes.set(B,I)},I.prototype.getIndex=function(B){return this.$indexes.get(B)},I.prototype.getByIndex=function(B){return this.$items.get(this.$indexes.get(B))},I.prototype.deleteByIndex=function(B){var I=this.$indexes.get(B);this.$items.delete(I),this.$indexes.delete(B)},I.prototype.toJSON=function(){var B={};return this.forEach((function(I,C){B[C]="function"===typeof I.toJSON?I.toJSON():I})),B},I.prototype.clone=function(B){var C;return B?C=Object.assign(new I,this):(C=new I,this.forEach((function(B,I){B.$changes?C.set(I,B.clone()):C.set(I,B)}))),C},I}(),o={};function U(B,I){o[B]=I}function G(B){return o[B]}var V=function(){function B(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return B.create=function(I){var C=new B;return C.schema=Object.assign({},I&&I.schema||{}),C.indexes=Object.assign({},I&&I.indexes||{}),C.fieldsByIndex=Object.assign({},I&&I.fieldsByIndex||{}),C.descriptors=Object.assign({},I&&I.descriptors||{}),C.deprecated=Object.assign({},I&&I.deprecated||{}),C},B.prototype.addField=function(B,I){var C=this.getNextFieldIndex();this.fieldsByIndex[C]=B,this.indexes[B]=C,this.schema[B]=Array.isArray(I)?{array:I[0]}:I},B.prototype.hasField=function(B){return void 0!==this.indexes[B]},B.prototype.addFilter=function(B,I){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[B]]=I,this.indexesWithFilters.push(this.indexes[B]),!0},B.prototype.addChildrenFilter=function(B,I){var C=this.indexes[B],M=this.schema[B];if(G(Object.keys(M)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[C]=I,!0;console.warn("@filterChildren: field '".concat(B,"' can't have children. Ignoring filter."))},B.prototype.getChildrenFilter=function(B){return this.childFilters&&this.childFilters[this.indexes[B]]},B.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},B}();function c(B){return B._context&&B._context.useFilters}var t=function(){function B(){this.types={},this.schemas=new Map,this.useFilters=!1}return B.prototype.has=function(B){return this.schemas.has(B)},B.prototype.get=function(B){return this.types[B]},B.prototype.add=function(B,I){void 0===I&&(I=this.schemas.size),B._definition=V.create(B._definition),B._typeid=I,this.types[I]=B,this.schemas.set(B,I)},B.create=function(I){return void 0===I&&(I={}),function(C){return I.context||(I.context=new B),A(C,I)}},B}(),r=new t;function A(B,I){return void 0===I&&(I={}),function(C,M){var y=I.context||r,f=C.constructor;if(f._context=y,!B)throw new Error("".concat(f.name,': @type() reference provided for "').concat(M,"\" is undefined. Make sure you don't have any circular dependencies."));y.has(f)||y.add(f);var L=f._definition;if(L.addField(M,B),L.descriptors[M]){if(L.deprecated[M])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(M,"' definition on '").concat(f.name,"'.\nCheck @type() annotation"))}catch(o){var e=o.stack.split("\n")[4].trim();throw new Error("".concat(o.message," ").concat(e))}}var g=k.is(B),N=!g&&S.is(B);if("string"!==typeof B&&!OB.is(B)){var R=Object.values(B)[0];"string"===typeof R||y.has(R)||y.add(R)}if(I.manual)L.descriptors[M]={enumerable:!0,configurable:!0,writable:!0};else{var H="_".concat(M);L.descriptors[H]={enumerable:!1,configurable:!1,writable:!0},L.descriptors[M]={get:function(){return this[H]},set:function(B){B!==this[H]&&(void 0!==B&&null!==B?(!g||B instanceof k||(B=new(k.bind.apply(k,x([void 0],B,!1)))),!N||B instanceof S||(B=new S(B)),void 0===B.$proxy&&(N?B=q(B):g&&(B=F(B))),this.$changes.change(M),B.$changes&&B.$changes.setParent(this,this.$changes.root,this._definition.indexes[M])):this[H]&&this.$changes.delete(M),this[H]=B)},enumerable:!0,configurable:!0}}}}function D(B){return function(I,C){var M=I.constructor;M._definition.addFilter(C,B)&&(M._context.useFilters=!0)}}function J(B){return function(I,C){var M=I.constructor;M._definition.addChildrenFilter(C,B)&&(M._context.useFilters=!0)}}function i(B){return void 0===B&&(B=!0),function(I,C){var M=I.constructor._definition;M.deprecated[C]=!0,B&&(M.descriptors[C]={get:function(){throw new Error("".concat(C," is deprecated."))},set:function(B){},enumerable:!1,configurable:!0})}}function u(B,I,C){for(var M in void 0===C&&(C={}),C.context||(C.context=B._context||C.context||r),I)A(I[M],C)(B.prototype,M);return B}function p(B){for(var I=0,C=0,M=0,x=B.length;M<x;M++)(I=B.charCodeAt(M))<128?C+=1:I<2048?C+=2:I<55296||I>=57344?C+=3:(M++,C+=4);return C}function n(B,I,C){for(var M=0,x=0,y=C.length;x<y;x++)(M=C.charCodeAt(x))<128?B[I++]=M:M<2048?(B[I++]=192|M>>6,B[I++]=128|63&M):M<55296||M>=57344?(B[I++]=224|M>>12,B[I++]=128|M>>6&63,B[I++]=128|63&M):(x++,M=65536+((1023&M)<<10|1023&C.charCodeAt(x)),B[I++]=240|M>>18,B[I++]=128|M>>12&63,B[I++]=128|M>>6&63,B[I++]=128|63&M)}function O(B,I){B.push(255&I)}function a(B,I){B.push(255&I)}function W(B,I){B.push(255&I),B.push(I>>8&255)}function d(B,I){B.push(255&I),B.push(I>>8&255)}function l(B,I){B.push(255&I),B.push(I>>8&255),B.push(I>>16&255),B.push(I>>24&255)}function E(B,I){var C=I>>24,M=I>>16,x=I>>8,y=I;B.push(255&y),B.push(255&x),B.push(255&M),B.push(255&C)}function Q(B,I){var C=Math.floor(I/Math.pow(2,32));E(B,I>>>0),E(B,C)}function Z(B,I){var C=I/Math.pow(2,32)|0;E(B,I>>>0),E(B,C)}function z(B,I){X(B,I)}function b(B,I){T(B,I)}var Y=new Int32Array(2),v=new Float32Array(Y.buffer),s=new Float64Array(Y.buffer);function X(B,I){v[0]=I,l(B,Y[0])}function T(B,I){s[0]=I,l(B,Y[0]),l(B,Y[1])}function P(B,I){return a(B,I?1:0)}function h(B,I){I||(I="");var C=p(I),M=0;if(C<32)B.push(160|C),M=1;else if(C<256)B.push(217),a(B,C),M=2;else if(C<65536)B.push(218),d(B,C),M=3;else{if(!(C<4294967296))throw new Error("String too long");B.push(219),E(B,C),M=5}return n(B,B.length,I),M+C}function j(B,I){return isNaN(I)?j(B,0):isFinite(I)?I!==(0|I)?(B.push(203),T(B,I),9):I>=0?I<128?(a(B,I),1):I<256?(B.push(204),a(B,I),2):I<65536?(B.push(205),d(B,I),3):I<4294967296?(B.push(206),E(B,I),5):(B.push(207),Z(B,I),9):I>=-32?(B.push(224|I+32),1):I>=-128?(B.push(208),O(B,I),2):I>=-32768?(B.push(209),W(B,I),3):I>=-2147483648?(B.push(210),l(B,I),5):(B.push(211),Q(B,I),9):j(B,I>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var w=Object.freeze({__proto__:null,utf8Write:n,int8:O,uint8:a,int16:W,uint16:d,int32:l,uint32:E,int64:Q,uint64:Z,float32:z,float64:b,writeFloat32:X,writeFloat64:T,boolean:P,string:h,number:j});function K(B,I,C){for(var M="",x=0,y=I,f=I+C;y<f;y++){var L=B[y];0!==(128&L)?192!==(224&L)?224!==(240&L)?240!==(248&L)?console.error("Invalid byte "+L.toString(16)):(x=(7&L)<<18|(63&B[++y])<<12|(63&B[++y])<<6|63&B[++y])>=65536?(x-=65536,M+=String.fromCharCode(55296+(x>>>10),56320+(1023&x))):M+=String.fromCharCode(x):M+=String.fromCharCode((15&L)<<12|(63&B[++y])<<6|63&B[++y]):M+=String.fromCharCode((31&L)<<6|63&B[++y]):M+=String.fromCharCode(L)}return M}function m(B,I){return BB(B,I)<<24>>24}function BB(B,I){return B[I.offset++]}function IB(B,I){return CB(B,I)<<16>>16}function CB(B,I){return B[I.offset++]|B[I.offset++]<<8}function MB(B,I){return B[I.offset++]|B[I.offset++]<<8|B[I.offset++]<<16|B[I.offset++]<<24}function xB(B,I){return MB(B,I)>>>0}function yB(B,I){return HB(B,I)}function fB(B,I){return FB(B,I)}function LB(B,I){var C=xB(B,I);return MB(B,I)*Math.pow(2,32)+C}function eB(B,I){var C=xB(B,I);return xB(B,I)*Math.pow(2,32)+C}var gB=new Int32Array(2),NB=new Float32Array(gB.buffer),RB=new Float64Array(gB.buffer);function HB(B,I){return gB[0]=MB(B,I),NB[0]}function FB(B,I){return gB[0]=MB(B,I),gB[1]=MB(B,I),RB[0]}function kB(B,I){return BB(B,I)>0}function qB(B,I){var C,M=B[I.offset++];M<192?C=31&M:217===M?C=BB(B,I):218===M?C=CB(B,I):219===M&&(C=xB(B,I));var x=K(B,I.offset,C);return I.offset+=C,x}function SB(B,I){var C=B[I.offset];return C<192&&C>160||217===C||218===C||219===C}function oB(B,I){var C=B[I.offset++];return C<128?C:202===C?HB(B,I):203===C?FB(B,I):204===C?BB(B,I):205===C?CB(B,I):206===C?xB(B,I):207===C?eB(B,I):208===C?m(B,I):209===C?IB(B,I):210===C?MB(B,I):211===C?LB(B,I):C>223?-1*(255-C+1):void 0}function UB(B,I){var C=B[I.offset];return C<128||C>=202&&C<=211}function GB(B,I){return B[I.offset]<160}function VB(B,I){return B[I.offset-1]===f&&(B[I.offset]<128||B[I.offset]>=202&&B[I.offset]<=211)}var cB=Object.freeze({__proto__:null,int8:m,uint8:BB,int16:IB,uint16:CB,int32:MB,uint32:xB,float32:yB,float64:fB,int64:LB,uint64:eB,readFloat32:HB,readFloat64:FB,boolean:kB,string:qB,stringCheck:SB,number:oB,numberCheck:UB,arrayCheck:GB,switchStructureCheck:VB}),tB=function(){function I(B){var I=this;this.$changes=new e(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,B&&B.forEach((function(B){return I.add(B)}))}return I.prototype.OL=function(I,C){return void 0===C&&(C=!0),g(this.$callbacks||(this.$callbacks=[]),B.OPERATION.ADD,I,C?this.$items:void 0)},I.prototype.XC=function(I){return g(this.$callbacks||(this.$callbacks=[]),B.OPERATION.DELETE,I)},I.prototype.onChange=function(I){return g(this.$callbacks||(this.$callbacks=[]),B.OPERATION.REPLACE,I)},I.is=function(B){return void 0!==B.collection},I.prototype.add=function(B){var I=this.$refId++;return void 0!==B.$changes&&B.$changes.setParent(this,this.$changes.root,I),this.$changes.indexes[I]=I,this.$indexes.set(I,I),this.$items.set(I,B),this.$changes.change(I),I},I.prototype.at=function(B){var I=Array.from(this.$items.keys())[B];return this.$items.get(I)},I.prototype.entries=function(){return this.$items.entries()},I.prototype.delete=function(B){for(var I,C,M=this.$items.entries();(C=M.next())&&!C.done;)if(B===C.value[1]){I=C.value[0];break}return void 0!==I&&(this.$changes.delete(I),this.$indexes.delete(I),this.$items.delete(I))},I.prototype.clear=function(I){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),I&&N.call(this,I),this.$items.clear(),this.$changes.operation({index:0,op:B.OPERATION.CLEAR}),this.$changes.touchParents()},I.prototype.has=function(B){return Array.from(this.$items.values()).some((function(I){return I===B}))},I.prototype.forEach=function(B){var I=this;this.$items.forEach((function(C,M,x){return B(C,M,I)}))},I.prototype.values=function(){return this.$items.values()},Object.defineProperty(I.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),I.prototype.setIndex=function(B,I){this.$indexes.set(B,I)},I.prototype.getIndex=function(B){return this.$indexes.get(B)},I.prototype.getByIndex=function(B){return this.$items.get(this.$indexes.get(B))},I.prototype.deleteByIndex=function(B){var I=this.$indexes.get(B);this.$items.delete(I),this.$indexes.delete(B)},I.prototype.toArray=function(){return Array.from(this.$items.values())},I.prototype.toJSON=function(){var B=[];return this.forEach((function(I,C){B.push("function"===typeof I.toJSON?I.toJSON():I)})),B},I.prototype.clone=function(B){var C;return B?C=Object.assign(new I,this):(C=new I,this.forEach((function(B){B.$changes?C.add(B.clone()):C.add(B)}))),C},I}(),rB=function(){function I(B){var I=this;this.$changes=new e(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,B&&B.forEach((function(B){return I.add(B)}))}return I.prototype.OL=function(I,C){return void 0===C&&(C=!0),g(this.$callbacks||(this.$callbacks=[]),B.OPERATION.ADD,I,C?this.$items:void 0)},I.prototype.XC=function(I){return g(this.$callbacks||(this.$callbacks=[]),B.OPERATION.DELETE,I)},I.prototype.onChange=function(I){return g(this.$callbacks||(this.$callbacks=[]),B.OPERATION.REPLACE,I)},I.is=function(B){return void 0!==B.set},I.prototype.add=function(I){var C,M;if(this.has(I))return!1;var x=this.$refId++;void 0!==I.$changes&&I.$changes.setParent(this,this.$changes.root,x);var y=null!==(M=null===(C=this.$changes.indexes[x])||void 0===C?void 0:C.op)&&void 0!==M?M:B.OPERATION.ADD;return this.$changes.indexes[x]=x,this.$indexes.set(x,x),this.$items.set(x,I),this.$changes.change(x,y),x},I.prototype.entries=function(){return this.$items.entries()},I.prototype.delete=function(B){for(var I,C,M=this.$items.entries();(C=M.next())&&!C.done;)if(B===C.value[1]){I=C.value[0];break}return void 0!==I&&(this.$changes.delete(I),this.$indexes.delete(I),this.$items.delete(I))},I.prototype.clear=function(I){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),I&&N.call(this,I),this.$items.clear(),this.$changes.operation({index:0,op:B.OPERATION.CLEAR}),this.$changes.touchParents()},I.prototype.has=function(B){for(var I,C=this.$items.values(),M=!1;(I=C.next())&&!I.done;)if(B===I.value){M=!0;break}return M},I.prototype.forEach=function(B){var I=this;this.$items.forEach((function(C,M,x){return B(C,M,I)}))},I.prototype.values=function(){return this.$items.values()},Object.defineProperty(I.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),I.prototype.setIndex=function(B,I){this.$indexes.set(B,I)},I.prototype.getIndex=function(B){return this.$indexes.get(B)},I.prototype.getByIndex=function(B){return this.$items.get(this.$indexes.get(B))},I.prototype.deleteByIndex=function(B){var I=this.$indexes.get(B);this.$items.delete(I),this.$indexes.delete(B)},I.prototype.toArray=function(){return Array.from(this.$items.values())},I.prototype.toJSON=function(){var B=[];return this.forEach((function(I,C){B.push("function"===typeof I.toJSON?I.toJSON():I)})),B},I.prototype.clone=function(B){var C;return B?C=Object.assign(new I,this):(C=new I,this.forEach((function(B){B.$changes?C.add(B.clone()):C.add(B)}))),C},I}(),AB=function(){function B(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return B.prototype.addRefId=function(B){this.refIds.has(B)||(this.refIds.add(B),this.containerIndexes.set(B,new Set))},B.get=function(I){return void 0===I.$filterState&&(I.$filterState=new B),I.$filterState},B}(),DB=function(){function B(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return B.prototype.getNextUniqueId=function(){return this.nextUniqueId++},B.prototype.addRef=function(B,I,C){void 0===C&&(C=!0),this.refs.set(B,I),C&&(this.refCounts[B]=(this.refCounts[B]||0)+1)},B.prototype.removeRef=function(B){this.refCounts[B]=this.refCounts[B]-1,this.deletedRefs.add(B)},B.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},B.prototype.garbageCollectDeletedRefs=function(){var B=this;this.deletedRefs.forEach((function(I){if(!(B.refCounts[I]>0)){var C=B.refs.get(I);if(C instanceof OB)for(var M in C._definition.schema)"string"!==typeof C._definition.schema[M]&&C[M]&&C[M].$changes&&B.removeRef(C[M].$changes.refId);else{var x=C.$changes.parent._definition,y=x.schema[x.fieldsByIndex[C.$changes.parentIndex]];"function"===typeof Object.values(y)[0]&&Array.from(C.values()).forEach((function(I){return B.removeRef(I.$changes.refId)}))}B.refs.delete(I),delete B.refCounts[I]}})),this.deletedRefs.clear()},B}(),JB=function(B){function I(){return null!==B&&B.apply(this,arguments)||this}return C(I,B),I}(Error);function iB(B,I,C,M){var x,y=!1;switch(I){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":x="number",isNaN(B)&&console.log('trying to encode "NaN" in '.concat(C.constructor.name,"#").concat(M));break;case"string":x="string",y=!0;break;case"boolean":return}if(typeof B!==x&&(!y||y&&null!==B)){var f="'".concat(JSON.stringify(B),"'").concat(B&&B.constructor&&" (".concat(B.constructor.name,")")||"");throw new JB("a '".concat(x,"' was expected, but ").concat(f," was provided in ").concat(C.constructor.name,"#").concat(M))}}function uB(B,I,C,M){if(!(B instanceof I))throw new JB("a '".concat(I.name,"' was expected, but '").concat(B.constructor.name,"' was provided in ").concat(C.constructor.name,"#").concat(M))}function pB(B,I,C,M,x){iB(C,B,M,x);var y=w[B];if(!y)throw new JB("a '".concat(B,"' was expected, but ").concat(C," was provided in ").concat(M.constructor.name,"#").concat(x));y(I,C)}function nB(B,I,C){return cB[B](I,C)}var OB=function(){function I(){for(var B=[],I=0;I<arguments.length;I++)B[I]=arguments[I];Object.defineProperties(this,{$changes:{value:new e(this,void 0,new DB),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var C=this._definition.descriptors;C&&Object.defineProperties(this,C),B[0]&&this.assign(B[0])}return I.onError=function(B){console.error(B)},I.is=function(B){return B._definition&&void 0!==B._definition.schema},I.prototype.onChange=function(I){return g(this.$callbacks||(this.$callbacks=[]),B.OPERATION.REPLACE,I)},I.prototype.XC=function(I){return g(this.$callbacks||(this.$callbacks=[]),B.OPERATION.DELETE,I)},I.prototype.assign=function(B){return Object.assign(this,B),this},Object.defineProperty(I.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),I.prototype.setDirty=function(B,I){this.$changes.change(B,I)},I.prototype.listen=function(B,I,C){var M=this;return void 0===C&&(C=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[B]||(this.$callbacks[B]=[]),this.$callbacks[B].push(I),C&&void 0!==this[B]&&I(this[B],void 0),function(){return R(M.$callbacks[B],M.$callbacks[B].indexOf(I))}},I.prototype.decode=function(C,M,x){var y;void 0===M&&(M={offset:0}),void 0===x&&(x=this);var L=[],e=this.$changes.root,g=C.length,N=0;for(e.refs.set(N,this);M.offset<g;){var R=C[M.offset++];if(R!=f){var H=x.$changes,F=void 0!==x._definition,q=F?R>>6<<6:R;if(q!==B.OPERATION.CLEAR){var o=F?R%(q||255):oB(C,M),U=F?x._definition.fieldsByIndex[o]:"",V=H.getType(o),c=void 0,t=void 0,r=void 0;if(F?t=x["_".concat(U)]:(t=x.getByIndex(o),(q&B.OPERATION.ADD)===B.OPERATION.ADD?(r=x instanceof S?qB(C,M):o,x.setIndex(o,r)):r=x.getIndex(o)),(q&B.OPERATION.DELETE)===B.OPERATION.DELETE&&(q!==B.OPERATION.DELETE_AND_ADD&&x.deleteByIndex(o),t&&t.$changes&&e.removeRef(t.$changes.refId),c=null),void 0!==U){if(q===B.OPERATION.DELETE);else if(I.is(V)){var A=oB(C,M);if(c=e.refs.get(A),q!==B.OPERATION.REPLACE){var D=this.getSchemaType(C,M,V);c||((c=this.createTypeInstance(D)).$changes.refId=A,t&&(c.$callbacks=t.$callbacks,t.$changes.refId&&A!==t.$changes.refId&&e.removeRef(t.$changes.refId))),e.addRef(A,c,c!==t)}}else if("string"===typeof V)c=nB(V,C,M);else{var J=G(Object.keys(V)[0]),i=oB(C,M),u=e.refs.has(i)?t||e.refs.get(i):new J.constructor;if((c=u.clone(!0)).$changes.refId=i,t&&(c.$callbacks=t.$callbacks,t.$changes.refId&&i!==t.$changes.refId)){e.removeRef(t.$changes.refId);for(var p=t.entries(),n=void 0;(n=p.next())&&!n.done;){var O=(y=n.value)[0],a=y[1];L.push({refId:i,op:B.OPERATION.DELETE,field:O,value:void 0,previousValue:a})}}e.addRef(i,c,u!==t)}if(null!==c&&void 0!==c)if(c.$changes&&c.$changes.setParent(H.ref,H.root,o),x instanceof I)x[U]=c;else if(x instanceof S)O=r,x.$items.set(O,c),x.$changes.allChanges.add(o);else if(x instanceof k)x.setAt(o,c);else if(x instanceof tB){var W=x.add(c);x.setIndex(o,W)}else x instanceof rB&&!1!==(W=x.add(c))&&x.setIndex(o,W);t!==c&&L.push({refId:N,op:q,field:U,dynamicIndex:r,value:c,previousValue:t})}else{console.warn("@colyseus/schema: definition mismatch");for(var d={offset:M.offset};M.offset<g&&(!VB(C,M)||(d.offset=M.offset+1,!e.refs.has(oB(C,d))));)M.offset++}}else x.clear(L)}else{N=oB(C,M);var l=e.refs.get(N);if(!l)throw new Error('"refId" not found: '.concat(N));x=l}}return this._triggerChanges(L),e.garbageCollectDeletedRefs(),L},I.prototype.encode=function(C,M,x){void 0===C&&(C=!1),void 0===M&&(M=[]),void 0===x&&(x=!1);for(var y=this.$changes,L=new WeakSet,e=[y],g=1,N=0;N<g;N++){var R=e[N],H=R.ref,F=H instanceof I;R.ensureRefId(),L.add(R),R!==y&&(R.changed||C)&&(a(M,f),j(M,R.refId));for(var k=C?Array.from(R.allChanges):Array.from(R.changes.values()),q=0,o=k.length;q<o;q++){var U=C?{op:B.OPERATION.ADD,index:k[q]}:k[q],V=U.index,c=F?H._definition.fieldsByIndex&&H._definition.fieldsByIndex[V]:V,t=M.length;if(U.op!==B.OPERATION.TOUCH)if(F)a(M,V|U.op);else{if(a(M,U.op),U.op===B.OPERATION.CLEAR)continue;j(M,V)}if(F||(U.op&B.OPERATION.ADD)!=B.OPERATION.ADD||H instanceof S&&h(M,R.ref.$indexes.get(V)),U.op!==B.OPERATION.DELETE){var r=R.getType(V),A=R.getValue(V);if(A&&A.$changes&&!L.has(A.$changes)&&(e.push(A.$changes),A.$changes.ensureRefId(),g++),U.op!==B.OPERATION.TOUCH){if(I.is(r))uB(A,r,H,c),j(M,A.$changes.refId),(U.op&B.OPERATION.ADD)===B.OPERATION.ADD&&this.tryEncodeTypeId(M,r,A.constructor);else if("string"===typeof r)pB(r,M,A,H,c);else{var D=G(Object.keys(r)[0]);uB(H["_".concat(c)],D.constructor,H,c),j(M,A.$changes.refId)}x&&R.cache(V,M.slice(t))}}}C||x||R.discard()}return M},I.prototype.encodeAll=function(B){return this.encode(!0,[],B)},I.prototype.applyFilters=function(C,M){var x,y;void 0===M&&(M=!1);for(var L=this,e=new Set,g=AB.get(C),N=[this.$changes],R=1,H=[],F=function(F){var k=N[F];if(e.has(k.refId))return"continue";var q=k.ref,o=q instanceof I;a(H,f),j(H,k.refId);var U=g.refIds.has(k),G=M||!U;g.addRefId(k);var V=g.containerIndexes.get(k),c=G?Array.from(k.allChanges):Array.from(k.changes.values());!M&&o&&q._definition.indexesWithFilters&&q._definition.indexesWithFilters.forEach((function(I){!V.has(I)&&k.allChanges.has(I)&&(G?c.push(I):c.push({op:B.OPERATION.ADD,index:I}))}));for(var t=0,r=c.length;t<r;t++){var A=G?{op:B.OPERATION.ADD,index:c[t]}:c[t];if(A.op!==B.OPERATION.CLEAR){var D=A.index;if(A.op!==B.OPERATION.DELETE){var J=k.getValue(D),i=k.getType(D);if(o){if((u=q._definition.filters&&q._definition.filters[D])&&!u.call(q,C,J,L)){J&&J.$changes&&e.add(J.$changes.refId);continue}}else{var u,p=k.parent;if((u=k.getChildrenFilter())&&!u.call(p,C,q.$indexes.get(D),J,L)){J&&J.$changes&&e.add(J.$changes.refId);continue}}if(J.$changes&&(N.push(J.$changes),R++),A.op!==B.OPERATION.TOUCH)if(A.op===B.OPERATION.ADD||o)H.push.apply(H,null!==(x=k.caches[D])&&void 0!==x?x:[]),V.add(D);else if(V.has(D))H.push.apply(H,null!==(y=k.caches[D])&&void 0!==y?y:[]);else{if(V.add(D),a(H,B.OPERATION.ADD),j(H,D),q instanceof S){var n=k.ref.$indexes.get(D);h(H,n)}J.$changes?j(H,J.$changes.refId):w[i](H,J)}else J.$changes&&!o&&(a(H,B.OPERATION.ADD),j(H,D),q instanceof S&&(n=k.ref.$indexes.get(D),h(H,n)),j(H,J.$changes.refId))}else o?a(H,A.op|D):(a(H,A.op),j(H,D))}else a(H,A.op)}},k=0;k<R;k++)F(k);return H},I.prototype.clone=function(){var B,I=new this.constructor,C=this._definition.schema;for(var M in C)"object"===typeof this[M]&&"function"===typeof(null===(B=this[M])||void 0===B?void 0:B.clone)?I[M]=this[M].clone():I[M]=this[M];return I},I.prototype.toJSON=function(){var B=this._definition.schema,I=this._definition.deprecated,C={};for(var M in B)I[M]||null===this[M]||"undefined"===typeof this[M]||(C[M]="function"===typeof this[M].toJSON?this[M].toJSON():this["_".concat(M)]);return C},I.prototype.discardAllChanges=function(){this.$changes.discardAll()},I.prototype.getByIndex=function(B){return this[this._definition.fieldsByIndex[B]]},I.prototype.deleteByIndex=function(B){this[this._definition.fieldsByIndex[B]]=void 0},I.prototype.tryEncodeTypeId=function(B,I,C){I._typeid!==C._typeid&&(a(B,L),j(B,C._typeid))},I.prototype.getSchemaType=function(B,I,C){var M;return B[I.offset]===L&&(I.offset++,M=this.constructor._context.get(oB(B,I))),M||C},I.prototype.createTypeInstance=function(B){var I=new B;return I.$changes.root=this.$changes.root,I},I.prototype._triggerChanges=function(C){for(var M,x,y,f,L,e,g,N,R,H=new Set,F=this.$changes.root.refs,k=function(k){var q=C[k],S=q.refId,o=F.get(S),U=o.$callbacks;if((q.op&B.OPERATION.DELETE)===B.OPERATION.DELETE&&q.previousValue instanceof I&&(null===(x=null===(M=q.previousValue.$callbacks)||void 0===M?void 0:M[B.OPERATION.DELETE])||void 0===x||x.forEach((function(B){return B()}))),!U)return"continue";if(o instanceof I){if(!H.has(S))try{null===(y=null===U||void 0===U?void 0:U[B.OPERATION.REPLACE])||void 0===y||y.forEach((function(B){return B()}))}catch(G){I.onError(G)}try{U.hasOwnProperty(q.field)&&(null===(f=U[q.field])||void 0===f||f.forEach((function(B){return B(q.value,q.previousValue)})))}catch(G){I.onError(G)}}else q.op===B.OPERATION.ADD&&void 0===q.previousValue?null===(L=U[B.OPERATION.ADD])||void 0===L||L.forEach((function(B){var I;return B(q.value,null!==(I=q.dynamicIndex)&&void 0!==I?I:q.field)})):q.op===B.OPERATION.DELETE?void 0!==q.previousValue&&(null===(e=U[B.OPERATION.DELETE])||void 0===e||e.forEach((function(B){var I;return B(q.previousValue,null!==(I=q.dynamicIndex)&&void 0!==I?I:q.field)}))):q.op===B.OPERATION.DELETE_AND_ADD&&(void 0!==q.previousValue&&(null===(g=U[B.OPERATION.DELETE])||void 0===g||g.forEach((function(B){var I;return B(q.previousValue,null!==(I=q.dynamicIndex)&&void 0!==I?I:q.field)}))),null===(N=U[B.OPERATION.ADD])||void 0===N||N.forEach((function(B){var I;return B(q.value,null!==(I=q.dynamicIndex)&&void 0!==I?I:q.field)}))),q.value!==q.previousValue&&(null===(R=U[B.OPERATION.REPLACE])||void 0===R||R.forEach((function(B){var I;return B(q.value,null!==(I=q.dynamicIndex)&&void 0!==I?I:q.field)})));H.add(S)},q=0;q<C.length;q++)k(q)},I._definition=V.create(),I}();function aB(B){for(var I=[B.$changes],C=1,M={},x=M,y=function(B){var C=I[B];C.changes.forEach((function(B){var I=C.ref,M=B.index,y=I._definition?I._definition.fieldsByIndex[M]:I.$indexes.get(M);x[y]=C.getValue(M)}))},f=0;f<C;f++)y(f);return M}var WB={context:new t},dB=function(B){function I(){return null!==B&&B.apply(this,arguments)||this}return C(I,B),M([A("string",WB)],I.prototype,"name",void 0),M([A("string",WB)],I.prototype,"type",void 0),M([A("number",WB)],I.prototype,"referencedType",void 0),I}(OB),lB=function(B){function I(){var I=null!==B&&B.apply(this,arguments)||this;return I.fields=new k,I}return C(I,B),M([A("number",WB)],I.prototype,"id",void 0),M([A([dB],WB)],I.prototype,"fields",void 0),I}(OB),EB=function(B){function I(){var I=null!==B&&B.apply(this,arguments)||this;return I.types=new k,I}return C(I,B),I.encode=function(B){var C=B.constructor,M=new I;M.rootType=C._typeid;var x=function(B,I){for(var C in I){var x=new dB;x.name=C;var y=void 0;if("string"===typeof I[C])y=I[C];else{var f=I[C],L=void 0;OB.is(f)?(y="ref",L=I[C]):"string"===typeof f[y=Object.keys(f)[0]]?y+=":"+f[y]:L=f[y],x.referencedType=L?L._typeid:-1}x.type=y,B.fields.push(x)}M.types.push(B)},y=C._context.types;for(var f in y){var L=new lB;L.id=Number(f),x(L,y[f]._definition.schema)}return M.encodeAll()},I.decode=function(B,M){var x=new t,y=new I;y.decode(B,M);var f=y.types.reduce((function(B,I){var M=function(B){function I(){return null!==B&&B.apply(this,arguments)||this}return C(I,B),I}(OB),y=I.id;return B[y]=M,x.add(M,y),B}),{});y.types.forEach((function(B){var I=f[B.id];B.fields.forEach((function(B){var C;if(void 0!==B.referencedType){var M=B.type,y=f[B.referencedType];if(!y){var L=B.type.split(":");M=L[0],y=L[1]}"ref"===M?A(y,{context:x})(I.prototype,B.name):A(((C={})[M]=y,C),{context:x})(I.prototype,B.name)}else A(B.type,{context:x})(I.prototype,B.name)}))}));var L=f[y.rootType],e=new L;for(var g in L._definition.schema){var N=L._definition.schema[g];"string"!==typeof N&&(e[g]="function"===typeof N?new N:new(G(Object.keys(N)[0]).constructor))}return e},M([A([lB],WB)],I.prototype,"types",void 0),M([A("number",WB)],I.prototype,"rootType",void 0),I}(OB);U("map",{constructor:S}),U("array",{constructor:k}),U("set",{constructor:rB}),U("collection",{constructor:tB}),B.ArraySchema=k,B.CollectionSchema=tB,B.Context=t,B.MapSchema=S,B.Reflection=EB,B.ReflectionField=dB,B.ReflectionType=lB,B.Schema=OB,B.SchemaDefinition=V,B.SetSchema=rB,B.decode=cB,B.defineTypes=u,B.deprecated=i,B.dumpChanges=aB,B.encode=w,B.filter=D,B.filterChildren=J,B.hasFilter=c,B.registerType=U,B.type=A,Object.defineProperty(B,"__esModule",{value:!0})}(I)},13315:B=>{"use strict";B.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13307:(B,I,C)=>{var M=C(13315),x=C(13317),y=Object.hasOwnProperty,f=Object.create(null);for(var L in M)y.call(M,L)&&(f[M[L]]=L);var e=B.exports={to:{},get:{}};function g(B,I,C){return Math.min(Math.max(I,B),C)}function N(B){var I=Math.round(B).toString(16).toUpperCase();return I.length<2?"0"+I:I}e.get=function(B){var I,C;switch(B.substring(0,3).toLowerCase()){case"hsl":I=e.get.hsl(B),C="hsl";break;case"hwb":I=e.get.hwb(B),C="hwb";break;default:I=e.get.rgb(B),C="rgb"}return I?{model:C,value:I}:null},e.get.rgb=function(B){if(!B)return null;var I,C,x,f=[0,0,0,1];if(I=B.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(x=I[2],I=I[1],C=0;C<3;C++){var L=2*C;f[C]=parseInt(I.slice(L,L+2),16)}x&&(f[3]=parseInt(x,16)/255)}else if(I=B.match(/^#([a-f0-9]{3,4})$/i)){for(x=(I=I[1])[3],C=0;C<3;C++)f[C]=parseInt(I[C]+I[C],16);x&&(f[3]=parseInt(x+x,16)/255)}else if(I=B.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(C=0;C<3;C++)f[C]=parseInt(I[C+1],0);I[4]&&(I[5]?f[3]=.01*parseFloat(I[4]):f[3]=parseFloat(I[4]))}else{if(!(I=B.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(I=B.match(/^(\w+)$/))?"transparent"===I[1]?[0,0,0,0]:y.call(M,I[1])?((f=M[I[1]])[3]=1,f):null:null;for(C=0;C<3;C++)f[C]=Math.round(2.55*parseFloat(I[C+1]));I[4]&&(I[5]?f[3]=.01*parseFloat(I[4]):f[3]=parseFloat(I[4]))}for(C=0;C<3;C++)f[C]=g(f[C],0,255);return f[3]=g(f[3],0,1),f},e.get.hsl=function(B){if(!B)return null;var I=B.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(I){var C=parseFloat(I[4]);return[(parseFloat(I[1])%360+360)%360,g(parseFloat(I[2]),0,100),g(parseFloat(I[3]),0,100),g(isNaN(C)?1:C,0,1)]}return null},e.get.hwb=function(B){if(!B)return null;var I=B.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(I){var C=parseFloat(I[4]);return[(parseFloat(I[1])%360+360)%360,g(parseFloat(I[2]),0,100),g(parseFloat(I[3]),0,100),g(isNaN(C)?1:C,0,1)]}return null},e.to.hex=function(){var B=x(arguments);return"#"+N(B[0])+N(B[1])+N(B[2])+(B[3]<1?N(Math.round(255*B[3])):"")},e.to.rgb=function(){var B=x(arguments);return B.length<4||1===B[3]?"rgb("+Math.round(B[0])+", "+Math.round(B[1])+", "+Math.round(B[2])+")":"rgba("+Math.round(B[0])+", "+Math.round(B[1])+", "+Math.round(B[2])+", "+B[3]+")"},e.to.rgb.percent=function(){var B=x(arguments),I=Math.round(B[0]/255*100),C=Math.round(B[1]/255*100),M=Math.round(B[2]/255*100);return B.length<4||1===B[3]?"rgb("+I+"%, "+C+"%, "+M+"%)":"rgba("+I+"%, "+C+"%, "+M+"%, "+B[3]+")"},e.to.hsl=function(){var B=x(arguments);return B.length<4||1===B[3]?"hsl("+B[0]+", "+B[1]+"%, "+B[2]+"%)":"hsla("+B[0]+", "+B[1]+"%, "+B[2]+"%, "+B[3]+")"},e.to.hwb=function(){var B=x(arguments),I="";return B.length>=4&&1!==B[3]&&(I=", "+B[3]),"hwb("+B[0]+", "+B[1]+"%, "+B[2]+"%"+I+")"},e.to.keyword=function(B){return f[B.slice(0,3)]}},13298:(B,I,C)=>{const M=C(13307),x=C(13328),y=["keyword","gray","hex"],f={};for(const F of Object.keys(x))f[[...x[F].labels].sort().join("")]=F;const L={};function e(B,I){if(!(this instanceof e))return new e(B,I);if(I&&I in y&&(I=null),I&&!(I in x))throw new Error("Unknown model: "+I);let C,g;if(null==B)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(B instanceof e)this.model=B.model,this.color=[...B.color],this.valpha=B.valpha;else if("string"===typeof B){const I=M.get(B);if(null===I)throw new Error("Unable to parse color from string: "+B);this.model=I.model,g=x[this.model].channels,this.color=I.value.slice(0,g),this.valpha="number"===typeof I.value[g]?I.value[g]:1}else if(B.length>0){this.model=I||"rgb",g=x[this.model].channels;const C=Array.prototype.slice.call(B,0,g);this.color=H(C,g),this.valpha="number"===typeof B[g]?B[g]:1}else if("number"===typeof B)this.model="rgb",this.color=[B>>16&255,B>>8&255,255&B],this.valpha=1;else{this.valpha=1;const I=Object.keys(B);"alpha"in B&&(I.splice(I.indexOf("alpha"),1),this.valpha="number"===typeof B.alpha?B.alpha:0);const M=I.sort().join("");if(!(M in f))throw new Error("Unable to parse color from object: "+JSON.stringify(B));this.model=f[M];const{labels:y}=x[this.model],L=[];for(C=0;C<y.length;C++)L.push(B[y[C]]);this.color=H(L)}if(L[this.model])for(g=x[this.model].channels,C=0;C<g;C++){const B=L[this.model][C];B&&(this.color[C]=B(this.color[C]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}e.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(B){let I=this.model in M.to?this:this.rgb();I=I.round("number"===typeof B?B:1);const C=1===I.valpha?I.color:[...I.color,this.valpha];return M.to[I.model](C)},percentString(B){const I=this.rgb().round("number"===typeof B?B:1),C=1===I.valpha?I.color:[...I.color,this.valpha];return M.to.rgb.percent(C)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const B={},{channels:I}=x[this.model],{labels:C}=x[this.model];for(let M=0;M<I;M++)B[C[M]]=this.color[M];return 1!==this.valpha&&(B.alpha=this.valpha),B},unitArray(){const B=this.rgb().color;return B[0]/=255,B[1]/=255,B[2]/=255,1!==this.valpha&&B.push(this.valpha),B},unitObject(){const B=this.rgb().object();return B.r/=255,B.g/=255,B.b/=255,1!==this.valpha&&(B.alpha=this.valpha),B},round(B){return B=Math.max(B||0,0),new e([...this.color.map(g(B)),this.valpha],this.model)},alpha(B){return void 0!==B?new e([...this.color,Math.max(0,Math.min(1,B))],this.model):this.valpha},red:N("rgb",0,R(255)),green:N("rgb",1,R(255)),blue:N("rgb",2,R(255)),hue:N(["hsl","hsv","hsl","hwb","hcg"],0,(B=>(B%360+360)%360)),saturationl:N("hsl",1,R(100)),lightness:N("hsl",2,R(100)),saturationv:N("hsv",1,R(100)),value:N("hsv",2,R(100)),chroma:N("hcg",1,R(100)),gray:N("hcg",2,R(100)),white:N("hwb",1,R(100)),wblack:N("hwb",2,R(100)),cyan:N("cmyk",0,R(100)),magenta:N("cmyk",1,R(100)),yellow:N("cmyk",2,R(100)),black:N("cmyk",3,R(100)),x:N("xyz",0,R(95.047)),y:N("xyz",1,R(100)),z:N("xyz",2,R(108.833)),l:N("lab",0,R(100)),a:N("lab",1),b:N("lab",2),keyword(B){return void 0!==B?new e(B):x[this.model].keyword(this.color)},hex(B){return void 0!==B?new e(B):M.to.hex(this.rgb().round().color)},hexa(B){if(void 0!==B)return new e(B);const I=this.rgb().round().color;let C=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===C.length&&(C="0"+C),M.to.hex(I)+C},rgbNumber(){const B=this.rgb().color;return(255&B[0])<<16|(255&B[1])<<8|255&B[2]},luminosity(){const B=this.rgb().color,I=[];for(const[C,M]of B.entries()){const B=M/255;I[C]=B<=.04045?B/12.92:((B+.055)/1.055)**2.4}return.2126*I[0]+.7152*I[1]+.0722*I[2]},contrast(B){const I=this.luminosity(),C=B.luminosity();return I>C?(I+.05)/(C+.05):(C+.05)/(I+.05)},level(B){const I=this.contrast(B);return I>=7?"AAA":I>=4.5?"AA":""},isDark(){const B=this.rgb().color;return(2126*B[0]+7152*B[1]+722*B[2])/1e4<128},isLight(){return!this.isDark()},negate(){const B=this.rgb();for(let I=0;I<3;I++)B.color[I]=255-B.color[I];return B},lighten(B){const I=this.hsl();return I.color[2]+=I.color[2]*B,I},darken(B){const I=this.hsl();return I.color[2]-=I.color[2]*B,I},saturate(B){const I=this.hsl();return I.color[1]+=I.color[1]*B,I},desaturate(B){const I=this.hsl();return I.color[1]-=I.color[1]*B,I},whiten(B){const I=this.hwb();return I.color[1]+=I.color[1]*B,I},blacken(B){const I=this.hwb();return I.color[2]+=I.color[2]*B,I},grayscale(){const B=this.rgb().color,I=.3*B[0]+.59*B[1]+.11*B[2];return e.rgb(I,I,I)},fade(B){return this.alpha(this.valpha-this.valpha*B)},opaquer(B){return this.alpha(this.valpha+this.valpha*B)},rotate(B){const I=this.hsl();let C=I.color[0];return C=(C+B)%360,C=C<0?360+C:C,I.color[0]=C,I},mix(B,I){if(!B||!B.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof B);const C=B.rgb(),M=this.rgb(),x=void 0===I?.5:I,y=2*x-1,f=C.alpha()-M.alpha(),L=((y*f===-1?y:(y+f)/(1+y*f))+1)/2,g=1-L;return e.rgb(L*C.red()+g*M.red(),L*C.green()+g*M.green(),L*C.blue()+g*M.blue(),C.alpha()*x+M.alpha()*(1-x))}};for(const F of Object.keys(x)){if(y.includes(F))continue;const{channels:B}=x[F];e.prototype[F]=function(){if(this.model===F)return new e(this);for(var B=arguments.length,I=new Array(B),C=0;C<B;C++)I[C]=arguments[C];return I.length>0?new e(I,F):new e([...(M=x[this.model][F].raw(this.color),Array.isArray(M)?M:[M]),this.valpha],F);var M},e[F]=function(){for(var I=arguments.length,C=new Array(I),M=0;M<I;M++)C[M]=arguments[M];let x=C[0];return"number"===typeof x&&(x=H(C,B)),new e(x,F)}}function g(B){return function(I){return function(B,I){return Number(B.toFixed(I))}(I,B)}}function N(B,I,C){B=Array.isArray(B)?B:[B];for(const M of B)(L[M]||(L[M]=[]))[I]=C;return B=B[0],function(M){let x;return void 0!==M?(C&&(M=C(M)),x=this[B](),x.color[I]=M,x):(x=this[B]().color[I],C&&(x=C(x)),x)}}function R(B){return function(I){return Math.max(0,Math.min(B,I))}}function H(B,I){for(let C=0;C<I;C++)"number"!==typeof B[C]&&(B[C]=0);return B}B.exports=e},13332:(B,I,C)=>{const M=C(13335),x={};for(const f of Object.keys(M))x[M[f]]=f;const y={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};B.exports=y;for(const f of Object.keys(y)){if(!("channels"in y[f]))throw new Error("missing channels property: "+f);if(!("labels"in y[f]))throw new Error("missing channel labels property: "+f);if(y[f].labels.length!==y[f].channels)throw new Error("channel and label counts mismatch: "+f);const{channels:B,labels:I}=y[f];delete y[f].channels,delete y[f].labels,Object.defineProperty(y[f],"channels",{value:B}),Object.defineProperty(y[f],"labels",{value:I})}y.rgb.hsl=function(B){const I=B[0]/255,C=B[1]/255,M=B[2]/255,x=Math.min(I,C,M),y=Math.max(I,C,M),f=y-x;let L,e;y===x?L=0:I===y?L=(C-M)/f:C===y?L=2+(M-I)/f:M===y&&(L=4+(I-C)/f),L=Math.min(60*L,360),L<0&&(L+=360);const g=(x+y)/2;return e=y===x?0:g<=.5?f/(y+x):f/(2-y-x),[L,100*e,100*g]},y.rgb.hsv=function(B){let I,C,M,x,y;const f=B[0]/255,L=B[1]/255,e=B[2]/255,g=Math.max(f,L,e),N=g-Math.min(f,L,e),R=function(B){return(g-B)/6/N+.5};return 0===N?(x=0,y=0):(y=N/g,I=R(f),C=R(L),M=R(e),f===g?x=M-C:L===g?x=1/3+I-M:e===g&&(x=2/3+C-I),x<0?x+=1:x>1&&(x-=1)),[360*x,100*y,100*g]},y.rgb.hwb=function(B){const I=B[0],C=B[1];let M=B[2];const x=y.rgb.hsl(B)[0],f=1/255*Math.min(I,Math.min(C,M));return M=1-1/255*Math.max(I,Math.max(C,M)),[x,100*f,100*M]},y.rgb.cmyk=function(B){const I=B[0]/255,C=B[1]/255,M=B[2]/255,x=Math.min(1-I,1-C,1-M);return[100*((1-I-x)/(1-x)||0),100*((1-C-x)/(1-x)||0),100*((1-M-x)/(1-x)||0),100*x]},y.rgb.keyword=function(B){const I=x[B];if(I)return I;let C,y=1/0;for(const x of Object.keys(M)){const I=M[x],e=(L=I,((f=B)[0]-L[0])**2+(f[1]-L[1])**2+(f[2]-L[2])**2);e<y&&(y=e,C=x)}var f,L;return C},y.keyword.rgb=function(B){return M[B]},y.rgb.xyz=function(B){let I=B[0]/255,C=B[1]/255,M=B[2]/255;I=I>.04045?((I+.055)/1.055)**2.4:I/12.92,C=C>.04045?((C+.055)/1.055)**2.4:C/12.92,M=M>.04045?((M+.055)/1.055)**2.4:M/12.92;return[100*(.4124*I+.3576*C+.1805*M),100*(.2126*I+.7152*C+.0722*M),100*(.0193*I+.1192*C+.9505*M)]},y.rgb.lab=function(B){const I=y.rgb.xyz(B);let C=I[0],M=I[1],x=I[2];C/=95.047,M/=100,x/=108.883,C=C>.008856?C**(1/3):7.787*C+16/116,M=M>.008856?M**(1/3):7.787*M+16/116,x=x>.008856?x**(1/3):7.787*x+16/116;return[116*M-16,500*(C-M),200*(M-x)]},y.hsl.rgb=function(B){const I=B[0]/360,C=B[1]/100,M=B[2]/100;let x,y,f;if(0===C)return f=255*M,[f,f,f];x=M<.5?M*(1+C):M+C-M*C;const L=2*M-x,e=[0,0,0];for(let g=0;g<3;g++)y=I+1/3*-(g-1),y<0&&y++,y>1&&y--,f=6*y<1?L+6*(x-L)*y:2*y<1?x:3*y<2?L+(x-L)*(2/3-y)*6:L,e[g]=255*f;return e},y.hsl.hsv=function(B){const I=B[0];let C=B[1]/100,M=B[2]/100,x=C;const y=Math.max(M,.01);M*=2,C*=M<=1?M:2-M,x*=y<=1?y:2-y;return[I,100*(0===M?2*x/(y+x):2*C/(M+C)),100*((M+C)/2)]},y.hsv.rgb=function(B){const I=B[0]/60,C=B[1]/100;let M=B[2]/100;const x=Math.floor(I)%6,y=I-Math.floor(I),f=255*M*(1-C),L=255*M*(1-C*y),e=255*M*(1-C*(1-y));switch(M*=255,x){case 0:return[M,e,f];case 1:return[L,M,f];case 2:return[f,M,e];case 3:return[f,L,M];case 4:return[e,f,M];case 5:return[M,f,L]}},y.hsv.hsl=function(B){const I=B[0],C=B[1]/100,M=B[2]/100,x=Math.max(M,.01);let y,f;f=(2-C)*M;const L=(2-C)*x;return y=C*x,y/=L<=1?L:2-L,y=y||0,f/=2,[I,100*y,100*f]},y.hwb.rgb=function(B){const I=B[0]/360;let C=B[1]/100,M=B[2]/100;const x=C+M;let y;x>1&&(C/=x,M/=x);const f=Math.floor(6*I),L=1-M;y=6*I-f,0!==(1&f)&&(y=1-y);const e=C+y*(L-C);let g,N,R;switch(f){default:case 6:case 0:g=L,N=e,R=C;break;case 1:g=e,N=L,R=C;break;case 2:g=C,N=L,R=e;break;case 3:g=C,N=e,R=L;break;case 4:g=e,N=C,R=L;break;case 5:g=L,N=C,R=e}return[255*g,255*N,255*R]},y.cmyk.rgb=function(B){const I=B[0]/100,C=B[1]/100,M=B[2]/100,x=B[3]/100;return[255*(1-Math.min(1,I*(1-x)+x)),255*(1-Math.min(1,C*(1-x)+x)),255*(1-Math.min(1,M*(1-x)+x))]},y.xyz.rgb=function(B){const I=B[0]/100,C=B[1]/100,M=B[2]/100;let x,y,f;return x=3.2406*I+-1.5372*C+-.4986*M,y=-.9689*I+1.8758*C+.0415*M,f=.0557*I+-.204*C+1.057*M,x=x>.0031308?1.055*x**(1/2.4)-.055:12.92*x,y=y>.0031308?1.055*y**(1/2.4)-.055:12.92*y,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,x=Math.min(Math.max(0,x),1),y=Math.min(Math.max(0,y),1),f=Math.min(Math.max(0,f),1),[255*x,255*y,255*f]},y.xyz.lab=function(B){let I=B[0],C=B[1],M=B[2];I/=95.047,C/=100,M/=108.883,I=I>.008856?I**(1/3):7.787*I+16/116,C=C>.008856?C**(1/3):7.787*C+16/116,M=M>.008856?M**(1/3):7.787*M+16/116;return[116*C-16,500*(I-C),200*(C-M)]},y.lab.xyz=function(B){let I,C,M;C=(B[0]+16)/116,I=B[1]/500+C,M=C-B[2]/200;const x=C**3,y=I**3,f=M**3;return C=x>.008856?x:(C-16/116)/7.787,I=y>.008856?y:(I-16/116)/7.787,M=f>.008856?f:(M-16/116)/7.787,I*=95.047,C*=100,M*=108.883,[I,C,M]},y.lab.lch=function(B){const I=B[0],C=B[1],M=B[2];let x;x=360*Math.atan2(M,C)/2/Math.PI,x<0&&(x+=360);return[I,Math.sqrt(C*C+M*M),x]},y.lch.lab=function(B){const I=B[0],C=B[1],M=B[2]/360*2*Math.PI;return[I,C*Math.cos(M),C*Math.sin(M)]},y.rgb.ansi16=function(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[C,M,x]=B;let f=null===I?y.rgb.hsv(B)[2]:I;if(f=Math.round(f/50),0===f)return 30;let L=30+(Math.round(x/255)<<2|Math.round(M/255)<<1|Math.round(C/255));return 2===f&&(L+=60),L},y.hsv.ansi16=function(B){return y.rgb.ansi16(y.hsv.rgb(B),B[2])},y.rgb.ansi256=function(B){const I=B[0],C=B[1],M=B[2];if(I===C&&C===M)return I<8?16:I>248?231:Math.round((I-8)/247*24)+232;return 16+36*Math.round(I/255*5)+6*Math.round(C/255*5)+Math.round(M/255*5)},y.ansi16.rgb=function(B){let I=B%10;if(0===I||7===I)return B>50&&(I+=3.5),I=I/10.5*255,[I,I,I];const C=.5*(1+~~(B>50));return[(1&I)*C*255,(I>>1&1)*C*255,(I>>2&1)*C*255]},y.ansi256.rgb=function(B){if(B>=232){const I=10*(B-232)+8;return[I,I,I]}let I;B-=16;return[Math.floor(B/36)/5*255,Math.floor((I=B%36)/6)/5*255,I%6/5*255]},y.rgb.hex=function(B){const I=(((255&Math.round(B[0]))<<16)+((255&Math.round(B[1]))<<8)+(255&Math.round(B[2]))).toString(16).toUpperCase();return"000000".substring(I.length)+I},y.hex.rgb=function(B){const I=B.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!I)return[0,0,0];let C=I[0];3===I[0].length&&(C=C.split("").map((B=>B+B)).join(""));const M=parseInt(C,16);return[M>>16&255,M>>8&255,255&M]},y.rgb.hcg=function(B){const I=B[0]/255,C=B[1]/255,M=B[2]/255,x=Math.max(Math.max(I,C),M),y=Math.min(Math.min(I,C),M),f=x-y;let L,e;return L=f<1?y/(1-f):0,e=f<=0?0:x===I?(C-M)/f%6:x===C?2+(M-I)/f:4+(I-C)/f,e/=6,e%=1,[360*e,100*f,100*L]},y.hsl.hcg=function(B){const I=B[1]/100,C=B[2]/100,M=C<.5?2*I*C:2*I*(1-C);let x=0;return M<1&&(x=(C-.5*M)/(1-M)),[B[0],100*M,100*x]},y.hsv.hcg=function(B){const I=B[1]/100,C=B[2]/100,M=I*C;let x=0;return M<1&&(x=(C-M)/(1-M)),[B[0],100*M,100*x]},y.hcg.rgb=function(B){const I=B[0]/360,C=B[1]/100,M=B[2]/100;if(0===C)return[255*M,255*M,255*M];const x=[0,0,0],y=I%1*6,f=y%1,L=1-f;let e=0;switch(Math.floor(y)){case 0:x[0]=1,x[1]=f,x[2]=0;break;case 1:x[0]=L,x[1]=1,x[2]=0;break;case 2:x[0]=0,x[1]=1,x[2]=f;break;case 3:x[0]=0,x[1]=L,x[2]=1;break;case 4:x[0]=f,x[1]=0,x[2]=1;break;default:x[0]=1,x[1]=0,x[2]=L}return e=(1-C)*M,[255*(C*x[0]+e),255*(C*x[1]+e),255*(C*x[2]+e)]},y.hcg.hsv=function(B){const I=B[1]/100,C=I+B[2]/100*(1-I);let M=0;return C>0&&(M=I/C),[B[0],100*M,100*C]},y.hcg.hsl=function(B){const I=B[1]/100,C=B[2]/100*(1-I)+.5*I;let M=0;return C>0&&C<.5?M=I/(2*C):C>=.5&&C<1&&(M=I/(2*(1-C))),[B[0],100*M,100*C]},y.hcg.hwb=function(B){const I=B[1]/100,C=I+B[2]/100*(1-I);return[B[0],100*(C-I),100*(1-C)]},y.hwb.hcg=function(B){const I=B[1]/100,C=1-B[2]/100,M=C-I;let x=0;return M<1&&(x=(C-M)/(1-M)),[B[0],100*M,100*x]},y.apple.rgb=function(B){return[B[0]/65535*255,B[1]/65535*255,B[2]/65535*255]},y.rgb.apple=function(B){return[B[0]/255*65535,B[1]/255*65535,B[2]/255*65535]},y.gray.rgb=function(B){return[B[0]/100*255,B[0]/100*255,B[0]/100*255]},y.gray.hsl=function(B){return[0,0,B[0]]},y.gray.hsv=y.gray.hsl,y.gray.hwb=function(B){return[0,100,B[0]]},y.gray.cmyk=function(B){return[0,0,0,B[0]]},y.gray.lab=function(B){return[B[0],0,0]},y.gray.hex=function(B){const I=255&Math.round(B[0]/100*255),C=((I<<16)+(I<<8)+I).toString(16).toUpperCase();return"000000".substring(C.length)+C},y.rgb.gray=function(B){return[(B[0]+B[1]+B[2])/3/255*100]}},13328:(B,I,C)=>{const M=C(13332),x=C(13342),y={};Object.keys(M).forEach((B=>{y[B]={},Object.defineProperty(y[B],"channels",{value:M[B].channels}),Object.defineProperty(y[B],"labels",{value:M[B].labels});const I=x(B);Object.keys(I).forEach((C=>{const M=I[C];y[B][C]=function(B){const I=function(){for(var I=arguments.length,C=new Array(I),M=0;M<I;M++)C[M]=arguments[M];const x=C[0];if(void 0===x||null===x)return x;x.length>1&&(C=x);const y=B(C);if("object"===typeof y)for(let B=y.length,f=0;f<B;f++)y[f]=Math.round(y[f]);return y};return"conversion"in B&&(I.conversion=B.conversion),I}(M),y[B][C].raw=function(B){const I=function(){for(var I=arguments.length,C=new Array(I),M=0;M<I;M++)C[M]=arguments[M];const x=C[0];return void 0===x||null===x?x:(x.length>1&&(C=x),B(C))};return"conversion"in B&&(I.conversion=B.conversion),I}(M)}))})),B.exports=y},13342:(B,I,C)=>{const M=C(13332);function x(B){const I=function(){const B={},I=Object.keys(M);for(let C=I.length,M=0;M<C;M++)B[I[M]]={distance:-1,parent:null};return B}(),C=[B];for(I[B].distance=0;C.length;){const B=C.pop(),x=Object.keys(M[B]);for(let M=x.length,y=0;y<M;y++){const M=x[y],f=I[M];-1===f.distance&&(f.distance=I[B].distance+1,f.parent=B,C.unshift(M))}}return I}function y(B,I){return function(C){return I(B(C))}}function f(B,I){const C=[I[B].parent,B];let x=M[I[B].parent][B],f=I[B].parent;for(;I[f].parent;)C.unshift(I[f].parent),x=y(M[I[f].parent][f],x),f=I[f].parent;return x.conversion=C,x}B.exports=function(B){const I=x(B),C={},M=Object.keys(I);for(let x=M.length,y=0;y<x;y++){const B=M[y];null!==I[B].parent&&(C[B]=f(B,I))}return C}},13335:B=>{"use strict";B.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11870:function(B,I,C){"use strict";var M=this&&this.__createBinding||(Object.create?function(B,I,C,M){void 0===M&&(M=C);var x=Object.getOwnPropertyDescriptor(I,C);x&&!("get"in x?!I.__esModule:x.writable||x.configurable)||(x={enumerable:!0,get:function(){return I[C]}}),Object.defineProperty(B,M,x)}:function(B,I,C,M){void 0===M&&(M=C),B[M]=I[C]}),x=this&&this.__setModuleDefault||(Object.create?function(B,I){Object.defineProperty(B,"default",{enumerable:!0,value:I})}:function(B,I){B.default=I}),y=this&&this.__importStar||function(B){if(B&&B.__esModule)return B;var I={};if(null!=B)for(var C in B)"default"!==C&&Object.prototype.hasOwnProperty.call(B,C)&&M(I,B,C);return x(I,B),I},f=this&&this.__awaiter||function(B,I,C,M){return new(C||(C=Promise))((function(x,y){function f(B){try{e(M.next(B))}catch(I){y(I)}}function L(B){try{e(M.throw(B))}catch(I){y(I)}}function e(B){var I;B.done?x(B.value):(I=B.value,I instanceof C?I:new C((function(B){B(I)}))).then(f,L)}e((M=M.apply(B,I||[])).next())}))};Object.defineProperty(I,"__esModule",{value:!0}),I.Auth=I.Platform=void 0;const L=y(C(11806)),e=C(11873),g="colyseus-auth-token";!function(B){B.ios="ios",B.android="android"}(I.Platform||(I.Platform={}));I.Auth=class{constructor(B){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=B.replace("ws","http"),(0,e.getItem)(g,(B=>this.token=B))}get hasToken(){return!!this.token}login(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return f(this,void 0,void 0,(function*(){const I=Object.assign({},B);this.hasToken&&(I.token=this.token);const C=yield this.request("post","/auth",I);this.token=C.token,(0,e.setItem)(g,this.token);for(let B in C)this.hasOwnProperty(B)&&(this[B]=C[B]);return this.registerPingService(),this}))}save(){return f(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return f(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return f(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return f(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(B){return f(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:B})}))}acceptFriendRequest(B){return f(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:B})}))}declineFriendRequest(B){return f(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:B})}))}blockUser(B){return f(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:B})}))}unblockUser(B){return f(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:B})}))}request(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},M=arguments.length>3?arguments[3]:void 0,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return f(this,void 0,void 0,(function*(){x.Accept="application/json",this.hasToken&&(x.Authorization="Bearer "+this.token);const y=[];for(const B in C)y.push(`${B}=${C[B]}`);const f=y.length>0?`?${y.join("&")}`:"",e={headers:x};return M&&(e.body=M),(yield L[B](`${this.endpoint}${I}${f}`,e)).data}))}logout(){this.token=void 0,(0,e.removeItem)(g),this.unregisterPingService()}registerPingService(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),B)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11797:function(B,I,C){"use strict";var M,x=this&&this.__awaiter||function(B,I,C,M){return new(C||(C=Promise))((function(x,y){function f(B){try{e(M.next(B))}catch(I){y(I)}}function L(B){try{e(M.throw(B))}catch(I){y(I)}}function e(B){var I;B.done?x(B.value):(I=B.value,I instanceof C?I:new C((function(B){B(I)}))).then(f,L)}e((M=M.apply(B,I||[])).next())}))};Object.defineProperty(I,"__esModule",{value:!0}),I.Client=I.MatchMakeError=void 0;const y=C(11806),f=C(11813),L=C(11820);class e extends Error{constructor(B,I){super(B),this.code=I,Object.setPrototypeOf(this,e.prototype)}}I.MatchMakeError=e;const g="undefined"!==typeof window&&"undefined"!==typeof(null===(M=null===window||void 0===window?void 0:window.location)||void 0===M?void 0:M.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";I.Client=class{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g;if("string"===typeof B){const I=new URL(B),C="https:"===I.protocol||"wss:"===I.protocol,M=Number(I.port||(C?443:80));this.settings={hostname:I.hostname,pathname:"/"!==I.pathname?I.pathname:"",port:M,secure:C}}else void 0===B.port&&(B.port=B.secure?443:80),void 0===B.pathname&&(B.pathname=""),this.settings=B}joinOrCreate(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return x(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",B,I,C)}))}create(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return x(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",B,I,C)}))}join(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return x(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",B,I,C)}))}joinById(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;return x(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",B,I,C)}))}reconnect(B,I){return x(this,void 0,void 0,(function*(){if("string"===typeof B&&"string"===typeof I)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[C,M]=B.split(":");return yield this.createMatchMakeRequest("reconnect",C,{reconnectionToken:M},I)}))}getAvailableRooms(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return x(this,void 0,void 0,(function*(){return(yield(0,y.get)(this.getHttpEndpoint(`${B}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(B,I,C){return x(this,void 0,void 0,(function*(){const M=this.createRoom(B.room.name,I);M.roomId=B.room.roomId,M.sessionId=B.sessionId;const y={sessionId:M.sessionId};B.reconnectionToken&&(y.reconnectionToken=B.reconnectionToken);const L=C||M;return M.connect(this.buildEndpoint(B.room,y),B.devMode&&(()=>x(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${M.roomId}'...`);let C=0;const y=()=>x(this,void 0,void 0,(function*(){C++;try{yield this.consumeSeatReservation(B,I,L),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${M.roomId}'`)}catch(x){C<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${C} out of 8)`),setTimeout(y,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(y,2e3)}))),L),new Promise(((B,I)=>{const C=(B,C)=>I(new f.ServerError(B,C));L.onError.once(C),L.onJoin.once((()=>{L.onError.remove(C),B(L)}))}))}))}createMatchMakeRequest(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},M=arguments.length>3?arguments[3]:void 0,f=arguments.length>4?arguments[4]:void 0;return x(this,void 0,void 0,(function*(){const x=(yield(0,y.post)(this.getHttpEndpoint(`${B}/${I}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(C)})).data;if(x.error)throw new e(x.error,x.code);return"reconnect"===B&&(x.reconnectionToken=C.reconnectionToken),yield this.consumeSeatReservation(x,M,f)}))}createRoom(B,I){return new L.Room(B,I)}buildEndpoint(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const C=[];for(const x in I)I.hasOwnProperty(x)&&C.push(`${x}=${I[x]}`);let M=this.settings.secure?"wss://":"ws://";return B.publicAddress?M+=`${B.publicAddress}`:M+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${M}/${B.processId}/${B.roomId}?${C.join("&")}`}getHttpEndpoint(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${B}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11831:(B,I,C)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.Connection=void 0;const M=C(11834);I.Connection=class{constructor(){this.events={},this.transport=new M.WebSocketTransport(this.events)}send(B){this.transport.send(B)}connect(B){this.transport.connect(B)}close(B,I){this.transport.close(B,I)}get isOpen(){return this.transport.isOpen}}},11846:(B,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.utf8Length=I.utf8Read=I.ErrorCode=I.Protocol=void 0,function(B){B[B.HANDSHAKE=9]="HANDSHAKE",B[B.JOIN_ROOM=10]="JOIN_ROOM",B[B.ERROR=11]="ERROR",B[B.LEAVE_ROOM=12]="LEAVE_ROOM",B[B.ROOM_DATA=13]="ROOM_DATA",B[B.ROOM_STATE=14]="ROOM_STATE",B[B.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",B[B.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",B[B.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(I.Protocol||(I.Protocol={})),function(B){B[B.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",B[B.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",B[B.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",B[B.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",B[B.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",B[B.AUTH_FAILED=4215]="AUTH_FAILED",B[B.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(I.ErrorCode||(I.ErrorCode={})),I.utf8Read=function(B,I){const C=B[I++];for(var M="",x=0,y=I,f=I+C;y<f;y++){var L=B[y];if(0!==(128&L))if(192!==(224&L))if(224!==(240&L)){if(240!==(248&L))throw new Error("Invalid byte "+L.toString(16));(x=(7&L)<<18|(63&B[++y])<<12|(63&B[++y])<<6|63&B[++y])>=65536?(x-=65536,M+=String.fromCharCode(55296+(x>>>10),56320+(1023&x))):M+=String.fromCharCode(x)}else M+=String.fromCharCode((15&L)<<12|(63&B[++y])<<6|63&B[++y]);else M+=String.fromCharCode((31&L)<<6|63&B[++y]);else M+=String.fromCharCode(L)}return M},I.utf8Length=function(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",I=0,C=0;for(let M=0,x=B.length;M<x;M++)I=B.charCodeAt(M),I<128?C+=1:I<2048?C+=2:I<55296||I>=57344?C+=3:(M++,C+=4);return C+1}},11820:function(B,I,C){"use strict";var M=this&&this.__createBinding||(Object.create?function(B,I,C,M){void 0===M&&(M=C);var x=Object.getOwnPropertyDescriptor(I,C);x&&!("get"in x?!I.__esModule:x.writable||x.configurable)||(x={enumerable:!0,get:function(){return I[C]}}),Object.defineProperty(B,M,x)}:function(B,I,C,M){void 0===M&&(M=C),B[M]=I[C]}),x=this&&this.__setModuleDefault||(Object.create?function(B,I){Object.defineProperty(B,"default",{enumerable:!0,value:I})}:function(B,I){B.default=I}),y=this&&this.__importStar||function(B){if(B&&B.__esModule)return B;var I={};if(null!=B)for(var C in B)"default"!==C&&Object.prototype.hasOwnProperty.call(B,C)&&M(I,B,C);return x(I,B),I};Object.defineProperty(I,"__esModule",{value:!0}),I.Room=void 0;const f=y(C(11828)),L=C(11831),e=C(11846),g=C(11854),N=C(11856),R=C(11861),H=C(11868),F=C(11813);class k{constructor(B,I){this.onStateChange=(0,R.createSignal)(),this.onError=(0,R.createSignal)(),this.onLeave=(0,R.createSignal)(),this.onJoin=(0,R.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,N.createNanoEvents)(),this.roomId=null,this.name=B,I&&(this.serializer=new((0,g.getSerializer)("schema")),this.rootSchema=I,this.serializer.state=new I),this.onError(((B,I)=>{var C;return null===(C=console.warn)||void 0===C?void 0:C.call(console,`colyseus.js - onError => (${B}) ${I}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const M=new L.Connection;C.connection=M,M.events.onmessage=k.prototype.onMessageCallback.bind(C),M.events.onclose=function(B){var M;if(!C.hasJoined)return null===(M=console.warn)||void 0===M||M.call(console,`Room connection was closed unexpectedly (${B.code}): ${B.reason}`),void C.onError.invoke(B.code,B.reason);B.code===F.CloseCode.DEVMODE_RESTART&&I?I():(C.onLeave.invoke(B.code),C.destroy())},M.events.onerror=function(B){var I;null===(I=console.warn)||void 0===I||I.call(console,`Room, onError (${B.code}): ${B.reason}`),C.onError.invoke(B.code,B.reason)},M.connect(B)}leave(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((I=>{this.onLeave((B=>I(B))),this.connection?B?this.connection.send([e.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(F.CloseCode.CONSENTED)}))}onMessage(B,I){return this.onMessageHandlers.on(this.getMessageHandlerKey(B),I)}send(B,I){const C=[e.Protocol.ROOM_DATA];let M;if("string"===typeof B?H.encode.string(C,B):H.encode.number(C,B),void 0!==I){const B=f.encode(I);M=new Uint8Array(C.length+B.byteLength),M.set(new Uint8Array(C),0),M.set(new Uint8Array(B),C.length)}else M=new Uint8Array(C);this.connection.send(M.buffer)}sendBytes(B,I){const C=[e.Protocol.ROOM_DATA_BYTES];let M;"string"===typeof B?H.encode.string(C,B):H.encode.number(C,B),M=new Uint8Array(C.length+(I.byteLength||I.length)),M.set(new Uint8Array(C),0),M.set(new Uint8Array(I),C.length),this.connection.send(M.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(B){const I=Array.from(new Uint8Array(B.data)),C=I[0];if(C===e.Protocol.JOIN_ROOM){let B=1;const C=(0,e.utf8Read)(I,B);if(B+=(0,e.utf8Length)(C),this.serializerId=(0,e.utf8Read)(I,B),B+=(0,e.utf8Length)(this.serializerId),!this.serializer){const B=(0,g.getSerializer)(this.serializerId);this.serializer=new B}I.length>B&&this.serializer.handshake&&this.serializer.handshake(I,{offset:B}),this.reconnectionToken=`${this.roomId}:${C}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([e.Protocol.JOIN_ROOM])}else if(C===e.Protocol.ERROR){const B={offset:1},C=H.decode.number(I,B),M=H.decode.string(I,B);this.onError.invoke(C,M)}else if(C===e.Protocol.LEAVE_ROOM)this.leave();else if(C===e.Protocol.ROOM_DATA_SCHEMA){const B={offset:1},C=this.serializer.getState().constructor._context.get(H.decode.number(I,B)),M=new C;M.decode(I,B),this.dispatchMessage(C,M)}else if(C===e.Protocol.ROOM_STATE)I.shift(),this.setState(I);else if(C===e.Protocol.ROOM_STATE_PATCH)I.shift(),this.patch(I);else if(C===e.Protocol.ROOM_DATA){const C={offset:1},M=H.decode.stringCheck(I,C)?H.decode.string(I,C):H.decode.number(I,C),x=I.length>C.offset?f.decode(B.data,C.offset):void 0;this.dispatchMessage(M,x)}else if(C===e.Protocol.ROOM_DATA_BYTES){const B={offset:1},C=H.decode.stringCheck(I,B)?H.decode.string(I,B):H.decode.number(I,B);this.dispatchMessage(C,new Uint8Array(I.slice(B.offset)))}}setState(B){this.serializer.setState(B),this.onStateChange.invoke(this.serializer.getState())}patch(B){this.serializer.patch(B),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(B,I){var C;const M=this.getMessageHandlerKey(B);this.onMessageHandlers.events[M]?this.onMessageHandlers.emit(M,I):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",B,I):null===(C=console.warn)||void 0===C||C.call(console,`colyseus.js: onMessage() not registered for type '${B}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(B){switch(typeof B){case"function":return`$${B._typeid}`;case"string":return B;case"number":return`i${B}`;default:throw new Error("invalid message type.")}}}I.Room=k},11873:(B,I)=>{"use strict";let C;function M(){return C||(C="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(B,I){this.cache[B]=I},getItem:function(B){this.cache[B]},removeItem:function(B){delete this.cache[B]}}),C}Object.defineProperty(I,"__esModule",{value:!0}),I.getItem=I.removeItem=I.setItem=void 0,I.setItem=function(B,I){M().setItem(B,I)},I.removeItem=function(B){M().removeItem(B)},I.getItem=function(B,I){const C=M().getItem(B);"undefined"!==typeof Promise&&C instanceof Promise?C.then((B=>I(B))):I(C)}},11856:(B,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.createNanoEvents=void 0;I.createNanoEvents=()=>({emit(B){let I=this.events[B]||[];for(var C=arguments.length,M=new Array(C>1?C-1:0),x=1;x<C;x++)M[x-1]=arguments[x];for(let y=0,f=I.length;y<f;y++)I[y](...M)},events:{},on(B,I){var C;return(null===(C=this.events[B])||void 0===C?void 0:C.push(I))||(this.events[B]=[I]),()=>{var C;this.events[B]=null===(C=this.events[B])||void 0===C?void 0:C.filter((B=>I!==B))}}})},11861:(B,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.createSignal=I.EventEmitter=void 0;class C{constructor(){this.handlers=[]}register(B){return this.handlers.push(B),this}invoke(){for(var B=arguments.length,I=new Array(B),C=0;C<B;C++)I[C]=arguments[C];this.handlers.forEach((B=>B.apply(this,I)))}invokeAsync(){for(var B=arguments.length,I=new Array(B),C=0;C<B;C++)I[C]=arguments[C];return Promise.all(this.handlers.map((B=>B.apply(this,I))))}remove(B){const I=this.handlers.indexOf(B);this.handlers[I]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}I.EventEmitter=C,I.createSignal=function(){const B=new C;function I(I){return B.register(I,null===this)}return I.once=I=>{const C=function(){for(var M=arguments.length,x=new Array(M),y=0;y<M;y++)x[y]=arguments[y];I.apply(this,x),B.remove(C)};B.register(C)},I.remove=I=>B.remove(I),I.invoke=function(){return B.invoke(...arguments)},I.invokeAsync=function(){return B.invokeAsync(...arguments)},I.clear=()=>B.clear(),I}},11813:(B,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.ServerError=I.CloseCode=void 0,function(B){B[B.CONSENTED=4e3]="CONSENTED",B[B.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(I.CloseCode||(I.CloseCode={}));class C extends Error{constructor(B,I){super(I),this.name="ServerError",this.code=B}}I.ServerError=C},11791:(B,I,C)=>{"use strict";I.c=void 0,C(11794);var M=C(11797);Object.defineProperty(I,"c",{enumerable:!0,get:function(){return M.Client}});var x=C(11846);var y=C(11820);var f=C(11870);const L=C(11879);const e=C(11885),g=C(11854);(0,g.registerSerializer)("schema",L.SchemaSerializer),(0,g.registerSerializer)("none",e.NoneSerializer)},11794:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=B=>null!==B&&"object"===typeof B&&B.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11828:(B,I)=>{"use strict";function C(B,I){if(this._offset=I,B instanceof ArrayBuffer)this._buffer=B,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(B))throw new Error("Invalid argument");this._buffer=B.buffer,this._view=new DataView(this._buffer,B.byteOffset,B.byteLength)}}Object.defineProperty(I,"__esModule",{value:!0}),I.decode=I.encode=void 0,C.prototype._array=function(B){for(var I=new Array(B),C=0;C<B;C++)I[C]=this._parse();return I},C.prototype._map=function(B){for(var I={},C=0;C<B;C++)I[this._parse()]=this._parse();return I},C.prototype._str=function(B){var I=function(B,I,C){for(var M="",x=0,y=I,f=I+C;y<f;y++){var L=B.getUint8(y);if(0!==(128&L))if(192!==(224&L))if(224!==(240&L)){if(240!==(248&L))throw new Error("Invalid byte "+L.toString(16));(x=(7&L)<<18|(63&B.getUint8(++y))<<12|(63&B.getUint8(++y))<<6|63&B.getUint8(++y))>=65536?(x-=65536,M+=String.fromCharCode(55296+(x>>>10),56320+(1023&x))):M+=String.fromCharCode(x)}else M+=String.fromCharCode((15&L)<<12|(63&B.getUint8(++y))<<6|63&B.getUint8(++y));else M+=String.fromCharCode((31&L)<<6|63&B.getUint8(++y));else M+=String.fromCharCode(L)}return M}(this._view,this._offset,B);return this._offset+=B,I},C.prototype._bin=function(B){var I=this._buffer.slice(this._offset,this._offset+B);return this._offset+=B,I},C.prototype._parse=function(){var B,I=this._view.getUint8(this._offset++),C=0,M=0,x=0,y=0;if(I<192)return I<128?I:I<144?this._map(15&I):I<160?this._array(15&I):this._str(31&I);if(I>223)return-1*(255-I+1);switch(I){case 192:return null;case 194:return!1;case 195:return!0;case 196:return C=this._view.getUint8(this._offset),this._offset+=1,this._bin(C);case 197:return C=this._view.getUint16(this._offset),this._offset+=2,this._bin(C);case 198:return C=this._view.getUint32(this._offset),this._offset+=4,this._bin(C);case 199:if(C=this._view.getUint8(this._offset),M=this._view.getInt8(this._offset+1),this._offset+=2,-1===M){var f=this._view.getUint32(this._offset);return x=this._view.getInt32(this._offset+4),y=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*x+y)+f/1e6)}return[M,this._bin(C)];case 200:return C=this._view.getUint16(this._offset),M=this._view.getInt8(this._offset+2),this._offset+=3,[M,this._bin(C)];case 201:return C=this._view.getUint32(this._offset),M=this._view.getInt8(this._offset+4),this._offset+=5,[M,this._bin(C)];case 202:return B=this._view.getFloat32(this._offset),this._offset+=4,B;case 203:return B=this._view.getFloat64(this._offset),this._offset+=8,B;case 204:return B=this._view.getUint8(this._offset),this._offset+=1,B;case 205:return B=this._view.getUint16(this._offset),this._offset+=2,B;case 206:return B=this._view.getUint32(this._offset),this._offset+=4,B;case 207:return x=this._view.getUint32(this._offset)*Math.pow(2,32),y=this._view.getUint32(this._offset+4),this._offset+=8,x+y;case 208:return B=this._view.getInt8(this._offset),this._offset+=1,B;case 209:return B=this._view.getInt16(this._offset),this._offset+=2,B;case 210:return B=this._view.getInt32(this._offset),this._offset+=4,B;case 211:return x=this._view.getInt32(this._offset)*Math.pow(2,32),y=this._view.getUint32(this._offset+4),this._offset+=8,x+y;case 212:return M=this._view.getInt8(this._offset),this._offset+=1,0===M?void(this._offset+=1):[M,this._bin(1)];case 213:return M=this._view.getInt8(this._offset),this._offset+=1,[M,this._bin(2)];case 214:return M=this._view.getInt8(this._offset),this._offset+=1,-1===M?(B=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*B)):[M,this._bin(4)];case 215:return M=this._view.getInt8(this._offset),this._offset+=1,0===M?(x=this._view.getInt32(this._offset)*Math.pow(2,32),y=this._view.getUint32(this._offset+4),this._offset+=8,new Date(x+y)):-1===M?(x=this._view.getUint32(this._offset),y=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&x)+y)+(x>>>2)/1e6)):[M,this._bin(8)];case 216:return M=this._view.getInt8(this._offset),this._offset+=1,[M,this._bin(16)];case 217:return C=this._view.getUint8(this._offset),this._offset+=1,this._str(C);case 218:return C=this._view.getUint16(this._offset),this._offset+=2,this._str(C);case 219:return C=this._view.getUint32(this._offset),this._offset+=4,this._str(C);case 220:return C=this._view.getUint16(this._offset),this._offset+=2,this._array(C);case 221:return C=this._view.getUint32(this._offset),this._offset+=4,this._array(C);case 222:return C=this._view.getUint16(this._offset),this._offset+=2,this._map(C);case 223:return C=this._view.getUint32(this._offset),this._offset+=4,this._map(C)}throw new Error("Could not parse")},I.decode=function(B){var I=new C(B,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),M=I._parse();if(I._offset!==B.byteLength)throw new Error(B.byteLength-I._offset+" trailing bytes");return M};function M(B,I,C){for(var M=0,x=0,y=C.length;x<y;x++)(M=C.charCodeAt(x))<128?B.setUint8(I++,M):M<2048?(B.setUint8(I++,192|M>>6),B.setUint8(I++,128|63&M)):M<55296||M>=57344?(B.setUint8(I++,224|M>>12),B.setUint8(I++,128|M>>6&63),B.setUint8(I++,128|63&M)):(x++,M=65536+((1023&M)<<10|1023&C.charCodeAt(x)),B.setUint8(I++,240|M>>18),B.setUint8(I++,128|M>>12&63),B.setUint8(I++,128|M>>6&63),B.setUint8(I++,128|63&M))}function x(B,I,C){var M=typeof C,y=0,f=0,L=0,e=0,g=0,N=0;if("string"===M){if(g=function(B){for(var I=0,C=0,M=0,x=B.length;M<x;M++)(I=B.charCodeAt(M))<128?C+=1:I<2048?C+=2:I<55296||I>=57344?C+=3:(M++,C+=4);return C}(C),g<32)B.push(160|g),N=1;else if(g<256)B.push(217,g),N=2;else if(g<65536)B.push(218,g>>8,g),N=3;else{if(!(g<4294967296))throw new Error("String too long");B.push(219,g>>24,g>>16,g>>8,g),N=5}return I.push({_str:C,_length:g,_offset:B.length}),N+g}if("number"===M)return Math.floor(C)===C&&isFinite(C)?C>=0?C<128?(B.push(C),1):C<256?(B.push(204,C),2):C<65536?(B.push(205,C>>8,C),3):C<4294967296?(B.push(206,C>>24,C>>16,C>>8,C),5):(L=C/Math.pow(2,32)|0,e=C>>>0,B.push(207,L>>24,L>>16,L>>8,L,e>>24,e>>16,e>>8,e),9):C>=-32?(B.push(C),1):C>=-128?(B.push(208,C),2):C>=-32768?(B.push(209,C>>8,C),3):C>=-2147483648?(B.push(210,C>>24,C>>16,C>>8,C),5):(L=Math.floor(C/Math.pow(2,32)),e=C>>>0,B.push(211,L>>24,L>>16,L>>8,L,e>>24,e>>16,e>>8,e),9):(B.push(203),I.push({_float:C,_length:8,_offset:B.length}),9);if("object"===M){if(null===C)return B.push(192),1;if(Array.isArray(C)){if((g=C.length)<16)B.push(144|g),N=1;else if(g<65536)B.push(220,g>>8,g),N=3;else{if(!(g<4294967296))throw new Error("Array too large");B.push(221,g>>24,g>>16,g>>8,g),N=5}for(y=0;y<g;y++)N+=x(B,I,C[y]);return N}if(C instanceof Date){var R=C.getTime(),H=Math.floor(R/1e3),F=1e6*(R-1e3*H);return H>=0&&F>=0&&H<=17179869183?0===F&&H<=4294967295?(B.push(214,255,H>>24,H>>16,H>>8,H),6):(L=H/4294967296,e=4294967295&H,B.push(215,255,F>>22,F>>14,F>>6,L,e>>24,e>>16,e>>8,e),10):(L=Math.floor(H/4294967296),e=H>>>0,B.push(199,12,255,F>>24,F>>16,F>>8,F,L>>24,L>>16,L>>8,L,e>>24,e>>16,e>>8,e),15)}if(C instanceof ArrayBuffer){if((g=C.byteLength)<256)B.push(196,g),N=2;else if(g<65536)B.push(197,g>>8,g),N=3;else{if(!(g<4294967296))throw new Error("Buffer too large");B.push(198,g>>24,g>>16,g>>8,g),N=5}return I.push({_bin:C,_length:g,_offset:B.length}),N+g}if("function"===typeof C.toJSON)return x(B,I,C.toJSON());var k=[],q="",S=Object.keys(C);for(y=0,f=S.length;y<f;y++)void 0!==C[q=S[y]]&&"function"!==typeof C[q]&&k.push(q);if((g=k.length)<16)B.push(128|g),N=1;else if(g<65536)B.push(222,g>>8,g),N=3;else{if(!(g<4294967296))throw new Error("Object too large");B.push(223,g>>24,g>>16,g>>8,g),N=5}for(y=0;y<g;y++)N+=x(B,I,q=k[y]),N+=x(B,I,C[q]);return N}if("boolean"===M)return B.push(C?195:194),1;if("undefined"===M)return B.push(192),1;if("function"===typeof C.toJSON)return x(B,I,C.toJSON());throw new Error("Could not encode")}I.encode=function(B){var I=[],C=[],y=x(I,C,B),f=new ArrayBuffer(y),L=new DataView(f),e=0,g=0,N=-1;C.length>0&&(N=C[0]._offset);for(var R,H=0,F=0,k=0,q=I.length;k<q;k++)if(L.setUint8(g+k,I[k]),k+1===N){if(H=(R=C[e])._length,F=g+N,R._bin)for(var S=new Uint8Array(R._bin),o=0;o<H;o++)L.setUint8(F+o,S[o]);else R._str?M(L,F,R._str):void 0!==R._float&&L.setFloat64(F,R._float);g+=H,C[++e]&&(N=C[e]._offset)}return f}},11885:(B,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.NoneSerializer=void 0;I.NoneSerializer=class{setState(B){}getState(){return null}patch(B){}teardown(){}handshake(B){}}},11879:(B,I,C)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.SchemaSerializer=void 0;const M=C(11868);I.SchemaSerializer=class{setState(B){return this.state.decode(B)}getState(){return this.state}patch(B){return this.state.decode(B)}teardown(){var B,I;null===(I=null===(B=this.state)||void 0===B?void 0:B.$changes)||void 0===I||I.root.clearRefs()}handshake(B,I){if(this.state){(new M.Reflection).decode(B,I)}else this.state=M.Reflection.decode(B,I)}}},11854:(B,I)=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0}),I.getSerializer=I.registerSerializer=void 0;const C={};I.registerSerializer=function(B,I){C[B]=I},I.getSerializer=function(B){const I=C[B];if(!I)throw new Error("missing serializer: "+B);return I}},11834:function(B,I,C){"use strict";var M=this&&this.__importDefault||function(B){return B&&B.__esModule?B:{default:B}};Object.defineProperty(I,"__esModule",{value:!0}),I.WebSocketTransport=void 0;const x=M(C(11843)),y=globalThis.WebSocket||x.default;I.WebSocketTransport=class{constructor(B){this.events=B}send(B){B instanceof ArrayBuffer?this.ws.send(B):Array.isArray(B)&&this.ws.send(new Uint8Array(B).buffer)}connect(B){this.ws=new y(B,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(B,I){this.ws.close(B,I)}get isOpen(){return this.ws.readyState===y.OPEN}}},11843:B=>{"use strict";B.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12266:B=>{"use strict";B.exports=function(B){for(var I=new Array(B),C=0;C<B;++C)I[C]=C;return I}},12273:B=>{function I(B){return!!B.constructor&&"function"===typeof B.constructor.isBuffer&&B.constructor.isBuffer(B)}B.exports=function(B){return null!=B&&(I(B)||function(B){return"function"===typeof B.readFloatLE&&"function"===typeof B.slice&&I(B.slice(0,0))}(B)||!!B._isBuffer)}},12257:(B,I,C)=>{var M=C(12266),x=C(12273),y="undefined"!==typeof Float64Array;function f(B,I){return B[0]-I[0]}function L(){var B,I=this.stride,C=new Array(I.length);for(B=0;B<C.length;++B)C[B]=[Math.abs(I[B]),B];C.sort(f);var M=new Array(C.length);for(B=0;B<M.length;++B)M[B]=C[B][1];return M}function e(B,I){var C=["View",I,"d",B].join("");I<0&&(C="View_Nil"+B);var x="generic"===B;if(-1===I){var y="function "+C+"(a){this.data=a;};var proto="+C+".prototype;proto.dtype='"+B+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+C+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+C+"(a){return new "+C+"(a);}";return new Function(y)()}if(0===I){y="function "+C+"(a,d) {this.data = a;this.offset = d};var proto="+C+".prototype;proto.dtype='"+B+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+C+"_copy() {return new "+C+"(this.data,this.offset)};proto.pick=function "+C+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+C+"_get(){return "+(x?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+C+"_set(v){return "+(x?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+C+"(a,b,c,d){return new "+C+"(a,d)}";return new Function("TrivialArray",y)(g[B][0])}y=["'use strict'"];var f=M(I),e=f.map((function(B){return"i"+B})),N="this.offset+"+f.map((function(B){return"this.stride["+B+"]*i"+B})).join("+"),R=f.map((function(B){return"b"+B})).join(","),H=f.map((function(B){return"c"+B})).join(",");y.push("function "+C+"(a,"+R+","+H+",d){this.data=a","this.shape=["+R+"]","this.stride=["+H+"]","this.offset=d|0}","var proto="+C+".prototype","proto.dtype='"+B+"'","proto.dimension="+I),y.push("Object.defineProperty(proto,'size',{get:function "+C+"_size(){return "+f.map((function(B){return"this.shape["+B+"]"})).join("*"),"}})"),1===I?y.push("proto.order=[0]"):(y.push("Object.defineProperty(proto,'order',{get:"),I<4?(y.push("function "+C+"_order(){"),2===I?y.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===I&&y.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):y.push("ORDER})")),y.push("proto.set=function "+C+"_set("+e.join(",")+",v){"),x?y.push("return this.data.set("+N+",v)}"):y.push("return this.data["+N+"]=v}"),y.push("proto.get=function "+C+"_get("+e.join(",")+"){"),x?y.push("return this.data.get("+N+")}"):y.push("return this.data["+N+"]}"),y.push("proto.index=function "+C+"_index(",e.join(),"){return "+N+"}"),y.push("proto.hi=function "+C+"_hi("+e.join(",")+"){return new "+C+"(this.data,"+f.map((function(B){return["(typeof i",B,"!=='number'||i",B,"<0)?this.shape[",B,"]:i",B,"|0"].join("")})).join(",")+","+f.map((function(B){return"this.stride["+B+"]"})).join(",")+",this.offset)}");var F=f.map((function(B){return"a"+B+"=this.shape["+B+"]"})),k=f.map((function(B){return"c"+B+"=this.stride["+B+"]"}));y.push("proto.lo=function "+C+"_lo("+e.join(",")+"){var b=this.offset,d=0,"+F.join(",")+","+k.join(","));for(var q=0;q<I;++q)y.push("if(typeof i"+q+"==='number'&&i"+q+">=0){d=i"+q+"|0;b+=c"+q+"*d;a"+q+"-=d}");y.push("return new "+C+"(this.data,"+f.map((function(B){return"a"+B})).join(",")+","+f.map((function(B){return"c"+B})).join(",")+",b)}"),y.push("proto.step=function "+C+"_step("+e.join(",")+"){var "+f.map((function(B){return"a"+B+"=this.shape["+B+"]"})).join(",")+","+f.map((function(B){return"b"+B+"=this.stride["+B+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(q=0;q<I;++q)y.push("if(typeof i"+q+"==='number'){d=i"+q+"|0;if(d<0){c+=b"+q+"*(a"+q+"-1);a"+q+"=ceil(-a"+q+"/d)}else{a"+q+"=ceil(a"+q+"/d)}b"+q+"*=d}");y.push("return new "+C+"(this.data,"+f.map((function(B){return"a"+B})).join(",")+","+f.map((function(B){return"b"+B})).join(",")+",c)}");var S=new Array(I),o=new Array(I);for(q=0;q<I;++q)S[q]="a[i"+q+"]",o[q]="b[i"+q+"]";y.push("proto.transpose=function "+C+"_transpose("+e+"){"+e.map((function(B,I){return B+"=("+B+"===undefined?"+I+":"+B+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+C+"(this.data,"+S.join(",")+","+o.join(",")+",this.offset)}"),y.push("proto.pick=function "+C+"_pick("+e+"){var a=[],b=[],c=this.offset");for(q=0;q<I;++q)y.push("if(typeof i"+q+"==='number'&&i"+q+">=0){c=(c+this.stride["+q+"]*i"+q+")|0}else{a.push(this.shape["+q+"]);b.push(this.stride["+q+"])}");return y.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),y.push("return function construct_"+C+"(data,shape,stride,offset){return new "+C+"(data,"+f.map((function(B){return"shape["+B+"]"})).join(",")+","+f.map((function(B){return"stride["+B+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",y.join("\n"))(g[B],L)}var g={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};B.exports=function(B,I,C,M){if(void 0===B)return(0,g.array[0])([]);"number"===typeof B&&(B=[B]),void 0===I&&(I=[B.length]);var f=I.length;if(void 0===C){C=new Array(f);for(var L=f-1,N=1;L>=0;--L)C[L]=N,N*=I[L]}if(void 0===M){M=0;for(L=0;L<f;++L)C[L]<0&&(M-=(I[L]-1)*C[L])}for(var R=function(B){if(x(B))return"buffer";if(y)switch(Object.prototype.toString.call(B)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(B)?"array":"generic"}(B),H=g[R];H.length<=f+1;)H.push(e(R,H.length-1));return(0,H[f+1])(B,I,C,M)}},13285:B=>{var I;self,I=()=>(()=>{"use strict";var B={d:(I,C)=>{for(var M in C)B.o(C,M)&&!B.o(I,M)&&Object.defineProperty(I,M,{enumerable:!0,get:C[M]})},o:(B,I)=>Object.prototype.hasOwnProperty.call(B,I)},I={};B.d(I,{default:()=>a});var C,M=function(B,I){var C=I.x-B.x,M=I.y-B.y;return Math.sqrt(C*C+M*M)},x=function(B){return B*(Math.PI/180)},y=new Map,f=function(B){y.has(B)&&clearTimeout(y.get(B)),y.set(B,setTimeout(B,100))},L=function(B,I,C){for(var M,x=I.split(/[ ,]+/g),y=0;y<x.length;y+=1)M=x[y],B.addEventListener?B.addEventListener(M,C,!1):B.attachEvent&&B.attachEvent(M,C)},e=function(B,I,C){for(var M,x=I.split(/[ ,]+/g),y=0;y<x.length;y+=1)M=x[y],B.removeEventListener?B.removeEventListener(M,C):B.detachEvent&&B.detachEvent(M,C)},g=function(B){return B.preventDefault(),B.type.match(/^touch/)?B.changedTouches:B},N=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},R=function(B,I){I.top||I.right||I.bottom||I.left?(B.style.top=I.top,B.style.right=I.right,B.style.bottom=I.bottom,B.style.left=I.left):(B.style.left=I.x+"px",B.style.top=I.y+"px")},H=function(B,I,C){var M=F(B);for(var x in M)if(M.hasOwnProperty(x))if("string"==typeof I)M[x]=I+" "+C;else{for(var y="",f=0,L=I.length;f<L;f+=1)y+=I[f]+" "+C+", ";M[x]=y.slice(0,-2)}return M},F=function(B){var I={};return I[B]="",["webkit","Moz","o"].forEach((function(C){I[C+B.charAt(0).toUpperCase()+B.slice(1)]=""})),I},k=function(B,I){for(var C in I)I.hasOwnProperty(C)&&(B[C]=I[C]);return B},q=function(B,I){if(B.length)for(var C=0,M=B.length;C<M;C+=1)I(B[C]);else I(B)},S="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,o=window.matchMedia("(any-hover: none)").matches,U=!!("ontouchstart"in window),G=!!window.PointerEvent,V=!!window.MSPointerEvent,c={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},t={start:"mousedown",move:"mousemove",end:"mouseup"},r={};function A(){}S&&!o?C=c:G?C={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:V?C={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:U?(C=c,r=t):C=t,A.prototype.on=function(B,I){var C,M=this,x=B.split(/[ ,]+/g);M._handlers_=M._handlers_||{};for(var y=0;y<x.length;y+=1)C=x[y],M._handlers_[C]=M._handlers_[C]||[],M._handlers_[C].push(I);return M},A.prototype.off=function(B,I){var C=this;return C._handlers_=C._handlers_||{},void 0===B?C._handlers_={}:void 0===I?C._handlers_[B]=null:C._handlers_[B]&&C._handlers_[B].indexOf(I)>=0&&C._handlers_[B].splice(C._handlers_[B].indexOf(I),1),C},A.prototype.trigger=function(B,I){var C,M=this,x=B.split(/[ ,]+/g);M._handlers_=M._handlers_||{};for(var y=0;y<x.length;y+=1)C=x[y],M._handlers_[C]&&M._handlers_[C].length&&M._handlers_[C].forEach((function(B){B.call(M,{type:C,target:M},I)}))},A.prototype.config=function(B){var I=this;I.options=I.defaults||{},B&&(I.options=function(B,I){var C={};for(var M in B)B.hasOwnProperty(M)&&I.hasOwnProperty(M)?C[M]=I[M]:B.hasOwnProperty(M)&&(C[M]=B[M]);return C}(I.options,B))},A.prototype.bindEvt=function(B,I){var M=this;return M._domHandlers_=M._domHandlers_||{},M._domHandlers_[I]=function(){"function"==typeof M["on"+I]?M["on"+I].apply(M,arguments):console.warn('[WARNING] : Missing "on'+I+'" handler.')},L(B,C[I],M._domHandlers_[I]),r[I]&&L(B,r[I],M._domHandlers_[I]),M},A.prototype.unbindEvt=function(B,I){var M=this;return M._domHandlers_=M._domHandlers_||{},e(B,C[I],M._domHandlers_[I]),r[I]&&e(B,r[I],M._domHandlers_[I]),delete M._domHandlers_[I],this};const D=A;function J(B,I){return this.identifier=I.identifier,this.position=I.position,this.frontPosition=I.frontPosition,this.collection=B,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(I),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=J.id,J.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}J.prototype=new D,J.constructor=J,J.id=0,J.prototype.buildEl=function(B){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},J.prototype.stylize=function(){if(this.options.dataOnly)return this;var B=this.options.fadeTime+"ms",I=function(){var B=F("borderRadius");for(var I in B)B.hasOwnProperty(I)&&(B[I]="50%");return B}(),C=H("transition","opacity",B),M={};return M.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},M.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},M.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},k(M.el,C),"circle"===this.options.shape&&k(M.back,I),k(M.front,I),this.applyStyles(M),this},J.prototype.applyStyles=function(B){for(var I in this.ui)if(this.ui.hasOwnProperty(I))for(var C in B[I])this.ui[I].style[C]=B[I][C];return this},J.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},J.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},J.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},J.prototype.show=function(B){var I=this;return I.options.dataOnly||(clearTimeout(I.removeTimeout),clearTimeout(I.showTimeout),clearTimeout(I.restTimeout),I.addToDom(),I.restCallback(),setTimeout((function(){I.ui.el.style.opacity=1}),0),I.showTimeout=setTimeout((function(){I.trigger("shown",I.instance),"function"==typeof B&&B.call(this)}),I.options.fadeTime)),I},J.prototype.hide=function(B){var I=this;if(I.options.dataOnly)return I;if(I.ui.el.style.opacity=I.options.restOpacity,clearTimeout(I.removeTimeout),clearTimeout(I.showTimeout),clearTimeout(I.restTimeout),I.removeTimeout=setTimeout((function(){var C="dynamic"===I.options.mode?"none":"block";I.ui.el.style.display=C,"function"==typeof B&&B.call(I),I.trigger("hidden",I.instance)}),I.options.fadeTime),I.options.restJoystick){var C=I.options.restJoystick,M={};M.x=!0===C||!1!==C.x?0:I.instance.frontPosition.x,M.y=!0===C||!1!==C.y?0:I.instance.frontPosition.y,I.setPosition(B,M)}return I},J.prototype.setPosition=function(B,I){var C=this;C.frontPosition={x:I.x,y:I.y};var M=C.options.fadeTime+"ms",x={};x.front=H("transition",["transform"],M);var y={front:{}};y.front={transform:"translate("+C.frontPosition.x+"px,"+C.frontPosition.y+"px)"},C.applyStyles(x),C.applyStyles(y),C.restTimeout=setTimeout((function(){"function"==typeof B&&B.call(C),C.restCallback()}),C.options.fadeTime)},J.prototype.restCallback=function(){var B=this,I={};I.front=H("transition","none",""),B.applyStyles(I),B.trigger("rested",B.instance)},J.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},J.prototype.computeDirection=function(B){var I,C,M,x=B.angle.radian,y=Math.PI/4,f=Math.PI/2;if(x>y&&x<3*y&&!B.lockX?I="up":x>-y&&x<=y&&!B.lockY?I="left":x>3*-y&&x<=-y&&!B.lockX?I="down":B.lockY||(I="right"),B.lockY||(C=x>-f&&x<f?"left":"right"),B.lockX||(M=x>0?"up":"down"),B.force>this.options.threshold){var L,e={};for(L in this.direction)this.direction.hasOwnProperty(L)&&(e[L]=this.direction[L]);var g={};for(L in this.direction={x:C,y:M,angle:I},B.direction=this.direction,e)e[L]===this.direction[L]&&(g[L]=!0);if(g.x&&g.y&&g.angle)return B;g.x&&g.y||this.trigger("plain",B),g.x||this.trigger("plain:"+C,B),g.y||this.trigger("plain:"+M,B),g.angle||this.trigger("dir dir:"+I,B)}else this.resetDirection();return B};const i=J;function u(B,I){var C=this;C.nipples=[],C.idles=[],C.actives=[],C.ids=[],C.pressureIntervals={},C.manager=B,C.id=u.id,u.id+=1,C.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},C.config(I),"static"!==C.options.mode&&"semi"!==C.options.mode||(C.options.multitouch=!1),C.options.multitouch||(C.options.maxNumberOfNipples=1);var M=getComputedStyle(C.options.zone.parentElement);return M&&"flex"===M.display&&(C.parentIsFlex=!0),C.updateBox(),C.prepareNipples(),C.AH(),C.begin(),C.nipples}u.prototype=new D,u.constructor=u,u.id=0,u.prototype.prepareNipples=function(){var B=this,I=B.nipples;I.on=B.on.bind(B),I.off=B.off.bind(B),I.options=B.options,I.destroy=B.destroy.bind(B),I.ids=B.ids,I.id=B.id,I.processOnMove=B.processOnMove.bind(B),I.processOnEnd=B.processOnEnd.bind(B),I.get=function(B){if(void 0===B)return I[0];for(var C=0,M=I.length;C<M;C+=1)if(I[C].identifier===B)return I[C];return!1}},u.prototype.AH=function(){var B=this;B.bindEvt(B.options.zone,"start"),B.options.zone.style.touchAction="none",B.options.zone.style.msTouchAction="none"},u.prototype.begin=function(){var B=this,I=B.options;if("static"===I.mode){var C=B.createNipple(I.position,B.manager.getIdentifier());C.add(),B.idles.push(C)}},u.prototype.createNipple=function(B,I){var C=this,M=C.manager.scroll,x={},y=C.options,f=C.parentIsFlex?M.x:M.x+C.box.left,L=C.parentIsFlex?M.y:M.y+C.box.top;if(B.x&&B.y)x={x:B.x-f,y:B.y-L};else if(B.top||B.right||B.bottom||B.left){var e=document.createElement("DIV");e.style.display="hidden",e.style.top=B.top,e.style.right=B.right,e.style.bottom=B.bottom,e.style.left=B.left,e.style.position="absolute",y.zone.appendChild(e);var g=e.getBoundingClientRect();y.zone.removeChild(e),x=B,B={x:g.left+M.x,y:g.top+M.y}}var N=new i(C,{color:y.color,size:y.size,threshold:y.threshold,fadeTime:y.fadeTime,dataOnly:y.dataOnly,restJoystick:y.restJoystick,restOpacity:y.restOpacity,mode:y.mode,identifier:I,position:B,zone:y.zone,frontPosition:{x:0,y:0},shape:y.shape});return y.dataOnly||(R(N.ui.el,x),R(N.ui.front,N.frontPosition)),C.nipples.push(N),C.trigger("added "+N.identifier+":added",N),C.manager.trigger("added "+N.identifier+":added",N),C.bindNipple(N),N},u.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},u.prototype.bindNipple=function(B){var I,C=this,M=function(B,M){I=B.type+" "+M.id+":"+B.type,C.trigger(I,M)};B.on("destroyed",C.onDestroyed.bind(C)),B.on("shown hidden rested dir plain",M),B.on("dir:up dir:right dir:down dir:left",M),B.on("plain:up plain:right plain:down plain:left",M)},u.prototype.pressureFn=function(B,I,C){var M=this,x=0;clearInterval(M.pressureIntervals[C]),M.pressureIntervals[C]=setInterval(function(){var C=B.force||B.pressure||B.webkitForce||0;C!==x&&(I.trigger("pressure",C),M.trigger("pressure "+I.identifier+":pressure",C),x=C)}.bind(M),100)},u.prototype.onstart=function(B){var I=this,C=I.options,M=B;return B=g(B),I.updateBox(),q(B,(function(x){I.actives.length<C.maxNumberOfNipples?I.processOnStart(x):M.type.match(/^touch/)&&(Object.keys(I.manager.ids).forEach((function(C){if(Object.values(M.touches).findIndex((function(B){return B.identifier===C}))<0){var x=[B[0]];x.identifier=C,I.processOnEnd(x)}})),I.actives.length<C.maxNumberOfNipples&&I.processOnStart(x))})),I.manager.bindDocument(),!1},u.prototype.processOnStart=function(B){var I,C=this,x=C.options,y=C.manager.getIdentifier(B),f=B.force||B.pressure||B.webkitForce||0,L={x:B.pageX,y:B.pageY},e=C.getOrCreate(y,L);e.identifier!==y&&C.manager.removeIdentifier(e.identifier),e.identifier=y;var g=function(I){I.trigger("start",I),C.trigger("start "+I.id+":start",I),I.show(),f>0&&C.pressureFn(B,I,I.identifier),C.processOnMove(B)};if((I=C.idles.indexOf(e))>=0&&C.idles.splice(I,1),C.actives.push(e),C.ids.push(e.identifier),"semi"!==x.mode)g(e);else{if(!(M(L,e.position)<=x.catchDistance))return e.destroy(),void C.processOnStart(B);g(e)}return e},u.prototype.getOrCreate=function(B,I){var C,M=this,x=M.options;return/(semi|static)/.test(x.mode)?(C=M.idles[0])?(M.idles.splice(0,1),C):"semi"===x.mode?M.createNipple(I,B):(console.warn("Coudln't find the needed nipple."),!1):C=M.createNipple(I,B)},u.prototype.processOnMove=function(B){var I=this,C=I.options,y=I.manager.getIdentifier(B),f=I.nipples.get(y),L=I.manager.scroll;if(function(B){return isNaN(B.buttons)?0!==B.pressure:0!==B.buttons}(B)){if(!f)return console.error("Found zombie joystick with ID "+y),void I.manager.removeIdentifier(y);if(C.dynamicPage){var e=f.el.getBoundingClientRect();f.position={x:L.x+e.left,y:L.y+e.top}}f.identifier=y;var g=f.options.size/2,N={x:B.pageX,y:B.pageY};C.lockX&&(N.y=f.position.y),C.lockY&&(N.x=f.position.x);var R,H,F,k,q,S,o,U,G,V,c=M(N,f.position),t=(R=N,F=(H=f.position).x-R.x,k=H.y-R.y,function(B){return B*(180/Math.PI)}(Math.atan2(k,F))),r=x(t),A=c/g,D={distance:c,position:N};if("circle"===f.options.shape?(q=Math.min(c,g),o=f.position,U=q,V={x:0,y:0},G=x(G=t),V.x=o.x-U*Math.cos(G),V.y=o.y-U*Math.sin(G),S=V):(S=function(B,I,C){return{x:Math.min(Math.max(B.x,I.x-C),I.x+C),y:Math.min(Math.max(B.y,I.y-C),I.y+C)}}(N,f.position,g),q=M(S,f.position)),C.follow){if(c>g){var J=N.x-S.x,i=N.y-S.y;f.position.x+=J,f.position.y+=i,f.el.style.top=f.position.y-(I.box.top+L.y)+"px",f.el.style.left=f.position.x-(I.box.left+L.x)+"px",c=M(N,f.position)}}else N=S,c=q;var u=N.x-f.position.x,p=N.y-f.position.y;f.frontPosition={x:u,y:p},C.dataOnly||(f.ui.front.style.transform="translate("+u+"px,"+p+"px)");var n={identifier:f.identifier,position:N,force:A,pressure:B.force||B.pressure||B.webkitForce||0,distance:c,angle:{radian:r,degree:t},vector:{x:u/g,y:-p/g},raw:D,instance:f,lockX:C.lockX,lockY:C.lockY};(n=f.computeDirection(n)).angle={radian:x(180-t),degree:180-t},f.trigger("move",n),I.trigger("move "+f.id+":move",n)}else this.processOnEnd(B)},u.prototype.processOnEnd=function(B){var I=this,C=I.options,M=I.manager.getIdentifier(B),x=I.nipples.get(M),y=I.manager.removeIdentifier(x.identifier);x&&(C.dataOnly||x.hide((function(){"dynamic"===C.mode&&(x.trigger("removed",x),I.trigger("removed "+x.id+":removed",x),I.manager.trigger("removed "+x.id+":removed",x),x.destroy())})),clearInterval(I.pressureIntervals[x.identifier]),x.resetDirection(),x.trigger("end",x),I.trigger("end "+x.id+":end",x),I.ids.indexOf(x.identifier)>=0&&I.ids.splice(I.ids.indexOf(x.identifier),1),I.actives.indexOf(x)>=0&&I.actives.splice(I.actives.indexOf(x),1),/(semi|static)/.test(C.mode)?I.idles.push(x):I.nipples.indexOf(x)>=0&&I.nipples.splice(I.nipples.indexOf(x),1),I.manager.unbindDocument(),/(semi|static)/.test(C.mode)&&(I.manager.ids[y.id]=y.identifier))},u.prototype.onDestroyed=function(B,I){var C=this;C.nipples.indexOf(I)>=0&&C.nipples.splice(C.nipples.indexOf(I),1),C.actives.indexOf(I)>=0&&C.actives.splice(C.actives.indexOf(I),1),C.idles.indexOf(I)>=0&&C.idles.splice(C.idles.indexOf(I),1),C.ids.indexOf(I.identifier)>=0&&C.ids.splice(C.ids.indexOf(I.identifier),1),C.manager.removeIdentifier(I.identifier),C.manager.unbindDocument()},u.prototype.destroy=function(){var B=this;for(var I in B.unbindEvt(B.options.zone,"start"),B.nipples.forEach((function(B){B.destroy()})),B.pressureIntervals)B.pressureIntervals.hasOwnProperty(I)&&clearInterval(B.pressureIntervals[I]);B.trigger("destroyed",B.nipples),B.manager.unbindDocument(),B.off()};const p=u;function n(B){var I=this;I.ids={},I.index=0,I.collections=[],I.scroll=N(),I.config(B),I.prepareCollections();var C=function(){var B;I.collections.forEach((function(C){C.forEach((function(C){B=C.el.getBoundingClientRect(),C.position={x:I.scroll.x+B.left,y:I.scroll.y+B.top}}))}))};L(window,"resize",(function(){f(C)}));var M=function(){I.scroll=N()};return L(window,"scroll",(function(){f(M)})),I.collections}n.prototype=new D,n.constructor=n,n.prototype.prepareCollections=function(){var B=this;B.collections.create=B.create.bind(B),B.collections.on=B.on.bind(B),B.collections.off=B.off.bind(B),B.collections.destroy=B.destroy.bind(B),B.collections.get=function(I){var C;return B.collections.every((function(B){return!(C=B.get(I))})),C}},n.prototype.create=function(B){return this.createCollection(B)},n.prototype.createCollection=function(B){var I=this,C=new p(I,B);return I.bindCollection(C),I.collections.push(C),C},n.prototype.bindCollection=function(B){var I,C=this,M=function(B,M){I=B.type+" "+M.id+":"+B.type,C.trigger(I,M)};B.on("destroyed",C.onDestroyed.bind(C)),B.on("shown hidden rested dir plain",M),B.on("dir:up dir:right dir:down dir:left",M),B.on("plain:up plain:right plain:down plain:left",M)},n.prototype.bindDocument=function(){var B=this;B.binded||(B.bindEvt(document,"move").bindEvt(document,"end"),B.binded=!0)},n.prototype.unbindDocument=function(B){var I=this;Object.keys(I.ids).length&&!0!==B||(I.unbindEvt(document,"move").unbindEvt(document,"end"),I.binded=!1)},n.prototype.getIdentifier=function(B){var I;return B?void 0===(I=void 0===B.identifier?B.pointerId:B.identifier)&&(I=this.latest||0):I=this.index,void 0===this.ids[I]&&(this.ids[I]=this.index,this.index+=1),this.latest=I,this.ids[I]},n.prototype.removeIdentifier=function(B){var I={};for(var C in this.ids)if(this.ids[C]===B){I.id=C,I.identifier=this.ids[C],delete this.ids[C];break}return I},n.prototype.onmove=function(B){return this.onAny("move",B),!1},n.prototype.onend=function(B){return this.onAny("end",B),!1},n.prototype.oncancel=function(B){return this.onAny("end",B),!1},n.prototype.onAny=function(B,I){var C,M=this,x="processOn"+B.charAt(0).toUpperCase()+B.slice(1);I=g(I);var y=function(B,I,C){C.ids.indexOf(I)>=0&&(C[x](B),B._found_=!0)};return q(I,(function(B){C=M.getIdentifier(B),q(M.collections,y.bind(null,B,C)),B._found_||M.removeIdentifier(C)})),!1},n.prototype.destroy=function(){var B=this;B.unbindDocument(!0),B.ids={},B.index=0,B.collections.forEach((function(B){B.destroy()})),B.off()},n.prototype.onDestroyed=function(B,I){var C=this;if(C.collections.indexOf(I)<0)return!1;C.collections.splice(C.collections.indexOf(I),1)};var O=new n;const a={create:function(B){return O.create(B)},factory:O};return I.default})(),B.exports=I()},12291:(B,I,C)=>{"use strict";const{Deflate:M,deflate:x,deflateRaw:y,gzip:f}=C(12296),{Inflate:L,inflate:e,inflateRaw:g,ungzip:N}=C(12343),R=C(12330);B.exports.Deflate=M,B.exports.deflate=x,B.exports.deflateRaw=y,B.exports.gzip=f,B.exports.Inflate=L,B.exports.inflate=e,B.exports.inflateRaw=g,B.exports.ungzip=N,B.exports.constants=R},12296:(B,I,C)=>{"use strict";const M=C(12305),x=C(12333),y=C(12336),f=C(12327),L=C(12340),e=Object.prototype.toString,{Z_NO_FLUSH:g,Z_SYNC_FLUSH:N,Z_FULL_FLUSH:R,Z_FINISH:H,Z_OK:F,Z_STREAM_END:k,Z_DEFAULT_COMPRESSION:q,Z_DEFAULT_STRATEGY:S,Z_DEFLATED:o}=C(12330);function U(B){this.options=x.assign({level:q,method:o,QB:16384,windowBits:15,memLevel:8,strategy:S},B||{});let I=this.options;I.raw&&I.windowBits>0?I.windowBits=-I.windowBits:I.gzip&&I.windowBits>0&&I.windowBits<16&&(I.windowBits+=16),this.err=0,this.LI="",this.ended=!1,this.chunks=[],this.strm=new L,this.strm.avail_out=0;let C=M.deflateInit2(this.strm,I.level,I.method,I.windowBits,I.memLevel,I.strategy);if(C!==F)throw new Error(f[C]);if(I.header&&M.deflateSetHeader(this.strm,I.header),I.dictionary){let B;if(B="string"===typeof I.dictionary?y.string2buf(I.dictionary):"[object ArrayBuffer]"===e.call(I.dictionary)?new Uint8Array(I.dictionary):I.dictionary,C=M.deflateSetDictionary(this.strm,B),C!==F)throw new Error(f[C]);this._dict_set=!0}}function G(B,I){const C=new U(I);if(C.push(B,!0),C.err)throw C.LI||f[C.err];return C.result}U.prototype.push=function(B,I){const C=this.strm,x=this.options.QB;let f,L;if(this.ended)return!1;for(L=I===~~I?I:!0===I?H:g,"string"===typeof B?C.input=y.string2buf(B):"[object ArrayBuffer]"===e.call(B)?C.input=new Uint8Array(B):C.input=B,C.next_in=0,C.avail_in=C.input.length;;)if(0===C.avail_out&&(C.output=new Uint8Array(x),C.next_out=0,C.avail_out=x),(L===N||L===R)&&C.avail_out<=6)this.onData(C.output.subarray(0,C.next_out)),C.avail_out=0;else{if(f=M.deflate(C,L),f===k)return C.next_out>0&&this.onData(C.output.subarray(0,C.next_out)),f=M.deflateEnd(this.strm),this.onEnd(f),this.ended=!0,f===F;if(0!==C.avail_out){if(L>0&&C.next_out>0)this.onData(C.output.subarray(0,C.next_out)),C.avail_out=0;else if(0===C.avail_in)break}else this.onData(C.output)}return!0},U.prototype.onData=function(B){this.chunks.push(B)},U.prototype.onEnd=function(B){B===F&&(this.result=x.flattenChunks(this.chunks)),this.chunks=[],this.err=B,this.LI=this.strm.LI},B.exports.Deflate=U,B.exports.deflate=G,B.exports.deflateRaw=function(B,I){return(I=I||{}).raw=!0,G(B,I)},B.exports.gzip=function(B,I){return(I=I||{}).gzip=!0,G(B,I)},B.exports.constants=C(12330)},12343:(B,I,C)=>{"use strict";const M=C(12345),x=C(12333),y=C(12336),f=C(12327),L=C(12340),e=C(12363),g=Object.prototype.toString,{Z_NO_FLUSH:N,Z_FINISH:R,Z_OK:H,Z_STREAM_END:F,Z_NEED_DICT:k,Z_STREAM_ERROR:q,Z_DATA_ERROR:S,Z_MEM_ERROR:o}=C(12330);function U(B){this.options=x.assign({QB:65536,windowBits:15,to:""},B||{});const I=this.options;I.raw&&I.windowBits>=0&&I.windowBits<16&&(I.windowBits=-I.windowBits,0===I.windowBits&&(I.windowBits=-15)),!(I.windowBits>=0&&I.windowBits<16)||B&&B.windowBits||(I.windowBits+=32),I.windowBits>15&&I.windowBits<48&&0===(15&I.windowBits)&&(I.windowBits|=15),this.err=0,this.LI="",this.ended=!1,this.chunks=[],this.strm=new L,this.strm.avail_out=0;let C=M.inflateInit2(this.strm,I.windowBits);if(C!==H)throw new Error(f[C]);if(this.header=new e,M.inflateGetHeader(this.strm,this.header),I.dictionary&&("string"===typeof I.dictionary?I.dictionary=y.string2buf(I.dictionary):"[object ArrayBuffer]"===g.call(I.dictionary)&&(I.dictionary=new Uint8Array(I.dictionary)),I.raw&&(C=M.inflateSetDictionary(this.strm,I.dictionary),C!==H)))throw new Error(f[C])}function G(B,I){const C=new U(I);if(C.push(B),C.err)throw C.LI||f[C.err];return C.result}U.prototype.push=function(B,I){const C=this.strm,x=this.options.QB,f=this.options.dictionary;let L,e,U;if(this.ended)return!1;for(e=I===~~I?I:!0===I?R:N,"[object ArrayBuffer]"===g.call(B)?C.input=new Uint8Array(B):C.input=B,C.next_in=0,C.avail_in=C.input.length;;){for(0===C.avail_out&&(C.output=new Uint8Array(x),C.next_out=0,C.avail_out=x),L=M.inflate(C,e),L===k&&f&&(L=M.inflateSetDictionary(C,f),L===H?L=M.inflate(C,e):L===S&&(L=k));C.avail_in>0&&L===F&&C.state.wrap>0&&0!==B[C.next_in];)M.inflateReset(C),L=M.inflate(C,e);switch(L){case q:case S:case k:case o:return this.onEnd(L),this.ended=!0,!1}if(U=C.avail_out,C.next_out&&(0===C.avail_out||L===F))if("string"===this.options.to){let B=y.utf8border(C.output,C.next_out),I=C.next_out-B,M=y.buf2string(C.output,B);C.next_out=I,C.avail_out=x-I,I&&C.output.set(C.output.subarray(B,B+I),0),this.onData(M)}else this.onData(C.output.length===C.next_out?C.output:C.output.subarray(0,C.next_out));if(L!==H||0!==U){if(L===F)return L=M.inflateEnd(this.strm),this.onEnd(L),this.ended=!0,!0;if(0===C.avail_in)break}}return!0},U.prototype.onData=function(B){this.chunks.push(B)},U.prototype.onEnd=function(B){B===H&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=x.flattenChunks(this.chunks)),this.chunks=[],this.err=B,this.LI=this.strm.LI},B.exports.Inflate=U,B.exports.inflate=G,B.exports.inflateRaw=function(B,I){return(I=I||{}).raw=!0,G(B,I)},B.exports.ungzip=G,B.exports.constants=C(12330)},12333:B=>{"use strict";const I=(B,I)=>Object.prototype.hasOwnProperty.call(B,I);B.exports.assign=function(B){const C=Array.prototype.slice.call(arguments,1);for(;C.length;){const M=C.shift();if(M){if("object"!==typeof M)throw new TypeError(M+"must be non-object");for(const C in M)I(M,C)&&(B[C]=M[C])}}return B},B.exports.flattenChunks=B=>{let I=0;for(let M=0,x=B.length;M<x;M++)I+=B[M].length;const C=new Uint8Array(I);for(let M=0,x=0,y=B.length;M<y;M++){let I=B[M];C.set(I,x),x+=I.length}return C}},12336:B=>{"use strict";let I=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(M){I=!1}const C=new Uint8Array(256);for(let x=0;x<256;x++)C[x]=x>=252?6:x>=248?5:x>=240?4:x>=224?3:x>=192?2:1;C[254]=C[254]=1,B.exports.string2buf=B=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(B);let I,C,M,x,y,f=B.length,L=0;for(x=0;x<f;x++)C=B.charCodeAt(x),55296===(64512&C)&&x+1<f&&(M=B.charCodeAt(x+1),56320===(64512&M)&&(C=65536+(C-55296<<10)+(M-56320),x++)),L+=C<128?1:C<2048?2:C<65536?3:4;for(I=new Uint8Array(L),y=0,x=0;y<L;x++)C=B.charCodeAt(x),55296===(64512&C)&&x+1<f&&(M=B.charCodeAt(x+1),56320===(64512&M)&&(C=65536+(C-55296<<10)+(M-56320),x++)),C<128?I[y++]=C:C<2048?(I[y++]=192|C>>>6,I[y++]=128|63&C):C<65536?(I[y++]=224|C>>>12,I[y++]=128|C>>>6&63,I[y++]=128|63&C):(I[y++]=240|C>>>18,I[y++]=128|C>>>12&63,I[y++]=128|C>>>6&63,I[y++]=128|63&C);return I};B.exports.buf2string=(B,M)=>{const x=M||B.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(B.subarray(0,M));let y,f;const L=new Array(2*x);for(f=0,y=0;y<x;){let I=B[y++];if(I<128){L[f++]=I;continue}let M=C[I];if(M>4)L[f++]=65533,y+=M-1;else{for(I&=2===M?31:3===M?15:7;M>1&&y<x;)I=I<<6|63&B[y++],M--;M>1?L[f++]=65533:I<65536?L[f++]=I:(I-=65536,L[f++]=55296|I>>10&1023,L[f++]=56320|1023&I)}}return((B,C)=>{if(C<65534&&B.subarray&&I)return String.fromCharCode.apply(null,B.length===C?B:B.subarray(0,C));let M="";for(let I=0;I<C;I++)M+=String.fromCharCode(B[I]);return M})(L,f)},B.exports.utf8border=(B,I)=>{(I=I||B.length)>B.length&&(I=B.length);let M=I-1;for(;M>=0&&128===(192&B[M]);)M--;return M<0||0===M?I:M+C[B[M]]>I?M:I}},12317:B=>{"use strict";B.exports=(B,I,C,M)=>{let x=65535&B,y=B>>>16&65535,f=0;for(;0!==C;){f=C>2e3?2e3:C,C-=f;do{x=x+I[M++]|0,y=y+x|0}while(--f);x%=65521,y%=65521}return x|y<<16}},12330:B=>{"use strict";B.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12323:B=>{"use strict";const I=new Uint32Array((()=>{let B,I=[];for(var C=0;C<256;C++){B=C;for(var M=0;M<8;M++)B=1&B?3988292384^B>>>1:B>>>1;I[C]=B}return I})());B.exports=(B,C,M,x)=>{const y=I,f=x+M;B^=-1;for(let I=x;I<f;I++)B=B>>>8^y[255&(B^C[I])];return~B}},12305:(B,I,C)=>{"use strict";const{_tr_init:M,_tr_stored_block:x,_tr_flush_block:y,_tr_tally:f,_tr_align:L}=C(12309),e=C(12317),g=C(12323),N=C(12327),{Z_NO_FLUSH:R,Z_PARTIAL_FLUSH:H,Z_FULL_FLUSH:F,Z_FINISH:k,Z_BLOCK:q,Z_OK:S,Z_STREAM_END:o,Z_STREAM_ERROR:U,Z_DATA_ERROR:G,Z_BUF_ERROR:V,Z_DEFAULT_COMPRESSION:c,Z_FILTERED:t,Z_HUFFMAN_ONLY:r,Z_RLE:A,Z_FIXED:D,Z_DEFAULT_STRATEGY:J,Z_UNKNOWN:i,Z_DEFLATED:u}=C(12330),p=258,n=262,O=103,a=113,W=666,d=(B,I)=>(B.LI=N[I],I),l=B=>(B<<1)-(B>4?9:0),E=B=>{let I=B.length;for(;--I>=0;)B[I]=0};let Q=(B,I,C)=>(I<<B.hash_shift^C)&B.hash_mask;const Z=B=>{const I=B.state;let C=I.pending;C>B.avail_out&&(C=B.avail_out),0!==C&&(B.output.set(I.pending_buf.subarray(I.pending_out,I.pending_out+C),B.next_out),B.next_out+=C,I.pending_out+=C,B.total_out+=C,B.avail_out-=C,I.pending-=C,0===I.pending&&(I.pending_out=0))},z=(B,I)=>{y(B,B.block_start>=0?B.block_start:-1,B.strstart-B.block_start,I),B.block_start=B.strstart,Z(B.strm)},b=(B,I)=>{B.pending_buf[B.pending++]=I},Y=(B,I)=>{B.pending_buf[B.pending++]=I>>>8&255,B.pending_buf[B.pending++]=255&I},v=(B,I,C,M)=>{let x=B.avail_in;return x>M&&(x=M),0===x?0:(B.avail_in-=x,I.set(B.input.subarray(B.next_in,B.next_in+x),C),1===B.state.wrap?B.adler=e(B.adler,I,x,C):2===B.state.wrap&&(B.adler=g(B.adler,I,x,C)),B.next_in+=x,B.total_in+=x,x)},s=(B,I)=>{let C,M,x=B.max_chain_length,y=B.strstart,f=B.prev_length,L=B.nice_match;const e=B.strstart>B.w_size-n?B.strstart-(B.w_size-n):0,g=B.window,N=B.w_mask,R=B.prev,H=B.strstart+p;let F=g[y+f-1],k=g[y+f];B.prev_length>=B.good_match&&(x>>=2),L>B.lookahead&&(L=B.lookahead);do{if(C=I,g[C+f]===k&&g[C+f-1]===F&&g[C]===g[y]&&g[++C]===g[y+1]){y+=2,C++;do{}while(g[++y]===g[++C]&&g[++y]===g[++C]&&g[++y]===g[++C]&&g[++y]===g[++C]&&g[++y]===g[++C]&&g[++y]===g[++C]&&g[++y]===g[++C]&&g[++y]===g[++C]&&y<H);if(M=p-(H-y),y=H-p,M>f){if(B.match_start=I,f=M,M>=L)break;F=g[y+f-1],k=g[y+f]}}}while((I=R[I&N])>e&&0!==--x);return f<=B.lookahead?f:B.lookahead},X=B=>{const I=B.w_size;let C,M,x,y,f;do{if(y=B.window_size-B.lookahead-B.strstart,B.strstart>=I+(I-n)){B.window.set(B.window.subarray(I,I+I),0),B.match_start-=I,B.strstart-=I,B.block_start-=I,M=B.hash_size,C=M;do{x=B.head[--C],B.head[C]=x>=I?x-I:0}while(--M);M=I,C=M;do{x=B.prev[--C],B.prev[C]=x>=I?x-I:0}while(--M);y+=I}if(0===B.strm.avail_in)break;if(M=v(B.strm,B.window,B.strstart+B.lookahead,y),B.lookahead+=M,B.lookahead+B.insert>=3)for(f=B.strstart-B.insert,B.ins_h=B.window[f],B.ins_h=Q(B,B.ins_h,B.window[f+1]);B.insert&&(B.ins_h=Q(B,B.ins_h,B.window[f+3-1]),B.prev[f&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=f,f++,B.insert--,!(B.lookahead+B.insert<3)););}while(B.lookahead<n&&0!==B.strm.avail_in)},T=(B,I)=>{let C,M;for(;;){if(B.lookahead<n){if(X(B),B.lookahead<n&&I===R)return 1;if(0===B.lookahead)break}if(C=0,B.lookahead>=3&&(B.ins_h=Q(B,B.ins_h,B.window[B.strstart+3-1]),C=B.prev[B.strstart&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=B.strstart),0!==C&&B.strstart-C<=B.w_size-n&&(B.match_length=s(B,C)),B.match_length>=3)if(M=f(B,B.strstart-B.match_start,B.match_length-3),B.lookahead-=B.match_length,B.match_length<=B.max_lazy_match&&B.lookahead>=3){B.match_length--;do{B.strstart++,B.ins_h=Q(B,B.ins_h,B.window[B.strstart+3-1]),C=B.prev[B.strstart&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=B.strstart}while(0!==--B.match_length);B.strstart++}else B.strstart+=B.match_length,B.match_length=0,B.ins_h=B.window[B.strstart],B.ins_h=Q(B,B.ins_h,B.window[B.strstart+1]);else M=f(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++;if(M&&(z(B,!1),0===B.strm.avail_out))return 1}return B.insert=B.strstart<2?B.strstart:2,I===k?(z(B,!0),0===B.strm.avail_out?3:4):B.last_lit&&(z(B,!1),0===B.strm.avail_out)?1:2},P=(B,I)=>{let C,M,x;for(;;){if(B.lookahead<n){if(X(B),B.lookahead<n&&I===R)return 1;if(0===B.lookahead)break}if(C=0,B.lookahead>=3&&(B.ins_h=Q(B,B.ins_h,B.window[B.strstart+3-1]),C=B.prev[B.strstart&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=B.strstart),B.prev_length=B.match_length,B.prev_match=B.match_start,B.match_length=2,0!==C&&B.prev_length<B.max_lazy_match&&B.strstart-C<=B.w_size-n&&(B.match_length=s(B,C),B.match_length<=5&&(B.strategy===t||3===B.match_length&&B.strstart-B.match_start>4096)&&(B.match_length=2)),B.prev_length>=3&&B.match_length<=B.prev_length){x=B.strstart+B.lookahead-3,M=f(B,B.strstart-1-B.prev_match,B.prev_length-3),B.lookahead-=B.prev_length-1,B.prev_length-=2;do{++B.strstart<=x&&(B.ins_h=Q(B,B.ins_h,B.window[B.strstart+3-1]),C=B.prev[B.strstart&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=B.strstart)}while(0!==--B.prev_length);if(B.match_available=0,B.match_length=2,B.strstart++,M&&(z(B,!1),0===B.strm.avail_out))return 1}else if(B.match_available){if(M=f(B,0,B.window[B.strstart-1]),M&&z(B,!1),B.strstart++,B.lookahead--,0===B.strm.avail_out)return 1}else B.match_available=1,B.strstart++,B.lookahead--}return B.match_available&&(M=f(B,0,B.window[B.strstart-1]),B.match_available=0),B.insert=B.strstart<2?B.strstart:2,I===k?(z(B,!0),0===B.strm.avail_out?3:4):B.last_lit&&(z(B,!1),0===B.strm.avail_out)?1:2};function h(B,I,C,M,x){this.good_length=B,this.max_lazy=I,this.nice_length=C,this.max_chain=M,this.func=x}const j=[new h(0,0,0,0,((B,I)=>{let C=65535;for(C>B.pending_buf_size-5&&(C=B.pending_buf_size-5);;){if(B.lookahead<=1){if(X(B),0===B.lookahead&&I===R)return 1;if(0===B.lookahead)break}B.strstart+=B.lookahead,B.lookahead=0;const M=B.block_start+C;if((0===B.strstart||B.strstart>=M)&&(B.lookahead=B.strstart-M,B.strstart=M,z(B,!1),0===B.strm.avail_out))return 1;if(B.strstart-B.block_start>=B.w_size-n&&(z(B,!1),0===B.strm.avail_out))return 1}return B.insert=0,I===k?(z(B,!0),0===B.strm.avail_out?3:4):(B.strstart>B.block_start&&(z(B,!1),B.strm.avail_out),1)})),new h(4,4,8,4,T),new h(4,5,16,8,T),new h(4,6,32,32,T),new h(4,4,16,16,P),new h(8,16,32,32,P),new h(8,16,128,128,P),new h(8,32,128,256,P),new h(32,128,258,1024,P),new h(32,258,258,4096,P)];function w(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=u,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),E(this.dyn_ltree),E(this.dyn_dtree),E(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),E(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),E(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const K=B=>{if(!B||!B.state)return d(B,U);B.total_in=B.total_out=0,B.data_type=i;const I=B.state;return I.pending=0,I.pending_out=0,I.wrap<0&&(I.wrap=-I.wrap),I.status=I.wrap?42:a,B.adler=2===I.wrap?0:1,I.last_flush=R,M(I),S},m=B=>{const I=K(B);var C;return I===S&&((C=B.state).window_size=2*C.w_size,E(C.head),C.max_lazy_match=j[C.level].max_lazy,C.good_match=j[C.level].good_length,C.nice_match=j[C.level].nice_length,C.max_chain_length=j[C.level].max_chain,C.strstart=0,C.block_start=0,C.lookahead=0,C.insert=0,C.match_length=C.prev_length=2,C.match_available=0,C.ins_h=0),I},BB=(B,I,C,M,x,y)=>{if(!B)return U;let f=1;if(I===c&&(I=6),M<0?(f=0,M=-M):M>15&&(f=2,M-=16),x<1||x>9||C!==u||M<8||M>15||I<0||I>9||y<0||y>D)return d(B,U);8===M&&(M=9);const L=new w;return B.state=L,L.strm=B,L.wrap=f,L.gzhead=null,L.w_bits=M,L.w_size=1<<L.w_bits,L.w_mask=L.w_size-1,L.hash_bits=x+7,L.hash_size=1<<L.hash_bits,L.hash_mask=L.hash_size-1,L.hash_shift=~~((L.hash_bits+3-1)/3),L.window=new Uint8Array(2*L.w_size),L.head=new Uint16Array(L.hash_size),L.prev=new Uint16Array(L.w_size),L.lit_bufsize=1<<x+6,L.pending_buf_size=4*L.lit_bufsize,L.pending_buf=new Uint8Array(L.pending_buf_size),L.d_buf=1*L.lit_bufsize,L.l_buf=3*L.lit_bufsize,L.level=I,L.strategy=y,L.method=C,m(B)};B.exports.deflateInit=(B,I)=>BB(B,I,u,15,8,J),B.exports.deflateInit2=BB,B.exports.deflateReset=m,B.exports.deflateResetKeep=K,B.exports.deflateSetHeader=(B,I)=>B&&B.state?2!==B.state.wrap?U:(B.state.gzhead=I,S):U,B.exports.deflate=(B,I)=>{let C,M;if(!B||!B.state||I>q||I<0)return B?d(B,U):U;const y=B.state;if(!B.output||!B.input&&0!==B.avail_in||y.status===W&&I!==k)return d(B,0===B.avail_out?V:U);y.strm=B;const e=y.last_flush;if(y.last_flush=I,42===y.status)if(2===y.wrap)B.adler=0,b(y,31),b(y,139),b(y,8),y.gzhead?(b(y,(y.gzhead.text?1:0)+(y.gzhead.hcrc?2:0)+(y.gzhead.extra?4:0)+(y.gzhead.name?8:0)+(y.gzhead.comment?16:0)),b(y,255&y.gzhead.time),b(y,y.gzhead.time>>8&255),b(y,y.gzhead.time>>16&255),b(y,y.gzhead.time>>24&255),b(y,9===y.level?2:y.strategy>=r||y.level<2?4:0),b(y,255&y.gzhead.os),y.gzhead.extra&&y.gzhead.extra.length&&(b(y,255&y.gzhead.extra.length),b(y,y.gzhead.extra.length>>8&255)),y.gzhead.hcrc&&(B.adler=g(B.adler,y.pending_buf,y.pending,0)),y.gzindex=0,y.status=69):(b(y,0),b(y,0),b(y,0),b(y,0),b(y,0),b(y,9===y.level?2:y.strategy>=r||y.level<2?4:0),b(y,3),y.status=a);else{let I=u+(y.w_bits-8<<4)<<8,C=-1;C=y.strategy>=r||y.level<2?0:y.level<6?1:6===y.level?2:3,I|=C<<6,0!==y.strstart&&(I|=32),I+=31-I%31,y.status=a,Y(y,I),0!==y.strstart&&(Y(y,B.adler>>>16),Y(y,65535&B.adler)),B.adler=1}if(69===y.status)if(y.gzhead.extra){for(C=y.pending;y.gzindex<(65535&y.gzhead.extra.length)&&(y.pending!==y.pending_buf_size||(y.gzhead.hcrc&&y.pending>C&&(B.adler=g(B.adler,y.pending_buf,y.pending-C,C)),Z(B),C=y.pending,y.pending!==y.pending_buf_size));)b(y,255&y.gzhead.extra[y.gzindex]),y.gzindex++;y.gzhead.hcrc&&y.pending>C&&(B.adler=g(B.adler,y.pending_buf,y.pending-C,C)),y.gzindex===y.gzhead.extra.length&&(y.gzindex=0,y.status=73)}else y.status=73;if(73===y.status)if(y.gzhead.name){C=y.pending;do{if(y.pending===y.pending_buf_size&&(y.gzhead.hcrc&&y.pending>C&&(B.adler=g(B.adler,y.pending_buf,y.pending-C,C)),Z(B),C=y.pending,y.pending===y.pending_buf_size)){M=1;break}M=y.gzindex<y.gzhead.name.length?255&y.gzhead.name.charCodeAt(y.gzindex++):0,b(y,M)}while(0!==M);y.gzhead.hcrc&&y.pending>C&&(B.adler=g(B.adler,y.pending_buf,y.pending-C,C)),0===M&&(y.gzindex=0,y.status=91)}else y.status=91;if(91===y.status)if(y.gzhead.comment){C=y.pending;do{if(y.pending===y.pending_buf_size&&(y.gzhead.hcrc&&y.pending>C&&(B.adler=g(B.adler,y.pending_buf,y.pending-C,C)),Z(B),C=y.pending,y.pending===y.pending_buf_size)){M=1;break}M=y.gzindex<y.gzhead.comment.length?255&y.gzhead.comment.charCodeAt(y.gzindex++):0,b(y,M)}while(0!==M);y.gzhead.hcrc&&y.pending>C&&(B.adler=g(B.adler,y.pending_buf,y.pending-C,C)),0===M&&(y.status=O)}else y.status=O;if(y.status===O&&(y.gzhead.hcrc?(y.pending+2>y.pending_buf_size&&Z(B),y.pending+2<=y.pending_buf_size&&(b(y,255&B.adler),b(y,B.adler>>8&255),B.adler=0,y.status=a)):y.status=a),0!==y.pending){if(Z(B),0===B.avail_out)return y.last_flush=-1,S}else if(0===B.avail_in&&l(I)<=l(e)&&I!==k)return d(B,V);if(y.status===W&&0!==B.avail_in)return d(B,V);if(0!==B.avail_in||0!==y.lookahead||I!==R&&y.status!==W){let C=y.strategy===r?((B,I)=>{let C;for(;;){if(0===B.lookahead&&(X(B),0===B.lookahead)){if(I===R)return 1;break}if(B.match_length=0,C=f(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++,C&&(z(B,!1),0===B.strm.avail_out))return 1}return B.insert=0,I===k?(z(B,!0),0===B.strm.avail_out?3:4):B.last_lit&&(z(B,!1),0===B.strm.avail_out)?1:2})(y,I):y.strategy===A?((B,I)=>{let C,M,x,y;const L=B.window;for(;;){if(B.lookahead<=p){if(X(B),B.lookahead<=p&&I===R)return 1;if(0===B.lookahead)break}if(B.match_length=0,B.lookahead>=3&&B.strstart>0&&(x=B.strstart-1,M=L[x],M===L[++x]&&M===L[++x]&&M===L[++x])){y=B.strstart+p;do{}while(M===L[++x]&&M===L[++x]&&M===L[++x]&&M===L[++x]&&M===L[++x]&&M===L[++x]&&M===L[++x]&&M===L[++x]&&x<y);B.match_length=p-(y-x),B.match_length>B.lookahead&&(B.match_length=B.lookahead)}if(B.match_length>=3?(C=f(B,1,B.match_length-3),B.lookahead-=B.match_length,B.strstart+=B.match_length,B.match_length=0):(C=f(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++),C&&(z(B,!1),0===B.strm.avail_out))return 1}return B.insert=0,I===k?(z(B,!0),0===B.strm.avail_out?3:4):B.last_lit&&(z(B,!1),0===B.strm.avail_out)?1:2})(y,I):j[y.level].func(y,I);if(3!==C&&4!==C||(y.status=W),1===C||3===C)return 0===B.avail_out&&(y.last_flush=-1),S;if(2===C&&(I===H?L(y):I!==q&&(x(y,0,0,!1),I===F&&(E(y.head),0===y.lookahead&&(y.strstart=0,y.block_start=0,y.insert=0))),Z(B),0===B.avail_out))return y.last_flush=-1,S}return I!==k?S:y.wrap<=0?o:(2===y.wrap?(b(y,255&B.adler),b(y,B.adler>>8&255),b(y,B.adler>>16&255),b(y,B.adler>>24&255),b(y,255&B.total_in),b(y,B.total_in>>8&255),b(y,B.total_in>>16&255),b(y,B.total_in>>24&255)):(Y(y,B.adler>>>16),Y(y,65535&B.adler)),Z(B),y.wrap>0&&(y.wrap=-y.wrap),0!==y.pending?S:o)},B.exports.deflateEnd=B=>{if(!B||!B.state)return U;const I=B.state.status;return 42!==I&&69!==I&&73!==I&&91!==I&&I!==O&&I!==a&&I!==W?d(B,U):(B.state=null,I===a?d(B,G):S)},B.exports.deflateSetDictionary=(B,I)=>{let C=I.length;if(!B||!B.state)return U;const M=B.state,x=M.wrap;if(2===x||1===x&&42!==M.status||M.lookahead)return U;if(1===x&&(B.adler=e(B.adler,I,C,0)),M.wrap=0,C>=M.w_size){0===x&&(E(M.head),M.strstart=0,M.block_start=0,M.insert=0);let B=new Uint8Array(M.w_size);B.set(I.subarray(C-M.w_size,C),0),I=B,C=M.w_size}const y=B.avail_in,f=B.next_in,L=B.input;for(B.avail_in=C,B.next_in=0,B.input=I,X(M);M.lookahead>=3;){let B=M.strstart,I=M.lookahead-2;do{M.ins_h=Q(M,M.ins_h,M.window[B+3-1]),M.prev[B&M.w_mask]=M.head[M.ins_h],M.head[M.ins_h]=B,B++}while(--I);M.strstart=B,M.lookahead=2,X(M)}return M.strstart+=M.lookahead,M.block_start=M.strstart,M.insert=M.lookahead,M.lookahead=0,M.match_length=M.prev_length=2,M.match_available=0,B.next_in=f,B.input=L,B.avail_in=y,M.wrap=x,S},B.exports.deflateInfo="pako deflate (from Nodeca project)"},12363:B=>{"use strict";B.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12347:B=>{"use strict";B.exports=function(B,I){let C,M,x,y,f,L,e,g,N,R,H,F,k,q,S,o,U,G,V,c,t,r,A,D;const J=B.state;C=B.next_in,A=B.input,M=C+(B.avail_in-5),x=B.next_out,D=B.output,y=x-(I-B.avail_out),f=x+(B.avail_out-257),L=J.dmax,e=J.wsize,g=J.whave,N=J.wnext,R=J.window,H=J.hold,F=J.bits,k=J.lencode,q=J.distcode,S=(1<<J.lenbits)-1,o=(1<<J.distbits)-1;B:do{F<15&&(H+=A[C++]<<F,F+=8,H+=A[C++]<<F,F+=8),U=k[H&S];I:for(;;){if(G=U>>>24,H>>>=G,F-=G,G=U>>>16&255,0===G)D[x++]=65535&U;else{if(!(16&G)){if(0===(64&G)){U=k[(65535&U)+(H&(1<<G)-1)];continue I}if(32&G){J.mode=12;break B}B.LI="invalid literal/length code",J.mode=30;break B}V=65535&U,G&=15,G&&(F<G&&(H+=A[C++]<<F,F+=8),V+=H&(1<<G)-1,H>>>=G,F-=G),F<15&&(H+=A[C++]<<F,F+=8,H+=A[C++]<<F,F+=8),U=q[H&o];C:for(;;){if(G=U>>>24,H>>>=G,F-=G,G=U>>>16&255,!(16&G)){if(0===(64&G)){U=q[(65535&U)+(H&(1<<G)-1)];continue C}B.LI="invalid distance code",J.mode=30;break B}if(c=65535&U,G&=15,F<G&&(H+=A[C++]<<F,F+=8,F<G&&(H+=A[C++]<<F,F+=8)),c+=H&(1<<G)-1,c>L){B.LI="invalid distance too far back",J.mode=30;break B}if(H>>>=G,F-=G,G=x-y,c>G){if(G=c-G,G>g&&J.sane){B.LI="invalid distance too far back",J.mode=30;break B}if(t=0,r=R,0===N){if(t+=e-G,G<V){V-=G;do{D[x++]=R[t++]}while(--G);t=x-c,r=D}}else if(N<G){if(t+=e+N-G,G-=N,G<V){V-=G;do{D[x++]=R[t++]}while(--G);if(t=0,N<V){G=N,V-=G;do{D[x++]=R[t++]}while(--G);t=x-c,r=D}}}else if(t+=N-G,G<V){V-=G;do{D[x++]=R[t++]}while(--G);t=x-c,r=D}for(;V>2;)D[x++]=r[t++],D[x++]=r[t++],D[x++]=r[t++],V-=3;V&&(D[x++]=r[t++],V>1&&(D[x++]=r[t++]))}else{t=x-c;do{D[x++]=D[t++],D[x++]=D[t++],D[x++]=D[t++],V-=3}while(V>2);V&&(D[x++]=D[t++],V>1&&(D[x++]=D[t++]))}break}}break}}while(C<M&&x<f);V=F>>3,C-=V,F-=V<<3,H&=(1<<F)-1,B.next_in=C,B.next_out=x,B.avail_in=C<M?M-C+5:5-(C-M),B.avail_out=x<f?f-x+257:257-(x-f),J.hold=H,J.bits=F}},12345:(B,I,C)=>{"use strict";const M=C(12317),x=C(12323),y=C(12347),f=C(12354),{Z_FINISH:L,Z_BLOCK:e,Z_TREES:g,Z_OK:N,Z_STREAM_END:R,Z_NEED_DICT:H,Z_STREAM_ERROR:F,Z_DATA_ERROR:k,Z_MEM_ERROR:q,Z_BUF_ERROR:S,Z_DEFLATED:o}=C(12330),U=12,G=30,V=B=>(B>>>24&255)+(B>>>8&65280)+((65280&B)<<8)+((255&B)<<24);function c(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const t=B=>{if(!B||!B.state)return F;const I=B.state;return B.total_in=B.total_out=I.total=0,B.LI="",I.wrap&&(B.adler=1&I.wrap),I.mode=1,I.last=0,I.havedict=0,I.dmax=32768,I.head=null,I.hold=0,I.bits=0,I.lencode=I.lendyn=new Int32Array(852),I.distcode=I.distdyn=new Int32Array(592),I.sane=1,I.back=-1,N},r=B=>{if(!B||!B.state)return F;const I=B.state;return I.wsize=0,I.whave=0,I.wnext=0,t(B)},A=(B,I)=>{let C;if(!B||!B.state)return F;const M=B.state;return I<0?(C=0,I=-I):(C=1+(I>>4),I<48&&(I&=15)),I&&(I<8||I>15)?F:(null!==M.window&&M.wbits!==I&&(M.window=null),M.wrap=C,M.wbits=I,r(B))},D=(B,I)=>{if(!B)return F;const C=new c;B.state=C,C.window=null;const M=A(B,I);return M!==N&&(B.state=null),M};let J,i,u=!0;const p=B=>{if(u){J=new Int32Array(512),i=new Int32Array(32);let I=0;for(;I<144;)B.lens[I++]=8;for(;I<256;)B.lens[I++]=9;for(;I<280;)B.lens[I++]=7;for(;I<288;)B.lens[I++]=8;for(f(1,B.lens,0,288,J,0,B.work,{bits:9}),I=0;I<32;)B.lens[I++]=5;f(2,B.lens,0,32,i,0,B.work,{bits:5}),u=!1}B.lencode=J,B.lenbits=9,B.distcode=i,B.distbits=5},n=(B,I,C,M)=>{let x;const y=B.state;return null===y.window&&(y.wsize=1<<y.wbits,y.wnext=0,y.whave=0,y.window=new Uint8Array(y.wsize)),M>=y.wsize?(y.window.set(I.subarray(C-y.wsize,C),0),y.wnext=0,y.whave=y.wsize):(x=y.wsize-y.wnext,x>M&&(x=M),y.window.set(I.subarray(C-M,C-M+x),y.wnext),(M-=x)?(y.window.set(I.subarray(C-M,C),0),y.wnext=M,y.whave=y.wsize):(y.wnext+=x,y.wnext===y.wsize&&(y.wnext=0),y.whave<y.wsize&&(y.whave+=x))),0};B.exports.inflateReset=r,B.exports.inflateReset2=A,B.exports.inflateResetKeep=t,B.exports.inflateInit=B=>D(B,15),B.exports.inflateInit2=D,B.exports.inflate=(B,I)=>{let C,c,t,r,A,D,J,i,u,O,a,W,d,l,E,Q,Z,z,b,Y,v,s,X=0;const T=new Uint8Array(4);let P,h;const j=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!B||!B.state||!B.output||!B.input&&0!==B.avail_in)return F;C=B.state,C.mode===U&&(C.mode=13),A=B.next_out,t=B.output,J=B.avail_out,r=B.next_in,c=B.input,D=B.avail_in,i=C.hold,u=C.bits,O=D,a=J,s=N;B:for(;;)switch(C.mode){case 1:if(0===C.wrap){C.mode=13;break}for(;u<16;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}if(2&C.wrap&&35615===i){C.check=0,T[0]=255&i,T[1]=i>>>8&255,C.check=x(C.check,T,2,0),i=0,u=0,C.mode=2;break}if(C.flags=0,C.head&&(C.head.done=!1),!(1&C.wrap)||(((255&i)<<8)+(i>>8))%31){B.LI="incorrect header check",C.mode=G;break}if((15&i)!==o){B.LI="unknown compression method",C.mode=G;break}if(i>>>=4,u-=4,v=8+(15&i),0===C.wbits)C.wbits=v;else if(v>C.wbits){B.LI="invalid window size",C.mode=G;break}C.dmax=1<<C.wbits,B.adler=C.check=1,C.mode=512&i?10:U,i=0,u=0;break;case 2:for(;u<16;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}if(C.flags=i,(255&C.flags)!==o){B.LI="unknown compression method",C.mode=G;break}if(57344&C.flags){B.LI="unknown header flags set",C.mode=G;break}C.head&&(C.head.text=i>>8&1),512&C.flags&&(T[0]=255&i,T[1]=i>>>8&255,C.check=x(C.check,T,2,0)),i=0,u=0,C.mode=3;case 3:for(;u<32;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}C.head&&(C.head.time=i),512&C.flags&&(T[0]=255&i,T[1]=i>>>8&255,T[2]=i>>>16&255,T[3]=i>>>24&255,C.check=x(C.check,T,4,0)),i=0,u=0,C.mode=4;case 4:for(;u<16;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}C.head&&(C.head.xflags=255&i,C.head.os=i>>8),512&C.flags&&(T[0]=255&i,T[1]=i>>>8&255,C.check=x(C.check,T,2,0)),i=0,u=0,C.mode=5;case 5:if(1024&C.flags){for(;u<16;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}C.length=i,C.head&&(C.head.extra_len=i),512&C.flags&&(T[0]=255&i,T[1]=i>>>8&255,C.check=x(C.check,T,2,0)),i=0,u=0}else C.head&&(C.head.extra=null);C.mode=6;case 6:if(1024&C.flags&&(W=C.length,W>D&&(W=D),W&&(C.head&&(v=C.head.extra_len-C.length,C.head.extra||(C.head.extra=new Uint8Array(C.head.extra_len)),C.head.extra.set(c.subarray(r,r+W),v)),512&C.flags&&(C.check=x(C.check,c,W,r)),D-=W,r+=W,C.length-=W),C.length))break B;C.length=0,C.mode=7;case 7:if(2048&C.flags){if(0===D)break B;W=0;do{v=c[r+W++],C.head&&v&&C.length<65536&&(C.head.name+=String.fromCharCode(v))}while(v&&W<D);if(512&C.flags&&(C.check=x(C.check,c,W,r)),D-=W,r+=W,v)break B}else C.head&&(C.head.name=null);C.length=0,C.mode=8;case 8:if(4096&C.flags){if(0===D)break B;W=0;do{v=c[r+W++],C.head&&v&&C.length<65536&&(C.head.comment+=String.fromCharCode(v))}while(v&&W<D);if(512&C.flags&&(C.check=x(C.check,c,W,r)),D-=W,r+=W,v)break B}else C.head&&(C.head.comment=null);C.mode=9;case 9:if(512&C.flags){for(;u<16;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}if(i!==(65535&C.check)){B.LI="header crc mismatch",C.mode=G;break}i=0,u=0}C.head&&(C.head.hcrc=C.flags>>9&1,C.head.done=!0),B.adler=C.check=0,C.mode=U;break;case 10:for(;u<32;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}B.adler=C.check=V(i),i=0,u=0,C.mode=11;case 11:if(0===C.havedict)return B.next_out=A,B.avail_out=J,B.next_in=r,B.avail_in=D,C.hold=i,C.bits=u,H;B.adler=C.check=1,C.mode=U;case U:if(I===e||I===g)break B;case 13:if(C.last){i>>>=7&u,u-=7&u,C.mode=27;break}for(;u<3;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}switch(C.last=1&i,i>>>=1,u-=1,3&i){case 0:C.mode=14;break;case 1:if(p(C),C.mode=20,I===g){i>>>=2,u-=2;break B}break;case 2:C.mode=17;break;case 3:B.LI="invalid block type",C.mode=G}i>>>=2,u-=2;break;case 14:for(i>>>=7&u,u-=7&u;u<32;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}if((65535&i)!==(i>>>16^65535)){B.LI="invalid stored block lengths",C.mode=G;break}if(C.length=65535&i,i=0,u=0,C.mode=15,I===g)break B;case 15:C.mode=16;case 16:if(W=C.length,W){if(W>D&&(W=D),W>J&&(W=J),0===W)break B;t.set(c.subarray(r,r+W),A),D-=W,r+=W,J-=W,A+=W,C.length-=W;break}C.mode=U;break;case 17:for(;u<14;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}if(C.nlen=257+(31&i),i>>>=5,u-=5,C.ndist=1+(31&i),i>>>=5,u-=5,C.ncode=4+(15&i),i>>>=4,u-=4,C.nlen>286||C.ndist>30){B.LI="too many length or distance symbols",C.mode=G;break}C.have=0,C.mode=18;case 18:for(;C.have<C.ncode;){for(;u<3;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}C.lens[j[C.have++]]=7&i,i>>>=3,u-=3}for(;C.have<19;)C.lens[j[C.have++]]=0;if(C.lencode=C.lendyn,C.lenbits=7,P={bits:C.lenbits},s=f(0,C.lens,0,19,C.lencode,0,C.work,P),C.lenbits=P.bits,s){B.LI="invalid code lengths set",C.mode=G;break}C.have=0,C.mode=19;case 19:for(;C.have<C.nlen+C.ndist;){for(;X=C.lencode[i&(1<<C.lenbits)-1],E=X>>>24,Q=X>>>16&255,Z=65535&X,!(E<=u);){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}if(Z<16)i>>>=E,u-=E,C.lens[C.have++]=Z;else{if(16===Z){for(h=E+2;u<h;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}if(i>>>=E,u-=E,0===C.have){B.LI="invalid bit length repeat",C.mode=G;break}v=C.lens[C.have-1],W=3+(3&i),i>>>=2,u-=2}else if(17===Z){for(h=E+3;u<h;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}i>>>=E,u-=E,v=0,W=3+(7&i),i>>>=3,u-=3}else{for(h=E+7;u<h;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}i>>>=E,u-=E,v=0,W=11+(127&i),i>>>=7,u-=7}if(C.have+W>C.nlen+C.ndist){B.LI="invalid bit length repeat",C.mode=G;break}for(;W--;)C.lens[C.have++]=v}}if(C.mode===G)break;if(0===C.lens[256]){B.LI="invalid code -- missing end-of-block",C.mode=G;break}if(C.lenbits=9,P={bits:C.lenbits},s=f(1,C.lens,0,C.nlen,C.lencode,0,C.work,P),C.lenbits=P.bits,s){B.LI="invalid literal/lengths set",C.mode=G;break}if(C.distbits=6,C.distcode=C.distdyn,P={bits:C.distbits},s=f(2,C.lens,C.nlen,C.ndist,C.distcode,0,C.work,P),C.distbits=P.bits,s){B.LI="invalid distances set",C.mode=G;break}if(C.mode=20,I===g)break B;case 20:C.mode=21;case 21:if(D>=6&&J>=258){B.next_out=A,B.avail_out=J,B.next_in=r,B.avail_in=D,C.hold=i,C.bits=u,y(B,a),A=B.next_out,t=B.output,J=B.avail_out,r=B.next_in,c=B.input,D=B.avail_in,i=C.hold,u=C.bits,C.mode===U&&(C.back=-1);break}for(C.back=0;X=C.lencode[i&(1<<C.lenbits)-1],E=X>>>24,Q=X>>>16&255,Z=65535&X,!(E<=u);){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}if(Q&&0===(240&Q)){for(z=E,b=Q,Y=Z;X=C.lencode[Y+((i&(1<<z+b)-1)>>z)],E=X>>>24,Q=X>>>16&255,Z=65535&X,!(z+E<=u);){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}i>>>=z,u-=z,C.back+=z}if(i>>>=E,u-=E,C.back+=E,C.length=Z,0===Q){C.mode=26;break}if(32&Q){C.back=-1,C.mode=U;break}if(64&Q){B.LI="invalid literal/length code",C.mode=G;break}C.extra=15&Q,C.mode=22;case 22:if(C.extra){for(h=C.extra;u<h;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}C.length+=i&(1<<C.extra)-1,i>>>=C.extra,u-=C.extra,C.back+=C.extra}C.was=C.length,C.mode=23;case 23:for(;X=C.distcode[i&(1<<C.distbits)-1],E=X>>>24,Q=X>>>16&255,Z=65535&X,!(E<=u);){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}if(0===(240&Q)){for(z=E,b=Q,Y=Z;X=C.distcode[Y+((i&(1<<z+b)-1)>>z)],E=X>>>24,Q=X>>>16&255,Z=65535&X,!(z+E<=u);){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}i>>>=z,u-=z,C.back+=z}if(i>>>=E,u-=E,C.back+=E,64&Q){B.LI="invalid distance code",C.mode=G;break}C.offset=Z,C.extra=15&Q,C.mode=24;case 24:if(C.extra){for(h=C.extra;u<h;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}C.offset+=i&(1<<C.extra)-1,i>>>=C.extra,u-=C.extra,C.back+=C.extra}if(C.offset>C.dmax){B.LI="invalid distance too far back",C.mode=G;break}C.mode=25;case 25:if(0===J)break B;if(W=a-J,C.offset>W){if(W=C.offset-W,W>C.whave&&C.sane){B.LI="invalid distance too far back",C.mode=G;break}W>C.wnext?(W-=C.wnext,d=C.wsize-W):d=C.wnext-W,W>C.length&&(W=C.length),l=C.window}else l=t,d=A-C.offset,W=C.length;W>J&&(W=J),J-=W,C.length-=W;do{t[A++]=l[d++]}while(--W);0===C.length&&(C.mode=21);break;case 26:if(0===J)break B;t[A++]=C.length,J--,C.mode=21;break;case 27:if(C.wrap){for(;u<32;){if(0===D)break B;D--,i|=c[r++]<<u,u+=8}if(a-=J,B.total_out+=a,C.total+=a,a&&(B.adler=C.check=C.flags?x(C.check,t,a,A-a):M(C.check,t,a,A-a)),a=J,(C.flags?i:V(i))!==C.check){B.LI="incorrect data check",C.mode=G;break}i=0,u=0}C.mode=28;case 28:if(C.wrap&&C.flags){for(;u<32;){if(0===D)break B;D--,i+=c[r++]<<u,u+=8}if(i!==(4294967295&C.total)){B.LI="incorrect length check",C.mode=G;break}i=0,u=0}C.mode=29;case 29:s=R;break B;case G:s=k;break B;case 31:return q;default:return F}return B.next_out=A,B.avail_out=J,B.next_in=r,B.avail_in=D,C.hold=i,C.bits=u,(C.wsize||a!==B.avail_out&&C.mode<G&&(C.mode<27||I!==L))&&n(B,B.output,B.next_out,a-B.avail_out)?(C.mode=31,q):(O-=B.avail_in,a-=B.avail_out,B.total_in+=O,B.total_out+=a,C.total+=a,C.wrap&&a&&(B.adler=C.check=C.flags?x(C.check,t,a,B.next_out-a):M(C.check,t,a,B.next_out-a)),B.data_type=C.bits+(C.last?64:0)+(C.mode===U?128:0)+(20===C.mode||15===C.mode?256:0),(0===O&&0===a||I===L)&&s===N&&(s=S),s)},B.exports.inflateEnd=B=>{if(!B||!B.state)return F;let I=B.state;return I.window&&(I.window=null),B.state=null,N},B.exports.inflateGetHeader=(B,I)=>{if(!B||!B.state)return F;const C=B.state;return 0===(2&C.wrap)?F:(C.head=I,I.done=!1,N)},B.exports.inflateSetDictionary=(B,I)=>{const C=I.length;let x,y,f;return B&&B.state?(x=B.state,0!==x.wrap&&11!==x.mode?F:11===x.mode&&(y=1,y=M(y,I,C,0),y!==x.check)?k:(f=n(B,I,C,C),f?(x.mode=31,q):(x.havedict=1,N))):F},B.exports.inflateInfo="pako inflate (from Nodeca project)"},12354:B=>{"use strict";const I=15,C=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),M=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),x=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),y=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);B.exports=(B,f,L,e,g,N,R,H)=>{const F=H.bits;let k,q,S,o,U,G,V=0,c=0,t=0,r=0,A=0,D=0,J=0,i=0,u=0,p=0,n=null,O=0;const a=new Uint16Array(16),W=new Uint16Array(16);let d,l,E,Q=null,Z=0;for(V=0;V<=I;V++)a[V]=0;for(c=0;c<e;c++)a[f[L+c]]++;for(A=F,r=I;r>=1&&0===a[r];r--);if(A>r&&(A=r),0===r)return g[N++]=20971520,g[N++]=20971520,H.bits=1,0;for(t=1;t<r&&0===a[t];t++);for(A<t&&(A=t),i=1,V=1;V<=I;V++)if(i<<=1,i-=a[V],i<0)return-1;if(i>0&&(0===B||1!==r))return-1;for(W[1]=0,V=1;V<I;V++)W[V+1]=W[V]+a[V];for(c=0;c<e;c++)0!==f[L+c]&&(R[W[f[L+c]]++]=c);if(0===B?(n=Q=R,G=19):1===B?(n=C,O-=257,Q=M,Z-=257,G=256):(n=x,Q=y,G=-1),p=0,c=0,V=t,U=N,D=A,J=0,S=-1,u=1<<A,o=u-1,1===B&&u>852||2===B&&u>592)return 1;for(;;){d=V-J,R[c]<G?(l=0,E=R[c]):R[c]>G?(l=Q[Z+R[c]],E=n[O+R[c]]):(l=96,E=0),k=1<<V-J,q=1<<D,t=q;do{q-=k,g[U+(p>>J)+q]=d<<24|l<<16|E}while(0!==q);for(k=1<<V-1;p&k;)k>>=1;if(0!==k?(p&=k-1,p+=k):p=0,c++,0===--a[V]){if(V===r)break;V=f[L+R[c]]}if(V>A&&(p&o)!==S){for(0===J&&(J=A),U+=t,D=V-J,i=1<<D;D+J<r&&(i-=a[D+J],!(i<=0));)D++,i<<=1;if(u+=1<<D,1===B&&u>852||2===B&&u>592)return 1;S=p&o,g[S]=A<<24|D<<16|U-N}}return 0!==p&&(g[U+p]=V-J<<24|64<<16),H.bits=A,0}},12327:B=>{"use strict";B.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12309:B=>{"use strict";function I(B){let I=B.length;for(;--I>=0;)B[I]=0}const C=256,M=286,x=30,y=15,f=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),L=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),g=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),N=new Array(576);I(N);const R=new Array(60);I(R);const H=new Array(512);I(H);const F=new Array(256);I(F);const k=new Array(29);I(k);const q=new Array(x);function S(B,I,C,M,x){this.static_tree=B,this.extra_bits=I,this.extra_base=C,this.elems=M,this.max_length=x,this.has_stree=B&&B.length}let o,U,G;function V(B,I){this.dyn_tree=B,this.max_code=0,this.stat_desc=I}I(q);const c=B=>B<256?H[B]:H[256+(B>>>7)],t=(B,I)=>{B.pending_buf[B.pending++]=255&I,B.pending_buf[B.pending++]=I>>>8&255},r=(B,I,C)=>{B.bi_valid>16-C?(B.bi_buf|=I<<B.bi_valid&65535,t(B,B.bi_buf),B.bi_buf=I>>16-B.bi_valid,B.bi_valid+=C-16):(B.bi_buf|=I<<B.bi_valid&65535,B.bi_valid+=C)},A=(B,I,C)=>{r(B,C[2*I],C[2*I+1])},D=(B,I)=>{let C=0;do{C|=1&B,B>>>=1,C<<=1}while(--I>0);return C>>>1},J=(B,I,C)=>{const M=new Array(16);let x,f,L=0;for(x=1;x<=y;x++)M[x]=L=L+C[x-1]<<1;for(f=0;f<=I;f++){let I=B[2*f+1];0!==I&&(B[2*f]=D(M[I]++,I))}},i=B=>{let I;for(I=0;I<M;I++)B.dyn_ltree[2*I]=0;for(I=0;I<x;I++)B.dyn_dtree[2*I]=0;for(I=0;I<19;I++)B.bl_tree[2*I]=0;B.dyn_ltree[512]=1,B.opt_len=B.static_len=0,B.last_lit=B.matches=0},u=B=>{B.bi_valid>8?t(B,B.bi_buf):B.bi_valid>0&&(B.pending_buf[B.pending++]=B.bi_buf),B.bi_buf=0,B.bi_valid=0},p=(B,I,C,M)=>{const x=2*I,y=2*C;return B[x]<B[y]||B[x]===B[y]&&M[I]<=M[C]},n=(B,I,C)=>{const M=B.heap[C];let x=C<<1;for(;x<=B.heap_len&&(x<B.heap_len&&p(I,B.heap[x+1],B.heap[x],B.depth)&&x++,!p(I,M,B.heap[x],B.depth));)B.heap[C]=B.heap[x],C=x,x<<=1;B.heap[C]=M},O=(B,I,M)=>{let x,y,e,g,N=0;if(0!==B.last_lit)do{x=B.pending_buf[B.d_buf+2*N]<<8|B.pending_buf[B.d_buf+2*N+1],y=B.pending_buf[B.l_buf+N],N++,0===x?A(B,y,I):(e=F[y],A(B,e+C+1,I),g=f[e],0!==g&&(y-=k[e],r(B,y,g)),x--,e=c(x),A(B,e,M),g=L[e],0!==g&&(x-=q[e],r(B,x,g)))}while(N<B.last_lit);A(B,256,I)},a=(B,I)=>{const C=I.dyn_tree,M=I.stat_desc.static_tree,x=I.stat_desc.has_stree,f=I.stat_desc.elems;let L,e,g,N=-1;for(B.heap_len=0,B.heap_max=573,L=0;L<f;L++)0!==C[2*L]?(B.heap[++B.heap_len]=N=L,B.depth[L]=0):C[2*L+1]=0;for(;B.heap_len<2;)g=B.heap[++B.heap_len]=N<2?++N:0,C[2*g]=1,B.depth[g]=0,B.opt_len--,x&&(B.static_len-=M[2*g+1]);for(I.max_code=N,L=B.heap_len>>1;L>=1;L--)n(B,C,L);g=f;do{L=B.heap[1],B.heap[1]=B.heap[B.heap_len--],n(B,C,1),e=B.heap[1],B.heap[--B.heap_max]=L,B.heap[--B.heap_max]=e,C[2*g]=C[2*L]+C[2*e],B.depth[g]=(B.depth[L]>=B.depth[e]?B.depth[L]:B.depth[e])+1,C[2*L+1]=C[2*e+1]=g,B.heap[1]=g++,n(B,C,1)}while(B.heap_len>=2);B.heap[--B.heap_max]=B.heap[1],((B,I)=>{const C=I.dyn_tree,M=I.max_code,x=I.stat_desc.static_tree,f=I.stat_desc.has_stree,L=I.stat_desc.extra_bits,e=I.stat_desc.extra_base,g=I.stat_desc.max_length;let N,R,H,F,k,q,S=0;for(F=0;F<=y;F++)B.bl_count[F]=0;for(C[2*B.heap[B.heap_max]+1]=0,N=B.heap_max+1;N<573;N++)R=B.heap[N],F=C[2*C[2*R+1]+1]+1,F>g&&(F=g,S++),C[2*R+1]=F,R>M||(B.bl_count[F]++,k=0,R>=e&&(k=L[R-e]),q=C[2*R],B.opt_len+=q*(F+k),f&&(B.static_len+=q*(x[2*R+1]+k)));if(0!==S){do{for(F=g-1;0===B.bl_count[F];)F--;B.bl_count[F]--,B.bl_count[F+1]+=2,B.bl_count[g]--,S-=2}while(S>0);for(F=g;0!==F;F--)for(R=B.bl_count[F];0!==R;)H=B.heap[--N],H>M||(C[2*H+1]!==F&&(B.opt_len+=(F-C[2*H+1])*C[2*H],C[2*H+1]=F),R--)}})(B,I),J(C,N,B.bl_count)},W=(B,I,C)=>{let M,x,y=-1,f=I[1],L=0,e=7,g=4;for(0===f&&(e=138,g=3),I[2*(C+1)+1]=65535,M=0;M<=C;M++)x=f,f=I[2*(M+1)+1],++L<e&&x===f||(L<g?B.bl_tree[2*x]+=L:0!==x?(x!==y&&B.bl_tree[2*x]++,B.bl_tree[32]++):L<=10?B.bl_tree[34]++:B.bl_tree[36]++,L=0,y=x,0===f?(e=138,g=3):x===f?(e=6,g=3):(e=7,g=4))},d=(B,I,C)=>{let M,x,y=-1,f=I[1],L=0,e=7,g=4;for(0===f&&(e=138,g=3),M=0;M<=C;M++)if(x=f,f=I[2*(M+1)+1],!(++L<e&&x===f)){if(L<g)do{A(B,x,B.bl_tree)}while(0!==--L);else 0!==x?(x!==y&&(A(B,x,B.bl_tree),L--),A(B,16,B.bl_tree),r(B,L-3,2)):L<=10?(A(B,17,B.bl_tree),r(B,L-3,3)):(A(B,18,B.bl_tree),r(B,L-11,7));L=0,y=x,0===f?(e=138,g=3):x===f?(e=6,g=3):(e=7,g=4)}};let l=!1;const E=(B,I,C,M)=>{r(B,0+(M?1:0),3),((B,I,C,M)=>{u(B),M&&(t(B,C),t(B,~C)),B.pending_buf.set(B.window.subarray(I,I+C),B.pending),B.pending+=C})(B,I,C,!0)};B.exports._tr_init=B=>{l||((()=>{let B,I,C,g,V;const c=new Array(16);for(C=0,g=0;g<28;g++)for(k[g]=C,B=0;B<1<<f[g];B++)F[C++]=g;for(F[C-1]=g,V=0,g=0;g<16;g++)for(q[g]=V,B=0;B<1<<L[g];B++)H[V++]=g;for(V>>=7;g<x;g++)for(q[g]=V<<7,B=0;B<1<<L[g]-7;B++)H[256+V++]=g;for(I=0;I<=y;I++)c[I]=0;for(B=0;B<=143;)N[2*B+1]=8,B++,c[8]++;for(;B<=255;)N[2*B+1]=9,B++,c[9]++;for(;B<=279;)N[2*B+1]=7,B++,c[7]++;for(;B<=287;)N[2*B+1]=8,B++,c[8]++;for(J(N,287,c),B=0;B<x;B++)R[2*B+1]=5,R[2*B]=D(B,5);o=new S(N,f,257,M,y),U=new S(R,L,0,x,y),G=new S(new Array(0),e,0,19,7)})(),l=!0),B.l_desc=new V(B.dyn_ltree,o),B.d_desc=new V(B.dyn_dtree,U),B.bl_desc=new V(B.bl_tree,G),B.bi_buf=0,B.bi_valid=0,i(B)},B.exports._tr_stored_block=E,B.exports._tr_flush_block=(B,I,M,x)=>{let y,f,L=0;B.level>0?(2===B.strm.data_type&&(B.strm.data_type=(B=>{let I,M=4093624447;for(I=0;I<=31;I++,M>>>=1)if(1&M&&0!==B.dyn_ltree[2*I])return 0;if(0!==B.dyn_ltree[18]||0!==B.dyn_ltree[20]||0!==B.dyn_ltree[26])return 1;for(I=32;I<C;I++)if(0!==B.dyn_ltree[2*I])return 1;return 0})(B)),a(B,B.l_desc),a(B,B.d_desc),L=(B=>{let I;for(W(B,B.dyn_ltree,B.l_desc.max_code),W(B,B.dyn_dtree,B.d_desc.max_code),a(B,B.bl_desc),I=18;I>=3&&0===B.bl_tree[2*g[I]+1];I--);return B.opt_len+=3*(I+1)+5+5+4,I})(B),y=B.opt_len+3+7>>>3,f=B.static_len+3+7>>>3,f<=y&&(y=f)):y=f=M+5,M+4<=y&&-1!==I?E(B,I,M,x):4===B.strategy||f===y?(r(B,2+(x?1:0),3),O(B,N,R)):(r(B,4+(x?1:0),3),((B,I,C,M)=>{let x;for(r(B,I-257,5),r(B,C-1,5),r(B,M-4,4),x=0;x<M;x++)r(B,B.bl_tree[2*g[x]+1],3);d(B,B.dyn_ltree,I-1),d(B,B.dyn_dtree,C-1)})(B,B.l_desc.max_code+1,B.d_desc.max_code+1,L+1),O(B,B.dyn_ltree,B.dyn_dtree)),i(B),x&&u(B)},B.exports._tr_tally=(B,I,M)=>(B.pending_buf[B.d_buf+2*B.last_lit]=I>>>8&255,B.pending_buf[B.d_buf+2*B.last_lit+1]=255&I,B.pending_buf[B.l_buf+B.last_lit]=255&M,B.last_lit++,0===I?B.dyn_ltree[2*M]++:(B.matches++,I--,B.dyn_ltree[2*(F[M]+C+1)]++,B.dyn_dtree[2*c(I)]++),B.last_lit===B.lit_bufsize-1),B.exports._tr_align=B=>{r(B,2,3),A(B,256,N),(B=>{16===B.bi_valid?(t(B,B.bi_buf),B.bi_buf=0,B.bi_valid=0):B.bi_valid>=8&&(B.pending_buf[B.pending++]=255&B.bi_buf,B.bi_buf>>=8,B.bi_valid-=8)})(B)}},12340:B=>{"use strict";B.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.LI="",this.state=null,this.data_type=2,this.adler=0}},11969:B=>{function I(B,I,C){for(var M=B.length,x=-1/0,y=1/0,f=0;f<M;f++){var L=(C[0][f]-B[f])/I[f],e=(C[1][f]-B[f])/I[f];if(L>e){var g=L;L=e,e=g}if(e<x||L>y)return 1/0;L>x&&(x=L),e<y&&(y=e)}return x>y?1/0:x}B.exports=function(B,C,M,x){var y=I(C,M,x);if(y===1/0)B=null;else{B=B||[];for(var f=0;f<C.length;f++)B[f]=C[f]+M[f]*y}return B},B.exports.distance=I},13367:(B,I,C)=>{"use strict";C.d(I,{d:()=>f});var M=C(28);const x=M.useLayoutEffect;const y=function(B){var I=(0,M.useRef)(B);return x((function(){I.current=B})),I};var f=function(B){var I=y(B);(0,M.xI)((function(){var B=function(B){var C;if(null!=I.current&&(C=I.current(B)),B.defaultPrevented&&(B.returnValue=""),"string"===typeof C)return B.returnValue=C,C};return window.addEventListener("beforeunload",B),function(){window.removeEventListener("beforeunload",B)}}),[])}},13317:(B,I,C)=>{"use strict";var M=C(13325),x=Array.prototype.concat,y=Array.prototype.slice,f=B.exports=function(B){for(var I=[],C=0,f=B.length;C<f;C++){var L=B[C];M(L)?I=x.call(I,y.call(L)):I.push(L)}return I};f.wrap=function(B){return function(){return B(f(arguments))}}},13325:B=>{B.exports=function(B){return!(!B||"string"===typeof B)&&(B instanceof Array||Array.isArray(B)||B.length>=0&&(B.splice instanceof Function||Object.getOwnPropertyDescriptor(B,B.length-1)&&"String"!==B.constructor.name))}},12241:(B,I,C)=>{var M=C(12249);function x(B){for(var I,C,x=0,y=B.length,f=0;f<B.length;){for(I=B[f],C=0;f<y&&B[f]===I;)++f,++C;x+=M.log2(C)/7|0,x+=M.log2(I>>>0)/7|0,x+=2}return x}I.size=x,I.encode=function(B,I){I||(I=new Uint8Array(x(B)));for(var C,M,y=0,f=I.length,L=0;L<B.length;){for(C=B[L],M=0;L<B.length&&B[L]===C;)++L,++M;for(;y<f&&M>=128;)I[y++]=128+(127&M),M>>>=7;if(y>=f)throw new Error("RLE buffer overflow");for(I[y++]=M,C>>>=0;y<f&&C>=128;)I[y++]=128+(127&C),C>>>=7;if(y>=f)throw new Error("RLE buffer overflow");I[y++]=C}return I},I.decode=function(B,I){for(var C,M,x,y,f=I.length,L=B.length,e=0,g=0;g<L;){for(C=0,M=0;g<L&&B[g]>=128;)C+=(127&B[g++])<<M,M+=7;if(C+=B[g++]<<M,g>=L)throw new Error("RLE buffer underrun");if(e+C>f)throw new Error("Chunk buffer overflow");for(x=0,M=0;g<L&&B[g]>=128;)x+=(127&B[g++])<<M,M+=7;if(g>=L)throw new Error("RLE buffer underrun");for(x+=B[g++]<<M,y=0;y<C;++y)I[e++]=x}return I}},12249:(B,I)=>{"use strict";function C(B){var I=32;return(B&=-B)&&I--,65535&B&&(I-=16),16711935&B&&(I-=8),252645135&B&&(I-=4),858993459&B&&(I-=2),1431655765&B&&(I-=1),I}I.INT_BITS=32,I.INT_MAX=2147483647,I.INT_MIN=-1<<31,I.sign=function(B){return(B>0)-(B<0)},I.abs=function(B){var I=B>>31;return(B^I)-I},I.min=function(B,I){return I^(B^I)&-(B<I)},I.max=function(B,I){return B^(B^I)&-(B<I)},I.isPow2=function(B){return!(B&B-1)&&!!B},I.log2=function(B){var I,C;return I=(B>65535)<<4,I|=C=((B>>>=I)>255)<<3,I|=C=((B>>>=C)>15)<<2,(I|=C=((B>>>=C)>3)<<1)|(B>>>=C)>>1},I.log10=function(B){return B>=1e9?9:B>=1e8?8:B>=1e7?7:B>=1e6?6:B>=1e5?5:B>=1e4?4:B>=1e3?3:B>=100?2:B>=10?1:0},I.popCount=function(B){return 16843009*((B=(858993459&(B-=B>>>1&1431655765))+(B>>>2&858993459))+(B>>>4)&252645135)>>>24},I.countTrailingZeros=C,I.nextPow2=function(B){return B+=0===B,--B,B|=B>>>1,B|=B>>>2,B|=B>>>4,B|=B>>>8,(B|=B>>>16)+1},I.prevPow2=function(B){return B|=B>>>1,B|=B>>>2,B|=B>>>4,B|=B>>>8,(B|=B>>>16)-(B>>>1)},I.parity=function(B){return B^=B>>>16,B^=B>>>8,B^=B>>>4,27030>>>(B&=15)&1};var M=new Array(256);!function(B){for(var I=0;I<256;++I){var C=I,M=I,x=7;for(C>>>=1;C;C>>>=1)M<<=1,M|=1&C,--x;B[I]=M<<x&255}}(M),I.reverse=function(B){return M[255&B]<<24|M[B>>>8&255]<<16|M[B>>>16&255]<<8|M[B>>>24&255]},I.interleave2=function(B,I){return(B=1431655765&((B=858993459&((B=252645135&((B=16711935&((B&=65535)|B<<8))|B<<4))|B<<2))|B<<1))|(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I&=65535)|I<<8))|I<<4))|I<<2))|I<<1))<<1},I.deinterleave2=function(B,I){return(B=65535&((B=16711935&((B=252645135&((B=858993459&((B=B>>>I&1431655765)|B>>>1))|B>>>2))|B>>>4))|B>>>16))<<16>>16},I.interleave3=function(B,I,C){return B=1227133513&((B=3272356035&((B=251719695&((B=4278190335&((B&=1023)|B<<16))|B<<8))|B<<4))|B<<2),(B|=(I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2))<<1)|(C=1227133513&((C=3272356035&((C=251719695&((C=4278190335&((C&=1023)|C<<16))|C<<8))|C<<4))|C<<2))<<2},I.deinterleave3=function(B,I){return(B=1023&((B=4278190335&((B=251719695&((B=3272356035&((B=B>>>I&1227133513)|B>>>2))|B>>>4))|B>>>8))|B>>>16))<<22>>22},I.nextCombination=function(B){var I=B|B-1;return I+1|(~I&-~I)-1>>>C(B)+1}},12283:B=>{"use strict";B.exports=function(B,I,C,M){var x=self||window;try{try{var y;try{y=new x.Blob([B])}catch(g){(y=new(x.BlobBuilder||x.WebKitBlobBuilder||x.MozBlobBuilder||x.MSBlobBuilder)).append(B),y=y.getBlob()}var f=x.URL||x.webkitURL,L=f.createObjectURL(y),e=new x[I](L,C);return f.revokeObjectURL(L),e}catch(g){return new x[I]("data:application/javascript,".concat(encodeURIComponent(B)),C)}}catch(g){if(!M)throw Error("Inline worker is not supported");return new x[I](M,C)}}},11957:(B,I,C)=>{"use strict";function M(B,I,C,M,x){var y={};return Object.keys(M).forEach((function(B){y[B]=M[B]})),y.enumerable=!!y.enumerable,y.configurable=!!y.configurable,("value"in y||y.initializer)&&(y.writable=!0),y=C.slice().reverse().reduce((function(C,M){return M(B,I,C)||C}),y),x&&void 0!==y.initializer&&(y.value=y.initializer?y.initializer.call(x):void 0,y.initializer=void 0),void 0===y.initializer&&(Object.defineProperty(B,I,y),y=null),y}C.d(I,{c:()=>M})},11952:(B,I,C)=>{"use strict";function M(B,I,C,M){C&&Object.defineProperty(B,I,{enumerable:C.enumerable,configurable:C.configurable,writable:C.writable,value:C.initializer?C.initializer.call(M):void 0})}C.d(I,{b:()=>M})},13350:(B,I,C)=>{"use strict";C.d(I,{d:()=>f,g:()=>R,k:()=>L,m:()=>y,q:()=>e,s:()=>x,u:()=>g,v:()=>N});var M=C(11409);class x{constructor(){this._easingMode=x.EASINGMODE_EASEIN}setEasingMode(B){const I=Math.min(Math.max(B,0),2);this._easingMode=I}getEasingMode(){return this._easingMode}easeInCore(B){throw new Error("You must implement this method")}ease(B){switch(this._easingMode){case x.EASINGMODE_EASEIN:return this.easeInCore(B);case x.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-B)}return B>=.5?.5*(1-this.easeInCore(2*(1-B)))+.5:.5*this.easeInCore(2*B)}}x.EASINGMODE_EASEIN=0,x.EASINGMODE_EASEOUT=1,x.EASINGMODE_EASEINOUT=2;class y extends x{easeInCore(B){return B=Math.max(0,Math.min(1,B)),1-Math.sqrt(1-B*B)}}class f extends x{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=B}easeInCore(B){const I=Math.max(0,this.amplitude);return Math.pow(B,3)-B*I*Math.sin(3.141592653589793*B)}}class L extends x{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=B,this.bounciness=I}easeInCore(B){const I=Math.max(0,this.bounces);let C=this.bounciness;C<=1&&(C=1.001);const M=Math.pow(C,I),x=1-C,y=(1-M)/x+.5*M,f=B*y,L=Math.log(-f*(1-C)+1)/Math.log(C),e=Math.floor(L),g=e+1,N=(1-Math.pow(C,e))/(x*y),R=.5*(N+(1-Math.pow(C,g))/(x*y)),H=B-R,F=R-N;return-Math.pow(1/C,I-e)/(F*F)*(H-F)*(H+F)}}class e extends x{easeInCore(B){return B*B*B}}class g extends x{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=B,this.springiness=I}easeInCore(B){let I;const C=Math.max(0,this.oscillations),M=Math.max(0,this.springiness);return I=0==M?B:(Math.exp(M*B)-1)/(Math.exp(M)-1),I*Math.sin((6.283185307179586*C+1.5707963267948966)*B)}}class N extends x{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=B}easeInCore(B){return this.exponent<=0?B:(Math.exp(this.exponent*B)-1)/(Math.exp(this.exponent)-1)}}class R extends x{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=B,this.y1=I,this.x2=C,this.y2=M}easeInCore(B){return M.d.Interpolate(B,this.x1,this.y1,this.x2,this.y2)}}},12808:(B,I,C)=>{"use strict";C.d(I,{e:()=>f});var M=C(11194),x=C(11204),y=C(11621);class f extends y.d{get _matrix(){return this._compose(),this.zH}set _matrix(B){(B.updateFlag!==this.zH.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.zH.M(B),this._markAsDirtyAndDecompose())}constructor(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(B,I.rB(),!1),this.name=B,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=I,this.zH=(null===x||void 0===x?void 0:x.clone())??M.Matrix.Identity(),this._restMatrix=y??this.zH.clone(),this._bindMatrix=f??this.zH.clone(),this._index=L,this._absoluteMatrix=new M.Matrix,this._absoluteBindMatrix=new M.Matrix,this._absoluteInverseBindMatrix=new M.Matrix,this._finalMatrix=new M.Matrix,I.bones.push(this),this.setParent(C,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(B){this.setParent(B)}setParent(B){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==B){if(this.parent){const B=this.parent.children.indexOf(this);-1!==B&&this.parent.children.splice(B,1)}this._parentNode=B,this.parent&&this.parent.children.push(this),I&&this._updateAbsoluteBindMatrices(),this.RN()}}getLocalMatrix(){return this._compose(),this.zH}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(B){this._restMatrix.M(B)}setRestPose(B){this.setRestMatrix(B)}getBindPose(){return this.getBindMatrix()}setBindMatrix(B){this.pf(B)}setBindPose(B){this.setBindMatrix(B)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const B=M.TmpVectors.HI[0],I=M.TmpVectors.Quaternion[0],C=M.TmpVectors.HI[1];this.getRestMatrix().decompose(B,I,C),this._linkedTransformNode.position.M(C),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??M.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.M(I),this._linkedTransformNode.Xf.M(B)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(B){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=B,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.sL}set position(B){this._decompose(),this.sL.M(B),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(B){this.setRotation(B)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(B){this.setRotationQuaternion(B)}get Xf(){return this.getScale()}set Xf(B){this.setScale(B)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=M.HI.Zero(),this._localRotation=M.Quaternion.Zero(),this.sL=M.HI.Zero()),this.zH.decompose(this._localScaling,this._localRotation,this.sL))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,M.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.sL,this.zH)):this._needToCompose=!1)}pf(B){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.M(B),I&&this._updateAbsoluteBindMatrices(),C?this._matrix=B:this.RN()}_updateAbsoluteBindMatrices(B){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(B||(B=this._bindMatrix),this.parent?B.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.M(B),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),I)for(let C=0;C<this.children.length;C++)this.children[C]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}RN(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.RN(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.RN(),this._needToDecompose=!0}_updatePosition(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0,x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const y=this.getLocalMatrix();if(0==I)x?(y.addAtIndex(12,B.x),y.addAtIndex(13,B.y),y.addAtIndex(14,B.z)):y.setTranslationFromFloats(B.x,B.y,B.z);else{let I=null;C&&(I=C.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const L=f._TmpMats[0],e=f._TmpVecs[0];this.parent?C&&I?(L.M(this.parent.getAbsoluteMatrix()),L.multiplyToRef(I,L)):L.M(this.parent.getAbsoluteMatrix()):M.Matrix.IdentityToRef(L),x&&L.setTranslationFromFloats(0,0,0),L.invert(),M.HI.TransformCoordinatesToRef(B,L,e),x?(y.addAtIndex(12,e.x),y.addAtIndex(13,e.y),y.addAtIndex(14,e.z)):y.setTranslationFromFloats(e.x,e.y,e.z)}this._markAsDirtyAndDecompose()}translate(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this._updatePosition(B,I,C,!0)}setPosition(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this._updatePosition(B,I,C,!1)}setAbsolutePosition(B,I){this.setPosition(B,1,I)}scale(B,I,C){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const y=this.getLocalMatrix(),L=f._TmpMats[0];M.Matrix.ScalingToRef(B,I,C,L),L.multiplyToRef(y,y),L.invert();for(const M of this.children){const x=M.getLocalMatrix();x.multiplyToRef(L,x),x.multiplyAtIndex(12,B),x.multiplyAtIndex(13,I),x.multiplyAtIndex(14,C),M._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),x)for(const M of this.children)M.scale(B,I,C,x)}setScale(B){this._decompose(),this._localScaling.M(B),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(B){this._decompose(),B.M(this._localScaling)}setYawPitchRoll(B,I,C){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,y=arguments.length>4?arguments[4]:void 0;if(0===x){const L=f._TmpQuat;return M.Quaternion.RotationYawPitchRollToRef(B,I,C,L),void this.setRotationQuaternion(L,x,y)}const L=f._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(L,y))return;const e=f._TmpMats[1];M.Matrix.RotationYawPitchRollToRef(B,I,C,e),L.multiplyToRef(e,e),this._rotateWithMatrix(e,x,y)}rotate(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3?arguments[3]:void 0;const y=f._TmpMats[0];y.setTranslationFromFloats(0,0,0),M.Matrix.RotationAxisToRef(B,I,y),this._rotateWithMatrix(y,C,x)}setAxisAngle(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3?arguments[3]:void 0;if(0===C){const y=f._TmpQuat;return M.Quaternion.RotationAxisToRef(B,I,y),void this.setRotationQuaternion(y,C,x)}const y=f._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(y,x))return;const L=f._TmpMats[1];M.Matrix.RotationAxisToRef(B,I,L),y.multiplyToRef(L,L),this._rotateWithMatrix(L,C,x)}setRotation(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(B.y,B.x,B.z,I,C)}setRotationQuaternion(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;if(0===I)return this._decompose(),this._localRotation.M(B),void this._markAsDirtyAndCompose();const x=f._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(x,C))return;const y=f._TmpMats[1];M.Matrix.FromQuaternionToRef(B,y),x.multiplyToRef(y,y),this._rotateWithMatrix(y,I,C)}setRotationMatrix(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;if(0===I){const x=f._TmpQuat;return M.Quaternion.FromRotationMatrixToRef(B,x),void this.setRotationQuaternion(x,I,C)}const x=f._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(x,C))return;const y=f._TmpMats[1];y.M(B),x.multiplyToRef(B,y),this._rotateWithMatrix(y,I,C)}_rotateWithMatrix(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;const M=this.getLocalMatrix(),x=M.m[12],y=M.m[13],L=M.m[14],e=this.getParent(),g=f._TmpMats[3],N=f._TmpMats[4];e&&1==I?(C?(g.M(C.getWorldMatrix()),e.getAbsoluteMatrix().multiplyToRef(g,g)):g.M(e.getAbsoluteMatrix()),N.M(g),N.invert(),M.multiplyToRef(g,M),M.multiplyToRef(B,M),M.multiplyToRef(N,M)):1==I&&C?(g.M(C.getWorldMatrix()),N.M(g),N.invert(),M.multiplyToRef(g,M),M.multiplyToRef(B,M),M.multiplyToRef(N,M)):M.multiplyToRef(B,M),M.setTranslationFromFloats(x,y,L),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(B,I){const C=f._TmpMats[2];return B.M(this.getAbsoluteMatrix()),I?(B.multiplyToRef(I.getWorldMatrix(),B),M.Matrix.ScalingToRef(I.Xf.x,I.Xf.y,I.Xf.z,C)):M.Matrix.IdentityToRef(C),B.invert(),!isNaN(B.m[0])&&(C.multiplyAtIndex(0,this._scalingDeterminant),B.multiplyToRef(C,B),!0)}DM(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=M.HI.Zero();return this.getPositionToRef(B,I,C),C}getPositionToRef(){let B=arguments.length>1?arguments[1]:void 0,I=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const B=this.getLocalMatrix();I.x=B.m[12],I.y=B.m[13],I.z=B.m[14]}else{let C=null;B&&(C=B.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let M=f._TmpMats[0];B&&C?(M.M(this.getAbsoluteMatrix()),M.multiplyToRef(C,M)):M=this.getAbsoluteMatrix(),I.x=M.m[12],I.y=M.m[13],I.z=M.m[14]}}getAbsolutePosition(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const I=M.HI.Zero();return this.getPositionToRef(1,B,I),I}getAbsolutePositionToRef(B,I){this.getPositionToRef(1,B,I)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.zH.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.M(this.zH);const B=this._skeleton.getPoseMatrix();B&&this._absoluteMatrix.multiplyToRef(B,this._absoluteMatrix)}const B=this.children,I=B.length;for(let C=0;C<I;C++)B[C].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Je(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=M.HI.Zero();return this.getDirectionToRef(B,I,C),C}getDirectionToRef(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,x=null;I&&(x=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const y=f._TmpMats[0];y.M(this.getAbsoluteMatrix()),I&&x&&y.multiplyToRef(x,y),M.HI.TransformNormalToRef(B,y,C),C.normalize()}getRotation(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=M.HI.Zero();return this.getRotationToRef(B,I,C),C}getRotationToRef(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0;const M=f._TmpQuat;this.getRotationQuaternionToRef(B,I,M),M.toEulerAnglesToRef(C)}getRotationQuaternion(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=M.Quaternion.Identity();return this.getRotationQuaternionToRef(B,I,C),C}getRotationQuaternionToRef(){let B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,I=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),I.M(this._localRotation);else{const C=f._TmpMats[0],M=this.getAbsoluteMatrix();B?M.multiplyToRef(B.getWorldMatrix(),C):C.M(M),C.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyAtIndex(1,this._scalingDeterminant),C.multiplyAtIndex(2,this._scalingDeterminant),C.decompose(void 0,I,void 0)}}getRotationMatrix(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1?arguments[1]:void 0;const C=M.Matrix.Identity();return this.getRotationMatrixToRef(B,I,C),C}getRotationMatrixToRef(){let B=arguments.length>1?arguments[1]:void 0,I=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(I);else{const C=f._TmpMats[0],M=this.getAbsoluteMatrix();B?M.multiplyToRef(B.getWorldMatrix(),C):C.M(M),C.multiplyAtIndex(0,this._scalingDeterminant),C.multiplyAtIndex(1,this._scalingDeterminant),C.multiplyAtIndex(2,this._scalingDeterminant),C.getRotationMatrixToRef(I)}}getAbsolutePositionFromLocal(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=M.HI.Zero();return this.getAbsolutePositionFromLocalToRef(B,I,C),C}getAbsolutePositionFromLocalToRef(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,x=null;I&&(x=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const y=f._TmpMats[0];y.M(this.getAbsoluteMatrix()),I&&x&&y.multiplyToRef(x,y),M.HI.TransformCoordinatesToRef(B,y,C)}getLocalPositionFromAbsolute(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=M.HI.Zero();return this.getLocalPositionFromAbsoluteToRef(B,I,C),C}getLocalPositionFromAbsoluteToRef(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2?arguments[2]:void 0,x=null;I&&(x=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const y=f._TmpMats[0];y.M(this.getAbsoluteMatrix()),I&&x&&y.multiplyToRef(x,y),y.invert(),M.HI.TransformCoordinatesToRef(B,y,C)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const B=this._skeleton.bones.indexOf(this);if(-1!==B&&this._skeleton.bones.splice(B,1),this._parentNode&&this._parentNode.children){const B=this._parentNode.children,I=B.indexOf(this);-1!==I&&B.splice(I,1)}super.dispose()}}f._TmpVecs=(0,x.b)(2,M.HI.Zero),f._TmpQuat=M.Quaternion.Identity(),f._TmpMats=(0,x.b)(5,M.Matrix.Identity)},13347:(B,I,C)=>{"use strict";C.d(I,{b:()=>a});var M=C(11180),x=C(11186),y=C(11022),f=C(11194),L=C(11212),e=C(11621),g=C(11645),N=C(11479),R=C(11034),H=C(11197);class F{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(B){this._zoomStopsAnimation=B}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(B){this._idleRotationSpeed=B}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(B){this._idleRotationWaitTime=B}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(B){this._idleRotationSpinupTime=B}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(B){this._attachedCamera=B;const I=this._attachedCamera.rB();this._onPrePointerObservableObserver=I.onPrePointerObservable.add((B=>{B.type!==N.c.POINTERDOWN?B.type===N.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=B.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const B=R.c.Now;let I=0;null!=this._lastFrameTime&&(I=B-this._lastFrameTime),this._lastFrameTime=B,this._applyUserInteraction();const C=B-this._lastInteractionTime-this._idleRotationWaitTime,M=Math.max(Math.min(C/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*M,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(I/1e3))}))}detach(){if(!this._attachedCamera)return;const B=this._attachedCamera.rB();this._onPrePointerObservableObserver&&B.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(B){this._lastInteractionTime=B??R.c.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<H.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let B=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(B=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?B:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=R.c.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var k=C(13350),q=C(11708);class S{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(B){if(this._autoTransitionRange===B)return;this._autoTransitionRange=B;const I=this._attachedCamera;I&&(B?this._onMeshTargetChangedObserver=I.onMeshTargetChangedObservable.add((B=>{if(B&&(B.nf(!0),B.getBoundingInfo)){const I=B.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*I,this.upperRadiusTransitionRange=.05*I}})):this._onMeshTargetChangedObserver&&I.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(B){this._attachedCamera=B,this._onAfterCheckInputsObserver=B.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(B){return!!this._attachedCamera&&(this._attachedCamera.radius===B&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(B){if(!this._attachedCamera)return;this._radiusBounceTransition||(S.EasingFunction.setEasingMode(S.EasingMode),this._radiusBounceTransition=q.c.CreateAnimation("radius",q.c.ANIMATIONTYPE_FLOAT,60,S.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const I=q.c.TransitionTo("radius",this._attachedCamera.radius+B,this._attachedCamera,this._attachedCamera.rB(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));I&&this._animatables.push(I)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}S.EasingFunction=new k.d(.3),S.EasingMode=k.s.EASINGMODE_EASEOUT;class o{constructor(){this.onTargetFramingAnimationEndObservable=new y.e,this._mode=o.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(B){this._mode=B}get mode(){return this._mode}set radiusScale(B){this._radiusScale=B}get radiusScale(){return this._radiusScale}set positionScale(B){this._positionScale=B}get positionScale(){return this._positionScale}set defaultElevation(B){this._defaultElevation=B}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(B){this._elevationReturnTime=B}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(B){this._elevationReturnWaitTime=B}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(B){this._zoomStopsAnimation=B}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(B){this._framingTime=B}get framingTime(){return this._framingTime}init(){}attach(B){this._attachedCamera=B;const I=this._attachedCamera.rB();o.EasingFunction.setEasingMode(o.EasingMode),this._onPrePointerObservableObserver=I.onPrePointerObservable.add((B=>{B.type!==N.c.POINTERDOWN?B.type===N.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=B.onMeshTargetChangedObservable.add((B=>{B&&B.getBoundingInfo&&this.zoomOnMesh(B,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=B.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const B=this._attachedCamera.rB();this._onPrePointerObservableObserver&&B.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(B){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;B.nf(!0);const M=B.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(M.minimumWorld,M.maximumWorld,I,C)}zoomOnMeshHierarchy(B){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;B.nf(!0);const M=B.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(M.min,M.max,I,C)}zoomOnMeshesHierarchy(B){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new f.HI(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),x=new f.HI(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let y=0;y<B.length;y++){const I=B[y].getHierarchyBoundingVectors(!0);f.HI.CheckExtends(I.min,M,x),f.HI.CheckExtends(I.max,M,x)}this.zoomOnBoundingInfo(M,x,I,C)}zoomOnBoundingInfo(B,I){let C,M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const y=B.y,L=y+(I.y-y)*this._positionScale,e=I.FI(B).scale(.5);if(!isFinite(L))return!1;if(M)C=new f.HI(0,L,0);else{const I=B.add(e);C=new f.HI(I.x,L,I.z)}this._vectorTransition||(this._vectorTransition=q.c.CreateAnimation("target",q.c.ANIMATIONTYPE_VECTOR3,60,o.EasingFunction)),this._betaIsAnimating=!0;let g=q.c.TransitionTo("target",C,this._attachedCamera,this._attachedCamera.rB(),60,this._vectorTransition,this._framingTime);g&&this._animatables.push(g);let N=0;if(this._mode===o.FitFrustumSidesMode){const C=this._calculateLowerRadiusFromModelBoundingSphere(B,I);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=e.length()+this._attachedCamera.uf),N=C}else this._mode===o.IgnoreBoundsSizeMode&&(N=this._calculateLowerRadiusFromModelBoundingSphere(B,I),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.uf));if(this.autoCorrectCameraLimitsAndSensibility){const C=I.FI(B).length();this._attachedCamera.panningSensibility=5e3/C,this._attachedCamera.wheelPrecision=100/N}return this._radiusTransition||(this._radiusTransition=q.c.CreateAnimation("radius",q.c.ANIMATIONTYPE_FLOAT,60,o.EasingFunction)),g=q.c.TransitionTo("radius",N,this._attachedCamera,this._attachedCamera.rB(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),x&&x(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),g&&this._animatables.push(g),!0}_calculateLowerRadiusFromModelBoundingSphere(B,I){const C=this._attachedCamera;if(!C)return 0;let M=C._calculateLowerRadiusFromModelBoundingSphere(B,I,this._radiusScale);return C.lowerRadiusLimit&&this._mode===o.IgnoreBoundsSizeMode&&(M=M<C.lowerRadiusLimit?C.lowerRadiusLimit:M),C.upperRadiusLimit&&(M=M>C.upperRadiusLimit?C.upperRadiusLimit:M),M}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const B=R.c.Now-this._lastInteractionTime,I=.5*Math.PI-this._defaultElevation,C=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>C&&B>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=q.c.CreateAnimation("beta",q.c.ANIMATIONTYPE_FLOAT,60,o.EasingFunction));const B=q.c.TransitionTo("beta",I,this._attachedCamera,this._attachedCamera.rB(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));B&&this._animatables.push(B)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=R.c.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}o.EasingFunction=new k.v,o.EasingMode=k.s.EASINGMODE_EASEINOUT,o.IgnoreBoundsSizeMode=0,o.FitFrustumSidesMode=1;var U=C(11647),G=C(11671),V=C(12802),c=C(11018);class t{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(B){B=c.Tools.BackCompatCameraNoPreventDefault(arguments);const I=this.camera.getEngine(),C=I.getInputElement();let M=0,x=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=y=>{var f,L;const e=y.event,g="touch"===e.pointerType;if(y.type!==N.c.POINTERMOVE&&-1===this.buttons.indexOf(e.button))return;const R=e.target;if(this._altKey=e.altKey,this._ctrlKey=e.ctrlKey,this._metaKey=e.metaKey,this._shiftKey=e.shiftKey,this._buttonsPressed=e.buttons,I.isPointerLock){const B=e.movementX,I=e.movementY;this.onTouch(null,B,I),this._pointA=null,this._pointB=null}else{if(y.type!==N.c.POINTERDOWN&&y.type!==N.c.POINTERDOUBLETAP&&g&&(null===(f=this._pointA)||void 0===f?void 0:f.pointerId)!==e.pointerId&&(null===(L=this._pointB)||void 0===L?void 0:L.pointerId)!==e.pointerId)return;if(y.type!==N.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!g)if(y.type===N.c.POINTERDOUBLETAP)this.onDoubleTap(e.pointerType);else if(y.type!==N.c.POINTERUP||this._currentMousePointerIdDown!==e.pointerId&&!g){if(y.type===N.c.POINTERMOVE)if(B||e.preventDefault(),this._pointA&&null===this._pointB){const B=e.clientX-this._pointA.x,I=e.clientY-this._pointA.y;this._pointA.x=e.clientX,this._pointA.y=e.clientY,this.onTouch(this._pointA,B,I)}else if(this._pointA&&this._pointB){const B=this._pointA.pointerId===e.pointerId?this._pointA:this._pointB;B.x=e.clientX,B.y=e.clientY;const I=this._pointA.x-this._pointB.x,C=this._pointA.y-this._pointB.y,f=I*I+C*C,L={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:e.pointerId,type:y.type};this.onMultiTouch(this._pointA,this._pointB,M,f,x,L),x=L,M=f}}else{try{null===R||void 0===R||R.releasePointerCapture(e.pointerId)}catch(H){}g||(this._pointB=null),I._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==e.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==e.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==M||x)&&(this.onMultiTouch(this._pointA,this._pointB,M,0,x,null),M=0,x=null),this._currentMousePointerIdDown=-1,this.onButtonUp(e),B||e.preventDefault()}else{try{null===R||void 0===R||R.setPointerCapture(e.pointerId)}catch(H){}if(null===this._pointA)this._pointA={x:e.clientX,y:e.clientY,pointerId:e.pointerId,type:e.pointerType};else{if(null!==this._pointB)return;this._pointB={x:e.clientX,y:e.clientY,pointerId:e.pointerId,type:e.pointerType}}-1!==this._currentMousePointerIdDown||g||(this._currentMousePointerIdDown=e.pointerId),this.onButtonDown(e),B||(e.preventDefault(),C&&C.focus())}}},this._observer=this.camera.rB()._inputManager._addCameraPointerObserver(this._pointerInput,N.c.POINTERDOWN|N.c.POINTERUP|N.c.POINTERMOVE|N.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,M=0,x=null,this.onLostFocus()},this._contextMenuBind=B=>this.onContextMenu(B),C&&C.addEventListener("contextmenu",this._contextMenuBind,!1);const y=this.camera.rB().getEngine().getHostWindow();y&&c.Tools.RegisterTopRootEvents(y,[{name:"blur",handler:this._onLostFocus}])}KR(){if(this._onLostFocus){const B=this.camera.rB().getEngine().getHostWindow();B&&c.Tools.UnregisterTopRootEvents(B,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.rB()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const B=this.camera.rB().getEngine().getInputElement();B&&B.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(B){}onTouch(B,I,C){}onMultiTouch(B,I,C,M,x,y){}onContextMenu(B){B.preventDefault()}onButtonDown(B){}onButtonUp(B){}onLostFocus(){}}(0,M.e)([(0,x.K)()],t.prototype,"buttons",void 0);class r extends t{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(B,I){if(0!==this.panningSensibility&&B&&I){const C=I.x-B.x,M=I.y-B.y;this.camera.inertialPanningX+=-C/this.panningSensibility,this.camera.inertialPanningY+=M/this.panningSensibility}}_computePinchZoom(B,I){const C=this.camera.radius||r.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=C*Math.sqrt(B)/Math.sqrt(I):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(I-B)*C*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(I-B)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(B,I,C){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-I/this.panningSensibility,this.camera.inertialPanningY+=C/this.panningSensibility):(this.camera.inertialAlphaOffset-=I/this.angularSensibilityX,this.camera.inertialBetaOffset-=C/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(B,I,C,M,x,y){0===C&&null===x||0===M&&null===y||(this.multiTouchPanAndZoom?(this._computePinchZoom(C,M),this._computeMultiTouchPanning(x,y)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(M)-Math.sqrt(C))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(C,M),this._isPinching=!0):this._computeMultiTouchPanning(x,y)):this.multiTouchPanning?this._computeMultiTouchPanning(x,y):this.pinchZoom&&this._computePinchZoom(C,M))}onButtonDown(B){this._isPanClick=B.button===this.camera._panningMouseButton}onButtonUp(B){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}r.MinimumRadiusForPinch=.001,(0,M.e)([(0,x.K)()],r.prototype,"buttons",void 0),(0,M.e)([(0,x.K)()],r.prototype,"angularSensibilityX",void 0),(0,M.e)([(0,x.K)()],r.prototype,"angularSensibilityY",void 0),(0,M.e)([(0,x.K)()],r.prototype,"pinchPrecision",void 0),(0,M.e)([(0,x.K)()],r.prototype,"pinchDeltaPercentage",void 0),(0,M.e)([(0,x.K)()],r.prototype,"useNaturalPinchZoom",void 0),(0,M.e)([(0,x.K)()],r.prototype,"pinchZoom",void 0),(0,M.e)([(0,x.K)()],r.prototype,"panningSensibility",void 0),(0,M.e)([(0,x.K)()],r.prototype,"multiTouchPanning",void 0),(0,M.e)([(0,x.K)()],r.prototype,"multiTouchPanAndZoom",void 0),V.d.ArcRotateCameraPointersInput=r;var A=C(11484);class D{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(B){B=c.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.rB(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((I=>{const C=I.event;if(!C.metaKey)if(I.type===A.d.KEYDOWN){if(this._ctrlPressed=C.ctrlKey,this._altPressed=C.altKey,-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysReset.indexOf(C.keyCode)){-1===this._keys.indexOf(C.keyCode)&&this._keys.push(C.keyCode),C.preventDefault&&(B||C.preventDefault())}}else if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysReset.indexOf(C.keyCode)){const I=this._keys.indexOf(C.keyCode);I>=0&&this._keys.splice(I,1),C.preventDefault&&(B||C.preventDefault())}})))}KR(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const B=this.camera;for(let I=0;I<this._keys.length;I++){const C=this._keys[I];-1!==this.keysLeft.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?B.inertialPanningX-=1/this.panningSensibility:B.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?B.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?B.inertialRadiusOffset+=1/this.zoomingSensibility:B.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?B.inertialPanningX+=1/this.panningSensibility:B.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(C)?this._ctrlPressed&&this.camera._useCtrlForPanning?B.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?B.inertialRadiusOffset-=1/this.zoomingSensibility:B.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(C)&&B.useInputToRestoreState&&B.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,M.e)([(0,x.K)()],D.prototype,"keysUp",void 0),(0,M.e)([(0,x.K)()],D.prototype,"keysDown",void 0),(0,M.e)([(0,x.K)()],D.prototype,"keysLeft",void 0),(0,M.e)([(0,x.K)()],D.prototype,"keysRight",void 0),(0,M.e)([(0,x.K)()],D.prototype,"keysReset",void 0),(0,M.e)([(0,x.K)()],D.prototype,"panningSensibility",void 0),(0,M.e)([(0,x.K)()],D.prototype,"zoomingSensibility",void 0),(0,M.e)([(0,x.K)()],D.prototype,"useAltToZoom",void 0),(0,M.e)([(0,x.K)()],D.prototype,"angularSpeed",void 0),V.d.ArcRotateCameraKeyboardMoveInput=D;var J=C(11242),i=C(11490);class u{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new f.HI(0,0,0),this._globalOffset=new f.HI(0,0,0),this._inertialPanning=f.HI.Zero()}_computeDeltaFromMouseWheelLegacyEvent(B,I){let C=0;const M=.01*B*this.wheelDeltaPercentage*I;return C=B>0?M/(1+this.wheelDeltaPercentage):M*(1+this.wheelDeltaPercentage),C}attachControl(B){B=c.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=I=>{if(I.type!==N.c.POINTERWHEEL)return;const C=I.event;let M=0;const x=C.deltaMode===i.d.DOM_DELTA_LINE?40:1,y=-C.deltaY*x;if(this.customComputeDeltaFromMouseWheel)M=this.customComputeDeltaFromMouseWheel(y,this,C);else if(this.wheelDeltaPercentage){if(M=this._computeDeltaFromMouseWheelLegacyEvent(y,this.camera.radius),M>0){let B=this.camera.radius,I=this.camera.inertialRadiusOffset+M;for(let C=0;C<20&&!(B<=I)&&!(Math.abs(I*this.camera.inertia)<.001);C++)B-=I,I*=this.camera.inertia;B=(0,L.Clamp)(B,0,Number.MAX_VALUE),M=this._computeDeltaFromMouseWheelLegacyEvent(y,B)}}else M=y/(40*this.wheelPrecision);M&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(M)):this.camera.inertialRadiusOffset+=M),C.preventDefault&&(B||C.preventDefault())},this._observer=this.camera.rB()._inputManager._addCameraPointerObserver(this._wheel,N.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Tf(0)}KR(){this._observer&&(this.camera.rB()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const B=this.camera;0+B.inertialAlphaOffset+B.inertialBetaOffset+B.inertialRadiusOffset&&(this._updateHitPlane(),B.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(B.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const B=this.camera,I=B.target.FI(B.position);this._hitPlane=J.d.FromPositionAndNormal(B.target,I)}_getPosition(){const B=this.camera,I=B.rB(),C=I.createPickingRay(I.pointerX,I.pointerY,f.Matrix.Identity(),B,!1);0===B.targetScreenOffset.x&&0===B.targetScreenOffset.y||(this._viewOffset.set(B.targetScreenOffset.x,B.targetScreenOffset.y,0),B.getViewMatrix().invertToRef(B._cameraTransformMatrix),this._globalOffset=f.HI.TransformNormal(this._viewOffset,B._cameraTransformMatrix),C.origin.addInPlace(this._globalOffset));let M=0;return this._hitPlane&&(M=C.intersectsPlane(this._hitPlane)??0),C.origin.addInPlace(C.direction.scaleInPlace(M))}_zoomToMouse(B){const I=this.camera,C=1-I.inertia;if(I.lowerRadiusLimit){const M=I.lowerRadiusLimit??0;I.radius-(I.inertialRadiusOffset+B)/C<M&&(B=(I.radius-M)*C-I.inertialRadiusOffset)}if(I.upperRadiusLimit){const M=I.upperRadiusLimit??0;I.radius-(I.inertialRadiusOffset+B)/C>M&&(B=(I.radius-M)*C-I.inertialRadiusOffset)}const M=B/C/I.radius,x=this._getPosition(),y=f.TmpVectors.HI[6];x.subtractToRef(I.target,y),y.scaleInPlace(M),y.scaleInPlace(C),this._inertialPanning.addInPlace(y),I.inertialRadiusOffset+=B}_zeroIfClose(B){Math.abs(B.x)<H.d&&(B.x=0),Math.abs(B.y)<H.d&&(B.y=0),Math.abs(B.z)<H.d&&(B.z=0)}}(0,M.e)([(0,x.K)()],u.prototype,"wheelPrecision",void 0),(0,M.e)([(0,x.K)()],u.prototype,"zoomToMouseLocation",void 0),(0,M.e)([(0,x.K)()],u.prototype,"wheelDeltaPercentage",void 0),V.d.ArcRotateCameraMouseWheelInput=u;class p extends V.h{constructor(B){super(B)}addMouseWheel(){return this.add(new u),this}addPointers(){return this.add(new r),this}addKeyboard(){return this.add(new D),this}}var n=C(11149);function O(B,I){return isNaN(B)?I:B}e.d.AddNodeConstructor("ArcRotateCamera",((B,I)=>()=>new a(B,0,0,1,f.HI.Zero(),I)));class a extends G.e{get target(){return this._target}set target(B){this.setTarget(B)}get targetHost(){return this._targetHost}set targetHost(B){B&&this.setTarget(B)}getTarget(){return this.target}get position(){return this._position}set position(B){this.setPosition(B)}set upVector(B){this._upToYMatrix||(this._yToUpMatrix=new f.Matrix,this._upToYMatrix=new f.Matrix,this._upVector=f.HI.Zero()),B.normalize(),this._upVector.M(B),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){f.Matrix.RotationAlignToRef(f.HI.UpReadOnly,this._upVector,this._yToUpMatrix),f.Matrix.RotationAlignToRef(this._upVector,f.HI.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const B=this.inputs.attached.pointers;return B?B.angularSensibilityX:0}set angularSensibilityX(B){const I=this.inputs.attached.pointers;I&&(I.angularSensibilityX=B)}get angularSensibilityY(){const B=this.inputs.attached.pointers;return B?B.angularSensibilityY:0}set angularSensibilityY(B){const I=this.inputs.attached.pointers;I&&(I.angularSensibilityY=B)}get pinchPrecision(){const B=this.inputs.attached.pointers;return B?B.pinchPrecision:0}set pinchPrecision(B){const I=this.inputs.attached.pointers;I&&(I.pinchPrecision=B)}get pinchDeltaPercentage(){const B=this.inputs.attached.pointers;return B?B.pinchDeltaPercentage:0}set pinchDeltaPercentage(B){const I=this.inputs.attached.pointers;I&&(I.pinchDeltaPercentage=B)}get useNaturalPinchZoom(){const B=this.inputs.attached.pointers;return!!B&&B.useNaturalPinchZoom}set useNaturalPinchZoom(B){const I=this.inputs.attached.pointers;I&&(I.useNaturalPinchZoom=B)}get panningSensibility(){const B=this.inputs.attached.pointers;return B?B.panningSensibility:0}set panningSensibility(B){const I=this.inputs.attached.pointers;I&&(I.panningSensibility=B)}get keysUp(){const B=this.inputs.attached.keyboard;return B?B.keysUp:[]}set keysUp(B){const I=this.inputs.attached.keyboard;I&&(I.keysUp=B)}get keysDown(){const B=this.inputs.attached.keyboard;return B?B.keysDown:[]}set keysDown(B){const I=this.inputs.attached.keyboard;I&&(I.keysDown=B)}get keysLeft(){const B=this.inputs.attached.keyboard;return B?B.keysLeft:[]}set keysLeft(B){const I=this.inputs.attached.keyboard;I&&(I.keysLeft=B)}get keysRight(){const B=this.inputs.attached.keyboard;return B?B.keysRight:[]}set keysRight(B){const I=this.inputs.attached.keyboard;I&&(I.keysRight=B)}get wheelPrecision(){const B=this.inputs.attached.mousewheel;return B?B.wheelPrecision:0}set wheelPrecision(B){const I=this.inputs.attached.mousewheel;I&&(I.wheelPrecision=B)}get zoomToMouseLocation(){const B=this.inputs.attached.mousewheel;return!!B&&B.zoomToMouseLocation}set zoomToMouseLocation(B){const I=this.inputs.attached.mousewheel;I&&(I.zoomToMouseLocation=B)}get wheelDeltaPercentage(){const B=this.inputs.attached.mousewheel;return B?B.wheelDeltaPercentage:0}set wheelDeltaPercentage(B){const I=this.inputs.attached.mousewheel;I&&(I.wheelDeltaPercentage=B)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(B){B!==this.useBouncingBehavior&&(B?(this._bouncingBehavior=new S,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(B){B!==this.useFramingBehavior&&(B?(this._framingBehavior=new o,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(B){B!==this.useAutoRotationBehavior&&(B?(this._autoRotationBehavior=new F,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(B,I,C,M,x,L){var e;let g=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(B,f.HI.Zero(),L,g),e=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=f.HI.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=f.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new f.Matrix,this.panningAxis=new f.HI(1,1,0),this._transformedDirection=new f.HI,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new y.e,this.checkCollisions=!1,this.collisionRadius=new f.HI(.5,.5,.5),this._previousPosition=f.HI.Zero(),this._collisionVelocity=f.HI.Zero(),this._newPosition=f.HI.Zero(),this._computationVector=f.HI.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new f.HI(NaN,NaN,NaN),this._goalTargetScreenOffset=new f.Vector2(NaN,NaN),this._onCollisionPositionChange=function(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C?(e.setPosition(I),e.aF&&e.aF(C)):e._previousPosition.M(e._position);const M=Math.cos(e.alpha),x=Math.sin(e.alpha),y=Math.cos(e.beta);let f=Math.sin(e.beta);0===f&&(f=1e-4);const L=e._getTargetPosition();e._computationVector.vf(e.radius*M*f,e.radius*y,e.radius*x*f),L.addToRef(e._computationVector,e._newPosition),e._position.M(e._newPosition);let g=e.upVector;e.allowUpsideDown&&e.beta<0&&(g=g.clone(),g=g.negate()),e._computeViewMatrix(e._position,L,g),e._viewMatrix.addAtIndex(12,e.targetScreenOffset.x),e._viewMatrix.addAtIndex(13,e.targetScreenOffset.y),e._collisionTriggered=!1},this._target=f.HI.Zero(),x&&this.setTarget(x),this.alpha=I,this.beta=C,this.radius=M,this.getViewMatrix(),this.inputs=new p(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new f.HI(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=f.Vector2.Zero()}_updateCache(B){B||super._updateCache(),this._cache._target.M(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.M(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const B=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?B.addToRef(this._targetBoundingCenter,this._target):this._target.M(B)}const B=this._getLockedTargetPosition();return B||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>H.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,y=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=y?this._currentInterpolationFactor=y:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=O(B,this._goalAlpha),this._goalBeta=O(I,this._goalBeta),this._goalRadius=O(C,this._goalRadius),this._goalTarget.set(O(M.x,this._goalTarget.x),O(M.y,this._goalTarget.y),O(M.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(O(x.x,this._goalTargetScreenOffset.x),O(x.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,L.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,L.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,L.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,L.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(B,I){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const x=arguments;I=c.Tools.BackCompatCameraNoPreventDefault(x),this._useCtrlForPanning=C,this._panningMouseButton=M,"boolean"===typeof x[0]&&(x.length>1&&(this._useCtrlForPanning=x[1]),x.length>2&&(this._panningMouseButton=x[2])),this.inputs.attachElement(I),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}KR(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let B=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){B=!0;const I=this.invertRotation?-1:1,C=this._calculateHandednessMultiplier();let M=this.inertialAlphaOffset*C;this.beta<0&&(M*=-1),this.alpha+=M*I,this.beta+=this.inertialBetaOffset*I,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<H.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<H.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*H.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){B=!0;const I=new f.HI(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),I.multiplyInPlace(this.panningAxis),f.HI.TransformNormalToRef(I,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const B=this.upVector,I=f.HI.CrossToRef(this._transformedDirection,B,this._transformedDirection);f.HI.CrossToRef(B,I,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);f.HI.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.M(this._transformedDirection)}else{if(this.parent){const B=f.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(B),B.transposeToRef(B),f.HI.TransformCoordinatesToRef(this._transformedDirection,B,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*H.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*H.d&&(this.inertialPanningY=0)}if(B)this.stopInterpolation();else if(this._isInterpolating){let B=!1;const I=this._scene.getEngine().getDeltaTime()/1e3,C=1-Math.pow(2,-I/this._currentInterpolationFactor),M=O(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const I=f.TmpVectors.HI[0].set(O(this._goalTarget.x,this._target.x),O(this._goalTarget.y,this._target.y),O(this._goalTarget.z,this._target.z));f.HI.LerpToRef(this.target,I,C,this._target),10*f.HI.Distance(this.target,I)/M<H.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.M(I),this.setTarget(this.target,!1,!0,!0)):B=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const I=f.Quaternion.RotationAlphaBetaGammaToRef(O(this._goalAlpha,this.alpha),O(this._goalBeta,this.beta),0,f.TmpVectors.Quaternion[0]),M=f.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,f.TmpVectors.Quaternion[1]),x=f.Quaternion.SlerpToRef(M,I,C,f.TmpVectors.Quaternion[2]);x.normalize();const y=x.toAlphaBetaGammaToRef(f.TmpVectors.HI[0]);if(this.alpha=y.x,this.beta=y.y,x.isApprox(I,H.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const B=I.toAlphaBetaGammaToRef(f.TmpVectors.HI[0]);this.alpha=B.x,this.beta=B.y}else B=!0}if(isNaN(this._goalRadius)||(this.radius+=(M-this.radius)*C,Math.abs(M/this.radius-1)<H.d?(this._goalRadius=NaN,this.radius=M):B=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const I=f.TmpVectors.Vector2[0].set(O(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),O(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));f.Vector2.LerpToRef(this.targetScreenOffset,I,C,this.targetScreenOffset),f.Vector2.Distance(this.targetScreenOffset,I)<H.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.M(I)):B=!0}this._isInterpolating=B}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||f.HI.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const B=this.alpha;var I,C;this.alpha=function(B){let I=Math.PI/2;return 0===B.x&&0===B.z||(I=Math.acos(B.x/Math.sqrt(Math.pow(B.x,2)+Math.pow(B.z,2)))),B.z<0&&(I=2*Math.PI-I),I}(this._computationVector),this.beta=(I=this._computationVector.y,C=this.radius,Math.acos(I/C));const M=Math.round((B-this.alpha)/(2*Math.PI));this.alpha+=2*M*Math.PI,this._checkLimits()}setPosition(B){this._position.equals(B)||(this._position.M(B),this.rebuildAnglesAndRadius())}setTarget(B){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],M=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(M=this.overrideCloneAlphaBetaRadius??M,B.nf)I&&B.getBoundingInfo?this._targetBoundingCenter=B.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,B.nf(),this._targetHost=B,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const I=B,M=this._getTargetPosition();if(M&&!C&&M.equals(I))return;this._targetHost=null,this._target=I,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}M||this.rebuildAnglesAndRadius()}_getViewMatrix(){const B=Math.cos(this.alpha),I=Math.sin(this.alpha),C=Math.cos(this.beta);let M=Math.sin(this.beta);0===M&&(M=1e-4),0===this.radius&&(this.radius=1e-4);const x=this._getTargetPosition();if(this._computationVector.vf(this.radius*B*M,this.radius*C,this.radius*I*M),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||f.HI.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),x.addToRef(this._computationVector,this._newPosition),this.rB().collisionsEnabled&&this.checkCollisions){const B=this.rB().collisionCoordinator;this._collider||(this._collider=B.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,B.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.M(this._newPosition);let B=this.upVector;this.allowUpsideDown&&M<0&&(B=B.negate()),this._computeViewMatrix(this._position,x,B),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.M(x),this._viewMatrix}zoomOn(B){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];B=B||this.rB().meshes;const C=g.b.MinMax(B);let M=this._calculateLowerRadiusFromModelBoundingSphere(C.min,C.max);if(M=Math.max(Math.min(M,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=M*this.zoomOnFactor,this.mode===U.e.ORTHOGRAPHIC_CAMERA){const B=this.rB().getEngine().getAspectRatio(this),I=M*this.zoomOnFactor/2;this.orthoLeft=-I*B,this.orthoRight=I*B,this.orthoBottom=-I,this.orthoTop=I}this.focusOn({min:C.min,max:C.max,distance:M},I)}focusOn(B){let I,C,M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===B.min){const M=B||this.rB().meshes;I=g.b.MinMax(M),C=f.HI.Distance(I.min,I.max)}else{I=B,C=B.distance}this._target=g.b.Center(I),M||(this.maxZ=2*C)}createRigCamera(B,I){let C=0;switch(this.cameraRigMode){case U.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case U.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case U.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case U.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case U.e.RIG_MODE_VR:C=this._cameraRigParams.stereoHalfAngle*(0===I?1:-1);break;case U.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:C=this._cameraRigParams.stereoHalfAngle*(0===I?-1:1)}const M=new a(B,this.alpha+C,this.beta,this.radius,this._target,this.rB());return M._cameraRigParams={},M.isRigCamera=!0,M.rigParent=this,M.upVector=this.upVector,M.mode=this.mode,M.orthoLeft=this.orthoLeft,M.orthoRight=this.orthoRight,M.orthoBottom=this.orthoBottom,M.orthoTop=this.orthoTop,M}_updateRigCameras(){const B=this._rigCameras[0],I=this._rigCameras[1];switch(B.beta=I.beta=this.beta,this.cameraRigMode){case U.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case U.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case U.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case U.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case U.e.RIG_MODE_VR:B.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,I.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case U.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:B.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,I.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const M=f.HI.Distance(B,I),x=this.rB().getEngine().getAspectRatio(this),y=Math.tan(this.fov/2),L=y*x,e=.5*M*C,g=e*Math.sqrt(1+1/(L*L)),N=e*Math.sqrt(1+1/(y*y));return Math.max(g,N)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,M.e)([(0,x.K)()],a.prototype,"alpha",void 0),(0,M.e)([(0,x.K)()],a.prototype,"beta",void 0),(0,M.e)([(0,x.K)()],a.prototype,"radius",void 0),(0,M.e)([(0,x.K)()],a.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,M.e)([(0,x.G)("target")],a.prototype,"_target",void 0),(0,M.e)([(0,x.x)("targetHost")],a.prototype,"_targetHost",void 0),(0,M.e)([(0,x.K)()],a.prototype,"inertialAlphaOffset",void 0),(0,M.e)([(0,x.K)()],a.prototype,"inertialBetaOffset",void 0),(0,M.e)([(0,x.K)()],a.prototype,"inertialRadiusOffset",void 0),(0,M.e)([(0,x.K)()],a.prototype,"lowerAlphaLimit",void 0),(0,M.e)([(0,x.K)()],a.prototype,"upperAlphaLimit",void 0),(0,M.e)([(0,x.K)()],a.prototype,"lowerBetaLimit",void 0),(0,M.e)([(0,x.K)()],a.prototype,"upperBetaLimit",void 0),(0,M.e)([(0,x.K)()],a.prototype,"lowerRadiusLimit",void 0),(0,M.e)([(0,x.K)()],a.prototype,"upperRadiusLimit",void 0),(0,M.e)([(0,x.K)()],a.prototype,"lowerTargetYLimit",void 0),(0,M.e)([(0,x.K)()],a.prototype,"inertialPanningX",void 0),(0,M.e)([(0,x.K)()],a.prototype,"inertialPanningY",void 0),(0,M.e)([(0,x.K)()],a.prototype,"pinchToPanMaxDistance",void 0),(0,M.e)([(0,x.K)()],a.prototype,"panningDistanceLimit",void 0),(0,M.e)([(0,x.G)()],a.prototype,"panningOriginTarget",void 0),(0,M.e)([(0,x.K)()],a.prototype,"panningInertia",void 0),(0,M.e)([(0,x.K)()],a.prototype,"zoomToMouseLocation",null),(0,M.e)([(0,x.K)()],a.prototype,"zoomOnFactor",void 0),(0,M.e)([(0,x.F)()],a.prototype,"targetScreenOffset",void 0),(0,M.e)([(0,x.K)()],a.prototype,"allowUpsideDown",void 0),(0,M.e)([(0,x.K)()],a.prototype,"useInputToRestoreState",void 0),(0,M.e)([(0,x.K)()],a.prototype,"restoreStateInterpolationFactor",void 0),(0,n.h)("BABYLON.ArcRotateCamera",a)},12802:(B,I,C)=>{"use strict";C.d(I,{d:()=>f,h:()=>L});var M=C(11027),x=C(11226),y=C(11647),f={};class L{constructor(B){this.attachedToElement=!1,this.attached={},this.camera=B,this.checkInputs=()=>{}}add(B){const I=B.getSimpleName();this.attached[I]?M.b.Warn("camera input of type "+I+" already exists on camera"):(this.attached[I]=B,B.camera=this.camera,B.checkInputs&&(this.checkInputs=this._addCheckInputs(B.checkInputs.bind(B))),this.attachedToElement&&B.attachControl(this.noPreventDefault))}remove(B){for(const I in this.attached){const C=this.attached[I];if(C===B)return C.KR(),C.camera=null,delete this.attached[I],void this.rebuildInputCheck()}}removeByType(B){for(const I in this.attached){const C=this.attached[I];C.getClassName()===B&&(C.KR(),C.camera=null,delete this.attached[I],this.rebuildInputCheck())}}_addCheckInputs(B){const I=this.checkInputs;return()=>{I(),B()}}attachInput(B){this.attachedToElement&&B.attachControl(this.noPreventDefault)}attachElement(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){B=!y.e.ForceAttachControlToAlwaysPreventDefault&&B,this.attachedToElement=!0,this.noPreventDefault=B;for(const I in this.attached)this.attached[I].attachControl(B)}}detachElement(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const I in this.attached)this.attached[I].KR(),B&&(this.attached[I].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const B in this.attached){const I=this.attached[B];I.checkInputs&&(this.checkInputs=this._addCheckInputs(I.checkInputs.bind(I)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(B){const I={};for(const C in this.attached){const B=this.attached[C],M=x.d.Serialize(B);I[B.getClassName()]=M}B.inputsmgr=I}parse(B){const I=B.inputsmgr;if(I){this.clear();for(const B in I){const C=f[B];if(C){const M=I[B],y=x.d.Parse((()=>new C),M,null);this.add(y)}}}else for(const C in this.attached){const I=f[this.attached[C].getClassName()];if(I){const M=x.d.Parse((()=>new I),B,null);this.remove(this.attached[C]),this.add(M)}}}}},12800:(B,I,C)=>{"use strict";C.d(I,{c:()=>t});var M=C(11180),x=C(11186),y=C(11194),f=C(11671),L=C(12802),e=C(11484),g=C(11018);class N{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(B){B=g.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.rB(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((I=>{const C=I.event;if(!C.metaKey)if(I.type===e.d.KEYDOWN){if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysUpward.indexOf(C.keyCode)||-1!==this.keysDownward.indexOf(C.keyCode)||-1!==this.keysRotateLeft.indexOf(C.keyCode)||-1!==this.keysRotateRight.indexOf(C.keyCode)||-1!==this.keysRotateUp.indexOf(C.keyCode)||-1!==this.keysRotateDown.indexOf(C.keyCode)){-1===this._keys.indexOf(C.keyCode)&&this._keys.push(C.keyCode),B||C.preventDefault()}}else if(-1!==this.keysUp.indexOf(C.keyCode)||-1!==this.keysDown.indexOf(C.keyCode)||-1!==this.keysLeft.indexOf(C.keyCode)||-1!==this.keysRight.indexOf(C.keyCode)||-1!==this.keysUpward.indexOf(C.keyCode)||-1!==this.keysDownward.indexOf(C.keyCode)||-1!==this.keysRotateLeft.indexOf(C.keyCode)||-1!==this.keysRotateRight.indexOf(C.keyCode)||-1!==this.keysRotateUp.indexOf(C.keyCode)||-1!==this.keysRotateDown.indexOf(C.keyCode)){const I=this._keys.indexOf(C.keyCode);I>=0&&this._keys.splice(I,1),B||C.preventDefault()}})))}KR(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const B=this.camera;for(let I=0;I<this._keys.length;I++){const C=this._keys[I],M=B._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(C)?B._localDirection.vf(-M,0,0):-1!==this.keysUp.indexOf(C)?B._localDirection.vf(0,0,M):-1!==this.keysRight.indexOf(C)?B._localDirection.vf(M,0,0):-1!==this.keysDown.indexOf(C)?B._localDirection.vf(0,0,-M):-1!==this.keysUpward.indexOf(C)?B._localDirection.vf(0,M,0):-1!==this.keysDownward.indexOf(C)?B._localDirection.vf(0,-M,0):-1!==this.keysRotateLeft.indexOf(C)?(B._localDirection.vf(0,0,0),B.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(C)?(B._localDirection.vf(0,0,0),B.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(C)?(B._localDirection.vf(0,0,0),B.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(C)&&(B._localDirection.vf(0,0,0),B.cameraRotation.x+=this._getLocalRotation()),B.rB().useRightHandedSystem&&(B._localDirection.z*=-1),B.getViewMatrix().invertToRef(B._cameraTransformMatrix),y.HI.TransformNormalToRef(B._localDirection,B._cameraTransformMatrix,B._transformedDirection),B.cameraDirection.addInPlace(B._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const B=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*B}}(0,M.e)([(0,x.K)()],N.prototype,"keysUp",void 0),(0,M.e)([(0,x.K)()],N.prototype,"keysUpward",void 0),(0,M.e)([(0,x.K)()],N.prototype,"keysDown",void 0),(0,M.e)([(0,x.K)()],N.prototype,"keysDownward",void 0),(0,M.e)([(0,x.K)()],N.prototype,"keysLeft",void 0),(0,M.e)([(0,x.K)()],N.prototype,"keysRight",void 0),(0,M.e)([(0,x.K)()],N.prototype,"rotationSpeed",void 0),(0,M.e)([(0,x.K)()],N.prototype,"keysRotateLeft",void 0),(0,M.e)([(0,x.K)()],N.prototype,"keysRotateRight",void 0),(0,M.e)([(0,x.K)()],N.prototype,"keysRotateUp",void 0),(0,M.e)([(0,x.K)()],N.prototype,"keysRotateDown",void 0),L.d.FreeCameraKeyboardMoveInput=N;var R=C(11022),H=C(11479);class F{constructor(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=B,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new R.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(B){B=g.Tools.BackCompatCameraNoPreventDefault(arguments);const I=this.camera.getEngine(),C=I.getInputElement();this._pointerInput||(this._pointerInput=M=>{const x=M.event,y="touch"===x.pointerType;if(!this.touchEnabled&&y)return;if(M.type!==H.c.POINTERMOVE&&-1===this.buttons.indexOf(x.button))return;const f=x.target;if(M.type===H.c.POINTERDOWN){if(y&&-1!==this._activePointerId||!y&&-1!==this._currentActiveButton)return;this._activePointerId=x.pointerId;try{null===f||void 0===f||f.setPointerCapture(x.pointerId)}catch(L){}-1===this._currentActiveButton&&(this._currentActiveButton=x.button),this._previousPosition={x:x.clientX,y:x.clientY},B||(x.preventDefault(),C&&C.focus()),I.isPointerLock&&this._onMouseMove&&this._onMouseMove(M.event)}else if(M.type===H.c.POINTERUP){if(y&&this._activePointerId!==x.pointerId||!y&&this._currentActiveButton!==x.button)return;try{null===f||void 0===f||f.releasePointerCapture(x.pointerId)}catch(L){}this._currentActiveButton=-1,this._previousPosition=null,B||x.preventDefault(),this._activePointerId=-1}else if(M.type===H.c.POINTERMOVE&&(this._activePointerId===x.pointerId||!y))if(I.isPointerLock&&this._onMouseMove)this._onMouseMove(M.event);else if(this._previousPosition){const I=this.camera._calculateHandednessMultiplier(),C=(x.clientX-this._previousPosition.x)*I,M=x.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=C/this.angularSensibility,this.camera.cameraRotation.x+=M/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:C,offsetY:M}),this._previousPosition={x:x.clientX,y:x.clientY},B||x.preventDefault()}}),this._onMouseMove=C=>{if(!I.isPointerLock)return;const M=this.camera._calculateHandednessMultiplier(),x=C.movementX*M;this.camera.cameraRotation.y+=x/this.angularSensibility;const y=C.movementY;this.camera.cameraRotation.x+=y/this.angularSensibility,this._previousPosition=null,B||C.preventDefault()},this._observer=this.camera.rB()._inputManager._addCameraPointerObserver(this._pointerInput,H.c.POINTERDOWN|H.c.POINTERUP|H.c.POINTERMOVE),C&&(this._contextMenuBind=B=>this.onContextMenu(B),C.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(B){B.preventDefault()}KR(){if(this._observer){if(this.camera.rB()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const B=this.camera.getEngine().getInputElement();B&&B.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,M.e)([(0,x.K)()],F.prototype,"buttons",void 0),(0,M.e)([(0,x.K)()],F.prototype,"angularSensibility",void 0),L.d.FreeCameraMouseInput=F;var k,q=C(11490);class S{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new R.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(B){B=g.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=I=>{if(I.type!==H.c.POINTERWHEEL)return;const C=I.event,M=C.deltaMode===q.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*M*C.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*M*C.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*M*C.deltaZ/this._normalize,C.preventDefault&&(B||C.preventDefault())},this._observer=this.camera.rB()._inputManager._addCameraPointerObserver(this._wheel,H.c.POINTERWHEEL)}KR(){this._observer&&(this.camera.rB()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,M.e)([(0,x.K)()],S.prototype,"wheelPrecisionX",void 0),(0,M.e)([(0,x.K)()],S.prototype,"wheelPrecisionY",void 0),(0,M.e)([(0,x.K)()],S.prototype,"wheelPrecisionZ",void 0),function(B){B[B.MoveRelative=0]="MoveRelative",B[B.RotateRelative=1]="RotateRelative",B[B.MoveScene=2]="MoveScene"}(k||(k={}));class o extends S{constructor(){super(...arguments),this._moveRelative=y.HI.Zero(),this._rotateRelative=y.HI.Zero(),this._moveScene=y.HI.Zero(),this._wheelXAction=k.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=k.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(B){null===B&&this._wheelXAction!==k.MoveRelative||(this._wheelXAction=k.MoveRelative,this._wheelXActionCoordinate=B)}get wheelXMoveRelative(){return this._wheelXAction!==k.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(B){null===B&&this._wheelYAction!==k.MoveRelative||(this._wheelYAction=k.MoveRelative,this._wheelYActionCoordinate=B)}get wheelYMoveRelative(){return this._wheelYAction!==k.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(B){null===B&&this._wheelZAction!==k.MoveRelative||(this._wheelZAction=k.MoveRelative,this._wheelZActionCoordinate=B)}get wheelZMoveRelative(){return this._wheelZAction!==k.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(B){null===B&&this._wheelXAction!==k.RotateRelative||(this._wheelXAction=k.RotateRelative,this._wheelXActionCoordinate=B)}get wheelXRotateRelative(){return this._wheelXAction!==k.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(B){null===B&&this._wheelYAction!==k.RotateRelative||(this._wheelYAction=k.RotateRelative,this._wheelYActionCoordinate=B)}get wheelYRotateRelative(){return this._wheelYAction!==k.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(B){null===B&&this._wheelZAction!==k.RotateRelative||(this._wheelZAction=k.RotateRelative,this._wheelZActionCoordinate=B)}get wheelZRotateRelative(){return this._wheelZAction!==k.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(B){null===B&&this._wheelXAction!==k.MoveScene||(this._wheelXAction=k.MoveScene,this._wheelXActionCoordinate=B)}get wheelXMoveScene(){return this._wheelXAction!==k.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(B){null===B&&this._wheelYAction!==k.MoveScene||(this._wheelYAction=k.MoveScene,this._wheelYActionCoordinate=B)}get wheelYMoveScene(){return this._wheelYAction!==k.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(B){null===B&&this._wheelZAction!==k.MoveScene||(this._wheelZAction=k.MoveScene,this._wheelZActionCoordinate=B)}get wheelZMoveScene(){return this._wheelZAction!==k.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Tf(0),this._rotateRelative.Tf(0),this._moveScene.Tf(0),this._updateCamera(),this.camera.rB().useRightHandedSystem&&(this._moveRelative.z*=-1);const B=y.Matrix.Zero();this.camera.getViewMatrix().invertToRef(B);const I=y.HI.Zero();y.HI.TransformNormalToRef(this._moveRelative,B,I),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(I),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(B,I,C){if(0===B)return;if(null===I||null===C)return;let M=null;switch(I){case k.MoveRelative:M=this._moveRelative;break;case k.RotateRelative:M=this._rotateRelative;break;case k.MoveScene:M=this._moveScene}switch(C){case 0:M.set(B,0,0);break;case 1:M.set(0,B,0);break;case 2:M.set(0,0,B)}}}(0,M.e)([(0,x.K)()],o.prototype,"wheelXMoveRelative",null),(0,M.e)([(0,x.K)()],o.prototype,"wheelYMoveRelative",null),(0,M.e)([(0,x.K)()],o.prototype,"wheelZMoveRelative",null),(0,M.e)([(0,x.K)()],o.prototype,"wheelXRotateRelative",null),(0,M.e)([(0,x.K)()],o.prototype,"wheelYRotateRelative",null),(0,M.e)([(0,x.K)()],o.prototype,"wheelZRotateRelative",null),(0,M.e)([(0,x.K)()],o.prototype,"wheelXMoveScene",null),(0,M.e)([(0,x.K)()],o.prototype,"wheelYMoveScene",null),(0,M.e)([(0,x.K)()],o.prototype,"wheelZMoveScene",null),L.d.FreeCameraMouseWheelInput=o;class U{constructor(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=B,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=g.Tools.IsSafari()}attachControl(B){B=g.Tools.BackCompatCameraNoPreventDefault(arguments);let I=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=C=>{const M=C.event,x="mouse"===M.pointerType||this._isSafari&&"undefined"===typeof M.pointerType;if(this.allowMouse||!x)if(C.type===H.c.POINTERDOWN){if(B||M.preventDefault(),this._pointerPressed.push(M.pointerId),1!==this._pointerPressed.length)return;I={x:M.clientX,y:M.clientY}}else if(C.type===H.c.POINTERUP){B||M.preventDefault();const C=this._pointerPressed.indexOf(M.pointerId);if(-1===C)return;if(this._pointerPressed.splice(C,1),0!=C)return;I=null,this._offsetX=null,this._offsetY=null}else if(C.type===H.c.POINTERMOVE){if(B||M.preventDefault(),!I)return;if(0!=this._pointerPressed.indexOf(M.pointerId))return;this._offsetX=M.clientX-I.x,this._offsetY=-(M.clientY-I.y)}}),this._observer=this.camera.rB()._inputManager._addCameraPointerObserver(this._pointerInput,H.c.POINTERDOWN|H.c.POINTERUP|H.c.POINTERMOVE),this._onLostFocus){const B=this.camera.getEngine().getInputElement();B&&B.addEventListener("blur",this._onLostFocus)}}KR(){if(this._pointerInput){if(this._observer&&(this.camera.rB()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const B=this.camera.getEngine().getInputElement();B&&B.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const B=this.camera,I=B._calculateHandednessMultiplier();B.cameraRotation.y=I*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)B.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const I=B._computeLocalCameraSpeed(),C=new y.HI(0,0,0!==this.touchMoveSensibility?I*this._offsetY/this.touchMoveSensibility:0);y.Matrix.RotationYawPitchRollToRef(B.rotation.y,B.rotation.x,0,B._cameraRotationMatrix),B.cameraDirection.addInPlace(y.HI.TransformCoordinates(C,B._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,M.e)([(0,x.K)()],U.prototype,"touchAngularSensibility",void 0),(0,M.e)([(0,x.K)()],U.prototype,"touchMoveSensibility",void 0),L.d.FreeCameraTouchInput=U;class G extends L.h{constructor(B){super(B),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new N),this}addMouse(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new F(B),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new o,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new U),this}clear(){super.clear(),this._mouseInput=null}}var V=C(11149),c=C(11096);class t extends f.e{get angularSensibility(){const B=this.inputs.attached.mouse;return B?B.angularSensibility:0}set angularSensibility(B){const I=this.inputs.attached.mouse;I&&(I.angularSensibility=B)}get keysUp(){const B=this.inputs.attached.keyboard;return B?B.keysUp:[]}set keysUp(B){const I=this.inputs.attached.keyboard;I&&(I.keysUp=B)}get keysUpward(){const B=this.inputs.attached.keyboard;return B?B.keysUpward:[]}set keysUpward(B){const I=this.inputs.attached.keyboard;I&&(I.keysUpward=B)}get keysDown(){const B=this.inputs.attached.keyboard;return B?B.keysDown:[]}set keysDown(B){const I=this.inputs.attached.keyboard;I&&(I.keysDown=B)}get keysDownward(){const B=this.inputs.attached.keyboard;return B?B.keysDownward:[]}set keysDownward(B){const I=this.inputs.attached.keyboard;I&&(I.keysDownward=B)}get keysLeft(){const B=this.inputs.attached.keyboard;return B?B.keysLeft:[]}set keysLeft(B){const I=this.inputs.attached.keyboard;I&&(I.keysLeft=B)}get keysRight(){const B=this.inputs.attached.keyboard;return B?B.keysRight:[]}set keysRight(B){const I=this.inputs.attached.keyboard;I&&(I.keysRight=B)}get keysRotateLeft(){const B=this.inputs.attached.keyboard;return B?B.keysRotateLeft:[]}set keysRotateLeft(B){const I=this.inputs.attached.keyboard;I&&(I.keysRotateLeft=B)}get keysRotateRight(){const B=this.inputs.attached.keyboard;return B?B.keysRotateRight:[]}set keysRotateRight(B){const I=this.inputs.attached.keyboard;I&&(I.keysRotateRight=B)}get keysRotateUp(){const B=this.inputs.attached.keyboard;return B?B.keysRotateUp:[]}set keysRotateUp(B){const I=this.inputs.attached.keyboard;I&&(I.keysRotateUp=B)}get keysRotateDown(){const B=this.inputs.attached.keyboard;return B?B.keysRotateDown:[]}set keysRotateDown(B){const I=this.inputs.attached.keyboard;I&&(I.keysRotateDown=B)}constructor(B,I,C){var M;super(B,I,C,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),M=this,this.ellipsoid=new y.HI(.5,1,.5),this.ellipsoidOffset=new y.HI(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=y.HI.Zero(),this._diffPosition=y.HI.Zero(),this._newPosition=y.HI.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;M._newPosition.M(I),M._newPosition.subtractToRef(M._oldPosition,M._diffPosition),M._diffPosition.length()>c.e.CollisionsEpsilon&&(M.position.addToRef(M._diffPosition,M._deferredPositionUpdate),M._deferOnly?M._deferredUpdated=!0:M.position.M(M._deferredPositionUpdate),M.aF&&C&&M.aF(C))},this.inputs=new G(this),this.inputs.addKeyboard().addMouse()}attachControl(B,I){I=g.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(I)}KR(){this.inputs.detachElement(),this.cameraDirection=new y.HI(0,0,0),this.cameraRotation=new y.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(B){this._collisionMask=isNaN(B)?-1:B}_collideWithWorld(B){let I;I=this.parent?y.HI.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,I.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const C=this.rB().collisionCoordinator;this._collider||(this._collider=C.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let M=B;this.applyGravity&&(M=B.add(this.rB().gravity)),C.getNewPosition(this._oldPosition,M,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=y.HI.Zero(),this._transformedDirection=y.HI.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(B){this._needMoveForGravity=B}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.rB().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Fe"}}(0,M.e)([(0,x.G)()],t.prototype,"ellipsoid",void 0),(0,M.e)([(0,x.G)()],t.prototype,"ellipsoidOffset",void 0),(0,M.e)([(0,x.K)()],t.prototype,"checkCollisions",void 0),(0,M.e)([(0,x.K)()],t.prototype,"applyGravity",void 0),(0,V.h)("BABYLON.FreeCamera",t)},13411:(B,I,C)=>{"use strict";C.d(I,{e:()=>y});var M=C(11291),x=C(13416);class y{constructor(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=C,this.oR=[],this._maxBlockCapacity=I||64,this._selectionContent=new M.b(1024),this._creationFunc=B}update(B,I,C){x.b._CreateBlocks(B,I,C,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}AN(B){for(let I=0;I<this.EN.length;I++){this.EN[I].addEntry(B)}}rN(B){for(let I=0;I<this.EN.length;I++){this.EN[I].removeEntry(B)}}select(B,I){this._selectionContent.reset();for(let C=0;C<this.EN.length;C++){this.EN[C].select(B,this._selectionContent,I)}return I?this._selectionContent.concat(this.oR):this._selectionContent.concatWithNoDuplicate(this.oR),this._selectionContent}intersects(B,I,C){this._selectionContent.reset();for(let M=0;M<this.EN.length;M++){this.EN[M].intersects(B,I,this._selectionContent,C)}return C?this._selectionContent.concat(this.oR):this._selectionContent.concatWithNoDuplicate(this.oR),this._selectionContent}intersectsRay(B){this._selectionContent.reset();for(let I=0;I<this.EN.length;I++){this.EN[I].intersectsRay(B,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.oR),this._selectionContent}}y.CreationFuncForMeshes=(B,I)=>{const C=B.getBoundingInfo();!B.isBlocked&&C.boundingBox.intersectsMinMax(I.tR,I.rR)&&I.entries.push(B)},y.CreationFuncForSubMeshes=(B,I)=>{B.getBoundingInfo().boundingBox.intersectsMinMax(I.tR,I.rR)&&I.entries.push(B)}},13416:(B,I,C)=>{"use strict";C.d(I,{b:()=>y});var M=C(11194),x=C(11536);class y{constructor(B,I,C,M,x,y){this.entries=[],this.AR=new Array,this._capacity=C,this._depth=M,this._maxDepth=x,this._creationFunc=y,this._minPoint=B,this._maxPoint=I,this.AR.push(B.clone()),this.AR.push(I.clone()),this.AR.push(B.clone()),this.AR[2].x=I.x,this.AR.push(B.clone()),this.AR[3].y=I.y,this.AR.push(B.clone()),this.AR[4].z=I.z,this.AR.push(I.clone()),this.AR[5].z=B.z,this.AR.push(I.clone()),this.AR[6].x=B.x,this.AR.push(I.clone()),this.AR[7].y=B.y}get nI(){return this._capacity}get tR(){return this._minPoint}get rR(){return this._maxPoint}addEntry(B){if(this.EN)for(let I=0;I<this.EN.length;I++){this.EN[I].addEntry(B)}else this._creationFunc(B,this),this.entries.length>this.nI&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(B){if(this.EN){for(let I=0;I<this.EN.length;I++){this.EN[I].removeEntry(B)}return}const I=this.entries.indexOf(B);I>-1&&this.entries.splice(I,1)}addEntries(B){for(let I=0;I<B.length;I++){const C=B[I];this.addEntry(C)}}select(B,I,C){if(x.b.IsInFrustum(this.AR,B)){if(this.EN){for(let M=0;M<this.EN.length;M++){this.EN[M].select(B,I,C)}return}C?I.concat(this.entries):I.concatWithNoDuplicate(this.entries)}}intersects(B,I,C,M){if(x.b.IntersectsSphere(this._minPoint,this._maxPoint,B,I)){if(this.EN){for(let x=0;x<this.EN.length;x++){this.EN[x].intersects(B,I,C,M)}return}M?C.concat(this.entries):C.concatWithNoDuplicate(this.entries)}}intersectsRay(B,I){if(B.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.EN){for(let C=0;C<this.EN.length;C++){this.EN[C].intersectsRay(B,I)}return}I.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){y._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(B,I,C,x,f,L,e,g){e.EN=new Array;const N=new M.HI((I.x-B.x)/2,(I.y-B.y)/2,(I.z-B.z)/2);for(let M=0;M<2;M++)for(let I=0;I<2;I++)for(let R=0;R<2;R++){const H=B.add(N.multiplyByFloats(M,I,R)),F=B.add(N.multiplyByFloats(M+1,I+1,R+1)),k=new y(H,F,x,f+1,L,g);k.addEntries(C),e.EN.push(k)}}}},13419:(B,I,C)=>{"use strict";C.d(I,{e:()=>N});var M=C(11440),x=C(11194),y=C(11625),f=C(12556),L=C(11471),e=C(13411),g=C(11056);M.b.prototype.createOrUpdateSelectionOctree=function(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,C=this._getComponent(L.d.NAME_OCTREE);C||(C=new N(this),this.py(C)),this.qR||(this.qR=new e.e(e.e.CreationFuncForMeshes,B,I));const M=this.getWorldExtends();return this.qR.update(M.min,M.max,this.meshes),this.qR},Object.defineProperty(M.b.prototype,"selectionOctree",{get:function(){return this.qR},enumerable:!0,configurable:!0}),y.e.prototype.createOrUpdateSubmeshesOctree=function(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const C=this.rB();let M=C._getComponent(L.d.NAME_OCTREE);M||(M=new N(C),C.py(M)),this._submeshesOctree||(this._submeshesOctree=new e.e(e.e.CreationFuncForSubMeshes,B,I)),this.nf(!0);const x=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(x.minimumWorld,x.maximumWorld,this.cf),this._submeshesOctree};class N{constructor(B){this.name=L.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new f.c(x.HI.Zero(),new x.HI(1,1,1)),(B=B||g.c.LastCreatedScene)&&(this.kI=B,this.kI.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.kI.getActiveSubMeshCandidates=B=>this.getActiveSubMeshCandidates(B),this.kI.getCollidingSubMeshCandidates=(B,I)=>this.getCollidingSubMeshCandidates(B,I),this.kI.getIntersectingSubMeshCandidates=(B,I)=>this.getIntersectingSubMeshCandidates(B,I))}register(){this.kI.onMeshRemovedObservable.add((B=>{const I=this.kI.selectionOctree;if(void 0!==I&&null!==I){const C=I.oR.indexOf(B);-1!==C&&I.oR.splice(C,1)}})),this.kI.onMeshImportedObservable.add((B=>{const I=this.kI.selectionOctree;void 0!==I&&null!==I&&I.AN(B)}))}getActiveMeshCandidates(){var B;return(null===(B=this.kI.qR)||void 0===B?void 0:B.select(this.kI.frustumPlanes))||this.kI._getDefaultMeshCandidates()}getActiveSubMeshCandidates(B){if(B._submeshesOctree&&B.useOctreeForRenderingSelection){return B._submeshesOctree.select(this.kI.frustumPlanes)}return this.kI._getDefaultSubMeshCandidates(B)}getIntersectingSubMeshCandidates(B,I){if(B._submeshesOctree&&B.useOctreeForPicking){f.c.TransformToRef(I,B.getWorldMatrix(),this._tempRay);return B._submeshesOctree.intersectsRay(this._tempRay)}return this.kI._getDefaultSubMeshCandidates(B)}getCollidingSubMeshCandidates(B,I){if(B._submeshesOctree&&B.useOctreeForCollisions){const C=I._velocityWorldLength+Math.max(I._radius.x,I._radius.y,I._radius.z);return B._submeshesOctree.intersects(I._basePointWorld,C)}return this.kI._getDefaultSubMeshCandidates(B)}rebuild(){}dispose(){}}},12556:(B,I,C)=>{"use strict";C.d(I,{c:()=>F});var M=C(11440),x=C(11647),y=C(11197),f=C(11194),L=C(11204),e=C(11522),g=C(11469),N=C(11056),R=C(11499);const H={internalPickerForMesh:void 0};class F{constructor(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y.d;this.origin=B,this.direction=I,this.length=C,this.epsilon=M}clone(){return new F(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const M=F._TmpVector3[0].vf(B.x-C,B.y-C,B.z-C),x=F._TmpVector3[1].vf(I.x+C,I.y+C,I.z+C);let y,f,L,e,g=0,N=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<M.x||this.origin.x>x.x)return!1}else if(y=1/this.direction.x,f=(M.x-this.origin.x)*y,L=(x.x-this.origin.x)*y,L===-1/0&&(L=1/0),f>L&&(e=f,f=L,L=e),g=Math.max(f,g),N=Math.min(L,N),g>N)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<M.y||this.origin.y>x.y)return!1}else if(y=1/this.direction.y,f=(M.y-this.origin.y)*y,L=(x.y-this.origin.y)*y,L===-1/0&&(L=1/0),f>L&&(e=f,f=L,L=e),g=Math.max(f,g),N=Math.min(L,N),g>N)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<M.z||this.origin.z>x.z)return!1}else if(y=1/this.direction.z,f=(M.z-this.origin.z)*y,L=(x.z-this.origin.z)*y,L===-1/0&&(L=1/0),f>L&&(e=f,f=L,L=e),g=Math.max(f,g),N=Math.min(L,N),g>N)return!1;return!0}intersectsBox(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(B.minimum,B.maximum,I)}intersectsSphere(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=B.center.x-this.origin.x,M=B.center.y-this.origin.y,x=B.center.z-this.origin.z,y=C*C+M*M+x*x,f=B.radius+I,L=f*f;if(y<=L)return!0;const e=C*this.direction.x+M*this.direction.y+x*this.direction.z;if(e<0)return!1;return y-e*e<=L}intersectsTriangle(B,I,C){const M=F._TmpVector3[0],x=F._TmpVector3[1],y=F._TmpVector3[2],L=F._TmpVector3[3],g=F._TmpVector3[4];I.subtractToRef(B,M),C.subtractToRef(B,x),f.HI.CrossToRef(this.direction,x,y);const N=f.HI.Dot(M,y);if(0===N)return null;const R=1/N;this.origin.subtractToRef(B,L);const H=f.HI.Dot(L,y)*R;if(H<-this.epsilon||H>1+this.epsilon)return null;f.HI.CrossToRef(L,M,g);const k=f.HI.Dot(this.direction,g)*R;if(k<-this.epsilon||H+k>1+this.epsilon)return null;const q=f.HI.Dot(x,g)*R;return q>this.length?null:new e.c(1-H-k,H,q)}intersectsPlane(B){let I;const C=f.HI.Dot(B.normal,this.direction);if(Math.abs(C)<9.99999997475243e-7)return null;{const M=f.HI.Dot(B.normal,this.origin);return I=(-B.d-M)/C,I<0?I<-9.99999997475243e-7?null:0:I}}intersectsAxis(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(B){case"y":{const B=(this.origin.y-I)/this.direction.y;return B>0?null:new f.HI(this.origin.x+this.direction.x*-B,I,this.origin.z+this.direction.z*-B)}case"x":{const B=(this.origin.x-I)/this.direction.x;return B>0?null:new f.HI(I,this.origin.y+this.direction.y*-B,this.origin.z+this.direction.z*-B)}case"z":{const B=(this.origin.z-I)/this.direction.z;return B>0?null:new f.HI(this.origin.x+this.direction.x*-B,this.origin.y+this.direction.y*-B,I)}default:return null}}intersectsMesh(B,I,C){let M=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4?arguments[4]:void 0,y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const L=f.TmpVectors.Matrix[0];return B.getWorldMatrix().invertToRef(L),this._tmpRay?F.TransformToRef(this,L,this._tmpRay):this._tmpRay=F.Transform(this,L),B.intersects(this._tmpRay,I,C,M,x,y)}intersectsMeshes(B,I,C){C?C.length=0:C=[];for(let M=0;M<B.length;M++){const x=this.intersectsMesh(B[M],I);x.hit&&C.push(x)}return C.sort(this._comparePickingInfo),C}_comparePickingInfo(B,I){return B.distance<I.distance?-1:B.distance>I.distance?1:0}intersectionSegment(B,I,C){const M=this.origin,x=f.TmpVectors.HI[0],y=f.TmpVectors.HI[1],L=f.TmpVectors.HI[2],e=f.TmpVectors.HI[3];I.subtractToRef(B,x),this.direction.scaleToRef(F._Rayl,L),M.addToRef(L,y),B.subtractToRef(M,e);const g=f.HI.Dot(x,x),N=f.HI.Dot(x,L),R=f.HI.Dot(L,L),H=f.HI.Dot(x,e),k=f.HI.Dot(L,e),q=g*R-N*N;let S,o,U=q,G=q;q<F._Smallnum?(S=0,U=1,o=k,G=R):(S=N*k-R*H,o=g*k-N*H,S<0?(S=0,o=k,G=R):S>U&&(S=U,o=k+N,G=R)),o<0?(o=0,-H<0?S=0:-H>g?S=U:(S=-H,U=g)):o>G&&(o=G,-H+N<0?S=0:-H+N>g?S=U:(S=-H+N,U=g));const V=Math.abs(S)<F._Smallnum?0:S/U,c=Math.abs(o)<F._Smallnum?0:o/G,t=f.TmpVectors.HI[4];L.scaleToRef(c,t);const r=f.TmpVectors.HI[5];x.scaleToRef(V,r),r.addInPlace(e);const A=f.TmpVectors.HI[6];r.subtractToRef(t,A);return c>0&&c<=this.length&&A.lengthSquared()<C*C?r.length():-1}update(B,I,C,M,x,y,L){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){F._RayDistant||(F._RayDistant=F.Zero()),F._RayDistant.unprojectRayToRef(B,I,C,M,f.Matrix.IdentityReadOnly,y,L);const e=f.TmpVectors.Matrix[0];x.invertToRef(e),F.TransformToRef(F._RayDistant,e,this)}else this.unprojectRayToRef(B,I,C,M,x,y,L);return this}static Zero(){return new F(f.HI.Zero(),f.HI.Zero())}static CreateNew(B,I,C,M,x,y,f){return F.Zero().update(B,I,C,M,x,y,f)}static CreateNewFromTo(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.Matrix.IdentityReadOnly;const M=new F(new f.HI(0,0,0),new f.HI(0,0,0));return F.CreateFromToToRef(B,I,M,C)}static CreateFromToToRef(B,I,C){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:f.Matrix.IdentityReadOnly;C.origin.M(B);const x=I.subtractToRef(B,C.direction),y=Math.sqrt(x.x*x.x+x.y*x.y+x.z*x.z);return C.length=y,C.direction.normalize(),F.TransformToRef(C,M,C)}static Transform(B,I){const C=new F(new f.HI(0,0,0),new f.HI(0,0,0));return F.TransformToRef(B,I,C),C}static TransformToRef(B,I,C){f.HI.TransformCoordinatesToRef(B.origin,I,C.origin),f.HI.TransformNormalToRef(B.direction,I,C.direction),C.length=B.length,C.epsilon=B.epsilon;const M=C.direction,x=M.length();if(0!==x&&1!==x){const B=1/x;M.x*=B,M.y*=B,M.z*=B,C.length*=x}return C}unprojectRayToRef(B,I,C,M,x,y,L){const e=f.TmpVectors.Matrix[0];x.multiplyToRef(y,e),e.multiplyToRef(L,e),e.invert();const g=N.c.LastCreatedEngine,R=f.TmpVectors.HI[0];R.x=B/C*2-1,R.y=-(I/M*2-1),R.z=null!==g&&void 0!==g&&g.useReverseDepthBuffer?1:null!==g&&void 0!==g&&g.isNDCHalfZRange?0:-1;const H=f.TmpVectors.HI[1].vf(R.x,R.y,1-1e-8),F=f.TmpVectors.HI[2],k=f.TmpVectors.HI[3];f.HI._UnprojectFromInvertedMatrixToRef(R,e,F),f.HI._UnprojectFromInvertedMatrixToRef(H,e,k),this.origin.M(F),k.subtractToRef(F,this.direction),this.direction.normalize()}}function k(B,I,C,M,x){let y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const f=F.Zero();return q(B,I,C,M,f,x,y),f}function q(B,I,C,M,x,y){let L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],e=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const g=B.getEngine();if(!y&&!(y=B.activeCamera))return B;const N=y.viewport,R=g.getRenderHeight(),{x:H,y:F,width:k,height:q}=N.toGlobal(g.getRenderWidth(),R),S=1/g.getHardwareScalingLevel();return I=I*S-H,C=C*S-(R-F-q),x.update(I,C,k,q,M||f.Matrix.IdentityReadOnly,L?f.Matrix.IdentityReadOnly:y.getViewMatrix(),y.getProjectionMatrix(),e),B}function S(B,I,C,M,x){if(!g.b)return B;const y=B.getEngine();if(!x&&!(x=B.activeCamera))throw new Error("Active camera not set");const L=x.viewport,e=y.getRenderHeight(),{x:N,y:R,width:H,height:F}=L.toGlobal(y.getRenderWidth(),e),k=f.Matrix.Identity(),q=1/y.getHardwareScalingLevel();return I=I*q-N,C=C*q-(e-R-F),M.update(I,C,H,F,k,k,x.getProjectionMatrix()),B}function o(B,I,C,M,x,y,f,L){const e=I(M,C.enableDistantPicking),g=C.intersects(e,x,f,y,M,L);return g&&g.hit?!x&&null!=B&&g.distance>=B.distance?null:g:null}function U(B,I,C,M,x,y){let L=null;const e=!!(B.activeCameras&&B.activeCameras.length>1&&B.cameraToUseForPointers!==B.activeCamera),N=B.cameraToUseForPointers||B.activeCamera,R=H.internalPickerForMesh||o;for(let g=0;g<B.meshes.length;g++){const H=B.meshes[g];if(C){if(!C(H,-1))continue}else if(!H.isEnabled()||!H.isVisible||!H.Te)continue;const F=e&&H.isWorldMatrixCameraDependent(),k=H.nf(F,N);if(H.hasThinInstances&&H.thinInstanceEnablePicking){const B=R(L,I,H,k,!0,!0,y);if(B){if(x)return B;const e=f.TmpVectors.Matrix[1],g=H.thinInstanceGetWorldMatrices();for(let B=0;B<g.length;B++){if(C&&!C(H,B))continue;g[B].multiplyToRef(k,e);const f=R(L,I,H,e,M,x,y,!0);if(f&&(L=f,L.thinInstanceIndex=B,M))return L}}}else{const B=R(L,I,H,k,M,x,y);if(B&&(L=B,M))return L}}return L||new g.b}function G(B,I,C,M){if(!g.b)return null;const x=[],y=!!(B.activeCameras&&B.activeCameras.length>1&&B.cameraToUseForPointers!==B.activeCamera),L=B.cameraToUseForPointers||B.activeCamera,e=H.internalPickerForMesh||o;for(let g=0;g<B.meshes.length;g++){const N=B.meshes[g];if(C){if(!C(N,-1))continue}else if(!N.isEnabled()||!N.isVisible||!N.Te)continue;const R=y&&N.isWorldMatrixCameraDependent(),H=N.nf(R,L);if(N.hasThinInstances&&N.thinInstanceEnablePicking){if(e(null,I,N,H,!0,!0,M)){const B=f.TmpVectors.Matrix[1],y=N.thinInstanceGetWorldMatrices();for(let f=0;f<y.length;f++){if(C&&!C(N,f))continue;y[f].multiplyToRef(H,B);const L=e(null,I,N,B,!1,!1,M,!0);L&&(L.thinInstanceIndex=f,x.push(L))}}}else{const B=e(null,I,N,H,!1,!1,M);B&&x.push(B)}}return x}function V(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,M=arguments.length>3?arguments[3]:void 0,x=arguments.length>4?arguments[4]:void 0;M||(M=B.getWorldMatrix()),I.length=C,x?I.origin.M(x):I.origin.M(B.position);const y=f.TmpVectors.HI[2];y.set(0,0,B._scene.useRightHandedSystem?-1:1);const L=f.TmpVectors.HI[3];return f.HI.TransformNormalToRef(y,M,L),f.HI.NormalizeToRef(L,I.direction),I}var c,t;F._TmpVector3=(0,L.b)(6,f.HI.Zero),F._RayDistant=F.Zero(),F._Smallnum=1e-8,F._Rayl=1e9,c=M.b,(t=x.e)&&(t.prototype.getForwardRay=function(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,I=arguments.length>1?arguments[1]:void 0,C=arguments.length>2?arguments[2]:void 0;return V(this,new F(f.HI.Zero(),f.HI.Zero(),B),B,I,C)},t.prototype.getForwardRayToRef=function(B){return V(this,B,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),c&&(R.e._IsPickingAvailable=!0,c.prototype.createPickingRay=function(B,I,C,M){return k(this,B,I,C,M,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),M.b.prototype.createPickingRayToRef=function(B,I,C,M,x){return q(this,B,I,C,M,x,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},M.b.prototype.createPickingRayInCameraSpace=function(B,I,C){return function(B,I,C,M){const x=F.Zero();return S(B,I,C,x,M),x}(this,B,I,C)},M.b.prototype.createPickingRayInCameraSpaceToRef=function(B,I,C,M){return S(this,B,I,C,M)},M.b.prototype.pickWithBoundingInfo=function(B,I,C,M,x){return function(B,I,C,M,x,y){if(!g.b)return null;const L=U(B,(M=>(B._tempPickingRay||(B._tempPickingRay=F.Zero()),q(B,I,C,M,B._tempPickingRay,y||null),B._tempPickingRay)),M,x,!0);return L&&(L.ray=k(B,I,C,f.Matrix.Identity(),y||null)),L}(this,B,I,C,M,x)},M.b.prototype.NC=function(B,I,C,M,x,y){return function(B,I,C,M,x,y,L){const e=U(B,((M,x)=>(B._tempPickingRay||(B._tempPickingRay=F.Zero()),q(B,I,C,M,B._tempPickingRay,y||null,!1,x),B._tempPickingRay)),M,x,!1,L);return e&&(e.ray=k(B,I,C,f.Matrix.Identity(),y||null)),e}(this,B,I,C,M,x,y)},M.b.prototype.pickWithRay=function(B,I,C,M){return function(B,I,C,M,x){const y=U(B,(C=>(B._pickWithRayInverseMatrix||(B._pickWithRayInverseMatrix=f.Matrix.Identity()),C.invertToRef(B._pickWithRayInverseMatrix),B._cachedRayForTransform||(B._cachedRayForTransform=F.Zero()),F.TransformToRef(I,B._pickWithRayInverseMatrix,B._cachedRayForTransform),B._cachedRayForTransform)),C,M,!1,x);return y&&(y.ray=I),y}(this,B,I,C,M)},M.b.prototype.multiPick=function(B,I,C,M,x){return function(B,I,C,M,x,y){return G(B,(M=>k(B,I,C,M,x||null)),M,y)}(this,B,I,C,M,x)},M.b.prototype.multiPickWithRay=function(B,I,C){return function(B,I,C,M){return G(B,(C=>(B._pickWithRayInverseMatrix||(B._pickWithRayInverseMatrix=f.Matrix.Identity()),C.invertToRef(B._pickWithRayInverseMatrix),B._cachedRayForTransform||(B._cachedRayForTransform=F.Zero()),F.TransformToRef(I,B._pickWithRayInverseMatrix,B._cachedRayForTransform),B._cachedRayForTransform)),C,M)}(this,B,I,C)}},12858:(B,I,C)=>{"use strict";var M=C(11129),x=C(11027),y=C(11062),f=C(11156),L=C(11096),e=C(11137);L.e.prototype._partialLoadFile=function(B,I,C,M){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(B,(B=>{C[I]=B,C._internalCount++,6===C._internalCount&&M(C)}),void 0,void 0,!0,((B,I)=>{x&&B&&x(B.status+" "+B.statusText,I)}))},L.e.prototype._cascadeLoadFiles=function(B,I,C){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const x=[];x._internalCount=0;for(let y=0;y<6;y++)this._partialLoadFile(C[y],y,x,I,M)},L.e.prototype._cascadeLoadImgs=function(B,I,C,M){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5?arguments[5]:void 0;const f=[];f._internalCount=0;for(let L=0;L<6;L++)this._partialLoadImg(M[L],L,f,B,I,C,x,y)},L.e.prototype._partialLoadImg=function(B,I,C,M,x,L){let e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7?arguments[7]:void 0;const N=(0,f.c)();(0,y.q)(B,(B=>{C[I]=B,C._internalCount++,M&&M.removePendingData(N),6===C._internalCount&&L&&L(x,C)}),((B,I)=>{M&&M.removePendingData(N),e&&e(B,I)}),M?M.offlineProvider:null,g),M&&M.addPendingData(N)},L.e.prototype.createCubeTextureBase=function(B,I,C,y){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6?arguments[6]:void 0,N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,R=arguments.length>8&&void 0!==arguments[8]&&arguments[8],H=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,F=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,k=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,S=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,o=arguments.length>14&&void 0!==arguments[14]&&arguments[14],U=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const G=k||new M.b(this,7);G.isCube=!0,G.url=B,G.generateMipMaps=!y,G._lodGenerationScale=H,G._lodGenerationOffset=F,G._useSRGBBuffer=!!o&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!y),G!==k&&(G.label=B.substring(0,60)),this._doNotHandleContextLost||(G._extension=N,G._files=C,G._buffer=U);const V=B;this._transformTextureUrl&&!k&&(B=this._transformTextureUrl(B));const c=N??function(B){const I=B.split("?")[0],C=I.lastIndexOf(".");return C>-1?I.substring(C).toLowerCase():""}(B),t=(0,e.c)(c),r=(B,I)=>{G.dispose(),L?L(B,I):B&&x.b.Warn(B)},A=(M,L)=>{B===V?M&&r(M.status+" "+M.statusText,L):(x.b.Warn(`Failed to load ${B}, falling back to the ${V}`),this.createCubeTextureBase(V,I,C,!!y,f,r,g,N,R,H,F,G,q,S,o,U))};if(t)t.then((M=>{const x=B=>{q&&q(G,B),M.loadCubeData(B,G,R,f,((B,I)=>{r(B,I)}))};U?x(U):C&&6===C.length?M.supportCascades?this._cascadeLoadFiles(I,(B=>x(B.map((B=>new Uint8Array(B))))),C,r):r("Textures type does not support cascades."):this._loadFile(B,(B=>x(new Uint8Array(B))),void 0,void 0,!0,A)}));else{if(!C||0===C.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(I,G,((B,I)=>{S&&S(B,I)}),C,r)}return this._internalTexturesCache.push(G),G}},13428:(B,I,C)=>{"use strict";C(11027);var M=C(11324);C(11129),C(11275),C(11126),C(11376),C(11337);M.d},12895:(B,I,C)=>{"use strict";C.d(I,{b:()=>x});var M=C(11149);class x{constructor(B){this.value=this._toInt(B)}_toInt(B){return 0|B}add(B){return new x(this.value+B.value)}FI(B){return new x(this.value-B.value)}multiply(B){return new x(Math.imul(this.value,B.value))}divide(B){return new x(this.value/B.value)}getClassName(){return x.ClassName}equals(B){return this.value===B.value}static FromValue(B){return new x(B)}toString(){return this.value.toString()}}x.ClassName="FlowGraphInteger",(0,M.h)("FlowGraphInteger",x)},12908:(B,I,C)=>{"use strict";C.d(I,{c:()=>x,e:()=>y});var M=C(11194);class x{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Mf=B}get m(){return this.Mf}transformVector(B){return this.transformVectorToRef(B,new M.Vector2)}transformVectorToRef(B,I){return I.x=B.x*this.Mf[0]+B.y*this.Mf[1],I.y=B.x*this.Mf[2]+B.y*this.Mf[3],I}Df(){return this.toArray()}toArray(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let I=0;I<4;I++)B[I]=this.Mf[I];return B}RC(B){for(let I=0;I<4;I++)this.Mf[I]=B[I];return this}multiplyToRef(B,I){const C=B.Mf,M=this.Mf,x=I.Mf;return x[0]=C[0]*M[0]+C[1]*M[2],x[1]=C[0]*M[1]+C[1]*M[3],x[2]=C[2]*M[0]+C[3]*M[2],x[3]=C[2]*M[1]+C[3]*M[3],I}multiply(B){return this.multiplyToRef(B,new x)}divideToRef(B,I){const C=this.Mf,M=B.Mf,x=I.Mf;return x[0]=C[0]/M[0],x[1]=C[1]/M[1],x[2]=C[2]/M[2],x[3]=C[3]/M[3],I}divide(B){return this.divideToRef(B,new x)}addToRef(B,I){const C=this.Mf,M=B.m,x=I.m;return x[0]=C[0]+M[0],x[1]=C[1]+M[1],x[2]=C[2]+M[2],x[3]=C[3]+M[3],I}add(B){return this.addToRef(B,new x)}subtractToRef(B,I){const C=this.Mf,M=B.m,x=I.m;return x[0]=C[0]-M[0],x[1]=C[1]-M[1],x[2]=C[2]-M[2],x[3]=C[3]-M[3],I}FI(B){return this.subtractToRef(B,new x)}transpose(){const B=this.Mf;return new x([B[0],B[2],B[1],B[3]])}determinant(){const B=this.Mf;return B[0]*B[3]-B[1]*B[2]}inverse(){const B=this.determinant();if(0===B)throw new Error("Matrix is not invertible");const I=this.Mf,C=1/B;return new x([I[3]*C,-I[1]*C,-I[2]*C,I[0]*C])}equals(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=this.Mf,M=B.m;return 0===I?C[0]===M[0]&&C[1]===M[1]&&C[2]===M[2]&&C[3]===M[3]:Math.abs(C[0]-M[0])<I&&Math.abs(C[1]-M[1])<I&&Math.abs(C[2]-M[2])<I&&Math.abs(C[3]-M[3])<I}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Mf.join(", ")})`}}class y{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Mf=B}get m(){return this.Mf}transformVector(B){return this.transformVectorToRef(B,new M.HI)}transformVectorToRef(B,I){const C=this.Mf;return I.x=B.x*C[0]+B.y*C[1]+B.z*C[2],I.y=B.x*C[3]+B.y*C[4]+B.z*C[5],I.z=B.x*C[6]+B.y*C[7]+B.z*C[8],I}multiplyToRef(B,I){const C=B.Mf,M=this.Mf,x=I.m;return x[0]=C[0]*M[0]+C[1]*M[3]+C[2]*M[6],x[1]=C[0]*M[1]+C[1]*M[4]+C[2]*M[7],x[2]=C[0]*M[2]+C[1]*M[5]+C[2]*M[8],x[3]=C[3]*M[0]+C[4]*M[3]+C[5]*M[6],x[4]=C[3]*M[1]+C[4]*M[4]+C[5]*M[7],x[5]=C[3]*M[2]+C[4]*M[5]+C[5]*M[8],x[6]=C[6]*M[0]+C[7]*M[3]+C[8]*M[6],x[7]=C[6]*M[1]+C[7]*M[4]+C[8]*M[7],x[8]=C[6]*M[2]+C[7]*M[5]+C[8]*M[8],I}multiply(B){return this.multiplyToRef(B,new y)}divideToRef(B,I){const C=this.Mf,M=B.m,x=I.m;return x[0]=C[0]/M[0],x[1]=C[1]/M[1],x[2]=C[2]/M[2],x[3]=C[3]/M[3],x[4]=C[4]/M[4],x[5]=C[5]/M[5],x[6]=C[6]/M[6],x[7]=C[7]/M[7],x[8]=C[8]/M[8],I}divide(B){return this.divideToRef(B,new y)}addToRef(B,I){const C=this.Mf,M=B.m,x=I.m;return x[0]=C[0]+M[0],x[1]=C[1]+M[1],x[2]=C[2]+M[2],x[3]=C[3]+M[3],x[4]=C[4]+M[4],x[5]=C[5]+M[5],x[6]=C[6]+M[6],x[7]=C[7]+M[7],x[8]=C[8]+M[8],I}add(B){return this.addToRef(B,new y)}subtractToRef(B,I){const C=this.Mf,M=B.m,x=I.m;return x[0]=C[0]-M[0],x[1]=C[1]-M[1],x[2]=C[2]-M[2],x[3]=C[3]-M[3],x[4]=C[4]-M[4],x[5]=C[5]-M[5],x[6]=C[6]-M[6],x[7]=C[7]-M[7],x[8]=C[8]-M[8],I}FI(B){return this.subtractToRef(B,new y)}toArray(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let I=0;I<9;I++)B[I]=this.Mf[I];return B}Df(){return this.toArray()}RC(B){for(let I=0;I<9;I++)this.Mf[I]=B[I];return this}transpose(){const B=this.Mf;return new y([B[0],B[3],B[6],B[1],B[4],B[7],B[2],B[5],B[8]])}determinant(){const B=this.Mf;return B[0]*(B[4]*B[8]-B[5]*B[7])-B[1]*(B[3]*B[8]-B[5]*B[6])+B[2]*(B[3]*B[7]-B[4]*B[6])}inverse(){const B=this.determinant();if(0===B)throw new Error("Matrix is not invertible");const I=this.Mf,C=1/B;return new y([(I[4]*I[8]-I[5]*I[7])*C,(I[2]*I[7]-I[1]*I[8])*C,(I[1]*I[5]-I[2]*I[4])*C,(I[5]*I[6]-I[3]*I[8])*C,(I[0]*I[8]-I[2]*I[6])*C,(I[2]*I[3]-I[0]*I[5])*C,(I[3]*I[7]-I[4]*I[6])*C,(I[1]*I[6]-I[0]*I[7])*C,(I[0]*I[4]-I[1]*I[3])*C])}equals(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const C=this.Mf,M=B.m;return 0===I?C[0]===M[0]&&C[1]===M[1]&&C[2]===M[2]&&C[3]===M[3]&&C[4]===M[4]&&C[5]===M[5]&&C[6]===M[6]&&C[7]===M[7]&&C[8]===M[8]:Math.abs(C[0]-M[0])<I&&Math.abs(C[1]-M[1])<I&&Math.abs(C[2]-M[2])<I&&Math.abs(C[3]-M[3])<I&&Math.abs(C[4]-M[4])<I&&Math.abs(C[5]-M[5])<I&&Math.abs(C[6]-M[6])<I&&Math.abs(C[7]-M[7])<I&&Math.abs(C[8]-M[8])<I}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Mf.join(", ")})`}}},12916:(B,I,C)=>{"use strict";var M;function x(B,I,C,M){switch(I){case"Animation":return M?B.animations.find((B=>B.uniqueId===C))??null:B.animations[C]??null;case"AnimationGroup":return M?B.animationGroups.find((B=>B.uniqueId===C))??null:B.animationGroups[C]??null;case"Mesh":return M?B.meshes.find((B=>B.uniqueId===C))??null:B.meshes[C]??null;case"Material":return M?B.materials.find((B=>B.uniqueId===C))??null:B.materials[C]??null;case"aN":return M?B.cameras.find((B=>B.uniqueId===C))??null:B.cameras[C]??null;case"Light":return M?B.lights.find((B=>B.uniqueId===C))??null:B.lights[C]??null;default:return null}}C.d(I,{b:()=>x}),function(B){B.Animation="Animation",B.AnimationGroup="AnimationGroup",B.Mesh="Mesh",B.Material="Material",B.aN="aN",B.Light="Light"}(M||(M={}))},12950:(B,I,C)=>{"use strict";C.d(I,{b:()=>x});var M=C(12952);class x extends M.b{constructor(B,I){if(super(B),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),I)for(const C of I)this._eventsSignalOutputs[C]=this._registerSignalOutput(C+"Event")}_executeOnTick(B){}_startPendingTasks(B){B._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(B),this._resetAfterCanceled(B)),this._preparePendingTasks(B),B._addPendingBlock(this),this.out._activateSignal(B),B._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(B){B._deleteExecutionVariable(this,"_initialized"),B._removePendingBlock(this)}}},12927:(B,I,C)=>{"use strict";C.d(I,{e:()=>g});var M=C(11156),x=C(11149),y=C(12932),f=C(11022),L=C(12888);class e extends y.c{constructor(B,I,C,M){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:M.defaultValue,y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(B,I,C),this.richType=M,this._defaultValue=x,this._optional=y,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new f.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(B){this._isDisabled!==B&&(this._isDisabled=B,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(B,I){I._getConnectionValue(this)!==B&&(I._setConnectionValue(this,B),this.onValueChangedObservable.notifyObservers(B))}resetToDefaultValue(B){B._setConnectionValue(this,this._defaultValue)}connectTo(B){this._isDisabled||super.connectTo(B)}_getValueOrDefault(B){const I=B._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(I):I}getValue(B){if(1===this.connectionType){B._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(B);const I=this._getValueOrDefault(B);return this._lastValue=I,this.richType.typeTransformer?this.richType.typeTransformer(I):I}const I=this.isConnected()?this._connectedPoint[0].getValue(B):this._getValueOrDefault(B);return this._lastValue=I,this.richType.typeTransformer?this.richType.typeTransformer(I):I}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(B),B.richType={},this.richType.serialize(B.richType),B.optional=this._optional,(0,L.f)("defaultValue",this._defaultValue,B)}}(0,x.h)("FlowGraphDataConnection",e);class g{constructor(B){var I;this.config=B,this.uniqueId=(0,M.c)(),this.name=(null===(I=this.config)||void 0===I?void 0:I.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(B){}registerDataInput(B,I,C){const M=new e(B,0,this,I,C);return this.dataInputs.push(M),M}registerDataOutput(B,I,C){const M=new e(B,1,this,I,C);return this.dataOutputs.push(M),M}getDataInput(B){return this.dataInputs.find((I=>I.name===B))}getDataOutput(B){return this.dataOutputs.find((I=>I.name===B))}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:L.f;if(B.uniqueId=this.uniqueId,B.config={},this.config){const C=this.config,M=Object.keys(C);for(const x of M)I(x,C[x],B.config)}B.dataInputs=[],B.dataOutputs=[],B.className=this.getClassName();for(const C of this.dataInputs){const I={};C.serialize(I),B.dataInputs.push(I)}for(const C of this.dataOutputs){const I={};C.serialize(I),B.dataOutputs.push(I)}}deserialize(B){}_log(B,I,C){var M;null===(M=B.logger)||void 0===M||M.addLogItem({action:I,payload:C,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12932:(B,I,C)=>{"use strict";C.d(I,{c:()=>y});var M,x=C(11156);!function(B){B[B.Input=0]="Input",B[B.Output=1]="Output"}(M||(M={}));class y{constructor(B,I,C){this._ownerBlock=C,this._connectedPoint=[],this.uniqueId=(0,x.c)(),this.connectedPointIds=[],this.name=B,this._connectionType=I}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(B){if(this._connectionType===B._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||B._isSingularConnection()&&B._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(B),B._connectedPoint.push(this)}disconnectFrom(B){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const C=this._connectedPoint.indexOf(B),M=B._connectedPoint.indexOf(this);-1!==C&&-1!==M&&(I&&this._connectedPoint.splice(C,1),B._connectedPoint.splice(M,1))}disconnectFromAll(){for(const B of this._connectedPoint)this.disconnectFrom(B,!1);this._connectedPoint.length=0}dispose(){for(const B of this._connectedPoint)this.disconnectFrom(B)}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};B.uniqueId=this.uniqueId,B.name=this.name,B._connectionType=this._connectionType,B.connectedPointIds=[],B.className=this.getClassName();for(const I of this._connectedPoint)B.connectedPointIds.push(I.uniqueId)}getClassName(){return"FGConnection"}deserialize(B){this.uniqueId=B.uniqueId,this.name=B.name,this._connectionType=B._connectionType,this.connectedPointIds=B.connectedPointIds}}},12880:(B,I,C)=>{"use strict";C.d(I,{d:()=>G});var M,x=C(11022),y=C(11180),f=C(11186),L=C(11156),e=C(12888),g=C(12916),N=C(11027);!function(B){B.ExecuteBlock="ExecuteBlock",B.ExecuteEvent="ExecuteEvent",B.TriggerConnection="TriggerConnection",B.ContextVariableSet="ContextVariableSet",B.GlobalVariableSet="GlobalVariableSet",B.GlobalVariableDelete="GlobalVariableDelete",B.GlobalVariableGet="GlobalVariableGet",B.AddConnection="AddConnection",B.GetConnectionValue="GetConnectionValue",B.SetConnectionValue="SetConnectionValue",B.ActivateSignal="ActivateSignal",B.ContextVariableGet="ContextVariableGet"}(M||(M={}));class R{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(B){if(B.time||(B.time=Date.now()),this.log.push(B),this.logToConsole){var I;const C=null===(I=B.payload)||void 0===I?void 0:I.value;"object"===typeof C&&C.getClassName?N.b.Log(`[FGLog] ${B.className}:${B.uniqueId.split("-")[0]} ${B.action} - ${JSON.stringify(C.getClassName())}: ${C.toString()}`):N.b.Log(`[FGLog] ${B.className}:${B.uniqueId.split("-")[0]} ${B.action} - ${JSON.stringify(B.payload)}`)}}getItemsOfType(B){return this.log.filter((I=>I.action===B))}}class H{get enableLogging(){return this._enableLogging}set enableLogging(B){this._enableLogging!==B&&(this._enableLogging=B,this._enableLogging?(this.logger=new R,this.logger.logToConsole=!0):this.logger=null)}constructor(B){this.uniqueId=(0,L.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new x.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=B,this.assetsContext=B.assetsContext??B.kI}hasVariable(B){return B in this._userVariables}setVariable(B,I){var C;this._userVariables[B]=I,null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:B,value:I}})}getAsset(B,I){return(0,g.b)(this.assetsContext,B,I)}getVariable(B){var I;return null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:B,value:this._userVariables[B]}}),this._userVariables[B]}get userVariables(){return this._userVariables}rB(){return this._configuration.kI}_getUniqueIdPrefixedName(B,I){return`${B.uniqueId}_${I}`}_getGlobalContextVariable(B,I){var C;return null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:B,defaultValue:I,possibleValue:this._globalContextVariables[B]}}),this._hasGlobalContextVariable(B)?this._globalContextVariables[B]:I}_setGlobalContextVariable(B,I){var C;null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:B,value:I}}),this._globalContextVariables[B]=I}_deleteGlobalContextVariable(B){var I;null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:B}}),delete this._globalContextVariables[B]}_hasGlobalContextVariable(B){return B in this._globalContextVariables}_setExecutionVariable(B,I,C){this._executionVariables[this._getUniqueIdPrefixedName(B,I)]=C}_getExecutionVariable(B,I,C){return this._hasExecutionVariable(B,I)?this._executionVariables[this._getUniqueIdPrefixedName(B,I)]:C}_deleteExecutionVariable(B,I){delete this._executionVariables[this._getUniqueIdPrefixedName(B,I)]}_hasExecutionVariable(B,I){return this._getUniqueIdPrefixedName(B,I)in this._executionVariables}_hasConnectionValue(B){return B.uniqueId in this._connectionValues}_setConnectionValue(B,I){var C;this._connectionValues[B.uniqueId]=I,null===(C=this.logger)||void 0===C||C.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:B.uniqueId,value:I}})}_setConnectionValueByKey(B,I){this._connectionValues[B]=I}_getConnectionValue(B){var I;return null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:B.uniqueId,value:this._connectionValues[B.uniqueId]}}),this._connectionValues[B.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(B){this._pendingBlocks.includes(B)||(this._pendingBlocks.push(B),this._pendingBlocks.sort(((B,I)=>B.priority-I.priority)))}_removePendingBlock(B){const I=this._pendingBlocks.indexOf(B);-1!==I&&this._pendingBlocks.splice(I,1)}_clearPendingBlocks(){for(const B of this._pendingBlocks)B._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(B){var I;this.onNodeExecutedObservable.notifyObservers(B),null===(I=this.logger)||void 0===I||I.addLogItem({time:Date.now(),className:B.getClassName(),uniqueId:B.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(B){this._setGlobalContextVariable("timeSinceStart",B.timeSinceStart),this._setGlobalContextVariable("deltaTime",B.deltaTime);for(const C of this._pendingBlocks){var I;null===(I=C._executeOnTick)||void 0===I||I.call(C,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.f;B.uniqueId=this.uniqueId,B._userVariables={};for(const M in this._userVariables)I(M,this._userVariables[M],B._userVariables);B._connectionValues={};for(const M in this._connectionValues)I(M,this._connectionValues[M],B._connectionValues);var C;this.assetsContext!==this.rB()&&(B._assetsContext={meshes:this.assetsContext.meshes.map((B=>B.id)),materials:this.assetsContext.materials.map((B=>B.id)),textures:this.assetsContext.textures.map((B=>B.name)),animations:this.assetsContext.animations.map((B=>B.name)),lights:this.assetsContext.lights.map((B=>B.id)),cameras:this.assetsContext.cameras.map((B=>B.id)),KH:null===(C=this.assetsContext.KH)||void 0===C?void 0:C.map((B=>B.name)),skeletons:this.assetsContext.skeletons.map((B=>B.id)),oH:this.assetsContext.oH.map((B=>B.name)),geometries:this.assetsContext.geometries.map((B=>B.id)),multiMaterials:this.assetsContext.multiMaterials.map((B=>B.id)),transformNodes:this.assetsContext.transformNodes.map((B=>B.id))})}getClassName(){return"FlowGraphContext"}}(0,y.e)([(0,f.K)()],H.prototype,"uniqueId",void 0);var F=C(12923),k=C(11479);class q{constructor(B){this.onEventTriggeredObservable=new x.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=B,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.If.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const B=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:B}}),this._startingTime+=B})),this._meshPickedObserver=this._scene.onPointerObservable.add((B=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:B})}),k.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((B=>{const I=B.pointerId,C=B.mesh,M=this._pointerUnderMeshState[I];!M&&C?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:I,mesh:C}}):M&&!C?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:I,mesh:M}}):M&&C&&M!==C&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:I,mesh:M,over:C}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:I,mesh:C,out:M}})),this._pointerUnderMeshState[I]=C}),k.c.POINTERMOVE)}dispose(){var B,I,C,M,x;null===(B=this._sceneDisposeObserver)||void 0===B||B.remove(),null===(I=this._sceneReadyObserver)||void 0===I||I.remove(),null===(C=this._sceneOnBeforeRenderObserver)||void 0===C||C.remove(),null===(M=this._meshPickedObserver)||void 0===M||M.remove(),null===(x=this._meshUnderPointerObserver)||void 0===x||x.remove(),this.onEventTriggeredObservable.clear()}}var S,o=C(12939);!function(B){B[B.Stopped=0]="Stopped",B[B.Started=1]="Started"}(S||(S={}));class U{get state(){return this._state}set state(B){this._state=B,this.onStateChangedObservable.notifyObservers(B)}constructor(B){this.onStateChangedObservable=new x.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=B.kI,this._sceneEventCoordinator=new q(this._scene),this._coordinator=B.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((B=>{for(const I of this._executionContexts){const C=this._getContextualOrder(B.type,I);for(const M of C)if(!M._executeEvent(I,B.payload))break}switch(B.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const I of this._executionContexts)I._notifyOnTick(B.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const B=new H({kI:this._scene,coordinator:this._coordinator});return this._executionContexts.push(B),B}getContext(B){return this._executionContexts[B]}addEventBlock(B){if("PointerOver"!==B.type&&"PointerOut"!==B.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==B.type&&this._eventBlocks[B.type].push(B),1===this.state)for(const I of this._executionContexts)B._startPendingTasks(I);else this.onStateChangedObservable.addOnce((I=>{if(1===I)for(const C of this._executionContexts)B._startPendingTasks(C)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((B=>{1===B&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const B of this._executionContexts)for(const I in this._eventBlocks){const C=this._getContextualOrder(I,B);for(const I of C)I._startPendingTasks(B)}}_getContextualOrder(B,I){const C=this._eventBlocks[B].sort(((B,I)=>I.initPriority-B.initPriority));if("MeshPick"===B){const B=[];for(const M of C){const x=M.asset.getValue(I);let y=0;for(;y<C.length;y++){const B=C[y].asset.getValue(I);if(x&&B&&(0,o.p)(x,B))break}B.splice(y,0,M)}return B}return C}dispose(){var B;if(0!==this.state){this.state=0;for(const B of this._executionContexts)B._clearPendingBlocks();this._executionContexts.length=0;for(const B in this._eventBlocks)this._eventBlocks[B].length=0;null===(B=this._eventObserver)||void 0===B||B.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(B){const I=[],C=new Set;for(const M in this._eventBlocks)for(const B of this._eventBlocks[M])I.push(B),C.add(B.uniqueId);for(;I.length>0;){const M=I.pop();B(M);for(const B of M.dataInputs)for(const M of B._connectedPoint)C.has(M._ownerBlock.uniqueId)||(I.push(M._ownerBlock),C.add(M._ownerBlock.uniqueId));if(M instanceof F.b)for(const B of M.signalOutputs)for(const M of B._connectedPoint)C.has(M._ownerBlock.uniqueId)||(I.push(M._ownerBlock),C.add(M._ownerBlock.uniqueId))}}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},I=arguments.length>1?arguments[1]:void 0;B.allBlocks=[],this.visitAllBlocks((I=>{const C={};I.serialize(C),B.allBlocks.push(C)})),B.executionContexts=[];for(const C of this._executionContexts){const M={};C.serialize(M,I),B.executionContexts.push(M)}}}class G{constructor(B){this.config=B,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.kI.If.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.kI.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const B=this._executeOnNextFrame.slice(0);if(B.length)for(const I of B){this.notifyCustomEvent(I.id,I.data,!1);const B=this._executeOnNextFrame.findIndex((B=>B.uniqueId===I.uniqueId));-1!==B&&this._executeOnNextFrame.splice(B,1)}}));(G.SceneCoordinators.get(this.config.kI)??[]).push(this)}createGraph(){const B=new U({kI:this.config.kI,coordinator:this});return this._flowGraphs.push(B),B}removeGraph(B){const I=this._flowGraphs.indexOf(B);-1!==I&&(B.dispose(),this._flowGraphs.splice(I,1))}start(){for(const B of this._flowGraphs)B.start()}dispose(){var B,I;for(const x of this._flowGraphs)x.dispose();this._flowGraphs.length=0,null===(B=this._disposeObserver)||void 0===B||B.remove(),null===(I=this._onBeforeRenderObserver)||void 0===I||I.remove();const C=G.SceneCoordinators.get(this.config.kI)??[],M=C.indexOf(this);-1!==M&&C.splice(M,1)}serialize(B,I){B._flowGraphs=[];for(const C of this._flowGraphs){const M={};C.serialize(M,I),B._flowGraphs.push(M)}B.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(B){let I=this._customEventsMap.get(B);return I||(I=new x.e,this._customEventsMap.set(B,I)),I}notifyCustomEvent(B,I){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:B,data:I,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(B)){const I=this._eventExecutionCounter.get(B);if(this._eventExecutionCounter.set(B,I+1),I>=G.MaxEventTypeExecutionPerFrame)return void(I===G.MaxEventTypeExecutionPerFrame&&N.b.Warn(`FlowGraphCoordinator: Too many executions of event "${B}".`))}else this._eventExecutionCounter.set(B,1);const C=this._customEventsMap.get(B);C&&C.notifyObservers(I)}}G.MaxEventsPerType=30,G.MaxEventTypeExecutionPerFrame=30,G.SceneCoordinators=new Map},12945:(B,I,C)=>{"use strict";C.d(I,{d:()=>x});var M=C(12950);class x extends M.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(B){B._notifyExecuteNode(this),this.done._activateSignal(B)}}},12923:(B,I,C)=>{"use strict";C.d(I,{b:()=>L});var M=C(12927),x=C(12932),y=C(11149);class f extends x.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(B){super.connectTo(B),this._connectedPoint.sort(((B,I)=>I.priority-B.priority))}_activateSignal(B){var I;if(null===(I=B.logger)||void 0===I||I.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)B._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(B,this),B._increaseExecutionId();else for(const C of this._connectedPoint)C._activateSignal(B)}}(0,y.h)("FlowGraphSignalConnection",f);class L extends M.e{constructor(B){super(B),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(B){const I=new f(B,0,this);return this.signalInputs.push(I),I}_registerSignalOutput(B){const I=new f(B,1,this);return this.signalOutputs.push(I),I}_unregisterSignalInput(B){const I=this.signalInputs.findIndex((I=>I.name===B));-1!==I&&(this.signalInputs[I].dispose(),this.signalInputs.splice(I,1))}_unregisterSignalOutput(B){const I=this.signalOutputs.findIndex((I=>I.name===B));-1!==I&&(this.signalOutputs[I].dispose(),this.signalOutputs.splice(I,1))}_reportError(B,I){this.error.payload="string"===typeof I?new Error(I):I,this.error._activateSignal(B)}getSignalInput(B){return this.signalInputs.find((I=>I.name===B))}getSignalOutput(B){return this.signalOutputs.find((I=>I.name===B))}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(B),B.signalInputs=[],B.signalOutputs=[];for(const I of this.signalInputs){const C={};I.serialize(C),B.signalInputs.push(C)}for(const I of this.signalOutputs){const C={};I.serialize(C),B.signalOutputs.push(C)}}deserialize(B){for(let I=0;I<B.signalInputs.length;I++){const C=this.getSignalInput(B.signalInputs[I].name);if(!C)throw new Error("Could not find signal input with name "+B.signalInputs[I].name+" in block "+B.className);C.deserialize(B.signalInputs[I])}for(let I=0;I<B.signalOutputs.length;I++){const C=this.getSignalOutput(B.signalOutputs[I].name);if(!C)throw new Error("Could not find signal output with name "+B.signalOutputs[I].name+" in block "+B.className);C.deserialize(B.signalOutputs[I])}}getClassName(){return"FlowGraphExecutionBlock"}}},12952:(B,I,C)=>{"use strict";C.d(I,{b:()=>x});var M=C(12923);class x extends M.b{constructor(B){super(B),this.out=this._registerSignalOutput("out")}}},12901:(B,I,C)=>{"use strict";C.d(I,{D:()=>J,H:()=>A,I:()=>r,b:()=>g,e:()=>H,f:()=>t,g:()=>S,j:()=>o,k:()=>U,m:()=>R,p:()=>c,s:()=>N,w:()=>F,x:()=>k,y:()=>q,z:()=>D});var M,x=C(11194),y=C(11239),f=C(12895),L=C(12908);!function(B){B.Any="any",B.String="string",B.Number="number",B.Boolean="boolean",B.Object="object",B.Integer="FlowGraphInteger",B.Vector2="Vector2",B.HI="HI",B.Vector4="Vector4",B.Quaternion="Quaternion",B.Matrix="Matrix",B.Matrix2D="Matrix2D",B.Matrix3D="Matrix3D",B.SI="SI",B.Pf="Pf"}(M||(M={}));class e{constructor(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=B,this.defaultValue=I,this.animationType=C}serialize(B){B.typeName=this.typeName,B.defaultValue=this.defaultValue}}const g=new e("any",void 0),N=new e("string",""),R=new e("number",0,0),H=new e("boolean",!1),F=new e("Vector2",x.Vector2.Zero(),5),k=new e("HI",x.HI.Zero(),1),q=new e("Vector4",x.Vector4.Zero()),S=new e("Matrix",x.Matrix.Identity(),3),o=new e("Matrix2D",new L.c),U=new e("Matrix3D",new L.e),G=new e("SI",y.SI.Black(),4),V=new e("Pf",new y.Pf(0,0,0,0),7),c=new e("Quaternion",x.Quaternion.Identity(),2);c.typeTransformer=B=>{if(B.getClassName){if("Vector4"===B.getClassName())return x.Quaternion.oI(B.Df());if("HI"===B.getClassName())return x.Quaternion.FromEulerVector(B);if("Matrix"===B.getClassName())return x.Quaternion.FromRotationMatrix(B)}return B};const t=new e("FlowGraphInteger",new f.b(0),0);function r(B){const I=B;switch(typeof B){case"string":return N;case"number":return R;case"boolean":return H;case"object":if(I.getClassName)switch(I.getClassName()){case"Vector2":return F;case"HI":return k;case"Vector4":return q;case"Matrix":return S;case"SI":return G;case"Pf":return V;case"Quaternion":return c;case"FlowGraphInteger":return t;case"Matrix2D":return o;case"Matrix3D":return U}return g;default:return g}}function A(B){switch(B){case"string":return N;case"number":return R;case"boolean":return H;case"Vector2":return F;case"HI":return k;case"Vector4":return q;case"Matrix":return S;case"SI":return G;case"Pf":return V;case"Quaternion":return c;case"FlowGraphInteger":return t;case"Matrix2D":return o;case"Matrix3D":return U;default:return g}}function D(B){switch(B){case"number":default:return 0;case"Vector2":return 5;case"HI":return 1;case"Matrix":return 3;case"SI":return 4;case"Pf":return 7;case"Quaternion":return 2}}function J(B){switch(B){case 0:return R;case 5:return F;case 1:return k;case 3:return S;case 4:return G;case 7:return V;case 2:return c;default:return g}}},12888:(B,I,C)=>{"use strict";C.d(I,{e:()=>N,f:()=>g,i:()=>R});var M=C(11239),x=C(11194),y=C(12895),f=C(12901),L=C(12908);function e(B){return"Vector2"===B||"HI"===B||"Vector4"===B||"Quaternion"===B||"SI"===B||"Pf"===B}function g(B,I,C){var M;const x=(null===I||void 0===I||null===(M=I.getClassName)||void 0===M?void 0:M.call(I))??"";if(e(x)||function(B){return"Matrix"===B||"Matrix2D"===B||"Matrix3D"===B}(x))C[B]={value:I.Df(),className:x};else if("FlowGraphInteger"===x)C[B]={value:I.value,className:x};else if(x&&(I.id||I.name))C[B]={id:I.id,name:I.name,className:x};else{if("object"===typeof I)throw new Error(`Could not serialize value ${I}`);C[B]=I}}function N(B,I,C,g){const R=I[B];let H;const F=(null===R||void 0===R?void 0:R.type)??(null===R||void 0===R?void 0:R.className);if(function(B){return"Mesh"===B||"AbstractMesh"===B||"GroundMesh"===B||"InstanceMesh"===B||"LinesMesh"===B||"GoldbergMesh"===B||"GreasedLineMesh"===B||"TrailMesh"===B}(F)){let B=g.meshes.filter((B=>R.id?B.id===R.id:B.name===R.name));0===B.length&&(B=g.transformNodes.filter((B=>R.id?B.id===R.id:B.name===R.name))),H=R.uniqueId?B.find((B=>B.uniqueId===R.uniqueId)):B[0]}else if(e(F))H=function(B,I){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===B)return x.Vector2.oI(I);if("HI"===B)return C&&(I[2]*=-1),x.HI.oI(I);if("Vector4"===B)return x.Vector4.oI(I);if("Quaternion"===B)return C&&(I[2]*=-1,I[3]*=-1),x.Quaternion.oI(I);if("SI"===B)return new M.SI(I[0],I[1],I[2]);if("Pf"===B)return new M.Pf(I[0],I[1],I[2],I[3]);throw new Error(`Unknown vector class name ${B}`)}(F,R.value);else if(function(B){return"AnimationGroup"===B}(F)){const B=g.animationGroups.filter((B=>B.name===R.name));H=1===B.length?B[0]:B.find((B=>B.uniqueId===R.uniqueId))}else H="Matrix"===F?x.Matrix.oI(R.value):"Matrix2D"===F?new L.c(R.value):"Matrix3D"===F?new L.e(R.value):"FlowGraphInteger"===F?y.b.FromValue(R.value):"number"===F||"string"===F||"boolean"===F?R.value[0]:R&&void 0!==R.value?R.value:Array.isArray(R)?R.reduce(((B,I)=>I.eventData?(B[I.id]={type:(0,f.H)(I.type)},"undefined"!==typeof I.value&&(B[I.id].value=N("value",I,C,g)),B):B),{}):R;return H}function R(B){return"FlowGraphJsonPointerParserBlock"===B}},12939:(B,I,C)=>{"use strict";function M(B,I){return!(!B.parent||B.parent!==I&&!M(B.parent,I))}function x(B){if(B.getClassName)return B.getClassName()}function y(B,I){return B===I&&("Vector2"===B||"HI"===B||"Vector4"===B||"Quaternion"===B)}function f(B,I){return B===I&&("Matrix"===B||"Matrix2D"===B||"Matrix3D"===B)}function L(B,I){return"FlowGraphInteger"===B&&"FlowGraphInteger"===I}function e(B,I){const C="number"===typeof B||"number"===typeof(null===B||void 0===B?void 0:B.value);return C&&!I?!isNaN(g(B)):C}function g(B){return"number"===typeof B?B:B.value}C.d(I,{e:()=>L,h:()=>f,l:()=>y,n:()=>x,p:()=>M,s:()=>g,t:()=>e})},12278:(B,I,C)=>{"use strict";C.r(I),C.d(I,{SceneInstrumentation:()=>y});var M=C(11018),x=C(11417);class y{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(B){B!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=B,B?(this._onBeforeActiveMeshesEvaluationObserver=this.kI.onBeforeActiveMeshesEvaluationObservable.add((()=>{M.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.kI.onAfterActiveMeshesEvaluationObservable.add((()=>{M.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.kI.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.kI.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(B){B!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=B,B?(this._onBeforeRenderTargetsRenderObserver=this.kI.onBeforeRenderTargetsRenderObservable.add((()=>{M.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.kI.onAfterRenderTargetsRenderObservable.add((()=>{M.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.kI.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.kI.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(B){B!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=B,B?(this._onBeforeParticlesRenderingObserver=this.kI.onBeforeParticlesRenderingObservable.add((()=>{M.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.kI.onAfterParticlesRenderingObservable.add((()=>{M.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.kI.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.kI.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(B){B!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=B,this.kI.spriteManagers&&(B?(this._onBeforeSpritesRenderingObserver=this.kI.onBeforeSpritesRenderingObservable.add((()=>{M.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.kI.onAfterSpritesRenderingObservable.add((()=>{M.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.kI.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.kI.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(B){B!==this._capturePhysicsTime&&this.kI.onBeforePhysicsObservable&&(this._capturePhysicsTime=B,B?(this._onBeforePhysicsObserver=this.kI.onBeforePhysicsObservable.add((()=>{M.Tools.StartPerformanceCounter("ke"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.kI.onAfterPhysicsObservable.add((()=>{M.Tools.EndPerformanceCounter("ke"),this._physicsTime.endMonitoring()}))):(this.kI.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.kI.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(B){B!==this._captureAnimationsTime&&(this._captureAnimationsTime=B,B?this._onAfterAnimationsObserver=this.kI.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.kI.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(B){this._captureFrameTime=B}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(B){this._captureInterFrameTime=B}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(B){B!==this._captureRenderTime&&(this._captureRenderTime=B,B?(this._onBeforeDrawPhaseObserver=this.kI.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),M.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.kI.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),M.Tools.EndPerformanceCounter("Main render")}))):(this.kI.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.kI.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(B){B!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=B,B?(this._onBeforeCameraRenderObserver=this.kI.onBeforeCameraRenderObservable.add((B=>{this._cameraRenderTime.beginMonitoring(),M.Tools.StartPerformanceCounter(`Rendering camera ${B.name}`)})),this._onAfterCameraRenderObserver=this.kI.onAfterCameraRenderObservable.add((B=>{this._cameraRenderTime.endMonitoring(!1),M.Tools.EndPerformanceCounter(`Rendering camera ${B.name}`)}))):(this.kI.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.kI.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.kI.getEngine()._drawCalls}constructor(B){this.kI=B,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new x.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new x.b,this._captureFrameTime=!1,this._frameTime=new x.b,this._captureRenderTime=!1,this._renderTime=new x.b,this._captureInterFrameTime=!1,this._interFrameTime=new x.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new x.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new x.b,this._capturePhysicsTime=!1,this._physicsTime=new x.b,this._captureAnimationsTime=!1,this._animationsTime=new x.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new x.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=B.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(M.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.kI.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=B.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(M.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.ny(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.ny(),this._captureParticlesRenderTime&&this._particlesRenderTime.ny(),this._captureSpritesRenderTime&&this._spritesRenderTime.ny(),this._captureRenderTime&&this._renderTime.ny(),this._captureCameraRenderTime&&this._cameraRenderTime.ny()}))}dispose(){this._disposed||(this.kI.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.kI.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.kI.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.kI.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.kI.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.kI.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.kI.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.kI.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.kI.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.kI.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.kI.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.kI.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.kI.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.kI.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.kI.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.kI.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.kI.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.kI=null,this._disposed=!0)}}},12873:(B,I,C)=>{"use strict";C.d(I,{b:()=>N});var M=C(11180),x=C(11186),y=C(11194),f=C(11621),L=C(11725),e=C(11777),g=C(11149);f.d.AddNodeConstructor("Light_Type_1",((B,I)=>()=>new N(B,y.HI.Zero(),I)));class N extends e.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(B){this._shadowFrustumSize=B,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(B){this._shadowOrthoScale=B,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(B){this._orthoLeft=B}get orthoRight(){return this._orthoRight}set orthoRight(B){this._orthoRight=B}get orthoTop(){return this._orthoTop}set orthoTop(B){this._orthoTop=B}get orthoBottom(){return this._orthoBottom}set orthoBottom(B){this._orthoBottom=B}constructor(B,I,C){super(B,C),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=I.scale(-1),this.direction=I}getClassName(){return"Se"}getTypeID(){return L.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(B,I,C){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(B):this._setDefaultAutoExtendShadowProjectionMatrix(B,I,C)}_setDefaultFixedFrustumShadowProjectionMatrix(B){const I=this.rB().activeCamera;I&&y.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:I.uf,void 0!==this.shadowMaxZ?this.shadowMaxZ:I.maxZ,B,this.rB().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(B,I,C){const M=this.rB().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const B=y.HI.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let M=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let f=0;f<C.length;f++){const L=C[f];if(!L)continue;const e=L.getBoundingInfo().boundingBox;for(let C=0;C<e.vectorsWorld.length;C++)y.HI.TransformCoordinatesToRef(e.vectorsWorld[C],I,B),B.x<this._orthoLeft&&(this._orthoLeft=B.x),B.y<this._orthoBottom&&(this._orthoBottom=B.y),B.x>this._orthoRight&&(this._orthoRight=B.x),B.y>this._orthoTop&&(this._orthoTop=B.y),this.autoCalcShadowZBounds&&(B.z<M&&(M=B.z),B.z>x&&(x=B.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=M,this._shadowMaxZ=x)}const x=this._orthoRight-this._orthoLeft,f=this._orthoTop-this._orthoBottom,L=void 0!==this.shadowMinZ?this.shadowMinZ:(null===M||void 0===M?void 0:M.uf)||0,e=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===M||void 0===M?void 0:M.maxZ)||1e4,g=this.rB().getEngine().useReverseDepthBuffer;y.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-x*this.shadowOrthoScale,this._orthoRight+x*this.shadowOrthoScale,this._orthoBottom-f*this.shadowOrthoScale,this._orthoTop+f*this.shadowOrthoScale,g?e:L,g?L:e,B,this.rB().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(B,I){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,I),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,I),this)}transferToNodeMaterialEffect(B,I){return this.computeTransformedInformation()?(B.setFloat3(I,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(B.setFloat3(I,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(B){const I=this._scene.getEngine();return!I.useReverseDepthBuffer&&I.isNDCHalfZRange?0:1}getDepthMaxZ(B){const I=this._scene.getEngine();return I.useReverseDepthBuffer&&I.isNDCHalfZRange?0:1}prepareLightSpecificDefines(B,I){B["DIRLIGHT"+I]=!0}}(0,M.e)([(0,x.K)()],N.prototype,"shadowFrustumSize",null),(0,M.e)([(0,x.K)()],N.prototype,"shadowOrthoScale",null),(0,M.e)([(0,x.K)()],N.prototype,"autoUpdateExtends",void 0),(0,M.e)([(0,x.K)()],N.prototype,"autoCalcShadowZBounds",void 0),(0,M.e)([(0,x.K)("orthoLeft")],N.prototype,"_orthoLeft",void 0),(0,M.e)([(0,x.K)("orthoRight")],N.prototype,"_orthoRight",void 0),(0,M.e)([(0,x.K)("orthoTop")],N.prototype,"_orthoTop",void 0),(0,M.e)([(0,x.K)("orthoBottom")],N.prototype,"_orthoBottom",void 0),(0,g.h)("BABYLON.DirectionalLight",N)},13358:(B,I,C)=>{"use strict";C.d(I,{d:()=>N});var M=C(11180),x=C(11186),y=C(11194),f=C(11239),L=C(11621),e=C(11725),g=C(11149);L.d.AddNodeConstructor("Light_Type_3",((B,I)=>()=>new N(B,y.HI.Zero(),I)));class N extends e.c{constructor(B,I,C){super(B,C),this.groundColor=new f.SI(0,0,0),this.direction=I||y.HI.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Ve"}setDirectionToTarget(B){return this.direction=y.HI.Normalize(B.FI(y.HI.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(B,I){const C=y.HI.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",C.x,C.y,C.z,0,I),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.AL),I),this}transferToNodeMaterialEffect(B,I){const C=y.HI.Normalize(this.direction);return B.setFloat3(I,C.x,C.y,C.z),this}nf(){return this._worldMatrix||(this._worldMatrix=y.Matrix.Identity()),this._worldMatrix}getTypeID(){return e.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(B,I){B["HEMILIGHT"+I]=!0}}(0,M.e)([(0,x.m)()],N.prototype,"groundColor",void 0),(0,M.e)([(0,x.G)()],N.prototype,"direction",void 0),(0,g.h)("BABYLON.HemisphericLight",N)},12833:(B,I,C)=>{"use strict";C.d(I,{b:()=>R});var M=C(11180),x=C(11186),y=C(11194),f=C(11621),L=C(11725),e=C(11777),g=C(11171),N=C(11149);f.d.AddNodeConstructor("Light_Type_2",((B,I)=>()=>new R(B,y.HI.Zero(),y.HI.Zero(),0,0,I)));class R extends e.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(B){this._iesProfileTexture!==B&&(this._iesProfileTexture=B,this._iesProfileTexture&&R._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(B){this._angle=B,this._cosHalfAngle=Math.cos(.5*B),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(B){this._innerAngle=B,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(B){this._shadowAngleScale=B,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(B){this._projectionTextureLightNear=B,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(B){this._projectionTextureLightFar=B,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(B){this._projectionTextureUpDirection=B,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(B){this._projectionTexture!==B&&(this._projectionTexture=B,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(R._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):R._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(B){return void 0!==B.onGeneratedObservable}static _IsTexture(B){return void 0!==B.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(B){this._projectionTextureProjectionLightMatrix=B,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(B,I,C,M,x,f){super(B,f),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=y.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=y.HI.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=y.HI.Zero(),this._projectionTextureViewLightMatrix=y.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=y.Matrix.Zero(),this._projectionTextureScalingMatrix=y.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=I,this.direction=C,this.angle=M,this.exponent=x}getClassName(){return"SpotLight"}getTypeID(){return L.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(B){super._setDirection(B),this._projectionTextureViewLightDirty=!0}_setPosition(B){super._setPosition(B),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(B,I,C){const M=this.rB().activeCamera;if(!M)return;this._shadowAngleScale=this._shadowAngleScale||1;const x=this._shadowAngleScale*this._angle,f=void 0!==this.shadowMinZ?this.shadowMinZ:M.uf,L=void 0!==this.shadowMaxZ?this.shadowMaxZ:M.maxZ,e=this.rB().getEngine().useReverseDepthBuffer;y.Matrix.PerspectiveFovLHToRef(x,1,e?L:f,e?f:L,B,!0,this._scene.getEngine().isNDCHalfZRange,void 0,e)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),y.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const B=this.projectionTextureLightFar,I=this.projectionTextureLightNear,C=B/(B-I),M=-C*I,x=1/Math.tan(this._angle/2);y.Matrix.FromValuesToRef(x/1,0,0,0,0,x,0,0,0,0,C,1,0,0,M,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof g.c){const B=this._projectionTexture.uScale/2,I=this._projectionTexture.vScale/2;y.Matrix.FromValuesToRef(B,0,0,0,0,I,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(B,I){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),B.setMatrix("textureProjectionMatrix"+I,this._projectionTextureMatrix),B.setTexture("projectionLightTexture"+I,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&B.setTexture("iesLightTexture"+I,this._iesProfileTexture),this}transferToEffect(B,I){let C;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,I),C=y.HI.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,I),C=y.HI.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",C.x,C.y,C.z,this._cosHalfAngle,I),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,I),this}transferToNodeMaterialEffect(B,I){let C;return C=this.computeTransformedInformation()?y.HI.Normalize(this.transformedDirection):y.HI.Normalize(this.direction),this.rB().useRightHandedSystem?B.setFloat3(I,-C.x,-C.y,-C.z):B.setFloat3(I,C.x,C.y,C.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(B){const I=this._scene.getEngine(),C=void 0!==this.shadowMinZ?this.shadowMinZ:(null===B||void 0===B?void 0:B.uf)??0;return I.useReverseDepthBuffer&&I.isNDCHalfZRange?C:this._scene.getEngine().isNDCHalfZRange?0:C}getDepthMaxZ(B){const I=this._scene.getEngine(),C=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===B||void 0===B?void 0:B.maxZ)??1e4;return I.useReverseDepthBuffer&&I.isNDCHalfZRange?0:C}prepareLightSpecificDefines(B,I){B["SPOTLIGHT"+I]=!0,B["PROJECTEDLIGHTTEXTURE"+I]=!(!this.projectionTexture||!this.projectionTexture.isReady()),B["IESLIGHTTEXTURE"+I]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,M.e)([(0,x.K)()],R.prototype,"angle",null),(0,M.e)([(0,x.K)()],R.prototype,"innerAngle",null),(0,M.e)([(0,x.K)()],R.prototype,"shadowAngleScale",null),(0,M.e)([(0,x.K)()],R.prototype,"exponent",void 0),(0,M.e)([(0,x.K)()],R.prototype,"projectionTextureLightNear",null),(0,M.e)([(0,x.K)()],R.prototype,"projectionTextureLightFar",null),(0,M.e)([(0,x.K)()],R.prototype,"projectionTextureUpDirection",null),(0,M.e)([(0,x.B)("projectedLightTexture")],R.prototype,"_projectionTexture",void 0),(0,N.h)("BABYLON.SpotLight",R)},12540:(B,I,C)=>{"use strict";C.d(I,{b:()=>f,e:()=>y,f:()=>L});const M={},x={};function y(B,I){M[B]=I}function f(B,I){x[B]=I}function L(B){return x[B]?x[B]:null}},12446:(B,I,C)=>{"use strict";C.d(I,{e:()=>r,h:()=>d});var M,x=C(11018),y=C(11022),f=C(11440),L=C(11056),e=C(11027),g=C(11655),N=C(11062),R=C(11069),H=C(11156),F=C(11096),k=C(11051);!function(B){B[B.Clean=0]="Clean",B[B.Stop=1]="Stop",B[B.Sync=2]="Sync",B[B.NoSync=3]="NoSync"}(M||(M={}));const q=new y.e,S={};let o=!1;function U(){return S[".babylon"]}function G(B,I){const C=S[B];return C||(e.b.Warn("Unable to find a plugin to load "+B+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),I?U():void 0)}function V(B,I,C){let M="Unable to load from "+(B.rawData?"binary data":B.url);return I?M+=`: ${I}`:C&&(M+=`: ${C}`),M}async function c(B,I,C,M,x,y,f,L,e){var g;const R="data:"===(H=B.url).substring(0,5)?H.substring(5):null;var H;if(B.rawData&&!f)throw"When using ArrayBufferView to load data the file extension must be provided.";const o=R||f?"":function(B){const I=B.indexOf("?");-1!==I&&(B=B.substring(0,I));const C=B.lastIndexOf(".");return B.substring(C,B.length).toLowerCase()}(B.url);let V=f?G(f,!0):R?function(B){for(const I in S){const C=S[I].plugin;if(C.canDirectLoad&&C.canDirectLoad(B))return S[I]}return U()}(B.url):G(o,!1);if(!V&&o){if(B.url&&!B.url.startsWith("blob:")){const I=await async function(B,I){const C=I.method||"GET";return await new Promise(((M,x)=>{const y=new k.c;y.addEventListener("readystatechange",(()=>{if(4==y.readyState)if(200==y.status){const B={};if(I.responseHeaders)for(const C of I.responseHeaders)B[C]=y.getResponseHeader(C)||"";M({response:y.response,headerValues:B})}else x(`Unable to fetch data from ${B}. Error code: ${y.status}`)})),y.open(C,B),y.send()}))}(B.url,{method:"HEAD",responseHeaders:["Content-Type"]}),C=I.headerValues?I.headerValues["Content-Type"]:"";C&&(V=function(B){for(const I in S){const C=S[I];if(C.mimeType===B)return C}}(C))}V||(V=U())}if(!V)throw new Error(`No plugin or fallback for ${f??B.url}`);if(!1===(null===e||void 0===e||null===(g=e[V.plugin.name])||void 0===g?void 0:g.enabled))throw new Error(`The '${V.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(B.rawData&&!V.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(B=>{if(V.plugin.createPlugin){const I=V.plugin.createPlugin(e??{});return I instanceof Promise?(I.then(B).catch((B=>{x("Error instantiating plugin.",B)})),null):(B(I),I)}return B(V.plugin),V.plugin})((e=>{var g;if(!e)throw`The loader plugin corresponding to the '${f}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(q.notifyObservers(e),R&&(e.canDirectLoad&&e.canDirectLoad(B.url)||!(0,N.k)(B.url))){if(e.directLoad){const B=e.directLoad(I,R);B instanceof Promise?B.then((B=>{C(e,B)})).catch((B=>{x("Error in directLoad of _loadData: "+B,B)})):C(e,B)}else C(e,R);return}const H=V.isBinary,k=(B,M)=>{I.R?x("Scene has been disposed"):C(e,B,M)};let S=null,o=!1;null===(g=e.If)||void 0===g||g.add((()=>{o=!0,S&&(S.abort(),S=null),y()}));const U=()=>{if(o)return;const C=(B,I)=>{x(null===B||void 0===B?void 0:B.statusText,I)};if(!e.loadFile&&B.rawData)throw"Plugin does not support loading ArrayBufferView.";S=e.loadFile?e.loadFile(I,B.rawData||B.file||B.url,B.rootUrl,k,M,H,C,L):I._loadFile(B.file||B.url,k,M,!0,H,C)},G=I.getEngine();let c=G.enableOfflineSupport;if(c){let C=!1;for(const M of I.disableOfflineSupportExceptionRules)if(M.test(B.url)){C=!0;break}c=!C}c&&F.e.OfflineProviderFactory?I.offlineProvider=F.e.OfflineProviderFactory(B.url,U,G.disableManifestCheck):U()}))}function t(B,I){let C,M,y=null,f=null;if(I)if(I.name)C=`file:${I.name}`,M=I.name,y=I;else if(ArrayBuffer.isView(I))C="",M=(0,H.c)(),f=I;else if(I.startsWith("data:"))C=I,M="";else if(B){const y=I;if("/"===y.substring(0,1))return x.Tools.Error("Wrong sceneFilename parameter"),null;C=B+y,M=y}else C=I,M=x.Tools.GetFilename(I),B=x.Tools.GetFolderPath(I);else C=B,M=x.Tools.GetFilename(B),B=x.Tools.GetFolderPath(B);return{url:C,rootUrl:B,name:M,file:y,rawData:f}}function r(B){if("string"===typeof B.extensions){const I=B.extensions;S[I.toLowerCase()]={plugin:B,isBinary:!1}}else{const I=B.extensions,C=Object.keys(I);for(const M of C)S[M.toLowerCase()]={plugin:B,isBinary:I[M].isBinary,mimeType:I[M].mimeType}}}async function A(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:L.c.LastCreatedScene,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",H=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!M)return e.b.Error("No scene available to import mesh to"),null;const F=t(I,C);if(!F)return null;const k={};M.addPendingData(k);const q=()=>{M.removePendingData(k)},S=(B,I)=>{const C=V(F,B,I);f?f(M,C,new R.j(C,R.f.SceneLoaderError,I)):e.b.Error(C),q()},o=y?B=>{try{y(B)}catch(I){S("Error in onProgress callback: "+I,I)}}:void 0,U=(B,I,C,y,f,L,e,g)=>{if(M.importedMeshesFiles.push(F.url),x)try{x(B,I,C,y,f,L,e,g)}catch(N){S("Error in onSuccess callback: "+N,N)}M.removePendingData(k)};return await c(F,M,((I,C,x)=>{if(I.rewriteRootURL&&(F.rootUrl=I.rewriteRootURL(F.rootUrl,x)),I.importMesh){const x=[],y=[],f=[];if(!I.importMesh(B,M,C,F.rootUrl,x,y,f,S))return;M.loadingPluginName=I.name,U(x,y,f,[],[],[],[],[])}else{I.importMeshAsync(B,M,C,F.rootUrl,o,F.name).then((B=>{M.loadingPluginName=I.name,U(B.meshes,B.oH,B.skeletons,B.animationGroups,B.transformNodes,B.geometries,B.lights,B.spriteManagers)})).catch((B=>{S(B.message,B)}))}}),o,S,q,g,N,H)}async function D(B,I,C,M,x,y,f,L){return await new Promise(((e,g)=>{try{A(B,I,C,M,((B,I,C,M,x,y,f,L)=>{e({meshes:B,oH:I,skeletons:C,animationGroups:M,transformNodes:x,geometries:y,lights:f,spriteManagers:L})}),x,((B,I,C)=>{g(C||new Error(I))}),y,f,L).catch(g)}catch(R){g(R)}}))}async function J(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:L.c.LastCreatedEngine,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};C?await u(B,I,new f.b(C),M,y,e,g,N,R):x.Tools.Error("No engine available")}async function i(B,I,C,M,x,y,f){return await new Promise(((L,e)=>{J(B,I,C,(B=>{L(B)}),M,((B,I,C)=>{e(C||new Error(I))}),x,y,f)}))}async function u(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:L.c.LastCreatedScene,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,N=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",H=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!C)return e.b.Error("No scene available to append to"),null;const F=t(B,I);if(!F)return null;const k={};C.addPendingData(k);const q=()=>{C.removePendingData(k)};g.c.ShowLoadingScreen&&!o&&(o=!0,C.getEngine().displayLoadingUI(),C.executeWhenReady((()=>{C.getEngine().hideLoadingUI(),o=!1})));const S=(B,I)=>{const M=V(F,B,I);y?y(C,M,new R.j(M,R.f.SceneLoaderError,I)):e.b.Error(M),q()},U=x?B=>{try{x(B)}catch(I){S("Error in onProgress callback",I)}}:void 0,G=()=>{if(M)try{M(C)}catch(B){S("Error in onSuccess callback",B)}C.removePendingData(k)};return await c(F,C,((B,I)=>{if(B.load){if(!B.load(C,I,F.rootUrl,S))return;C.loadingPluginName=B.name,G()}else{B.loadAsync(C,I,F.rootUrl,U,F.name).then((()=>{C.loadingPluginName=B.name,G()})).catch((B=>{S(B.message,B)}))}}),U,S,q,f,N,H)}async function p(B,I,C,M,x,y,f){return await new Promise(((L,e)=>{try{u(B,I,C,(B=>{L(B)}),M,((B,I,C)=>{e(C||new Error(I))}),x,y,f).catch(e)}catch(R){e(R)}}))}async function n(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:L.c.LastCreatedScene,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!C)return e.b.Error("No scene available to load asset container to"),null;const H=t(B,I);if(!H)return null;const F={};C.addPendingData(F);const k=()=>{C.removePendingData(F)},q=(B,I)=>{const M=V(H,B,I);y?y(C,M,new R.j(M,R.f.SceneLoaderError,I)):e.b.Error(M),k()},S=x?B=>{try{x(B)}catch(I){q("Error in onProgress callback",I)}}:void 0,o=B=>{if(M)try{M(B)}catch(I){q("Error in onSuccess callback",I)}C.removePendingData(F)};return await c(H,C,((B,I)=>{if(B.loadAssetContainer){const M=B.loadAssetContainer(C,I,H.rootUrl,q);if(!M)return;M.populateRootNodes(),C.loadingPluginName=B.name,o(M)}else if(B.loadAssetContainerAsync){B.loadAssetContainerAsync(C,I,H.rootUrl,S,H.name).then((I=>{I.populateRootNodes(),C.loadingPluginName=B.name,o(I)})).catch((B=>{q(B.message,B)}))}else q("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),S,q,k,f,g,N)}async function O(B,I,C,M,x,y,f){return await new Promise(((L,e)=>{try{n(B,I,C,(B=>{L(B)}),M,((B,I,C)=>{e(C||new Error(I))}),x,y,f).catch(e)}catch(R){e(R)}}))}async function a(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:L.c.LastCreatedScene,M=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,R=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,H=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",F=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!C)return void e.b.Error("No scene available to load animations to");if(M){for(const M of C.animatables)M.reset();C.stopAllAnimations();const B=C.animationGroups.slice();for(const C of B)C.dispose();const I=C.getNodes();for(const C of I)C.animations&&(C.animations=[])}else switch(x){case 0:const B=C.animationGroups.slice();for(const I of B)I.dispose();break;case 1:for(const I of C.animationGroups)I.stop();break;case 2:for(const I of C.animationGroups)I.reset(),I.restart();break;case 3:break;default:return void e.b.Error("Unknown animation group loading mode value '"+x+"'")}const k=C.animatables.length;await n(B,I,C,(B=>{B.mergeAnimationsTo(C,C.animatables.slice(k),y),B.dispose(),C.onAnimationFileImportedObservable.notifyObservers(C),f&&f(C)}),g,N,R,H,F)}async function W(B,I,C,M,x,y,f,L,e,g){return await new Promise(((N,H)=>{try{a(B,I,C,M,x,y,(B=>{N(B)}),f,((B,I,C)=>{H(C||new Error(I))}),L,e,g).catch(H)}catch(R){H(R)}}))}class d{static get ForceFullSceneLoadingForIncremental(){return g.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(B){g.c.ForceFullSceneLoadingForIncremental=B}static get ShowLoadingScreen(){return g.c.ShowLoadingScreen}static set ShowLoadingScreen(B){g.c.ShowLoadingScreen=B}static get loggingLevel(){return g.c.loggingLevel}static set loggingLevel(B){g.c.loggingLevel=B}static get CleanBoneMatrixWeights(){return g.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(B){g.c.CleanBoneMatrixWeights=B}static GetDefaultPlugin(){return U()}static GetPluginForExtension(B){var I;return null===(I=G(B,!0))||void 0===I?void 0:I.plugin}static IsPluginForExtensionAvailable(B){return function(B){return!!S[B]}(B)}static RegisterPlugin(B){r(B)}static ImportMesh(B,I,C,M,x,y,f,e,g){A(B,I,C,M,x,y,f,e,g).catch((B=>null===f||void 0===f?void 0:f(L.c.LastCreatedScene,null===B||void 0===B?void 0:B.message,B)))}static async ImportMeshAsync(B,I,C,M,x,y,f){return await D(B,I,C,M,x,y,f)}static Load(B,I,C,M,x,y,f,e){J(B,I,C,M,x,y,f,e).catch((B=>null===y||void 0===y?void 0:y(L.c.LastCreatedScene,null===B||void 0===B?void 0:B.message,B)))}static async LoadAsync(B,I,C,M,x,y){return await i(B,I,C,M,x,y)}static Append(B,I,C,M,x,y,f,e){u(B,I,C,M,x,y,f,e).catch((B=>null===y||void 0===y?void 0:y(C??L.c.LastCreatedScene,null===B||void 0===B?void 0:B.message,B)))}static async AppendAsync(B,I,C,M,x,y){return await p(B,I,C,M,x,y)}static LoadAssetContainer(B,I,C,M,x,y,f,e){n(B,I,C,M,x,y,f,e).catch((B=>null===y||void 0===y?void 0:y(C??L.c.LastCreatedScene,null===B||void 0===B?void 0:B.message,B)))}static async LoadAssetContainerAsync(B,I,C,M,x,y){return await O(B,I,C,M,x,y)}static ImportAnimations(B,I,C,M,x,y,f,e,g,N,R){a(B,I,C,M,x,y,f,e,g,N,R).catch((B=>null===g||void 0===g?void 0:g(C??L.c.LastCreatedScene,null===B||void 0===B?void 0:B.message,B)))}static async ImportAnimationsAsync(B,I,C,M,x,y,f,L,e,g,N){return await W(B,I,C,M,x,y,L,g,N)}}d.NO_LOGGING=0,d.MINIMAL_LOGGING=1,d.SUMMARY_LOGGING=2,d.DETAILED_LOGGING=3,d.OnPluginActivatedObservable=q},12852:(B,I,C)=>{"use strict";C.d(I,{c:()=>H});var M=C(11180),x=C(11186),y=C(11018),f=C(11194),L=C(11217),e=C(11171),g=C(11149),N=C(11022),R=C(11226);C(12858);class H extends L.c{set boundingBoxSize(B){if(this._boundingBoxSize&&this._boundingBoxSize.equals(B))return;this._boundingBoxSize=B;const I=this.rB();I&&I.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(B){this._rotationY=B,this.setReflectionTextureMatrix(f.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(B,I,C){let M="";for(const x of B)M+=x;return new H(M,I,null,C,B)}static CreateFromPrefilteredData(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,M=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const x=I.useDelayedTextureLoading;I.useDelayedTextureLoading=!1;const y=new H(B,I,null,!1,null,null,null,void 0,!0,C,M);return I.useDelayedTextureLoading=x,y}constructor(B,I){var C;let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,H=arguments.length>8&&void 0!==arguments[8]&&arguments[8],F=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,k=arguments.length>10&&void 0!==arguments[10]&&arguments[10],q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,S=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,o=arguments.length>13?arguments[13]:void 0,U=arguments.length>14?arguments[14]:void 0;super(I),this.onLoadObservable=new N.e,this.boundingBoxPosition=f.HI.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new f.Matrix,this._buffer=null,this.name=B,this.url=B,this._noMipmap=x,this.if=!1,this.isCube=!0,this._textureMatrix=f.Matrix.Identity(),this.coordinatesMode=e.c.CUBIC_MODE;let G=null,V=null;null===M||Array.isArray(M)?(this._noMipmap=x,this._format=R,this._createPolynomials=k,G=M,this._loaderOptions=o,this._useSRGBBuffer=U,this._lodScale=q,this._lodOffset=S):(G=M.extensions??null,this._noMipmap=M.noMipmap??!1,y=M.files??null,V=M.buffer??null,this._format=M.format??5,H=M.prefiltered??!1,F=M.forcedExtension??null,this._createPolynomials=M.createPolynomials??!1,this._lodScale=M.lodScale??.8,this._lodOffset=M.lodOffset??0,this._loaderOptions=M.loaderOptions,this._useSRGBBuffer=M.useSRGBBuffer,L=M.h??null,g=M.onError??null),(B||y)&&this.updateURL(B,F,L,H,g,G,null===(C=this.rB())||void 0===C?void 0:C.useDelayedTextureLoading,y,V)}getClassName(){return"CubeTexture"}updateURL(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,M=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=B),this.url=B,I&&(this._forcedExtension=I);const g=B.lastIndexOf("."),N=I||(g>-1?B.substring(g).toLowerCase():""),R=0===N.indexOf(".dds"),H=0===N.indexOf(".env"),F=0===N.indexOf(".basis");if(H?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=M,M&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),L)this._files=L;else if(F||H||R||y||(y=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,y){for(let I=0;I<y.length;I++)this._files.push(B+y[I]);this._extensions=y}this._buffer=e,f?(this.delayLoadState=4,this._delayedOnLoad=C,this._delayedOnError=x):this._loadTexture(C,x)}delayLoad(B){4===this.delayLoadState&&(B&&(this._forcedExtension=B),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(B){var I,C;if(B.updateFlag===this._textureMatrix.updateFlag)return;B.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(C=this.rB())||void 0===C||C.markAllMaterialsAsDirty(1,(B=>-1!==B.getActiveTextures().indexOf(this))));if(this._textureMatrix=B,null===(I=this.rB())||void 0===I||!I.useRightHandedSystem)return;const M=f.TmpVectors.HI[0],x=f.TmpVectors.Quaternion[0],y=f.TmpVectors.HI[1];this._textureMatrix.decompose(M,x,y),x.z*=-1,x.w*=-1,f.Matrix.ComposeToRef(M,x,y,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var B;return null!==(B=this.rB())&&void 0!==B&&B.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=this.rB(),M=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const x=()=>{var I;(this.onLoadObservable.notifyObservers(this),M)&&(M.dispose(),null===(I=this.rB())||void 0===I||I.markAllMaterialsAsDirty(1));B&&B()},f=(B,C)=>{this._loadingError=!0,this._errorObject={message:B,exception:C},I&&I(B,C),e.c.OnTextureLoadErrorObservable.notifyObservers(this)};var L;this._texture?this._texture.isReady?y.Tools.SetImmediate((()=>x())):this._texture.onLoadedObservable.add((()=>x())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,C,this._lodScale,this._lodOffset,B,f,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,C,this._files,this._noMipmap,B,f,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(L=this._texture)||void 0===L||L.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(B,I,C){const M=R.d.Parse((()=>{let M=!1;return B.prefiltered&&(M=B.prefiltered),new H(C+(B.url??B.name),I,B.extensions,!1,B.files||null,null,null,void 0,M,B.forcedExtension)}),B,I);if(B.boundingBoxPosition&&(M.boundingBoxPosition=f.HI.oI(B.boundingBoxPosition)),B.boundingBoxSize&&(M.boundingBoxSize=f.HI.oI(B.boundingBoxSize)),B.animations)for(let x=0;x<B.animations.length;x++){const I=B.animations[x],C=(0,g.e)("BABYLON.Animation");C&&M.animations.push(C.Parse(I))}return M}clone(){let B=0;const I=R.d.Clone((()=>{const I=new H(this.url,this.rB()||this._getEngine(),this._extensions,this._noMipmap,this._files);return B=I.uniqueId,I}),this);return I.uniqueId=B,I}}(0,M.e)([(0,x.K)()],H.prototype,"url",void 0),(0,M.e)([(0,x.G)()],H.prototype,"boundingBoxPosition",void 0),(0,M.e)([(0,x.G)()],H.prototype,"boundingBoxSize",null),(0,M.e)([(0,x.K)("rotationY")],H.prototype,"rotationY",null),(0,M.e)([(0,x.K)("files")],H.prototype,"_files",void 0),(0,M.e)([(0,x.K)("forcedExtension")],H.prototype,"_forcedExtension",void 0),(0,M.e)([(0,x.K)("extensions")],H.prototype,"_extensions",void 0),(0,M.e)([(0,x.w)("textureMatrix")],H.prototype,"_textureMatrix",void 0),(0,M.e)([(0,x.w)("textureMatrixRefraction")],H.prototype,"_textureMatrixRefraction",void 0),e.c._CubeTextureParser=H.Parse,(0,g.h)("BABYLON.CubeTexture",H)},13376:(B,I,C)=>{"use strict";C.d(I,{e:()=>e});var M=C(11027),x=C(11171),y=C(11161),f=C(11332),L=C(11129);f.ThinEngine.prototype.createDynamicTexture=function(B,I,C,M){const x=new L.b(this,4);return x.baseWidth=B,x.baseHeight=I,C&&(B=this.needPOTTextures?(0,y.f)(B,this._caps.maxTextureSize):B,I=this.needPOTTextures?(0,y.f)(I,this._caps.maxTextureSize):I),x.width=B,x.height=I,x.isReady=!1,x.generateMipMaps=C,x.samplingMode=M,this.updateTextureSamplingMode(M,x),this._internalTexturesCache.push(x),x},f.ThinEngine.prototype.updateDynamicTexture=function(B,I,C){let M=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4?arguments[4]:void 0,y=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!B)return;const f=this._gl,L=f.TEXTURE_2D,e=this._bindTextureDirectly(L,B,!0,y);this._unpackFlipY(void 0===C?B.invertY:C),M&&f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const g=this._getWebGLTextureType(B.type),N=this._getInternalFormat(x||B.format),R=this._getRGBABufferInternalSizedFormat(B.type,N);f.texImage2D(L,0,R,N,g,I),B.generateMipMaps&&f.generateMipmap(L),e||this._bindTextureDirectly(L,null),M&&f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),x&&(B.format=x),B._dynamicTextureSource=I,B._premulAlpha=M,B.invertY=C||!1,B.isReady=!0};class e extends x.c{constructor(B,I,C){let M=arguments.length>3&&void 0!==arguments[3]&&arguments[3],y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,L=arguments.length>6?arguments[6]:void 0;const e=!C||C._isScene;super(null,e?C:null===C||void 0===C?void 0:C.kI,e?!M:C,L,y,void 0,void 0,void 0,void 0,f),this.name=B,this.wrapU=x.c.CLAMP_ADDRESSMODE,this.wrapV=x.c.CLAMP_ADDRESSMODE,this._generateMipMaps=M;const g=this._getEngine();if(!g)return;if(I.getContext)this._canvas=I,this._ownCanvas=!1,this._texture=g.createDynamicTexture(this._canvas.width,this._canvas.height,M,y);else{this._canvas=g.createCanvas(1,1),this._ownCanvas=!0;const B=I;B.width||0===B.width?this._texture=g.createDynamicTexture(B.width,B.height,M,y):this._texture=g.createDynamicTexture(I,I,M,y)}const N=this.getSize();this._canvas.width!==N.width&&(this._canvas.width=N.width),this._canvas.height!==N.height&&(this._canvas.height=N.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(B){this._canvas.width=B.width,this._canvas.height=B.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(B.width,B.height,this._generateMipMaps,this.samplingMode)}scale(B){const I=this.getSize();I.width*=B,I.height*=B,this._recreate(I)}scaleTo(B,I){const C=this.getSize();C.width=B,C.height=I,this._recreate(C)}getContext(){return this._context}clear(B){const I=this.getSize();B&&(this._context.fillStyle=B),this._context.clearRect(0,0,I.width,I.height)}update(B){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===B||B,I,this._format||void 0,void 0,C)}drawText(B,I,C,M,x,y,f){let L=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const e=this.getSize();if(y&&(this._context.fillStyle=y,this._context.fillRect(0,0,e.width,e.height)),this._context.font=M,null===I||void 0===I){const C=this._context.measureText(B);I=(e.width-C.width)/2}if(null===C||void 0===C){const B=parseInt(M.replace(/\D/g,""));C=e.height/2+B/3.65}this._context.fillStyle=x||"",this._context.fillText(B,I,C),L&&this.update(f)}dispose(){var B,I;(super.dispose(),this._ownCanvas)&&(null===(B=this._canvas)||void 0===B||null===(I=B.remove)||void 0===I||I.call(B));this._canvas=null,this._context=null}clone(){const B=this.rB();if(!B)return this;const I=this.getSize(),C=new e(this.name,I,B,this._generateMipMaps);return C.if=this.if,C.level=this.level,C.wrapU=this.wrapU,C.wrapV=this.wrapV,C}serialize(){const B=this.rB();B&&!B.isReady()&&M.b.Warn("The scene must be ready before serializing the dynamic texture");const I=super.serialize();return e._IsCanvasElement(this._canvas)&&(I.base64String=this._canvas.toDataURL()),I.invertY=this._invertY,I.samplingMode=this.samplingMode,I}static _IsCanvasElement(B){return void 0!==B.toDataURL}_rebuild(){this.update()}}},12766:(B,I,C)=>{"use strict";C.d(I,{e:()=>x});var M=C(11171);class x extends M.c{get depth(){return this._depth}constructor(B,I,C,x,y,f){let L=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],e=arguments.length>7&&void 0!==arguments[7]&&arguments[7],g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:M.c.TRILINEAR_SAMPLINGMODE,N=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,R=arguments.length>10?arguments[10]:void 0;super(null,f,!L,e),this.format=y,this._texture=f.getEngine().createRawTexture2DArray(B,I,C,x,y,L,e,g,null,N,R),this._depth=x,this.is2DArray=!0}update(B){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,B,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(B,I,C,M,y){return new x(B,I,C,M,5,y,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12564:(B,I,C)=>{"use strict";C.d(I,{c:()=>L,d:()=>e,g:()=>y,j:()=>f});var M=C(11212),x=C(11194);function y(B,I){return`{X: ${B.x.toFixed(I)} Y: ${B.y.toFixed(I)}}`}function f(B,I){return`{X: ${B._x.toFixed(I)} Y: ${B._y.toFixed(I)} Z: ${B._z.toFixed(I)}}`}function L(B,I){return 2*Math.acos((0,M.Clamp)(x.Quaternion.Dot(B,I)))}function e(B,I){const C=new x.Quaternion;return function(B,I,C){const y=x.HI.Cross(B,I),f=Math.acos((0,M.Clamp)(x.HI.Dot(B,I),-1,1));x.Quaternion.RotationAxisToRef(y,f,C)}(B,I,C),C}},12385:(B,I,C)=>{"use strict";C.d(I,{c:()=>g});var M=C(11194),x=C(11239),y=C(11645),f=C(11633),L=C(11247);C(12393);function e(B){let I=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const C=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],y=[];let e=[];const g=B.width||B.size||1,N=B.height||B.size||1,R=B.depth||B.size||1,H=B.wrap||!1;let F=void 0===B.topBaseAt?1:B.topBaseAt,k=void 0===B.bottomBaseAt?0:B.bottomBaseAt;F=(F+4)%4,k=(k+4)%4;let q=[2,0,3,1][F],S=[2,0,1,3][k],o=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(H){I=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],o=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let B=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],C=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const M=[17,18,19,16],x=[22,23,20,21];for(;q>0;)B.unshift(B.pop()),M.unshift(M.pop()),q--;for(;S>0;)C.unshift(C.pop()),x.unshift(x.pop()),S--;B=B.flat(),C=C.flat(),o=o.concat(B).concat(C),I.push(M[0],M[2],M[3],M[0],M[1],M[2]),I.push(x[0],x[2],x[3],x[0],x[1],x[2])}const U=[g/2,N/2,R/2];e=o.reduce(((B,I,C)=>B.concat(I*U[C%3])),[]);const G=0===B.sideOrientation?0:B.sideOrientation||f.e.DEFAULTSIDE,V=B.faceUV||new Array(6),c=B.faceColors,t=[];for(let f=0;f<6;f++)void 0===V[f]&&(V[f]=new M.Vector4(0,0,1,1)),c&&void 0===c[f]&&(c[f]=new x.Pf(1,1,1,1));for(let M=0;M<6;M++)if(y.push(V[M].z,L.b?1-V[M].w:V[M].w),y.push(V[M].x,L.b?1-V[M].w:V[M].w),y.push(V[M].x,L.b?1-V[M].y:V[M].y),y.push(V[M].z,L.b?1-V[M].y:V[M].y),c)for(let B=0;B<4;B++)t.push(c[M].r,c[M].g,c[M].b,c[M].a);f.e._ComputeSides(G,e,I,C,y,B.frontUVs,B.backUVs);const r=new f.e;if(r.indices=I,r.DB=e,r.JB=C,r.uB=y,c){const B=G===f.e.DOUBLESIDE?t.concat(t):t;r.iB=B}return r}function g(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new y.b(B,C);I.sideOrientation=y.b._GetDefaultSideOrientation(I.sideOrientation),M._originalBuilderSideOrientation=I.sideOrientation;return e(I).nB(M,I.updatable),M}f.e.CreateBox=e,y.b.CreateBox=function(B,I){return g(B,{size:I,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12549:(B,I,C)=>{"use strict";C.d(I,{d:()=>L});var M=C(11645),x=C(11633),y=C(11247);function f(B){const I=[],C=[],M=[],f=[],L=B.radius||.5,e=B.tessellation||64,g=B.arc&&(B.arc<=0||B.arc>1)?1:B.arc||1,N=0===B.sideOrientation?0:B.sideOrientation||x.e.DEFAULTSIDE;I.push(0,0,0),f.push(.5,.5);const R=2*Math.PI*g,H=1===g?R/e:R/(e-1);let F=0;for(let x=0;x<e;x++){const B=Math.cos(F),C=Math.sin(F),M=(B+1)/2,x=(1-C)/2;I.push(L*B,L*C,0),f.push(M,y.b?1-x:x),F+=H}1===g&&(I.push(I[3],I[4],I[5]),f.push(f[2],y.b?1-f[3]:f[3]));const k=I.length/3;for(let x=1;x<k-1;x++)C.push(x+1,0,x);x.e.ComputeNormals(I,C,M),x.e._ComputeSides(N,I,C,M,f,B.frontUVs,B.backUVs);const q=new x.e;return q.indices=C,q.DB=I,q.JB=M,q.uB=f,q}function L(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new M.b(B,C);I.sideOrientation=M.b._GetDefaultSideOrientation(I.sideOrientation),x._originalBuilderSideOrientation=I.sideOrientation;return f(I).nB(x,I.updatable),x}x.e.CreateDisc=f,M.b.CreateDisc=function(B,I,C){return L(B,{radius:I,tessellation:C,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12393:(B,I,C)=>{"use strict";C.d(I,{f:()=>S,c:()=>U,h:()=>o});var M=C(11194),x=C(11239),y=C(11645),f=C(11633),L=C(11270);y.b._GroundMeshParser=(B,I)=>e.Parse(B,I);class e extends y.b{constructor(B,I){super(B,I),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=B,this._subdivisionsY=B,this.subdivide(B);const C=this;C.createOrUpdateSubmeshesOctree&&C.createOrUpdateSubmeshesOctree(I)}getHeightAtCoordinates(B,I){const C=this.getWorldMatrix(),x=M.TmpVectors.Matrix[5];C.invertToRef(x);const y=M.TmpVectors.HI[8];if(M.HI.TransformCoordinatesFromFloatsToRef(B,0,I,x,y),B=y.x,I=y.z,B<this._minX||B>=this._maxX||I<=this._minZ||I>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const f=this._getFacetAt(B,I),L=-(f.x*B+f.z*I+f.w)/f.y;return M.HI.TransformCoordinatesFromFloatsToRef(0,L,0,C,y),y.y}getNormalAtCoordinates(B,I){const C=new M.HI(0,1,0);return this.getNormalAtCoordinatesToRef(B,I,C),C}getNormalAtCoordinatesToRef(B,I,C){const x=this.getWorldMatrix(),y=M.TmpVectors.Matrix[5];x.invertToRef(y);const f=M.TmpVectors.HI[8];if(M.HI.TransformCoordinatesFromFloatsToRef(B,0,I,y,f),B=f.x,I=f.z,B<this._minX||B>this._maxX||I<this._minZ||I>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const L=this._getFacetAt(B,I);return M.HI.TransformNormalFromFloatsToRef(L.x,L.y,L.z,x,C),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(B,I){const C=Math.floor((B+this._maxX)*this._subdivisionsX/this._width),M=Math.floor(-(I+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),x=this._heightQuads[M*this._subdivisionsX+C];let y;return y=I<x.slope.x*B+x.slope.y?x.facet1:x.facet2,y}_initHeightQuads(){const B=this._subdivisionsX,I=this._subdivisionsY;this._heightQuads=[];for(let C=0;C<I;C++)for(let I=0;I<B;I++){const x={slope:M.Vector2.Zero(),facet1:new M.Vector4(0,0,0,0),facet2:new M.Vector4(0,0,0,0)};this._heightQuads[C*B+I]=x}return this}_computeHeightQuads(){const B=this.getVerticesData(L.g.PositionKind);if(!B)return this;const I=M.TmpVectors.HI[3],C=M.TmpVectors.HI[2],x=M.TmpVectors.HI[1],y=M.TmpVectors.HI[0],f=M.TmpVectors.HI[4],e=M.TmpVectors.HI[5],g=M.TmpVectors.HI[6],N=M.TmpVectors.HI[7],R=M.TmpVectors.HI[8];let H=0,F=0,k=0,q=0,S=0,o=0,U=0;const G=this._subdivisionsX,V=this._subdivisionsY;for(let L=0;L<V;L++)for(let V=0;V<G;V++){H=3*V,F=L*(G+1)*3,k=(L+1)*(G+1)*3,I.x=B[F+H],I.y=B[F+H+1],I.z=B[F+H+2],C.x=B[F+H+3],C.y=B[F+H+4],C.z=B[F+H+5],x.x=B[k+H],x.y=B[k+H+1],x.z=B[k+H+2],y.x=B[k+H+3],y.y=B[k+H+4],y.z=B[k+H+5],q=(y.z-I.z)/(y.x-I.x),S=I.z-q*I.x,C.subtractToRef(I,f),x.subtractToRef(I,e),y.subtractToRef(I,g),M.HI.CrossToRef(g,e,N),M.HI.CrossToRef(f,g,R),N.normalize(),R.normalize(),o=-(N.x*I.x+N.y*I.y+N.z*I.z),U=-(R.x*C.x+R.y*C.y+R.z*C.z);const c=this._heightQuads[L*G+V];c.slope.vf(q,S),c.facet1.vf(N.x,N.y,N.z,o),c.facet2.vf(R.x,R.y,R.z,U)}return this}serialize(B){super.serialize(B),B.subdivisionsX=this._subdivisionsX,B.subdivisionsY=this._subdivisionsY,B.minX=this._minX,B.maxX=this._maxX,B.uf=this._minZ,B.maxZ=this._maxZ,B.width=this._width,B.height=this._height}static Parse(B,I){const C=new e(B.name,I);return C._subdivisionsX=B.subdivisionsX||1,C._subdivisionsY=B.subdivisionsY||1,C._minX=B.minX,C._maxX=B.maxX,C._minZ=B.uf,C._maxZ=B.maxZ,C._width=B.width,C._height=B.height,C}}var g=C(11018),N=C(11056),R=C(11197),H=C(11247);function F(B){const I=[],C=[],x=[],y=[];let L,e;const g=B.width||B.size||1,N=B.height||B.size||1,R=0|(B.subdivisionsX||B.subdivisions||1),F=0|(B.subdivisionsY||B.subdivisions||1);for(L=0;L<=F;L++)for(e=0;e<=R;e++){const B=new M.HI(e*g/R-g/2,0,(F-L)*N/F-N/2),I=new M.HI(0,1,0);C.push(B.x,B.y,B.z),x.push(I.x,I.y,I.z),y.push(e/R,H.b?L/F:1-L/F)}for(L=0;L<F;L++)for(e=0;e<R;e++)I.push(e+1+(L+1)*(R+1)),I.push(e+1+L*(R+1)),I.push(e+L*(R+1)),I.push(e+(L+1)*(R+1)),I.push(e+1+(L+1)*(R+1)),I.push(e+L*(R+1));const k=new f.e;return k.indices=I,k.DB=C,k.JB=x,k.uB=y,k}function k(B){const I=void 0!==B.xmin&&null!==B.xmin?B.xmin:-1,C=void 0!==B.zmin&&null!==B.zmin?B.zmin:-1,x=void 0!==B.xmax&&null!==B.xmax?B.xmax:1,y=void 0!==B.zmax&&null!==B.zmax?B.zmax:1,L=B.subdivisions||{w:1,h:1},e=B.precision||{w:1,h:1},g=[],N=[],R=[],H=[];let F,k,q,S;L.h=L.h<1?1:L.h,L.w=L.w<1?1:L.w,e.w=e.w<1?1:e.w,e.h=e.h<1?1:e.h;const o=(x-I)/L.w,U=(y-C)/L.h;function G(B,I,C,x){const y=N.length/3,f=e.w+1;for(F=0;F<e.h;F++)for(k=0;k<e.w;k++){const B=[y+k+F*f,y+(k+1)+F*f,y+(k+1)+(F+1)*f,y+k+(F+1)*f];g.push(B[1]),g.push(B[2]),g.push(B[3]),g.push(B[0]),g.push(B[1]),g.push(B[3])}const L=M.HI.Zero(),q=new M.HI(0,1,0);for(F=0;F<=e.h;F++)for(L.z=F*(x-I)/e.h+I,k=0;k<=e.w;k++)L.x=k*(C-B)/e.w+B,L.y=0,N.push(L.x,L.y,L.z),R.push(q.x,q.y,q.z),H.push(k/e.w,F/e.h)}for(q=0;q<L.h;q++)for(S=0;S<L.w;S++)G(I+S*o,C+q*U,I+(S+1)*o,C+(q+1)*U);const V=new f.e;return V.indices=g,V.DB=N,V.JB=R,V.uB=H,V}function q(B){const I=[],C=[],y=[],L=[];let e,g;const N=B.colorFilter||new x.SI(.3,.59,.11),H=B.alphaFilter||0;let F=!1;if(B.minHeight>B.maxHeight){F=!0;const I=B.maxHeight;B.maxHeight=B.minHeight,B.minHeight=I}for(e=0;e<=B.subdivisions;e++)for(g=0;g<=B.subdivisions;g++){const I=new M.HI(g*B.width/B.subdivisions-B.width/2,0,(B.subdivisions-e)*B.height/B.subdivisions-B.height/2),x=4*(((I.x+B.width/2)/B.width*(B.bufferWidth-1)|0)+((1-(I.z+B.height/2)/B.height)*(B.bufferHeight-1)|0)*B.bufferWidth);let f=B.buffer[x]/255,k=B.buffer[x+1]/255,q=B.buffer[x+2]/255;const S=B.buffer[x+3]/255;F&&(f=1-f,k=1-k,q=1-q);const o=f*N.r+k*N.g+q*N.b;I.y=S>=H?B.minHeight+(B.maxHeight-B.minHeight)*o:B.minHeight-R.d,B.heightBuffer&&(B.heightBuffer[e*(B.subdivisions+1)+g]=I.y),C.push(I.x,I.y,I.z),y.push(0,0,0),L.push(g/B.subdivisions,1-e/B.subdivisions)}for(e=0;e<B.subdivisions;e++)for(g=0;g<B.subdivisions;g++){const M=g+1+(e+1)*(B.subdivisions+1),x=g+1+e*(B.subdivisions+1),y=g+e*(B.subdivisions+1),f=g+(e+1)*(B.subdivisions+1),L=C[3*M+1]>=B.minHeight,N=C[3*x+1]>=B.minHeight,R=C[3*y+1]>=B.minHeight;L&&N&&R&&(I.push(M),I.push(x),I.push(y));C[3*f+1]>=B.minHeight&&L&&R&&(I.push(f),I.push(M),I.push(y))}f.e.ComputeNormals(C,I,y);const k=new f.e;return k.indices=I,k.DB=C,k.JB=y,k.uB=L,k}function S(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const C=new e(B,arguments.length>2?arguments[2]:void 0);C._setReady(!1),C._subdivisionsX=I.subdivisionsX||I.subdivisions||1,C._subdivisionsY=I.subdivisionsY||I.subdivisions||1,C._width=I.width||1,C._height=I.height||1,C._maxX=C._width/2,C._maxZ=C._height/2,C._minX=-C._maxX,C._minZ=-C._maxZ;return F(I).nB(C,I.updatable),C._setReady(!0),C}function o(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new y.b(B,C);return k(I).nB(M,I.updatable),M}function U(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const y=C.width||10,f=C.height||10,L=C.subdivisions||1,R=C.minHeight||0,H=C.maxHeight||1,F=C.colorFilter||new x.SI(.3,.59,.11),k=C.alphaFilter||0,S=C.updatable,o=C.onReady;M=M||N.c.LastCreatedScene;const U=new e(B,M);let G;U._subdivisionsX=L,U._subdivisionsY=L,U._width=y,U._height=f,U._maxX=U._width/2,U._maxZ=U._height/2,U._minX=-U._maxX,U._minZ=-U._maxZ,U._setReady(!1),C.passHeightBufferInCallback&&(G=new Float32Array((L+1)*(L+1)));const V=(B,I,C)=>{q({width:y,height:f,subdivisions:L,minHeight:R,maxHeight:H,colorFilter:F,buffer:B,bufferWidth:I,bufferHeight:C,alphaFilter:k,heightBuffer:G}).nB(U,S),o&&o(U,G),U._setReady(!0)};if("string"===typeof I){const B=B=>{var I;const C=B.width,x=B.height;if(M.R)return;const y=null===(I=M)||void 0===I?void 0:I.getEngine().resizeImageBitmap(B,C,x);V(y,C,x)};g.Tools.LoadImage(I,B,C.onError?C.onError:()=>{},M.offlineProvider)}else V(I.data,I.width,I.height);return U}f.e.CreateGround=F,f.e.CreateTiledGround=k,f.e.CreateGroundFromHeightMap=q,y.b.CreateGround=(B,I,C,M,x,y)=>S(B,{width:I,height:C,subdivisions:M,updatable:y},x),y.b.CreateTiledGround=(B,I,C,M,x,y,f,L,e)=>o(B,{xmin:I,zmin:C,xmax:M,zmax:x,subdivisions:y,precision:f,updatable:e},L),y.b.CreateGroundFromHeightMap=(B,I,C,M,x,y,f,L,e,g,N)=>U(B,I,{width:C,height:M,subdivisions:x,minHeight:y,maxHeight:f,updatable:e,onReady:g,alphaFilter:N},L)},13073:(B,I,C)=>{"use strict";C.d(I,{e:()=>F,h:()=>R,l:()=>H});var M=C(11194),x=C(11645),y=C(11633),f=C(11730),L=C(11270),e=C(11027);function g(B){const I=[],C=[],M=B.lines,x=B.iB,f=[];let L=0;for(let y=0;y<M.length;y++){const B=M[y];for(let M=0;M<B.length;M++){const{x:e,y:g,z:N}=B[M];if(C.push(e,g,N),x){const B=x[y],{r:I,g:C,b:L,a:e}=B[M];f.push(I,C,L,e)}M>0&&(I.push(L-1),I.push(L)),L++}}const e=new y.e;return e.indices=I,e.DB=C,x&&(e.iB=f),e}function N(B){const I=B.dashSize||3,C=B.gapSize||1,x=B.dashNb||200,f=B.points,L=[],e=[],g=M.HI.Zero();let N=0,R=0,H=0,F=0,k=0,q=0,S=0;for(S=0;S<f.length-1;S++)f[S+1].subtractToRef(f[S],g),N+=g.length();for(H=N/x,F=I*H/(I+C),S=0;S<f.length-1;S++){f[S+1].subtractToRef(f[S],g),R=Math.floor(g.length()/H),g.normalize();for(let B=0;B<R;B++)k=H*B,L.push(f[S].x+k*g.x,f[S].y+k*g.y,f[S].z+k*g.z),L.push(f[S].x+(k+F)*g.x,f[S].y+(k+F)*g.y,f[S].z+(k+F)*g.z),e.push(q,q+1),q+=2}const o=new y.e;return o.DB=L,o.indices=e,o}function R(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=I.instance,x=I.lines,y=I.iB;if(M){const B=M.getVerticesData(L.g.PositionKind);let I,C;y&&(I=M.getVerticesData(L.g.ColorKind));let f=0,e=0;for(let M=0;M<x.length;M++){const L=x[M];for(let x=0;x<L.length;x++)B[f]=L[x].x,B[f+1]=L[x].y,B[f+2]=L[x].z,y&&I&&(C=y[M],I[e]=C[x].r,I[e+1]=C[x].g,I[e+2]=C[x].b,I[e+3]=C[x].a,e+=4),f+=3}return M.updateVerticesData(L.g.PositionKind,B,!1,!1),y&&I&&M.updateVerticesData(L.g.ColorKind,I,!1,!1),M.refreshBoundingInfo(),M}const e=!!y,N=new f.d(B,C,null,void 0,void 0,e,I.useVertexAlpha,I.material);return g(I).nB(N,I.updatable),N}function H(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=I.iB?[I.iB]:null;return R(B,{lines:[I.points],updatable:I.updatable,instance:I.instance,iB:M,useVertexAlpha:I.useVertexAlpha,material:I.material},C)}function F(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=I.points,L=I.instance,g=I.gapSize||1,R=I.dashSize||3;if(L){const B=B=>{const I=M.HI.Zero(),C=B.length/6;let x=0,f=0,e=0,g=0,N=0,R=0,H=0,F=0;for(H=0;H<y.length-1;H++)y[H+1].subtractToRef(y[H],I),x+=I.length();e=x/C;const k=L._creationDataStorage.dashSize;for(g=k*e/(k+L._creationDataStorage.gapSize),H=0;H<y.length-1;H++)for(y[H+1].subtractToRef(y[H],I),f=Math.floor(I.length()/e),I.normalize(),F=0;F<f&&R<B.length;)N=e*F,B[R]=y[H].x+N*I.x,B[R+1]=y[H].y+N*I.y,B[R+2]=y[H].z+N*I.z,B[R+3]=y[H].x+(N+g)*I.x,B[R+4]=y[H].y+(N+g)*I.y,B[R+5]=y[H].z+(N+g)*I.z,R+=6,F++;for(;R<B.length;)B[R]=y[H].x,B[R+1]=y[H].y,B[R+2]=y[H].z,R+=3};return(I.dashNb||I.dashSize||I.gapSize||I.useVertexAlpha||I.material)&&e.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),L.updateMeshPositions(B,!1),L}const H=new f.d(B,C,null,void 0,void 0,void 0,I.useVertexAlpha,I.material);return N(I).nB(H,I.updatable),H._creationDataStorage=new x.d,H._creationDataStorage.dashSize=R,H._creationDataStorage.gapSize=g,H}y.e.CreateLineSystem=g,y.e.CreateDashedLines=N,x.b.zg=function(B,I){return H(B,{points:I,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},x.b.CreateDashedLines=function(B,I,C,M,x){return F(B,{points:I,dashSize:C,gapSize:M,dashNb:x,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12449:(B,I,C)=>{"use strict";C.d(I,{c:()=>L,g:()=>e});var M=C(11645),x=C(11633),y=C(11247);function f(B){const I=[],C=[],M=[],f=[],L=void 0!==B.width?B.width:void 0!==B.size?B.size:1,e=void 0!==B.height?B.height:void 0!==B.size?B.size:1,g=0===B.sideOrientation?0:B.sideOrientation||x.e.DEFAULTSIDE,N=L/2,R=e/2;C.push(-N,-R,0),M.push(0,0,-1),f.push(0,y.b?1:0),C.push(N,-R,0),M.push(0,0,-1),f.push(1,y.b?1:0),C.push(N,R,0),M.push(0,0,-1),f.push(1,y.b?0:1),C.push(-N,R,0),M.push(0,0,-1),f.push(0,y.b?0:1),I.push(0),I.push(1),I.push(2),I.push(0),I.push(2),I.push(3),x.e._ComputeSides(g,C,I,M,f,B.frontUVs,B.backUVs);const H=new x.e;return H.indices=I,H.DB=C,H.JB=M,H.uB=f,H}function L(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const x=new M.b(B,C);I.sideOrientation=M.b._GetDefaultSideOrientation(I.sideOrientation),x._originalBuilderSideOrientation=I.sideOrientation;return f(I).nB(x,I.updatable),I.sourcePlane&&(x.translate(I.sourcePlane.normal,-I.sourcePlane.d),x.setDirection(I.sourcePlane.normal.scale(-1))),x}const e={Yg:L};x.e.Yg=f,M.b.Yg=(B,I,C,M,x)=>L(B,{size:I,width:I,height:I,sideOrientation:x,updatable:M},C)},12537:(B,I,C)=>{"use strict";C.d(I,{e:()=>e});var M=C(11194),x=C(11645),y=C(11633),f=C(11247);function L(B){const I=0|(B.segments||32),C=B.diameterX||B.diameter||1,x=B.diameterY||B.diameter||1,L=B.diameterZ||B.diameter||1,e=B.arc&&(B.arc<=0||B.arc>1)?1:B.arc||1,g=B.slice&&B.slice<=0?1:B.slice||1,N=0===B.sideOrientation?0:B.sideOrientation||y.e.DEFAULTSIDE,R=!!B.dedupTopBottomIndices,H=new M.HI(C/2,x/2,L/2),F=2+I,k=2*F,q=[],S=[],o=[],U=[];for(let y=0;y<=F;y++){const B=y/F,I=B*Math.PI*g;for(let C=0;C<=k;C++){const x=C/k,y=x*Math.PI*2*e,L=M.Matrix.RotationZ(-I),g=M.Matrix.RotationY(y),N=M.HI.TransformCoordinates(M.HI.Up(),L),R=M.HI.TransformCoordinates(N,g),F=R.multiply(H),q=R.divide(H).normalize();S.push(F.x,F.y,F.z),o.push(q.x,q.y,q.z),U.push(x,f.b?1-B:B)}if(y>0){const B=S.length/3;for(let I=B-2*(k+1);I+k+2<B;I++)R?(y>1&&(q.push(I),q.push(I+1),q.push(I+k+1)),(y<F||g<1)&&(q.push(I+k+1),q.push(I+1),q.push(I+k+2))):(q.push(I),q.push(I+1),q.push(I+k+1),q.push(I+k+1),q.push(I+1),q.push(I+k+2))}}y.e._ComputeSides(N,S,q,o,U,B.frontUVs,B.backUVs);const G=new y.e;return G.indices=q,G.DB=S,G.JB=o,G.uB=U,G}function e(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new x.b(B,C);I.sideOrientation=x.b._GetDefaultSideOrientation(I.sideOrientation),M._originalBuilderSideOrientation=I.sideOrientation;return L(I).nB(M,I.updatable),M}y.e.CreateSphere=L,x.b.CreateSphere=(B,I,C,M,x,y)=>e(B,{segments:I,diameterX:C,diameterY:C,diameterZ:C,sideOrientation:y,updatable:x},M)},13384:(B,I,C)=>{"use strict";C.d(I,{e:()=>L});var M=C(11746),x=C(12867),y=C(11766),f=C(11633);class L{static get Configuration(){return{get decoder(){return x.c.DefaultConfiguration},set decoder(B){x.c.DefaultConfiguration=B}}}static set Configuration(B){x.c.DefaultConfiguration=B.decoder}static get DecoderAvailable(){return(0,M.h)(x.c.DefaultConfiguration)}static get Default(){return L._Default??(L._Default=new L),L._Default}static ResetDefault(B){L._Default&&(B||L._Default.dispose(),L._Default=null)}constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L.DefaultNumWorkers;const I="number"===typeof B?{...x.c.DefaultConfiguration,numWorkers:B}:{...x.c.DefaultConfiguration,...B};this._decoder=new x.c(I)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(B,I,C){return this._decoder.decodeMeshToMeshDataAsync(B,I,C)}async decodeMeshToGeometryAsync(B,I,C,M){return await this._decoder.decodeMeshToGeometryAsync(B,I,C,M)}async _decodeMeshToGeometryForGltfAsync(B,I,C,M,x,y){return await this._decoder._decodeMeshToGeometryForGltfAsync(B,I,C,M,x,y)}async decodeMeshAsync(B,I){const C=await this._decoder.decodeMeshToMeshDataAsync(B,I),M=new f.e;C.indices&&(M.indices=C.indices);for(const x of C.attributes){const B=y.b.GetFloatData(x.data,x.size,y.b.GetDataType(x.data),x.byteOffset,x.byteStride,x.normalized,C.totalVertices);M.set(B,x.kind)}return M}}L.DefaultNumWorkers=(0,M.g)(),L._Default=null},12867:(B,I,C)=>{"use strict";C.d(I,{c:()=>g});var M=C(11746),x=C(11018),y=C(11650),f=C(11766),L=C(11027),e=C(11759);class g extends M.d{static get DefaultAvailable(){return(0,M.h)(g.DefaultConfiguration)}static get Default(){return g._Default??(g._Default=new g),g._Default}static ResetDefault(B){g._Default&&(B||g._Default.dispose(),g._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(B,I){return{module:await(I||DracoDecoderModule)({wasmBinary:B})}}_getWorkerContent(){return`${e.e}(${e.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.DefaultConfiguration)}decodeMeshToMeshDataAsync(B,I,C){const M=B instanceof ArrayBuffer?new Int8Array(B):new Int8Array(B.buffer,B.byteOffset,B.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async B=>await new Promise(((x,y)=>{B.push(((B,f)=>{let e=null;const g=[],N=I=>{B.removeEventListener("error",N),B.removeEventListener("message",R),y(I),f()},R=I=>{const M=I.data;switch(M.id){case"indices":e=M.data;break;case"attribute":g.push({kind:M.kind,data:M.data,size:M.size,byteOffset:M.byteOffset,byteStride:M.byteStride,normalized:(y=M.kind,H=M.normalized,C&&void 0!==C[y]?(H!==C[y]&&L.b.Warn(`Normalized flag from Draco data (${H}) does not match normalized flag from glTF accessor (${C[y]}). Using flag from glTF accessor.`),C[y]):H)});break;case"decodeMeshDone":B.removeEventListener("error",N),B.removeEventListener("message",R),x({indices:e,attributes:g,totalVertices:M.totalVertices}),f()}var y,H};B.addEventListener("error",N),B.addEventListener("message",R);const H=M.slice();B.postMessage({id:"decodeMesh",dataView:H,attributes:I},[H.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((B=>{let C=null;const x=[],y=(0,e.e)(B.module,M,I,(B=>{C=B}),((B,I,C,M,y,f)=>{x.push({kind:B,data:I,size:C,byteOffset:M,byteStride:y,normalized:f})}));return{indices:C,attributes:x,totalVertices:y}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(B,I,C,M){const x=await this.decodeMeshToMeshDataAsync(C,M),L=new y.d(B,I);x.indices&&L.setIndices(x.indices);for(const y of x.attributes)L.setVerticesBuffer(new f.b(I.getEngine(),y.data,y.kind,!1,void 0,y.byteStride,void 0,y.byteOffset,y.size,void 0,y.normalized,!0),x.totalVertices);return L}async _decodeMeshToGeometryForGltfAsync(B,I,C,M,x,L){const e=await this.decodeMeshToMeshDataAsync(C,M,x),g=new y.d(B,I);L&&(g._boundingInfo=L,g.useBoundingInfoFromGeometry=!0),e.indices&&g.setIndices(e.indices);for(const y of e.attributes)g.setVerticesBuffer(new f.b(I.getEngine(),y.data,y.kind,!1,void 0,y.byteStride,void 0,y.byteOffset,y.size,void 0,y.normalized,!0),e.totalVertices);return g}}g.DefaultConfiguration={wasmUrl:`${x.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${x.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${x.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},g._Default=null},13065:(B,I,C)=>{"use strict";C.d(I,{b:()=>LB});var M=C(11194),x=C(11645),y=C(11270),f=C(11633),L=C(11247);function e(B){let I=B.pathArray;const C=B.closeArray||!1,M=B.closePath||!1,x=B.invertUV||!1,e=Math.floor(I[0].length/2);let g=B.offset||e;g=g>e?e:Math.floor(g);const N=0===B.sideOrientation?0:B.sideOrientation||f.e.DEFAULTSIDE,R=B.uB,H=B.iB,F=[],k=[],q=[],S=[],o=[],U=[],G=[],V=[];let c;const t=[],r=[];let A,D,J;if(I.length<2){const B=[],C=[];for(D=0;D<I[0].length-g;D++)B.push(I[0][D]),C.push(I[0][D+g]);I=[B,C]}let i=0;const u=M?1:0,p=C?1:0;let n,O,a,W,d,l;for(c=I[0].length,A=0;A<I.length+p;A++){for(G[A]=0,o[A]=[0],n=A===I.length?I[0]:I[A],O=n.length,c=c<O?c:O,J=0;J<O;)F.push(n[J].x,n[J].y,n[J].z),J>0&&(a=n[J].FI(n[J-1]).length(),W=a+G[A],o[A].push(W),G[A]=W),J++;M&&(J--,F.push(n[0].x,n[0].y,n[0].z),a=n[J].FI(n[0]).length(),W=a+G[A],o[A].push(W),G[A]=W),t[A]=O+u,r[A]=i,i+=O+u}let E,Q,Z=null,z=null;for(D=0;D<c+u;D++)for(V[D]=0,U[D]=[0],A=0;A<I.length-1+p;A++)d=I[A],l=A===I.length-1?I[0]:I[A+1],D===c?(Z=d[0],z=l[0]):(Z=d[D],z=l[D]),a=z.FI(Z).length(),W=a+V[D],U[D].push(W),V[D]=W;if(R)for(A=0;A<R.length;A++)S.push(R[A].x,L.b?1-R[A].y:R[A].y);else for(A=0;A<I.length+p;A++)for(D=0;D<c+u;D++)E=0!=G[A]?o[A][D]/G[A]:0,Q=0!=V[D]?U[D][A]/V[D]:0,x?S.push(Q,E):S.push(E,L.b?1-Q:Q);A=0;let b=0,Y=t[A]-1,v=t[A+1]-1,s=Y<v?Y:v,X=r[1]-r[0];const T=t.length-1;for(;b<=s&&A<T;)k.push(b,b+X,b+1),k.push(b+X+1,b+1,b+X),b+=1,b===s&&(A++,X=r[A+1]-r[A],Y=t[A]-1,v=t[A+1]-1,b=r[A],s=Y<v?Y+b:v+b);if(f.e.ComputeNormals(F,k,q),M){let B=0,C=0;for(A=0;A<I.length;A++){B=3*r[A],C=A+1<I.length?3*(r[A+1]-1):q.length-3,q[B]=.5*(q[B]+q[C]),q[B+1]=.5*(q[B+1]+q[C+1]),q[B+2]=.5*(q[B+2]+q[C+2]);const M=Math.sqrt(q[B]*q[B]+q[B+1]*q[B+1]+q[B+2]*q[B+2]);q[B]/=M,q[B+1]/=M,q[B+2]/=M,q[C]=q[B],q[C+1]=q[B+1],q[C+2]=q[B+2]}}if(C){let B=3*r[0],C=3*r[I.length];for(D=0;D<c+u;D++){q[B]=.5*(q[B]+q[C]),q[B+1]=.5*(q[B+1]+q[C+1]),q[B+2]=.5*(q[B+2]+q[C+2]);const I=Math.sqrt(q[B]*q[B]+q[B+1]*q[B+1]+q[B+2]*q[B+2]);q[B]/=I,q[B+1]/=I,q[B+2]/=I,q[C]=q[B],q[C+1]=q[B+1],q[C+2]=q[B+2],B+=3,C+=3}}f.e._ComputeSides(N,F,k,q,S,B.frontUVs,B.backUVs);let P=null;if(H){P=new Float32Array(4*H.length);for(let B=0;B<H.length;B++)P[4*B]=H[B].r,P[4*B+1]=H[B].g,P[4*B+2]=H[B].b,P[4*B+3]=H[B].a}const h=new f.e,j=new Float32Array(F),w=new Float32Array(q),K=new Float32Array(S);return h.indices=k,h.DB=j,h.JB=w,h.uB=K,P&&h.set(P,y.g.ColorKind),M&&(h._idx=r),h}function g(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const g=I.pathArray,N=I.closeArray,R=I.closePath,H=x.b._GetDefaultSideOrientation(I.sideOrientation),F=I.instance,k=I.updatable;if(F){const B=M.TmpVectors.HI[0].Tf(Number.MAX_VALUE),C=M.TmpVectors.HI[1].Tf(-Number.MAX_VALUE),e=I=>{let M=g[0].length;const y=F;let f=0;const L=y._originalBuilderSideOrientation===x.b.DOUBLESIDE?2:1;for(let x=1;x<=L;++x)for(let L=0;L<g.length;++L){const x=g[L],e=x.length;M=M<e?M:e;for(let y=0;y<M;++y){const M=x[y];I[f]=M.x,I[f+1]=M.y,I[f+2]=M.z,B.minimizeInPlaceFromFloats(M.x,M.y,M.z),C.maximizeInPlaceFromFloats(M.x,M.y,M.z),f+=3}if(y._creationDataStorage&&y._creationDataStorage.closePath){const B=x[0];I[f]=B.x,I[f+1]=B.y,I[f+2]=B.z,f+=3}}},N=F.getVerticesData(y.g.PositionKind);if(e(N),F.hasBoundingInfo?F.getBoundingInfo().reConstruct(B,C,F._worldMatrix):F.buildBoundingInfo(B,C,F._worldMatrix),F.updateVerticesData(y.g.PositionKind,N,!1,!1),I.iB){const B=F.getVerticesData(y.g.ColorKind);for(let C=0,M=0;C<I.iB.length;C++,M+=4){const x=I.iB[C];B[M]=x.r,B[M+1]=x.g,B[M+2]=x.b,B[M+3]=x.a}F.updateVerticesData(y.g.ColorKind,B,!1,!1)}if(I.uB){const B=F.getVerticesData(y.g.UVKind);for(let C=0;C<I.uB.length;C++)B[2*C]=I.uB[C].x,B[2*C+1]=L.b?1-I.uB[C].y:I.uB[C].y;F.updateVerticesData(y.g.UVKind,B,!1,!1)}if(!F.areNormalsFrozen||F.isFacetDataEnabled){const B=F.bf(),I=F.getVerticesData(y.g.NormalKind),C=F.isFacetDataEnabled?F.getFacetDataParameters():null;if(f.e.ComputeNormals(N,B,I,C),F._creationDataStorage&&F._creationDataStorage.closePath){let B=0,C=0;for(let M=0;M<g.length;M++)B=3*F._creationDataStorage.idx[M],C=M+1<g.length?3*(F._creationDataStorage.idx[M+1]-1):I.length-3,I[B]=.5*(I[B]+I[C]),I[B+1]=.5*(I[B+1]+I[C+1]),I[B+2]=.5*(I[B+2]+I[C+2]),I[C]=I[B],I[C+1]=I[B+1],I[C+2]=I[B+2]}F.areNormalsFrozen||F.updateVerticesData(y.g.NormalKind,I,!1,!1)}return F}{const M=new x.b(B,C);M._originalBuilderSideOrientation=H,M._creationDataStorage=new x.d;const y=e(I);return R&&(M._creationDataStorage.idx=y._idx),M._creationDataStorage.closePath=R,M._creationDataStorage.closeArray=N,y.nB(M,k),M}}f.e.CreateRibbon=e,x.b.CreateRibbon=function(B,I){return g(B,{pathArray:I,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var N=C(12549),R=C(12385),H=C(11239);function F(B){const I=B.pattern||x.b.NO_FLIP,C=B.tileWidth||B.tileSize||1,M=B.tileHeight||B.tileSize||1,y=B.alignHorizontal||0,L=B.alignVertical||0,e=B.width||B.size||1,g=Math.floor(e/C);let N=e-g*C;const R=B.height||B.size||1,H=Math.floor(R/M);let F=R-H*M;const k=C*g/2,q=M*H/2;let S=0,o=0,U=0,G=0,V=0,c=0;if(N>0||F>0){switch(U=-k,G=-q,V=k,c=q,y){case x.b.CENTER:N/=2,U-=N,V+=N;break;case x.b.LEFT:V+=N,S=-N/2;break;case x.b.RIGHT:U-=N,S=N/2}switch(L){case x.b.CENTER:F/=2,G-=F,c+=F;break;case x.b.BOTTOM:c+=F,o=-F/2;break;case x.b.TOP:G-=F,o=F/2}}const t=[],r=[],A=[];A[0]=[0,0,1,0,1,1,0,1],A[1]=[0,0,1,0,1,1,0,1],I!==x.b.ROTATE_TILE&&I!==x.b.ROTATE_ROW||(A[1]=[1,1,0,1,0,0,1,0]),I!==x.b.FLIP_TILE&&I!==x.b.FLIP_ROW||(A[1]=[1,0,0,0,0,1,1,1]),I!==x.b.FLIP_N_ROTATE_TILE&&I!==x.b.FLIP_N_ROTATE_ROW||(A[1]=[0,1,1,1,1,0,0,0]);let D=[];const J=[],i=[];let u=0;for(let f=0;f<H;f++)for(let B=0;B<g;B++)t.push(B*C-k+S,f*M-q+o,0),t.push((B+1)*C-k+S,f*M-q+o,0),t.push((B+1)*C-k+S,(f+1)*M-q+o,0),t.push(B*C-k+S,(f+1)*M-q+o,0),i.push(u,u+1,u+3,u+1,u+2,u+3),D=I===x.b.FLIP_TILE||I===x.b.ROTATE_TILE||I===x.b.FLIP_N_ROTATE_TILE?D.concat(A[(B%2+f%2)%2]):I===x.b.FLIP_ROW||I===x.b.ROTATE_ROW||I===x.b.FLIP_N_ROTATE_ROW?D.concat(A[f%2]):D.concat(A[0]),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),u+=4;if(N>0||F>0){const B=F>0&&(L===x.b.CENTER||L===x.b.TOP),f=F>0&&(L===x.b.CENTER||L===x.b.BOTTOM),e=N>0&&(y===x.b.CENTER||y===x.b.RIGHT),R=N>0&&(y===x.b.CENTER||y===x.b.LEFT);let A,p,n,O,a=[];if(B&&e&&(t.push(U+S,G+o,0),t.push(-k+S,G+o,0),t.push(-k+S,G+F+o,0),t.push(U+S,G+F+o,0),i.push(u,u+1,u+3,u+1,u+2,u+3),u+=4,A=1-N/C,p=1-F/M,n=1,O=1,a=[A,p,n,p,n,O,A,O],I===x.b.ROTATE_ROW&&(a=[1-A,1-p,1-n,1-p,1-n,1-O,1-A,1-O]),I===x.b.FLIP_ROW&&(a=[1-A,p,1-n,p,1-n,O,1-A,O]),I===x.b.FLIP_N_ROTATE_ROW&&(a=[A,1-p,n,1-p,n,1-O,A,1-O]),D=D.concat(a),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B&&R&&(t.push(k+S,G+o,0),t.push(V+S,G+o,0),t.push(V+S,G+F+o,0),t.push(k+S,G+F+o,0),i.push(u,u+1,u+3,u+1,u+2,u+3),u+=4,A=0,p=1-F/M,n=N/C,O=1,a=[A,p,n,p,n,O,A,O],(I===x.b.ROTATE_ROW||I===x.b.ROTATE_TILE&&g%2===0)&&(a=[1-A,1-p,1-n,1-p,1-n,1-O,1-A,1-O]),(I===x.b.FLIP_ROW||I===x.b.FLIP_TILE&&g%2===0)&&(a=[1-A,p,1-n,p,1-n,O,1-A,O]),(I===x.b.FLIP_N_ROTATE_ROW||I===x.b.FLIP_N_ROTATE_TILE&&g%2===0)&&(a=[A,1-p,n,1-p,n,1-O,A,1-O]),D=D.concat(a),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),f&&e&&(t.push(U+S,q+o,0),t.push(-k+S,q+o,0),t.push(-k+S,c+o,0),t.push(U+S,c+o,0),i.push(u,u+1,u+3,u+1,u+2,u+3),u+=4,A=1-N/C,p=0,n=1,O=F/M,a=[A,p,n,p,n,O,A,O],(I===x.b.ROTATE_ROW&&H%2===1||I===x.b.ROTATE_TILE&&H%1===0)&&(a=[1-A,1-p,1-n,1-p,1-n,1-O,1-A,1-O]),(I===x.b.FLIP_ROW&&H%2===1||I===x.b.FLIP_TILE&&H%2===0)&&(a=[1-A,p,1-n,p,1-n,O,1-A,O]),(I===x.b.FLIP_N_ROTATE_ROW&&H%2===1||I===x.b.FLIP_N_ROTATE_TILE&&H%2===0)&&(a=[A,1-p,n,1-p,n,1-O,A,1-O]),D=D.concat(a),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),f&&R&&(t.push(k+S,q+o,0),t.push(V+S,q+o,0),t.push(V+S,c+o,0),t.push(k+S,c+o,0),i.push(u,u+1,u+3,u+1,u+2,u+3),u+=4,A=0,p=0,n=N/C,O=F/M,a=[A,p,n,p,n,O,A,O],(I===x.b.ROTATE_ROW&&H%2===1||I===x.b.ROTATE_TILE&&(H+g)%2===1)&&(a=[1-A,1-p,1-n,1-p,1-n,1-O,1-A,1-O]),(I===x.b.FLIP_ROW&&H%2===1||I===x.b.FLIP_TILE&&(H+g)%2===1)&&(a=[1-A,p,1-n,p,1-n,O,1-A,O]),(I===x.b.FLIP_N_ROTATE_ROW&&H%2===1||I===x.b.FLIP_N_ROTATE_TILE&&(H+g)%2===1)&&(a=[A,1-p,n,1-p,n,1-O,A,1-O]),D=D.concat(a),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B){const B=[];A=0,p=1-F/M,n=1,O=1,B[0]=[A,p,n,p,n,O,A,O],B[1]=[A,p,n,p,n,O,A,O],I!==x.b.ROTATE_TILE&&I!==x.b.ROTATE_ROW||(B[1]=[1-A,1-p,1-n,1-p,1-n,1-O,1-A,1-O]),I!==x.b.FLIP_TILE&&I!==x.b.FLIP_ROW||(B[1]=[1-A,p,1-n,p,1-n,O,1-A,O]),I!==x.b.FLIP_N_ROTATE_TILE&&I!==x.b.FLIP_N_ROTATE_ROW||(B[1]=[A,1-p,n,1-p,n,1-O,A,1-O]);for(let M=0;M<g;M++)t.push(M*C-k+S,G+o,0),t.push((M+1)*C-k+S,G+o,0),t.push((M+1)*C-k+S,G+F+o,0),t.push(M*C-k+S,G+F+o,0),i.push(u,u+1,u+3,u+1,u+2,u+3),u+=4,D=I===x.b.FLIP_TILE||I===x.b.ROTATE_TILE||I===x.b.FLIP_N_ROTATE_TILE?D.concat(B[(M+1)%2]):I===x.b.FLIP_ROW||I===x.b.ROTATE_ROW||I===x.b.FLIP_N_ROTATE_ROW?D.concat(B[1]):D.concat(B[0]),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(f){const B=[];A=0,p=0,n=1,O=F/M,B[0]=[A,p,n,p,n,O,A,O],B[1]=[A,p,n,p,n,O,A,O],I!==x.b.ROTATE_TILE&&I!==x.b.ROTATE_ROW||(B[1]=[1-A,1-p,1-n,1-p,1-n,1-O,1-A,1-O]),I!==x.b.FLIP_TILE&&I!==x.b.FLIP_ROW||(B[1]=[1-A,p,1-n,p,1-n,O,1-A,O]),I!==x.b.FLIP_N_ROTATE_TILE&&I!==x.b.FLIP_N_ROTATE_ROW||(B[1]=[A,1-p,n,1-p,n,1-O,A,1-O]);for(let M=0;M<g;M++)t.push(M*C-k+S,c-F+o,0),t.push((M+1)*C-k+S,c-F+o,0),t.push((M+1)*C-k+S,c+o,0),t.push(M*C-k+S,c+o,0),i.push(u,u+1,u+3,u+1,u+2,u+3),u+=4,D=I===x.b.FLIP_TILE||I===x.b.ROTATE_TILE||I===x.b.FLIP_N_ROTATE_TILE?D.concat(B[(M+H)%2]):I===x.b.FLIP_ROW||I===x.b.ROTATE_ROW||I===x.b.FLIP_N_ROTATE_ROW?D.concat(B[H%2]):D.concat(B[0]),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(e){const B=[];A=1-N/C,p=0,n=1,O=1,B[0]=[A,p,n,p,n,O,A,O],B[1]=[A,p,n,p,n,O,A,O],I!==x.b.ROTATE_TILE&&I!==x.b.ROTATE_ROW||(B[1]=[1-A,1-p,1-n,1-p,1-n,1-O,1-A,1-O]),I!==x.b.FLIP_TILE&&I!==x.b.FLIP_ROW||(B[1]=[1-A,p,1-n,p,1-n,O,1-A,O]),I!==x.b.FLIP_N_ROTATE_TILE&&I!==x.b.FLIP_N_ROTATE_ROW||(B[1]=[A,1-p,n,1-p,n,1-O,A,1-O]);for(let C=0;C<H;C++)t.push(U+S,C*M-q+o,0),t.push(U+N+S,C*M-q+o,0),t.push(U+N+S,(C+1)*M-q+o,0),t.push(U+S,(C+1)*M-q+o,0),i.push(u,u+1,u+3,u+1,u+2,u+3),u+=4,D=I===x.b.FLIP_TILE||I===x.b.ROTATE_TILE||I===x.b.FLIP_N_ROTATE_TILE?D.concat(B[(C+1)%2]):I===x.b.FLIP_ROW||I===x.b.ROTATE_ROW||I===x.b.FLIP_N_ROTATE_ROW?D.concat(B[C%2]):D.concat(B[0]),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(R){const B=[];A=0,p=0,n=N/M,O=1,B[0]=[A,p,n,p,n,O,A,O],B[1]=[A,p,n,p,n,O,A,O],I!==x.b.ROTATE_TILE&&I!==x.b.ROTATE_ROW||(B[1]=[1-A,1-p,1-n,1-p,1-n,1-O,1-A,1-O]),I!==x.b.FLIP_TILE&&I!==x.b.FLIP_ROW||(B[1]=[1-A,p,1-n,p,1-n,O,1-A,O]),I!==x.b.FLIP_N_ROTATE_TILE&&I!==x.b.FLIP_N_ROTATE_ROW||(B[1]=[A,1-p,n,1-p,n,1-O,A,1-O]);for(let C=0;C<H;C++)t.push(V-N+S,C*M-q+o,0),t.push(V+S,C*M-q+o,0),t.push(V+S,(C+1)*M-q+o,0),t.push(V-N+S,(C+1)*M-q+o,0),i.push(u,u+1,u+3,u+1,u+2,u+3),u+=4,D=I===x.b.FLIP_TILE||I===x.b.ROTATE_TILE||I===x.b.FLIP_N_ROTATE_TILE?D.concat(B[(C+g)%2]):I===x.b.FLIP_ROW||I===x.b.ROTATE_ROW||I===x.b.FLIP_N_ROTATE_ROW?D.concat(B[C%2]):D.concat(B[0]),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),r.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const p=0===B.sideOrientation?0:B.sideOrientation||f.e.DEFAULTSIDE;f.e._ComputeSides(p,t,i,r,D,B.frontUVs,B.backUVs);const n=new f.e;n.indices=i,n.DB=t,n.JB=r,n.uB=D;const O=p===f.e.DOUBLESIDE?J.concat(J):J;return n.iB=O,n}function k(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new x.b(B,C);I.sideOrientation=x.b._GetDefaultSideOrientation(I.sideOrientation),M._originalBuilderSideOrientation=I.sideOrientation;return F(I).nB(M,I.updatable),M}function q(B){const I=B.faceUV||new Array(6),C=B.faceColors,y=B.pattern||x.b.NO_FLIP,e=B.width||B.size||1,g=B.height||B.size||1,N=B.depth||B.size||1,R=B.tileWidth||B.tileSize||1,k=B.tileHeight||B.tileSize||1,q=B.alignHorizontal||0,S=B.alignVertical||0,o=0===B.sideOrientation?0:B.sideOrientation||f.e.DEFAULTSIDE;for(let x=0;x<6;x++)void 0===I[x]&&(I[x]=new M.Vector4(0,0,1,1)),C&&void 0===C[x]&&(C[x]=new H.Pf(1,1,1,1));const U=e/2,G=g/2,V=N/2,c=[];for(let M=0;M<2;M++)c[M]=F({pattern:y,tileWidth:R,tileHeight:k,width:e,height:g,alignVertical:S,alignHorizontal:q,sideOrientation:o});for(let M=2;M<4;M++)c[M]=F({pattern:y,tileWidth:R,tileHeight:k,width:N,height:g,alignVertical:S,alignHorizontal:q,sideOrientation:o});let t=S;S===x.b.BOTTOM?t=x.b.TOP:S===x.b.TOP&&(t=x.b.BOTTOM);for(let M=4;M<6;M++)c[M]=F({pattern:y,tileWidth:R,tileHeight:k,width:e,height:N,alignVertical:t,alignHorizontal:q,sideOrientation:o});let r=[],A=[],D=[],J=[];const i=[],u=[],p=[],n=[];let O=0,a=0;for(let x=0;x<6;x++){const B=c[x].DB.length;u[x]=[],p[x]=[];for(let I=0;I<B/3;I++)u[x].push(new M.HI(c[x].DB[3*I],c[x].DB[3*I+1],c[x].DB[3*I+2])),p[x].push(new M.HI(c[x].JB[3*I],c[x].JB[3*I+1],c[x].JB[3*I+2]));O=c[x].uB.length,n[x]=[];for(let C=0;C<O;C+=2)n[x][C]=I[x].x+(I[x].z-I[x].x)*c[x].uB[C],n[x][C+1]=I[x].y+(I[x].w-I[x].y)*c[x].uB[C+1],L.b&&(n[x][C+1]=1-n[x][C+1]);if(D=D.concat(n[x]),J=J.concat(c[x].indices.map((B=>B+a))),a+=u[x].length,C)for(let I=0;I<4;I++)i.push(C[x].r,C[x].g,C[x].b,C[x].a)}const W=new M.HI(0,0,V),d=M.Matrix.RotationY(Math.PI);r=u[0].map((B=>M.HI.TransformNormal(B,d).add(W))).map((B=>[B.x,B.y,B.z])).reduce(((B,I)=>B.concat(I)),[]),A=p[0].map((B=>M.HI.TransformNormal(B,d))).map((B=>[B.x,B.y,B.z])).reduce(((B,I)=>B.concat(I)),[]),r=r.concat(u[1].map((B=>B.FI(W))).map((B=>[B.x,B.y,B.z])).reduce(((B,I)=>B.concat(I)),[])),A=A.concat(p[1].map((B=>[B.x,B.y,B.z])).reduce(((B,I)=>B.concat(I)),[]));const l=new M.HI(U,0,0),E=M.Matrix.RotationY(-Math.PI/2);r=r.concat(u[2].map((B=>M.HI.TransformNormal(B,E).add(l))).map((B=>[B.x,B.y,B.z])).reduce(((B,I)=>B.concat(I)),[])),A=A.concat(p[2].map((B=>M.HI.TransformNormal(B,E))).map((B=>[B.x,B.y,B.z])).reduce(((B,I)=>B.concat(I)),[]));const Q=M.Matrix.RotationY(Math.PI/2);r=r.concat(u[3].map((B=>M.HI.TransformNormal(B,Q).FI(l))).map((B=>[B.x,B.y,B.z])).reduce(((B,I)=>B.concat(I)),[])),A=A.concat(p[3].map((B=>M.HI.TransformNormal(B,Q))).map((B=>[B.x,B.y,B.z])).reduce(((B,I)=>B.concat(I)),[]));const Z=new M.HI(0,G,0),z=M.Matrix.RotationX(Math.PI/2);r=r.concat(u[4].map((B=>M.HI.TransformNormal(B,z).add(Z))).map((B=>[B.x,B.y,B.z])).reduce(((B,I)=>B.concat(I)),[])),A=A.concat(p[4].map((B=>M.HI.TransformNormal(B,z))).map((B=>[B.x,B.y,B.z])).reduce(((B,I)=>B.concat(I)),[]));const b=M.Matrix.RotationX(-Math.PI/2);r=r.concat(u[5].map((B=>M.HI.TransformNormal(B,b).FI(Z))).map((B=>[B.x,B.y,B.z])).reduce(((B,I)=>B.concat(I)),[])),A=A.concat(p[5].map((B=>M.HI.TransformNormal(B,b))).map((B=>[B.x,B.y,B.z])).reduce(((B,I)=>B.concat(I)),[])),f.e._ComputeSides(o,r,J,A,D);const Y=new f.e;if(Y.indices=J,Y.DB=r,Y.JB=A,Y.uB=D,C){const B=o===f.e.DOUBLESIDE?i.concat(i):i;Y.iB=B}return Y}function S(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new x.b(B,C);I.sideOrientation=x.b._GetDefaultSideOrientation(I.sideOrientation),M._originalBuilderSideOrientation=I.sideOrientation;return q(I).nB(M,I.updatable),M}f.e.CreateTiledPlane=F;f.e.CreateTiledBox=q;var o=C(12537),U=C(11440),G=C(11396);function V(B){const I=B.height||2;let C=0===B.diameterTop?0:B.diameterTop||B.diameter||1,y=0===B.diameterBottom?0:B.diameterBottom||B.diameter||1;C=C||1e-5,y=y||1e-5;const e=0|(B.tessellation||24),g=0|(B.subdivisions||1),N=!!B.hasRings,R=!!B.enclose,F=0===B.cap?0:B.cap||x.b.CAP_ALL,k=B.arc&&(B.arc<=0||B.arc>1)?1:B.arc||1,q=0===B.sideOrientation?0:B.sideOrientation||f.e.DEFAULTSIDE,S=B.faceUV||new Array(3),o=B.faceColors,U=2+(1+(1!==k&&R?2:0))*(N?g:1);let V;for(V=0;V<U;V++)o&&void 0===o[V]&&(o[V]=new H.Pf(1,1,1,1));for(V=0;V<U;V++)S&&void 0===S[V]&&(S[V]=new M.Vector4(0,0,1,1));const c=[],t=[],r=[],A=[],D=[],J=2*Math.PI*k/e;let i,u,p;const n=(y-C)/2/I,O=M.HI.Zero(),a=M.HI.Zero(),W=M.HI.Zero(),d=M.HI.Zero(),l=M.HI.Zero(),E=G.e.Y;let Q,Z,z,b=1,Y=1,v=0,s=0;for(Q=0;Q<=g;Q++)for(u=Q/g,p=(u*(C-y)+y)/2,b=N&&0!==Q&&Q!==g?2:1,z=0;z<b;z++){for(N&&(Y+=z),R&&(Y+=2*z),Z=0;Z<=e;Z++)i=Z*J,O.x=Math.cos(-i)*p,O.y=-I/2+u*I,O.z=Math.sin(-i)*p,0===C&&Q===g?(a.x=r[r.length-3*(e+1)],a.y=r[r.length-3*(e+1)+1],a.z=r[r.length-3*(e+1)+2]):(a.x=O.x,a.z=O.z,a.y=Math.sqrt(a.x*a.x+a.z*a.z)*n,a.normalize()),0===Z&&(W.M(O),d.M(a)),t.push(O.x,O.y,O.z),r.push(a.x,a.y,a.z),s=N?v!==Y?S[Y].y:S[Y].w:S[Y].y+(S[Y].w-S[Y].y)*u,A.push(S[Y].x+(S[Y].z-S[Y].x)*Z/e,L.b?1-s:s),o&&D.push(o[Y].r,o[Y].g,o[Y].b,o[Y].a);1!==k&&R&&(t.push(O.x,O.y,O.z),t.push(0,O.y,0),t.push(0,O.y,0),t.push(W.x,W.y,W.z),M.HI.CrossToRef(E,a,l),l.normalize(),r.push(l.x,l.y,l.z,l.x,l.y,l.z),M.HI.CrossToRef(d,E,l),l.normalize(),r.push(l.x,l.y,l.z,l.x,l.y,l.z),s=N?v!==Y?S[Y+1].y:S[Y+1].w:S[Y+1].y+(S[Y+1].w-S[Y+1].y)*u,A.push(S[Y+1].x,L.b?1-s:s),A.push(S[Y+1].z,L.b?1-s:s),s=N?v!==Y?S[Y+2].y:S[Y+2].w:S[Y+2].y+(S[Y+2].w-S[Y+2].y)*u,A.push(S[Y+2].x,L.b?1-s:s),A.push(S[Y+2].z,L.b?1-s:s),o&&(D.push(o[Y+1].r,o[Y+1].g,o[Y+1].b,o[Y+1].a),D.push(o[Y+1].r,o[Y+1].g,o[Y+1].b,o[Y+1].a),D.push(o[Y+2].r,o[Y+2].g,o[Y+2].b,o[Y+2].a),D.push(o[Y+2].r,o[Y+2].g,o[Y+2].b,o[Y+2].a))),v!==Y&&(v=Y)}const X=1!==k&&R?e+4:e;for(Q=0,Y=0;Y<g;Y++){let B=0,I=0,C=0,M=0;for(Z=0;Z<e;Z++)B=Q*(X+1)+Z,I=(Q+1)*(X+1)+Z,C=Q*(X+1)+(Z+1),M=(Q+1)*(X+1)+(Z+1),c.push(B,I,C),c.push(M,C,I);1!==k&&R&&(c.push(B+2,I+2,C+2),c.push(M+2,C+2,I+2),c.push(B+4,I+4,C+4),c.push(M+4,C+4,I+4)),Q=N?Q+2:Q+1}const T=B=>{const x=B?C/2:y/2;if(0===x)return;let f,g,N;const R=B?S[U-1]:S[0];let H=null;o&&(H=B?o[U-1]:o[0]);const F=t.length/3,q=B?I/2:-I/2,G=new M.HI(0,q,0);t.push(G.x,G.y,G.z),r.push(0,B?1:-1,0);const V=R.y+.5*(R.w-R.y);A.push(R.x+.5*(R.z-R.x),L.b?1-V:V),H&&D.push(H.r,H.g,H.b,H.a);const J=new M.Vector2(.5,.5);for(N=0;N<=e;N++){f=2*Math.PI*N*k/e;const I=Math.cos(-f),C=Math.sin(-f);g=new M.HI(I*x,q,C*x);const y=new M.Vector2(I*J.x+.5,C*J.y+.5);t.push(g.x,g.y,g.z),r.push(0,B?1:-1,0);const F=R.y+(R.w-R.y)*y.y;A.push(R.x+(R.z-R.x)*y.x,L.b?1-F:F),H&&D.push(H.r,H.g,H.b,H.a)}for(N=0;N<e;N++)B?(c.push(F),c.push(F+(N+2)),c.push(F+(N+1))):(c.push(F),c.push(F+(N+1)),c.push(F+(N+2)))};F!==x.b.CAP_START&&F!==x.b.CAP_ALL||T(!1),F!==x.b.CAP_END&&F!==x.b.CAP_ALL||T(!0),f.e._ComputeSides(q,t,c,r,A,B.frontUVs,B.backUVs);const P=new f.e;return P.indices=c,P.DB=t,P.JB=r,P.uB=A,o&&(P.iB=D),P}function c(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const M=new x.b(B,C);I.sideOrientation=x.b._GetDefaultSideOrientation(I.sideOrientation),M._originalBuilderSideOrientation=I.sideOrientation;return V(I).nB(M,I.updatable),M}function t(B){const I=[],C=[],x=[],y=[],e=B.diameter||1,g=B.thickness||.5,N=0|(B.tessellation||16),R=0===B.sideOrientation?0:B.sideOrientation||f.e.DEFAULTSIDE,H=N+1;for(let f=0;f<=N;f++){const B=f/N,R=f*Math.PI*2/N-Math.PI/2,F=M.Matrix.Translation(e/2,0,0).multiply(M.Matrix.RotationY(R));for(let e=0;e<=N;e++){const R=1-e/N,k=e*Math.PI*2/N+Math.PI,q=Math.cos(k),S=Math.sin(k);let o=new M.HI(q,S,0),U=o.scale(g/2);const G=new M.Vector2(B,R);U=M.HI.TransformCoordinates(U,F),o=M.HI.TransformNormal(o,F),C.push(U.x,U.y,U.z),x.push(o.x,o.y,o.z),y.push(G.x,L.b?1-G.y:G.y);const V=(f+1)%H,c=(e+1)%H;I.push(f*H+e),I.push(f*H+c),I.push(V*H+e),I.push(f*H+c),I.push(V*H+c),I.push(V*H+e)}}f.e._ComputeSides(R,C,I,x,y,B.frontUVs,B.backUVs);const F=new f.e;return F.indices=I,F.DB=C,F.JB=x,F.uB=y,F}function r(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const M=new x.b(B,C);I.sideOrientation=x.b._GetDefaultSideOrientation(I.sideOrientation),M._originalBuilderSideOrientation=I.sideOrientation;return t(I).nB(M,I.updatable),M}f.e.CreateCylinder=V,x.b.CreateCylinder=(B,I,C,M,y,f,L,e,g)=>{void 0!==L&&L instanceof U.b||(void 0!==L&&(g=e||x.b.DEFAULTSIDE,e=L),L=f,f=1);return c(B,{height:I,diameterTop:C,diameterBottom:M,tessellation:y,subdivisions:f,sideOrientation:g,updatable:e},L)};function A(B){const I=[],C=[],x=[],y=[],e=B.radius||2,g=B.tube||.5,N=B.radialSegments||32,R=B.tubularSegments||32,H=B.p||2,F=B.q||3,k=0===B.sideOrientation?0:B.sideOrientation||f.e.DEFAULTSIDE,q=B=>{const I=Math.cos(B),C=Math.sin(B),x=F/H*B,y=Math.cos(x),f=e*(2+y)*.5*I,L=e*(2+y)*C*.5,g=e*Math.sin(x)*.5;return new M.HI(f,L,g)};let S,o;for(S=0;S<=N;S++){const B=S%N/N*2*H*Math.PI,I=q(B),x=q(B+.01),f=x.FI(I);let e=x.add(I);const F=M.HI.Cross(f,e);for(e=M.HI.Cross(F,f),F.normalize(),e.normalize(),o=0;o<R;o++){const B=o%R/R*2*Math.PI,M=-g*Math.cos(B),x=g*Math.sin(B);C.push(I.x+M*e.x+x*F.x),C.push(I.y+M*e.y+x*F.y),C.push(I.z+M*e.z+x*F.z),y.push(S/N),y.push(L.b?1-o/R:o/R)}}for(S=0;S<N;S++)for(o=0;o<R;o++){const B=(o+1)%R,C=S*R+o,M=(S+1)*R+o,x=(S+1)*R+B,y=S*R+B;I.push(y),I.push(M),I.push(C),I.push(y),I.push(x),I.push(M)}f.e.ComputeNormals(C,I,x),f.e._ComputeSides(k,C,I,x,y,B.frontUVs,B.backUVs);const U=new f.e;return U.indices=I,U.DB=C,U.JB=x,U.uB=y,U}function D(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;const M=new x.b(B,C);I.sideOrientation=x.b._GetDefaultSideOrientation(I.sideOrientation),M._originalBuilderSideOrientation=I.sideOrientation;return A(I).nB(M,I.updatable),M}f.e.CreateTorus=t,x.b.CreateTorus=(B,I,C,M,x,y,f)=>r(B,{diameter:I,thickness:C,tessellation:M,sideOrientation:f,updatable:y},x);f.e.CreateTorusKnot=A,x.b.CreateTorusKnot=(B,I,C,M,x,y,f,L,e,g)=>D(B,{radius:I,tube:C,radialSegments:M,tubularSegments:x,p:y,q:f,sideOrientation:g,updatable:e},L);var J=C(13073),i=C(11735),u=C(11409);function p(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=I.path,y=I.shape,f=I.scale||1,L=I.rotation||0,e=0===I.cap?0:I.cap||x.b.NO_CAP,g=I.updatable,N=x.b._GetDefaultSideOrientation(I.sideOrientation),R=I.instance||null,H=I.invertUV||!1,F=I.closeShape||!1,k=I.closePath||!1,q=I.capFunction||null;return O(B,y,M,f,L,null,null,k,F,e,!1,C,!!g,N,R,H,I.frontUVs||null,I.backUVs||null,I.firstNormal||null,!!I.adjustFrame,q)}function n(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=I.path,y=I.shape,f=I.scaleFunction||(()=>1),L=I.rotationFunction||(()=>0),e=I.closePath||I.ribbonCloseArray||!1,g=I.closeShape||I.ribbonClosePath||!1,N=0===I.cap?0:I.cap||x.b.NO_CAP,R=I.updatable,H=I.firstNormal||null,F=I.adjustFrame||!1,k=x.b._GetDefaultSideOrientation(I.sideOrientation),q=I.instance,S=I.invertUV||!1,o=I.capFunction||null;return O(B,y,M,null,null,f,L,e,g,N,!0,C,!!R,k,q||null,S,I.frontUVs||null,I.backUVs||null,H,F,o||null)}function O(B,I,C,y,f,L,e,N,R,H,F,k,q,S,o,U,G,V,c,t,r){const A=(B,I,C,y,f,L,e,g,N,R,H)=>{const F=C.getTangents(),k=C.getNormals(),q=C.getBinormals(),S=C.getDistances();if(H)for(let x=0;x<F.length;x++)if(0==F[x].x&&0==F[x].y&&0==F[x].z&&F[x].M(F[x-1]),0==k[x].x&&0==k[x].y&&0==k[x].z&&k[x].M(k[x-1]),0==q[x].x&&0==q[x].y&&0==q[x].z&&q[x].M(q[x-1]),x>0){let B=F[x-1];M.HI.Dot(B,F[x])<0&&F[x].scaleInPlace(-1),B=k[x-1],M.HI.Dot(B,k[x])<0&&k[x].scaleInPlace(-1),B=q[x-1],M.HI.Dot(B,q[x])<0&&q[x].scaleInPlace(-1)}let o=0;const U=R&&g?g:()=>null!==L?L:0,G=R&&e?e:()=>null!==f?f:1;let V=N===x.b.NO_CAP||N===x.b.CAP_END?0:2;const c=M.TmpVectors.Matrix[0];for(let x=0;x<I.length;x++){const C=[],f=U(x,S[x]),L=G(x,S[x]);M.Matrix.RotationAxisToRef(F[x],o,c);for(let y=0;y<B.length;y++){const f=F[x].scale(B[y].z).add(k[x].scale(B[y].x)).add(q[x].scale(B[y].y)),e=M.HI.Zero();M.HI.TransformCoordinatesToRef(f,c,e),e.scaleInPlace(L).addInPlace(I[x]),C[y]=e}y[V]=C,o+=f,V++}const t=r||(B=>{const I=Array(),C=M.HI.Zero();let x;for(x=0;x<B.length;x++)C.addInPlace(B[x]);for(C.scaleInPlace(1/B.length),x=0;x<B.length;x++)I.push(C);return I});switch(N){case x.b.NO_CAP:break;case x.b.CAP_START:y[0]=t(y[2]),y[1]=y[2];break;case x.b.CAP_END:y[V]=y[V-1],y[V+1]=t(y[V-1]);break;case x.b.CAP_ALL:y[0]=t(y[2]),y[1]=y[2],y[V]=y[V-1],y[V+1]=t(y[V-1])}return y};let D,J;if(o){const B=o._creationDataStorage;return D=c?B.path3D.update(C,c):B.path3D.update(C),J=A(I,C,B.path3D,B.pathArray,y,f,L,e,B.cap,F,t),o=g("",{pathArray:J,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:o},k||void 0)}D=c?new u.l(C,c):new u.l(C);J=A(I,C,D,new Array,y,f,L,e,H=H<0||H>3?0:H,F,t);const i=g(B,{pathArray:J,closeArray:N,closePath:R,updatable:q,sideOrientation:S,invertUV:U,frontUVs:G||void 0,backUVs:V||void 0},k);return i._creationDataStorage.pathArray=J,i._creationDataStorage.path3D=D,i._creationDataStorage.cap=H,i}function a(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=I.arc?I.arc<=0||I.arc>1?1:I.arc:1,f=void 0===I.closed||I.closed,L=I.shape,e=I.radius||1,N=I.tessellation||64,R=I.clip||0,H=I.updatable,F=x.b._GetDefaultSideOrientation(I.sideOrientation),k=I.cap||x.b.NO_CAP,q=2*Math.PI,S=[],o=I.invertUV||!1;let U=0,G=0;const V=q/N*y;let c,t;for(U=0;U<=N-R;U++){for(t=[],k!=x.b.CAP_START&&k!=x.b.CAP_ALL||(t.push(new M.HI(0,L[0].y,0)),t.push(new M.HI(Math.cos(U*V)*L[0].x*e,L[0].y,Math.sin(U*V)*L[0].x*e))),G=0;G<L.length;G++)c=new M.HI(Math.cos(U*V)*L[G].x*e,L[G].y,Math.sin(U*V)*L[G].x*e),t.push(c);k!=x.b.CAP_END&&k!=x.b.CAP_ALL||(t.push(new M.HI(Math.cos(U*V)*L[L.length-1].x*e,L[L.length-1].y,Math.sin(U*V)*L[L.length-1].x*e)),t.push(new M.HI(0,L[L.length-1].y,0))),S.push(t)}return g(B,{pathArray:S,closeArray:f,sideOrientation:F,updatable:H,invertUV:o,frontUVs:I.frontUVs,backUVs:I.backUVs},C)}x.b.ExtrudeShape=function(B,I,C,M,y,f){let L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7?arguments[7]:void 0,g=arguments.length>8?arguments[8]:void 0,N=arguments.length>9?arguments[9]:void 0;return p(B,{shape:I,path:C,scale:M,rotation:y,cap:0===f?0:f||x.b.NO_CAP,sideOrientation:g,instance:N,updatable:e},L)},x.b.ExtrudeShapeCustom=(B,I,C,M,y,f,L,e,g,N,R,H)=>n(B,{shape:I,path:C,scaleFunction:M,rotationFunction:y,ribbonCloseArray:f,ribbonClosePath:L,cap:0===e?0:e||x.b.NO_CAP,sideOrientation:R,instance:H,updatable:N},g);x.b.CreateLathe=(B,I,C,M,x,y,f)=>a(B,{shape:I,radius:C,tessellation:M,sideOrientation:f,updatable:y},x);var W=C(12449),d=C(12393);function l(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=I.path;let f=I.instance,L=1;void 0!==I.radius?L=I.radius:f&&(L=f._creationDataStorage.radius);const e=I.tessellation||64,N=I.radiusFunction||null;let R=I.cap||x.b.NO_CAP;const H=I.invertUV||!1,F=I.updatable,k=x.b._GetDefaultSideOrientation(I.sideOrientation);I.arc=I.arc&&(I.arc<=0||I.arc>1)?1:I.arc||1;const q=(B,I,C,y,f,L,e,g)=>{const N=I.getTangents(),R=I.getNormals(),H=I.getDistances(),F=2*Math.PI/f*g,k=L||(()=>y);let q,S,o,U;const G=M.TmpVectors.Matrix[0];let V=e===x.b.NO_CAP||e===x.b.CAP_END?0:2;for(let x=0;x<B.length;x++){S=k(x,H[x]),q=Array(),o=R[x];for(let I=0;I<f;I++)M.Matrix.RotationAxisToRef(N[x],F*I,G),U=q[I]?q[I]:M.HI.Zero(),M.HI.TransformCoordinatesToRef(o,G,U),U.scaleInPlace(S).addInPlace(B[x]),q[I]=U;C[V]=q,V++}const c=(I,C)=>{const M=Array();for(let x=0;x<I;x++)M.push(B[C]);return M};switch(e){case x.b.NO_CAP:break;case x.b.CAP_START:C[0]=c(f,0),C[1]=C[2].slice(0);break;case x.b.CAP_END:C[V]=C[V-1].slice(0),C[V+1]=c(f,B.length-1);break;case x.b.CAP_ALL:C[0]=c(f,0),C[1]=C[2].slice(0),C[V]=C[V-1].slice(0),C[V+1]=c(f,B.length-1)}return C};let S,o;if(f){const B=f._creationDataStorage,C=I.arc||B.arc;return S=B.path3D.update(y),o=q(y,S,B.pathArray,L,B.tessellation,N,B.cap,C),f=g("",{pathArray:o,instance:f}),B.path3D=S,B.pathArray=o,B.arc=C,B.radius=L,f}S=new u.l(y);R=R<0||R>3?0:R,o=q(y,S,new Array,L,e,N,R,I.arc);const U=g(B,{pathArray:o,closePath:!0,closeArray:!1,updatable:F,sideOrientation:k,invertUV:H,frontUVs:I.frontUVs,backUVs:I.backUVs},C);return U._creationDataStorage.pathArray=o,U._creationDataStorage.path3D=S,U._creationDataStorage.tessellation=e,U._creationDataStorage.cap=R,U._creationDataStorage.arc=I.arc,U._creationDataStorage.radius=L,U}function E(B){const I=[];I[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},I[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},I[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},I[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},I[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},I[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},I[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},I[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},I[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},I[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},I[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},I[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},I[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},I[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},I[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const C=B.type&&(B.type<0||B.type>=I.length)?0:B.type||0,x=B.size,y=B.sizeX||x||1,e=B.sizeY||x||1,g=B.sizeZ||x||1,N=B.custom||I[C],R=N.face.length,F=B.faceUV||new Array(R),k=B.faceColors,q=void 0===B.flat||B.flat,S=0===B.sideOrientation?0:B.sideOrientation||f.e.DEFAULTSIDE,o=[],U=[],G=[],V=[],c=[];let t=0,r=0;const A=[];let D,J,i,u,p,n,O=0,a=0;if(q)for(a=0;a<R;a++)k&&void 0===k[a]&&(k[a]=new H.Pf(1,1,1,1)),F&&void 0===F[a]&&(F[a]=new M.Vector4(0,0,1,1));if(q)for(a=0;a<R;a++){const B=N.face[a].length;for(i=2*Math.PI/B,u=.5*Math.tan(i/2),p=.5,O=0;O<B;O++)o.push(N.vertex[N.face[a][O]][0]*y,N.vertex[N.face[a][O]][1]*e,N.vertex[N.face[a][O]][2]*g),A.push(t),t++,D=F[a].x+(F[a].z-F[a].x)*(.5+u),J=F[a].y+(F[a].w-F[a].y)*(p-.5),V.push(D,L.b?1-J:J),n=u*Math.cos(i)-p*Math.sin(i),p=u*Math.sin(i)+p*Math.cos(i),u=n,k&&c.push(k[a].r,k[a].g,k[a].b,k[a].a);for(O=0;O<B-2;O++)U.push(A[0+r],A[O+2+r],A[O+1+r]);r+=B}else{for(O=0;O<N.vertex.length;O++)o.push(N.vertex[O][0]*y,N.vertex[O][1]*e,N.vertex[O][2]*g),V.push(0,L.b?1:0);for(a=0;a<R;a++)for(O=0;O<N.face[a].length-2;O++)U.push(N.face[a][0],N.face[a][O+2],N.face[a][O+1])}f.e.ComputeNormals(o,U,G),f.e._ComputeSides(S,o,U,G,V,B.frontUVs,B.backUVs);const W=new f.e;return W.DB=o,W.indices=U,W.JB=G,W.uB=V,k&&q&&(W.iB=c),W}function Q(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new x.b(B,C);I.sideOrientation=x.b._GetDefaultSideOrientation(I.sideOrientation),M._originalBuilderSideOrientation=I.sideOrientation;return E(I).nB(M,I.updatable),M}x.b.CreateTube=(B,I,C,M,x,y,f,L,e,g)=>l(B,{path:I,radius:C,tessellation:M,radiusFunction:x,arc:1,cap:y,updatable:L,sideOrientation:e,instance:g},f);function Z(B){const I=B.sideOrientation||f.e.DEFAULTSIDE,C=B.radius||1,x=void 0===B.flat||B.flat,y=0|(B.subdivisions||4),e=B.radiusX||C,g=B.radiusY||C,N=B.radiusZ||C,R=(1+Math.sqrt(5))/2,H=[-1,R,-0,1,R,0,-1,-R,0,1,-R,0,0,-1,-R,0,1,-R,0,-1,R,0,1,R,R,0,1,R,0,-1,-R,0,1,-R,0,-1],F=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],k=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],q=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],S=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],o=[],U=[],G=[],V=[];let c=0;const t=new Array(3),r=new Array(3);let A;for(A=0;A<3;A++)t[A]=M.HI.Zero(),r[A]=M.Vector2.Zero();for(let f=0;f<20;f++){for(A=0;A<3;A++){const B=F[3*f+A];t[A].vf(H[3*k[B]],H[3*k[B]+1],H[3*k[B]+2]),t[A].normalize(),r[A].vf(.134765625*q[2*B]+.05859375+-.0390625*S[f],.2333984375*q[2*B+1]+.025390625+.01953125*S[f])}const B=(B,I,C,f)=>{const R=M.HI.Lerp(t[0],t[2],I/y),H=M.HI.Lerp(t[1],t[2],I/y),F=y===I?t[2]:M.HI.Lerp(R,H,B/(y-I));let k;if(F.normalize(),x){const B=M.HI.Lerp(t[0],t[2],f/y),I=M.HI.Lerp(t[1],t[2],f/y);k=M.HI.Lerp(B,I,C/(y-f))}else k=new M.HI(F.x,F.y,F.z);k.x/=e,k.y/=g,k.z/=N,k.normalize();const q=M.Vector2.Lerp(r[0],r[2],I/y),S=M.Vector2.Lerp(r[1],r[2],I/y),A=y===I?r[2]:M.Vector2.Lerp(q,S,B/(y-I));U.push(F.x*e,F.y*g,F.z*N),G.push(k.x,k.y,k.z),V.push(A.x,L.b?1-A.y:A.y),o.push(c),c++};for(let I=0;I<y;I++)for(let C=0;C+I<y;C++)B(C,I,C+1/3,I+1/3),B(C+1,I,C+1/3,I+1/3),B(C,I+1,C+1/3,I+1/3),C+I+1<y&&(B(C+1,I,C+2/3,I+2/3),B(C+1,I+1,C+2/3,I+2/3),B(C,I+1,C+2/3,I+2/3))}f.e._ComputeSides(I,U,o,G,V,B.frontUVs,B.backUVs);const D=new f.e;return D.indices=o,D.DB=U,D.JB=G,D.uB=V,D}function z(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const M=new x.b(B,C);I.sideOrientation=x.b._GetDefaultSideOrientation(I.sideOrientation),M._originalBuilderSideOrientation=I.sideOrientation;return Z(I).nB(M,I.updatable),M}f.e.CreatePolyhedron=E,x.b.CreatePolyhedron=(B,I,C)=>Q(B,I,C);f.e.CreateIcoSphere=Z,x.b.CreateIcoSphere=(B,I,C)=>z(B,I,C);var b=C(11212);const Y=new M.HI(1,0,0),v=new M.HI(-1,0,0),s=new M.HI(0,1,0),X=new M.HI(0,-1,0),T=new M.HI(0,0,1),P=new M.HI(0,0,-1);class h{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.HI.Zero(),I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M.HI.Up(),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M.Vector2.Zero(),x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=B,this.normal=I,this.uv=C,this.vertexIdx=x,this.vertexIdxForBones=y,this.localPositionOverride=f,this.localNormalOverride=L,this.matrixIndicesOverride=e,this.matrixWeightsOverride=g}clone(){var B,I,C,M;return new h(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(B=this.localPositionOverride)||void 0===B?void 0:B.slice(),null===(I=this.localNormalOverride)||void 0===I?void 0:I.slice(),null===(C=this.matrixIndicesOverride)||void 0===C?void 0:C.slice(),null===(M=this.matrixWeightsOverride)||void 0===M?void 0:M.slice())}}function j(B,I,C){var e,g,N,R,H;const F=!!I.skeleton,k=!(null===(e=I.morphTargetManager)||void 0===e||!e.numTargets),q=C.localMode||F,S=I.bf(),o=F||k?I.WL(!0,!0):I.getVerticesData(y.g.PositionKind),U=F||k?I.getNormalsData(!0,!0):I.getVerticesData(y.g.NormalKind),G=q?F?I.getVerticesData(y.g.PositionKind):o:null,V=q?F?I.getVerticesData(y.g.NormalKind):U:null,c=I.getVerticesData(y.g.UVKind),t=F?I.getVerticesData(y.g.MatricesIndicesKind):null,r=F?I.getVerticesData(y.g.MatricesWeightsKind):null,A=F?I.getVerticesData(y.g.MatricesIndicesExtraKind):null,D=F?I.getVerticesData(y.g.MatricesWeightsExtraKind):null,J=C.position||M.HI.Zero();let i=C.normal||M.HI.Up();const u=C.size||M.HI.One(),p=C.angle||0;if(!i){const B=new M.HI(0,0,1),C=I.rB().activeCamera,x=M.HI.TransformCoordinates(B,C.getWorldMatrix());i=C.globalPosition.FI(x)}const n=-Math.atan2(i.z,i.x)-Math.PI/2,O=Math.sqrt(i.x*i.x+i.z*i.z),a=Math.atan2(i.y,O),W=new f.e;W.indices=[],W.DB=[],W.JB=[],W.uB=[],W.matricesIndices=F?[]:null,W.matricesWeights=F?[]:null,W.matricesIndicesExtra=A?[]:null,W.matricesWeightsExtra=D?[]:null;let d=0;const l=(B,I)=>{const x=new h;if(!S||!o||!U)return x;const y=S[B];if(x.vertexIdx=3*y,x.vertexIdxForBones=4*y,x.position=new M.HI(o[3*y],o[3*y+1],o[3*y+2]),M.HI.TransformCoordinatesToRef(x.position,I,x.position),x.normal=new M.HI(U[3*y],U[3*y+1],U[3*y+2]),M.HI.TransformNormalToRef(x.normal,I,x.normal),C.captureUVS&&c){const B=c[2*y+1];x.uv=new M.Vector2(c[2*y],L.b?1-B:B)}return x},E=[0,0,0,0],Q=(B,I)=>{if(0===B.length)return B;const C=.5*Math.abs(M.HI.Dot(u,I)),x=(B,I,C,M)=>{for(let x=0;x<M;++x)if(B[C+x]===I)return C+x;return-1},y=(B,y)=>{const f=M.HI.GetClipFactor(B.position,y.position,I,C);let L=E,e=E;if(t&&r){const I=B.matrixIndicesOverride?0:B.vertexIdxForBones,C=B.matrixIndicesOverride??t,M=B.matrixWeightsOverride??r,g=y.matrixIndicesOverride?0:y.vertexIdxForBones,N=y.matrixIndicesOverride??t,R=y.matrixWeightsOverride??r;L=[0,0,0,0],e=[0,0,0,0];let H=0;for(let B=0;B<4;++B)if(M[I+B]>0){const y=x(N,C[I+B],g,4);L[H]=C[I+B],e[H]=(0,b.Lerp)(M[I+B],y>=0?R[y]:0,f),H++}for(let B=0;B<4&&H<4;++B){const M=N[g+B];-1===x(C,M,I,4)&&(L[H]=M,e[H]=(0,b.Lerp)(0,R[g+B],f),H++)}const F=e[0]+e[1]+e[2]+e[3];e[0]/=F,e[1]/=F,e[2]/=F,e[3]/=F}const g=B.localPositionOverride?B.localPositionOverride[0]:(null===G||void 0===G?void 0:G[B.vertexIdx])??0,N=B.localPositionOverride?B.localPositionOverride[1]:(null===G||void 0===G?void 0:G[B.vertexIdx+1])??0,R=B.localPositionOverride?B.localPositionOverride[2]:(null===G||void 0===G?void 0:G[B.vertexIdx+2])??0,H=y.localPositionOverride?y.localPositionOverride[0]:(null===G||void 0===G?void 0:G[y.vertexIdx])??0,F=y.localPositionOverride?y.localPositionOverride[1]:(null===G||void 0===G?void 0:G[y.vertexIdx+1])??0,k=y.localPositionOverride?y.localPositionOverride[2]:(null===G||void 0===G?void 0:G[y.vertexIdx+2])??0,q=B.localNormalOverride?B.localNormalOverride[0]:(null===V||void 0===V?void 0:V[B.vertexIdx])??0,S=B.localNormalOverride?B.localNormalOverride[1]:(null===V||void 0===V?void 0:V[B.vertexIdx+1])??0,o=B.localNormalOverride?B.localNormalOverride[2]:(null===V||void 0===V?void 0:V[B.vertexIdx+2])??0,U=q+((y.localNormalOverride?y.localNormalOverride[0]:(null===V||void 0===V?void 0:V[y.vertexIdx])??0)-q)*f,c=S+((y.localNormalOverride?y.localNormalOverride[1]:(null===V||void 0===V?void 0:V[y.vertexIdx+1])??0)-S)*f,A=o+((y.localNormalOverride?y.localNormalOverride[2]:(null===V||void 0===V?void 0:V[y.vertexIdx+2])??0)-o)*f,D=Math.sqrt(U*U+c*c+A*A);return new h(M.HI.Lerp(B.position,y.position,f),M.HI.Lerp(B.normal,y.normal,f).normalize(),M.Vector2.Lerp(B.uv,y.uv,f),-1,-1,G?[g+(H-g)*f,N+(F-N)*f,R+(k-R)*f]:null,V?[U/D,c/D,A/D]:null,L,e)};let f=null;B.length>3&&(f=[]);for(let L=0;L<B.length;L+=3){let x=0,e=null,g=null,N=null,R=null;const H=M.HI.Dot(B[L].position,I)-C>0,F=M.HI.Dot(B[L+1].position,I)-C>0,k=M.HI.Dot(B[L+2].position,I)-C>0;switch(x=(H?1:0)+(F?1:0)+(k?1:0),x){case 0:B.length>3?(f.push(B[L]),f.push(B[L+1]),f.push(B[L+2])):f=B;break;case 1:if(f=f??new Array,H&&(e=B[L+1],g=B[L+2],N=y(B[L],e),R=y(B[L],g)),F){e=B[L],g=B[L+2],N=y(B[L+1],e),R=y(B[L+1],g),f.push(N),f.push(g.clone()),f.push(e.clone()),f.push(g.clone()),f.push(N.clone()),f.push(R);break}k&&(e=B[L],g=B[L+1],N=y(B[L+2],e),R=y(B[L+2],g)),e&&g&&N&&R&&(f.push(e.clone()),f.push(g.clone()),f.push(N),f.push(R),f.push(N.clone()),f.push(g.clone()));break;case 2:f=f??new Array,H||(e=B[L].clone(),g=y(e,B[L+1]),N=y(e,B[L+2]),f.push(e),f.push(g),f.push(N)),F||(e=B[L+1].clone(),g=y(e,B[L+2]),N=y(e,B[L]),f.push(e),f.push(g),f.push(N)),k||(e=B[L+2].clone(),g=y(e,B[L]),N=y(e,B[L+1]),f.push(e),f.push(g),f.push(N))}}return f},Z=I instanceof x.b?I:null,z=null===Z||void 0===Z?void 0:Z._thinInstanceDataStorage.matrixData,j=(null===Z||void 0===Z?void 0:Z.rL)||1,w=M.TmpVectors.Matrix[0];w.M(M.Matrix.IdentityReadOnly);for(let x=0;x<j;++x){if(null!==Z&&void 0!==Z&&Z.hasThinInstances&&z){const B=16*x;w.setRowFromFloats(0,z[B+0],z[B+1],z[B+2],z[B+3]),w.setRowFromFloats(1,z[B+4],z[B+5],z[B+6],z[B+7]),w.setRowFromFloats(2,z[B+8],z[B+9],z[B+10],z[B+11]),w.setRowFromFloats(3,z[B+12],z[B+13],z[B+14],z[B+15])}const B=M.Matrix.RotationYawPitchRoll(n,a,p).multiply(M.Matrix.Translation(J.x,J.y,J.z)),y=M.Matrix.Invert(B),f=I.getWorldMatrix(),e=w.multiply(f).multiply(y),g=new Array(3);for(let I=0;I<S.length;I+=3){let B=g;if(B[0]=l(I,e),B[1]=l(I+1,e),B[2]=l(I+2,e),!(C.cullBackFaces&&-B[0].normal.z<=0&&-B[1].normal.z<=0&&-B[2].normal.z<=0)&&(B=Q(B,Y),B&&(B=Q(B,v),B&&(B=Q(B,s),B&&(B=Q(B,X),B&&(B=Q(B,T),B&&(B=Q(B,P),B)))))))for(let I=0;I<B.length;I++){const M=B[I];if(W.indices.push(d),q?(M.localPositionOverride?(W.DB[3*d]=M.localPositionOverride[0],W.DB[3*d+1]=M.localPositionOverride[1],W.DB[3*d+2]=M.localPositionOverride[2]):G&&(W.DB[3*d]=G[M.vertexIdx],W.DB[3*d+1]=G[M.vertexIdx+1],W.DB[3*d+2]=G[M.vertexIdx+2]),M.localNormalOverride?(W.JB[3*d]=M.localNormalOverride[0],W.JB[3*d+1]=M.localNormalOverride[1],W.JB[3*d+2]=M.localNormalOverride[2]):V&&(W.JB[3*d]=V[M.vertexIdx],W.JB[3*d+1]=V[M.vertexIdx+1],W.JB[3*d+2]=V[M.vertexIdx+2])):(M.position.toArray(W.DB,3*d),M.normal.toArray(W.JB,3*d)),W.matricesIndices&&W.matricesWeights&&(M.matrixIndicesOverride?(W.matricesIndices[4*d]=M.matrixIndicesOverride[0],W.matricesIndices[4*d+1]=M.matrixIndicesOverride[1],W.matricesIndices[4*d+2]=M.matrixIndicesOverride[2],W.matricesIndices[4*d+3]=M.matrixIndicesOverride[3]):(t&&(W.matricesIndices[4*d]=t[M.vertexIdxForBones],W.matricesIndices[4*d+1]=t[M.vertexIdxForBones+1],W.matricesIndices[4*d+2]=t[M.vertexIdxForBones+2],W.matricesIndices[4*d+3]=t[M.vertexIdxForBones+3]),A&&W.matricesIndicesExtra&&(W.matricesIndicesExtra[4*d]=A[M.vertexIdxForBones],W.matricesIndicesExtra[4*d+1]=A[M.vertexIdxForBones+1],W.matricesIndicesExtra[4*d+2]=A[M.vertexIdxForBones+2],W.matricesIndicesExtra[4*d+3]=A[M.vertexIdxForBones+3])),M.matrixWeightsOverride?(W.matricesWeights[4*d]=M.matrixWeightsOverride[0],W.matricesWeights[4*d+1]=M.matrixWeightsOverride[1],W.matricesWeights[4*d+2]=M.matrixWeightsOverride[2],W.matricesWeights[4*d+3]=M.matrixWeightsOverride[3]):(r&&(W.matricesWeights[4*d]=r[M.vertexIdxForBones],W.matricesWeights[4*d+1]=r[M.vertexIdxForBones+1],W.matricesWeights[4*d+2]=r[M.vertexIdxForBones+2],W.matricesWeights[4*d+3]=r[M.vertexIdxForBones+3]),D&&W.matricesWeightsExtra&&(W.matricesWeightsExtra[4*d]=D[M.vertexIdxForBones],W.matricesWeightsExtra[4*d+1]=D[M.vertexIdxForBones+1],W.matricesWeightsExtra[4*d+2]=D[M.vertexIdxForBones+2],W.matricesWeightsExtra[4*d+3]=D[M.vertexIdxForBones+3]))),C.captureUVS)M.uv.toArray(W.uB,2*d);else{W.uB.push(.5+M.position.x/u.x);const B=.5+M.position.y/u.y;W.uB.push(L.b?1-B:B)}d++}}}0===W.indices.length&&(W.indices=null),0===W.DB.length&&(W.DB=null),0===W.JB.length&&(W.JB=null),0===W.uB.length&&(W.uB=null),0===(null===(g=W.matricesIndices)||void 0===g?void 0:g.length)&&(W.matricesIndices=null),0===(null===(N=W.matricesWeights)||void 0===N?void 0:N.length)&&(W.matricesWeights=null),0===(null===(R=W.matricesIndicesExtra)||void 0===R?void 0:R.length)&&(W.matricesIndicesExtra=null),0===(null===(H=W.matricesWeightsExtra)||void 0===H?void 0:H.length)&&(W.matricesWeightsExtra=null);const K=new x.b(B,I.rB());return W.nB(K),q?(K.skeleton=I.skeleton,K.parent=I):(K.position=J.clone(),K.rotation=new M.HI(a,n,p)),K.nf(!0),K.refreshBoundingInfo(!0,!0),K}function w(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const I=0|Math.max(B.subdivisions?B.subdivisions:2,1),C=0|Math.max(B.tessellation?B.tessellation:16,3),x=Math.max(B.height?B.height:1,0),y=Math.max(B.radius?B.radius:.25,0),e=0|Math.max(B.capSubdivisions?B.capSubdivisions:6,1),g=C,N=I,R=Math.max(B.radiusTop?B.radiusTop:y,0),H=Math.max(B.radiusBottom?B.radiusBottom:y,0),F=x-(R+H),k=2*Math.PI,q=Math.max(B.topCapSubdivisions?B.topCapSubdivisions:e,1),S=Math.max(B.bottomCapSubdivisions?B.bottomCapSubdivisions:e,1),o=Math.acos((H-R)/x);let U=[];const G=[],V=[],c=[];let t=0;const r=[],A=.5*F,D=.5*Math.PI;let J,i;const u=M.HI.Zero(),p=M.HI.Zero(),n=Math.cos(o),O=Math.sin(o),a=new M.Vector2(R*O,A+R*n).FI(new M.Vector2(H*O,H*n-A)).length(),W=R*o+a+H*(D-o);let d=0;for(i=0;i<=q;i++){const B=[],I=D-o*(i/q);d+=R*o/q;const C=Math.cos(I),M=Math.sin(I),x=C*R;for(J=0;J<=g;J++){const I=J/g,y=I*k+0,f=Math.sin(y),e=Math.cos(y);p.x=x*f,p.y=A+M*R,p.z=x*e,G.push(p.x,p.y,p.z),u.set(C*f,M,C*e),V.push(u.x,u.y,u.z),c.push(I,L.b?d/W:1-d/W),B.push(t),t++}r.push(B)}const l=x-R-H+n*R-n*H,E=O*(H-R)/l;for(i=1;i<=N;i++){const B=[];d+=a/N;const I=O*(i*(H-R)/N+R);for(J=0;J<=g;J++){const C=J/g,M=C*k+0,x=Math.sin(M),y=Math.cos(M);p.x=I*x,p.y=A+n*R-i*l/N,p.z=I*y,G.push(p.x,p.y,p.z),u.set(x,E,y).normalize(),V.push(u.x,u.y,u.z),c.push(C,L.b?d/W:1-d/W),B.push(t),t++}r.push(B)}for(i=1;i<=S;i++){const B=[],I=D-o-(Math.PI-o)*(i/S);d+=H*o/S;const C=Math.cos(I),M=Math.sin(I),x=C*H;for(J=0;J<=g;J++){const I=J/g,y=I*k+0,f=Math.sin(y),e=Math.cos(y);p.x=x*f,p.y=M*H-A,p.z=x*e,G.push(p.x,p.y,p.z),u.set(C*f,M,C*e),V.push(u.x,u.y,u.z),c.push(I,L.b?d/W:1-d/W),B.push(t),t++}r.push(B)}for(J=0;J<g;J++)for(i=0;i<q+N+S;i++){const B=r[i][J],I=r[i+1][J],C=r[i+1][J+1],M=r[i][J+1];U.push(B),U.push(I),U.push(M),U.push(I),U.push(C),U.push(M)}if(U=U.reverse(),B.orientation&&!B.orientation.equals(M.HI.Up())){const I=new M.Matrix;B.orientation.clone().scale(.5*Math.PI).cross(M.HI.Up()).toQuaternion().toRotationMatrix(I);const C=M.HI.Zero();for(let B=0;B<G.length;B+=3)C.set(G[B],G[B+1],G[B+2]),M.HI.TransformCoordinatesToRef(C.clone(),I,C),G[B]=C.x,G[B+1]=C.y,G[B+2]=C.z}const Q=new f.e;return Q.DB=G,Q.JB=V,Q.uB=c,Q.indices=U,Q}function K(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:M.HI.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=new x.b(B,C);return w(I).nB(y,I.updatable),y}x.b.CreateDecal=(B,I,C,M,x,y)=>j(B,I,{position:C,normal:M,size:x,angle:y});x.b.CreateCapsule=(B,I,C)=>K(B,I,C),f.e.CreateCapsule=w;var m=C(11027),BB=C(11197);class IB{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=B,this.y=I,B!==Math.floor(B)&&(B=Math.floor(B),m.b.Warn("x is not an integer, floor(x) used")),I!==Math.floor(I)&&(I=Math.floor(I),m.b.Warn("y is not an integer, floor(y) used"))}clone(){return new IB(this.x,this.y)}rotate60About(B){const I=this.x;return this.x=B.x+B.y-this.y,this.y=I+this.y-B.x,this}rotateNeg60About(B){const I=this.x;return this.x=I+this.y-B.y,this.y=B.x+B.y-I,this}rotate120(B,I){B!==Math.floor(B)&&(B=Math.floor(B),m.b.Warn("m not an integer only floor(m) used")),I!==Math.floor(I)&&(I=Math.floor(I),m.b.Warn("n not an integer only floor(n) used"));const C=this.x;return this.x=B-C-this.y,this.y=I+C,this}rotateNeg120(B,I){B!==Math.floor(B)&&(B=Math.floor(B),m.b.Warn("m is not an integer, floor(m) used")),I!==Math.floor(I)&&(I=Math.floor(I),m.b.Warn("n is not an integer,   floor(n) used"));const C=this.x;return this.x=this.y-I,this.y=B+I-C-this.y,this}toCartesianOrigin(B,I){const C=M.HI.Zero();return C.x=B.x+2*this.x*I+this.y*I,C.y=B.y+Math.sqrt(3)*this.y*I,C}static Zero(){return new IB(0,0)}}class CB{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new MB("icosahedron","Regular",[[0,BB.e,-1],[-BB.e,1,0],[-1,0,-BB.e],[1,0,-BB.e],[BB.e,1,0],[0,BB.e,1],[-1,0,BB.e],[-BB.e,-1,0],[0,-BB.e,-1],[BB.e,-1,0],[1,0,BB.e],[0,-BB.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let B=12;const I={},C=this.m,M=this.n;let x,y,f,L,e,g=C,N=1,R=0;0!==M&&(g=(0,b.HighestCommonFactor)(C,M)),N=C/g,R=M/g;const H=IB.Zero(),F=new IB(C,M),k=new IB(-M,C+M),q=IB.Zero(),S=IB.Zero(),o=IB.Zero();let U,G,V,c,t=[];const r=[],A=this.vertByDist,D=(C,M,x,y)=>{U=C+"|"+x,G=M+"|"+y,U in I||G in I?U in I&&!(G in I)?I[G]=I[U]:G in I&&!(U in I)&&(I[U]=I[G]):(I[U]=B,I[G]=B,B++),A[x][0]>2?r[I[U]]=[-A[x][0],A[x][1],I[U]]:r[I[U]]=[t[A[x][0]],A[x][1],I[U]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let J=0;J<20;J++){if(t=this.IDATA.face[J],f=t[2],L=t[1],e=t[0],V=H.x+"|"+H.y,U=J+"|"+V,U in I||(I[U]=f,r[f]=[t[A[V][0]],A[V][1]]),V=F.x+"|"+F.y,U=J+"|"+V,U in I||(I[U]=L,r[L]=[t[A[V][0]],A[V][1]]),V=k.x+"|"+k.y,U=J+"|"+V,U in I||(I[U]=e,r[e]=[t[A[V][0]],A[V][1]]),x=this.IDATA.edgematch[J][0],y=this.IDATA.edgematch[J][1],"B"===y)for(let B=1;B<g;B++)S.x=C-B*(N+R),S.y=M+B*N,o.x=-B*R,o.y=B*(N+R),V=S.x+"|"+S.y,c=o.x+"|"+o.y,D(J,x,V,c);if("O"===y)for(let B=1;B<g;B++)o.x=-B*R,o.y=B*(N+R),q.x=B*N,q.y=B*R,V=o.x+"|"+o.y,c=q.x+"|"+q.y,D(J,x,V,c);if(x=this.IDATA.edgematch[J][2],y=this.IDATA.edgematch[J][3],y&&"A"===y)for(let B=1;B<g;B++)q.x=B*N,q.y=B*R,S.x=C-(g-B)*(N+R),S.y=M+(g-B)*N,V=q.x+"|"+q.y,c=S.x+"|"+S.y,D(J,x,V,c);for(let C=0;C<this.vertices.length;C++)V=this.vertices[C].x+"|"+this.vertices[C].y,U=J+"|"+V,U in I||(I[U]=B++,A[V][0]>2?r[I[U]]=[-A[V][0],A[V][1],I[U]]:r[I[U]]=[t[A[V][0]],A[V][1],I[U]])}this.closestTo=r,this.vecToidx=I}calcCoeffs(){const B=this.m,I=this.n,C=Math.sqrt(3)/3,M=B*B+I*I+B*I;this.coau=(B+I)/M,this.cobu=-I/M,this.coav=-C*(B-I)/M,this.cobv=C*(2*B+I)/M}createInnerFacets(){const B=this.m,I=this.n;for(let C=0;C<I+B+1;C++)for(let B=this.min[C];B<this.max[C]+1;B++)B<this.max[C]&&B<this.max[C+1]+1&&this.innerFacets.push(["|"+B+"|"+C,"|"+B+"|"+(C+1),"|"+(B+1)+"|"+C]),C>0&&B<this.max[C-1]&&B+1<this.max[C]+1&&this.innerFacets.push(["|"+B+"|"+C,"|"+(B+1)+"|"+C,"|"+(B+1)+"|"+(C-1)])}edgeVecsABOB(){const B=this.m,I=this.n,C=new IB(-I,B+I);for(let M=1;M<B+I;M++){const B=new IB(this.min[M],M),I=new IB(this.min[M-1],M-1),x=new IB(this.min[M+1],M+1),y=B.clone(),f=I.clone(),L=x.clone();y.rotate60About(C),f.rotate60About(C),L.rotate60About(C);const e=new IB(this.max[y.y],y.y),g=new IB(this.max[y.y-1],y.y-1),N=new IB(this.max[y.y-1]-1,y.y-1);y.x===e.x&&y.y===e.y||(y.x!==g.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([B,g,N]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([B,N,e])):y.y===L.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([B,I,g]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([B,g,x])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([B,I,g]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([B,g,e])))}}mapABOBtoOBOA(){const B=new IB(0,0);for(let I=0;I<this.isoVecsABOB.length;I++){const C=[];for(let M=0;M<3;M++)B.x=this.isoVecsABOB[I][M].x,B.y=this.isoVecsABOB[I][M].y,0===this.vertexTypes[I][M]&&B.rotateNeg120(this.m,this.n),C.push(B.clone());this.isoVecsOBOA.push(C)}}mapABOBtoBAOA(){const B=new IB(0,0);for(let I=0;I<this.isoVecsABOB.length;I++){const C=[];for(let M=0;M<3;M++)B.x=this.isoVecsABOB[I][M].x,B.y=this.isoVecsABOB[I][M].y,1===this.vertexTypes[I][M]&&B.rotate120(this.m,this.n),C.push(B.clone());this.isoVecsBAOA.push(C)}}MapToFace(B,I){const C=this.IDATA.face[B],x=C[2],y=C[1],f=C[0],L=M.HI.oI(this.IDATA.vertex[x]),e=M.HI.oI(this.IDATA.vertex[y]),g=M.HI.oI(this.IDATA.vertex[f]),N=e.FI(L),R=g.FI(L),H=N.scale(this.coau).add(R.scale(this.cobu)),F=N.scale(this.coav).add(R.scale(this.cobv)),k=[];let q,S=M.TmpVectors.HI[0];for(let M=0;M<this.cartesian.length;M++)S=H.scale(this.cartesian[M].x).add(F.scale(this.cartesian[M].y)).add(L),k[M]=[S.x,S.y,S.z],q=B+"|"+this.vertices[M].x+"|"+this.vertices[M].y,I.vertex[this.vecToidx[q]]=[S.x,S.y,S.z]}build(B,I){const C=[],M=IB.Zero(),x=new IB(B,I),y=new IB(-I,B+I);C.push(M,x,y);for(let V=I;V<B+1;V++)for(let I=0;I<B+1-V;I++)C.push(new IB(I,V));if(I>0){const M=(0,b.HighestCommonFactor)(B,I),x=B/M,y=I/M;for(let L=1;L<M;L++)C.push(new IB(L*x,L*y)),C.push(new IB(-L*y,L*(x+y))),C.push(new IB(B-L*(x+y),I+L*x));const f=B/I;for(let L=1;L<I;L++)for(let M=0;M<L*f;M++)C.push(new IB(M,L)),C.push(new IB(M,L).rotate120(B,I)),C.push(new IB(M,L).rotateNeg120(B,I))}C.sort(((B,I)=>B.x-I.x)),C.sort(((B,I)=>B.y-I.y));const f=new Array(B+I+1),L=new Array(B+I+1);for(let V=0;V<f.length;V++)f[V]=1/0,L[V]=-1/0;let e=0,g=0;const N=C.length;for(let V=0;V<N;V++)g=C[V].x,e=C[V].y,f[e]=Math.min(g,f[e]),L[e]=Math.max(g,L[e]);const R=(C,M)=>{const x=C.clone();return"A"===M&&x.rotateNeg120(B,I),"B"===M&&x.rotate120(B,I),x.x<0?x.y:x.x+x.y},H=[],F=[],k=[],q=[],S={},o=[];let U=-1,G=-1;for(let V=0;V<N;V++)H[V]=C[V].toCartesianOrigin(new IB(0,0),.5),F[V]=R(C[V],"O"),k[V]=R(C[V],"A"),q[V]=R(C[V],"B"),F[V]===k[V]&&k[V]===q[V]?(U=3,G=F[V]):F[V]===k[V]?(U=4,G=F[V]):k[V]===q[V]?(U=5,G=k[V]):q[V]===F[V]&&(U=6,G=F[V]),F[V]<k[V]&&F[V]<q[V]&&(U=2,G=F[V]),k[V]<F[V]&&k[V]<q[V]&&(U=1,G=k[V]),q[V]<k[V]&&q[V]<F[V]&&(U=0,G=q[V]),o.push([U,G,C[V].x,C[V].y]);o.sort(((B,I)=>B[2]-I[2])),o.sort(((B,I)=>B[3]-I[3])),o.sort(((B,I)=>B[1]-I[1])),o.sort(((B,I)=>B[0]-I[0]));for(let V=0;V<o.length;V++)S[o[V][2]+"|"+o[V][3]]=[o[V][0],o[V][1],V];return this.m=B,this.n=I,this.vertices=C,this.vertByDist=S,this.cartesian=H,this.min=f,this.max=L,this}}class MB{constructor(B,I,C,M){this.name=B,this.category=I,this.vertex=C,this.face=M}}class xB extends MB{innerToData(B,I){for(let C=0;C<I.innerFacets.length;C++)this.face.push(I.innerFacets[C].map((C=>I.vecToidx[B+C])))}mapABOBtoDATA(B,I){const C=I.IDATA.edgematch[B][0];for(let M=0;M<I.isoVecsABOB.length;M++){const x=[];for(let y=0;y<3;y++)0===I.vertexTypes[M][y]?x.push(B+"|"+I.isoVecsABOB[M][y].x+"|"+I.isoVecsABOB[M][y].y):x.push(C+"|"+I.isoVecsABOB[M][y].x+"|"+I.isoVecsABOB[M][y].y);this.face.push([I.vecToidx[x[0]],I.vecToidx[x[1]],I.vecToidx[x[2]]])}}mapOBOAtoDATA(B,I){const C=I.IDATA.edgematch[B][0];for(let M=0;M<I.isoVecsOBOA.length;M++){const x=[];for(let y=0;y<3;y++)1===I.vertexTypes[M][y]?x.push(B+"|"+I.isoVecsOBOA[M][y].x+"|"+I.isoVecsOBOA[M][y].y):x.push(C+"|"+I.isoVecsOBOA[M][y].x+"|"+I.isoVecsOBOA[M][y].y);this.face.push([I.vecToidx[x[0]],I.vecToidx[x[1]],I.vecToidx[x[2]]])}}mapBAOAtoDATA(B,I){const C=I.IDATA.edgematch[B][2];for(let M=0;M<I.isoVecsBAOA.length;M++){const x=[];for(let y=0;y<3;y++)1===I.vertexTypes[M][y]?x.push(B+"|"+I.isoVecsBAOA[M][y].x+"|"+I.isoVecsBAOA[M][y].y):x.push(C+"|"+I.isoVecsBAOA[M][y].x+"|"+I.isoVecsBAOA[M][y].y);this.face.push([I.vecToidx[x[0]],I.vecToidx[x[1]],I.vecToidx[x[2]]])}}orderData(B){const I=[];for(let y=0;y<13;y++)I[y]=[];const C=B.closestTo;for(let y=0;y<C.length;y++)C[y][0]>-1?C[y][1]>0&&I[C[y][0]].push([y,C[y][1]]):I[12].push([y,C[y][0]]);const M=[];for(let y=0;y<12;y++)M[y]=y;let x=12;for(let y=0;y<12;y++){I[y].sort(((B,I)=>B[1]-I[1]));for(let B=0;B<I[y].length;B++)M[I[y][B][0]]=x++}for(let y=0;y<I[12].length;y++)M[I[12][y][0]]=x++;for(let y=0;y<this.vertex.length;y++)this.vertex[y].push(M[y]);this.vertex.sort(((B,I)=>B[3]-I[3]));for(let y=0;y<this.vertex.length;y++)this.vertex[y].pop();for(let y=0;y<this.face.length;y++)for(let B=0;B<this.face[y].length;B++)this.face[y][B]=M[this.face[y][B]];this.sharedNodes=I[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(B,I){const C=[],M=[];let x=I.pop();M.push(x);let y=this.face[x].indexOf(B);y=(y+2)%3;let f=this.face[x][y];C.push(f);let L=0;for(;I.length>0;)x=I[L],this.face[x].indexOf(f)>-1?(y=(this.face[x].indexOf(f)+1)%3,f=this.face[x][y],C.push(f),M.push(x),I.splice(L,1),L=0):L++;return this.adjacentFaces.push(C),M}toGoldbergPolyhedronData(){const B=new MB("GeoDual","Goldberg",[],[]);B.name="GD dual";const I=this.vertex.length,C=new Array(I);for(let e=0;e<I;e++)C[e]=[];for(let e=0;e<this.face.length;e++)for(let B=0;B<3;B++)C[this.face[e][B]].push(e);let M=0,x=0,y=0,f=[],L=[];this.adjacentFaces=[];for(let e=0;e<C.length;e++){B.face[e]=this.setOrder(e,C[e].concat([]));for(const I of C[e]){M=0,x=0,y=0,f=this.face[I];for(let B=0;B<3;B++)L=this.vertex[f[B]],M+=L[0],x+=L[1],y+=L[2];B.vertex[I]=[M/3,x/3,y/3]}}return B}static BuildGeodesicData(B){const I=new xB("Geodesic-m-n","Geodesic",[[0,BB.e,-1],[-BB.e,1,0],[-1,0,-BB.e],[1,0,-BB.e],[BB.e,1,0],[0,BB.e,1],[-1,0,BB.e],[-BB.e,-1,0],[0,-BB.e,-1],[BB.e,-1,0],[1,0,BB.e],[0,-BB.e,1]],[]);B.setIndices(),B.calcCoeffs(),B.createInnerFacets(),B.edgeVecsABOB(),B.mapABOBtoOBOA(),B.mapABOBtoBAOA();for(let C=0;C<B.IDATA.face.length;C++)B.MapToFace(C,I),I.innerToData(C,B),"B"===B.IDATA.edgematch[C][1]&&I.mapABOBtoDATA(C,B),"O"===B.IDATA.edgematch[C][1]&&I.mapOBOAtoDATA(C,B),"A"===B.IDATA.edgematch[C][3]&&I.mapBAOAtoDATA(C,B);I.orderData(B);return I.vertex=I.vertex.map((function(B){const I=B[0],C=B[1],M=B[2],x=Math.sqrt(I*I+C*C+M*M);return B[0]*=1/x,B[1]*=1/x,B[2]*=1/x,B})),I}}x.b._GoldbergMeshParser=(B,I)=>yB.Parse(B,I);class yB extends x.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(B,I){return void 0===I?(B>this.goldbergData.nbUnsharedFaces-1&&(m.b.Warn("Maximum number of unshared faces used"),B=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+B):(B>11&&(m.b.Warn("Last pole used"),B=11),I>this.goldbergData.nbFacesAtPole-1&&(m.b.Warn("Maximum number of faces at a pole used"),I=this.goldbergData.nbFacesAtPole-1),12+B*this.goldbergData.nbFacesAtPole+I)}_changeGoldbergFaceColors(B){for(let C=0;C<B.length;C++){const I=B[C][0],M=B[C][1],x=B[C][2];for(let B=I;B<M+1;B++)this.goldbergData.faceColors[B]=x}const I=[];for(let C=0;C<12;C++)for(let B=0;B<5;B++)I.push(this.goldbergData.faceColors[C].r,this.goldbergData.faceColors[C].g,this.goldbergData.faceColors[C].b,this.goldbergData.faceColors[C].a);for(let C=12;C<this.goldbergData.faceColors.length;C++)for(let B=0;B<6;B++)I.push(this.goldbergData.faceColors[C].r,this.goldbergData.faceColors[C].g,this.goldbergData.faceColors[C].b,this.goldbergData.faceColors[C].a);return I}setGoldbergFaceColors(B){const I=this._changeGoldbergFaceColors(B);this.dB(y.g.ColorKind,I)}updateGoldbergFaceColors(B){const I=this._changeGoldbergFaceColors(B);this.updateVerticesData(y.g.ColorKind,I)}_changeGoldbergFaceUVs(B){const I=this.getVerticesData(y.g.UVKind);for(let C=0;C<B.length;C++){const M=B[C][0],x=B[C][1],y=B[C][2],f=B[C][3],L=B[C][4],e=[],g=[];let N,R;for(let B=0;B<5;B++)N=y.x+f*Math.cos(L+B*Math.PI/2.5),R=y.y+f*Math.sin(L+B*Math.PI/2.5),N<0&&(N=0),N>1&&(N=1),e.push(N,R);for(let B=0;B<6;B++)N=y.x+f*Math.cos(L+B*Math.PI/3),R=y.y+f*Math.sin(L+B*Math.PI/3),N<0&&(N=0),N>1&&(N=1),g.push(N,R);for(let B=M;B<Math.min(12,x+1);B++)for(let C=0;C<5;C++)I[10*B+2*C]=e[2*C],I[10*B+2*C+1]=e[2*C+1];for(let B=Math.max(12,M);B<x+1;B++)for(let C=0;C<6;C++)I[12*B-24+2*C]=g[2*C],I[12*B-23+2*C]=g[2*C+1]}return I}setGoldbergFaceUVs(B){const I=this._changeGoldbergFaceUVs(B);this.dB(y.g.UVKind,I)}updateGoldbergFaceUVs(B){const I=this._changeGoldbergFaceUVs(B);this.updateVerticesData(y.g.UVKind,I)}placeOnGoldbergFaceAt(B,I,C){const x=M.HI.RotationFromAxis(this.goldbergData.faceXaxis[I],this.goldbergData.faceYaxis[I],this.goldbergData.faceZaxis[I]);B.rotation=x,B.position=this.goldbergData.faceCenters[I].add(this.goldbergData.faceXaxis[I].scale(C.x)).add(this.goldbergData.faceYaxis[I].scale(C.y)).add(this.goldbergData.faceZaxis[I].scale(C.z))}serialize(B){super.serialize(B),B.type="GoldbergMesh";const I={};if(I.adjacentFaces=this.goldbergData.adjacentFaces,I.nbSharedFaces=this.goldbergData.nbSharedFaces,I.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,I.nbFaces=this.goldbergData.nbFaces,I.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){I.faceColors=[];for(const B of this.goldbergData.faceColors)I.faceColors.push(B.Df())}if(this.goldbergData.faceCenters){I.faceCenters=[];for(const B of this.goldbergData.faceCenters)I.faceCenters.push(B.Df())}if(this.goldbergData.faceZaxis){I.faceZaxis=[];for(const B of this.goldbergData.faceZaxis)I.faceZaxis.push(B.Df())}if(this.goldbergData.faceYaxis){I.faceYaxis=[];for(const B of this.goldbergData.faceYaxis)I.faceYaxis.push(B.Df())}if(this.goldbergData.faceXaxis){I.faceXaxis=[];for(const B of this.goldbergData.faceXaxis)I.faceXaxis.push(B.Df())}B.goldbergData=I}static Parse(B,I){const C=B.goldbergData;C.faceColors=C.faceColors.map((B=>H.Pf.oI(B))),C.faceCenters=C.faceCenters.map((B=>M.HI.oI(B))),C.faceZaxis=C.faceZaxis.map((B=>M.HI.oI(B))),C.faceXaxis=C.faceXaxis.map((B=>M.HI.oI(B))),C.faceYaxis=C.faceYaxis.map((B=>M.HI.oI(B)));const x=new yB(B.name,I);return x.goldbergData=C,x}}var fB=C(11733);const LB={CreateBox:R.c,CreateTiledBox:S,CreateSphere:o.e,CreateDisc:N.d,CreateIcoSphere:z,CreateRibbon:g,CreateCylinder:c,CreateTorus:r,CreateTorusKnot:D,CreateLineSystem:J.h,zg:J.l,CreateDashedLines:J.e,ExtrudeShape:p,ExtrudeShapeCustom:n,CreateLathe:a,CreateTiledPlane:k,Yg:W.c,CreateGround:d.f,CreateTiledGround:d.h,CreateGroundFromHeightMap:d.c,CreatePolygon:i.d,ExtrudePolygon:i.g,CreateTube:l,CreatePolyhedron:Q,CreateGeodesic:function(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,M=I.m||1;M!==Math.floor(M)&&(M=Math.floor(M),m.b.Warn("m not an integer only floor(m) used"));let x=I.n||0;if(x!==Math.floor(x)&&(x=Math.floor(x),m.b.Warn("n not an integer only floor(n) used")),x>M){const B=x;x=M,M=B,m.b.Warn("n > m therefore m and n swapped")}const y=new CB;return y.build(M,x),Q(B,{custom:xB.BuildGeodesicData(y),size:I.size,sizeX:I.sizeX,sizeY:I.sizeY,sizeZ:I.sizeZ,faceUV:I.faceUV,faceColors:I.faceColors,flat:I.flat,updatable:I.updatable,sideOrientation:I.sideOrientation,frontUVs:I.frontUVs,backUVs:I.backUVs},C)},CreateGoldberg:function(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const y=I.size,e=I.sizeX||y||1,g=I.sizeY||y||1,N=I.sizeZ||y||1;let R=I.m||1;R!==Math.floor(R)&&(R=Math.floor(R),m.b.Warn("m not an integer only floor(m) used"));let F=I.n||0;if(F!==Math.floor(F)&&(F=Math.floor(F),m.b.Warn("n not an integer only floor(n) used")),F>R){const B=F;F=R,R=B,m.b.Warn("n > m therefore m and n swapped")}const k=new CB;k.build(R,F);const q=xB.BuildGeodesicData(k),S=q.toGoldbergPolyhedronData(),o=new yB(B,C);I.sideOrientation=x.b._GetDefaultSideOrientation(I.sideOrientation),o._originalBuilderSideOrientation=I.sideOrientation;(function(B,I){const C=B.size,x=B.sizeX||C||1,y=B.sizeY||C||1,e=B.sizeZ||C||1,g=0===B.sideOrientation?0:B.sideOrientation||f.e.DEFAULTSIDE,N=[],R=[],H=[],F=[];let k=1/0,q=-1/0,S=1/0,o=-1/0;for(let M=0;M<I.vertex.length;M++)k=Math.min(k,I.vertex[M][0]*x),q=Math.max(q,I.vertex[M][0]*x),S=Math.min(S,I.vertex[M][1]*y),o=Math.max(o,I.vertex[M][1]*y);let U=0;for(let f=0;f<I.face.length;f++){const B=I.face[f],C=M.HI.oI(I.vertex[B[0]]),g=M.HI.oI(I.vertex[B[2]]),G=M.HI.oI(I.vertex[B[1]]),V=g.FI(C),c=G.FI(C),t=M.HI.Cross(c,V).normalize();for(let M=0;M<B.length;M++){H.push(t.x,t.y,t.z);const C=I.vertex[B[M]];N.push(C[0]*x,C[1]*y,C[2]*e);const f=(C[1]*y-S)/(o-S);F.push((C[0]*x-k)/(q-k),L.b?1-f:f)}for(let I=0;I<B.length-2;I++)R.push(U,U+I+2,U+I+1);U+=B.length}f.e._ComputeSides(g,N,R,H,F);const G=new f.e;return G.DB=N,G.indices=R,G.JB=H,G.uB=F,G})(I,S).nB(o,I.updatable),o.goldbergData.nbSharedFaces=q.sharedNodes,o.goldbergData.nbUnsharedFaces=q.poleNodes,o.goldbergData.adjacentFaces=q.adjacentFaces,o.goldbergData.nbFaces=o.goldbergData.nbSharedFaces+o.goldbergData.nbUnsharedFaces,o.goldbergData.nbFacesAtPole=(o.goldbergData.nbUnsharedFaces-12)/12;for(let x=0;x<q.vertex.length;x++)o.goldbergData.faceCenters.push(M.HI.oI(q.vertex[x])),o.goldbergData.faceCenters[x].x*=e,o.goldbergData.faceCenters[x].y*=g,o.goldbergData.faceCenters[x].z*=N,o.goldbergData.faceColors.push(new H.Pf(1,1,1,1));for(let x=0;x<S.face.length;x++){const B=S.face[x],I=M.HI.oI(S.vertex[B[0]]),C=M.HI.oI(S.vertex[B[2]]),y=M.HI.oI(S.vertex[B[1]]),f=C.FI(I),L=y.FI(I),e=M.HI.Cross(L,f).normalize(),g=M.HI.Cross(L,e).normalize();o.goldbergData.faceXaxis.push(L.normalize()),o.goldbergData.faceYaxis.push(e),o.goldbergData.faceZaxis.push(g)}return o},CreateDecal:j,CreateCapsule:K,CreateText:fB.d}},12462:(B,I,C)=>{"use strict";C.d(I,{c:()=>LI});var M=C(11194),x=C(11586);class y extends x.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var f=C(11239),L=(C(11369),C(11149));class e{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(B){this._targetStopDuration!==B&&(this._targetStopDuration=B)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(B){this._noiseTexture!==B&&(this._noiseTexture=B,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(B){this._animationSheetEnabled!==B&&(this._animationSheetEnabled=B)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(B){this._isAnimationSheetEnabled!=B&&(this._isAnimationSheetEnabled=B,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(B){this._useLogarithmicDepth=B&&this.rB().getEngine().getCaps().fragmentDepthSupported}rB(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(B){switch(B){case e.BLENDMODE_MULTIPLYADD:return;case e.BLENDMODE_ADD:B=1;break;case e.BLENDMODE_ONEONE:B=6;break;case e.BLENDMODE_STANDARD:B=2;break;case e.BLENDMODE_MULTIPLY:B=4;break;case e.BLENDMODE_SUBTRACT:B=3}this._engine.setAlphaMode(B)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:M.HI.Zero()}set direction1(B){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=B)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:M.HI.Zero()}set direction2(B){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=B)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:M.HI.Zero()}set minEmitBox(B){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=B)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:M.HI.Zero()}set maxEmitBox(B){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=B)}get billboardMode(){return this._billboardMode}set billboardMode(B){this._billboardMode!==B&&(this._billboardMode=B,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(B){this._isBillboardBased!==B&&(this._isBillboardBased=B,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(B){this._attachImageProcessingConfiguration(B)}_attachImageProcessingConfiguration(B){B!==this._imageProcessingConfiguration&&(!B&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=B)}_reset(){}_removeGradientAndTexture(B,I,C){if(!I)return this;let M=0;for(const x of I){if(x.gradient===B){I.splice(M,1);break}M++}return C&&C.dispose(),this}constructor(B){this.animations=[],this.renderingGroupId=0,this.j=M.HI.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new M.HI(10,10,10),this.onAnimationEnd=null,this.blendMode=e.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new M.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.lg=new M.HI(0,0,0),this._useLogarithmicDepth=!1,this.gravity=M.HI.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new f.Pf(1,1,1,1),this.color2=new f.Pf(1,1,1,1),this.colorDead=new f.Pf(0,0,0,1),this.textureMask=new f.Pf(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new y,this.id=B,this.name=B}createPointEmitter(B,I){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new M.HI(0,1,0),arguments.length>2&&void 0!==arguments[2]||new M.HI(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new M.HI(0,1,0),arguments.length>4&&void 0!==arguments[4]||new M.HI(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new M.HI(0,1,0),arguments.length>3&&void 0!==arguments[3]||new M.HI(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(B,I,C,M){throw new Error("Method not implemented.")}}e.BLENDMODE_ONEONE=0,e.BLENDMODE_STANDARD=1,e.BLENDMODE_ADD=2,e.BLENDMODE_MULTIPLY=3,e.BLENDMODE_MULTIPLYADD=4,e.BLENDMODE_SUBTRACT=-1,(0,L.h)("BABYLON.BaseParticleSystem",e);var g=C(11212),N=C(11029);class R{constructor(){this.direction1=new M.HI(0,1,0),this.direction2=new M.HI(0,1,0),this.minEmitBox=new M.HI(-.5,-.5,-.5),this.maxEmitBox=new M.HI(.5,.5,.5)}startDirectionFunction(B,I,C,x){const y=(0,g.RandomRange)(this.direction1.x,this.direction2.x),f=(0,g.RandomRange)(this.direction1.y,this.direction2.y),L=(0,g.RandomRange)(this.direction1.z,this.direction2.z);if(x)return I.x=y,I.y=f,void(I.z=L);M.HI.TransformNormalFromFloatsToRef(y,f,L,B,I)}startPositionFunction(B,I,C,x){const y=(0,g.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),f=(0,g.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),L=(0,g.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(x)return I.x=y,I.y=f,void(I.z=L);M.HI.TransformCoordinatesFromFloatsToRef(y,f,L,B,I)}clone(){const B=new R;return N.d.DeepCopy(this,B),B}applyToShader(B){B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2),B.setVector3("minEmitBox",this.minEmitBox),B.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(B){B.addUniform("direction1",3),B.addUniform("direction2",3),B.addUniform("minEmitBox",3),B.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.direction1=this.direction1.Df(),B.direction2=this.direction2.Df(),B.minEmitBox=this.minEmitBox.Df(),B.maxEmitBox=this.maxEmitBox.Df(),B}parse(B){M.HI.FromArrayToRef(B.direction1,0,this.direction1),M.HI.FromArrayToRef(B.direction2,0,this.direction2),M.HI.FromArrayToRef(B.minEmitBox,0,this.minEmitBox),M.HI.FromArrayToRef(B.maxEmitBox,0,this.maxEmitBox)}}class H{get radius(){return this._radius}set radius(B){this._radius=B,this._buildHeight()}get angle(){return this._angle}set angle(B){this._angle=B,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=C,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=I,this.radius=B}startDirectionFunction(B,I,C,x){x?M.TmpVectors.HI[0].M(C.sL).normalize():C.position.subtractToRef(B.getTranslation(),M.TmpVectors.HI[0]).normalize();const y=(0,g.RandomRange)(0,this.directionRandomizer),f=(0,g.RandomRange)(0,this.directionRandomizer),L=(0,g.RandomRange)(0,this.directionRandomizer);I.x=M.TmpVectors.HI[0].x+y,I.y=M.TmpVectors.HI[0].y+f,I.z=M.TmpVectors.HI[0].z+L,I.normalize()}startPositionFunction(B,I,C,x){const y=(0,g.RandomRange)(0,2*Math.PI);let f;this.emitFromSpawnPointOnly?f=1e-4:(f=(0,g.RandomRange)(0,this.heightRange),f=1-f*f);let L=this._radius-(0,g.RandomRange)(0,this._radius*this.radiusRange);L*=f;const e=L*Math.sin(y),N=L*Math.cos(y),R=f*this._height;if(x)return I.x=e,I.y=R,void(I.z=N);M.HI.TransformCoordinatesFromFloatsToRef(e,R,N,B,I)}clone(){const B=new H(this._radius,this._angle,this.directionRandomizer);return N.d.DeepCopy(this,B),B}applyToShader(B){B.setFloat2("radius",this._radius,this.radiusRange),B.setFloat("coneAngle",this._angle),B.setFloat2("height",this._height,this.heightRange),B.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(B){B.addUniform("radius",2),B.addUniform("coneAngle",1),B.addUniform("height",2),B.addUniform("directionRandomizer",1)}getEffectDefines(){let B="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(B+="\n#define CONEEMITTERSPAWNPOINT"),B}getClassName(){return"ConeParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.radius=this._radius,B.angle=this._angle,B.directionRandomizer=this.directionRandomizer,B.radiusRange=this.radiusRange,B.heightRange=this.heightRange,B.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,B}parse(B){this.radius=B.radius,this.angle=B.angle,this.directionRandomizer=B.directionRandomizer,this.radiusRange=void 0!==B.radiusRange?B.radiusRange:1,this.heightRange=void 0!==B.radiusRange?B.heightRange:1,this.emitFromSpawnPointOnly=void 0!==B.emitFromSpawnPointOnly&&B.emitFromSpawnPointOnly}}class F extends H{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M.HI(0,1,0),x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new M.HI(0,1,0);super(B,I),this.direction1=C,this.direction2=x}startDirectionFunction(B,I){const C=(0,g.RandomRange)(this.direction1.x,this.direction2.x),x=(0,g.RandomRange)(this.direction1.y,this.direction2.y),y=(0,g.RandomRange)(this.direction1.z,this.direction2.z);M.HI.TransformNormalFromFloatsToRef(C,x,y,B,I)}clone(){const B=new F(this.radius,this.angle,this.direction1,this.direction2);return N.d.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("radiusRange",this.radiusRange),B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("radiusRange",1),B.addUniform("direction1",3),B.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const B=super.serialize();return B.direction1=this.direction1.Df(),B.direction2=this.direction2.Df(),B}parse(B){super.parse(B),this.direction1.M(B.direction1),this.direction2.M(B.direction2)}}class k{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=B,this.height=I,this.radiusRange=C,this.directionRandomizer=x,this._tempVector=M.HI.Zero()}startDirectionFunction(B,I,C,x,y){C.position.subtractToRef(B.getTranslation(),this._tempVector),this._tempVector.normalize(),M.HI.TransformNormalToRef(this._tempVector,y,this._tempVector);const f=(0,g.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let L=Math.atan2(this._tempVector.x,this._tempVector.z);L+=(0,g.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=f,this._tempVector.x=Math.sin(L),this._tempVector.z=Math.cos(L),this._tempVector.normalize(),x?I.M(this._tempVector):M.HI.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,B,I)}startPositionFunction(B,I,C,x){const y=(0,g.RandomRange)(-this.height/2,this.height/2),f=(0,g.RandomRange)(0,2*Math.PI),L=(0,g.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),e=Math.sqrt(L)*this.radius,N=e*Math.cos(f),R=e*Math.sin(f);x?I.vf(N,y,R):M.HI.TransformCoordinatesFromFloatsToRef(N,y,R,B,I)}clone(){const B=new k(this.radius,this.directionRandomizer);return N.d.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("height",this.height),B.setFloat("radiusRange",this.radiusRange),B.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("height",1),B.addUniform("radiusRange",1),B.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.radius=this.radius,B.height=this.height,B.radiusRange=this.radiusRange,B.directionRandomizer=this.directionRandomizer,B}parse(B){this.radius=B.radius,this.height=B.height,this.radiusRange=B.radiusRange,this.directionRandomizer=B.directionRandomizer}}class q extends k{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new M.HI(0,1,0),y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new M.HI(0,1,0);super(B,I,C),this.direction1=x,this.direction2=y}startDirectionFunction(B,I,C,x){const y=(0,g.RandomRange)(this.direction1.x,this.direction2.x),f=(0,g.RandomRange)(this.direction1.y,this.direction2.y),L=(0,g.RandomRange)(this.direction1.z,this.direction2.z);x?I.vf(y,f,L):M.HI.TransformNormalFromFloatsToRef(y,f,L,B,I)}clone(){const B=new q(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return N.d.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("height",this.height),B.setFloat("radiusRange",this.radiusRange),B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("height",1),B.addUniform("radiusRange",1),B.addUniform("direction1",3),B.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const B=super.serialize();return B.direction1=this.direction1.Df(),B.direction2=this.direction2.Df(),B}parse(B){super.parse(B),M.HI.FromArrayToRef(B.direction1,0,this.direction1),M.HI.FromArrayToRef(B.direction2,0,this.direction2)}}class S{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=B,this.radiusRange=I,this.directionRandomizer=C}startDirectionFunction(B,I,C,x){const y=C.position.FI(B.getTranslation()).normalize(),f=(0,g.RandomRange)(0,this.directionRandomizer),L=(0,g.RandomRange)(0,this.directionRandomizer),e=(0,g.RandomRange)(0,this.directionRandomizer);y.x+=f,y.y+=L,y.z+=e,y.normalize(),x?I.M(y):M.HI.TransformNormalFromFloatsToRef(y.x,y.y,y.z,B,I)}startPositionFunction(B,I,C,x){const y=this.radius-(0,g.RandomRange)(0,this.radius*this.radiusRange),f=(0,g.RandomRange)(0,1),L=(0,g.RandomRange)(0,2*Math.PI),e=Math.acos(2*f-1),N=y*Math.cos(L)*Math.sin(e),R=y*Math.cos(e),H=y*Math.sin(L)*Math.sin(e);x?I.vf(N,Math.abs(R),H):M.HI.TransformCoordinatesFromFloatsToRef(N,Math.abs(R),H,B,I)}clone(){const B=new S(this.radius,this.directionRandomizer);return N.d.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("radiusRange",this.radiusRange),B.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("radiusRange",1),B.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.radius=this.radius,B.radiusRange=this.radiusRange,B.directionRandomizer=this.directionRandomizer,B}parse(B){this.radius=B.radius,this.radiusRange=B.radiusRange,this.directionRandomizer=B.directionRandomizer}}class o{constructor(){this.direction1=new M.HI(0,1,0),this.direction2=new M.HI(0,1,0)}startDirectionFunction(B,I,C,x){const y=(0,g.RandomRange)(this.direction1.x,this.direction2.x),f=(0,g.RandomRange)(this.direction1.y,this.direction2.y),L=(0,g.RandomRange)(this.direction1.z,this.direction2.z);x?I.vf(y,f,L):M.HI.TransformNormalFromFloatsToRef(y,f,L,B,I)}startPositionFunction(B,I,C,x){x?I.vf(0,0,0):M.HI.TransformCoordinatesFromFloatsToRef(0,0,0,B,I)}clone(){const B=new o;return N.d.DeepCopy(this,B),B}applyToShader(B){B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2)}buildUniformLayout(B){B.addUniform("direction1",3),B.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.direction1=this.direction1.Df(),B.direction2=this.direction2.Df(),B}parse(B){M.HI.FromArrayToRef(B.direction1,0,this.direction1),M.HI.FromArrayToRef(B.direction2,0,this.direction2)}}class U{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=B,this.radiusRange=I,this.directionRandomizer=C}startDirectionFunction(B,I,C,x){const y=C.position.FI(B.getTranslation()).normalize(),f=(0,g.RandomRange)(0,this.directionRandomizer),L=(0,g.RandomRange)(0,this.directionRandomizer),e=(0,g.RandomRange)(0,this.directionRandomizer);y.x+=f,y.y+=L,y.z+=e,y.normalize(),x?I.M(y):M.HI.TransformNormalFromFloatsToRef(y.x,y.y,y.z,B,I)}startPositionFunction(B,I,C,x){const y=this.radius-(0,g.RandomRange)(0,this.radius*this.radiusRange),f=(0,g.RandomRange)(0,1),L=(0,g.RandomRange)(0,2*Math.PI),e=Math.acos(2*f-1),N=y*Math.cos(L)*Math.sin(e),R=y*Math.cos(e),H=y*Math.sin(L)*Math.sin(e);x?I.vf(N,R,H):M.HI.TransformCoordinatesFromFloatsToRef(N,R,H,B,I)}clone(){const B=new U(this.radius,this.directionRandomizer);return N.d.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("radiusRange",this.radiusRange),B.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("radiusRange",1),B.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.radius=this.radius,B.radiusRange=this.radiusRange,B.directionRandomizer=this.directionRandomizer,B}parse(B){this.radius=B.radius,this.radiusRange=B.radiusRange,this.directionRandomizer=B.directionRandomizer}}class G extends U{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new M.HI(0,1,0),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M.HI(0,1,0);super(B),this.direction1=I,this.direction2=C}startDirectionFunction(B,I){const C=(0,g.RandomRange)(this.direction1.x,this.direction2.x),x=(0,g.RandomRange)(this.direction1.y,this.direction2.y),y=(0,g.RandomRange)(this.direction1.z,this.direction2.z);M.HI.TransformNormalFromFloatsToRef(C,x,y,B,I)}clone(){const B=new G(this.radius,this.direction1,this.direction2);return N.d.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("radiusRange",this.radiusRange),B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("radiusRange",1),B.addUniform("direction1",3),B.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const B=super.serialize();return B.direction1=this.direction1.Df(),B.direction2=this.direction2.Df(),B}parse(B){super.parse(B),this.direction1.M(B.direction1),this.direction2.M(B.direction2)}}class V{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(B,I,C,x){const y=M.TmpVectors.HI[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,C,y);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,C,y);const B=M.TmpVectors.HI[1];y.subtractToRef(C.position,B),B.scaleToRef(1/C.lifeTime,y)}else y.set(0,0,0);x?I.M(y):M.HI.TransformNormalToRef(y,B,I)}startPositionFunction(B,I,C,x){const y=M.TmpVectors.HI[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,C,y):y.set(0,0,0),x?I.M(y):M.HI.TransformCoordinatesToRef(y,B,I)}clone(){const B=new V;return N.d.DeepCopy(this,B),B}applyToShader(B){}buildUniformLayout(B){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.particlePositionGenerator=this.particlePositionGenerator,B.particleDestinationGenerator=this.particleDestinationGenerator,B}parse(B){B.particlePositionGenerator&&(this.particlePositionGenerator=B.particlePositionGenerator),B.particleDestinationGenerator&&(this.particleDestinationGenerator=B.particleDestinationGenerator)}}var c=C(11270);class t{get mesh(){return this._mesh}set mesh(B){this._mesh!==B&&(this._mesh=B,B?(this._indices=B.bf(),this._positions=B.getVerticesData(c.g.PositionKind),this._normals=B.getVerticesData(c.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=M.HI.Zero(),this._mesh=null,this.direction1=new M.HI(0,1,0),this.direction2=new M.HI(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=B}startDirectionFunction(B,I,C,x){if(this.useMeshNormalsForDirection&&this._normals)return void M.HI.TransformNormalToRef(this._storedNormal,B,I);const y=(0,g.RandomRange)(this.direction1.x,this.direction2.x),f=(0,g.RandomRange)(this.direction1.y,this.direction2.y),L=(0,g.RandomRange)(this.direction1.z,this.direction2.z);x?I.vf(y,f,L):M.HI.TransformNormalFromFloatsToRef(y,f,L,B,I)}startPositionFunction(B,I,C,x){if(!this._indices||!this._positions)return;const y=3*(Math.random()*(this._indices.length/3)|0),f=Math.random(),L=Math.random()*(1-f),e=1-f-L,g=this._indices[y],N=this._indices[y+1],R=this._indices[y+2],H=M.TmpVectors.HI[0],F=M.TmpVectors.HI[1],k=M.TmpVectors.HI[2],q=M.TmpVectors.HI[3];M.HI.FromArrayToRef(this._positions,3*g,H),M.HI.FromArrayToRef(this._positions,3*N,F),M.HI.FromArrayToRef(this._positions,3*R,k),q.x=f*H.x+L*F.x+e*k.x,q.y=f*H.y+L*F.y+e*k.y,q.z=f*H.z+L*F.z+e*k.z,x?I.vf(q.x,q.y,q.z):M.HI.TransformCoordinatesFromFloatsToRef(q.x,q.y,q.z,B,I),this.useMeshNormalsForDirection&&this._normals&&(M.HI.FromArrayToRef(this._normals,3*g,H),M.HI.FromArrayToRef(this._normals,3*N,F),M.HI.FromArrayToRef(this._normals,3*R,k),this._storedNormal.x=f*H.x+L*F.x+e*k.x,this._storedNormal.y=f*H.y+L*F.y+e*k.y,this._storedNormal.z=f*H.z+L*F.z+e*k.z)}clone(){const B=new t(this.mesh);return N.d.DeepCopy(this,B),B}applyToShader(B){B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2)}buildUniformLayout(B){B.addUniform("direction1",3),B.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var B;const I={};return I.type=this.getClassName(),I.direction1=this.direction1.Df(),I.direction2=this.direction2.Df(),I.meshId=null===(B=this.mesh)||void 0===B?void 0:B.id,I.useMeshNormalsForDirection=this.useMeshNormalsForDirection,I}parse(B,I){M.HI.FromArrayToRef(B.direction1,0,this.direction1),M.HI.FromArrayToRef(B.direction2,0,this.direction2),B.meshId&&I&&(this.mesh=I.getLastMeshById(B.meshId)),this.useMeshNormalsForDirection=B.useMeshNormalsForDirection}}class r{_isUbo(B){return void 0!==B.addUniform}constructor(B){this._isUbo(B)?(this.setMatrix3x3=B.updateMatrix3x3.bind(B),this.setMatrix2x2=B.updateMatrix2x2.bind(B),this.setFloat=B.updateFloat.bind(B),this.setFloat2=B.updateFloat2.bind(B),this.setFloat3=B.updateFloat3.bind(B),this.setFloat4=B.updateFloat4.bind(B),this.setFloatArray=B.updateFloatArray.bind(B),this.setArray=B.updateArray.bind(B),this.setIntArray=B.updateIntArray.bind(B),this.setMatrix=B.pf.bind(B),this.setMatrices=B.updateMatrices.bind(B),this.setVector3=B.updateVector3.bind(B),this.setVector4=B.updateVector4.bind(B),this.setColor3=B.updateColor3.bind(B),this.setColor4=B.updateColor4.bind(B),this.setDirectColor4=B.updateDirectColor4.bind(B),this.setInt=B.updateInt.bind(B),this.setInt2=B.updateInt2.bind(B),this.setInt3=B.updateInt3.bind(B),this.setInt4=B.updateInt4.bind(B)):(this.setMatrix3x3=B.setMatrix3x3.bind(B),this.setMatrix2x2=B.setMatrix2x2.bind(B),this.setFloat=B.setFloat.bind(B),this.setFloat2=B.setFloat2.bind(B),this.setFloat3=B.setFloat3.bind(B),this.setFloat4=B.setFloat4.bind(B),this.setFloatArray=B.setFloatArray.bind(B),this.setArray=B.setArray.bind(B),this.setIntArray=B.setIntArray.bind(B),this.setMatrix=B.setMatrix.bind(B),this.setMatrices=B.setMatrices.bind(B),this.setVector3=B.setVector3.bind(B),this.setVector4=B.setVector4.bind(B),this.setColor3=B.setColor3.bind(B),this.setColor4=B.setColor4.bind(B),this.setDirectColor4=B.setDirectColor4.bind(B),this.setInt=B.setInt.bind(B),this.setInt2=B.setInt2.bind(B),this.setInt3=B.setInt3.bind(B),this.setInt4=B.setInt4.bind(B))}}var A=C(11110);const D="gpuUpdateParticlesPixelShader",J="#version 300 es\nvoid main() {discard;}\n";A.d.ShadersStore[D]||(A.d.ShadersStore[D]=J);const i="gpuUpdateParticlesVertexShader",u="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";A.d.ShadersStore[i]||(A.d.ShadersStore[i]=u);(0,L.h)("BABYLON.WebGL2ParticleSystem",class{constructor(B,I){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=B,this._engine=I,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var B;return(null===(B=this._updateEffect)||void 0===B?void 0:B.isReady())??!1}createUpdateBuffer(B){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof V&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=B,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new r(this._updateEffect)}createVertexBuffers(B,I){this._updateVAO.push(this._createUpdateVAO(B)),this._renderVAO.push(this._engine.recordVertexArrayObject(I,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=I}createParticleBuffer(B){return B}bindDrawBuffers(B,I,C){C?this._engine.bindBuffers(this._renderVertexBuffers,C,I):this._engine.bindVertexArrayObject(this._renderVAO[B],null)}preUpdateParticleBuffer(){const B=this._engine;if(this._engine.enableEffect(this._updateEffect),!B.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(B,I,C){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[B],null);const M=this._engine;M.bindTransformFeedbackBuffer(I.getBuffer()),M.setRasterizerState(!1),M.beginTransformFeedback(!0),M.drawArraysType(3,0,C),M.endTransformFeedback(),M.setRasterizerState(!0),M.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let B=0;B<this._updateVAO.length;B++)this._engine.releaseVertexArrayObject(this._updateVAO[B]);this._updateVAO.length=0;for(let B=0;B<this._renderVAO.length;B++)this._engine.releaseVertexArrayObject(this._renderVAO[B]);this._renderVAO.length=0}_createUpdateVAO(B){const I={};I.position=B.createVertexBuffer("position",0,3);let C=3;I.age=B.createVertexBuffer("age",C,1),C+=1,I.size=B.createVertexBuffer("size",C,3),C+=3,I.life=B.createVertexBuffer("life",C,1),C+=1,I.seed=B.createVertexBuffer("seed",C,4),C+=4,I.direction=B.createVertexBuffer("direction",C,3),C+=3,this._parent.particleEmitterType instanceof V&&(I.initialPosition=B.createVertexBuffer("initialPosition",C,3),C+=3),this._parent._colorGradientsTexture||(I.color=B.createVertexBuffer("color",C,4),C+=4),this._parent._isBillboardBased||(I.initialDirection=B.createVertexBuffer("initialDirection",C,3),C+=3),this._parent.noiseTexture&&(I.noiseCoordinates1=B.createVertexBuffer("noiseCoordinates1",C,3),C+=3,I.noiseCoordinates2=B.createVertexBuffer("noiseCoordinates2",C,3),C+=3),this._parent._angularSpeedGradientsTexture?(I.angle=B.createVertexBuffer("angle",C,1),C+=1):(I.angle=B.createVertexBuffer("angle",C,2),C+=2),this._parent._isAnimationSheetEnabled&&(I.cellIndex=B.createVertexBuffer("cellIndex",C,1),C+=1,this._parent.spriteRandomStartCell&&(I.cellStartOffset=B.createVertexBuffer("cellStartOffset",C,1),C+=1));const M=this._engine.recordVertexArrayObject(I,null,this._updateEffect);return this._engine.bindArrayBuffer(null),M}});class p{constructor(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,M=arguments.length>3?arguments[3]:void 0;this._engine=B,this._label=M,this._engine._storageBuffers.push(this),this._create(I,C)}_create(B,I){this._bufferSize=B,this._creationFlags=I,this._buffer=this._engine.createStorageBuffer(B,I,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(B,I,C){this._buffer&&this._engine.updateStorageBuffer(this._buffer,B,I,C)}async read(B,I,C,M){return await this._engine.readFromStorageBuffer(this._buffer,B,I,C,M)}dispose(){const B=this._engine._storageBuffers,I=B.indexOf(this);-1!==I&&(B[I]=B[B.length-1],B.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var n=C(11180),O=C(11186),a=C(11226),W=C(11171),d=C(11502),l=C(11027),E=C(11135),Q=C(11417);class Z{constructor(){this._gpuTimeInFrameId=-1,this.counter=new Q.b}_addDuration(B,I){B<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==B?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(I,!1),this._gpuTimeInFrameId=B):this.counter.addCount(I,!1))}}var z=C(11091);class b{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(B,I,C){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=B,this._engine=I,this.uniqueId=d.d.UniqueId,I.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new Z),this._engine.getCaps().supportComputeShaders?M.bindingsMapping?(this._context=I.createComputeContext(),this._shaderPath=C,this._options={bindingsMapping:{},defines:[],...M}):l.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):l.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(B,I){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const M=this._bindings[B];this._bindings[B]={type:C?0:4,object:I,indexInGroupEntries:null===M||void 0===M?void 0:M.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!M||M.object!==I||M.type!==this._bindings[B].type)}setStorageTexture(B,I){const C=this._bindings[B];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==I),this._bindings[B]={type:1,object:I,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setExternalTexture(B,I){const C=this._bindings[B];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==I),this._bindings[B]={type:6,object:I,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setVideoTexture(B,I){return!!I.externalTexture&&(this.setExternalTexture(B,I.externalTexture),!0)}setUniformBuffer(B,I){const C=this._bindings[B];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==I),this._bindings[B]={type:b._BufferIsDataBuffer(I)?7:2,object:I,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setStorageBuffer(B,I){const C=this._bindings[B];this._contextIsDirty||(this._contextIsDirty=!C||C.object!==I),this._bindings[B]={type:b._BufferIsDataBuffer(I)?7:3,object:I,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}setTextureSampler(B,I){const C=this._bindings[B];this._contextIsDirty||(this._contextIsDirty=!C||!I.compareSampler(C.object)),this._bindings[B]={type:5,object:I,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries}}isReady(){let B=this._effect;for(const x in this._bindings){const B=this._bindings[x],I=B.type,C=B.object;switch(I){case 0:case 4:case 1:if(!C.isReady())return!1;break;case 6:if(!C.isReady())return!1;break}}const I=[],C=this._shaderPath;if(this._options.defines)for(let x=0;x<this._options.defines.length;x++)I.push(this._options.defines[x]);const M=I.join("\n");return this._cachedDefines!==M&&(this._cachedDefines=M,B=this._engine.createComputeEffect(C,{defines:M,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=B),!!B.isReady()}dispatch(B,I,C){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,B,I,C,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const C=b._BufferIsDataBuffer(B)?B:B.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,C,I,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const I in this._bindings){const C=this._bindings[I];if(!this._options.bindingsMapping[I])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+I+"'");switch(C.type){case 0:{const M=this._samplers[I],x=C.object;var B;if(!M||!x._texture||!M.compareSampler(x._texture))this._samplers[I]=(new E.d).setParameters(x.wrapU,x.wrapV,x.wrapR,x.anisotropicFilteringLevel,x._texture.samplingMode,null===(B=x._texture)||void 0===B?void 0:B._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const B=C.object;B.getBuffer()!==C.buffer&&(C.buffer=B.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(B,I,C){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((x=>{(0,z.f)((()=>this.dispatch(B,I,C)),x,void 0,M)}))}serialize(){const B=a.d.Serialize(this);B.options=this._options,B.shaderPath=this._shaderPath,B.AH={},B.textures={};for(const I in this._bindings){const C=this._bindings[I],M=C.object;switch(C.type){case 0:case 4:case 1:{const x=M.serialize();x&&(B.textures[I]=x,B.AH[I]={type:C.type});break}}}return B}static Parse(B,I,C){const M=a.d.Parse((()=>new b(B.name,I.getEngine(),B.shaderPath,B.options)),B,I,C);for(const x in B.textures){const y=B.AH[x],f=W.c.Parse(B.textures[x],I,C);0===y.type?M.setTexture(x,f):4===y.type?M.setTexture(x,f,!1):M.setStorageTexture(x,f)}return M}static _BufferIsDataBuffer(B){return void 0!==B.underlyingResource}}(0,n.e)([(0,O.K)()],b.prototype,"name",void 0),(0,n.e)([(0,O.K)()],b.prototype,"fastMode",void 0),(0,L.h)("BABYLON.ComputeShader",b);var Y=C(11463);const v="gpuUpdateParticlesComputeShader",s="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";A.d.ShadersStoreWGSL[v]||(A.d.ShadersStoreWGSL[v]=s);(0,L.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(B,I){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=B,this._engine=I}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var B;return(null===(B=this._updateComputeShader)||void 0===B?void 0:B.isReady())??!1}createUpdateBuffer(B){var I;const C={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(C.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(C.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(C.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(C.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(C.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(C.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(C.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new b("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:C,defines:B.split("\n")}),null===(I=this._simParamsComputeShader)||void 0===I||I.dispose(),this._simParamsComputeShader=new Y.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new r(this._simParamsComputeShader)}createVertexBuffers(B,I){this._renderVertexBuffers.push(I)}createParticleBuffer(B){const I=new p(this._engine,4*B.length,11,"ComputeShaderParticleSystemBuffer");return I.update(B),this._bufferComputeShader.push(I),I.getBuffer()}bindDrawBuffers(B,I,C){this._engine.bindBuffers(this._renderVertexBuffers[B],C,I)}preUpdateParticleBuffer(){}updateParticleBuffer(B,I,C){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[B]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^B]),this._updateComputeShader.dispatch(Math.ceil(C/64))}releaseBuffers(){var B;for(let I=0;I<this._bufferComputeShader.length;++I)this._bufferComputeShader[I].dispose();this._bufferComputeShader.length=0,null===(B=this._simParamsComputeShader)||void 0===B||B.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class X{constructor(B,I,C){this.gradient=B,this.color1=I,this.color2=C}getColorToRef(B){this.color2?f.Pf.LerpToRef(this.color1,this.color2,Math.random(),B):B.M(this.color1)}}class T{constructor(B,I){this.gradient=B,this.color=I}}class P{constructor(B,I,C){this.gradient=B,this.factor1=I,this.factor2=C}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class h{static GetCurrentGradient(B,I,C){if(I[0].gradient>B)return void C(I[0],I[0],1);for(let x=0;x<I.length-1;x++){const M=I[x],y=I[x+1];if(B>=M.gradient&&B<=y.gradient){return void C(M,y,(B-M.gradient)/(y.gradient-M.gradient))}}const M=I.length-1;C(I[M],I[M],1)}}var j=C(11022),w=C(11659),K=C(11056);class m{constructor(B){this.particleSystem=B,this.position=M.HI.Zero(),this.direction=M.HI.Zero(),this.color=new f.Pf(0,0,0,0),this.colorStep=new f.Pf(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new M.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new f.Pf(0,0,0,0),this._currentColor2=new f.Pf(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=m._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let B=this.age,I=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===I?(I=1,B=this._randomCellOffset):B+=this._randomCellOffset);const C=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let M;M=this._initialSpriteCellLoop?(0,g.Clamp)(B*I%this.lifeTime/this.lifeTime):(0,g.Clamp)(B*I/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+M*C|0}_inheritParticleInfoToSubEmitter(B){if(B.particleSystem.j.position){const I=B.particleSystem.j;if(I.position.M(this.position),B.inheritDirection){const B=M.TmpVectors.HI[0];this.direction.normalizeToRef(B),I.setDirection(B,0,Math.PI/2)}}else{B.particleSystem.j.M(this.position)}this.direction.scaleToRef(B.inheritedVelocityAmount/2,M.TmpVectors.HI[0]),B.particleSystem._inheritedVelocityOffset.M(M.TmpVectors.HI[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const B of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(B)}_reset(){this.age=0,this.id=m._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(B){B.position.M(this.position),this._initialDirection?B._initialDirection?B._initialDirection.M(this._initialDirection):B._initialDirection=this._initialDirection.clone():B._initialDirection=null,B.direction.M(this.direction),this.sL&&(B.sL?B.sL.M(this.sL):B.sL=this.sL.clone()),B.color.M(this.color),B.colorStep.M(this.colorStep),B.lifeTime=this.lifeTime,B.age=this.age,B._randomCellOffset=this._randomCellOffset,B.size=this.size,B.scale.M(this.scale),B.angle=this.angle,B.angularSpeed=this.angularSpeed,B.particleSystem=this.particleSystem,B.cellIndex=this.cellIndex,B.id=this.id,B._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(B._currentColorGradient=this._currentColorGradient,B._currentColor1.M(this._currentColor1),B._currentColor2.M(this._currentColor2)),this._currentSizeGradient&&(B._currentSizeGradient=this._currentSizeGradient,B._currentSize1=this._currentSize1,B._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(B._currentAngularSpeedGradient=this._currentAngularSpeedGradient,B._currentAngularSpeed1=this._currentAngularSpeed1,B._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(B._currentVelocityGradient=this._currentVelocityGradient,B._currentVelocity1=this._currentVelocity1,B._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(B._currentLimitVelocityGradient=this._currentLimitVelocityGradient,B._currentLimitVelocity1=this._currentLimitVelocity1,B._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(B._currentDragGradient=this._currentDragGradient,B._currentDrag1=this._currentDrag1,B._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(B._initialStartSpriteCellId=this._initialStartSpriteCellId,B._initialEndSpriteCellId=this._initialEndSpriteCellId,B._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(B.remapData&&this.remapData?B.remapData.M(this.remapData):B.remapData=new M.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(B._randomNoiseCoordinates1?(B._randomNoiseCoordinates1.M(this._randomNoiseCoordinates1),B._randomNoiseCoordinates2.M(this._randomNoiseCoordinates2)):(B._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),B._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}m._Count=0;var BB=C(11313),IB=(C(11364),C(11565)),CB=C(11559),MB=C(11457);function xB(B,I){const C=(0,g.RandomRange)(0,1);f.Pf.LerpToRef(I.color1,I.color2,C,B.color),I.colorDead.subtractToRef(B.color,I._colorDiff),I._colorDiff.scaleToRef(1/B.lifeTime,B.colorStep)}function yB(B,I){B._currentColorGradient=I._colorGradients[0],B._currentColorGradient.getColorToRef(B.color),B._currentColor1.M(B.color),I._colorGradients.length>1?I._colorGradients[1].getColorToRef(B._currentColor2):B._currentColor2.M(B.color)}function fB(B,I){const C=I._colorGradients;h.GetCurrentGradient(I._ratio,C,((I,C,M)=>{I!==B._currentColorGradient&&(B._currentColor1.M(B._currentColor2),C.getColorToRef(B._currentColor2),B._currentColorGradient=I),f.Pf.LerpToRef(B._currentColor1,B._currentColor2,M,B.color)}))}function LB(B,I){B.colorStep.scaleToRef(I._scaledUpdateSpeed,I._scaledColorStep),B.color.addInPlace(I._scaledColorStep),B.color.a<0&&(B.color.a=0)}function eB(B,I){h.GetCurrentGradient(I._ratio,I._angularSpeedGradients,((I,C,M)=>{I!==B._currentAngularSpeedGradient&&(B._currentAngularSpeed1=B._currentAngularSpeed2,B._currentAngularSpeed2=C.getFactor(),B._currentAngularSpeedGradient=I),B.angularSpeed=(0,g.Lerp)(B._currentAngularSpeed1,B._currentAngularSpeed2,M)}))}function gB(B,I){B.angle+=B.angularSpeed*I._scaledUpdateSpeed}function NB(B,I){I.particleEmitterType.startDirectionFunction(I._emitterWorldMatrix,B.direction,B,I.isLocal,I._emitterInverseWorldMatrix)}function RB(B,I){I.startDirectionFunction(I._emitterWorldMatrix,B.direction,B,I.isLocal)}function HB(B,I){B._currentVelocityGradient=I._velocityGradients[0],B._currentVelocity1=B._currentVelocityGradient.getFactor(),I._velocityGradients.length>1?B._currentVelocity2=I._velocityGradients[1].getFactor():B._currentVelocity2=B._currentVelocity1}function FB(B,I){B._currentLimitVelocityGradient=I._limitVelocityGradients[0],B._currentLimitVelocity1=B._currentLimitVelocityGradient.getFactor(),I._limitVelocityGradients.length>1?B._currentLimitVelocity2=I._limitVelocityGradients[1].getFactor():B._currentLimitVelocity2=B._currentLimitVelocity1}function kB(B,I){h.GetCurrentGradient(I._ratio,I._velocityGradients,((C,M,x)=>{C!==B._currentVelocityGradient&&(B._currentVelocity1=B._currentVelocity2,B._currentVelocity2=M.getFactor(),B._currentVelocityGradient=C),I._directionScale*=(0,g.Lerp)(B._currentVelocity1,B._currentVelocity2,x)}))}function qB(B,I){h.GetCurrentGradient(I._ratio,I._limitVelocityGradients,((C,M,x)=>{C!==B._currentLimitVelocityGradient&&(B._currentLimitVelocity1=B._currentLimitVelocity2,B._currentLimitVelocity2=M.getFactor(),B._currentLimitVelocityGradient=C);const y=(0,g.Lerp)(B._currentLimitVelocity1,B._currentLimitVelocity2,x);B.direction.length()>y&&B.direction.scaleInPlace(I.limitVelocityDamping)}))}function SB(B,I){B.direction.scaleToRef(I._directionScale,I._scaledDirection)}function oB(B,I){I.particleEmitterType.startPositionFunction(I._emitterWorldMatrix,B.position,B,I.isLocal)}function UB(B,I){I.startPositionFunction(I._emitterWorldMatrix,B.position,B,I.isLocal)}function GB(B,I){B.sL?B.sL.M(B.position):B.sL=B.position.clone(),M.HI.TransformCoordinatesToRef(B.sL,I._emitterWorldMatrix,B.position)}function VB(B,I){I.isLocal&&B.sL?(B.sL.addInPlace(I._scaledDirection),M.HI.TransformCoordinatesToRef(B.sL,I._emitterWorldMatrix,B.position)):B.position.addInPlace(I._scaledDirection)}function cB(B,I){B._currentDragGradient=I._dragGradients[0],B._currentDrag1=B._currentDragGradient.getFactor(),I._dragGradients.length>1?B._currentDrag2=I._dragGradients[1].getFactor():B._currentDrag2=B._currentDrag1}function tB(B,I){h.GetCurrentGradient(I._ratio,I._dragGradients,((C,M,x)=>{C!==B._currentDragGradient&&(B._currentDrag1=B._currentDrag2,B._currentDrag2=M.getFactor(),B._currentDragGradient=C);const y=(0,g.Lerp)(B._currentDrag1,B._currentDrag2,x);I._scaledDirection.scaleInPlace(1-y)}))}function rB(B,I){B._randomNoiseCoordinates1?(B._randomNoiseCoordinates1.vf(Math.random(),Math.random(),Math.random()),B._randomNoiseCoordinates2.vf(Math.random(),Math.random(),Math.random())):(B._randomNoiseCoordinates1=new M.HI(Math.random(),Math.random(),Math.random()),B._randomNoiseCoordinates2=new M.HI(Math.random(),Math.random(),Math.random()))}function AB(B,I){const C=I._noiseTextureData,x=I._noiseTextureSize;if(C&&x&&B._randomNoiseCoordinates1){const y=I._fetchR(B._randomNoiseCoordinates1.x,B._randomNoiseCoordinates1.y,x.width,x.height,C),f=I._fetchR(B._randomNoiseCoordinates1.z,B._randomNoiseCoordinates2.x,x.width,x.height,C),L=I._fetchR(B._randomNoiseCoordinates2.y,B._randomNoiseCoordinates2.z,x.width,x.height,C),e=M.TmpVectors.HI[0],g=M.TmpVectors.HI[1];e.vf((2*y-1)*I.noiseStrength.x,(2*f-1)*I.noiseStrength.y,(2*L-1)*I.noiseStrength.z),e.scaleToRef(I._tempScaledUpdateSpeed,g),B.direction.addInPlace(g)}}function DB(B,I){I.gravity.scaleToRef(I._tempScaledUpdateSpeed,I._scaledGravity),B.direction.addInPlace(I._scaledGravity)}function JB(B,I){B.size=(0,g.RandomRange)(I.minSize,I.maxSize),B.scale.vf((0,g.RandomRange)(I.minScaleX,I.maxScaleX),(0,g.RandomRange)(I.minScaleY,I.maxScaleY))}function iB(B,I){B._currentSizeGradient=I._sizeGradients[0],B._currentSize1=B._currentSizeGradient.getFactor(),B.size=B._currentSize1,I._sizeGradients.length>1?B._currentSize2=I._sizeGradients[1].getFactor():B._currentSize2=B._currentSize1,B.scale.vf((0,g.RandomRange)(I.minScaleX,I.maxScaleX),(0,g.RandomRange)(I.minScaleY,I.maxScaleY))}function uB(B,I){const C=I._actualFrame/I.targetStopDuration;h.GetCurrentGradient(C,I._startSizeGradients,((C,M,x)=>{C!==I._currentStartSizeGradient&&(I._currentStartSize1=I._currentStartSize2,I._currentStartSize2=M.getFactor(),I._currentStartSizeGradient=C);const y=(0,g.Lerp)(I._currentStartSize1,I._currentStartSize2,x);B.scale.scaleInPlace(y)}))}function pB(B,I){h.GetCurrentGradient(I._ratio,I._sizeGradients,((I,C,M)=>{I!==B._currentSizeGradient&&(B._currentSize1=B._currentSize2,B._currentSize2=C.getFactor(),B._currentSizeGradient=I),B.size=(0,g.Lerp)(B._currentSize1,B._currentSize2,M)}))}function nB(B,I){B.remapData=new M.Vector4(0,1,0,1)}function OB(B,I){I._colorRemapGradients&&I._colorRemapGradients.length>0&&h.GetCurrentGradient(I._ratio,I._colorRemapGradients,((I,C,M)=>{const x=(0,g.Lerp)(I.factor1,C.factor1,M),y=(0,g.Lerp)(I.factor2,C.factor2,M);B.remapData.x=x,B.remapData.y=y-x})),I._alphaRemapGradients&&I._alphaRemapGradients.length>0&&h.GetCurrentGradient(I._ratio,I._alphaRemapGradients,((I,C,M)=>{const x=(0,g.Lerp)(I.factor1,C.factor1,M),y=(0,g.Lerp)(I.factor2,C.factor2,M);B.remapData.z=x,B.remapData.w=y-x}))}function aB(B,I){const C=(0,g.Clamp)(I._actualFrame/I.targetStopDuration);h.GetCurrentGradient(C,I._lifeTimeGradients,((I,M)=>{const x=I,y=M,f=x.getFactor(),L=y.getFactor(),e=(C-x.gradient)/(y.gradient-x.gradient);B.lifeTime=(0,g.Lerp)(f,L,e)})),I._emitPower=(0,g.RandomRange)(I.minEmitPower,I.maxEmitPower)}function WB(B,I){B.lifeTime=(0,g.RandomRange)(I.minLifeTime,I.maxLifeTime),I._emitPower=(0,g.RandomRange)(I.minEmitPower,I.maxEmitPower)}function dB(B,I){0===I._emitPower?(B._initialDirection?B._initialDirection.M(B.direction):B._initialDirection=B.direction.clone(),B.direction.set(0,0,0)):(B._initialDirection=null,B.direction.scaleInPlace(I._emitPower)),B.direction.addInPlace(I._inheritedVelocityOffset)}function lB(B,I){B.angularSpeed=(0,g.RandomRange)(I.minAngularSpeed,I.maxAngularSpeed),B.angle=(0,g.RandomRange)(I.minInitialRotation,I.maxInitialRotation)}function EB(B,I){B._currentAngularSpeedGradient=I._angularSpeedGradients[0],B.angularSpeed=B._currentAngularSpeedGradient.getFactor(),B._currentAngularSpeed1=B.angularSpeed,I._angularSpeedGradients.length>1?B._currentAngularSpeed2=I._angularSpeedGradients[1].getFactor():B._currentAngularSpeed2=B._currentAngularSpeed1,B.angle=(0,g.RandomRange)(I.minInitialRotation,I.maxInitialRotation)}function QB(B,I){B._initialStartSpriteCellId=I.startSpriteCellID,B._initialEndSpriteCellId=I.endSpriteCellID,B._initialSpriteCellLoop=I.spriteCellLoop}function ZB(B,I){B.previousItem=I.previousItem,B.nextItem=I,I.previousItem&&(I.previousItem.nextItem=B),I.previousItem=B}function zB(B,I){B.previousItem=I,B.nextItem=I.nextItem,I.nextItem&&(I.nextItem.previousItem=B),I.nextItem=B}function bB(B,I){let C=I;for(;C.nextItem;)C=C.nextItem;B.previousItem=C,B.nextItem=C.nextItem,C.nextItem=B}function YB(B){B.previousItem&&(B.previousItem.nextItem=B.nextItem),B.nextItem&&(B.nextItem.previousItem=B.previousItem)}class vB extends e{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(B){this._startDirectionFunction!==B&&(this._startDirectionFunction=B,this._directionProcessing.process=B?RB:NB)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(B){this._startPositionFunction!==B&&(this._startPositionFunction=B,this._positionCreation.process=B?UB:oB)}set onDispose(B){this._onDisposeObserver&&this.If.remove(this._onDisposeObserver),this._onDisposeObserver=this.If.add(B)}get R(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(B){this._useRampGradients!==B&&(this._useRampGradients=B,this._resetEffect(),B?(this._rampCreation={process:nB,previousItem:null,nextItem:null},zB(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:OB,previousItem:null,nextItem:null},zB(this._remapGradientProcessing,this._gravityProcessing)):(YB(this._rampCreation),YB(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(B){this._isLocal!==B&&(this._isLocal=B,B?(this._isLocalCreation={process:GB,previousItem:null,nextItem:null},zB(this._isLocalCreation,this._positionCreation)):YB(this._isLocalCreation))}get particles(){return this.GH}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(B){this._animationSheetEnabled!==B&&(this._animationSheetEnabled=B,B?(this._sheetCreation={process:QB,previousItem:null,nextItem:null},zB(this._sheetCreation,this._colorCreation)):YB(this._sheetCreation),this._reset())}getActiveCount(){return this.GH.length}getClassName(){return"Ie"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var B;let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(B=this._customWrappers[I])||void 0===B?void 0:B.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[B]??this._customWrappers[0]}setCustomEffect(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[I]=new BB.b(this._engine),this._customWrappers[I].effect=B,this._customWrappers[I].drawContext&&(this._customWrappers[I].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new j.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(B){if(this.noiseTexture!==B){if(this._noiseTexture=B,!B)return YB(this._noiseCreation),void YB(this._noiseProcessing);this._noiseCreation={process:rB,previousItem:null,nextItem:null},zB(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:AB,previousItem:null,nextItem:null},zB(this._noiseProcessing,this._positionProcessing)}}constructor(B,I,C){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4&&void 0!==arguments[4]&&arguments[4],L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,e=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(B),this._emitterInverseWorldMatrix=M.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new M.HI,this.If=new j.e,this.onStoppedObservable=new j.e,this.onStartedObservable=new j.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.GH=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new f.Pf(0,0,0,0),this._colorDiff=new f.Pf(0,0,0,0),this._scaledDirection=M.HI.Zero(),this._scaledGravity=M.HI.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=B=>{},this.recycleParticle=B=>{const I=this.GH.pop();I!==B&&I.copyTo(B),this._stockParticles.push(I)},this._createParticle=()=>{let B;return 0!==this._stockParticles.length?(B=this._stockParticles.pop(),B._reset()):B=new m(this),this._prepareParticle(B),B},this.paused=!1,this._shadersLoaded=!1,this._capacity=I,this._epsilon=L,C&&"Scene"!==C.getClassName()?(this._engine=C,this.defaultProjectionMatrix=M.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=C||K.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.oH.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:WB,previousItem:null,nextItem:null},this._positionCreation={process:oB,previousItem:null,nextItem:null},zB(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:NB,previousItem:null,nextItem:null},zB(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:dB,previousItem:null,nextItem:null},zB(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:JB,previousItem:null,nextItem:null},zB(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:lB,previousItem:null,nextItem:null},zB(this._angleCreation,this._sizeCreation),this._colorCreation={process:xB,previousItem:null,nextItem:null},zB(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,e||(this._colorProcessing={process:LB,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:gB,previousItem:null,nextItem:null},zB(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:SB,previousItem:null,nextItem:null},zB(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:VB,previousItem:null,nextItem:null},zB(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:DB,previousItem:null,nextItem:null},zB(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=y,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new BB.b(this._engine)},this._customWrappers[0].effect=x,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new R,this.updateFunction=B=>{var I;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(I=this.noiseTexture.getContent())||void 0===I||I.then((B=>{this._noiseTextureData=B})));const C=B===this.GH;for(let M=0;M<B.length;M++){const I=B[M];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const x=I.age;if(I.age+=this._tempScaledUpdateSpeed,I.age>I.lifeTime){const B=I.age-x,C=I.lifeTime-x;this._tempScaledUpdateSpeed=C*this._tempScaledUpdateSpeed/B,I.age=I.lifeTime}this._ratio=I.age/I.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let y=this._updateQueueStart;for(;y;)y.process(I,this),y=y.nextItem;if(this._isAnimationSheetEnabled&&!e&&I.updateCellIndex(),I._inheritParticleInfoToSubEmitters(),I.age>=I.lifeTime){if(this._emitFromParticle(I),I._attachedSubEmitters){for(const B of I._attachedSubEmitters)B.particleSystem.disposeOnStop=!0,B.particleSystem.stop();I._attachedSubEmitters=null}this.recycleParticle(I),C&&M--}else;}}}serialize(B){throw new Error("Method not implemented.")}clone(B,I){throw new Error("Method not implemented.")}_addFactorGradient(B,I,C,M){const x=new P(I,C,M);B.push(x),B.sort(((B,I)=>B.gradient<I.gradient?-1:B.gradient>I.gradient?1:0))}_removeFactorGradient(B,I){if(!B)return;let C=0;for(const M of B){if(M.gradient===I){B.splice(C,1);break}C++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=aB:this._lifeTimeCreation.process=WB}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:uB,previousItem:null,nextItem:null},zB(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(YB(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(B){this.targetStopDuration!==B&&(this._targetStopDuration=B,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(B,I,C){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,B,I,C),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(B){return this._removeFactorGradient(this._lifeTimeGradients,B),this._syncLifeTimeCreation(),this}addSizeGradient(B,I,C){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=iB,this._sizeGradientProcessing={process:pB,previousItem:null,nextItem:null},ZB(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,B,I,C),this}removeSizeGradient(B){var I;return this._removeFactorGradient(this._sizeGradients,B),0===(null===(I=this._sizeGradients)||void 0===I?void 0:I.length)&&(YB(this._sizeGradientProcessing),this._sizeCreation.process=JB),this}addColorRemapGradient(B,I,C){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,B,I,C),this}removeColorRemapGradient(B){return this._removeFactorGradient(this._colorRemapGradients,B),this}addAlphaRemapGradient(B,I,C){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,B,I,C),this}removeAlphaRemapGradient(B){return this._removeFactorGradient(this._alphaRemapGradients,B),this}addAngularSpeedGradient(B,I,C){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=EB,this._angularSpeedGradientProcessing={process:eB,previousItem:null,nextItem:null},ZB(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,B,I,C),this}removeAngularSpeedGradient(B){var I;return this._removeFactorGradient(this._angularSpeedGradients,B),0===(null===(I=this._angularSpeedGradients)||void 0===I?void 0:I.length)&&(this._angleCreation.process=lB,YB(this._angularSpeedGradientProcessing)),this}addVelocityGradient(B,I,C){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:HB,previousItem:null,nextItem:null},zB(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:kB,previousItem:null,nextItem:null},ZB(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,B,I,C),this}removeVelocityGradient(B){var I;return this._removeFactorGradient(this._velocityGradients,B),0===(null===(I=this._velocityGradients)||void 0===I?void 0:I.length)&&(YB(this._velocityCreation),YB(this._velocityGradientProcessing)),this}addLimitVelocityGradient(B,I,C){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:FB,previousItem:null,nextItem:null},zB(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:qB,previousItem:null,nextItem:null},zB(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,B,I,C),this}removeLimitVelocityGradient(B){var I;return this._removeFactorGradient(this._limitVelocityGradients,B),0===(null===(I=this._limitVelocityGradients)||void 0===I?void 0:I.length)&&(YB(this._limitVelocityCreation),YB(this._limitVelocityGradientProcessing)),this}addDragGradient(B,I,C){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:cB,previousItem:null,nextItem:null},ZB(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:tB,previousItem:null,nextItem:null},ZB(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,B,I,C),this}removeDragGradient(B){var I;return this._removeFactorGradient(this._dragGradients,B),0===(null===(I=this._dragGradients)||void 0===I?void 0:I.length)&&(YB(this._dragCreation),YB(this._dragGradientProcessing)),this}addEmitRateGradient(B,I,C){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,B,I,C),this}removeEmitRateGradient(B){return this._removeFactorGradient(this._emitRateGradients,B),this}addStartSizeGradient(B,I,C){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,B,I,C),this._syncStartSizeCreation(),this}removeStartSizeGradient(B){return this._removeFactorGradient(this._startSizeGradients,B),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const B=new Uint8Array(4*this._rawTextureWidth),I=f.TmpColors.SI[0];for(let C=0;C<this._rawTextureWidth;C++){const M=C/this._rawTextureWidth;h.GetCurrentGradient(M,this._rampGradients,((M,x,y)=>{f.SI.LerpToRef(M.color,x.color,y,I),B[4*C]=255*I.r,B[4*C+1]=255*I.g,B[4*C+2]=255*I.b,B[4*C+3]=255}))}this._rampGradientsTexture=w.e.CreateRGBATexture(B,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((B,I)=>B.gradient<I.gradient?-1:B.gradient>I.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(B,I){this._rampGradients||(this._rampGradients=[]);const C=new T(B,I);return this._rampGradients.push(C),this._syncRampGradientTexture(),this}removeRampGradient(B){return this._removeGradientAndTexture(B,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(B,I,C){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=yB,this._colorProcessing.process=fB);const M=new X(B,I,C);return this._colorGradients.push(M),this._colorGradients.sort(((B,I)=>B.gradient<I.gradient?-1:B.gradient>I.gradient?1:0)),this}removeColorGradient(B){if(!this._colorGradients)return this;let I=0;for(const C of this._colorGradients){if(C.gradient===B){this._colorGradients.splice(I,1);break}I++}return 0===this._colorGradients.length&&(this._colorCreation.process=xB,this._colorProcessing.process=LB),this}resetDrawCache(){if(this._drawWrappers){for(const B of this._drawWrappers)if(B)for(const I of B)null===I||void 0===I||I.dispose();this._drawWrappers=[]}}_fetchR(B,I,C,M,x){return x[4*(((B=.5*Math.abs(B)+.5)*C%C|0)+((I=.5*Math.abs(I)+.5)*M%M|0)*C)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const B=this._engine,I=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*I),this._vertexBuffer=new c.d(B,this._vertexData,!0,I);let C=0;const M=this._vertexBuffer.createVertexBuffer(c.g.PositionKind,C,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[c.g.PositionKind]=M,C+=3;const x=this._vertexBuffer.createVertexBuffer(c.g.ColorKind,C,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[c.g.ColorKind]=x,C+=4;const y=this._vertexBuffer.createVertexBuffer("angle",C,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=y,C+=1;const f=this._vertexBuffer.createVertexBuffer("size",C,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=f,C+=2,this._isAnimationSheetEnabled){const B=this._vertexBuffer.createVertexBuffer("cellIndex",C,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=B,C+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const B=this._vertexBuffer.createVertexBuffer("direction",C,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=B,C+=3}if(this._useRampGradients){const B=this._vertexBuffer.createVertexBuffer("remapData",C,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=B,C+=4}let L;if(this._useInstancing){const I=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new c.d(B,I,!1,2),L=this._spriteBuffer.createVertexBuffer("offset",0,2)}else L=this._vertexBuffer.createVertexBuffer("offset",C,2,this._vertexBufferSize,this._useInstancing),C+=2;this._vertexBuffers.offset=L,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const B=[],I=[];let C=0;for(let M=0;M<this._capacity;M++)B.push(C),B.push(C+1),B.push(C+2),B.push(C),B.push(C+2),B.push(C+3),I.push(C,C+1,C+1,C+2,C+2,C+3,C+3,C,C,C+3),C+=4;this._indexBuffer=this._engine.createIndexBuffer(B),this._linesIndexBuffer=this._engine.createIndexBuffer(I)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(B)setTimeout((()=>{this.start(0)}),B);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var I;-1!==(null===(I=this.j)||void 0===I?void 0:I.getClassName().indexOf("Mesh"))&&this.j.nf(!0);const B=this.noiseTexture;if(B&&B.onGeneratedObservable)B.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let I=0;I<this.preWarmCycles;I++)this.animate(!0),B.render()}))}));else for(let I=0;I<this.preWarmCycles;I++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(B))}_postStop(B){}reset(){this._stockParticles.length=0,this.GH.length=0}_appendParticleVertex(B,I,C,x){let y=B*this._vertexBufferSize;if(this._vertexData[y++]=I.position.x+this.lg.x,this._vertexData[y++]=I.position.y+this.lg.y,this._vertexData[y++]=I.position.z+this.lg.z,this._vertexData[y++]=I.color.r,this._vertexData[y++]=I.color.g,this._vertexData[y++]=I.color.b,this._vertexData[y++]=I.color.a,this._vertexData[y++]=I.angle,this._vertexData[y++]=I.scale.x*I.size,this._vertexData[y++]=I.scale.y*I.size,this._isAnimationSheetEnabled&&(this._vertexData[y++]=I.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[y++]=I.direction.x,this._vertexData[y++]=I.direction.y,this._vertexData[y++]=I.direction.z);else if(I._initialDirection){let B=I._initialDirection;this.isLocal&&(M.HI.TransformNormalToRef(B,this._emitterWorldMatrix,M.TmpVectors.HI[0]),B=M.TmpVectors.HI[0]),0===B.x&&0===B.z&&(B.x=.001),this._vertexData[y++]=B.x,this._vertexData[y++]=B.y,this._vertexData[y++]=B.z}else{let B=I.direction;this.isLocal&&(M.HI.TransformNormalToRef(B,this._emitterWorldMatrix,M.TmpVectors.HI[0]),B=M.TmpVectors.HI[0]),0===B.x&&0===B.z&&(B.x=.001),this._vertexData[y++]=B.x,this._vertexData[y++]=B.y,this._vertexData[y++]=B.z}this._useRampGradients&&I.remapData&&(this._vertexData[y++]=I.remapData.x,this._vertexData[y++]=I.remapData.y,this._vertexData[y++]=I.remapData.z,this._vertexData[y++]=I.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===C?C=this._epsilon:1===C&&(C=1-this._epsilon),0===x?x=this._epsilon:1===x&&(x=1-this._epsilon)),this._vertexData[y++]=C,this._vertexData[y++]=x)}_prepareParticle(B){}_createNewOnes(B){let I;for(let C=0;C<B&&this.GH.length!==this._capacity;C++){I=this._createParticle(),this.GH.push(I);let B=this._createQueueStart;for(;B;)B.process(I,this),B=B.nextItem;I._inheritParticleInfoToSubEmitters()}}_update(B){if(this._alive=this.GH.length>0,this.j.position){const B=this.j;this._emitterWorldMatrix=B.getWorldMatrix()}else{const B=this.j;this._emitterWorldMatrix=M.Matrix.Translation(B.x,B.y,B.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.GH),this._createNewOnes(B)}static _GetAttributeNamesOrOptions(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const M=[c.g.PositionKind,c.g.ColorKind,"angle","offset","size"];return B&&M.push("cellIndex"),I||M.push("direction"),C&&M.push("remapData"),M}static _GetEffectCreationOptions(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const M=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,IB.e)(M),B&&M.push("particlesInfos"),I&&M.push("logarithmicDepthConstant"),C&&(M.push("vFogInfos"),M.push("vFogColor")),M}fillDefines(B,I){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,IB.l)(this,this._scene,B),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&B.push("#define FOG")),this._isAnimationSheetEnabled&&B.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&B.push("#define LOGARITHMICDEPTH"),I===e.BLENDMODE_MULTIPLY&&B.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&B.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(B.push("#define BILLBOARD"),this.billboardMode){case 2:B.push("#define BILLBOARDY");break;case 8:case 9:B.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&B.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:B.push("#define BILLBOARDMODE_ALL")}C&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),B.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(B,I,C){I.push(...vB._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),B.push(...vB._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),C.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,MB.i)(B,this._imageProcessingConfigurationDefines),(0,MB.e)(C,this._imageProcessingConfigurationDefines))}_getWrapper(B){const I=this._getCustomDrawWrapper(B);if(null!==I&&void 0!==I&&I.effect)return I;const C=[];this.fillDefines(C,B);const M=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let x=this._drawWrappers[M];x||(x=this._drawWrappers[M]=[]);let y=x[B];y||(y=new BB.b(this._engine),y.drawContext&&(y.drawContext.useInstancing=this._useInstancing),x[B]=y);const f=C.join("\n");if(y.defines!==f){const B=[],I=[],C=[];this.fillUniformsAttributesAndSamplerNames(I,B,C),y.setEffect(this._engine.createEffect("particles",B,I,C,f,void 0,void 0,void 0,void 0,this._shaderLanguage),f)}return y}animate(){var B;let I,C=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!C&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(C?this.preWarmStepOffset:(null===(B=this._scene)||void 0===B?void 0:B.getAnimationRatio())||1),this.manualEmitCount>-1)I=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let B=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const I=this._actualFrame/this.targetStopDuration;h.GetCurrentGradient(I,this._emitRateGradients,((I,C,M)=>{I!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=C.getFactor(),this._currentEmitRateGradient=I),B=(0,g.Lerp)(this._currentEmitRate1,this._currentEmitRate2,M)}))}I=B*this._scaledUpdateSpeed|0,this._newPartsExcess+=B*this._scaledUpdateSpeed-I}if(this._newPartsExcess>1&&(I+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?I=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(I),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!C){let B=0;for(let I=0;I<this.GH.length;I++){const C=this.GH[I];this._appendParticleVertices(B,C),B+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.GH.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(B,I){this._appendParticleVertex(B++,I,0,0),this._useInstancing||(this._appendParticleVertex(B++,I,1,0),this._appendParticleVertex(B++,I,1,1),this._appendParticleVertex(B++,I,0,1))}rebuild(){var B;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(B=this._spriteBuffer)||void 0===B||B._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!vB.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(C.bind(C,12643)),Promise.resolve().then(C.bind(C,12588))])):await Promise.all([Promise.resolve().then(C.bind(C,12577)),Promise.resolve().then(C.bind(C,12569))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==e.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(e.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(e.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(B){const I=this._getWrapper(B),C=I.effect,x=this._engine;x.enableEffect(I);const y=this.defaultViewMatrix??this._scene.getViewMatrix();if(C.setTexture("diffuseSampler",this.particleTexture),C.setMatrix("view",y),C.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const B=this.particleTexture.getBaseSize();C.setFloat3("particlesInfos",this.spriteCellWidth/B.width,this.spriteCellHeight/B.height,this.spriteCellWidth/B.width)}if(C.setVector2("translationPivot",this.translationPivot),C.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const B=this._scene.activeCamera;C.setVector3("eyePosition",B.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),C.setTexture("rampSampler",this._rampGradientsTexture));const f=C.defines;var L,e,g,N,R,H;(this._scene&&((0,IB.f)(C,this,this._scene),this.applyFog&&(0,CB.e)(this._scene,void 0,C)),f.indexOf("#define BILLBOARDMODE_ALL")>=0&&(y.invertToRef(M.TmpVectors.Matrix[0]),C.setMatrix("invView",M.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?x.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,C):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,C)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?x.bindBuffers(this._vertexBuffers,null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?this._linesIndexBuffer:this._indexBuffer,C):x.bindBuffers(this._vertexBuffers,null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?this._linesIndexBufferUseInstancing:null,C);(this.useLogarithmicDepth&&this._scene&&(0,CB.h)(f,C,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(C),this._setEngineBasedOnBlendMode(B),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(C),this._useInstancing)?null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?x.drawElementsType(6,0,10,this.GH.length):x.drawArraysType(7,0,4,this.GH.length):null!==(H=this._scene)&&void 0!==H&&H.forceWireframe?x.drawElementsType(1,0,10*this.GH.length):x.drawElementsType(0,0,6*this.GH.length);return this.GH.length}render(){if(!this.isReady()||!this.GH.length)return 0;const B=this._engine;B.setState&&(B.setState(!1),this.forceDepthWrite&&B.setDepthWrite(!0));let I=0;return I=this.blendMode===e.BLENDMODE_MULTIPLYADD?this._render(e.BLENDMODE_MULTIPLY)+this._render(e.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),I}_onDispose(){}dispose(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),B&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),B&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(I,C),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const B=this._scene.oH.indexOf(this);B>-1&&this._scene.oH.splice(B,1),this._scene._activeParticleSystems.dispose()}this.If.notifyObservers(this),this.If.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}vB.ForceGLSL=!1;var sB,XB=C(11042);!function(B){B[B.ATTACHED=0]="ATTACHED",B[B.END=1]="END"}(sB||(sB={}));class TB{constructor(B){if(this.particleSystem=B,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!B.j||!B.j.dispose){const I=(0,L.e)("BABYLON.AbstractMesh");B.j=new I("SubemitterSystemEmitter",B.rB()),B._disposeEmitterOnDispose=!0}}clone(){let B=this.particleSystem.j;if(B){if(B instanceof M.HI)B=B.clone();else if(-1!==B.getClassName().indexOf("Mesh")){B=new((0,L.e)("BABYLON.Mesh"))("",B.rB()),B.isVisible=!1}}else B=new M.HI;const I=new TB(this.particleSystem.clone(this.particleSystem.name,B));return I.particleSystem.name+="Clone",I.type=this.type,I.inheritDirection=this.inheritDirection,I.inheritedVelocityAmount=this.inheritedVelocityAmount,I.particleSystem._disposeEmitterOnDispose=!0,I.particleSystem.disposeOnStop=!0,I}serialize(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I={};return I.type=this.type,I.inheritDirection=this.inheritDirection,I.inheritedVelocityAmount=this.inheritedVelocityAmount,I.particleSystem=this.particleSystem.serialize(B),I}static _ParseParticleSystem(B,I,C){throw(0,XB.c)("ParseParticle")}static Parse(B,I,C){const M=B.particleSystem,x=new TB(TB._ParseParticleSystem(M,I,C,!0));return x.type=B.type,x.inheritDirection=B.inheritDirection,x.inheritedVelocityAmount=B.inheritedVelocityAmount,x.particleSystem._isSubEmitter=!0,x}dispose(){this.particleSystem.dispose()}}var PB=C(11096);function hB(B,I){const C=new o;return C.direction1=B,C.direction2=I,C}function jB(){return new S(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function wB(){return new U(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function KB(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new M.HI(0,1,0),C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M.HI(0,1,0);return new G(B,I,C)}function mB(){return new k(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function BI(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new M.HI(0,1,0),y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new M.HI(0,1,0);return new q(B,I,C,x,y)}function II(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new H(B,I)}function CI(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M.HI(0,1,0),x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new M.HI(0,1,0);return new F(B,I,C,x)}const MI=M.HI.Zero(),xI=M.HI.Zero(),yI=M.HI.Zero();class fI{constructor(){this.strength=0,this.position=M.HI.Zero()}_processParticle(B,I){this.position.subtractToRef(B.position,MI);const C=MI.lengthSquared()+1;MI.normalize().scaleToRef(this.strength/C,xI),xI.scaleToRef(I._tempScaledUpdateSpeed,yI),B.direction.addInPlace(yI)}serialize(){return{position:this.position.Df(),strength:this.strength}}}class LI extends vB{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=B=>{if(!this._subEmitters||0===this._subEmitters.length)return;const I=Math.floor(Math.random()*this._subEmitters.length);for(const C of this._subEmitters[I])if(1===C.type){const I=C.clone();B._inheritParticleInfoToSubEmitter(I),I.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(I.particleSystem),I.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(B,I){const C=hB(B,I);return this.particleEmitterType=C,C}get flowMap(){return this._flowMap}set flowMap(B){this._flowMap!==B&&(this._flowMap=B,this._flowMapUpdate&&(YB(this._flowMapUpdate),this._flowMapUpdate=null),B&&(this._flowMapUpdate={process:B=>{var I;const C=null===(I=this.rB())||void 0===I?void 0:I.getTransformMatrix();this._flowMap._processParticle(B,this.flowMapStrength*this._tempScaledUpdateSpeed,C)},previousItem:null,nextItem:null},zB(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(B){this._attractors.push(B),1===this._attractors.length&&(this._attractorUpdate={process:B=>{for(const I of this._attractors)I._processParticle(B,this)},previousItem:null,nextItem:null},zB(this._attractorUpdate,this._directionProcessing))}removeAttractor(B){const I=this._attractors.indexOf(B);-1!==I&&this._attractors.splice(I,1),0===this._attractors.length&&YB(this._attractorUpdate)}start(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(B)}createHemisphericEmitter(){const B=jB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=B,B}createSphereEmitter(){const B=wB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=B,B}createDirectedSphereEmitter(){const B=KB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new M.HI(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M.HI(0,1,0));return this.particleEmitterType=B,B}createCylinderEmitter(){const B=mB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=B,B}createDirectedCylinderEmitter(){const B=BI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new M.HI(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new M.HI(0,1,0));return this.particleEmitterType=B,B}createConeEmitter(){const B=II(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=B,B}createDirectedConeEmitter(){const B=CI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M.HI(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new M.HI(0,1,0));return this.particleEmitterType=B,B}createBoxEmitter(B,I,C,M){const x=new R;return this.particleEmitterType=x,this.direction1=B,this.direction2=I,this.minEmitBox=C,this.maxEmitBox=M,x}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const B of this.subEmitters)B instanceof LI?this._subEmitters.push([new TB(B)]):B instanceof TB?this._subEmitters.push([B]):B instanceof Array&&this._subEmitters.push(B)}_stopSubEmitters(){if(this.activeSubSystems){for(const B of this.activeSubSystems)B.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const B=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==B&&this._rootParticleSystem.activeSubSystems.splice(B,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(B){B&&this._stopSubEmitters()}_prepareParticle(B){if(this._subEmitters&&this._subEmitters.length>0){const I=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];B._attachedSubEmitters=[];for(const C of I)if(0===C.type){const I=C.clone();B._attachedSubEmitters.push(I),I.particleSystem.start()}}}_onDispose(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),B&&this.particles)for(const C of this.particles)if(C._attachedSubEmitters)for(let B=C._attachedSubEmitters.length-1;B>=0;B-=1)C._attachedSubEmitters[B].dispose();if(I&&this.activeSubSystems)for(let C=this.activeSubSystems.length-1;C>=0;C-=1)this.activeSubSystems[C].dispose();if(this._subEmitters&&this._subEmitters.length){for(let B=0;B<this._subEmitters.length;B++)for(const I of this._subEmitters[B])I.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(B,I,C,x){let y;y=C instanceof PB.e?null:C;const e=(0,L.e)("BABYLON.Texture");if(e&&y&&(B.texture?I.particleTexture=e.Parse(B.texture,y,x):B.textureName&&(I.particleTexture=new e(x+B.textureName,y,!1,void 0===B.invertY||B.invertY),I.particleTexture.name=B.textureName)),B.emitterId||0===B.emitterId||void 0!==B.j?B.emitterId&&y?I.j=y.getLastMeshById(B.emitterId):I.j=M.HI.oI(B.j):I.j=M.HI.Zero(),I.isLocal=!!B.isLocal,void 0!==B.renderingGroupId&&(I.renderingGroupId=B.renderingGroupId),void 0!==B.isBillboardBased&&(I.isBillboardBased=B.isBillboardBased),void 0!==B.billboardMode&&(I.billboardMode=B.billboardMode),void 0!==B.useLogarithmicDepth&&(I.useLogarithmicDepth=B.useLogarithmicDepth),B.animations){for(let C=0;C<B.animations.length;C++){const M=B.animations[C],x=(0,L.e)("BABYLON.Animation");x&&I.animations.push(x.Parse(M))}I.beginAnimationOnStart=B.beginAnimationOnStart,I.beginAnimationFrom=B.beginAnimationFrom,I.beginAnimationTo=B.beginAnimationTo,I.beginAnimationLoop=B.beginAnimationLoop}if(B.autoAnimate&&y&&y.beginAnimation(I,B.autoAnimateFrom,B.autoAnimateTo,B.autoAnimateLoop,B.autoAnimateSpeed||1),I.startDelay=0|B.startDelay,I.minAngularSpeed=B.minAngularSpeed,I.maxAngularSpeed=B.maxAngularSpeed,I.minSize=B.minSize,I.maxSize=B.maxSize,B.minScaleX&&(I.minScaleX=B.minScaleX,I.maxScaleX=B.maxScaleX,I.minScaleY=B.minScaleY,I.maxScaleY=B.maxScaleY),void 0!==B.preWarmCycles&&(I.preWarmCycles=B.preWarmCycles,I.preWarmStepOffset=B.preWarmStepOffset),void 0!==B.minInitialRotation&&(I.minInitialRotation=B.minInitialRotation,I.maxInitialRotation=B.maxInitialRotation),I.minLifeTime=B.minLifeTime,I.maxLifeTime=B.maxLifeTime,I.minEmitPower=B.minEmitPower,I.maxEmitPower=B.maxEmitPower,I.emitRate=B.emitRate,I.gravity=M.HI.oI(B.gravity),B.noiseStrength&&(I.noiseStrength=M.HI.oI(B.noiseStrength)),I.color1=f.Pf.oI(B.color1),I.color2=f.Pf.oI(B.color2),I.colorDead=f.Pf.oI(B.colorDead),I.updateSpeed=B.updateSpeed,I.targetStopDuration=B.targetStopDuration,I.blendMode=B.blendMode,B.colorGradients)for(const M of B.colorGradients)I.addColorGradient(M.gradient,f.Pf.oI(M.color1),M.color2?f.Pf.oI(M.color2):void 0);if(B.rampGradients){for(const C of B.rampGradients)I.addRampGradient(C.gradient,f.SI.oI(C.color));I.useRampGradients=B.useRampGradients}if(B.colorRemapGradients)for(const M of B.colorRemapGradients)I.addColorRemapGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(B.alphaRemapGradients)for(const M of B.alphaRemapGradients)I.addAlphaRemapGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(B.sizeGradients)for(const M of B.sizeGradients)I.addSizeGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(B.angularSpeedGradients)for(const M of B.angularSpeedGradients)I.addAngularSpeedGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(B.velocityGradients)for(const M of B.velocityGradients)I.addVelocityGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(B.dragGradients)for(const M of B.dragGradients)I.addDragGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(B.emitRateGradients)for(const M of B.emitRateGradients)I.addEmitRateGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(B.startSizeGradients)for(const M of B.startSizeGradients)I.addStartSizeGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(B.lifeTimeGradients)for(const M of B.lifeTimeGradients)I.addLifeTimeGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);if(B.limitVelocityGradients){for(const C of B.limitVelocityGradients)I.addLimitVelocityGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);I.limitVelocityDamping=B.limitVelocityDamping}if(B.noiseTexture&&y){const C=(0,L.e)("BABYLON.ProceduralTexture");I.noiseTexture=C.Parse(B.noiseTexture,y,x)}let g;if(B.particleEmitterType){switch(B.particleEmitterType.type){case"SphereParticleEmitter":g=new U;break;case"SphereDirectedParticleEmitter":g=new G;break;case"ConeEmitter":case"ConeParticleEmitter":g=new H;break;case"ConeDirectedParticleEmitter":g=new F;break;case"CylinderParticleEmitter":g=new k;break;case"CylinderDirectedParticleEmitter":g=new q;break;case"HemisphericParticleEmitter":g=new S;break;case"PointParticleEmitter":g=new o;break;case"MeshParticleEmitter":g=new t;break;case"CustomParticleEmitter":g=new V;break;default:g=new R}g.parse(B.particleEmitterType,y)}else g=new R,g.parse(B,y);I.particleEmitterType=g,I.startSpriteCellID=B.startSpriteCellID,I.endSpriteCellID=B.endSpriteCellID,I.spriteCellLoop=B.spriteCellLoop??!0,I.spriteCellWidth=B.spriteCellWidth,I.spriteCellHeight=B.spriteCellHeight,I.spriteCellChangeSpeed=B.spriteCellChangeSpeed,I.spriteRandomStartCell=B.spriteRandomStartCell,I.disposeOnStop=B.disposeOnStop??!1,I.manualEmitCount=B.manualEmitCount??-1}static Parse(B,I,C){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],y=arguments.length>4?arguments[4]:void 0;const L=B.name;let e,g,N=null,R=null;if(I instanceof PB.e?e=I:(g=I,e=g.getEngine()),B.customShader&&e.createEffectForParticles){R=B.customShader;const I=R.shaderOptions.defines.length>0?R.shaderOptions.defines.join("\n"):"";N=e.createEffectForParticles(R.shaderPath.fragmentElement,R.shaderOptions.uniforms,R.shaderOptions.samplers,I)}const H=new LI(L,y||B.nI,I,N,B.isAnimationSheetEnabled);if(H.customShader=R,H._rootUrl=C,B.id&&(H.id=B.id),B.subEmitters){H.subEmitters=[];for(const M of B.subEmitters){const B=[];for(const x of M)B.push(TB.Parse(x,I,C));H.subEmitters.push(B)}}if(B.attractors)for(const f of B.attractors){const B=new fI;B.position=M.HI.oI(f.position),B.strength=f.strength,H.addAttractor(B)}return LI._Parse(B,H,I,C),B.textureMask&&(H.textureMask=f.Pf.oI(B.textureMask)),B.lg&&(H.lg=M.HI.oI(B.lg)),B.preventAutoStart&&(H.preventAutoStart=B.preventAutoStart),x||H.preventAutoStart||H.start(),H}serialize(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I={};if(LI._Serialize(I,this,B),I.textureMask=this.textureMask.Df(),I.customShader=this.customShader,I.preventAutoStart=this.preventAutoStart,I.lg=this.lg.Df(),this.subEmitters){I.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const C of this._subEmitters){const M=[];for(const I of C)M.push(I.serialize(B));I.subEmitters.push(M)}}if(this._attractors&&this._attractors.length){I.attractors=[];for(const B of this._attractors)I.attractors.push(B.serialize())}return I}static _Serialize(B,I,C){if(B.name=I.name,B.id=I.id,B.nI=I.getCapacity(),B.disposeOnStop=I.disposeOnStop,B.manualEmitCount=I.manualEmitCount,I.j.position){const C=I.j;B.emitterId=C.id}else{const C=I.j;B.j=C.Df()}I.particleEmitterType&&(B.particleEmitterType=I.particleEmitterType.serialize()),I.particleTexture&&(C?B.texture=I.particleTexture.serialize():(B.textureName=I.particleTexture.name,B.invertY=!!I.particleTexture._invertY)),B.isLocal=I.isLocal,a.d.AppendSerializedAnimations(I,B),B.beginAnimationOnStart=I.beginAnimationOnStart,B.beginAnimationFrom=I.beginAnimationFrom,B.beginAnimationTo=I.beginAnimationTo,B.beginAnimationLoop=I.beginAnimationLoop,B.startDelay=I.startDelay,B.renderingGroupId=I.renderingGroupId,B.isBillboardBased=I.isBillboardBased,B.billboardMode=I.billboardMode,B.minAngularSpeed=I.minAngularSpeed,B.maxAngularSpeed=I.maxAngularSpeed,B.minSize=I.minSize,B.maxSize=I.maxSize,B.minScaleX=I.minScaleX,B.maxScaleX=I.maxScaleX,B.minScaleY=I.minScaleY,B.maxScaleY=I.maxScaleY,B.minEmitPower=I.minEmitPower,B.maxEmitPower=I.maxEmitPower,B.minLifeTime=I.minLifeTime,B.maxLifeTime=I.maxLifeTime,B.emitRate=I.emitRate,B.gravity=I.gravity.Df(),B.noiseStrength=I.noiseStrength.Df(),B.color1=I.color1.Df(),B.color2=I.color2.Df(),B.colorDead=I.colorDead.Df(),B.updateSpeed=I.updateSpeed,B.targetStopDuration=I.targetStopDuration,B.blendMode=I.blendMode,B.preWarmCycles=I.preWarmCycles,B.preWarmStepOffset=I.preWarmStepOffset,B.minInitialRotation=I.minInitialRotation,B.maxInitialRotation=I.maxInitialRotation,B.startSpriteCellID=I.startSpriteCellID,B.spriteCellLoop=I.spriteCellLoop,B.endSpriteCellID=I.endSpriteCellID,B.spriteCellChangeSpeed=I.spriteCellChangeSpeed,B.spriteCellWidth=I.spriteCellWidth,B.spriteCellHeight=I.spriteCellHeight,B.spriteRandomStartCell=I.spriteRandomStartCell,B.isAnimationSheetEnabled=I.isAnimationSheetEnabled,B.useLogarithmicDepth=I.useLogarithmicDepth;const M=I.getColorGradients();if(M){B.colorGradients=[];for(const I of M){const C={gradient:I.gradient,color1:I.color1.Df()};I.color2?C.color2=I.color2.Df():C.color2=I.color1.Df(),B.colorGradients.push(C)}}const x=I.getRampGradients();if(x){B.rampGradients=[];for(const I of x){const C={gradient:I.gradient,color:I.color.Df()};B.rampGradients.push(C)}B.useRampGradients=I.useRampGradients}const y=I.getColorRemapGradients();if(y){B.colorRemapGradients=[];for(const I of y){const C={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?C.factor2=I.factor2:C.factor2=I.factor1,B.colorRemapGradients.push(C)}}const f=I.getAlphaRemapGradients();if(f){B.alphaRemapGradients=[];for(const I of f){const C={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?C.factor2=I.factor2:C.factor2=I.factor1,B.alphaRemapGradients.push(C)}}const L=I.getSizeGradients();if(L){B.sizeGradients=[];for(const I of L){const C={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?C.factor2=I.factor2:C.factor2=I.factor1,B.sizeGradients.push(C)}}const e=I.getAngularSpeedGradients();if(e){B.angularSpeedGradients=[];for(const I of e){const C={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?C.factor2=I.factor2:C.factor2=I.factor1,B.angularSpeedGradients.push(C)}}const g=I.getVelocityGradients();if(g){B.velocityGradients=[];for(const I of g){const C={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?C.factor2=I.factor2:C.factor2=I.factor1,B.velocityGradients.push(C)}}const N=I.getDragGradients();if(N){B.dragGradients=[];for(const I of N){const C={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?C.factor2=I.factor2:C.factor2=I.factor1,B.dragGradients.push(C)}}const R=I.getEmitRateGradients();if(R){B.emitRateGradients=[];for(const I of R){const C={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?C.factor2=I.factor2:C.factor2=I.factor1,B.emitRateGradients.push(C)}}const H=I.getStartSizeGradients();if(H){B.startSizeGradients=[];for(const I of H){const C={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?C.factor2=I.factor2:C.factor2=I.factor1,B.startSizeGradients.push(C)}}const F=I.getLifeTimeGradients();if(F){B.lifeTimeGradients=[];for(const I of F){const C={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?C.factor2=I.factor2:C.factor2=I.factor1,B.lifeTimeGradients.push(C)}}const k=I.getLimitVelocityGradients();if(k){B.limitVelocityGradients=[];for(const I of k){const C={gradient:I.gradient,factor1:I.factor1};void 0!==I.factor2?C.factor2=I.factor2:C.factor2=I.factor1,B.limitVelocityGradients.push(C)}B.limitVelocityDamping=I.limitVelocityDamping}I.noiseTexture&&(B.noiseTexture=I.noiseTexture.serialize())}clone(B,I){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const M={...this._customWrappers};let x=null;const y=this._engine;if(y.createEffectForParticles&&null!=this.customShader){x=this.customShader;const B=x.shaderOptions.defines.length>0?x.shaderOptions.defines.join("\n"):"",I=y.createEffectForParticles(x.shaderPath.fragmentElement,x.shaderOptions.uniforms,x.shaderOptions.samplers,B);M[0]?M[0].effect=I:this.setCustomEffect(I,0)}const f=this.serialize(C),L=LI.Parse(f,this._scene||this._engine,this._rootUrl);return L.name=B,L.customShader=x,L._customWrappers=M,void 0===I&&(I=this.j),this.noiseTexture&&(L.noiseTexture=this.noiseTexture.clone()),L.j=I,this.preventAutoStart||L.start(),L}}LI.BILLBOARDMODE_Y=2,LI.BILLBOARDMODE_ALL=7,LI.BILLBOARDMODE_STRETCHED=8,LI.BILLBOARDMODE_STRETCHED_LOCAL=9,TB._ParseParticleSystem=LI.Parse;var eI=C(11445),gI=C(11440),NI=C(11324);NI.d.prototype.createTransformFeedback=function(){const B=this._gl.createTransformFeedback();if(!B)throw new Error("Unable to create Transform Feedback");return B},NI.d.prototype.deleteTransformFeedback=function(B){this._gl.deleteTransformFeedback(B)},NI.d.prototype.bindTransformFeedback=function(B){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,B)},NI.d.prototype.beginTransformFeedback=function(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(B?this._gl.POINTS:this._gl.TRIANGLES)},NI.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},NI.d.prototype.setTranformFeedbackVaryings=function(B,I){this._gl.transformFeedbackVaryings(B,I,this._gl.INTERLEAVED_ATTRIBS)},NI.d.prototype.bindTransformFeedbackBuffer=function(B){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,B?B.underlyingResource:null)},NI.d.prototype.readTransformFeedbackBuffer=function(B){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,B)};const RI="clipPlaneFragmentDeclaration2",HI="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";A.d.IncludesShadersStore[RI]||(A.d.IncludesShadersStore[RI]=HI);C(12471),C(12474),C(12476),C(12484),C(12488),C(12494),C(12497),C(12504);const FI="gpuRenderParticlesPixelShader",kI="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";A.d.ShadersStore[FI]||(A.d.ShadersStore[FI]=kI);const qI="clipPlaneVertexDeclaration2",SI="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";A.d.IncludesShadersStore[qI]||(A.d.IncludesShadersStore[qI]=SI);C(12509),C(12515),C(12520),C(12528);const oI="gpuRenderParticlesVertexShader",UI="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";A.d.ShadersStore[oI]||(A.d.ShadersStore[oI]=UI);class GI extends e{static get IsSupported(){if(!K.c.LastCreatedEngine)return!1;const B=K.c.LastCreatedEngine.getCaps();return B.supportTransformFeedbacks||B.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(B){this._maxActiveParticleCount=Math.min(B,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(B){this.maxActiveParticleCount=B}createPointEmitter(B,I){const C=hB(B,I);return this.particleEmitterType=C,C}createHemisphericEmitter(){const B=jB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=B,B}createSphereEmitter(){const B=wB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=B,B}createDirectedSphereEmitter(){const B=KB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new M.HI(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M.HI(0,1,0));return this.particleEmitterType=B,B}createCylinderEmitter(){const B=mB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=B,B}createDirectedCylinderEmitter(){const B=BI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new M.HI(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new M.HI(0,1,0));return this.particleEmitterType=B,B}createConeEmitter(){const B=II(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=B,B}createDirectedConeEmitter(){const B=CI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new M.HI(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new M.HI(0,1,0));return this.particleEmitterType=B,B}createBoxEmitter(B,I,C,M){const x=new R;return this.particleEmitterType=x,this.direction1=B,this.direction2=I,this.minEmitBox=C,this.maxEmitBox=M,x}get flowMap(){return this._flowMap}set flowMap(B){this._flowMap!==B&&(this._flowMap=B)}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==LI.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(LI.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(LI.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";B?setTimeout((()=>{this.start(0)}),B):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var B;let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(B=this._customWrappers[I])||void 0===B?void 0:B.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[B]??this._customWrappers[0]}setCustomEffect(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[I]=new BB.b(this._engine),this._customWrappers[I].effect=B}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new j.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(B,I,C){return super._removeGradientAndTexture(B,I,C),this._releaseBuffers(),this}addColorGradient(B,I){this._colorGradients||(this._colorGradients=[]);const C=new X(B,I);return this._colorGradients.push(C),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(B&&this._colorGradients.sort(((B,I)=>B.gradient<I.gradient?-1:B.gradient>I.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(B){return this._removeGradientAndTexture(B,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const I in this._drawWrappers){var B;null===(B=this._drawWrappers[I].drawContext)||void 0===B||B.reset()}}_addFactorGradient(B,I,C){const M=new P(I,C);B.push(M),this._releaseBuffers()}addSizeGradient(B,I){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,B,I),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(B){return this._removeGradientAndTexture(B,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(B,I){if(!B)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&B.sort(((B,I)=>B.gradient<I.gradient?-1:B.gradient>I.gradient?1:0));const C=this;C[I]&&(C[I].dispose(),C[I]=null)}addAngularSpeedGradient(B,I){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,B,I),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(B){return this._removeGradientAndTexture(B,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(B,I){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,B,I),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(B){return this._removeGradientAndTexture(B,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(B,I){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,B,I),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(B){return this._removeGradientAndTexture(B,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(B,I){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,B,I),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(B){return this._removeGradientAndTexture(B,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(B){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(B,I,C){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(B),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.If=new j.e,this.onStoppedObservable=new j.e,this.onStartedObservable=new j.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,C&&"Scene"!==C.getClassName()?(this._engine=C,this.defaultProjectionMatrix=M.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=C||K.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.oH.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,L.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,L.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,L.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,L.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new BB.b(this._engine)},this._customWrappers[0].effect=x,this._drawWrappers={0:new BB.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(I=I??{}).randomTextureSize||delete I.randomTextureSize;const f={nI:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...I},e=I;isFinite(e)&&(f.nI=e),this._capacity=f.nI,this._maxActiveParticleCount=f.nI,this._currentActiveCount=0,this._isAnimationSheetEnabled=y,this.particleEmitterType=new R;const g=Math.min(this._engine.getCaps().maxTextureSize,f.randomTextureSize);let N=[];for(let M=0;M<g;++M)N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),N.push(Math.random());this._randomTexture=new w.e(new Float32Array(N),g,1,5,C,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,N=[];for(let M=0;M<g;++M)N.push(Math.random()),N.push(Math.random()),N.push(Math.random()),N.push(Math.random());this._randomTexture2=new w.e(new Float32Array(N),g,1,5,C,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=g}_reset(){this._releaseBuffers()}_createVertexBuffers(B,I,C){const M={};M.position=I.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let x=3;M.age=I.createVertexBuffer("age",x,1,this._attributesStrideSize,!0),x+=1,M.size=I.createVertexBuffer("size",x,3,this._attributesStrideSize,!0),x+=3,M.life=I.createVertexBuffer("life",x,1,this._attributesStrideSize,!0),x+=1,x+=4,this.billboardMode===LI.BILLBOARDMODE_STRETCHED&&(M.direction=I.createVertexBuffer("direction",x,3,this._attributesStrideSize,!0)),x+=3,this._platform.alignDataInBuffer&&(x+=1),this.particleEmitterType instanceof V&&(x+=3,this._platform.alignDataInBuffer&&(x+=1)),this._colorGradientsTexture||(M.color=I.createVertexBuffer("color",x,4,this._attributesStrideSize,!0),x+=4),this._isBillboardBased||(M.initialDirection=I.createVertexBuffer("initialDirection",x,3,this._attributesStrideSize,!0),x+=3,this._platform.alignDataInBuffer&&(x+=1)),this.noiseTexture&&(M.noiseCoordinates1=I.createVertexBuffer("noiseCoordinates1",x,3,this._attributesStrideSize,!0),x+=3,this._platform.alignDataInBuffer&&(x+=1),M.noiseCoordinates2=I.createVertexBuffer("noiseCoordinates2",x,3,this._attributesStrideSize,!0),x+=3,this._platform.alignDataInBuffer&&(x+=1)),M.angle=I.createVertexBuffer("angle",x,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?x++:x+=2,this._isAnimationSheetEnabled&&(M.cellIndex=I.createVertexBuffer("cellIndex",x,1,this._attributesStrideSize,!0),x+=1,this.spriteRandomStartCell&&(M.cellStartOffset=I.createVertexBuffer("cellStartOffset",x,1,this._attributesStrideSize,!0),x+=1)),M.offset=C.createVertexBuffer("offset",0,2),M.uv=C.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(M),this._platform.createVertexBuffers(B,M),this.resetDrawCache()}_initialize(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!B)return;const I=this._engine,C=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof V&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const x=this.particleEmitterType instanceof V,y=M.TmpVectors.HI[0];let f=0;for(let M=0;M<this._capacity;M++)if(C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(0),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),x?(this.particleEmitterType.particleDestinationGenerator(M,null,y),C.push(y.x),C.push(y.y),C.push(y.z)):(C.push(0),C.push(0),C.push(0)),this._platform.alignDataInBuffer&&C.push(0),f+=16,x&&(this.particleEmitterType.particlePositionGenerator(M,null,y),C.push(y.x),C.push(y.y),C.push(y.z),this._platform.alignDataInBuffer&&C.push(0),f+=4),this._colorGradientsTexture||(C.push(0),C.push(0),C.push(0),C.push(0),f+=4),this.isBillboardBased||(C.push(0),C.push(0),C.push(0),this._platform.alignDataInBuffer&&C.push(0),f+=4),this.noiseTexture&&(C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),this._platform.alignDataInBuffer&&C.push(0),C.push(Math.random()),C.push(Math.random()),C.push(Math.random()),this._platform.alignDataInBuffer&&C.push(0),f+=8),C.push(0),f+=1,this._angularSpeedGradientsTexture||(C.push(0),f+=1),this._isAnimationSheetEnabled&&(C.push(0),f+=1,this.spriteRandomStartCell&&(C.push(0),f+=1)),this._platform.alignDataInBuffer){let B=3-(f+3&3);for(f+=B;B-- >0;)C.push(0)}const L=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),e=this._platform.createParticleBuffer(C),g=this._platform.createParticleBuffer(C);this._buffer0=new c.d(I,e,!1,this._attributesStrideSize),this._buffer1=new c.d(I,g,!1,this._attributesStrideSize),this._spriteBuffer=new c.d(I,L,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let B=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(B+="\n#define BILLBOARD"),this._colorGradientsTexture&&(B+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(B+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(B+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(B+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(B+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(B+="\n#define DRAGGRADIENTS"),this._flowMap&&(B+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(B+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(B+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(B+="\n#define NOISE"),this.isLocal&&(B+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===B||(this._cachedUpdateDefines=B,this._updateBuffer=this._platform.createUpdateBuffer(B)),this._platform.isUpdateBufferReady()}_getWrapper(B){const I=this._getCustomDrawWrapper(B);if(null!==I&&void 0!==I&&I.effect)return I;const C=[];this.fillDefines(C,B);let M=this._drawWrappers[B];M||(M=new BB.b(this._engine),M.drawContext&&(M.drawContext.useInstancing=!0),this._drawWrappers[B]=M);const x=C.join("\n");if(M.defines!==x){const B=[],I=[],C=[];this.fillUniformsAttributesAndSamplerNames(I,B,C),M.setEffect(this._engine.createEffect("gpuRenderParticles",B,I,C,x),x)}return M}static _GetAttributeNamesOrOptions(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],M=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const x=[c.g.PositionKind,"age","life","size","angle"];return B||x.push(c.g.ColorKind),I&&x.push("cellIndex"),C||x.push("initialDirection"),M&&x.push("direction"),x.push("offset",c.g.UVKind),x}static _GetEffectCreationOptions(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const M=["emitterWM","lg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,IB.e)(M),B&&M.push("sheetInfos"),I&&M.push("logarithmicDepthConstant"),C&&(M.push("vFogInfos"),M.push("vFogColor")),M}fillDefines(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,IB.l)(this,this._scene,B),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==gI.b.FOGMODE_NONE&&B.push("#define FOG")),I===LI.BLENDMODE_MULTIPLY&&B.push("#define BLENDMULTIPLYMODE"),this.isLocal&&B.push("#define LOCAL"),this.useLogarithmicDepth&&B.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(B.push("#define BILLBOARD"),this.billboardMode){case LI.BILLBOARDMODE_Y:B.push("#define BILLBOARDY");break;case LI.BILLBOARDMODE_STRETCHED:B.push("#define BILLBOARDSTRETCHED");break;case LI.BILLBOARDMODE_ALL:B.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&B.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&B.push("#define ANIMATESHEET"),C&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),B.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(B,I,C){I.push(...GI._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===LI.BILLBOARDMODE_STRETCHED)),B.push(...GI._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),C.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(eI.c.PrepareUniforms(B,this._imageProcessingConfigurationDefines),eI.c.PrepareSamplers(C,this._imageProcessingConfigurationDefines))}animate(){var B;let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(I?this.preWarmStepOffset:(null===(B=this._scene)||void 0===B?void 0:B.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(B,I){const C=this[I];if(!B||!B.length||C)return;const M=new Float32Array(this._rawTextureWidth);for(let x=0;x<this._rawTextureWidth;x++){const I=x/this._rawTextureWidth;h.GetCurrentGradient(I,B,((B,I,C)=>{M[x]=(0,g.Lerp)(B.factor1,I.factor1,C)}))}this[I]=w.e.CreateRTexture(M,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[I].name=I.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const B=new Uint8Array(4*this._rawTextureWidth),I=f.TmpColors.Pf[0];for(let C=0;C<this._rawTextureWidth;C++){const M=C/this._rawTextureWidth;h.GetCurrentGradient(M,this._colorGradients,((M,x,y)=>{f.Pf.LerpToRef(M.color1,x.color1,y,I),B[4*C]=255*I.r,B[4*C+1]=255*I.g,B[4*C+2]=255*I.b,B[4*C+3]=255*I.a}))}this._colorGradientsTexture=w.e.CreateRGBATexture(B,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(B,I){var C,x,y,f;const L=this._getWrapper(B),e=L.effect;this._engine.enableEffect(L);const g=(null===(C=this._scene)||void 0===C?void 0:C.getViewMatrix())||M.Matrix.IdentityReadOnly;if(e.setMatrix("view",g),e.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),e.setTexture("diffuseSampler",this.particleTexture),e.setVector2("translationPivot",this.translationPivot),e.setVector3("lg",this.lg),this.isLocal&&e.setMatrix("emitterWM",I),this._colorGradientsTexture?e.setTexture("colorGradientSampler",this._colorGradientsTexture):e.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const B=this.particleTexture.getBaseSize();e.setFloat3("sheetInfos",this.spriteCellWidth/B.width,this.spriteCellHeight/B.height,B.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const B=this._scene.activeCamera;e.setVector3("eyePosition",B.globalPosition)}const N=e.defines;if(this._scene&&((0,IB.f)(e,this,this._scene),this.applyFog&&(0,CB.e)(this._scene,void 0,e)),N.indexOf("#define BILLBOARDMODE_ALL")>=0){const B=g.clone();B.invert(),e.setMatrix("invView",B)}return this.useLogarithmicDepth&&this._scene&&(0,CB.h)(N,e,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(e),this._setEngineBasedOnBlendMode(B),this._platform.bindDrawBuffers(this._targetIndex,e,null!==(x=this._scene)&&void 0!==x&&x.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(e),null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(f=this._scene)&&void 0!==f&&f.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(B){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!B)if(this.j.position){B=this.j.getWorldMatrix()}else{const I=this.j;B=M.TmpVectors.Matrix[0],M.Matrix.TranslationToRef(I.x,I.y,I.z,B)}const I=this._engine,C=I.getDepthWrite();if(I.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const B=this.rB();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",B.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",B),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const x=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=x,I.setDepthWrite(C)}render(){let B,I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],C=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!I&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let B=0;B<this.preWarmCycles;B++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const B=0|this._accumulatedCount;this._accumulatedCount-=B,this._currentActiveCount+=B}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){B=this.j.getWorldMatrix()}else{const I=this.j;B=M.TmpVectors.Matrix[0],M.Matrix.TranslationToRef(I.x,I.y,I.z,B)}const x=this._engine;this.updateInAnimate||this._update(B);let y=0;return I||C||(x.setState(!1),this.forceDepthWrite&&x.setDepthWrite(!0),y=this.blendMode===LI.BLENDMODE_MULTIPLYADD?this._render(LI.BLENDMODE_MULTIPLY,B)+this._render(LI.BLENDMODE_ADD,B):this._render(this.blendMode,B),this._engine.setAlphaMode(0)),y}rebuild(){const B=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(B,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,B()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const I in this._drawWrappers){this._drawWrappers[I].dispose()}if(this._drawWrappers={},this._scene){const B=this._scene.oH.indexOf(this);B>-1&&this._scene.oH.splice(B,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let I=0;I<this._renderVertexBuffers.length;++I){const B=this._renderVertexBuffers[I];for(const I in B)B[I].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),B&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),B&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.If.notifyObservers(this),this.If.clear()}clone(B,I){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const M={...this._customWrappers};let x=null;const y=this._engine;if(y.createEffectForParticles&&null!=this.customShader){x=this.customShader;const B=x.shaderOptions.defines.length>0?x.shaderOptions.defines.join("\n"):"";M[0]=y.createEffectForParticles(x.shaderPath.fragmentElement,x.shaderOptions.uniforms,x.shaderOptions.samplers,B,void 0,void 0,void 0,this)}const f=this.serialize(C),L=GI.Parse(f,this._scene||this._engine,this._rootUrl);return L.name=B,L.customShader=x,L._customWrappers=M,void 0===I&&(I=this.j),this.noiseTexture&&(L.noiseTexture=this.noiseTexture.clone()),L.j=I,L}serialize(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I={};return LI._Serialize(I,this,B),I.activeParticleCount=this.activeParticleCount,I.randomTextureSize=this._randomTextureSize,I.customShader=this.customShader,I}static Parse(B,I,C){let M=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4?arguments[4]:void 0;const y=B.name;let f,L;I instanceof PB.e?f=I:(L=I,f=L.getEngine());const e=new GI(y,{nI:x||B.nI,randomTextureSize:B.randomTextureSize},I,null,B.isAnimationSheetEnabled);if(e._rootUrl=C,B.customShader&&f.createEffectForParticles){const I=B.customShader,C=I.shaderOptions.defines.length>0?I.shaderOptions.defines.join("\n"):"",M=f.createEffectForParticles(I.shaderPath.fragmentElement,I.shaderOptions.uniforms,I.shaderOptions.samplers,C,void 0,void 0,void 0,e);e.setCustomEffect(M,0),e.customShader=I}return B.id&&(e.id=B.id),B.activeParticleCount&&(e.activeParticleCount=B.activeParticleCount),LI._Parse(B,e,I,C),B.preventAutoStart&&(e.preventAutoStart=B.preventAutoStart),M||e.preventAutoStart||e.start(),e}}var VI=C(11018),cI=C(12537),tI=C(11573);class rI{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(B){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const I of this.systems)I.j=B;this._emitterNode=B}setEmitterAsSphere(B,I,C){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:B,renderingGroupId:I};const M=(0,cI.e)("emitterSphere",{diameter:B.diameter,segments:B.segments},C);M.renderingGroupId=I;const x=new tI.qI("emitterSphereMaterial",C);x.emissiveColor=B.color,M.material=x;for(const y of this.systems)y.j=M;this._emitterNode=M}start(B){for(const I of this.systems)B&&(I.j=B),I.start()}dispose(){for(const B of this.systems)B.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const I={systems:[]};for(const C of this.systems)I.systems.push(C.serialize(B));return this._emitterNode&&(I.j=this._emitterCreationOptions),I}static Parse(B,I){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],M=arguments.length>3?arguments[3]:void 0;const x=new rI,y=this.BaseAssetsUrl+"/textures/";I=I||K.c.LastCreatedScene;for(const f of B.systems)x.systems.push(C?GI.Parse(f,I,y,!0,M):LI.Parse(f,I,y,!0,M));if(B.j){const C=B.j.options;if("Sphere"===B.j.kind)x.setEmitterAsSphere({diameter:C.diameter,segments:C.segments,color:f.SI.oI(C.color)},B.j.renderingGroupId,I)}return x}}rI.BaseAssetsUrl="https://assets.babylonjs.com/particles";var AI=C(11051);class DI{static CreateDefault(B){let I,C=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,M=arguments.length>2?arguments[2]:void 0;I=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new GI("default system",{nI:C},M):new LI("default system",C,M),I.j=B;const x=VI.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return I.particleTexture=new W.c(x,I.rB()),I.createConeEmitter(.1,Math.PI/4),I.color1=new f.Pf(1,1,1,1),I.color2=new f.Pf(1,1,1,1),I.colorDead=new f.Pf(1,1,1,0),I.minSize=.1,I.maxSize=.1,I.minEmitPower=2,I.maxEmitPower=2,I.updateSpeed=1/60,I.emitRate=30,I}static CreateAsync(B,I){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],M=arguments.length>3?arguments[3]:void 0;I||(I=K.c.LastCreatedScene);const x={};return I.addPendingData(x),new Promise(((y,f)=>{if(C&&!GI.IsSupported)return I.removePendingData(x),f("Particle system with GPU is not supported.");VI.Tools.LoadFile(`${DI.BaseAssetsUrl}/systems/${B}.json`,(B=>{I.removePendingData(x);const f=JSON.parse(B.toString());return y(rI.Parse(f,I,C,M))}),void 0,void 0,void 0,(()=>(I.removePendingData(x),f(`An error occurred with the creation of your particle system. Check if your type '${B}' exists.`))))}))}static ExportSet(B){const I=new rI;for(const C of B)I.systems.push(C);return I}static ParseFromFileAsync(B,I,C){let M=arguments.length>3&&void 0!==arguments[3]&&arguments[3],x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",y=arguments.length>5?arguments[5]:void 0;return new Promise(((f,L)=>{const e=new AI.c;e.addEventListener("readystatechange",(()=>{if(4==e.readyState)if(200==e.status){const I=JSON.parse(e.responseText);let L;L=M?GI.Parse(I,C,x,!1,y):LI.Parse(I,C,x,!1,y),B&&(L.name=B),f(L)}else L("Unable to load the particle system")})),e.open("GET",I),e.send()}))}static ParseFromSnippetAsync(B,I){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",x=arguments.length>4?arguments[4]:void 0;if("_BLANK"===B){const B=this.CreateDefault(null);return B.start(),Promise.resolve(B)}return new Promise(((y,f)=>{const L=new AI.c;L.addEventListener("readystatechange",(()=>{if(4==L.readyState)if(200==L.status){const f=JSON.parse(JSON.parse(L.responseText).jsonPayload),e=JSON.parse(f.particleSystem);let g;g=C?GI.Parse(e,I,M,!1,x):LI.Parse(e,I,M,!1,x),g.snippetId=B,y(g)}else f("Unable to load the snippet "+B)})),L.open("GET",this.SnippetUrl+"/"+B.replace(/#/g,"/")),L.send()}))}}DI.BaseAssetsUrl=rI.BaseAssetsUrl,DI.SnippetUrl="https://snippet.babylonjs.com",DI.CreateFromSnippetAsync=DI.ParseFromSnippetAsync;var JI=C(11645),iI=C(11471),uI=C(12540);(0,uI.e)(iI.d.NAME_PARTICLESYSTEM,((B,I,C,M)=>{const x=(0,uI.f)(iI.d.NAME_PARTICLESYSTEM);if(x&&void 0!==B.oH&&null!==B.oH)for(let y=0,f=B.oH.length;y<f;y++){const f=B.oH[y];C.oH.push(x(f,I,M))}})),(0,uI.b)(iI.d.NAME_PARTICLESYSTEM,((B,I,C)=>{if(B.activeParticleCount){return GI.Parse(B,I,C)}return LI.Parse(B,I,C)})),PB.e.prototype.createEffectForParticles=function(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",y=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0,L=arguments.length>6?arguments[6]:void 0,e=arguments.length>7?arguments[7]:void 0,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,N=arguments.length>9?arguments[9]:void 0,R=[],H=[];const F=[];return e?e.fillUniformsAttributesAndSamplerNames(H,R,F):(R=LI._GetAttributeNamesOrOptions(),H=LI._GetEffectCreationOptions()),-1===x.indexOf(" BILLBOARD")&&(x+="\n#define BILLBOARD\n"),null!==e&&void 0!==e&&e.isAnimationSheetEnabled&&-1===x.indexOf(" ANIMATESHEET")&&(x+="\n#define ANIMATESHEET\n"),-1===M.indexOf("diffuseSampler")&&M.push("diffuseSampler"),this.createEffect({vertex:N??(null===e||void 0===e?void 0:e.vertexShaderName)??"particles",fragmentElement:B},R,H.concat(I),F.concat(M),x,y,f,L,void 0,g,(async()=>{0===g?await Promise.resolve().then(C.bind(C,12577)):await Promise.resolve().then(C.bind(C,12643))}))},JI.b.prototype.getEmittedParticleSystems=function(){const B=[];for(let I=0;I<this.rB().oH.length;I++){const C=this.rB().oH[I];C.j===this&&B.push(C)}return B},JI.b.prototype.getHierarchyEmittedParticleSystems=function(){const B=[],I=this.getDescendants();I.push(this);for(let C=0;C<this.rB().oH.length;C++){const M=this.rB().oH[C],x=M.j;x.position&&-1!==I.indexOf(x)&&B.push(M)}return B};C(11527),C(11545),C(11625);C(11633),C(12549),C(11396),C(11518),C(11657);C(11387);var pI;C(12556),C(11217);!function(B){B[B.Color=2]="Color",B[B.UV=1]="UV",B[B.Random=0]="Random",B[B.Stated=3]="Stated"}(pI||(pI={}));var nI=C(11426);const OI=new M.HI(0,0,0),aI=new M.HI(0,0,0),WI=new M.HI(0,0,0);class dI{constructor(B,I,C){this.width=B,this.height=I,this.data=C}processFlowable(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2?arguments[2]:void 0;if(!C)return;C instanceof M.Matrix?M.HI.TransformCoordinatesToRef(B.position,C,WI):(WI.x=C.x,WI.y=C.y,WI.z=C.z);const x=.5*WI.x+.5,y=1-(.5*WI.y+.5),f=Math.floor(x*this.width),L=Math.floor(y*this.height);if(f<0||f>=this.width||L<0||L>=this.height)return;const e=4*(L*this.width+f),g=this.data[e]/255*2-1,N=this.data[e+1]/255*2-1,R=this.data[e+2]/255*2-1,H=this.data[e+3]/255;OI.set(g,N,R),OI.scaleToRef(I*H,aI),B.direction.addInPlace(aI)}_processParticle(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,C=arguments.length>2?arguments[2]:void 0;this.processFlowable(B,I,C)}static async FromUrlAsync(B){return await new Promise(((I,C)=>{const M=document.createElement("canvas"),x=M.getContext("2d");let y=null;const f=new Image;f.crossOrigin="anonymous",f.src=B,f.onerror=I=>{C(new Error(`Failed to load image: ${B} : ${I}`))},f.onload=()=>{M.width=f.width,M.height=f.height,x.drawImage(f,0,0),y=x.getImageData(0,0,M.width,M.height),I(new dI(M.width,M.height,y.data))}}))}static async ExtractFromTextureAsync(B){return await new Promise(((I,C)=>{if(!B.isReady())return void B.onLoadObservable.addOnce((async()=>{try{const C=await this.ExtractFromTextureAsync(B);I(C)}catch(M){C(M)}}));const M=B.getSize();nI.k.GetTextureDataAsync(B,M.width,M.height).then((B=>{I(new dI(M.width,M.height,new Uint8ClampedArray(B)))})).catch(C)}))}}var lI,EI,QI,ZI,zI,bI,YI,vI,sI;!function(B){B[B.Int=1]="Int",B[B.Float=2]="Float",B[B.Vector2=4]="Vector2",B[B.HI=8]="HI",B[B.Matrix=16]="Matrix",B[B.Particle=32]="Particle",B[B.Texture=64]="Texture",B[B.Pf=128]="Pf",B[B.FloatGradient=256]="FloatGradient",B[B.Vector2Gradient=512]="Vector2Gradient",B[B.Vector3Gradient=1024]="Vector3Gradient",B[B.Color4Gradient=2048]="Color4Gradient",B[B.System=4096]="System",B[B.AutoDetect=8192]="AutoDetect",B[B.BasedOnInput=16384]="BasedOnInput",B[B.Undefined=32768]="Undefined",B[B.All=65535]="All"}(lI||(lI={})),function(B){B[B.Compatible=0]="Compatible",B[B.TypeIncompatible=1]="TypeIncompatible",B[B.HierarchyIssue=2]="HierarchyIssue"}(EI||(EI={})),function(B){B[B.Input=0]="Input",B[B.Output=1]="Output"}(QI||(QI={}));class XI{get direction(){return this._direction}get type(){if(this._type===lI.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===lI.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(B){this._type=B}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((B=>B.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(B,I,C){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=lI.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new j.e,this.onDisconnectionObservable=new j.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=I,this.name=B,this._direction=C}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(B){var I;return this.isConnected?null!==(I=this._connectedPoint)&&void 0!==I&&I._storedFunction?this._connectedPoint._storedFunction(B):this._connectedPoint._storedValue:this.value}canConnectTo(B){return 0===this.checkCompatibilityState(B)}checkCompatibilityState(B){const I=this._ownerBlock,C=B.ownerBlock;if(this.type!==B.type&&B.innerType!==lI.AutoDetect)return B.acceptedConnectionPointTypes&&-1!==B.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(B.excludedConnectionPointTypes&&-1!==B.excludedConnectionPointTypes.indexOf(this.type))return 1;let M=C,x=I;return 0===this.direction&&(M=I,x=C),M.isAnAncestorOf(x)?2:0}connectTo(B){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(B))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${B.ownerBlock.name}".${B.name}`;return this._endpoints.push(B),B._connectedPoint=this,this.onConnectionObservable.notifyObservers(B),B.onConnectionObservable.notifyObservers(this),this}disconnectFrom(B){const I=this._endpoints.indexOf(B);return-1===I||(this._endpoints.splice(I,1),B._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(B),B.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(B){let I=1;for(;I<lI.All;)B&I||this.excludedConnectionPointTypes.push(I),I<<=1}serialize(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const I={};return I.name=this.name,I.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Df?(I.valueType="BABYLON."+this.value.getClassName(),I.value=this.value.Df()):(I.valueType="number",I.value=this.value)),B&&this.connectedPoint&&(I.inputName=this.name,I.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,I.targetConnectionName=this.connectedPoint.name,I.isExposedOnFrame=!0,I.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(I.isExposedOnFrame=!0,I.exposedPortPosition=this.exposedPortPosition),I}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class TI{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(B){this._name=B}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(B){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new j.e,this.If=new j.e,this.onInputChangedObservable=new j.e,this.visibleOnFrame=!1,this._name=B,this.uniqueId=d.d.UniqueId}_inputRename(B){return B}_outputRename(B){return B}isAnAncestorOf(B){for(const I of this._outputs)if(I.hasEndpoints)for(const C of I.endpoints){if(C.ownerBlock===B)return!0;if(C.ownerBlock.isAnAncestorOf(B))return!0}return!1}isAnAncestorOfType(B){if(this.getClassName()===B)return!0;for(const I of this._outputs)if(I.hasEndpoints)for(const C of I.endpoints)if(C.ownerBlock.isAnAncestorOfType(B))return!0;return!1}getInputByName(B){const I=this._inputs.filter((I=>I.name===B));return I.length?I[0]:null}_linkConnectionTypes(B,I){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[I]._acceptedConnectionPointType=this._inputs[B]:(this._inputs[B]._linkedConnectionSource=this._inputs[I],this._inputs[B]._isMainLinkSource=!0),this._inputs[I]._linkedConnectionSource=this._inputs[B]}registerInput(B,I){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],M=arguments.length>3?arguments[3]:void 0,x=arguments.length>4?arguments[4]:void 0,y=arguments.length>5?arguments[5]:void 0;const f=new XI(B,this,0);return f.type=I,f.isOptional=C,f.defaultValue=M,f.value=M,f.valueMin=x,f.valueMax=y,this._inputs.push(f),this.onInputChangedObservable.notifyObservers(f),this}registerOutput(B,I,C){return(C=C??new XI(B,this,1)).type=I,this._outputs.push(C),this}_build(B){}_customBuildStep(B){}build(B){if(this._buildId===B.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((B=>B.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=B.buildId;for(const I of this._inputs){if(!I.connectedPoint){I.isOptional||B.notConnectedNonOptionalInputs.push(I);continue}const C=I.connectedPoint.ownerBlock;C&&C!==this&&!C.isSystem&&C.build(B)}return this._customBuildStep(B),B.verbose&&l.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(B),this.onBuildObservable.notifyObservers(this),!1}serialize(){const B={};B.customType="BABYLON."+this.getClassName(),B.id=this.uniqueId,B.name=this.name,B.visibleOnFrame=this.visibleOnFrame,B.inputs=[],B.outputs=[];for(const I of this.inputs)B.inputs.push(I.serialize());for(const I of this.outputs)B.outputs.push(I.serialize(!1));return B}_deserialize(B){this._name=B.name,this.comments=B.comments,this.visibleOnFrame=!!B.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(B)}_deserializePortDisplayNamesAndExposedOnFrame(B){const I=B.inputs,C=B.outputs;if(I)for(const M of I){const B=this.inputs.find((B=>B.name===M.name));if(!B)return;if(M.displayName&&(B.displayName=M.displayName),M.isExposedOnFrame&&(B.isExposedOnFrame=M.isExposedOnFrame,B.exposedPortPosition=M.exposedPortPosition),void 0!==M.value&&null!==M.value)if("number"===M.valueType)B.value=M.value;else{const I=(0,L.e)(M.valueType);I&&(B.value=I.oI(M.value))}}if(C)for(let M=0;M<C.length;M++){const B=C[M];B.displayName&&(this.outputs[M].displayName=B.displayName),B.isExposedOnFrame&&(this.outputs[M].isExposedOnFrame=B.isExposedOnFrame,this.outputs[M].exposedPortPosition=B.exposedPortPosition)}}clone(){const B=this.serialize(),I=(0,L.e)(B.customType);if(I){const C=new I;return C._deserialize(B),C}return null}dispose(){this.If.notifyObservers(this),this.If.clear();for(const B of this.inputs)B.dispose();for(const B of this.outputs)B.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function PI(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",M=arguments.length>3?arguments[3]:void 0;return(x,y)=>{let f=x._propStore;f||(f=[],x._propStore=f),f.push({propertyName:y,displayName:B,type:I,groupName:C,options:M??{},className:x.getClassName()})}}(0,n.e)([(0,O.K)("comment")],TI.prototype,"comments",void 0),function(B){B[B.Boolean=0]="Boolean",B[B.Float=1]="Float",B[B.Int=2]="Int",B[B.Vector2=3]="Vector2",B[B.List=4]="List",B[B.Pf=5]="Pf",B[B.SamplingMode=6]="SamplingMode",B[B.TextureFormat=7]="TextureFormat",B[B.TextureType=8]="TextureType"}(ZI||(ZI={})),function(B){B[B.None=0]="None",B[B.Position=1]="Position",B[B.Direction=2]="Direction",B[B.Age=3]="Age",B[B.Lifetime=4]="Lifetime",B[B.Color=5]="Color",B[B.ScaledDirection=6]="ScaledDirection",B[B.Scale=7]="Scale",B[B.AgeGradient=8]="AgeGradient",B[B.Angle=9]="Angle",B[B.SpriteCellIndex=16]="SpriteCellIndex",B[B.SpriteCellStart=17]="SpriteCellStart",B[B.SpriteCellEnd=18]="SpriteCellEnd"}(zI||(zI={})),function(B){B[B.None=0]="None",B[B.Time=1]="Time",B[B.Delta=2]="Delta",B[B.Emitter=3]="Emitter"}(bI||(bI={}));class hI{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let B="";for(const I of this.notConnectedNonOptionalInputs)B+=`input ${I.name} from block ${I.ownerBlock.name}[${I.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(B)throw"Build of Node Particle System Set failed:\n"+B}adapt(B,I){const C=B.getConnectedValue(this)||0;if(B.type===I)return C;switch(I){case lI.Vector2:return new M.Vector2(C,C);case lI.HI:return new M.HI(C,C,C);case lI.Pf:return new f.Pf(C,C,C,C)}return null}getContextualValue(B){if(!this.particleContext||!this.systemContext)return null;switch(B){case zI.Position:return this.particleContext.position;case zI.Direction:return this.particleContext.direction;case zI.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case zI.Color:return this.particleContext.color;case zI.Age:return this.particleContext.age;case zI.Lifetime:return this.particleContext.lifeTime;case zI.Angle:return this.particleContext.angle;case zI.Scale:return this.particleContext.scale;case zI.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case zI.SpriteCellEnd:return this.systemContext.endSpriteCellID;case zI.SpriteCellIndex:return this.particleContext.cellIndex;case zI.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.j.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.j.absolutePosition:this.systemContext.j:null}getSystemValue(B){if(!this.particleContext||!this.systemContext)return null;switch(B){case bI.Time:return this.systemContext._actualFrame;case bI.Delta:return this.systemContext._scaledUpdateSpeed;case bI.Emitter:if(this.isEmitterTransformNode){return this.systemContext.j.absolutePosition}return this.systemContext.j}return null}}function jI(B,I,C){const M=new hI;M.kI=I;const x=B.createSystem(M);return x.canStart=()=>!0,x.j=C.clone(),x.disposeOnStop=!0,x.start(),x}class wI extends TI{constructor(B){super(B),this.blendMode=e.BLENDMODE_ONEONE,this.nI=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",lI.Particle),this.registerInput("texture",lI.Texture),this.registerInput("onStart",lI.System,!0),this.registerInput("onEnd",lI.System,!0),this.registerOutput("system",lI.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(B){B.nI=this.nI,B.buildId=this._buildId++,this.build(B);const I=this.particle.getConnectedValue(B);return I.particleTexture=this.texture.getConnectedValue(B),I.emitRate=this.emitRate,I.blendMode=this.blendMode,I.name=this.name,I._nodeGenerated=!0,I._targetStopDuration=this.targetStopDuration,I.startDelay=this.startDelay,this.system._storedValue=this,I.canStart=()=>!this.doNoStart,I.onStartedObservable.add((C=>{const M=this.onStart.getConnectedValue(B);M&&C.onStartedObservable.addOnce((()=>{B.systemContext=I;const C=jI(M,B.kI,B.emitterPosition);this.If.addOnce((()=>{C.dispose()}))}));const x=this.onEnd.getConnectedValue(B);x&&C.onStoppedObservable.addOnce((()=>{B.systemContext=I;const C=jI(x,B.kI,B.emitterPosition);this.If.addOnce((()=>{C.dispose()}))}))})),this.If.addOnce((()=>{I.dispose()})),I}serialize(){const B=super.serialize();return B.nI=this.nI,B.emitRate=this.emitRate,B.blendMode=this.blendMode,B.doNoStart=this.doNoStart,B.targetStopDuration=this.targetStopDuration,B.startDelay=this.startDelay,B}_deserialize(B){super._deserialize(B),this.nI=B.nI,this.emitRate=B.emitRate,this.doNoStart=!!B.doNoStart,void 0!==B.blendMode&&(this.blendMode=B.blendMode),void 0!==B.targetStopDuration&&(this.targetStopDuration=B.targetStopDuration),void 0!==B.startDelay&&(this.startDelay=B.startDelay)}}(0,n.e)([PI("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:e.BLENDMODE_ONEONE},{label:"Standard",value:e.BLENDMODE_STANDARD},{label:"Add",value:e.BLENDMODE_ADD},{label:"Multiply",value:e.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:e.BLENDMODE_MULTIPLYADD}]})],wI.prototype,"blendMode",void 0),(0,n.e)([PI("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],wI.prototype,"nI",void 0),(0,n.e)([PI("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wI.prototype,"emitRate",void 0),(0,n.e)([PI("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wI.prototype,"targetStopDuration",void 0),(0,n.e)([PI("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wI.prototype,"startDelay",void 0),(0,n.e)([PI("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],wI.prototype,"doNoStart",void 0),(0,L.h)("BABYLON.SystemBlock",wI);class KI extends TI{get type(){if(this._type===lI.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=lI.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=lI.Vector2,this._type;case"HI":return this._type=lI.HI,this._type;case"Pf":return this._type=lI.Pf,this._type;case"Matrix":return this._type=lI.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===zI.None&&this._systemSource!==bI.None}get systemSource(){return this._systemSource}set systemSource(B){if(this._systemSource=B,B!==bI.None){switch(this._contextualSource=zI.None,this._type=lI.Float,B){case bI.Time:case bI.Delta:this._type=lI.Float;break;case bI.Emitter:this._type=lI.HI}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==zI.None}get contextualValue(){return this._contextualSource}set contextualValue(B){if(this._contextualSource=B,B!==zI.None){switch(this._systemSource=bI.None,B){case zI.Scale:this._type=lI.Vector2;break;case zI.Position:case zI.Direction:case zI.ScaledDirection:this._type=lI.HI;break;case zI.Color:this._type=lI.Pf;break;case zI.Age:case zI.Lifetime:case zI.Angle:case zI.AgeGradient:this._type=lI.Float;break;case zI.SpriteCellEnd:case zI.SpriteCellStart:case zI.SpriteCellIndex:this._type=lI.Int}this.output&&(this.output.type=this._type)}}constructor(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:lI.AutoDetect;super(B),this._type=lI.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new j.e,this._systemSource=bI.None,this._contextualSource=zI.None,this._type=I,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",I)}get value(){return this._storedValue}set value(B){this.type===lI.Float&&this.min!==this.max&&(B=Math.max(this.min,B),B=Math.min(this.max,B)),this._storedValue=B,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(B){this._valueCallback=B}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case lI.Int:case lI.Float:this.value=0;break;case lI.Vector2:this.value=M.Vector2.Zero();break;case lI.HI:this.value=M.HI.Zero();break;case lI.Pf:this.value=new f.Pf(1,1,1,1);break;case lI.Matrix:this.value=M.Matrix.Identity()}}_build(B){super._build(B),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=B=>B.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=B=>B.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const B=super.serialize();return B.type=this.type,B.contextualValue=this.contextualValue,B.systemSource=this.systemSource,B.min=this.min,B.max=this.max,B.groupInInspector=this.groupInInspector,B.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Df?(B.valueType="BABYLON."+this._storedValue.getClassName(),B.value=this._storedValue.Df()):(B.valueType="number",B.value=this._storedValue)),B}_deserialize(B){if(super._deserialize(B),this._type=B.type,this.contextualValue=B.contextualValue,this.systemSource=B.systemSource||bI.None,this.min=B.min||0,this.max=B.max||0,this.groupInInspector=B.groupInInspector||"",void 0!==B.displayInInspector&&(this.displayInInspector=B.displayInInspector),B.valueType)if("number"===B.valueType)this._storedValue=B.value;else{const I=(0,L.e)(B.valueType);I&&(this._storedValue=I.oI(B.value))}}}(0,L.h)("BABYLON.ParticleInputBlock",KI);class mI extends TI{get url(){return this._url}set url(B){this._url!==B&&(this._cachedData=null,this._url=B,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(B){this._textureDataUrl!==B&&(this._cachedData=null,this._textureDataUrl=B,this._url="",this._sourceTexture=null)}set sourceTexture(B){this._sourceTexture!==B&&(this._cachedData=null,this._sourceTexture=B,this._url="",this._textureDataUrl="")}constructor(B){super(B),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",lI.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const B=this.texture._storedValue;return await new Promise(((I,C)=>{if(!B.isReady())return void B.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),I(this._cachedData)}catch(B){C(B)}}));const M=B.getSize();nI.k.GetTextureDataAsync(B,M.width,M.height).then((C=>{this._cachedData={width:M.width,height:M.height,data:new Uint8ClampedArray(C)},B.dispose(),I(this._cachedData)})).catch(C)}))}_build(B){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new W.c(this._textureDataUrl,B.kI):this.texture._storedValue=new W.c(this._url,B.kI):this.texture._storedValue=null}serialize(){const B=super.serialize();return B.url=this.url,B.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(B.textureDataUrl=this.textureDataUrl),B}_deserialize(B){super._deserialize(B),this.url=B.url,this.serializedCachedData=!!B.serializedCachedData,B.textureDataUrl&&(this.textureDataUrl=B.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,L.h)("BABYLON.ParticleTextureSourceBlock",mI);class BC extends TI{constructor(B){super(B),this.registerInput("particle",lI.Particle),this.registerInput("position",lI.HI),this.registerOutput("output",lI.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(B){const I=this.particle.getConnectedValue(B);if(this.output._storedValue=I,!this.position.isConnected)return;const C={process:C=>{B.particleContext=C,B.systemContext=I,C.position.M(this.position.getConnectedValue(B))},previousItem:null,nextItem:null};I._updateQueueStart?bB(C,I._updateQueueStart):I._updateQueueStart=C}}(0,L.h)("BABYLON.UpdatePositionBlock",BC),function(B){B[B.Add=0]="Add",B[B.Subtract=1]="Subtract",B[B.Multiply=2]="Multiply",B[B.Divide=3]="Divide",B[B.Max=4]="Max",B[B.Min=5]="Min"}(YI||(YI={}));class IC extends TI{constructor(B){super(B),this.operation=YI.Add,this.registerInput("left",lI.AutoDetect),this.registerInput("right",lI.AutoDetect),this.registerOutput("output",lI.BasedOnInput),this.output._typeConnectionSource=this.left;const I=[lI.Matrix,lI.Particle,lI.Texture,lI.System,lI.FloatGradient,lI.Color4Gradient,lI.Vector2Gradient,lI.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...I),this.right.excludedConnectionPointTypes.push(...I),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(B){let I;const C=this.left,x=this.right;if(!C.isConnected||!x.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const y=C.type===lI.Float||C.type===lI.Int,L=x.type===lI.Float||x.type===lI.Int,e=y&&L;switch(this.operation){case YI.Add:I=e?B=>C.getConnectedValue(B)+x.getConnectedValue(B):y?B=>B.adapt(C,x.type).add(x.getConnectedValue(B)):B=>C.getConnectedValue(B).add(B.adapt(x,C.type));break;case YI.Subtract:I=e?B=>C.getConnectedValue(B)-x.getConnectedValue(B):y?B=>B.adapt(C,x.type).FI(x.getConnectedValue(B)):B=>C.getConnectedValue(B).FI(B.adapt(x,C.type));break;case YI.Multiply:I=e?B=>C.getConnectedValue(B)*x.getConnectedValue(B):y?B=>B.adapt(C,x.type).multiply(x.getConnectedValue(B)):B=>C.getConnectedValue(B).multiply(B.adapt(x,C.type));break;case YI.Divide:I=e?B=>C.getConnectedValue(B)/x.getConnectedValue(B):y?B=>B.adapt(C,x.type).divide(x.getConnectedValue(B)):B=>C.getConnectedValue(B).divide(B.adapt(x,C.type));break;case YI.Min:if(e)I=B=>Math.min(C.getConnectedValue(B),x.getConnectedValue(B));else{const[B,L]=y?[x,C]:[C,x];switch(B.type){case lI.Vector2:I=I=>M.Vector2.Minimize(B.getConnectedValue(I),I.adapt(L,B.type));break;case lI.HI:I=I=>M.HI.Minimize(B.getConnectedValue(I),I.adapt(L,B.type));break;case lI.Pf:I=I=>{const C=B.getConnectedValue(I),{r:M,g:x,b:y,a:e}=I.adapt(L,B.type);return new f.Pf(Math.min(C.r,M),Math.min(C.g,x),Math.min(C.b,y),Math.min(C.a,e))}}}break;case YI.Max:if(!e){const[B,L]=y?[x,C]:[C,x];switch(B.type){case lI.Vector2:I=I=>M.Vector2.Maximize(B.getConnectedValue(I),I.adapt(L,B.type));break;case lI.HI:I=I=>M.HI.Maximize(B.getConnectedValue(I),I.adapt(L,B.type));break;case lI.Pf:I=I=>{const C=B.getConnectedValue(I),{r:M,g:x,b:y,a:e}=I.adapt(L,B.type);return new f.Pf(Math.max(C.r,M),Math.min(C.g,x),Math.min(C.b,y),Math.min(C.a,e))}}break}I=B=>Math.max(C.getConnectedValue(B),x.getConnectedValue(B))}this.output._storedFunction=B=>C.type===lI.Int?0|I(B):I(B)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===lI.Int||this.left.type===lI.Float&&this.right.type!==lI.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[B,I]of[[this.left,this.right],[this.right,this.left]])B.acceptedConnectionPointTypes=[lI.Int,lI.Float],I.isConnected&&(B.acceptedConnectionPointTypes.push(I.type),I.type!==lI.Int&&I.type!==lI.Float||B.acceptedConnectionPointTypes.push(lI.Vector2,lI.HI,lI.Pf))}dispose(){super.dispose();for(const B of this._connectionObservers)B.remove();this._connectionObservers.length=0}serialize(){const B=super.serialize();return B.operation=this.operation,B}_deserialize(B){super._deserialize(B),this.operation=B.operation}}(0,n.e)([PI("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:YI.Add},{label:"Subtract",value:YI.Subtract},{label:"Multiply",value:YI.Multiply},{label:"Divide",value:YI.Divide},{label:"Max",value:YI.Max},{label:"Min",value:YI.Min}]})],IC.prototype,"operation",void 0),(0,L.h)("BABYLON.ParticleMathBlock",IC);class CC extends TI{constructor(B){super(B),this.registerInput("particle",lI.Particle),this.registerInput("direction1",lI.HI,!0,new M.HI(0,1,0)),this.registerInput("direction2",lI.HI,!0,new M.HI(0,1,0)),this.registerInput("minEmitBox",lI.HI,!0,new M.HI(-.5,-.5,-.5)),this.registerInput("maxEmitBox",lI.HI,!0,new M.HI(.5,.5,.5)),this.registerOutput("output",lI.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(B){const I=this.particle.getConnectedValue(B);I._directionCreation.process=C=>{B.particleContext=C,B.systemContext=I;const x=this.direction1.getConnectedValue(B),y=this.direction2.getConnectedValue(B),f=(0,g.RandomRange)(x.x,y.x),L=(0,g.RandomRange)(x.y,y.y),e=(0,g.RandomRange)(x.z,y.z);B.isEmitterTransformNode?M.HI.TransformNormalFromFloatsToRef(f,L,e,B.emitterWorldMatrix,C.direction):C.direction.vf(f,L,e)},I._positionCreation.process=C=>{B.particleContext=C,B.systemContext=I;const x=this.minEmitBox.getConnectedValue(B),y=this.maxEmitBox.getConnectedValue(B),f=(0,g.RandomRange)(x.x,y.x),L=(0,g.RandomRange)(x.y,y.y),e=(0,g.RandomRange)(x.z,y.z);B.isEmitterTransformNode?M.HI.TransformCoordinatesFromFloatsToRef(f,L,e,B.emitterWorldMatrix,C.position):(C.position.vf(f,L,e),C.position.addInPlace(B.emitterPosition))},this.output._storedValue=I}}(0,L.h)("BABYLON.BoxShapeBlock",CC);class MC extends TI{constructor(B){super(B),this.registerInput("emitPower",lI.Float,!0,1),this.registerInput("lifeTime",lI.Float,!0,1),this.registerInput("color",lI.Pf,!0,new f.Pf(1,1,1,1)),this.registerInput("scale",lI.Vector2,!0,new M.Vector2(1,1)),this.registerInput("angle",lI.Float,!0,0),this.registerOutput("particle",lI.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(B){const I=new LI(this.name,B.nI,B.kI,null,!1,void 0,!0);I.particleEmitterType=new o,I._lifeTimeCreation.process=(I,C)=>{B.particleContext=I,I.lifeTime=this.lifeTime.getConnectedValue(B),C._emitPower=this.emitPower.getConnectedValue(B)},I._colorCreation.process=I=>{B.particleContext=I,I.color.M(this.color.getConnectedValue(B))},I._sizeCreation.process=I=>{B.particleContext=I,I.size=1,I.scale.M(this.scale.getConnectedValue(B))},I._angleCreation.process=I=>{B.particleContext=I,I.angle=this.angle.getConnectedValue(B)},this.particle._storedValue=I}}(0,L.h)("BABYLON.CreateParticleBlock",MC);class xC{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const B=[];for(const I of this.attachedBlocks)I.isInput&&B.push(I);return B}constructor(B){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new j.e,this.name=B}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(B){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(B)&&this.attachedBlocks.push(B);for(const C of B.inputs){const M=C.connectedPoint;if(M){const C=M.ownerBlock;C!==B&&this._initializeBlock(C,I)}}}async buildAsync(B){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((C=>{const M=new rI;for(const B of this._systemBlocks)this._initializeBlock(B);for(const x of this.systemBlocks){const C=new hI;C.buildId=this._buildId++,C.kI=B,C.verbose=I;const y=x.createSystem(C);C.emitErrors(),M.systems.push(y)}this.onBuildObservable.notifyObservers(this),C(M)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const B=new wI("Particle system"),I=new BC("Update position");I.output.connectTo(B.particle);const C=new KI("Position");C.contextualValue=zI.Position;const M=new KI("Scaled direction");M.contextualValue=zI.ScaledDirection;const x=new IC("Add");x.operation=YI.Add,C.output.connectTo(x.left),M.output.connectTo(x.right),x.output.connectTo(I.position);const y=new MC("Create particle"),f=new CC("Box shape");y.particle.connectTo(f.particle),f.output.connectTo(I.particle);const L=new mI("Texture");L.texture.connectTo(B.texture),L.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(B)}removeBlock(B){const I=this.attachedBlocks.indexOf(B);if(I>-1&&this.attachedBlocks.splice(I,1),B.isSystem){const I=this._systemBlocks.indexOf(B);I>-1&&this._systemBlocks.splice(I,1)}}parseSerializedObject(B){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];I||this.clear();const C={};for(const M of B.EN){const B=(0,L.e)(M.customType);if(B){const I=new B;I._deserialize(M),C[M.id]=I,this.attachedBlocks.push(I),I.isSystem&&this._systemBlocks.push(I)}}for(const M of this.attachedBlocks)if(M.isTeleportOut){const B=M,I=B._tempEntryPointUniqueId;if(I){const M=C[I];M&&M.attachToEndpoint(B)}}for(let M=0;M<B.EN.length;M++){const x=B.EN[M],y=C[x.id];y&&(y.inputs.length&&x.inputs.some((B=>B.targetConnectionName))&&!I||this._restoreConnections(y,B,C))}if(B.locations||B.editorData&&B.editorData.locations){const M=B.locations||B.editorData.locations;for(const B of M)C[B.sx]&&(B.sx=C[B.sx].uniqueId);I&&this.editorData&&this.editorData.locations&&M.concat(this.editorData.locations),B.locations?this.editorData={locations:M}:(this.editorData=B.editorData,this.editorData.locations=M);const x=[];for(const B in C)x[B]=C[B].uniqueId;this.editorData.map=x}this.comment=B.comment}_restoreConnections(B,I,C){for(const M of B.outputs)for(const x of I.EN){const y=C[x.id];if(y)for(const f of x.inputs)if(C[f.targetBlockId]!==B||f.targetConnectionName!==M.name);else{const B=y.getInputByName(f.inputName);if(!B||B.isConnected)continue;M.connectTo(B,!0),this._restoreConnections(y,I,C)}}}serialize(B){const I=B?{}:a.d.Serialize(this);I.editorData=JSON.parse(JSON.stringify(this.editorData));let C=[];B?C=B:I.customType="BABYLON.NodeParticleSystemSet",I.EN=[];for(const M of C)I.EN.push(M.serialize());if(!B)for(const M of this.attachedBlocks)-1===C.indexOf(M)&&I.EN.push(M.serialize());return I}dispose(){for(const B of this.attachedBlocks)B.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(B){const I=new xC(B);return I.setToDefault(),I}static Parse(B){const I=a.d.Parse((()=>new xC(B.name)),B,null);return I.parseSerializedObject(B),I}static ParseFromSnippetAsync(B,I){return"_BLANK"===B?Promise.resolve(xC.CreateDefault("blank")):new Promise(((C,M)=>{const x=new AI.c;x.addEventListener("readystatechange",(()=>{if(4==x.readyState)if(200==x.status){const f=JSON.parse(JSON.parse(x.responseText).jsonPayload),L=JSON.parse(f.nodeParticle);I||(I=a.d.Parse((()=>new xC(B)),L,null)),I.parseSerializedObject(L),I.snippetId=B;try{C(I)}catch(y){M(y)}}else M("Unable to load the snippet "+B)})),x.open("GET",this.SnippetUrl+"/"+B.replace(/#/g,"/")),x.send()}))}}xC.EditorURL=`${VI.Tools._DefaultCdnUrl}/v${PB.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,xC.SnippetUrl="https://snippet.babylonjs.com",(0,n.e)([(0,O.K)()],xC.prototype,"name",void 0),(0,n.e)([(0,O.K)("comment")],xC.prototype,"comment",void 0),function(B){B[B.None=0]="None",B[B.PerParticle=1]="PerParticle",B[B.PerSystem=2]="PerSystem"}(vI||(vI={}));class yC extends TI{constructor(B){super(B),this._currentLockId=-2,this.lockMode=vI.PerParticle,this.registerInput("min",lI.AutoDetect,!0,0),this.registerInput("max",lI.AutoDetect,!0,1),this.registerOutput("output",lI.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lI.Float|lI.Int|lI.Vector2|lI.HI|lI.Pf),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(lI.Float|lI.Int|lI.Vector2|lI.HI|lI.Pf),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=lI.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let B=null;switch(this._currentLockId=-2,this.min.type){case lI.AutoDetect:case lI.Int:case lI.Float:B=B=>{const I=this.min.getConnectedValue(B)||0,C=this.max.getConnectedValue(B)||1;return I+Math.random()*(C-I)};break;case lI.Vector2:B=B=>{const I=this.min.getConnectedValue(B)||M.Vector2.Zero(),C=this.max.getConnectedValue(B)||M.Vector2.One();return new M.Vector2(I.x+Math.random()*(C.x-I.x),I.y+Math.random()*(C.y-I.y))};break;case lI.HI:B=B=>{const I=this.min.getConnectedValue(B)||M.HI.Zero(),C=this.max.getConnectedValue(B)||M.HI.One();return new M.HI(I.x+Math.random()*(C.x-I.x),I.y+Math.random()*(C.y-I.y),I.z+Math.random()*(C.z-I.z))};break;case lI.Pf:B=B=>{const I=this.min.getConnectedValue(B)||new f.Pf(0,0,0,0),C=this.max.getConnectedValue(B)||new f.Pf(1,1,1,1);return new f.Pf(I.x+Math.random()*(C.x-I.x),I.y+Math.random()*(C.y-I.y),I.z+Math.random()*(C.z-I.z),I.w+Math.random()*(C.w-I.w))}}this.output._storedFunction=I=>{var C;let M=0;switch(this.lockMode){case vI.PerParticle:M=(null===(C=I.particleContext)||void 0===C?void 0:C.id)||-1;break;case vI.PerSystem:M=I.buildId||0}return this._currentLockId!==M&&(this.lockMode!==vI.None&&(this._currentLockId=M),this.output._storedValue=B(I)),this.output._storedValue}}serialize(){const B=super.serialize();return B.lockMode=this.lockMode,B}_deserialize(B){super._deserialize(B),this.lockMode=B.lockMode}}(0,n.e)([PI("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:vI.None},{label:"Per particle",value:vI.PerParticle},{label:"Per system",value:vI.PerSystem}]})],yC.prototype,"lockMode",void 0),(0,L.h)("BABYLON.ParticleRandomBlock",yC);class fC extends TI{constructor(B){super(B),this._currentLockId=-2,this.lockMode=vI.PerParticle,this.registerInput("min",lI.AutoDetect),this.registerInput("max",lI.AutoDetect),this.registerOutput("output",lI.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const I=[lI.Matrix,lI.Particle,lI.Texture,lI.System,lI.FloatGradient,lI.Color4Gradient,lI.Vector2Gradient,lI.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...I),this.max.excludedConnectionPointTypes.push(...I)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let B=null;switch(this._currentLockId=-2,this.min.type){case lI.Float:case lI.Int:B=B=>{const I=this.min.getConnectedValue(B),C=this.max.getConnectedValue(B);return Math.random()*(C-I)+I};break;case lI.Vector2:B=B=>{const I=this.min.getConnectedValue(B),C=this.max.getConnectedValue(B);return new M.Vector2(Math.random()*(C.x-I.x)+I.x,Math.random()*(C.y-I.y)+I.y)};break;case lI.HI:B=B=>{const I=this.min.getConnectedValue(B),C=this.max.getConnectedValue(B);return new M.HI(Math.random()*(C.x-I.x)+I.x,Math.random()*(C.y-I.y)+I.y,Math.random()*(C.z-I.z)+I.z)};break;case lI.Pf:B=B=>{const I=this.min.getConnectedValue(B),C=this.max.getConnectedValue(B);return new f.Pf(Math.random()*(C.r-I.r)+I.r,Math.random()*(C.g-I.g)+I.g,Math.random()*(C.b-I.b)+I.b,Math.random()*(C.a-I.a)+I.a)}}this.output._storedFunction=I=>{var C;let M=0;switch(this.lockMode){case vI.PerParticle:M=(null===(C=I.particleContext)||void 0===C?void 0:C.id)||-1;break;case vI.PerSystem:M=I.buildId||0}return this._currentLockId!==M&&(this.lockMode!==vI.None&&(this._currentLockId=M),this.output._storedValue=B(I)),this.output._storedValue}}serialize(){const B=super.serialize();return B.lockMode=this.lockMode,B}_deserialize(B){super._deserialize(B),void 0!==B.lockMode&&(this.lockMode=B.lockMode)}}(0,n.e)([PI("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:vI.None},{label:"Per particle",value:vI.PerParticle},{label:"Per system",value:vI.PerSystem}]})],fC.prototype,"lockMode",void 0),(0,L.h)("BABYLON.RandomRangeBlock",fC);(0,L.h)("BABYLON.ParticleLerpBlock",class extends TI{constructor(B){super(B),this.registerInput("left",lI.AutoDetect),this.registerInput("right",lI.AutoDetect),this.registerInput("gradient",lI.Float,!0,0,0,1),this.registerOutput("output",lI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lI.Float|lI.Int|lI.Vector2|lI.HI|lI.Pf)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const B=(B,I,C)=>(1-B)*I+B*C;this.output._storedFunction=I=>{const C=this.left.getConnectedValue(I),x=this.right.getConnectedValue(I),y=this.gradient.getConnectedValue(I);switch(this.left.type){case lI.Int:case lI.Float:return B(y,C,x);case lI.Vector2:return new M.Vector2(B(y,C.x,x.x),B(y,C.y,x.y));case lI.HI:return new M.HI(B(y,C.x,x.x),B(y,C.y,x.y),B(y,C.z,x.z));case lI.Pf:return new f.Pf(B(y,C.r,x.r),B(y,C.g,x.g),B(y,C.b,x.b),B(y,C.a,x.a))}return 0}}});(0,L.h)("BABYLON.UpdateDirectionBlock",class extends TI{constructor(B){super(B),this.registerInput("particle",lI.Particle),this.registerInput("direction",lI.HI),this.registerOutput("output",lI.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(B){const I=this.particle.getConnectedValue(B);if(this.output._storedValue=I,!this.direction.isConnected)return;const C={process:C=>{B.particleContext=C,B.systemContext=I,C.direction.M(this.direction.getConnectedValue(B))},previousItem:null,nextItem:null};I._updateQueueStart?bB(C,I._updateQueueStart):I._updateQueueStart=C}});(0,L.h)("BABYLON.UpdateColorBlock",class extends TI{constructor(B){super(B),this.registerInput("particle",lI.Particle),this.registerInput("color",lI.Pf),this.registerOutput("output",lI.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(B){const I=this.particle.getConnectedValue(B);if(this.output._storedValue=I,!this.color.isConnected)return;const C={process:C=>{B.particleContext=C,B.systemContext=I,C.color.M(this.color.getConnectedValue(B))},previousItem:null,nextItem:null};I._updateQueueStart?bB(C,I._updateQueueStart):I._updateQueueStart=C}});(0,L.h)("BABYLON.UpdateScaleBlock",class extends TI{constructor(B){super(B),this.registerInput("particle",lI.Particle),this.registerInput("scale",lI.Vector2),this.registerOutput("output",lI.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(B){const I=this.particle.getConnectedValue(B);if(this.output._storedValue=I,!this.scale.isConnected)return;const C={process:C=>{B.particleContext=C,B.systemContext=I,C.scale.M(this.scale.getConnectedValue(B))},previousItem:null,nextItem:null};I._updateQueueStart?bB(C,I._updateQueueStart):I._updateQueueStart=C}});(0,L.h)("BABYLON.UpdateAngleBlock",class extends TI{constructor(B){super(B),this.registerInput("particle",lI.Particle),this.registerInput("angle",lI.Float),this.registerOutput("output",lI.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(B){const I=this.particle.getConnectedValue(B);if(this.output._storedValue=I,!this.angle.isConnected)return;const C={process:C=>{B.particleContext=C,B.systemContext=I,C.angle=this.angle.getConnectedValue(B)},previousItem:null,nextItem:null};I._updateQueueStart?bB(C,I._updateQueueStart):I._updateQueueStart=C}});(0,L.h)("BABYLON.BasicPositionUpdateBlock",class extends TI{constructor(B){super(B),this.registerInput("particle",lI.Particle),this.registerOutput("output",lI.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(B){const I=this.particle.getConnectedValue(B),C={process:C=>{B.particleContext=C,B.systemContext=I,C.direction.scaleToRef(I._directionScale,I._scaledDirection),C.position.addInPlace(I._scaledDirection)},previousItem:null,nextItem:null};I._updateQueueStart?bB(C,I._updateQueueStart):I._updateQueueStart=C,this.output._storedValue=I}});(0,L.h)("BABYLON.BasicSpriteUpdateBlock",class extends TI{constructor(B){super(B),this.registerInput("particle",lI.Particle),this.registerOutput("output",lI.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(B){const I=this.particle.getConnectedValue(B),C={process:C=>{B.particleContext=C,B.systemContext=I,C.updateCellIndex()},previousItem:null,nextItem:null};I._updateQueueStart?bB(C,I._updateQueueStart):I._updateQueueStart=C,this.output._storedValue=I}});(0,L.h)("BABYLON.UpdateSpriteCellIndexBlock",class extends TI{constructor(B){super(B),this.registerInput("particle",lI.Particle),this.registerInput("cellIndex",lI.Int),this.registerOutput("output",lI.Particle),this.cellIndex.acceptedConnectionPointTypes=[lI.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(B){const I=this.particle.getConnectedValue(B);if(this.output._storedValue=I,!this.cellIndex.isConnected)return;const C={process:C=>{B.particleContext=C,B.systemContext=I,C.cellIndex=Math.floor(this.cellIndex.getConnectedValue(B))},previousItem:null,nextItem:null};I._updateQueueStart?bB(C,I._updateQueueStart):I._updateQueueStart=C}});class LC extends TI{constructor(B){super(B),this.strength=1,this.registerInput("particle",lI.Particle),this.registerInput("flowMap",lI.Texture),this.registerOutput("output",lI.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(B){var I;const C=this.particle.getConnectedValue(B),M=B.kI;let x;(null===(I=this.flowMap.connectedPoint)||void 0===I?void 0:I.ownerBlock).extractTextureContentAsync().then((B=>{B&&(x=new dI(B.width,B.height,B.data))}));const y={process:B=>{const I=M.getTransformMatrix();x&&x._processParticle(B,this.strength*C._tempScaledUpdateSpeed,I)},previousItem:null,nextItem:null};C._updateQueueStart?bB(y,C._updateQueueStart):C._updateQueueStart=y,this.output._storedValue=C}serialize(){const B=super.serialize();return B.strength=this.strength,B}_deserialize(B){super._deserialize(B),this.strength=B.strength}}(0,n.e)([PI("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],LC.prototype,"strength",void 0),(0,L.h)("BABYLON.UpdateFlowMapBlock",LC);(0,L.h)("BABYLON.SphereShapeBlock",class extends TI{constructor(B){super(B),this.registerInput("input",lI.Particle),this.registerInput("radius",lI.Float,!0,1),this.registerInput("radiusRange",lI.Float,!0,1,0,1),this.registerInput("directionRandomizer",lI.Float,!0,0,0,1),this.registerOutput("output",lI.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(B){const I=this.input.getConnectedValue(B);I._directionCreation.process=C=>{B.particleContext=C,B.systemContext=I;const x=this.directionRandomizer.getConnectedValue(B),y=C.position.FI(B.emitterPosition).normalize(),f=(0,g.RandomRange)(0,x),L=(0,g.RandomRange)(0,x),e=(0,g.RandomRange)(0,x);y.x+=f,y.y+=L,y.z+=e,y.normalize(),B.isEmitterTransformNode?M.HI.TransformNormalFromFloatsToRef(f,L,e,B.emitterWorldMatrix,C.direction):C.direction.vf(f,L,e)},I._positionCreation.process=C=>{B.particleContext=C,B.systemContext=I;const x=this.radius.getConnectedValue(B),y=this.radiusRange.getConnectedValue(B),f=x-(0,g.RandomRange)(0,x*y),L=(0,g.RandomRange)(0,1),e=(0,g.RandomRange)(0,2*Math.PI),N=Math.acos(2*L-1),R=f*Math.cos(e)*Math.sin(N),H=f*Math.cos(N),F=f*Math.sin(e)*Math.sin(N);B.isEmitterTransformNode?M.HI.TransformCoordinatesFromFloatsToRef(R,H,F,B.emitterWorldMatrix,C.position):(C.position.vf(R,H,F),C.position.addInPlace(B.emitterPosition))},this.output._storedValue=I}});(0,L.h)("BABYLON.PointShapeBlock",class extends TI{constructor(B){super(B),this.registerInput("particle",lI.Particle),this.registerInput("direction1",lI.HI,!0,new M.HI(0,1,0)),this.registerInput("direction2",lI.HI,!0,new M.HI(0,1,0)),this.registerOutput("output",lI.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(B){const I=this.particle.getConnectedValue(B);I._directionCreation.process=C=>{B.particleContext=C,B.systemContext=I;const x=this.direction1.getConnectedValue(B),y=this.direction2.getConnectedValue(B),f=(0,g.RandomRange)(x.x,y.x),L=(0,g.RandomRange)(x.y,y.y),e=(0,g.RandomRange)(x.z,y.z);B.isEmitterTransformNode?M.HI.TransformNormalFromFloatsToRef(f,L,e,B.emitterWorldMatrix,C.direction):C.direction.vf(f,L,e)},I._positionCreation.process=C=>{B.systemContext=I,B.isEmitterTransformNode?M.HI.TransformCoordinatesFromFloatsToRef(0,0,0,B.emitterWorldMatrix,C.position):C.position.M(B.emitterPosition)},this.output._storedValue=I}});(0,L.h)("BABYLON.CustomShapeBlock",class extends TI{constructor(B){super(B),this.registerInput("particle",lI.Particle),this.registerInput("position",lI.HI,!0,new M.HI(0,0,0)),this.registerInput("direction",lI.HI,!0,new M.HI(0,1,0)),this.registerOutput("output",lI.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(B){const I=this.particle.getConnectedValue(B);I._directionCreation.process=C=>{B.particleContext=C,B.systemContext=I;const x=this.direction.getConnectedValue(B);B.isEmitterTransformNode?M.HI.TransformNormalToRef(x,B.emitterWorldMatrix,C.direction):C.direction.M(x)},I._positionCreation.process=C=>{B.particleContext=C,B.systemContext=I;const x=this.position.getConnectedValue(B);B.isEmitterTransformNode?M.HI.TransformCoordinatesToRef(x,B.emitterWorldMatrix,C.position):(C.position.M(x),C.position.addInPlace(B.emitterPosition))},this.output._storedValue=I}});(0,L.h)("BABYLON.CylinderShapeBlock",class extends TI{constructor(B){super(B),this._tempVector=M.HI.Zero(),this.registerInput("particle",lI.Particle),this.registerInput("radius",lI.Float,!0,1),this.registerInput("height",lI.Float,!0,1,0),this.registerInput("radiusRange",lI.Float,!0,1,0,1),this.registerInput("directionRandomizer",lI.Float,!0,0,0,1),this.registerOutput("output",lI.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(B){const I=this.particle.getConnectedValue(B);I._directionCreation.process=C=>{B.particleContext=C,B.systemContext=I;const x=this.directionRandomizer.getConnectedValue(B);C.position.subtractToRef(B.emitterPosition,this._tempVector),this._tempVector.normalize(),B.isEmitterTransformNode&&M.HI.TransformNormalToRef(this._tempVector,B.emitterInverseWorldMatrix,this._tempVector);const y=(0,g.RandomRange)(-x/2,x/2);let f=Math.atan2(this._tempVector.x,this._tempVector.z);f+=(0,g.RandomRange)(-Math.PI/2,Math.PI/2)*x,this._tempVector.y=y,this._tempVector.x=Math.sin(f),this._tempVector.z=Math.cos(f),this._tempVector.normalize(),B.isEmitterTransformNode?M.HI.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,B.emitterWorldMatrix,C.direction):C.direction.M(this._tempVector)},I._positionCreation.process=C=>{B.particleContext=C,B.systemContext=I;const x=this.height.getConnectedValue(B),y=this.radiusRange.getConnectedValue(B),f=this.radius.getConnectedValue(B),L=(0,g.RandomRange)(-x/2,x/2),e=(0,g.RandomRange)(0,2*Math.PI),N=(0,g.RandomRange)((1-y)*(1-y),1),R=Math.sqrt(N)*f,H=R*Math.cos(e),F=R*Math.sin(e);B.isEmitterTransformNode?M.HI.TransformCoordinatesFromFloatsToRef(H,L,F,B.emitterWorldMatrix,C.position):(C.position.vf(H,L,F),C.position.addInPlace(B.emitterPosition))},this.output._storedValue=I}});class eC extends TI{constructor(B){super(B),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",lI.Particle),this.registerOutput("output",lI.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(B){super._build(B);const I=this.particle.getConnectedValue(B);I._isAnimationSheetEnabled=!0,I.spriteCellWidth=this.width,I.spriteCellHeight=this.height,I.startSpriteCellID=this.start,I.endSpriteCellID=this.end,I.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=I}serialize(){const B=super.serialize();return B.width=this.width,B.height=this.height,B.start=this.start,B.end=this.end,B.randomStartCell=this.randomStartCell,B}_deserialize(B){super._deserialize(B),this.width=B.width,this.height=B.height,this.start=B.start,this.end=B.end,this.randomStartCell=B.randomStartCell}}(0,n.e)([PI("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],eC.prototype,"start",void 0),(0,n.e)([PI("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],eC.prototype,"end",void 0),(0,n.e)([PI("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],eC.prototype,"width",void 0),(0,n.e)([PI("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],eC.prototype,"height",void 0),(0,n.e)([PI("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],eC.prototype,"loop",void 0),(0,n.e)([PI("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],eC.prototype,"randomStartCell",void 0),(0,L.h)("BABYLON.SetupSpriteSheetBlock",eC);class gC extends TI{constructor(B){super(B),this.reference=0,this.registerInput("value",lI.AutoDetect),this.registerOutput("output",lI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=B=>{switch(B){case lI.Float:return lI.FloatGradient;case lI.Vector2:return lI.Vector2Gradient;case lI.HI:return lI.Vector3Gradient;case lI.Pf:return lI.Color4Gradient}return B},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lI.Float|lI.Vector2|lI.HI|lI.Pf)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=B=>null}serialize(){const B=super.serialize();return B.reference=this.reference,B}_deserialize(B){super._deserialize(B),this.reference=B.reference}}(0,n.e)([PI("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],gC.prototype,"reference",void 0),(0,L.h)("BABYLON.ParticleGradientValueBlock",gC);(0,L.h)("BABYLON.ParticleGradientBlock",class extends TI{constructor(B){super(B),this._entryCount=1,this.registerInput("gradient",lI.Float,!0,1,0,1),this.registerInput("value0",lI.AutoDetect),this.registerOutput("output",lI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=B=>{switch(B){case lI.FloatGradient:return lI.Float;case lI.Vector2Gradient:return lI.Vector2;case lI.Vector3Gradient:return lI.HI;case lI.Color4Gradient:return lI.Pf}return B},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(lI.FloatGradient|lI.Vector2Gradient|lI.Vector3Gradient|lI.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(B){this._inputs[B].onConnectionObservable.add((()=>{this._entryCount>B||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),lI.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const B=[];for(let C=1;C<this._inputs.length;C++){var I;if(this._inputs[C].isConnected)B.push(null===(I=this._inputs[C].connectedPoint)||void 0===I?void 0:I.ownerBlock)}B.sort(((B,I)=>B.reference-I.reference)),this.output._storedFunction=I=>{const C=this.gradient.getConnectedValue(I);if(1===B.length)return B[0].value.getConnectedValue(I);let x=null;for(let y=B.length-1;y>=0;y--){const L=B[y];if(L.reference<=C){const B=L.value.getConnectedValue(I);if(x){const y=x.value.getConnectedValue(I),e=x.reference,N=L.reference,R=Math.max(0,Math.min(1,(C-N)/(e-N)));switch(this.output.type){case lI.Float:return(0,g.Lerp)(B,y,R);case lI.Vector2:return M.Vector2.Lerp(B,y,R);case lI.HI:return M.HI.Lerp(B,y,R);case lI.Pf:return f.Pf.Lerp(B,y,R)}}return B}x=L}return 0}}});(0,L.h)("BABYLON.ParticleConverterBlock",class extends TI{constructor(B){super(B),this.registerInput("color ",lI.Pf,!0),this.registerInput("xyz ",lI.HI,!0),this.registerInput("xy ",lI.Vector2,!0),this.registerInput("zw ",lI.Vector2,!0),this.registerInput("x ",lI.Float,!0),this.registerInput("y ",lI.Float,!0),this.registerInput("z ",lI.Float,!0),this.registerInput("w ",lI.Float,!0),this.registerOutput("color",lI.Pf),this.registerOutput("xyz",lI.HI),this.registerOutput("xy",lI.Vector2),this.registerOutput("zw",lI.Vector2),this.registerOutput("x",lI.Float),this.registerOutput("y",lI.Float),this.registerOutput("z",lI.Float),this.registerOutput("w",lI.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(B){return"color "===B?"colorIn":"xyz "===B?"xyzIn":"xy "===B?"xyIn":"zw "===B?"zwIn":"x "===B?"xIn":"y "===B?"yIn":"z "===B?"zIn":"w "===B?"wIn":B}_outputRename(B){switch(B){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return B}}_build(B){super._build(B);const I=this.xIn,C=this.yIn,x=this.zIn,y=this.wIn,L=this.xyIn,e=this.zwIn,g=this.xyzIn,N=this.colorIn,R=this.colorOut,H=this.xyzOut,F=this.xyOut,k=this.zwOut,q=this.xOut,S=this.yOut,o=this.zOut,U=this.wOut,G=B=>{if(N.isConnected)return N.getConnectedValue(B);let M=0,R=0,H=0,F=0;if(I.isConnected&&(M=I.getConnectedValue(B)),C.isConnected&&(R=C.getConnectedValue(B)),x.isConnected&&(H=x.getConnectedValue(B)),y.isConnected&&(F=y.getConnectedValue(B)),L.isConnected){const I=L.getConnectedValue(B);I&&(M=I.x,R=I.y)}if(e.isConnected){const I=e.getConnectedValue(B);I&&(H=I.x,F=I.y)}if(g.isConnected){const I=g.getConnectedValue(B);I&&(M=I.x,R=I.y,H=I.z)}return new f.Pf(M,R,H,F)};R._storedFunction=B=>G(B),H._storedFunction=B=>{const I=G(B);return new M.HI(I.r,I.g,I.b)},F._storedFunction=B=>{const I=G(B);return new M.Vector2(I.r,I.g)},k._storedFunction=B=>{const I=G(B);return new M.Vector2(I.b,I.a)},q._storedFunction=B=>G(B).r,S._storedFunction=B=>G(B).g,o._storedFunction=B=>G(B).b,U._storedFunction=B=>G(B).a}}),function(B){B[B.Cos=0]="Cos",B[B.Sin=1]="Sin",B[B.Abs=2]="Abs",B[B.Exp=3]="Exp",B[B.Exp2=4]="Exp2",B[B.Round=5]="Round",B[B.Floor=6]="Floor",B[B.Ceiling=7]="Ceiling",B[B.Sqrt=8]="Sqrt",B[B.Log=9]="Log",B[B.Tan=10]="Tan",B[B.ArcTan=11]="ArcTan",B[B.ArcCos=12]="ArcCos",B[B.ArcSin=13]="ArcSin",B[B.Sign=14]="Sign",B[B.Negate=15]="Negate",B[B.OneMinus=16]="OneMinus",B[B.Reciprocal=17]="Reciprocal",B[B.ToDegrees=18]="ToDegrees",B[B.ToRadians=19]="ToRadians",B[B.Fract=20]="Fract"}(sI||(sI={}));class NC extends TI{constructor(B){super(B),this.operation=sI.Cos,this.registerInput("input",lI.AutoDetect),this.registerOutput("output",lI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(lI.Float|lI.Int|lI.Vector2|lI.HI|lI.Pf)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(B){super._build(B);let I=null;switch(this.operation){case sI.Cos:I=B=>Math.cos(B);break;case sI.Sin:I=B=>Math.sin(B);break;case sI.Abs:I=B=>Math.abs(B);break;case sI.Exp:I=B=>Math.exp(B);break;case sI.Exp2:I=B=>Math.pow(2,B);break;case sI.Round:I=B=>Math.round(B);break;case sI.Floor:I=B=>Math.floor(B);break;case sI.Ceiling:I=B=>Math.ceil(B);break;case sI.Sqrt:I=B=>Math.sqrt(B);break;case sI.Log:I=B=>Math.log(B);break;case sI.Tan:I=B=>Math.tan(B);break;case sI.ArcTan:I=B=>Math.atan(B);break;case sI.ArcCos:I=B=>Math.acos(B);break;case sI.ArcSin:I=B=>Math.asin(B);break;case sI.Sign:I=B=>Math.sign(B);break;case sI.Negate:I=B=>-B;break;case sI.OneMinus:I=B=>1-B;break;case sI.Reciprocal:I=B=>1/B;break;case sI.ToRadians:I=B=>B*Math.PI/180;break;case sI.ToDegrees:I=B=>180*B/Math.PI;break;case sI.Fract:I=B=>B>=0?B-Math.floor(B):B-Math.ceil(B)}if(!I)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case lI.Int:case lI.Float:this.output._storedFunction=B=>{const C=this.input.getConnectedValue(B);return I(C)};break;case lI.Vector2:this.output._storedFunction=B=>{const C=this.input.getConnectedValue(B);return new M.Vector2(I(C.x),I(C.y))};break;case lI.HI:this.output._storedFunction=B=>{const C=this.input.getConnectedValue(B);return new M.HI(I(C.x),I(C.y),I(C.z))};break;case lI.Pf:this.output._storedFunction=B=>{const C=this.input.getConnectedValue(B);return new f.Pf(I(C.r),I(C.g),I(C.b),I(C.a))}}return this}serialize(){const B=super.serialize();return B.operation=this.operation,B}_deserialize(B){super._deserialize(B),this.operation=B.operation}}(0,n.e)([PI("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:sI.Cos},{label:"Sin",value:sI.Sin},{label:"Abs",value:sI.Abs},{label:"Exp",value:sI.Exp},{label:"Exp2",value:sI.Exp2},{label:"Round",value:sI.Round},{label:"Floor",value:sI.Floor},{label:"Ceiling",value:sI.Ceiling},{label:"Sqrt",value:sI.Sqrt},{label:"Log",value:sI.Log},{label:"Tan",value:sI.Tan},{label:"ArcTan",value:sI.ArcTan},{label:"ArcCos",value:sI.ArcCos},{label:"ArcSin",value:sI.ArcSin},{label:"Sign",value:sI.Sign},{label:"Negate",value:sI.Negate},{label:"OneMinus",value:sI.OneMinus},{label:"Reciprocal",value:sI.Reciprocal},{label:"ToDegrees",value:sI.ToDegrees},{label:"ToRadians",value:sI.ToRadians},{label:"Fract",value:sI.Fract}]})],NC.prototype,"operation",void 0),(0,L.h)("BABYLON.ParticleTrigonometryBlock",NC);var RC,HC=C(12564);class FC extends TI{constructor(B){super(B),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",lI.AutoDetect),this.registerOutput("output",lI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(lI.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(lI.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(lI.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(lI.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(lI.System),this._inputs[0].excludedConnectionPointTypes.push(lI.Particle),this._inputs[0].excludedConnectionPointTypes.push(lI.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(B){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const I=B=>{const I=this.input.getConnectedValue(B);if(this.log.length>=this.stackSize)return I;if(null===I||void 0===I)return this.log.push(["null",""]),I;switch(this.input.type){case lI.Vector2:this.log.push([(0,HC.g)(I,4),I.toString()]);break;case lI.HI:this.log.push([(0,HC.j)(I,4),I.toString()]);break;case lI.Pf:this.log.push([`{R: ${I.r.toFixed(4)} G: ${I.g.toFixed(4)} B: ${I.b.toFixed(4)} A: ${I.a.toFixed(4)}}`,I.toString()]);break;default:this.log.push([I.toString(),I.toString()])}return I};this.output.isConnected?this.output._storedFunction=I:this.output._storedValue=I(B)}serialize(){const B=super.serialize();return B.stackSize=this.stackSize,B}_deserialize(B){super._deserialize(B),this.stackSize=B.stackSize}}(0,n.e)([PI("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],FC.prototype,"stackSize",void 0),(0,L.h)("BABYLON.ParticleDebugBlock",FC);(0,L.h)("BABYLON.ParticleElbowBlock",class extends TI{constructor(B){super(B),this.registerInput("input",lI.AutoDetect),this.registerOutput("output",lI.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(B){super._build(B);const I=this._outputs[0],C=this._inputs[0];I._storedFunction=B=>C.getConnectedValue(B)}});(0,L.h)("BABYLON.ParticleTeleportInBlock",class extends TI{get endpoints(){return this._endpoints}constructor(B){super(B),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",lI.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(B){if(this.getClassName()===B)return!0;for(const I of this.endpoints)if(I.isAnAncestorOfType(B))return!0;return!1}isAnAncestorOf(B){for(const I of this.endpoints){if(I===B)return!0;if(I.isAnAncestorOf(B))return!0}return!1}attachToEndpoint(B){B.detach(),this._endpoints.push(B),B._entryPoint=this,B._outputs[0]._typeConnectionSource=this._inputs[0],B._tempEntryPointUniqueId=null,B.name="> "+this.name}detachFromEndpoint(B){const I=this._endpoints.indexOf(B);-1!==I&&(this._endpoints.splice(I,1),B._outputs[0]._typeConnectionSource=null,B._entryPoint=null)}_build(){for(const B of this._endpoints)B.output._storedFunction=B=>this.input.getConnectedValue(B)}});(0,L.h)("BABYLON.ParticleTeleportOutBlock",class extends TI{constructor(B){super(B),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",lI.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(B){this.entryPoint&&this.entryPoint.build(B)}clone(){const B=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(B),B}serialize(){var B;const I=super.serialize();return I.entryPoint=(null===(B=this.entryPoint)||void 0===B?void 0:B.uniqueId)??"",I}_deserialize(B){super._deserialize(B),this._tempEntryPointUniqueId=B.entryPoint}}),function(B){B[B.Equal=0]="Equal",B[B.NotEqual=1]="NotEqual",B[B.LessThan=2]="LessThan",B[B.GreaterThan=3]="GreaterThan",B[B.LessOrEqual=4]="LessOrEqual",B[B.GreaterOrEqual=5]="GreaterOrEqual",B[B.Xor=6]="Xor",B[B.Or=7]="Or",B[B.And=8]="And"}(RC||(RC={}));class kC extends TI{constructor(B){super(B),this.test=RC.Equal,this.epsilon=0,this.registerInput("left",lI.Float),this.registerInput("right",lI.Float,!0,0),this.registerInput("ifTrue",lI.AutoDetect,!0,1),this.registerInput("ifFalse",lI.AutoDetect,!0,0),this.registerOutput("output",lI.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=lI.Float,this._inputs[0].acceptedConnectionPointTypes.push(lI.Int),this._inputs[1].acceptedConnectionPointTypes.push(lI.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const B=B=>{const I=this.left.getConnectedValue(B),C=this.right.getConnectedValue(B);let M=!1;switch(this.test){case RC.Equal:M=(0,g.WithinEpsilon)(I,C,this.epsilon);break;case RC.NotEqual:M=!(0,g.WithinEpsilon)(I,C,this.epsilon);break;case RC.LessThan:M=I<C+this.epsilon;break;case RC.GreaterThan:M=I>C-this.epsilon;break;case RC.LessOrEqual:M=I<=C+this.epsilon;break;case RC.GreaterOrEqual:M=I>=C-this.epsilon;break;case RC.Xor:M=!!I&&!C||!I&&!!C;break;case RC.Or:M=!!I||!!C;break;case RC.And:M=!!I&&!!C}return M};this.output._storedFunction=I=>B(I)?this.ifTrue.getConnectedValue(I):this.ifFalse.getConnectedValue(I)}serialize(){const B=super.serialize();return B.test=this.test,B.epsilon=this.epsilon,B}_deserialize(B){super._deserialize(B),this.test=B.test,void 0!==B.epsilon&&(this.epsilon=B.epsilon)}}(0,n.e)([PI("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:RC.Equal},{label:"NotEqual",value:RC.NotEqual},{label:"LessThan",value:RC.LessThan},{label:"GreaterThan",value:RC.GreaterThan},{label:"LessOrEqual",value:RC.LessOrEqual},{label:"GreaterOrEqual",value:RC.GreaterOrEqual},{label:"Xor",value:RC.Xor},{label:"Or",value:RC.Or},{label:"And",value:RC.And}]})],kC.prototype,"test",void 0),(0,n.e)([PI("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],kC.prototype,"epsilon",void 0),(0,L.h)("BABYLON.ParticleConditionBlock",kC);class qC extends TI{constructor(B){super(B),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",lI.Particle),this.registerInput("condition",lI.Float,!0,0),this.registerInput("system",lI.System),this.registerOutput("output",lI.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(B){this._triggerCount=0;const I=this.input.getConnectedValue(B),C={process:C=>{if(B.particleContext=C,B.systemContext=I,0!==this.condition.getConnectedValue(B)&&(0===this.limit||this._triggerCount<this.limit)){const M=(new Date).getTime();if(this._previousOne&&M-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=M;const x=this.system.getConnectedValue(B);if(x){const M=jI(x,B.kI,C.position);M.If.addOnce((()=>{this._triggerCount--})),I.If.addOnce((()=>{M.dispose()}))}}},previousItem:null,nextItem:null};I._updateQueueStart?bB(C,I._updateQueueStart):I._updateQueueStart=C,this.output._storedValue=I}serialize(){const B=super.serialize();return B.limit=this.limit,B.delay=this.delay,B}_deserialize(B){super._deserialize(B),void 0!==B.limit&&(this.limit=B.limit),void 0!==B.delay&&(this.delay=B.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,n.e)([PI("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qC.prototype,"limit",void 0),(0,n.e)([PI("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],qC.prototype,"delay",void 0),(0,L.h)("BABYLON.ParticleTriggerBlock",qC);C(12569),C(12577),C(12588),C(12643)},12625:(B,I,C)=>{"use strict";var M=C(11110);const x="clipPlaneFragment",y="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";M.d.IncludesShadersStoreWGSL[x]||(M.d.IncludesShadersStoreWGSL[x]=y)},12594:(B,I,C)=>{"use strict";var M=C(11110);const x="clipPlaneFragmentDeclaration",y="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";M.d.IncludesShadersStoreWGSL[x]||(M.d.IncludesShadersStoreWGSL[x]=y)},12659:(B,I,C)=>{"use strict";var M=C(11110);const x="clipPlaneVertex",y="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";M.d.IncludesShadersStoreWGSL[x]||(M.d.IncludesShadersStoreWGSL[x]=y)},12647:(B,I,C)=>{"use strict";var M=C(11110);const x="clipPlaneVertexDeclaration",y="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";M.d.IncludesShadersStoreWGSL[x]||(M.d.IncludesShadersStoreWGSL[x]=y)},12636:(B,I,C)=>{"use strict";var M=C(11110);const x="fogFragment",y="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";M.d.IncludesShadersStoreWGSL[x]||(M.d.IncludesShadersStoreWGSL[x]=y)},12618:(B,I,C)=>{"use strict";var M=C(11110);const x="fogFragmentDeclaration",y="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";M.d.IncludesShadersStoreWGSL[x]||(M.d.IncludesShadersStoreWGSL[x]=y)},12662:(B,I,C)=>{"use strict";var M=C(11110);const x="fogVertex",y="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";M.d.IncludesShadersStoreWGSL[x]||(M.d.IncludesShadersStoreWGSL[x]=y)},12652:(B,I,C)=>{"use strict";var M=C(11110);const x="fogVertexDeclaration",y="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";M.d.IncludesShadersStoreWGSL[x]||(M.d.IncludesShadersStoreWGSL[x]=y)},12610:(B,I,C)=>{"use strict";var M=C(11110);const x="helperFunctions",y="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";M.d.IncludesShadersStoreWGSL[x]||(M.d.IncludesShadersStoreWGSL[x]=y)},12599:(B,I,C)=>{"use strict";var M=C(11110);const x="imageProcessingDeclaration",y="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";M.d.IncludesShadersStoreWGSL[x]||(M.d.IncludesShadersStoreWGSL[x]=y)},12614:(B,I,C)=>{"use strict";var M=C(11110);const x="imageProcessingFunctions",y="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";M.d.IncludesShadersStoreWGSL[x]||(M.d.IncludesShadersStoreWGSL[x]=y)},12607:(B,I,C)=>{"use strict";var M=C(11110);const x="logDepthDeclaration",y="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";M.d.IncludesShadersStoreWGSL[x]||(M.d.IncludesShadersStoreWGSL[x]=y)},12630:(B,I,C)=>{"use strict";var M=C(11110);const x="logDepthFragment",y="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";M.d.IncludesShadersStoreWGSL[x]||(M.d.IncludesShadersStoreWGSL[x]=y)},12669:(B,I,C)=>{"use strict";var M=C(11110);const x="logDepthVertex",y="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";M.d.IncludesShadersStoreWGSL[x]||(M.d.IncludesShadersStoreWGSL[x]=y)},12588:(B,I,C)=>{"use strict";C.r(I),C.d(I,{particlesPixelShaderWGSL:()=>f});var M=C(11110);C(12594),C(12599),C(12607),C(12610),C(12614),C(12618),C(12625),C(12630),C(12636);const x="particlesPixelShader",y="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";M.d.ShadersStoreWGSL[x]||(M.d.ShadersStoreWGSL[x]=y);const f={name:x,shader:y}},12643:(B,I,C)=>{"use strict";C.r(I),C.d(I,{particlesVertexShaderWGSL:()=>f});var M=C(11110);C(12647),C(12652),C(12607),C(12659),C(12662),C(12669);const x="particlesVertexShader",y="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";M.d.ShadersStoreWGSL[x]||(M.d.ShadersStoreWGSL[x]=y);const f={name:x,shader:y}},12494:(B,I,C)=>{"use strict";var M=C(11110);const x="clipPlaneFragment",y="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";M.d.IncludesShadersStore[x]||(M.d.IncludesShadersStore[x]=y)},12575:(B,I,C)=>{"use strict";var M=C(11110);const x="clipPlaneFragmentDeclaration",y="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";M.d.IncludesShadersStore[x]||(M.d.IncludesShadersStore[x]=y)},12515:(B,I,C)=>{"use strict";var M=C(11110);const x="clipPlaneVertex",y="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";M.d.IncludesShadersStore[x]||(M.d.IncludesShadersStore[x]=y)},12581:(B,I,C)=>{"use strict";var M=C(11110);const x="clipPlaneVertexDeclaration",y="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";M.d.IncludesShadersStore[x]||(M.d.IncludesShadersStore[x]=y)},12504:(B,I,C)=>{"use strict";var M=C(11110);const x="fogFragment",y="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";M.d.IncludesShadersStore[x]||(M.d.IncludesShadersStore[x]=y)},12488:(B,I,C)=>{"use strict";var M=C(11110);const x="fogFragmentDeclaration",y="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";M.d.IncludesShadersStore[x]||(M.d.IncludesShadersStore[x]=y)},12520:(B,I,C)=>{"use strict";var M=C(11110);const x="fogVertex",y="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";M.d.IncludesShadersStore[x]||(M.d.IncludesShadersStore[x]=y)},12509:(B,I,C)=>{"use strict";var M=C(11110);const x="fogVertexDeclaration",y="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";M.d.IncludesShadersStore[x]||(M.d.IncludesShadersStore[x]=y)},12476:(B,I,C)=>{"use strict";var M=C(11110);const x="helperFunctions",y="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";M.d.IncludesShadersStore[x]||(M.d.IncludesShadersStore[x]=y)},12471:(B,I,C)=>{"use strict";var M=C(11110);const x="imageProcessingDeclaration",y="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";M.d.IncludesShadersStore[x]||(M.d.IncludesShadersStore[x]=y)},12484:(B,I,C)=>{"use strict";var M=C(11110);const x="imageProcessingFunctions",y="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";M.d.IncludesShadersStore[x]||(M.d.IncludesShadersStore[x]=y)},12474:(B,I,C)=>{"use strict";var M=C(11110);const x="logDepthDeclaration",y="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";M.d.IncludesShadersStore[x]||(M.d.IncludesShadersStore[x]=y)},12497:(B,I,C)=>{"use strict";var M=C(11110);const x="logDepthFragment",y="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";M.d.IncludesShadersStore[x]||(M.d.IncludesShadersStore[x]=y)},12528:(B,I,C)=>{"use strict";var M=C(11110);const x="logDepthVertex",y="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";M.d.IncludesShadersStore[x]||(M.d.IncludesShadersStore[x]=y)},12569:(B,I,C)=>{"use strict";C.r(I),C.d(I,{particlesPixelShader:()=>f});var M=C(11110);C(12575),C(12471),C(12474),C(12476),C(12484),C(12488),C(12494),C(12497),C(12504);const x="particlesPixelShader",y="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";M.d.ShadersStore[x]||(M.d.ShadersStore[x]=y);const f={name:x,shader:y}},12577:(B,I,C)=>{"use strict";C.r(I),C.d(I,{particlesVertexShader:()=>f});var M=C(11110);C(12581),C(12509),C(12474),C(12515),C(12520),C(12528);const x="particlesVertexShader",y="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";M.d.ShadersStore[x]||(M.d.ShadersStore[x]=y);const f={name:x,shader:y}},12955:(B,I,C)=>{"use strict";C.r(I),C.d(I,{FlowGraphGLTFDataProvider:()=>y});var M=C(12927),x=C(12901);class y extends M.e{constructor(B){var I,C;super();const M=B.glTF,y=(null===(I=M.animations)||void 0===I?void 0:I.map((B=>B._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",x.b,y);const f=(null===(C=M.nodes)||void 0===C?void 0:C.map((B=>B._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",x.b,f)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12826:(B,I,C)=>{"use strict";C.d(I,{b:()=>S,d:()=>k,g:()=>F,k:()=>q});var M=C(11194),x=C(11662),y=C(11239),f=C(12833);const L=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class e{constructor(B,I){this._gltf=B,this._infoTree=I}convert(B){let I,C=this._gltf,M=this._infoTree;if(!B.startsWith("/"))throw new Error("Path must start with a /");const x=B.split("/");if(x.shift(),x[x.length-1].includes(".length")){const B=x[x.length-1].split(".");x.pop(),x.push(...B)}let y=!1;for(const e of x){const x="length"===e;if(x&&!M.__array__)throw new Error(`Path ${B} is invalid`);if(M.__ignoreObjectTree__&&(y=!0),M.__array__&&!x)M=M.__array__;else if(M=M[e],!M)throw new Error(`Path ${B} is invalid`);if(!y)if(void 0===C){if(!L.find((I=>I.regex.test(B))))throw new Error(`Path ${B} is invalid`)}else if(!x){var f;C=null===(f=C)||void 0===f?void 0:f[e]}(M.__target__||x)&&(I=C)}return{object:I,info:M}}}function g(B,I,C,M){const x=N(B,I);return M?x[C][M]:x[C]}function N(B,I,C){var M,y;return null===(M=B._data)||void 0===M||null===(y=M[(null===C||void 0===C?void 0:C.fillMode)??x.b.MATERIAL_TriangleFillMode])||void 0===y?void 0:y.babylonMaterial}function R(B,I){return{offset:{componentsCount:2,type:"Vector2",get:(C,x,y)=>{const f=g(C,y,B,I);return new M.Vector2(null===f||void 0===f?void 0:f.uOffset,null===f||void 0===f?void 0:f.vOffset)},getTarget:N,set:(C,M,x,y)=>{const f=g(M,y,B,I);f.uOffset=C.x,f.vOffset=C.y},getPropertyName:[()=>`${B}${I?"."+I:""}.uOffset`,()=>`${B}${I?"."+I:""}.vOffset`]},rotation:{type:"number",get:(C,M,x)=>{var y;return null===(y=g(C,x,B,I))||void 0===y?void 0:y.wAng},getTarget:N,set:(C,M,x,y)=>g(M,y,B,I).wAng=C,getPropertyName:[()=>`${B}${I?"."+I:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(C,x,y)=>{const f=g(C,y,B,I);return new M.Vector2(null===f||void 0===f?void 0:f.uScale,null===f||void 0===f?void 0:f.vScale)},getTarget:N,set:(C,M,x,y)=>{const f=g(M,y,B,I);f.uScale=C.x,f.vScale=C.y},getPropertyName:[()=>`${B}${I?"."+I:""}.uScale`,()=>`${B}${I?"."+I:""}.vScale`]}}}const H={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:B=>{var I,C;return new M.Vector2((null===(I=B._babylonCamera)||void 0===I?void 0:I.orthoLeft)??0,(null===(C=B._babylonCamera)||void 0===C?void 0:C.orthoRight)??0)},set:(B,I)=>{I._babylonCamera&&(I._babylonCamera.orthoLeft=B.x,I._babylonCamera.orthoRight=B.y)},getTarget:B=>B,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:B=>{var I,C;return new M.Vector2((null===(I=B._babylonCamera)||void 0===I?void 0:I.orthoBottom)??0,(null===(C=B._babylonCamera)||void 0===C?void 0:C.orthoTop)??0)},set:(B,I)=>{I._babylonCamera&&(I._babylonCamera.orthoBottom=B.x,I._babylonCamera.orthoTop=B.y)},getTarget:B=>B,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:B=>{var I;return null===(I=B._babylonCamera)||void 0===I?void 0:I.maxZ},set:(B,I)=>{I._babylonCamera&&(I._babylonCamera.maxZ=B)},getTarget:B=>B,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:B=>{var I;return null===(I=B._babylonCamera)||void 0===I?void 0:I.uf},set:(B,I)=>{I._babylonCamera&&(I._babylonCamera.uf=B)},getTarget:B=>B,getPropertyName:[()=>"uf"]}},perspective:{aspectRatio:{type:"number",get:B=>{var I;return null===(I=B._babylonCamera)||void 0===I?void 0:I.getEngine().getAspectRatio(B._babylonCamera)},getTarget:B=>B,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:B=>{var I;return null===(I=B._babylonCamera)||void 0===I?void 0:I.fov},set:(B,I)=>{I._babylonCamera&&(I._babylonCamera.fov=B)},getTarget:B=>B,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:B=>{var I;return null===(I=B._babylonCamera)||void 0===I?void 0:I.maxZ},set:(B,I)=>{I._babylonCamera&&(I._babylonCamera.maxZ=B)},getTarget:B=>B,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:B=>{var I;return null===(I=B._babylonCamera)||void 0===I?void 0:I.uf},set:(B,I)=>{I._babylonCamera&&(I._babylonCamera.uf=B)},getTarget:B=>B,getPropertyName:[()=>"uf"]}}}},nodes:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>B._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"HI",get:B=>{var I;return null===(I=B._babylonTransformNode)||void 0===I?void 0:I.position},set:(B,I)=>{var C;return null===(C=I._babylonTransformNode)||void 0===C?void 0:C.position.M(B)},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:B=>{var I;return null===(I=B._babylonTransformNode)||void 0===I?void 0:I.rotationQuaternion},set:(B,I)=>{var C,M;return null===(C=I._babylonTransformNode)||void 0===C||null===(M=C.rotationQuaternion)||void 0===M?void 0:M.M(B)},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"HI",get:B=>{var I;return null===(I=B._babylonTransformNode)||void 0===I?void 0:I.Xf},set:(B,I)=>{var C;return null===(C=I._babylonTransformNode)||void 0===C?void 0:C.Xf.M(B)},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"Xf"]},weights:{length:{type:"number",get:B=>B._numMorphTargets,getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(B,I)=>{var C,M;return void 0!==I?null===(C=B._primitiveBabylonMeshes)||void 0===C||null===(M=C[0].morphTargetManager)||void 0===M?void 0:M.getTarget(I).influence:void 0},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(B,I)=>[0],getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:B=>{var I,C,x;return M.Matrix.Compose(null===(I=B._babylonTransformNode)||void 0===I?void 0:I.Xf,null===(C=B._babylonTransformNode)||void 0===C?void 0:C.rotationQuaternion,null===(x=B._babylonTransformNode)||void 0===x?void 0:x.position)},getTarget:B=>B._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:B=>{var I,C,x,y;const f=M.Matrix.Identity();let L=B.parent;for(;L&&L.parent;)L=L.parent;const e=(null===(I=B._babylonTransformNode)||void 0===I?void 0:I.position._isDirty)||(null===(C=B._babylonTransformNode)||void 0===C||null===(x=C.rotationQuaternion)||void 0===x?void 0:x._isDirty)||(null===(y=B._babylonTransformNode)||void 0===y?void 0:y.Xf._isDirty);if(L){var g;const I=null===(g=L._babylonTransformNode)||void 0===g?void 0:g.nf(!0).invert();var N,R;if(I)null===(N=B._babylonTransformNode)||void 0===N||null===(R=N.nf(e))||void 0===R||R.multiplyToRef(I,f)}else B._babylonTransformNode&&f.M(B._babylonTransformNode.nf(e));return f},getTarget:B=>B._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:B=>{var I,C;return null===(I=B._babylonTransformNode)||void 0===I||null===(C=I.getChildren((B=>B instanceof f.b),!0)[0])||void 0===C?void 0:C.AL},getTarget:B=>{var I;return null===(I=B._babylonTransformNode)||void 0===I?void 0:I.getChildren((B=>B instanceof f.b),!0)[0]},set:(B,I)=>{if(I._babylonTransformNode){const C=I._babylonTransformNode.getChildren((B=>B instanceof f.b),!0)[0];C&&(C.AL=B)}}},color:{type:"SI",get:B=>{var I,C;return null===(I=B._babylonTransformNode)||void 0===I||null===(C=I.getChildren((B=>B instanceof f.b),!0)[0])||void 0===C?void 0:C.DL},getTarget:B=>{var I;return null===(I=B._babylonTransformNode)||void 0===I?void 0:I.getChildren((B=>B instanceof f.b),!0)[0]},set:(B,I)=>{if(I._babylonTransformNode){const C=I._babylonTransformNode.getChildren((B=>B instanceof f.b),!0)[0];C&&(C.DL=B)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"SI",get:(B,I,C)=>N(B,I,C).emissiveColor,set:(B,I,C,M)=>N(I,C,M).emissiveColor.M(B),getTarget:(B,I,C)=>N(B,I,C),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:R("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(B,I,C)=>{var M;return null===(M=g(B,C,"bumpTexture"))||void 0===M?void 0:M.level},set:(B,I,C,M)=>{const x=g(I,M,"bumpTexture");x&&(x.level=B)},getTarget:(B,I,C)=>N(B,I,C),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:R("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(B,I,C)=>N(B,I,C).ambientTextureStrength,set:(B,I,C,M)=>{const x=N(I,C,M);x&&(x.ambientTextureStrength=B)},getTarget:(B,I,C)=>N(B,I,C),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:R("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Pf",get:(B,I,C)=>{const M=N(B,I,C);return y.Pf.FromColor3(M.albedoColor,M.alpha)},set:(B,I,C,M)=>{const x=N(I,C,M);x.albedoColor.set(B.r,B.g,B.b),x.alpha=B.a},getTarget:(B,I,C)=>N(B,I,C),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:R("albedoTexture")}},metallicFactor:{type:"number",get:(B,I,C)=>N(B,I,C).metallic,set:(B,I,C,M)=>{const x=N(I,C,M);x&&(x.metallic=B)},getTarget:(B,I,C)=>N(B,I,C),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(B,I,C)=>N(B,I,C).roughness,set:(B,I,C,M)=>{const x=N(I,C,M);x&&(x.roughness=B)},getTarget:(B,I,C)=>N(B,I,C),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:R("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(B,I,C)=>N(B,I,C).anisotropy.AL,set:(B,I,C,M)=>{N(I,C,M).anisotropy.AL=B},getTarget:(B,I,C)=>N(B,I,C),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(B,I,C)=>N(B,I,C).anisotropy.angle,set:(B,I,C,M)=>{N(I,C,M).anisotropy.angle=B},getTarget:(B,I,C)=>N(B,I,C),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:R("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(B,I,C)=>N(B,I,C).clearCoat.AL,set:(B,I,C,M)=>{N(I,C,M).clearCoat.AL=B},getTarget:(B,I,C)=>N(B,I,C),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(B,I,C)=>N(B,I,C).clearCoat.roughness,set:(B,I,C,M)=>{N(I,C,M).clearCoat.roughness=B},getTarget:(B,I,C)=>N(B,I,C),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:R("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(B,I,C)=>{var M;return null===(M=N(B,I,C).clearCoat.bumpTexture)||void 0===M?void 0:M.level},getTarget:N,set:(B,I,C,M)=>N(I,C,M).clearCoat.bumpTexture.level=B},extensions:{KHR_texture_transform:R("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:R("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(B,I,C)=>N(B,I,C).subSurface.dispersion,getTarget:N,set:(B,I,C,M)=>N(I,C,M).subSurface.dispersion=B}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(B,I,C)=>N(B,I,C).emissiveIntensity,getTarget:N,set:(B,I,C,M)=>N(I,C,M).emissiveIntensity=B}},KHR_materials_ior:{ior:{type:"number",get:(B,I,C)=>N(B,I,C).indexOfRefraction,getTarget:N,set:(B,I,C,M)=>N(I,C,M).indexOfRefraction=B}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(B,I,C)=>N(B,I,C).iridescence.AL,getTarget:N,set:(B,I,C,M)=>N(I,C,M).iridescence.AL=B},iridescenceIor:{type:"number",get:(B,I,C)=>N(B,I,C).iridescence.indexOfRefraction,getTarget:N,set:(B,I,C,M)=>N(I,C,M).iridescence.indexOfRefraction=B},iridescenceTexture:{extensions:{KHR_texture_transform:R("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(B,I,C)=>N(B,I,C).iridescence.maximumThickness,getTarget:N,set:(B,I,C,M)=>N(I,C,M).iridescence.maximumThickness=B},iridescenceThicknessMinimum:{type:"number",get:(B,I,C)=>N(B,I,C).iridescence.minimumThickness,getTarget:N,set:(B,I,C,M)=>N(I,C,M).iridescence.minimumThickness=B},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:R("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"SI",get:(B,I,C)=>N(B,I,C).sheen.color,getTarget:N,set:(B,I,C,M)=>N(I,C,M).sheen.color.M(B)},sheenColorTexture:{extensions:{KHR_texture_transform:R("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(B,I,C)=>N(B,I,C).sheen.AL,getTarget:N,set:(B,I,C,M)=>N(I,C,M).sheen.AL=B},sheenRoughnessTexture:{extensions:{KHR_texture_transform:R("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(B,I,C)=>N(B,I,C).metallicF0Factor,getTarget:N,set:(B,I,C,M)=>N(I,C,M).metallicF0Factor=B,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"SI",get:(B,I,C)=>N(B,I,C).metallicReflectanceColor,getTarget:N,set:(B,I,C,M)=>N(I,C,M).metallicReflectanceColor.M(B),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:R("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:R("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(B,I,C)=>N(B,I,C).subSurface.refractionIntensity,getTarget:N,set:(B,I,C,M)=>N(I,C,M).subSurface.refractionIntensity=B,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:R("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(B,I,C)=>N(B,I,C).subSurface.translucencyIntensity,getTarget:N,set:(B,I,C,M)=>N(I,C,M).subSurface.translucencyIntensity=B},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:R("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"SI",get:(B,I,C)=>N(B,I,C).subSurface.translucencyColor,getTarget:N,set:(B,I,C,M)=>{var x;return B&&(null===(x=N(I,C,M).subSurface.translucencyColor)||void 0===x?void 0:x.M(B))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:R("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"SI",get:(B,I,C)=>N(B,I,C).subSurface.tintColor,getTarget:N,set:(B,I,C,M)=>N(I,C,M).subSurface.tintColor.M(B)},attenuationDistance:{type:"number",get:(B,I,C)=>N(B,I,C).subSurface.tintColorAtDistance,getTarget:N,set:(B,I,C,M)=>N(I,C,M).subSurface.tintColorAtDistance=B},thicknessFactor:{type:"number",get:(B,I,C)=>N(B,I,C).subSurface.maximumThickness,getTarget:N,set:(B,I,C,M)=>N(I,C,M).subSurface.maximumThickness=B},thicknessTexture:{extensions:{KHR_texture_transform:R("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>B._babylonLight)),getPropertyName:[B=>"length"]},__array__:{__target__:!0,color:{type:"SI",get:B=>{var I;return null===(I=B._babylonLight)||void 0===I?void 0:I.DL},set:(B,I)=>{var C;return null===(C=I._babylonLight)||void 0===C?void 0:C.DL.M(B)},getTarget:B=>B._babylonLight,getPropertyName:[B=>"diffuse"]},AL:{type:"number",get:B=>{var I;return null===(I=B._babylonLight)||void 0===I?void 0:I.AL},set:(B,I)=>I._babylonLight?I._babylonLight.AL=B:void 0,getTarget:B=>B._babylonLight,getPropertyName:[B=>"intensity"]},range:{type:"number",get:B=>{var I;return null===(I=B._babylonLight)||void 0===I?void 0:I.range},set:(B,I)=>I._babylonLight?I._babylonLight.range=B:void 0,getTarget:B=>B._babylonLight,getPropertyName:[B=>"range"]},spot:{innerConeAngle:{type:"number",get:B=>{var I;return null===(I=B._babylonLight)||void 0===I?void 0:I.innerAngle},set:(B,I)=>I._babylonLight?I._babylonLight.innerAngle=B:void 0,getTarget:B=>B._babylonLight,getPropertyName:[B=>"innerConeAngle"]},outerConeAngle:{type:"number",get:B=>{var I;return null===(I=B._babylonLight)||void 0===I?void 0:I.angle},set:(B,I)=>I._babylonLight?I._babylonLight.angle=B:void 0,getTarget:B=>B._babylonLight,getPropertyName:[B=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>B._babylonLight)),getPropertyName:[B=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>B._babylonTexture)),getPropertyName:[B=>"length"]},__array__:{__target__:!0,AL:{type:"number",get:B=>{var I;return null===(I=B._babylonTexture)||void 0===I?void 0:I.level},set:(B,I)=>{I._babylonTexture&&(I._babylonTexture.level=B)},getTarget:B=>B._babylonTexture},rotation:{type:"Quaternion",get:B=>{var I;return B._babylonTexture&&M.Quaternion.FromRotationMatrix(null===(I=B._babylonTexture)||void 0===I?void 0:I.getReflectionTextureMatrix())},set:(B,I)=>{var C;I._babylonTexture&&(null!==(C=I._babylonTexture.rB())&&void 0!==C&&C.useRightHandedSystem||(B=M.Quaternion.Inverse(B)),M.Matrix.FromQuaternionToRef(B,I._babylonTexture.getReflectionTextureMatrix()))},getTarget:B=>B._babylonTexture}}}}},animations:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>B._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>{var I;return null===(I=B.primitives[0]._instanceData)||void 0===I?void 0:I.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function F(B){return new e(B,H)}function k(B){const I=B.split("/").map((B=>B.replace(/{}/g,"__array__")));let C=H;for(const M of I)M&&(C=C[M]);if(C&&C.type&&C.get)return C}function q(B,I){const C=B.split("/").map((B=>B.replace(/{}/g,"__array__")));let M=H;for(const x of C)x&&(M=M[x]);M&&M.type&&M.get&&(M.interpolation=I)}function S(B,I){const C=B.split("/").map((B=>B.replace(/{}/g,"__array__")));let M=H;for(const x of C)if(x){if(!M[x]){if("?"===x){M.__ignoreObjectTree__=!0;continue}M[x]={},"__array__"===x&&(M[x].__target__=!0)}M=M[x]}Object.assign(M,I)}},12838:(B,I,C)=>{"use strict";C.r(I),C.d(I,{AnimationPropertyInfo:()=>g,TransformNodeAnimationPropertyInfo:()=>N,WeightAnimationPropertyInfo:()=>R,getQuaternion:()=>L,getVector3:()=>f,getWeights:()=>e});var M=C(11708),x=C(11194),y=C(12826);function f(B,I,C,M){return x.HI.oI(I,C).scaleInPlace(M)}function L(B,I,C,M){return x.Quaternion.oI(I,C).scaleInPlace(M)}function e(B,I,C,M){const x=new Array(B._numMorphTargets);for(let y=0;y<x.length;y++)x[y]=I[C++]*M;return x}class g{constructor(B,I,C,M){this.type=B,this.name=I,this.getValue=C,this.getStride=M}_buildAnimation(B,I,C){const x=new M.c(B,this.name,I,this.type);return x.setKeys(C),x}}class N extends g{buildAnimations(B,I,C,M){const x=[];return x.push({babylonAnimatable:B._babylonTransformNode,babylonAnimation:this._buildAnimation(I,C,M)}),x}}class R extends g{buildAnimations(B,I,C,x){const y=[];if(B._numMorphTargets)for(let f=0;f<B._numMorphTargets;f++){const L=new M.c(`${I}_${f}`,this.name,C,this.type);if(L.setKeys(x.map((B=>({frame:B.frame,inTangent:B.inTangent?B.inTangent[f]:void 0,value:B.value[f],outTangent:B.outTangent?B.outTangent[f]:void 0,interpolation:B.interpolation})))),B._primitiveBabylonMeshes)for(const I of B._primitiveBabylonMeshes)if(I.morphTargetManager){const B=I.morphTargetManager.getTarget(f),C=L.clone();B.animations.push(C),y.push({babylonAnimatable:B,babylonAnimation:C})}}return y}}(0,y.k)("/nodes/{}/translation",[new N(M.c.ANIMATIONTYPE_VECTOR3,"position",f,(()=>3))]),(0,y.k)("/nodes/{}/rotation",[new N(M.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",L,(()=>4))]),(0,y.k)("/nodes/{}/scale",[new N(M.c.ANIMATIONTYPE_VECTOR3,"Xf",f,(()=>3))]),(0,y.k)("/nodes/{}/weights",[new R(M.c.ANIMATIONTYPE_FLOAT,"influence",e,(B=>B._numMorphTargets))])},12794:(B,I,C)=>{"use strict";class M{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((B,I)=>{this._resolve=B,this._reject=I}))}}var x=C(11194),y=C(11239),f=C(11018),L=C(11647),e=C(12800),g=C(12808),N=C(11022),R=C(11659),H=C(11708),F=C(11715),k=C(11056),q=C(11027),S=C(11029);class o{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(B){this._useTextureToStoreBoneMatrices=B,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(B){this._animationPropertiesOverride=B}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(B,I,C){this.name=B,this.id=I,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=x.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new N.e,this.bones=[],this._scene=C||k.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const M=this._scene.getEngine().getCaps();this._canUseTextureForBones=M.textureFloat&&M.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((B=>!B.getParent()))}getTransformMatrices(B){if(this.needInitialSkinMatrix){if(!B)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return B._bonesTransformMatrices||this.prepare(!0),B._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(B){return this.needInitialSkinMatrix&&B._transformMatrixTexture?B._transformMatrixTexture:this._transformMatrixTexture}rB(){return this._scene}toString(B){let I=`Name: ${this.name}, nBones: ${this.bones.length}`;if(I+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,B){I+=", Ranges: {";let B=!0;for(const C in this._ranges)B&&(I+=", ",B=!1),I+=C;I+="}"}return I}getBoneIndexByName(B){for(let I=0,C=this.bones.length;I<C;I++)if(this.bones[I].name===B)return I;return-1}createAnimationRange(B,I,C){if(!this._ranges[B]){this._ranges[B]=new F.b(B,I,C);for(let M=0,x=this.bones.length;M<x;M++)this.bones[M].animations[0]&&this.bones[M].animations[0].createRange(B,I,C)}}deleteAnimationRange(B){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let C=0,M=this.bones.length;C<M;C++)this.bones[C].animations[0]&&this.bones[C].animations[0].deleteRange(B,I);this._ranges[B]=null}getAnimationRange(B){return this._ranges[B]||null}getAnimationRanges(){const B=[];let I;for(I in this._ranges)B.push(this._ranges[I]);return B}copyAnimationRange(B,I){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[I]||!B.getAnimationRange(I))return!1;let M=!0;const x=this._getHighestAnimationFrame()+1,y={},f=B.bones;let L,e;for(e=0,L=f.length;e<L;e++)y[f[e].name]=f[e];this.bones.length!==f.length&&(q.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${f.length}`),M=!1);const g=C&&this.dimensionsAtRest&&B.dimensionsAtRest?this.dimensionsAtRest.divide(B.dimensionsAtRest):null;for(e=0,L=this.bones.length;e<L;e++){const B=this.bones[e].name,f=y[B];f?M=M&&this.bones[e].copyAnimationRange(f,I,x,C,g):(q.b.Warn("copyAnimationRange: not same rig, missing source bone "+B),M=!1)}const N=B.getAnimationRange(I);return N&&(this._ranges[I]=new F.b(I,N.from+x,N.to+x)),M}returnToRest(){for(const B of this.bones)-1!==B._index&&B.returnToRest()}_getHighestAnimationFrame(){let B=0;for(let I=0,C=this.bones.length;I<C;I++)if(this.bones[I].animations[0]){const C=this.bones[I].animations[0].getHighestFrame();B<C&&(B=C)}return B}beginAnimation(B,I,C,M){const x=this.getAnimationRange(B);return x?this._scene.beginAnimation(this,x.from,x.to,I,C,M):null}static MakeAnimationAdditive(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,C=arguments.length>2?arguments[2]:void 0;const M=B.getAnimationRange(C);if(!M)return null;const x=B._scene.getAllAnimatablesByTarget(B);let y=null;for(let L=0;L<x.length;L++){const B=x[L];if(B.fromFrame===(null===M||void 0===M?void 0:M.from)&&B.toFrame===(null===M||void 0===M?void 0:M.to)){y=B;break}}const f=B.getAnimatables();for(let L=0;L<f.length;L++){const B=f[L].animations;if(B)for(let M=0;M<B.length;M++)H.c.MakeAnimationAdditive(B[M],I,C)}return y&&(y.isAdditive=!0),B}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(B){this._meshesWithPoseMatrix.push(B)}_unregisterMeshWithPoseMatrix(B){const I=this._meshesWithPoseMatrix.indexOf(B);I>-1&&this._meshesWithPoseMatrix.splice(I,1)}_computeTransformMatrices(B,I){this.onBeforeComputeObservable.notifyObservers(this);for(let C=0;C<this.bones.length;C++){const M=this.bones[C];M._childUpdateId++;const x=M.getParent();if(x?M.getLocalMatrix().multiplyToRef(x.getFinalMatrix(),M.getFinalMatrix()):I?M.getLocalMatrix().multiplyToRef(I,M.getFinalMatrix()):M.getFinalMatrix().M(M.getLocalMatrix()),-1!==M._index){const I=null===M._index?C:M._index;M.getAbsoluteInverseBindMatrix().multiplyToArray(M.getFinalMatrix(),B,16*I)}}this._identity.copyToArray(B,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const B=this.rB().getRenderId();if(this._currentRenderId===B)return;this._currentRenderId=B}if(this._numBonesWithLinkedTransformNode>0)for(const B of this.bones)if(B._linkedTransformNode){const I=B._linkedTransformNode;B.position=I.position,I.rotationQuaternion?B.rotationQuaternion=I.rotationQuaternion:B.rotation=I.rotation,B.Xf=I.Xf}if(this.needInitialSkinMatrix)for(const B of this._meshesWithPoseMatrix){const I=B.getPoseMatrix();let C=this._isDirty;if(B._bonesTransformMatrices&&B._bonesTransformMatrices.length===16*(this.bones.length+1)||(B._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),C=!0),C){if(this._synchronizedWithMesh!==B){this._synchronizedWithMesh=B;for(const B of this.bones)if(!B.getParent()){B.getBindMatrix().multiplyToRef(I,x.TmpVectors.Matrix[1]),B._updateAbsoluteBindMatrices(x.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const I=4*(this.bones.length+1);B._transformMatrixTexture&&B._transformMatrixTexture.getSize().width===I||(B._transformMatrixTexture&&B._transformMatrixTexture.dispose(),B._transformMatrixTexture=R.e.CreateRGBATexture(B._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(B._bonesTransformMatrices,I),this.isUsingTextureForMatrices&&B._transformMatrixTexture&&B._transformMatrixTexture.update(B._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=R.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let B=0;B<this.bones.length;B++)this._animatables.push(this.bones[B])}return this._animatables}clone(B,I){const C=new o(B,I||B,this._scene);C.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let M=0;M<this.bones.length;M++){const B=this.bones[M];let I=null;const x=B.getParent();if(x){const B=this.bones.indexOf(x);I=C.bones[B]}const y=new g.e(B.name,C,I,B.getBindMatrix().clone(),B.getRestMatrix().clone());y._index=B._index,B._linkedTransformNode&&y.linkTransformNode(B._linkedTransformNode),S.d.DeepCopy(B.animations,y.animations)}if(this._ranges){C._ranges={};for(const B in this._ranges){const I=this._ranges[B];I&&(C._ranges[B]=I.clone())}}return this._isDirty=!0,C.prepare(!0),C}enableBlending(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const I of this.bones)for(const C of I.animations)C.enableBlending=!0,C.blendingSpeed=B}dispose(){if(this._meshesWithPoseMatrix.length=0,this.rB().stopAnimation(this),this.rB().removeSkeleton(this),this._parentContainer){const B=this._parentContainer.skeletons.indexOf(this);B>-1&&this._parentContainer.skeletons.splice(B,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const B={};B.name=this.name,B.id=this.id,this.dimensionsAtRest&&(B.dimensionsAtRest=this.dimensionsAtRest.Df()),B.bones=[],B.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let C=0;C<this.bones.length;C++){var I;const M=this.bones[C],x=M.getParent(),y={parentBoneIndex:x?this.bones.indexOf(x):-1,index:M.getIndex(),name:M.name,id:M.id,matrix:M.getBindMatrix().Df(),rest:M.getRestMatrix().Df(),linkedTransformNodeId:null===(I=M.getTransformNode())||void 0===I?void 0:I.id};B.bones.push(y),M.length&&(y.length=M.length),M.metadata&&(y.metadata=M.metadata),M.animations&&M.animations.length>0&&(y.animation=M.animations[0].serialize()),B.ranges=[];for(const I in this._ranges){const C=this._ranges[I];if(!C)continue;const M={};M.name=I,M.from=C.from,M.to=C.to,B.ranges.push(M)}}return B}static Parse(B,I){const C=new o(B.name,B.id,I);let M;for(B.dimensionsAtRest&&(C.dimensionsAtRest=x.HI.oI(B.dimensionsAtRest)),C.needInitialSkinMatrix=B.needInitialSkinMatrix,M=0;M<B.bones.length;M++){const I=B.bones[M],y=B.bones[M].index;let f=null;I.parentBoneIndex>-1&&(f=C.bones[I.parentBoneIndex]);const L=I.rest?x.Matrix.oI(I.rest):null,e=new g.e(I.name,C,f,x.Matrix.oI(I.matrix),L,null,y);void 0!==I.id&&null!==I.id&&(e.id=I.id),I.length&&(e.length=I.length),I.metadata&&(e.metadata=I.metadata),I.animation&&e.animations.push(H.c.Parse(I.animation)),void 0!==I.linkedTransformNodeId&&null!==I.linkedTransformNodeId&&(C._hasWaitingData=!0,e._waitingTransformNodeId=I.linkedTransformNodeId)}if(B.ranges)for(M=0;M<B.ranges.length;M++){const I=B.ranges[M];C.createAnimationRange(I.name,I.from,I.to)}return C}computeAbsoluteMatrices(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||B)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(B)}getPoseMatrix(){let B=null;return this._meshesWithPoseMatrix.length>0&&(B=this._meshesWithPoseMatrix[0].getPoseMatrix()),B}sortBones(){const B=[],I=new Array(this.bones.length);for(let C=0;C<this.bones.length;C++)this._sortBones(C,B,I);this.bones=B}_sortBones(B,I,C){if(C[B])return;C[B]=!0;const M=this.bones[B];if(!M)return;void 0===M._index&&(M._index=B);const x=M.getParent();x&&this._sortBones(this.bones.indexOf(x),I,C),I.push(M)}setCurrentPoseAsRest(){for(const B of this.bones)B.setCurrentPoseAsRest()}}var U=C(11516),G=C(11677),V=C(11171),c=C(11616),t=C(11270),r=C(11650),A=C(11625),D=C(11645),J=C(11720),i=C(11291),u=C(12766);class p{set areUpdatesFrozen(B){B?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new i.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,B||(B=k.c.LastCreatedScene),this._scene=B,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const B=this._scene.getEngine().getCaps();this._canUseTextureForTargets=B.canUseGLVertexID&&B.textureFloat&&B.maxVertexTextureImageUnits>0&&B.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return p.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?p.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(B){this._numMaxInfluencers!==B&&(this._numMaxInfluencers=B,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(B){this._useTextureToStoreTargets!==B&&(this._useTextureToStoreTargets=B,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var B;return p.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(B=this._scene)&&void 0!==B&&B.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(B){return this._activeTargets.data[B]}getTarget(B){return this._targets[B]}getTargetByName(B){for(const I of this._targets)if(I.name===B)return I;return null}addTarget(B){this._targets.push(B),this._targetInfluenceChangedObservers.push(B.onInfluenceChanged.add((B=>{this.areUpdatesFrozen&&B&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(B)}))),this._targetDataLayoutChangedObservers.push(B._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(B){const I=this._targets.indexOf(B);I>=0&&(this._targets.splice(I,1),B.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(I,1)[0]),B._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(I,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(B)}_bind(B){B.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),B.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),B.setTexture("morphTargets",this._targetStoreTexture),B.setInt("morphTargetCount",this.numInfluencers)}clone(){const B=new p(this._scene);for(const I of this._targets)B.addTarget(I.clone());return B.enablePositionMorphing=this.enablePositionMorphing,B.enableNormalMorphing=this.enableNormalMorphing,B.enableTangentMorphing=this.enableTangentMorphing,B.enableUVMorphing=this.enableUVMorphing,B.enableUV2Morphing=this.enableUV2Morphing,B.enableColorMorphing=this.enableColorMorphing,B}serialize(){const B={};B.id=this.uniqueId,B.targets=[];for(const I of this._targets)B.targets.push(I.serialize());return B}_syncActiveTargets(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const I=!!this._targetStoreTexture,C=this.isUsingTextureForTargets;(this._mustSynchronize||I!==C)&&(this._mustSynchronize=!1,this.synchronize());let M=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let x=-1;for(const y of this._targets)if(x++,0!==y.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=p.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(y),this._morphTargetTextureIndices[M]=x,this._tempInfluences[M++]=y.influence}this._morphTargetTextureIndices.length!==M&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,M)),this._influences&&this._influences.length===M||(this._influences=new Float32Array(M));for(let y=0;y<M;y++)this._influences[y]=this._tempInfluences[y];if(B&&this._scene)for(const y of this._scene.meshes)y.morphTargetManager===this&&(C?y._markSubMeshesAsAttributesDirty():y._syncGeometryWithMorphTargetManager())}synchronize(){var B;if(!this._scene||this.areUpdatesFrozen)return;const I=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(B=this._targetStoreTexture)||void 0===B||B.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>I.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const C of this._targets){this._supportsPositions=this._supportsPositions&&C.hasPositions,this._supportsNormals=this._supportsNormals&&C.hasNormals,this._supportsTangents=this._supportsTangents&&C.hasTangents,this._supportsUVs=this._supportsUVs&&C.hasUVs,this._supportsUV2s=this._supportsUV2s&&C.hasUV2s,this._supportsColors=this._supportsColors&&C.hasColors;const B=C.vertexCount;if(0===this._vertexCount)this._vertexCount=B;else if(this._vertexCount!==B)return void q.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${C.name}": ${B}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const B=I.getCaps().maxTextureSize;this._textureWidth>B&&(this._textureHeight=Math.ceil(this._textureWidth/B),this._textureWidth=B);const C=this._targets.length,M=new Float32Array(C*this._textureWidth*this._textureHeight*4);let x=0;for(let I=0;I<C;I++){const B=this._targets[I],C=B.getPositions(),y=B.getNormals(),f=B.getUVs(),L=B.getTangents(),e=B.getUV2s(),g=B.getColors();x=I*this._textureWidth*this._textureHeight*4;for(let I=0;I<this._vertexCount;I++)this._supportsPositions&&C&&(M[x]=C[3*I],M[x+1]=C[3*I+1],M[x+2]=C[3*I+2],x+=4),this._supportsNormals&&y&&(M[x]=y[3*I],M[x+1]=y[3*I+1],M[x+2]=y[3*I+2],x+=4),this._supportsUVs&&f&&(M[x]=f[2*I],M[x+1]=f[2*I+1],x+=4),this._supportsTangents&&L&&(M[x]=L[3*I],M[x+1]=L[3*I+1],M[x+2]=L[3*I+2],x+=4),this._supportsUV2s&&e&&(M[x]=e[2*I],M[x+1]=e[2*I+1],x+=4),this._supportsColors&&g&&(M[x]=g[4*I],M[x+1]=g[4*I+1],M[x+2]=g[4*I+2],M[x+3]=g[4*I+3],x+=4)}this._targetStoreTexture=u.e.CreateRGBATexture(M,this._textureWidth,this._textureHeight,C,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const C of this._scene.meshes)C.morphTargetManager===this&&C._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const B=this._parentContainer.morphTargetManagers.indexOf(this);B>-1&&this._parentContainer.morphTargetManagers.splice(B,1),this._parentContainer=null}for(const B of this._targets)this._scene.stopAnimation(B)}}static Parse(B,I){const C=new p(I);for(const M of B.targets)C.addTarget(J.b.Parse(M,I));return C}}p.EnableTextureStorage=!0,p.MaxActiveMorphTargetsInVertexAttributeMode=8,p.ConstantTargetCountForTextureMode=0;var n=C(12817),O=C(11062),a=C(11527);const W=new Map,d=W;function l(B,I,C){E(B)&&q.b.Warn(`Extension with the name '${B}' already exists`),W.set(B,{isGLTFExtension:I,factory:C})}function E(B){return W.delete(B)}var Q=C(12826),Z=C(11768),z=C(11284);class b{static Get(B,I,C){if(!I||void 0==C||!I[C])throw new Error(`${B}: Failed to find index (${C})`);return I[C]}static TryGet(B,I){return B&&void 0!=I&&B[I]?B[I]:null}static Assign(B){if(B)for(let I=0;I<B.length;I++)B[I].index=I}}function Y(B){if(B.min&&B.max){const I=B.min,C=B.max,M=x.TmpVectors.HI[0].vf(I[0],I[1],I[2]),y=x.TmpVectors.HI[1].vf(C[0],C[1],C[2]);if(B.normalized&&5126!==B.componentType){let I=1;switch(B.componentType){case 5120:I=127;break;case 5121:I=255;break;case 5122:I=32767;break;case 5123:I=65535}const C=1/I;M.scaleInPlace(C),y.scaleInPlace(C)}return new a.b(M,y)}return null}class v{static RegisterExtension(B,I){l(B,!1,I)}static UnregisterExtension(B){return E(B)}get qf(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(B){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=B}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((B=>B.dispose&&B.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(B,I,C,M,x,y){let f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=I,this._assetContainer=C,this._loadData(M);let y=null;if(B){const I={};if(this._gltf.nodes)for(const B of this._gltf.nodes)B.name&&(I[B.name]=B.index);y=(B instanceof Array?B:[B]).map((B=>{const C=I[B];if(void 0===C)throw new Error(`Failed to find node '${B}'`);return C}))}return await this._loadAsync(x,f,y,(()=>({meshes:this._getMeshes(),oH:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(B,I,C,M){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=B,this._loadData(I),await this._loadAsync(C,x,null,(()=>{}))}async _loadAsync(B,I,C,M){return await Promise.resolve().then((async()=>{this._rootUrl=B,this._uniqueRootUrl=!B.startsWith("file:")&&I?B:`${B}${Date.now()}/`,this._fileName=I,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const x=`${n.m[n.m.LOADING]} => ${n.m[n.m.READY]}`,y=`${n.m[n.m.LOADING]} => ${n.m[n.m.COMPLETE]}`;this._parent._startPerformanceCounter(x),this._parent._startPerformanceCounter(y),this._parent._setState(n.m.LOADING),this._extensionsOnLoading();const L=new Array;if(!this.parent.loadOnlyMaterials)if(C)L.push(this.loadSceneAsync("/nodes",{nodes:C,index:-1}));else if(void 0!=this._gltf.kI||this._gltf.scenes&&this._gltf.scenes[0]){const B=b.Get("/scene",this._gltf.scenes,this._gltf.kI||0);L.push(this.loadSceneAsync(`/scenes/${B.index}`,B))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let B=0;B<this._gltf.materials.length;++B){const I=this._gltf.materials[B],C="/materials/"+B,M=U.c.TriangleFillMode;L.push(this._loadMaterialAsync(C,I,null,M,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&L.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&L.push(this._compileShadowGeneratorsAsync());const e=Promise.all(L).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.YL(!0);for(const B of this._babylonScene.materials){const I=B;void 0!==I.maxSimultaneousLights&&(I.maxSimultaneousLights=Math.max(I.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(n.m.READY),this._skipStartAnimationStep||this._startAnimations(),M()}));return await e.then((B=>(this._parent._endPerformanceCounter(x),f.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(y),this._parent._setState(n.m.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(B=>{this._parent.onErrorObservable.notifyObservers(B),this._parent.onErrorObservable.clear(),this.dispose()}))})),B)))})).catch((B=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(B),this._parent.onErrorObservable.clear(),this.dispose()),B}))}_loadData(B){if(this._gltf=B.json,this._setupData(),B.bin){const I=this._gltf.buffers;if(I&&I[0]&&!I[0].uri){const C=I[0];(C.byteLength<B.bin.byteLength-3||C.byteLength>B.bin.byteLength)&&q.b.Warn(`Binary buffer length (${C.byteLength}) from JSON does not match chunk length (${B.bin.byteLength})`),this._bin=B.bin}else q.b.Warn("Unexpected BIN chunk")}}_setupData(){if(b.Assign(this._gltf.accessors),b.Assign(this._gltf.animations),b.Assign(this._gltf.buffers),b.Assign(this._gltf.bufferViews),b.Assign(this._gltf.cameras),b.Assign(this._gltf.images),b.Assign(this._gltf.materials),b.Assign(this._gltf.meshes),b.Assign(this._gltf.nodes),b.Assign(this._gltf.samplers),b.Assign(this._gltf.scenes),b.Assign(this._gltf.skins),b.Assign(this._gltf.textures),this._gltf.nodes){const B={};for(const C of this._gltf.nodes)if(C.children)for(const I of C.children)B[I]=C.index;const I=this._createRootNode();for(const C of this._gltf.nodes){const M=B[C.index];C.parent=void 0===M?I:this._gltf.nodes[M]}}}async _loadExtensionsAsync(){const B=[];if(d.forEach(((I,C)=>{var M;!1===(null===(M=this.parent.extensionOptions[C])||void 0===M?void 0:M.enabled)?I.isGLTFExtension&&this.isExtensionUsed(C)&&q.b.Warn(`Extension ${C} is used but has been explicitly disabled.`):I.isGLTFExtension&&!this.isExtensionUsed(C)||B.push((async()=>{const B=await I.factory(this);return B.name!==C&&q.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${B.name} !== ${C}`),this._parent.onExtensionLoadedObservable.notifyObservers(B),B})())})),this._extensions.push(...await Promise.all(B)),this._extensions.sort(((B,I)=>(B.order||Number.MAX_VALUE)-(I.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const C of this._gltf.extensionsRequired){if(!this._extensions.some((B=>B.name===C&&B.enabled))){var I;if(!1===(null===(I=this.parent.extensionOptions[C])||void 0===I?void 0:I.enabled))throw new Error(`Required extension ${C} is disabled`);throw new Error(`Required extension ${C} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new D.b("__root__",this._babylonScene);this._rootBabylonMesh=B,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.YL(!1);const I={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case n.i.AUTO:this._babylonScene.useRightHandedSystem||(I.rotation=[0,1,0,0],I.scale=[1,1,-1],v._LoadTransform(I,this._rootBabylonMesh));break;case n.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(B),I}loadSceneAsync(B,I){const C=this._extensionsLoadSceneAsync(B,I);if(C)return C;const M=new Array;if(this.logOpen(`${B} ${I.name||""}`),I.nodes)for(const x of I.nodes){const I=b.Get(`${B}/nodes/${x}`,this._gltf.nodes,x);M.push(this.loadNodeAsync(`/nodes/${I.index}`,I,(B=>{B.parent=this._rootBabylonMesh})))}for(const x of this._postSceneLoadActions)x();return M.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(M).then((()=>{}))}_forEachPrimitive(B,I){if(B._primitiveBabylonMeshes)for(const C of B._primitiveBabylonMeshes)I(C)}_getGeometries(){const B=[],I=this._gltf.nodes;if(I)for(const C of I)this._forEachPrimitive(C,(I=>{const C=I.zf;C&&-1===B.indexOf(C)&&B.push(C)}));return B}_getMeshes(){const B=[];this._rootBabylonMesh instanceof A.e&&B.push(this._rootBabylonMesh);const I=this._gltf.nodes;if(I)for(const C of I)this._forEachPrimitive(C,(I=>{B.push(I)}));return B}_getTransformNodes(){const B=[],I=this._gltf.nodes;if(I)for(const C of I)C._babylonTransformNode&&"Le"===C._babylonTransformNode.getClassName()&&B.push(C._babylonTransformNode),C._babylonTransformNodeForSkin&&B.push(C._babylonTransformNodeForSkin);return B}_getSkeletons(){const B=[],I=this._gltf.skins;if(I)for(const C of I)C._data&&B.push(C._data.babylonSkeleton);return B}_getAnimationGroups(){const B=[],I=this._gltf.animations;if(I)for(const C of I)C._babylonAnimationGroup&&B.push(C._babylonAnimationGroup);return B}_startAnimations(){switch(this._parent.animationStartMode){case n.e.NONE:break;case n.e.FIRST:{const B=this._getAnimationGroups();0!==B.length&&B[0].start(!0);break}case n.e.ALL:{const B=this._getAnimationGroups();for(const I of B)I.start(!0);break}default:return void q.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const M=this._extensionsLoadNodeAsync(B,I,C);if(M)return M;if(I._babylonTransformNode)throw new Error(`${B}: Invalid recursive node hierarchy`);const x=new Array;this.logOpen(`${B} ${I.name||""}`);const y=M=>{if(v.AddPointerMetadata(M,B),v._LoadTransform(I,M),void 0!=I.camera){const C=b.Get(`${B}/camera`,this._gltf.cameras,I.camera);x.push(this.loadCameraAsync(`/cameras/${C.index}`,C,(B=>{B.parent=M,this._babylonScene.useRightHandedSystem||(M.Xf.x=-1)})))}if(I.children)for(const C of I.children){const I=b.Get(`${B}/children/${C}`,this._gltf.nodes,C);x.push(this.loadNodeAsync(`/nodes/${I.index}`,I,(B=>{B.parent=M})))}C(M)},f=void 0!=I.mesh,L=this._parent.loadSkins&&void 0!=I.skin;if(!f||L){const B=I.name||`node${I.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new c.d(B,this._babylonScene);C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==I.mesh?I._babylonTransformNode=C:I._babylonTransformNodeForSkin=C,y(C)}if(f)if(L){const C=b.Get(`${B}/mesh`,this._gltf.meshes,I.mesh);x.push(this._loadMeshAsync(`/meshes/${C.index}`,I,C,(C=>{const M=I._babylonTransformNodeForSkin;C.metadata=(0,Z.c)(M.metadata,C.metadata||{});const y=b.Get(`${B}/skin`,this._gltf.skins,I.skin);x.push(this._loadSkinAsync(`/skins/${y.index}`,I,y,(B=>{this._forEachPrimitive(I,(I=>{I.skeleton=B})),this._postSceneLoadActions.push((()=>{if(void 0!=y.skeleton){const B=b.Get(`/skins/${y.index}/skeleton`,this._gltf.nodes,y.skeleton).parent;I.index===B.index?C.parent=M.parent:C.parent=B._babylonTransformNode}else C.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:M,skinnedNode:C})}))})))})))}else{const C=b.Get(`${B}/mesh`,this._gltf.meshes,I.mesh);x.push(this._loadMeshAsync(`/meshes/${C.index}`,I,C,y))}return this.logClose(),Promise.all(x).then((()=>(this._forEachPrimitive(I,(B=>{const I=B;!I.isAnInstance&&I.zf&&I.zf.useBoundingInfoFromGeometry?B.aB():B.refreshBoundingInfo(!0,!0)})),I._babylonTransformNode)))}_loadMeshAsync(B,I,C,M){const x=C.primitives;if(!x||!x.length)throw new Error(`${B}: Primitives are missing`);void 0==x[0].index&&b.Assign(x);const y=new Array;this.logOpen(`${B} ${C.name||""}`);const f=I.name||`node${I.index}`;if(1===x.length){const M=C.primitives[0];y.push(this._loadMeshPrimitiveAsync(`${B}/primitives/${M.index}`,f,I,C,M,(B=>{I._babylonTransformNode=B,I._primitiveBabylonMeshes=[B]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,I._babylonTransformNode=new c.d(f,this._babylonScene),I._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I._primitiveBabylonMeshes=[];for(const M of x)y.push(this._loadMeshPrimitiveAsync(`${B}/primitives/${M.index}`,`${f}_primitive${M.index}`,I,C,M,(B=>{B.parent=I._babylonTransformNode,I._primitiveBabylonMeshes.push(B)})))}return M(I._babylonTransformNode),this.logClose(),Promise.all(y).then((()=>I._babylonTransformNode))}_loadMeshPrimitiveAsync(B,I,C,M,x,y){const f=this._extensionsLoadMeshPrimitiveAsync(B,I,C,M,x,y);if(f)return f;this.logOpen(`${B}`);const L=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==C.skin&&!M.primitives[0].targets;let e,g;if(L&&x._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,e=x._instanceData.babylonSourceMesh.createInstance(I),e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g=x._instanceData.promise;else{const y=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new D.b(I,this._babylonScene);f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f.sideOrientation=this._babylonScene.useRightHandedSystem?U.c.CounterClockWiseSideOrientation:U.c.ClockWiseSideOrientation,this._createMorphTargets(B,C,M,x,f),y.push(this._loadVertexDataAsync(B,x,f).then((async I=>await this._loadMorphTargetsAsync(B,x,f,I).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,I.nB(f),I._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const N=v._GetDrawMode(B,x.mode);if(void 0==x.material){let B=this._defaultBabylonMaterialData[N];B||(B=this._createDefaultMaterial("__GLTFLoader._default",N),this._parent.onMaterialLoadedObservable.notifyObservers(B),this._defaultBabylonMaterialData[N]=B),f.material=B}else if(!this.parent.skipMaterials){const I=b.Get(`${B}/material`,this._gltf.materials,x.material);y.push(this._loadMaterialAsync(`/materials/${I.index}`,I,f,N,(B=>{f.material=B})))}g=Promise.all(y),L&&(x._instanceData={babylonSourceMesh:f,promise:g}),e=f}return v.AddPointerMetadata(e,B),this._parent.onMeshLoadedObservable.notifyObservers(e),y(e),this.logClose(),g.then((()=>e))}_loadVertexDataAsync(B,I,C){const M=this._extensionsLoadVertexDataAsync(B,I,C);if(M)return M;const x=I.attributes;if(!x)throw new Error(`${B}: Attributes are missing`);const y=new Array,f=new r.d(C.name,this._babylonScene);if(void 0==I.indices)C.isUnIndexed=!0;else{const C=b.Get(`${B}/indices`,this._gltf.accessors,I.indices);y.push(this._loadIndicesAccessorAsync(`/accessors/${C.index}`,C).then((B=>{f.setIndices(B)})))}const L=(I,M,L)=>{if(void 0==x[I])return;C._delayInfo=C._delayInfo||[],-1===C._delayInfo.indexOf(M)&&C._delayInfo.push(M);const e=b.Get(`${B}/attributes/${I}`,this._gltf.accessors,x[I]);y.push(this._loadVertexAccessorAsync(`/accessors/${e.index}`,e,M).then((B=>{if(B.getKind()===t.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!C.skeleton){const B=Y(e);B&&(f._boundingInfo=B,f.useBoundingInfoFromGeometry=!0)}f.setVerticesBuffer(B,e.count)}))),M==t.g.MatricesIndicesExtraKind&&(C.numBoneInfluencers=8),L&&L(e)};return L("POSITION",t.g.PositionKind),L("NORMAL",t.g.NormalKind),L("TANGENT",t.g.TangentKind),L("TEXCOORD_0",t.g.UVKind),L("TEXCOORD_1",t.g.UV2Kind),L("TEXCOORD_2",t.g.UV3Kind),L("TEXCOORD_3",t.g.UV4Kind),L("TEXCOORD_4",t.g.UV5Kind),L("TEXCOORD_5",t.g.UV6Kind),L("JOINTS_0",t.g.MatricesIndicesKind),L("WEIGHTS_0",t.g.MatricesWeightsKind),L("JOINTS_1",t.g.MatricesIndicesExtraKind),L("WEIGHTS_1",t.g.MatricesWeightsExtraKind),L("COLOR_0",t.g.ColorKind,(B=>{"VEC4"===B.type&&(C.hasVertexAlpha=!0)})),Promise.all(y).then((()=>f))}_createMorphTargets(B,I,C,M,x){if(!M.targets||!this._parent.loadMorphTargets)return;if(void 0==I._numMorphTargets)I._numMorphTargets=M.targets.length;else if(M.targets.length!==I._numMorphTargets)throw new Error(`${B}: Primitives do not have the same number of targets`);const y=C.extras?C.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,x.morphTargetManager=new p(this._babylonScene),x.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x.morphTargetManager.areUpdatesFrozen=!0;for(let f=0;f<M.targets.length;f++){const B=I.weights?I.weights[f]:C.weights?C.weights[f]:0,M=y?y[f]:`morphTarget${f}`;x.morphTargetManager.addTarget(new J.b(M,B,x.rB()))}}_loadMorphTargetsAsync(B,I,C,M){if(!I.targets||!this._parent.loadMorphTargets)return Promise.resolve();const x=new Array,y=C.morphTargetManager;for(let f=0;f<y.numTargets;f++){const C=y.getTarget(f);x.push(this._loadMorphTargetVertexDataAsync(`${B}/targets/${f}`,M,I.targets[f],C))}return Promise.all(x).then((()=>{y.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(B,I,C,M){const x=new Array,y=(M,y,f)=>{if(void 0==C[M])return;const L=I.getVertexBuffer(y);if(!L)return;const e=b.Get(`${B}/${M}`,this._gltf.accessors,C[M]);x.push(this._loadFloatAccessorAsync(`/accessors/${e.index}`,e).then((B=>{f(L,B)})))};return y("POSITION",t.g.PositionKind,((B,I)=>{const C=new Float32Array(I.length);B.forEach(I.length,((B,M)=>{C[M]=I[M]+B})),M.setPositions(C)})),y("NORMAL",t.g.NormalKind,((B,I)=>{const C=new Float32Array(I.length);B.forEach(C.length,((B,M)=>{C[M]=I[M]+B})),M.setNormals(C)})),y("TANGENT",t.g.TangentKind,((B,I)=>{const C=new Float32Array(I.length/3*4);let x=0;B.forEach(I.length/3*4,((B,M)=>{(M+1)%4!==0&&(C[x]=I[x]+B,x++)})),M.setTangents(C)})),y("TEXCOORD_0",t.g.UVKind,((B,I)=>{const C=new Float32Array(I.length);B.forEach(I.length,((B,M)=>{C[M]=I[M]+B})),M.setUVs(C)})),y("TEXCOORD_1",t.g.UV2Kind,((B,I)=>{const C=new Float32Array(I.length);B.forEach(I.length,((B,M)=>{C[M]=I[M]+B})),M.setUV2s(C)})),y("COLOR_0",t.g.ColorKind,((I,C)=>{let x=null;const y=I.getSize();if(3===y){x=new Float32Array(C.length/3*4),I.forEach(C.length,((B,I)=>{const M=Math.floor(I/3),y=I%3;x[4*M+y]=C[3*M+y]+B}));for(let B=0;B<C.length/3;++B)x[4*B+3]=1}else{if(4!==y)throw new Error(`${B}: Invalid number of components (${y}) for COLOR_0 attribute`);x=new Float32Array(C.length),I.forEach(C.length,((B,I)=>{x[I]=C[I]+B}))}M.setColors(x)})),await Promise.all(x).then((()=>{}))}static _LoadTransform(B,I){if(void 0!=B.skin)return;let C=x.HI.Zero(),M=x.Quaternion.Identity(),y=x.HI.One();if(B.matrix){x.Matrix.oI(B.matrix).decompose(y,M,C)}else B.translation&&(C=x.HI.oI(B.translation)),B.rotation&&(M=x.Quaternion.oI(B.rotation)),B.scale&&(y=x.HI.oI(B.scale));I.position=C,I.rotationQuaternion=M,I.Xf=y}_loadSkinAsync(B,I,C,M){if(!this._parent.loadSkins)return Promise.resolve();const x=this._extensionsLoadSkinAsync(B,I,C);if(x)return x;if(C._data)return M(C._data.babylonSkeleton),C._data.promise;const y=`skeleton${C.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new o(C.name||y,y,this._babylonScene);f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(B,C,f);const L=this._loadSkinInverseBindMatricesDataAsync(B,C).then((B=>{this._updateBoneMatrices(f,B)}));return C._data={babylonSkeleton:f,promise:L},M(f),L}_loadBones(B,I,C){if(void 0==I.skeleton||this._parent.alwaysComputeSkeletonRootNode){const C=this._findSkeletonRootNode(`${B}/joints`,I.joints);if(C)if(void 0===I.skeleton)I.skeleton=C.index;else{const M=(B,I)=>{for(;I.parent;I=I.parent)if(I.parent===B)return!0;return!1},x=b.Get(`${B}/skeleton`,this._gltf.nodes,I.skeleton);x===C||M(x,C)||(q.b.Warn(`${B}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),I.skeleton=C.index)}else q.b.Warn(`${B}: Failed to find common root`)}const M={};for(const x of I.joints){const y=b.Get(`${B}/joints/${x}`,this._gltf.nodes,x);this._loadBone(y,I,C,M)}}_findSkeletonRootNode(B,I){if(0===I.length)return null;const C={};for(const x of I){const I=[];let M=b.Get(`${B}/${x}`,this._gltf.nodes,x);for(;-1!==M.index;)I.unshift(M),M=M.parent;C[x]=I}let M=null;for(let x=0;;++x){let B=C[I[0]];if(x>=B.length)return M;const y=B[x];for(let f=1;f<I.length;++f)if(B=C[I[f]],x>=B.length||y!==B[x])return M;M=y}}_loadBone(B,I,C,M){B._isJoint=!0;let x=M[B.index];if(x)return x;let y=null;B.index!==I.skeleton&&(B.parent&&-1!==B.parent.index?y=this._loadBone(B.parent,I,C,M):void 0!==I.skeleton&&q.b.Warn(`/skins/${I.index}/skeleton: Skeleton node is not a common root`));const f=I.joints.indexOf(B.index);return x=new g.e(B.name||`joint${B.index}`,C,y,this._getNodeMatrix(B),null,null,f),M[B.index]=x,this._postSceneLoadActions.push((()=>{x.linkTransformNode(B._babylonTransformNode)})),x}_loadSkinInverseBindMatricesDataAsync(B,I){if(void 0==I.inverseBindMatrices)return Promise.resolve(null);const C=b.Get(`${B}/inverseBindMatrices`,this._gltf.accessors,I.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${C.index}`,C)}_updateBoneMatrices(B,I){for(const C of B.bones){const B=x.Matrix.Identity(),M=C._index;I&&-1!==M&&(x.Matrix.FromArrayToRef(I,16*M,B),B.invertToRef(B));const y=C.getParent();y&&B.multiplyToRef(y.getAbsoluteInverseBindMatrix(),B),C.pf(B,!1,!1),C._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(B){return B.matrix?x.Matrix.oI(B.matrix):x.Matrix.Compose(B.scale?x.HI.oI(B.scale):x.HI.One(),B.rotation?x.Quaternion.oI(B.rotation):x.Quaternion.Identity(),B.translation?x.HI.oI(B.translation):x.HI.Zero())}loadCameraAsync(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const M=this._extensionsLoadCameraAsync(B,I,C);if(M)return M;const y=new Array;this.logOpen(`${B} ${I.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const f=new e.c(I.name||`camera${I.index}`,x.HI.Zero(),this._babylonScene,!1);switch(f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I._babylonCamera=f,f.setTarget(new x.HI(0,0,-1)),I.type){case"perspective":{const C=I.perspective;if(!C)throw new Error(`${B}: Camera perspective properties are missing`);f.fov=C.yfov,f.uf=C.znear,f.maxZ=C.zfar||0;break}case"orthographic":if(!I.orthographic)throw new Error(`${B}: Camera orthographic properties are missing`);f.mode=L.e.ORTHOGRAPHIC_CAMERA,f.orthoLeft=-I.orthographic.xmag,f.orthoRight=I.orthographic.xmag,f.orthoBottom=-I.orthographic.ymag,f.orthoTop=I.orthographic.ymag,f.uf=I.orthographic.znear,f.maxZ=I.orthographic.zfar;break;default:throw new Error(`${B}: Invalid camera type (${I.type})`)}return v.AddPointerMetadata(f,B),this._parent.onCameraLoadedObservable.notifyObservers(f),C(f),this.logClose(),Promise.all(y).then((()=>f))}_loadAnimationsAsync(){const B=this._gltf.animations;if(!B)return Promise.resolve();const I=new Array;for(let C=0;C<B.length;C++){const M=B[C];I.push(this.loadAnimationAsync(`/animations/${M.index}`,M).then((B=>{0===B.targetedAnimations.length&&B.dispose()})))}return Promise.all(I).then((()=>{}))}loadAnimationAsync(B,I){const M=this._extensionsLoadAnimationAsync(B,I);return M||C.e(78).then(C.bind(C,14332)).then((C=>{let{AnimationGroup:M}=C;this._babylonScene._blockEntityCollection=!!this._assetContainer;const x=new M(I.name||`animation${I.index}`,this._babylonScene);x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I._babylonAnimationGroup=x;const y=new Array;b.Assign(I.channels),b.Assign(I.samplers);for(const f of I.channels)y.push(this._loadAnimationChannelAsync(`${B}/channels/${f.index}`,B,I,f,((B,I)=>{B.animations=B.animations||[],B.animations.push(I),x.addTargetedAnimation(I,B)})));return Promise.all(y).then((()=>(x.normalize(0),x)))}))}async _loadAnimationChannelAsync(B,I,M,x,y){const f=this._extensionsLoadAnimationChannelAsync(B,I,M,x,y);if(f)return await f;if(void 0==x.target.node)return await Promise.resolve();const L=b.Get(`${B}/target/node`,this._gltf.nodes,x.target.node),e=x.target.path,g="weights"===e;if(g&&!L._numMorphTargets||!g&&!L._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!g&&!L._isJoint)return await Promise.resolve();let N;switch(await Promise.resolve().then(C.bind(C,12838)),e){case"translation":var R;N=null===(R=(0,Q.d)("/nodes/{}/translation"))||void 0===R?void 0:R.interpolation;break;case"rotation":var H;N=null===(H=(0,Q.d)("/nodes/{}/rotation"))||void 0===H?void 0:H.interpolation;break;case"scale":var F;N=null===(F=(0,Q.d)("/nodes/{}/scale"))||void 0===F?void 0:F.interpolation;break;case"weights":var k;N=null===(k=(0,Q.d)("/nodes/{}/weights"))||void 0===k?void 0:k.interpolation;break;default:throw new Error(`${B}/target/path: Invalid value (${x.target.path})`)}if(!N)throw new Error(`${B}/target/path: Could not find interpolation properties for target path (${x.target.path})`);const q={object:L,info:N};return await this._loadAnimationChannelFromTargetInfoAsync(B,I,M,x,q,y)}_loadAnimationChannelFromTargetInfoAsync(B,I,C,M,x,y){const f=this.parent.targetFps,L=1/f,e=b.Get(`${B}/sampler`,C.samplers,M.sampler);return this._loadAnimationSamplerAsync(`${I}/samplers/${M.sampler}`,e).then((B=>{let I=0;const e=x.object,g=x.info;for(const x of g){const g=x.getStride(e),N=B.input,R=B.output,H=new Array(N.length);let F=0;switch(B.interpolation){case"STEP":for(let B=0;B<N.length;B++){const I=x.getValue(e,R,F,1);F+=g,H[B]={frame:N[B]*f,value:I,interpolation:1}}break;case"CUBICSPLINE":for(let B=0;B<N.length;B++){const I=x.getValue(e,R,F,L);F+=g;const C=x.getValue(e,R,F,1);F+=g;const M=x.getValue(e,R,F,L);F+=g,H[B]={frame:N[B]*f,inTangent:I,value:C,outTangent:M}}break;case"LINEAR":for(let B=0;B<N.length;B++){const I=x.getValue(e,R,F,1);F+=g,H[B]={frame:N[B]*f,value:I}}}if(F>0){const B=`${C.name||`animation${C.index}`}_channel${M.index}_${I}`,L=x.buildAnimations(e,B,f,H);for(const C of L)I++,y(C.babylonAnimatable,C.babylonAnimation)}}}))}_loadAnimationSamplerAsync(B,I){if(I._data)return I._data;const C=I.interpolation||"LINEAR";switch(C){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${B}/interpolation: Invalid value (${I.interpolation})`)}const M=b.Get(`${B}/input`,this._gltf.accessors,I.input),x=b.Get(`${B}/output`,this._gltf.accessors,I.output);return I._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${M.index}`,M),this._loadFloatAccessorAsync(`/accessors/${x.index}`,x)]).then((B=>{let[I,M]=B;return{input:I,interpolation:C,output:M}})),I._data}loadBufferAsync(B,I,C,M){const x=this._extensionsLoadBufferAsync(B,I,C,M);if(x)return x;if(!I._data)if(I.uri)I._data=this.loadUriAsync(`${B}/uri`,I,I.uri);else{if(!this._bin)throw new Error(`${B}: Uri is missing or the binary glTF is missing its binary chunk`);I._data=this._bin.readAsync(0,I.byteLength)}return I._data.then((I=>{try{return new Uint8Array(I.buffer,I.byteOffset+C,M)}catch(x){throw new Error(`${B}: ${x.message}`)}}))}loadBufferViewAsync(B,I){const C=this._extensionsLoadBufferViewAsync(B,I);if(C)return C;if(I._data)return I._data;const M=b.Get(`${B}/buffer`,this._gltf.buffers,I.buffer);return I._data=this.loadBufferAsync(`/buffers/${M.index}`,M,I.byteOffset||0,I.byteLength),I._data}_loadAccessorAsync(B,I,C){if(I._data)return I._data;const M=v._GetNumComponents(B,I.type),x=M*t.g.GetTypeByteLength(I.componentType),y=M*I.count;if(void 0==I.bufferView)I._data=Promise.resolve(new C(y));else{const f=b.Get(`${B}/bufferView`,this._gltf.bufferViews,I.bufferView);I._data=this.loadBufferViewAsync(`/bufferViews/${f.index}`,f).then((L=>{if(5126!==I.componentType||I.normalized||f.byteStride&&f.byteStride!==x){const B=new C(y);return t.g.ForEach(L,I.byteOffset||0,f.byteStride||x,M,I.componentType,B.length,I.normalized||!1,((I,C)=>{B[C]=I})),B}return v._GetTypedArray(B,I.componentType,L,I.byteOffset,y)}))}if(I.sparse){const y=I.sparse;I._data=I._data.then((f=>{const L=f,e=b.Get(`${B}/sparse/indices/bufferView`,this._gltf.bufferViews,y.indices.bufferView),g=b.Get(`${B}/sparse/values/bufferView`,this._gltf.bufferViews,y.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${e.index}`,e),this.loadBufferViewAsync(`/bufferViews/${g.index}`,g)]).then((f=>{let[e,g]=f;const N=v._GetTypedArray(`${B}/sparse/indices`,y.indices.componentType,e,y.indices.byteOffset,y.count),R=M*y.count;let H;if(5126!==I.componentType||I.normalized){const f=v._GetTypedArray(`${B}/sparse/values`,I.componentType,g,y.values.byteOffset,R);H=new C(R),t.g.ForEach(f,0,x,M,I.componentType,H.length,I.normalized||!1,((B,I)=>{H[I]=B}))}else H=v._GetTypedArray(`${B}/sparse/values`,I.componentType,g,y.values.byteOffset,R);let F=0;for(let B=0;B<N.length;B++){let I=N[B]*M;for(let B=0;B<M;B++)L[I++]=H[F++]}return L}))}))}return I._data}_loadFloatAccessorAsync(B,I){return this._loadAccessorAsync(B,I,Float32Array)}_loadIndicesAccessorAsync(B,I){if("SCALAR"!==I.type)throw new Error(`${B}/type: Invalid value ${I.type}`);if(5121!==I.componentType&&5123!==I.componentType&&5125!==I.componentType)throw new Error(`${B}/componentType: Invalid value ${I.componentType}`);if(I._data)return I._data;if(I.sparse){const C=v._GetTypedArrayConstructor(`${B}/componentType`,I.componentType);I._data=this._loadAccessorAsync(B,I,C)}else{const C=b.Get(`${B}/bufferView`,this._gltf.bufferViews,I.bufferView);I._data=this.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((C=>v._GetTypedArray(B,I.componentType,C,I.byteOffset,I.count)))}return I._data}_loadVertexBufferViewAsync(B){if(B._babylonBuffer)return B._babylonBuffer;const I=this._babylonScene.getEngine();return B._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${B.index}`,B).then((B=>new t.d(I,B,!1))),B._babylonBuffer}_loadVertexAccessorAsync(B,I,C){var M;if(null!==(M=I._babylonVertexBuffer)&&void 0!==M&&M[C])return I._babylonVertexBuffer[C];I._babylonVertexBuffer||(I._babylonVertexBuffer={});const x=this._babylonScene.getEngine();if(I.sparse||void 0==I.bufferView)I._babylonVertexBuffer[C]=this._loadFloatAccessorAsync(B,I).then((B=>new t.g(x,B,C,!1)));else{const M=b.Get(`${B}/bufferView`,this._gltf.bufferViews,I.bufferView);I._babylonVertexBuffer[C]=this._loadVertexBufferViewAsync(M).then((y=>{const f=v._GetNumComponents(B,I.type);return new t.g(x,y,C,!1,void 0,M.byteStride,void 0,I.byteOffset,f,I.componentType,I.normalized,!0,void 0,!0)}))}return I._babylonVertexBuffer[C]}_loadMaterialMetallicRoughnessPropertiesAsync(B,I,C){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);const M=new Array;return I&&(I.baseColorFactor?(C.albedoColor=y.SI.oI(I.baseColorFactor),C.alpha=I.baseColorFactor[3]):C.albedoColor=y.SI.White(),C.metallic=void 0==I.metallicFactor?1:I.metallicFactor,C.roughness=void 0==I.roughnessFactor?1:I.roughnessFactor,I.baseColorTexture&&M.push(this.loadTextureInfoAsync(`${B}/baseColorTexture`,I.baseColorTexture,(B=>{B.name=`${C.name} (Base Color)`,C.albedoTexture=B}))),I.metallicRoughnessTexture&&(I.metallicRoughnessTexture.nonColorData=!0,M.push(this.loadTextureInfoAsync(`${B}/metallicRoughnessTexture`,I.metallicRoughnessTexture,(B=>{B.name=`${C.name} (Metallic Roughness)`,C.metallicTexture=B}))),C.useMetallnessFromMetallicTextureBlue=!0,C.useRoughnessFromMetallicTextureGreen=!0,C.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(M).then((()=>{}))}_loadMaterialAsync(B,I,C,M){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const y=this._extensionsLoadMaterialAsync(B,I,C,M,x);if(y)return y;I._data=I._data||{};let f=I._data[M];if(!f){this.logOpen(`${B} ${I.name||""}`);const C=this.createMaterial(B,I,M);f={babylonMaterial:C,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(B,I,C)},I._data[M]=f,v.AddPointerMetadata(C,B),this._parent.onMaterialLoadedObservable.notifyObservers(C),this.logClose()}return C&&(f.babylonMeshes.push(C),C.If.addOnce((()=>{const B=f.babylonMeshes.indexOf(C);-1!==B&&f.babylonMeshes.splice(B,1)}))),x(f.babylonMaterial),f.promise.then((()=>f.babylonMaterial))}_createDefaultMaterial(B,I){this._babylonScene._blockEntityCollection=!!this._assetContainer;const C=new G.c(B,this._babylonScene);return C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.fillMode=I,C.enableSpecularAntiAliasing=!0,C.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,C.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,C.transparencyMode=G.c.PBRMATERIAL_OPAQUE,C.metallic=1,C.roughness=1,C}createMaterial(B,I,C){const M=this._extensionsCreateMaterial(B,I,C);if(M)return M;const x=I.name||`material${I.index}`;return this._createDefaultMaterial(x,C)}loadMaterialPropertiesAsync(B,I,C){const M=this._extensionsLoadMaterialPropertiesAsync(B,I,C);if(M)return M;const x=new Array;return x.push(this.loadMaterialBasePropertiesAsync(B,I,C)),I.pbrMetallicRoughness&&x.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${B}/pbrMetallicRoughness`,I.pbrMetallicRoughness,C)),this.loadMaterialAlphaProperties(B,I,C),Promise.all(x).then((()=>{}))}loadMaterialBasePropertiesAsync(B,I,C){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);const M=new Array;return C.emissiveColor=I.emissiveFactor?y.SI.oI(I.emissiveFactor):new y.SI(0,0,0),I.doubleSided&&(C.Yf=!1,C.twoSidedLighting=!0),I.normalTexture&&(I.normalTexture.nonColorData=!0,M.push(this.loadTextureInfoAsync(`${B}/normalTexture`,I.normalTexture,(B=>{B.name=`${C.name} (Normal)`,C.bumpTexture=B}))),C.invertNormalMapX=!this._babylonScene.useRightHandedSystem,C.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=I.normalTexture.scale&&C.bumpTexture&&(C.bumpTexture.level=I.normalTexture.scale),C.forceIrradianceInFragment=!0),I.occlusionTexture&&(I.occlusionTexture.nonColorData=!0,M.push(this.loadTextureInfoAsync(`${B}/occlusionTexture`,I.occlusionTexture,(B=>{B.name=`${C.name} (Occlusion)`,C.ambientTexture=B}))),C.useAmbientInGrayScale=!0,void 0!=I.occlusionTexture.strength&&(C.ambientTextureStrength=I.occlusionTexture.strength)),I.emissiveTexture&&M.push(this.loadTextureInfoAsync(`${B}/emissiveTexture`,I.emissiveTexture,(B=>{B.name=`${C.name} (Emissive)`,C.emissiveTexture=B}))),Promise.all(M).then((()=>{}))}loadMaterialAlphaProperties(B,I,C){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);switch(I.alphaMode||"OPAQUE"){case"OPAQUE":C.transparencyMode=G.c.PBRMATERIAL_OPAQUE,C.alpha=1;break;case"MASK":C.transparencyMode=G.c.PBRMATERIAL_ALPHATEST,C.alphaCutOff=void 0==I.alphaCutoff?.5:I.alphaCutoff,C.albedoTexture&&(C.albedoTexture.if=!0);break;case"BLEND":C.transparencyMode=G.c.PBRMATERIAL_ALPHABLEND,C.albedoTexture&&(C.albedoTexture.if=!0,C.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${B}/alphaMode: Invalid value (${I.alphaMode})`)}}loadTextureInfoAsync(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const M=this._extensionsLoadTextureInfoAsync(B,I,C);if(M)return M;if(this.logOpen(`${B}`),I.texCoord>=6)throw new Error(`${B}/texCoord: Invalid value (${I.texCoord})`);const x=b.Get(`${B}/index`,this._gltf.textures,I.index);x._textureInfo=I;const y=this._loadTextureAsync(`/textures/${I.index}`,x,(M=>{M.coordinatesIndex=I.texCoord||0,v.AddPointerMetadata(M,B),this._parent.onTextureLoadedObservable.notifyObservers(M),C(M)}));return this.logClose(),y}_loadTextureAsync(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const M=this._extensionsLoadTextureAsync(B,I,C);if(M)return M;this.logOpen(`${B} ${I.name||""}`);const x=void 0==I.sampler?v.DefaultSampler:b.Get(`${B}/sampler`,this._gltf.samplers,I.sampler),y=b.Get(`${B}/source`,this._gltf.images,I.source),f=this._createTextureAsync(B,x,y,C,void 0,!I._textureInfo.nonColorData);return this.logClose(),f}_createTextureAsync(B,I,C){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},y=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0;const L=this._loadSampler(`/samplers/${I.index}`,I),e=new Array,g=new M;this._babylonScene._blockEntityCollection=!!this._assetContainer;const N={noMipmap:L.noMipMaps,invertY:!1,samplingMode:L.samplingMode,h:()=>{this._disposed||g.resolve()},onError:(I,C)=>{this._disposed||g.reject(new Error(`${B}: ${C&&C.message?C.message:I||"Failed to load texture"}`))},mimeType:C.mimeType??(0,O.j)(C.uri??""),loaderOptions:y,useSRGBBuffer:!!f&&this._parent.useSRGBBuffers},R=new V.c(null,this._babylonScene,N);return R._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e.push(g.promise),e.push(this.loadImageAsync(`/images/${C.index}`,C).then((B=>{const I=C.uri||`${this._fileName}#image${C.index}`,M=`data:${this._uniqueRootUrl}${I}`;R.updateURL(M,B);const x=R.getInternalTexture();x&&(x.label=C.name)}))),R.wrapU=L.wrapU,R.wrapV=L.wrapV,x(R),this._parent.useGltfTextureNames&&(R.name=C.name||C.uri||`image${C.index}`),Promise.all(e).then((()=>R))}_loadSampler(B,I){return I._data||(I._data={noMipMaps:9728===I.minFilter||9729===I.minFilter,samplingMode:v._GetTextureSamplingMode(B,I),wrapU:v._GetTextureWrapMode(`${B}/wrapS`,I.wrapS),wrapV:v._GetTextureWrapMode(`${B}/wrapT`,I.wrapT)}),I._data}loadImageAsync(B,I){if(!I._data){if(this.logOpen(`${B} ${I.name||""}`),I.uri)I._data=this.loadUriAsync(`${B}/uri`,I,I.uri);else{const C=b.Get(`${B}/bufferView`,this._gltf.bufferViews,I.bufferView);I._data=this.loadBufferViewAsync(`/bufferViews/${C.index}`,C)}this.logClose()}return I._data}loadUriAsync(B,I,C){const M=this._extensionsLoadUriAsync(B,I,C);if(M)return M;if(!v._ValidateUri(C))throw new Error(`${B}: '${C}' is invalid`);if((0,O.k)(C)){const I=new Uint8Array((0,O.c)(C));return this.log(`${B}: Decoded ${C.substring(0,64)}... (${I.length} bytes)`),Promise.resolve(I)}return this.log(`${B}: Loading ${C}`),this._parent.preprocessUrlAsync(this._rootUrl+C).then((I=>new Promise(((M,x)=>{this._parent._loadFile(this._babylonScene,I,(I=>{this._disposed||(this.log(`${B}: Loaded ${C} (${I.byteLength} bytes)`),M(new Uint8Array(I)))}),!0,(I=>{x(new O.l(`${B}: Failed to load '${C}'${I?": "+I.status+" "+I.statusText:""}`,I))}))}))))}static AddPointerMetadata(B,I){B.metadata=B.metadata||{};const C=B._internalMetadata=B._internalMetadata||{},M=C.qf=C.qf||{};(M.pointers=M.pointers||[]).push(I)}static _GetTextureWrapMode(B,I){switch(I=void 0==I?10497:I){case 33071:return V.c.CLAMP_ADDRESSMODE;case 33648:return V.c.MIRROR_ADDRESSMODE;case 10497:return V.c.WRAP_ADDRESSMODE;default:return q.b.Warn(`${B}: Invalid value (${I})`),V.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(B,I){const C=void 0==I.magFilter?9729:I.magFilter,M=void 0==I.minFilter?9987:I.minFilter;if(9729===C)switch(M){case 9728:return V.c.LINEAR_NEAREST;case 9729:return V.c.LINEAR_LINEAR;case 9984:return V.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return V.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return V.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return V.c.LINEAR_LINEAR_MIPLINEAR;default:return q.b.Warn(`${B}/minFilter: Invalid value (${M})`),V.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==C&&q.b.Warn(`${B}/magFilter: Invalid value (${C})`),M){case 9728:return V.c.NEAREST_NEAREST;case 9729:return V.c.NEAREST_LINEAR;case 9984:return V.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return V.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return V.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return V.c.NEAREST_LINEAR_MIPLINEAR;default:return q.b.Warn(`${B}/minFilter: Invalid value (${M})`),V.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(B,I){try{return(0,z.n)(I)}catch(C){throw new Error(`${B}: ${C.message}`)}}static _GetTypedArray(B,I,C,M,x){const y=C.buffer;M=C.byteOffset+(M||0);const f=v._GetTypedArrayConstructor(`${B}/componentType`,I),L=t.g.GetTypeByteLength(I);return M%L!==0?(q.b.Warn(`${B}: Copying buffer as byte offset (${M}) is not a multiple of component type byte length (${L})`),new f(y.slice(M,M+x*L),0)):new f(y,M,x)}static _GetNumComponents(B,I){switch(I){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${B}: Invalid type (${I})`)}static _ValidateUri(B){return f.Tools.IsBase64(B)||-1===B.indexOf("..")}static _GetDrawMode(B,I){switch(void 0==I&&(I=4),I){case 0:return U.c.PointListDrawMode;case 1:return U.c.LineListDrawMode;case 2:return U.c.LineLoopDrawMode;case 3:return U.c.LineStripDrawMode;case 4:return U.c.TriangleFillMode;case 5:return U.c.TriangleStripDrawMode;case 6:return U.c.TriangleFanDrawMode}throw new Error(`${B}: Invalid mesh primitive mode (${I})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const B=new Array;if(this._gltf.materials)for(const I of this._gltf.materials)if(I._data)for(const C in I._data){const M=I._data[C];for(const I of M.babylonMeshes){I.nf(!0);const C=M.babylonMaterial;B.push(C.forceCompilationAsync(I)),B.push(C.forceCompilationAsync(I,{useInstances:!0})),this._parent.useClipPlane&&(B.push(C.forceCompilationAsync(I,{clipPlane:!0})),B.push(C.forceCompilationAsync(I,{clipPlane:!0,useInstances:!0})))}}return Promise.all(B).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const B=new Array,I=this._babylonScene.lights;for(const C of I){const I=C.getShadowGenerator();I&&B.push(I.forceCompilationAsync())}return Promise.all(B).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(B){for(const I of this._extensions)I.enabled&&B(I)}_applyExtensions(B,I,C){for(const M of this._extensions)if(M.enabled){const x=`${M.name}.${I}`,y=B;y._activeLoaderExtensionFunctions=y._activeLoaderExtensionFunctions||{};const f=y._activeLoaderExtensionFunctions;if(!f[x]){f[x]=!0;try{const B=C(M);if(B)return B}finally{delete f[x]}}}return null}_extensionsOnLoading(){this._forEachExtensions((B=>B.onLoading&&B.onLoading()))}_extensionsOnReady(){this._forEachExtensions((B=>B.onReady&&B.onReady()))}_extensionsLoadSceneAsync(B,I){return this._applyExtensions(I,"loadScene",(C=>C.loadSceneAsync&&C.loadSceneAsync(B,I)))}_extensionsLoadNodeAsync(B,I,C){return this._applyExtensions(I,"loadNode",(M=>M.loadNodeAsync&&M.loadNodeAsync(B,I,C)))}_extensionsLoadCameraAsync(B,I,C){return this._applyExtensions(I,"loadCamera",(M=>M.loadCameraAsync&&M.loadCameraAsync(B,I,C)))}_extensionsLoadVertexDataAsync(B,I,C){return this._applyExtensions(I,"loadVertexData",(M=>M._loadVertexDataAsync&&M._loadVertexDataAsync(B,I,C)))}_extensionsLoadMeshPrimitiveAsync(B,I,C,M,x,y){return this._applyExtensions(x,"loadMeshPrimitive",(f=>f._loadMeshPrimitiveAsync&&f._loadMeshPrimitiveAsync(B,I,C,M,x,y)))}_extensionsLoadMaterialAsync(B,I,C,M,x){return this._applyExtensions(I,"loadMaterial",(y=>y._loadMaterialAsync&&y._loadMaterialAsync(B,I,C,M,x)))}_extensionsCreateMaterial(B,I,C){return this._applyExtensions(I,"createMaterial",(M=>M.createMaterial&&M.createMaterial(B,I,C)))}_extensionsLoadMaterialPropertiesAsync(B,I,C){return this._applyExtensions(I,"loadMaterialProperties",(M=>M.loadMaterialPropertiesAsync&&M.loadMaterialPropertiesAsync(B,I,C)))}_extensionsLoadTextureInfoAsync(B,I,C){return this._applyExtensions(I,"loadTextureInfo",(M=>M.loadTextureInfoAsync&&M.loadTextureInfoAsync(B,I,C)))}_extensionsLoadTextureAsync(B,I,C){return this._applyExtensions(I,"loadTexture",(M=>M._loadTextureAsync&&M._loadTextureAsync(B,I,C)))}_extensionsLoadAnimationAsync(B,I){return this._applyExtensions(I,"loadAnimation",(C=>C.loadAnimationAsync&&C.loadAnimationAsync(B,I)))}_extensionsLoadAnimationChannelAsync(B,I,C,M,x){return this._applyExtensions(C,"loadAnimationChannel",(y=>y._loadAnimationChannelAsync&&y._loadAnimationChannelAsync(B,I,C,M,x)))}_extensionsLoadSkinAsync(B,I,C){return this._applyExtensions(C,"loadSkin",(M=>M._loadSkinAsync&&M._loadSkinAsync(B,I,C)))}_extensionsLoadUriAsync(B,I,C){return this._applyExtensions(I,"loadUri",(M=>M._loadUriAsync&&M._loadUriAsync(B,I,C)))}_extensionsLoadBufferViewAsync(B,I){return this._applyExtensions(I,"loadBufferView",(C=>C.loadBufferViewAsync&&C.loadBufferViewAsync(B,I)))}_extensionsLoadBufferAsync(B,I,C,M){return this._applyExtensions(I,"loadBuffer",(x=>x.loadBufferAsync&&x.loadBufferAsync(B,I,C,M)))}static LoadExtensionAsync(B,I,C,M){if(!I.extensions)return null;const x=I.extensions[C];return x?M(`${B}/extensions/${C}`,x):null}static LoadExtraAsync(B,I,C,M){if(!I.extras)return null;const x=I.extras[C];return x?M(`${B}/extras/${C}`,x):null}isExtensionUsed(B){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(B)}logOpen(B){this._parent._logOpen(B)}logClose(){this._parent._logClose()}log(B){this._parent._log(B)}startPerformanceCounter(B){this._parent._startPerformanceCounter(B)}endPerformanceCounter(B){this._parent._endPerformanceCounter(B)}}v.DefaultSampler={index:-1},n.b._CreateGLTF2Loader=B=>new v(B);var s=C(12838),X=C(11383),T=C(11226),P=C(12844),h=C(12852);class j extends h.c{constructor(B,I,C){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],L=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",B),this._texture=B.getEngine().createRawCubeTexture(I,C,M,x,y,f,L,e)}update(B,I,C,M){let x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,B,I,C,M,x)}updateRGBDAsync(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,P.o)(this._texture,B,I,C,M).then((()=>{}))}clone(){return T.d.Clone((()=>{const B=this.rB(),I=this._texture,C=new j(B,I._bufferViewArray,I.width,I.format,I.type,I.generateMipMaps,I.invertY,I.samplingMode,I._compression);return 13===I.source&&C.updateRGBDAsync(I._bufferViewArrayArray,I._sphericalPolynomial,I._lodGenerationScale,I._lodGenerationOffset),C}),this)}}const w="EXT_lights_image_based";class K{constructor(B){this.name=w,this._loader=B,this.enabled=this._loader.isExtensionUsed(w)}dispose(){this._loader=null,delete this._lights}onLoading(){const B=this._loader.qf.extensions;if(B&&B[this.name]){const I=B[this.name];this._lights=I.lights}}loadSceneAsync(B,I){return v.LoadExtensionAsync(B,I,this.name,(async(C,M)=>{this._loader._allMaterialsDirtyRequired=!0;const x=new Array;x.push(this._loader.loadSceneAsync(B,I)),this._loader.logOpen(`${C}`);const y=b.Get(`${C}/light`,this._lights,M.nx);return x.push(this._loadLightAsync(`/extensions/${this.name}/lights/${M.nx}`,y).then((B=>{this._loader.babylonScene.environmentTexture=B}))),this._loader.logClose(),await Promise.all(x).then((()=>{}))}))}_loadLightAsync(B,I){if(!I._loaded){const C=new Array;this._loader.logOpen(`${B}`);const M=new Array(I.specularImages.length);for(let x=0;x<I.specularImages.length;x++){const y=I.specularImages[x];M[x]=new Array(y.length);for(let I=0;I<y.length;I++){const f=`${B}/specularImages/${x}/${I}`;this._loader.logOpen(`${f}`);const L=y[I],e=b.Get(f,this._loader.qf.images,L);C.push(this._loader.loadImageAsync(`/images/${L}`,e).then((B=>{M[x][I]=B}))),this._loader.logClose()}}this._loader.logClose(),I._loaded=Promise.all(C).then((async()=>{const C=new j(this._loader.babylonScene,null,I.specularImageSize);if(C.name=I.name||"environment",I._babylonTexture=C,void 0!=I.AL&&(C.level=I.AL),I.rotation){let B=x.Quaternion.oI(I.rotation);this._loader.babylonScene.useRightHandedSystem||(B=x.Quaternion.Inverse(B)),x.Matrix.FromQuaternionToRef(B,C.getReflectionTextureMatrix())}if(!I.irradianceCoefficients)throw new Error(`${B}: Irradiance coefficients are missing`);const y=X.c.oI(I.irradianceCoefficients);y.scaleInPlace(I.AL),y.convertIrradianceToLambertianRadiance();const f=X.f.FromHarmonics(y),L=(M.length-1)/Math.log2(I.specularImageSize);return await C.updateRGBDAsync(M,f,L)}))}return I._loaded.then((()=>I._babylonTexture))}}E(w),l(w,!0,(B=>new K(B)));C(11743);const m="EXT_mesh_gpu_instancing";class BB{constructor(B){this.name=m,this._loader=B,this.enabled=this._loader.isExtensionUsed(m)}dispose(){this._loader=null}loadNodeAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(B,M)=>{this._loader._disableInstancedMesh++;const y=this._loader.loadNodeAsync(`/nodes/${I.index}`,I,C);if(this._loader._disableInstancedMesh--,!I._primitiveBabylonMeshes)return await y;const f=new Array;let L=0;const e=I=>{if(void 0==M.attributes[I])return void f.push(Promise.resolve(null));const C=b.Get(`${B}/attributes/${I}`,this._loader.qf.accessors,M.attributes[I]);if(f.push(this._loader._loadFloatAccessorAsync(`/accessors/${C.bufferView}`,C)),0===L)L=C.count;else if(L!==C.count)throw new Error(`${B}/attributes: Instance buffer accessors do not have the same count.`)};return e("TRANSLATION"),e("ROTATION"),e("SCALE"),await y.then((async B=>{const[C,M,y]=await Promise.all(f),e=new Float32Array(16*L);x.TmpVectors.HI[0].vf(0,0,0),x.TmpVectors.Quaternion[0].vf(0,0,0,1),x.TmpVectors.HI[1].vf(1,1,1);for(let I=0;I<L;++I)C&&x.HI.FromArrayToRef(C,3*I,x.TmpVectors.HI[0]),M&&x.Quaternion.FromArrayToRef(M,4*I,x.TmpVectors.Quaternion[0]),y&&x.HI.FromArrayToRef(y,3*I,x.TmpVectors.HI[1]),x.Matrix.ComposeToRef(x.TmpVectors.HI[1],x.TmpVectors.Quaternion[0],x.TmpVectors.HI[0],x.TmpVectors.Matrix[0]),x.TmpVectors.Matrix[0].copyToArray(e,16*I);for(const x of I._primitiveBabylonMeshes)x.QR("matrix",e,16,!0);return B}))}))}}E(m),l(m,!0,(B=>new BB(B)));let IB=0,CB=null;class MB{static get Default(){return MB._Default||(MB._Default=new MB),MB._Default}constructor(){const B=MB.Configuration.decoder;this._decoderModulePromise=f.Tools.LoadBabylonScriptAsync(B.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(B,I,C,M,x){await this._decoderModulePromise,0===IB&&(MeshoptDecoder.useWorkers(1),IB=1);const y=await MeshoptDecoder.decodeGltfBufferAsync(I,C,B,M,x);return null!==CB&&clearTimeout(CB),CB=setTimeout((()=>{MeshoptDecoder.useWorkers(0),IB=0,CB=null}),1e3),y}}MB.Configuration={decoder:{url:`${f.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},MB._Default=null;const xB="EXT_meshopt_compression";class yB{constructor(B){this.name=xB,this.enabled=B.isExtensionUsed(xB),this._loader=B}dispose(){this._loader=null}loadBufferViewAsync(B,I){return v.LoadExtensionAsync(B,I,this.name,(async(C,M)=>{const x=I;if(x._meshOptData)return await x._meshOptData;const y=b.Get(`${B}/buffer`,this._loader.qf.buffers,M.buffer);return x._meshOptData=this._loader.loadBufferAsync(`/buffers/${y.index}`,y,M.byteOffset||0,M.byteLength).then((async B=>await MB.Default.decodeGltfBufferAsync(B,M.count,M.byteStride,M.mode,M.filter))),await x._meshOptData}))}}E(xB),l(xB,!0,(B=>new yB(B)));const fB="EXT_texture_webp";class LB{constructor(B){this.name=fB,this._loader=B,this.enabled=B.isExtensionUsed(fB)}dispose(){this._loader=null}_loadTextureAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>{const y=void 0==I.sampler?v.DefaultSampler:b.Get(`${B}/sampler`,this._loader.qf.samplers,I.sampler),f=b.Get(`${M}/source`,this._loader.qf.images,x.source);return await this._loader._createTextureAsync(B,y,f,(B=>{C(B)}),void 0,!I._textureInfo.nonColorData)}))}}E(fB),l(fB,!0,(B=>new LB(B)));const eB="EXT_texture_avif";class gB{constructor(B){this.name=eB,this._loader=B,this.enabled=B.isExtensionUsed(eB)}dispose(){this._loader=null}_loadTextureAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>{const y=void 0==I.sampler?v.DefaultSampler:b.Get(`${B}/sampler`,this._loader.qf.samplers,I.sampler),f=b.Get(`${M}/source`,this._loader.qf.images,x.source);return await this._loader._createTextureAsync(B,y,f,(B=>{C(B)}),void 0,!I._textureInfo.nonColorData)}))}}E(eB),l(eB,!0,(B=>new gB(B)));var NB=C(12833),RB=C(11725);const HB="EXT_lights_ies";class FB{constructor(B){this.name=HB,this._loader=B,this.enabled=this._loader.isExtensionUsed(HB)}dispose(){this._loader=null,delete this._lights}onLoading(){const B=this._loader.qf.extensions;if(B&&B[this.name]){const I=B[this.name];this._lights=I.lights,b.Assign(this._lights)}}loadNodeAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,f)=>{let L,e;this._loader._allMaterialsDirtyRequired=!0;const g=await this._loader.loadNodeAsync(B,I,(B=>{e=b.Get(M,this._lights,f.nx);const I=e.name||B.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,L=new NB.b(I,x.HI.Zero(),x.HI.Backward(),0,1,this._loader.babylonScene),L.angle=Math.PI/2,L.innerAngle=0,L._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,e._babylonLight=L,L.falloffType=RB.c.FALLOFF_GLTF,L.DL=f.color?y.SI.oI(f.color):y.SI.White(),L.AL=f.multiplier||1,L.range=Number.MAX_VALUE,L.parent=B,this._loader._babylonLights.push(L),v.AddPointerMetadata(L,M),C(B)}));let N;if(e.uri)N=await this._loader.loadUriAsync(B,e,e.uri);else{const I=b.Get(`${B}/bufferView`,this._loader.qf.bufferViews,e.bufferView);N=await this._loader.loadBufferViewAsync(`/bufferViews/${I.index}`,I)}return L.iesProfileTexture=new V.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,N,!0,void 0,void 0,void 0,void 0,".ies"),g}))}}E(HB),l(HB,!0,(B=>new FB(B)));var kB=C(12867);const qB="KHR_draco_mesh_compression";class SB{constructor(B){this.name=qB,this.useNormalizedFlagFromAccessor=!0,this._loader=B,this.enabled=kB.c.DefaultAvailable&&this._loader.isExtensionUsed(qB)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>{if(void 0!=I.mode&&4!==I.mode&&5!==I.mode)throw new Error(`${B}: Unsupported mode ${I.mode}`);const y={},f={},L=(B,M)=>{const L=x.attributes[B];if(void 0!=L&&(C._delayInfo=C._delayInfo||[],-1===C._delayInfo.indexOf(M)&&C._delayInfo.push(M),y[M]=L,this.useNormalizedFlagFromAccessor)){const C=b.TryGet(this._loader.qf.accessors,I.attributes[B]);C&&(f[M]=C.normalized||!1)}};L("POSITION",t.g.PositionKind),L("NORMAL",t.g.NormalKind),L("TANGENT",t.g.TangentKind),L("TEXCOORD_0",t.g.UVKind),L("TEXCOORD_1",t.g.UV2Kind),L("TEXCOORD_2",t.g.UV3Kind),L("TEXCOORD_3",t.g.UV4Kind),L("TEXCOORD_4",t.g.UV5Kind),L("TEXCOORD_5",t.g.UV6Kind),L("JOINTS_0",t.g.MatricesIndicesKind),L("WEIGHTS_0",t.g.MatricesWeightsKind),L("COLOR_0",t.g.ColorKind);const e=b.Get(M,this._loader.qf.bufferViews,x.bufferView);return e._dracoBabylonGeometry||(e._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then((async M=>{const x=this.dracoDecoder||kB.c.Default,L=b.TryGet(this._loader.qf.accessors,I.attributes.POSITION),e=this._loader.parent.alwaysComputeBoundingBox||C.skeleton||!L?null:Y(L);return await x._decodeMeshToGeometryForGltfAsync(C.name,this._loader.babylonScene,M,y,f,e).catch((I=>{throw new Error(`${B}: ${I.message}`)}))}))),await e._dracoBabylonGeometry}))}}E(qB),l(qB,!0,(B=>new SB(B)));var oB=C(12873),UB=C(11180),GB=C(11186),VB=C(11621),cB=C(11777),tB=C(11149);VB.d.AddNodeConstructor("Light_Type_0",((B,I)=>()=>new rB(B,x.HI.Zero(),I)));class rB extends cB.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(B){this._shadowAngle=B,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(B){const I=this.needCube();if(this._direction=B,this.needCube()!==I&&this._shadowGenerators){const B=this._shadowGenerators.values();for(let I=B.next();!0!==I.done;I=B.next()){I.value.recreateShadowMap()}}}constructor(B,I,C){super(B,C),this._shadowAngle=Math.PI/2,this.position=I}getClassName(){return"PointLight"}getTypeID(){return RB.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(B){if(this.direction)return super.getShadowDirection(B);switch(B){case 0:return new x.HI(1,0,0);case 1:return new x.HI(-1,0,0);case 2:return new x.HI(0,-1,0);case 3:return new x.HI(0,1,0);case 4:return new x.HI(0,0,1);case 5:return new x.HI(0,0,-1)}return x.HI.Zero()}_setDefaultShadowProjectionMatrix(B,I,C){const M=this.rB().activeCamera;if(!M)return;const y=void 0!==this.shadowMinZ?this.shadowMinZ:M.uf,f=void 0!==this.shadowMaxZ?this.shadowMaxZ:M.maxZ,L=this.rB().getEngine().useReverseDepthBuffer;x.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,L?f:y,L?y:f,B,!0,this._scene.getEngine().isNDCHalfZRange,void 0,L)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(B,I){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,I):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,I),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,I),this}transferToNodeMaterialEffect(B,I){return this.computeTransformedInformation()?B.setFloat3(I,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):B.setFloat3(I,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(B,I){B["POINTLIGHT"+I]=!0}}(0,UB.e)([(0,GB.K)()],rB.prototype,"shadowAngle",null),(0,tB.h)("BABYLON.PointLight",rB);const AB="KHR_lights_punctual";class DB{constructor(B){this.name=AB,this._loader=B,this.enabled=this._loader.isExtensionUsed(AB)}dispose(){this._loader=null,delete this._lights}onLoading(){const B=this._loader.qf.extensions;if(B&&B[this.name]){const I=B[this.name];this._lights=I.lights,b.Assign(this._lights)}}loadNodeAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,f)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(B,I,(B=>{let I;const L=b.Get(M,this._lights,f.nx),e=L.name||B.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,L.type){case"directional":{const B=new oB.b(e,x.HI.Backward(),this._loader.babylonScene);B.position.Tf(0),I=B;break}case"point":I=new rB(e,x.HI.Zero(),this._loader.babylonScene);break;case"spot":{const B=new NB.b(e,x.HI.Zero(),x.HI.Backward(),0,1,this._loader.babylonScene);B.angle=2*(L.spot&&L.spot.outerConeAngle||Math.PI/4),B.innerAngle=2*(L.spot&&L.spot.innerConeAngle||0),I=B;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${M}: Invalid light type (${L.type})`)}I._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,L._babylonLight=I,I.falloffType=RB.c.FALLOFF_GLTF,I.DL=L.color?y.SI.oI(L.color):y.SI.White(),I.AL=void 0==L.AL?1:L.AL,I.range=void 0==L.range?Number.MAX_VALUE:L.range,I.parent=B,this._loader._babylonLights.push(I),v.AddPointerMetadata(I,M),C(B)})))))}}E(AB),l(AB,!0,(B=>new DB(B)));const JB="KHR_materials_pbrSpecularGlossiness";class iB{constructor(B){this.name=JB,this.order=200,this._loader=B,this.enabled=this._loader.isExtensionUsed(JB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>{const y=new Array;return y.push(this._loader.loadMaterialBasePropertiesAsync(B,I,C)),y.push(this._loadSpecularGlossinessPropertiesAsync(M,x,C)),this._loader.loadMaterialAlphaProperties(B,I,C),await Promise.all(y).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(B,I,C){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);const M=new Array;return C.metallic=null,C.roughness=null,I.diffuseFactor?(C.albedoColor=y.SI.oI(I.diffuseFactor),C.alpha=I.diffuseFactor[3]):C.albedoColor=y.SI.White(),C.reflectivityColor=I.specularFactor?y.SI.oI(I.specularFactor):y.SI.White(),C.microSurface=void 0==I.glossinessFactor?1:I.glossinessFactor,I.diffuseTexture&&M.push(this._loader.loadTextureInfoAsync(`${B}/diffuseTexture`,I.diffuseTexture,(B=>{B.name=`${C.name} (Diffuse)`,C.albedoTexture=B}))),I.specularGlossinessTexture&&(M.push(this._loader.loadTextureInfoAsync(`${B}/specularGlossinessTexture`,I.specularGlossinessTexture,(B=>{B.name=`${C.name} (Specular Glossiness)`,C.reflectivityTexture=B,C.reflectivityTexture.if=!0}))),C.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(M).then((()=>{}))}}E(JB),l(JB,!0,(B=>new iB(B)));const uB="KHR_materials_unlit";class pB{constructor(B){this.name=uB,this.order=210,this._loader=B,this.enabled=this._loader.isExtensionUsed(uB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async()=>await this._loadUnlitPropertiesAsync(B,I,C)))}_loadUnlitPropertiesAsync(B,I,C){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);const M=new Array;C.unlit=!0;const x=I.pbrMetallicRoughness;return x&&(x.baseColorFactor?(C.albedoColor=y.SI.oI(x.baseColorFactor),C.alpha=x.baseColorFactor[3]):C.albedoColor=y.SI.White(),x.baseColorTexture&&M.push(this._loader.loadTextureInfoAsync(`${B}/baseColorTexture`,x.baseColorTexture,(B=>{B.name=`${C.name} (Base Color)`,C.albedoTexture=B})))),I.doubleSided&&(C.Yf=!1,C.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(B,I,C),Promise.all(M).then((()=>{}))}}E(uB),l(uB,!0,(B=>new pB(B)));const nB="KHR_materials_clearcoat";class OB{constructor(B){this.name=nB,this.order=190,this._loader=B,this.enabled=this._loader.isExtensionUsed(nB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>{const y=new Array;y.push(this._loader.loadMaterialPropertiesAsync(B,I,C)),y.push(this._loadClearCoatPropertiesAsync(M,x,C)),await Promise.all(y)}))}_loadClearCoatPropertiesAsync(B,I,C){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);const M=new Array;return C.clearCoat.isEnabled=!0,C.clearCoat.useRoughnessFromMainTexture=!1,C.clearCoat.remapF0OnInterfaceChange=!1,void 0!=I.clearcoatFactor?C.clearCoat.AL=I.clearcoatFactor:C.clearCoat.AL=0,I.clearcoatTexture&&M.push(this._loader.loadTextureInfoAsync(`${B}/clearcoatTexture`,I.clearcoatTexture,(B=>{B.name=`${C.name} (ClearCoat)`,C.clearCoat.texture=B}))),void 0!=I.clearcoatRoughnessFactor?C.clearCoat.roughness=I.clearcoatRoughnessFactor:C.clearCoat.roughness=0,I.clearcoatRoughnessTexture&&(I.clearcoatRoughnessTexture.nonColorData=!0,M.push(this._loader.loadTextureInfoAsync(`${B}/clearcoatRoughnessTexture`,I.clearcoatRoughnessTexture,(B=>{B.name=`${C.name} (ClearCoat Roughness)`,C.clearCoat.textureRoughness=B})))),I.clearcoatNormalTexture&&(I.clearcoatNormalTexture.nonColorData=!0,M.push(this._loader.loadTextureInfoAsync(`${B}/clearcoatNormalTexture`,I.clearcoatNormalTexture,(B=>{B.name=`${C.name} (ClearCoat Normal)`,C.clearCoat.bumpTexture=B}))),C.invertNormalMapX=!C.rB().useRightHandedSystem,C.invertNormalMapY=C.rB().useRightHandedSystem,void 0!=I.clearcoatNormalTexture.scale&&(C.clearCoat.bumpTexture.level=I.clearcoatNormalTexture.scale)),Promise.all(M).then((()=>{}))}}E(nB),l(nB,!0,(B=>new OB(B)));const aB="KHR_materials_iridescence";class WB{constructor(B){this.name=aB,this.order=195,this._loader=B,this.enabled=this._loader.isExtensionUsed(aB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>{const y=new Array;return y.push(this._loader.loadMaterialPropertiesAsync(B,I,C)),y.push(this._loadIridescencePropertiesAsync(M,x,C)),await Promise.all(y).then((()=>{}))}))}_loadIridescencePropertiesAsync(B,I,C){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);const M=new Array;return C.iridescence.isEnabled=!0,C.iridescence.AL=I.iridescenceFactor??0,C.iridescence.indexOfRefraction=I.iridescenceIor??I.iridescenceIOR??1.3,C.iridescence.minimumThickness=I.iridescenceThicknessMinimum??100,C.iridescence.maximumThickness=I.iridescenceThicknessMaximum??400,I.iridescenceTexture&&M.push(this._loader.loadTextureInfoAsync(`${B}/iridescenceTexture`,I.iridescenceTexture,(B=>{B.name=`${C.name} (Iridescence)`,C.iridescence.texture=B}))),I.iridescenceThicknessTexture&&M.push(this._loader.loadTextureInfoAsync(`${B}/iridescenceThicknessTexture`,I.iridescenceThicknessTexture,(B=>{B.name=`${C.name} (Iridescence Thickness)`,C.iridescence.thicknessTexture=B}))),Promise.all(M).then((()=>{}))}}E(aB),l(aB,!0,(B=>new WB(B)));const dB="KHR_materials_anisotropy";class lB{constructor(B){this.name=dB,this.order=195,this._loader=B,this.enabled=this._loader.isExtensionUsed(dB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>{const y=new Array;y.push(this._loader.loadMaterialPropertiesAsync(B,I,C)),y.push(this._loadIridescencePropertiesAsync(M,x,C)),await Promise.all(y)}))}async _loadIridescencePropertiesAsync(B,I,C){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);const M=new Array;C.anisotropy.isEnabled=!0,C.anisotropy.AL=I.anisotropyStrength??0,C.anisotropy.angle=I.anisotropyRotation??0,I.anisotropyTexture&&(I.anisotropyTexture.nonColorData=!0,M.push(this._loader.loadTextureInfoAsync(`${B}/anisotropyTexture`,I.anisotropyTexture,(B=>{B.name=`${C.name} (Anisotropy Intensity)`,C.anisotropy.texture=B})))),await Promise.all(M)}}E(dB),l(dB,!0,(B=>new lB(B)));const EB="KHR_materials_emissive_strength";class QB{constructor(B){this.name=EB,this.order=170,this._loader=B,this.enabled=this._loader.isExtensionUsed(EB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>await this._loader.loadMaterialPropertiesAsync(B,I,C).then((()=>{this._loadEmissiveProperties(M,x,C)}))))}_loadEmissiveProperties(B,I,C){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);void 0!==I.emissiveStrength&&(C.emissiveIntensity=I.emissiveStrength)}}E(EB),l(EB,!0,(B=>new QB(B)));const ZB="KHR_materials_sheen";class zB{constructor(B){this.name=ZB,this.order=190,this._loader=B,this.enabled=this._loader.isExtensionUsed(ZB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>{const y=new Array;return y.push(this._loader.loadMaterialPropertiesAsync(B,I,C)),y.push(this._loadSheenPropertiesAsync(M,x,C)),await Promise.all(y).then((()=>{}))}))}_loadSheenPropertiesAsync(B,I,C){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);const M=new Array;return C.sheen.isEnabled=!0,C.sheen.AL=1,void 0!=I.sheenColorFactor?C.sheen.color=y.SI.oI(I.sheenColorFactor):C.sheen.color=y.SI.Black(),I.sheenColorTexture&&M.push(this._loader.loadTextureInfoAsync(`${B}/sheenColorTexture`,I.sheenColorTexture,(B=>{B.name=`${C.name} (Sheen Color)`,C.sheen.texture=B}))),void 0!==I.sheenRoughnessFactor?C.sheen.roughness=I.sheenRoughnessFactor:C.sheen.roughness=0,I.sheenRoughnessTexture&&(I.sheenRoughnessTexture.nonColorData=!0,M.push(this._loader.loadTextureInfoAsync(`${B}/sheenRoughnessTexture`,I.sheenRoughnessTexture,(B=>{B.name=`${C.name} (Sheen Roughness)`,C.sheen.textureRoughness=B})))),C.sheen.albedoScaling=!0,C.sheen.useRoughnessFromMainTexture=!1,Promise.all(M).then((()=>{}))}}E(ZB),l(ZB,!0,(B=>new zB(B)));var bB=C(11662);const YB="KHR_materials_specular";class vB{constructor(B){this.name=YB,this.order=190,this._loader=B,this.enabled=this._loader.isExtensionUsed(YB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>{const y=new Array;if(y.push(this._loader.loadMaterialPropertiesAsync(B,I,C)),y.push(this._loadSpecularPropertiesAsync(M,x,C)),x.extensions&&x.extensions.EXT_materials_specular_edge_color&&C instanceof G.c){x.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(C.brdf.dielectricSpecularModel=bB.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,C.brdf.conductorSpecularModel=bB.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(y).then((()=>{}))}))}_loadSpecularPropertiesAsync(B,I,C){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);const M=new Array;return void 0!==I.specularFactor&&(C.metallicF0Factor=I.specularFactor),void 0!==I.specularColorFactor&&(C.metallicReflectanceColor=y.SI.oI(I.specularColorFactor)),I.specularTexture&&(I.specularTexture.nonColorData=!0,M.push(this._loader.loadTextureInfoAsync(`${B}/specularTexture`,I.specularTexture,(B=>{B.name=`${C.name} (Specular)`,C.metallicReflectanceTexture=B,C.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),I.specularColorTexture&&M.push(this._loader.loadTextureInfoAsync(`${B}/specularColorTexture`,I.specularColorTexture,(B=>{B.name=`${C.name} (Specular Color)`,C.reflectanceTexture=B}))),Promise.all(M).then((()=>{}))}}E(YB),l(YB,!0,(B=>new vB(B)));const sB="KHR_materials_ior";class XB{constructor(B){this.name=sB,this.order=180,this._loader=B,this.enabled=this._loader.isExtensionUsed(sB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>{const y=new Array;return y.push(this._loader.loadMaterialPropertiesAsync(B,I,C)),y.push(this._loadIorPropertiesAsync(M,x,C)),await Promise.all(y).then((()=>{}))}))}_loadIorPropertiesAsync(B,I,C){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);return void 0!==I.ior?C.indexOfRefraction=I.ior:C.indexOfRefraction=XB._DEFAULT_IOR,Promise.resolve()}}XB._DEFAULT_IOR=1.5,E(sB),l(sB,!0,(B=>new XB(B)));const TB="KHR_materials_variants";class PB{constructor(B){this.name=TB,this._loader=B,this.enabled=this._loader.isExtensionUsed(TB)}dispose(){this._loader=null}static GetAvailableVariants(B){const I=this._GetExtensionMetadata(B);return I?Object.keys(I.variants):[]}getAvailableVariants(B){return PB.GetAvailableVariants(B)}static SelectVariant(B,I){const C=this._GetExtensionMetadata(B);if(!C)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${TB} extension`);const M=B=>{const I=C.variants[B];if(I)for(const C of I)C.mesh.material=C.material};if(I instanceof Array)for(const x of I)M(x);else M(I);C.lastSelected=I}selectVariant(B,I){PB.SelectVariant(B,I)}static Reset(B){const I=this._GetExtensionMetadata(B);if(!I)throw new Error(`Cannot reset on a glTF mesh that does not have the ${TB} extension`);for(const C of I.original)C.mesh.material=C.material;I.lastSelected=null}reset(B){PB.Reset(B)}static GetLastSelectedVariant(B){const I=this._GetExtensionMetadata(B);if(!I)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${TB} extension`);return I.lastSelected}getLastSelectedVariant(B){return PB.GetLastSelectedVariant(B)}static _GetExtensionMetadata(B){var I,C;return(null===B||void 0===B||null===(I=B._internalMetadata)||void 0===I||null===(C=I.qf)||void 0===C?void 0:C[TB])||null}onLoading(){const B=this._loader.qf.extensions;if(B&&B[this.name]){const I=B[this.name];this._variants=I.variants}}onReady(){const B=this._loader.rootBabylonMesh;if(B){var I;const C=this._loader.parent.extensionOptions[TB];null!==C&&void 0!==C&&C.defaultVariant&&PB.SelectVariant(B,C.defaultVariant),null===C||void 0===C||null===(I=C.onLoaded)||void 0===I||I.call(C,{get variants(){return PB.GetAvailableVariants(B)},get selectedVariant(){const I=PB.GetLastSelectedVariant(B);return I?Array.isArray(I)?I[0]:I:PB.GetAvailableVariants(B)[0]},set selectedVariant(I){PB.SelectVariant(B,I)}})}}_loadMeshPrimitiveAsync(B,I,C,M,x,y){return v.LoadExtensionAsync(B,x,this.name,(async(f,L)=>{const e=new Array;return e.push(this._loader._loadMeshPrimitiveAsync(B,I,C,M,x,(I=>{if(y(I),I instanceof D.b){const C=v._GetDrawMode(B,x.mode),M=this._loader.rootBabylonMesh,y=M?M._internalMetadata=M._internalMetadata||{}:{},g=y.qf=y.qf||{},N=g[TB]=g[TB]||{lastSelected:null,original:[],variants:{}};N.original.push({mesh:I,material:I.material});for(let B=0;B<L.mappings.length;++B){const x=L.mappings[B],y=b.Get(`${f}/mappings/${B}/material`,this._loader.qf.materials,x.material);e.push(this._loader._loadMaterialAsync(`#/materials/${x.material}`,y,I,C,(B=>{for(let C=0;C<x.variants.length;++C){const y=x.variants[C],f=b.Get(`/extensions/${TB}/variants/${y}`,this._variants,y);N.variants[f.name]=N.variants[f.name]||[],N.variants[f.name].push({mesh:I,material:B}),I.onClonedObservable.add((B=>{const C=B;let x=null,y=C;do{if(y=y.parent,!y)return;x=PB._GetExtensionMetadata(y)}while(null===x);if(M&&x===PB._GetExtensionMetadata(M)){y._internalMetadata={};for(const B in M._internalMetadata)y._internalMetadata[B]=M._internalMetadata[B];y._internalMetadata.qf=[];for(const B in M._internalMetadata.qf)y._internalMetadata.qf[B]=M._internalMetadata.qf[B];y._internalMetadata.qf[TB]={lastSelected:null,original:[],variants:{}};for(const B of x.original)y._internalMetadata.qf[TB].original.push({mesh:B.mesh,material:B.material});for(const B in x.variants)if(Object.prototype.hasOwnProperty.call(x.variants,B)){y._internalMetadata.qf[TB].variants[B]=[];for(const I of x.variants[B])y._internalMetadata.qf[TB].variants[B].push({mesh:I.mesh,material:I.material})}x=y._internalMetadata.qf[TB]}for(const M of x.original)M.mesh===I&&(M.mesh=C);for(const M of x.variants[f.name])M.mesh===I&&(M.mesh=C)}))}})))}}}))),await Promise.all(e).then((B=>{let[I]=B;return I}))}))}}E(TB),l(TB,!0,(B=>new PB(B)));var hB=C(11256);class jB{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:bB.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(B,I){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...jB._GetDefaultOptions(),...B},this._scene=I,this._scene._transmissionHelper=this,this.onErrorObservable=new N.e,this._scene.If.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(B){if(!Object.keys(B).filter((I=>this._options[I]!==B[I])).length)return;const I={...this._options,...B},C=this._options;this._options=I,I.renderSize===C.renderSize&&I.renderTargetTextureType===C.renderTargetTextureType&&I.generateMipmaps===C.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=I.samples,this._opaqueRenderTarget.lodGenerationScale=I.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=I.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(B){return!!B&&!!(B instanceof G.c&&B.subSurface.isRefractionEnabled)}_addMesh(B){this._materialObservers[B.uniqueId]=B.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),f.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(B.material)?(B.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(B)&&this._transparentMeshesCache.push(B)):-1===this._opaqueMeshesCache.indexOf(B)&&this._opaqueMeshesCache.push(B)}))}_removeMesh(B){B.onMaterialChangedObservable.remove(this._materialObservers[B.uniqueId]),delete this._materialObservers[B.uniqueId];let I=this._transparentMeshesCache.indexOf(B);-1!==I&&this._transparentMeshesCache.splice(I,1),I=this._opaqueMeshesCache.indexOf(B),-1!==I&&this._opaqueMeshesCache.splice(I,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(B){const I=this._transparentMeshesCache.indexOf(B),C=this._opaqueMeshesCache.indexOf(B);this._shouldRenderAsTransmission(B.material)?(B.material instanceof G.c&&(B.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==C?(this._opaqueMeshesCache.splice(C,1),this._transparentMeshesCache.push(B)):-1===I&&this._transparentMeshesCache.push(B)):-1!==I?(this._transparentMeshesCache.splice(I,1),this._opaqueMeshesCache.push(B)):-1===C&&this._opaqueMeshesCache.push(B)}_isRenderTargetValid(){var B;return null!==(null===(B=this._opaqueRenderTarget)||void 0===B?void 0:B.getInternalTexture())}_setupRenderTargets(){var B;let I;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new hB.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(B=this._options.clearColor)||void 0===B?void 0:B.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((B=>{I=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?B.clearColor.M(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(B.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=I}));for(const C of this._transparentMeshesCache)this._shouldRenderAsTransmission(C.material)&&(C.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const wB="KHR_materials_transmission";class KB{constructor(B){this.name=wB,this.order=175,this._loader=B,this.enabled=this._loader.isExtensionUsed(wB),this.enabled&&(B.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>{const y=new Array;return y.push(this._loader.loadMaterialPropertiesAsync(B,I,C)),y.push(this._loadTransparentPropertiesAsync(M,I,C,x)),await Promise.all(y).then((()=>{}))}))}_loadTransparentPropertiesAsync(B,I,C,M){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);const x=C;if(x.subSurface.isRefractionEnabled=!0,x.subSurface.volumeIndexOfRefraction=1,x.subSurface.useAlbedoToTintRefraction=!0,void 0===M.transmissionFactor)return x.subSurface.refractionIntensity=0,x.subSurface.isRefractionEnabled=!1,Promise.resolve();{var y;x.subSurface.refractionIntensity=M.transmissionFactor;const B=x.rB();if(x.subSurface.refractionIntensity&&!B._transmissionHelper)new jB({},x.rB());else if(x.subSurface.refractionIntensity&&(null===(y=B._transmissionHelper)||void 0===y||!y._isRenderTargetValid())){var f;null===(f=B._transmissionHelper)||void 0===f||f._setupRenderTargets()}}return x.subSurface.minimumThickness=0,x.subSurface.maximumThickness=0,M.transmissionTexture?(M.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${B}/transmissionTexture`,M.transmissionTexture,void 0).then((B=>{B.name=`${C.name} (Transmission)`,x.subSurface.refractionIntensityTexture=B,x.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}E(wB),l(wB,!0,(B=>new KB(B)));const mB="KHR_materials_diffuse_transmission";class BI{constructor(B){this.name=mB,this.order=174,this._loader=B,this.enabled=this._loader.isExtensionUsed(mB),this.enabled&&(B.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>{const y=new Array;return y.push(this._loader.loadMaterialPropertiesAsync(B,I,C)),y.push(this._loadTranslucentPropertiesAsync(M,I,C,x)),await Promise.all(y).then((()=>{}))}))}_loadTranslucentPropertiesAsync(B,I,C,M){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);const x=C;if(x.subSurface.isTranslucencyEnabled=!0,x.subSurface.volumeIndexOfRefraction=1,x.subSurface.minimumThickness=0,x.subSurface.maximumThickness=0,x.subSurface.useAlbedoToTintTranslucency=!1,void 0===M.diffuseTransmissionFactor)return x.subSurface.translucencyIntensity=0,x.subSurface.isTranslucencyEnabled=!1,Promise.resolve();x.subSurface.translucencyIntensity=M.diffuseTransmissionFactor;const f=new Array;return x.subSurface.useGltfStyleTextures=!0,M.diffuseTransmissionTexture&&(M.diffuseTransmissionTexture.nonColorData=!0,f.push(this._loader.loadTextureInfoAsync(`${B}/diffuseTransmissionTexture`,M.diffuseTransmissionTexture).then((B=>{B.name=`${C.name} (Diffuse Transmission)`,x.subSurface.translucencyIntensityTexture=B})))),void 0!==M.diffuseTransmissionColorFactor?x.subSurface.translucencyColor=y.SI.oI(M.diffuseTransmissionColorFactor):x.subSurface.translucencyColor=y.SI.White(),M.diffuseTransmissionColorTexture&&f.push(this._loader.loadTextureInfoAsync(`${B}/diffuseTransmissionColorTexture`,M.diffuseTransmissionColorTexture).then((B=>{B.name=`${C.name} (Diffuse Transmission Color)`,x.subSurface.translucencyColorTexture=B}))),Promise.all(f).then((()=>{}))}}E(mB),l(mB,!0,(B=>new BI(B)));const II="KHR_materials_volume";class CI{constructor(B){this.name=II,this.order=173,this._loader=B,this.enabled=this._loader.isExtensionUsed(II),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>{const y=new Array;return y.push(this._loader.loadMaterialPropertiesAsync(B,I,C)),y.push(this._loadVolumePropertiesAsync(M,I,C,x)),await Promise.all(y).then((()=>{}))}))}_loadVolumePropertiesAsync(B,I,C,M){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);if(!C.subSurface.isRefractionEnabled&&!C.subSurface.isTranslucencyEnabled||!M.thicknessFactor)return Promise.resolve();C.subSurface.volumeIndexOfRefraction=C.indexOfRefraction;const x=void 0!==M.attenuationDistance?M.attenuationDistance:Number.MAX_VALUE;return C.subSurface.tintColorAtDistance=x,void 0!==M.attenuationColor&&3==M.attenuationColor.length&&C.subSurface.tintColor.vf(M.attenuationColor[0],M.attenuationColor[1],M.attenuationColor[2]),C.subSurface.minimumThickness=0,C.subSurface.maximumThickness=M.thicknessFactor,C.subSurface.useThicknessAsDepth=!0,M.thicknessTexture?(M.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${B}/thicknessTexture`,M.thicknessTexture).then((B=>{B.name=`${C.name} (Thickness)`,C.subSurface.thicknessTexture=B,C.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}E(II),l(II,!0,(B=>new CI(B)));const MI="KHR_materials_dispersion";class xI{constructor(B){this.name=MI,this.order=174,this._loader=B,this.enabled=this._loader.isExtensionUsed(MI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>{const y=new Array;return y.push(this._loader.loadMaterialPropertiesAsync(B,I,C)),y.push(this._loadDispersionPropertiesAsync(M,I,C,x)),await Promise.all(y).then((()=>{}))}))}_loadDispersionPropertiesAsync(B,I,C,M){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);return C.subSurface.isRefractionEnabled&&M.dispersion?(C.subSurface.isDispersionEnabled=!0,C.subSurface.dispersion=M.dispersion,Promise.resolve()):Promise.resolve()}}E(MI),l(MI,!0,(B=>new xI(B)));const yI="EXT_materials_diffuse_roughness";class fI{constructor(B){this.name=yI,this.order=190,this._loader=B,this.enabled=this._loader.isExtensionUsed(yI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>{const y=new Array;return y.push(this._loader.loadMaterialPropertiesAsync(B,I,C)),y.push(this._loadDiffuseRoughnessPropertiesAsync(M,x,C)),await Promise.all(y).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(B,I,C){if(!(C instanceof G.c))throw new Error(`${B}: Material type not supported`);const M=new Array;return C.brdf.baseDiffuseModel=bB.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=I.diffuseRoughnessFactor?C.baseDiffuseRoughness=I.diffuseRoughnessFactor:C.baseDiffuseRoughness=0,I.diffuseRoughnessTexture&&M.push(this._loader.loadTextureInfoAsync(`${B}/diffuseRoughnessTexture`,I.diffuseRoughnessTexture,(B=>{B.name=`${C.name} (Diffuse Roughness)`,C.baseDiffuseRoughnessTexture=B}))),Promise.all(M).then((()=>{}))}}E(yI),l(yI,!0,(B=>new fI(B)));const LI="KHR_mesh_quantization";class eI{constructor(B){this.name=LI,this.enabled=B.isExtensionUsed(LI)}dispose(){}}E(LI),l(LI,!0,(B=>new eI(B)));const gI="KHR_texture_basisu";class NI{constructor(B){this.name=gI,this._loader=B,this.enabled=B.isExtensionUsed(gI)}dispose(){this._loader=null}_loadTextureAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>{const y=void 0==I.sampler?v.DefaultSampler:b.Get(`${B}/sampler`,this._loader.qf.samplers,I.sampler),f=b.Get(`${M}/source`,this._loader.qf.images,x.source);return await this._loader._createTextureAsync(B,y,f,(B=>{C(B)}),I._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!I._textureInfo.nonColorData)}))}}E(gI),l(gI,!0,(B=>new NI(B)));const RI="KHR_texture_transform";class HI{constructor(B){this.name=RI,this._loader=B,this.enabled=this._loader.isExtensionUsed(RI)}dispose(){this._loader=null}loadTextureInfoAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(M,x)=>await this._loader.loadTextureInfoAsync(B,I,(B=>{if(!(B instanceof V.c))throw new Error(`${M}: Texture type not supported`);x.offset&&(B.uOffset=x.offset[0],B.vOffset=x.offset[1]),B.uRotationCenter=0,B.vRotationCenter=0,x.rotation&&(B.wAng=-x.rotation),x.scale&&(B.uScale=x.scale[0],B.vScale=x.scale[1]),void 0!=x.texCoord&&(B.coordinatesIndex=x.texCoord),C(B)}))))}}E(RI),l(RI,!0,(B=>new HI(B)));const FI="KHR_xmp_json_ld";class kI{constructor(B){this.name=FI,this.order=100,this._loader=B,this.enabled=this._loader.isExtensionUsed(FI)}dispose(){this._loader=null}onLoading(){var B,I,C;if(null===this._loader.rootBabylonMesh)return;const M=null===(B=this._loader.qf.extensions)||void 0===B?void 0:B.KHR_xmp_json_ld,x=null===(I=this._loader.qf.asset)||void 0===I||null===(C=I.extensions)||void 0===C?void 0:C.KHR_xmp_json_ld;if(M&&x){const B=+x.packet;M.packets&&B<M.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=M.packets[B])}}}function qI(B,I,C,M){return y.SI.oI(I,C).scale(M)}function SI(B,I,C,M){return I[C]*M}function oI(B,I,C,M){return-I[C]*M}function UI(B,I,C,M){return I[C+1]*M}function GI(B,I,C,M){return I[C]*M*2}function VI(B){return{scale:[new tI(H.c.ANIMATIONTYPE_FLOAT,`${B}.uScale`,SI,(()=>2)),new tI(H.c.ANIMATIONTYPE_FLOAT,`${B}.vScale`,UI,(()=>2))],offset:[new tI(H.c.ANIMATIONTYPE_FLOAT,`${B}.uOffset`,SI,(()=>2)),new tI(H.c.ANIMATIONTYPE_FLOAT,`${B}.vOffset`,UI,(()=>2))],rotation:[new tI(H.c.ANIMATIONTYPE_FLOAT,`${B}.wAng`,oI,(()=>1))]}}E(FI),l(FI,!0,(B=>new kI(B)));class cI extends s.AnimationPropertyInfo{buildAnimations(B,I,C,M){return[{babylonAnimatable:B._babylonCamera,babylonAnimation:this._buildAnimation(I,C,M)}]}}class tI extends s.AnimationPropertyInfo{buildAnimations(B,I,C,M){const x=[];for(const y in B._data)x.push({babylonAnimatable:B._data[y].babylonMaterial,babylonAnimation:this._buildAnimation(I,C,M)});return x}}class rI extends s.AnimationPropertyInfo{buildAnimations(B,I,C,M){return[{babylonAnimatable:B._babylonLight,babylonAnimation:this._buildAnimation(I,C,M)}]}}(0,Q.k)("/cameras/{}/orthographic/xmag",[new cI(H.c.ANIMATIONTYPE_FLOAT,"orthoLeft",oI,(()=>1)),new cI(H.c.ANIMATIONTYPE_FLOAT,"orthoRight",UI,(()=>1))]),(0,Q.k)("/cameras/{}/orthographic/ymag",[new cI(H.c.ANIMATIONTYPE_FLOAT,"orthoBottom",oI,(()=>1)),new cI(H.c.ANIMATIONTYPE_FLOAT,"orthoTop",UI,(()=>1))]),(0,Q.k)("/cameras/{}/orthographic/zfar",[new cI(H.c.ANIMATIONTYPE_FLOAT,"maxZ",SI,(()=>1))]),(0,Q.k)("/cameras/{}/orthographic/znear",[new cI(H.c.ANIMATIONTYPE_FLOAT,"uf",SI,(()=>1))]),(0,Q.k)("/cameras/{}/perspective/yfov",[new cI(H.c.ANIMATIONTYPE_FLOAT,"fov",SI,(()=>1))]),(0,Q.k)("/cameras/{}/perspective/zfar",[new cI(H.c.ANIMATIONTYPE_FLOAT,"maxZ",SI,(()=>1))]),(0,Q.k)("/cameras/{}/perspective/znear",[new cI(H.c.ANIMATIONTYPE_FLOAT,"uf",SI,(()=>1))]),(0,Q.k)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new tI(H.c.ANIMATIONTYPE_COLOR3,"albedoColor",qI,(()=>4)),new tI(H.c.ANIMATIONTYPE_FLOAT,"alpha",(function(B,I,C,M){return I[C+3]*M}),(()=>4))]),(0,Q.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new tI(H.c.ANIMATIONTYPE_FLOAT,"metallic",SI,(()=>1))]),(0,Q.k)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new tI(H.c.ANIMATIONTYPE_FLOAT,"roughness",SI,(()=>1))]);const AI=VI("albedoTexture");(0,Q.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",AI.scale),(0,Q.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",AI.offset),(0,Q.k)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",AI.rotation);const DI=VI("metallicTexture");(0,Q.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",DI.scale),(0,Q.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",DI.offset),(0,Q.k)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",DI.rotation),(0,Q.k)("/materials/{}/emissiveFactor",[new tI(H.c.ANIMATIONTYPE_COLOR3,"emissiveColor",qI,(()=>3))]);const JI=VI("bumpTexture");(0,Q.k)("/materials/{}/normalTexture/scale",[new tI(H.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",SI,(()=>1))]),(0,Q.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",JI.scale),(0,Q.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",JI.offset),(0,Q.k)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",JI.rotation),(0,Q.k)("/materials/{}/occlusionTexture/strength",[new tI(H.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",SI,(()=>1))]);const iI=VI("ambientTexture");(0,Q.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",iI.scale),(0,Q.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",iI.offset),(0,Q.k)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",iI.rotation);const uI=VI("emissiveTexture");(0,Q.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",uI.scale),(0,Q.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",uI.offset),(0,Q.k)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",uI.rotation),(0,Q.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new tI(H.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",SI,(()=>1))]),(0,Q.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new tI(H.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",SI,(()=>1))]);const pI=VI("anisotropy.texture");(0,Q.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",pI.scale),(0,Q.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",pI.offset),(0,Q.k)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",pI.rotation),(0,Q.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new tI(H.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",SI,(()=>1))]),(0,Q.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new tI(H.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",SI,(()=>1))]);const nI=VI("clearCoat.texture");(0,Q.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",nI.scale),(0,Q.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",nI.offset),(0,Q.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",nI.rotation);const OI=VI("clearCoat.bumpTexture");(0,Q.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new tI(H.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",SI,(()=>1))]),(0,Q.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",OI.scale),(0,Q.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",OI.offset),(0,Q.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",OI.rotation);const aI=VI("clearCoat.textureRoughness");(0,Q.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",aI.scale),(0,Q.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",aI.offset),(0,Q.k)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",aI.rotation),(0,Q.k)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new tI(H.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",SI,(()=>1))]),(0,Q.k)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new tI(H.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",SI,(()=>1))]),(0,Q.k)("/materials/{}/extensions/KHR_materials_ior/ior",[new tI(H.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",SI,(()=>1))]),(0,Q.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new tI(H.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",SI,(()=>1))]),(0,Q.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new tI(H.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",SI,(()=>1))]),(0,Q.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new tI(H.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",SI,(()=>1))]),(0,Q.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new tI(H.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",SI,(()=>1))]);const WI=VI("iridescence.texture");(0,Q.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",WI.scale),(0,Q.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",WI.offset),(0,Q.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",WI.rotation);const dI=VI("iridescence.thicknessTexture");(0,Q.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",dI.scale),(0,Q.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",dI.offset),(0,Q.k)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",dI.rotation),(0,Q.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new tI(H.c.ANIMATIONTYPE_COLOR3,"sheen.color",qI,(()=>3))]),(0,Q.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new tI(H.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",SI,(()=>1))]);const lI=VI("sheen.texture");(0,Q.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",lI.scale),(0,Q.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",lI.offset),(0,Q.k)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",lI.rotation);const EI=VI("sheen.textureRoughness");(0,Q.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",EI.scale),(0,Q.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",EI.offset),(0,Q.k)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",EI.rotation),(0,Q.k)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new tI(H.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",SI,(()=>1))]),(0,Q.k)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new tI(H.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",qI,(()=>3))]);const QI=VI("metallicReflectanceTexture");(0,Q.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",QI.scale),(0,Q.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",QI.offset),(0,Q.k)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",QI.rotation);const ZI=VI("reflectanceTexture");(0,Q.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",ZI.scale),(0,Q.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",ZI.offset),(0,Q.k)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",ZI.rotation),(0,Q.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new tI(H.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",SI,(()=>1))]);const zI=VI("subSurface.refractionIntensityTexture");(0,Q.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",zI.scale),(0,Q.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",zI.offset),(0,Q.k)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",zI.rotation),(0,Q.k)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new tI(H.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",qI,(()=>3))]),(0,Q.k)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new tI(H.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",SI,(()=>1))]),(0,Q.k)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new tI(H.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",SI,(()=>1))]);const bI=VI("subSurface.thicknessTexture");(0,Q.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",bI.scale),(0,Q.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",bI.offset),(0,Q.k)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",bI.rotation),(0,Q.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new tI(H.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",SI,(()=>1))]);const YI=VI("subSurface.translucencyIntensityTexture");(0,Q.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",YI.scale),(0,Q.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",YI.offset),(0,Q.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",YI.rotation),(0,Q.k)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new tI(H.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",qI,(()=>3))]);const vI=VI("subSurface.translucencyColorTexture");(0,Q.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",vI.scale),(0,Q.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",vI.offset),(0,Q.k)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",vI.rotation),(0,Q.k)("/extensions/KHR_lights_punctual/lights/{}/color",[new rI(H.c.ANIMATIONTYPE_COLOR3,"diffuse",qI,(()=>3))]),(0,Q.k)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new rI(H.c.ANIMATIONTYPE_FLOAT,"intensity",SI,(()=>1))]),(0,Q.k)("/extensions/KHR_lights_punctual/lights/{}/range",[new rI(H.c.ANIMATIONTYPE_FLOAT,"range",SI,(()=>1))]),(0,Q.k)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new rI(H.c.ANIMATIONTYPE_FLOAT,"innerAngle",GI,(()=>1))]),(0,Q.k)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new rI(H.c.ANIMATIONTYPE_FLOAT,"angle",GI,(()=>1))]),(0,Q.k)("/nodes/{}/extensions/EXT_lights_ies/color",[new rI(H.c.ANIMATIONTYPE_COLOR3,"diffuse",qI,(()=>3))]),(0,Q.k)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new rI(H.c.ANIMATIONTYPE_FLOAT,"intensity",SI,(()=>1))]);const sI="KHR_animation_pointer";class XI{constructor(B){this.name=sI,this._loader=B,this._pathToObjectConverter=(0,Q.g)(this._loader.qf)}get enabled(){return this._loader.isExtensionUsed(sI)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(B,I,C,M,x){var y;const f=null===(y=M.target.extensions)||void 0===y?void 0:y.KHR_animation_pointer;if(!f||!this._pathToObjectConverter)return null;"pointer"!==M.target.path&&q.b.Warn(`${B}/target/path: Value (${M.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=M.target.node&&q.b.Warn(`${B}/target/node: Value (${M.target.node}) must not be present when using the ${this.name} extension`);const L=`${B}/extensions/${this.name}`,e=f.pointer;if(!e)throw new Error(`${L}: Pointer is missing`);try{const y=this._pathToObjectConverter.convert(e);if(!y.info.interpolation)throw new Error(`${L}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(B,I,C,M,{object:y.object,info:y.info.interpolation},x)}catch(g){return q.b.Warn(`${L}/pointer: Invalid pointer (${e}) skipped`),null}}}E(sI),l(sI,!0,(B=>new XI(B)));class TI{constructor(B,I,C){this.frame=B,this.action=I,this.onlyOnce=C,this.isDone=!1}_clone(){return new TI(this.frame,this.action,this.onlyOnce)}}var PI=C(11042),hI=C(11096),jI=C(11091);class wI{get loop(){return this._loop}set loop(B){B!==this._loop&&(this._loop=B,this.updateOptions({loop:B}))}get currentTime(){var B;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(B=hI.e.audioEngine)&&void 0!==B&&B.audioContext&&(this.isPlaying||this.isPaused)){const B=this.isPaused?0:hI.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+B}return 0}get spatialSound(){return this._spatialSound}set spatialSound(B){if(B==this._spatialSound)return;const I=this.isPlaying;this.pause(),B?(this._spatialSound=B,this._updateSpatialParameters()):this._disableSpatialSound(),I&&this.play()}constructor(B,I,C){var M;let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new N.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=x.HI.Zero(),this._localDirection=new x.HI(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=B,C=C||k.c.LastCreatedScene)if(this._scene=C,wI._SceneComponentInitialization(C),this._readyToPlayCallback=y,this._customAttenuationFunction=(B,I,C,M,x)=>I<C?B*(1-I/C):0,L&&(this.autoplay=L.autoplay||!1,this._loop=L.loop||!1,void 0!==L.volume&&(this._volume=L.volume),this._spatialSound=L.spatialSound??!1,this.maxDistance=L.maxDistance??100,this.useCustomAttenuation=L.useCustomAttenuation??!1,this.rolloffFactor=L.rolloffFactor||1,this.refDistance=L.refDistance||1,this.distanceModel=L.distanceModel||"linear",this._playbackRate=L.playbackRate||1,this._streaming=L.streaming??!1,this._length=L.length,this._offset=L.offset),null!==(M=hI.e.audioEngine)&&void 0!==M&&M.canUseWebAudio&&hI.e.audioEngine.audioContext){this._soundGain=hI.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let B=!0;if(I)try{"string"===typeof I?(this._urlType="String",this._url=I):I instanceof ArrayBuffer?this._urlType="ArrayBuffer":I instanceof HTMLMediaElement?this._urlType="MediaElement":I instanceof MediaStream?this._urlType="MediaStream":I instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(I)&&(this._urlType="Array");let C=[],M=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=hI.e.audioEngine.audioContext.createMediaElementSource(I),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=hI.e.audioEngine.audioContext.createMediaStreamSource(I),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":I.byteLength>0&&(M=!0,this._soundLoaded(I));break;case"AudioBuffer":this._audioBufferLoaded(I);break;case"String":C.push(I);case"Array":0===C.length&&(C=I);for(let B=0;B<C.length;B++){const I=C[B];if(M=L&&L.skipCodecCheck||-1!==I.indexOf(".mp3",I.length-4)&&hI.e.audioEngine.isMP3supported||-1!==I.indexOf(".ogg",I.length-4)&&hI.e.audioEngine.isOGGsupported||-1!==I.indexOf(".wav",I.length-4)||-1!==I.indexOf(".m4a",I.length-4)||-1!==I.indexOf(".mp4",I.length-4)||-1!==I.indexOf("blob:"),M){this._streaming?(this._htmlAudioElement=new Audio(I),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,f.Tools.SetCorsBehavior(I,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(I,(B=>{this._soundLoaded(B)}),void 0,!0,!0,(B=>{B&&q.b.Error("XHR "+B.status+" error on: "+I+"."),q.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:B=!1}B?M||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):q.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(e){q.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),hI.e.audioEngine&&!hI.e.audioEngine.WarnedWebAudioUnsupported&&(q.b.Error("Web Audio is not supported by your browser."),hI.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var B;null!==(B=hI.e.audioEngine)&&void 0!==B&&B.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(B){var I;null!==(I=hI.e.audioEngine)&&void 0!==I&&I.audioContext&&(this._audioBuffer=B,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(B){var I;null!==(I=hI.e.audioEngine)&&void 0!==I&&I.audioContext&&hI.e.audioEngine.audioContext.decodeAudioData(B,(B=>{this._audioBufferLoaded(B)}),(B=>{q.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+B)}))}setAudioBuffer(B){var I;null!==(I=hI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&(this._audioBuffer=B,this._isReadyToPlay=!0)}updateOptions(B){B&&(this.loop=B.loop??this.loop,this.maxDistance=B.maxDistance??this.maxDistance,this.useCustomAttenuation=B.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=B.rolloffFactor??this.rolloffFactor,this.refDistance=B.refDistance??this.refDistance,this.distanceModel=B.distanceModel??this.distanceModel,this._playbackRate=B.playbackRate??this._playbackRate,this._length=B.length??void 0,this.spatialSound=B.spatialSound??this._spatialSound,this._setOffset(B.offset??void 0),this.setVolume(B.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var B;null!==(B=hI.e.audioEngine)&&void 0!==B&&B.canUseWebAudio&&hI.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??hI.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var B;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(B=this._soundPanner)||void 0===B||B.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var B;null!==(B=hI.e.audioEngine)&&void 0!==B&&B.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(B){var I;null!==(I=hI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(B),this._isOutputConnected=!0)}setDirectionalCone(B,I,C){I<B?q.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=B,this._coneOuterAngle=I,this._coneOuterGain=C,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(B){if(B!=this._coneInnerAngle){var I;if(this._coneOuterAngle<B)return void q.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=B,null!==(I=hI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(B){if(B!=this._coneOuterAngle){var I;if(B<this._coneInnerAngle)return void q.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=B,null!==(I=hI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(B){var I;B.equals(this._position)||(this._position.M(B),null!==(I=hI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(B){var I;this._localDirection=B,null!==(I=hI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const B=this._connectedTransformNode.getWorldMatrix(),I=x.HI.TransformNormal(this._localDirection,B);I.normalize(),this._soundPanner.orientationX.value=I.x,this._soundPanner.orientationY.value=I.y,this._soundPanner.orientationZ.value=I.z}updateDistanceFromListener(){var B;if(null!==(B=hI.e.audioEngine)&&void 0!==B&&B.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const B=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.FI(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,B,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(B){this._customAttenuationFunction=B}play(B,I,C){var M;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(M=hI.e.audioEngine)&&void 0!==M&&M.audioContext)try{var x,y;this._clearTimeoutsAndObservers();let M=B?(null===(x=hI.e.audioEngine)||void 0===x?void 0:x.audioContext.currentTime)+B:null===(y=hI.e.audioEngine)||void 0===y?void 0:y.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=hI.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const B=()=>{var C;if(null!==(C=hI.e.audioEngine)&&void 0!==C&&C.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=I??0;const C=this._htmlAudioElement.play();void 0!==C&&C.catch((()=>{var I,C;(null===(I=hI.e.audioEngine)||void 0===I||I.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(C=hI.e.audioEngine)||void 0===C?void 0:C.onAudioUnlockedObservable.addOnce((()=>{B()})))}))}else{var M;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(M=hI.e.audioEngine)||void 0===M?void 0:M.onAudioUnlockedObservable.addOnce((()=>{B()}))}};B()}}else{var f;const x=()=>{var x;if(null!==(x=hI.e.audioEngine)&&void 0!==x&&x.audioContext){var y;if(C=C||this._length,void 0!==I&&this._setOffset(I),this._soundSource){const B=this._soundSource;B.onended=()=>{B.disconnect()}}if(this._soundSource=null===(y=hI.e.audioEngine)||void 0===y?void 0:y.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var f;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==I&&(this._soundSource.loopStart=I),void 0!==C&&(this._soundSource.loopEnd=(0|I)+C),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},M=B?(null===(f=hI.e.audioEngine)||void 0===f?void 0:f.audioContext.currentTime)+B:hI.e.audioEngine.audioContext.currentTime;const x=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(M,x,this.loop?void 0:C)}}};"suspended"===(null===(f=hI.e.audioEngine)||void 0===f?void 0:f.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var B;"suspended"===(null===(B=hI.e.audioEngine)||void 0===B?void 0:B.audioContext.state)?(hI.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=hI.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{x()})))):x()}),500):x()}this._startTime=M,this.isPlaying=!0,this.isPaused=!1}catch(L){q.b.Error("Error while trying to play audio: "+this.name+", "+L.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(B){var I;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var C;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(C=this._streamingSource)||void 0===C||C.disconnect();this.isPlaying=!1}else if(null!==(I=hI.e.audioEngine)&&void 0!==I&&I.audioContext&&this._soundSource){const I=B?hI.e.audioEngine.audioContext.currentTime+B:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(I)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var B;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var I;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(I=this._streamingSource)||void 0===I||I.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(B=hI.e.audioEngine)&&void 0!==B&&B.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=hI.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(B,I){var C;null!==(C=hI.e.audioEngine)&&void 0!==C&&C.canUseWebAudio&&this._soundGain&&(I&&hI.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(hI.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,hI.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(B,hI.e.audioEngine.audioContext.currentTime+I)):this._soundGain.gain.value=B),this._volume=B}setPlaybackRate(B){this._playbackRate=B,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(B){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=B,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=B=>this._onRegisterAfterWorldMatrixUpdate(B),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(B){var I;if(B.getBoundingInfo){const I=B.getBoundingInfo();this.setPosition(I.boundingSphere.centerWorld)}else this.setPosition(B.absolutePosition);null!==(I=hI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const B=()=>{(0,jI.f)((()=>this._isReadyToPlay),(()=>{C._audioBuffer=this.getAudioBuffer(),C._isReadyToPlay=!0,C.autoplay&&C.play(0,this._offset,this._length)}),void 0,300)},I={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},C=new wI(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,I);return this.useCustomAttenuation&&C.setAttenuationFunction(this._customAttenuationFunction),C.setPosition(this._position),C.setPlaybackRate(this._playbackRate),B(),C}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const B={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(B.connectedMeshId=this._connectedTransformNode.id),B.position=this._position.Df(),B.refDistance=this.refDistance,B.distanceModel=this.distanceModel,B.isDirectional=this._isDirectional,B.localDirectionToMesh=this._localDirection.Df(),B.coneInnerAngle=this._coneInnerAngle,B.coneOuterAngle=this._coneOuterAngle,B.coneOuterGain=this._coneOuterGain),B}static Parse(B,I,C,M){const y=B.name;let f;f=B.url?C+B.url:C+y;const L={autoplay:B.autoplay,loop:B.loop,volume:B.volume,spatialSound:B.spatialSound,maxDistance:B.maxDistance,rolloffFactor:B.rolloffFactor,refDistance:B.refDistance,distanceModel:B.distanceModel,playbackRate:B.playbackRate};let e;if(M){const B=()=>{(0,jI.f)((()=>M._isReadyToPlay),(()=>{e._audioBuffer=M.getAudioBuffer(),e._isReadyToPlay=!0,e.autoplay&&e.play(0,e._offset,e._length)}),void 0,300)};e=new wI(y,new ArrayBuffer(0),I,null,L),B()}else e=new wI(y,f,I,(()=>{I.removePendingData(e)}),L),I.addPendingData(e);if(B.position){const I=x.HI.oI(B.position);e.setPosition(I)}if(B.isDirectional&&(e.setDirectionalCone(B.coneInnerAngle||360,B.coneOuterAngle||360,B.coneOuterGain||0),B.localDirectionToMesh)){const I=x.HI.oI(B.localDirectionToMesh);e.setLocalDirectionToMesh(I)}if(B.connectedMeshId){const C=I.getMeshById(B.connectedMeshId);C&&e.attachToMesh(C)}return B.metadata&&(e.metadata=B.metadata),e}_setOffset(B){this._offset!==B&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=B)}_clearTimeoutsAndObservers(){var B;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(B=hI.e.audioEngine)||void 0===B||B.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}wI._SceneComponentInitialization=B=>{throw(0,PI.c)("AudioSceneComponent")},(0,tB.h)("BABYLON.Sound",wI);class KI{constructor(B,I,C){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],I.length!==C.length)throw new Error("Sounds length does not equal weights length");this.loop=B,this._weights=C;let M=0;for(const y of C)M+=y;const x=M>0?1/M:0;for(let y=0;y<this._weights.length;y++)this._weights[y]*=x;this._sounds=I;for(const y of this._sounds)y.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(B){if(B!==this._coneInnerAngle){if(this._coneOuterAngle<B)return void q.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=B;for(const I of this._sounds)I.directionalConeInnerAngle=B}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(B){if(B!==this._coneOuterAngle){if(B<this._coneInnerAngle)return void q.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=B;for(const I of this._sounds)I.directionalConeOuterAngle=B}}get volume(){return this._volume}set volume(B){if(B!==this._volume)for(const I of this._sounds)I.setVolume(B)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(B){if(!this.isPaused){this.stop();const B=Math.random();let I=0;for(let C=0;C<this._weights.length;C++)if(I+=this._weights[C],B<=I){this._currentIndex=C;break}}const I=this._sounds[this._currentIndex??0];I.isReady()?I.play(0,this.isPaused?void 0:B):I.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class mI{constructor(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(B=B||k.c.LastCreatedScene)&&(this._scene=B,this.soundCollection=[],this._options=I,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var B;null!==(B=hI.e.audioEngine)&&void 0!==B&&B.canUseWebAudio&&hI.e.audioEngine.audioContext&&(this._outputAudioNode=hI.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(hI.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(hI.e.audioEngine&&hI.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(B){var I;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(I=hI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._outputAudioNode&&B.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==B.soundTrackId&&(-1===B.soundTrackId?this._scene.mainSoundTrack.removeSound(B):this._scene.soundTracks&&this._scene.soundTracks[B.soundTrackId].removeSound(B)),this.soundCollection.push(B),B.soundTrackId=this.id}removeSound(B){const I=this.soundCollection.indexOf(B);-1!==I&&this.soundCollection.splice(I,1)}setVolume(B){var I;null!==(I=hI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=B)}switchPanningModelToHRTF(){var B;if(null!==(B=hI.e.audioEngine)&&void 0!==B&&B.canUseWebAudio)for(let I=0;I<this.soundCollection.length;I++)this.soundCollection[I].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var B;if(null!==(B=hI.e.audioEngine)&&void 0!==B&&B.canUseWebAudio)for(let I=0;I<this.soundCollection.length;I++)this.soundCollection[I].switchPanningModelToEqualPower()}connectToAnalyser(B){var I;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=B,null!==(I=hI.e.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,hI.e.audioEngine.masterGain))}}var BC=C(11471),IC=C(11440),CC=C(11024);hI.e.AudioEngineFactory=(B,I,C)=>new MC(B,I,C);class MC{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new N.e,this.onAudioLockedObservable=new N.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,CC.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const M=document.createElement("audio");this._hostElement=B,this._audioContext=I,this._audioDestination=C;try{M&&M.canPlayType&&(M.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||M.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(x){}try{M&&M.canPlayType&&M.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(x){}}lock(){this._triggerSuspendedState()}unlock(){var B,I;if("running"===(null===(B=this._audioContext)||void 0===B?void 0:B.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(I=this._audioContext)||void 0===I||I.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{q.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var B;null===(B=this._audioContext)||void 0===B||B.addEventListener("statechange",(()=>{var B;this.unlocked&&"running"!==(null===(B=this._audioContext)||void 0===B?void 0:B.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var B;return null!==(B=this._audioContext)&&void 0!==B&&B.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(B){this.canUseWebAudio=!1,q.b.Error("Web Audio: "+B.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(B){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const B=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",I=document.createElement("style");I.appendChild(document.createTextNode(B)),document.getElementsByTagName("head")[0].appendChild(I),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var B;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(B=this._audioContext)||void 0===B||B.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(B){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=B)}connectToAnalyser(B){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=B,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var xC=C(11034);(0,C(12540).e)(BC.d.NAME_AUDIO,((B,I,C,M)=>{let x,y=[];if(C.KH=C.KH||[],void 0!==B.KH&&null!==B.KH)for(let L=0,e=B.KH.length;L<e;L++){var f;const e=B.KH[L];null!==(f=hI.e.audioEngine)&&void 0!==f&&f.canUseWebAudio?(e.url||(e.url=e.name),y[e.url]?C.KH.push(wI.Parse(e,I,M,y[e.url])):(x=wI.Parse(e,I,M),y[e.url]=x,C.KH.push(x))):C.KH.push(new wI(e.name,null,I))}y=[]})),Object.defineProperty(IC.b.prototype,"mainSoundTrack",{get:function(){let B=this._getComponent(BC.d.NAME_AUDIO);return B||(B=new yC(this),this.py(B)),this._mainSoundTrack||(this._mainSoundTrack=new mI(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),IC.b.prototype.getSoundByName=function(B){let I;for(I=0;I<this.mainSoundTrack.soundCollection.length;I++)if(this.mainSoundTrack.soundCollection[I].name===B)return this.mainSoundTrack.soundCollection[I];if(this.soundTracks)for(let C=0;C<this.soundTracks.length;C++)for(I=0;I<this.soundTracks[C].soundCollection.length;I++)if(this.soundTracks[C].soundCollection[I].name===B)return this.soundTracks[C].soundCollection[I];return null},Object.defineProperty(IC.b.prototype,"audioEnabled",{get:function(){let B=this._getComponent(BC.d.NAME_AUDIO);return B||(B=new yC(this),this.py(B)),B.audioEnabled},set:function(B){let I=this._getComponent(BC.d.NAME_AUDIO);I||(I=new yC(this),this.py(I)),B?I.enableAudio():I.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(IC.b.prototype,"headphone",{get:function(){let B=this._getComponent(BC.d.NAME_AUDIO);return B||(B=new yC(this),this.py(B)),B.headphone},set:function(B){let I=this._getComponent(BC.d.NAME_AUDIO);I||(I=new yC(this),this.py(I)),B?I.switchAudioModeForHeadphones():I.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(IC.b.prototype,"audioListenerPositionProvider",{get:function(){let B=this._getComponent(BC.d.NAME_AUDIO);return B||(B=new yC(this),this.py(B)),B.audioListenerPositionProvider},set:function(B){let I=this._getComponent(BC.d.NAME_AUDIO);if(I||(I=new yC(this),this.py(I)),B&&"function"!==typeof B)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");I.audioListenerPositionProvider=B},enumerable:!0,configurable:!0}),Object.defineProperty(IC.b.prototype,"audioListenerRotationProvider",{get:function(){let B=this._getComponent(BC.d.NAME_AUDIO);return B||(B=new yC(this),this.py(B)),B.audioListenerRotationProvider},set:function(B){let I=this._getComponent(BC.d.NAME_AUDIO);if(I||(I=new yC(this),this.py(I)),B&&"function"!==typeof B)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");I.audioListenerRotationProvider=B},enumerable:!0,configurable:!0}),Object.defineProperty(IC.b.prototype,"audioPositioningRefreshRate",{get:function(){let B=this._getComponent(BC.d.NAME_AUDIO);return B||(B=new yC(this),this.py(B)),B.audioPositioningRefreshRate},set:function(B){let I=this._getComponent(BC.d.NAME_AUDIO);I||(I=new yC(this),this.py(I)),I.audioPositioningRefreshRate=B},enumerable:!0,configurable:!0});class yC{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(B){this.name=BC.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new x.HI,this._cachedCameraPosition=new x.HI,this._lastCheck=0,this._invertMatrixTemp=new x.Matrix,this._cameraDirectionTemp=new x.HI,(B=B||k.c.LastCreatedScene)&&(this.kI=B,B.soundTracks=[],B.KH=[])}register(){this.kI._afterRenderStage.registerStep(BC.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(B){if(B.KH=[],this.kI.soundTracks)for(let I=0;I<this.kI.soundTracks.length;I++){const C=this.kI.soundTracks[I];for(let I=0;I<C.soundCollection.length;I++)B.KH.push(C.soundCollection[I].serialize())}}addFromContainer(B){if(B.KH)for(const I of B.KH)I.play(),I.autoplay=!0,this.kI.mainSoundTrack.addSound(I)}removeFromContainer(B){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(B.KH)for(const C of B.KH)C.stop(),C.autoplay=!1,this.kI.mainSoundTrack.removeSound(C),I&&C.dispose()}dispose(){const B=this.kI;if(B._mainSoundTrack&&B.mainSoundTrack.dispose(),B.soundTracks)for(let I=0;I<B.soundTracks.length;I++)B.soundTracks[I].dispose()}disableAudio(){const B=this.kI;let I;for(this._audioEnabled=!1,hI.e.audioEngine&&hI.e.audioEngine.audioContext&&hI.e.audioEngine.audioContext.suspend(),I=0;I<B.mainSoundTrack.soundCollection.length;I++)B.mainSoundTrack.soundCollection[I].pause();if(B.soundTracks)for(I=0;I<B.soundTracks.length;I++)for(let C=0;C<B.soundTracks[I].soundCollection.length;C++)B.soundTracks[I].soundCollection[C].pause()}enableAudio(){const B=this.kI;let I;for(this._audioEnabled=!0,hI.e.audioEngine&&hI.e.audioEngine.audioContext&&hI.e.audioEngine.audioContext.resume(),I=0;I<B.mainSoundTrack.soundCollection.length;I++)B.mainSoundTrack.soundCollection[I].isPaused&&B.mainSoundTrack.soundCollection[I].play();if(B.soundTracks)for(I=0;I<B.soundTracks.length;I++)for(let C=0;C<B.soundTracks[I].soundCollection.length;C++)B.soundTracks[I].soundCollection[C].isPaused&&B.soundTracks[I].soundCollection[C].play()}switchAudioModeForHeadphones(){const B=this.kI;if(this._headphone=!0,B.mainSoundTrack.switchPanningModelToHRTF(),B.soundTracks)for(let I=0;I<B.soundTracks.length;I++)B.soundTracks[I].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const B=this.kI;if(this._headphone=!1,B.mainSoundTrack.switchPanningModelToEqualPower(),B.soundTracks)for(let I=0;I<B.soundTracks.length;I++)B.soundTracks[I].switchPanningModelToEqualPower()}_afterRender(){const B=xC.c.Now;if(this._lastCheck&&B-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=B;const I=this.kI;if(!this._audioEnabled||!I._mainSoundTrack||!I.soundTracks||0===I._mainSoundTrack.soundCollection.length&&1===I.soundTracks.length)return;const C=hI.e.audioEngine;if(C&&C.audioContext){let B,M=I.activeCamera;if(I.activeCameras&&I.activeCameras.length>0&&(M=I.activeCameras[0]),this.audioListenerPositionProvider){const B=this.audioListenerPositionProvider();C.audioContext.listener.setPosition(B.x||0,B.y||0,B.z||0)}else M?this._cachedCameraPosition.equals(M.globalPosition)||(this._cachedCameraPosition.M(M.globalPosition),C.audioContext.listener.setPosition(M.globalPosition.x,M.globalPosition.y,M.globalPosition.z)):C.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const B=this.audioListenerRotationProvider();C.audioContext.listener.setOrientation(B.x||0,B.y||0,B.z||0,0,1,0)}else M?(M.rigCameras&&M.rigCameras.length>0&&(M=M.rigCameras[0]),M.getViewMatrix().invertToRef(this._invertMatrixTemp),x.HI.TransformNormalToRef(yC._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.M(this._cameraDirectionTemp),C.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):C.audioContext.listener.setOrientation(0,0,0,0,1,0);for(B=0;B<I.mainSoundTrack.soundCollection.length;B++){const C=I.mainSoundTrack.soundCollection[B];C.useCustomAttenuation&&C.updateDistanceFromListener()}if(I.soundTracks)for(B=0;B<I.soundTracks.length;B++)for(let C=0;C<I.soundTracks[B].soundCollection.length;C++){const M=I.soundTracks[B].soundCollection[C];M.useCustomAttenuation&&M.updateDistanceFromListener()}}}}yC._CameraDirection=new x.HI(0,0,-1),wI._SceneComponentInitialization=B=>{let I=B._getComponent(BC.d.NAME_AUDIO);I||(I=new yC(B),B.py(I))};const fC="MSFT_audio_emitter";class LC{constructor(B){this.name=fC,this._loader=B,this.enabled=this._loader.isExtensionUsed(fC)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const B=this._loader.qf.extensions;if(B&&B[this.name]){const I=B[this.name];this._clips=I.clips,this._emitters=I.emitters,b.Assign(this._clips),b.Assign(this._emitters)}}loadSceneAsync(B,I){return v.LoadExtensionAsync(B,I,this.name,(async(C,M)=>{const x=new Array;x.push(this._loader.loadSceneAsync(B,I));for(const B of M.emitters){const I=b.Get(`${C}/emitters`,this._emitters,B);if(void 0!=I.refDistance||void 0!=I.maxDistance||void 0!=I.rolloffFactor||void 0!=I.distanceModel||void 0!=I.innerAngle||void 0!=I.outerAngle)throw new Error(`${C}: Direction or Distance properties are not allowed on emitters attached to a scene`);x.push(this._loadEmitterAsync(`${C}/emitters/${I.index}`,I))}await Promise.all(x)}))}loadNodeAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(B,M)=>{const y=new Array,L=await this._loader.loadNodeAsync(B,I,(I=>{for(const C of M.emitters){const M=b.Get(`${B}/emitters`,this._emitters,C);y.push(this._loadEmitterAsync(`${B}/emitters/${M.index}`,M).then((()=>{for(const B of M._babylonSounds)B.attachToMesh(I),void 0==M.innerAngle&&void 0==M.outerAngle||(B.setLocalDirectionToMesh(x.HI.Forward()),B.setDirectionalCone(2*f.Tools.ToDegrees(void 0==M.innerAngle?Math.PI:M.innerAngle),2*f.Tools.ToDegrees(void 0==M.outerAngle?Math.PI:M.outerAngle),0))})))}C(I)}));return await Promise.all(y),L}))}loadAnimationAsync(B,I){return v.LoadExtensionAsync(B,I,this.name,(async(C,M)=>{const x=await this._loader.loadAnimationAsync(B,I),y=new Array;b.Assign(M.events);for(const f of M.events)y.push(this._loadAnimationEventAsync(`${C}/events/${f.index}`,B,I,f,x));return await Promise.all(y),x}))}_loadClipAsync(B,I){if(I._objectURL)return I._objectURL;let C;if(I.uri)C=this._loader.loadUriAsync(B,I,I.uri);else{const M=b.Get(`${B}/bufferView`,this._loader.qf.bufferViews,I.bufferView);C=this._loader.loadBufferViewAsync(`/bufferViews/${M.index}`,M)}return I._objectURL=C.then((B=>URL.createObjectURL(new Blob([B],{type:I.mimeType})))),I._objectURL}_loadEmitterAsync(B,I){if(I._babylonSounds=I._babylonSounds||[],!I._babylonData){const B=new Array,C=I.name||`emitter${I.index}`,M={loop:!1,autoplay:!1,volume:void 0==I.volume?1:I.volume};for(let y=0;y<I.clips.length;y++){const x=`/extensions/${this.name}/clips`,f=b.Get(x,this._clips,I.clips[y].clip);B.push(this._loadClipAsync(`${x}/${I.clips[y].clip}`,f).then((B=>{const x=I._babylonSounds[y]=new wI(C,B,this._loader.babylonScene,null,M);x.refDistance=I.refDistance||1,x.maxDistance=I.maxDistance||256,x.rolloffFactor=I.rolloffFactor||1,x.distanceModel=I.distanceModel||"exponential"})))}const x=Promise.all(B).then((()=>{const B=I.clips.map((B=>B.weight||1)),C=new KI(I.loop||!1,I._babylonSounds,B);I.innerAngle&&(C.directionalConeInnerAngle=2*f.Tools.ToDegrees(I.innerAngle)),I.outerAngle&&(C.directionalConeOuterAngle=2*f.Tools.ToDegrees(I.outerAngle)),I.volume&&(C.volume=I.volume),I._babylonData.sound=C}));I._babylonData={loaded:x}}return I._babylonData.loaded}_getEventAction(B,I,C,M,x){switch(C){case"play":return B=>{const C=(x||0)+(B-M);I.play(C)};case"stop":return()=>{I.stop()};case"pause":return()=>{I.pause()};default:throw new Error(`${B}: Unsupported action ${C}`)}}_loadAnimationEventAsync(B,I,C,M,x){if(0==x.targetedAnimations.length)return Promise.resolve();const y=x.targetedAnimations[0],f=M.j,L=b.Get(`/extensions/${this.name}/emitters`,this._emitters,f);return this._loadEmitterAsync(B,L).then((()=>{const I=L._babylonData.sound;if(I){const C=new TI(M.time,this._getEventAction(B,I,M.action,M.time,M.startOffset));y.animation.addEvent(C),x.onAnimationGroupEndObservable.add((()=>{I.stop()})),x.onAnimationGroupPauseObservable.add((()=>{I.pause()}))}}))}}E(fC),l(fC,!0,(B=>new LC(B)));const eC="MSFT_lod";class gC{constructor(B){var I;this.name=eC,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new N.e,this.onMaterialLODsLoadedObservable=new N.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=B,this.maxLODsToLoad=(null===(I=this._loader.parent.extensionOptions[eC])||void 0===I?void 0:I.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(eC)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let B=0;B<this._nodePromiseLODs.length;B++){const I=Promise.all(this._nodePromiseLODs[B]).then((()=>{0!==B&&(this._loader.endPerformanceCounter(`Node LOD ${B}`),this._loader.log(`Loaded node LOD ${B}`)),this.onNodeLODsLoadedObservable.notifyObservers(B),B!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${B+1}`),this._loadBufferLOD(this._nodeBufferLODs,B+1),this._nodeSignalLODs[B]&&this._nodeSignalLODs[B].resolve())}));this._loader._completePromises.push(I)}for(let B=0;B<this._materialPromiseLODs.length;B++){const I=Promise.all(this._materialPromiseLODs[B]).then((()=>{0!==B&&(this._loader.endPerformanceCounter(`Material LOD ${B}`),this._loader.log(`Loaded material LOD ${B}`)),this.onMaterialLODsLoadedObservable.notifyObservers(B),B!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${B+1}`),this._loadBufferLOD(this._materialBufferLODs,B+1),this._materialSignalLODs[B]&&this._materialSignalLODs[B].resolve())}));this._loader._completePromises.push(I)}}loadSceneAsync(B,I){const C=this._loader.loadSceneAsync(B,I);return this._loadBufferLOD(this._bufferLODs,0),C}loadNodeAsync(B,I,C){return v.LoadExtensionAsync(B,I,this.name,(async(B,x)=>{let y;const f=this._getLODs(B,I,this._loader.qf.nodes,x.ids);this._loader.logOpen(`${B}`);for(let I=0;I<f.length;I++){const B=f[I];0!==I&&(this._nodeIndexLOD=I,this._nodeSignalLODs[I]=this._nodeSignalLODs[I]||new M);const x=B=>{C(B),B.YL(!1)},L=this._loader.loadNodeAsync(`/nodes/${B.index}`,B,x).then((B=>{if(0!==I){const B=f[I-1];B._babylonTransformNode&&(this._disposeTransformNode(B._babylonTransformNode),delete B._babylonTransformNode)}return B.YL(!0),B}));this._nodePromiseLODs[I]=this._nodePromiseLODs[I]||[],0===I?y=L:(this._nodeIndexLOD=null,this._nodePromiseLODs[I].push(L))}return this._loader.logClose(),await y}))}_loadMaterialAsync(B,I,C,M,x){return this._nodeIndexLOD?null:v.LoadExtensionAsync(B,I,this.name,(async(B,y)=>{let f;const L=this._getLODs(B,I,this._loader.qf.materials,y.ids);this._loader.logOpen(`${B}`);for(let I=0;I<L.length;I++){const B=L[I];0!==I&&(this._materialIndexLOD=I);const y=this._loader._loadMaterialAsync(`/materials/${B.index}`,B,C,M,(B=>{0===I&&x(B)})).then((B=>{if(0!==I){x(B);const C=L[I-1]._data;C[M]&&(this._disposeMaterials([C[M].babylonMaterial]),delete C[M])}return B}));this._materialPromiseLODs[I]=this._materialPromiseLODs[I]||[],0===I?f=y:(this._materialIndexLOD=null,this._materialPromiseLODs[I].push(y))}return this._loader.logClose(),await f}))}_loadUriAsync(B,I,C){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const x=this._nodeIndexLOD-1;return this._nodeSignalLODs[x]=this._nodeSignalLODs[x]||new M,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(B,I,C)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const x=this._materialIndexLOD-1;return this._materialSignalLODs[x]=this._materialSignalLODs[x]||new M,this._materialSignalLODs[x].promise.then((async()=>await this._loader.loadUriAsync(B,I,C)))}return null}loadBufferAsync(B,I,C,x){if(this._loader.parent.useRangeRequests&&!I.uri){if(!this._loader.bin)throw new Error(`${B}: Uri is missing or the binary glTF is missing its binary chunk`);const I=async(B,I)=>{const y=C,f=y+x-1;let L=B[I];return L?(L.start=Math.min(L.start,y),L.end=Math.max(L.end,f)):(L={start:y,end:f,loaded:new M},B[I]=L),await L.loaded.promise.then((B=>new Uint8Array(B.buffer,B.byteOffset+C-L.start,x)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?I(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?I(this._materialBufferLODs,this._materialIndexLOD):I(this._bufferLODs,0)}return null}_loadBufferLOD(B,I){const C=B[I];C&&(this._loader.log(`Loading buffer range [${C.start}-${C.end}]`),this._loader.bin.readAsync(C.start,C.end-C.start+1).then((B=>{C.loaded.resolve(B)}),(B=>{C.loaded.reject(B)})))}_getLODs(B,I,C,M){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const x=[];for(let y=M.length-1;y>=0;y--)if(x.push(b.Get(`${B}/ids/${M[y]}`,C,M[y])),x.length===this.maxLODsToLoad)return x;return x.push(I),x}_disposeTransformNode(B){const I=[],C=B.material;C&&I.push(C);for(const x of B.getChildMeshes())x.material&&I.push(x.material);B.dispose();const M=I.filter((B=>this._loader.babylonScene.meshes.every((I=>I.material!=B))));this._disposeMaterials(M)}_disposeMaterials(B){const I={};for(const C of B){for(const B of C.getActiveTextures())I[B.uniqueId]=B;C.dispose()}for(const C in I)for(const B of this._loader.babylonScene.materials)B.hasTexture(I[C])&&delete I[C];for(const C in I)I[C].dispose()}}E(eC),l(eC,!0,(B=>new gC(B)));const NC="MSFT_minecraftMesh";class RC{constructor(B){this.name=NC,this._loader=B,this.enabled=this._loader.isExtensionUsed(NC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,I,C){return v.LoadExtraAsync(B,I,this.name,(async(M,x)=>{if(x){if(!(C instanceof G.c))throw new Error(`${M}: Material type not supported`);const x=this._loader.loadMaterialPropertiesAsync(B,I,C);return C.needAlphaBlending()&&(C.forceDepthWrite=!0,C.separateCullingPass=!0),C.Yf=C.forceDepthWrite,C.twoSidedLighting=!0,await x}}))}}E(NC),l(NC,!0,(B=>new RC(B)));const HC="MSFT_sRGBFactors";class FC{constructor(B){this.name=HC,this._loader=B,this.enabled=this._loader.isExtensionUsed(HC)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,I,C){return v.LoadExtraAsync(B,I,this.name,(async(M,x)=>{if(x){if(!(C instanceof G.c))throw new Error(`${M}: Material type not supported`);const x=this._loader.loadMaterialPropertiesAsync(B,I,C),y=C.rB().getEngine().useExactSrgbConversions;return C.albedoTexture||C.albedoColor.toLinearSpaceToRef(C.albedoColor,y),C.reflectivityTexture||C.reflectivityColor.toLinearSpaceToRef(C.reflectivityColor,y),await x}}))}}E(HC),l(HC,!0,(B=>new FC(B)));var kC=C(12880);const qC={};var SC=C(12945),oC=C(12923),UC=C(12888),GC=C(12901);function VC(B,I){for(const C of B)for(const B of C.dataOutputs)if(B.uniqueId===I)return B;throw new Error("Could not find data out connection with unique id "+I)}function cC(B,I){for(const C of B)if(C instanceof oC.b)for(const B of C.signalInputs)if(B.uniqueId===I)return B;throw new Error("Could not find signal in connection with unique id "+I)}async function tC(B,I){const M=await Promise.all(B.allBlocks.map((async B=>{const I=function(B){switch(B){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([C.e(78),C.e(79)]).then(C.bind(C,14341))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await C.e(80).then(C.bind(C,14350))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await C.e(81).then(C.bind(C,14357))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await C.e(82).then(C.bind(C,14365))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await C.e(83).then(C.bind(C,14373))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await C.e(84).then(C.bind(C,14382))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await C.e(85).then(C.bind(C,14384))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await C.e(86).then(C.bind(C,14392))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await C.e(87).then(C.bind(C,14398))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await C.e(89).then(C.bind(C,14418))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await C.e(89).then(C.bind(C,14418))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await C.e(89).then(C.bind(C,14418))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await C.e(89).then(C.bind(C,14418))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await C.e(89).then(C.bind(C,14418))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await C.e(89).then(C.bind(C,14418))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await C.e(90).then(C.bind(C,14422))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await C.e(90).then(C.bind(C,14422))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await C.e(90).then(C.bind(C,14422))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await C.e(90).then(C.bind(C,14422))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await C.e(95).then(C.bind(C,14429))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await C.e(96).then(C.bind(C,14438))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await C.e(97).then(C.bind(C,14442))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await C.e(98).then(C.bind(C,14447))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await C.e(99).then(C.bind(C,14455))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await C.e(100).then(C.bind(C,14463))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await C.e(101).then(C.bind(C,14468))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await C.e(102).then(C.bind(C,14477))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await C.e(103).then(C.bind(C,14486))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await C.e(104).then(C.bind(C,14490))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await C.e(105).then(C.bind(C,14494))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await C.e(106).then(C.bind(C,14500))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await C.e(107).then(C.bind(C,14507))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await C.e(108).then(C.bind(C,14513))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await C.e(109).then(C.bind(C,14515))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await C.e(110).then(C.bind(C,14521))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await C.e(111).then(C.bind(C,14525))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await C.e(112).then(C.bind(C,14532))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await C.e(113).then(C.bind(C,14540))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await C.e(92).then(C.bind(C,14544))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await C.e(114).then(C.bind(C,14546))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await C.e(115).then(C.bind(C,14548))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await C.e(116).then(C.bind(C,14557))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await C.e(93).then(C.bind(C,14561))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await C.e(88).then(C.bind(C,14402))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await C.e(94).then(C.bind(C,14565))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await C.e(94).then(C.bind(C,14565))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await C.e(94).then(C.bind(C,14565))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await C.e(94).then(C.bind(C,14565))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await C.e(94).then(C.bind(C,14565))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await C.e(94).then(C.bind(C,14565))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await C.e(94).then(C.bind(C,14565))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await C.e(94).then(C.bind(C,14565))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await C.e(89).then(C.bind(C,14418))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await C.e(89).then(C.bind(C,14418))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await C.e(89).then(C.bind(C,14418))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await C.e(89).then(C.bind(C,14418))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await C.e(89).then(C.bind(C,14418))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await C.e(89).then(C.bind(C,14418))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await C.e(89).then(C.bind(C,14418))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await C.e(90).then(C.bind(C,14422))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await C.e(90).then(C.bind(C,14422))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await C.e(91).then(C.bind(C,14569))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await C.e(91).then(C.bind(C,14569))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await C.e(91).then(C.bind(C,14569))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await C.e(91).then(C.bind(C,14569))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await C.e(91).then(C.bind(C,14569))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await C.e(91).then(C.bind(C,14569))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await C.e(117).then(C.bind(C,14573))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await C.e(118).then(C.bind(C,14582))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await C.e(119).then(C.bind(C,14589))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await C.e(120).then(C.bind(C,14593))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await C.e(121).then(C.bind(C,14601))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await C.e(122).then(C.bind(C,14603))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await C.e(123).then(C.bind(C,14612))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await C.e(124).then(C.bind(C,14617))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await C.e(125).then(C.bind(C,14626))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await C.e(126).then(C.bind(C,14635))).FlowGraphDataSwitchBlock;default:if(qC[B])return qC[B];throw new Error(`Unknown block name ${B}`)}}(B.className);return await I()})));return function(B,I,C){const M=I.coordinator.createGraph(),x=[],y=I.valueParseFunction??UC.e;for(let f=0;f<B.allBlocks.length;f++){const L=AC(B.allBlocks[f],{kI:I.coordinator.config.kI,pathConverter:I.pathConverter,assetsContainer:I.coordinator.config.kI,valueParseFunction:y},C[f]);x.push(L),L instanceof SC.d&&M.addEventBlock(L)}for(const f of x){for(const B of f.dataInputs)for(const I of B.connectedPointIds){const C=VC(x,I);B.connectTo(C)}if(f instanceof oC.b)for(const B of f.signalOutputs)for(const I of B.connectedPointIds){const C=cC(x,I);B.connectTo(C)}}for(const f of B.executionContexts)rC(f,{graph:M,valueParseFunction:y},B.rightHanded);return M}(B,I,M)}function rC(B,I,C){const M=I.graph.createContext();B.enableLogging&&(M.enableLogging=!0),M.treatDataAsRightHanded=C||!1;const x=I.valueParseFunction??UC.e;M.uniqueId=B.uniqueId;const y=M.rB();if(B._assetsContext){var f,L,e,g,N,R,H,F,k,q;const I=B._assetsContext,C={meshes:null===(f=I.meshes)||void 0===f?void 0:f.map((B=>y.getMeshById(B))),lights:null===(L=I.lights)||void 0===L?void 0:L.map((B=>y.getLightByName(B))),cameras:null===(e=I.cameras)||void 0===e?void 0:e.map((B=>y.getCameraByName(B))),materials:null===(g=I.materials)||void 0===g?void 0:g.map((B=>y.getMaterialById(B))),textures:null===(N=I.textures)||void 0===N?void 0:N.map((B=>y.getTextureByName(B))),animations:null===(R=I.animations)||void 0===R?void 0:R.map((B=>y.animations.find((I=>I.name===B)))),skeletons:null===(H=I.skeletons)||void 0===H?void 0:H.map((B=>y.getSkeletonByName(B))),oH:null===(F=I.oH)||void 0===F?void 0:F.map((B=>y.getParticleSystemById(B))),animationGroups:null===(k=I.animationGroups)||void 0===k?void 0:k.map((B=>y.getAnimationGroupByName(B))),transformNodes:null===(q=I.transformNodes)||void 0===q?void 0:q.map((B=>y.getTransformNodeById(B))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],KH:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};M.assetsContext=C}for(const S in B._userVariables){const I=x(S,B._userVariables,M.assetsContext,y);M.userVariables[S]=I}for(const S in B._connectionValues){const I=x(S,B._connectionValues,M.assetsContext,y);M._setConnectionValueByKey(S,I)}return M}function AC(B,I,C){const M={},x=I.valueParseFunction??UC.e;if(B.config)for(const f in B.config)M[f]=x(f,B.config,I.assetsContainer||I.kI,I.kI);if((0,UC.i)(B.className)){if(!I.pathConverter)throw new Error("Path converter is required for this block");M.pathConverter=I.pathConverter}const y=new C(M);y.uniqueId=B.uniqueId;for(let f=0;f<B.dataInputs.length;f++){const I=y.getDataInput(B.dataInputs[f].name);if(!I)throw new Error("Could not find data input with name "+B.dataInputs[f].name+" in block "+B.className);I.deserialize(B.dataInputs[f])}for(let f=0;f<B.dataOutputs.length;f++){const I=y.getDataOutput(B.dataOutputs[f].name);if(!I)throw new Error("Could not find data output with name "+B.dataOutputs[f].name+" in block "+B.className);I.deserialize(B.dataOutputs[f])}return y.metadata=B.metadata,y.deserialize&&y.deserialize(B),y}function DC(B){const[I,C]=B.split(":");return JC({op:I,extension:C})}function JC(B){var I;let C=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const M=B.extension?null===(I=uC[B.extension])||void 0===I?void 0:I[B.op]:pC[B.op];if(!M&&(q.b.Warn(`No mapping found for operation ${B.op} and extension ${B.extension||"KHR_interactivity"}`),C)){const I={},C={flows:{}};if(B.inputValueSockets){I.values={};for(const C in B.inputValueSockets)I.values[C]={name:C}}return B.outputValueSockets&&(C.values={},Object.keys(B.outputValueSockets).forEach((B=>{C.values[B]={name:B}}))),{EN:[],inputs:I,outputs:C}}return M}function iC(B,I,C){uC[I]||(uC[I]={}),uC[I][B]=C}const uC={BABYLON:{"flow/log":{EN:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},pC={"event/onStart":{EN:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{EN:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{EN:["FlowGraphSendCustomEventBlock"],extraProcessor(B,I,C,M,x){if("event/send"!==I.op||!B.configuration||1!==Object.keys(B.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const y=B.configuration.event.value[0];if("number"!==typeof y)throw new Error("Event id should be a number");const f=M.arrays.events[y],L=x[0];return L.config||(L.config={}),L.config.eventId=f.eventId,L.config.eventData=f.eventData,x}},"event/receive":{EN:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(B,I){var C;if(!B.configuration)return q.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const M=B.configuration.event;if(!M)return q.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const x=M.value[0];if("number"!==typeof x)return q.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(C=I.events)||void 0===C?void 0:C[x])?{valid:!0}:(q.b.Error(`Event with id ${x} not found`),{valid:!1,error:`Event with id ${x} not found`})},extraProcessor(B,I,C,M,x){if("event/receive"!==I.op||!B.configuration||1!==Object.keys(B.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const y=B.configuration.event.value[0];if("number"!==typeof y)throw new Error("Event id should be a number");const f=M.arrays.events[y],L=x[0];return L.config||(L.config={}),L.config.eventId=f.eventId,L.config.eventData=f.eventData,x}},"math/e":nC("FlowGraphEBlock"),"math/pi":nC("FlowGraphPIBlock"),"math/inf":nC("FlowGraphInfBlock"),"math/nan":nC("FlowGraphNaNBlock"),"math/abs":nC("FlowGraphAbsBlock"),"math/sign":nC("FlowGraphSignBlock"),"math/trunc":nC("FlowGraphTruncBlock"),"math/floor":nC("FlowGraphFloorBlock"),"math/ceil":nC("FlowGraphCeilBlock"),"math/round":{EN:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,I,C,M,x){var y;return(y=x[0]).config||(y.config={}),x[0].config.roundHalfAwayFromZero=!0,x}},"math/fract":nC("FlowGraphFractBlock"),"math/neg":nC("FlowGraphNegationBlock"),"math/add":nC("FlowGraphAddBlock",["a","b"],!0),"math/sub":nC("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{EN:["FlowGraphMultiplyBlock"],extraProcessor(B,I,C,M,x){var y;(y=x[0]).config||(y.config={}),x[0].config.useMatrixPerComponent=!0,x[0].config.preventIntegerFloatArithmetic=!0;let f=-1;return Object.keys(B.values||{}).find((I=>{var C;return void 0!==(null===(C=B.values)||void 0===C?void 0:C[I].type)&&(f=B.values[I].type,!0)})),-1!==f&&(x[0].config.type=M.arrays.types[f].flowGraphType),x},validation:B=>B.values?OC(B):{valid:!0}},"math/div":nC("FlowGraphDivideBlock",["a","b"],!0),"math/rem":nC("FlowGraphModuloBlock",["a","b"]),"math/min":nC("FlowGraphMinBlock",["a","b"]),"math/max":nC("FlowGraphMaxBlock",["a","b"]),"math/clamp":nC("FlowGraphClampBlock",["a","b","c"]),"math/saturate":nC("FlowGraphSaturateBlock"),"math/mix":nC("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":nC("FlowGraphEqualityBlock",["a","b"]),"math/lt":nC("FlowGraphLessThanBlock",["a","b"]),"math/le":nC("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":nC("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":nC("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":nC("FlowGraphIsNaNBlock"),"math/isinf":nC("FlowGraphIsInfBlock"),"math/select":{EN:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{EN:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":nC("FlowGraphSinBlock"),"math/cos":nC("FlowGraphCosBlock"),"math/tan":nC("FlowGraphTanBlock"),"math/asin":nC("FlowGraphASinBlock"),"math/acos":nC("FlowGraphACosBlock"),"math/atan":nC("FlowGraphATanBlock"),"math/atan2":nC("FlowGraphATan2Block",["a","b"]),"math/sinh":nC("FlowGraphSinhBlock"),"math/cosh":nC("FlowGraphCoshBlock"),"math/tanh":nC("FlowGraphTanhBlock"),"math/asinh":nC("FlowGraphASinhBlock"),"math/acosh":nC("FlowGraphACoshBlock"),"math/atanh":nC("FlowGraphATanhBlock"),"math/exp":nC("FlowGraphExponentialBlock"),"math/log":nC("FlowGraphLogBlock"),"math/log2":nC("FlowGraphLog2Block"),"math/log10":nC("FlowGraphLog10Block"),"math/sqrt":nC("FlowGraphSquareRootBlock"),"math/cbrt":nC("FlowGraphCubeRootBlock"),"math/pow":nC("FlowGraphPowerBlock",["a","b"]),"math/length":nC("FlowGraphLengthBlock"),"math/normalize":nC("FlowGraphNormalizeBlock"),"math/dot":nC("FlowGraphDotBlock",["a","b"]),"math/cross":nC("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":nC("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":nC("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{EN:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{EN:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{EN:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{EN:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{EN:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{EN:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{EN:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":nC("FlowGraphTransposeBlock"),"math/determinant":nC("FlowGraphDeterminantBlock"),"math/inverse":nC("FlowGraphInvertMatrixBlock"),"math/matmul":nC("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{EN:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Xf",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,I,C,M,x,y){const f=x[0].dataInputs.find((B=>"rotationQuaternion"===B.name));if(!f)throw new Error("Rotation quaternion input not found");return y._connectionValues[f.uniqueId]&&(y._connectionValues[f.uniqueId].type="Quaternion"),x}},"math/matDecompose":{EN:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Xf"}}}},"math/quatConjugate":nC("FlowGraphConjugateBlock",["a"]),"math/quatMul":{EN:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,I,C,M,x){var y;return(y=x[0]).config||(y.config={}),x[0].config.type="Quaternion",x}},"math/quatAngleBetween":nC("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{EN:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":nC("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":nC("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{EN:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,I,C,M,x){var y;return(y=x[0]).config||(y.config={}),x[0].config.inputIsColumnMajor=!0,x}},"math/extract2x2":{EN:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{EN:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,I,C,M,x){var y;return(y=x[0]).config||(y.config={}),x[0].config.inputIsColumnMajor=!0,x}},"math/extract3x3":{EN:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{EN:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,I,C,M,x){var y;return(y=x[0]).config||(y.config={}),x[0].config.inputIsColumnMajor=!0,x}},"math/extract4x4":{EN:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{EN:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,I,C,M,x,y){var f,L;(L=x[0]).config||(L.config={});const e=x[0].dataInputs[0];return x[0].config.valueType=(null===(f=y._connectionValues[e.uniqueId])||void 0===f?void 0:f.type)??"FlowGraphInteger",x}},"math/and":{EN:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,I,C,M,x,y){var f,L,e;(e=x[0]).config||(e.config={});const g=x[0].dataInputs[0],N=x[0].dataInputs[1];return x[0].config.valueType=(null===(f=y._connectionValues[g.uniqueId])||void 0===f?void 0:f.type)??(null===(L=y._connectionValues[N.uniqueId])||void 0===L?void 0:L.type)??"FlowGraphInteger",x}},"math/or":{EN:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,I,C,M,x,y){var f,L,e;(e=x[0]).config||(e.config={});const g=x[0].dataInputs[0],N=x[0].dataInputs[1];return x[0].config.valueType=(null===(f=y._connectionValues[g.uniqueId])||void 0===f?void 0:f.type)??(null===(L=y._connectionValues[N.uniqueId])||void 0===L?void 0:L.type)??"FlowGraphInteger",x}},"math/xor":{EN:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,I,C,M,x,y){var f,L,e;(e=x[0]).config||(e.config={});const g=x[0].dataInputs[0],N=x[0].dataInputs[1];return x[0].config.valueType=(null===(f=y._connectionValues[g.uniqueId])||void 0===f?void 0:f.type)??(null===(L=y._connectionValues[N.uniqueId])||void 0===L?void 0:L.type)??"FlowGraphInteger",x}},"math/asr":nC("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":nC("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":nC("FlowGraphLeadingZerosBlock"),"math/ctz":nC("FlowGraphTrailingZerosBlock"),"math/popcnt":nC("FlowGraphOneBitsCounterBlock"),"math/rad":nC("FlowGraphDegToRadBlock"),"math/deg":nC("FlowGraphRadToDegBlock"),"type/boolToInt":nC("FlowGraphBooleanToInt"),"type/boolToFloat":nC("FlowGraphBooleanToFloat"),"type/intToBool":nC("FlowGraphIntToBoolean"),"type/intToFloat":nC("FlowGraphIntToFloat"),"type/floatToInt":nC("FlowGraphFloatToInt"),"type/floatToBool":nC("FlowGraphFloatToBoolean"),"flow/sequence":{EN:["FlowGraphSequenceBlock"],extraProcessor(B,I,C,M,x){const y=x[0];return y.config||(y.config={}),y.config.outputSignalCount=Object.keys(B.flows||[]).length,y.signalOutputs.forEach(((B,I)=>{B.name="out_"+I})),x}},"flow/branch":{EN:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{EN:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(B){if(B.configuration&&B.configuration.cases){const I=B.configuration.cases.value;if(!I.every((B=>"number"===typeof B&&/^-?\d+$/.test(B.toString()))))return q.b.Warn("Switch cases should be integers. Using empty array instead."),B.configuration.cases.value=[],{valid:!0};const C=new Set(I);B.configuration.cases.value=Array.from(C)}return{valid:!0}},extraProcessor(B,I,C,M,x){if("flow/switch"!==I.op||!B.flows||0===Object.keys(B.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return x[0].signalOutputs.forEach((B=>{"default"!==B.name&&(B.name="out_"+B.name)})),x}},"flow/while":{EN:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{EN:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(B,I,C,M,x){const y=x[0];return y.config||(y.config={}),y.config.incrementIndexWhenLoopDone=!0,x}},"flow/doN":{EN:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{EN:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(B,I,C,M,x){if("flow/multiGate"!==I.op||!B.flows||0===Object.keys(B.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const y=x[0];return y.config||(y.config={}),y.config.outputSignalCount=Object.keys(B.flows).length,y.signalOutputs.forEach(((B,I)=>{B.name="out_"+I})),x}},"flow/waitAll":{EN:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(B){var I,C;return"number"!==typeof(null===(I=B.configuration)||void 0===I||null===(C=I.inputFlows)||void 0===C?void 0:C.value[0])&&(B.configuration=B.configuration||{inputFlows:{value:[0]}},B.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{EN:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{EN:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{EN:["FlowGraphCancelDelayBlock"]},"variable/get":{EN:["FlowGraphGetVariableBlock"],validation(B){var I,C;return null!==(I=B.configuration)&&void 0!==I&&null!==(C=I.variable)&&void 0!==C&&C.value?{valid:!0}:(q.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(B,I)=>[I.getVariableName(B[0])]}}},"variable/set":{EN:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(B,I)=>[I.getVariableName(B[0])]}}},"variable/setMultiple":{EN:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(B,I)=>[B[0].map((B=>I.getVariableName(B)))]}},extraProcessor:(B,I,C,M,x)=>(x[0].dataInputs.forEach((B=>{B.name=M.getVariableName(+B.name)})),x)},"variable/interpolate":{EN:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(B,I)=>[I.getVariableName(B[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:B=>!0===B[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",FC:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",FC:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",FC:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",FC:"FlowGraphPlayAnimationBlock"},out:{name:"out",FC:"FlowGraphPlayAnimationBlock"},done:{name:"done",FC:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(B,I,C,M,x){var y,f,L;const e=x[0],g=null===(y=B.configuration)||void 0===y?void 0:y.variable.value[0];if("number"!==typeof g)throw q.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const N=M.arrays.staticVariables[g];"undefined"===typeof e.config.animationType.value&&(M.arrays.staticVariables,e.config.animationType.value=(0,GC.z)(N.type));const R=x[4];return R.config||(R.config={}),(f=R.config).variable||(f.variable={}),R.config.variable.value=M.getVariableName(g),(L=x[3]).config||(L.config={}),x}},"pointer/get":{EN:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",FC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",FC:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(B,I,C,M,x)=>(x.forEach((B=>{"FlowGraphJsonPointerParserBlock"===B.className&&(B.config||(B.config={}),B.config.outputValue=!0)})),x)},"pointer/set":{EN:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",FC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",FC:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(B,I,C,M,x)=>(x.forEach((B=>{"FlowGraphJsonPointerParserBlock"===B.className&&(B.config||(B.config={}),B.config.outputValue=!0)})),x)},"pointer/interpolate":{EN:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",FC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",FC:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",FC:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",FC:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",FC:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",FC:"FlowGraphPlayAnimationBlock"},out:{name:"out",FC:"FlowGraphPlayAnimationBlock"},done:{name:"done",FC:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(B,I,C,M,x)=>(x.forEach((I=>{"FlowGraphJsonPointerParserBlock"===I.className?(I.config||(I.config={}),I.config.outputValue=!0):"FlowGraphInterpolationBlock"===I.className&&(I.config||(I.config={}),Object.keys(B.values||[]).forEach((C=>{var x;const y=null===(x=B.values)||void 0===x?void 0:x[C];if("value"===C&&y){const B=y.type;void 0!==B&&(I.config.animationType=M.arrays.types[B].flowGraphType)}})))})),x)},"animation/start":{EN:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",FC:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(B,I)=>[B[0]*I._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(B,I)=>[B[0]*I._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(B,I,C,M,x,y,f){const L=x[x.length-1];return L.config||(L.config={}),L.config.glTF=f,x}},"animation/stop":{EN:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",FC:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(B,I,C,M,x,y,f){const L=x[x.length-1];return L.config||(L.config={}),L.config.glTF=f,x}},"animation/stopAt":{EN:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",FC:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(B,I)=>[B[0]*I._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(B,I,C,M,x,y,f){const L=x[x.length-1];return L.config||(L.config={}),L.config.glTF=f,x}},"math/switch":{EN:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(B){if(B.configuration&&B.configuration.cases){const I=B.configuration.cases.value;if(!I.every((B=>"number"===typeof B&&/^-?\d+$/.test(B.toString()))))return q.b.Warn("Switch cases should be integers. Using empty array instead."),B.configuration.cases.value=[],{valid:!0};const C=new Set(I);B.configuration.cases.value=Array.from(C)}return{valid:!0}},extraProcessor(B,I,C,M,x){const y=x[0];return y.dataInputs.forEach((B=>{"default"!==B.name&&"case"!==B.name&&(B.name="in_"+B.name)})),y.config||(y.config={}),y.config.treatCasesAsIntegers=!0,x}},"debug/log":{EN:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function nC(B){let I=arguments.length>2?arguments[2]:void 0;return{EN:[B],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((B,I)=>(B[I]={name:I},B)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(B,C,M,x,y){var f;if(I){(f=y[0]).config||(f.config={}),y[0].config.preventIntegerFloatArithmetic=!0;let I=-1;Object.keys(B.values||{}).find((C=>{var M;return void 0!==(null===(M=B.values)||void 0===M?void 0:M[C].type)&&(I=B.values[C].type,!0)})),-1!==I&&(y[0].config.type=x.arrays.types[I].flowGraphType)}return y},validation:B=>I?OC(B):{valid:!0}}}function OC(B){if(B.values){const I=Object.keys(B.values).map((I=>B.values[I].type)).filter((B=>void 0!==B));if(!I.every((B=>B===I[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}pC["math/compose"]=pC["math/matCompose"],pC["math/decompose"]=pC["math/matDecompose"];var aC=C(11156);const WC={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"HI",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class dC{constructor(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=B,this._gltf=I,this._animationTargetFps=C,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const B of this._interactivityGraph.types)this._types.push(WC[B.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const B of this._interactivityGraph.declarations){const I=JC(B);if(!I)throw q.b.Error(["No mapping found for declaration",B]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:I,fullOperationName:B.extension?B.op+":"+B.extension:B.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const B of this._interactivityGraph.variables){const I=this._parseVariable(B);this._staticVariables.push(I)}}_parseVariable(B,I){const C=this._types[B.type];if(!C)throw q.b.Error(["No type found for variable",B]),new Error("Error parsing variables");if(B.value&&B.value.length!==C.length)throw q.b.Error(["Invalid value length for variable",B,C]),new Error("Error parsing variables");const M=B.value||[];if(!M.length)switch(C.flowGraphType){case"boolean":M.push(!1);break;case"FlowGraphInteger":M.push(0);break;case"number":M.push(NaN);break;case"Vector2":M.push(NaN,NaN);break;case"HI":M.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":M.fill(NaN,0,4);break;case"Matrix":M.fill(NaN,0,16);break;case"Matrix3D":M.fill(NaN,0,9)}return"number"===C.elementType&&"string"===typeof M[0]&&(M[0]=parseFloat(M[0])),{type:C.flowGraphType,value:I?I(M,this):M}}_parseEvents(){if(this._interactivityGraph.events)for(const B of this._interactivityGraph.events){const I={eventId:B.id||"internalEvent_"+this._internalEventsCounter++};B.values&&(I.eventData=Object.keys(B.values).map((I=>{var C;const M=null===(C=B.values)||void 0===C?void 0:C[I];if(!M)throw q.b.Error(["No value found for event key",I]),new Error("Error parsing events");const x=this._types[M.type];if(!x)throw q.b.Error(["No type found for event value",M]),new Error("Error parsing events");const y="undefined"!==typeof M.value?this._parseVariable(M):void 0;return{id:I,type:x.flowGraphType,eventData:!0,value:y}}))),this._events.push(I)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const I of this._interactivityGraph.nodes){if("number"!==typeof I.declaration)throw q.b.Error(["No declaration found for node",I]),new Error("Error parsing nodes");const C=this._mappings[I.declaration];if(!C)throw q.b.Error(["No mapping found for node",I]),new Error("Error parsing nodes");if(C.flowGraphMapping.validation){const M=C.flowGraphMapping.validation(I,this._interactivityGraph,this._gltf);var B;if(!M.valid)throw new Error(`Error validating interactivity node ${null===(B=this._interactivityGraph.declarations)||void 0===B?void 0:B[I.declaration].op} - ${M.error}`)}const M=[];for(const B of C.flowGraphMapping.EN){const x=this._getEmptyBlock(B,C.fullOperationName);this._parseNodeConfiguration(I,x,C.flowGraphMapping,B),M.push(x)}this._nodes.push({EN:M,fullOperationName:C.fullOperationName})}}_getEmptyBlock(B,I){return{uniqueId:(0,aC.c)(),className:B,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:I,metadata:{}}}_parseNodeConfiguration(B,I,C,M){const x=I.config;if(B.configuration){const I=Object.keys(B.configuration);for(const L of I){var y,f;const I=null===(y=B.configuration)||void 0===y?void 0:y[L];if(!I)throw q.b.Error(["No value found for node configuration",L]),new Error("Error parsing node configuration");const e=null===(f=C.configuration)||void 0===f?void 0:f[L];if(e&&e.FC?e.FC===M:0===C.EN.indexOf(M)){const B=(null===e||void 0===e?void 0:e.name)||L;I&&"undefined"!==typeof I.value||"undefined"===typeof(null===e||void 0===e?void 0:e.defaultValue)?I.value.length>=0?x[B]={value:1===I.value.length?I.value[0]:I.value}:q.b.Warn(["Invalid value for node configuration",I]):x[B]={value:e.defaultValue},e&&e.dataTransformer&&(x[B].value=e.dataTransformer([x[B].value],this)[0])}}}}_parseNodeConnections(B){for(let t=0;t<this._nodes.length;t++){var I;const r=null===(I=this._interactivityGraph.nodes)||void 0===I?void 0:I[t];if(!r)throw q.b.Error(["No node found for interactivity node",this._nodes[t]]),new Error("Error parsing node connections");const A=this._nodes[t],D=this._mappings[r.declaration];if(!D)throw q.b.Error(["No mapping found for node",r]),new Error("Error parsing node connections");const J=r.flows||{},i=Object.keys(J).sort();for(const B of i){var C,M,x,y;const I=J[B],g=null===(C=D.flowGraphMapping.outputs)||void 0===C||null===(M=C.flows)||void 0===M?void 0:M[B],N=(null===g||void 0===g?void 0:g.name)||B,R=this._createNewSocketConnection(N,!0);(g&&g.FC&&A.EN.find((B=>B.className===g.FC))||A.EN[0]).signalOutputs.push(R);const H=I.node,F=this._nodes[H];if(!F)throw q.b.Error(["No node found for input node id",H]),new Error("Error parsing node connections");const k=DC(F.fullOperationName);if(!k)throw q.b.Error(["No mapping found for input node",F]),new Error("Error parsing node connections");let S=null===(x=k.inputs)||void 0===x||null===(y=x.flows)||void 0===y?void 0:y[I.socket||"in"],o=!1;if(!S)for(const B in null===(f=k.inputs)||void 0===f?void 0:f.flows){var f,L,e;if(B.startsWith("[")&&B.endsWith("]"))o=!0,S=null===(L=k.inputs)||void 0===L||null===(e=L.flows)||void 0===e?void 0:e[B]}const U=S?o?S.name.replace("$1",I.socket||""):S.name:I.socket||"in",G=S&&S.FC&&F.EN.find((B=>B.className===S.FC))||F.EN[0];let V=G.signalInputs.find((B=>B.name===U));V||(V=this._createNewSocketConnection(U),G.signalInputs.push(V)),V.connectedPointIds.push(R.uniqueId),R.connectedPointIds.push(V.uniqueId)}const u=r.values||{},p=Object.keys(u);for(const I of p){var g,N;const C=u[I];let M=null===(g=D.flowGraphMapping.inputs)||void 0===g||null===(N=g.values)||void 0===N?void 0:N[I],x=!1;if(!M)for(const B in null===(R=D.flowGraphMapping.inputs)||void 0===R?void 0:R.values){var R,H,F;if(B.startsWith("[")&&B.endsWith("]"))x=!0,M=null===(H=D.flowGraphMapping.inputs)||void 0===H||null===(F=H.values)||void 0===F?void 0:F[B]}const y=M?x?M.name.replace("$1",I):M.name:I,f=this._createNewSocketConnection(y);if((M&&M.FC&&A.EN.find((B=>B.className===M.FC))||A.EN[0]).dataInputs.push(f),void 0!==C.value){const I=this._parseVariable(C,M&&M.dataTransformer);B._connectionValues[f.uniqueId]=I}else{if("undefined"===typeof C.node)throw q.b.Error(["Invalid value for value connection",C]),new Error("Error parsing node connections");{var k,S,o;const B=C.node,I=C.socket||"value",M=this._nodes[B];if(!M)throw q.b.Error(["No node found for output socket reference",C]),new Error("Error parsing node connections");const x=DC(M.fullOperationName);if(!x)throw q.b.Error(["No mapping found for output socket reference",C]),new Error("Error parsing node connections");let y=null===(k=x.outputs)||void 0===k||null===(S=k.values)||void 0===S?void 0:S[I],L=!1;if(!y)for(const C in null===(U=x.outputs)||void 0===U?void 0:U.values){var U,G,V;if(C.startsWith("[")&&C.endsWith("]"))L=!0,y=null===(G=x.outputs)||void 0===G||null===(V=G.values)||void 0===V?void 0:V[C]}const e=y?L?y.name.replace("$1",I):null===(o=y)||void 0===o?void 0:o.name:I,g=y&&y.FC&&M.EN.find((B=>B.className===y.FC))||M.EN[0];let N=g.dataOutputs.find((B=>B.name===e));N||(N=this._createNewSocketConnection(e,!0),g.dataOutputs.push(N)),f.connectedPointIds.push(N.uniqueId),N.connectedPointIds.push(f.uniqueId)}}}if(D.flowGraphMapping.interBlockConnectors)for(const B of D.flowGraphMapping.interBlockConnectors){const I=B.input,C=B.output,M=B.isVariable;this._connectFlowGraphNodes(I,C,A.EN[B.inputBlockIndex],A.EN[B.outputBlockIndex],M)}if(D.flowGraphMapping.extraProcessor){var c;const I=null===(c=this._interactivityGraph.declarations)||void 0===c?void 0:c[r.declaration];if(!I)throw q.b.Error(["No declaration found for extra processor",r]),new Error("Error parsing node connections");A.EN=D.flowGraphMapping.extraProcessor(r,I,D.flowGraphMapping,this,A.EN,B,this._gltf)}}}_createNewSocketConnection(B,I){return{uniqueId:(0,aC.c)(),name:B,_connectionType:I?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(B,I,C,M,x){const y=x?C.dataInputs:C.signalInputs,f=x?M.dataOutputs:M.signalOutputs,L=y.find((I=>I.name===B))||this._createNewSocketConnection(B),e=f.find((B=>B.name===I))||this._createNewSocketConnection(I,!0);y.find((I=>I.name===B))||y.push(L),f.find((B=>B.name===I))||f.push(e),L.connectedPointIds.push(e.uniqueId),e.connectedPointIds.push(L.uniqueId)}getVariableName(B){return"staticVariable_"+B}serializeToFlowGraph(){const B={uniqueId:(0,aC.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(B);for(let I=0;I<this._staticVariables.length;I++){const C=this._staticVariables[I];B._userVariables[this.getVariableName(I)]=C}return{rightHanded:!0,allBlocks:this._nodes.reduce(((B,I)=>B.concat(I.EN)),[]),executionContexts:[B]}}}const lC="KHR_interactivity";class EC{constructor(B){this._loader=B,this.name=lC,this.enabled=this._loader.isExtensionUsed(lC),this._pathConverter=(0,Q.g)(this._loader.qf),B._skipStartAnimationStep=!0;const I=B.babylonScene;I&&function(B){(0,Q.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!B.activeCamera)return new x.Quaternion(NaN,NaN,NaN,NaN);const I=x.Quaternion.FromRotationMatrix(B.activeCamera.getWorldMatrix()).normalize();return B.useRightHandedSystem||(I.w*=-1,I.x*=-1),I},type:"Quaternion",getTarget:()=>B.activeCamera}),(0,Q.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!B.activeCamera)return new x.HI(NaN,NaN,NaN);const I=B.activeCamera.getWorldMatrix().getTranslation();return B.useRightHandedSystem||(I.x*=-1),I},type:"HI",getTarget:()=>B.activeCamera}),(0,Q.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:B=>{var I;return(null===(I=B._babylonAnimationGroup)||void 0===I?void 0:I.isPlaying)??!1},type:"boolean",getTarget:B=>B._babylonAnimationGroup}),(0,Q.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:B=>{var I;return((null===(I=B._babylonAnimationGroup)||void 0===I?void 0:I.from)??0)/60},type:"number",getTarget:B=>B._babylonAnimationGroup}),(0,Q.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:B=>{var I;return((null===(I=B._babylonAnimationGroup)||void 0===I?void 0:I.to)??0)/60},type:"number",getTarget:B=>B._babylonAnimationGroup}),(0,Q.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:B=>{var I;return((null===(I=B._babylonAnimationGroup)||void 0===I?void 0:I.getCurrentFrame())??0)/60},type:"number",getTarget:B=>B._babylonAnimationGroup}),(0,Q.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:B=>{var I;return((null===(I=B._babylonAnimationGroup)||void 0===I?void 0:I.getCurrentFrame())??0)/60},type:"number",getTarget:B=>B._babylonAnimationGroup})}(I)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var B;if(!this._loader.babylonScene||!this._pathConverter)return;const I=this._loader.babylonScene,C=null===(B=this._loader.qf.extensions)||void 0===B?void 0:B.KHR_interactivity;if(!C)return;const M=new kC.d({kI:I});M.dispatchEventsSynchronously=!1;const x=C.graphs.map((B=>new dC(B,this._loader.qf,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(x.map((async B=>await tC(B,{coordinator:M,pathConverter:this._pathConverter})))),M.start()}}var QC;QC=async()=>(await Promise.resolve().then(C.bind(C,12955))).FlowGraphGLTFDataProvider,qC[`${lC}/${"FlowGraphGLTFDataProvider"}`]=QC,E(lC),l(lC,!0,(B=>new EC(B)));const ZC="KHR_node_visibility";(0,Q.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:B=>{const I=B._babylonTransformNode;return!I||void 0===I.isVisible||I.isVisible},set:(B,I)=>{var C,M;null===(C=I._primitiveBabylonMeshes)||void 0===C||C.forEach((B=>{B.inheritVisibility=!0})),I._babylonTransformNode&&(I._babylonTransformNode.isVisible=B),null===(M=I._primitiveBabylonMeshes)||void 0===M||M.forEach((I=>{I.isVisible=B}))},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class zC{constructor(B){this.name=ZC,this._loader=B,this.enabled=B.isExtensionUsed(ZC)}async onReady(){var B;null===(B=this._loader.qf.nodes)||void 0===B||B.forEach((B=>{var I,C,M,x;(null===(I=B._primitiveBabylonMeshes)||void 0===I||I.forEach((B=>{B.inheritVisibility=!0})),null!==(C=B.extensions)&&void 0!==C&&C.KHR_node_visibility)&&(!1===(null===(M=B.extensions)||void 0===M?void 0:M.KHR_node_visibility.visible)&&(B._babylonTransformNode&&(B._babylonTransformNode.isVisible=!1),null===(x=B._primitiveBabylonMeshes)||void 0===x||x.forEach((B=>{B.isVisible=!1}))))}))}dispose(){this._loader=null}}E(ZC),l(ZC,!0,(B=>new zC(B)));const bC="KHR_node_selectability";iC("event/onSelect",bC,{EN:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",FC:"FlowGraphGetVariableBlock",dataTransformer:B=>["pickedMesh_"+B[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",FC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(B,I,C,M,x,y,f){var L,e,g,N,R,H;const F=x[x.length-1];F.config=F.config||{},F.config.glTF=f;const k=null===(L=B.configuration)||void 0===L||null===(e=L.nodeIndex)||void 0===e?void 0:e.value[0];if(void 0===k||"number"!==typeof k)throw new Error("nodeIndex not found in configuration");const q="pickedMesh_"+k;return x[1].config.variable=q,y._userVariables[q]={className:"Mesh",id:null===f||void 0===f||null===(g=f.nodes)||void 0===g||null===(N=g[k]._babylonTransformNode)||void 0===N?void 0:N.id,uniqueId:null===f||void 0===f||null===(R=f.nodes)||void 0===R||null===(H=R[k]._babylonTransformNode)||void 0===H?void 0:H.uniqueId},x}}),(0,Q.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:B=>{const I=B._babylonTransformNode;return!I||void 0===I.Te||I.Te},set:(B,I)=>{var C;null===(C=I._primitiveBabylonMeshes)||void 0===C||C.forEach((I=>{I.Te=B}))},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"Te"],type:"boolean"});class YC{constructor(B){this.name=bC,this._loader=B,this.enabled=B.isExtensionUsed(bC)}async onReady(){var B;null===(B=this._loader.qf.nodes)||void 0===B||B.forEach((B=>{var I,C,M;null!==(I=B.extensions)&&void 0!==I&&I.KHR_node_selectability&&!1===(null===(C=B.extensions)||void 0===C?void 0:C.KHR_node_selectability.selectable)&&(null===(M=B._babylonTransformNode)||void 0===M||M.getChildMeshes().forEach((B=>{B.Te=!1})))}))}dispose(){this._loader=null}}E(bC),l(bC,!0,(B=>new YC(B)));const vC="KHR_node_hoverability",sC="targetMeshPointerOver_";iC("event/onHoverIn",vC,{EN:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",FC:"FlowGraphGetVariableBlock",dataTransformer:B=>[sC+B[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",FC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(B,I,C,M,x,y,f){var L,e,g,N,R,H;const F=x[x.length-1];F.config=F.config||{},F.config.glTF=f;const k=null===(L=B.configuration)||void 0===L||null===(e=L.nodeIndex)||void 0===e?void 0:e.value[0];if(void 0===k||"number"!==typeof k)throw new Error("nodeIndex not found in configuration");const q=sC+k;return x[1].config.variable=q,y._userVariables[q]={className:"Mesh",id:null===f||void 0===f||null===(g=f.nodes)||void 0===g||null===(N=g[k]._babylonTransformNode)||void 0===N?void 0:N.id,uniqueId:null===f||void 0===f||null===(R=f.nodes)||void 0===R||null===(H=R[k]._babylonTransformNode)||void 0===H?void 0:H.uniqueId},x}});const XC="targetMeshPointerOut_";iC("event/onHoverOut",vC,{EN:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",FC:"FlowGraphGetVariableBlock",dataTransformer:B=>[XC+B[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",FC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(B,I,C,M,x,y,f){var L,e,g,N,R,H;const F=x[x.length-1];F.config=F.config||{},F.config.glTF=f;const k=null===(L=B.configuration)||void 0===L||null===(e=L.nodeIndex)||void 0===e?void 0:e.value[0];if(void 0===k||"number"!==typeof k)throw new Error("nodeIndex not found in configuration");const q=XC+k;return x[1].config.variable=q,y._userVariables[q]={className:"Mesh",id:null===f||void 0===f||null===(g=f.nodes)||void 0===g||null===(N=g[k]._babylonTransformNode)||void 0===N?void 0:N.id,uniqueId:null===f||void 0===f||null===(R=f.nodes)||void 0===R||null===(H=R[k]._babylonTransformNode)||void 0===H?void 0:H.uniqueId},x}}),(0,Q.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:B=>{const I=B._babylonTransformNode;return!I||void 0===I.pointerOverDisableMeshTesting||I.pointerOverDisableMeshTesting},set:(B,I)=>{var C;null===(C=I._primitiveBabylonMeshes)||void 0===C||C.forEach((I=>{I.pointerOverDisableMeshTesting=!B}))},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class TC{constructor(B){this.name=vC,this._loader=B,this.enabled=B.isExtensionUsed(vC)}async onReady(){var B;null===(B=this._loader.qf.nodes)||void 0===B||B.forEach((B=>{var I,C,M;null!==(I=B.extensions)&&void 0!==I&&I.KHR_node_hoverability&&!1===(null===(C=B.extensions)||void 0===C?void 0:C.KHR_node_hoverability.hoverable)&&(null===(M=B._babylonTransformNode)||void 0===M||M.getChildMeshes().forEach((B=>{B.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}E(vC),l(vC,!0,(B=>new TC(B)));const PC="ExtrasAsMetadata";class hC{_assignExtras(B,I){if(I.extras&&Object.keys(I.extras).length>0){const C=B.metadata=B.metadata||{};(C.qf=C.qf||{}).extras=I.extras}}constructor(B){this.name=PC,this.enabled=!0,this._loader=B}dispose(){this._loader=null}loadNodeAsync(B,I,C){return this._loader.loadNodeAsync(B,I,(B=>{this._assignExtras(B,I),C(B)}))}loadCameraAsync(B,I,C){return this._loader.loadCameraAsync(B,I,(B=>{this._assignExtras(B,I),C(B)}))}createMaterial(B,I,C){const M=this._loader.createMaterial(B,I,C);return this._assignExtras(M,I),M}}E(PC),l(PC,!1,(B=>new hC(B)));C(12955)},12817:(B,I,C)=>{"use strict";C.d(I,{b:()=>O,e:()=>D,i:()=>A,m:()=>J});var M=C(11022),x=C(11018),y=C(12446),f=C(11645),L=C(11616),e=C(11625),g=C(11027),N=C(11056),R=C(11643),H=C(11725),F=C(11647),k=C(11232);class q{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.oH=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.KH=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(B){this._environmentTexture=B}getNodes(){let B=[];B=B.concat(this.meshes),B=B.concat(this.lights),B=B.concat(this.cameras),B=B.concat(this.transformNodes);for(const I of this.skeletons)B=B.concat(I.bones);return B}}class S extends q{}class o{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const B=this.rootNodes;for(const M of B)M.dispose();B.length=0;const I=this.skeletons;for(const M of I)M.dispose();I.length=0;const C=this.animationGroups;for(const M of C)M.dispose();C.length=0}}class U extends q{constructor(B){super(),this._wasAddedToScene=!1,(B=B||N.c.LastCreatedScene)&&(this.kI=B,this.proceduralTextures=[],B.If.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=B.getEngine().onContextRestoredObservable.add((()=>{for(const B of this.geometries)B._rebuild();for(const B of this.meshes)B._rebuild();for(const B of this.oH)B.rebuild();for(const B of this.textures)B._rebuild()})))}_topologicalSort(B){const I=new Map;for(const f of B)I.set(f.uniqueId,f);const C={dependsOn:new Map,dependedBy:new Map};for(const f of B){const B=f.uniqueId;C.dependsOn.set(B,new Set),C.dependedBy.set(B,new Set)}for(const f of B){const B=f.uniqueId,M=C.dependsOn.get(B);if(f instanceof R.d){const x=f.sourceMesh;I.has(x.uniqueId)&&(M.add(x.uniqueId),C.dependedBy.get(x.uniqueId).add(B))}const x=C.dependedBy.get(B);for(const y of f.getDescendants()){const M=y.uniqueId;if(I.has(M)){x.add(M);C.dependsOn.get(M).add(B)}}}const M=[],x=[];for(const f of B){const B=f.uniqueId;0===C.dependsOn.get(B).size&&(x.push(f),I.delete(B))}const y=x;for(;y.length>0;){const B=y.shift();M.push(B);const x=C.dependedBy.get(B.uniqueId);for(const M of Array.from(x.values())){const x=C.dependsOn.get(M);x.delete(B.uniqueId),0===x.size&&I.get(M)&&(y.push(I.get(M)),I.delete(M))}}return I.size>0&&(g.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),I.forEach((B=>{g.b.Error(B.name)}))),M}_addNodeAndDescendantsToList(B,I,C,M){if(C&&(!M||M(C))&&!I.has(C.uniqueId)){B.push(C),I.add(C.uniqueId);for(const x of C.getDescendants(!0))this._addNodeAndDescendantsToList(B,I,x,M)}}_isNodeInContainer(B){return B instanceof e.e&&-1!==this.meshes.indexOf(B)||(B instanceof L.d&&-1!==this.transformNodes.indexOf(B)||(B instanceof H.c&&-1!==this.lights.indexOf(B)||B instanceof F.e&&-1!==this.cameras.indexOf(B)))}_isValidHierarchy(){for(const B of this.meshes)if(B.parent&&!this._isNodeInContainer(B.parent))return g.b.Warn(`Node ${B.name} has a parent that is not in the container.`),!1;for(const B of this.transformNodes)if(B.parent&&!this._isNodeInContainer(B.parent))return g.b.Warn(`Node ${B.name} has a parent that is not in the container.`),!1;for(const B of this.lights)if(B.parent&&!this._isNodeInContainer(B.parent))return g.b.Warn(`Node ${B.name} has a parent that is not in the container.`),!1;for(const B of this.cameras)if(B.parent&&!this._isNodeInContainer(B.parent))return g.b.Warn(`Node ${B.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(B){let I=arguments.length>1&&void 0!==arguments[1]&&arguments[1],C=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||x.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const M={},y={},L=new o,e=[],g=[],N={doNotInstantiate:!0,...C},R=[],H=new Set;for(const x of this.transformNodes)null===x.parent&&this._addNodeAndDescendantsToList(R,H,x,N.predicate);for(const x of this.meshes)null===x.parent&&this._addNodeAndDescendantsToList(R,H,x,N.predicate);const F=this._topologicalSort(R),k=(C,x)=>{if(((I,C)=>{if(M[I.uniqueId]=C.uniqueId,y[C.uniqueId]=C,B&&(C.name=B(I.name)),C instanceof f.b){const B=C;if(B.morphTargetManager){const C=I.morphTargetManager;B.morphTargetManager=C.clone();for(let I=0;I<C.numTargets;I++){const x=C.getTarget(I),f=B.morphTargetManager.getTarget(I);M[x.uniqueId]=f.uniqueId,y[f.uniqueId]=f}}}})(C,x),C.parent){const B=M[C.parent.uniqueId],I=y[B];x.parent=I||C.parent}if(x.position&&C.position&&x.position.M(C.position),x.rotationQuaternion&&C.rotationQuaternion&&x.rotationQuaternion.M(C.rotationQuaternion),x.rotation&&C.rotation&&x.rotation.M(C.rotation),x.Xf&&C.Xf&&x.Xf.M(C.Xf),x.material){const f=x;if(f.material)if(I){const I=C.material;if(-1===g.indexOf(I)){let C=I.clone(B?B(I.name):"Clone of "+I.name);if(g.push(I),M[I.uniqueId]=C.uniqueId,y[C.uniqueId]=C,"MultiMaterial"===I.getClassName()){const x=I;for(const I of x.jf)I&&(C=I.clone(B?B(I.name):"Clone of "+I.name),g.push(I),M[I.uniqueId]=C.uniqueId,y[C.uniqueId]=C);x.jf=x.jf.map((B=>B&&y[M[B.uniqueId]]))}}"InstancedMesh"!==f.getClassName()&&(f.material=y[M[I.uniqueId]])}else"MultiMaterial"===f.material.getClassName()?-1===this.kI.multiMaterials.indexOf(f.material)&&this.kI.addMultiMaterial(f.material):-1===this.kI.materials.indexOf(f.material)&&this.kI.addMaterial(f.material)}null===x.parent&&L.rootNodes.push(x)};for(const x of F)if("InstancedMesh"===x.getClassName()){const B=x,I=B.sourceMesh,C=M[I.uniqueId];k(B,("number"===typeof C?y[C]:I).createInstance(B.name))}else{let B=!0;"Le"===x.getClassName()||"Node"===x.getClassName()||x.skeleton||!x.getTotalVertices||0===x.getTotalVertices()?B=!1:N.doNotInstantiate&&(B="function"===typeof N.doNotInstantiate?!N.doNotInstantiate(x):!N.doNotInstantiate);const I=B?x.createInstance(`instance of ${x.name}`):x.clone(`Clone of ${x.name}`,null,!0);if(!I)throw new Error(`Could not clone or instantiate node on Asset Container ${x.name}`);k(x,I)}for(const x of this.skeletons){if(N.predicate&&!N.predicate(x))continue;const I=x.clone(B?B(x.name):"Clone of "+x.name);for(const B of this.meshes)if(B.skeleton===x&&!B.isAnInstance){const C=y[M[B.uniqueId]];if(!C||C.isAnInstance)continue;if(C.skeleton=I,-1!==e.indexOf(I))continue;e.push(I);for(const B of I.bones)B._linkedTransformNode&&(B._linkedTransformNode=y[M[B._linkedTransformNode.uniqueId]])}L.skeletons.push(I)}for(const x of this.animationGroups){if(N.predicate&&!N.predicate(x))continue;const I=x.clone(B?B(x.name):"Clone of "+x.name,(B=>y[M[B.uniqueId]]||B));L.animationGroups.push(I)}return L}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||x.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.kI.environmentTexture=this.environmentTexture);for(const B of this.kI._serializableComponents)B.addFromContainer(this);this.kI.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const I=[];for(const C of this.cameras)B&&!B(C)||(this.kI.addCamera(C),I.push(C));for(const C of this.lights)B&&!B(C)||(this.kI.addLight(C),I.push(C));for(const C of this.meshes)B&&!B(C)||(this.kI.AN(C),I.push(C));for(const C of this.skeletons)B&&!B(C)||this.kI.addSkeleton(C);for(const C of this.animations)B&&!B(C)||this.kI.addAnimation(C);for(const C of this.animationGroups)B&&!B(C)||this.kI.addAnimationGroup(C);for(const C of this.multiMaterials)B&&!B(C)||this.kI.addMultiMaterial(C);for(const C of this.materials)B&&!B(C)||this.kI.addMaterial(C);for(const C of this.morphTargetManagers)B&&!B(C)||this.kI.addMorphTargetManager(C);for(const C of this.geometries)B&&!B(C)||this.kI.addGeometry(C);for(const C of this.transformNodes)B&&!B(C)||(this.kI.addTransformNode(C),I.push(C));for(const C of this.actionManagers)B&&!B(C)||this.kI.addActionManager(C);for(const C of this.textures)B&&!B(C)||this.kI.addTexture(C);for(const C of this.reflectionProbes)B&&!B(C)||this.kI.addReflectionProbe(C);for(const C of I)C.parent&&-1===this.kI.getNodes().indexOf(C.parent)&&(C.setParent?C.setParent(null):C.parent=null)}removeAllFromScene(){this._isValidHierarchy()||x.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.kI.environmentTexture&&(this.kI.environmentTexture=null);for(const B of this.kI._serializableComponents)B.removeFromContainer(this)}removeFromScene(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const I of this.cameras)B&&!B(I)||this.kI.removeCamera(I);for(const I of this.lights)B&&!B(I)||this.kI.removeLight(I);for(const I of this.meshes)B&&!B(I)||this.kI.rN(I,!0);for(const I of this.skeletons)B&&!B(I)||this.kI.removeSkeleton(I);for(const I of this.animations)B&&!B(I)||this.kI.removeAnimation(I);for(const I of this.animationGroups)B&&!B(I)||this.kI.removeAnimationGroup(I);for(const I of this.multiMaterials)B&&!B(I)||this.kI.removeMultiMaterial(I);for(const I of this.materials)B&&!B(I)||this.kI.removeMaterial(I);for(const I of this.morphTargetManagers)B&&!B(I)||this.kI.removeMorphTargetManager(I);for(const I of this.geometries)B&&!B(I)||this.kI.removeGeometry(I);for(const I of this.transformNodes)B&&!B(I)||this.kI.removeTransformNode(I);for(const I of this.actionManagers)B&&!B(I)||this.kI.removeActionManager(I);for(const I of this.textures)B&&!B(I)||this.kI.removeTexture(I);for(const I of this.reflectionProbes)B&&!B(I)||this.kI.removeReflectionProbe(I)}dispose(){const B=this.cameras.slice(0);for(const F of B)F.dispose();this.cameras.length=0;const I=this.lights.slice(0);for(const F of I)F.dispose();this.lights.length=0;const C=this.meshes.slice(0);for(const F of C)F.dispose();this.meshes.length=0;const M=this.skeletons.slice(0);for(const F of M)F.dispose();this.skeletons.length=0;const x=this.animationGroups.slice(0);for(const F of x)F.dispose();this.animationGroups.length=0;const y=this.multiMaterials.slice(0);for(const F of y)F.dispose();this.multiMaterials.length=0;const f=this.materials.slice(0);for(const F of f)F.dispose();this.materials.length=0;const L=this.geometries.slice(0);for(const F of L)F.dispose();this.geometries.length=0;const e=this.transformNodes.slice(0);for(const F of e)F.dispose();this.transformNodes.length=0;const g=this.actionManagers.slice(0);for(const F of g)F.dispose();this.actionManagers.length=0;const N=this.textures.slice(0);for(const F of N)F.dispose();this.textures.length=0;const R=this.reflectionProbes.slice(0);for(const F of R)F.dispose();this.reflectionProbes.length=0;const H=this.morphTargetManagers.slice(0);for(const F of H)F.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const F of this.kI._serializableComponents)F.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.kI.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(B,I,C){if(B&&I)for(const M of B){let B=!0;if(C)for(const I of C)if(M===I){B=!1;break}B&&(I.push(M),M._parentContainer=this)}}moveAllFromScene(B){this._wasAddedToScene=!1,void 0===B&&(B=new S);for(const I in this)Object.prototype.hasOwnProperty.call(this,I)&&(this[I]=this[I]||("_environmentTexture"===I?null:[]),this._moveAssets(this.kI[I],this[I],B[I]));this.environmentTexture=this.kI.environmentTexture,this.removeAllFromScene()}createRootMesh(){const B=new f.b("assetContainerRootMesh",this.kI);for(const I of this.meshes)I.parent||B.addChild(I);return this.meshes.unshift(B),B}mergeAnimationsTo(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N.c.LastCreatedScene,I=arguments.length>1?arguments[1]:void 0,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!B)return g.b.Error("No scene available to merge animations to"),[];const M=C||(I=>{let C=null;const M=I.animations.length?I.animations[0].targetProperty:"",x=I.name.split(".").join("").split("_primitive")[0];switch(M){case"position":case"rotationQuaternion":C=B.getTransformNodeByName(I.name)||B.getTransformNodeByName(x);break;case"influence":C=B.getMorphTargetByName(I.name)||B.getMorphTargetByName(x);break;default:C=B.getNodeByName(I.name)||B.getNodeByName(x)}return C}),x=this.getNodes();for(const L of x){const B=M(L);if(null!==B){for(const I of L.animations){const C=B.animations.filter((B=>B.targetProperty===I.targetProperty));for(const I of C){const C=B.animations.indexOf(I,0);C>-1&&B.animations.splice(C,1)}}B.animations=B.animations.concat(L.animations)}}const y=[],f=this.animationGroups.slice();for(const L of f){y.push(L.clone(L.name,M));for(const B of L.animatables)B.stop()}for(const L of I){const I=M(L.target);I&&(B.beginAnimation(I,L.fromFrame,L.toFrame,L.loopAnimation,L.speedRatio,L.onAnimationEnd?L.onAnimationEnd:void 0,void 0,!0,void 0,L.onAnimationLoop?L.onAnimationLoop:void 0),B.stopAnimation(L.target))}return y}populateRootNodes(){this.rootNodes.length=0;for(const B of this.meshes)B.parent||-1!==this.rootNodes.indexOf(B)||this.rootNodes.push(B);for(const B of this.transformNodes)B.parent||-1!==this.rootNodes.indexOf(B)||this.rootNodes.push(B);for(const B of this.lights)B.parent||-1!==this.rootNodes.indexOf(B)||this.rootNodes.push(B);for(const B of this.cameras)B.parent||-1!==this.rootNodes.indexOf(B)||this.rootNodes.push(B)}addAllAssetsToContainer(B){if(!B)return;const I=[],C=new Set;for(I.push(B);I.length>0;){const B=I.pop();if(B instanceof f.b?(B.zf&&-1===this.geometries.indexOf(B.zf)&&this.geometries.push(B.zf),this.meshes.push(B)):B instanceof R.d?this.meshes.push(B):B instanceof L.d?this.transformNodes.push(B):B instanceof H.c?this.lights.push(B):B instanceof F.e&&this.cameras.push(B),B instanceof e.e){if(B.material&&-1===this.materials.indexOf(B.material)){this.materials.push(B.material);for(const I of B.material.getActiveTextures())-1===this.textures.indexOf(I)&&this.textures.push(I)}B.skeleton&&-1===this.skeletons.indexOf(B.skeleton)&&this.skeletons.push(B.skeleton),B.morphTargetManager&&-1===this.morphTargetManagers.indexOf(B.morphTargetManager)&&this.morphTargetManagers.push(B.morphTargetManager)}for(const M of B.getChildren())C.has(M)||I.push(M);C.add(B)}this.populateRootNodes()}_getByTags(B,I,C){if(void 0===I)return B;const M=[];for(const x in B){const y=B[x];k.e&&k.e.MatchesQuery(y,I)&&(!C||C(y))&&M.push(y)}return M}getMeshesByTags(B,I){return this._getByTags(this.meshes,B,I)}getCamerasByTags(B,I){return this._getByTags(this.cameras,B,I)}getLightsByTags(B,I){return this._getByTags(this.lights,B,I)}getMaterialsByTags(B,I){return this._getByTags(this.materials,B,I).concat(this._getByTags(this.multiMaterials,B,I))}getTransformNodesByTags(B,I){return this._getByTags(this.transformNodes,B,I)}}var G=C(11072);class V{constructor(B){this.byteOffset=0,this.buffer=B}async loadAsync(B){const I=await this.buffer.readAsync(this.byteOffset,B);this._dataView=new DataView(I.buffer,I.byteOffset,I.byteLength),this._dataByteOffset=0}readUint32(){const B=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,B}readUint8Array(B){const I=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,B);return this._dataByteOffset+=B,this.byteOffset+=B,I}readString(B){return(0,G.g)(this.readUint8Array(B))}skipBytes(B){this._dataByteOffset+=B,this.byteOffset+=B}}var c=C(12819);const t="Z2xURg",r={name:"qf",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:B=>-1!==B.indexOf("asset")&&-1!==B.indexOf("version")||B.startsWith("data:base64,"+t)||B.startsWith("data:;base64,"+t)||B.startsWith("data:application/octet-stream;base64,"+t)||B.startsWith("data:model/gltf-binary;base64,"+t)};var A,D,J,i=C(11062),u=C(11069);function p(B,I,C){try{return Promise.resolve(new Uint8Array(B,I,C))}catch(M){return Promise.reject(M)}}!function(B){B[B.AUTO=0]="AUTO",B[B.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(A||(A={})),function(B){B[B.NONE=0]="NONE",B[B.FIRST=1]="FIRST",B[B.ALL=2]="ALL"}(D||(D={})),function(B){B[B.LOADING=0]="LOADING",B[B.READY=1]="READY",B[B.COMPLETE=2]="COMPLETE"}(J||(J={}));class n{constructor(){this.coordinateSystemMode=A.AUTO,this.animationStartMode=D.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=B=>Promise.resolve(B),this.extensionOptions={}}M(B){B&&(this.onParsed=B.onParsed,this.coordinateSystemMode=B.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=B.animationStartMode??this.animationStartMode,this.loadNodeAnimations=B.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=B.loadSkins??this.loadSkins,this.loadMorphTargets=B.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=B.compileMaterials??this.compileMaterials,this.useClipPlane=B.useClipPlane??this.useClipPlane,this.compileShadowGenerators=B.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=B.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=B.useRangeRequests??this.useRangeRequests,this.createInstances=B.createInstances??this.createInstances,this.alwaysComputeBoundingBox=B.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=B.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=B.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=B.skipMaterials??this.skipMaterials,this.useSRGBBuffers=B.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=B.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=B.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=B.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=B.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=B.customRootNode,this.onMeshLoaded=B.onMeshLoaded,this.onSkinLoaded=B.onSkinLoaded,this.onTextureLoaded=B.onTextureLoaded,this.onMaterialLoaded=B.onMaterialLoaded,this.onCameraLoaded=B.onCameraLoaded,this.extensionOptions=B.extensionOptions??this.extensionOptions)}}class O extends n{constructor(B){super(),this.onParsedObservable=new M.e,this.onMeshLoadedObservable=new M.e,this.onSkinLoadedObservable=new M.e,this.onTextureLoadedObservable=new M.e,this.onMaterialLoadedObservable=new M.e,this.onCameraLoadedObservable=new M.e,this.onCompleteObservable=new M.e,this.onErrorObservable=new M.e,this.If=new M.e,this.onExtensionLoadedObservable=new M.e,this.validate=!1,this.onValidatedObservable=new M.e,this._loader=null,this._state=null,this._requests=new Array,this.name=r.name,this.extensions=r.extensions,this.onLoaderStateChangedObservable=new M.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.M(B)}set onParsed(B){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),B&&(this._onParsedObserver=this.onParsedObservable.add(B))}set onMeshLoaded(B){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),B&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(B))}set onSkinLoaded(B){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),B&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((I=>B(I.node,I.skinnedNode))))}set onTextureLoaded(B){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),B&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(B))}set onMaterialLoaded(B){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),B&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(B))}set onCameraLoaded(B){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),B&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(B))}set onComplete(B){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(B)}set onError(B){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(B)}set onDispose(B){this._onDisposeObserver&&this.If.remove(this._onDisposeObserver),this._onDisposeObserver=this.If.add(B)}set onExtensionLoaded(B){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(B)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(B){this._loggingEnabled!==B&&(this._loggingEnabled=B,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(B){this._capturePerformanceCounters!==B&&(this._capturePerformanceCounters=B,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(B){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(B)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const B of this._requests)B.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=B=>Promise.resolve(B),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.If.notifyObservers(void 0),this.If.clear()}loadFile(B,I,C,y,f,L,e,N){if(ArrayBuffer.isView(I))return this._loadBinary(B,I,C,y,e,N),null;this._progressCallback=f;const R=I.name||x.Tools.GetFilename(I);if(L){if(this.useRangeRequests){this.validate&&g.b.Warn("glTF validation is not supported when range requests are enabled");const C={abort:()=>{},onCompleteObservable:new M.e},x={readAsync:(C,M)=>new Promise(((x,y)=>{this._loadFile(B,I,(B=>{x(new Uint8Array(B))}),!0,(B=>{y(B)}),(B=>{B.setRequestHeader("Range",`bytes=${C}-${C+M-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new V(x)).then((B=>{C.onCompleteObservable.notifyObservers(C),y(B)}),e?B=>e(void 0,B):void 0),C}return this._loadFile(B,I,(I=>{this._validate(B,new Uint8Array(I,0,I.byteLength),C,R),this._unpackBinaryAsync(new V({readAsync:(B,C)=>p(I,B,C),byteLength:I.byteLength})).then((B=>{y(B)}),e?B=>e(void 0,B):void 0)}),!0,e)}return this._loadFile(B,I,(I=>{try{this._validate(B,I,C,R),y({json:this._parseJson(I)})}catch{e&&e()}}),!1,e)}_loadBinary(B,I,C,M,x,y){this._validate(B,new Uint8Array(I.buffer,I.byteOffset,I.byteLength),C,y),this._unpackBinaryAsync(new V({readAsync:(B,C)=>function(B,I,C){try{if(I<0||I>=B.byteLength)throw new RangeError("Offset is out of range.");if(I+C>B.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(B.buffer,B.byteOffset+I,C))}catch(M){return Promise.reject(M)}}(I,B,C),byteLength:I.byteLength})).then((B=>{M(B)}),x?B=>x(void 0,B):void 0)}importMeshAsync(B,I,C,M,x,y){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(C),this.onParsedObservable.clear(),this._log(`Loading ${y||""}`),this._loader=this._getLoader(C),this._loader.importMeshAsync(B,I,null,C,M,x,y))))}loadAsync(B,I,C,M,x){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(I),this.onParsedObservable.clear(),this._log(`Loading ${x||""}`),this._loader=this._getLoader(I),this._loader.loadAsync(B,I,C,M,x))))}loadAssetContainerAsync(B,I,C,M,x){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(I),this.onParsedObservable.clear(),this._log(`Loading ${x||""}`),this._loader=this._getLoader(I);const y=new U(B),f=[];this.onMaterialLoadedObservable.add((B=>{f.push(B)}));const L=[];this.onTextureLoadedObservable.add((B=>{L.push(B)}));const e=[];this.onCameraLoadedObservable.add((B=>{e.push(B)}));const g=[];return this.onMeshLoadedObservable.add((B=>{B.morphTargetManager&&g.push(B.morphTargetManager)})),this._loader.importMeshAsync(null,B,y,I,C,M,x).then((B=>(Array.prototype.push.apply(y.geometries,B.geometries),Array.prototype.push.apply(y.meshes,B.meshes),Array.prototype.push.apply(y.oH,B.oH),Array.prototype.push.apply(y.skeletons,B.skeletons),Array.prototype.push.apply(y.animationGroups,B.animationGroups),Array.prototype.push.apply(y.materials,f),Array.prototype.push.apply(y.textures,L),Array.prototype.push.apply(y.lights,B.lights),Array.prototype.push.apply(y.transformNodes,B.transformNodes),Array.prototype.push.apply(y.cameras,e),Array.prototype.push.apply(y.morphTargetManagers,g),y)))}))}canDirectLoad(B){return r.canDirectLoad(B)}directLoad(B,I){if(I.startsWith("base64,"+t)||I.startsWith(";base64,"+t)||I.startsWith("application/octet-stream;base64,"+t)||I.startsWith("model/gltf-binary;base64,"+t)){const C=(0,i.c)(I);return this._validate(B,new Uint8Array(C,0,C.byteLength)),this._unpackBinaryAsync(new V({readAsync:(B,I)=>p(C,B,I),byteLength:C.byteLength}))}return this._validate(B,I),Promise.resolve({json:this._parseJson(I)})}createPlugin(B){return new O(B[r.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((B,I)=>{this.onCompleteObservable.addOnce((()=>{B()})),this.onErrorObservable.addOnce((B=>{I(B)}))}))}_setState(B){this._state!==B&&(this._state=B,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(J[this._state]))}_loadFile(B,I,C,M,x,y){const f=B._loadFile(I,C,(B=>{this._onProgress(B,f)}),!0,M,x,y);return f.onCompleteObservable.add((()=>{f._lengthComputable=!0,f._total=f._loaded})),this._requests.push(f),f}_onProgress(B,I){if(!this._progressCallback)return;I._lengthComputable=B.lengthComputable,I._loaded=B.loaded,I._total=B.total;let C=!0,M=0,x=0;for(const y of this._requests){if(void 0===y._lengthComputable||void 0===y._loaded||void 0===y._total)return;C=C&&y._lengthComputable,M+=y._loaded,x+=y._total}this._progressCallback({lengthComputable:C,loaded:M,total:C?x:0})}_validate(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),c.b.ValidateAsync(I,C,M,(I=>this.preprocessUrlAsync(C+I).then((I=>B._loadFileAsync(I,void 0,!0,!0).then((B=>new Uint8Array(B,0,B.byteLength))))))).then((B=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(B),this.onValidatedObservable.clear()}),(B=>{this._endPerformanceCounter("Validate JSON"),x.Tools.Warn(`Failed to validate: ${B.message}`),this.onValidatedObservable.clear()})))}_getLoader(B){const I=B.json.asset||{};this._log(`Asset version: ${I.version}`),I.minVersion&&this._log(`Asset minimum version: ${I.minVersion}`),I.generator&&this._log(`Asset generator: ${I.generator}`);const C=O._parseVersion(I.version);if(!C)throw new Error("Invalid version: "+I.version);if(void 0!==I.minVersion){const B=O._parseVersion(I.minVersion);if(!B)throw new Error("Invalid minimum version: "+I.minVersion);if(O._compareVersion(B,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+I.minVersion)}const M={1:O._CreateGLTF1Loader,2:O._CreateGLTF2Loader}[C.major];if(!M)throw new Error("Unsupported version: "+I.version);return M(this)}_parseJson(B){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${B.length}`);const I=JSON.parse(B);return this._endPerformanceCounter("Parse JSON"),I}_unpackBinaryAsync(B){return this._startPerformanceCounter("Unpack Binary"),B.loadAsync(20).then((()=>{const I=B.readUint32();if(1179937895!==I)throw new u.j("Unexpected magic: "+I,u.f.GLTFLoaderUnexpectedMagicError);const C=B.readUint32();this.loggingEnabled&&this._log(`Binary version: ${C}`);const M=B.readUint32();let x;switch(this.useRangeRequests||M===B.buffer.byteLength||g.b.Warn(`Length in header does not match actual data length: ${M} != ${B.buffer.byteLength}`),C){case 1:x=this._unpackBinaryV1Async(B,M);break;case 2:x=this._unpackBinaryV2Async(B,M);break;default:throw new Error("Unsupported version: "+C)}return this._endPerformanceCounter("Unpack Binary"),x}))}_unpackBinaryV1Async(B,I){const C=B.readUint32(),M=B.readUint32();if(0!==M)throw new Error(`Unexpected content format: ${M}`);const x=I-B.byteOffset,y={json:this._parseJson(B.readString(C)),bin:null};if(0!==x){const I=B.byteOffset;y.bin={readAsync:(C,M)=>B.buffer.readAsync(I+C,M),byteLength:x}}return Promise.resolve(y)}_unpackBinaryV2Async(B,I){const C=1313821514,M=5130562,x=B.readUint32();if(B.readUint32()!==C)throw new Error("First chunk format is not JSON");return B.byteOffset+x===I?B.loadAsync(x).then((()=>({json:this._parseJson(B.readString(x)),bin:null}))):B.loadAsync(x+8).then((()=>{const y={json:this._parseJson(B.readString(x)),bin:null},f=()=>{const x=B.readUint32();switch(B.readUint32()){case C:throw new Error("Unexpected JSON chunk");case M:{const I=B.byteOffset;y.bin={readAsync:(C,M)=>B.buffer.readAsync(I+C,M),byteLength:x},B.skipBytes(x);break}default:B.skipBytes(x)}return B.byteOffset!==I?B.loadAsync(8).then(f):Promise.resolve(y)};return f()}))}static _parseVersion(B){if("1.0"===B||"1.0.1"===B)return{major:1,minor:0};const I=(B+"").match(/^(\d+)\.(\d+)/);return I?{major:parseInt(I[1]),minor:parseInt(I[2])}:null}static _compareVersion(B,I){return B.major>I.major?1:B.major<I.major?-1:B.minor>I.minor?1:B.minor<I.minor?-1:0}_logOpen(B){this._log(B),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(B){const I=O._logSpaces.substring(0,2*this._logIndentLevel);g.b.Log(`${I}${B}`)}_logDisabled(B){}_startPerformanceCounterEnabled(B){x.Tools.StartPerformanceCounter(B)}_startPerformanceCounterDisabled(B){}_endPerformanceCounterEnabled(B){x.Tools.EndPerformanceCounter(B)}_endPerformanceCounterDisabled(B){}}O.IncrementalLoading=!0,O.HomogeneousCoordinates=!1,O._logSpaces="                                ",(0,y.e)(new O)},12819:(B,I,C)=>{"use strict";C.d(I,{b:()=>f});var M=C(11018);function x(B,I,C,M){const x={externalResourceFunction:M};return C&&(x.uri="file:"===I?C:I+C),ArrayBuffer.isView(B)?GLTFValidator.validateBytes(B,x):GLTFValidator.validateString(B,x)}function y(){const B=[];onmessage=I=>{const C=I.data;switch(C.id){case"init":importScripts(C.url);break;case"validate":x(C.data,C.rootUrl,C.fileName,(I=>new Promise(((C,M)=>{const x=B.length;B.push({resolve:C,reject:M}),postMessage({id:"getExternalResource",index:x,uri:I})})))).then((B=>{postMessage({id:"validate.resolve",value:B})}),(B=>{postMessage({id:"validate.reject",reason:B})}));break;case"getExternalResource.resolve":B[C.index].resolve(C.value);break;case"getExternalResource.reject":B[C.index].reject(C.reason)}}}class f{static ValidateAsync(B,I,C,f){return"function"===typeof Worker?new Promise(((L,e)=>{const g=`${x}(${y})()`,N=URL.createObjectURL(new Blob([g],{type:"application/javascript"})),R=new Worker(N),H=B=>{R.removeEventListener("error",H),R.removeEventListener("message",F),e(B)},F=B=>{const I=B.data;switch(I.id){case"getExternalResource":f(I.uri).then((B=>{R.postMessage({id:"getExternalResource.resolve",index:I.index,value:B},[B.buffer])}),(B=>{R.postMessage({id:"getExternalResource.reject",index:I.index,reason:B})}));break;case"validate.resolve":R.removeEventListener("error",H),R.removeEventListener("message",F),L(I.value),R.terminate();break;case"validate.reject":R.removeEventListener("error",H),R.removeEventListener("message",F),e(I.reason),R.terminate()}};if(R.addEventListener("error",H),R.addEventListener("message",F),R.postMessage({id:"init",url:M.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(B)){const M=B.slice();R.postMessage({id:"validate",data:M,rootUrl:I,fileName:C},[M.buffer])}else R.postMessage({id:"validate",data:B,rootUrl:I,fileName:C})})):(this._LoadScriptPromise||(this._LoadScriptPromise=M.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>x(B,I,C,f))))}}f.Configuration={url:`${M.Tools._DefaultCdnUrl}/gltf_validator.js`}},13382:(B,I,C)=>{"use strict";C.d(I,{d:()=>r});var M=C(11180),x=C(11186),y=C(11226),f=C(11194),L=C(11586),e=C(11513),g=C(11270),N=C(11440),R=C(11149),H=C(11110);C(12575),C(12474),C(12488),C(12476),C(12494),C(12497),C(12504);const F="imageProcessingCompatibility",k="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";H.d.IncludesShadersStore[F]||(H.d.IncludesShadersStore[F]=k);const q="skyPixelShader",S="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";H.d.ShadersStore[q]||(H.d.ShadersStore[q]=S);C(12581),C(12509),C(12515),C(12528),C(12520);const o="skyVertexShader",U="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";H.d.ShadersStore[o]||(H.d.ShadersStore[o]=U);var G=C(11509),V=C(11565),c=C(11559);class t extends L.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class r extends e.c{constructor(B,I){super(B,I),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new f.HI(0,100,0),this.useSunPosition=!1,this.cameraOffset=f.HI.Zero(),this.up=f.HI.Up(),this.dithering=!1,this._cameraPosition=f.HI.Zero(),this._skyOrientation=new f.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(B,I){const C=I._drawWrapper;if(this.isFrozen&&C.effect&&C._wasPreviouslyReady)return!0;I.materialDefines||(I.materialDefines=new t);const M=I.materialDefines,x=this.rB();if(this._isReadyForSubMesh(I))return!0;if((0,c.P)(B,x,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,M),(0,c.F)(B,M,!0,!1),M.IMAGEPROCESSINGPOSTPROCESS!==x.imageProcessingConfiguration.applyByPostProcess&&M.markAsMiscDirty(),M.DITHER!==this.dithering&&M.markAsMiscDirty(),M.isDirty){M.markAsProcessed(),x.resetCachedMaterial();const B=new G.b;M.FOG&&B.addFallback(1,"FOG"),M.IMAGEPROCESSINGPOSTPROCESS=x.imageProcessingConfiguration.applyByPostProcess,M.DITHER=this.dithering;const C=[g.g.PositionKind];M.VERTEXCOLOR&&C.push(g.g.ColorKind);const y="sky",f=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,V.e)(f);const L=M.toString();I.setEffect(x.getEngine().createEffect(y,C,f,[],L,B,this.onCompiled,this.onError),M,this._materialContext)}return!(!I.effect||!I.effect.isReady())&&(M._renderId=x.getRenderId(),C._wasPreviouslyReady=!0,!0)}bindForSubMesh(B,I,C){const M=this.rB(),x=C.materialDefines;if(!x)return;const y=C.effect;if(!y)return;this._activeEffect=y,this.bindOnlyWorldMatrix(B),this._activeEffect.setMatrix("viewProjection",M.getTransformMatrix()),this._mustRebind(M,y,C)&&((0,V.f)(y,this,M),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,c.h)(x,y,M)),M.fogEnabled&&I.applyFog&&M.fogMode!==N.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",M.getViewMatrix()),(0,c.e)(M,I,this._activeEffect);const L=M.activeCamera;if(L){const B=L.getWorldMatrix();this._cameraPosition.x=B.m[12],this._cameraPosition.y=B.m[13],this._cameraPosition.z=B.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const B=Math.PI*(this.inclination-.5),I=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(I)*Math.cos(B),this.sunPosition.y=this.distance*Math.sin(-B),this.sunPosition.z=this.distance*Math.sin(I)*Math.cos(B),f.Quaternion.FromUnitVectorsToRef(f.HI.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(I,this._activeEffect,C)}getAnimatables(){return[]}dispose(B){super.dispose(B)}clone(B){return y.d.Clone((()=>new r(B,this.rB())),this)}serialize(){const B=super.serialize();return B.customType="BABYLON.SkyMaterial",B}getClassName(){return"SkyMaterial"}static Parse(B,I,C){return y.d.Parse((()=>new r(B.name,I)),B,I,C)}}(0,M.e)([(0,x.K)()],r.prototype,"luminance",void 0),(0,M.e)([(0,x.K)()],r.prototype,"turbidity",void 0),(0,M.e)([(0,x.K)()],r.prototype,"rayleigh",void 0),(0,M.e)([(0,x.K)()],r.prototype,"mieCoefficient",void 0),(0,M.e)([(0,x.K)()],r.prototype,"mieDirectionalG",void 0),(0,M.e)([(0,x.K)()],r.prototype,"distance",void 0),(0,M.e)([(0,x.K)()],r.prototype,"inclination",void 0),(0,M.e)([(0,x.K)()],r.prototype,"azimuth",void 0),(0,M.e)([(0,x.G)()],r.prototype,"sunPosition",void 0),(0,M.e)([(0,x.K)()],r.prototype,"useSunPosition",void 0),(0,M.e)([(0,x.G)()],r.prototype,"cameraOffset",void 0),(0,M.e)([(0,x.G)()],r.prototype,"up",void 0),(0,M.e)([(0,x.K)()],r.prototype,"dithering",void 0),(0,R.h)("BABYLON.SkyMaterial",r)},11806:(B,I,C)=>{"use strict";function M(B,I){I.headers=B.headers||{},I.statusMessage=B.statusText,I.statusCode=B.status,I.data=B.response}function x(B,I,C){return new Promise((function(x,y){C=C||{};var f,L,e,g=new XMLHttpRequest,N=C.body,R=C.headers||{};for(f in C.timeout&&(g.timeout=C.timeout),g.ontimeout=g.onerror=function(B){B.timeout="timeout"==B.type,y(B)},g.open(B,I.href||I),g.onload=function(){for(e=g.getAllResponseHeaders().trim().split(/[\r\n]+/),M(g,g);L=e.shift();)L=L.split(": "),g.headers[L.shift().toLowerCase()]=L.join(": ");if((L=g.headers["content-type"])&&~L.indexOf("application/json"))try{g.data=JSON.parse(g.data,C.reviver)}catch(B){return M(g,B),y(B)}(g.status>=400?y:x)(g)},typeof FormData<"u"&&N instanceof FormData||N&&"object"==typeof N&&(R["content-type"]="application/json",N=JSON.stringify(N)),g.withCredentials=!!C.withCredentials,R)g.setRequestHeader(f,R[f]);g.send(N)}))}C.r(I),C.d(I,{del:()=>e,get:()=>y,patch:()=>L,post:()=>f,put:()=>g,send:()=>x});var y=x.bind(x,"GET"),f=x.bind(x,"POST"),L=x.bind(x,"PATCH"),e=x.bind(x,"DELETE"),g=x.bind(x,"PUT")},13487:(B,I,C)=>{"use strict";C.d(I,{d:()=>R});const M=.5*(Math.sqrt(3)-1),x=(3-Math.sqrt(3))/6,y=1/3,f=1/6,L=(Math.sqrt(5)-1)/4,e=(5-Math.sqrt(5))/20,g=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),N=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const R=class{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const I="function"==typeof B?B:function(B){let I=0,C=0,M=0,x=1;const y=function(){let B=4022871197;return function(I){I=I.toString();for(let C=0;C<I.length;C++){B+=I.charCodeAt(C);let M=.02519603282416938*B;B=M>>>0,M-=B,M*=B,B=M>>>0,M-=B,B+=4294967296*M}return 2.3283064365386963e-10*(B>>>0)}}();I=y(" "),C=y(" "),M=y(" "),I-=y(B),I<0&&(I+=1);C-=y(B),C<0&&(C+=1);M-=y(B),M<0&&(M+=1);return function(){const B=2091639*I+2.3283064365386963e-10*x;return I=C,C=M,M=B-(x=0|B)}}(B);this.p=function(B){const I=new Uint8Array(256);for(let C=0;C<256;C++)I[C]=C;for(let C=0;C<255;C++){const M=C+~~(B()*(256-C)),x=I[C];I[C]=I[M],I[M]=x}return I}(I),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let C=0;C<512;C++)this.perm[C]=this.p[255&C],this.permMod12[C]=this.perm[C]%12}noise2D(B,I){const C=this.permMod12,y=this.perm;let f=0,L=0,e=0;const N=(B+I)*M,R=Math.floor(B+N),H=Math.floor(I+N),F=(R+H)*x,k=B-(R-F),q=I-(H-F);let S,o;k>q?(S=1,o=0):(S=0,o=1);const U=k-S+x,G=q-o+x,V=k-1+2*x,c=q-1+2*x,t=255&R,r=255&H;let A=.5-k*k-q*q;if(A>=0){const B=3*C[t+y[r]];A*=A,f=A*A*(g[B]*k+g[B+1]*q)}let D=.5-U*U-G*G;if(D>=0){const B=3*C[t+S+y[r+o]];D*=D,L=D*D*(g[B]*U+g[B+1]*G)}let J=.5-V*V-c*c;if(J>=0){const B=3*C[t+1+y[r+1]];J*=J,e=J*J*(g[B]*V+g[B+1]*c)}return 70*(f+L+e)}noise3D(B,I,C){const M=this.permMod12,x=this.perm;let L,e,N,R;const H=(B+I+C)*y,F=Math.floor(B+H),k=Math.floor(I+H),q=Math.floor(C+H),S=(F+k+q)*f,o=B-(F-S),U=I-(k-S),G=C-(q-S);let V,c,t,r,A,D;o>=U?U>=G?(V=1,c=0,t=0,r=1,A=1,D=0):o>=G?(V=1,c=0,t=0,r=1,A=0,D=1):(V=0,c=0,t=1,r=1,A=0,D=1):U<G?(V=0,c=0,t=1,r=0,A=1,D=1):o<G?(V=0,c=1,t=0,r=0,A=1,D=1):(V=0,c=1,t=0,r=1,A=1,D=0);const J=o-V+f,i=U-c+f,u=G-t+f,p=o-r+2*f,n=U-A+2*f,O=G-D+2*f,a=o-1+.5,W=U-1+.5,d=G-1+.5,l=255&F,E=255&k,Q=255&q;let Z=.6-o*o-U*U-G*G;if(Z<0)L=0;else{const B=3*M[l+x[E+x[Q]]];Z*=Z,L=Z*Z*(g[B]*o+g[B+1]*U+g[B+2]*G)}let z=.6-J*J-i*i-u*u;if(z<0)e=0;else{const B=3*M[l+V+x[E+c+x[Q+t]]];z*=z,e=z*z*(g[B]*J+g[B+1]*i+g[B+2]*u)}let b=.6-p*p-n*n-O*O;if(b<0)N=0;else{const B=3*M[l+r+x[E+A+x[Q+D]]];b*=b,N=b*b*(g[B]*p+g[B+1]*n+g[B+2]*O)}let Y=.6-a*a-W*W-d*d;if(Y<0)R=0;else{const B=3*M[l+1+x[E+1+x[Q+1]]];Y*=Y,R=Y*Y*(g[B]*a+g[B+1]*W+g[B+2]*d)}return 32*(L+e+N+R)}noise4D(B,I,C,M){const x=this.perm;let y,f,g,R,H;const F=(B+I+C+M)*L,k=Math.floor(B+F),q=Math.floor(I+F),S=Math.floor(C+F),o=Math.floor(M+F),U=(k+q+S+o)*e,G=B-(k-U),V=I-(q-U),c=C-(S-U),t=M-(o-U);let r=0,A=0,D=0,J=0;G>V?r++:A++,G>c?r++:D++,G>t?r++:J++,V>c?A++:D++,V>t?A++:J++,c>t?D++:J++;const i=r>=3?1:0,u=A>=3?1:0,p=D>=3?1:0,n=J>=3?1:0,O=r>=2?1:0,a=A>=2?1:0,W=D>=2?1:0,d=J>=2?1:0,l=r>=1?1:0,E=A>=1?1:0,Q=D>=1?1:0,Z=J>=1?1:0,z=G-i+e,b=V-u+e,Y=c-p+e,v=t-n+e,s=G-O+2*e,X=V-a+2*e,T=c-W+2*e,P=t-d+2*e,h=G-l+3*e,j=V-E+3*e,w=c-Q+3*e,K=t-Z+3*e,m=G-1+4*e,BB=V-1+4*e,IB=c-1+4*e,CB=t-1+4*e,MB=255&k,xB=255&q,yB=255&S,fB=255&o;let LB=.6-G*G-V*V-c*c-t*t;if(LB<0)y=0;else{const B=x[MB+x[xB+x[yB+x[fB]]]]%32*4;LB*=LB,y=LB*LB*(N[B]*G+N[B+1]*V+N[B+2]*c+N[B+3]*t)}let eB=.6-z*z-b*b-Y*Y-v*v;if(eB<0)f=0;else{const B=x[MB+i+x[xB+u+x[yB+p+x[fB+n]]]]%32*4;eB*=eB,f=eB*eB*(N[B]*z+N[B+1]*b+N[B+2]*Y+N[B+3]*v)}let gB=.6-s*s-X*X-T*T-P*P;if(gB<0)g=0;else{const B=x[MB+O+x[xB+a+x[yB+W+x[fB+d]]]]%32*4;gB*=gB,g=gB*gB*(N[B]*s+N[B+1]*X+N[B+2]*T+N[B+3]*P)}let NB=.6-h*h-j*j-w*w-K*K;if(NB<0)R=0;else{const B=x[MB+l+x[xB+E+x[yB+Q+x[fB+Z]]]]%32*4;NB*=NB,R=NB*NB*(N[B]*h+N[B+1]*j+N[B+2]*w+N[B+3]*K)}let RB=.6-m*m-BB*BB-IB*IB-CB*CB;if(RB<0)H=0;else{const B=x[MB+1+x[xB+1+x[yB+1+x[fB+1]]]]%32*4;RB*=RB,H=RB*RB*(N[B]*m+N[B+1]*BB+N[B+2]*IB+N[B+3]*CB)}return 27*(y+f+g+R+H)}}}}]);